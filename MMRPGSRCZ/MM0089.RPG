     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Loans/deposits/NA issued input')              *
      *****************************************************************
      *                                                               *
      *  Midas - MM Dealer Module                                     *
      *                                                               *
      *     This program will be made redundant at DBA R4.00          *
      *     In the interim please check the new ILE RPG versions      *
      *     and apply any new fixes if they are appropriate.          *
      *                                                               *
      *  MM0089  -  BACK OFFICE DEAL INPUT - LOANS/DEPOSITS -         *
      *               INPUT AND AUTHORISATION                         *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CER050             Date 16Jun19               *
      *  Prev Amend No. MD053295           Date 13Apr19               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *      
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 AR996895           Date 25Nov12               *
      *                 CRE073             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CDL081             Date 14Dec09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL013             Date 08Jun06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD027A            Date 16May06               *
      *                 237063             Date 20Nov05               *
      *                 CDL038             Date 10May05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CDL022             Date 03Feb04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 04Oct01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 192008             Date 09Apr01               *
      *                 CRE007             Date 01Mar01               *
      *                 170254             Date 14Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      *                 176510             Date 22Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 163715             Date 25Nov99               *
      *                 CSE006             DATE 03Feb00               *
      *                 CPB001             DATE 18Jun99               *
      *                 108068             Date 14Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 163136             Date 07Jul99               *
      *                 136653             Date 28Apr99               *
      *                 145001             Date 19Oct98               *
      *                 144833             Date 14Oct98               *
      *                 143523             Date 29Sep98               *
      *                 CEU015             Date 19Jun98               *
      *                 121483             Date 09Jun98               *
      *                 109308             DATE 09Jun98               *
      *                 108558             DATE 21May98               *
      *                 125411             DATE 27FEB98               *
      *                 115152             DATE 27FEB98               *
      *                 136728             Date 11Jun98               *
      *                 CAP002             Date 01May98               *
      *                 135093             Date 12May98               *
      *                 134935             Date 10May98               *
      *                 CEU003             DATE 29MAR98               *
      *                 082887             DATE 24FEB98               *
      *                 091823             DATE 28JAN98               *
      *                 107546             DATE 27JAN98               *
      *                 109275             DATE 27JAN98               *
      *                 109732             DATE 26JAN98               *
      *                 109269             DATE 20JAN98               *
      *                 103237             DATE 20JAN98               *
      *                 081888             DATE 14JAN98               *
      *                 077469             DATE 13JAN98               *
      *                 109628             DATE 08DEC97               *
      *                 126017             DATE 18NOV97               *
      *                 120827             Date 06Jul97               *
      *                 109015             Date 24Sep97               *
      *                 117785             DATE 24JUN97               *
      *                 091825             DATE 24JUN97               *
      *                 105817             DATE 18FEB97               *
      *                 097885             DATE 03FEB97               *
      *                 104058             DATE 01NOV96               *
      *                 S01408             DATE 18OCT96               *
      *                 S01408             DATE 03OCT96               *
      *                 S01408             DATE 05SEP96               *
      *                 S01408             DATE 03SEP96               *
      *                 S01408             DATE 30AUG96               *
      *                 S01408             DATE 22AUG96               *
      *                 S01408             DATE 22AUG96               *
      *                 088044             DATE 22JUL96               *
      *                 CAC001             DATE 01FEB96               *
      *                 093081             DATE 05JUL96               *
      *                 S01408             DATE 05JUL96               *
      *                 S01408             DATE 11JUN96               *
      *                 095180             DATE 21NOV95               *
      *                 S01408             DATE 01MAY96               *
      *                 S01408             DATE 12APR96               *
      *                 S01408             DATE 01APR96               *
      *                 CPM004             DATE 08FEB96               *
      *                 072531             DATE 23FEB96               *
      *                 070080             DATE 23FEB96               *
      *                 S01408             DATE 22FEB96               *
      *                 072529             DATE 22FEB96               *
      *                 S01408             DATE 12FEB96               *
      *                 S01408             DATE 06FEB96               *
      *                 S01408             DATE 18JAN96               *
      *                 088852             DATE 06JUL95               *
      *                 087755             DATE 08JUN95               *
      *                 093843             DATE 17OCT95               *
      *                 S01408             DATE 08JAN96               #
      *                 090749             DATE 04JAN95               *
      *                 097564             DATE 22DEC95               *
      *                 095244             DATE 01NOV95               *
      *                 095238             DATE 31OCT95               *
      *                 S01408             DATE 10NOV95               *
      *                 S01408             DATE 23OCT95               *
      *                 093723             DATE 28SEP95               *
      *                 090480             DATE 25OCT95               *
      *                 089603             DATE 19OCT95               *
      *                 091554             DATE 18OCT95               *
      *                 087923             DATE 05MAY95               *
      *                 088263             DATE 08JUN95               *
      *                 S01408             DATE 15SEP95               *
      *                 S01408             DATE 05SEP95               *
      *                 S01408             DATE 21AUG95               *
      *                 S01408             DATE 02AUG95               *
      *                 S01408             DATE 20JUL95               *
      *                 087551             DATE 18MAY95               *
      *                 088306             DATE 21JUN95               *
      *                 088380             DATE 16JUN95               *
      *                 087176             DATE 15JUN95               *
      *                 086484             DATE 15JUN95               *
      *                 S01408             DATE 25MAY95               *
      *                 082738             DATE 17MAR95               *
      *                 S01408             DATE 21MAR95               *
      *                 082290             DATE 12APR95               *
      *                 084659             DATE 11APR95               *
      *                 S01444             DATE 12APR95               *
      *                 S01408             DATE 13MAR95               *
      *                 079775             DATE 25JAN95               *
      *                 079768             DATE 25JAN95               *
      *                 079765             DATE 25JAN95               *
      *                 079157             DATE 25JAN95               *
      *                 077939             DATE 25JAN95               *
      *                 077554             DATE 25JAN95               *
      *                 S01408             DATE 13DEC94               *
      *                 079475             DATE 12DEC94               *
      *                 S01486             DATE 01NOV94               *
      *                 S01408             DATE 15NOV94               *
      *                 068204             DATE 25OCT94               *
      *                 067079             DATE 24OCT94               *
      *                 075360             DATE 14OCT94               *
      *                 075430             DATE 13OCT94               *
      *                 S01408             DATE 21SEP94               *
      *                 073516             DATE 12AUG94               *
      *                 044740             DATE 05JUL94               *
      *                 067426             DATE 21APR94               *
      *                 064243             DATE 07MAR94               *
      *                 065460             DATE 04MAR94               *
      *                 065492             DATE 04MAR94               *
      *                 066074             DATE 04MAR94               *
      *                 S01468             DATE 06MAR94               *
      *                 062962             DATE 11FEB94               *
      *                 063371             DATE 03FEB94               *
      *                 059667             DATE 03FEB94               *
      *                 S01408             DATE 20JAN94               *
      *                 063375             DATE 17JAN94               *
      *                 060779             DATE 13JAN94               *
      *                 S01453             DATE 14DEC93               *
      *                 060936             DATE 10NOV93               *
      *                 060933             DATE 10NOV93               *
      *                 055836             DATE 10NOV93               *
      *                 047780             DATE 26OCT93               *
      *                 S01408             DATE 04OCT93               *
      *                 S01443             DATE 22AUG93               *
      *                 061426             DATE 30SEP93               *
      *                 S01434             DATE 29JUL93               *
      *                 057977             DATE 18SEP93               *
      *                 054069             DATE 18SEP93               *
      *                 S01408             DATE 23AUG93               *
      *                 042960             DATE 20AUG93               *
      *                 055894             DATE 20AUG93               *
      *                 053519             DATE 20AUG93               *
      *                 052511             DATE 20AUG93               *
      *                 S01408             DATE 22JUL93               *
      *                 052292             DATE 29JUN93               *
      *                 056095             DATE 07JUN93               *
      *                 054889             DATE 09JUN93               *
      *                 E51300             DATE 17MAY93               *
      *                 043277             DATE 26APR93               *
      *                 027568             DATE 26APR93               *
      *                 047736             DATE 26APR93               *
      *                 E52924             DATE 22APR93               *
      *                 E52649             DATE 20APR93               *
      *                 E50108             DATE 01APR93               *
      *                 E01005             DATE 09MAR93               *
      *                 E50684             DATE 03MAR93               *
      *                 E46993             DATE 10MAR93               *
      *                 E48032             DATE 01FEB93               *
      *                 E47130             DATE 01FEB93               *
      *                 E46937             DATE 01FEB93               *
      *                 E47225             DATE 01FEB93               *
      *                 E46904             DATE 01FEB93               *
      *                 049499             DATE 13JAN93               *
      *                 046323             DATE 29OCT92               *
      *                 046259             DATE 28OCT92               *
      *                 E40579             DATE 13OCT92               *
      *                 S01392             DATE 20JUL92               *
      *                 S01391             DATE 20JUL92               *
      *                 AUS007             DATE 15JUL92               *
      *                 AUS003             DATE 19JUN92               *
      *                 AUS011             DATE 19JUN92               *
      *                 E40281             DATE 07AUG92               *
      *                 S01383             DATE 27APR92               *
      *                 E34306             DATE 13JAN92               *
      *                 S01354             DATE 06JAN92               *
      *                 E30473             DATE 19NOV91               *
      *                 E29975             DATE 18OCT91               *
      *                 BH1114             DATE 22AUG91               *
      *                 BH1059             DATE 22AUG91               *
      *                 BH1117             DATE 22AUG91               *
      *                 E25562             DATE 20AUG91               *
      *                 E24039             DATE 16AUG91               *
      *                 E24405             DATE 16AUG91               *
      *                 E25515             DATE 14AUG91               *
      *                 S01319             DATE 07AUG91               *
      *                 E24202             DATE 29JUL91               *
      *                 E26566             DATE 24JUL91               *
      *                 E24533             DATE 23JUL91               *
      *                 E24019             DATE 23JUL91               *
      *                 E24193             DATE 19JUL91               *
      *                 E21775             DATE 07JUL91               *
      *                 E24366             DATE 28JUN91               *
      *                 E25678             DATE 27JUN91               *
      *                 E25683             DATE 27JUN91               *
      *                 RT0150             DATE 12JUN91               *
      *                 E24242             DATE 05JUN91               *
      *                 DT0170             DATE 16MAY91               *
      *                 DT0073             DATE 13MAY91               *
      *                 E16048             DATE 08MAY91               *
      *                 E16047             DATE 24SEP90               *
      *                 BHF894             DATE 30OCT90               *
      *                 BHF861             DATE 19OCT90               *
      *                 DT0013             DATE 28MAR91               *
      *                 DT0012             DATE 26MAR91               *
      *                 DT0024             DATE 22MAR91               *
      *                 DT0015             DATE 20MAR91               *
      *                 DT0009             DATE 20MAR91               *
      *                 DT0010             DATE 20MAR91               *
      *                 E21612             DATE 25SEP90               *
      *                 E23511             DATE 20SEP90               *
      *                 E23406             DATE 18SEP90               *
      *                 S01304             DATE 13SEP90               *
      *                 S01184             DATE 12NOV89               *
      *                 E22903             DATE 20AUG90               *
      *                 E23044             DATE 13AUG90               *
      *                 E22219             DATE 08AUG90               *
      *                 E23026             DATE 02AUG90               *
      *                 E23032             DATE 31JUL90               *
      *                 E22936             DATE 30JUL90               *
      *                 E20636             DATE 25JUL90               *
      *                 E22744             DATE 21JUL90               *
      *                 E22668             DATE 20JUL90               *
      *                 E22412             DATE 04JUL90               *
      *                 E21835             DATE 11JUN90               *
      *                 E18886             DATE 18APR90               *
      *                 E19066             DATE 18APR90               *
      *                 E22161             DATE 24MAY90               *
      *                 S01253             DATE 17APR90               *
      *                 E20774             DATE 06APR90               *
      *                 S01252             DATE 19FEB90               *
      *                 S01251             DATE 19FEB90               *
      *                 E21145             DATE 17FEB90               *
      *                 E20611             DATE 15FEB90               *
      *                 E20989             DATE 15FEB90               *
      *                 E20609             DATE 15FEB90               *
      *                 S01314             DATE 15JAN91               *
      *                 S01241             DATE 08JAN90               *
      *                 LN1143             DATE 15FEB91               *
      *                 LN1104             DATE 14FEB91               *
      *                 BHF367             DATE 01OCT90               *
      *                 LN0558             DATE 28SEP90               *
      *                 BHF632             DATE 14SEP90               *
      *                 BHF364             DATE 08AUG90               *
      *                 BHF488             DATE 12SEP90               *
      *                 E22405             DATE 16AUG90               *
      *                 BHF365             DATE 02AUG90               *
      *                 BHF079             DATE 06AUG90               *
      *                 BHF280             DATE 03AUG90               *
      *                 E17279             DATE 03AUG90               *
      *                 LN0390             DATE 21JUN90               *
      *                 S01282             DATE 20JUN90               *
      *                 LN0234             DATE 06JUN90               *
      *                 LN0266             DATE 25MAY90               *
      *                 LN0023             DATE 25MAY90               *
      *                 E20202             DATE 25APR90               *
      *                 E270               DATE 21MAR90               *
      *                 S01199             DATE 08MAR90               *
      *                 E20282             DATE 31JAN90               *
      *                 E15515             DATE 03JAN90               *
      *                 E20376             DATE 23NOV89               *
      *                 E20041             DATE 30OCT89               *
      *                 E214/S01227        DATE 18JAN90               *
      *                 E81                DATE 09JAN90               *
      *                 E83                DATE 20NOV89               *
      *                 E70                DATE 16NOV89               *
      *                 E00032             DATE 07NOV89               *
      *                 E19346             DATE 26SEP89               *
      *                 E18187             DATE 20/09/89              *
      *                 E18569             DATE 20/09/89              *
      *                 E19396             DATE 30AUG89               *
      *                 S01218             DATE 10/08/89              *
      *                 S01176             DATE 30/01/89              *
      *                 E18596             DATE 06JUL89               *
      *                 E18599             DATE 03JUL89               *
      *                 E16042             DATE 20JUN89               *
      *                 E17710             DATE 07/06/89              *
      *                 E18380             DATE 18/05/89              *
      *                 E18139             DATE 03/05/89              *
      *                 E18138             DATE 24/04/89              *
      *                 E17654             DATE 20/04/89              *
      *                 E17020             DATE 22/03/89              *
      *                 E17603             DATE 22/03/89              *
      *                 E17051             DATE 09/03/89              *
      *                 E17050             DATE 01/03/89              *
      *                 E17021             DATE 01/03/89              *
      *                 E16709             DATE 01/03/89              *
      *                 E16027             DATE 05/01/89              *
      *                 S01194             DATE 08/09/89              *
      *                 S01195             DATE 21/06/89              *
      *                 S01117             DATE 19/06/89              *
      *                 S01177             DATE 14/06/89              *
      *                 E16252             DATE 16/12/88              *
      *                 E16041             DATE 25/11/88              *
      *                 E15947             DATE 23/11/88              *
      *                 E13747             DATE 02/09/88              *
      *                 E14354             DATE 25/08/88              *
      *                 E14353             DATE 10/08/88              *
      *                 E14377             DATE 02/08/88              *
      *                 E14356             DATE 27/07/88              *
      *                 E14363             DATE 26/07/88              *
      *                 E14035             DATE 15/07/88              *
      *                 S01165             DATE 25/05/88              *
      *                 E13873             DATE 25/06/88              *
      *                 E12945             DATE 04/05/88              *
      *                 E12415             DATE 27/03/88              *
      *                 E12662             DATE 24/03/88              *
      *                 E12686             DATE 21/03/88              *
      *                 E12306             DATE 17/03/88              *
      *                 E12663             DATE 17/03/88              *
      *                 E12365             DATE 15/03/88              *
      *                 E12574             DATE 09/03/88              *
      *                 S01136             DATE 03/07/87              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus                                       *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CDL081 - Tiered withholding tax rounding upgrade             *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL013 - Tiered Withholding Tax                              *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines                                        *
      *  CDL022 - Deal Amendment Changes (Recompile)                  *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.                                     *
      *  CPK014 - Release 4 packaging.  Rename of field which is too  *
      *           long for OPM program.                               *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  192008 - Book Code not defaulted.                            *
      *  CRE007 - Base Rate Tax 2001.                                 *
      *  170254 - Customer Shortname is not output in file MMDELDPP   *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to ZINTDY changes                    *
      *  176510 - Incorporation of fixes 171062 and 166075 into Core  *
      *           171062 - Only allocate profit centre from matrix    *
      *           after customer has been validated. 166075 - Remove  *
      *           fix LN0390 as it was done before PCA module was     *
      *           developed and causes error in the functioning       *
      *           of the default profit centre matrix.                *
      *  163715 - Get error message saying Interest Settlement A/c    *
      *           is invalid, because branch code is blank. Fix is    *
      *           to move default branch code into IBRCA, remove      *
      *           part of 125411 so that IBRCA is passed to AOACCTR0  *
      *           instead of BJSBRC which is blank if MBIN = 'Y'.     *
      *  CSE006 - Repurchase Agreements (REPOS) enhancement:          *
      *           New field - Transaction Type added to DEALSDC       *
      *           clashes with a work field in this program.          *
      *  CPB001 - 'Private Banking' Module                            *
      *  108068 - Recompiled over changed display file.               *
      *  163136 - Interest Calculation Method '6'  showing incorrect -*
      *           ZERO - amount . Addition to Core #126017 which dealt*
      *           with the issue. It introduced an additional  INT6DY *
      *           field in s-routine ZINTDY in  /COPY ZSRSRC/ZINTDYZ2 *
      *           which in turn is usually called from GLINTC s-routine
      *           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
      *           least a dozen other pgms that use ZINTDY but do     *
      *           GLINTC-processing within the pgms calculation specs *
      *  136653 - Action code field is blanked after authorization    *
      *  145001 - CEU015 fix: Pass the original rollover by deal      *
      *           amount (HKORDA) to MM0081. This will be used        *
      *           to update the RBDA of the rolled over deal.         *
      *  144833 - When called from Rollover Deals Maintenance some    *
      *           EMU fields are not validated properly as SAR        *
      *           check is enclosed in restricted condition.          *
      *  143523 - When the maturity date is brought forward in        *
      *           preparation for rollover to Euros, allow            *
      *           interest frequency day in month to be changed.      *
      *           CEU015 fix.                                         *
      *  CEU015 - Amended to allow deals denominated in Euros to      *
      *           rollover deals denominated in 'in' currencies.      *
      *  121483 - Unable to reauthorise deal after amending           *
      *           settlement details. Applied fix 115730.             *
      *  109308 - Ensure that the prompt function for int. counterparty
      *           nostro,if used (ie '?' entry) that the called prompt*
      *           programs , update the screen field if selected.     *
      *  108558 - Only allow to change book code if the deal is       *
      *           completed and waiting for authorisation.            *
      *  125411 - Initialise parameter for access object AOACCTR0     *
      *  115152 - Base ccy rate tolerance work field is to small.     *
      *           Increased the size of @ULIM.  Applied fix 114480.   *
      *  136728 - Interest Settlement Ccy Field is always highlighted *
      *  CAP002 - Recompiled as part of conversion of Midas inputs to *
      *           modular API structure.                              *
      *  135093 - Fix 077469 should only apply to inserts.            *
      *  134935 - Settlement currency not shown/amendable if          *
      *           transition starts before value date                 *
      *  CEU003 - EMU Dealing Settlement Ccy Conversion               *
      *  082887 - Use Half Adjust for BRT calculations and redefine   *
      *           tax amount field to avoid rounding errors.          *
      *  091823 - Incorrect Next Interest Date accepted because Value *
      *           Date is a holiday. Fix is not to condition Next Int *
      *           Date validation on *IN11 which is set on if Value   *
      *           Date is not a working day, and prevents the program *
      *           outputting an error message.                        *
      *  107546 - If deal number has already been inserted by another *
      *           user send message MMM1015 instead of crashing.      *
      *  109275 - Spread/rate not being edited correctly because work *
      *           field is not being initialised.                     *
      *  109732 - On select screen, if action code is 'X' (authorise) *
      *           then retain this action code when deal is displayed.*
      *  109269 - Do not show Deleted deals on the Authorisation      *
      *           selection screen.                                   *
      *  103237 - System allows the time deposit to be rolled over    *
      *           with a different subtype to the original TD deal.   *
      *           If subtype is different, then issue a WARNING. This *
      *           is a compromise between 088852 & 079765 .           *
      *  081888 - AOCURRR0 crashes if invalid broker code entered.    *
      *           Fix is to access broker currency record only if a   *
      *           valid broker code has been entered.                 *
      *  077469 - Input should not be allowed if value date is        *
      *           beyond back-valuation period.                       *
      *  109628 - If Portfolio Management Module is not switched on   *
      *           do not display the Portfolio input field or perform *
      *           validation on it whilst doing a Rollover.           *
      *  126017 - Correction to interest calculation for calculation  *
      *           basis 6 in SR/GLINTC - recompile program.           *
      *  120827 - Profit Centre Accounting defaulting                 *
      *  109015 - Disable the use of F/14 for amendment and           *
      *           authorisation.                                      *
      *  117785 - Program tried to divide by zero because an invalid  *
      *           Calc Method was entered therefore the field @@YEAR  *
      *           had zero in it.                                     *
      *  091825 - Error in MIDAS payment instructions field when      *
      *           amendment has been done on the deal.                *
      *  105817 - Bad incorporation of S01486 missing access of       *
      *           SDMMODP                                             *
      *  097885 - Recompiled for wrong calculation of number of day   *
      *           interest (ZINTDYZ2).                                *
      *  104058 - Defaulting of PTFR incorrect                        *
      *  S01408 - Core hook MM0089C144 added                          *
      *         - Core hook MM0089C143 added                          *
      *         - Core hook MM0089C142 added                          *
      *  S01408 - Core hook MM0089C141 added                          *
      *         - Core hook MM0089C140 added                          *
      *         - Core hook MM0089C139 added                          *
      *         - Core hook MM0089C138 added                          *
      *         - Core hook MM0089C137 added                          *
      *         - Core hook MM0089C136 added                          *
      *  S01408 - Core hook MM0089C135 added                          *
      *         - Core hook MM0089C134 added                          *
      *         - Core hook MM0089C133 added                          *
      *  S01408 - Core hook MM0089C132 added                          *
      *  S01408 - Core hook MM0089C130 added                          *
      *         - Core hook MM0089C131 added                          *
      *         - Core hook MM0089FFP1 added                          *
      *  S01408 - Core hook MM0089C129 added                          *
      *         - Core hook MM0089C128 added                          *
      *         - Core hook MM0089C127 added                          *
      *         - Core hook MM0089C126 added                          *
      *         - Core hook MM0089C125 added                          *
      *         - Core hook MM0089C124 added                          *
      *         - Core hook MM0089C123 added                          *
      *         - Core hook MM0089C122 added                          *
      *         - Core hook MM0089C121 added                          *
      *  S01408 - Core hook MM0089C120 added                          *
      *         - Core hook MM0089C119 added                          *
      *         - Core hook MM0089C118 added                          *
      *  088044 - VALIDATE THAT THE INTEREST SETTLEMENT ACCOUNT IS    *
      *           OPEN                                                *
      *  CAC001 - Profit Centre Accounting Development:               *
      *           Three addt'l fields will appear in a window to en-  *
      *           able Funding Information to be recorded.  The window*
      *           program AA1000 is optional and will be displayed by *
      *           taking F19.                                         *
      *  093081 - Do not allow deletion of a deal with status 'R' -   *
      *           (requires re-authorisation) since this shows up as  *
      *           an un-authorised deal, but it cannot be authorised. *
      *           Fix is to force user to re-authorise the amended    *
      *           deal before deleting.                               *
      *  S01408 - Core hook MM0089EEP2 added                          *
      *           Core hook MM0089C117 added                          *
      *           Core hook MM0089C116 added                          *
      *           Core hook MM0089C115 added                          *
      *           Core hook MM0089C114 added                          *
      *           Core hook MM0089C113 added                          *
      *  S01408 - Core hook MM0089C111 added                          *
      *           Core hook MM0089C112 added                          *
      *  095180 - TRAM feedback information is not showing on deal    *
      *           within 'MIDAS' (for Broker).  Indicator used is     *
      *           wrong, *IN64 is for broker and not *IN36 (MBIN).    *
      *  S01408 - Core hook MM0089C110 added                          *
      *           Core hook MM0089C109 added                          *
      *           Core hook MM0089C108 added                          *
      *           Core hook MM0089C107 added                          *
      *           Core hook MM0089C106 added                          *
      *           Core hook MM0089C105 added                          *
      *           Core hook MM0089C104 added                          *
      *           Core hook MM0089C103 added                          *
      *           Core hook MM0089C102 added                          *
      *           Core hook MM0089C101 added                          *
      *  S01408 - Core hook MM0089C100 added                          *
      *  S01408 - Core hook MM0089CP95 added                          *
      *           Core hook MM0089CP96 added                          *
      *           Core hook MM0089CP97 added                          *
      *           Core hook MM0089CP98 added                          *
      *           Core hook MM0089CP99 added                          *
      *  CPM004 - Bank Portfolios                                     *
      *  072531 - SAME AS 070080 BUT FOR MATURITY DATE BEING HOLIDAY.  *
      *  070080 - INTEREST AMOUNT WAS NOT BEING VALIDATED WHEN THE   *
      *           VALUE DATE WAS A HOLIDAY. THIS MEANT THAT IN SUCH  *
      *           CIRCUMSTANCES, THE INTEREST AMOUNT ENTERED WAS     *
      *           ACCEPTED WITHOUT ERROR...                          *
      *  S01408 - Core hook MM0089CP91 added                          *
      *           Core hook MM0089CP92 added                          *
      *           Core hook MM0089CP93 added                          *
      *           Core hook MM0089CP94 added                          *
      *  072529 - WHEN AUTHORISING A DEAL AND A WARNING MESSAGE IS   *
      *           GIVEN, SETTLEMENT INSTRUCTIONS ARE NOT SHOWN.      *
      *  S01408 - Core hook MM0089CP89 added                          *
      *           Core hook MM0089CP90 added                          *
      *  S01408 - Core hook MM0089CP84 added                          *
      *           Core hook MM0089CP85 added                          *
      *           Core hook MM0089CP86 added                          *
      *           Core hook MM0089CP87 added                          *
      *           Core hook MM0089CP88 added                          *
      *  S01408 - Core hook MM0089IIP1 added                          *
      *           Core hook MM0089CP81 added                          *
      *           Core hook MM0089CP82 added                          *
      *           Core hook MM0089CP83 added                          *
      *  088852 - Deal sub-type of a rollover deal can be different   *
      *           as the rolled over deal.                            *
      *  087755 - Settlement details are not updated when deal        *
      *           details are changed (Apllied 070586).               *
      *  093843 - IKRBAT not being updated if coming from Rollover    *
      *           maintenance screen.                                 *
      *  S01408 - Core hook MM0089CP77 added                          *
      *           Core hook MM0089CP78 added                          *
      *           Core hook MM0089CP79 added                          *
      *           Core hook MM0089CP80 added                          *
      *  090749 - FEEDBACK status from TRAM is incorrect - add        *
      *           missing FEEDBACK status codes.                      *
      *  097564 - Reinsert line inadvertently removed by R10.6 PTF04  *
      *  095244 - Recompiled for Calculation method 3                 *
      *  095238 - Recompiled for Calculation method 3                 *
      *  S01408 - Core hook MM0089CP73 added                          *
      *           Core hook MM0089CP74 added                          *
      *           Core hook MM0089CP75 added                          *
      *           Core hook MM0089CP76 added                          *
      *  S01408 - Core hook MM0089CP66 added                          *
      *           Core hook MM0089CP67 added                          *
      *           Core hook MM0089CP68 added                          *
      *           Core hook MM0089CP69 added                          *
      *           Core hook MM0089CP70 added                          *
      *           Core hook MM0089CP71 added                          *
      *           Core hook MM0089CP72 added                          *
      *  093723 - Do not ignore format of MMDEAULL to prevent fail in *
      *           range authorization.                                *
      *  090480 - ON CHECKING THE EXISTENANCE OF PRIME A/C FOR INT.   *
      *           SETTLEMENT METHOD 04, SHOULD USE DDCUST (INPUT      *
      *           SCREEN CUSTOMER NUMBER) RATHER THAN DDCNUM          *
      *           (SELECTION SCREEN CUSTOMER NUMBER)                  *
      *  089603 - Do not allow a/c sequence field to default to       *
      *           00 or blank/numeric.                                *
      *  091554 - DEALER NAME IS NOT SETUP CORRECTLY FOR ROLLOVER DEAL*
      *  087923 - F3 from authorisation screen authorises deal - pgm  *
      *           amended so that it ends if F3 taken from main       *
      *           screen or extended settlements screen, pgm ends.    *
      *  088263 - If there is already something in the customer field *
      *           and you put a ? in the 1st character we are taken   *
      *           into customer selection screen but on return the    *
      *           selected customer was not put into the field.       *
      *  S01408 - Core hook MM0089CP61 added                          *
      *           Core hook MM0089CP62 added                          *
      *           Core hook MM0089CP63 added                          *
      *           Core hook MM0089CP64 added                          *
      *           Core hook MM0089CP65 added                          *
      *  S01408 - Core hook MM0089CP60 added                          *
      *  S01408 - Core hook MM0089CP59 added                          *
      *  S01408 - Core hook MM0089CP52 added                          *
      *           Core hook MM0089CP53 added                          *
      *           Core hook MM0089CP54 added                          *
      *           Core hook MM0089CP55 added                          *
      *           Core hook MM0089CP57 added                          *
      *           Core hook MM0089CP58 added                          *
      *  S01408 - Core hook MM0089CSFI added x 2                      *
      *           Core hook MM0089CSF1 added                          *
      *  087551 - The system does not allow amendments on interest    *
      *           day in month field if the deal is authorised.       *
      *           MM0089 is amended to accept amendments on it even   *
      *           if deal is authorised (as per fix 063371)           *
      *  088306 - Do not process further if deal number is left blank *
      *  088380 - Wrong maturity date info passed to SD2400 for call  *
      *           deal (if mat. date not defineD, pass the one from   *
      *           the previous input)                                 *
      *         - Impossible to modify maturity settl. instruction.   *
      *           if mat. not yet defined and value date outside      *
      *           back value period                                   *
      *  087176 - Allow deal date to be amendable when the deal       *
      *           status is still 'COMPLETE'.                         *
      *  086484 - Not able to authorise deal if associated deal has   *
      *           status 'M'                                          *
      *         - Not able to authorise deal if associated deal is    *
      *           historic and no more in MMDELDPP                    *
      *  S01408 - Core hook MM0089CP47 added                          *
      *           Core hook MM0089CP48 added                          *
      *           Core hook MM0089CP49 added                          *
      *           Core hook MM0089CP50 added                          *
      *           Core hook MM0089CP51 added                          *
      *  082738 - Rewrite of projected account movements.             *
      *  S01408 - Core hook MM0089EEP1 added                          *
      *           Core hook MM0089CP13 added                          *
      *           Core hook MM0089CP14 added                          *
      *           Core hook MM0089CP15 added                          *
      *           Core hook MM0089CP16 added                          *
      *           Core hook MM0089CP17 added                          *
      *           Core hook MM0089CP18 added                          *
      *           Core hook MM0089CP19 added                          *
      *           Core hook MM0089CP20 added                          *
      *           Core hook MM0089CP21 added                          *
      *           Core hook MM0089CP22 added                          *
      *           Core hook MM0089CP23 added                          *
      *           Core hook MM0089CP24 added                          *
      *           Core hook MM0089CP25 added                          *
      *           Core hook MM0089CP26 added                          *
      *           Core hook MM0089CP27 added                          *
      *           Core hook MM0089CP28 added                          *
      *           Core hook MM0089CP29 added                          *
      *           Core hook MM0089CP30 added                          *
      *           Core hook MM0089CP31 added                          *
      *           Core hook MM0089CP32 added                          *
      *           Core hook MM0089CP33 added                          *
      *           Core hook MM0089CP34 added                          *
      *           Core hook MM0089CP35 added                          *
      *           Core hook MM0089CP36 added                          *
      *           Core hook MM0089CP37 added                          *
      *           Core hook MM0089CP38 added                          *
      *           Core hook MM0089CP39 added                          *
      *           Core hook MM0089CP40 added                          *
      *           Core hook MM0089CP41 added                          *
      *           Core hook MM0089CP42 added                          *
      *           Core hook MM0089CP43 added                          *
      *           Core hook MM0089CP44 added                          *
      *           Core hook MM0089CP45 added                          *
      *           Core hook MM0089CP46 added                          *
      *  082290 - Display settlements if warnings on authorisation.   *
      *           (Fix BHF945 borrowed from FX0820).                  *
      *  084659 - Amending a deal cuases sign to be changed in amount *
      *           field. As amount is non-amendable this field should *
      *           not be updated in amend mode.                       *
      *  S01444 - Recompiled. (LF/DEALSALL - amended to include       *
      *           historic deals files)                               *
      *  S01408 - Core hook MM0089CVS5 added                          *
      *           Core hook MM0089CP10 added                          *
      *           Core hook MM0089CP11 added                          *
      *           Core hook MM0089CP12 added                          *
      *           Core hook MM0089CISN added                          *
      *           Core hook MM0089CPG8 added                          *
      *           Core hook MM0089CPG9 added                          *
      *  079775 - When a deal has been rolled over do not allow       *
      *           amendment of automatic rollover indicator           *
      *  079768 - When a deal is amended, the rollover/brought/sold   *
      *           indicator and the rolled over by fields             *
      *           should not be blanked out.                          *
      *  079765 - Rollover Deal Customer Number may not be amended    *
      *  079157 - A PRINCIPAL INCREASE ROLLOVER IS ALLOWED WHEN       *
      *           ENHANCED ROLLOVERS SWITCHED ON                      *
      *  077939 - SHOULD NOT BE ABLE TO INPUT INTEREST SETTLEMENT     *
      *           A/C OR INT COUNTERPARTY NOSTRO IF DDIPDS IS 'N'     *
      *  077554 - IKLACT, Deal Last Action, needs to be set up        *
      *           correctly for a deal from rollver maintenance       *
      *  S01408 - Core hook MM0089CPG4 added                          *
      *           Core hook MM0089CPG7 added                          *
      *  079475 - Portfolio reference field still appears even if     *
      *           Portfolio Management module is off.                 *
      *  S01486 - Portfolio Lending Upgrade to Release 10.            *
      *  S01408 - Core hook MM0089CCP2 added                          *
      *           Core hook MM0089CCP3 added                          *
      *           Core hook MM0089CCP4 added                          *
      *           Core hook MM0089CCP5 added                          *
      *           Core hook MM0089CCP6 added                          *
      *           Core hook MM0089CCP7 added                          *
      *           Core hook MM0089CCP8 added                          *
      *           Core hook MM0089CCP9 added                          *
      *           Core hook MM0089CPG1 added                          *
      *           Core hook MM0089CPG2 added                          *
      *           Core hook MM0089CPG3 added                          *
      *           Core hook MM0089CPG5 added                          *
      *           Core hook MM0089CPG6 added                          *
      *  068204 - Base Rate Code is NOT AMENDABLE.  Reinstated some   *
      *           code deleted by E18886.                             *
      *  067079 - Database error if Brokerage input with invalid      *
      *           Broker.  Do not check Broker currency if Broker     *
      *           invalid.                                            *
      *  075360 - For deal type 'CI' if CD Holder is blanked out it   *
      *           will cause database error 21 in DL0110, so default  *
      *           to counterparty regardless of action code.          *
      *  075430 - Unable to amend settlement instuctions due to       *
      *           incorrect fix for E22936. Therefore, reinstated     *
      *           original coding as this was not incorrect.          *
      *  S01408 - Core hook MM0089CCP1 added                          *
      *           Core hook MM0089CVS2 added                          *
      *           Core hook MM0089CVS3 added                          *
      *           Core hook MM0089CVS4 added                          *
      *           Core hook MM0089OOPG added                          *
      *           Core hook MM0089EEPG added                          *
      *           Core hook MM0089CVS1 added                          *
      *           Core hook MM0089CEND added                          *
      *  073516 - Use decimal point and thousand separator as set up  *
      *           in ICD                                              *
      *  044740 - File was not updated even when customer shortname   *
      *           was changed.                                        *
      *  067426 - Deal accepted even if interest rate records do not  *
      *           exist for the currency.  No checking for logically  *
      *           deleted records.                                    *
      *  064243 - Fix for 050948 has gone missing; this is a re-doing *
      *           of it.  When deal subtype is not mandatory on       *
      *           complete deals, the deal types/subtypes table should*
      *           not be checked if the subtype is left blank.        *
      *  065460 - If a warning error exists on deal date or next      *
      *           interest date, the rollover deal amount was not     *
      *           output to DEALSDC, on a rollover deal.              *
      *  065492 - For ID/IL deal types show linked deal in linked     *
      *           deal number field instead of rollover field.        *
      *  066074 - If error in Repo/Pledge Ind/Number highlight        *
      *           those fields and positon cursor.                    *
      *  S01468 - Upgrade of Germany enhancements to Class 1:-        *
      *           Allow Total Interest = 0 for CD, CL and DL deals    *
      *           with Notice Days = 0 (GE0002)                       *
      *  062962 - Check for parent customer used an incorrect value   *
      *           of 'Y' instead of 'P' for field BBPAIN.             *
      *  063371 - The system does not allow amendments on interest    *
      *           payment frequency if the deal is authorised.        *
      *           MM0089 is amended to accept amendments on it even   *
      *           if deal is authorised.                              *
      *  059667 - Quicken the authorisation function (follow the      *
      *           procedures on FX deal authorisation).               *
      *  S01408 - Core hook MM0089CEXV added                          *
      *  063375 - Remove Fix DT0012 - Cannot change maturity date.    *
      *  060779 - The confirmation matching feedback records are      *
      *           not displaying the correct information. Set up      *
      *           key correctly before chaining to LF/CFFEEDL0.       *
      *  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
      *           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
      *  060936 - Transaction failed - cannot settle through 04       *
      *           on the receipt side due to nostro field not         *
      *           being setup                                         *
      *  060933 - On CF3 from user window program should terminate    *
      *           immediately, was dumping on attempt to send message *
      *           that is in Synon message file (not essential).      *
      *  055836 - Only output warning message if NIDT is holiday      *
      *  047780 - Instead of displaying error msg MMM0594 ('Taxable   *
      *           indicator is not N or blank.'), warning msg MM1050  *
      *           shld be displayed when MM Deal is exempt from BRT   *
      *           but the customer is tax liable. Also, include GEMS  *
      *           fix 044539.                                         *
      *  S01408 - Core hook MM0089CBDU added                          *
      *         - Core hook MM0089CCBU added                          *
      *  S01443 - MM Interest rate tolerance check, for BLI, Phas II  *
      *           Amended to validate the effective interest rate of  *
      *           an MM deal against a rate from the Interest rates   *
      *           file, LF/FDINTRLL                                   *
      *  061426 - Recompile after ZDATE9 correction                   *
      *  S01434 - ENHANCED ROLLOVER PROCESSING                        *
      *  057977 - During deal input of a deposit taken the base       *
      *           currency rate was not amended when the currency     *
      *           was changed.  The currency was changed after        *
      *           pressing F12 (instead of ENTER to insert the deal)  *
      *           after the Extended Settlement Screen validation.    *
      *  054069 - 100 billion dollar deals cause errors in COB        *
      *           because of architectural limit.  Change limit       *
      *           to 10 billion to stop this problem.                 *
      *  S01408 - Core hook MM0089CIKS added                          *
      *         - Core hook MM0089IPG  added                          *
      *         - Core hook MM0089IDS  added                          *
      *         - Core hook MM0089CVSF added                          *
      *  042960 - Chain to DEALSALL to better check for duplicate     *
      *           duplicate Deal Numbers.                             *
      *  055894 - Half-day deposit should allow input of interest     *
      *           rate(i.e. base rate/spread rate).                   *
      *  053519 - Front-up interest field is changed to take that     *
      *           on the deal subtype file as default.                *
      *  052511 - User not allowed to amend deal input today because  *
      *           INTEREST ACCRUAL DATE same as RUN DATE - this       *
      *           should be allowed if JSM switched on.               *
      *  S01408 - Core hook MM0089CICE added                          *
      *         - Core hook MM0089CICS added                          *
      *         - Core hook MM0089CVKS added                          *
      *         - Core hook MM0089CVSR added                          *
      *         - Core hook MM0089FPG added                           *
      *         - Core hook MM0089CPG added                           *
      *  052292 - Default 'Interest day in month' to day in 'Next     *
      *           interest date'.                                     *
      *  056095 - Interest not calculated consistently in MM.         *
      *           SR. MM1009 was externally defined as ZINTDY,        *
      *           while SR. ZA0710 and ZA0680 were replaced by        *
      *           the externally defined standard SR. ZDATE9 and      *
      *           ZDAT10, respectively.  Seventeen MM programs        *
      *           were amended.                                       *
      *  054889 - Range authorisation to work the same way as FX      *
      *           ie. only have to hit Enter once                     *
      *  E51300 - Warning message "Maturity date is before Notice     *
      *           Period" produced twice.                             *
      *  043277 - If there are no deal numbers available in range     *
      *           then do not dump in CA0050 but return to this       *
      *           program to send a message to the user.              *
      *  027568 - Validate if Book code is optional.  If it is        *
      *           and a blank book code is entered, get the           *
      *           default book code.                                  *
      *  047736 - ENABLES 02 AND 12 SETTLEMENT CODES TO BE PROCESSED  *
      *           CORRECTLY.                                          *
      *  E52924 - BROKERAGE field is being validated even if the      *
      *           BROKER CODE input is invalid. Database error in     *
      *           the validation of BROKERAGE field.                  *
      *  E52649 - When the REPO/PLEDGE indicator is in error, the     *
      *           Repo/Pledge Indicator field is being highlighted    *
      *           instead of the ORIGINATING BRANCH field.            *
      *  E50108 - Duplicate Warning Messages shown when inserting     *
      *           or amending a deal.                                 *
      *  E01005 - Incorrect validation of Negative Interest           *
      *           Indicator, not as per instruction manual            *
      *  E50684 - Customer number cannot be amended from a non bank   *
      *           to a bank for deal types TD and TI. Similar from    *
      *           a bank to a non bank for deal types IP and IT.      *
      *  E46993 - Unable to authorise CALL deposit - BASE             *
      *           CURRENCY RATE field incorrect.                      *
      *  E48032 - AUS007 CAUSED DATABASE ERROR IN SDNOSTPD:           *
      *           *IN77 NOT REPLACED BY *INL1 THROUGHOUT PROGRAM      *
      *  E47130 - System does not accept deal with interest           *
      *           frequency 'N' for input on last calendar day        *
      *           of month even though 'next interest date' is        *
      *           input as following month-end.  Keyed date is        *
      *           blanked out by system.  Can't leave it blank        *
      *           either.                                             *
      *  E46937 - Inappropriate message is displayed on screen        *
      *           when interest frequency N is entered for            *
      *           currency other than AUD.                            *
      *  E47225 - CONDITION CALL TO AORETLR0 ON RETAIL BEING          *
      *           PRESENT.                                            *
      *  E46904 - CL deal defaults "CD held BY" field and no          *
      *           error on input.                                     *
      *  049499 - INCREASE SIZE OF WORK FIELD TO ENABLE CORRECT       *
      *           CALCULATION OF INTEREST ON VERY LARGE AMOUNTS       *
      *  046323 - AUS007 Incomplete. No output to FORAT               *
      *           on initial deal input.                              *
      *  046259 - Incorrect message IDs being used by AUS007          *
      *  E40579 - Default interest calc method to dealing ccy         *
      *           default if left blank                               *
      *  S01392 - JAP.SUB-MODULE INCORPORATION (CORE)                 *
      *  S01391 - JAP.SUB-MODULE INCORPORATION (SWITCH)               *
      *  AUS007 - Australian Brokerage.                               *
      *  AUS003 - Australian Release - Interest To Calender Month     *
      *           End.                                                *
      *  AUS011 - Deal type/subtype validation                        *
      *  E40281 - Condition check for interest rates/revaluation      *
      *           on CCY validation on either Treasury Management     *
      *           or FRA/IRS in system. This is because Project       *
      *           Harry made Rates Maintenance conditional on one     *
      *           of these modules being present.                     *
      *  S01383 - BASIC RATE TAX INCORPORATION                        *
      *  E34306 - ERROR MSG MMM0584 DUPLICATED. MMM0585 CREATED       *
      *  S01354 - Internal Funding - disallow deletion of 'IL' &      *
      *           'ID' Deal types                                     *
      *  E30473 - ROBR & POBR BLANKED ON AMEND                        *
      *  E29975 - IF USER AMENDS INTEREST FREQUENCY OF DEAL OF        *
      *           TYPE CD, CL OR DL, ZA0240 IS CALLED WITH MSG        *
      *           ID BLANK. FIX IS TO MOVE END OF 'IF' LOOP TO        *
      *           CORRECT POSITION - CORRECTION TO E24202.            *
      *  BH1114 - THE DEAL TRANSACTION DATE SHOULD NOT BE UPDATED     *
      *           FOR AMEND.                                          *
      *  BH1059 - DO NOT ALLOW DUPLICATE DEAL NUMBERS                 *
      *  BH1117 - SHOW MATURED LOANS/DEPOSITS                         *
      *  E25562 - NO AMENDMENT COULD BE MADE TO A DEAL WITH A         *
      *           RELATED ROLLOVER DEAL BECAUSE PROGRAM WAS           *
      *           CHECKING STATUS OF ROLLED-OVER DEAL AND FINDING     *
      *           IT HAD MATURED. THIS CHECK SHOULD ONLY OCCUR        *
      *           ON INSERTIONS.                                      *
      *  E24039 - DOES NOT ALLOW AMENDMENT OF MATURITY SIDE OF        *
      *           EXTENDED SETTLEMENTS IF DEAL VALUED BEFORE THE      *
      *           BACK VALUED PERIOD                                  *
      *  E24405 - NEXT INTEREST DATE cannot be amended on day of      *
      *           input even the field is blank                       *
      *  E25515 - REMOVAL OF SYNDICATED LOANS                         *
      *  S01319 - Remove redundant processing                         *
      *  E24202 - Branch fix incorporated to make E22903 complete.    *
      *  E26566 - For authorisation of a call deal needs no vali-     *
      *           dation for 'amount' with a balance of zero.         *
      *  E24533 - THE MATURITY DATE OF A DEPOSIT DEAL SHOULD          *
      *           NOT BE CHECKED AGAINST THE RECEIVE                  *
      *           SETTLEMENT INSTRUCTIONS.                            *
      *  E24019 - For amendment of call deal , needs no vali-         *
      *           dation for 'amount' with a balance of zero.         *
      *  E24193 - Value & Maturity Date holidays should only be       *
      *           warning errors.                                     *
      *  E21775 - For call deals (notice days = 0), the notice day    *
      *           field is not changed to -999 on amending the        *
      *           deal to insert the maturity date                    *
      *  E24366 - User should not be able to change the maturity      *
      *           date of a deal which has been rolled over           *
      *  E25678 - Validation of beneficiary should not have  DB       *
      *           error processing on AOCUSTR0                        *
      *  E25683 - Counterparty nostros being written to file          *
      *           in DRS (ie. 2 part shortname) format. AOCNSTR0      *
      *           cannot find.                                        *
      *  RT0150 - RECOMPILE PROGRAM FOR CHANGE IN MMSTDSPP            *
      *  E24242 - NEXT INTEREST DATE WAS ERRONEOUSLY BLANKED OUT      *
      *           FOR INSERT WHEN IT FELL ON A HOLIDAY. (This is      *
      *           Astec fix no. E41123.)                              *
      *  DT0170 - On select screen should say DELETED not FORWARD     *
      *           if a deal is deleted                                *
      *  DT0073 - HK tax being deducted in error                      *
      *  E16048 - When Value date entered is previous to value        *
      *           date of new rate change, the system should          *
      *           notify the user of the new rate change. (DT0047)    *
      *  E16047 - Screen values should be checked to see if           *
      *           interest validation should be done.                 *
      *  BHF894 - DON'T VALIDATE SETTL.DETAILS IF ERROR EXISTS        *
      *  BHF861 - VDAT AND ORED NOT SETUP IF AMEND A DEAL             *
      *  DT0013 - Remove February processing for interest calc.       *
      *           method 3 as it is assumed to have 30 days.          *
      *  DT0012 - Allow 'NIL' to be entered for Brokerage             *
      *  DT0024 - GIVE WARNING MSG IF MATURITY DATE ENTERED IS        *
      *           LESS THAN THE SYS DATE PLUS NOTICE DAYS             *
      *  DT0015 - RECOMPILED                                          *
      *  DT0009 - Payment settlement instructions protected on an     *
      *           insert of an IP deal.                               *
      *  DT0010 - Call to MM0031 removed.  MM0031 is now              *
      *           called in MIPGM.                                    *
      *  E21612 - Allow amendment of maturity date of  an             *
      *           authorised deal .                                   *
      *  E23511 - Update transaction date if deal is inserted         *
      *           but not for amendments.                             *
      *  E23406 - Check for modules RE(RETAIL 2) or IA(INTEREST       *
      *           ON ACCOUNTS).                                       *
      *  S01304 - CHANGES MADE DURING CONFIRMATION MATCHING           *
      *           INCORPORATION.                                      *
      *  S01184 - CONFIRMATION MATCHING                               *
      *           Display counterparty/broker match status            *
      *  E22903 - Interest details can be amended if an authorised    *
      *           deal  of type CD,CL, or DL is to be matured.        *
      *  E23044 - @TOTI was being updated by @TOTIN for amends.       *
      *           This would cause interest validation to fail        *
      *           if the screen was validated twice (eg error on      *
      *           first input).                                       *
      *  E22219 - Change #RTRN message handling to process all        *
      *           message ids.                                        *
      *  E23026 - Total interest must equal amount calculated         *
      *           by system, no error margin allowed.                 *
      *  E23032 - Number of integers calculated in ZA0840 is one      *
      *           too many if leading zeros are entered.              *
      *  E22936 - The back-value period should be calculated by       *
      *           subtracting the back-value from the value date      *
      *           and not from the maturity date.                     *
      *  E20636 - Linked reference number should be numeric.On        *
      *           insert allows say 12AA34 and changes the non-       *
      *            numerics to numerics.                              *
      *  E22744 - Enquire on deleted deal,then insert another         *
      *           deal the deleted flag stays on.(Caption 'DELETED'   *
      *           remains at bottom of screen.)                       *
      *           (SEE BHF632)                                        *
      *  E22668 - When the customer has leading zeros one can         *
      *           enter either just the customer number without       *
      *           the leading zeros or as many zeros as one can       *
      *           enter & then the customer number.The customer       *
      *           number should be 6 numeric.                         *
      *           (SUPERSEDED - VALIDATION DONE BY ACCESS OBJECT)     *
      *  E22412 - Allow for amendment of Rollover with Rolled-        *
      *           Over deal matured and still on MMDELDPP.            *
      *  E21835 - As SDMMODPD is used in other pgms if the file is    *
      *           already open before this pgm is called, the file    *
      *           pointer will be at end of file.Subsequently         *
      *           SETLL is used to pick up the first(& only) recrd    *
      *  E18886 - ALLOW BASE CURRENCY RATE TO BE AMENDED              *
      *  E19066 - MOVE BLANKS TO SCREEN OUTPUT @LNKN                  *
      *  E22161 - Introduction of M = Million,T = Thousand            *
      *           processing. (Incorporated under E17279)             *
      *           On options available 'X' is displayed even if       *
      *           back office authorisation is not required.This      *
      *           was because the field H1BOAR was tested before      *
      *           its file MMSSTSLL was opened and read.              *
      *  S01253 - CHANGED FOR MULTILANGUAGE SCREENS                   *
      *  E20774 - Replace QCAEXEC with QCMDEXC                        *
      *  S01252 - ADDITIONAL SPARE WINDOW MANAGER PARAMETER           *
      *  S01251 - SYNON FIELD/PROGRAM NAME CHANGES                    *
      *  E21145 - ON USING F15 PROCESSING A LOOP OCCURS WHEN          *
      *           AN ERROR MSG IS IGNORED ON ATTEMPTING               *
      *           AUTHORISATION WHEN ENDORSING SETTLEMENT             *
      *           DETAILS AMENDMENT. ENTER IS PRESSED WHEN            *
      *           ACTION CODE IS BLANK.                               *
      *  E20611 - When amending a rollover deal (or authorising)      *
      *           the deal which this deal rolls over may no          *
      *           longer be on file. Change validation to allow       *
      *           this with a warning error.                          *
      *  E20989 - Whole string of problems caused by E18139,          *
      *           the performance enhancement modifications.          *
      *           1) When in range authorisation blank screen is      *
      *              shown before and after authorisation but screen  *
      *              is not input capable.                            *
      *           2) In range authorisation need to Press F12 three   *
      *              (3) times to get amend screen up.                *
      *           3) In range authorisation if press F12 and then     *
      *              enter, program goes into long processing loop    *
      *              returning control to user c. 5 - 10 mins later   *
      *              on a quick machine.                              *
      *           4) After F15 and selecting multiple deals, program  *
      *              processes only first one before presenting user  *
      *              with a blank screen for input thereby ignoring   *
      *              any other selections.                            *
      *           5) Time is not correct when screen written for      *
      *              user input                                       *
      *           6) During range authorisation details for deal      *
      *              never displayed for accceptance or rejection     *
      *           (partly corrected by LN0266)                        *
      *  E20609 - When rolling over a deal the original deal          *
      *           can have '000000' in the rolled over by deal        *
      *           number field. Pgm is checking for blanks and        *
      *           therefore assumes that deal has already been        *
      *           rolled over when it hasn't.                         *
      *  S01314 - Incorporation changes                               *
      *  S01241 - Window incorporation                                *
      *  LN1143 - BHF367 ONLY APPLIES TO AMEND ACTION CODE            *
      *  LN1104 - RECOMPILE DUE TO CHANGE IN SDCUSTPD                 *
      *  BHF367 - NOT ALLOW START DATE INSTRUCTIONS TO BE AMENDED     *
      *  LN0558 - ON AN AMEND, PROFIT CENTRE SHOULD NOT DEFAULT IF    *
      *           LEFT BLANK AS IT MAY CHANGE TO THE DEFAULT OF       *
      *           SECOND USER UNKNOWINGLY                             *
      *  BHF364 - AMENDED SHOULD NOT CHECK ROLLOVER DEALS NUMBER      *
      *           BECAUSE IS NOT AMENDABLE (ENY032)                   *
      *  BHF632 - DELETE INDICATOR NOT RESET BEFORE ACTION CODE       *
      *           AND DEAL NUMBER VALIDATION (ALSO E22744/160074)     *
      *  BHF488 - DIPLAY DEAL NO. ON SETTLEMENTS SCREEN IF IT         *
      *           IS KNOWN                                            *
      *  E22405 - Add new field to Extended Settlements.(Cover        *
      *           MT202 required).                                    *
      *  BHF365 - DATABASE ERROR ACCESSING BROKERAGE CURRENCY         *
      *  BHF079 - WHEN AN ERROR WITH AOCUSTR0, KEY STATUS             *
      *           IS '*ERROR' NOT 'ERROR'                             *
      *  BHF280 - REDISPLAY SCREEN IF ACTION CODE INVALID             *
      *  E17279 - Introduction of M = Million,T = Thousand            *
      *           processing.                                         *
      *  LN0390 - PROFIT CENTRE DEFAULT MATRIX PARAMETERS SET UP      *
      *           INCORRECTLY AND ACCOUNT OFFICER NEEDS TO BE SET     *
      *           TO BLANK IF CUSTOMER FIELD IS IN ERROR              *
      *  S01282 - REMOVE SUB-TYPE CHECK FOR ROLLOVERS                 *
      *  LN0234 - VALUE DATE, MATURITY DATE, NEXT INTEREST DATE       *
      *           HOLIDAY VALIDATION NOT BEING CARRIED WHEN 00        *
      *           SETTLEMENT                                          *
      *  LN0266 - IF PROGRAM CALLED FROM RANGE AUTHORIZATION,         *
      *           DETAILS AND ERROR MESSAGES ARE NOT DISPLAYED IF     *
      *              VALIDATION FAILS.                                *
      *  LN0023 - IF SETTLEMENT METHOD IS NOT A NOSTRO, SYSTEM        *
      *           LOCATION SHOULD BE MOVED INTO ZLOC NOT *BLANKS      *
      *  E20202 - FIX NOT INCORPORATED                                *
      *  E270   - Profit centre default program (AOPRFMR0) has        *
      *           new parameters.                                     *
      *  S01199 - HELP                                                *
      *  E20282 - Wrong interest amount is being output to screen     *
      *  E15515 - To remove any embeded BLANKS in the construction    *
      *           of Standard Deals Member for User ID with only      *
      *           one or two characters.                              *
      *  E20376 - Insert of deals with auto-generated numbers         *
      *           does not output message if after authorisation      *
      *  E20041 - Insert of deals with manually entered deal          *
      *           numbers in error. New dsp. format added.            *
      *  S01227/E214 - SDKTPVR & SDKUUPR renamed SD2400 & SD2410      *
      *  E81    - Only check dates for holiday inlocal ccy when       *
      *           NOT settled through a nostro                        *
      *  E83    - Set up Default Branch for Set Meth 05 for Mbin=N    *
      *  E70    - USE OF '?' WITH ACCESS PROGRAMS                     *
      *  E00032 - Deal date validation must be done using system      *
      *           location for single branch and booking branch       *
      *           location for multibranching                         *
      *  E19346 - Insert mode deal number allocation performed        *
      *           immediately before file updates to prevent          *
      *           deal number gaps caused by unsuccessful inserts.    *
      *  E18187 - Currency validation should check rates have been    *
      *           entered and a revaluation has been run              *
      *  E18569 - Search other 'Front Office' files (MM etc) for      *
      *           Deal number to prevent Dupe keys. Also ensure       *
      *           that the Number of a matured deal is not used.      *
      *  E19396 - Validate Pay/Receive against vdate and deal         *
      *            type for amend only. (SUPERSEDED BY S01177)        *
      *  S01218 - Capital markets dealing interface incorporation     *
      *  S01176 - Two new fields added (DRID and DDMR) onto the       *
      *           Deals files.Securities Trading 3.1                  *
      *  E18596 - Prevent amendment of Pay/Receive settlement         *
      *           instructions after value date dependent upon        *
      *           deal type. (SUPERSEDED BY S01177)                   *
      *  E18599 - To stop the spread rate being moved into the        *
      *           interest amount screen field on amendments.         *
      *  E16042 - Unable to delete rollovers.                         *
      *  E17710 - Calculate correctly the total interest at           *
      *           maturity of a deal being rolled over and the        *
      *           correct input amount for a rollover TD deal.        *
      *  E18380 - Program was recompiled with new formats for the     *
      *           standard deal files. This stops the book code       *
      *           and linked reference number fields from being       *
      *           overwritten.                                        *
      *  E18139 - Speed up response time on deal update by            *
      *           writing deal input screen while update taking       *
      *           place. Involves splitting SR #ZE into #ZE & #ZEA    *
      *  E18138 - Program recompiled due to error on first            *
      *           recompilation.                                      *
      *  E17654 - REMOVE VALIDATION AGAINST LOCATIONS                 *
      *           (DUPLICATED IN S01177/S01117)                       *
      *  E17020 - Error in E17603: Deals get total interest set       *
      *           to zero on amend.                                   *
      *  E17603 - Do not validate the total interest during           *
      *           amendment & authorisation of a deal. Just           *
      *           check that the total interest has not changed.      *
      *  E17051 - Use MM1030 for interest calculations since it       *
      *           is more accurate than MM1007.                       *
      *  E17050 - Don't default For Accnt Of and special              *
      *           instructions fields if values have already been     *
      *           entered there. (SUPERSEDED BY S01177)               *
      *  E17021 - Remove COMIT from between MM0078 and MM0082         *
      *           so that DRS & MIDAS update is in the same comit     *
      *           cycle. E14354 not applied completely.               *
      *  E16709 - When amending or authorising a deal, the taxable    *
      *           indicator must be displayed as 'N' for a non        *
      *           taxable deal, otherwise the deal could default      *
      *           to taxable on pressing enter.                       *
      *  E16027 - Fixes for accepting Counterparty Nostro             *
      *           Shortname in FACO field and make sure DRS           *
      *           Shortname will go into the DRS for A/C of           *
      *           field.                                              *
      *  S01194 - New Standing Data files - NB. only done for         *
      *           Branch details to get 3A Location Code              *
      *  S01195 - New holidays processing                             *
      *  S01117 - Multibranching changes                              *
      *  S01177 - Extended Settlements                                *
      *  E16252 - MM0089 should allow zero interest rate/spread.      *
      *           Validation for zero rates removed.                  *
      *  E16041 - Fix Database Error 009 caused by Customer           *
      *           Shortname/Number in Counterparty Pay/Receive        *
      *           Instructions. Also, when an error occurred,         *
      *           program dumped twice and then continued.            *
      *  E15947 - Program recompiled due to change in MMCDAFLL        *
      *           format based on MMCDAFPP which had wrong field      *
      *           length for HBRCA (Branch code amendable             *
      *           indicator).                                         *
      *  E13747 - The program now uses MIDAS default standard         *
      *           settlement instructions.                            *
      *  E14354 - Remove COMIT from between MM0078 and MM0082         *
      *           so that DRS & Midas update is in same comit         *
      *           cycle.                                              *
      *  E14353 - Allow brokerage amount to have the number of        *
      *           decimal places associated with the broker           *
      *           currency.                                           *
      *  E14377 - If no Brokerage has been entered, then              *
      *           Brokerage Amount on Deals file should be            *
      *           all 9's. Also remove all 'PROM' validation.         *
      *  E14356 - Fix E12945 not required, as DRS base rate code      *
      *           is 5 long.                                          *
      *  E14363 - C'Party Bank's local currency should be the         *
      *           same as the Deal Currency.                          *
      *  E14035 - Setup MIDAS CD Held By field on the Standard        *
      *           Deal file with the same customer number as          *
      *           the deal customer when inserting a CD Issued.       *
      *           (Required because CD Held By is mandatory for       *
      *           MIDAS processing of CDs Issued).                    *
      *  S01165 - Two new fields (Book code and linked reference      *
      *           number) have been added to MMDENBPP MMDENSPP        *
      *           MMDELDPP MMSTDBPP MMSTDSPP &MMSTDLPP. The new       *
      *           file included is BOOKD which contains valid         *
      *           book codes.                                         *
      *  E13873 - Correct error message now issued for invalid        *
      *           C'Party Paying/Receiving Bank Details.              *
      *  E12945 - DRS BASE RATE USED INSTEAD OF MIDAS BASE RATE       *
      *  E12415 - ON AUTHORISATION OF A ROLLOVER DEAL,CHAINS TO       *
      *           MMDEALLL FOR DETAILS OF RELATED DEAL,BUT DOES       *
      *           NOT CHAIN BACK FOR DETAILS OF DEAL BEING ENTERED    *
      *  E12662 - ON INSERT OF ROLLOVER,SPREAD RATE FIELD DISPLAYS    *
      *           TOTAL INTEREST AMOUNT - SHOULD BE BLANK             *
      *  E12686 - ON INPUT OF A ROLLOVER- RELATED DEAL AMOUNT         *
      *           FIELD ISN'T SET-UP CORRECTLY                        *
      *  E12306 - AFTER READE TO MMDEAMLL SHOULD USE HNDATE DEAM      *
      *           VALUE DATE                                          *
      *  E12663 - WHEN VALIDATING ROLLOVER SHOULD COMPARE DEAL        *
      *           TYPE WITH MIDAS DEAL TYPE AND NOT DRS DEAL TYPE     *
      *  E12365 - Warning message displayed if value date is a        *
      *           holiday in local currency.                          *
      *  E12574 - RECOMPILE PROGRAM DUE TO CHANGE IN MMOD             *
      *  S01136 - DRS INCORPORATION :-                                *
      *           Federal funds indicator processing added.           *
      *                                                               *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * ID F  C  H  L    FUNCTION OF INDICATORS                       *
      *                                                               *
      *       KC         Exit program.                                *
      *       KL         Return to blank screen or, if screen blank,  *
      *                  exit program.                                *
      *       KH         Advance to next record.                      *
      *       KG         Go to previous record.                       *
      *       KP         Select processing required.                  *
      *       KJ         Confirm delete.                              *
      *                                                               *
      *       01         Error on field DDACTN.                       *
      *       02         Error on field DDDLNO.                       *
      *       03         Error on field DDTYPE.                       *
      *       04         Error on field DDSTYP.                       *
      *       05         Error on field DDDLDT.                       *
      *****   06         Error on field DDBRCD.                       *   S01117
      *       06         Error on field DDBRCA.                       *   S01117
      *       07         Error on field DDBKCD.                       *
      *       08         Error on field DDBRKG.                       *
      *       09         Error on field DDDADN.                       *
      *       10         Error on field DDCUST.                       *
      *       11         Error on field DDVDAT.                       *
      *       12         Error on field DDMDAT.                       *
      *       13         Error on field DDNTCE.                       *
      ********14*********Error*on*field*DDFCLY.***************************E25515
      *       15         Error on field DDACSQ.                       *
      *       16         Error on field DDCCY.                        *
      *       17         Error on field DDAMNP.                       *
      *       18         Error on field DDBRAT.                       *
      *       19         Error on field DDBSRC.                       *
      *       20         Error on field DDSPRT.                       *
      *       21         Error on field DDICMT.                       *
      *       22         Error on field DDNGVI.                       *
      *       23         Error on field DDIPFQ.                       *
      *       24         Error on field DDNDAT.                       *
      *       25         Error on field DDTOTI.                       *
      *       26         Error on field DDIPDM.                       *
      *       27         Error on field DDCPTI.                       *
      *       28         Error on field DDMTAX.                       *
      *       29         Error on field DDCDRF.                       *
      *       30         Error on field DDCDCH.                       *
      ******  31         Error on field DDORCM.                       *   S01177
      ******  32         Error on field DDMOPM.                       *   S01177
      ******  33         Error on field DDMORI.                       *   S01177
      ******  34         Error on field DDMOPI.                       *   S01177
      ******  35         Error on field DDMCPI.                       *   S01177
      ******  36         Error on field DDMCRI.                       *   S01177
      ******  37         Error on field DDMFAO.                       *   S01177
      *       31         Error on field DDPRFC                        *   S01117
      *       32         F12 pressed from settlements screen when     *   S01177
      *                  screen reached by pressing F14 (WITHIN       *   S01177
      *                  SELECT PROCESSING)                           *   S01177
      *       33         F12 pressed from settlements screen when     *   S01177
      *                  screen reached by pressing ENTER on 'A' of   *   S01177
      *                  deal (SELECT PROCESSING)                     *   S01177
      *       34         Action code changed                          *   S01177
      *       35         F12 pressed in response to confirm prompt    *   S01177
      *                  (in select processing only) - causes the     *   S01177
      *                  action code to be set back to 'E'            *   S01177
      *       36         DDBRCA displayed and input capable.          *   S01117
      *       37         Profit centre used flag is on.               *   S01117
      *                  DDPRFC displayed and input capable.          *   S01117
      *       37         Chain fail CFFEEDL0                          *   S01184
      *       38         Display deal status DDSTS.                   *
      *       39         Display DELETED Message.                     *
      *       40         Error on field DDFEDF.                       *   S01136
      *       41         Error has occurred in screen validation.     *
      *       42         F10  is enabled.                             *
      *       43         Position cursor under key.                   *
      *       44         Position cursor under first non-key field.   *
      *       45         Select processing in progress.               *
      *       46         Controls SFLCLR on select screen.            *
      *       47         Allows write to msg control fmt without the  *
      *                  screen being displayed.                      *
      *       46         Error on field DDPTFR.                       *   S01486
      *       47         Portf. module not present: DDPTFR not displayed  S01486
      *       48         Error on field DDBOKC.                       *   S01165
      *       49         Error on field DDLNKN.                       *   S01165
      *       50         Conditions screen for confirmation processing*
      *       51         ROLLUP key pressed.                          *
      *       52         Range authorisation in progress.             *
      *       53         Enable CMD/14                                *   S01177
      *       54         Error on field DDORBR                        *   S01117
      *       55         Warnig error indicator.                      *   E12365
      *       56         SE 2 installed (position 21 of MMOD)         *   S01176
      *       57         Input screen displayed already               *   E18139
      *       58         No more selected records on subfile.         *
      *       59         Controls SFLEND on Display File.             *
      *       60         Failure on read of display and database file.*
      *       61         O/P successful insert message.               *   E19346
      *       62         Deal number is numeric.                      *
      *       63         Deal number is numeric with leading blanks.  *
      *       64         On => no broker involved                     *   S01184
      *       65         Failure on read or chain to file.            *
      ********66*********Indicates error in settlement instructions.  *   S01392
      ********67*********Pay instructions have been validated.        *   S01392
      ********68*********S.I. defaults performed                      *   S01392
      *       66         Error on field DDFUID                        *   S01392
      *       67         Error on field DDFLID                        *   S01392
      *       68         Error on field DDRDFC                        *   S01392
      *       69         Error on access to customer/currency defaults*
      *       70         End of file of deals file                    *
      *       71         Beginning of deals file                      *
      *       72         Record locked on deals file                  *
      *       73         Rightmost byte of tested field is numeric.   *
      *       74         Error on field DDDRID.                       *   S01176
      *       75         Error on field DDDDMR.                       *   S01176
      *       76         DDORBR displayed and input capable.          *   S01117
      *       76         LOKUP Counterparty/Broker STATUS TABLE       *   S01184
      ********77*********Allow*direct*call*to*SD2410****************S01177AUS007
      *       77         Error on field DDRACD                        *   AUS007
      ********78*********External*transaction*taken*place*****************S01434
      *       79         Update record locked                         *
      *       78         Enhanced Rollovers processing switched on    *   S01434
      *       80         Error on field DDAURO                        *   S01434
      *       81         Error on field DDIPDS                        *   S01434
      *       82         Error on field DDROFQ                        *   S01434
      *       83         Error on field DDRLDN                        *   S01434
      *       84         Error on field DDCNNA                        *   S01434
      *       85         Error on field DDIMET                        *   S01434
      *       86         Error on field DDINSA                        *   S01434
      *       87         Error on field DDINOS                        *   S01434
      *       88         Analytical Accounting is installed           *   CAC001
      *                  and deal type is not 'IL', 'ID'              *   CAC001
      *       89         Action code is 'D' or 'E'                    *   CAC001
      *       92         CONFIRMATION MATCHING present                *   S01184
      *       93         #ZD called from within F15 processing        *   S01184
      *       94         "INSERT" so do not diSplay FEEDBACK          *   S01184
      ********80-99******Standard subroutine indicators.              *   S01314
      *                                                               *
      *                                                                   S01408
     F/COPY WNCPYSRC,MM0089FFP1                                           S01408
      *                                                                   S01408
      *          L1    Allow direct call to SD2410                    *   AUS007
      *          U7    Set on with U8 if a database error occurs.     *
      *          U8    File out of balance if on on its own.          *
      *                                                               *
      *                Unused indicators                              *   S01165
      *                -----------------                              *   S01165
      *       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..                  *   S01165
      *       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..                  *   S01165
      *       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..                  *   S01165
      *       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..                  *   S01165
      *       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..                  *   S01165
      ********..**..**53**54**..**56**57**..**..**..************** S01165 S01176
      *       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..                  *   S01176
      *       61  ..  ..  64  ..  ..  ..  ..  ..  ..                  *   S01165
      ********..**.. **.**74**75**..  ..**..**..**..**************  S01165S01176
      *       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..                S01165S01176
      *       ..  ..  ..  ..  ..  ..  ..  ..  ..                      *   S01165
      *       ..  ..  ..  ..  ..  ..  ..  ..  ..                      *   S01165
      *                                                               *
      *****************************************************************
     F**FDICDRLLIF**E***      K        DISK         KINFSR *PSSR      UC  S01194
     F**FXTB40LLIF**E***      K        DISK         KINFSR *PSSR      UC  S01194
     F*FDINSTLLIF**E*******************DISK*********KINFSR**PSSR******UC**S01319
     FMMMCOMLLIF  E                    DISK         KINFSR *PSSR      UC
     F*MMSSTSLLIF**E*******************DISK*********KINFSR**PSSR******UC**S01319
     FMMCDAFLLIF  E                    DISK         KINFSR *PSSR      UC
     FFDDLNMLLIF  E                    DISK         KINFSR *PSSR      UC
     F*MMUAUTLLIF**E*******************DISK*********KINFSR**PSSR******UC**S01319
     F*MMUSERLLIF**E**********K********DISK*********KINFSR**PSSR******UC**S01319
     FFDDTSTL1IF  E           K        DISK         KINFSR *PSSR      UC  AUS011
     FCADLFALLUF  E                    DISK         KINFSR *PSSR      UC
     F/COPY WNCPYSRC,MM0089F002
     F*                                             KCOMIT         E19346 043277
     F*FDTABJLLIF  E           K        DISK         KINFSR *PSSR      UC S01195
     F***FACIL***IF  E           K        DISK         KINFSR *PSSR   UC  E25515
     F**FDBSRTLLIF**E***      K        DISK         KINFSR *PSSR      UC  S01194
     F*FDRETALLIF  E           K        DISK         KINFSR *PSSR      UC S01177
     F*           ACCNTABF                          KRENAMEFDRETAL0       S01177
     F*ACCNT   IF  E           K        DISK         KINFSR *PSSR      UC S01177
     F*           ACCNTAAF                          KIGNORE               S01177
     F*           ACCNTACF                          KIGNORE               S01177
     F**CLINT*IF  E           K        DISK         KINFSR *PSSR      UC  S01194
     F*****       CLINTCAF                          KIGNORE               S01194
     F*****       CLINTCCF                          KIGNORE               S01194
     F**SNAME***IF**E         K        DISK         KINFSR *PSSR      UC  S01194
     F*****       CLINTCBF                          KRENAMESNAMEF         S01194
     F**FDDLSTLLIF**E***      K        DISK         KINFSR *PSSR      UC  S01194
     F**FDBRNCLLIF**E**       K        DISK         KINFSR *PSSR      UC  S01194
     F**FDBRKRLLIF**E***      K        DISK         KINFSR *PSSR      UC  S01194
     F**FDCCYTLLIF**E***      K        DISK         KINFSR *PSSR      UC  S01194
     F********** FDCCCYLLIF  EK        DISK         KINFSR *PSSR      UC  E13747
     F********** FDNOSTLLIF  EK        DISK         KINFSR *PSSR      UC  E13747
     F**FDTBLILLIF**E***      K        DISK         KINFSR *PSSR      UC  S01194
     F*           TABLETLF                          KRENAMETBLITLF        S01177
     F**FDCPTILLIF**E***      K        DISK         KINFSR *PSSR      UC  S01194
     F*SDPRFCL1IF**E******     K        DISK         KINFSR *PSSR         E70
     F*FDLCY1LLIF  E           K        DISK         KINFSR *PSSR  E14363 S01177
     F********** FDSNAMLLIF  EK        DISK         KINFSR *PSSR      UC  E13747
     F**********  TABLET2F                          KRENAMEFDSNAML0       E13747
     FMMDEAULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KINFDS INFDU
     F            MMDELDP0                          KRENAMEMMDLDUP0
     F************MMDENSP0                          KIGNORE               093723
     F************MMDENBP0                          KIGNORE               093723
     F            MMDENSP0                          KRENAMEMMDENSP1       093723
     F            MMDENBP0                          KRENAMEMMDENBP1       093723
     F                                              KCOMIT
     F*FXDEALLLIF  E  ******  K ****** DISK ******* KINFSR *PSSR      UC  E18569
     F***CADENQLLIF**E           K        DISK  KINFSR *PSSR   UC  E18569 042960
     F************MMDELDP0                          KRENAMEMMDELDP9E18569 042960
     F************MMDENBP0                          KRENAMEMMDENBP9E18569 042960
     F************MMDENSP0                          KRENAMEMMDENSP9E18569 042960
     F***DEALS***IF**E           K        DISK         KINFSR *PSSR   UC  042960
     F************DEALSDAF                          KIGNORE               042960
     F*********** DEALSDDF ***********************  KIGNORE               E18569
     F*********** DEALSDEF ***********************  KIGNORE               E18569
     F************DEALSDFF                          KIGNORE               042960
     F***DEALSH**IF**E           K        DISK  KINFSR *PSSR   UC  BH1059 042960
     F************DEALSDBF                          KRENAME#DAB    BH1059 042960
     F************DEALSDCF                          KRENAME#DAC    BH1059 042960
     F************DEALSDDF                          KRENAME#DAD    BH1059 042960
     F************DEALSDEF                          KRENAME#DAE    BH1059 042960
     F************DEALSDGF                          KRENAME#DAG    BH1059 042960
     FDEALSALLIF  E           K        DISK         KINFSR *PSSR      UC  042960
     F            FXDEALP0                          KRENAMEFXDLALL        042960
     F            MMDELDP0                          KRENAMEMMDELALL       042960
     F            MMDENSP0                          KRENAMEMMDESALL       042960
     F            MMDENBP0                          KRENAMEMMDEBALL       042960
     F*                                                                   042960
     F** All Deals. DRS and Midas                                         042960
     F*                                                                   042960
     FMMDEAMLLIF  E           K        DISK         KINFSR *PSSR      UC
     FMMLVDMLLIF  E           K        DISK         KINFSR *PSSR      UC
     F            MMDEAMP0                          KRENAMEMMLVDMP0
     FMMCMPLLLIF  E           K        DISK         KINFSR *PSSR      UC
     F            MMDENSP0                          KIGNORE
     F            MMDENBP0                          KIGNORE
     F            MMDEAMP0                          KIGNORE
     F            MMDELDP0                          KRENAMEMMCMPLP0
     FMMCARDLLIF  E           K        DISK         KINFSR *PSSR      UC
     F            MMDENSP0                          KIGNORE
     F            MMDENBP0                          KIGNORE
     F            MMDELDP0                          KRENAMEMMCARDP0
     FMMDEALLLIF  E           K        DISK         KINFSR *PSSR      UC
     F                                              KINFDS INFDS
     F/COPY WNCPYSRC,MM0089F003
     FMM0089DDCF  E                    WORKSTN      KINFSR *PSSR
     F                                        @RRN  KSFILE MM0089S3
     F/COPY WNCPYSRC,MM0089F001
     F**BOOKD***IF  E         K        DISK         KINFSR *PSSR    S01165S01194
     F*STDSI   IF  E           K        DISK         KINFSR *PSSR  E13747 S01177
     F*           STDSIAAF                          KIGNORE        E13747 S01177
     FFDINTRLLIF  E           K        DISK         KINFSR INFSR      UC  E18187
     F*SDMMODPDIF**E*******************DISK         KINFSR *PSSRUC  S01241S01314
     FCFFEEDL0IF  E           K        DISK                               S01184
     FPMPORTPDIF  E           K        DISK         KINFSR *PSSR      UC  S01486
     FBROKR   IF  E           K        DISK         KINFSR *PSSR      UC  AUS007
     F            BROKRBNF                          KIGNORE               AUS007
     FFORAT   UF  E           K        DISK         KINFSR *PSSR A    UC  AUS007
     F                                              KCOMIT                AUS007
     FSDCBRTL1IF  E           K        DISK         KINFSR *PSSR      UC  S01383
     FSDBRTDL1IF  E           K        DISK         KINFSR *PSSR      UC  S01383
     F** Core hook for externalisation.                                   S01408
      *                                                                                       CDL013
     FSDSTAAL1IF  E           K        DISK                           UC                      CDL013
      *                                                                                       CDL013
     F/COPY WNCPYSRC,MM0089FPG                                            S01408
      *****************************************************************
     E*                                                                   S01408
     E/COPY WNCPYSRC,MM0089EEP2                                           S01408
     E*                                                                   S01408
     E                    CPY@    1   1 80                                S01194
      *
     E                    @TXT    1   1 25
     E**  Array to hold key field descriptive text for screen messages.
     E*
     E********************@STSA***1***5*24********************************S01319
     E                    @STSA   1   4 24                                S01319
     E*                                                                   S01408
     E/COPY WNCPYSRC,MM0089EEP1                                           S01408
     E*                                                                   S01408
     E**  Array of text for the status.
     E*
     E*****               @CY        50  3                                S01195
     E****Used by SR. ZA0830 - ccy records.                               S01195
     E*****                                                               S01195
     E                    @F         16  1
     E**  Input array for ZA0840
     E*
     E                    @G         16  1
     E**  Output array for ZA0840
     E*
     E                    @H      1  15 15 0
     E**  Array of powers of ten
     E*
     E***********         @YD     4   4  5 0A                             056095
     E****Array*for*SR.*ZA0710*-*Cumulative*days*in*year*for*4*year*period056095
     E*
     E***********         @MD    13  13  5 0A                             056095
     E****Array*for*SR.*ZA0710*-*Cumulative*days*in*year*per*month.****   056095
     E*                                                                   056095
     E/COPY ZSRSRC,ZDATE9Z1                                               056095
     E**  Array for SR. ZDATE9                                            056095
     E*
     E                    @Z         14  1
     E**  Array @Z stores amount with decimal.(Execution time array)
     E*
     E                    @Q         13  1 0
     E**  Array @Q stores amount as it is.(Execution time array)
     E*
     E                    @D         15  1
     E**  Array for amount input.
     E*
     E                    @E         21  1
     E**  Array for display amount.
     E*
     E                    @C         21  1
     E**  Work array.
     E*
     E********************@CMD****1***1*30********************************S01319
     E***Command*used*on*call*to*QCAEXEC*************                     E20774
     E***Command*used*on*call*to*QCMDEXC****************************E20774S01319
     E*
     E                    @M     12  12  2 0
     E**  Array for SR. MM1004 - Days in a month.  (Compile time array)
     E*
     E*****               @V      1   4 20                                S01177
     E****Array to hold event date names.                                 S01177
     E*****                                                               S01177
     E*
     E                    @SF     1  10 10 0
     E**  Array of scaling factors.
     E****E15515*-*Initial*array*with*embeded*BLANKS****************E15515S01319
     E********************@IA********10**1**************************E15515S01319
     E****E15515*-*Ending*array*without*any*embeded*BLANKS**********E15515S01319
     E********************@EA********10**1**************************E15515S01319
     E*
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E*                                                                   S01184
     E******************  TABA    1  10  2   TABB   15             S01184 090749
     E                    TABA    1  16  2   TABB   15                    090749
     E*   Counterparty and Broker STATUS Codes and associated text        S01184
     E                    TABTFU  4   4  2                                S01392
     E*   Valid Deal Types for Front Up Interest                          S01392
     E                    TABFRQ 17  17  1                                S01434
     E*                                                                   S01434
     E**  Array to hold all valid rollover frequencies                    S01434
     E*                                                                   S01434
     E                    TABFQ2  8   8  1                                S01434
     E*                                                                   S01434
     E**  Array to hold all rollover frequencies which need day numbers   S01434
     E*                                                                   S01434
     E                    TABSET 11  11  2                                S01434
     E*                                                                   S01434
     E**  Array to hold all valid interest settlement methods             S01434
     E*                                                                   S01434
     E/COPY ZSRSRC,ZDATE1Z1                                               S01443
     E*                                                                   S01408
     E                    POWER   1   7  7 3             POWER ARRAY      CRE007
     E/COPY WNCPYSRC,MM0089EEPG                                           S01408
     E*                                                                   S01408
     E*****************************************************************   S01184
      /EJECT
      *                                                                                       CPK014
     IFDINTRP0                                                                                CPK014
     I              HWTMESTMP                       HWTMST                                    CPK014
     I***********                                                         E25515
     I***FACILH1F***                                                      E25515
     I***********   KEY                             KEY1                  E25515
     I****Field*renamed.                                                  E25515
     I*                                                                   S01383
     I**  Rename fields to differentiate DEALSDC from SDBRTDL1 fields.    S01383
     I*                                                                   S01383
     ISDBRTDD0                                                            S01383
     I              LCD                             BRTLCD                S01383
     I              LCT                             BRTLCT                S01383
     I              CHTP                            BRCHTP                S01383
     I*                                                                   S01408
     I** Core hook for externalisation.                                   S01408
     I/COPY WNCPYSRC,MM0089IPG                                            S01408
     I*
     I@@AMDS      DS                             15
     I**  Data structure to convert @@IAMT decimal field to alpha.
     I                                        1  150@@IAMT
     I*
     IINFDS       DS
     I**  Data structure for file status of MM deals file.
     I                                     *RECORD  RECORD
     I*
     IINFDU       DS
     I**  Data structure for file status of MM deals update file.
     I                                     *STATUS  STATUS
     I*
     IDNATN       DS                              5
     I**  Data structure to update last transaction number.
     I                                        1   50FNATN
     I********************************************************************S01319
     I*@@RTDS******DS*****************************13**********************S01319
     I****Data*structure*to*convert*@@IRAT*decimal*field*to*alpha*field.**S01319
     I****************************************1**138@@IRAT****************S01319
     I*
     IPSDS       SDS
     I/COPY WNCPYSRC,MM0089I006
     I**  Program status data structure.
     I                                       37  390@NOPMS
     I                                      244 253 @JOB
     I                                      254 263 @USER
     I/COPY WNCPYSRC,MM0089I003
     I**************************************264*2690@JOBNO****************S01319
     I*
     I*****      UDS                                                      S01177
     I***********UDS                            256                 S01177S01117
     I***********UDS                                                S01117E24039
     ILDA         DS                            256                       E24039
     I**  Local data area for data base errors.
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I                                      200 200 NOCHG1                E24039
     I                                      201 201 RCVSTR                E24039
     I                                      202 202 NOCHG2                E24039
     I/COPY WNCPYSRC,MM0089I001
      *                                                                   CPM004
      ** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
      ** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
     IZ#BSTS    E DSZ#BST                                                 082738
     IZ#ASTS    E DSZ#AST                                                 082738
     IZ#WSTS    E DSZ#WST                                                 082738
     I*
     I@SLDS     E DSMMSTDLPP
     I**  Data structure of the standard deal, Loans/Deposits format.
     I*
     I@SBDS     E DSMMSTDBPP
     I**  Data structure of the standard deal, NA's bought format.
     I              QQDORI                          QQDOR1                                    CGL029
     I              QQMORI                          QQMOR1                                    CGL029
     I              QQDOPI                          QQDOP1                                    CGL029
     I              QQMOPI                          QQMOP1                                    CGL029
     I              QQBORI                          QQBOR1                                    CGL029
     I              QQBOPI                          QQBOP1                                    CGL029
     I              QQRONS                          QQRON1                                    CGL029
     I              QQPONS                          QQPON1                                    CGL029
     I*
     I@SSDS     E DSMMSTDSPP
     I**  Data structure of the standard deal, NA's sold format.
     I              QQDORI                          QQDOR2                                    CGL029
     I              QQMORI                          QQMOR2                                    CGL029
     I              QQBORI                          QQBOR2                                    CGL029
     I              QQBOPI                          QQBOP2                                    CGL029
     I              QQRORI                          QQROR2                                    CGL029
     I              QQROPI                          QQROP2                                    CGL029
     I              QQRONS                          QQRON2                                    CGL029
     I              QQPONS                          QQPON2                                    CGL029
     I*
     I@SADS     E DSMMSTDAPP
     I**  Data structure of the standard deal, Deams format.
     I              QQDORI                          QQDOR3                                    CGL029
     I              QQMORI                          QQMOR3                                    CGL029
     I              QQDOPI                          QQDOP3                                    CGL029
     I              QQMOPI                          QQMOP3                                    CGL029
     I              QQBORI                          QQBOR3                                    CGL029
     I              QQBOPI                          QQBOP3                                    CGL029
     I              QQRORI                          QQROR3                                    CGL029
     I              QQROPI                          QQROP3                                    CGL029
     I              QQRONS                          QQRON3                                    CGL029
     I              QQPONS                          QQPON3                                    CGL029
     I*
     I@DLDS     E DSMMDELDPP
     I**  Data structure of the MM deal.
     I              QQDORI                          QQDOR4                                    CGL029
     I              QQMORI                          QQMOR4                                    CGL029
     I              QQDOPI                          QQDOP4                                    CGL029
     I              QQMOPI                          QQMOP4                                    CGL029
     I              QQRONS                          QQRON4                                    CGL029
     I              QQPONS                          QQPON4                                    CGL029
     I              QQINSA                          QQINS4                                    CGL029
     I*
      *                                                                   S01177
     I@PARM2    E DSSETLIAB                                               S01177
     I              QQRONS                          QQRON5                                    CGL029
     I              QQPONS                          QQPON5                                    CGL029
      *                                                                   S01177
      ** data structure for passing a parameter to synon screen           S01177
      *  handling program.                                                S01177
      *                                                                   S01177
     I@PARM3    E DSSETLIAZ                                               S01177
      *                                                                   S01177
      ** data structure for passing a parameter to synon screen           S01177
      *  handling program.                                                S01177
     IWDUMMY      DS                            648                       CEU003
     I** data structure for passing parameter to PGM SD2400               CEU003
     I** (Note: length of DS must equal length of PF/SETLDPD)             CEU003
     I*                                                                   CEU003
      *                                                                   S01177
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** EXTERNAL DS FOR BANK DETAILS                                     S01194
     I*                                                                   S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     I** EXTERNAL DS FOR MIDAS MODULES DETAILS                            S01194
     I*                                                                   S01194
     ISDPRFC    E DSSDPRFCPD                                              S01194
     I** EXTERNAL DS FOR PROFIT CENTRES                                   S01194
     I*                                                                   S01194
     ISDDEAL    E DSSDDEALPD                                              S01194
     I** EXTERNAL DS FOR DEALING DETAILS                                  S01194
     I*                                                                   S01194
     ISDTRAD    E DSSDTRADPD                                              S01194
     I** EXTERNAL DS FOR TRADING DETAILS                                  S01194
     I              QQACCD                          QQ1ACD                                    CGL029
     I*                                                                   S01194
     ISDRETL    E DSSDRETLPD                                              S01194
     I** EXTERNAL DS FOR RETAIL DETAILS                                   S01194
     I              QQACCD                          QQ2ACD                                    CGL029
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I** EXTERNAL DS FOR CURRENCY DETAILS                                 S01194
     I*                                                                   S01194
     ISDDLST    E DSSDDLSTPD                                              S01194
     I** EXTERNAL DS FOR DEAL SUBTYPE DETAILS                             S01194
     I*                                                                   S01194
     ISDBRCH    E DSSDBRCHPD                                              S01194
     I** EXTERNAL DS FOR BRANCH DETAILS                                   S01194
     I*                                                                   S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I** EXTERNAL DS FOR NOSTRO DETAILS                                   S01194
     I              QQACCD                          QQ3ACD                                    CGL029
     I*                                                                   S01194
     ISDBROK    E DSSDBROKPD                                              S01194
     I** EXTERNAL DS FOR BROKER DETAILS                                   S01194
     I*                                                                   S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I** EXTERNAL DS FOR CUSTOMER DETAILS                                 S01194
     I              QQDFAC                          QQ4DFA                                    CGL029
     I*                                                                   S01194
     ISDSECS    E DSSDSECSPD                                              S01194
     I** EXTERNAL DS FOR SE CUSTOMER DETAILS                              S01194
     I              QQACCD                          QQ5ACD                                    CGL029
     I*                                                                   S01194
     ISDBOOK    E DSSDBOOKPD                                              S01194
     I** EXTERNAL DS FOR BOOK DETAILS                                     S01194
     I*                                                                   S01194
     ISDBSRT    E DSSDBSRTPD                                              S01194
     I** EXTERNAL DS FOR BASE RATE DETAILS                                S01194
     I*                                                                   S01194
     ISDCNST    E DSSDCNSTPD                                              S01194
     I** EXTERNAL DS FOR COUNTERPARTY NOSTRO DETAILS                      S01194
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     I** EXTERNAL DS FOR GENERAL LEDGER DETAILS                           S01194
     I              QQACCD                          QQ6ACD                                    CGL029
     I*                                                                   AUS007
     ISCSARD    E DSSCSARDPD                                              AUS007
     I** EXTERNAL DS FOR SAR DETAILS                                      AUS007
     I*                                                                   S01434
     ISDACNT    E DSACCNTAB                                               S01434
     I** EXTERNAL DS FOR ACCOUNT DETAILS                                  S01434
     I*                                                                   S01194
     I              LCD                             ACLCD                 S01434
     I*                                                                   S01194
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I**  Data structure for Portfolio Management customer details        S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I**  Data structure for Portfolio Management ICD File                S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSLDY     E DSDSLDY                                                 CPB001
     I* THIRD DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE            CPB001
     I*                                                                   CPB001
     ICMTTXT      DS                             67
     I**  COMIT text.
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTCDX
     I*
     I@DATA       DS                             45
     I**  Data structure to hold the data for screen messages.
     I                                        1  25 @DATA1
     I                                       26  45 @DATA2
     I*
     I**@KEY***     DS                             12                     S01194
     I****Data*structure for keying to the MIDAS table files              S01194
     I*****                                   1   2 @KEY1                 S01194
     I*****                                   9  11 @KEY2                 S01194
     I*****                                  12  12 @KEY3                 S01194
     I*****                                   8  10 @KEY4                 S01194
     I*****                                  11  12 @KEY5                 S01194
     I*
     I@DFMT       DS
     I**  Data structure to format separate dates into a 8N number
     I                                        1   40@YEAR
     I                                        5   60@MNTH
     I                                        7   80@DAY
     I                                        1   80@DATE
     I*
     I*********** DS                                                      056095
     I****Data*structure*for*SR.*ZA0710*-*field*is*@@Z71Y**************   056095
     I***********                             1   40@@Z71Y                056095
     I***********                             1   10@@SSY1                056095
     I***********                             2   20@@SSY2                056095
     I***********                             3   30@@SSY3                056095
     I***********                             4   40@@SSY4                056095
     I*
     I*********** DS                                                      056095
     I****Data*structure*for*SR.*ZA0710*-*field*is*@@VDT***************   056095
     I***********                             1   80@@VDT                 056095
     I***********                             1   40@@YR                  056095
     I***********                             5   60@@Z71M                056095
     I***********                             7   80@@Z71D                056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDATE9Z2                                               056095
     I**  Data structure for SR. ZDATE9                                   056095
     I*
     I            DS
     I**  Data structure for date in, to change format.
     I                                        1   80@@DTIN
     I                                        3   40@@YY
     I                                        5   60@@MM
     I                                        7   80@@DD
     I***********                             1   40@@YYYY                056095
     I***********                             1   20@@CC                  056095
     I***********                             5   60@@MTH                 056095
     I***********                             7   80@@DAY                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDAT10Z1                                               056095
     I**  Data structure for SR. ZDAT10                                   056095
     I*
     I            DS                              6
     I**  Data structure to change format to MMDDYY/DDMMYY
     I                                        1   60@@DTOU
     I                                        1   20@@DAT1
     I                                        3   40@@DAT2
     I                                        5   60@@YYY
     I*
     I            DS
     I**  Data structure to redefine array @Z as returned field @@AMTD
     I                                        1  14 @@AMTD
     I                                        1  14 @Z
     I*
     I            DS
     I**  Data structure to redefine array @Q as input field @@AMTW
     I                                        1  130@@AMTW
     I                                        1  130@Q
     I*
     I*****       DS                                                      S01195
     I****Used by SR. ZA0830 - array data structure.                      S01195
     I*****                                   1 150 @CY                   S01195
     I*****                                   1  75 @@CY1                 S01195
     I*****                                  76 150 @@CY2                 S01195
     I*
     I**  Data structure for SR. MM1004 - Manipulate date input.
     I@@WKDS      DS
     I                                        1   80@@WKDT
     I                                        1   40@@WKYY
     I                                        3   40@@WKY
     I                                        5   60@@WKM
     I                                        7   80@@WKD
     I*
     I*********** DS                                                      056095
     I****Data*Structure*for*SR.*MM1009*-*date*field*YYYYMMDD.*********   056095
     I***********                             1   80@@DATA                056095
     I***********                             1   40@@YY1                 056095
     I***********                             5   60@@MM1                 056095
     I***********                             7   80@@DD1                 056095
     I*
     I*********** DS                                                      056095
     I****Data*Structure*for*SR.*MM1009*-*date*field*YYYYMMDD.*********   056095
     I***********                             1   80@@DATB                056095
     I***********                             1   40@@YY2                 056095
     I***********                             5   60@@MM2                 056095
     I***********                             7   80@@DD2                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZINTDYZ1                                               056095
     I**  Data Structure for SR. ZINTDY                                   056095
     I*
     I            DS
     I**  Data structure for SR. MM1010 - Date field YYMMDD.
     I                                        1   80HNDATE
     I                                        1   40HNVDYY
     I                                        5   60HNVDMM
     I                                        7   80HNVDDD
     I*
     I            DS                                                      S01434
     I*                                                                   S01434
     I**  Data structure for Interest Settlement Account                  S01434
     I*                                                                   S01434
     I**********                              1  15 @@INSA                             S01434 CGL029
     I                                        1  21 @@INSA                                    CGL029
     I                                        1   2 INOST                 S01434
     I**********                              3  12 IZ010                              125411 CGL029
     I**********                              3  15 IZ013                              S01434 CGL029
     I                                        3  18 IZ010                                     CGL029
     I                                        3  21 IZ013                                     CGL029
     I                                        1   6 ICUST                 S01434
     I**********                              7  15 IZ009                              S01434 CGL029
     I                                        7  21 IZ009                                     CGL029
     I                                        1  10 IRETL                 S01434
     I**********                              7  10 IACOD                              S01434 CGL029
     I**********                             11  12 IACSQ                              S01434 CGL029
     I**********                             13  15 IBRCA                              S01434 CGL029
     I**********                             11  15 IZ004                              S01434 CGL029
     I**********                              1  12 IINSN                              S01434 CGL029
     I                                        7  16 IACOD                                     CGL029
     I                                       17  18 IACSQ                                     CGL029
     I                                       19  21 IBRCA                                     CGL029
     I                                       17  21 IZ004                                     CGL029
     I                                        1  18 IINSN                                     CGL029
     I*                                                                   S01434
     I            DS                                                      S01434
     I*                                                                   S01434
     I**  Data structure for Interest Counterparty Nostro                 S01434
     I*                                                                   S01434
     I                                        1  10 DDINOS                S01434
     I                                        1   6 ICUSN                 S01434
     I                                        7  10 IZZ04                 S01434
     I                                        1   8 INOSN                 S01434
     I                                        9  10 IZZ02                 S01434
     I*                                                                   S01434
     I***@CLTDS***   DS                                                   S01194
     I****Data*structure for output of the CLINT key.                     S01194
     I*****                                   1   60@CNUM                 S01194
     I*****                                   7   7 @RCDT                 S01194
     I*
     I************DS******************************************************S01319
     I****Data*structure*to*split*up*our*settlement*instructions.*********S01319
     I****************************************1***60@CUN******************S01319
     I****************************************7**100@ACD******************S01319
     I***************************************11**120@SEQ******************S01319
     I****************************************1**12*@OUR******************S01319
     I********************************************************************S01319
     I*@CMDV*******DS*****************************10**********************S01319
     I****Command*variables***********************************************S01319
     I****************************************1***3*@CUID*****************S01319
     I****************************************4***9*@CJON*****************S01319
     I***************************************10**10*@CEND*****************S01319
     I*
     I*****       DS                             64                       E12574
     I            DS                            256                       E12574
     I**  MMOD data structure.
     I*****                                   1  64 MMOD                  E12574
     I                                        1 256 MMOD                  E12574
     I******************************         13  13 @MOD13                S01314
     I                                       21  21 @MOD21                S01176
     I***************************************60  60 @CNF           S01184 S01314
     I** FIX E12945 IS INCORRECT                                   E12945 E14356
     I******                                                       E12945 E14356
     I******SPLIT FIELD FOR CORRECT BASE RATE CALCULATION          E12945 E14356
     I******      DS                             12                E12945 E14356
     I******                                  1  12 KEY            E12945 E14356
     I******                                 11  12 BRTT1          E12945 E14356
      *                                                                   S01408
     I/COPY WNCPYSRC,MM0089IIP1                                           S01408
      *                                                                   S01408
     I*     SPLIT FIELD FOR A/C SEQ NUMBER                                089603
     I                                        1   2 WKACSQ                089603
     I                                        1   1 WKACS1                089603
     I                                        2   2 WKACS2                089603
     I*                                                                   S01117
     I*SDPRFC****E DSSDPRFCD0*******                                      E70
     I***PROFIT*CENTRE DETAILS ACCESSED VIA ACCESS PROGRAM                E70
     I*                                                                   S01117
     IZMUSER      DS                             17                       S01117
     I                                        1  10 ZUSER                 CDL010
     I                                       11  13 BRC                   S01117
     I                                       14  16 DEPT                  S01117
     I*                                                                   S01117
     I**@PORC*******DS*****************************41              S01117 E270
      ***Profit*Centre*Dft.*Matrix*Retrieval*index*(AOPRFMR0)      S01117 E270
      ***Book Code                                                 S01117 E270
     I****************************************1   2 DDBOKC         S01117 E270
      ***Relevant*Transaction*Type                                 S01117 E270
     I****************************************3   7 @DLTP1         S01117 E270
      ***Sub*Type                                                  S01117 E270
     I****************************************8   9 DDSTYP         S01117 E270
      ***Branch*code                                               S01117 E270
     I***************************************10  12 DDBRCA         S01117 E270
      ***Dept*Code                                                 S01117 E270
     I***************************************13  15 @DEPT1         S01117 E270
      ***User                                                      S01117 E270
     I***************************************16  25 @USER1         S01117 E270
      ***Account*Officer*Code                                      S01117 E270
     I***************************************26  27 @ACOF1         S01117 E270
      ***Customer*number                                           S01117 E270
     I***************************************28  33 @CUST1         S01117 E270
      **Profit*Centre*Code                                         S01117 E270
     I***************************************34  37 @PRFC1         S01117 E270
     I*                                                                   S01117
     IRUNDAT      DS                                                      S01117
     I                                       13  13 @MBIN                 S01117
     I/COPY WNCPYSRC,MM0089I002
     I*                                                                   S01117
     I*                                                                   S01117
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      *
      /EJECT                                                              S01241
      *                                                                   S01241
      *======== S01241 ===================================================S01241
      * Insert DS to pass the DATA parameter to the return program        S01241
     ISPARE       DS                            256                       CAC001
      * Define the data structure to pass data to WN0010 and return pgm   CAC001
      *                                                                   CAC001
     I                                        1   1 WACTN                 CAC001
     I                                        2   2 WDSTS                 CAC001
     I                                    P   3   87WINTR                 CAC001
     I                                        9  12 WPRFC                 CAC001
     I                                    P  13  187WFSRP                 CAC001
     I                                       19  19 WFSGN                 CAC001
     I                                       20  23 WFPRC                 CAC001
     I                                       24  26 WCCY                  CAC001
     I                                       27  29 WLCCY                 CAC001
     I                                       30  30 WRATF                 CAC001
     I                                       31  31 WFRC                  CAC001
     I                                       32  35 WTPRC                 CAC001
     I/COPY WNCPYSRC,MM0089I005
      /COPY QWINDSRC,MM0089DTA                                            S01241
      *                                                                   S01241
      *======== S01241 ===================================================S01241
     I*                                                                   S01408
     I** Core hook for externalisation.                                   S01408
      /COPY WNCPYSRC,MM0089IDS                                            S01408
     I*                                                                   S01408
      /EJECT
     I/COPY WNCPYSRC,MM0089I004
      *                                                                                       CDL081
      ** Named constants                                                                      CDL081
      *                                                                                       CDL081
     I              'BasCcyTaxRoundDown'  C         C#BASE                                    CDL081
     I              'NBasCcyTaxRoundDown' C         C#NBAS                                    CDL081
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     C**************************************************************S01253S01304
      **********************************************                S01253S01304
      **Call*SDRTVTXT*pgm*to*access*appropriate*text                S01253S01304
      ***for*a*field*used*in*a*SFL******************                S01253S01304
      **********************************************                S01253S01304
     C*********************MOVEL'ZZGBMSGF'MSGNM                     S01253S01304
     C*********************MOVEL'ZZM1607' MSGDNB                    S01253S01304
     C*********************CALL 'SDRTVTXT'                          S01253S01304
     C*********************PARM           MSGDNB  7                 S01253S01304
     C*********************PARM           MSGNM  10                 S01253S01304
     C*********************PARM           MSGTXT 80                 S01253S01304
     C*********************MOVELMSGTXT    ZZM053                    S01253S01304
      *********************************************                 S01253S01304
     C*****************************************************************
     C*                                                               *
     C* MAIN     - Top level of program.                              *
     C*                                                               *
     C* CALLS    #A       - Initial processing.                       *
     C*          #B       - Main processing.                          *
     C*          #C       - Termination processing.                   *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
      *
     C**  If the program has been called with a termination parameter
     C**  'T', go directly to termination processing.
     C           @TERM1    IFNE 'T'                        B1
     C/COPY WNCPYSRC,MM0089C541
     C*
     C**  Initial processing.
     C                     EXSR #A                         *1
     C*
     C**  Main processing
     C                     EXSR #B                         *1
     C                     END                             E1
     C*
     C**  Termination processing
     C                     EXSR #C
     C*
     C           ENDPGM    TAG                             **ENDPGM**
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C* SUBROUTINES USED                                              *
     C*                                                               *
     C*  01  #B       - Main processing.                              *
     C*  02  #BG      - Range authorisation processing.               *
     C*      #BH      - Rollover deal processing.                     *   S01434
     C*  03  #ZL      - Displays, reads and resets screen.            *
     C*  04  #ZA      - Resets screen error indicators and MSGQ.      *
     C*  05  #BB      - F8  processing.                               *
     C*  06  #BC      - F7  processing.                               *
     C*  07  #BA      - F12 processing.                               *
     C*      #BE      - F14 processing - settlement screen details    *   S01177
     C*  08  #ZE      - Clears all screen fields.                     *
     C*      #ZEA     - clear standard deal fields                    *   E18139
     C*  09  #ZD      - Sets up screen with file values.              *
     C*  10  ZA1150   - Convert rate to scaled rate.                  *
     C*  11  #ZF      - Resets screen fileds with stored values.      *
     C*  12  #BD      - Enter processing.                             *
     C*  13  #BDA     - Enter processing for action code I.           *
     C*  14  #ZC      - Enter processing for action code A.           *
     C*  15  #ZI      - Validates the screen input for I,A and X.     *
     C*  16  ZA1160   - Convert rate to scaled rate.                  *
     C*  17  #ZIB     - Set up event date fields.                     *
     C***18  #ZIA     - Validates the setttlement instructions.       *   S01177
     C***19  #ZIC     - Revalidation for settlement defaults.         *   S01177
     C***20  #ZIAA    - Perform account checks.                       *   S01177
     C*  21  #ZO      - Validate deal number and action code.         *
     C*  22  #ZP      - Enter processing for action code X.           *
     C***23**ZA0680***-*YYYYMMDD*to*MIDAS*day*no.*conversion.**********   056095
     C***24**ZA0710***-*MIDAS*day*no.*to*YYYYMMDD*conversion.**********   056095
     C*  23  ZDAT10   - YYYYMMDD to MIDAS day no. conversion.         *   056095
     C*  24  ZDATE9   - MIDAS day no. to YYYYMMDD conversion.         *   056095
     C*  25  ZA0770   - YYYYMMDD to MMDDYY or DDMMYY conversion.      *
     C***26  ZA0830   - Check whether day is a holiday for ccy.       *   S01195
     C*  27  ZA0840   - Validate alpha versions of numeric fields.    *
     C*  28  ZA0920   - Back office amount editor.                    *
     C*  29  ZA1020   - Convert amount to display.                    *
     C*  30  MM1004   - Calculate next interest payment date.         *
     C***31**MM1007***-*Calculate interest.                           *   E17051
     C*  31  MM1030   - Calculate interest.                           *   E17051
     C***32**MM1009***-*Calculate*the*number*of*interest*days.*********   056095
     C*  32  ZINTDY   - Calculate the number of interest days.        *   056095
     C*  33  MM1010   - Calculation of interest at maturity.          *
     C*  34  #ZJ      - Move screen fields into standard deal fmt.    *
     C*      #ZK      - Set up Date of Payment and Receipt            *   S01177
     C*  35  #ZG      - Update processing.                            *
     C*  36  #BDAA    - Processing for insert of new record.          *
     C*  37  ZTNLU1   - Locks and updates trans. no. data area.       *
     C*  38  #ZB      - Enter processing for action code D.           *
     C*  39  #ZM      - F10  processing.                              *
     C*  40  #BF      - F15  processing - select screen handling.     *
     C*  41  #BFA     - F15  processing - amend handling.             *
     C*  42  #BFB     - F15  processing - delete handling.            *
     C*  43  #BFC     - F15  processing - authorise handling.         *
     C*  44  #A       - Initial processing.                           *
     C*  45  #C       - Termination processing.                       *
     C*  46  INFSR    - Error checking SR for write to deals file.    *
     C***47**ZA0150***-*Access installation control data file.        *   S01194
     C*  48  *PSSR    - Program error handling routine.               *
     C*  57  #TSPN    - Determine deal time span                      *   S01443
     C*  58  #FEED    - Extract feedback information when             *   S01184
     C*                 CONFIRMATION MATCHING module present          *   S01184
     C*                                                               *
     C* EXTERNAL ROUTINE                                              *
     C*  49  ZA0250   - Clears error message queue.                   *
     C*  50  ZA0240   - Sends a msg to the program message queue.     *
     C*  51  CA0040   - Deal number regeneration.                     *
     C*  52  ZA0270   - Alpha date to MIDAS day no. conversion.       *
     C*  53  ZA0440   - Sends a msg with data to the pgm msg queue    *
     C*  54  MM0078   - Update front office data base.                *
     C***55**MM0082***-*Update*back*office*data*base.                 *   082738
     C*  55  MM0083   - Update back office data base.                 *   082738
     C***56**MM0031***-*Add*member*to*standard*deals*file*fmts.***********S01319
     C***57**QCAEXEC**-*Perform*CL*command.****************************   E20774
     C***57**QCMDEXC**-*Perform*CL*command.*************************E20774S01319
     C*                                                               *
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #B       - Main processing.                                   *
     C*                                                               *
     C* CALLS    #BA      - F12 processing.                           *
     C*          #BB      - F8  processing.                           *
     C*          #BC      - F7  processing.                           *
     C*          #BD      - Enter processing.                         *
     C*          #BE      - F14 processing settlements screen         *   S01177
     C*          #BF      - F15  processing - select screen handling. *
     C*          #BG      - Range authorisation processing.           *
     C*          #BH      - Rollver deal processing.                  *   S01434
     C*          #ZL      - Displays, reads and resets screen.        *
     C*          #ZM      - F10  processing.                          *
     C*                                                               *
     C* CALLED BY  MAIN   - Top level of program.                     *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C*
     C           #B        BEGSR
     C*
     C**  If the number of parameters passed to the program is three,
     C**  the program has been called from Range Authorizations.
     C**  Execute range authorisation processing and by-pass main proc.
     C           @NOPMS    IFEQ 3                          B1
     C                     EXSR #BG                        *1
     C                     GOTO #B9                        *1
     C                     END                             E1
     C*                                                                   S01434
     C**  If program wsa called from Rollover Deals Maintenance then      S01434
     C**  execute Rollover processing.                                    S01434
     C*                                                                   S01434
     C           @TERM1    IFEQ 'R'                                       S01434
     C                     EXSR #BH                                       S01434
     C/COPY WNCPYSRC,MM0089C195
     C                     END                                            S01434
     C*
     C**  Continue processing until program exit is required.
     C           *INKC     DOWEQ'0'                        B1
     C**    (IF 'I'nsert do not display FEEDBACK information)             S01184
     C           DDACTN    IFEQ 'I'                                       S01184
     C                     MOVE '1'       *IN94                           S01184
     C                     MOVE '0'       *IN39                           S01184
     C/COPY WNCPYSRC,MM0089C043
     C                     ELSE                                           S01184
     C                     MOVE '0'       *IN94                           S01184
     C/COPY WNCPYSRC,MM0089C044
     C                     END                                            S01184
     C/COPY WNCPYSRC,MM0089C068
     C*
     C**  Process screen.
     C                     EXSR #ZL                        *1
      *                                                                   S01241
     C/COPY WNCPYSRC,MM0089C042
     C           DDACTN    IFEQ 'E'                                       S01241
     C           DDDLNO    ANDEQ@DLNO                                     S01241
     C           DDDLNO    ANDNE*BLANKS                                   088306
     C           *INKC     ANDEQ'0'                                       S01241
     C           *INKL     ANDEQ'0'                                       S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP91                                           S01408
     C*                                                                   S01408
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,MM0089MOV1                                           S01241
      *                                                                   S01241
     C                     EXSR #WIND                                     S01241
     C/COPY WNCPYSRC,MM0089C393
     C                     END                                            S01241
      *                                                                   S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP42                                           S01408
     C*                                                                   S01408
     C*
     C**  Process screen input - depending upon input type.
     C*
     C/COPY WNCPYSRC,MM0089CP66                                           S01408
     C*                                                                   S01408
     C**  If F3  is input exit main processing immediately.
     C           *INKC     CABEQ'1'       #B9              *1
     C*
     C**  F12 input.
     C           *INKL     CASEQ'1'       #BA              *1
     C*
     C**  F8  input.
     C           *INKH     CASEQ'1'       #BB              *1
     C*
     C**   F7 input.
     C           *INKG     CASEQ'1'       #BC              *1
     C*
     C**   F14 input.                                                     S01177
     C           *INKN     CASEQ'1'       #BE              *1             S01177
     C*                                                                   S01177
     C**   F15 input.
     C           *INKP     CASEQ'1'       #BF              *1
     C*
     C**   F10 input - only possible after valid 'ENTER' processing
     C**               in delete mode.
     C           *INKJ     CASEQ'1'       #ZM              *1
     C*
     C/COPY WNCPYSRC,MM0089C045
     C****'ENTER'*input.***********************************************   CAC001
      **  'ENTER' or 'F19' input                                          CAC001
     C                     CAS            #BD              *1
     C*
     C                     END                             *1
     C*
     C/COPY WNCPYSRC,MM0089C157
     C                     END                             E1
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP43                                           S01408
     C*                                                                   S01408
     C           #B9       ENDSR                           **#B9**
      /EJECT
     C/COPY WNCPYSRC,MM0089C069
     C*****************************************************************
     C*                                                               *
     C* #BG      - Range authorisation processing.                    *
     C*                                                               *
     C* CALLS    #ZA      - Resets screen error indicators and MSGQ.  *
     C*          #ZD      - Sets up screen with file values.          *
     C*          #ZG      - Update processing.                        *
     C*          #ZI      - Validates the screen input for I,A and X. *
     C*          #ZL      - Displays, reads and resets screen.        *
     C*                                                               *
     C* CALLED BY  #B     - Main processing.                          *
     C*                                                               *
     C* FLDS USED  @RDLN  - No. of deal requiring authorisation.      *
     C*            @DLKEY - Numeric key to deal file.                 *
     C*            @TERM1 - Termination paramater.                    *
     C*                                                               *
     C*****************************************************************
     C           #BG       BEGSR
     C*
     C**  Deal number is passed as parameter. Assign to screen field
     C**   and protect
     C                     MOVE 'X'       DDACTN
     C                     MOVE @RDLN     DDDLNO
     C                     MOVE '1'       *IN52
     C*
     C**  Chain to the file using the key.
     C                     MOVE DDDLNO    @DLKEY
     C           @DLKEY    CHAINMMDEALLL             72
     C/COPY WNCPYSRC,MM0089C266
     C*
     C**  Move fields into pgm fields.
     C                     EXSR #ZD
     C/COPY WNCPYSRC,MM0089C082
     C*
     C**  Reset error indicators and clear screen message queue.
     C                     EXSR #ZA
     C*
     C**  Process until record updated (deal no reset by #ZG)
     C**          or    F3 entered   (for invalid deal)
     C           DDDLNO    DOUEQ*BLANKS                    B1
     C           *INKC     OREQ '1'                        B1
     C*
     C**  Validation
     C*                                                                   S01177
     C**  Allow  call to SD2410  to validate settlement details           S01177
     C********             MOVE '0'       *IN77                     S01177AUS007
     C                     MOVE '0'       *INL1                           AUS007
     C*                                                                   E16048
     C** A new indicator is introduced to highlight Value Date            E16048
     C** under certain circumstances                                      E16048
     C*                                                                   E16048
     C                     SETOF                     69                   E16048
     C*                                                                   S01177
     C/COPY WNCPYSRC,MM0089C291
     C                     EXSR #ZI                        *1
     C*
     C**  If valid, update
     C           *IN41     IFEQ '0'                        B*2
     C                     MOVE 'Y'       @@@BPS  1                       E20989
     C                     EXSR #ZG                        **2
     C                     MOVE *BLANKS   @@@BPS                          E20989
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C295
     C*
     C**  If not updated, display for amendment
     C           DDDLNO    IFNE *BLANKS                    B*2
     C                     MOVE 'A'       DDACTN           **2
     C                     MOVE 'E'       @ERR             **2
     C                     EXSR #ZL                        **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #BG9      ENDSR                           **#BG9**
      /EJECT                                                              S01434
     C*****************************************************************   S01434
     C*                                                               *   S01434
     C* #BH      - Rollover deals processing                          *   S01434
     C*                                                               *   S01434
     C* CALLS    #ZA      - Resets screen error indicators and MSGQ.  *   S01434
     C*          #ZD      - Sets up screen with file values.          *   S01434
     C*                                                               *   S01434
     C* CALLED BY  #B     - Main processing.                          *   S01434
     C*                                                               *   S01434
     C* FLDS USED  NEWDN  - No. of deal requiring amendment    .      *   S01434
     C*            @DLKEY - Numeric key to deal file.                 *   S01434
     C*            @TERM1 - Termination paramater.                    *   S01434
     C*                                                               *   S01434
     C*****************************************************************   S01434
     C           #BH       BEGSR                                          S01434
     C*                                                                   S01434
     C**  Chain to the file using the key.                                S01434
     C*                                                                   S01434
     C                     MOVE 'A'       DDACTN                          S01434
     C                     MOVE NEWDN     DDDLNO                          S01434
     C                     MOVE DDDLNO    @DLKEY                          S01434
     C*                                                                   S01434
     C           @DLKEY    CHAINMMDEALLL             72                   S01434
     C*                                                                   S01434
     C**  Move fields into pgm fields.                                    S01434
     C                     EXSR #ZD                                       S01434
     C*                                                                   S01434
     C**  Reset error indicators and clear screen message queue.          S01434
     C                     EXSR #ZA                                       S01434
     C*                                                                   S01434
     C           #BH9      ENDSR                           **#BH9**       S01434
      /EJECT
      *****************************************************************   S01241
      *                                                               *   S01241
      * #WIND    - WINDOW PROCESSING                                  *   S01241
      *                                                               *   S01241
      * CALLS    WN0010   - WINDOW PROGRAM CALLING.                   *   S01241
      *          ZA0270   - DATE CONVERSION.                          *   S01241
      *                                                               *   S01241
      * CALLED BY  #BDA   - ENTER PROCESSING FOR ACTION CODE I.       *   S01241
      *            #ZG    - UPDATE  processing.                       *   S01241
      *                                                               *   S01241
      * FLDS USED                                                     *   S01241
      *                                                               *   S01241
      *****************************************************************   S01241
     C           #WIND     BEGSR                                          S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CPG8                                           S01408
     C*                                                                   S01408
     C*                                                                   S01241
     C           @5ST      IFEQ 'Y'                                       S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP60                                           S01408
     C*                                                                   S01408
     C                     CALL 'WN0010'                                  S01241
     C                     PARM 'MM0089'  #PGM   10                       S01241
     C                     PARM           FKEY    2                       S01241
     C                     PARM DDACTN    ACTION  1                       S01241
     C                     PARM           DATA                            S01241
     C                     PARM *BLANKS   #RTRN   7                       S01241
     C                     PARM           SPARE 256                       S01252
     C*                                                                   060933
     C** Process returned command keys                                    060933
     C*                                                                   060933
     C                     SELEC                                          060933
     C           #RTRN     WHEQ 'Y2U9999'                                 060933
     C/COPY WNCPYSRC,MM0089C490
     C                     MOVE *ON       *INKC            CK-03          060933
     C                     EXSR #C                         Terminate      060933
     C                     ENDSL                                          060933
     C/COPY WNCPYSRC,MM0089C505
     C*                                                                   060933
     C                     END                                            S01241
     C*                                                                   S01241
     C***********#RTRN     IFEQ 'USR0790'                           S01241E22219
     C           #RTRN     IFNE *BLANK                              S01241E22219
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP92                                           S01408
     C*                                                                   S01408
     C           DDACTN    ANDNE'E'                                       S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP93                                           S01408
     C*                                                                   S01408
     C                     CALL 'SNDERMSG'                                S01241
     C                     PARM 'MM0089'  ZAPGM  10        Program queue  S01241
     C                     PARM           ZAPGRL  5        Rel queue      S01241
     C*********************PARM 'WND0001' ZAMSID  7        Message  S01241E22219
     C                     PARM #RTRN     ZAMSID  7        Message Id.    E22219
     C*********************PARM 'MIDAS  ' ZAMSGF 10        Message  S01241E22219
     C                     PARM 'WNMSGF ' ZAMSGF 10        Message file.  E22219
     C                     PARM           ZAMSDA132        Message data.  S01241
     C                     PARM           ZAMSTP  7        Message type.  S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP94                                           S01408
     C*                                                                   S01408
      * Clear all fields                                                  S01241
     C                     MOVEL*BLANK    ZAPGM            Program queue  S01241
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      S01241
     C                     MOVEL*BLANK    ZAMSID           Message Id.    S01241
     C                     MOVEL*BLANK    ZAMSGF           Message file.  S01241
     C                     MOVEL*BLANK    ZAMSDA           Message data.  S01241
     C                     MOVEL*BLANK    ZAMSTP           Message type.  S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C129                                           S01408
     C*                                                                   S01408
     C                     END                                            S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CPG9                                           S01408
     C*                                                                   S01408
     C*                                                                   S01241
     C                     ENDSR                                          S01241
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZL      - Displays, reads and resets screen.                 *
     C*                                                               *
     C* CALLS    #ZA      - Resets screen error indicators and MSGQ.  *
     C*                                                               *
     C* CALLED BY  #B     - Main processing.                          *
     C*            #BF    -  F15 processing - select screen handling. *
     C*            #BFA   -  F15 processing - amend handling.         *
     C*            #BFB   -  F15 processing - delete handling.        *
     C*            #BFC   -  F15 processing - authorise handling.     *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #ZL       BEGSR
     C*
     C**  Retrieve time and place in screen field.
     C                     TIME           DDTIME
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP39                                           S01408
     C*                                                                   S01408
     C*
     C**  Display screen.
     C**  Do not display screen if already diplayed pending file update   E18139
     C************IN57     IFEQ '0'                        B1      E18139 136728
     C***********WIN57     IFEQ '0'                        B1      136728 CEU015
     C           WIN57     IFNE '1'                        B1             CEU015
     C                     WRITEMM0089S0
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP13                                           S01408
     C*                                                                   S01408
     C                     WRITEMM0089D3                                  S01199
     C                     WRITEMM0089D0
     C                     END                             E1             E18139
     C*
     C**  Read screen.
     C*********************READ MM0089S0                 60               S01199
     C                     READ MM0089D3                 60               S01199
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP40                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP14                                           S01408
     C*                                                                   S01408
     C*
     C**  Reset error indicators and clear screen message queue.
     C                     EXSR #ZA
     C*                                                                   E18139
     C**  Set off screen indicator                                        E18139
     C***********          SETOF                     57            E18139 136728
     C                     MOVEL'0'       WIN57   1                       136728
     C*
     C           #ZL9      ENDSR                           **#ZL9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZA      - Resets screen error indicators and MSGQ.           *
     C*                                                               *
     C* CALLS    ZA0250   - Clears error message queue.               *
     C*                                                               *
     C* CALLED BY  #BDAA  - Processing for insert of new record.      *
     C*            #BF    -  F15 processing - select screen handling. *
     C*            #ZG    - Update processing.                        *
     C*            #ZL    - Displays, reads and resets screen.        *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #ZA       BEGSR
     C*
     C**  Reset all field error indicators.
     C                     MOVE '0'       *IN01
     C                     MOVE '0'       *IN02
     C                     MOVE '0'       *IN03
     C                     MOVE '0'       *IN04
     C                     MOVE '0'       *IN05
     C                     MOVE '0'       *IN06
     C                     MOVE '0'       *IN07
     C                     MOVE '0'       *IN08
     C                     MOVE '0'       *IN09
     C                     MOVE '0'       *IN10
     C                     MOVE '0'       *IN11
     C*                                                                   E16048
     C** A new indicator is introduced to highlight Value Date            E16048
     C** under certain circumstances                                      E16048
     C*                                                                   E16048
     C                     SETOF                     69                   E16048
     C                     MOVE '0'       *IN12
     C                     MOVE '0'       *IN13
     C***********          MOVE '0'       *IN14                           E25515
     C                     MOVE '0'       *IN15
     C                     MOVE '0'       *IN16
     C                     MOVE '0'       *IN17
     C                     MOVE '0'       *IN18
     C                     MOVE '0'       *IN19
     C                     MOVE '0'       *IN20
     C                     MOVE '0'       *IN21
     C                     MOVE '0'       *IN22
     C                     MOVE '0'       *IN23
     C                     MOVE '0'       *IN24
     C                     MOVE '0'       *IN25
     C                     MOVE '0'       *IN26
     C                     MOVE '0'       *IN27
     C                     MOVE '0'       *IN28
     C                     MOVE '0'       *IN29
     C                     MOVE '0'       *IN30
     C                     MOVE '0'       *IN31
     C*****                MOVE '0'       *IN32                           S01177
     C*****                MOVE '0'       *IN33                           S01177
     C*****                MOVE '0'       *IN34                           S01177
     C*****                MOVE '0'       *IN35                           S01177
     C*****                MOVE '0'       *IN36                           S01177
     C*****                MOVE '0'       *IN37                           S01177
     C                     MOVE '0'       *IN34                           136728
     C                     MOVE '0'       *IN40                           S01136
     C                     MOVE '0'       *IN46                           S01486
     C***********          MOVE '0'       *IN47                    S01486 079475
     C                     MOVE '0'       *IN48                           S01165
     C                     MOVE '0'       *IN49                           S01165
     C                     MOVE '0'       *IN54                           S01117
     C                     MOVE '0'       *IN57                           136728
     C                     MOVE '0'       *IN66                           S01392
     C                     MOVE '0'       *IN67                           S01392
     C                     MOVE '0'       *IN68                           S01392
     C                     MOVE '0'       *IN74                           S01176
     C                     MOVE '0'       *IN75                           S01176
     C                     MOVE '0'       *IN77                           AUS007
     C                     MOVE '0'       *IN80                           S01434
     C                     MOVE '0'       *IN81                           S01434
     C                     MOVE '0'       *IN82                           S01434
     C                     MOVE '0'       *IN83                           S01434
     C                     MOVE '0'       *IN84                           S01434
     C                     MOVE '0'       *IN85                           S01434
     C                     MOVE '0'       *IN86                           S01434
     C                     MOVE '0'       *IN87                           S01434
     C/COPY WNCPYSRC,MM0089C267
     C*
     C**  Reset cursor positioning indicators.
     C                     MOVE '0'       *IN43
     C                     MOVE '0'       *IN44
     C*
     C**  Reset validation error indicator.
     C                     MOVE '0'       *IN41
     C*
     C**  Reset indicator enabling F10.
     C           DDACTN    IFNE 'D'                                       S01177
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP62                                           S01408
     C*                                                                   S01408
     C                     MOVE '0'       *IN42
     C                     END                                            S01177
     C*
     C**  Reset warning error indicator.                                  E12365
     C                     MOVE '0'       *IN55                           E12365
     C*
     C**  Reset indicator showing external update.
     C***********          MOVE '0'       *IN78                           S01434
     C                     Z-ADD0         IN78    10                      S01434
     C*
     C**  Clear screen message queue.
     C/COPY WNCPYSRC,MM0089C296
     C                     CALL 'ZA0250'
     C/COPY WNCPYSRC,MM0089C297
     C*
     C           #ZA9      ENDSR                           **#ZA9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #BB      -  F8 processing.                                    *
     C*                                                               *
     C* CALLS    #ZD      - Sets up screen with file values.          *
     C*          ZA0240   - Sends a msg to the program message queue. *
     C*                                                               *
     C* CALLED BY  #B     - Main processing.                          *
     C*                                                               *
     C* FLDS USED  @TEST  - Field to test numeric fields' right byte. *
     C*            @DLKEY - Numeric key to deal file.                 *
     C*            @MSGID - Message id field.                         *
     C*            @DLNO  - Stored version of DDDLNO.                 *
     C*            @ACTN  - Stored version of DDACTN.                 *
     C*                                                               *
     C*****************************************************************
     C           #BB       BEGSR
     C*
      ** Must first check user is authorised to action code 'E' if        S01117
      ** MBIN 'N'. Note MBIN 'Y' checking done later in subroutine        S01117
     C           @MBIN     IFEQ 'N'                        B1             S01117
      *                                                                   S01117
     C                     CALL 'ZVACTU'                   *1             S01117
     C                     PARM 'E'       ZACTN            *1             S01117
     C                     PARM           ERR              *1             S01117
      *                                                                   S01117
     C           ERR       IFEQ 1                          B*2            S01117
     C                     MOVE '1'       *IN01            **2            S01117
     C                     MOVE '1'       *IN41            **2            S01117
     C                     MOVEL'FXM0292' @MSGID           **2            S01117
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C                     GOTO #BB9                       **2            S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
     C                     END                             E1             S01117
     C*                                                                   S01177
     C**  Clear "F10-CONFIRM" prompt if displayed before F8 pressed       S01177
     C                     MOVE '0'       *IN42                           S01177
     C*
     C**  Validate that deal number is numeric or blank.
     C                     TESTN          DDDLNO     62
     C                     MOVE DDDLNO    @TEST
     C                     TESTZ          @TEST          73
     C*
     C**  If it is set up the file key, otherwise output an error message.
     C           DDDLNO    IFEQ *BLANKS                    B1
     C           *IN62     OREQ '1'                        B1
     C           *IN73     ANDEQ'1'                        B1
     C                     MOVE DDDLNO    @DLKEY           *1
     C                     ELSE                            X1
     C                     MOVEL'MMM0162' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE '1'       *IN02            *1
     C                     MOVE '1'       *IN41            *1
     C                     GOTO #BB9                       *1
     C                     END                             E1
     C*
     C**  Set action code to E, only if action code is not X
     C           DDACTN    IFNE 'X'                        B1
     C                     MOVE 'E'       DDACTN           *1
     C                     END                             E1
     C*
     C**  If the key field has changed or is blank, set file pointer
     C**  using key.  Which file depends on whether an authorisation
     C**  is to be performed or not.
     C           DDDLNO    IFNE @DLNO                      B1
     C           DDDLNO    OREQ *BLANKS                    *1
     C           DDACTN    IFEQ 'X'                        B*2
     C           @DLKEY    SETLLMMCMPLLL                   **2
     C                     ELSE                            X*2
     C           @DLKEY    SETLLMMCARDLL                   **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  If the action code has changed from the last F8 or F7
     C**  then setgt on the new file
     C           DDACTN    IFNE @ACTN                      B1
     C           DDDLNO    ANDNE*BLANKS                    B1
     C           DDDLNO    ANDEQ@DLNO                      B1
     C           DDACTN    IFEQ 'X'                        B*2
     C           @DLKEY    SETGTMMCMPLLL                   **2
     C                     ELSE                            X*2
     C           @DLKEY    SETGTMMCARDLL                   **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  If the key field is the same, and *IN71 is on, the beginning
     C**  of the file was passed whilst the first record was displayed.
     C**  Set the file pointer to read the second record.
     C           @DLNO     IFEQ DDDLNO                     B1
     C           *IN71     ANDEQ'1'                        B1
     C           DDACTN    IFEQ 'X'                        B*2
     C           @DLKEY    SETGTMMCMPLLL                   **2
     C                     ELSE                            X*2
     C           @DLKEY    SETGTMMCARDLL                   **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  Read the next record on file
     C*
     C**  Read records until valid record found.
     C/COPY WNCPYSRC,MM0089C417
     C           *IN70     DOUEQ'1'                        B1
     C           HKDLTF    OREQ *BLANKS                    B1
     C           ERR       ANDEQ*ZERO                      *1             S01117
     C           DDACTN    IFEQ 'X'                        B*2
     C                     READ MMCMPLLL                 70**2
     C                     ELSE                            X*2
     C                     READ MMCARDLL                 70**2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C513
      *                                                                   S01117
      ** Must also check for user authority to branch in mb system        S01117
     C           @MBIN     IFEQ 'Y'                        B*2            S01117
      *                                                                   S01117
      ** check booking branch, always use action code of 'E'              S01117
     C                     CALL 'ZVACTBU'                  **2            S01117
     C                     PARM 'E'       ZACTN            **2            S01117
     C                     PARM           HKBRCA           **2            S01117
     C                     PARM           ERR              **2            S01117
      *                                                                   S01117
      ** if originating branch used and no errors from prev               S01117
     C*****      OBUV      IFEQ 'Y'                        B**3     S01117S01194
     C           BKOBUV    IFEQ 'Y'                        B**3           S01194
     C           ERR       ANDEQ*ZERO                      B**3           S01117
     C                     CALL 'ZVOBU'                    ***3           S01117
     C                     PARM           HKORBR           ***3           S01117
     C                     PARM           ERR              ***3           S01117
     C                     END                             E**3           S01117
      *                                                                   S01117
      ** Must also check for user authority to action code for MBIN 'N'   S01117
     C                     ELSE                            X*2            S01117
      *                                                                   S01117
      ** check booking branch, always use action code of 'E'              S01117
     C                     CALL 'ZVACTU'                   **2            S01117
     C                     PARM 'E'       ZACTN            **2            S01117
     C                     PARM           ERR              **2            S01117
     C                     END                             E*2            S01117
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C418
     C*
     C**  If *IN70 is on then the end of the file has been reached.
     C           *IN70     IFEQ '1'                        B1
     C*
     C**  Reset the file pointer for the next read operation.
     C**  - If the key is that of the last record on file, a subsequent
     C**     F7 will read the record prior to the last record.
     C**  - If the key is beyond the last record on file, a subsequent
     C**     F7 will read the the last record.
     C           DDACTN    IFEQ 'X'                        B*2
     C           @DLKEY    SETGTMMCMPLLL                   **2
     C                     ELSE                            X*2
     C           @DLKEY    SETGTMMCARDLL                   **2
     C                     END                             E*2
     C*
     C**  If the key field is blank then no valid records exist.
     C           DDDLNO    IFEQ *BLANKS                    B*2
     C*
     C**  Set up error output for screen.
     C                     MOVEL'MMM1006' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  By-pass further  F8 processing.
     C                     GOTO #BB9                       **2
     C*
     C                     END                             E*2
     C*
     C**  Set up error output for screen.
     C                     MOVEL'MMM1002' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  By-pass further  F8 processing.
     C                     GOTO #BB9                       *1
     C*
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C410
     C*
     C**  A valid record has been read - move file fields into program
     C**  work fields and screen fields.
     C                     EXSR #ZD
     C/COPY WNCPYSRC,MM0089C083
     C*
     C**  Seton indicator to allow CMD/14 to be pressed                   S01177
     C*                                                                   109015
     C** Only for action for 'E' or 'D'                                   109015
     C*                                                                   109015
     C           DDACTN    IFEQ 'E'                                       109015
     C           DDACTN    OREQ 'D'                                       109015
     C                     MOVE 1         *IN53                           S01177
     C                     END                                            109015
     C*                                                                   109015
     C** Core hook for externalisation.                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP19                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C**  Enter has now been pressed for this deal number                 S01177
     C                     MOVE DDDLNO    DLENT                           S01177
     C/COPY WNCPYSRC,MM0089C268
     C*                                                                   S01177
      * S01227 - Set up flag for use by Extended Settlements              S01227
     C                     MOVE 'Y'       PMFRST                          S01227
      *                                                                   S01227
     C           #BB9      ENDSR                           **#BB9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #BC      -  F7 processing.                                    *
     C*                                                               *
     C* CALLS    #ZD      - Sets up screen with file values.          *
     C*          ZA0240   - Sends a msg to the program message queue. *
     C*                                                               *
     C* CALLED BY  #B     - Main processing.                          *
     C*                                                               *
     C* FLDS USED  @TEST  - Field to test numeric fields' right byte. *
     C*            @DLKEY - Numeric key to deal file.                 *
     C*            @MSGID - Message id field.                         *
     C*            @DLNO  - Stored version of DDDLNO.                 *
     C*            @ACTN  - Stored version of DDACTN.                 *
     C*                                                               *
     C*****************************************************************
     C           #BC       BEGSR
     C*
      ** Must first check user is authorised to action code 'E' if        S01117
      ** MBIN 'N'. Note MBIN 'Y' checking done later in subroutine        S01117
     C           @MBIN     IFEQ 'N'                        B1             S01117
      *                                                                   S01117
     C                     CALL 'ZVACTU'                   *1             S01117
     C                     PARM 'E'       ZACTN            *1             S01117
     C                     PARM           ERR              *1             S01117
      *                                                                   S01117
     C           ERR       IFEQ 1                          B*2            S01117
     C                     MOVE '1'       *IN01            **2            S01117
     C                     MOVE '1'       *IN41            **2            S01117
     C                     MOVEL'FXM0292' @MSGID           **2            S01117
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C                     GOTO #BC9                       **2            S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
     C                     END                             E1             S01117
     C*                                                                   S01177
     C**  Clear "F10-CONFIRM" prompt if displayed before F7 pressed       S01177
     C                     MOVE '0'       *IN42                           S01177
     C*
     C**  Validate that deal number is numeric or blank.
     C                     TESTN          DDDLNO     62
     C                     MOVE DDDLNO    @TEST
     C                     TESTZ          @TEST          73
     C*
     C**  If it is set up the file key, otherwise output an error message.
     C           DDDLNO    IFEQ *BLANKS                    B1
     C           *IN62     OREQ '1'                        B1
     C           *IN73     ANDEQ'1'                        B1
     C                     MOVE DDDLNO    @DLKEY           *1
     C                     ELSE                            X1
     C                     MOVEL'MMM0162' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE '1'       *IN11            *1
     C                     MOVE '1'       *IN41            *1
     C                     GOTO #BC9                       *1
     C                     END                             E1
     C*
     C**  Set action code to E, only if not X
     C           DDACTN    IFNE 'X'                        B1
     C                     MOVE 'E'       DDACTN           *1
     C                     END                             E1
     C*
     C**  If the key field has changed or is blank, set file pointer
     C**  using key.  Which file depends on whether an authorisation
     C**  is to be performed or not.
     C           DDDLNO    IFNE @DLNO                      B1
     C           DDDLNO    OREQ *BLANKS                    B1
     C*
     C           DDACTN    IFEQ 'X'                        B*2
     C           @DLKEY    SETLLMMCMPLLL                   **2
     C                     ELSE                            X*2
     C           @DLKEY    SETLLMMCARDLL                   **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  If the action code has changed from the last F8 or F7
     C**  then setll on the new file.
     C           DDACTN    IFNE @ACTN                      B1
     C           DDDLNO    ANDNE*BLANKS                    B1
     C           DDDLNO    ANDEQ@DLNO                      *1
     C           DDACTN    IFEQ 'X'                        B*2
     C           @DLKEY    SETLLMMCMPLLL                   **2
     C                     ELSE                            X*2
     C           @DLKEY    SETLLMMCARDLL                   **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  If the key field is the same, and *IN70 is on, the end of the
     C**  file was passed whilst the last record was displayed.
     C**  Set the file pointer to read the penultimate record.
     C           DDDLNO    IFEQ @DLNO                      B1
     C           *IN70     ANDEQ'1'                        B1
     C*
     C           DDACTN    IFEQ 'X'                        B*2
     C           @DLKEY    SETLLMMCMPLLL                   **2
     C                     ELSE                            X*2
     C           @DLKEY    SETLLMMCARDLL                   **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  Read the previous record on file
     C*
     C**  Read record previous to file pointer, until valid record found.
     C/COPY WNCPYSRC,MM0089C419
     C           *IN71     DOUEQ'1'                        B1
     C           HKDLTF    OREQ *BLANKS                    B1
     C           ERR       ANDEQ*ZERO                      *1             S01117
     C*
     C           DDACTN    IFEQ 'X'                        B*2
     C                     READPMMCMPLLL                 71**2
     C                     ELSE                            X*2
     C                     READPMMCARDLL                 71**2
     C                     END                             E*2
      *                                                                   S01117
      ** Must also check for user authority to branch in mb system        S01117
     C           @MBIN     IFEQ 'Y'                        B*2            S01117
      *                                                                   S01117
      ** check booking branch, always use action code of 'E'              S01117
     C                     CALL 'ZVACTBU'                  **2            S01117
     C                     PARM 'E'       ZACTN            **2            S01117
     C                     PARM           HKBRCA           **2            S01117
     C                     PARM           ERR              **2            S01117
      *                                                                   S01117
      ** if originating branch used and no errors from prev               S01117
     C*****      OBUV      IFEQ 'Y'                        B**3     S01117S01194
     C           BKOBUV    IFEQ 'Y'                        B**3           S01194
     C           ERR       ANDEQ*ZERO                      B**3           S01117
     C                     CALL 'ZVOBU'                    ***3           S01117
     C                     PARM HKORBR    ZOBRX            ***3           S01117
     C                     PARM           ERR              ***3           S01117
     C                     END                             E**3           S01117
      *                                                                   S01117
      ** Must also check for user authority to action code for MBIN 'N'   S01117
     C                     ELSE                            X*2            S01117
      *                                                                   S01117
      ** check booking branch, always use action code of 'E'              S01117
     C                     CALL 'ZVACTU'                   **2            S01117
     C                     PARM 'E'       ZACTN            **2            S01117
     C                     PARM           ERR              **2            S01117
     C                     END                             E*2            S01117
     C*
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C420
     C*
     C**  If *IN71 is on then the start of the file has been reached.
     C           *IN71     IFEQ '1'                        B1
     C*
     C**  Reset the file pointer for the next read operation.
     C           DDACTN    IFEQ 'X'                        B*2
     C           @DLKEY    SETLLMMCMPLLL                   **2
     C                     ELSE                            X*2
     C           @DLKEY    SETLLMMCARDLL                   **2
     C                     END                             E*2
     C*
     C**  Set up error output for screen.
     C                     MOVEL'MMM1003' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  By-pass further F7 processing.
     C                     GOTO #BC9                       *1
     C*
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C409
     C*
     C**  A valid record has been read - move file fields into program
     C**  work fields and screen fields.
     C                     EXSR #ZD
     C/COPY WNCPYSRC,MM0089C084
     C*
     C**  Seton indicator to allow CMD/14 to be pressed                   S01177
     C*                                                                   109015
     C** Only for action for 'E' or 'D'                                   109015
     C*                                                                   109015
     C           DDACTN    IFEQ 'E'                                       109015
     C           DDACTN    OREQ 'D'                                       109015
     C                     MOVE 1         *IN53                           S01177
     C                     END                                            109015
     C*                                                                   109015
     C** Core hook for externalisation.                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP19                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C**  Enter has now been pressed for this deal number                 S01177
     C                     MOVE DDDLNO    DLENT                           S01177
     C/COPY WNCPYSRC,MM0089C269
     C*                                                                   S01177
      * S01227 - Set up flag for use by Extended Settlements              S01227
     C                     MOVE 'Y'       PMFRST                          S01227
     C*                                                                   S01177
     C           #BC9      ENDSR                           **#BC9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #BA      - F12 processing.                                    *
     C*                                                               *
     C* CALLS    #ZE      - Clears all screen fields.                 *
     C*          #ZEA     - Clear standard deal                       *   E18139
     C*                                                               *
     C* CALLED BY  #B     - Main processing.                          *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #BA       BEGSR
     C*
     C**  Check whether all Screen fields blank.
     C           DDACTN    IFEQ *BLANKS                    B1
     C           DDDLNO    ANDEQ*BLANKS                    B1
     C           DDTYPE    ANDEQ*BLANKS                    B1
     C           DDSTYP    ANDEQ*BLANKS                    B1
     C/COPY WNCPYSRC,MM0089C001
     C           DDFEDF    ANDEQ*BLANKS                    B1             S01136
     C/COPY WNCPYSRC,MM0089C002
     C           DDDLDT    ANDEQ*BLANKS                    B1
     C*****      DDBRCD    ANDEQ*BLANKS                    B1             S01117
     C           DDBRCA    ANDEQ*BLANKS                    B1             S01117
     C           DDBKCD    ANDEQ*BLANKS                    B1
     C           DDBRKG    ANDEQ*BLANKS                    B1
     C           DDDADN    ANDEQ*BLANKS                    B1
     C           DDCUST    ANDEQ*BLANKS                    B1
     C           DDVDAT    ANDEQ*BLANKS                    B1
     C           DDMDAT    ANDEQ*BLANKS                    B1
     C           DDNTCE    ANDEQ*BLANKS                    B1
     C***********DDFCLY    ANDEQ*BLANKS                    B1             E25515
     C           DDACSQ    ANDEQ*BLANKS                    B1
     C           DDCCY     ANDEQ*BLANKS                    B1
     C           DDAMNP    ANDEQ*BLANKS                    B1
     C           DDBRAT    ANDEQ*BLANKS                    B1
     C           DDBSRC    ANDEQ*BLANKS                    B1
     C           DDSPRT    ANDEQ*BLANKS                    B1
     C           DDICMT    ANDEQ*BLANKS                    B1
     C           DDNGVI    ANDEQ*BLANKS                    B1
     C           DDIPFQ    ANDEQ*BLANKS                    B1
     C           DDNDAT    ANDEQ*BLANKS                    B1
     C           DDTOTI    ANDEQ*BLANKS                    B1
     C           DDIPDM    ANDEQ*BLANKS                    B1
     C           DDCPTI    ANDEQ*BLANKS                    B1
     C           DDMTAX    ANDEQ*BLANKS                    B1
     C           DDCDRF    ANDEQ*BLANKS                    B1
     C           DDCDCH    ANDEQ*BLANKS                    B1
     C           DDFUID    ANDEQ*BLANKS                    B1             S01392
     C           DDFLID    ANDEQ*BLANKS                    B1             S01392
     C           DDRDFC    ANDEQ*BLANKS                    B1             S01392
     C*****      DDORCM    ANDEQ*BLANKS                    B1             S01177
     C*****      DDMOPM    ANDEQ*BLANKS                    B1             S01177
     C*****      DDMORI    ANDEQ*BLANKS                    B1             S01177
     C*****      DDMOPI    ANDEQ*BLANKS                    B1             S01177
     C*****      DDMCPI    ANDEQ*BLANKS                    B1             S01177
     C*****      DDMCRI    ANDEQ*BLANKS                    B1             S01177
     C*****      DDMFAO    ANDEQ*BLANKS                    B1             S01177
     C*****      DDSPEC    ANDEQ*BLANKS                    B1             S01177
     C           DDBOKC    ANDEQ*BLANKS                    B1             S01165
     C           DDLNKN    ANDEQ*BLANKS                    B1             S01165
     C           DDORBR    ANDEQ*BLANKS                    B1             S01117
     C           DDPRFC    ANDEQ*BLANKS                    B1             S01117
     C           DDDRID    ANDEQ*BLANKS                    B1             S01176
     C           DDDDMR    ANDEQ*BLANKS                    B1             S01176
     C           DDRACD    ANDEQ*BLANKS                    B1             AUS007
     C           DDAURO    ANDEQ*BLANKS                                   S01434
     C           DDIPDS    ANDEQ*BLANKS                                   S01434
     C           DDROFQ    ANDEQ*BLANKS                                   S01434
     C           DDRLDN    ANDEQ*BLANKS                                   S01434
     C           DDIMET    ANDEQ*BLANKS                                   S01434
     C           DDINSA    ANDEQ*BLANKS                                   S01434
     C           DDINSN    ANDEQ*BLANKS                                   S01434
     C           DDINOS    ANDEQ*BLANKS                                   S01434
     C           DDCNNA    ANDEQ*BLANKS                                   S01434
     C           DDISCY    ANDEQ*BLANKS                                   CEU003
     C           DDII72    ANDEQ*BLANKS                                   CEU003
     C*
     C**  If they are, cease main processing by setting *INKC on.
     C                     MOVE '1'       *INKC            *1
     C*
     C**  Otherwise, blank out all input capable screen fields.
     C                     ELSE                            X1
     C*
     C                     EXSR #ZE                        *1
      *                                                                   E18139
      **  And standard deal fields                                        E18139
     C                     EXSR #ZEA                       *1             E18139
     C*
      * S01227 - Set up flag for use by Extended Settlements              S01227
     C                     MOVE 'Y'       PMFRST                          S01227
     C/COPY WNCPYSRC,MM0089C158
      *                                                                   CAC001
      **  Reset indicator that signifies action code is 'E' or 'D'        CAC001
      *                                                                   CAC001
     C                     MOVE '0'       *IN89                           CAC001
     C*
     C                     END                             E1
     C*
     C/COPY WNCPYSRC,MM0089C196
     C           #BA9      ENDSR                           **#BA9**
      /EJECT
     C*****************************************************************   S01177
     C*                                                               *   S01177
     C* #BE      - CF14processing                                     *   S01177
     C*                                                               *   S01177
     C* CALLS      #BEA   - Screen 2 insert processing                *   S01177
     C*            #BEB   - Screen 2 amend  processing                *   S01177
     C*            #BEC   - Screen 2 enquireprocessing                *   S01177
     C*            #BED   - Screen 2 authorise processing             *   S01177
     C*            #BEF   - Screen 2 initial validation               *   S01177
     C*            #ZK    - Set up date of payment and receipt        *   S01177
     C*                                                               *   S01177
     C* CALLED BY  #B     - Main processing;handles screen processing *   S01177
     C*            #BDA   - Enter processing for action code I        *   S01177
     C*                                                               *   S01177
     C* FLDS USED         -                                           *   S01177
     C*                                                               *   S01177
     C*****************************************************************   S01177
     C           #BE       BEGSR                                          S01177
     C*                                                                   S01177
     C** If Deal number has been changed on first screen but enter has    S01177
     C*    not been pressed to update screen fields do not allow          S01177
     C*    CMD/14 processing unless inselect screen processing.           S01177
     C           DDDLNO    IFNE DLENT                                     S01177
     C           *IN45     ANDEQ'0'                                       S01177
     C*********************MOVEL'MMM1041' @MSGID                S01177    S01227
     C                     MOVEL'MMM1043' @MSGID                          S01227
     C                     CALL 'ZA0240'                                  S01177
     C                     PARM           @MSGID                          S01177
     C                     GOTO #BE9                                      S01177
     C                     END                                            S01177
     C/COPY WNCPYSRC,MM0089C270
     C*                                                                   S01177
     C** If action code is insert, amend or authorise do primary          S01177
     C**   validation on first screen fields to be passed to              S01177
     C**      parameters                                                  S01177
     C           DDACTN    IFEQ 'I'                                       S01177
     C           DDACTN    OREQ 'A'                                       S01177
     C           DDACTN    OREQ 'X'                                       S01177
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP20                                           S01408
     C*                                                                   S01408
     C           DDACTN    OREQ ' '                                       S01177
     C                     EXSR #BEF                                      S01177
     C                     END                                            S01177
     C*                                                                   S01177
     C***If*deal*number*entered*does*not*match*that*currently*in*parS01177S01227
     C*****then*this*is*first*time*in*for*this*deal*****************S01177S01227
     C***********DDDLNO    IFNE @SAVD                               S01177S01227
     C***********          MOVE 'Y'       PMFRST                    S01177S01227
     C***********          MOVE DDDLNO    @SAVD   6                 S01177S01227
     C***********          ELSE                                     S01177S01227
     C***********                                                   S01177S01227
     C***Parmameters*will*already*be*set*up*************************S01177S01227
     C***********                                                   S01177S01227
     C***********          MOVE 'N'       PMFRST                    S01177S01227
     C***********          END                                      S01177S01227
     C*                                                                   S01177
     C** Set up parameters for call to SETTLEMENT SCREEN                  S01177
     C*                                                                   S01177
     C                     MOVE DDACTN    PMACTC                          S01177
     C                     MOVE 'MMLD'    PMCPGM                          S01177
     C                     MOVE DDTYPE    PMTTYP                          S01177
     C                     MOVE DDCUST    PMCSNM                          S01177
     C                     MOVE DDCCY     PMRCCY                          S01177
     C                     MOVE DDCCY     PMPCCY                          S01177
     C/COPY WNCPYSRC,MM0089C003
     C                     MOVE DDFEDF    PMFFND                          S01177
     C/COPY WNCPYSRC,MM0089C004
     C                     MOVE DDBRCA    PMBRCA                          S01177
     C                     MOVE *BLANKS   PMCMDP                          S01177
     C*                                                                   S01177
     C** Set up Date of Payment and Receipt                               S01177
     C                     EXSR #ZK                                       S01177
     C*                                                                   S01177
     C*  If any invalid fields found bypass screen 2 processing and       S01177
     C*    return to first screen                                         S01177
     C*  IF *IN11 OR *IN12 ARE NOT WARNING MESSAGES (IE. *IN55 = *OFF)    072529
     C*  THEN SKIP SCREEN 2 PROCESSING, OTHERWISE PERFORM SETTLEMENT      072529
     C*  SCREEN DISPLAY.                                                  072529
     C*                                                                   S01177
     C           DDACTN    IFNE 'X'                                       082290
     C           *IN10     IFEQ '1'                                       S01177
     C/COPY WNCPYSRC,MM0089C524
     C************IN11     OREQ '1'                                 S01177E16048
     C           *IN12     OREQ '1'                                       S01177
     C           *IN55     ANDEQ'0'                                       072529
     C           *IN41     ANDEQ'1'                                       E24193
     C           *IN16     OREQ '1'                                       S01177
     C           *IN11     OREQ '1'                                       E16048
     C           *IN55     ANDEQ'0'                                       072529
     C           *IN41     ANDEQ'1'                                       E16048
     C/COPY WNCPYSRC,MM0089C399
     C                     GOTO #BE9                                      S01177
     C                     END                                            S01177
     C                     END                                            082290
     C*                                                                   S01177
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP21                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C** Process according to action code                                 S01177
     C*                                                                   S01177
     C**  - If the action code is I, process SR #BEA.                     S01177
     C           DDACTN    CASEQ'I'       #BEA                            S01177
     C*                                                                   S01177
     C**  - If the action code is A, process SR #BEB.                     S01177
     C           DDACTN    CASEQ'A'       #BEB                            S01177
     C*                                                                   S01177
     C**  - If the action code is E or D, process SR #BEC.                S01177
     C           DDACTN    CASEQ'D'       #BEC                            S01177
     C           DDACTN    CASEQ'E'       #BEC                            S01177
     C*                                                                   S01177
     C**  - If the action code is X, process SR #BED.                     S01177
     C           DDACTN    CASEQ'X'       #BED                            S01177
     C*                                                                   S01177
     C                     END                                            S01177
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP22                                           S01408
     C*                                                                   S01408
     C*                                                                   E24039
     C** Check whether deal is deposit or loan                            E24039
     C** (receipts side is start side or not)                             E24039
     C*                                                                   E24039
     C           *LOCK     IN   LDA                                       E24039
     C                     MOVE '0'       RCVSTR                          E24039
     C*                                                                   E24039
     C** If deal is a deposit                                             E24039
     C*                                                                   E24039
     C           DDTYPE    IFEQ 'IT'                                      E24039
     C           DDTYPE    OREQ 'TD'                                      E24039
     C           DDTYPE    OREQ 'CI'                                      E24039
     C           DDTYPE    OREQ 'CD'                                      E24039
     C*                                                                   E24039
     C** Then receipts side is Start Side                                 E24039
     C*                                                                   E24039
     C                     MOVE '1'       RCVSTR                          E24039
     C                     END                                            E24039
     C                     OUT  LDA                                       E24039
     C*                                                                   S01177
     C***********@TERM1    IFEQ 'R'                                       S01434
     C***********@DLKEY    CHAINMMDEAULL             72                   S01434
     C***********HKBSRC    IFEQ *ZEROS                     B1             S01434
     C***********          MOVE *BLANKS   DDBSRC           *1             S01434
     C***********          MOVE *BLANKS   @BSRC            *1             S01434
     C***********          ELSE                            X1             S01434
     C***********          MOVE HKBSRC    DDBSRC           *1             S01434
     C***********          MOVE DDBSRC    @BSRC            *1             S01434
     C***********          END                             E1             S01434
     C***********@BSRC     IFEQ *BLANKS                    B1             S01434
     C***********HKIIRT    IFLT 0                          B*2            S01434
     C***********          Z-SUBHKIIRT    HKIIRT           **2            S01434
     C***********          END                             E*2            S01434
     C***********          MOVE HKIIRT    @@AMTW           *1             S01434
     C***********          ELSE                            X1             S01434
     C***********HKSPRD    IFLT 0                          B*2            S01434
     C***********          Z-SUBHKSPRD    HKSPRD           **2            S01434
     C***********          END                             E*2            S01434
     C***********          MOVE HKSPRD    @@AMTW           *1             S01434
     C***********          END                             E1             S01434
     C***********          Z-ADD7         @@QECN                          S01434
     C***********          EXSR ZA0920                                    S01434
     C***********          MOVE @@AMTD    DDSPRT                          S01434
     C***********          MOVE @@AMTD    @SPRT                           S01434
     C***********HKMTTI    IFLT 0                          B1             S01434
     C***********          Z-SUBHKMTTI    @@AMTW           *1             S01434
     C***********          ELSE                            X1             S01434
     C***********          Z-ADDHKMTTI    @@AMTW           *1             S01434
     C***********          END                             E1             S01434
     C***********          Z-ADDHKCYDP    @@QECN                          S01434
     C***********          EXSR ZA0920                                    S01434
     C***********          MOVE @@AMTD    DDTOTI                          S01434
     C***********          MOVE @@AMTD    @TOTI                           S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CVSR                                           S01408
     C*                                                                   S01408
     C** Call settlement screen validation program                        S01177
     C*****                CALL 'SDKTPVR'                     S01227S01177E214
     C                     CALL 'SD2400'                                  S01227
     C                     PARM           @PARM1  7                       S01177
     C                     PARM           @PARM2                          S01177
     C                     PARM           @PARM3                          S01177
     C                     PARM           DDDLNO                          BHF488
     C                     PARM           WDUMMY                          CEU003
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CSFI                                           S01408
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP18                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C** Terminate program if database error returned                     S01177
     C*                                                                   S01177
     C           PMDBSE    IFNE *ZERO                                     S01177
     C                     MOVE '1'       *INLR            *1             S01177
     C                     MOVE '1'       *INU7            *1             S01177
     C                     MOVE '1'       *INU8            *1             S01177
     C                     MOVE '1'       *INKC            ***************S01177
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVELPMDBFL    DBFILE           * DBERROR 028 *S01177
     C                     MOVE PMDBSE    DBASE            ***************S01177
     C                     MOVELPMDBKY    DBKEY            *1             S01177
     C                     MOVELPMDPGM    DBPGM            *1             S01177
     C                     OUT  LDA                                       E24039
     C                     GOTO #BE9                       *1             S01177
     C                     END                             E1             S01177
     C/COPY WNCPYSRC,MM0089C298
     C*                                                                   S01177
     C*                                                                   S01177
     C** Check if command key entered from screen 2                       S01177
     C*                                                                   S01177
     C           PMCMDP    IFEQ '12'                                      S01177
     C                     MOVE '1'       *INKL                           S01177
     C                     MOVE 'N'       PMSDTV                          S01177
     C                     END                                            S01177
     C*                                                                   S01177
     C           PMCMDP    IFEQ '03'                                      S01177
     C                     MOVE '1'       *INKC                           S01177
     C                     END                                            S01177
     C*                                                                   S01177
      * S01227 - Set flag to show F14 processing executed.                S01227
     C                     MOVE 'N'       PMFRST                          S01227
      *                                                                   S01227
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CCP7                                           S01408
      *                                                                   S01408
     C           #BE9      ENDSR                           **#BE9**       S01177
     C*                                                                   S01177
      /EJECT                                                              S01177
     C*****************************************************************   S01177
     C*                                                               *   S01177
     C* #BEA     - Screen 2 insert processing                         *   S01177
     C*                                                               *   S01177
     C* CALLS                                                         *   S01177
     C*                                                               *   S01177
     C* CALLED BY  #BE    - CF14processing                            *   S01177
     C*                                                               *   S01177
     C* FLDS USED         -                                           *   S01177
     C*                                                               *   S01177
     C*****************************************************************   S01177
     C           #BEA      BEGSR                                          S01177
     C*                                                                   S01177
     C** Set parameters to allow update and validation of settlement      S01177
     C**   fields                                                         S01177
     C                     MOVE 'N'       PMSDTV                          S01177
     C                     MOVE 'N'       PMPRCV                          S01177
     C                     MOVE 'N'       PMPPAY                          S01177
     C***********DDACTN****IFEQ 'A'                                 LN1143DT0009
     C*********************                                         BHF367DT0009
     C***********BJRDNB****IFGT @@VDAT                     B*1      BHF367DT0009
     C***********BJRDNB****ANDNEORED                       B*1      BHF367DT0009
     C***********DDTYPE****IFEQ 'IT'                       B**2     BHF367DT0009
     C***********DDTYPE****OREQ 'TD'                       B**2     BHF367DT0009
     C***********DDTYPE****OREQ 'CI'                       B**2     BHF367DT0009
     C***********DDTYPE****OREQ 'CD'                       B**2     BHF367DT0009
     C*********************MOVE 'Y'       PMPRCV                    BHF367DT0009
     C*********************END                             E**2     BHF367DT0009
     C*********************                                         BHF367DT0009
     C***********DDTYPE****IFEQ 'IP'                       B**2     BHF367DT0009
     C***********DDTYPE****OREQ 'TI'                       B**2     BHF367DT0009
     C***********DDTYPE****OREQ 'LN'                       B**2     BHF367DT0009
     C***********DDTYPE****OREQ 'CL'                       B**2     BHF367DT0009
     C***********DDTYPE****OREQ 'DL'                       B**2     BHF367DT0009
     C*********************MOVE 'Y'       PMPPAY                    BHF367DT0009
     C*********************END                             E**2     BHF367DT0009
     C*********************END                             E*1      BHF367DT0009
     C*********************END                                      LN1143DT0009
     C*********************                                         BHF367DT0009
     C*                                                                   S01177
     C** If this is not the first time in for this deal show already      S01177
     C**   invalidated fields highlighted                                 S01177
     C/COPY WNCPYSRC,MM0089C159
     C           PMFRST    IFEQ 'N'                                       S01177
     C                     MOVE 'Y'       PMVALO                          S01177
     C*                                                                   S01177
     C                     ELSE                                           S01177
     C                     MOVE 'N'       PMVALO                          S01177
     C*                                                                   S01177
     C** New deal insert so blank out parameters                          S01177
     C                     MOVE *ZEROS    PMRSTM                          S01177
     C                     MOVE *BLANKS   PMRONS                          S01177
     C                     MOVE *BLANKS   PARIBN                          S01177
     C                     MOVE *BLANKS   PMRIBN                          S01177
     C                     MOVE *BLANKS   PMRIBA                          S01177
     C                     MOVE *BLANKS   PAROBN                          S01177
     C                     MOVE *BLANKS   PMROBN                          S01177
     C                     MOVE *BLANKS   PAROCN                          S01177
     C                     MOVE *BLANKS   PMROCN                          S01177
     C                     MOVE *ZEROS    PMPSTM                          S01177
     C                     MOVE *BLANKS   PMPONS                          S01177
     C                     MOVE *BLANKS   PAPIBN                          S01177
     C                     MOVE *BLANKS   PMPIBN                          S01177
     C                     MOVE *BLANKS   PMPIBA                          S01177
     C                     MOVE *BLANKS   PAPOBN                          S01177
     C                     MOVE *BLANKS   PMPOBN                          S01177
     C                     MOVE *BLANKS   PAPOCN                          S01177
     C                     MOVE *BLANKS   PMPOCN                          S01177
     C                     MOVE *BLANKS   PARCRN                          S01177
     C                     MOVE *BLANKS   PMRCRN                          S01177
     C                     MOVE *BLANKS   PMRCRA                          S01177
     C                     MOVE *BLANKS   PARVNO                          S01177
     C                     MOVE *BLANKS   PMRVNO                          S01177
     C                     MOVE *BLANKS   PAAWBN                          S01177
     C                     MOVE *BLANKS   PMAWBN                          S01177
     C                     MOVE *BLANKS   PMAWBA                          S01177
     C                     MOVE *BLANKS   PABENN                          S01177
     C                     MOVE *BLANKS   PMBENN                          S01177
     C                     MOVE *BLANKS   PMBENA                          S01177
     C                     MOVE *BLANKS   PMDTP1                          S01177
     C                     MOVE *BLANKS   PMDTP2                          S01177
     C                     MOVE *BLANKS   PMDTP3                          S01177
     C                     MOVE *BLANKS   PMDTP4                          S01177
     C                     MOVE *BLANKS   PMDCHG                          S01177
     C                     MOVE *BLANKS   PMBTB1                          S01177
     C                     MOVE *BLANKS   PMBTB2                          S01177
     C                     MOVE *BLANKS   PMBTB3                          S01177
     C                     MOVE *BLANKS   PMBTB4                          S01177
     C                     MOVE *BLANKS   PMBTB5                          S01177
     C                     MOVE *BLANKS   PMBTB6                          S01177
     C                     MOVE *BLANKS   PMCVMR                          E22405
     C                     MOVE *BLANKS   PMROBR                          S01117
     C                     MOVE *BLANKS   PMPOBR                          S01117
     C*                                                                   CEU003
     C                     MOVE *BLANKS   PMRSCY                          CEU003
     C                     MOVE *BLANKS   PMPSCY                          CEU003
     C                     MOVE *BLANKS   PMIC72                          CEU003
     C                     MOVE *BLANKS   PMIERI                          CEU003
     C*                                                                   S01177
     C                     END                                            S01177
     C*                                                                   S01177
     C           #BEA9     ENDSR                           **#BEA9**      S01177
      /EJECT                                                              S01177
     C*****************************************************************   S01177
     C*                                                               *   S01177
     C* #BEB     - Screen 2 amend  processing                         *   S01177
     C*                                                               *   S01177
     C* CALLS                                                         *   S01177
     C*                                                               *   S01177
     C* CALLED BY  #BE    - CF14processing                            *   S01177
     C*                                                               *   S01177
     C* FLDS USED         -                                           *   S01177
     C*                                                               *   S01177
     C*****************************************************************   S01177
     C           #BEB      BEGSR                                          S01177
     C*                                                                   S01177
     C** Set parameters to allow update and validation of settlement      S01177
     C**   fields                                                         S01177
     C                     MOVE 'N'       PMSDTV                          S01177
     C                     MOVE 'N'       PMPRCV                          S01177
     C                     MOVE 'N'       PMPPAY                          S01177
     C*                                                                   DT0009
     C                     Z-ADDHKVDYY    @YEAR                           BHF861
     C                     Z-ADDHKVDMM    @MNTH                           BHF861
     C                     Z-ADDHKVDDD    @DAY                            BHF861
     C***********          Z-ADD@DATE     @@DTIN                    BHF861056095
     C***********          EXSR ZA0680                              BHF861056095
     C***********          Z-ADD@@MDNO    @@VDAT                    BHF861056095
     C                     Z-ADD@DATE     ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    @@VDAT                          056095
     C*                                                                   BHF861
     C                     Z-ADDHKDTYY    @YEAR                           BHF861
     C                     Z-ADDHKDTMM    @MNTH                           BHF861
     C                     Z-ADDHKDTDD    @DAY                            BHF861
     C***********          Z-ADD@DATE     @@DTIN                    BHF861056095
     C***********          EXSR ZA0680                              BHF861056095
     C***********          Z-ADD@@MDNO    @@ORED  50                BHF861056095
     C                     Z-ADD@DATE     ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    @@ORED  50                      056095
     C*                                                                   BHF861
     C           BJRDNB    IFGT @@VDAT                     B*1            DT0009
     C********** BJRDNB    ANDNEORED                       B*1      DT0009BHF861
     C           BJRDNB    ANDNE@@ORED                     B*1            BHF861
     C           DDTYPE    IFEQ 'IT'                       B**2           DT0009
     C           DDTYPE    OREQ 'TD'                       B**2           DT0009
     C           DDTYPE    OREQ 'CI'                       B**2           DT0009
     C           DDTYPE    OREQ 'CD'                       B**2           DT0009
     C                     MOVE 'Y'       PMPRCV                          DT0009
     C                     END                             E**2           DT0009
     C*                                                                   DT0009
     C           DDTYPE    IFEQ 'IP'                       B**2           DT0009
     C           DDTYPE    OREQ 'TI'                       B**2           DT0009
     C           DDTYPE    OREQ 'LN'                       B**2           DT0009
     C           DDTYPE    OREQ 'CL'                       B**2           DT0009
     C           DDTYPE    OREQ 'DL'                       B**2           DT0009
     C                     MOVE 'Y'       PMPPAY                          DT0009
     C                     END                             E**2           DT0009
     C                     END                             E*1            DT0009
     C*                                                                   CEU003
     C           WINCY     IFEQ 'Y'                                       CEU003
     C           DDCCY     OREQ BKEURO                                    CEU003
     C           CEU003    ANDEQ'Y'                                       CEU003
     C                     MOVEL'N'       PMPRCV                          CEU003
     C                     MOVEL'N'       PMPPAY                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   S01177
     C** If this is not the first time in for this deal show already      S01177
     C**   invalidated fields highlighted                                 S01177
     C           PMFRST    IFEQ 'N'                                       S01177
     C                     MOVE 'Y'       PMVALO                          S01177
     C*                                                                   S01177
     C                     ELSE                                           S01177
     C                     MOVE 'N'       PMVALO                          S01177
     C*                                                                   S01177
     C                     END                                            S01177
     C/COPY WNCPYSRC,MM0089C491
     C*                                                                   S01177
     C**  - If amend, check if deal customer has been changed             087755
     C           DDACTN    IFEQ 'A'                                       087755
     C           DDCUST    ANDNE@SAVCU                                    087755
     C                     MOVE 'Y'       PMFRST                          087755
     C                     MOVE DDCUST    @SAVCU                          087755
     C                     MOVE 'I'       PMACTC                          087755
     C                     END                                            087755
     C*                                                                   087755
     C           #BEB9     ENDSR                           **#BEB9**      S01177
      /EJECT                                                              S01177
     C*****************************************************************   S01177
     C*                                                               *   S01177
     C* #BEC     - Screen 2 enquiry processing                        *   S01177
     C*                                                               *   S01177
     C* CALLS                                                         *   S01177
     C*                                                               *   S01177
     C* CALLED BY  #BE    - CF14processing                            *   S01177
     C*                                                               *   S01177
     C* FLDS USED         -                                           *   S01177
     C*                                                               *   S01177
     C*****************************************************************   S01177
     C           #BEC      BEGSR                                          S01177
     C*                                                                   S01177
     C** Set parameters to protect settlement fields , no validation      S01177
     C                     MOVE 'Y'       PMSDTV                          S01177
     C                     MOVE 'N'       PMVALO                          S01177
     C                     MOVE 'Y'       PMPRCV                          S01177
     C                     MOVE 'Y'       PMPPAY                          S01177
     C*                                                                   S01177
     C*                                                                   S01177
     C           #BEC9     ENDSR                           **#BEC9**      S01177
      /EJECT                                                              S01177
     C*****************************************************************   S01177
     C*                                                               *   S01177
     C* #BED     - Screen 2 authorisation processing                  *   S01177
     C*                                                               *   S01177
     C* CALLS                                                         *   S01177
     C*                                                               *   S01177
     C* CALLED BY  #BE    - CF14processing                            *   S01177
     C*                                                               *   S01177
     C* FLDS USED         -                                           *   S01177
     C*                                                               *   S01177
     C*****************************************************************   S01177
     C           #BED      BEGSR                                          S01177
     C*                                                                   S01177
     C** Set parameters to protect settlement fields , but allow          S01177
     C**   validation                                                     S01177
     C                     MOVE 'N'       PMSDTV                          S01177
     C                     MOVE 'Y'       PMVALO                          S01177
     C                     MOVE 'Y'       PMPRCV                          S01177
     C                     MOVE 'Y'       PMPPAY                          S01177
     C*                                                                   S01177
     C           #BED9     ENDSR                           **#BED9*       S01177
      /EJECT                                                              S01177
     C*****************************************************************   S01177
     C*                                                               *   S01177
     C* #BEF              - Screen 2 initial validation               *   S01177
     C*                                                               *   S01177
     C* CALLS                                                         *   S01177
     C*                                                               *   S01177
     C* CALLED BY  #BE    - CF14 processing                           *   S01177
     C*                                                               *   S01177
     C* FLDS USED         -                                           *   S01177
     C*                                                               *   S01177
     C*****************************************************************   S01177
     C           #BEF      BEGSR                                          S01177
     C*                                                                   S01177
     C*                                                                   S01177
     C*  *------------------------*                                       S01177
     C*  * Validate Customer      *                                       S01177
     C*  *------------------------*                                       S01177
     C*                                                                   S01177
     C**  The Customer is not amendable for R and A status deals,         S01177
     C**  and is only amendable for status C if this is indicated on      S01177
     C**  MMCDAFLL.                                                       S01177
     C/COPY WNCPYSRC,MM0089C411
     C           DDACTN    IFEQ 'A'                        B1             S01177
     C           @DSTS     ANDEQ'C'                        B1             S01177
     C           HHCNMA    ANDEQ'N'                        B1             S01177
     C           DDCUST    ANDNE@CUST                      B1             S01177
     C/COPY WNCPYSRC,MM0089C445
     C           DDACTN    OREQ 'A'                        B1             S01177
     C           @DSTS     ANDNE'C'                        B1             S01177
     C           DDCUST    ANDNE@CUST                      B1             S01177
     C/COPY WNCPYSRC,MM0089C478
     C                     MOVE @CUST     DDCUST           *1             S01177
     C/COPY WNCPYSRC,MM0089C479
     C                     MOVE '1'       *IN10            *1             S01177
     C                     MOVE '1'       *IN41            *1             S01177
     C/COPY WNCPYSRC,MM0089C228
     C           @DSTS     IFEQ 'C'                        B*2            S01177
     C                     MOVEL'MMM0384' @MSGID           **2            S01177
     C                     ELSE                            X*2            S01177
     C                     MOVEL'MMM0385' @MSGID           **2            S01177
     C                     END                             E*2            S01177
     C                     CALL 'ZA0240'                   *1             S01177
     C                     PARM           @MSGID           *1             S01177
     C*                                                                   S01177
     C**  Check whether the field is blank - if so and the status will    S01177
     C**  not be complete, or if the status will be complete and the      S01177
     C**  field is defined as mandatory entry on MMMCOMLL, this is an     S01177
     C**  error.                                                          S01177
     C                     ELSE                            X1             S01177
     C           @STS      IFEQ 'C'                        B*2            S01177
     C           ICCNMM    ANDNE'N'                        B*2            S01177
     C           DDCUST    ANDEQ*BLANKS                    B*2            S01177
     C           @STS      ORNE 'C'                        B*2            S01177
     C           DDCUST    ANDEQ*BLANKS                    B*2            S01177
     C                     MOVE '1'       *IN10            **2            S01177
     C                     MOVE '1'       *IN41            **2            S01177
     C                     MOVEL'MMM0204' @MSGID           **2            S01177
     C                     CALL 'ZA0240'                   **2            S01177
     C                     PARM           @MSGID           **2            S01177
     C                     END                             E*2            S01177
     C*                                                                   S01177
     C**  If the input is not blank, validate it.                         S01177
     C           DDCUST    IFNE *BLANKS                    B*2            S01177
     C*****                                                         S01177S01194
     C****Check if the input is numeric.                            S01177S01194
     C*****                MOVE *BLANKS   @@ALPH           **2      S01177S01194
     C*****                Z-ADD0         @@IDP            **2      S01177S01194
     C*****                Z-ADD6         @@IINT           **2      S01177S01194
     C*****                MOVE DDCUST    @@ALPH           **2      S01177S01194
     C*****                EXSR ZA0840                     **2      S01177S01194
     C*****                                                         S01177S01194
     C****If ZA0840 returns no errors, the result will be treated   S01177S01194
     C****as a customer number, else it will be a shortname.        S01177S01194
     C*****      @@ERCD    IFEQ 0                          B**3     S01177S01194
     C*****                Z-ADD@@AMT     @CNUM            ***3     S01177S01194
     C*****      @CLTKY    CHAINCLINT                65    ***3     S01177S01194
     C*****      *IN65     IFEQ '1'                        B***4    S01177S01194
     C*****      RECI      OREQ '*'                        B***4    S01177S01194
     C*****                MOVE '1'       *IN10            ****4    S01177S01194
     C*****                MOVE '1'       *IN41            ****4    S01177S01194
     C*****                MOVEL'MMM0205' @MSGID           ****4    S01177S01194
     C*****                CALL 'ZA0240'                   ****4    S01177S01194
     C*****                PARM           @MSGID           ****4    S01177S01194
     C*****                END                             E***4    S01177S01194
     C*****                ELSE                            X**3     S01177S01194
     C*****      DDCUST    CHAINSNAME                65    ***3     S01177S01194
     C*****      *IN65     IFEQ '1'                        B***4    S01177S01194
     C*****      RECI      OREQ ':'                        B***4    S01177S01194
     C*****                MOVE '1'       *IN10            ****4    S01177S01194
     C*****                MOVE '1'       *IN41            ****4    S01177S01194
     C*****                MOVEL'MMM0205' @MSGID           ****4    S01177S01194
     C*****                CALL 'ZA0240'                   ****4    S01177S01194
     C*****                PARM           @MSGID           ****4    S01177S01194
     C*****                END                             E***4    S01177S01194
     C*****                END                             E**3     S01177S01194
      **                                                                  S01194
     C                     CALL 'AOCUSTR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM DDCUST    @KEY1  10        **2            S01194
     C                     PARM *BLANKS   @KYST   7        **2            S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C***********@KYST     OREQ 'ERROR  '                  ***3     S01194BHF079
     C           @KYST     OREQ '*ERROR '                  ***3           BHF079
     C                     MOVE '1'       *IN10            ***3           S01194
     C                     MOVE '1'       *IN41            ***3           S01194
     C                     MOVEL'MMM0205' @MSGID           ***3           S01194
     C                     CALL 'ZA0240'                   ***3           S01194
     C                     PARM           @MSGID           ***3           S01194
     C                     END                             E**3           S01194
     C*                                                                   S01177
     C**  If a record was found, check that the customer is not a         S01177
     C**  parent.                                                         S01177
     C           *IN10     IFEQ '0'                        B**3           S01177
     C*********            TESTB'2'       CMIN           65***3    S01177 S01194
     C*********  *IN65     IFEQ '1'                        B***4   S01177 S01194
     C***********BBPAIN    IFEQ 'Y'                        B**3    S01194 062962
     C           BBPAIN    IFEQ 'P'                                       062962
     C                     MOVE '1'       *IN10            ****4          S01177
     C                     MOVE '1'       *IN41            ****4          S01177
     C                     MOVEL'MMM0206' @MSGID           ****4          S01177
     C                     CALL 'ZA0240'                   ****4          S01177
     C                     PARM           @MSGID           ****4          S01177
     C                     ELSE                                           E70
     C********   DDCUST    IFEQ '?'                                   E70 088263
     C                     MOVELDDCUST    CUS1ST  1                       088263
     C           CUS1ST    IFEQ '?'                                       088263
     C                     MOVELBBCUST    DDCUST                          E70
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C134                                           S01408
      *                                                                   S01408
     C                     END                                            E70
     C                     END                             E***4          S01177
     C                     END                             E**3           S01177
     C                     END                             E*2            S01177
     C                     END                             E1             S01177
     C/COPY WNCPYSRC,MM0089C005
     C*                                                                   S01177
     C*                                                                   S01177
     C*  *------------------------*                                       S01177
     C*  * Validate Value Date    *                                       S01177
     C*  *------------------------*                                       S01177
     C*                                                                   S01177
     C**  The value date may not be amended if the action code is 'A'.    S01177
     C           DDACTN    IFEQ 'A'                        B1             S01177
     C           DDVDAT    ANDNE@VDAT                      B1             S01177
     C/COPY WNCPYSRC,MM0089C446
     C                     MOVE @VDAT     DDVDAT           *1             S01177
     C                     MOVE '1'       *IN11            *1             S01177
     C                     MOVE '1'       *IN41            *1             S01177
     C                     MOVEL'MMM0386' @MSGID           *1             S01177
     C                     CALL 'ZA0240'                   *1             S01177
     C                     PARM           @MSGID           *1             S01177
     C*                                                                   S01177
     C**  The field is must be entered.                                   S01177
     C                     ELSE                            X1             S01177
     C           DDVDAT    IFEQ *BLANKS                    B*2            S01177
     C                     MOVE '1'       *IN11            **2            S01177
     C                     MOVE '1'       *IN41            **2            S01177
     C                     MOVEL'MMM0123' @MSGID           **2            S01177
     C                     CALL 'ZA0240'                   **2            S01177
     C                     PARM           @MSGID           **2            S01177
     C*                                                                   S01177
     C**  Validate that the value date is a valid date.                   S01177
     C                     ELSE                            X*2            S01177
     C                     TESTN          DDVDAT     6263  **2            S01177
     C                     MOVE DDVDAT    @TEST            **2            S01177
     C                     TESTZ          @TEST          73**2            S01177
     C           *IN62     IFEQ '1'                        B**3           S01177
     C           *IN73     ANDEQ'1'                        B**3           S01177
     C           *IN63     OREQ '1'                        B**3           S01177
     C           *IN73     ANDEQ'1'                        B**3           S01177
     C                     MOVE DDVDAT    @DAT             ***3           S01177
     C                     CALL 'ZA0270'                   ***3           S01177
     C                     PARM           @DAT             ***3           S01177
     C*****                PARM           DATF             ***3     S01177S01194
     C                     PARM           BJDFIN           ***3           S01194
     C                     PARM           @RTCDE           ***3           S01177
     C                     PARM           @VDYNO           ***3           S01177
     C                     END                             E**3           S01177
     C*                                                                   S01177
     C**  If the return code is 1 then the input date is invalid or       S01177
     C**  non-numeric.                                                    S01177
     C           @RTCDE    IFEQ '1'                        B**3           S01177
     C           *IN73     OREQ '0'                        B**3           S01177
     C           *IN62     OREQ '0'                        B**3           S01177
     C           *IN63     ANDEQ'0'                        B**3           S01177
     C                     MOVE '1'       *IN11            ***3           S01177
     C                     MOVE '1'       *IN41            ***3           S01177
     C                     MOVEL'MMM0125' @MSGID           ***3           S01177
     C                     CALL 'ZA0240'                   ***3           S01177
     C                     PARM           @MSGID           ***3           S01177
     C                     ELSE                                           077469
     C*                                                                   077469
     C**  Check if value date is within back-value peroid                 077469
     C*                                                                   077469
     C           BJRDNB    SUB  BJBVPD    BVDYNO  50                      077469
     C           @VDYNO    IFLT BVDYNO                                    077469
     C           DDACTN    ANDEQ'I'                                       135093
     C                     MOVE '1'       *IN11                           077469
     C                     MOVE '1'       *IN41                           077469
     C                     MOVEL'MMM2625' @MSGID                          077469
     C                     CALL 'ZA0240'                                  077469
     C                     PARM           @MSGID                          077469
     C                     END                                            077469
     C                     END                             E**3           S01177
     C                     END                             E*2            S01177
     C                     END                             E1             S01177
     C*                                                                   S01177
     C*                                                                   S01177
     C*  *------------------------*                                       S01177
     C*  * Validate Maturity Date *                                       S01177
     C*  *------------------------*                                       S01177
      *                                                                   CEU015
      *  Check if this is an amendment of a deal denominated in an        CEU015
      *  'in' currency and the transition start date of such currency     CEU015
      *  is today or in the past.                                         CEU015
      *                                                                   CEU015
      **  Initialise In-currency-start-indicator                          CEU015
     C                     MOVE *BLANKS   @@ICST  1                       CEU015
      *                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           DDACTN    ANDEQ'A'                                       CEU015
      *                                                                   CEU015
      *  access currency file                                             CEU015
      *  (database error handling done in access program)                 CEU015
     C                     CALL 'AOCURRR0'                                CEU015
     C                     PARM '*DBERR ' @RTCD   7                       CEU015
     C                     PARM '*KEY   ' @OPTN   7                       CEU015
     C                     PARM DDCCY     @AJCD   3                       CEU015
     C           SDCURR    PARM SDCURR    DSSDY                           CEU015
      *                                                                   CEU015
     C           A6INCY    IFEQ 'Y'                                       CEU015
     C           A6TPSD    ANDLEBJRDNB                                    CEU015
     C                     MOVE 'Y'       @@ICST                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C           @@ICST    IFNE 'Y'                                       CEU015
     C*                                                                   S01177
     C**  The maturity date may only be changed if the deal has been      S01177
     C**  authorised, and the rundate is after the deal input date.       S01177
     C           DDACTN    IFEQ 'A'                        B1             E21612
     C           BJRDNB    ANDLE@TDYNO                     B1             E21612
     C           DDMDAT    ANDNE@MDAT                      B1             E21612
     C/COPY WNCPYSRC,MM0089C447
     C                     MOVE '1'       *IN12            *1             E21612
     C                     MOVE '1'       *IN41            *1             E21612
     C                     MOVEL'MMM0583' @MSGID           *1             E21612
     C                     CALL 'ZA0240'                   *1             E21612
     C                     PARM           @MSGID           *1             E21612
     C                     MOVE @MDAT     DDMDAT           *1             E21612
     C                     ELSE                                           E24366
      *                                                                   E24366
      ** Else Maturity date cannot be changed if deal has been rolled     E24366
      ** over                                                             E24366
     C           DDACTN    IFEQ 'A'                        B2             E24366
     C           HKROBY    ANDNE*BLANKS                    B2             E24366
     C           HKRBSI    ANDEQ'O'                        B2             E24366
     C           DDMDAT    ANDNE@MDAT                      B2             E24366
     C                     MOVE '1'       *IN12            *2             E24366
     C                     MOVE '1'       *IN41            *2             E24366
     C***********          MOVEL'MMM0584' @MSGID           *2       E24366E34306
     C                     MOVEL'MMM0585' @MSGID           *2       E24366E34306
     C                     MOVELHKROBY    @DATA            *2             E24366
     C                     CALL 'ZA0440'                   *2             E24366
     C                     PARM           @MSGID           *2             E24366
     C                     PARM           @DATA            *2             E24366
     C                     MOVE @MDAT     DDMDAT           *2             E24366
     C                     ELSE                            X2             S01392
      *                                                                   S01392
      ** Else Maturity date cannot be changed if deal is a front up       S01392
      ** interest deal                                                    S01392
     C           DDACTN    IFEQ 'A'                        B*3            S01392
     C           HKFUID    ANDEQ'Y'                        B*3            S01392
     C           DDMDAT    ANDNE@MDAT                      B*3            S01392
     C                     MOVE '1'       *IN12            **3            S01392
     C                     MOVE '1'       *IN41            **3            S01392
     C                     MOVEL'MMM0612' @MSGID           **3            S01392
     C                     CALL 'ZA0240'                   **3            S01392
     C                     PARM           @MSGID           **3            S01392
     C                     MOVE @MDAT     DDMDAT           **3            S01392
     C                     END                             E*3            S01392
     C                     END                             E2             E24366
      *                                                                   E24366
     C                     END                             E1             E21612
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
     C*                                                                   E21612
     C           DDACTN    IFEQ 'A'                        B1             S01177
     C           DDMDAT    ANDNE@MDAT                      B1             S01177
     C***********@MDAT     ANDNE*BLANKS                    B1       S01177E21612
     C           @DSTS     ANDNE'A'                        B1             E21612
     C           @@ICST    ANDNE'Y'                        B1             CEU015
     C/COPY WNCPYSRC,MM0089C448
     C                     MOVE '1'       *IN12            *1             S01177
     C                     MOVE '1'       *IN41            *1             S01177
     C                     MOVEL'MMM0388' @MSGID           *1             S01177
     C                     CALL 'ZA0240'                   *1             S01177
     C                     PARM           @MSGID           *1             S01177
     C                     MOVE @MDAT     DDMDAT           *1             S01177
     C*                                                                   S01177
     C**  Validate the maturity date.                                     S01177
     C                     ELSE                            X1             S01177
     C*                                                                   S01177
     C**  If the deal type is CD,CL or DL.                                S01177
     C           DDTYPE    IFEQ 'CD'                       B*2            S01177
     C           DDTYPE    OREQ 'CL'                       B*2            S01177
     C           DDTYPE    OREQ 'DL'                       B*2            S01177
     C*                                                                   S01177
     C**  If the action code is 'A', the maturity date on file is not     S01177
     C**  blank, and no date has been entered, this is an error.          S01177
     C           DDACTN    IFEQ 'A'                        B**3           S01177
     C           HKMDYY    ANDNE*ZEROS                     B**3           S01177
     C           HKMDMM    ANDNE*ZEROS                     B**3           S01177
     C           HKMDDD    ANDNE*ZEROS                     B**3           S01177
     C           DDMDAT    ANDEQ*BLANK                     B**3           S01177
     C                     MOVE '1'       *IN12            ***3           S01177
     C                     MOVE '1'       *IN41            ***3           S01177
     C                     MOVEL'MMM0126' @MSGID           ***3           S01177
     C                     CALL 'ZA0240'                   ***3           S01177
     C                     PARM           @MSGID           ***3           S01177
     C                     END                             E**3           S01177
     C*                                                                   S01177
     C**  If the action code is 'I', and a date has been entered, this    S01177
     C**  is an error.                                                    S01177
     C           DDACTN    IFEQ 'I'                        B**3           S01177
     C           DDMDAT    ANDNE*BLANK                     B**3           S01177
     C                     MOVE '1'       *IN12            ***3           S01177
     C                     MOVE '1'       *IN41            ***3           S01177
     C                     MOVEL'MMM0127' @MSGID           ***3           S01177
     C                     CALL 'ZA0240'                   ***3           S01177
     C                     PARM           @MSGID           ***3           S01177
     C                     END                             E**3           S01177
     C*                                                                   S01177
     C**  If the deal type is not CD,CL or DL, and no date has been       S01177
     C**  entered, this is an error.                                      S01177
     C                     ELSE                            X*2            S01177
     C           DDMDAT    IFEQ *BLANKS                    B**3           S01177
     C                     MOVE '1'       *IN12            ***3           S01177
     C                     MOVE '1'       *IN41            ***3           S01177
     C                     MOVEL'MMM0132' @MSGID           ***3           S01177
     C                     CALL 'ZA0240'                   ***3           S01177
     C                     PARM           @MSGID           ***3           S01177
     C                     END                             E**3           S01177
     C                     END                             E*2            S01177
     C*                                                                   S01177
     C**  Validate that the maturity date is valid as a date.             S01177
     C                     TESTN          DDMDAT     6263  *1             S01177
     C                     MOVE DDMDAT    @TEST            *1             S01177
     C                     TESTZ          @TEST          73*1             S01177
     C           *IN62     IFEQ '1'                        B*2            S01177
     C           *IN73     ANDEQ'1'                        B*2            S01177
     C           DDMDAT    ANDNE*BLANKS                    B*2            S01177
     C           *IN63     OREQ '1'                        B*2            S01177
     C           *IN73     ANDEQ'1'                        B*2            S01177
     C           DDMDAT    ANDNE*BLANKS                    B*2            S01177
     C                     MOVE DDMDAT    @DAT             **2            S01177
     C                     CALL 'ZA0270'                   **2            S01177
     C                     PARM           @DAT             **2            S01177
     C*****                PARM           DATF             **2      S01177S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2            S01177
     C                     PARM           @MDYNO           **2            S01177
     C                     ELSE                                           088380
     C                     Z-ADD0         @MDYNO                          088380
     C                     END                             E*2            S01177
     C*                                                                   S01177
     C**  If not, it is an error.                                         S01177
     C           *IN62     IFEQ '0'                        B*2            S01177
     C           *IN63     ANDEQ'0'                        B*2            S01177
     C           *IN73     OREQ '0'                        B*2            S01177
     C           @RTCDE    OREQ '1'                        B*2            S01177
     C           DDMDAT    IFNE *BLANKS                    B**3           S01177
     C                     MOVE '1'       *IN12            ***3           S01177
     C                     MOVE '1'       *IN41            ***3           S01177
     C                     MOVEL'MMM0128' @MSGID           ***3           S01177
     C                     CALL 'ZA0240'                   ***3           S01177
     C                     PARM           @MSGID           ***3           S01177
     C                     END                             E**3           S01177
     C                     END                             E*2            S01177
     C*                                                                   S01177
     C**  Check that the maturity date is after the value date.           S01177
     C**  if the Japanese Sub Module is not installed,                    S01391
     C**  else that it is not less than the value date                    S01391
     C**  if the Japanese Sub Module is installed and the deal            S01391
     C**  is an interbank deposit placed or taken                         S01391
     C*                                                                   S01391
     C           *IN12     IFEQ '0'                        B*2            S01177
     C           DDMDAT    ANDNE*BLANKS                    B*2            S01177
     C/COPY WNCPYSRC,MM0089C038
     C           @MDYNO    IFLE @VDYNO                     B**3           S01177
     C           S01391    ANDNE'Y'                                       S01391
     C           @MDYNO    ORLT @VDYNO                     B**3           S01391
     C           S01391    ANDEQ'Y'                                       S01391
     C           DDTYPE    ANDEQ'IP'                                      S01391
     C           @MDYNO    ORLT @VDYNO                     B**3           S01391
     C           S01391    ANDEQ'Y'                                       S01391
     C           DDTYPE    ANDEQ'IT'                                      S01391
     C           @MDYNO    ORLE @VDYNO                     B**3           S01391
     C           S01391    ANDEQ'Y'                                       S01391
     C           DDTYPE    ANDNE'IP'                                      S01391
     C           DDTYPE    ANDNE'IT'                                      S01391
     C                     MOVE '1'       *IN12            ***3           S01177
     C                     MOVE '1'       *IN41            ***3           S01177
     C                     MOVEL'MMM0130' @MSGID           ***3           S01177
     C                     CALL 'ZA0240'                   ***3           S01177
     C                     PARM           @MSGID           ***3           S01177
     C                     END                             E**3           S01177
     C                     END                             E*2            S01177
     C                     END                             E1             S01177
     C*                                                                   S01177
     C/COPY WNCPYSRC,MM0089C039
     C*                                                                   S01177
     C*  *-------------------*                                            S01177
     C*  * Validate Currency *                                            S01177
     C*  *-------------------*                                            S01177
     C*                                                                   S01177
     C** The deal currency is not amendable.                              S01177
     C           DDACTN    IFEQ 'A'                        B1             S01177
     C           DDCCY     ANDNE@CCY                       B1             S01177
     C/COPY WNCPYSRC,MM0089C449
     C                     MOVE @CCY      DDCCY            *1             S01177
     C                     MOVE '1'       *IN16            *1             S01177
     C                     MOVE '1'       *IN41            *1             S01177
     C                     MOVEL'MMM0370' @MSGID           *1             S01177
     C                     CALL 'ZA0240'                   *1             S01177
     C                     PARM           @MSGID           *1             S01177
     C                     ELSE                            X1             S01177
     C*                                                                   S01177
     C**  The currency must be entered.                                   S01177
     C           DDCCY     IFEQ *BLANKS                    B*2            S01177
     C                     MOVE '1'       *IN16            **2            S01177
     C                     MOVE '1'       *IN41            **2            S01177
     C                     MOVEL'MMM0142' @MSGID           **2            S01177
     C                     CALL 'ZA0240'                   **2            S01177
     C                     PARM           @MSGID           **2            S01177
     C*                                                                   S01177
     C**  If the currency is still valid, check that it is a live         S01177
     C**  dealing currency.                                               S01177
     C                     ELSE                            X*2            S01177
     C*****                MOVE *BLANKS   @KEY             **2      S01177S01194
     C*****                MOVE '20'      @KEY1            **2      S01177S01194
     C*****                MOVE DDCCY     @KEY2            **2      S01177S01194
     C*****                MOVE '1'       @KEY3            **2      S01177S01194
     C*****      @KEY      CHAINFDCCYTLL             65    **2      S01177S01194
     C*****                                                         S01177S01194
     C****If no valid record is found, it is an error.              S01177S01194
     C*****      *IN65     IFEQ '1'                        B**3     S01177S01194
     C*****      RECI      OREQ '*'                        B**3     S01177S01194
     C                     CALL 'AOCURRR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM DDCCY     @AJCD   3        **2            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     IFNE *BLANK                     B**3           S01194
     C                     MOVE '1'       *IN16            ***3           S01177
     C                     MOVE '1'       *IN41            ***3           S01177
     C                     MOVEL'MMM0202' @MSGID           ***3           S01177
     C                     CALL 'ZA0240'                   ***3           S01177
     C                     PARM           @MSGID           ***3           S01177
     C                     ELSE                            X**3           E18187
     C*                                                                   S01392
     C** Default Round Down Indicator from SDCURRPD                       S01392
     C*                                                                   S01392
     C                     MOVELA6RDFC    CYRDFC                          S01392
      ** Check revaluation has been run (1st ccy)                         E18187
      * (only if FRA/IRS or Treasury Management in system)                E40281
     C           BGFIIN    IFEQ 'Y'                        B***4          E40281
     C           BGTRMG    OREQ 'Y'                        ***4           E40281
     C           @TEST1    KLIST                           ***3           E18187
     C                     KFLD           DDCCY            ***3           E18187
     C                     KFLD           @TPRD1           ***3           E18187
     C                     KFLD           @PRD1            ***3           E18187
      *                                                                   E18187
     C                     MOVE *LOVAL    @TPRD1  1        ***3           E18187
     C                     Z-ADD*LOVAL    @PRD1   20       ***3           E18187
      ** CHAIN TO FILE FDINTRLL                                           E18187
     C           @TEST1    SETLLFDINTRLL                   ***3           E18187
     C           DDCCY     READEFDINTRLL                 65***3           E18187
     C           *IN65     IFEQ '1'                        B***4          E18187
     C           HWDLTF    OREQ '*'                                       067426
     C                     MOVE '1'       *IN16            ****4          E18187
     C                     MOVE '1'       *IN41            ****4          E18187
     C                     MOVEL'MMM0316' @MSGID           ****4          E18187
     C                     CALL 'ZA0240'                   ****4          E18187
     C                     PARM           @MSGID           ****4          E18187
     C                     END                             E***4          E18187
     C                     END                             E**4           E40281
     C                     END                             E**3           S01177
     C                     END                             E*2            S01177
     C                     END                             E1             S01177
     C/COPY WNCPYSRC,MM0089C450
     C*                                                                   S01177
     C           #BEF9     ENDSR                           **#BEF9**      S01177
      /EJECT                                                              S01177
     C/COPY WNCPYSRC,MM0089C197
     C*****************************************************************
     C*                                                               *
     C* #ZE      - Clears all screen fields.                          *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #A     - Calculate next interest payment date.     *
     C*            #BA    - F12 processing.                           *
     C*            #BDAA  - Processing for insert of new record.      *
     C*            #BF    - F15  processing - select screen handling. *
     C*            #ZG    - Update processing.                        *
     C*            #ZO    - Validate deal number and action code.     *
     C*                                                               *
     C* FLDS USED  @SLDS  - Data structure with MMSTDLPP format.      *
     C*            @ACTN  - Stored version of DDACTN.                 *
     C*            @DLNO  - Stored version of DDDLNO.                 *
     C*            @TYPE  - Stored version of DDTYPE.                 *
     C*            @STYP  - Stored version of DDSTYP.                 *
     C*            @DLDT  - Stored version of DDDLDT.                 *
     C*****        @BRCD  - Stored version of DDBRCD.                 *   S01117
     C*            @BRCA  - Stored version of DDBRCA.                 *   S01117
     C*            @BKCD  - Stored version of DDBKCD.                 *
     C*            @BRKG  - Stored version of DDBRKG.                 *
     C*            @DADN  - Stored version of DDDADN.                 *
     C*            @CUST  - Stored version of DDCUST.                 *
     C*            @VDAT  - Stored version of DDVDAT.                 *
     C*            @MDAT  - Stored version of DDMDAT.                 *
     C*            @NTCE  - Stored version of DDNTCE.                 *
     C*************@FCLY**-*Stored*version*of*DDFCLY.******************   E25515
     C*            @ACSQ  - Stored version of DDACSQ.                 *
     C*            @CCY   - Stored version of DDCCY.                  *
     C*            @AMNP  - Stored version of DDAMNP.                 *
     C*            @BRAT  - Stored version of DDBRAT.                 *
     C*            @BSRC  - Stored version of DDBSRC.                 *
     C*            @SPRT  - Stored version of DDSPRT.                 *
     C*            @ICMT  - Stored version of DDICMT.                 *
     C*            @NGVI  - Stored version of DDNGVI.                 *
     C*            @IPFQ  - Stored version of DDIPFQ.                 *
     C*            @NDAT  - Stored version of DDNDAT.                 *
     C*            @TOTI  - Stored version of DDTOTI.                 *
     C*            @IPDM  - Stored version of DDIPDM.                 *
     C*            @CPTI  - Stored version of DDCPTI.                 *
     C*            @MTAX  - Stored version of DDMTAX.                 *
     C*            @CDRF  - Stored version of DDCDRF.                 *
     C*            @CDCH  - Stored version of DDCDCH.                 *
     C*            @FUID  - Stored version of DDFUID                  *   S01392
     C*            @FLID  - Stored version of DDFLID                  *   S01392
     C*            @RDFC  - Stored version of DDRDFC                  *   S01392
      *            @ORBR  - stored orig. branch                       *   S01117
      *            @PRFC  - stored profit centre                      *   S01117
     C******       @ORCM  - Stored version of DDORCM.                 *   S01177
     C******       @MOPM  - Stored version of DDMOPM.                 *   S01177
     C******       @MORI  - Stored version of DDMORI.                 *   S01177
     C******       @MOPI  - Stored version of DDMOPI.                 *   S01177
     C******       @MCPI  - Stored version of DDMCPI.                 *   S01177
     C******       @MCRI  - Stored version of DDMCRI.                 *   S01177
     C******       @MFAO  - Stored version of DDMFAO.                 *   S01177
     C******       @SPEC  - Stored version of DDSPEC.                 *   S01177
     C*            @RSTM  - stored rcpt settlement method             *   S01177
     C*            @RONS  - stored rcpt our nostro                    *   S01177
     C*            @RIBN  - stored rcpt intermed bank no.             *   S01177
     C*            @RIBA  - stored rcpt intermed bank a/c line        *   S01177
     C*            @ROBN  - stored rcpt ordering bank no.             *   S01177
     C*            @ROCN  - stored rcpt ordering customer no.         *   S01177
     C*            @PSTM  - stored pay settlement method              *   S01177
     C*            @PONS  - stored pay our nostro                     *   S01177
     C*            @PIBN  - stored pay intermed bank no.              *   S01177
     C*            @PIBA  - stored pay intermed bank a/c line         *   S01177
     C*            @POBN  - stored pay ordering bank no.              *   S01177
     C*            @POCN  - stored pay ordering customer no.          *   S01177
     C*            @RCRN  - stored receiver correspondant no.         *   S01177
     C*            @RCRA  - stored receiver corr a/c line             *   S01177
     C*            @RVNO  - stored receiver no.                       *   S01177
     C*            @AWBN  - stored a/c with bank no.                  *   S01177
     C*            @AWBA  - stored a/c with bank a/c line             *   S01177
     C*            @BENN  - stored beneficiary no.                    *   S01177
     C*            @BENA  - stored beneficiary a/c line               *   S01177
     C*            @DTP1  - stored details of payment 1               *   S01177
     C*            @DTP2  - stored details of payment 2               *   S01177
     C*            @DTP3  - stored details of payment 3               *   S01177
     C*            @DTP4  - stored details of payment 4               *   S01177
     C*            @DCHG  - stored details of charges                 *   S01177
     C*            @BTB1  - stored bank to bank info 1                *   S01177
     C*            @BTB2  - stored bank to bank info 2                *   S01177
     C*            @BTB3  - stored bank to bank info 3                *   S01177
     C*            @BTB4  - stored bank to bank info 4                *   S01177
     C*            @BTB5  - stored bank to bank info 5                *   S01177
     C*            @BTB6  - stored bank to bank info 6                *   S01177
     C*            @CVMR  - cover MT202 required                      *   E22405
     C*            @AUTO  - Auto deal number indicator.               *
     C*            @BOKC  - Stored version of DDBOKC.                 *   S01165
     C*            @LNKN  - Stored version of DDLNKN.                 *   S01165
     C*            @DRID  - Stored version of DDDRID.                 *   S01176
     C*            @DDMR  - Stored version of DDDDMR.                 *   S01176
     C*                                                               *
     C*****************************************************************
     C           #ZE       BEGSR
     C****Clear the standard deal format.                                 E18139
     C****First fill standard deal format data structure with blanks,     E18139
     C****then zeroise numeric fields.                                    E18139
     C******               MOVE *BLANKS   @SLDS                           E18139
     C******               Z-ADD0         IKDLUP                          E18139
     C******               Z-ADD0         IKYLUP                          E18139
     C******               Z-ADD0         IKTLUP                          E18139
     C******               Z-ADD0         IKLCD                           E18139
     C******               Z-ADD0         IKDN38                          E18139
     C******               Z-ADD0         IKCYDP                          E18139
     C******               Z-ADD0         IKVDYY                          E18139
     C******               Z-ADD0         IKVDMM                          E18139
     C******               Z-ADD0         IKVDDD                          E18139
     C******               Z-ADD0         IKDTYY                          E18139
     C******               Z-ADD0         IKDTMM                          E18139
     C******               Z-ADD0         IKDTDD                          E18139
     C******               Z-ADD0         IKCNUM                          E18139
     C******               Z-ADD0         IKAMNP                          E18139
     C******               Z-ADD0         IKINTR                          E18139
     C******               Z-ADD0         IKBRCD                          E18139
     C******               Z-ADD0         IKDDYY                          E18139
     C******               Z-ADD0         IKDDMM                          E18139
     C******               Z-ADD0         IKDDDD                          E18139
     C******               Z-ADD0         IKBRKG                          E18139
     C******               Z-ADD0         IKBCDP                          E18139
     C******               Z-ADD0         IKPCTN                          E18139
     C******               Z-ADD0         IKTIME                          E18139
     C******               Z-ADD0         IKLDAT                          E18139
     C******               Z-ADD0         IKSLYY                          E18139
     C******               Z-ADD0         IKSLMM                          E18139
     C******               Z-ADD0         IKSLDD                          E18139
     C******               Z-ADD0         IKSPRD                          E18139
     C******               Z-ADD0         IKIIRT                          E18139
     C******               Z-ADD0         IKNIYY                          E18139
     C******               Z-ADD0         IKNIMM                          E18139
     C******               Z-ADD0         IKNIDD                          E18139
     C******               Z-ADD0         IKIPDM                          E18139
     C******               Z-ADD0         IKACSQ                          E18139
     C******               Z-ADD0         IKMTTI                          E18139
     C******               Z-ADD0         IKMCDH                          E18139
     C******               Z-ADD0         IKIAYY                          E18139
     C******               Z-ADD0         IKIAMM                          E18139
     C******               Z-ADD0         IKIADD                          E18139
     C******               Z-ADD0         IKMDYY                          E18139
     C******               Z-ADD0         IKMDMM                          E18139
     C******               Z-ADD0         IKMDDD                          E18139
     C******               Z-ADD0         IKNTCE                          E18139
     C******               Z-ADD0         IKFCLY                          E18139
     C******               Z-ADD0         IKIMAT                          E18139
     C******               Z-ADD0         IKBRAT                          E18139
     C******               Z-ADD0         IKORCM                          E18139
     C******               Z-ADD0         IKMOPM                          E18139
     C******               Z-ADD0         IKBORM                          E18139
     C******               Z-ADD0         IKBOPM                          E18139
     C******               Z-ADD0         IKBAMT                          E18139
     C******               Z-ADD0         IKBCNM                          E18139
     C******               Z-ADD0         IKBVDT                          E18139
     C******               Z-ADD0         IKBIRT                          E18139
     C******               Z-ADD0         IKBNID                          E18139
     C******               Z-ADD0         IKBIDM                          E18139
     C******               Z-ADD0         IKBFVL                          E18139
     C******               Z-ADD0         IKBLID                          E18139
     C******               Z-ADD0         IKBMTD                          E18139
     C******               Z-ADD0         IKBNTC                          E18139
     C******               Z-ADD0         IKMCHD                          E18139
     C******               Z-ADD0         IKDVSD                          E18139
     C******               Z-ADD0         IKDDND                          E18139
     C******               Z-ADD0         IKDLAD                          E18139
     C******               Z-ADD0         IKNIPD                          E18139
     C******               Z-ADD0         IKSLID                          E18139
     C******               Z-ADD0         IKMATD                          E18139
     C******               Z-ADD0         IKIACD                          E18139
     C******               Z-ADD0         IKRBAT                          E18139
     C******               Z-ADD0         IKRMTD                          E18139
     C******               Z-ADD0         IKLNKN                   S01165 E18139
     C*
     C**  Blank all screen input fields.
     C/COPY WNCPYSRC,MM0089C160
      *                                                                   136653
      ** Allow blanking of DDACTN after every processing of any           136653
      ** action code. Also, reset to blank @@ACTN if INKL = '1'           136653
      *                                                                   136653
     C           *INKL     IFEQ '1'                                       136653
     C                     MOVE *BLANKS   @@ACTN                          136653
     C                     END                                            136653
     C***********DDACTN    IFNE 'X'                                109732 136653
     C                     MOVE *BLANKS   DDACTN
     C***********          END                                     109732 136653
     C                     MOVE *BLANKS   DDDLNO
     C/COPY WNCPYSRC,MM0089C161
     C                     MOVE *BLANKS   DDTYPE
     C                     MOVE *BLANKS   DDSTYP
     C/COPY WNCPYSRC,MM0089C006
     C                     MOVE *BLANKS   DDFEDF                          S01136
     C/COPY WNCPYSRC,MM0089C007
     C                     MOVE *BLANKS   DDDLDT
     C*****                MOVE *BLANKS   DDBRCD                          S01117
     C/COPY WNCPYSRC,MM0089C223
     C                     MOVE *BLANKS   DDBRCA                          S01117
     C                     MOVE *BLANKS   DDBKCD
     C                     MOVE *BLANKS   DDBRKG
     C                     MOVE *BLANKS   DDDADN
     C                     MOVE *BLANKS   DDCUST
     C                     MOVE *BLANKS   DDVDAT
     C                     MOVE *BLANKS   DDMDAT
     C                     MOVE *BLANKS   DDNTCE
     C***********          MOVE *BLANKS   DDFCLY                          E25515
     C                     MOVE *BLANKS   DDPTFR                          S01486
     C                     MOVE *BLANKS   DDACSQ
     C                     MOVE *BLANKS   DDCCY
     C                     MOVE *BLANKS   DDAMNP
     C                     MOVE *BLANKS   DDBRAT
     C                     MOVE *BLANKS   DDBSRC
     C                     MOVE *BLANKS   DDSPRT
     C                     MOVE *BLANKS   DDICMT
     C                     MOVE *BLANKS   DDNGVI
     C                     MOVE *BLANKS   DDIPFQ
     C                     MOVE *BLANKS   DDNDAT
     C                     MOVE *BLANKS   DDTOTI
     C                     MOVE *BLANKS   DDIPDM
     C                     MOVE *BLANKS   DDCPTI
     C                     MOVE *BLANKS   DDMTAX
     C                     MOVE *BLANKS   DDCDRF
     C                     MOVE *BLANKS   DDCDCH
     C                     MOVE *BLANKS   DDFUID                          S01392
     C                     MOVE *BLANKS   DDFLID                          S01392
     C                     MOVE *BLANKS   DDRDFC                          S01392
     C                     MOVE *BLANKS   DDCPTY                          S01184
     C                     MOVE *BLANKS   DDBROK                          S01184
     C                     MOVE *BLANKS   DDTEXT                          S01184
     C                     MOVE *BLANKS   DDORBR                          S01117
     C                     MOVE *BLANKS   DDPRFC                          S01117
     C*****                MOVE *BLANKS   DDORCM                          S01177
     C*****                MOVE *BLANKS   DDMOPM                          S01177
     C*****                MOVE *BLANKS   DDMORI                          S01177
     C*****                MOVE *BLANKS   DDMOPI                          S01177
     C*****                MOVE *BLANKS   DDMCPI                          S01177
     C*****                MOVE *BLANKS   DDMCRI                          S01177
     C*****                MOVE *BLANKS   DDMFAO                          S01177
     C*****                MOVE *BLANKS   DDSPEC                          S01177
     C                     MOVE *BLANKS   DDBOKC                          S01165
     C                     MOVE *BLANKS   DDLNKN                          S01165
     C                     MOVE *BLANKS   DDDRID                          S01176
     C                     MOVE *BLANKS   DDDDMR                          S01176
     C                     MOVE *BLANKS   DDRACD                          AUS007
     C                     MOVE *BLANKS   DDAURO                          S01434
     C                     MOVE *BLANKS   DDIPDS                          S01434
     C                     MOVE *BLANKS   DDROFQ                          S01434
     C                     MOVE *BLANKS   DDRLDN                          S01434
     C                     MOVE *BLANKS   DDIMET                          S01434
     C                     MOVE *BLANKS   DDINSA                          S01434
     C                     MOVE *BLANKS   DDINSN                          S01434
     C                     MOVE *BLANKS   DDINOS                          S01434
     C                     MOVE *BLANKS   DDCNNA                          S01434
     C                     MOVE *BLANKS   DDISCY                          CEU003
     C                     MOVE *BLANKS   DDII72                          CEU003
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CISN                                           S01408
     C*                                                                   S01408
     C                     MOVE '0'       *IN38
     C                     MOVE '0'       *IN39
     C                     MOVE '0'       *IN67
     C*
     C**  Clear "F10-CONFIRM" prompt                                      S01177
     C                     MOVE '0'       *IN42                           S01177
     C*
     C**  Clear CONFIRMATION MATCHING indicator                           S01184
     C                     MOVE '0'       *IN92                           S01184
     C*                                                                   S01184
     C**  Blank settlement screen fields                                  S01177
     C*                                                                   S01177
     C                     MOVE *BLANKS   PMACTC                          S01177
     C                     MOVE *BLANKS   PMCPGM                          S01177
     C                     MOVE *BLANKS   PMTTYP                          S01177
     C/COPY WNCPYSRC,MM0089C376
     C                     MOVE *BLANKS   PMCSNM                          S01177
     C                     MOVE *BLANKS   PMRCCY                          S01177
     C                     MOVE *BLANKS   PMPCCY                          S01177
     C                     MOVE *BLANKS   PMFFND                          S01177
     C                     MOVE *BLANKS   PMPRCV                          S01177
     C                     MOVE *BLANKS   PMPPAY                          S01177
     C                     MOVE *BLANKS   PMCMDP                          S01177
     C                     MOVE *BLANKS   PMVALO                          S01177
     C                     MOVE *BLANKS   PMSDTV                          S01177
     C                     MOVE *BLANKS   PMTERM                          S01177
     C                     MOVE *BLANKS   PMRONS                          S01177
     C                     MOVE *BLANKS   PARIBN                          S01177
     C                     MOVE *BLANKS   PMRIBN                          S01177
     C                     MOVE *BLANKS   PMRIBA                          S01177
     C                     MOVE *BLANKS   PAROBN                          S01177
     C                     MOVE *BLANKS   PMROBN                          S01177
     C                     MOVE *BLANKS   PAROCN                          S01177
     C                     MOVE *BLANKS   PMROCN                          S01177
     C                     MOVE *BLANKS   PMPONS                          S01177
     C                     MOVE *BLANKS   PAPIBN                          S01177
     C                     MOVE *BLANKS   PMPIBN                          S01177
     C                     MOVE *BLANKS   PMPIBA                          S01177
     C                     MOVE *BLANKS   PAPOBN                          S01177
     C                     MOVE *BLANKS   PMPOBN                          S01177
     C                     MOVE *BLANKS   PAPOCN                          S01177
     C                     MOVE *BLANKS   PMPOCN                          S01177
     C                     MOVE *BLANKS   PARCRN                          S01177
     C                     MOVE *BLANKS   PMRCRN                          S01177
     C                     MOVE *BLANKS   PMRCRA                          S01177
     C                     MOVE *BLANKS   PARVNO                          S01177
     C                     MOVE *BLANKS   PMRVNO                          S01177
     C                     MOVE *BLANKS   PAAWBN                          S01177
     C                     MOVE *BLANKS   PMAWBN                          S01177
     C                     MOVE *BLANKS   PMAWBA                          S01177
     C                     MOVE *BLANKS   PABENN                          S01177
     C                     MOVE *BLANKS   PMBENN                          S01177
     C                     MOVE *BLANKS   PMBENA                          S01177
     C                     MOVE *BLANKS   PMDTP1                          S01177
     C                     MOVE *BLANKS   PMDTP2                          S01177
     C                     MOVE *BLANKS   PMDTP3                          S01177
     C                     MOVE *BLANKS   PMDTP4                          S01177
     C                     MOVE *BLANKS   PMDCHG                          S01177
     C                     MOVE *BLANKS   PMBTB1                          S01177
     C                     MOVE *BLANKS   PMBTB2                          S01177
     C                     MOVE *BLANKS   PMBTB3                          S01177
     C                     MOVE *BLANKS   PMBTB4                          S01177
     C                     MOVE *BLANKS   PMBTB5                          S01177
     C                     MOVE *BLANKS   PMBTB6                          S01177
     C                     MOVE *BLANKS   PMCVMR                          E22405
     C                     MOVE *BLANKS   PMDBFL                          S01177
     C                     MOVE *BLANKS   PMDBKY                          S01177
     C                     MOVE *BLANKS   PMDPGM                          S01177
     C                     MOVE *BLANKS   PMERCD                          S01177
     C                     MOVE *BLANKS   PMROBR                          S01117
     C                     MOVE *BLANKS   PMPOBR                          S01117
     C*                                                                   CEU003
     C                     MOVE *BLANKS   PMRSCY                          CEU003
     C                     MOVE *BLANKS   PMPSCY                          CEU003
     C                     MOVE *BLANKS   PMIC72                          CEU003
     C                     MOVE *BLANKS   PMIERI                          CEU003
     C*                                                                   S01177
     C**  Zeroise numeric settlement screen fields                        S01177
     C*                                                                   S01177
     C                     Z-ADD0         PMDTRC                          S01177
     C                     Z-ADD0         PMDTPY                          S01177
     C                     Z-ADD0         PMRSTM                          S01177
     C                     Z-ADD0         PMPSTM                          S01177
     C                     Z-ADD0         PMDBSE                          S01177
     C*                                                                   S01177
     C**  Blank all program work fields.
     C                     MOVE *BLANKS   @ACTN
     C                     MOVE *BLANKS   @DLNO
     C                     MOVE *BLANKS   @TYPE
     C                     MOVE *BLANKS   @STYP
     C/COPY WNCPYSRC,MM0089C008
     C                     MOVE *BLANKS   @FEDF                           S01136
     C/COPY WNCPYSRC,MM0089C009
     C                     MOVE *BLANKS   @DLDT
     C*****                MOVE *BLANKS   @BRCD                           S01117
     C                     MOVE *BLANKS   @BRCA                           S01117
     C                     MOVE *BLANKS   @BKCD
     C                     MOVE *BLANKS   @BRKG
     C                     MOVE *BLANKS   @DADN
     C                     MOVE *BLANKS   @CUST
     C                     MOVE *BLANKS   @VDAT
     C/COPY WNCPYSRC,MM0089C198
     C                     MOVE *BLANKS   @MDAT
     C                     MOVE *BLANKS   @NTCE
     C***********          MOVE *BLANKS   @FCLY                           E25515
     C                     MOVE *BLANKS   @PTFR                           S01486
     C                     MOVE *BLANKS   @ACSQ
     C                     MOVE *BLANKS   @CCY
     C                     MOVE *BLANKS   @AMNP
     C                     MOVE *BLANKS   @BRAT
     C                     MOVE *BLANKS   @BSRC
     C                     MOVE *BLANKS   @SPRT
     C                     MOVE *BLANKS   @ICMT
     C                     MOVE *BLANKS   @NGVI
     C                     MOVE *BLANKS   @IPFQ
     C                     MOVE *BLANKS   @NDAT
     C                     MOVE *BLANKS   @TOTI
     C                     MOVE *BLANKS   @IPDM
     C                     MOVE *BLANKS   @CPTI
     C                     MOVE *BLANKS   @MTAX
     C                     MOVE *BLANKS   @CDRF
     C                     MOVE *BLANKS   @CDCH
     C                     MOVE *BLANKS   @FUID                           S01392
     C                     MOVE *BLANKS   @FLID                           S01392
     C                     MOVE *BLANKS   @RDFC                           S01392
     C                     MOVE *BLANKS   @ORBR                           S01117
     C                     MOVE *BLANKS   @PRFC                           S01117
     C*****                MOVE *BLANKS   @ORCM                           S01177
     C*****                MOVE *BLANKS   @MOPM                           S01177
     C*****                MOVE *BLANKS   @MORI                           S01177
     C*****                MOVE *BLANKS   @MOPI                           S01177
     C*****                MOVE *BLANKS   @MCPI                           S01177
     C*****                MOVE *BLANKS   @MCRI                           S01177
     C*****                MOVE *BLANKS   @MFAO                           S01177
     C*****                MOVE *BLANKS   @SPEC                           S01177
     C                     MOVE *BLANKS   @RONS                           S01177
     C                     MOVE *BLANKS   @RIBN                           S01177
     C                     MOVE *BLANKS   @RIBA                           S01177
     C                     MOVE *BLANKS   @PONS                           S01177
     C                     MOVE *BLANKS   @PIBN                           S01177
     C                     MOVE *BLANKS   @PIBA                           S01177
     C                     MOVE *BLANKS   @RCRN                           S01177
     C                     MOVE *BLANKS   @RCRA                           S01177
     C                     MOVE *BLANKS   @RVNO                           S01177
     C                     MOVE *BLANKS   @AWBN                           S01177
     C                     MOVE *BLANKS   @AWBA                           S01177
     C                     MOVE *BLANKS   @BENN                           S01177
     C                     MOVE *BLANKS   @BENA                           S01177
     C                     MOVE *BLANKS   @DTP1                           S01177
     C                     MOVE *BLANKS   @DTP2                           S01177
     C                     MOVE *BLANKS   @DTP3                           S01177
     C                     MOVE *BLANKS   @DTP4                           S01177
     C                     MOVE *BLANKS   @DCHG                           S01177
     C                     MOVE *BLANKS   @BTB1                           S01177
     C                     MOVE *BLANKS   @BTB2                           S01177
     C                     MOVE *BLANKS   @BTB3                           S01177
     C                     MOVE *BLANKS   @BTB4                           S01177
     C                     MOVE *BLANKS   @BTB5                           S01177
     C                     MOVE *BLANKS   @BTB6                           S01177
     C                     MOVE *BLANKS   @CVMR                           E22405
     C                     MOVE *BLANKS   @BOKC                           S01165
     C                     MOVE *BLANKS   @LNKN                           S01165
     C                     MOVE *BLANKS   @DRID                           S01176
     C                     MOVE *BLANKS   @DDMR                           S01176
     C                     MOVE *BLANKS   @ROBR                           S01117
     C                     MOVE *BLANKS   @POBR                           S01117
     C                     MOVE 'N'       @AUTO
     C                     MOVE *BLANKS   @CPTY                           S01184
     C                     MOVE *BLANKS   @BROK                           S01184
     C                     MOVE *BLANKS   @TEXT                           S01184
     C                     MOVE *BLANKS   @RACD                           AUS007
     C                     MOVE *BLANKS   @AURO                           S01434
     C                     MOVE *BLANKS   @IPDS                           S01434
     C                     MOVE *BLANKS   @ROFQ                           S01434
     C                     MOVE *BLANKS   @RLDN                           S01434
     C                     MOVE *BLANKS   @IMET                           S01434
     C                     MOVE *BLANKS   @INSA                           S01434
     C                     MOVE *BLANKS   @INOS                           S01434
     C                     MOVE *BLANKS   @CNNA                           S01434
     C*                                                                   CEU003
     C                     MOVE *BLANKS   @STCY                           CEU003
     C                     MOVE *BLANKS   @IC72                           CEU003
     C                     MOVE *BLANKS   @IERI                           CEU003
     C                     MOVE *BLANKS   @ISCY                           CEU003
     C                     MOVE *BLANKS   @II72                           CEU003
     C*                                                                   CEU003
     C/COPY WNCPYSRC,MM0089C162
     C*                                                                   S01218
     C**  Access the data area MMOD to determine whether the FX           S01218
     C**  module is in the system.  If it is, position 13 contains a      S01218
     C**  a 'Y'.                                                          S01218
     C           *NAMVAR   DEFN           MMOD                            S01218
     C                     IN   MMOD                                      S01218
     C*                                                                   S01176
     C**  If position 21 of MMOD is 'Y' then Sec.Trading is installed     S01176
     C*                                                                   S01176
     C           @MOD21    IFEQ 'Y'                                       S01176
     C                     MOVE '1'       *IN56                           S01176
     C                     END                                            S01176
     C/COPY WNCPYSRC,MM0089C394
     C*
     C**  Zeroise numeric settlement work   fields                        S01177
     C                     MOVE *ZEROS    @RSTM                           S01177
     C                     MOVE *ZEROS    @ROBN                           S01177
     C                     MOVE *ZEROS    @ROCN                           S01177
     C                     MOVE *ZEROS    @PSTM                           S01177
     C                     MOVE *ZEROS    @POBN                           S01177
     C                     MOVE *ZEROS    @POCN                           S01177
      *                                                                   CAC001
      **  Reset funding info fields & previous spread/rate and deal no.   CAC001
      *                                                                   CAC001
     C                     Z-ADD0         WFSRP                           CAC001
     C                     MOVE *BLANKS   WFSGN                           CAC001
     C                     MOVE *BLANKS   WFPRC                           CAC001
     C                     MOVE *BLANKS   WSSPRT                          CAC001
     C                     MOVE *BLANKS   WSBSRC                          CAC001
     C                     MOVE *BLANKS   WSDLNO                          CAC001
     C                     MOVE *BLANKS   WLOOP                           CAC001
     C*                                                                   S01177
     C**  Screen is now blank so disable CMD\14                           S01177
     C                     MOVE '0'       *IN53                           S01177
      *                                                                   CAC001
      **  Screen is now blank so disable CMD\19 for Funding Info          CAC001
     C                     MOVE '0'       *IN88                           CAC001
     C*                                                                   S01177
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C122                                           S01408
     C*                                                                   S01408
     C           #ZE9      ENDSR                           **#ZE9**
      /EJECT                                                              E18139
      *****************************************************************   E18139
      *                                                               *   E18139
      * #ZEA     - clear standard deal                                *   E18139
      *                                                               *   E18139
      * CALLS             -                                           *   E18139
      *                                                               *   E18139
      * CALLED BY  #BA    - CF12 processing                           *   E18139
      *            #ZO    - validate deal number and action code      *   E18139
      *            #ZK    - retrieves and displays record             *   E18139
      *            #ZG    - updates file                              *   E18139
      *            #BDAA  - inserts record                            *   E18139
      *                                                               *   E18139
      *                                                               *   E18139
      *****************************************************************   E18139
     C           #ZEA      BEGSR                                          E18139
     C*                                                                   E18139
     C** clear the standard deal                                          E18139
     C**  First fill standard deal format data structure with blanks,     E18139
     C**  then zeroise numeric fields.                                    E18139
     C*                                                                   E18139
     C                     MOVE *BLANKS   @SLDS                           E18139
     C                     Z-ADD0         IKDLUP                          E18139
     C                     Z-ADD0         IKYLUP                          E18139
     C                     Z-ADD0         IKTLUP                          E18139
     C                     Z-ADD0         IKLCD                           E18139
     C                     Z-ADD0         IKDN38                          E18139
     C                     Z-ADD0         IKCYDP                          E18139
     C                     Z-ADD0         IKVDYY                          E18139
     C                     Z-ADD0         IKVDMM                          E18139
     C                     Z-ADD0         IKVDDD                          E18139
     C                     Z-ADD0         IKDTYY                          E18139
     C                     Z-ADD0         IKDTMM                          E18139
     C                     Z-ADD0         IKDTDD                          E18139
     C**********           Z-ADD0         IKCNUM                                      E18139 CSD027A
     C                     MOVE *BLANKS   IKCNUM                                             CSD027A
     C                     Z-ADD0         IKAMNP                          E18139
     C                     Z-ADD0         IKINTR                          E18139
     C                     Z-ADD0         IKDDYY                          E18139
     C                     Z-ADD0         IKDDMM                          E18139
     C                     Z-ADD0         IKDDDD                          E18139
     C                     Z-ADD0         IKBRKG                          E18139
     C                     Z-ADD0         IKBCDP                          E18139
     C                     Z-ADD0         IKPCTN                          E18139
     C                     Z-ADD0         IKTIME                          E18139
     C                     Z-ADD0         IKLDAT                          E18139
     C                     Z-ADD0         IKSLYY                          E18139
     C                     Z-ADD0         IKSLMM                          E18139
     C                     Z-ADD0         IKSLDD                          E18139
     C                     Z-ADD0         IKSPRD                          E18139
     C                     Z-ADD0         IKIIRT                          E18139
     C                     Z-ADD0         IKNIYY                          E18139
     C                     Z-ADD0         IKNIMM                          E18139
     C                     Z-ADD0         IKNIDD                          E18139
     C                     Z-ADD0         IKIPDM                          E18139
     C                     Z-ADD0         IKACSQ                          E18139
     C                     Z-ADD0         IKMTTI                          E18139
     C**********           Z-ADD0         IKMCDH                                      E18139 CSD027A
     C                     MOVE *BLANKS   IKMCDH                                             CSD027A
     C                     Z-ADD0         IKIAYY                          E18139
     C                     Z-ADD0         IKIAMM                          E18139
     C                     Z-ADD0         IKIADD                          E18139
     C                     Z-ADD0         IKMDYY                          E18139
     C                     Z-ADD0         IKMDMM                          E18139
     C                     Z-ADD0         IKMDDD                          E18139
     C                     Z-ADD0         IKNTCE                          E18139
     C                     Z-ADD0         IKFCLY                          E18139
     C                     Z-ADD0         IKIMAT                          E18139
     C                     Z-ADD0         IKBRAT                          E18139
     C                     Z-ADD0         IKORCM                          E18139
     C                     Z-ADD0         IKMOPM                          E18139
     C                     Z-ADD0         IKBORM                          E18139
     C                     Z-ADD0         IKBOPM                          E18139
     C                     Z-ADD0         IKBAMT                          E18139
     C**********           Z-ADD0         IKBCNM                                      E18139 CSD027A
     C                     MOVE *BLANKS   IKBCNM                                             CSD027A
     C                     Z-ADD0         IKBVDT                          E18139
     C                     Z-ADD0         IKBIRT                          E18139
     C                     Z-ADD0         IKBNID                          E18139
     C                     Z-ADD0         IKBIDM                          E18139
     C                     Z-ADD0         IKBFVL                          E18139
     C                     Z-ADD0         IKBLID                          E18139
     C                     Z-ADD0         IKBMTD                          E18139
     C                     Z-ADD0         IKBNTC                          E18139
     C                     Z-ADD0         IKMCHD                          E18139
     C                     Z-ADD0         IKDVSD                          E18139
     C                     Z-ADD0         IKDDND                          E18139
     C                     Z-ADD0         IKDLAD                          E18139
     C                     Z-ADD0         IKNIPD                          E18139
     C                     Z-ADD0         IKSLID                          E18139
     C                     Z-ADD0         IKMATD                          E18139
     C                     Z-ADD0         IKIACD                          E18139
     C                     Z-ADD0         IKRBAT                          E18139
     C                     Z-ADD0         IKRMTD                          E18139
     C                     Z-ADD0         IKLNKN                   S01165 E18139
     C                     Z-ADD0         IKRSTM                          E18139
     C**********           Z-ADD0         IKROBN                                      E18139 CSD027A
     C**********           Z-ADD0         IKROCN                                      E18139 CSD027A
     C                     MOVE *BLANKS   IKROBN                                             CSD027A
     C                     MOVE *BLANKS   IKROCN                                             CSD027A
     C                     Z-ADD0         IKPSTM                          E18139
     C**********           Z-ADD0         IKPOBN                                      E18139 CSD027A
     C**********           Z-ADD0         IKPOCN                                      E18139 CSD027A
     C                     MOVE *BLANKS   IKPOBN                                             CSD027A
     C                     MOVE *BLANKS   IKPOCN                                             CSD027A
     C                     Z-ADD0         IKFSRP                          CAC001
     C                     Z-ADD0         IKFCTD                          CAC001
     C                     Z-ADD0         IKORDA                          145001
     C/COPY WNCPYSRC,MM0089C526
      *                                                                   E18139
     C           #ZEA9     ENDSR                           #ZEA9 TAG      E18139
      *****************************************************************   E18139
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZD      - Sets up screen with file values.                   *
     C*                                                               *
     C* CALLS    ZA0770   - YYYYMMDD to MMDDYY or DDMMYY conversion.  *
     C*          ZA0920   - Back office amount editor.                *
      *          #FEED    - Extract feedback information when         *   S01184
      *                     CONFIRMATION MATCHING module present      *   S01184
     C*                                                               *
     C* CALLED BY  #BB    -  F8 processing.                           *
     C*            #BC    -  F7 processing.                           *
     C*            #BF    -  F15 processing - select screen handling. *
     C*            #ZG    - Update processing.                        *
     C*            INFSR  - Error checking SR for write to deals file.*
     C*                                                               *
     C* FLDS USED  @DLNO  - Stored version of DDDLNO.                 *
     C*            @TYPE  - Stored version of DDTYPE.                 *
     C*            @STYP  - Stored version of DDSTYP.                 *
     C*            @YEAR  - Field to hold year and century.           *
     C*            @MNTH  - Field to hold month (MM).                 *
     C*            @DAY   - Field to hold day (DD).                   *
     C*            @DATE  - Date (YYYYMMDD).                          *
     C*            @DLDT  - Stored version of DDDLDT.                 *
     C*            @@DTIN - Date (YYYYMMDD).                          *
     C*            @@DTOU - Date (MMDDYY or DDMMYY).                  *
     C*****        @BRCD  - Stored version of DDBRCD.                 *   S01117
     C*            @BRCA  - Stored version of DDBRCA.                 *   S01117
     C*            @BKCD  - Stored version of DDBKCD.                 *
     C*            @@QECN - Decimal places of validated field.        *
     C*            @@AMTW - Amount to be edited.                      *
     C*            @@AMTD - Edited alpha field.                       *
     C*            @BRKG  - Stored version of DDBRKG.                 *
     C*            @DADN  - Stored version of DDDADN.                 *
     C*            @CUST  - Stored version of DDCUST.                 *
     C*            @VDAT  - Stored version of DDVDAT.                 *
     C*            @MDAT  - Stored version of DDMDAT.                 *
     C*            @IADT  - Interst accrual date.                     *
     C*            @LIDT  - Last interest date.                       *
     C*            @NTCE  - Stored version of DDNTCE.                 *
     C*************@FCLY**-*Stored*version*of*DDFCLY.******************   E25515
     C*            @ACSQ  - Stored version of DDACSQ.                 *
     C*            @CCY   - Stored version of DDCCY.                  *
     C*            @AMNP  - Stored version of DDAMNP.                 *
     C*            @BRAT  - Stored version of DDBRAT.                 *
     C*            @BSRC  - Stored version of DDBSRC.                 *
     C*            @SPRT  - Stored version of DDSPRT.                 *
     C*            @ICMT  - Stored version of DDICMT.                 *
     C*            @NGVI  - Stored version of DDNGVI.                 *
     C*            @IPFQ  - Stored version of DDIPFQ.                 *
     C*            @NDAT  - Stored version of DDNDAT.                 *
     C*            @TOTI  - Stored version of DDTOTI.                 *
     C*            @IPDM  - Stored version of DDIPDM.                 *
     C*            @CPTI  - Stored version of DDCPTI.                 *
     C*            @MTAX  - Stored version of DDMTAX.                 *
     C*            @CDRF  - Stored version of DDCDRF.                 *
     C*            @CDCH  - Stored version of DDCDCH.                 *
     C*            @FUID  - Stored version of DDFUID                  *   S01392
     C*            @FLID  - Stored version of DDFLID                  *   S01392
     C*            @RDFC  - Stored version of DDRDFC                  *   S01392
     C*            @ORBR  - stored orig. branch                       *   S01117
     C*            @PRFC  - stored profit centre                      *   S01117
     C******       @ORCM  - Stored version of DDORCM.                 *   S01177
     C******       @MOPM  - Stored version of DDMOPM.                 *   S01177
     C******       @MORI  - Stored version of DDMORI.                 *   S01177
     C******       @MOPI  - Stored version of DDMOPI.                 *   S01177
     C******       @MCPI  - Stored version of DDMCPI.                 *   S01177
     C******       @MCRI  - Stored version of DDMCRI.                 *   S01177
     C******       @MFAO  - Stored version of DDMFAO.                 *   S01177
     C******       @SPEC  - Stored version of DDSPEC.                 *   S01177
     C*            @RSTM  - stored rcpt settlement method             *   S01177
     C*            @RONS  - stored rcpt our nostro                    *   S01177
     C*            @RIBN  - stored rcpt intermed bank no.             *   S01177
     C*            @RIBA  - stored rcpt intermed bank a/c line        *   S01177
     C*            @ROBN  - stored rcpt ordering bank no.             *   S01177
     C*            @ROCN  - stored rcpt ordering customer no.         *   S01177
     C*            @PSTM  - stored pay settlement method              *   S01177
     C*            @PONS  - stored pay our nostro                     *   S01177
     C*            @PIBN  - stored pay intermed bank no.              *   S01177
     C*            @PIBA  - stored pay intermed bank a/c line         *   S01177
     C*            @POBN  - stored pay ordering bank no.              *   S01177
     C*            @POCN  - stored pay ordering customer no.          *   S01177
     C*            @RCRN  - stored receiver correspondant no.         *   S01177
     C*            @RCRA  - stored receiver corr a/c line             *   S01177
     C*            @RVNO  - stored receiver no.                       *   S01177
     C*            @AWBN  - stored a/c with bank no.                  *   S01177
     C*            @AWBA  - stored a/c with bank a/c line             *   S01177
     C*            @BENN  - stored beneficiary no.                    *   S01177
     C*            @BENA  - stored beneficiary a/c line               *   S01177
     C*            @DTP1  - stored details of payment 1               *   S01177
     C*            @DTP2  - stored details of payment 2               *   S01177
     C*            @DTP3  - stored details of payment 3               *   S01177
     C*            @DTP4  - stored details of payment 4               *   S01177
     C*            @DCHG  - stored details of charges                 *   S01177
     C*            @BTB1  - stored bank to bank info 1                *   S01177
     C*            @BTB2  - stored bank to bank info 2                *   S01177
     C*            @BTB3  - stored bank to bank info 3                *   S01177
     C*            @BTB4  - stored bank to bank info 4                *   S01177
     C*            @BTB5  - stored bank to bank info 5                *   S01177
     C*            @BTB6  - stored bank to bank info 6                *   S01177
     C*            @CVMR  - cover MT202 required                      *   E22405
     C*            @STSA  - Array to hold status text.                *
     C*            @DLUP  - Stored day of last update.                *
     C*            @MLUP  - Stored month of last update.              *
     C*            @YLUP  - Stored year of last update.               *
     C*            @TLUP  - Stred time of last update.                *
     C*            @BOKC  - Stored version of DDBOKC.                 *   S01165
     C*            @LNKN  - Stored version of DDLNKN.                 *   S01165
     C*            @DRID  - Stored version of DDDRID.                 *   S01176
     C*            @DDMR  - Stored version of DDDDMR.                 *   S01176
     C*                                                               *
     C*****************************************************************
     C           #ZD       BEGSR
     C/COPY WNCPYSRC,MM0089C163
     C*
     C**  Moves fields from file into program work fields and screen
     C**  fields.
     C*
     C**  Deal number.
     C                     MOVE HKDN38    @DLNO
     C                     MOVE @DLNO     DDDLNO
     C*                                                                   AUS007
     C**  Access R/A Indicator for deal if Australian Brokerage           AUS007
     C**  is switched on                                                  AUS007
     C*                                                                   AUS007
     C           AUS007    IFEQ 'Y'                                       AUS007
     C           HKDN38    CHAINFORAT                65                   AUS007
     C           *IN65     IFEQ '0'                                       AUS007
     C                     MOVE RACD      DDRACD                          AUS007
     C                     ELSE                                           AUS007
     C                     MOVE *BLANKS   DDRACD                          AUS007
     C                     END                                            AUS007
     C                     MOVE DDRACD    @RACD                           AUS007
     C                     END                                            AUS007
     C*
     C**  Deal type.
     C                     MOVE HKMTYP    @TYPE
     C                     MOVE @TYPE     DDTYPE
      *                                                                   CAC001
      **  Enable F19 for Funding Information if Analytical Accounting     CAC001
      **  is installed and deal type is not 'IL', 'ID'.                   CAC001
      *                                                                   CAC001
     C                     MOVE '0'       *IN88                           CAC001
     C                     MOVE '0'       *IN89                           CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
     C           DDTYPE    IFNE 'IL'                                      CAC001
     C           DDTYPE    ANDNE'ID'                                      CAC001
     C                     MOVE '1'       *IN88                           CAC001
      *                                                                   CAC001
      **  Set on *IN89 for action code 'D' or 'E' to enable F19           CAC001
     C           DDACTN    IFEQ 'D'                                       CAC001
     C           DDACTN    OREQ 'E'                                       CAC001
     C                     MOVE '1'       *IN89                           CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*
     C**  Deal sub-type.
     C                     MOVE HKSTYP    @STYP
     C                     MOVE @STYP     DDSTYP
     C/COPY WNCPYSRC,MM0089C010
     C*                                                                   S01136
     C**  Federal funds indicator                                         S01136
     C                     MOVE HKFEDF    @FEDF                           S01136
     C                     MOVE @FEDF     DDFEDF                          S01136
     C/COPY WNCPYSRC,MM0089C011
      *                                                                   S01486
      **  Portfolio Reference                                             S01486
      *                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   S01486
     C           HKPTFR    IFEQ '9997'                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCR997    @PTFR                           S01486
     C                     ELSE                                           S01486
     C                     MOVE HKPTFR    @PTFR                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     MOVE @PTFR     DDPTFR                          S01486
     C                     END                                            S01486
     C*
     C**  Format the deal date.
     C*                                                                   S01434
     C           @TERM1    IFEQ 'R'                                       S01434
     C                     Z-ADDBJRDNB    @@DAYN                          S01434
     C                     EXSR ZDATE9                                    S01434
     C                     Z-ADD@@VDT     @DATE                           S01434
     C                     ELSE                                           S01434
     C                     Z-ADDHKDDYY    @YEAR
     C                     Z-ADDHKDDMM    @MNTH
     C                     Z-ADDHKDDDD    @DAY
     C                     END                                            S01434
     C*
     C           @DATE     IFEQ 0                          B1
     C                     MOVE *BLANKS   DDDLDT           *1
     C                     MOVE *BLANKS   @DLDT            *1
     C                     ELSE                            X1
     C                     Z-ADD@DATE     @@DTIN           *1
     C                     EXSR ZA0770                     *1
     C                     MOVE @@DTOU    @DLDT            *1
     C                     MOVE @@DTOU    DDDLDT           *1
     C                     END                             E1
     C*
     C**  Branch code.
     C*****                MOVE *BLANKS   @BRCD                           S01117
     C*****                MOVE *BLANKS   DDBRCD                          S01117
     C*****      HKBRCD    IFNE 0                          B1             S01117
     C*****                MOVE HKBRCD    @BRCD            *1             S01117
     C*****                MOVE @BRCD     DDBRCD           *1             S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   @BRCA                           S01117
     C                     MOVE *BLANKS   DDBRCA                          S01117
     C           HKBRCA    IFNE *BLANKS                    B1             S01117
     C                     MOVE HKBRCA    @BRCA            *1             S01117
     C                     MOVE @BRCA     DDBRCA           *1             S01117
     C*                                                                   S01117
     C                     END                             E1
     C*
     C**  Broker Code.
     C                     MOVE HKBKCD    @BKCD
     C                     MOVE @BKCD     DDBKCD
     C*
     C**  Brokerage amount.
     C**  - Execute ZA0920 to format brokerage, using Broker Ccy
     C**    decimal places.
     C           HKBRKG    IFEQ *ZERO                      B1
     C********** HKBKCD    IFEQ 'PHON'                     B*2            E14377
     C********** HKBKCD    OREQ 'MAIL'                     B*2            E14377
     C********** HKBKCD    OREQ 'TELX'                     B*2            E14377
     C********** HKBKCD    OREQ *BLANK                     B*2            E14377
     C**********           MOVE *BLANKS   @BRKG            **2            E14377
     C**********           MOVE *BLANKS   DDBRKG           **2            E14377
     C**********           ELSE                            X*2            E14377
     C                     MOVE *BLANKS   @BRKG            **2
     C                     MOVE *BLANKS   DDBRKG           **2
     C                     MOVE '0'       @BRKG            **2
     C                     MOVE '0'       DDBRKG           **2
     C**********           END                             E*2            E14377
     C                     END                             E1
     C*
     C**  IF BROKERAGE ALL 9'S OUTPUT BLANK
     C           HKBRKG    IFEQ *ALL'9'                    B1
     C                     MOVE *BLANKS   @BRKG            *1
     C                     MOVE *BLANKS   DDBRKG           *1
     C                     END                             E1
     C***********                                                  DT0012 063375
     C****IF*BROKERAGE*ALL*0'S*OUTPUT*'NIL'************************DT0012 063375
     C***********HKBRKG    IFEQ *ALL'0'                            DT0012 063375
     C***********          MOVE *BLANKS   @BRKG                    DT0012 063375
     C***********          MOVE *BLANKS   DDBRKG                   DT0012 063375
     C***********          MOVEL'NIL'     DDBRKG                   DT0012 063375
     C***********          MOVEL'NIL'     @BRKG                    DT0012 063375
     C***********          END                                     DT0012 063375
     C*
     C**  IF BROKERAGE A NUMBER REFORMAT
     C           HKBRKG    IFNE *ALL'9'                    B1
     C***********HKBRKG    ANDNE*ALL'0'                            DT0012 063375
     C           HKBRKG    ANDNE*ZERO                      B1
     C********** DDBKCD    IFEQ 'PROM'                     B*2            E14377
     C**********           Z-ADD1         @@QECN           **2            E14377
     C**********           Z-ADDHKBRKG    @@AMTW           **2            E14377
     C**********           EXSR ZA0920                     **2            E14377
     C**********           MOVE @@AMTD    DDBRKG           **2            E14377
     C**********           MOVE @@AMTD    @BRKG            **2            E14377
     C**********           ELSE                            X*2            E14377
     C**********           Z-ADD0         DEC     10       **2            E14353
     C**********           Z-ADDHKBRKG    NWBRKG 130       **2            E14353
     C********** DEC       DOWLTHKBCDP                     D**3           E14353
     C********** NWBRKG    DIV  10        NWBRKG           ***3           E14353
     C**********           ADD  1         DEC              ***3           E14353
     C**********           END                             E**3           E14353
     C**********           Z-ADD0         @@QECN           **2            E14353
     C**********           Z-ADDNWBRKG    @@AMTW           **2            E14353
      *                                                                   E14353
      ***set*up*key*to currency file to get number of decimal       E14353S01194
      ***places*for*the broker currency                             E14353S01194
     C*****                MOVE *BLANKS   @KEY             **2      E14353S01194
     C*****                MOVE '20'      @KEY1            **2      E14353S01194
     C*****                MOVE HKBKCY    @KEY2            **2      E14353S01194
     C*****                MOVE '1'       @KEY3            **2      E14353S01194
     C*****      @KEY      CHAINFDCCYTLL             65    **2      E14353S01194
      *****                                                         E14353S01194
      ***if**in65 is on, then it is a data base error               E14353S01194
     C*****      *IN65     IFEQ '1'                        B**3     E14353S01194
     C*****      RECI      ORNE 'D'                        ***3     E14353S01194
     C*****                MOVE '1'       *INLR            ***3     E14353S01194
     C*****                MOVE '1'       *INU7            ***3     E14353S01194
     C*****                MOVE '1'       *INU8            ***3     E14353S01194
     C*****                MOVE '1'       *INKA            *********E14353S01194
     C*****                MOVEL'FDCCYTLL'DBFILE           * DBERRORE14353S01194
     C*****                MOVE '025'     DBASE            *********E14353S01194
     C*****                MOVEL@KEY      DBKEY            ***3     E14353S01194
     C*****                GOTO #ZD9                       ***3     E14353S01194
     C*****                END                             E**3     E14353S01194
      *  access currency file to get number of decimal places for         S01194
      *  the broker currency                                              S01194
      *  (database error handling done in access program)                 S01194
     C*                                                                   BHF365
     C** If brokerage ccy is blank, assume deal currency.  Actually,      BHF365
     C** HKBCDP should already hold the brokerage decimal places, but     BHF365
     C** it isn't reliable, so call AOCURRR0 to be safe.                  BHF365
     C           AUS007    IFEQ 'N'                                       AUS007
     C           AUS007    OREQ 'Y'                                       AUS007
     C           DDRACD    ANDNE'R'                                       AUS007
     C           HKBKCY    IFNE *BLANKS                    **2            BHF365
     C                     MOVE HKBKCY    @AJCD   3        **2            BHF365
     C                     ELSE                            **2            BHF365
     C                     MOVE HKCCY     @AJCD            **2            BHF365
     C                     END                             **2            BHF365
     C*                                                                   BHF365
     C                     CALL 'AOCURRR0'                 **2            S01194
     C                     PARM '*DBERR ' @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C***********          PARM HKBKCY    @AJCD   3        **2     S01194 BHF365
     C                     PARM           @AJCD            **2            BHF365
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C                     ELSE                                           AUS007
     C           AUS007    IFEQ 'Y'                                       AUS007
     C                     Z-ADD7         A6NBDP                          AUS007
     C                     END                                            AUS007
     C                     END                                            AUS007
      *                                                                   E14353
      ** call ZA0920 using the CDP just obtained to format brokerage      E14353
     C*****                Z-ADDCDP       @@QECN           **2      E14353S01194
     C                     Z-ADDA6NBDP    @@QECN           **2            S01194
     C                     Z-ADDHKBRKG    @@AMTW                          E14353
     C                     EXSR ZA0920                     **2
     C                     MOVE @@AMTD    DDBRKG           **2
     C                     MOVE @@AMTD    @BRKG            **2
     C**********           END                             E*2            E14377
     C                     END                             E1
     C*
     C**  Rollover Deal Number.
     C                     MOVE HKDADN    @DADN
     C                     MOVE @DADN     DDDADN
     C*
     C**  Customer.
     C                     MOVE *BLANKS   @CUST
     C                     MOVE *BLANKS   DDCUST
     C********** HKCNUM    IFNE 0                          B1                                CSD027A
     C           HKCNUM    IFNE *BLANKS                    B1                                CSD027A
     C                     MOVELHKCNUM    @CUST            *1
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C133                                           S01408
      *                                                                   S01408
     C                     MOVE @CUST     @SAVCU 10        *1             087755
     C                     MOVE @CUST     DDCUST           *1
     C/COPY WNCPYSRC,MM0089C012
     C                     END                             E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C144                                           S01408
     C*                                                                   S01408
     C*
     C**  Format the value date.
     C                     Z-ADDHKVDYY    @YEAR
     C                     Z-ADDHKVDMM    @MNTH
     C                     Z-ADDHKVDDD    @DAY
     C           @DATE     IFEQ 0                          B1
     C                     MOVE *BLANKS   DDVDAT           *1
     C                     MOVE *BLANKS   @VDAT            *1
     C/COPY WNCPYSRC,MM0089C199
     C                     ELSE                            X1
     C                     Z-ADD@DATE     @@DTIN           *1
     C                     EXSR ZA0770                     *1
     C                     MOVE @@DTOU    DDVDAT           *1
     C                     MOVE @@DTOU    @VDAT            *1
     C/COPY WNCPYSRC,MM0089C200
     C                     END                             E1
     C*
     C**  Format the Maturity Date.
     C/COPY WNCPYSRC,MM0089C164
     C                     Z-ADDHKMDYY    @YEAR
     C                     Z-ADDHKMDMM    @MNTH
     C                     Z-ADDHKMDDD    @DAY
     C/COPY WNCPYSRC,MM0089C165
     C           @DATE     IFEQ 0                          B1
     C                     MOVE *BLANKS   DDMDAT           *1
     C                     MOVE *BLANKS   @MDAT            *1
     C/COPY WNCPYSRC,MM0089C201
     C                     ELSE                            X1
     C                     Z-ADD@DATE     @@DTIN           *1
     C                     EXSR ZA0770                     *1
     C                     MOVE @@DTOU    DDMDAT           *1
     C/COPY WNCPYSRC,MM0089C166
     C                     MOVE @@DTOU    @MDAT            *1
     C/COPY WNCPYSRC,MM0089C167
     C                     END                             E1
     C*
     C**  Format the Interest Accrual Control date.
     C                     Z-ADDHKIAYY    @YEAR
     C                     Z-ADDHKIAMM    @MNTH
     C                     Z-ADDHKIADD    @DAY
     C           @DATE     IFEQ 0                          B1
     C                     MOVE *BLANKS   @IADT            *1
     C                     ELSE                            X1
     C                     Z-ADD@DATE     @@DTIN           *1
     C                     EXSR ZA0770                     *1
     C                     MOVE @@DTOU    @IADT            *1
     C                     END                             E1
     C*
     C**  Format the Last Interest date.
     C                     Z-ADDHKSLYY    @YEAR
     C                     Z-ADDHKSLMM    @MNTH
     C                     Z-ADDHKSLDD    @DAY
     C           @DATE     IFEQ 0                          B1
     C                     MOVE *ZEROS    @LIDT            *1
     C                     ELSE                            X1
     C                     Z-ADD@DATE     @@DTIN           *1
     C                     EXSR ZA0770                     *1
     C                     MOVE @@DTOU    @LIDT            *1
     C                     END                             E1
     C*
     C**  Notice Days.
     C           HKNTCE    IFEQ 0                          B1
     C                     MOVE *BLANKS   DDNTCE           *1
     C                     MOVE *BLANKS   @NTCE            *1
     C                     Z-ADD*ZEROS    @NTCNM           *1
     C           DDTYPE    IFEQ 'CD'                       B*2
     C           DDMDAT    ANDEQ*BLANKS                    B*2
     C           DDTYPE    OREQ 'CL'                       B*2
     C           DDMDAT    ANDEQ*BLANKS                    B*2
     C           DDTYPE    OREQ 'DL'                       B*2
     C           DDMDAT    ANDEQ*BLANKS                    B*2
     C                     MOVE 0         DDNTCE           **2
     C                     MOVE 0         @NTCE            **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C168
     C                     ELSE                            X1
     C           HKNTCE    IFEQ -999                       B*2
     C                     MOVE *BLANKS   DDNTCE           **2
     C                     MOVE *BLANKS   @NTCE            **2
     C                     Z-SUB999       @NTCNM           **2
     C                     ELSE                            X*2
     C                     Z-ADDHKNTCE    @@AMTW           **2
     C                     Z-ADD0         @@QECN           **2
     C                     EXSR ZA0920                     **2
     C                     MOVE @@AMTD    DDNTCE           **2
     C                     MOVE @@AMTD    @NTCE            **2
     C                     Z-ADDHKNTCE    @NTCNM           **2
     C                     END                             E*2
     C                     END                             E1
     C***********                                                         E25515
     C****Facility Number.                                                E25515
     C***********HKFCLY    IFEQ 0                          B1             E25515
     C***********          MOVE *BLANKS   DDFCLY           *1             E25515
     C***********          MOVE *BLANKS   @FCLY            *1             E25515
     C***********          ELSE                            X1             E25515
     C***********          MOVE HKFCLY    DDFCLY           *1             E25515
     C***********          MOVE DDFCLY    @FCLY            *1             E25515
     C***********          END                             E1             E25515
     C*
     C**  Account Sequnce Number.
     C           HKACSQ    IFEQ 0                          B1
     C                     MOVE *BLANKS   DDACSQ           *1
     C                     MOVE *BLANKS   @ACSQ            *1
     C                     ELSE                            X1
     C                     MOVE HKACSQ    DDACSQ           *1
     C                     MOVE DDACSQ    @ACSQ            *1
     C                     END                             E1
     C*
     C**  Currency Code.
     C                     MOVE HKCCY     DDCCY
     C                     MOVE DDCCY     @CCY
     C*  Saved amt and base ccy rate                                      E46993
     C                     MOVE HKAMNP    @@DAMT                          E46993
     C                     MOVE HKBRAT    @@RATS                          E46993
     C*
     C**  Deal Amount.
     C**  - Execute ZA0920 to format Deal Amount, using Deal Ccy
     C**    decimal places.
     C           HKAMNP    IFLT 0                          B1
     C                     Z-SUBHKAMNP    @@AMTW           *1
     C                     ELSE                            X1
     C                     Z-ADDHKAMNP    @@AMTW           *1
     C                     END                             E1
     C                     Z-ADDHKCYDP    @@QECN
     C                     EXSR ZA0920
     C                     MOVE @@AMTD    DDAMNP
     C                     MOVE @@AMTD    @AMNP
     C*
     C**  Base Currency Rate.
     C*
     C**  Access the currency file to find the dealing currency
     C**  scaling exponent.
     C*****                MOVE *BLANKS   @KEY                            S01194
     C*****                MOVE '20'      @KEY1                           S01194
     C*****                MOVE DDCCY     @KEY2                           S01194
     C*****                MOVE '1'       @KEY3                           S01194
     C*****      @KEY      CHAINFDCCYTLL             65                   S01194
     C*****                                                               S01194
     C****If no valid record found then it is a data base error.          S01194
     C*****      *IN65     IFEQ '1'                        B1             S01194
     C*****                MOVE '1'       *INU7            *1             S01194
     C*****                MOVE '1'       *INU8            ***************S01194
     C*****                MOVEL'FDCCYTLL'DBFILE           * DBERROR 021 *S01194
     C*****                MOVEL@KEY      DBKEY            ***************S01194
     C*****                MOVE '021'     DBASE            *1             S01194
     C*****                MOVE '1'       *INLR            *1             S01194
     C*****                MOVE '1'       *INKC            *1             S01194
     C*****                                                               S01194
     C*****                EXSR #C                         *1             S01194
     C*****                END                             E1             S01194
      *  access currency file to get number of decimal places for         S01194
      *  the broker currency                                              S01194
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM DDCCY     @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*
     C**  Scale the Base Currency Exchange Rate.
     C*****                Z-ADDSEXP      @@SXP1                          S01194
     C                     Z-ADDA6SCEX    @@SXP1                          S01194
     C                     Z-ADD0         @@SXP2
     C                     Z-ADDHKBRAT    @@INRT
     C                     MOVE 'M'       @@FCMD
     C                     EXSR ZA1150
     C*
     C**  If the error code is 1 or 3, it is a data base error.
     C           @@ERCD    IFEQ 1
     C           @@ERCD    OREQ 3
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            ***************
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVEL'SCALING 'DBFILE           * DBERROR 022 *
     C                     MOVEL'HKBRAT'  DBKEY            ***************
     C                     MOVE '022'     DBASE            *1
     C                     OUT  LDA                                       E24039
     C                     MOVE '1'       *INLR            *1
     C                     MOVE '1'       *INKC            *1
     C*
     C                     EXSR #C                         *1
     C                     END                             E1
     C*
     C**  - Execute ZA0920 to format the rate, using 8 decimal places
     C**    and adjusting the file figure to have only implied decimal
     C**    places.
     C           @@SCRT    IFNE 0                          B1
     C           @@SCRT    MULT 100000000 @@AMTW           *1
     C                     Z-ADD8         @@QECN           *1
     C                     EXSR ZA0920                     *1
     C                     MOVE @@AMTD    DDBRAT           *1
     C                     MOVE @@AMTD    @BRAT            *1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   DDBRAT           *1
     C                     MOVE *BLANKS   @BRAT            *1
     C                     END                             E1
     C*
     C**  Base Rate Code.
     C           HKBSRC    IFEQ *ZEROS                     B1
     C                     MOVE *BLANKS   DDBSRC           *1
     C                     MOVE *BLANKS   @BSRC            *1
     C                     ELSE                            X1
     C                     MOVE HKBSRC    DDBSRC           *1
     C                     MOVE DDBSRC    @BSRC            *1
     C                     END                             E1
     C*
     C**  Spread/Rate - if no Base Rate Code has been entered, use the
     C**  Input Interest Rate, otherwise use the Spread.
     C**                                                                  109275
     C                     Z-ADD0         @@AMTW                          109275
     C**                                                                  109275
     C           @BSRC     IFEQ *BLANKS                    B1
     C           HKIIRT    IFLT 0                          B*2
     C                     Z-SUBHKIIRT    HKIIRT           **2
     C                     END                             E*2
     C                     MOVE HKIIRT    @@AMTW           *1
     C                     ELSE                            X1
     C           HKSPRD    IFLT 0                          B*2
     C                     Z-SUBHKSPRD    HKSPRD           **2
     C                     END                             E*2
     C                     MOVE HKSPRD    @@AMTW           *1
     C                     END                             E1
     C**  - Execute ZA0920 to format the Spread/Rate, using 7 decimal
     C**    and adjusting the file figure to have only implied decimal
     C**    places.
     C                     Z-ADD7         @@QECN
     C                     EXSR ZA0920
     C                     MOVE @@AMTD    DDSPRT
     C                     MOVE @@AMTD    @SPRT
     C*
     C/COPY WNCPYSRC,MM0089C248
     C**  Interest Calculation Method.
     C                     MOVE HKICMT    DDICMT
     C                     MOVE DDICMT    @ICMT
     C/COPY WNCPYSRC,MM0089C400
     C*
     C**  Negative Interest Indicator.
     C                     MOVE HKNGVI    DDNGVI
     C                     MOVE DDNGVI    @NGVI
     C*
     C**  Interest Payment Frequency.
     C                     MOVE HKIPFQ    DDIPFQ
     C                     MOVE DDIPFQ    @IPFQ
     C*
     C**  Format the Next Interest Date.
     C                     Z-ADDHKNIYY    @YEAR
     C                     Z-ADDHKNIMM    @MNTH
     C                     Z-ADDHKNIDD    @DAY
     C           @DATE     IFEQ 0                          B1
     C                     MOVE *BLANKS   DDNDAT           *1
     C                     MOVE *BLANKS   @NDAT            *1
     C                     ELSE                            X1
     C                     Z-ADD@DATE     @@DTIN           *1
     C                     EXSR ZA0770                     *1
     C                     MOVE @@DTOU    DDNDAT           *1
     C                     MOVE @@DTOU    @NDAT            *1
     C                     END                             E1
     C           DDIPFQ    IFEQ 'N'                                       AUS003
     C                     MOVE *BLANKS   DDNDAT                          AUS003
     C                     MOVE *BLANKS   @NDAT                           AUS003
     C                     END                                            AUS003
     C*
     C**  Total interest amount.
     C**  - Execute ZA0920 to format Total Interest Amount, using
     C**    Deal Ccy decimal places.
     C           HKMTTI    IFLT 0                          B1
     C                     Z-SUBHKMTTI    @@AMTW           *1
     C                     ELSE                            X1
     C                     Z-ADDHKMTTI    @@AMTW           *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C202
     C                     Z-ADDHKCYDP    @@QECN
     C                     EXSR ZA0920
     C                     MOVE @@AMTD    DDTOTI
     C                     MOVE @@AMTD    @TOTI
     C/COPY WNCPYSRC,MM0089C525
     C*
     C**  Interest Payment Day of Month.
     C           HKIPDM    IFEQ 0                          B1
     C                     MOVE *BLANKS   DDIPDM           *1
     C                     MOVE *BLANKS   @IPDM            *1
     C                     ELSE                            X1
     C                     MOVE HKIPDM    DDIPDM           *1
     C                     MOVE DDIPDM    @IPDM            *1
     C                     END                             E1
     C*
     C           HKIPFQ    IFEQ *BLANK                     B1
     C           HKIPDM    ANDNE0                          *1
     C                     MOVE *BLANKS   DDIPDM           *1
     C                     MOVE *BLANKS   @IPDM            *1
     C                     END                             E1
     C           DDIPFQ    IFEQ 'N'                                       AUS003
     C                     MOVE *BLANKS   DDIPDM                          AUS003
     C                     MOVE *BLANKS   @IPDM                           AUS003
     C                     END                                            AUS003
     C*
     C**  Interest Capitalisation Indicator.
     C                     MOVE HKCPTI    DDCPTI
     C                     MOVE DDCPTI    @CPTI
     C*
     C**  Taxable Indicator.
     C*                                                                   S01383
     C** IF BRT SAR IS INSTALLED                                          S01383
     C*                                                                   S01383
     C           S01383    IFEQ 'Y'                                       S01383
     C                     MOVE HKMTAX    DDMTAX                          S01383
     C                     ELSE                                           S01383
     C           HKMTAX    IFEQ *BLANKS                    B1             E16709
     C                     MOVE 'N'       DDMTAX           *1             E16709
     C                     ELSE                            X1             E16709
     C                     MOVE HKMTAX    DDMTAX
     C                     END                             X1             E16709
     C                     END                                            S01383
     C                     MOVE DDMTAX    @MTAX
     C*
     C**  C.D. Reference Number.
     C                     MOVE HKCDRF    DDCDRF
     C                     MOVE DDCDRF    @CDRF
     C*
     C**  Current Holder of CD.
     C********** HKMCDH    IFEQ 0                          B1                                CSD027A
     C           HKMCDH    IFEQ *BLANKS                    B1                                CSD027A
     C                     MOVE *BLANKS   DDCDCH           *1
     C                     MOVE *BLANKS   @CDCH            *1
     C                     ELSE                            X1
     C                     MOVE HKMCDH    DDCDCH           *1
     C                     MOVE DDCDCH    @CDCH            *1
     C                     END                             E1
     C*                                                                   S01392
     C**  Front Up Interest Indicator                                     S01392
     C*                                                                   S01392
     C                     MOVE HKFUID    @FUID                           S01392
     C                     MOVE @FUID     DDFUID                          S01392
     C*                                                                   S01392
     C**  First & Last Day Interest Indicator                             S01392
     C*                                                                   S01392
     C                     MOVE HKFLID    @FLID                           S01392
     C                     MOVE @FLID     DDFLID                          S01392
     C*                                                                   S01392
     C**  Round Down Interest Indicator                                   S01392
     C*                                                                   S01392
     C                     MOVE HKRDFC    @RDFC                           S01392
     C                     MOVE @RDFC     DDRDFC                          S01392
     C**  Book code.                                                      S01165
     C                     MOVE HKBOKC    @BOKC                           S01165
     C                     MOVE @BOKC     DDBOKC                          S01165
     C*                                                                   S01165
     C**  Linked reference number.                                        S01165
     C           HKLNKN    IFNE *ZEROS                                    E19066
     C                     MOVE HKLNKN    @LNKN                           S01165
     C                     ELSE                                           E19066
     C                     MOVE *BLANKS   @LNKN                           E19066
     C                     END                                            E19066
     C                     MOVE @LNKN     DDLNKN                          S01165
     C*                                                                   065492
     C** Special processing for ID/IL deals                               065492
     C*                                                                   065492
     C           HKMTYP    IFEQ 'ID'                                      065492
     C           HKMTYP    OREQ 'IL'                                      065492
     C                     MOVE *BLANKS   DDDADN                          065492
     C                     MOVE HKDADN    @LNKN                           065492
     C                     MOVE @LNKN     DDLNKN                          065492
     C                     END                                            065492
     C*                                                                   S01176
     C**  Repo/Pledge Indicator                                           S01176
     C                     MOVE HKDRID    @DRID                           S01176
     C                     MOVE @DRID     DDDRID                          S01176
     C*                                                                   S01176
     C**  Repo/Pledge Number                                              S01176
     C                     MOVE HKDDMR    @DDMR                           S01176
     C                     MOVE @DDMR     DDDDMR                          S01176
     C*
     C**  Originating Branch and Profit Centre                            S01117
     C                     MOVE HKORBR    DDORBR                          S01117
     C                     MOVE HKORBR    @ORBR                           S01117
     C/COPY WNCPYSRC,MM0089C510
     C                     MOVE HKPRFC    DDPRFC                          S01117
     C                     MOVE HKPRFC    @PRFC                           S01117
     C/COPY WNCPYSRC,MM0089C511
     C*                                                                   S01434
     C**  Automatic Rollover Indicator                                    S01434
     C*                                                                   S01434
     C                     MOVE HKAURO    @AURO                           S01434
     C                     MOVE HKAURO    DDAURO                          S01434
     C*                                                                   S01434
     C**  Interest Paid Separately Indicator                              S01434
     C*                                                                   S01434
     C                     MOVE HKIPDS    @IPDS                           S01434
     C                     MOVE HKIPDS    DDIPDS                          S01434
     C*                                                                   S01434
     C**  Rollover Frequency                                              S01434
     C*                                                                   S01434
     C                     MOVE HKROFQ    @ROFQ                           S01434
     C                     MOVE HKROFQ    DDROFQ                          S01434
     C*                                                                   S01434
     C**  Rollover Day Number                                             S01434
     C*                                                                   S01434
     C                     MOVE HKRLDN    @RLDN                           S01434
     C                     MOVE HKRLDN    DDRLDN                          S01434
     C           HKRLDN    IFEQ 0                                         S01434
     C                     MOVE *BLANKS   @RLDN                           S01434
     C                     MOVE *BLANKS   DDRLDN                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C**  Interest Settlement Method                                      S01434
     C*                                                                   S01434
     C                     MOVE HKIMET    @IMET                           S01434
     C                     MOVE HKIMET    DDIMET                          S01434
     C*                                                                   S01434
     C**  Interest Settlement Account                                     S01434
     C*                                                                   S01434
     C                     MOVE HKINSA    @INSA                           S01434
     C                     MOVE HKINSA    @@INSA                          S01434
     C                     MOVE HKINSA    DDINSA                          S01434
     C                     MOVELHKINSA    DDINSN                          S01434
     C*                                                                   S01434
     C**  Interest Counterparty Nostro                                    S01434
     C*                                                                   S01434
     C                     MOVE HKINOS    @INOS                           S01434
     C                     MOVE HKINOS    DDINOS                          S01434
     C*                                                                   CEU003
     C                     MOVE HKISCY    @ISCY                           CEU003
     C                     MOVE HKISCY    DDISCY                          CEU003
     C                     MOVE HKII72    @II72                           CEU003
     C                     MOVE HKII72    DDII72                          CEU003
     C*                                                                   S01434
     C**  Confirmation Narrative                                          S01434
     C*                                                                   S01434
     C                     MOVE HKCNNA    @CNNA                           S01434
     C                     MOVE HKCNNA    DDCNNA                          S01434
      *                                                                   S01117
     C**  Receipt Settlement Method.
     C*****                MOVE HKORCM    DDORCM                          S01177
     C*****                MOVE DDORCM    @ORCM                           S01177
     C                     MOVELHKRSTM    PMRSTM                          S01177
     C                     MOVELPMRSTM    @RSTM                           S01177
     C*
     C**  Payment Settlement Method.
     C*****                MOVE HKMOPM    DDMOPM                          S01177
     C*****                MOVE DDMOPM    @MOPM                           S01177
     C                     MOVELHKPSTM    PMPSTM                          S01177
     C                     MOVELPMPSTM    @PSTM                           S01177
     C*
     C**  Our Receive Instructions.
     C*****      HKORCM    IFEQ 4                          B1             S01177
     C*****                MOVE *BLANKS   DDMORI           *1             S01177
     C*****                MOVE *BLANKS   @MORI            *1             S01177
     C*****                ELSE                            X1             S01177
     C*****                MOVE HKMORI    DDMORI           *1             S01177
     C*****                MOVE DDMORI    @MORI            *1             S01177
     C*****                END                             E1             S01177
     C*
     C           HKRSTM    IFEQ 04                         B1             S01177
     C                     MOVE *BLANKS   PMRONS           *1             S01177
     C                     MOVE *BLANKS   @RONS            *1             S01177
     C                     ELSE                            X1             S01177
     C                     MOVELHKRONS    PMRONS           *1             S01177
     C                     MOVELPMRONS    @RONS            *1             S01177
     C                     END                             E1             S01177
     C*                                                                   S01177
     C**  Our Pay Instructions.
     C*****      HKMOPM    IFEQ 4                          B1             S01177
     C*****                MOVE *BLANKS   DDMOPI           *1             S01177
     C*****                MOVE *BLANKS   @MOPI            *1             S01177
     C*****                ELSE                            X1             S01177
     C*****                MOVE HKMOPI    DDMOPI           *1             S01177
     C*****                MOVE DDMOPI    @MOPI            *1             S01177
     C*****                END                             E1             S01177
     C*
     C           HKPSTM    IFEQ 04                         B1             S01177
     C                     MOVE *BLANKS   PMPONS           *1             S01177
     C                     MOVE *BLANKS   @PONS            *1             S01177
     C                     ELSE                            X1             S01177
     C                     MOVELHKPONS    PMPONS           *1             S01177
     C                     MOVELPMPONS    @PONS            *1             S01177
     C                     END                             E1             S01177
     C*                                                                   S01177
     C**  Counterparty Pay Instructions.
     C*****                MOVE HKMCPI    DDMCPI                          S01177
     C*****                MOVE DDMCPI    @MCPI                           S01177
     C                     MOVELHKRIBN    PARIBN                          S01177
     C                     MOVELPARIBN    @RIBN                           S01177
     C                     MOVE *BLANKS   PMRIBN                          S01177
     C                     MOVELPARIBN    PMRIBN                          S01177
     C*
     C**  Counterparty Receive Instructions.
     C*****                MOVE HKMCRI    DDMCRI                          S01177
     C*****                MOVE DDMCRI    @MCRI                           S01177
     C                     MOVELHKAWBN    PAAWBN                          S01177
     C                     MOVELPAAWBN    @AWBN                           S01177
     C                     MOVE *BLANKS   PMAWBN                          S01177
     C                     MOVELPAAWBN    PMAWBN                          S01177
     C*
     C**  For Account-of Instructions.
     C*****                MOVE HKMFAO    DDMFAO                          S01177
     C*****                MOVE DDMFAO    @MFAO                           S01177
     C                     MOVELHKBENN    PABENN                          S01177
     C                     MOVELPABENN    @BENN                           S01177
     C                     MOVE *BLANKS   PMBENN                          S01177
     C                     MOVELPABENN    PMBENN                          S01177
     C*
     C**  Special Instructions.
     C*****                MOVE HKSPEC    DDSPEC                          S01177
     C*****                MOVE DDSPEC    @SPEC                           S01177
     C                     MOVELHKBTB1    PMBTB1                          S01177
     C                     MOVELPMBTB1    @BTB1                           S01177
     C*                                                                   S01177
     C**  Rcpt - Intermediary bank A/C line                               S01177
     C                     MOVELHKRIBA    PMRIBA                          S01177
     C                     MOVELPMRIBA    @RIBA                           S01177
     C*                                                                   S01177
     C**  Rcpt - Ordering bank no.                                        S01177
     C           HKROBN    IFEQ *ZERO                                     S01177
     C                     MOVE *BLANKS   PAROBN                          S01177
     C                     ELSE                                           S01177
     C                     MOVELHKROBN    PAROBN                          S01177
     C                     END                                            S01177
     C                     MOVELPAROBN    @ROBN                           S01177
     C                     MOVE *BLANKS   PMROBN                          S01177
     C                     MOVELPAROBN    PMROBN                          S01177
     C*                                                                   S01177
     C**  Rcpt - Ordering customer no.                                    S01177
     C           HKROCN    IFEQ *ZERO                                     S01177
     C                     MOVE *BLANKS   PAROCN                          S01177
     C                     ELSE                                           S01177
     C                     MOVELHKROCN    PAROCN                          S01177
     C                     END                                            S01177
     C                     MOVELPAROCN    @ROCN                           S01177
     C                     MOVE *BLANKS   PMROCN                          S01177
     C                     MOVELPAROCN    PMROCN                          S01177
     C*                                                                   S01177
     C**  Pay  - Intermediary bank no.                                    S01177
     C                     MOVELHKPIBN    PAPIBN                          S01177
     C                     MOVELPAPIBN    @PIBN                           S01177
     C                     MOVE *BLANKS   PMPIBN                          S01177
     C                     MOVELPAPIBN    PMPIBN                          S01177
     C*                                                                   S01177
     C**  Pay  - Intermediary bank A/C line                               S01177
     C                     MOVELHKPIBA    PMPIBA                          S01177
     C                     MOVELPMPIBA    @PIBA                           S01177
     C*                                                                   S01177
     C**  Pay  - Ordering bank no.                                        S01177
     C           HKPOBN    IFEQ *ZERO                                     S01177
     C                     MOVE *BLANKS   PAPOBN                          S01177
     C                     ELSE                                           S01177
     C                     MOVELHKPOBN    PAPOBN                          S01177
     C                     END                                            S01177
     C                     MOVELPAPOBN    @POBN                           S01177
     C                     MOVE *BLANKS   PMPOBN                          S01177
     C                     MOVELPAPOBN    PMPOBN                          S01177
     C*                                                                   S01177
     C**  Pay  - Ordering customer no.                                    S01177
     C           HKPOCN    IFEQ *ZERO                                     S01177
     C                     MOVE *BLANKS   PAPOCN                          S01177
     C                     ELSE                                           S01177
     C                     MOVELHKPOCN    PAPOCN                          S01177
     C                     END                                            S01177
     C                     MOVELPAPOCN    @POCN                           S01177
     C                     MOVE *BLANKS   PMPOCN                          S01177
     C                     MOVELPAPOCN    PMPOCN                          S01177
     C*                                                                   S01177
     C**  Receiver correspondent no.                                      S01177
     C                     MOVELHKRCRN    PARCRN                          S01177
     C                     MOVELPARCRN    @RCRN                           S01177
     C                     MOVE *BLANKS   PMRCRN                          S01177
     C                     MOVELPARCRN    PMRCRN                          S01177
     C*                                                                   S01177
     C**  Receiver correspondent A/C line                                 S01177
     C                     MOVELHKRCRA    PMRCRA                          S01177
     C                     MOVELPMRCRA    @RCRA                           S01177
     C*                                                                   S01177
     C**  Receiver number                                                 S01177
     C                     MOVELHKRVNO    PARVNO                          S01177
     C                     MOVELPARVNO    @RVNO                           S01177
     C                     MOVE *BLANKS   PMRVNO                          S01177
     C                     MOVELPARVNO    PMRVNO                          S01177
     C*                                                                   S01177
     C**  A/C with bank A/C line                                          S01177
     C                     MOVELHKAWBA    PMAWBA                          S01177
     C                     MOVELPMAWBA    @AWBA                           S01177
     C*                                                                   S01177
     C**  Beneficiary A/C line                                            S01177
     C                     MOVELHKBENA    PMBENA                          S01177
     C                     MOVELPMBENA    @BENA                           S01177
     C*                                                                   S01177
     C**  Details of payment 1                                            S01177
     C                     MOVELHKDTP1    PMDTP1                          S01177
     C                     MOVELPMDTP1    @DTP1                           S01177
     C*                                                                   S01177
     C**  Details of payment 2                                            S01177
     C                     MOVELHKDTP2    PMDTP2                          S01177
     C                     MOVELPMDTP2    @DTP2                           S01177
     C*                                                                   S01177
     C**  Details of payment 3                                            S01177
     C                     MOVELHKDTP3    PMDTP3                          S01177
     C                     MOVELPMDTP3    @DTP3                           S01177
     C*                                                                   S01177
     C**  Details of payment 4                                            S01177
     C                     MOVELHKDTP4    PMDTP4                          S01177
     C                     MOVELPMDTP4    @DTP4                           S01177
     C*                                                                   S01177
     C**  Details of charges                                              S01177
     C                     MOVELHKDCHG    PMDCHG                          S01177
     C                     MOVELPMDCHG    @DCHG                           S01177
     C*                                                                   S01177
     C**  Bank to bank information 2                                      S01177
     C                     MOVELHKBTB2    PMBTB2                          S01177
     C                     MOVELPMBTB2    @BTB2                           S01177
     C*                                                                   S01177
     C**  Bank to bank information 3                                      S01177
     C                     MOVELHKBTB3    PMBTB3                          S01177
     C                     MOVELPMBTB3    @BTB3                           S01177
     C*                                                                   S01177
     C**  Bank to bank information 4                                      S01177
     C                     MOVELHKBTB4    PMBTB4                          S01177
     C                     MOVELPMBTB4    @BTB4                           S01177
     C*                                                                   S01177
     C**  Bank to bank information 5                                      S01177
     C                     MOVELHKBTB5    PMBTB5                          S01177
     C                     MOVELPMBTB5    @BTB5                           S01177
     C*                                                                   S01177
     C**  Bank to bank information 6                                      S01177
     C                     MOVELHKBTB6    PMBTB6                          S01177
     C                     MOVELPMBTB6    @BTB6                           S01177
     C*                                                                   E22405
     C**  Cover MT202 required                                            E22405
     C                     MOVELHKCVMR    PMCVMR                          E22405
     C                     MOVELPMCVMR    @CVMR                           E22405
     C*                                                                   S01177
     C**  Pay settlement branch                                           S01117
     C                     MOVELHKPOBR    PMPOBR                          S01117
     C                     MOVELPMPOBR    @POBR                           S01117
     C*                                                                   S01117
     C**  Receive settlement branch                                       S01117
     C                     MOVELHKROBR    PMROBR                          S01117
     C                     MOVELPMROBR    @ROBR                           S01117
     C*                                                                   CEU003
     C                     MOVE HKSTCY    PMRSCY                          CEU003
     C                     MOVE HKSTCY    PMPSCY                          CEU003
     C                     MOVE HKSTCY    @STCY                           CEU003
     C                     MOVE HKIC72    PMIC72                          CEU003
     C                     MOVE HKIC72    @IC72                           CEU003
     C                     MOVE *BLANKS   PMIERI                          CEU003
     C                     MOVE *BLANKS   @IERI                           CEU003
     C*                                                                   S01117
     C*
     C**  Set up text for deal status.
     C                     MOVE '1'       *IN38
     C***********HKDSTS****IFEQ*'I'************************B1*************S01319
     C*********************MOVE*@STSA,1***DDSTS*************1*************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           HKDSTS    IFEQ 'C'                        B1
     C*********************MOVE*@STSA,2***DDSTS*************1*************S01319
     C                     MOVE @STSA,1   DDSTS            *1             S01319
     C                     END                             E1
     C*
     C           HKDSTS    IFEQ 'A'                        B1
     C*********************MOVE*@STSA,3***DDSTS*************1*************S01319
     C                     MOVE @STSA,2   DDSTS            *1             S01319
     C                     END                             E1
     C*
     C           HKDSTS    IFEQ 'R'                        B1
     C*********************MOVE*@STSA,4***DDSTS*************1*************S01319
     C                     MOVE @STSA,3   DDSTS            *1             S01319
     C                     END                             E1
     C*
     C           HKDSTS    IFEQ 'M'                        B1
     C*********************MOVE*@STSA,5***DDSTS*************1*************S01319
     C                     MOVE @STSA,4   DDSTS            *1             S01319
     C                     END                             E1
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP23                                           S01408
     C*                                                                   S01408
     C*
     C**  If the deleted indicator is on then the 'DELETED' text is
     C**  displayed.
     C           HKDDLT    IFEQ 'D'                        B1
     C                     MOVE '1'       *IN39            *1
     C                     ELSE                            X1
     C                     MOVE '0'       *IN39            *1
     C                     END                             E1
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP24                                           S01408
     C*                                                                   S01408
     C*
     C**  Save time and date fields from file.
     C                     Z-ADDHKDLUP    @DLUP
     C                     MOVE HKMLUP    @MLUP
     C                     Z-ADDHKYLUP    @YLUP
     C                     Z-ADDHKTLUP    @TLUP
     C/COPY WNCPYSRC,MM0089C203
     C*                                                                   S01184
     C** if CONFIRMATION MATCHING present get match status feedback       S01184
     C           BGCFMT    IFEQ 'Y'                                       S01184
     C                     EXSR #FEED                                     S01184
     C                     END                                            S01184
     C*
     C           #ZD9      ENDSR                           **#ZD9**
     C*****************************************************************   S01184
      /EJECT
     C****************************************************************
     C*     ZA1150 -  Convert rate to scaled rate.                   *
     C*                                                              *
     C*     CALLS:                                                   *
     C*                                                              *
     C*     INPUT:   @@SXP1 - First currency scaling exponent.       *
     C*              @@SXP2 - Second currency scaling exponent.      *
     C*              @@INRT - Rate to be scaled.                     *
     C*              @@FCMD - First Currency Multiply/Divide Ind.    *
     C*                                                              *
     C*     OUTPUT:  @@SCRT - Scaled rate.                           *
     C*              @@ISRT - Inverse of scaled rate.                *
     C*              @@ERCD - Error code.                            *
     C*                                                              *
     C*     USES:    @SF    - Array of scaling factors.              *
     C*              @@C    - Index for array @SF.                   *
     C*              @@SCF1 - Scaling factor for currency 1.         *
     C*              @@SCF2 - Scaling factor for currency 2.         *
     C*              @@WKA  - Work field, 15,0N.                     *
     C*              @@WKB  - Work field, 15,0N.                     *
     C*                                                              *
     C*     LAST AMEND NO. 000000             DATE   XX/XX/XX        *
     C*                                                              *
     C*
     C           ZA1150    BEGSR
     C*
     C**  Define and initialise fields used and output fields.
     C                     Z-ADD@@SXP1    @@SXP1  10
     C                     Z-ADD@@SXP2    @@SXP2  10
     C                     Z-ADD@@INRT    @@INRT 128
     C                     MOVE @@FCMD    @@FCMD  1
     C*
     C                     Z-ADD*ZEROS    @@SCRT 128
     C                     Z-ADD*ZEROS    @@ISRT 128
     C                     Z-ADD*ZEROS    @@ERCD  10
     C*
     C                     Z-ADD*ZEROS    @@C     20
     C                     Z-ADD*ZEROS    @@SCF1 100
     C                     Z-ADD*ZEROS    @@SCF2 100
     C                     Z-ADD*ZEROS    @@WKA  150
     C                     Z-ADD*ZEROS    @@WKB  150
     C*
     C**  If the input rate is zero, the two output rates are zero,
     C**  by-pass further processing.
     C           @@INRT    CABEQ0         ZA1159
     C*
     C**  Determine the scaling factor from the scaling exponent for
     C**  the first currency.
     C                     Z-ADD@@SXP1    @@C
     C                     ADD  1         @@C
     C                     Z-ADD@SF,@@C   @@SCF1
     C*
     C**  Determine the scaling factor from the scaling exponent for
     C**  the second currency.
     C                     Z-ADD@@SXP2    @@C
     C                     ADD  1         @@C
     C                     Z-ADD@SF,@@C   @@SCF2
     C*
     C**  If the M/D indicator is M, then the scaled rate is calculated
     C**  as follows....
     C           @@FCMD    IFEQ 'M'                        B1
     C*
     C**  Calculate the scaled rate and its inverse.
     C           @@INRT    MULT @@SCF1    @@SCRT           *1
     C           @@SCF2    DIV  @@INRT    @@ISRT    H      *1
     C*
     C**  Calculate the scaled rate and its inverse, placing the result
     C**  into 15,0 fields to check for overflow.
     C           @@INRT    MULT @@SCF1    @@WKA            *1
     C           @@SCF2    DIV  @@INRT    @@WKB     H      *1
     C*
     C**  Otherwise, calculate the rate as follows....
     C                     ELSE                            X1
     C*
     C**  Calculate the scaled rate and its inverse.
     C           @@INRT    MULT @@SCF2    @@SCRT           *1
     C           @@SCF1    DIV  @@INRT    @@ISRT    H      *1
     C*
     C**  Calculate the scaled rate and its inverse, placing the result
     C**  into 15,0 fields to check for overflow.
     C           @@INRT    MULT @@SCF2    @@WKA            *1
     C           @@SCF1    DIV  @@INRT    @@WKB     H      *1
     C*
     C                     END                             E1
     C*
     C**  If the work fields are greater than 9999.99999999, set up the
     C**  error codes.
     C           @@WKA     IFGE 10000                      B1
     C                     Z-ADD1         @@ERCD           *1
     C                     END                             E1
     C           @@WKB     IFGE 10000                      B1
     C                     Z-ADD2         @@ERCD           *1
     C                     END                             E1
     C           @@WKA     IFGE 10000                      B1
     C           @@WKB     ANDGE10000                      B1
     C                     Z-ADD3         @@ERCD           *1
     C                     END                             E1
     C*
     C           ZA1159    ENDSR                           **ZA1159**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZF      - Resets screen fileds with stored values.           *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #ZB    - Enter processing for action code D.       *
     C*            #ZM    -  F10 proceesing.                          *
     C*            #ZP    - Enter processing for action code X.       *
     C*                                                               *
     C* FLDS USED  @ACTN  - Stored version of DDACTN.                 *
     C*            @DLNO  - Stored version of DDDLNO.                 *
     C*            @TYPE  - Stored version of DDTYPE.                 *
     C*            @STYP  - Stored version of DDSTYP.                 *
     C*            @DLDT  - Stored version of DDDLDT.                 *
     C*****        @BRCD  - Stored version of DDBRCD.                 *   S01117
     C*            @BRCA  - Stored version of DDBRCA.                 *   S01117
     C*            @BKCD  - Stored version of DDBKCD.                 *
     C*            @BRKG  - Stored version of DDBRKG.                 *
     C*            @DADN  - Stored version of DDDADN.                 *
     C*            @CUST  - Stored version of DDCUST.                 *
     C*            @VDAT  - Stored version of DDVDAT.                 *
     C*            @MDAT  - Stored version of DDMDAT.                 *
     C*            @NTCE  - Stored version of DDNTCE.                 *
     C*************@FCLY**-*Stored*version*of*DDFCLY.******************   E25515
     C*            @ACSQ  - Stored version of DDACSQ.                 *
     C*            @CCY   - Stored version of DDCCY.                  *
     C*            @AMNP  - Stored version of DDAMNP.                 *
     C*            @BRAT  - Stored version of DDBRAT.                 *
     C*            @BSRC  - Stored version of DDBSRC.                 *
     C*            @SPRT  - Stored version of DDSPRT.                 *
     C*            @ICMT  - Stored version of DDICMT.                 *
     C*            @NGVI  - Stored version of DDNGVI.                 *
     C*            @IPFQ  - Stored version of DDIPFQ.                 *
     C*            @NDAT  - Stored version of DDNDAT.                 *
     C*            @TOTI  - Stored version of DDTOTI.                 *
     C*            @IPDM  - Stored version of DDIPDM.                 *
     C*            @CPTI  - Stored version of DDCPTI.                 *
     C*            @MTAX  - Stored version of DDMTAX.                 *
     C*            @CDRF  - Stored version of DDCDRF.                 *
     C*            @CDCH  - Stored version of DDCDCH.                 *
     C*            @FUID  - Stored version of DDFUID                  *   S01392
     C*            @FLID  - Stored version of DDFLID                  *   S01392
     C*            @RDFC  - Stored version of DDRDFC                  *   S01392
     C*            @ORBR  - stored orig. branch                       *   S01117
     C*            @PRFC  - stored profit centre                      *   S01117
     C******       @ORCM  - Stored version of DDORCM.                 *   S01177
     C******       @MOPM  - Stored version of DDMOPM.                 *   S01177
     C******       @MORI  - Stored version of DDMORI.                 *   S01177
     C******       @MOPI  - Stored version of DDMOPI.                 *   S01177
     C******       @MCPI  - Stored version of DDMCPI.                 *   S01177
     C******       @MCRI  - Stored version of DDMCRI.                 *   S01177
     C******       @MFAO  - Stored version of DDMFAO.                 *   S01177
     C******       @SPEC  - Stored version of DDSPEC.                 *   S01177
     C*            @RSTM  - stored rcpt settlement method             *   S01177
     C*            @RONS  - stored rcpt our nostro                    *   S01177
     C*            @RIBN  - stored rcpt intermed bank no.             *   S01177
     C*            @RIBA  - stored rcpt intermed bank a/c line        *   S01177
     C*            @ROBN  - stored rcpt ordering bank no.             *   S01177
     C*            @ROCN  - stored rcpt ordering customer no.         *   S01177
     C*            @PSTM  - stored pay settlement method              *   S01177
     C*            @PONS  - stored pay our nostro                     *   S01177
     C*            @PIBN  - stored pay intermed bank no.              *   S01177
     C*            @PIBA  - stored pay intermed bank a/c line         *   S01177
     C*            @POBN  - stored pay ordering bank no.              *   S01177
     C*            @POCN  - stored pay ordering customer no.          *   S01177
     C*            @RCRN  - stored receiver correspondant no.         *   S01177
     C*            @RCRA  - stored receiver corr a/c line             *   S01177
     C*            @RVNO  - stored receiver no.                       *   S01177
     C*            @AWBN  - stored a/c with bank no.                  *   S01177
     C*            @AWBA  - stored a/c with bank a/c line             *   S01177
     C*            @BENN  - stored beneficiary no.                    *   S01177
     C*            @BENA  - stored beneficiary a/c line               *   S01177
     C*            @DTP1  - stored details of payment 1               *   S01177
     C*            @DTP2  - stored details of payment 2               *   S01177
     C*            @DTP3  - stored details of payment 3               *   S01177
     C*            @DTP4  - stored details of payment 4               *   S01177
     C*            @DCHG  - stored details of charges                 *   S01177
     C*            @BTB1  - stored bank to bank info 1                *   S01177
     C*            @BTB2  - stored bank to bank info 2                *   S01177
     C*            @BTB3  - stored bank to bank info 3                *   S01177
     C*            @BTB4  - stored bank to bank info 4                *   S01177
     C*            @BTB5  - stored bank to bank info 5                *   S01177
     C*            @BTB6  - stored bank to bank info 6                *   S01177
     C*            @CVMR  - cover MT202 required                      *   E22405
     C*            @BOKC  - Stored version of DDBOKC.                 *   S01165
     C*            @LNKN  - Stored version of DDLNKN.                 *   S01165
     C*            @DRID  - Stored version of DDDRID.                 *   S01176
     C*            @DDMR  - Stored version of DDDDMR.                 *   S01176
     C*                                                               *
     C*****************************************************************
     C           #ZF       BEGSR
     C*
     C**  Moves fields from program work fields into screen fields.
     C                     MOVE @ACTN     DDACTN
     C                     MOVE @DLNO     DDDLNO
     C                     MOVE @TYPE     DDTYPE
     C                     MOVE @STYP     DDSTYP
     C/COPY WNCPYSRC,MM0089C013
     C                     MOVE @FEDF     DDFEDF                          S01136
     C/COPY WNCPYSRC,MM0089C014
     C                     MOVE @DLDT     DDDLDT
     C*****                MOVE @BRCD     DDBRCD                          S01117
     C                     MOVE @BRCA     DDBRCA                          S01117
     C                     MOVE @BKCD     DDBKCD
     C                     MOVE @BRKG     DDBRKG
     C                     MOVE @DADN     DDDADN
     C/COPY WNCPYSRC,MM0089C480
     C                     MOVE @CUST     DDCUST
     C/COPY WNCPYSRC,MM0089C481
     C                     MOVE @VDAT     DDVDAT
     C                     MOVE @MDAT     DDMDAT
     C/COPY WNCPYSRC,MM0089C204
     C                     MOVE @NTCE     DDNTCE
     C***********          MOVE @FCLY     DDFCLY                          E25515
     C                     MOVE @PTFR     DDPTFR                          S01486
     C                     MOVE @ACSQ     DDACSQ
     C                     MOVE @CCY      DDCCY
     C                     MOVE @AMNP     DDAMNP
     C                     MOVE @BRAT     DDBRAT
     C                     MOVE @BSRC     DDBSRC
     C                     MOVE @SPRT     DDSPRT
     C                     MOVE @ICMT     DDICMT
     C                     MOVE @NGVI     DDNGVI
     C                     MOVE @IPFQ     DDIPFQ
     C                     MOVE @NDAT     DDNDAT
     C                     MOVE @TOTI     DDTOTI
     C                     MOVE @IPDM     DDIPDM
     C                     MOVE @CPTI     DDCPTI
     C                     MOVE @MTAX     DDMTAX
     C                     MOVE @CDRF     DDCDRF
     C                     MOVE @CDCH     DDCDCH
     C                     MOVE @FUID     DDFUID                          S01392
     C                     MOVE @FLID     DDFLID                          S01392
     C                     MOVE @RDFC     DDRDFC                          S01392
     C                     MOVE @CPTY     DDCPTY                          S01184
     C                     MOVE @BROK     DDBROK                          S01184
     C                     MOVE @TEXT     DDTEXT                          S01184
     C                     MOVE @ORBR     DDORBR                          S01117
     C                     MOVE @PRFC     DDPRFC                          S01117
     C*****                MOVE @ORCM     DDORCM                          S01177
     C*****                MOVE @MOPM     DDMOPM                          S01177
     C*****                MOVE @MORI     DDMORI                          S01177
     C*****                MOVE @MOPI     DDMOPI                          S01177
     C*****                MOVE @MCPI     DDMCPI                          S01177
     C*****                MOVE @MCRI     DDMCRI                          S01177
     C*****                MOVE @MFAO     DDMFAO                          S01177
     C*****                MOVE @SPEC     DDSPEC                          S01177
     C                     MOVE @BOKC     DDBOKC                          S01165
     C                     MOVE @LNKN     DDLNKN                          S01165
     C                     MOVE @DRID     DDDRID                          S01176
     C                     MOVE @DDMR     DDDDMR                          S01176
     C                     MOVE @AURO     DDAURO                          S01434
     C                     MOVE @IPDS     DDIPDS                          S01434
     C                     MOVE @ROFQ     DDROFQ                          S01434
     C                     MOVE @RLDN     DDRLDN                          S01434
     C                     MOVE @IMET     DDIMET                          S01434
     C                     MOVE @INSA     DDINSA                          S01434
     C                     MOVE @INSA     DDINSN                          S01434
     C                     MOVE @INSA     @@INSA                          S01434
     C                     MOVE @INOS     DDINOS                          S01434
     C                     MOVE @CNNA     DDCNNA                          S01434
     C*                                                                   CEU003
     C                     MOVE @ISCY     DDISCY                          CEU003
     C                     MOVE @II72     DDII72                          CEU003
     C*                                                                   CEU003
     C/COPY WNCPYSRC,MM0089C229
     C*
     C**  Moves fields from program work fields into screen 2 parms       S01177
     C*                                                                   S01177
     C                     MOVE @RSTM     PMRSTM                          S01177
     C                     MOVE @RONS     PMRONS                          S01177
     C                     MOVE @RIBN     PARIBN                          S01177
     C                     MOVE @RIBA     PMRIBA                          S01177
     C                     MOVE @ROBN     PAROBN                          S01177
     C                     MOVE @ROCN     PAROCN                          S01177
     C                     MOVE @PSTM     PMPSTM                          S01177
     C                     MOVE @PONS     PMPONS                          S01177
     C                     MOVE @PIBN     PAPIBN                          S01177
     C                     MOVE @PIBA     PMPIBA                          S01177
     C                     MOVE @POBN     PAPOBN                          S01177
     C                     MOVE @POCN     PAPOCN                          S01177
     C                     MOVE @RCRN     PARCRN                          S01177
     C                     MOVE @RCRA     PMRCRA                          S01177
     C                     MOVE @RVNO     PARVNO                          S01177
     C                     MOVE @AWBN     PAAWBN                          S01177
     C                     MOVE @AWBA     PMAWBA                          S01177
     C                     MOVE @BENN     PABENN                          S01177
     C                     MOVE @BENA     PMBENA                          S01177
     C                     MOVE @DTP1     PMDTP1                          S01177
     C                     MOVE @DTP2     PMDTP2                          S01177
     C                     MOVE @DTP3     PMDTP3                          S01177
     C                     MOVE @DTP4     PMDTP4                          S01177
     C                     MOVE @DCHG     PMDCHG                          S01177
     C                     MOVE @BTB1     PMBTB1                          S01177
     C                     MOVE @BTB2     PMBTB2                          S01177
     C                     MOVE @BTB3     PMBTB3                          S01177
     C                     MOVE @BTB4     PMBTB4                          S01177
     C                     MOVE @BTB5     PMBTB5                          S01177
     C                     MOVE @BTB6     PMBTB6                          S01177
     C                     MOVE @CVMR     PMCVMR                          E22405
     C                     MOVE @ROBR     PMROBR                          S01177
     C                     MOVE @POBR     PMPOBR                          S01177
     C                     MOVE @RACD     DDRACD                          AUS007
     C*
     C                     MOVE @STCY     PMRSCY                          CEU003
     C                     MOVE @STCY     PMPSCY                          CEU003
     C                     MOVE @IC72     PMIC72                          CEU003
     C                     MOVE *BLANKS   PMIERI                          CEU003
     C/COPY WNCPYSRC,MM0089C527
     C*                                                                   CEU003
     C           #ZF9      ENDSR                           **#ZF9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #BD      - Enter processing.                                  *
     C*                                                               *
     C* CALLS    #BDA     - Enter processing for action code I.       *
     C*          #ZB      - Enter processing for action code D.       *
     C*          #ZC      - Enter processing for action code A.       *
     C*          #ZO      - Validate deal number and action code.     *
     C*          #ZP      - Enter processing for action code X.       *
     C*                                                               *
     C* CALLED BY  #B     - Main processing.                          *
     C*                                                               *
     C* FLDS USED  @DLNO  - Stored version of DDDLNO.                 *
     C*            @ACTN  - Stored version of DDACTN.                 *
     C*                                                               *
     C*****************************************************************
     C           #BD       BEGSR
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CIKS                                           S01408
     C*
     C**  Validate deal number and action code if either have changed.
     C           @DLNO     IFNE DDDLNO                     B1
     C           @DLNO     OREQ *BLANKS                    B1
     C           @ACTN     ORNE DDACTN                     B1
     C           @ACTN     OREQ *BLANKS                    B1
     C/COPY WNCPYSRC,MM0089C169
     C                     EXSR #ZO                        *1
     C/COPY WNCPYSRC,MM0089C170
     C                     END                             E1
     C*
     C**  Enter has now been pressed for this deal number                 S01177
     C                     MOVE DDDLNO    DLENT   6                       S01177
      *                                                                   S01227
      * Set up flag for use by Extended Settlements                       S01227
      * unless it has already been set to 'Y' by another subroutine.      S01227
     C** If deal number entered does not match that currently in parms    S01227
     C** or Action Code entered does not match that currently in parms    S01227
     C**   then this is first time in for this deal                       S01227
     C           PMFRST    IFNE 'Y'                                       S01227
     C           DDDLNO    IFNE @SAVD                                     S01227
     C           DDACTN    ORNE @SVACT                                    S01227
     C                     MOVE 'Y'       PMFRST                          S01227
     C                     ELSE                                           S01227
     C*                                                                   S01227
     C** Parmameters for Extended Settlements will already be set up      S01227
     C*                                                                   S01227
     C                     MOVE 'N'       PMFRST                          S01227
     C                     END                                            S01227
     C                     END                                            S01227
     C** Store Deal Number & Action Code for next time through.           S01227
     C                     MOVE DDDLNO    @SAVD   6                       S01227
     C                     MOVE DDACTN    @SVACT  1                       S01227
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CVKS                                           S01408
     C*                                                                   S01177
     C**  By-pass further ENTER processing if a validation error has
     C**  occurred.
     C           *IN41     CABEQ'1'       #BD9
     C/COPY WNCPYSRC,MM0089C299
     C*
     C**  Enable CMD14 so settlement screen can be displayed              S01177
     C*                                                                   109015
     C** Only for action for 'E' or 'D'                                   109015
     C*                                                                   109015
     C           DDACTN    IFEQ 'E'                                       109015
     C           DDACTN    OREQ 'D'                                       109015
     C                     MOVE '1'       *IN53                           S01177
     C                     END                                            109015
     C*                                                                   109015
     C** Core hook for externalisation.                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP19                                           S01408
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP25                                           S01408
      *                                                                   CAC001
      **  Set on *IN89 for action code 'D' or 'E' to enable F19 if        CAC001
      **  analytical accounting is installed                              CAC001
      *                                                                   CAC001
     C                     MOVE '0'       *IN89                           CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           DDACTN    IFEQ 'D'                                       CAC001
     C           DDACTN    OREQ 'E'                                       CAC001
     C                     MOVE '1'       *IN89                           CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   S01408
     C*                                                                   S01177
     C**  Further processing depends on the action code.
     C**  - If the action code is I, process SR #BDA.
     C           DDACTN    CASEQ'I'       #BDA
     C*
     C**  - If the action code is A, process SR #ZC .
     C           DDACTN    CASEQ'A'       #ZC
     C*
     C**  - If the action code is D, process SR #ZB .
     C           DDACTN    CASEQ'D'       #ZB
     C*
     C**  - If the action code is E, process SR #ZD .
     C           DDACTN    CASEQ'E'       #ZD
     C*
     C**  - If the action code is X, process SR #ZP .
     C           DDACTN    CASEQ'X'       #ZP
     C*
     C                     END
     C*
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP26                                           S01408
      *                                                                   CAC001
      **  If Anal Accnting is installed, action code is 'D' or 'E', &     CAC001
      **  F19 was pressed, set up parameters for window manager           CAC001
      *                                                                   CAC001
     C           *IN89     IFEQ *ON                                       CAC001
     C           BGWDPR    ANDEQ'Y'                                       CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
     C           *INKT     ANDEQ*ON                                       CAC001
     C                     MOVE 'KT'      KEY                             CAC001
     C                     MOVE DDACTN    WACTN                           CAC001
     C                     MOVE 'D'       WDSTS                           CAC001
     C                     Z-ADD0         WINTR                           CAC001
     C                     MOVE *BLANKS   WPRFC                           CAC001
     C                     MOVE *BLANKS   WCCY                            CAC001
     C                     MOVE *BLANKS   WLCCY                           CAC001
     C                     MOVE *BLANKS   WRATF                           CAC001
     C                     Z-ADDHKFSRP    WFSRP                           CAC001
     C                     MOVE HKFSGN    WFSGN                           CAC001
     C                     MOVE HKFPRC    WFPRC                           CAC001
     C                     MOVE 'N'       WFRC                            CAC001
     C                     MOVE *BLANKS   WTPRC                           CAC001
     C/COPY WNCPYSRC,MM0089C404
      *                                                                   CAC001
      **  Call window manager WN0010 for the optional window              CAC001
      *                                                                   CAC001
     C                     CALL 'WN0010'                                  CAC001
     C                     PARM 'MM0089  '#PGM   10                       CAC001
     C                     PARM           KEY     2                       CAC001
     C                     PARM DDACTN    ACTION  1                       CAC001
     C                     PARM           DATA                            CAC001
     C                     PARM *BLANKS   #RTRN   7                       CAC001
     C                     PARM           SPARE 256                       CAC001
      *                                                                   CAC001
      **  Check return code                                               CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
     C           #RTRN     WHEQ 'Y2U9999'                                 CAC001
     C                     MOVE '1'       *INKC                           CAC001
     C                     GOTO #BD9                                      CAC001
     C           #RTRN     WHNE *BLANKS                                   CAC001
     C/COPY WNCPYSRC,MM0089C382
     C                     CALL 'SNDERMSG'                                CAC001
     C                     PARM 'MM0089'  ZAPGM  10        Program queue  CAC001
     C                     PARM           ZAPGRL  5        Rel queue      CAC001
     C                     PARM #RTRN     ZAMSID  7        Msg Id.        CAC001
     C                     PARM 'WNMSGF'  ZAMSGF 10        Msg file.      CAC001
     C                     PARM           ZAMSDA132        Message data.  CAC001
     C                     PARM           ZAMSTP  7        Message type.  CAC001
     C/COPY WNCPYSRC,MM0089C383
      *                                                                   CAC001
      **  Clear all fields                                                CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    ZAPGM            Program queue  CAC001
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      CAC001
     C                     MOVEL*BLANK    ZAMSID           Message Id.    CAC001
     C                     MOVEL*BLANK    ZAMSGF           Message file.  CAC001
     C                     MOVEL*BLANK    ZAMSDA           Message data.  CAC001
     C                     MOVEL*BLANK    ZAMSTP           Message type.  CAC001
     C                     ENDSL                                          CAC001
     C/COPY WNCPYSRC,MM0089C506
     C                     ENDIF                                          CAC001
     C*                                                                   S01408
     C           #BD9      ENDSR                           **#BD9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #BDA     - Enter processing for action code I.                *
     C*                                                               *
     C* CALLS    #BDAA    - Processing for insert of new record.      *
     C*          #ZI      - Validates the screen input for I,A and X. *
     C*                                                               *
     C* CALLED BY  #BD    - Enter processing.                         *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter.                    *
     C*                                                               *
     C*****************************************************************
     C           #BDA      BEGSR
      *                                                                   CAC001
      **  If Analytical Accounting is installed, action code was          CAC001
      **  changed from 'E' to 'I', and F19 was pressed, display error     CAC001
      **  message and F19 would be disabled                               CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *INKT     ANDEQ*ON                                       CAC001
     C                     MOVE '1'       *IN41                           CAC001
     C                     MOVEL'MMM2700' @MSGID                          CAC001
     C                     CALL 'ZA0240'                                  CAC001
     C                     PARM           @MSGID                          CAC001
     C                     GOTO #BDA9                                     CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   S01177
     C**  Dont allow call to SD2410  before settlement screen called      S01177
     C********             MOVE '1'       *IN77                     S01177AUS007
     C                     MOVE '1'       *INL1                           AUS007
     C*
     C**  Validate the screen input.  If an error has occurred in a
     C**  called program, by-pass further processing.
     C                     EXSR #ZI
     C           @TERM     CABEQ'E'       #BDA9
      *                                                                   E46904
      **  If the input is invalid, reset IKMCDH to zeroes                 E46904
      *                                                                   E46904
     C           *IN41     IFEQ '1'                                       E46904
     C           DDTYPE    ANDEQ'CI'                                      E46904
     C**********           Z-ADD0         IKMCDH                                      E46904 CSD027A
     C                     MOVE *BLANKS   IKMCDH                                             CSD027A
     C                     END                                            E46904
     C*
     C**  If the input is invalid, cease ENTER processing.
     C/COPY WNCPYSRC,MM0089C300
     C           *IN41     CABEQ'1'       #BDA9
     C/COPY WNCPYSRC,MM0089C301
     C*
     C**  Update DLENT in case a new deal no has been generated           S01177
     C                     MOVE DDDLNO    DLENT                           S01177
     C/COPY WNCPYSRC,MM0089C271
     C*                                                                   S01177
     C**  Call screen 2 to set up settlement details                      S01177
     C                     EXSR #BE                                       S01177
     C/COPY WNCPYSRC,MM0089C538
     C*                                                                   S01177
     C*   If CMD/3 taken from settlement screen bypass update processing  S01177
     C           *INKC     CABEQ'1'       #BDA9                           S01177
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CPG2                                           S01408
      *                                                                   S01408
     C*                                                                   S01177
     C**  Allow  call to SD2410  to validate settlement details           S01177
     C********             MOVE '0'       *IN77                     S01177AUS007
     C                     MOVE '0'       *INL1                           AUS007
     C*                                                                   S01177
     C                     EXSR #ZI                                       S01177
     C/COPY WNCPYSRC,MM0089C302
     C           *IN41     CABEQ'1'       #BDA9                           S01177
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP57                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C**  Write a new record.
     C                     EXSR #BDAA
     C/COPY WNCPYSRC,MM0089C303
     C           *IN41     CABEQ'1'       #BDA9                           043277
     C/COPY WNCPYSRC,MM0089C304
     C*
     C**  If a database error has occurred end processing.
     C           *INU7     CABEQ'1'       #BDA9
     C*
     C**  If the Action code is E, then the record has been inserted by
     C**  another workstation.  Therefore the intelligent insert is not
     C**  set up.
     C           DDACTN    CABEQ'E'       #BDA9
     C*
     C*
     C**  Set up I in the action code field.
     C                     MOVE 'I'       DDACTN
     C*
     C**  Position cursor on key field
     C                     MOVE '1'       *IN43
     C*
     C           BJSBRC    IFNE *BLANKS                    B1             S01117
     C                     MOVE BJSBRC    DDBRCA           *1             S01117
     C                     END                             E1             S01117
      *                                                                   S01117
     C           #BDA9     ENDSR                           **#BDA9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZC      - Enter processing for action code A.                *
     C*                                                               *
     C* CALLS    #ZG      - Update processing.                        *
     C*          #ZI      - Validates the screen input for I,A and X. *
     C*                                                               *
     C* CALLED BY  #BD    - Enter processing.                         *
     C*            #BFA   -  F15 processing - amend handling.         *
     C*                                                               *
     C* FLDS USED  @DLNO  - Stored version of DDDLNO.                 *
     C*            @TERM  - Termination parameter.                    *
     C*                                                               *
     C*****************************************************************
     C           #ZC       BEGSR
     C/COPY WNCPYSRC,MM0089C272
      *                                                                   CAC001
      **  If Analytical Accounting is installed, action code was          CAC001
      **  changed from 'E' to 'A', and F19 was pressed, display error     CAC001
      **  message and F19 would be disabled                               CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *INKT     ANDEQ*ON                                       CAC001
     C                     MOVE '1'       *IN41                           CAC001
     C                     MOVEL'MMM2700' @MSGID                          CAC001
     C                     CALL 'ZA0240'                                  CAC001
     C                     PARM           @MSGID                          CAC001
     C                     GOTO #ZC9                                      CAC001
     C                     ENDIF                                          CAC001
     C*
     C**  If key work field not the same as screen field, then the
     C**  record is not being displayed.
     C           DDDLNO    IFNE @DLNO                      B1
     C           DDDLNO    OREQ *BLANKS                    B1
     C/COPY WNCPYSRC,MM0089C273
     C*
     C**  Display file on screen.
     C                     EXSR #ZD                        *1
     C/COPY WNCPYSRC,MM0089C085
     C*
     C**  Position cursor on first non-key field
     C                     MOVE '1'       *IN44            *1
     C*
     C**  By-pass further ENTER processing.
     C/COPY WNCPYSRC,MM0089C343
     C                     GOTO #ZC9                       *1
     C/COPY WNCPYSRC,MM0089C344
     C*
     C                     END                             E1
     C*                                                                   S01177
     C**  Dont allow call to SD2410  before settlement screen called      S01177
     C********             MOVE '1'       *IN77                     S01177AUS007
     C                     MOVE '1'       *INL1                           AUS007
     C/COPY WNCPYSRC,MM0089C496
     C*
     C**  The record was displayed last cycle; validate the screen
     C**  input.  If an error has occurred in a called program, by-pass
     C**  further processing.
     C                     EXSR #ZI
     C           @TERM     CABEQ'E'       #ZC9
     C*
     C**  If the input is invalid, cease ENTER processing.
     C/COPY WNCPYSRC,MM0089C305
     C           *IN41     CABEQ'1'       #ZC9
     C/COPY WNCPYSRC,MM0089C306
     C*
     C**  Call screen 2 to set up settlement details                      S01177
     C**  (if we have not just returned from screen 2)                    S01177
     C           *INKN     IFNE '1'                                       S01177
     C                     EXSR #BE                                       S01177
     C                     END                                            S01177
     C*                                                                   S01177
     C*   If CMD/3 taken from settlement screen bypass update processing  S01177
     C           *INKC     CABEQ'1'       #ZC9                            S01177
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CPG1                                           S01408
      *                                                                   S01408
     C*                                                                   S01177
     C**  Allow  call to SD2410  to validate settlement details           S01177
     C********             MOVE '0'       *IN77                     S01177AUS007
     C                     MOVE '0'       *INL1                           AUS007
     C*                                                                   S01177
     C                     EXSR #ZI                                       S01177
     C/COPY WNCPYSRC,MM0089C307
     C           *IN41     CABEQ'1'       #ZC9                            S01177
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP58                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C**  The input is valid, update file.
     C                     EXSR #ZG
     C/COPY WNCPYSRC,MM0089C539
     C*
     C           #ZC9      ENDSR                           **#ZC9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZI      - Validates the screen input for I,A and X.          *
     C*                                                               *
     C**CALLS****#ZIA     - Validates the setttlement instructions.   *   S01177
     C***********#ZIB     - Set up event date fields.                 *   S01177
     C*          #ZK      - Set up date of payment and receipt        *   S01177
     C*          CA0040   - Deal number regeneration.                 *
     C***********MM1007   - Calculate interest.                       *   E17051
     C*          MM1030   - Calculate interest.                       *   E17051
     C*          MM1010   - Calculation of interest at maturity.      *
     C*          ZA0240   - Sends a msg to the program message queue. *
     C*          ZA0270   - Alpha date to MIDAS day no. conversion.   *
     C*          ZA0440   - Sends a msg with data to the pgm msg queue*
     C***********ZA0680***-*YYYYMMDD*to*MIDAS*day*no.*conversion.******   056095
     C*          ZDAT10   - YYYYMMDD to MIDAS day no. conversion.     *   056095
     C*          ZA0770   - YYYYMMDD to MMDDYY or DDMMYY conversion.  *
     C*****      ZA0830   - Check whether day is a holiday for ccy.   *   S01195
     C*          ZCHKH    - Check whether day is a holiday for ccy.   *   S01195
     C*          ZA0840   - Validate alpha versions of numeric fields.*
     C*          ZA0920   - Back office amount editor.                *
     C*                                                               *
     C* CALLED BY  #BDA   - Enter processing for action code I.       *
     C*            #BG    - Range authorisation processing            *   S01177
     C*            #ZC    - Enter processing for action code A.       *
     C*            #ZP    - Enter processing for action code X.       *
     C*                                                               *
     C* FLDS USED  @MSGID - Message id field.                         *
     C*            @TERM  - Termination parameter.                    *
     C*            @DLNO  - Stored version of DDDLNO.                 *
     C*            @AUTO  - Auto deal number indicator.               *
     C*            @TYPE  - Stored version of DDTYPE.                 *
     C*            @STS   - Future status of deal.                    *
     C*            @DSTS  - Present status of deal.                   *
     C*            @YEAR  - Field to hold year and century.           *
     C*            @MNTH  - Field to hold month (MM).                 *
     C*            @DAY   - Field to hold day (DD).                   *
     C*            @DATE  - Date (YYYYMMDD).                          *
     C*            @TDYNO - Transaction date day no.                  *
     C*            @@DTIN - Date (YYYYMMDD).                          *
     C*            ZZDTIN - Date (YYYYMMDD).                          *   056095
     C*            @@DTOU - Date (MMDDYY or DDMMYY).                  *
     C*            @DAT   - Date.(DDMMYY or MMDDYY).                  *
     C*            @RTCDE - Return code.                              *
     C*            @STYP  - Stored version of DDSTYP.                 *
     C*            @KEY   - Key field for MIDAS file.                 *
     C*            @KEY1  - Subfield of @KEY.                         *
     C*            @DLDT  - Stored version of DDDLDT.                 *
     C*            @TEST  - Field to test numeric fields' right byte. *
     C*            @DAYNO - MIDAS day no.                             *
     C*            @VDYNO - Value date day no.                        *
     C*            @@CCY  - Currency code.                            *
     C*            @@MNO  - Date(MIDAS day no.).                      *
     C*****        @@HIND - Holiday indicator.                        *   S01195
     C*****        @BRCD  - Stored version of DDBRCD.                 *   S01117
     C*            @BRCA  - Stored version of DDBRCA.                 *   S01117
     C*            @WK1   - Work field.                               *
     C*            @BKCD  - Stored version of DDBKCD.                 *
     C*            @KEY2  - Subfield of @KEY.                         *
     C*            @KEY3  - Subfield of @KEY.                         *
     C*            @BRKG  - Stored version of DDBRKG.                 *
     C*            @@IDP  - Decimal places field.                     *
     C*            @@IINT - No. of integers field.                    *
     C*            @@ALPH - Alpha amount for validation.              *
     C*            @@ERCD - Error code.                               *
     C*            @CUST  - Stored version of DDCUST.                 *
     C*            @@AMT  - Output amount field.                      *
     C*******      @CNUM  - Customer number.                          *   S01194
     C*******      @CLTKY - Key to client file.                       *   S01194
     C*            @VDAT  - Stored version of DDVDAT.                 *
     C*            @MDAT  - Stored version of DDMDAT.                 *
     C*            @MDYNO - Maturity date (MIDAS day no.)             *
     C*            @IADT  - Interst accrual date.                     *
     C*            @IADYN - Interest accrual date (MIDAS day no.)     *
     C*            @LIDT  - Last interest date.                       *
     C*            @LIDYN - Last interest date (MIDAS day no.)        *
     C*            @DEAMN - Deal no used to access DEAMS file.        *
     C*            @VDYY  - Value date key field for DEAMS file.      *
     C*            @VDMM  - Value date key field for DEAMS file.      *
     C*            @VDDD  - Value date key field for DEAMS file.      *
     C*            @DEAMS - DEAM sequence no.                         *
     C*            @DEAMK - DEAM file key.                            *
     C*            @DA38  - Deal no for DEAM.                         *
     C*            @DMVD  - DEAM value date.                          *
     C*            @DMDYN - DEAM value date (MIDAS day no.)           *
     C*            @NTCE  - Stored version of DDNTCE.                 *
     C*************@FCLY**-*Stored*version*of*DDFCLY.******************   E25515
     C*************@FCLK1*-*Sub*field*of*facility*file*key.************   E25515
     C*************@FCLK2*-*Sub*field*of*facility*file*key.************   E25515
     C*************@FCLK3*-*Sub*field*of*facility*file*key.************   E25515
     C*************@FCLK**-*Facility*file*key.*************************   E25515
     C*****        @BRCD1 - Alpha version of branch code.             *   S01117
     C*            @BRCA1 - Alpha version of branch code.             *   S01117
     C*            @ACSQ  - Stored version of DDACSQ.                 *
     C*            @ACSQN - Numeric version of account sequence no.   *
     C*            @CCY   - Stored version of DDCCY.                  *
     C*            WTCCY  - Temporary stored version of DDCCY.        *   057977
     C*            WTBRAT - Temporary stored version of DDBRAT.       *   057977
     C*            WINKL  - Sets to '1' if F12 was pressed after the  *   057977
     C*                     validation of the Extended Settlements.   *   057977
     C*            @AMNP  - Stored version of DDAMNP.                 *
     C*            @BRAT  - Stored version of DDBRAT.                 *
     C*            @@QECN - Decimal places of validated field.        *
     C*            @@AMTW - Amount to be edited.                      *
     C*            @@AMTD - Edited alpha field.                       *
     C*            @BRATN - Numeric version of base ccy exchange rate.*
     C*            @LLIM  - Lower limit for exchange rate.            *
     C*            @ULIM  - Upper limit for exchange rate.            *
     C*            @BSRC  - Stored version of DDBSRC.                 *
     C*            @KEY4  - Subfield of MIDAS file key.               *
     C*            @KEY5  - Subfield of MIDAS file key.               *
     C*            @RATE  - Interest field.                           *
     C*            @SPRT  - Stored version of DDSPRT.                 *
     C*            @SPRD  - Interest spread.                          *
     C*            @ICMT  - Stored version of DDICMT.                 *
     C*            @NGVI  - Stored version of DDNGVI.                 *
     C*            @IPFQ  - Stored version of DDIPFQ.                 *
     C*            @NDAT  - Stored version of DDNDAT.                 *
     C*            @NDYNO - Next interest date (MIDAS day no.)        *
     C*            @TOTI  - Stored version of DDTOTI.                 *
     C*************@@BEG**-*Start*date*of*period.**********************   056095
     C*************@@END**-*End*date*of*period.************************   056095
     C*            ZZBEG  - Start date of period.                     *   056095
     C*            ZZEND  - End date of period.                       *   056095
     C*            @@RATE - Interest rate.                            *
     C*************@@CALC*-*Interest*calculation*method.***************   056095
     C*            ZZCALC - Interest calculation method.              *   056095
     C*            @@INTR - Interest rate.                            *
     C*            @NTCEN - Numeric version of stored notice days.    *
     C*            @NTCNM - Numeric version of input notice days.     *
     C*            @TOTIN - Total interest  field.                    *
     C*            @DIFI  - Difference between input and calc. rate.  *
     C*            @WK151 - Work field (15,1)                         *
     C*            @WK152 - Work field (15,2)                         *
     C*            @WK153 - Work field (15,3)                         *
     C*            @WK20  - Work field (20A)                          *
     C*            @DATA  - DS to set up data for screen messages.    *
     C*            @IPDM  - Stored version of DDIPDM.                 *
     C*            @@DAT1 - DS field used to convert date in ZA0770.  *
     C*            @@DAT2 - DS field used to convert date in ZA0770.  *
     C*            @MTAX  - Stored version of DDMTAX.                 *
     C*            @CDRF  - Stored version of DDCDRF.                 *
     C*            @CDCH  - Stored version of DDCDCH.                 *
     C*            @CPTI  - Stored version of DDCPTI.                 *
     C*            @FUID  - Stored version of DDFUID                  *   S01392
     C*            @FLID  - Stored version of DDFLID                  *   S01392
     C*            @RDFC  - Stored version of DDRDFC                  *   S01392
     C*            @DADN  - Stored version of DDDADN.                 *
     C*            @DLKEY - Numeric key to deal file.                 *
     C*            @MRDYN - Maturity date of related deal (MIDAS)     *
     C*************@@MDNO*-*MIDAS*day*no.******************************   056095
     C*            ZZMDNO - MIDAS day no.                             *   056095
     C*            @@INTD - Interest to date.                         *
     C*            @@TINT - Total interest.                           *
     C*            @@INFQ - Interest payment frequency.               *
     C*            @@NXIP - Next interest payment date.               *
     C*            @@VDAT - Value date.                               *
     C*            @@INCM - Interest calculation method.              *
     C*            @@DLAM - Deal amount.                              *
     C*            @@EIRT - Effective interest rate.                  *
     C*            @@MTXI - MIDAS taxable indicator.                  *
     C*            @@DEAL - Deal number.                              *
     C*            @@INMT - Interest at maturity.                     *
     C*            @TOTL  - Interest and amount of rolled over deal.  *
     C*            @EDAT  - Event date.                               *
     C*            @V     - Event name array.                         *
     C*            @ENAM  - Event name.                               *
     C*            @EFLG  - Event flag.                               *
     C*            @SMT   - Settlement method.                        *
     C*            @PRIND - Pay/receive indicator.                    *
     C*            @THEIR - Their instructions.                       *
     C*            @OUR   - Our instructions.                         *
     C*            @FORAC - For the account of.                       *
     C*            @VALD  - Value date.                               *
     C*            @XCUST - Stored customer number.                   *
     C*            @@BRMD - Maturity date for BRT calculation         *   S01383
     C*            @@ICST - In ccy start indicator                    *   CEU015
     C*                                                               *
     C*****************************************************************
     C           #ZI       BEGSR
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP16                                           S01408
     C*                                                                   S01408
     C*
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP41                                           S01408
     C*                                                                   S01408
     C*  *-----------------------------------------------------*
     C*  * Secondary Validation and Generation of Deal Number. *
     C*  *-----------------------------------------------------*
     C*
     C**  If a deal number has not been input, and the action code is
     C**  not 'I', the deal number is invalid.
     C           DDDLNO    IFEQ *BLANKS                    B1
     C           DDACTN    IFNE 'I'                        B*2
     C                     MOVEL'MMM0111' @MSGID           **2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  Otherwise give the deal a deal no.
     C                     ELSE                            X*2
     C***********                                                         E19346
     C****Check for a live record on CADLFALL.                            E19346
     C************IN65     DOUEQ'0'                        B**3           E19346
     C***********1         SETLLCADLFALL                   ***3           E19346
     C***********          READ CADLFALL                 65***3           E19346
     C***********                                                         E19346
     C****If*a*live record is found, delete it.                           E19346
     C************IN65     IFEQ '0'                        B***4          E19346
     C***********          DELETCADLFAP0                   ****4          E19346
     C***********                                                         E19346
     C****Otherwise, call the regeneration program.                       E19346
     C***********          ELSE                            X***4          E19346
     C***********          CALL 'CA0040'                   ****4          E19346
     C***********          PARM           @TERM            ****4          E19346
     C***********                                                         E19346
     C****If*an*error occurs in the called program, perform a rollback,   E19346
     C****and*by-pass all further processing.                             E19346
     C***********@TERM     IFEQ 'E'                        B****5         E19346
     C***********          ROLBK                           *****5         E19346
     C***********          MOVE '1'       *INKC                           E19346
     C***********          EXSR #C                         *****5         E19346
     C***********          END                             E****5         E19346
     C***********          END                             E***4          E19346
     C***********          END                             E**3           E19346
     C***********                                                         E19346
     C****Set*up*the generated Deal No. in the screen and pgm fields.     E19346
     C**  Set the 'Deal No. generated' flag to 'Y'.                       E19346
     C***********          MOVE FKDN38    DDDLNO           **2            E19346
     C***********          MOVE FKDN38    @DLNO            **2            E19346
     C                     MOVE *ZEROS    @DLNO            **2            E19346
     C                     MOVE FKDN38    DLENT            **2            S01177
     C                     MOVE 'Y'       @AUTO            **2
     C                     END                             E*2
     C                     ELSE                            X1             E20041
     C                     MOVE 'Y'       @MAN    1        *1             E20041
     C                     END                             E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C121                                           S01408
     C*                                                                   S01408
     C*
     C*  *--------------------*
     C*  * Validate Deal Type *
     C*  *--------------------*
     C*
     C**  If the action code is 'A' and the Deal Type has changed, the
     C**  input is invalid.
     C           DDACTN    IFEQ 'A'                        B1
     C           @TYPE     ANDNEDDTYPE                     B1
     C/COPY WNCPYSRC,MM0089C451
     C                     MOVE @TYPE     DDTYPE           *1
     C                     MOVE '1'       *IN03            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0398' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  Otherwise, it must not be blank.....
     C                     ELSE                            X1
     C           DDTYPE    IFEQ *BLANKS                    B*2
     C                     MOVEL'MMM0245' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     MOVE '1'       *IN03            **2
     C                     MOVE '1'       *IN41            **2
     C*
     C**  ... And it must have a value of IT,IP,TD,TI,CI,LN,CD,CL or DL
     C                     ELSE                            X*2
     C/COPY WNCPYSRC,MM0089C421
     C           DDTYPE    IFNE 'IT'                       B**3
     C           DDTYPE    ANDNE'IP'                       B**3
     C           DDTYPE    ANDNE'TD'                       B**3
     C           DDTYPE    ANDNE'TI'                       B**3
     C/COPY WNCPYSRC,MM0089C015
     C           DDTYPE    ANDNE'CI'                       B**3
     C           DDTYPE    ANDNE'LN'                       B**3
     C           DDTYPE    ANDNE'CD'                       B**3
     C           DDTYPE    ANDNE'CL'                       B**3
     C           DDTYPE    ANDNE'DL'                       B**3
     C                     MOVE '1'       *IN03            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0112' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C*
     C**  If the Deal Type is 'LN' or 'DL', the CL module must exist on
     C****the*system.**(MODI1*field*from*TABTB10,*bit*3*is*off.)***       S01194
     C**  the system.  (ie. BGDKST field from SDMMODPD must be 'Y'.)      S01194
     C                     ELSE                            X**3
     C           DDTYPE    IFEQ 'LN'                       B***4
     C           DDTYPE    OREQ 'DL'                       B***4
     C*****                TESTB'3'       MODI1      73    ****4          S01194
     C*****      *IN73     IFEQ '1'                        B****5         S01194
     C           BGSYLN    IFNE 'Y'                        B****5         S01194
     C                     MOVE '1'       *IN03            *****5
     C                     MOVE '1'       *IN41            *****5
     C                     MOVEL'MMM0122' @MSGID           *****5
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C                     END                             E****5
     C/COPY WNCPYSRC,MM0089C231
     C                     END                             E***4
     C/COPY WNCPYSRC,MM0089C016
     C                     END                             E**3
     C/COPY WNCPYSRC,MM0089C422
     C                     END                             E*2
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C232
      *                                                                   CAC001
      **  Enable F19 for Funding Information if Analytical Accounting     CAC001
      **  is installed and deal type is not 'IL', 'ID'.                   CAC001
      *                                                                   CAC001
     C                     MOVE '0'       *IN88                           CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *IN03     ANDEQ'0'                                       CAC001
      *                                                                   CAC001
     C           DDTYPE    IFNE 'IL'                                      CAC001
     C           DDTYPE    ANDNE'ID'                                      CAC001
     C                     MOVE '1'       *IN88                           CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*
     C*  *------------------------*
     C*  * Determine Deal Status  *
     C*  *------------------------*
     C/COPY WNCPYSRC,MM0089C544
     C*
     C**  Determine the status the deal is to achieve.
     C           DDACTN    IFEQ 'I'                        B1
     C***********H1BOAR****ANDEQ'Y'************************B1*************S01319
     C           BNMMAU    ANDEQ'Y'                        B1             S01319
     C                     MOVE 'C'       @STS             *1
     C                     END                             E1
     C*
     C           DDACTN    IFEQ 'A'                        B1
     C           HKDSTS    ANDEQ'C'                        B1
     C                     MOVE 'C'       @STS             *1
     C                     END                             E1
     C*
     C           DDACTN    IFEQ 'I'                        B1
     C***********H1BOAR****ANDEQ'N'************************B1*************S01319
     C           BNMMAU    ANDEQ'N'                        B1             S01319
     C                     MOVE 'A'       @STS             *1
     C                     END                             E1
     C*
     C           DDACTN    IFEQ 'A'                        B1
     C           HKDSTS    ANDEQ'A'                        B1
     C***********H1RADL****ANDEQ'N'************************B1*************S01319
     C           BNMMRA    ANDEQ'N'                        B1             S01319
     C                     MOVE 'A'       @STS             *1
     C                     END                             E1
     C*
     C           DDACTN    IFEQ 'X'                        B1
     C                     MOVE 'A'       @STS             *1
     C                     END                             E1
     C*
     C           DDACTN    IFEQ 'A'                        B1
     C***********H1RADL****ANDEQ'Y'************************B1*************S01319
     C           BNMMRA    ANDEQ'Y'                        B1             S01319
     C           HKDSTS    IFEQ 'R'                        B*2
     C           HKDSTS    OREQ 'A'                        B*2
     C                     MOVE 'R'       @STS             **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           DDACTN    IFEQ 'D'                        B1
     C                     MOVE HKDSTS    @STS             *1
     C                     END                             E1
     C*
     C           DDACTN    IFEQ 'I'                        B1
     C                     MOVE 'I'       @DSTS            *1
     C                     ELSE                            X1
     C                     MOVE HKDSTS    @DSTS            *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C545
     C*
     C*  *-----------------------------------------*
     C*  * Set up Transaction Date in MIDAS Format *
     C*  *-----------------------------------------*
     C*
     C           DDACTN    IFEQ 'A'                        B1
     C                     Z-ADDHKDTYY    @YEAR            *1
     C                     Z-ADDHKDTMM    @MNTH            *1
     C                     Z-ADDHKDTDD    @DAY             *1
     C           @DATE     IFEQ 0                          B*2
     C                     Z-ADD0         @TDYNO           **2
     C                     ELSE                            X*2
     C                     Z-ADD@DATE     @@DTIN           **2
     C                     EXSR ZA0770                     **2
     C                     MOVE @@DTOU    @DAT             **2
     C                     CALL 'ZA0270'                   **2
     C                     PARM           @DAT             **2
     C*****                PARM           DATF             **2            S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2
     C                     PARM           @TDYNO           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C/COPY WNCPYSRC,MM0089C111                                           S01408
     C*  *------------------------*
     C*  * Validate Deal Sub-Type *
     C*  *------------------------*
     C*
     C**  Check whether the field has been amended while the action
     C**  code is 'A' - if so, the field must have been defined as
     C**  amendable on MMCDAFLL.
     C           DDACTN    IFEQ 'A'                        B1
     C           @DSTS     ANDNE'C'                        B1
     C           DDSTYP    ANDNE@STYP                      B1
     C/COPY WNCPYSRC,MM0089C452
     C           DDACTN    OREQ 'A'                        B1
     C           @DSTS     ANDEQ'C'                        B1
     C           DDSTYP    ANDNE@STYP                      B1
     C           HHDLSA    ANDEQ'N'                        B1
     C/COPY WNCPYSRC,MM0089C453
     C                     MOVE '1'       *IN04            *1
     C                     MOVE '1'       *IN41            *1
     C           @DSTS     IFEQ 'C'                        B*2
     C                     MOVEL'MMM0400' @MSGID           **2
     C                     ELSE                            X*2
     C                     MOVEL'MMM0401' @MSGID           **2
     C                     END                             E*2
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE @STYP     DDSTYP           *1
     C*
     C**  Check whether the field is blank - if so and the status will
     C**  not be complete, or if the status will be complete and the
     C**  field is defined as mandatory entry on MMMCOMLL, this is an
     C**  error.
     C                     ELSE                            X1
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP73                                           S01408
     C*                                                                   S01408
     C           @STS      IFEQ 'C'                        B*2
     C           ICDSTM    ANDNE'N'                        B*2
     C           DDSTYP    ANDEQ*BLANKS                    B*2
     C           @STS      ORNE 'C'                        B*2
     C           DDSTYP    ANDEQ*BLANKS                    B*2
     C/COPY WNCPYSRC,MM0089C086
     C                     MOVE '1'       *IN04            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0246' @MSGID           **2
     C/COPY WNCPYSRC,MM0089C221
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  If the sub-type is valid to this point, it should exist on
     C****FDDLSTLL.******                                                 S01194
     C**  SDDLSTPD.                                                       S01194
     C                     ELSE                            X*2
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CVS1                                           S01408
     C*                                                                   S01408
     C*
     C****Set*up*key*for*FDDLSTLL**                                       S01194
     C**  Access deal sub type file                                       S01194
     C           DDSTYP    IFNE *BLANKS                    B**3
     C*****                MOVE *BLANKS   @KEY             ***3           S01194
     C*****                MOVE '42'      @KEY1            ***3           S01194
     C*****                MOVE DDSTYP    @KEY             ***3           S01194
     C*****      @KEY      CHAINFDDLSTLL             65    ***3           S01194
     C*****                                                               S01194
     C                     CALL 'AODLSTR0'                 ***3           S01194
     C                     PARM *BLANKS   @RTCD   7        ***3           S01194
     C                     PARM '*KEY   ' @OPTN   7        ***3           S01194
     C                     PARM DDSTYP    @AQCD   2        ***3           S01194
     C           SDDLST    PARM SDDLST    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                     B***4          S01194
     C**  If no record found, the deal sub type is invalid
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C*****      RECI      OREQ '*'                        B***4          S01194
     C                     MOVE '1'       *IN04            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0113' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     ELSE                                           E70
     C                     MOVELASDSTC    DDSTYP                          E70
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP74                                           S01408
     C*                                                                   S01408
     C                     END                             E1
     C*                                                                   AUS011
     C** *----------------------------------------*                       AUS011
     C** * Validate Deal type/subtype combination *                       AUS011
     C** *----------------------------------------*                       AUS011
     C*                                                                   064243
     C** The deal types/subtypes table should be checked only if the      064243
     C** subtype is not blank.                                            064243
     C*                                                                   064243
     C/COPY WNCPYSRC,MM0089C087
     C           DDSTYP    IFNE *BLANKS                                   064243
     C*                                                                   AUS011
     C**  Record must exist on FDDTSTL1                                   AUS011
     C*                                                                   AUS011
     C           @DTSTK    CHAINFDDTSTL1             65                   AUS011
     C*                                                                   AUS011
     C**  If no record found, the deal type/sub type is invalid           AUS011
     C*                                                                   AUS011
     C           *IN65     IFEQ '1'                                       AUS011
     C           RCID11    OREQ '*'                                       AUS011
     C                     SETON                     030441               AUS011
     C                     MOVEL'MMM1051' @MSGID                          AUS011
     C                     CALL 'ZA0240'                                  AUS011
     C                     PARM           @MSGID                          AUS011
     C                     END                                            AUS011
     C/COPY WNCPYSRC,MM0089C233
     C                     END                                            064243
     C/COPY WNCPYSRC,MM0089C017
     C*                                                                   S01136
     C*  *----------------------------------*                             S01136
     C*  * Validate Federal funds indicator *                             S01136
     C*  *----------------------------------*                             S01136
      *                                                                   S01136
      ** fed funds cannot be changed                                      S01136
     C           @STS      IFNE 'C'                        B1             S01136
     C           DDACTN    ANDEQ'A'                        B1             S01136
     C           DDFEDF    ANDNE@FEDF                      *1             S01136
     C/COPY WNCPYSRC,MM0089C454
     C                     MOVE '1'       *IN40            *1             S01136
     C                     MOVE '1'       *IN41            *1             S01136
     C                     MOVEL'MMM0396' @MSGID           *1             S01136
     C                     CALL 'ZA0240'                   *1             S01136
     C                     PARM           @MSGID           *1             S01136
     C                     MOVE @FEDF     DDFEDF           *1             S01136
     C                     END                             E1             S01136
      *                                                                   S01136
      ** validate the fed funds indicator, must be Y or blank             S01136
      ** and currency must be US dollars if Y                             S01136
     C           DDFEDF    IFNE 'Y'                        B1             S01136
     C           DDFEDF    ANDNE' '                        *1             S01136
     C                     MOVE '1'       *IN40            *1             S01136
     C                     MOVE '1'       *IN41            *1             S01136
     C                     MOVEL'MMM0019' @MSGID           *1             S01136
     C                     CALL 'ZA0240'                   *1             S01136
     C                     PARM           @MSGID           *1             S01136
     C                     ELSE                            X1             S01136
     C           DDFEDF    IFEQ 'Y'                        B*2            S01136
     C*****      DDCCY     ANDNEUSCY                       **2      S01136S01194
     C           DDCCY     ANDNEBLUSCY                     **2            S01194
     C                     MOVE '1'       *IN40            **2            S01136
     C                     MOVE '1'       *IN41            **2            S01136
     C                     MOVEL'MMM0020' @MSGID           **2            S01136
     C                     CALL 'ZA0240'                   **2            S01136
     C                     PARM           @MSGID           **2            S01136
     C                     END                             E*2            S01136
     C                     END                             E1             S01136
     C/COPY WNCPYSRC,MM0089C018
     C*
     C*  *------------------------*
     C*  * Validate Deal Date     *
     C*  *------------------------*
     C*
     C****If*action*is*A*it*cannot*change.*****************************   087176
     C**  If action is A and Deals Status is not 'C', it cannot change.   087176
     C           DDACTN    IFEQ 'A'                        B1
     C           DDDLDT    ANDNE@DLDT                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C           HKDSTS    ANDNE'C'                                       087176
     C                     MOVE '1'       *IN05            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0382' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE @DLDT     DDDLDT           *1
     C*
     C**  The Deal Date must be entered.
     C                     ELSE                            X1
     C/COPY WNCPYSRC,MM0089C224
     C           DDDLDT    IFEQ *BLANKS                    B*2
     C/COPY WNCPYSRC,MM0089C019
     C                     MOVE '1'       *IN05            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0248' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C/COPY WNCPYSRC,MM0089C020
     C*
     C**  Validate that the deal date is a valid date.
     C                     ELSE                            X*2
     C                     TESTN          DDDLDT     6263  **2
     C                     MOVE DDDLDT    @TEST            **2
     C                     TESTZ          @TEST          73**2
     C           *IN62     IFEQ '1'                        B**3
     C           *IN73     ANDEQ'1'                        B**3
     C           *IN63     OREQ '1'                        B**3
     C           *IN73     ANDEQ'1'                        B**3
     C                     MOVE DDDLDT    @DAT             ***3
     C                     CALL 'ZA0270'                   ***3
     C                     PARM           @DAT             ***3
     C*****                PARM           DATF             ***3           S01194
     C                     PARM           BJDFIN           ***3           S01194
     C                     PARM           @RTCDE           ***3
     C                     PARM           @DAYNO           ***3
     C                     END                             E**3
     C*
     C**  If the return code is 1 then the input date is invalid or
     C**  non-numeric.
     C           @RTCDE    IFEQ '1'                        B**3
     C           *IN73     OREQ '0'                        B**3
     C           *IN62     OREQ '0'                        B**3
     C           *IN63     ANDEQ'0'                        B**3
     C                     MOVE '1'       *IN05            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0124' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C*
     C**  If the date is valid, carry out further validation.
     C                     ELSE                            X**3
     C*
     C**  The deal date must not be greater than the run date
     C*****      @DAYNO    IFGT RUND                       B***4          S01194
     C           @DAYNO    IFGT BJRDNB                     B***4          S01194
     C                     MOVE '1'       *IN05            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0249' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C*
     C**  The deal date must not be greater than the value date.
     C*
     C**  First check that the value date is a valid date.
     C                     TESTN          DDVDAT     6263  ***3
     C                     MOVE DDVDAT    @TEST            ***3
     C                     TESTZ          @TEST          73***3
     C           *IN62     IFEQ '1'                        B***4
     C           *IN73     ANDEQ'1'                        B***4
     C           *IN63     OREQ '1'                        B***4
     C           *IN73     ANDEQ'1'                        B***4
     C                     MOVE DDVDAT    @DAT             ****4
     C                     CALL 'ZA0270'                   ****4
     C                     PARM           @DAT             ****4
     C*****                PARM           DATF             ****4          S01194
     C                     PARM           BJDFIN           ****4          S01194
     C                     PARM           @RTCDE           ****4
     C                     PARM           @VDYNO           ****4
     C                     END                             E***4
     C*
     C**  If the value date is invalid then this check is not carried
     C**  out.
     C           @RTCDE    IFNE '1'                        B***4
     C           *IN63     IFEQ '1'                        B****5
     C           *IN73     ANDEQ'1'                        B****5
     C           *IN62     OREQ '1'                        B****5
     C           *IN73     ANDEQ'1'                        B****5
     C           @DAYNO    IFGT @VDYNO                     B*****6
     C                     MOVE '1'       *IN05            ******6
     C                     MOVE '1'       *IN41            ******6
     C                     MOVEL'MMM0250' @MSGID           ******6
     C                     CALL 'ZA0240'                   ******6
     C                     PARM           @MSGID           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C*
     C****The*date must not be a holiday in the local currency.           S01195
     C****(now done after validation of Booking Branch)                   S01195
     C*****                MOVE LOCY      @@CCY            ***3           S01195
     C*****                Z-ADD@DAYNO    @@MNO            ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C*****                                                               S01195
     C****If @@HIND   = 'H' then the date is a holiday.                   S01195
     C*****      @@HIND    IFEQ 'H'                        B***4          S01195
     C**********           MOVE '1'       *IN41            ****4    E12365S01195
     C*****                MOVE '1'       *IN55            ****4    E12365S01195
     C**********           MOVEL'MMM0251' @MSGID           ****4    E12365S01195
     C*****                MOVEL'MMM1038' @MSGID           ****4    E12365S01195
     C*****                CALL 'ZA0240'                   ****4          S01195
     C*****                PARM           @MSGID           ****4          S01195
     C*****                END                             E***4          S01195
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** if the deal date is valid, store it on Standard Deal
     C********** *IN05     IFEQ '0'                        B*2            E12365
     C           *IN05     IFEQ '1'                        B*2            E12365
     C           *IN55     ANDEQ'1'                        B*2            E12365
     C           *IN05     OREQ '0'                        B*2            E12365
     C                     Z-ADD@DAYNO    IKDDND           **2
     C                     END                             E*2
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089CP97                                           S01408
     C*
     C*  *------------------------*
     C*  * Validate Branch Code   *
     C*  *------------------------*
     C*
      ** Booking branch code validation only when MULTI-BRANCHING         S01117
      ** indicator is on.                                                 S01117
     C           @MBIN     IFNE 'Y'                        B1             S01117
      *                                                                   S01117
      ** Set up the booking branch code field with default value          S01117
     C           DDBRCA    IFEQ *BLANKS                    B*2            S01117
     C                     MOVE BJSBRC    DDBRCA           **2            S01117
     C                     MOVE BJSBRC    @BRCA            **2            S01117
     C                     MOVE BJSBRC    IKDBRC           **2            E00032
     C                     MOVE BJSBRC    IBRCA            **2            163715
     C                     END                             E*2            S01117
     C                     ELSE                            X1             S01117
     C**  The Branch Code is not amendable for R and A status deals,      S01117
     C**  and is only amendable for status C if this is indicated on      S01117
     C**  MMCDAFLL.                                                       S01117
     C           DDACTN    IFEQ 'A'                        B*2            S01117
     C           @DSTS     ANDNE'C'                        B*2            S01117
     C*****      DDBRCD    ANDNE@BRCD                      B1             S01117
     C           DDBRCA    ANDNE@BRCA                      B*2            S01117
     C           DDACTN    OREQ 'A'                        B*2            S01117
     C           @DSTS     ANDEQ'C'                        B*2            S01117
     C*****      DDBRCD    ANDNE@BRCD                      B1             S01117
     C*****      HHBRCA    ANDEQ'N'                        B1             S01117
     C*****                MOVE @BRCD     DDBRCD           *1             S01117
     C           DDBRCA    ANDNE@BRCA                      B*2            S01117
     C           HHBRCA    ANDEQ'N'                        B*2            S01117
     C/COPY WNCPYSRC,MM0089C455
     C                     MOVE @BRCA     DDBRCA           **2            S01117
     C                     MOVE '1'       *IN06            **2            S01117
     C                     MOVE '1'       *IN41            **2            S01117
     C           @DSTS     IFEQ 'C'                        B**3           S01117
     C                     MOVEL'MMM0380' @MSGID           ***3           S01117
     C                     ELSE                            X**3           S01117
     C                     MOVEL'MMM0381' @MSGID           ***3           S01117
     C                     END                             E**3           S01117
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C                     ELSE                            X*2            S01117
     C*
     C****If it is a single branch system (ie Default Branch No. is not   S01117
     C****000), then the input is optional, but must match the value of   S01117
     C****the Default Branch No. held on TABTB10.                         S01117
     C*****                ELSE                            X1             S01117
     C*****      DFBR      IFNE 0                          B*2            S01117
     C*****                MOVE DFBR      @WK1             **2            S01117
     C*****      @WK1      IFNE DDBRCD                     B**3           S01117
     C*****      DDBRCD    ANDNE*BLANKS                    B**3           S01117
     C*****                MOVE '1'       *IN06            ***3           S01117
     C*****                MOVE '1'       *IN41            ***3           S01117
     C*****                MOVEL'MMM0114' @MSGID           ***3           S01117
     C*****                CALL 'ZA0240'                   ***3           S01117
     C*****                PARM           @MSGID           ***3           S01117
     C*****                ELSE                            X**3           S01117
     C*****                                                               S01117
     C****Set up the branch code field with the default value.            S01117
     C*****      DDBRCD    IFEQ *BLANKS                    B***4          S01117
     C*****                MOVE DFBR      DDBRCD           ****4          S01117
     C*****                MOVE DFBR      @BRCD            ****4          S01117
     C*****                END                             E***4          S01117
     C*****                                                               S01117
     C****Check that the default branch code is valid.                    S01117
     C*****                MOVE *BLANKS   @KEY             ***3           S01117
     C*****                MOVE '10'      @KEY1            ***3           S01117
     C*****                MOVE DDBRCD    @KEY             ***3           S01117
     C*****      @KEY      CHAINFDBRNCLL             65    ***3           S01117
     C*****      *IN65     IFEQ '1'                        B***4          S01117
     C*****      RECI      OREQ '*'                        B***4          S01117
     C*****                MOVE '1'       *INLR            ****4          S01117
     C*****                MOVE '1'       *INU7            ****4          S01117
     C*****                MOVE '1'       *INU8            ****4          S01117
     C*****                MOVE '1'       *INKC            ***************S01117
     C*****                MOVEL'FDBRNCLL'DBFILE           * DBERROR 001 *S01117
     C*****                MOVEL@KEY      DBKEY            ***************S01117
     C*****                MOVE '001'     DBASE            ****4          S01117
     C*****                EXSR #C                         ****4          S01117
     C*****                END                             E***4          S01117
     C*****                END                             E**3           S01117
     C*****                                                               S01117
     C****Otherwise, the system is multibranch.  If the status will be    S01117
     C****complete, the field is described as mandatory on MMMCOMLL,      S01117
     C****and the field is blank, or the deal will have any other         S01117
     C****status and is blank, this is an error.                          S01117
     C*****                ELSE                            X*2            S01117
     C*****      @STS      IFEQ 'C'                        B**3           S01117
     C*****      ICBRSM    ANDNE'N'                        B**3           S01117
     C*****      DDBRCD    ANDEQ*BLANKS                    B**3           S01117
     C*****      @STS      ORNE 'C'                        B**3           S01117
     C*****      DDBRCD    ANDEQ*BLANKS                    B**3           S01117
     C*****                MOVE '1'       *IN06            ***3           S01117
     C*****                MOVE '1'       *IN41            ***3           S01117
     C*****                MOVEL'MMM0115' @MSGID           ***3           S01117
     C*****                CALL 'ZA0240'                   ***3           S01117
     C*****                PARM           @MSGID           ***3           S01117
     C*****                                                               S01117
     C**  Check that the Branch Code exists on FDBRNCLL.                  S01117
     C*****                ELSE                            X**3           S01117
     C*****      DDBRCD    IFNE *BLANKS                    B***4          S01117
     C*****      DDBRCA    IFNE *BLANKS                    B***4          S01117
     C*****                                                               S01117
     C****Set up key for FDBRNCLL.                                        S01117
     C*****                MOVE *BLANKS   @KEY             ****4          S01117
     C*****                MOVE '10'      @KEY1            ****4          S01117
     C*****                MOVE DDBRCD    @KEY             ****4          S01117
     C*****      @KEY      CHAINFDBRNCLL             65    ****4          S01117
     C*****      *IN65     IFEQ '1'                        B****5         S01117
     C*****      RECI      OREQ '*'                        B****5         S01117
     C*****                MOVE '1'       *IN06            *****5         S01117
     C*****                MOVE '1'       *IN41            *****5         S01117
     C*****                MOVEL'MMM0115' @MSGID           *****5         S01117
     C*****                CALL 'ZA0240'                   *****5         S01117
     C*****                PARM           @MSGID           *****5         S01117
     C*****                END                             E****5         S01117
     C*****                END                             E***4          S01117
     C*****                END                             E**3           S01117
     C*****                END                             E*2            S01117
     C*                                                                   S01117
     C** If Booking branch is blank, default to branch in MUSER dtaara    S01117
     C**                                                                  S01117
     C           DDBRCA    IFEQ *BLANKS                    B**3           S01117
     C                     MOVE BRC       DDBRCA           ***3           S01117
     C                     MOVE BRC       @BRCA            ***3           S01117
     C                     END                             E**3           S01117
      *                                                                   S01117
     C**  Check that the Branch Code exists on SDBRCHPD.            S01117S01194
     C** (Use new Standing Data for 3A Location Code (2A on old fileS01117S01194
     C**********           CALL 'AOBRCHR0'                 **2      S01117S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7        **2      S01117S01194
     C                     PARM '*KEY   ' @OPTN   7        **2      S01117S01194
     C                     PARM DDBRCA    @DSNB   3        **2      S01117S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                             S01117S01194
     C           @RTCD     IFNE *BLANKS                    B**3     S01117S01194
     C                     MOVE '1'       *IN06            ***3           S01117
     C                     MOVE '1'       *IN41            ***3           S01117
     C                     MOVEL'MMM0115' @MSGID           ***3           S01117
     C                     CALL 'ZA0240'                   ***3           S01117
     C                     PARM           @MSGID           ***3           S01117
     C                     ELSE                            X**3           S01117
      * PROCESS FOR USE OF '?'                                            S01117
     C                     MOVELA8BRCD    DDBRCA           ***3           S01117
     C                     MOVELA8BRCD    @BRCA            ***3           S01117
     C                     END                             E**3           S01117
      *                                                                   S01117
      ** Validate the booking Branch against User only if no error on     S01117
      ** the booking Branch                                               S01117
      *                                                                   S01117
     C           *IN06     IFEQ '0'                        B**3
     C                     CALL 'ZVACTBU'                  ***3           S01117
     C                     PARM DDACTN    ZACTN   1        ***3           S01117
     C                     PARM DDBRCA    ZBRCDX  3        ***3           S01117
     C                     PARM           ERR     10       ***3           S01117
     C           ERR       IFEQ 1                          B***4          S01117
      * no valid booking branches found for user                          S01117
     C                     MOVE '1'       *IN06            ****4          S01117
     C                     MOVE '1'       *IN41            ****4          S01117
     C                     MOVEL'FXM0290' @MSGID           ****4          S01117
     C                     CALL 'ZA0240'                   ****4          S01117
     C                     PARM           @MSGID           ****4          S01117
     C                     END                             E***4          S01117
      *                                                                   S01117
     C           ERR       IFEQ 2                          B***4          S01117
      * this booking branch invalid for user                              S01117
     C                     MOVE '1'       *IN06            ****4          S01117
     C                     MOVE '1'       *IN41            ****4          S01117
     C                     MOVEL'FXM0291' @MSGID           ****4          S01117
     C                     CALL 'ZA0240'                   ****4          S01117
     C                     PARM           @MSGID           ****4          S01117
     C                     END                             E***4          S01117
     C                     END                             E**3           S01117
      *                                                                   S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
     C****If there were no errors, move the branch short name to the
     C**  If there were no errors move the branch code to                 S01117
     C**  Standard Deal.
     C           *IN06     IFEQ '0'                        B*2
     C*****                MOVE BRCA      IKDBRC           **2            S01117
     C***********@MBIN     IFEQ 'Y'                        B**3     S01117E00032
     C                     MOVE DDBRCA    IKDBRC           ***3           S01117
     C*                                                                   S01392
     C** Default Round Down Indicator from SDBRCHPD                       S01392
     C*                                                                   S01392
     C                     MOVELA8RDFC    BRRDFC                          S01392
     C***********          ELSE                            X**3     S01117E00032
     C***********          MOVE BJEGCD    IKDBRC           ***3     S01117E00032
     C***********          END                             E**3     S01117E00032
     C                     END                             E*2
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C516
     C*
     C****If*no*error*on*Value*Date*or*Branch*then*use*Booking*BrancS01117LN0234
     C****Location*to*verify*that*the*Value*Date*is*not*a*holiday   S01117LN0234
     C****in*the*local*currency.                                    S01117LN0234
     C****(Only*if*not*settled*through*a*nostro)                       E81LN0234
     C*
     C**  If no error on Deal  Date or Branch then use Booking Branch     LN0234
     C**  Location to verify that the Deal  Date is not a holiday         LN0234
     C**  in the local currency.                                          LN0234
     C           *IN05     IFEQ '0'                        B1             S01117
     C           *IN06     ANDEQ'0'                        *1             S01117
     C***********PMRSTM    IFNE 00                                        E81
     C***********PMRSTM    ANDNE01                                    E81 LN0234
     C***********PMRSTM    ANDNE07                                    E81 LN0234
     C***********PMRSTM    ANDNE08                                    E81 LN0234
     C***********PMPSTM    ANDNE00                                        E81
     C***********PMPSTM    ANDNE01                                    E81 LN0234
     C***********PMPSTM    ANDNE07                                    E81 LN0234
     C***********PMPSTM    ANDNE08                                    E81 LN0234
     C                     MOVE BJLCCY    ZCCY             *1             S01117
     C                     Z-ADD@DAYNO    ZDAYNO           *1             S01117
     C                     MOVE A8LCCD    ZLOC             *1             S01117
     C                     EXSR ZCHKH                      *1             S01117
     C*                                                                   S01117
     C**  If ZIND   = 'H' then the date is a holiday.                     S01117
     C           ZIND      IFEQ 'H'                        B*2            S01117
     C/COPY WNCPYSRC,MM0089C443
     C                     MOVE '1'       *IN05            **2            S01117
     C                     MOVE '1'       *IN55            **2            S01117
     C                     MOVEL'MMM1038' @MSGID           **2            S01117
     C/COPY WNCPYSRC,MM0089C308
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C/COPY WNCPYSRC,MM0089C309
     C                     END                             E*2            S01117
     C**************       END                                            E81
     C                     END                             E1             S01117
     C*                                                                   CPM004
     C** Access Portfolio Management Customer Details                     CPM004
     C**                                                                  CPM004
     C*                                                                   CPM004
     C/COPY WNCPYSRC,MM0089C345
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     MOVELDDCUST    I#CUST                          CPM004
     C                     MOVELDDBRCA    I#BRCA                          CPM004
     C                     MOVELDDBOKC    I#BOOK                          CPM004
     C                     MOVELDDPTFR    I#PTFR                          CPM004
     C                     MOVELFCPORS    I#PORS                          CPM004
     C                     MOVELFCR997    I#R997                          CPM004
     C                     MOVEL'MM0089'  I#CPGM                          CPM004
     C*                                                                   CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CPM004
     C                     PARM '*KEY   ' P@OPTN  7        I:Option       CPM004
     C                     PARM           I@PARM           I:Parameters   CPM004
     C                     PARM *BLANKS   O@PARM           O:Parameters   CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY            O:Format       CPM004
     C*                                                                   CPM004
     C                     MOVELP@RTCD    ERPLCS  7                       CPM004
     C                     ENDIF                                          192008
      *                                                                   S01165
      ** validate the book code,                                          S01165
      *                                                                   S01165
      ** the field is mandatory                                           S01165
     C*                                                                   CPM004
     C** Book code defaulting:                                            CPM004
     C** 1) If Book Code Optional from DL ICD is 'Y', default book        CPM004
     C**    code to SDDEALPD/BNBKCD (as amended by 027217)                CPM004
     C** 2) Else, if Bank Portfolio is supported default book code        CPM004
     C**    to output book code determined from AOPLCSR1 (added by        CPM004
     C**    CPM004)                                                       CPM004
     C** 3) Else, send error message, book code is mandatory.             CPM004
     C*                                                                   CPM004
     C           DDBOKC    IFEQ *BLANKS                    B1             S01165
     C*                                                                   CPM004
     C           BNBCOP    IFNE 'Y'                                       027568
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           ERPLCS    ANDEQ*BLANKS                                   CPM004
     C                     MOVELO#BOOK    DDBOKC                          CPM004
     C                     ELSE                                           CPM004
     C                     MOVE '1'       *IN48            *1             S01165
     C                     MOVE '1'       *IN41            *1             S01165
     C                     MOVEL'FXM1037' @MSGID           *1             S01165
     C                     CALL 'ZA0240'                   *1             S01165
     C                     PARM           @MSGID           *1             S01165
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ELSE                                           027568
     C                     MOVE BNBKCD    IKBOKC                          027568
     C                     MOVE BNBKCD    DDBOKC                          CPM004
     C                     END                                            027568
      *                                                                   S01165
     C                     END                             E1             S01165
      *                                                                   108558
      ** Only allow to amend book code if the deal is complete.           108558
      *                                                                   108558
     C           *IN48     IFEQ '0'                        B1             108558
     C           DDBOKC    ANDNE@BOKC                                     108558
     C           HKDSTS    ANDNE'C'                                       108558
     C           DDACTN    ANDEQ'A'                                       108558
     C/COPY WNCPYSRC,MM0089C547
     C                     MOVE '1'       *IN48            *1             108558
     C                     MOVE '1'       *IN41            *1             108558
     C                     MOVEL'MMM2570' @MSGID           *1             108558
     C                     CALL 'ZA0240'                   *1             108558
     C                     PARM           @MSGID           *1             108558
     C                     END                             E1             108558
      *                                                                   108558
     C**********           ENDIF                                   CPB001 192008
     C/COPY WNCPYSRC,MM0089C346
      *                                                                   S01165
      ** it is amendable                                                  S01165
     C           *IN48     IFEQ '0'                        B1             S01165
     C           DDBOKC    ANDNE@BOKC                      *1             S01165
     C           DDBOKC    ANDNE*BLANKS                                   027568
     C******     DDBOKC    CHAINBOOKD                48    *1       S01165S01194
     C******     *IN48     IFEQ '1'                        B2       S01165S01194
     C                     CALL 'AOBOOKR0'                 *1             S01194
     C                     PARM *BLANKS   @RTCD   7        *1             S01194
     C                     PARM '*KEY   ' @OPTN   7        *1             S01194
     C                     PARM DDBOKC    @A1CD   2        *1             S01194
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                     B2             S01194
     C                     MOVE '1'       *IN48            B2       S01165S01194
     C                     MOVE '1'       *IN41            *2             S01165
     C                     MOVEL'FXM1038' @MSGID           *2             S01165
     C                     CALL 'ZA0240'                   *2             S01165
     C                     PARM           @MSGID           *2             S01165
     C                     ELSE                                           E70
     C                     MOVELBDBKCD    DDBOKC                          E70
     C                     END                             E2             S01165
      *                                                                   S01165
     C                     END                             E1             S01165
      *                                                                   S01165
      ** store valid book code in standard deal                           S01165
      *                                                                   S01165
     C           *IN48     IFEQ '0'                        B1             S01165
     C           DDBOKC    ANDNE*BLANKS                                   027568
     C                     MOVE DDBOKC    IKBOKC           *1             S01165
     C                     END                             E1             S01165
      *                                                                   S01165
      ** validate the linked reference number,                            S01165
      *                                                                   S01165
      ** the field is optional and amendable                              S01165
     C           DDLNKN    IFNE @LNKN                      B1             S01165
     C           DDLNKN    ANDNE*BLANKS                    *1             E20636
      *                                                                   E20636
      ** Linked Ref. No must be numeric but can have trailing blanks.     E20636
      **                                                                  E20636
     C                     MOVE *BLANKS   @@ALPH           *1             E20636
     C                     Z-ADD0         @@IDP            *1             E20636
     C                     Z-ADD6         @@IINT           *1             E20636
     C                     MOVE DDLNKN    @@ALPH           *1             E20636
     C                     MOVE 'N'       @@MTID           *1             E20636
     C*********************MOVE 'N'       @@CLN0           *1       E20636S01314
     C                     EXSR ZA0840                     *1             E20636
      * If error.                                                         E20636
     C           DDLNKN    COMP *ZEROS                 4949*1             S01165
     C************IN49     IFEQ '1'                        B2       S01165E20636
     C           @@ERCD    IFNE 0                          B2             E20636
     C           *IN49     OREQ '1'                        *2             E20636
     C                     MOVE '1'       *IN49            *2             E20636
     C                     MOVE '1'       *IN41            *2             S01165
     C                     MOVEL'FXM1039' @MSGID           *2             S01165
     C                     CALL 'ZA0240'                   *2             S01165
     C                     PARM           @MSGID           *2             S01165
     C                     END                             E2             S01165
      *                                                                   S01165
     C                     END                             E1             S01165
     C*                                                                   S01434
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CEXV                                           S01408
     C*                                                                   S01408
      *                                                                   S01165
      ** store valid linked reference number in standard deal             S01165
      *                                                                   S01165
     C           *IN49     IFEQ '0'                        B1             S01165
     C           @@ERCD    ANDEQ0                          *1             E20636
     C                     MOVE DDLNKN    IKLNKN           *1             S01165
     C                     END                             E1             S01165
     C*
     C*  *------------------------*
     C*  * Validate Broker Code   *
     C*  *------------------------*
     C/COPY WNCPYSRC,MM0089C381
     C*
     C**  The Broker Code is not amendable for R and A status deals,
     C**  and is only amendable for status C if this is indicated on
     C**  MMCDAFLL.
     C           DDACTN    IFEQ 'A'                        B1
     C           @DSTS     ANDNE'C'                        B1
     C           DDBKCD    ANDNE@BKCD                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C           DDACTN    OREQ 'A'                        B1
     C           @DSTS     ANDEQ'C'                        B1
     C           HHBKRA    ANDEQ'N'                        B1
     C           DDBKCD    ANDNE@BKCD                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C456
     C                     MOVE '1'       *IN07            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVE @BKCD     DDBKCD           *1
     C           @DSTS     IFEQ 'C'                        B*2
     C                     MOVEL'MMM0390' @MSGID           **2
     C                     ELSE                            X*2
     C                     MOVEL'MMM0391' @MSGID           **2
     C                     END                             E*2
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  Check whether the field is blank - if so and the status will
     C**  not be complete, or if the status will be complete and the
     C**  field is defined as mandatory entry on MMMCOMLL, this is an
     C**  error.
     C                     ELSE                            X1
     C/COPY WNCPYSRC,MM0089C021
     C           @STS      IFEQ 'C'                        B*2
     C           ICBKCM    ANDNE'N'                        B*2
     C           DDBKCD    ANDEQ*BLANKS                    B*2
     C           @STS      ORNE 'C'                        B*2
     C           DDBKCD    ANDEQ*BLANKS                    B*2
     C                     MOVE '1'       *IN07            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0195' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C022
     C*
     C**  If the Broker Code is not blank it must be TELX, PHON or
     C**  MAIL or exist on the Broker file.
     C****May*aslo*be*PROM.*******************************                E14377
     C           DDBKCD    IFNE *BLANKS                    B*2
     C           DDBKCD    ANDNE'TELX'                     B*2
     C           DDBKCD    ANDNE'PHON'                     B*2
     C           DDBKCD    ANDNE'MAIL'                     B*2
     C********** DDBKCD    ANDNE'PROM'                     B*2            E14377
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C123                                           S01408
     C*                                                                   S01408
     C*
     C****Set*up*key to access FDBRKRLL.                                  S01194
     C*****                MOVE *BLANKS   @KEY             **2            S01194
     C*****                MOVE '80'      @KEY1            **2            S01194
     C*****                MOVE DDBKCD    @KEY             **2            S01194
     C*****      @KEY      CHAINFDBRKRLL             65    **2            S01194
     C*****      *IN65     IFEQ '1'                        B**3           S01194
     C*****      RECI      OREQ '*'                        B**3           S01194
     C                     CALL 'AOBROKR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM DDBKCD    @BQTX   4        **2            S01194
     C           SDBROK    PARM SDBROK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                     B**3           S01194
     C                     MOVE '1'       *IN07            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0197' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     ELSE                            X**3
     C*
     C**  If a record has been found, find the no. of decimal places
     C**  for the broker currency.
      *  (database error handling done in access program)                 S01194
     C*****                MOVE *BLANKS   @KEY             ***3           S01194
     C*****                MOVE '20'      @KEY1            ***3           S01194
     C*****                MOVE BKCY      @KEY2            ***3           S01194
     C*****                MOVE '1'       @KEY3            ***3           S01194
     C*****      @KEY      CHAINFDCCYTLL             65    ***3           S01194
     C*****                                                               S01194
     C****If no valid record is found, it is an error.                    S01194
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C*****      RECI      OREQ '*'                        B***4          S01194
     C*****                MOVE '1'       *INLR            ****4          S01194
     C*****                MOVE '1'       *INU7            ****4          S01194
     C*****                MOVE '1'       *INU8            ****4          S01194
     C*****                MOVE '1'       *INKC            ***************S01194
     C*****                MOVEL'FDCCYTLL'DBFILE           * DBERROR 002 *S01194
     C*****                MOVEL@KEY      DBKEY            ***************S01194
     C*****                MOVE '002'     DBASE            ****4          S01194
     C*****                EXSR #C                         ****4          S01194
     C*****                END                             E***4          S01194
     C                     MOVELA9BROK    DDBKCD                          E70
      *                                                                   081888
     C           *IN07     IFNE *ON                        If Broker code 081888
      *                                                    valid .        081888
     C                     CALL 'AOCURRR0'                 ***3           S01194
     C                     PARM '*DBERR ' @RTCD   7        ***3           S01194
     C                     PARM '*KEY   ' @OPTN   7        ***3           S01194
     C                     PARM A9BRCY    @AJCD   3        ***3           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*
     C**  Set up the broker ccy dec. places on the standard deal format.
     C*****                Z-ADDCDP       IKBCDP           ***3           S01194
     C                     Z-ADDA6NBDP    IKBCDP           ***3           S01194
     C                     ENDIF                                          081888
      *                                                                   081888
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*                                                                   AUS007
     C*  *------------------------*                                       AUS007
     C*  * Validate R/A Indicator *                                       AUS007
     C*  *------------------------*                                       AUS007
     C*                                                                   AUS007
     C**  Only process if Australian Brokerage switched on                AUS007
     C**  R/A indicator is not amendable.                              .  AUS007
     C           AUS007    IFEQ 'Y'                                       AUS007
     C           DDACTN    IFEQ 'A'                                       AUS007
     C           DDRACD    ANDNE@RACD                                     AUS007
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C457
     C                     MOVE '1'       *IN77                           AUS007
     C                     MOVE '1'       *IN41                           AUS007
     C                     MOVEL'MMM0394' @MSGID                          AUS007
     C                     CALL 'ZA0240'                                  AUS007
     C                     PARM           @MSGID                          AUS007
     C                     ELSE                                           AUS007
     C**                                                               .  AUS007
     C**  Amount and indicator not allowed for the following codes.    .  AUS007
     C**                                                               .  AUS007
     C           DDBKCD    IFEQ 'MAIL'                                    AUS007
     C           DDBKCD    OREQ 'TELX'                                    AUS007
     C           DDBKCD    OREQ 'PHON'                                    AUS007
     C           DDBKCD    OREQ 'RDS '                                    AUS007
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C124                                           S01408
     C*                                                                   S01408
     C           DDRACD    IFNE *BLANKS                                   AUS007
     C           DDBRKG    ORNE *BLANKS                                   AUS007
     C           DDRACD    IFNE *BLANKS                                   AUS007
     C                     MOVE '1'       *IN77                           AUS007
     C                     END                                            AUS007
     C           DDBRKG    IFNE *BLANKS                                   AUS007
     C                     MOVE '1'       *IN08                           AUS007
     C                     END                                            AUS007
     C                     MOVE '1'       *IN41                           AUS007
     C***********          MOVEL'MMM1052' @MSGID                    AUS007046259
     C                     MOVEL'MMM1057' @MSGID                          046259
     C                     CALL 'ZA0240'                                  AUS007
     C                     PARM           @MSGID                          AUS007
     C                     END                                            AUS007
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C101                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           AUS007
     C**                                                               .  AUS007
     C**  If foreign currency R/A indicator must be blank.             .  AUS007
     C**                                                               .  AUS007
     C           DDCCY     IFNE BJLCCY                                    AUS007
     C           DDRACD    ANDNE*BLANKS                                   AUS007
     C                     MOVE '1'       *IN77                           AUS007
     C                     MOVE '1'       *IN41                           AUS007
     C***********          MOVEL'MMM1053' @MSGID                    AUS007046259
     C                     MOVEL'MMM1058' @MSGID                          046259
     C                     CALL 'ZA0240'                                  AUS007
     C                     PARM           @MSGID                          AUS007
     C                     END                                            AUS007
     C**                                                               .  AUS007
     C**  If local currency R/A indicator must be 'R' or 'A'.          .  AUS007
     C**                                                               .  AUS007
     C           DDCCY     IFEQ BJLCCY                                    AUS007
     C           DDRACD    ANDEQ*BLANKS                                   AUS007
     C           DDACTN    ANDNE'X'                                       AUS007
     C                     MOVE '1'       *IN77                           AUS007
     C                     MOVE '1'       *IN41                           AUS007
     C***********          MOVEL'MMM1054' @MSGID                    AUS007046259
     C                     MOVEL'MMM1059' @MSGID                          046259
     C                     CALL 'ZA0240'                                  AUS007
     C                     PARM           @MSGID                          AUS007
     C                     END                                            AUS007
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C102                                           S01408
     C*                                                                   S01408
     C                     END                                            AUS007
     C                     END                                            AUS007
     C**                                                               .  AUS007
     C           *IN77     IFEQ '0'                                       AUS007
     C                     MOVELDDRACD    @@RACD                          AUS007
     C                     END                                            AUS007
     C                     END                                            AUS007
     C*
     C*  *------------------------*
     C*  * Validate Brokerage     *
     C*  *------------------------*
     C*
     C**  The Brokerage is not amendable for R and A status deals,
     C**  and is only amendable for status C if this is indicated on
     C**  MMCDAFLL.
     C           DDACTN    IFEQ 'A'                        B1
     C           @DSTS     ANDEQ'C'                        B1
     C           HHBKGA    ANDEQ'N'                        B1
     C           DDBRKG    ANDNE@BRKG                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C458
     C           DDACTN    OREQ 'A'                        B1
     C           @DSTS     ANDNE'C'                        B1
     C           DDBRKG    ANDNE@BRKG                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C                     MOVE '1'       *IN08            *1
     C                     MOVE '1'       *IN41            *1
     C           @DSTS     IFEQ 'C'                        B*2
     C                     MOVEL'MMM0394' @MSGID           **2
     C                     ELSE                            X*2
     C                     MOVEL'MMM0395' @MSGID           **2
     C                     END                             E*2
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE @BRKG     DDBRKG           *1
     C                     ELSE                            X1
     C*
     C****If*the*Brokerage*is*blank*it*is*valid,*if*the*Broker*was*invalidDT0012
     C****by-pass*the*Brkerage*validation.********************************DT0012
     C****If*the*Brokerage*is*blank*or*NIL*it*is*valid,************DT0012 063375
     C****if*the*Broker*was*invalid,*by-pass*the*Brokerage*validatiDT0012 063375
     C*                                                                   063375
     C** If the Brokerage is blank it is valid,                           063375
     C** if the Broker was invalid, by-pass the Brokerage validation.     063375
     C*                                                                   063375
     C           DDBRKG    IFNE *BLANKS                    B*2
     C***********DDBRKG    ANDNE'NIL'                              DT0012 063375
     C           *IN77     ANDEQ'0'                                       AUS007
     C           *IN07     ANDEQ'0'                        B*2
     C*
     C**  If the Broker was not entered it is an error to enter the
     C**  Brokerage.
     C           DDBKCD    IFEQ *BLANKS                    B**3
     C                     MOVE '1'       *IN08            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0199' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C*
     C**  If the Broker is TELX,MAIL, or PHON the Brokerage may
     C**  not be entered.
     C           DDBKCD    IFEQ 'TELX'                     B**3
     C           DDBKCD    OREQ 'MAIL'                     B**3
     C           DDBKCD    OREQ 'PHON'                     B**3
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C126                                           S01408
     C*                                                                   S01408
     C                     MOVE '1'       *IN08            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0194' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C***********          END                             E**2    AUS007 E52924
     C*
     C**  If there has been an error do not validate Brokerage further.
     C           *IN08     IFEQ '0'                        B**3
     C*                                                                   AUS007
     C** Australian Brokerage                                             AUS007
     C*                                                                   AUS007
     C           AUS007    IFEQ 'Y'                                       AUS007
     C           DDRACD    IFEQ 'R'                        B*2            AUS007
     C           DDBRKG    IFEQ *BLANKS                    B*3            AUS007
     C                     MOVE DDBKCD    BRKK1            CHAIN TO       AUS007
     C                     MOVE DDCCY     BRKK2            BROKR FILE     AUS007
     C***********          MOVE *IN89     WIN89   1                CEU003 136728
      *                                                                   CAC001
      **  Save *IN89 value                                                CAC001
      *                                                                   CAC001
     C                     MOVE *IN89     WIN89   1                       CAC001
      *                                                                   CAC001
     C           BRKKEY    CHAINBROKR                89    FOR RATE.      AUS007
     C           *IN89     IFEQ '0'                                       AUS007
     C           RECI      IFNE 'D'                                       AUS007
     C                     MOVE '1'       *IN08                           AUS007
     C                     MOVE '1'       *IN41                           AUS007
     C***********          MOVEL'MMM1055' @MSGID                    AUS007046259
     C                     MOVEL'MMM1060' @MSGID                          046259
     C                     CALL 'ZA0240'                                  AUS007
     C                     PARM           @MSGID                          AUS007
     C                     ELSE                                           AUS007
     C           BRRD      IFEQ 0                                         AUS007
     C                     MOVE '1'       *IN08                           AUS007
     C                     MOVE '1'       *IN41                           AUS007
     C***********          MOVEL'MMM1055' @MSGID                    AUS007046259
     C                     MOVEL'MMM1060' @MSGID                          046259
     C                     CALL 'ZA0240'                                  AUS007
     C                     PARM           @MSGID                          AUS007
     C                     ELSE                                           AUS007
     C                     MOVE BRRD      TEMP9   9                       AUS007
     C                     MOVEL'0.'      TEMP9                           AUS007
     C                     MOVELTEMP9     DDBRKG                          AUS007
     C                     END                                            AUS007
     C                     END                                            AUS007
     C                     ELSE                                           AUS007
     C                     MOVE '1'       *IN08                           AUS007
     C                     MOVE '1'       *IN41                           AUS007
     C***********          MOVEL'MMM1055' @MSGID                    AUS007046259
     C                     MOVEL'MMM1060' @MSGID                          046259
     C                     CALL 'ZA0240'                                  AUS007
     C                     PARM           @MSGID                          AUS007
     C                     END                                            AUS007
      *                                                                   CAC001
      **  Restore *IN89 value                                             CAC001
      *                                                                   CAC001
     C                     MOVE WIN89     *IN89                           CAC001
      *                                                                   CAC001
     C                     END                                            AUS007
     C*                                                                   AUS007
     C           *IN08     IFEQ '0'                                       AUS007
      *                                                                   AUS007
      ** call za0840 to validate rate has correct no of decimal           AUS007
      ** places and is a valid number.                                    AUS007
     C                     Z-ADD7         @@IDP            ***3           AUS007
     C                     Z-ADD4         @@IINT           ***3           AUS007
     C                     MOVE 'N'       @@MTID           ***3           AUS007
     C                     MOVE *BLANKS   @@ALPH           ***3           AUS007
     C                     MOVE DDBRKG    @@ALPH           ***3           AUS007
     C                     EXSR ZA0840                     ***3           AUS007
     C*                                                                   AUS007
     C**  If the input value was non-numeric, it is an error.             AUS007
     C           @@ERCD    IFEQ 1                          B***4          AUS007
     C                     MOVE '1'       *IN08            ****4          AUS007
     C                     MOVE '1'       *IN41            ****4          AUS007
     C                     MOVEL'MMM0198' @MSGID           ****4          AUS007
     C                     CALL 'ZA0240'                   ****4          AUS007
     C                     PARM           @MSGID           ****4          AUS007
     C                     END                             E***4          AUS007
     C*                                                                   AUS007
     C**  If the figure entered had an incorrect number of decimals,      AUS007
     C**  it is an error.                                                 AUS007
     C           @@ERCD    IFEQ 2                          B***4          AUS007
     C                     MOVE '1'       *IN08            ****4          AUS007
     C                     MOVE '1'       *IN41            ****4          AUS007
     C                     MOVEL'MMM0200' @MSGID           ****4          AUS007
     C                     CALL 'ZA0240'                   ****4          AUS007
     C                     PARM           @MSGID           ****4          AUS007
     C                     END                             E***4          AUS007
     C                     MOVE DDCCY     IKBKCY                          AUS007
     C                     Z-ADD@@AMT     IKBRKG           ***3           AUS007
     C                     END                                            AUS007
     C                     ELSE                                           AUS007
     C           DDRACD    IFEQ 'A'                        B*2            AUS007
     C           DDTYPE    IFEQ 'CD'                       B*2            AUS007
     C           DDTYPE    OREQ 'CL'                       B*2            AUS007
     C           DDBRKG    IFNE *BLANKS                    B*2            AUS007
     C                     MOVE '1'       *IN08                           AUS007
     C                     MOVE '1'       *IN41                           AUS007
     C***********          MOVEL'MMM1056' @MSGID                    AUS007046259
     C                     MOVEL'MMM1061' @MSGID                          046259
     C                     CALL 'ZA0240'                                  AUS007
     C                     PARM           @MSGID                          AUS007
     C                     END                                            AUS007
     C                     END                                            AUS007
     C*                    ELSE                                           AUS007
     C           DDBRKG    IFEQ *BLANKS                    B*2            AUS007
     C                     MOVE ' '       @@RACD                          AUS007
     C                     END                                            AUS007
     C                     END                                            AUS007
     C                     END                                            AUS007
     C                     END                                            AUS007
     C*
     C**  Validate that the Brokerage entered has the correct number
     C**  of decimal places and is a valid number, using ZA0840.
     C**  Brokerage must be a whole number.
     C**
     C           DDRACD    IFNE 'R'                         B*2           AUS007
     C           DDBRKG    ANDNE*BLANKS                     B*2           AUS007
     C           *IN07     ANDEQ'0'                         B*2           067079
     C**********           Z-ADD0         @@IDP            ***3           E14353
     C**********           Z-ADD13        @@IINT           ***3           E14353
     C**********
     C****If*Broker is PROM, brokerage must be 2 long with 1 decimal.     E14377
     C********** DDBKCD    IFEQ 'PROM'                     B***4          E14377
     C********** DDBRKG    ANDNE*BLANKS                    ****4          E14377
     C**********           Z-ADD1         @@IDP            ****4          E14377
     C**********           Z-ADD1         @@IINT           ****4          E14377
     C**********           END                             E***4          E14377
      *                                                                   S01194
      ***set*up*key to currency file to get number of decimal       E14353S01194
      ***places*for*the broker currency                             E14353S01194
     C*****                MOVE *BLANKS   @KEY             ***3     E14353S01194
     C*****                MOVE '20'      @KEY1            ***3     E14353S01194
     C*****                MOVE '1'       @KEY3            ***3     E14353S01194
     C*****                MOVE BKCY      @KEY2            ***3     E14353S01194
     C*****      @KEY      CHAINFDCCYTLL             65    ***3     E14353S01194
      *****                                                         E14353S01194
      ***data*base error if record not found                              E14353
     C*****      *IN65     IFEQ '1'                        B***4    E14353S01194
     C*****      RECI      ORNE 'D'                        ****4    E14353S01194
     C*****                MOVE '1'       *INLR            ****4    E14353S01194
     C*****                MOVE '1'       *INKA            ****4    E14353S01194
     C*****                MOVE '1'       *INU7            ****4    E14353S01194
     C*****                MOVE '1'       *INU8            ****4    S14353S01194
     C*****                MOVEL'FDCCYTLL'DBFILE           *********E14353S01194
     C*****                MOVEL@KEY      DBKEY            * DBERRORE14353S01194
     C*****                MOVE '026'     DBFILE           *********E14353S01194
     C*****                GOTO #ZI9                       ****4    E14353S01194
     C*****                END                             E***4    E14353S01194
      *                                                                   081888
     C           *IN07     IFNE *ON                        If Broker code 081888
      *                                                    valid .        081888
      ** access currency file to get number of decimal places             S01194
      ** for the broker currency                                          S01194
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AOCURRR0'                 ***3           S01194
     C                     PARM '*DBERR ' @RTCD   7        ***3           S01194
     C                     PARM '*KEY   ' @OPTN   7        ***3           S01194
     C                     PARM A9BRCY    @AJCD   3        ***3           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   E14353
      ** call za0840 to validate currency has correct no of decimal       E14353
      ** places and is a valid number.                                    E14353
     C*****                Z-ADDCDP       @@IDP            ***3     E14353S01194
     C*****      13        SUB  CDP       @@IINT           ***3     E14353S01194
     C                     Z-ADDA6NBDP    @@IDP            ***3           S01194
     C           13        SUB  A6NBDP    @@IINT           ***3           S01194
     C                     MOVE *BLANKS   @@ALPH           ***3
     C                     MOVE DDBRKG    @@ALPH           ***3
     C                     MOVE 'N'       @@MTID  1                       E17279
     C                     EXSR ZA0840                     ***3
     C*
     C**  If the input value was non-numeric, it is an error.
     C           @@ERCD    IFEQ 1                          B***4
     C                     MOVE '1'       *IN08            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0198' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C*
     C**  If the figure entered had an incorrect number of decimals,
     C**  it is an error.
     C           @@ERCD    IFEQ 2                          B***4
     C                     MOVE '1'       *IN08            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0200' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C                     ENDIF                                          081888
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*                                                                   E52924
     C                     END                                            E52924
     C*                                                                   E52924
     C*
     C**  If the Brokerage is valid, put the formatted field into
     C**  the screen field, and place the Broker Ccy into the Standard
     C**  Deal format.
     C           *IN08     IFEQ '0'                        B1
     C           *IN07     ANDEQ'0'                        B1
     C           *IN77     ANDEQ'0'                                       AUS007
     C           DDRACD    ANDNE'R'                                       AUS007
     C           DDBRKG    IFNE *BLANKS                    B*2
     C***********DDBRKG    IFEQ 'NIL'                              DT0012 063375
     C***********          Z-ADD*ALL'0'   IKBRKG                   DT0012 063375
     C***********          ELSE                                    DT0012 063375
     C                     MOVE @@ALPH    DDBRKG           **2
     C                     MOVE @@ALPH    @BRKG            **2
     C********** DDBKCD    IFNE 'PROM'                     B**3           E14377
     C**********           Z-ADD0         DEC              ***3           E14353
     C********** DEC       DOWLTIKBCDP                     D***4          E14353
     C********** @@AMT     MULT 10        @@AMT            ****4          E14353
     C**********           ADD  1         DEC     10       ****4          E14353
     C**********           END                             E***4          E14353
     C**********           END                             E**3           E14377
     C           DDBKCD    IFNE *BLANKS                    B**3
     C                     Z-ADD@@AMT     IKBRKG           ***3
     C*****                MOVE BKCY      IKBKCY           ***3           S01194
     C                     MOVE A9BRCY    IKBKCY           ***3           S01194
     C                     END                             E**3
     C**********           END                                     DT0012 063375
     C                     ELSE                            X*2
     C********** DDBKCD    IFNE 'TELX'                                    E14377
     C********** DDBKCD    ANDNE'PHON'                                    E14377
     C********** DDBKCD    ANDNE*BLANK                                    E14377
     C********** DDBKCD    ANDNE'MAIL'                                    E14377
     C                     Z-ADD*ALL'9'   IKBRKG           ***2
     C**********           END                                            E14377
     C                     END                             E*2
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089CP98                                           S01408
     C*
     C*  *------------------------*
     C*  * Validate Customer      *
     C*  *------------------------*
     C*
     C**  The Customer is not amendable for R and A status deals,
     C**  and is only amendable for status C if this is indicated on
     C**  MMCDAFLL.
     C           DDACTN    IFEQ 'A'                        B1
     C           @DSTS     ANDEQ'C'                        B1
     C           HHCNMA    ANDEQ'N'                        B1
     C           DDCUST    ANDNE@CUST                      B1
     C/COPY WNCPYSRC,MM0089C459
     C           DDACTN    OREQ 'A'                        B1
     C           @DSTS     ANDNE'C'                        B1
     C           DDCUST    ANDNE@CUST                      B1
     C/COPY WNCPYSRC,MM0089C482
     C                     MOVE @CUST     DDCUST           *1
     C/COPY WNCPYSRC,MM0089C483
     C                     MOVE '1'       *IN10            *1
     C                     MOVE '1'       *IN41            *1
     C/COPY WNCPYSRC,MM0089C230
     C           @DSTS     IFEQ 'C'                        B*2
     C                     MOVEL'MMM0384' @MSGID           **2
     C                     ELSE                            X*2
     C                     MOVEL'MMM0385' @MSGID           **2
     C                     END                             E*2
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  Check whether the field is blank - if so and the status will
     C**  not be complete, or if the status will be complete and the
     C**  field is defined as mandatory entry on MMMCOMLL, this is an
     C**  error.
     C                     ELSE                            X1
     C           @STS      IFEQ 'C'                        B*2
     C           ICCNMM    ANDNE'N'                        B*2
     C           DDCUST    ANDEQ*BLANKS                    B*2
     C           @STS      ORNE 'C'                        B*2
     C           DDCUST    ANDEQ*BLANKS                    B*2
     C                     MOVE '1'       *IN10            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0204' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     END                             E*2
     C*
     C**  If the input is not blank, validate it.
     C           DDCUST    IFNE *BLANKS                    B*2
     C******                                                              S01194
     C****Check if the input is numeric.                                  S01194
     C*****                MOVE *BLANKS   @@ALPH           **2            S01194
     C*****                Z-ADD0         @@IDP            **2            S01194
     C*****                Z-ADD6         @@IINT           **2            S01194
     C*****                MOVE DDCUST    @@ALPH           **2            S01194
     C*****                EXSR ZA0840                     **2            S01194
     C*****                                                               S01194
     C****If ZA0840 returns no errors, the result will be treated         S01194
     C****as a customer number, else it will be a shortname.              S01194
     C*****      @@ERCD    IFEQ 0                          B**3           S01194
     C*****                Z-ADD@@AMT     @CNUM            ***3           S01194
     C*****      @CLTKY    CHAINCLINT                65    ***3           S01194
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C*****      RECI      OREQ '*'                        B***4          S01194
     C*****                MOVE '1'       *IN10            ****4          S01194
     C*****                MOVE '1'       *IN41            ****4          S01194
     C*****                MOVEL'MMM0205' @MSGID           ****4          S01194
     C*****                CALL 'ZA0240'                   ****4          S01194
     C*****                PARM           @MSGID           ****4          S01194
     C*****                END                             E***4          S01194
     C*****                ELSE                            X**3           S01194
     C*****      DDCUST    CHAINSNAME                65    ***3           S01194
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C*****      RECI      OREQ ':'                        B***4          S01194
     C*****                MOVE '1'       *IN10            ****4          S01194
     C*****                MOVE '1'       *IN41            ****4          S01194
     C*****                MOVEL'MMM0205' @MSGID           ****4          S01194
     C*****                CALL 'ZA0240'                   ****4          S01194
     C*****                PARM           @MSGID           ****4          S01194
     C*****                END                             E***4          S01194
     C*****                END                             E**3           S01194
     C                     CALL 'AOCUSTR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM DDCUST    @KEY1  10        **2            S01194
     C                     PARM *BLANKS   @KYST   7        **2            S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C***********@KYST     OREQ 'ERROR  '                  ***3     S01194BHF079
     C           @KYST     OREQ '*ERROR '                  ***3           BHF079
     C                     MOVE '1'       *IN10            ***3           S01194
     C                     MOVE '1'       *IN41            ***3           S01194
     C                     MOVEL'MMM0205' @MSGID           ***3           S01194
     C                     CALL 'ZA0240'                   ***3           S01194
     C                     PARM           @MSGID           ***3           S01194
     C                     ELSE                                           E70
     C********   DDCUST    IFEQ '?'                                   E70 088263
     C                     MOVELDDCUST    CUS1ST  1                       088263
     C/COPY WNCPYSRC,MM0089C171
     C           CUS1ST    IFEQ '?'                                       088263
     C                     MOVELBBCUST    DDCUST                          E70
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C135                                           S01408
      *                                                                   S01408
     C                     END                                            E70
     C/COPY WNCPYSRC,MM0089C088
     C                     END                             E**3           S01194
     C*
     C/COPY WNCPYSRC,MM0089C205
     C**  If a record was found, check that the customer is not a
     C**  parent.
     C           *IN10     IFEQ '0'                        B**3
     C*****                TESTB'2'       CMIN           65***3           S01194
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C***********BBPAIN    IFEQ 'Y'                        B**3    S01194 062962
     C           BBPAIN    IFEQ 'P'                                       062962
     C                     MOVE '1'       *IN10            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0206' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C/COPY WNCPYSRC,MM0089C023
     C                     END                             E**3
     C*                                                                   E50684
     C** Check for bank/non bank and deal types                           E50684
     C*                                                                   E50684
     C/COPY WNCPYSRC,MM0089C548
     C           BBBNBI    IFEQ 'Y'                                       E50684
     C*                                                                   E50684
     C** Customer is a bank                                               E50684
     C/COPY WNCPYSRC,MM0089C222
     C*                                                                   E50684
     C           DDTYPE    IFEQ 'TD'                                      E50684
     C           DDTYPE    OREQ 'TI'                                      E50684
     C                     SETON                     1041                 E50684
     C           DDACTN    IFEQ 'A'                                       E50684
     C                     MOVEL'MMM1062' @MSGID                          E50684
     C                     ELSE                                           E50684
     C                     MOVEL'MMM1064' @MSGID                          E50684
     C                     END                                            E50684
     C                     CALL 'ZA0240'                                  E50684
     C                     PARM           @MSGID                          E50684
     C                     END                                            E50684
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C103                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           E50684
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP50                                           S01408
     C*                                                                   S01408
     C           DDTYPE    IFEQ 'IP'                                      E50684
     C           DDTYPE    OREQ 'IT'                                      E50684
     C                     SETON                     1041                 E50684
     C           DDACTN    IFEQ 'A'                                       E50684
     C                     MOVEL'MMM1063' @MSGID                          E50684
     C                     ELSE                                           E50684
     C                     MOVEL'MMM1065' @MSGID                          E50684
     C                     END                                            E50684
     C                     CALL 'ZA0240'                                  E50684
     C                     PARM           @MSGID                          E50684
     C                     END                                            E50684
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP51                                           S01408
     C*                                                                   S01408
     C                     END                                            E50684
     C/COPY WNCPYSRC,MM0089C549
     C*
     C**  If the customer is valid, store it on the Standard Deal format.
     C           *IN10     IFEQ '0'                        B**3
     C*****                Z-ADDCNUM      IKCNUM           ***3           S01194
     C*****                MOVE CSNM      IKCSNM           ***3           S01194
     C                     MOVELBBCUST    IKCNUM           ***3           S01194
     C                     MOVE BBCSSN    IKCSNM           ***3           S01194
     C                     ELSE                            X**3
     C**********           Z-ADD0         IKCNUM           ***3                              CSD027A
     C                     MOVE *BLANKS   IKCNUM           ***3                              CSD027A
     C                     MOVE *BLANKS   IKCSNM           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP75                                           S01408
     C*                                                                   S01408
     C*
     C*  *------------------------*
     C*  * Validate Value Date    *
     C*  *------------------------*
     C*
     C                     MOVEL*BLANKS   WEFCY   3                       CEU003
     C*                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PMPSCY    ANDNE*BLANKS                                   CEU003
     C           PMERCD    ANDEQ*BLANKS                                   CEU003
     C           *INL1     ANDEQ'0'                                       CEU003
     C                     MOVELPMPSCY    WEFCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELDDCCY     WEFCY                           CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C**  The value date may not be amended if the action code is 'A'.
     C           DDACTN    IFEQ 'A'                        B1
     C           DDVDAT    ANDNE@VDAT                      B1
     C/COPY WNCPYSRC,MM0089C460
     C                     MOVE @VDAT     DDVDAT           *1
     C                     MOVE '1'       *IN11            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0386' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  The field is must be entered.
     C                     ELSE                            X1
     C           DDVDAT    IFEQ *BLANKS                    B*2
     C                     MOVE '1'       *IN11            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0123' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  Validate that the value date is a valid date.
     C                     ELSE                            X*2
     C                     TESTN          DDVDAT     6263  **2
     C                     MOVE DDVDAT    @TEST            **2
     C                     TESTZ          @TEST          73**2
     C           *IN62     IFEQ '1'                        B**3
     C           *IN73     ANDEQ'1'                        B**3
     C           *IN63     OREQ '1'                        B**3
     C           *IN73     ANDEQ'1'                        B**3
     C                     MOVE DDVDAT    @DAT             ***3
     C                     CALL 'ZA0270'                   ***3
     C                     PARM           @DAT             ***3
     C*****                PARM           DATF             ***3           S01194
     C                     PARM           BJDFIN           ***3           S01194
     C                     PARM           @RTCDE           ***3
     C                     PARM           @VDYNO           ***3
     C                     END                             E**3
     C*
     C**  If the return code is 1 then the input date is invalid or
     C**  non-numeric.
     C           @RTCDE    IFEQ '1'                        B**3
     C           *IN73     OREQ '0'                        B**3
     C           *IN62     OREQ '0'                        B**3
     C           *IN63     ANDEQ'0'                        B**3
     C                     MOVE '1'       *IN11            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0125' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C*
     C**  If the date is valid, carry out further validation.
     C                     ELSE                            X**3
     C*
     C****Find whether the date is a holiday in the deal currency.        E00032
     C*****                MOVE DDCCY     @@CCY            ***3           S01195
     C*****                Z-ADD@VDYNO    @@MNO            ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C*****                MOVE DDCCY     ZCCY             ***3     S01195E00032
     C*****                Z-ADD@VDYNO    ZDAYNO           ***3     S01195E00032
     C*****                MOVE *BLANKS   ZLOC             ***3     S01195E00032
     C*****                EXSR ZCHKH                      ***3     S01195E00032
     C*
     C*
     C**  If the date is not a working day in the deal currency and the
     C**  receive method is 01,07,08, and the deal type is IT,CD,CI or
     C**  TD, this is an error.
     C/COPY WNCPYSRC,MM0089C423
     C           DDTYPE    IFEQ 'IT'                       B***4
     C           DDTYPE    OREQ 'CD'                       B***4
     C           DDTYPE    OREQ 'CI'                       B***4
     C           DDTYPE    OREQ 'TD'                       B***4
     C*****      DDORCM    IFEQ '01'                       B****5         S01177
     C*****      DDORCM    OREQ '07'                       B****5         S01177
     C*****      DDORCM    OREQ '08'                       B****5         S01177
     C           PMRSTM    IFEQ 01                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C           PMRSTM    OREQ 07                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C           PMRSTM    OREQ 08                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C*                                                                   E00032
     C**  Find whether the date is a holiday in the deal currency         E00032
     C**  at the receive nostro location.                                 E00032
     C**  First find receive nostro location.                             E00032
      *  (database error handling done in access program)                 E00032
     C* IF ERRORS OUTSTANDING IN SETTL.DETAILS, DON'T CALL ACCESS OBJ     BHF894
     C*                                                                   BHF894
     C           PMERCD    IFEQ *BLANKS                                   BHF894
     C*                                                                   BHF894
     C                     CALL 'AONOSTR0'                 *****5         E00032
     C                     PARM '*DBERR ' @RTCD   7        *****5         E00032
     C                     PARM '*KEY   ' @OPTN   7        *****5         E00032
     C                     PARM *BLANKS   @KEYA   6        *****5         E00032
     C***********          PARM DDCCY     @KEYB   3        *****5  E00032 CEU003
     C                     PARM WEFCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        *****5                      E00032 CGL029
     C                     PARM *BLANKS   @KEYC  10                                           CGL029
     C                     PARM *BLANKS   @KEYD   2        *****5         E00032
     C                     PARM PMRONS    @KEYE   2        *****5         E00032
     C                     PARM *BLANKS   @KEYF   3                       S01194
     C                     PARM *BLANKS   @KEYG  10                       S01194
     C                     PARM *BLANKS   @KEYH   1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   E00032
     C*********************MOVE A7CSSN    ZLOC             *****5         E00032
     C                     MOVE A7NOSN    ZLOC             *****5         E00032
     C*                                                                   BHF894
     C                     ELSE                                           BHF894
     C                     MOVE *BLANKS   ZLOC                            BHF894
     C                     END                                            BHF894
     C*                                                                   BHF894
     C***********          MOVE DDCCY     ZCCY             *****5  E00032 CEU003
     C                     MOVE WEFCY     ZCCY                            CEU003
     C                     Z-ADD@VDYNO    ZDAYNO           *****5         E00032
     C                     EXSR ZCHKH                      *****5         E00032
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B*****6        S01195
     C           ZIND      IFEQ 'H'                        B*****6        S01195
     C                     MOVE '1'       *IN11            ******6
     C*********************MOVE '1'       *IN41            ******6        E24193
     C                     MOVE '1'       *IN55            ******6        E24193
     C*                                                                   CEU003
     C           WEFCY     IFEQ DDCCY                                     CEU003
     C                     MOVEL'MMM0129' @MSGID           ******6
     C                     ELSE                                           CEU003
     C                     MOVEL'MMM3000' @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C/COPY WNCPYSRC,MM0089C310
     C                     CALL 'ZA0240'                   ******6
     C                     PARM           @MSGID           ******6
     C/COPY WNCPYSRC,MM0089C311
     C                     END                             E*****6
     C                     END                             E****5
     C*
     C**  If the date is not a working day in the deal currency and the
     C**  pay method is 01,07,08, and the deal type is not IT,CD,CI or
     C**  TD, this is an error.
     C                     ELSE                            X***4
     C*****      DDMOPM    IFEQ '01'                       B****5         S01177
     C*****      DDMOPM    OREQ '07'                       B****5         S01177
     C*****      DDMOPM    OREQ '08'                       B****5         S01177
     C           PMPSTM    IFEQ 01                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C           PMPSTM    OREQ 07                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C           PMPSTM    OREQ 08                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C*                                                                   E00032
     C**  Find whether the date is a holiday in the deal currency         E00032
     C**  at the pay nostro location.                                     E00032
     C**  First find pay nostro location.                                 E00032
      *  (database error handling done in access program)                 E00032
     C* IF ERRORS OUTSTANDING IN SETTL.DETAILS, DON'T CALL ACCESS OBJ     BHF894
     C*                                                                   BHF894
     C           PMERCD    IFEQ *BLANKS                                   BHF894
     C*                                                                   BHF894
     C                     CALL 'AONOSTR0'                 *****5         E00032
     C                     PARM '*DBERR ' @RTCD   7        *****5         E00032
     C                     PARM '*KEY   ' @OPTN   7        *****5         E00032
     C                     PARM *BLANKS   @KEYA   6        *****5         E00032
     C***********          PARM DDCCY     @KEYB   3        *****5  E00032 CEU003
     C                     PARM WEFCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        *****5                      E00032 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        *****5         E00032
     C                     PARM PMPONS    @KEYE   2        *****5         E00032
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   E00032
     C*********************MOVE A7CSSN    ZLOC             *****5         E00032
     C                     MOVE A7NOSN    ZLOC             *****5         E00032
     C*                                                                   BHF894
     C                     ELSE                                           BHF894
     C                     MOVE *BLANKS   ZLOC                            BHF894
     C                     END                                            BHF894
     C*                                                                   BHF894
     C***********          MOVE DDCCY     ZCCY             *****5  E00032 CEU003
     C                     MOVE WEFCY     ZCCY                            CEU003
     C                     Z-ADD@VDYNO    ZDAYNO           *****5         E00032
     C                     EXSR ZCHKH                      *****5         E00032
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B*****6        S01195
     C           ZIND      IFEQ 'H'                        B*****6        S01195
     C                     MOVE '1'       *IN11            ******6
     C*********************MOVE '1'       *IN41            ******6        E24193
     C                     MOVE '1'       *IN55            ******6        E24193
     C*                                                                   CEU003
     C           WEFCY     IFEQ DDCCY                                     CEU003
     C                     MOVEL'MMM0129' @MSGID           ******6
     C                     ELSE                                           CEU003
     C                     MOVEL'MMM3000' @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C/COPY WNCPYSRC,MM0089C312
     C                     CALL 'ZA0240'                   ******6
     C                     PARM           @MSGID           ******6
     C/COPY WNCPYSRC,MM0089C313
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C/COPY WNCPYSRC,MM0089C424
     C*
     C**  Find whether the date is a holiday in the local currency.
     C*****                MOVE LOCY      @@CCY            ***3           S01195
     C*****                Z-ADD@VDYNO    @@MNO            ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C                     MOVE BJLCCY    ZCCY             ***3           S01195
     C                     Z-ADD@VDYNO    ZDAYNO           ***3           S01195
     C                     MOVE BJSLCD    ZLOC             ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C*
     C****If*settlement*method*is*not*blank,00,01,07*or*08*and*it*is      LN0234
     C**  If settlement method is not 01,07 or 08 and it is               LN0234
     C**  not a working day in the local currency, it is an error.
     C**  (Only if not settled through a nostro)                          E81
     C*****      DDORCM    IFNE *BLANKS                    B***4          S01177
     C*****      DDORCM    ANDNE'00'                       B***4          S01177
     C*****      DDORCM    ANDNE'01'                       B***4          S01177
     C*****      DDORCM    ANDNE'07'                       B***4          S01177
     C*****      DDORCM    ANDNE'08'                       B***4          S01177
     C*                                                                   E24533
     C** Maturity date is checked against receive settlement              E24533
     C** instructions only when deal is not a deposit.                    E24533
     C*                                                                   E24533
     C           DDTYPE    IFNE 'CD'                                      E24533
     C           DDTYPE    ANDNE'CI'                                      E24533
     C           DDTYPE    ANDNE'TD'                                      E24533
     C           DDTYPE    ANDNE'IT'                                      E24533
     C*                                                                   E24533
     C***********PMRSTM    IFNE *ZEROS                     B***4   S01177 LN0234
     C***********PMRSTM    ANDNE00                         B***4   S01177 LN0234
     C***********PMRSTM    ANDNE01                         B***4   S01177 LN0234
     C           PMRSTM    IFNE 01                         B***4          LN0234
     C           PMRSTM    ANDNE07                         B***4          S01177
     C           PMRSTM    ANDNE08                         B***4          S01177
     C************IN77     ANDEQ'0'                        B***4    LN0234E48032
     C           *INL1     ANDEQ'0'                        B***4          E48032
     C           PMPSTM    ORNE 01                         B***4          E50108
     C           PMPSTM    ANDNE07                         B***4          E50108
     C           PMPSTM    ANDNE08                         B***4          E50108
     C           *INL1     ANDEQ'0'                        B***4          E50108
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B****5         S01195
     C           ZIND      IFEQ 'H'                        B****5         S01195
     C                     MOVE '1'       *IN11            *****5
     C*********************MOVE '1'       *IN41            *****5         E24193
     C                     MOVE '1'       *IN55            *****5         E24193
     C                     MOVEL'MMM0131' @MSGID           *****5
     C/COPY WNCPYSRC,MM0089C314
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C/COPY WNCPYSRC,MM0089C315
     C                     END                             E****5
     C                     END                             E***4
     C*
     C                     END                                            E24533
     C*****      DDMOPM    IFNE *BLANKS                    B***4          S01177
     C*****      DDMOPM    ANDNE'00'                       B***4          S01177
     C*****      DDMOPM    ANDNE'01'                       B***4          S01177
     C*****      DDMOPM    ANDNE'07'                       B***4          S01177
     C*****      DDMOPM    ANDNE'08'                       B***4          S01177
     C***********PMPSTM    IFNE *ZEROS                     B***4   S01177 LN0234
     C***********PMPSTM    ANDNE00                         B***4   S01177 LN0234
     C***********PMPSTM    ANDNE01                         B***4   S01177 LN0234
     C***********PMPSTM    IFNE 01                         B***4   LN0234 E50108
     C***********PMPSTM    ANDNE07                         B***4   S01177 E50108
     C***********PMPSTM    ANDNE08                         B***4   S01177 E50108
     C************IN77     ANDEQ'0'                        B***4   LN0234 E48032
     C************INL1     ANDEQ'0'                        B***4   E48032 E50108
     C***********                                                         E50108
     C****If*ZIND*=*'H'*then*the*date*is*a*holiday.*************** S01195 E50108
     C*****      @@HIND    IFEQ 'H'                        B****5         S01195
     C***********ZIND      IFEQ 'H'                        B****5  S01195 E50108
     C***********          MOVE '1'       *IN11            *****5         E50108
     C*********************MOVE '1'       *IN41            *****5         E24193
     C***********          MOVE '1'       *IN55            *****5  E24193 E50108
     C***********          MOVEL'MMM0131' @MSGID           *****5         E50108
     C***********          CALL 'ZA0240'                   *****5         E50108
     C***********          PARM           @MSGID           *****5         E50108
     C***********          END                             E****5         E50108
     C***********          END                             E***4          E50108
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  Store valid value date in Standard Deal format.
     C           *IN11     IFEQ '0'                        B1
     C           *IN11     OREQ '1'                        B1             E24193
     C           *IN55     ANDEQ'1'                        B1             E24193
     C                     Z-ADD@VDYNO    IKDVSD           *1
     C                     Z-ADD@VDYNO    IKSLID           *1
     C                     ELSE                            X1
     C                     Z-ADD0         IKDVSD           *1
     C                     Z-ADD0         IKSLID           *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C316
      *                                                                   CEU015
      *  Check if this is an amendment of a deal denominated in an        CEU015
      *  'in' currency and the transition start date of such currency     CEU015
      *  is today or in the past.                                         CEU015
      *                                                                   CEU015
      **  Initialise In-currency-start-indicator                          CEU015
     C                     MOVE *BLANKS   @@ICST  1                       CEU015
      *                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           DDACTN    ANDEQ'A'                                       CEU015
      *                                                                   CEU015
      *  access currency file                                             CEU015
      *  (database error handling done in access program)                 CEU015
     C                     CALL 'AOCURRR0'                                CEU015
     C                     PARM '*DBERR ' @RTCD   7                       CEU015
     C                     PARM '*KEY   ' @OPTN   7                       CEU015
     C                     PARM DDCCY     @AJCD   3                       CEU015
     C           SDCURR    PARM SDCURR    DSSDY                           CEU015
      *                                                                   CEU015
     C           A6INCY    IFEQ 'Y'                                       CEU015
     C           A6TPSD    ANDLEBJRDNB                                    CEU015
     C                     MOVE 'Y'       @@ICST                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
     C*
     C*  *------------------------*
     C*  * Validate Maturity Date *
     C*  *------------------------*
     C*
     C           @@ICST    IFNE 'Y'                                       CEU015
      *                                                                   CEU015
     C**  The maturity date may only be changed if the deal has been
     C**  authorised, and the rundate is after the deal input date.
     C           DDACTN    IFEQ 'A'                        B1             E21612
     C           BJRDNB    ANDLE@TDYNO                     B1             E21612
     C           DDMDAT    ANDNE@MDAT                      B1             E21612
     C/COPY WNCPYSRC,MM0089C461
     C                     MOVE '1'       *IN12            *1             E21612
     C                     MOVE '1'       *IN41            *1             E21612
     C                     MOVEL'MMM0583' @MSGID           *1             E21612
     C                     CALL 'ZA0240'                   *1             E21612
     C                     PARM           @MSGID           *1             E21612
     C                     MOVE @MDAT     DDMDAT           *1             E21612
     C                     ELSE                            X1             E24366
      *                                                                   E24366
      ** Else Maturity date cannot be changed if deal has been rolled     E24366
      ** over                                                             E24366
     C           DDACTN    IFEQ 'A'                        B2             E24366
     C           HKROBY    ANDNE*BLANKS                    B2             E24366
     C           HKRBSI    ANDEQ'O'                        B2             E24366
     C           DDMDAT    ANDNE@MDAT                      B2             E24366
     C                     MOVE '1'       *IN12            *2             E24366
     C                     MOVE '1'       *IN41            *2             E24366
     C***********          MOVEL'MMM0584' @MSGID           *2       E24366E34306
     C                     MOVEL'MMM0585' @MSGID           *2       E24366E34306
     C                     MOVELHKROBY    @DATA            *2             E24366
     C                     CALL 'ZA0440'                   *2             E24366
     C                     PARM           @MSGID           *2             E24366
     C                     PARM           @DATA            *2             E24366
     C                     MOVE @MDAT     DDMDAT           *2             E24366
     C                     END                             E2             E24366
      *                                                                   E24366
     C                     END                             E1             E21612
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
     C*                                                                   E21612
     C           DDACTN    IFEQ 'A'                        B1
     C*******    DDMDAT    ANDNE@MDAT                      B1
     C*******    @DSTS     ANDNE'A'                        B1
     C*******    DDACTN    OREQ 'A'                        B1
     C*******    DDMDAT    ANDNE@MDAT                      B1
     C*******    RUND      ANDLE@TDYNO                     B1
     C***********DDMDAT    ANDNE@MDAT                      B1             E21612
     C***********@MDAT     ANDNE*BLANKS                    B1             E21612
     C           DDMDAT    ANDNE@MDAT                      B1             E21612
     C           @DSTS     ANDNE'A'                        B1             E21612
     C           @@ICST    ANDNE'Y'                        B1             CEU015
     C/COPY WNCPYSRC,MM0089C462
     C                     MOVE '1'       *IN12            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0388' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE @MDAT     DDMDAT           *1
     C*
     C**  Validate the maturity date.
     C                     ELSE                            X1
     C*
     C**  If the deal type is CD,CL or DL.
     C           DDTYPE    IFEQ 'CD'                       B*2
     C           DDTYPE    OREQ 'CL'                       B*2
     C           DDTYPE    OREQ 'DL'                       B*2
     C*
     C**  If the action code is 'A', the maturity date on file is not
     C**  blank, and no date has been entered, this is an error.
     C           DDACTN    IFEQ 'A'                        B**3
     C           HKMDYY    ANDNE*ZEROS                     B**3
     C           HKMDMM    ANDNE*ZEROS                     B**3
     C           HKMDDD    ANDNE*ZEROS                     B**3
     C           DDMDAT    ANDEQ*BLANK                     B**3
     C                     MOVE '1'       *IN12            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0126' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C*
     C**  If the action code is 'I', and a date has been entered, this
     C**  is an error.
     C           DDACTN    IFEQ 'I'                        B**3
     C           DDMDAT    ANDNE*BLANK                     B**3
     C                     MOVE '1'       *IN12            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0127' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C*
     C**  If the deal type is not CD,CL or DL, and no date has been
     C**  entered, this is an error.
     C                     ELSE                            X*2
     C           DDMDAT    IFEQ *BLANKS                    B**3
     C                     MOVE '1'       *IN12            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0132' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  Validate that the maturity date is valid as a date.
     C                     TESTN          DDMDAT     6263  *1
     C                     MOVE DDMDAT    @TEST            *1
     C                     TESTZ          @TEST          73*1
     C           *IN62     IFEQ '1'                        B*2
     C           *IN73     ANDEQ'1'                        B*2
     C           DDMDAT    ANDNE*BLANKS                    B*2
     C           *IN63     OREQ '1'                        B*2
     C           *IN73     ANDEQ'1'                        B*2
     C           DDMDAT    ANDNE*BLANKS                    B*2
     C                     MOVE DDMDAT    @DAT             **2
     C                     CALL 'ZA0270'                   **2
     C                     PARM           @DAT             **2
     C*****                PARM           DATF             **2            S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2
     C                     PARM           @MDYNO           **2
     C                     ELSE                                           088380
     C                     Z-ADD0         @MDYNO                          088380
     C                     END                             E*2
     C*
     C**  If not, it is an error.
     C           *IN62     IFEQ '0'                        B*2
     C           *IN63     ANDEQ'0'                        B*2
     C           *IN73     OREQ '0'                        B*2
     C           @RTCDE    OREQ '1'                        B*2
     C           DDMDAT    IFNE *BLANKS                    B**3
     C                     MOVE '1'       *IN12            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0128' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  Check that the maturity date is after the value date.
     C**  if the Japanese Sub Module is not installed,                    S01391
     C**  else that it is not less than the value date                    S01391
     C**  if the Japanese Sub Module is installed and the deal            S01391
     C**  is an interbank deposit placed or taken                         S01391
     C*                                                                   S01391
     C           *IN12     IFEQ '0'                        B*2
     C           DDMDAT    ANDNE*BLANKS                    B*2
     C/COPY WNCPYSRC,MM0089C040
     C           @MDYNO    IFLE @VDYNO                     B**3
     C           S01391    ANDNE'Y'                                       S01391
     C           @MDYNO    ORLT @VDYNO                     B**3           S01391
     C           S01391    ANDEQ'Y'                                       S01391
     C           DDTYPE    ANDEQ'IP'                                      S01391
     C           @MDYNO    ORLT @VDYNO                     B**3           S01391
     C           S01391    ANDEQ'Y'                                       S01391
     C           DDTYPE    ANDEQ'IT'                                      S01391
     C           @MDYNO    ORLE @VDYNO                     B**3           S01391
     C           S01391    ANDEQ'Y'                                       S01391
     C           DDTYPE    ANDNE'IP'                                      S01391
     C           DDTYPE    ANDNE'IT'                                      S01391
     C                     MOVE '1'       *IN12            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0130' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C/COPY WNCPYSRC,MM0089C041
     C*
     C**  If the action code is 'A' the maturity date must be after the
     C**  last interest date and the interest accrual control date.
     C           DDACTN    IFEQ 'A'                        B**3
     C*
     C**  First find the last interest date and interest accrual
     C**  control date in MIDAS format.
     C                     MOVE @IADT     @DAT             ***3
     C                     CALL 'ZA0270'                   ***3
     C                     PARM           @DAT             ***3
     C*****                PARM           DATF             ***3           S01194
     C                     PARM           BJDFIN           ***3           S01194
     C                     PARM           @RTCDE           ***3
     C                     PARM           @IADYN           ***3
     C*
     C                     Z-ADD@LIDT     @DAT             ***3
     C                     CALL 'ZA0270'                   ***3
     C                     PARM           @DAT             ***3
     C*****                PARM           DATF             ***3           S01194
     C                     PARM           BJDFIN           ***3           S01194
     C                     PARM           @RTCDE           ***3
     C                     PARM           @LIDYN           ***3
     C*
     C**  Compare dates.
     C**  Check that the maturity date is after the last interest date    052511
     C**  if the Japanese Sub Module is not installed,                    052511
     C**  else that it is not less than the last interest date            052511
     C**  if the Japanese Sub Module is installed and the deal            052511
     C**  is an interbank deposit placed or taken                         052511
     C*                                                                   052511
     C           DDIPFQ    IFNE 'N'                                       AUS003
     C*                                                                   052511
     C           @MDYNO    IFLE @IADYN                     B***4
     C           S01391    ANDNE'Y'                                       052511
     C           @MDYNO    ORLE @IADYN                     B***4          052511
     C           DDTYPE    ANDNE'IP'                                      052511
     C           DDTYPE    ANDNE'IT'                                      052511
     C           @MDYNO    ORLT @IADYN                                    052511
     C*                                                                   052511
     C**  Do the same check for Interest Accrual Control Date             052511
     C*                                                                   052511
     C           @MDYNO    ORLE @LIDYN                     B***4
     C           S01391    ANDNE'Y'                                       052511
     C           @MDYNO    ORLE @LIDYN                     B***4          052511
     C           DDTYPE    ANDNE'IP'                                      052511
     C           DDTYPE    ANDNE'IT'                                      052511
     C           @MDYNO    ORLT @LIDYN                                    052511
     C                     MOVE '1'       *IN12            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0133' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C                     END                                            AUS003
     C                     END                             E**3
     C*
     C****Find whether the date is a holiday in the deal currency.        E00032
     C*****                MOVE DDCCY     @@CCY            **2            S01195
     C*****                Z-ADD@MDYNO    @@MNO            **2            S01195
     C*****                EXSR ZA0830                     **2            S01195
     C*****                MOVE DDCCY     ZCCY             ***3     S01195E00032
     C*****                Z-ADD@MDYNO    ZDAYNO           ***3     S01195E00032
     C*****                MOVE *BLANKS   ZLOC             ***3     S01195E00032
     C*****                EXSR ZCHKH                      ***3     S01195E00032
     C/COPY WNCPYSRC,MM0089C425
     C*
     C**  If the date is not a working day in the deal currency and the
     C****receive*method*is*01,07,08,*and*the*deal*type*is*IT,CD,CI*or*   E00032
     C**  pay method is 01,07,08, and the deal type is IT,CD,CI or        E00032
     C**  TD, this is an error.
     C           DDTYPE    IFEQ 'IT'                       B**3
     C           DDTYPE    OREQ 'CD'                       B**3
     C           DDTYPE    OREQ 'CI'                       B**3
     C           DDTYPE    OREQ 'TD'                       B**3
     C*****      DDMOPM    IFEQ '01'                       B***4          S01177
     C*****      DDMOPM    OREQ '07'                       B***4          S01177
     C*****      DDMOPM    OREQ '08'                       B***4          S01177
     C           PMPSTM    IFEQ 01                         B***4          S01177
     C************IN77     ANDEQ'0'                        B***4    LN0234E48032
     C           *INL1     ANDEQ'0'                        B***4          E48032
     C           PMPSTM    OREQ 07                         B***4          S01177
     C************IN77     ANDEQ'0'                        B***4    LN0234E48032
     C           *INL1     ANDEQ'0'                        B***4          E48032
     C           PMPSTM    OREQ 08                         B***4          S01177
     C************IN77     ANDEQ'0'                        B***4    LN0234E48032
     C           *INL1     ANDEQ'0'                        B***4          E48032
     C*                                                                   E00032
     C**  Find whether the date is a holiday in the deal currency         E00032
     C**  at the pay nostro location.                                     E00032
     C**  First find pay nostro location.                                 E00032
      *  (database error handling done in access program)                 E00032
     C* IF ERRORS OUTSTANDING IN SETTL.DETAILS, DON'T CALL ACCESS OBJ     BHF894
     C*                                                                   BHF894
     C           PMERCD    IFEQ *BLANKS                                   BHF894
     C*                                                                   BHF894
     C                     CALL 'AONOSTR0'                 ****4          E00032
     C                     PARM '*DBERR ' @RTCD   7        ****4          E00032
     C                     PARM '*KEY   ' @OPTN   7        ****4          E00032
     C                     PARM *BLANKS   @KEYA   6        ****4          E00032
     C***********          PARM DDCCY     @KEYB   3        ****4   E00032 CEU003
     C                     PARM WEFCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        ****4                       E00032 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        ****4          E00032
     C                     PARM PMPONS    @KEYE   2        ****4          E00032
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   E00032
     C*********************MOVE A7CSSN    ZLOC             ****4          E00032
     C                     MOVE A7NOSN    ZLOC             ****4          E00032
     C*                                                                   BHF894
     C                     ELSE                                           BHF894
     C                     MOVE *BLANKS   ZLOC                            BHF894
     C                     END                                            BHF894
     C*                                                                   BHF894
     C***********          MOVE DDCCY     ZCCY             ****4   E00032 CEU003
     C                     MOVE WEFCY     ZCCY                            CEU003
     C                     Z-ADD@MDYNO    ZDAYNO           ****4          E00032
     C                     EXSR ZCHKH                      ****4          E00032
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B****5         S01195
     C           ZIND      IFEQ 'H'                        B****5         S01195
     C                     MOVE '1'       *IN12            *****5
     C*********************MOVE '1'       *IN41            *****5         E24193
     C                     MOVE '1'       *IN55            *****5         E24193
     C*                                                                   CEU003
     C           WEFCY     IFEQ DDCCY                                     CEU003
     C                     MOVEL'MMM0134' @MSGID           *****5
     C                     ELSE                                           CEU003
     C                     MOVEL'MMM3001' @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C/COPY WNCPYSRC,MM0089C317
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C/COPY WNCPYSRC,MM0089C318
     C                     END                             E****5
     C                     END                             E***4
     C*
     C**  If the date is not a working day in the deal currency and the
     C****pay*method*is*01,07,08,*and*the*deal*type*is*not*IT,CD,CI*or*   E00032
     C**  receive method is 01,07,08, and deal type is not IT,CD,CI or    E00032
     C**  TD, this is an error.
     C                     ELSE                            X**3
     C*****      DDORCM    IFEQ '01'                       B***4          S01177
     C*****      DDORCM    OREQ '07'                       B***4          S01177
     C*****      DDORCM    OREQ '08'                       B***4          S01177
     C           PMRSTM    IFEQ 01                         B***4          S01177
     C************IN77     ANDEQ'0'                        B***4    LN0234E48032
     C           *INL1     ANDEQ'0'                        B***4          E48032
     C           PMRSTM    OREQ 07                         B***4          S01177
     C************IN77     ANDEQ'0'                        B***4    LN0234E48032
     C           *INL1     ANDEQ'0'                        B***4          E48032
     C           PMRSTM    OREQ 08                         B***4          S01177
     C************IN77     ANDEQ'0'                        B***4    LN0234E48032
     C           *INL1     ANDEQ'0'                        B***4          E48032
     C*                                                                   E00032
     C**  Find whether the date is a holiday in the deal currency         E00032
     C**  at the receive nostro location.                                 E00032
     C**  First find receive nostro location.                             E00032
      *  (database error handling done in access program)                 E00032
     C* IF ERRORS OUTSTANDING IN SETTL.DETAILS, DON'T CALL ACCESS OBJ     BHF894
     C*                                                                   BHF894
     C           PMERCD    IFEQ *BLANKS                                   BHF894
     C*                                                                   BHF894
     C                     CALL 'AONOSTR0'                 ****4          E00032
     C                     PARM '*DBERR ' @RTCD   7        ****4          E00032
     C                     PARM '*KEY   ' @OPTN   7        ****4          E00032
     C                     PARM *BLANKS   @KEYA   6        ****4          E00032
     C***********          PARM DDCCY     @KEYB   3        ****4   E00032 CEU003
     C                     PARM WEFCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        ****4                       E00032 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        ****4          E00032
     C                     PARM PMRONS    @KEYE   2        ****4          E00032
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   E00032
     C*********************MOVE A7CSSN    ZLOC             ****4          E00032
     C                     MOVE A7NOSN    ZLOC             ****4          E00032
     C*                                                                   BHF894
     C                     ELSE                                           BHF894
     C                     MOVE *BLANKS   ZLOC                            BHF894
     C                     END                                            BHF894
     C*                                                                   BHF894
     C***********          MOVE DDCCY     ZCCY             ****4   E00032 CEU003
     C                     MOVE WEFCY     ZCCY                            CEU003
     C                     Z-ADD@MDYNO    ZDAYNO           ****4          E00032
     C                     EXSR ZCHKH                      ****4          E00032
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B****5         S01195
     C           ZIND      IFEQ 'H'                        B****5         S01195
     C                     MOVE '1'       *IN12            *****5
     C*********************MOVE '1'       *IN41            *****5         E24193
     C                     MOVE '1'       *IN55            *****5         E24193
     C*                                                                   CEU003
     C           WEFCY     IFEQ DDCCY                                     CEU003
     C                     MOVEL'MMM0134' @MSGID           *****5
     C                     ELSE                                           CEU003
     C                     MOVEL'MMM3001' @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C/COPY WNCPYSRC,MM0089C319
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C/COPY WNCPYSRC,MM0089C320
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C/COPY WNCPYSRC,MM0089C426
     C*
     C**  Find whether the date is a holiday in the local currency.
     C*****                MOVE LOCY      @@CCY            ***3           S01195
     C*****                Z-ADD@MDYNO    @@MNO            ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C                     MOVE BJLCCY    ZCCY             ***3           S01195
     C                     Z-ADD@MDYNO    ZDAYNO           ***3           S01195
     C                     MOVE BJSLCD    ZLOC             ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C*
     C**  If settlement method is not blank,00,01,07 or 08 and it is
     C**  not a working day in the local currency, it is an error.
     C**  (Only if not settled through a nostro)                          E81
     C*****      DDORCM    IFNE *BLANKS                    B**3           S01177
     C*****      DDORCM    ANDNE'00'                       B**3           S01177
     C*****      DDORCM    ANDNE'01'                       B**3           S01177
     C*****      DDORCM    ANDNE'07'                       B**3           S01177
     C*****      DDORCM    ANDNE'08'                       B**3           S01177
     C***********PMRSTM    IFNE *ZEROS                     B**3    S01177 LN0234
     C***********PMRSTM    ANDNE0                          B**3    S01177 LN0234
     C***********PMRSTM    ANDNE1                          B**3    S01177 LN0234
     C           PMRSTM    IFNE 1                          B**3           LN0234
     C           PMRSTM    ANDNE7                          B**3           S01177
     C           PMRSTM    ANDNE8                          B**3           S01177
     C************IN77     ANDEQ'0'                        B**3     LN0234E48032
     C           *INL1     ANDEQ'0'                        B**3           E48032
     C           PMPSTM    ORNE 1                          B**3           E50108
     C           PMPSTM    ANDNE7                          B**3           E50108
     C           PMPSTM    ANDNE8                          B**3           E50108
     C           *INL1     ANDEQ'0'                        B**3           E50108
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B***4          S01195
     C           ZIND      IFEQ 'H'                        B***4          S01195
     C                     MOVE '1'       *IN12            ****4
     C*********************MOVE '1'       *IN41            ****4          E24193
     C                     MOVE '1'       *IN55            ****4          E24193
     C                     MOVEL'MMM0135' @MSGID           ****4
     C/COPY WNCPYSRC,MM0089C321
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C/COPY WNCPYSRC,MM0089C322
     C                     END                             E***4
     C                     END                             E**3
     C*
     C*****      DDMOPM    IFNE *BLANKS                    B**3           S01177
     C*****      DDMOPM    ANDNE'00'                       B**3           S01177
     C*****      DDMOPM    ANDNE'01'                       B**3           S01177
     C*****      DDMOPM    ANDNE'07'                       B**3           S01177
     C*****      DDMOPM    ANDNE'08'                       B**3           S01177
     C***********PMPSTM    IFNE *ZEROS                     B**3    S01177 LN0234
     C***********PMPSTM    ANDNE0                          B**3    S01177 LN0234
     C***********PMPSTM    ANDNE1                          B**3    S01177 LN0234
     C***********PMPSTM    IFNE 1                          B**3    LN0234 E50108
     C***********PMPSTM    ANDNE7                          B**3    S01177 E50108
     C***********PMPSTM    ANDNE8                          B**3    S01177 E50108
     C************IN77     ANDEQ'0'                        B**3     LN0234E48032
     C************INL1     ANDEQ'0'                        B**3    E48032 E50108
     C***********                                                         E50108
     C****If*ZIND*=*'H'*then*the*date*is*a*holiday.*************** S01195 E50108
     C*****      @@HIND    IFEQ 'H'                        B***4          S01195
     C***********ZIND      IFEQ 'H'                        B***4   S01195 E50108
     C***********          MOVE '1'       *IN12            ****4          E50108
     C*********************MOVE '1'       *IN41            ****4          E24193
     C***********          MOVE '1'       *IN55            ****4   E24193 E50108
     C***********          MOVEL'MMM0135' @MSGID           ****4          E50108
     C***********          CALL 'ZA0240'                   ****4          E50108
     C***********          PARM           @MSGID           ****4          E50108
     C***********          END                             E***4          E50108
     C***********          END                             E**3           E50108
     C/COPY WNCPYSRC,MM0089C497
     C*
     C**  If the action code is 'A', access the deal amendments file
     C**  for the last amendment to the deal being processed.
     C           DDACTN    IFEQ 'A'                        B**3
     C*
     C                     Z-ADD0         @DMDYN           ***3
     C*
     C**  Set value for key of file to be greater than value required.
     C                     MOVE DDDLNO    @DEAMN           ***3
     C                     MOVE '9999'    @VDYY            ***3
     C                     MOVE '99'      @VDMM            ***3
     C                     MOVE '99'      @VDDD            ***3
     C                     MOVE '999'     @DEAMS           ***3
     C           @DEAMK    SETGTMMLVDMLL                   ***3
     C*
     C**  Read the previous record on file.  (Should be the latest deal
     C**  amendment.)
     C                     READPMMLVDMLL                 65***3
     C                     MOVE HNDA38    @DA38            ***3
     C*
     C**  If a record is found with the correct deal number, convert
     C**  its value date to a MIDAS day no.
     C           *IN65     IFEQ '0'                        B***4
     C           @DA38     ANDEQDDDLNO                     B***4
     C                     Z-ADDHNVDYY    @YEAR            ****4
     C                     Z-ADDHNVDMM    @MNTH            ****4
     C                     Z-ADDHNVDDD    @DAY             ****4
     C           @DATE     IFEQ 0                          B****5
     C                     MOVE *BLANKS   @DMVD            *****5
     C                     Z-ADD0         @DMDYN           *****5
     C                     ELSE                            X****5
     C                     Z-ADD@DATE     @@DTIN           *****5
     C                     EXSR ZA0770                     *****5
     C                     MOVE @@DTOU    @DMVD            *****5
     C                     MOVE @DMVD     @DAT             *****5
     C                     CALL 'ZA0270'                   *****5
     C                     PARM           @DAT             *****5
     C*****                PARM           DATF             *****5         S01194
     C                     PARM           BJDFIN           *****5         S01194
     C                     PARM           @RTCDE           *****5
     C                     PARM           @DMDYN           *****5
     C                     END                             E****5
     C                     END                             E***4
     C*
     C**  If the maturity date is not later than the value date, it is
     C**  an error.
     C           @MDYNO    IFLE @DMDYN                     B***4
     C                     MOVE '1'       *IN12            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0136' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C521
     C*
     C**  Store valid maturity date in Standard Deal format.
     C           *IN12     IFEQ '0'                        B1
     C           DDMDAT    ANDNE*BLANKS                    B1
     C           *IN12     OREQ '1'                        B1             E24193
     C           *IN55     ANDEQ'1'                        B1             E24193
     C           DDMDAT    ANDNE*BLANKS                    B1             E24193
     C                     Z-ADD@MDYNO    IKMATD           *1
     C                     ELSE                            X1
     C                     Z-ADD0         IKMATD           *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C323
     C*
     C*  *------------------------*
     C*  * Validate Notice Days   *
     C*  *------------------------*
     C*
     C**  The notice days are not amendable.  (Note that the stored
     C**  notice days may be different to those displayed.)
     C           DDACTN    IFEQ 'A'                        B1
     C           DDNTCE    ANDNE@NTCE                      B1
     C/COPY WNCPYSRC,MM0089C463
     C                     MOVE @NTCE     DDNTCE           *1
     C                     MOVE '1'       *IN13            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0388' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     ELSE                            X1
     C*
     C**  If the deal type is CL,DL or CD.
     C           DDTYPE    IFEQ 'CL'                       B*2
     C           DDTYPE    OREQ 'CD'                       B*2
     C           DDTYPE    OREQ 'DL'                       B*2
     C*
     C**  If the notice days have not been input, it is invalid unless
     C**  the maturity date has been input.
     C           DDNTCE    IFEQ *BLANKS                    B**3
     C           DDMDAT    ANDEQ*BLANKS                    B**3
     C                     MOVE '1'       *IN13            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0137' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C*
     C**  If the notice days are not zero...
     C           DDNTCE    IFNE '  0'                      B**3
     C           DDNTCE    ANDNE' 0 '                      B**3
     C           DDNTCE    ANDNE'0  '                      B**3
     C           DDNTCE    ANDNE'00 '                      B**3
     C           DDNTCE    ANDNE' 00'                      B**3
     C           DDNTCE    ANDNE'000'                      B**3
     C           DDNTCE    ANDNE*BLANKS                    B**3
     C*
     C**  Check if the notice days are numeric.
     C                     MOVE *BLANKS   @@ALPH           ***3
     C                     Z-ADD0         @@IDP            ***3
     C                     Z-ADD3         @@IINT           ***3
     C                     MOVE DDNTCE    @@ALPH           ***3
     C                     EXSR ZA0840                     ***3
     C*
     C**  If the notice days are non-numeric this is invalid.
     C           @@ERCD    IFNE 0                          B***4
     C                     MOVE '1'       *IN13            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0139' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     ELSE                            X***4
     C                     MOVE @@ALPH    DDNTCE           ****4
     C                     MOVE @@ALPH    @NTCE            ****4
     C                     Z-ADD@@AMT     @NTCNM           ****4
     C                     END                             E***4
     C*
     C**  If the notice days are zero, set up the screen fields.
     C                     ELSE                            X**3
     C           DDNTCE    IFNE *BLANKS                    B***4
     C                     MOVE '  0'     DDNTCE           ****4
     C                     MOVE '  0'     @NTCE            ****4
     C                     Z-ADD0         @NTCNM           ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** If the action code is 'A' and the maturity date entered is       DT0024
     C** less than the transaction date plus the notice days then send    DT0024
     C** a warning message                                                DT0024
     C** This routine should only be done after settlement screen.        E51300
     C*                                                                   DT0024
     C           *IN13     IFEQ '0'                                       DT0024
     C           DDACTN    ANDEQ'A'                                       DT0024
     C           DDMDAT    ANDNE*BLANKS                                   DT0024
     C           DDNTCE    ANDNE'  0'                                     DT0024
     C           *INL1     ANDEQ'0'                                       E51300
     C                     Z-ADD0         YIWRK   50                      DT0024
     C           @NTCNM    ADD  BJRDNB    YIWRK                           DT0024
     C           YIWRK     IFGT @MDYNO                                    DT0024
     C           *INL1     ANDEQ'0'                                       E50108
     C                     MOVE '1'       *IN55                           DT0024
     C                     MOVEL'MMM0584' @MSGID                          DT0024
     C/COPY WNCPYSRC,MM0089C324
     C                     CALL 'ZA0240'                                  DT0024
     C                     PARM           @MSGID                          DT0024
     C/COPY WNCPYSRC,MM0089C325
     C                     END                                            DT0024
     C                     END                                            DT0024
     C*                                                                   DT0024
     C**  If the action code is 'A', the maturity date is non-blank,
     C**  and no error has been found on the notice days, set the
     C**  notice days to -999.
     C           *IN13     IFEQ '0'                        B**3
     C           DDACTN    ANDEQ'A'                        B**3
     C           DDMDAT    ANDNE*BLANKS                    B**3
     C***********DDNTCE****ANDNE'  0'                      B**3           E21775
     C                     Z-SUB999       @NTCNM           ***3
     C                     END                             E**3
     C*
     C**  Otherwise, if the deal type is not CD,CL or DL....
     C                     ELSE                            X*2
     C*
     C**  If the notice days have been entered, this is invalid.
     C           DDNTCE    IFNE *BLANKS                    B**3
     C                     MOVE '1'       *IN13            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0138' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C*
     C**  Otherwise, if the deal type is not CD,CL or DL....
     C                     ELSE                            X**3
     C*
     C**  Set the notice days to -999.
     C                     Z-SUB999       @NTCNM           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C***********                                                         E25515
     C****------------------------*                                       E25515
     C*****Validate*Facility*******                                       E25515
     C****------------------------*                                       E25515
     C***********                                                         E25515
     C****The*facility*is*not*amendable.                                  E25515
     C***********DDACTN    IFEQ 'A'                        B1             E25515
     C***********DDFCLY    ANDNE@FCLY                      B1             E25515
     C***********          MOVE @FCLY     DDFCLY           *1             E25515
     C***********          MOVE '1'       *IN14            *1             E25515
     C***********          MOVE '1'       *IN41            *1             E25515
     C***********          MOVEL'MMM0378' @MSGID           *1             E25515
     C***********          CALL 'ZA0240'                   *1             E25515
     C***********          PARM           @MSGID           *1             E25515
     C***********          ELSE                            X1             E25515
     C***********                                                         E25515
     C****If*the*deal*type*is*LN,DL*or*TI,*and*a*facility*code*has*not    E25515
     C****been*entered,*this*is*invalid.                                  E25515
     C***********DDTYPE    IFEQ 'LN'                       B*2            E25515
     C***********DDTYPE ***OREQ 'TI'                       B*2
     C***********DDTYPE    OREQ 'DL'                       B*2            E25515
     C***********DDFCLY    IFEQ *BLANKS                    B**3           E25515
     C***********          MOVE '1'       *IN14            ***3           E25515
     C***********          MOVE '1'       *IN41            ***3           E25515
     C***********          MOVEL'MMM0116' @MSGID           ***3           E25515
     C***********          CALL 'ZA0240'                   ***3           E25515
     C***********          PARM           @MSGID           ***3           E25515
     C***********          END                             E**3           E25515
     C***********                                                         E25515
     C****If*the*deal*type*is*not*LN,DL*or*TI,*and*a*facility*code*has    E25515
     C****been*entered,*this*is*invalid.                                  E25515
     C***********          ELSE                            X*2            E25515
     C***********DDFCLY    IFNE *BLANKS                    B**3           E25515
     C***********          MOVE '1'       *IN14            ***3           E25515
     C***********          MOVE '1'       *IN41            ***3           E25515
     C***********          MOVEL'MMM0117' @MSGID           ***3           E25515
     C***********          CALL 'ZA0240'                   ***3           E25515
     C***********          PARM           @MSGID           ***3           E25515
     C***********          END                             E**3           E25515
     C***********          END                             E*2            E25515
     C***********                                                         E25515
     C****If*a*facility*code*has*been*entered*and*the*Syndicated*Loans    E25515
     C****module*is*not*on*the*system,*this*is*invalid.                   E25515
     C***********DDFCLY    IFNE *BLANK                     B*2            E25515
     C*****                TESTB'3'       MODI1      65    **2            S01194
     C*****      *IN65     IFEQ '1'                        B**3           S01194
     C***********BGSYLN    IFNE 'Y'                        B**3     S01194E25515
     C***********          MOVE '1'       *IN14            ***3           E25515
     C***********          MOVE '1'       *IN41            ***3           E25515
     C***********          MOVEL'MMM0119' @MSGID           ***3           E25515
     C***********          CALL 'ZA0240'                   ***3           E25515
     C***********          PARM           @MSGID           ***3           E25515
     C***********          END                             E**3           E25515
     C***********          END                             E*2            E25515
     C***********                                                         E25515
     C****If*a*facility*has*been*entered,*and*no*error*has*so*far*been    E25515
     C****found,*validate*the*facility*code*itself.**(Only*perform*this   E25515
     C****validation*if*the*customer*number*is*valid.)                    E25515
     C***********DDFCLY    IFNE *BLANKS                    B*2            E25515
     C***********DDCUST    ANDNE*BLANKS                    B*2            E25515
     C************IN14     ANDNE'1'                        B*2            E25515
     C************IN10     ANDNE'1'                        B*2            E25515
     C***********                                                         E25515
     C****Access*the*facilities*file,*FACIL,*using*the*facility*entered   E25515
     C***********          MOVE IKCNUM    @FCLK1           **2            E25515
     C***********          MOVELDDFCLY    @FCLK2           **2            E25515
     C***********          MOVE DDFCLY    @FCLK3           **2            E25515
     C***********@FCLK     CHAINFACIL                65    **2            E25515
     C***********                                                         E25515
     C****If*no*valid*record*is*found,*this*is*an*error.                  E25515
     C************IN65     IFEQ '1'                        B**3           E25515
     C***********RECI      OREQ '*'                        B**3           E25515
     C***********          MOVE '1'       *IN14            ***3           E25515
     C***********          MOVE '1'       *IN41            ***3           E25515
     C***********          MOVEL'MMM0120' @MSGID           ***3           E25515
     C***********          CALL 'ZA0240'                   ***3           E25515
     C***********          PARM           @MSGID           ***3           E25515
     C***********                                                         E25515
     C****If*a*valid*record*is*found,*the*branch*code*entered*must        E25515
     C****that*on*the*file.                                               E25515
     C***********          ELSE                            X**3           E25515
     C***********                                                         E25515
     C****If*a*branch*code*has*been*entered,*it*must*match*that*on*the    E25515
     C****FACIL*file.                                                     E25515
     C*****                MOVE BRCD      @BRCD1           ***3           S01117
     C*****      DDBRCD    IFNE *BLANKS                    B***4          S01117
     C*****      DDBRCD    ANDNE@BRCD1                     B***4          S01117
     C***********          MOVE BRCA      @BRCA1           ***3     S01117E25515
     C***********DDBRCA    IFNE *BLANKS                    B***4    S01117E25515
     C***********DDBRCA    ANDNE@BRCA1                     B***4    S01117E25515
     C***********          MOVE '1'       *IN14            ****4          E25515
     C***********          MOVE '1'       *IN41            ****4          E25515
     C***********          MOVEL'MMM0121' @MSGID           ****4          E25515
     C***********          CALL 'ZA0240'                   ****4          E25515
     C***********          PARM           @MSGID           ****4          E25515
     C***********                                                         E25515
     C****If*no*branch*code*has*been*entered,*the*default*branch*code     E25515
     C****must*match*that*on*the*FACIL*file.                              E25515
     C***********          ELSE                            X***4          E25515
     C*****      DDBRCD    IFEQ *BLANKS                    B****5         S01117
     C*****      BRCD      ANDNEDFBR                       B****5         S01117
     C***********DDBRCA    IFEQ *BLANKS                    B****5   S01117E25515
     C***********BRCA      ANDNEBJSBRC                     B****5   S01117E25515
     C***********          MOVE '1'       *IN14            *****5         E25515
     C***********          MOVE '1'       *IN41            *****5         E25515
     C***********          MOVEL'MMM0121' @MSGID           *****5         E25515
     C***********          CALL 'ZA0240'                   *****5         E25515
     C***********          PARM           @MSGID           *****5         E25515
     C***********          END                             E****5         E25515
     C***********          END                             E***4          E25515
     C***********          END                             E**3           E25515
     C***********          END                             E*2            E25515
     C***********          END                             E1             E25515
     C*                                                                   S01486
     C*  *------------------------*                                       S01486
     C*  * Validate Portfolio Ref *                                       S01486
     C*  *------------------------*                                       S01486
      *                                                                   S01486
      **  Set off the field conditioning indicator so that validation     S01486
      **  is performed for each call to #ZI - otherwise warning msg       S01486
      **  may be lost.                                                    S01486
     C                     MOVE *OFF      *IN46                           S01486
      *                                                                   CPM004
      **  If screen Portfolio Reference is blank, default it from the     CPM004
      **  value determined from AOPLCSR1 (called before book code         CPM004
      **  validation).                                                    CPM004
      *                                                                   CPM004
     C           DDPTFR    IFEQ *BLANKS                                   CPM004
     C           ERPLCS    ANDEQ*BLANKS                                   CPM004
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVELO#PTFR    DDPTFR                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   S01486
     C** IF 'LIABILITIES INCLUDED' INDICATOR = 'N',                       S01486
     C** PORTFOLIO REF. MAY NOT BE ENTERED FOR SOME DEAL TYPES            S01486
     C*                                                                   S01486
     C           DDPTFR    IFNE *BLANKS                                   S01486
     C           FCLIAB    ANDEQ'N'                                       S01486
     C           BGPFMG    ANDEQ'Y'                                       S01486
     C/COPY WNCPYSRC,MM0089C347
     C*                                                                   S01486
     C           DDTYPE    IFEQ 'IP'                                      S01486
     C           DDTYPE    OREQ 'DL'                                      S01486
     C           DDTYPE    OREQ 'LN'                                      S01486
     C           DDTYPE    OREQ 'TI'                                      S01486
     C           DDTYPE    OREQ 'CL'                                      S01486
     C                     MOVE *ON       *IN46                           S01486
     C                     MOVE *ON       *IN41                           S01486
     C                     MOVEL'PMM0007' @MSGID                          S01486
     C                     CALL 'ZA0240'                                  S01486
     C                     PARM           @MSGID                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           *IN10     ANDEQ'0'                                       S01486
     C           *IN46     ANDEQ'0'                                       S01486
     C           *IN10     ANDEQ'0'                                       CPM004
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C*                                                                   S01486
     C** May not be amended if original entry date of deal                S01486
     C** is not equal to run date                                         S01486
     C*                                                                   S01486
     C           DDACTN    IFEQ 'A'                                       S01486
     C           DDPTFR    ANDNE@PTFR                                     S01486
     C                     Z-ADDHKVDYY    @YEAR                           S01486
     C                     Z-ADDHKVDMM    @MNTH                           S01486
     C                     Z-ADDHKVDDD    @DAY                            S01486
     C                     Z-ADD@DATE     ZZDTIN                          S01486
     C                     EXSR ZDAT10                                    S01486
     C                     Z-ADDZZMDNO    @@ORED  50                      S01486
      *                                                                   S01486
     C           ZZMDNO    IFNE BJRDNB                                    S01486
     C                     MOVE '1'       *IN41                           S01486
     C                     MOVE '1'       *IN46                           S01486
     C                     MOVEL'PMM0005' @MSGID                          S01486
     C                     CALL 'ZA0240'                                  S01486
     C                     PARM           @MSGID                          S01486
     C                     MOVE @PTFR     DDPTFR                          S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
      ** Is customer a Portfolio Management Customer,otherwise error.     S01486
     C*                                                                   S01486
     C***********          CALL 'AOPLCSR0'                         S01486 CPM004
     C***********          PARM *BLANKS   @RTCD                    S01486 CPM004
     C***********          PARM '*KEY   ' @OPTN                    S01486 CPM004
     C***********          PARM DDCUST    @CUSN  10                S01486 CPM004
     C***********SDPLCS    PARM SDPLCS    DSFDY                    S01486 CPM004
      *                                                                   S01486
      ** Cust. must be a Portfolio Customer if Portfolio ref. entered     S01486
      *                                                                   S01486
     C***********@RTCD     IFEQ '*NRF'                             S01486 CPM004
     C           ERPLCS    IFEQ 'PMA0008'                                 CPM004
     C           DDPTFR    ANDNE*BLANKS                                   S01486
     C           ERPLCS    OREQ 'PMA0009'                                 CPM004
     C           DDPTFR    ANDNE*BLANKS                                   CPM004
     C                     MOVE *ON       *IN46                           S01486
     C                     MOVE *ON       *IN41                           S01486
     C***********          MOVEL'PMM0002' @MSGID                   S01486 CPM004
     C***********          CALL 'ZA0240'                           S01486 CPM004
     C***********          PARM           @MSGID                   S01486 CPM004
     C                     END                                            S01486
     C*                                                                   CPM004
     C**  Portfolio entered but no associated book found in               CPM004
     C**  SDBOOKPD to default blank book code, error.                     CPM004
     C*                                                                   CPM004
     C           ERPLCS    IFEQ 'PMA0010'                                 CPM004
     C                     MOVELO#PTFR    DDPTFR                          CPM004
     C                     MOVE '1'       *IN46                           CPM004
     C                     MOVE '1'       *IN41                           CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C**  Book entered but no portfolio reference found to                CPM004
     C**  default.                                                        CPM004
     C*                                                                   CPM004
     C           ERPLCS    IFEQ 'PMA0011'                                 CPM004
     C                     MOVELO#PTFR    DDPTFR                          CPM004
     C                     MOVE '1'       *IN48                           CPM004
     C                     MOVE '1'       *IN46                           CPM004
     C                     MOVE '1'       *IN41                           CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   S01486
     C***********@RTCD     IFEQ *BLANKS                            S01486 CPM004
     C           ERPLCS    IFEQ *BLANKS                                   CPM004
     C*                                                                   S01486
     C** Default value                                                    S01486
     C*                                                                   S01486
     C           DDPTFR    IFEQ *BLANKS                                   S01486
     C***********          MOVE FCR997    DDPTFR                   S01486 CPM004
     C                     MOVE O#PTFR    DDPTFR                          CPM004
     C                     END                                            S01486
     C*                                                                   S01486
     C** Portfolio reference must exist for Customer                      S01486
     C*                                                                   S01486
     C           DDPTFR    IFNE FCR997                                    S01486
     C***********          MOVELDDCUST    PNCNUM                   S01486 CPM004
     C                     MOVELQBCUST    PNCNUM                          CPM004
     C           PMKEY     CHAINPMPORTPD             65                   S01486
     C*                                                                   S01486
     C           *IN65     IFEQ '1'                                       S01486
     C           PNRECI    OREQ '*'                                       S01486
     C                     MOVE '1'       *IN46                           S01486
     C                     MOVE '1'       *IN41                           S01486
     C           FCPORS    IFNE 'B'                                       CPM004
     C                     MOVEL'PMM0001' @MSGID                          S01486
     C                     ELSE                                           CPM004
     C                     MOVEL'PMA0013' @MSGID                          CPM004
     C                     ENDIF                                          CPM004
     C                     CALL 'ZA0240'                                  S01486
     C                     PARM           @MSGID                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** Warning if selected Portfolio has been flagged for closure       S01486
     C*                                                                   S01486
     C           *IN46     IFEQ '0'                                       S01486
     C           PNDPCL    ANDNE0                                         S01486
     C                     MOVE '1'       *IN46                           S01486
     C                     MOVE '1'       *IN55                           S01486
     C                     MOVEL'PMM0008' @MSGID                          S01486
     C/COPY WNCPYSRC,MM0089C326
     C                     CALL 'ZA0240'                                  S01486
     C                     PARM           @MSGID                          S01486
     C/COPY WNCPYSRC,MM0089C327
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**  Bank Portfolio supported, book and portfolio reference          CPM004
     C**  must match in books file.                                       CPM004
     C*                                                                   CPM004
     C           *IN46     IFEQ *OFF                                      CPM004
     C           FCPORS    ANDEQ'B'                                       CPM004
     C           DDBOKC    ANDNE*BLANKS                                   CPM004
     C           DDPTFR    ANDNE*BLANKS                                   CPM004
     C           DDPTFR    IFNE O#PTFR                                    CPM004
     C                     MOVE *ON       *IN41                           CPM004
     C                     MOVE *ON       *IN46                           CPM004
     C                     MOVEL'PMA0012' @MSGID                          CPM004
     C                     CALL 'ZA0240'                                  CPM004
     C                     PARM           @MSGID                          CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     END                                            S01486
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD   7                       CPB001
     C                     PARM '*KEY   ' @OPTN   7                       CPB001
     C                     PARM DDCUST    @KEY1  10                       CPB001
     C                     PARM *BLANKS   @KYST   7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   CPB001
     C           @RTCD     IFNE *BLANKS                                   CPB001
     C           DDPTFR    ANDNE*BLANKS                                   CPB001
     C           BBPRBA    ORNE 'Y'                                       CPB001
     C           DDPTFR    ANDNE*BLANKS                                   CPB001
     C                     MOVE '1'       *IN46                           CPB001
     C                     MOVEL'PBM0001' @MSGID                          CPB001
     C                     CALL 'ZA0240'                                  CPB001
     C                     PARM           @MSGID                          CPB001
     C                     ELSE                                           CPB001
     C*                                                                   CPB001
     C           DDPTFR    IFEQ *BLANKS                                   CPB001
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C           @RTCD     ANDEQ*BLANKS                                   CPB001
     C           BBPRBA    OREQ 'Y'                                       CPB001
     C           @RTCD     ANDEQ*BLANKS                                   CPB001
     C                     MOVE 'N'       WWVAL   1                       CPB001
     C**********           MOVELBBCUST    KPCNUM  60                                  CPB001 CSD027A
     C                     MOVELBBCUST    KPCNUM  6                                          CSD027A
     C           KPCNUM    SETLLPMPORTPD                                  CPB001
     C           KPCNUM    READEPMPORTPD                 65               CPB001
     C*                                                                   CPB001
     C           *IN65     DOWEQ*OFF                                      CPB001
     C           WWVAL     ANDEQ'N'                                       CPB001
     C*                                                                   CPB001
     C           PNDPCL    IFEQ 0                                         CPB001
     C           PNRECI    ANDEQ'D'                                       CPB001
     C                     MOVE PNPTFR    DDPTFR                          CPB001
     C                     MOVE 'Y'       WWVAL                           CPB001
     C                     ELSE                                           CPB001
     C           KPCNUM    READEPMPORTPD                 65               CPB001
     C                     ENDIF                                          CPB001
     C                     ENDDO                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ELSE                                           CPB001
     C*                                                                   CPB001
     C                     MOVELBBCUST    PNCNUM                          CPB001
     C           PMKEY     CHAINPMPORTPD             65                   CPB001
     C*                                                                   CPB001
     C           *IN65     IFEQ *ON                                       CPB001
     C           PNRECI    OREQ '*'                                       CPB001
     C                     MOVE '1'       *IN46                           CPB001
     C                     MOVE '1'       *IN41                           CPB001
     C                     MOVEL'PMA0013' @MSGID                          CPB001
     C                     CALL 'ZA0240'                                  CPB001
     C                     PARM           @MSGID                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C** Warning if selected Portfolio has been flagged for closure       CPB001
     C*                                                                   CPB001
     C           *IN46     IFEQ *OFF                                      CPB001
     C           PNDPCL    ANDNE0                                         CPB001
     C                     MOVE '1'       *IN46                           CPB001
     C                     MOVE '1'       *IN55                           CPB001
     C                     MOVEL'PMM0008' @MSGID                          CPB001
     C                     CALL 'ZA0240'                                  CPB001
     C                     PARM           @MSGID                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C/COPY WNCPYSRC,MM0089C348
     C*
     C*  *-------------------------------*
     C*  * Validate Account Sequence No. *
     C*  *-------------------------------*
     C*
     C**  The account sequence number is only amendable if complete.
     C           DDACTN    IFEQ 'A'                        B1
     C           @DSTS     ANDNE'C'                        B1
     C           DDACSQ    ANDNE@ACSQ                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C464
     C                     MOVE @ACSQ     DDACSQ           *1
     C                     MOVE '1'       *IN15            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0490' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C                     ELSE                            X1
     C*
     C/COPY WNCPYSRC,MM0089C377
     C**  If the account sequence no. is not blank...
     C                     MOVE DDACSQ    WKACSQ                          089603
     C           WKACS1    IFEQ ' '                                       089603
     C                     MOVEL'0'       DDACSQ                          089603
     C                     ENDIF                                          089603
     C           WKACS2    IFEQ ' '                                       089603
     C                     MOVE '0'       DDACSQ                          089603
     C                     ENDIF                                          089603
     C           DDACSQ    IFNE *BLANKS                    B*2
     C***********DDACSQ    ANDNE*ZEROS                     B*2            089603
     C*
     C**  ... check that it is a valid number.
     C                     MOVE *BLANKS   @@ALPH           **2
     C                     Z-ADD0         @@IDP            **2
     C                     Z-ADD2         @@IINT           **2
     C                     MOVE DDACSQ    @@ALPH           **2
     C                     EXSR ZA0840                     **2
     C*
     C**  If the account sequence no. is non-numeric, this is invalid.
     C           @@ERCD    IFNE 0                          B**3
     C                     MOVE '1'       *IN15            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0140' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C*
     C****... check also that if the multi-branch indicator is 'Y',       S01117
     C****that the sequence no. has a value between the start seq. no.,   S01117
     C****and the end seq. no. on the FDBRNCLL record for the input       S01117
     C****branch code. (Perform only if the Branch Code is valid.)        S01117
     C*****      MBIN      IFEQ 'Y'                        B**3           S01117
     C*****      *IN06     ANDEQ'0'                        B**3           S01117
     C*****      *IN15     ANDEQ'0'                        B**3           S01117
     C*****      DDBRCD    ANDNE*BLANKS                    B**3           S01117
     C*****                MOVE DDACSQ    @ACSQN           ***3           S01117
     C*****      @ACSQN    IFLT NSACS                      B***4          S01117
     C*****      @ACSQN    ORGT NEACS                      B***4          S01117
     C*****                MOVE '1'       *IN15            ****4          S01117
     C*****                MOVE '1'       *IN41            ****4          S01117
     C*****                MOVEL'MMM0141' @MSGID           ****4          S01117
     C*****                CALL 'ZA0240'                   ****4          S01117
     C*****                PARM           @MSGID           ****4          S01117
     C*****                END                             E***4          S01117
     C*****                END                             E**3           S01117
     C                     END                             E*2
     C*
     C****If the multi-branch indicator is 'Y', and the action code is    S01117
     C****'I', default the account sequence no. to the value of the start S01117
     C****sequence no. from FDBRNCLL.                                     S01117
     C*****      MBIN      IFEQ 'Y'                        B*2            S01117
     C*****      DDACTN    ANDEQ'I'                        B*2            S01117
     C*****      *IN06     ANDEQ'0'                        B*2            S01117
     C*****      DDACSQ    IFEQ *BLANKS                    B**3           S01117
     C*****      DDACSQ    OREQ *ZEROS                     B**3           S01117
     C*****                MOVE NSACS     DDACSQ           ***3           S01117
     C*****                END                             E**3           S01117
     C****If the multi-branch indicator is 'N', and the action code is    S01117
     C****'I', default the account sequence no. to '01'.                  S01117
     C**  If the action code is 'I',                                      S01117
     C**  default the account sequence no. to '01'.                       S01117
     C*****                ELSE                            X*2            S01117
     C*****      MBIN      IFNE 'Y'                        B**3           S01117
     C*****      DDACTN    ANDEQ'I'                        B**3           S01117
     C           DDACTN    IFEQ 'I'                        B*2            S01117
     C           DDACSQ    IFEQ *BLANKS                    B**3           S01117
     C           DDACSQ    OREQ *ZEROS                     B**3           S01117
     C                     MOVE '01'      DDACSQ           ***3           S01117
     C*****                END                             E***4          S01117
     C                     END                             E**3
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C378
     C                     END                             E1
     C*
     C**  If no error has occurred, set up the Standard Deal format field
     C           *IN15     IFEQ '0'                        B1
     C                     MOVE DDACSQ    IKACSQ           *1
     C                     END                             E1
     C*
     C*  *-------------------*
     C*  * Validate Currency *
     C*  *-------------------*
     C*
     C** The deal currency is not amendable.
     C           DDACTN    IFEQ 'A'                        B1
     C           DDCCY     ANDNE@CCY                       B1
     C/COPY WNCPYSRC,MM0089C089
     C                     MOVE @CCY      DDCCY            *1
     C                     MOVE '1'       *IN16            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0370' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     ELSE                            X1
     C*
     C**  The currency must be entered.
     C           DDCCY     IFEQ *BLANKS                    B*2
     C                     MOVE '1'       *IN16            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0142' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  If the currency is still valid, check that it is a live
     C**  dealing currency.
     C                     ELSE                            X*2
     C*****                MOVE *BLANKS   @KEY             **2            S01194
     C*****                MOVE '20'      @KEY1            **2            S01194
     C*****                MOVE DDCCY     @KEY2            **2            S01194
     C*****                MOVE '1'       @KEY3            **2            S01194
     C*****      @KEY      CHAINFDCCYTLL             65    **2            S01194
     C*****                                                               S01194
     C                     CALL 'AOCURRR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM DDCCY     @AJCD   3        **2            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C**  If no valid record is found, it is an error.
     C*****      *IN65     IFEQ '1'                        B**3           S01194
     C*****      RECI      OREQ '*'                        B**3           S01194
     C           @RTCD     IFNE *BLANK                     B**3           S01194
     C                     MOVE '1'       *IN16            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0202' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     ELSE                            X**3           E18187
     C                     MOVELA6CYCD    DDCCY                           E70
     C*                                                                   S01392
     C** Default Round Down Indicator from SDCURRPD                       S01392
     C*                                                                   S01392
     C                     MOVELA6RDFC    CYRDFC                          S01392
      ** Check revaluation has been run (1st ccy)                         E18187
      * (only if FRA/IRS or Treasury Management in system)                E40281
     C           BGFIIN    IFEQ 'Y'                        B***4          E40281
     C           BGTRMG    OREQ 'Y'                        ***4           E40281
     C                     MOVE *LOVAL    @TPRD1  1        ***3           E18187
     C                     Z-ADD*LOVAL    @PRD1   20       ***3           E18187
      ** CHAIN TO FILE FDINTRLL                                           E18187
     C           @TEST1    SETLLFDINTRLL                   ***3           E18187
     C           DDCCY     READEFDINTRLL                 65***3           E18187
     C           *IN65     IFEQ '1'                        B***4          E18187
     C           HWDLTF    OREQ '*'                                       067426
     C                     MOVE '1'       *IN16            ****4          E18187
     C                     MOVE '1'       *IN41            ****4          E18187
     C                     MOVEL'MMM0316' @MSGID           ****4          E18187
     C                     CALL 'ZA0240'                   ****4          E18187
     C                     PARM           @MSGID           ****4          E18187
     C                     END                             E***4          E18187
     C                     END                             E**4           E40281
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  If no error has occurred, set up the Standard Deal format field
     C           *IN16     IFEQ '0'                        B1
     C*****                MOVE CDP       IKCYDP           *1             S01194
     C                     MOVE A6NBDP    IKCYDP           *1             S01194
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C090
     C*
     C*  *-------------------*
     C*  * Validate Amount   *
     C*  *-------------------*
     C*
     C** The deal amount may not be amended.
     C           DDAMNP    IFNE @AMNP                      B1
     C           DDACTN    ANDEQ'A'                        B1
     C/COPY WNCPYSRC,MM0089C465
     C                     MOVE '1'       *IN17            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0372' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE @AMNP     DDAMNP           *1
     C*
     C**  The amount field must be entered.
     C                     ELSE                            X1
     C           DDAMNP    IFEQ *BLANKS                    B*2
     C                     MOVE '1'       *IN17            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0143' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  Verify that the amount entered is valid numeric.
     C                     ELSE                            X*2
     C           *IN16     IFEQ '0'                        B**3
     C*****                Z-ADDCDP       @@IDP            ***3           S01194
     C*****      13        SUB  CDP       @@IINT           ***3           S01194
     C                     Z-ADDA6NBDP    @@IDP            ***3           S01194
     C/COPY WNCPYSRC,MM0089C070
     C***********13        SUB  A6NBDP    @@IINT           ***3    S01194 054069
     C           12        SUB  A6NBDP    @@IINT           ***3           054069
     C                     MOVE *BLANKS   @@ALPH           ***3
     C                     MOVE DDAMNP    @@ALPH           ***3
     C                     MOVE 'Y'       @@MTID                          E17279
     C                     EXSR ZA0840                     ***3
     C           @@ERCD    IFNE 0                          B***4
     C                     MOVE '1'       *IN17            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0144' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     ELSE                            X***4
     C*
     C**  The amount must not be zero.
     C           @@AMT     IFEQ *ZEROS                     B****5
     C*                                                                   E24019
     C**  No validation for amendment of call deal.                       E24019
     C***********DDACTN    ANDNE'A'                                 E24019E26566
     C           DDACTN    ANDEQ'I'                                       E26566
     C           DDTYPE    ANDNE'CD'                                      E24019
     C                     MOVE '1'       *IN17            *****5
     C                     MOVE '1'       *IN41            *****5
     C                     MOVEL'MMM0143' @MSGID           *****5
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  If the amount is valid, set up the numeric amount on the
     C**  Standard Deal format.
     C           *IN16     IFEQ '0'                        B1
     C           *IN17     ANDEQ'0'                        B1
     C/COPY WNCPYSRC,MM0089C071
     C                     Z-ADD@@AMT     IKAMNP           *1
     C/COPY WNCPYSRC,MM0089C379
     C                     MOVE @@ALPH    DDAMNP           *1
     C                     MOVE @@ALPH    @AMNP            *1
     C                     END                             E1
     C*
     C*  *--------------------------------------*
     C*  * Validate Base Currency Exchange Rate *
     C*  *--------------------------------------*
     C*
     C*  This validation should only be carried out:                      E46993
     C*  - in INSERT mode                                                 E46993
     C*  - in AMEND mode (when the rate has been changed)                 E46993
     C*                                                                   E46993
     C************ange rate is not amendable.                             E18886
     C**  The exchange rate IS  amendable.                                E18886
     C*********  DDACTN    IFEQ 'A'                        B1             E18886
     C*********  DDBRAT    ANDNE@BRAT                      B1             E18886
     C*********            MOVE '1'       *IN18            *1             E18886
     C*********            MOVE '1'       *IN41            *1             E18886
     C*********            MOVEL'MMM0392' @MSGID           *1             E18886
     C*********            CALL 'ZA0240'                   *1             E18886
     C*********            PARM           @MSGID           *1             E18886
     C*********            MOVE @BRAT     DDBRAT           *1             E18886
     C*
     C*********            ELSE                            X1             E18886
     C*
     C**  If the deal ccy is valid, validate the rate.
     C           *IN16     IFEQ '0'                        B*2
     C*
     C* Only carry out validation if :                                    E46993
     C* In INSERT mode or                                                 E46993
     C* In AMEND mode when the rate has been changed                      E46993
     C           DDACTN    IFEQ 'I'                        B2             E46993
     C           DDACTN    OREQ 'A'                        B1             E46993
     C           DDBRAT    ANDNE@BRAT                      B1             E46993
     C*                                                                   E46993
     C**  If F12 was pressed, instead of ENTER, after the Extended        057977
     C**  Settlement Screen validation, determine whether the deal        057977
     C**  currency was changed and the base currency rate was not.        057977
     C*                                                                   057977
     C           WINKL     IFEQ '1'                                       057977
     C                     MOVE ' '       WINKL                           057977
     C*                                                                   057977
     C**  If so, clear the base currency rate field.                      057977
     C*                                                                   057977
     C           WTCCY     IFNE DDCCY                                     057977
     C           WTBRAT    ANDEQDDBRAT                                    057977
     C                     MOVE *BLANKS   DDBRAT                          057977
     C                     END                                            057977
     C*                                                                   057977
     C                     END                                            057977
     C*                                                                   057977
     C**  If the rate is blank, default it to the rate held on the
     C**  currency file for the deal currency.
     C**
     C           DDBRAT    IFEQ *BLANKS                    B**3
     C******     DDCCY     ANDNEBCCY                       B**3
     C*
     C** convert to display amount
     C** Scale the rate for display.
     C*****                Z-ADDSPOT      @@INRT           ***3           S01194
     C*****                Z-ADDSEXP      @@SXP1           ***3           S01194
     C                     Z-ADDA6SPRT    @@INRT           ***3           S01194
     C                     Z-ADDA6SCEX    @@SXP1           ***3           S01194
     C                     Z-ADD0         @@SXP2           ***3
     C                     MOVE 'M'       @@FCMD           ***3
     C                     EXSR ZA1150                     ***3
     C*
     C**  If the error code is 1 or 3 process a data base error.
     C           @@ERCD    IFEQ 1                          B***4
     C           @@ERCD    OREQ 3                          B***4
     C                     MOVE '1'       *INLR            ****4
     C                     MOVE '1'       *INU7            ****4
     C                     MOVE '1'       *INU8            ****4
     C                     MOVE '1'       *INLR            ****4
     C                     MOVE '1'       *INKC            ***************
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVEL'SCALING 'DBFILE           * DBERROR 024 *
     C                     MOVE '024'     DBASE            ***************
     C                     MOVEL'@@SCRT'  DBKEY            ****4
     C                     OUT  LDA                                       E24039
     C                     EXSR #C                         ****4
     C                     END                             E***4
     C*
     C                     Z-ADD8         @@QECN           ***3
     C           @@SCRT    MULT 100000000 @@AMTW           ***3
     C                     EXSR ZA0920                     ***3
     C                     MOVE @@AMTD    DDBRAT           ***3
     C                     MOVE @@AMTD    @BRAT            ***3
     C                     Z-ADD@@AMTW    @@AMT            ***3
     C*
     C**  Check it is a valid figure with 8 decimal places max.
     C                     ELSE                            X**3
     C                     Z-ADD8         @@IDP            ***3
     C                     Z-ADD4         @@IINT           ***3
     C                     MOVE *BLANKS   @@ALPH           ***3
     C                     MOVE DDBRAT    @@ALPH           ***3
     C                     MOVE 'N'       @@MTID                          E17279
     C                     EXSR ZA0840                     ***3
     C           @@ERCD    IFNE 0                          B***4
     C                     MOVE '1'       *IN18            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0413' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C*
     C**  Calculate the upper and lower limits for the exchange rate.
     C                     ELSE                            X***4
     C                     Z-ADD0         @BRATN           ****4
     C                     MOVE @@AMT     @@INRT           ****4
     C*****                Z-ADDSEXP      @@SEXP           ****4          S01194
     C                     Z-ADDA6SCEX    @@SEXP           ****4          S01194
     C                     EXSR ZA1160                     ****4
     C                     Z-ADD@@USRT    @BRATN           ****4
     C*****      SPOT      MULT .8        @LLIM            ****4          S01194
     C*****      SPOT      MULT 1.2       @ULIM            ****4          S01194
     C           A6SPRT    MULT .8        @LLIM            ****4          S01194
     C           A6SPRT    MULT 1.2       @ULIM            ****4          S01194
     C*
     C** If Deal currency equals the base currency and the base currency
     C** rate is not equal to spot rate.
     C*****      DDCCY     IFEQ BCCY                       B****5         S01194
     C*****      @BRATN    ANDNESPOT                       B****5         S01194
     C           DDCCY     IFEQ BJCYCD                     B****5         S01194
     C           @BRATN    ANDNEA6SPRT                     B****5         S01194
     C                     MOVE '1'       *IN18            *****5
     C                     MOVE '1'       *IN41            *****5
     C                     MOVEL'MMM0412' @MSGID           *****5
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C                     END                             E****5
     C*
     C**  If the rate is less than the lower limit, or greater than the
     C**  the upper limit , this is an error.
     C**  If there is adifference in the input and calculated interest
     C**  amounts, format the calculated figure and output it in a message
     C***********DDACTN    IFNE 'A'                                       E46993
     C           @BRATN    IFLT @LLIM                      B****5
     C           @BRATN    ORGT @ULIM                      B****5
     C                     MOVE '1'       *IN18            *****5
     C                     MOVE '1'       *IN41            *****5
     C                     Z-ADD8         @@QECN           *****5
     C*
     C**  Scale the Spot Rate for output in the message.
     C*****                Z-ADDSEXP      @@SXP1           *****5         S01194
     C                     Z-ADDA6SCEX    @@SXP1           *****5         S01194
     C                     Z-ADD0         @@SXP2           *****5
     C*****                Z-ADDSPOT      @@INRT           *****5         S01194
     C                     Z-ADDA6SPRT    @@INRT           *****5         S01194
     C                     MOVE 'M'       @@FCMD           *****5
     C                     EXSR ZA1150                     *****5
     C*
     C**  If the error code is 1 or 3, it is a data base error.
     C           @@ERCD    IFEQ 1                          B*****6
     C           @@ERCD    OREQ 3                          B*****6
     C                     MOVE '1'       *INU7            ******6
     C                     MOVE '1'       *INU8            ***************
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVEL'SCALING 'DBFILE           * DBERROR 023 *
     C                     MOVEL'HKBRAT'  DBKEY            ***************
     C                     MOVE '023'     DBASE            ******6
     C                     OUT  LDA                                       E24039
     C                     MOVE '1'       *INLR            ******6
     C                     MOVE '1'       *INKC            ******6
     C*                                                    ******6
     C                     EXSR #C                         ******6
     C                     END                             E*****6
     C*
     C                     MOVE @@SCRT    @@AMTW           *****5
     C                     EXSR ZA0920                     *****5
     C                     MOVE *BLANKS   @DATA            *****5
     C                     MOVEL@@AMTD    @DATA            *****5
     C                     MOVEL'MMM0414' @MSGID           *****5
     C                     CALL 'ZA0440'                   *****5
     C                     PARM           @MSGID           *****5
     C                     PARM           @DATA            *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  If the base currency exchange rate is valid, set up the base
     C**  currency exchange rate and the multiply divide indicator on
     C**  the standard deal format.
     C           *IN16     IFEQ '0'                        B1
     C           *IN18     ANDEQ'0'                        B1
     C           DDBRAT    IFEQ *BLANKS                    B*2
     C                     Z-ADD*ZEROS    IKBRAT           **2
     C                     ELSE                            X*2
     C           DDACTN    IFEQ 'A'                        B1             E46993
     C           DDBRAT    ANDEQ@BRAT                      B1             E46993
     C/COPY WNCPYSRC,MM0089C476
     C                     Z-ADD@@RATS    IKBRAT           **2            E46993
     C                     Z-ADD@@DAMT    IKAMNP           **2            E46993
     C                     END                             E*2            E46993
     C           DDACTN    IFEQ 'I'                        B2             E46993
     C           DDACTN    OREQ 'A'                        B1             E46993
     C           DDBRAT    ANDNE@BRAT                      B1             E46993
     C                     MOVE @@AMT     @@INRT           **2
     C*****                Z-ADDSEXP      @@SEXP           **2            S01194
     C                     Z-ADDA6SCEX    @@SEXP           **2            S01194
     C                     EXSR ZA1160                     **2
     C                     Z-ADD@@USRT    IKBRAT           **2
     C*****                MOVE MDIN      IKMMDI           **2            S01194
     C                     MOVE A6MDIN    IKMMDI           **2            S01194
     C                     END                             E*2
     C                     END                             E1
     C                     END                             E1             E46993
     C/COPY WNCPYSRC,MM0089C274
     C*                                                                   S01176
     C*  *--------------------------------*                               S01176
     C*  * Validate Repo/Pledge Ind and no.                               S01176
     C*  *--------------------------------*                               S01176
     C*                                                                   S01176
     C*  If Securities Trading module is installed                        S01176
     C*                                                                   S01176
     C           *IN56     IFEQ '1'                        B1             S01176
     C*                                                                   S01176
     C** Repo/Pledge Ind must be blank,'R' or 'P'                         S01176
     C*                                                                   S01176
     C           DDDRID    IFNE ' '                        B2             S01176
     C           DDDRID    ANDNE'R'                                       S01176
     C           DDDRID    ANDNE'P'                                       S01176
     C                     MOVE '1'       *IN41                           S01176
     C***********          MOVE '1'       *IN53                    S01176 E52649
     C                     MOVE '1'       *IN74                           E52649
     C                     MOVEL'MMM0521' @MSGID                          S01176
     C                     CALL 'ZA0240'                                  S01176
     C                     PARM           @MSGID                          S01176
     C                     END                             E2             S01176
     C*                                                                   S01176
     C** Do the following validation if Repo/Pledge Ind is 'R' or 'P'     S01176
     C*                                                                   S01176
     C           DDDRID    IFEQ 'R'                        B2             S01176
     C           DDDRID    OREQ 'P'                                       S01176
     C*********************Z-ADDIKCNUM    @CNUM                     S01176S01194
     C*********************MOVE '1'       @RCDT                     S01176S01194
     C***********@CLTKY****CHAINCLINT                65             S01176S01194
     C*********************MOVE 'A'       @RCDT                     S01176S01194
     C************IN65*****IFEQ '1'                        B3       S01176S01194
     C***********RECI******OREQ '*'                                 S01176S01194
     C                     MOVE IKCNUM    @CNUMA  6        **2      S01176S01194
     C                     CALL 'AOSECSR0'                 **2      S01176S01194
     C                     PARM *BLANKS   @RTCD   7        **2      S01176S01194
     C                     PARM '*KEY   ' @OPTN   7        **2      S01176S01194
     C                     PARM @CNUMA    @AENB   6        **2      S01176S01194
     C           SDSECS    PARM SDSECS    DSFDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B3             S01176
     C                     MOVE '1'       *IN41                           S01176
     C***********          MOVE '1'       *IN53                    S01176 066074
     C                     MOVE '1'       *IN74                           066074
     C                     MOVEL'MMM0522' @MSGID                          S01176
     C                     CALL 'ZA0240'                                  S01176
     C                     PARM           @MSGID                          S01176
     C                     ELSE                            X3             S01176
     C*                                                                   S01176
     C** If client record found Pledge Agreement ind must be 'Y'          S01176
     C*                                                                   S01176
     C***********C1PA******IFNE 'Y'                        B4             S01176
     C           BFPLAG    IFNE 'Y'                        B4       S01194S01176
     C                     MOVE '1'       *IN41                           S01176
     C***********          MOVE '1'       *IN53                    S01176 066074
     C                     MOVE '1'       *IN74                           066074
     C                     MOVEL'MMM0523' @MSGID                          S01176
     C                     CALL 'ZA0240'                                  S01176
     C                     PARM           @MSGID                          S01176
     C                     END                             E4             S01176
     C                     END                             E3             S01176
     C*                                                                   S01176
     C** If Repo/Pledge Number input when Repo/Pledge Ind is 'R' or 'P'   S01176
     C** Then Repo/Pledge Number must be non-zero and numeric             S01176
     C*                                                                   S01176
     C           DDDDMR    IFNE *BLANK                     B3             S01176
     C*                                                                   S01176
     C**  Check that the input is numeric and non-zero                    S01176
     C                     TESTN          DDDDMR     73                   S01176
     C                     MOVE DDDDMR    @TEST                           S01176
     C   73                TESTZ          @TEST          73               S01176
     C   73      DDDDMR    COMP '000000'             7373                 S01176
     C*                                                                   S01176
     C           *IN73     IFEQ '0'                        B4             S01176
     C                     MOVE '1'       *IN41                           S01176
     C***********          MOVE '1'       *IN54                    S01176 066074
     C                     MOVE '1'       *IN75                           066074
     C                     MOVEL'MMM0524' @MSGID                          S01176
     C                     CALL 'ZA0240'                                  S01176
     C                     PARM           @MSGID                          S01176
     C                     ELSE                            E4             S01176
     C                     END                             E4             S01176
     C                     END                             E3             S01176
     C*                                                                   S01176
     C** Do the following validation if Repo/Pledge Ind is not 'R' or 'P' S01176
     C*                                                                   S01176
     C                     ELSE                            X2             S01176
     C*                                                                   S01176
     C** Repo/Pledge Number must be blank                                 S01176
     C*                                                                   S01176
     C           DDDDMR    IFNE *BLANK                     B3             S01176
     C                     MOVE '1'       *IN41                           S01176
     C***********          MOVE '1'       *IN54                    S01176 066074
     C                     MOVE '1'       *IN75                           066074
     C                     MOVEL'MMM0525' @MSGID                          S01176
     C                     CALL 'ZA0240'                                  S01176
     C                     PARM           @MSGID                          S01176
     C                     END                             E3             S01176
     C                     END                             E2             S01176
     C                     END                             E1             S01176
     C                     MOVELDDDRID    IKDRID                          S01176
     C                     MOVELDDDDMR    IKDDMR                          S01176
     C*
     C*  *-------------------------*
     C*  * Validate Base Rate Code *
     C*  *-------------------------*
     C*
     C*********ase rate code is not amendable.                            E18886
     C**  The base rate code IS amendable.                                E18886
     C********   DDACTN    IFEQ 'A'                        B1             E18886
     C********   DDBSRC    ANDNE@BSRC                      B1             E18886
     C********             MOVE '1'       *IN19            *1             E18886
     C********             MOVE '1'       *IN41            *1             E18886
     C********             MOVEL'MMM0376' @MSGID           *1             E18886
     C********             CALL 'ZA0240'                   *1             E18886
     C********             PARM           @MSGID           *1             E18886
     C********             MOVE @BSRC     DDBSRC           *1             E18886
     C*
     C** The Base Rate Code is not amendable.                             068204
     C*                                                                   068204
     C           DDACTN    IFEQ 'A'                        B1             068204
     C           DDBSRC    ANDNE@BSRC                      B1             068204
     C/COPY WNCPYSRC,MM0089C466
     C                     MOVE '1'       *IN19            *1             068204
     C                     MOVE '1'       *IN41            *1             068204
     C                     MOVEL'MMM0376' @MSGID           *1             068204
     C                     CALL 'ZA0240'                   *1             068204
     C                     PARM           @MSGID           *1             068204
     C                     MOVE @BSRC     DDBSRC           *1             068204
     C/COPY WNCPYSRC,MM0089C504
     C********             ELSE                            X1             E18886
     C                     ELSE                            X1             068204
     C*
     C**  If the base rate code facility indicator is not 'Y', and the
     C**  base rate code is non-blank, it is an error.
     C*****      BRCF      IFNE 'Y'                        B*2            S01194
     C           BLBRCF    IFNE 'Y'                        B*2            S01194
     C           DDBSRC    ANDNE*BLANKS                    B*2
     C                     MOVE '1'       *IN19            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0416' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     END                             E*2
     C***********                                                  S01392 055894
     C****If*the*deal*is*a*half*day*deal,*Base*Rate*Code*must*not* S01392 055894
     C****be*entered********************************************** S01392 055894
     C***********DDVDAT    IFEQ DDMDAT                     B*2     S01392 055894
     C***********DDBSRC    ANDNE*BLANKS                    B*2     S01392 055894
     C***********          MOVE '1'       *IN19            **2     S01392 055894
     C***********          MOVE '1'       *IN41            **2     S01392 055894
     C***********          MOVEL'MMM0613' @MSGID           **2     S01392 055894
     C***********          CALL 'ZA0240'                   **2     S01392 055894
     C***********          PARM           @MSGID           **2     S01392 055894
     C***********          END                             E*2     S01392 055894
     C*
     C**  If the base rate code, deal currency and deal value date are
     C**  all valid and non-blank, further validate the base rate code.
     C/COPY WNCPYSRC,MM0089C249
     C           *IN11     IFEQ '0'                        B*2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C104                                           S01408
     C*                                                                   S01408
     C           *IN16     ANDEQ'0'                        B*2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C105                                           S01408
     C*                                                                   S01408
     C           *IN19     ANDEQ'0'                        B*2
     C           DDBSRC    ANDNE*BLANKS                    B*2
     C*
     C**  Access the base rates file to ascertain whether the base rate
     C**  code is valid.
     C*****                MOVE *BLANKS   @KEY             **2            S01194
     C*****                MOVE '21'      @KEY1            **2            S01194
     C*****                MOVE DDCCY     @KEY4            **2            S01194
     C*****                MOVE DDBSRC    @KEY5            **2            S01194
     C*****      @KEY      CHAINFDBSRTLL             65    **2            S01194
     C                     CALL 'AOBSRTR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM DDCCY     @AJCD   3        **2            S01194
     C                     PARM DDBSRC    @DWND   2        **2            S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C**  If no valid record is found, it is an error.
     C*****      *IN65     IFEQ '1'                        B**3           S01194
     C*****      RECI      OREQ '*'                        B**3           S01194
     C           @RTCD     IFNE *BLANK                     B**3           S01194
     C                     MOVE '1'       *IN19            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0417' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C*
     C**  If a valid record has been found, find the base rate to use.
     C                     ELSE                            X**3
     C                     MOVELBABSRC    DDBSRC                          E70
     C/COPY WNCPYSRC,MM0089C294
     C*
     C**  If the deal value date is less than value date of new rate
     C**  change, use the previous base rate.
     C*****      @VDYNO    IFLT VDNR                       B***4          S01194
     C*****                Z-ADDBRTE      @RATE            ****4          S01194
     C           @VDYNO    IFLT BAVDNR                     B***4          S01194
     C                     Z-ADDBACBSR    @RATE            ****4          S01194
     C*                                                                   E16048
     C** Display a warning message if the user is in Insert mode          E16048
     C*                                                                   E16048
     C           DDACTN    IFEQ 'I'                                       E16048
     C           *INL1     ANDEQ'0'                                       E50108
     C                     SETON                     5569                 E16048
     C                     MOVEL'MMM1045' @MSGID                          E16048
     C                     CALL 'ZA0240'                                  E16048
     C                     PARM           @MSGID                          E16048
     C                     END                                            E16048
     C*
     C**  If the deal value date is greater than value date of new rate
     C**  change, use the next base rate.
     C                     ELSE                            X***4
     C*****                Z-ADDNBRT      @RATE            ****4          S01194
     C                     Z-ADDBANBRT    @RATE            ****4          S01194
     C****                 END                             E***4          E18886
     C                     END                             E***4          068204
     C                     END                             E**3
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C250
     C                     END                             E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C106                                           S01408
     C*                                                                   S01408
     C*
     C**  If the base rate code is valid, set up the DRS base rate code
     C**  on the Standard Deal format.
     C           *IN19     IFEQ '0'                        B1
     C           DDBSRC    IFEQ *BLANKS                    B*2
     C                     MOVE *BLANKS   IKDBSR           **2
     C                     ELSE                            X*2
     C************         MOVE FSRT      IKDBSR           **2            E12945
     C*                                                                   E14356
     C** FIX E12945 INCORRECT                                             E14356
     C************         MOVE BRTT1     IKDBSR           **2     E12945 E14356
     C****                 MOVE FSRT      IKDBSR           **2      E14356S01194
     C                     MOVE BABSRS    IKDBSR           **2            S01194
     C                     END                             E*2
     C                     END                             E1
     C*
     C*  *-------------------------------*
     C*  * Validate Interest Rate/Spread *
     C*  *-------------------------------*
     C*
     C**  The interest rate/spread is not amendable.
     C           DDACTN    IFEQ 'A'                        B1
     C           DDSPRT    ANDNE@SPRT                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C467
     C                     MOVE @SPRT     DDSPRT           *1
     C                     MOVE '1'       *IN20            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0374' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C                     ELSE                            X1
     C*
     C**  If the deal type has been input, validate the spread/rate.
     C*********  DDTYPE    IFNE *BLANKS                    B*2            E12662
     C*
     C**  If the spread/rate is blank, this is an error.
     C**  Unless base rate code is entered
     C           DDSPRT    IFEQ *BLANKS                    B**3
     C           DDBSRC    ANDEQ*BLANKS                    B**3
     C                     MOVE '1'       *IN20            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0419' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C*
     C**  Check it is a valid figure with 7 decimal places max.
     C                     ELSE                            X**3
     C                     Z-ADD7         @@IDP            ***3
     C                     Z-ADD4         @@IINT           ***3
     C                     MOVE *BLANKS   @@ALPH           ***3
     C                     MOVE DDSPRT    @@ALPH           ***3
     C                     MOVE 'N'       @@MTID                          E17279
     C                     EXSR ZA0840                     ***3
     C           @@ERCD    IFNE 0                          B***4
     C                     MOVE '1'       *IN20            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0422' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C*
     C****If*the*spread/rate*is*zero,*this*is*an*error.                   E16252
     C****Unless*base*rate*code*is*entered*************                   E16252
     C                     ELSE                            X***4
     C*******    @@AMT     IFEQ 0                          B****5         E16252
     C*******    DDBSRC    ANDEQ*BLANKS                    B****5         E16252
     C*******              MOVE '1'       *IN20            *****5         E16252
     C*******              MOVE '1'       *IN41            *****5         E16252
     C*******              MOVEL'MMM0421' @MSGID           *****5         E16252
     C*******              CALL 'ZA0240'                   *****5         E16252
     C*******              PARM           @MSGID           *****5         E16252
     C*******              ELSE                            X****5         E16252
     C***********                                                  S01392 055894
     C****If*the*deal*is*a*half*day*deal,*Interest*Spread/Rate*mustS01392 055894
     C****not*be*entered*******************************************S01392 055894
     C***********DDVDAT    IFEQ DDMDAT                     B****5  S01392 055894
     C***********@@AMT     ANDNE*ZERO                      B****5  S01392 055894
     C***********          MOVE '1'       *IN20            *****5  S01392 055894
     C***********          MOVE '1'       *IN41            *****5  S01392 055894
     C***********          MOVEL'MMM0614' @MSGID           *****5  S01392 055894
     C***********          CALL 'ZA0240'                   *****5  S01392 055894
     C***********          PARM           @MSGID           *****5  S01392 055894
     C***********          ELSE                            X****5  S01392 055894
     C                     MOVE @@AMT     @SPRD            *****5
     C***********          END                             E****5  S01392 055894
     C*******              END                             E****5         E16252
     C                     END                             E***4
     C                     END                             E**3
     C*******************  END                             E*2            E12662
     C                     END                             E1
     C*
     C**  If the spread/rate is valid, determine the effective rate and
     C**  place it in the Standard Deal format.
     C           *IN20     IFEQ '0'                        B1
     C           *IN19     ANDEQ'0'                        B1
     C           DDBSRC    IFNE *BLANKS                    B*2
     C/COPY WNCPYSRC,MM0089C542
     C           @SPRD     ADD  @RATE     IKINTR           **2
     C/COPY WNCPYSRC,MM0089C543
     C                     ELSE                            X*2
     C                     Z-ADD@SPRD     IKINTR           **2
     C                     END                             E*2
     C                     MOVE @@ALPH    DDSPRT           *1
     C                     MOVE @@ALPH    @SPRT            *1
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C113                                           S01408
     C*                                                                   S01408
     C***********          END                             E1             S01443
      *                                                                   S01443
      ** If the 'loan/deposits interest rate tolerance' field,            S01443
      ** PF/SDDEALPD, is not equal to 0                                   S01443
      *                                                                   S01443
     C           BNLDIT    IFNE 0                          B*2            S01443
     C           *INL1     ANDEQ'0'                         *2            S01443
      *                                                                   S01443
      ** Calculate deal time span, and set up key to access interest      S01443
      ** rates file, LF/FDINTRLL                                          S01443
      *                                                                   S01443
     C           UTEST2    KLIST                                          S01443
     C                     KFLD           DDCCY                           S01443
     C                     KFLD           UTPRD2  1                       S01443
     C                     KFLD           UPRD2   20                      S01443
      *                                                                   S01443
     C                     EXSR #TSPN                                     S01443
      *                                                                   S01443
      ** Access LF/FDINTRLL                                               S01443
      *                                                                   S01443
     C           UTEST2    CHAINFDINTRLL             65                   S01443
      *                                                                   S01443
      ** If record found on file                                          S01443
      *                                                                   S01443
     C           *IN65     IFEQ '0'                        B**3           S01443
      *                                                                   S01443
     C           DDTYPE    IFEQ 'IT'                       B***4          S01443
     C           DDTYPE    OREQ 'TD'                                      S01443
     C           DDTYPE    OREQ 'CI'                                      S01443
     C           DDTYPE    OREQ 'CD'                                      S01443
      *                                                                   S01443
      ** If deal type is 'IT', 'TD', 'CI', or 'CD', use borrow rate       S01443
      ** to calculate interest rate range limits,                         S01443
      *                                                                   S01443
     C                     Z-ADDHWBRRT    URANGE 117                      S01443
     C                     END                             E***4          S01443
     C*                                                                   S01443
     C           DDTYPE    IFEQ 'IP'                       B***4          S01443
     C           DDTYPE    OREQ 'TI'                                      S01443
     C           DDTYPE    OREQ 'DL'                                      S01443
     C           DDTYPE    OREQ 'CL'                                      S01443
      *                                                                   S01443
      ** If deal type is 'IP', 'TI', 'DL', or 'CL', use lend   rate       S01443
      ** to calculate interest rate range limits,                         S01443
      *                                                                   S01443
     C                     Z-ADDHWLDRT    URANGE                          S01443
     C                     END                             E***4          S01443
      *                                                                   S01443
      ** Multiply range workfield by 'Loans Deposit  Interest rates       S01443
      ** Tolerance' field, and divide by 100 to give limit percentage     S01443
      *                                                                   S01443
     C           URANGE    MULT BNLDIT    UTEMPL 159H                     S01443
     C           UTEMPL    DIV  100       UPRCNT 117H                     S01443
      *                                                                   S01443
      ** Add percentage to range workfield to calculate upper limit       S01443
      ** Subtract percentage to range workfield to calculate lower        S01443
      ** limit                                                            S01443
      *                                                                   S01443
     C           URANGE    ADD  UPRCNT    UUPLMT 117                      S01443
     C           URANGE    SUB  UPRCNT    ULOLMT 117                      S01443
     C*                                                                   S01443
     C                     ELSE                            X**3           S01443
      *                                                                   S01443
      ** If record not found on LF/FDINTRLL, set uppper and lower         S01443
      ** limits to 0                                                      S01443
      *                                                                   S01443
     C                     Z-ADD0         UUPLMT                          S01443
     C                     Z-ADD0         ULOLMT                          S01443
     C                     END                             E**3           S01443
      *                                                                   S01443
      ** If the effective interest rate is above the upper limit          S01443
      ** or below the lower limit, output warning message                 S01443
      *                                                                   S01443
     C           IKINTR    IFLT ULOLMT                     B**3           S01443
     C           IKINTR    ORGT UUPLMT                                    S01443
     C                     MOVEL'1'       *IN55                           S01443
     C                     MOVEL'1'       *IN20                           S01443
     C                     MOVEL'MMM2549' @MSGID                          S01443
     C/COPY WNCPYSRC,MM0089C328
     C                     CALL 'ZA0240'                                  S01443
     C                     PARM           @MSGID                          S01443
     C/COPY WNCPYSRC,MM0089C329
     C                     END                             E**3           S01443
     C                     END                             E*2            S01443
     C                     END                             E1             S01443
     C*
     C/COPY WNCPYSRC,MM0089C251
     C*  *-----------------------------*
     C*  * Validate Calculation Method *
     C*  *-----------------------------*
     C*
     C**  The calculation method is only amendable if the deal is
     C**  complete, and the field is designated as amendable on the
     C**  file MMCDAFLL.
     C           DDACTN    IFEQ 'A'                        B1
     C           @DSTS     ANDNE'C'                        B1
     C           DDICMT    ANDNE@ICMT                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C           DDACTN    OREQ 'A'                        B1
     C           @DSTS     ANDEQ'C'                        B1
     C           DDICMT    ANDNE@ICMT                      B1
     C           HHINTA    ANDEQ'N'                        B1
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C468
     C                     MOVE @ICMT     DDICMT           *1
     C                     MOVE '1'       *IN21            *1
     C                     MOVE '1'       *IN41            *1
     C           @DSTS     IFEQ 'C'                        B*2
     C                     MOVEL'MMM0484' @MSGID           **2
     C                     ELSE                            X*2
     C                     MOVEL'MMM0485' @MSGID           **2
     C                     END                             E*2
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C                     ELSE                            X1
     C*
     C**  If the interest calculation method is blank, this is an error
     C           DDICMT    IFEQ *BLANK                     B*2
     C***********          MOVE '1'       *IN21            **2            E40579
     C***********          MOVE '1'       *IN41            **2            E40579
     C***********          MOVEL'MMM0427' @MSGID           **2            E40579
     C***********          CALL 'ZA0240'                   **2            E40579
     C***********          PARM           @MSGID           **2            E40579
     C                     MOVE A6DICB    DDICMT                          E40579
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C241
     C*
     C**  If the method is not 1,2,3,4,5 or 6 this is an error.
     C           DDICMT    IFNE '1'                        B*2
     C           DDICMT    ANDNE'2'                        B*2
     C           DDICMT    ANDNE'3'                        B*2
     C           DDICMT    ANDNE'4'                        B*2
     C           DDICMT    ANDNE'5'                        B*2
     C           DDICMT    ANDNE'6'                        B*2
     C/COPY WNCPYSRC,MM0089C075
     C           DDICMT    ANDNE*BLANKS                    B*2
     C                     MOVE '1'       *IN21            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0428' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C242
     C                     END                             E1
     C*
     C*  *--------------------------------------*
     C*  * Validate Negative Interest Indicator *
     C*  *--------------------------------------*
     C*
     C**  The negative interest indicator is not amendable.
     C/COPY WNCPYSRC,MM0089C252
     C           DDACTN    IFEQ 'A'                        B1
     C           DDNGVI    ANDNE@NGVI                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C469
     C                     MOVE @NGVI     DDNGVI           *1
     C                     MOVE '1'       *IN22            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0491' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C                     ELSE                            X1
     C*
     C****If*the*base*rate*code*is*non-blank,*and*the*negative*interest** E01005
     C****Indicator*is*also*non-blank,*this*is*an*error.***************** E01005
     C***********DDBSRC    IFNE *BLANK                     B*2            E01005
     C***********DDNGVI    IFNE *BLANK                     B**3           E01005
     C***********          MOVE '1'       *IN22            ***3           E01005
     C***********          MOVE '1'       *IN41            ***3           E01005
     C***********          MOVEL'MMM0431' @MSGID           ***3           E01005
     C***********          CALL 'ZA0240'                   ***3           E01005
     C***********          PARM           @MSGID           ***3           E01005
     C***********          END                             E**3           E01005
     C*                                                                   E01005
     C**  If the negative interest indicator is not Y or N or Blanks      E01005
     C**  this is an error                                                E01005
     C           DDNGVI    IFNE 'Y'                                       E01005
     C           DDNGVI    ANDNE'N'                                       E01005
     C           DDNGVI    ANDNE' '                                       E01005
     C                     MOVE '1'       *IN22                           E01005
     C                     MOVE '1'       *IN41                           E01005
     C                     MOVEL'MMM0433' @MSGID                          E01005
     C                     CALL 'ZA0240'                                  E01005
     C                     PARM           @MSGID                          E01005
     C                     END                                            E01005
     C*                                                                   E01005
     C****If*the*base*rate*code*is*blank,*and*the*negative*interest****** E01005
     C****indicator*is*not*blank or*'Y',*this*is*an*error.*************** E01005
     C***********          ELSE                            X*2            E01005
     C***********DDNGVI    IFNE *BLANK                     B**3           E01005
     C***********DDNGVI    ANDNE'Y'                        B**3           E01005
     C***********          MOVE '1'       *IN22            ***3           E01005
     C***********          MOVE '1'       *IN41            ***3           E01005
     C***********          MOVEL'MMM0432' @MSGID           ***3           E01005
     C***********          CALL 'ZA0240'                   ***3           E01005
     C***********          PARM           @MSGID           ***3           E01005
     C***********          END                             E**3           E01005
     C***********          END                             E*2            E01005
     C                     END                             E1
     C*
     C*  *--------------------------------------*
     C*  * Validate Interest Payment Frequency  *
     C*  *--------------------------------------*
     C*
     C**  The payment frequency is only amendable if the deal is
     C**  complete, and the field is designated as amendable on the
     C**  file MMCDAFLL.
     C***********DDACTN    IFEQ 'A'                        B1       E22903E24202
     C***********@DSTS     ANDNE'A'                        B1       E22903E24202
     C***********HHINTA    ANDEQ'N'                        B1       E22903E24202
     C***********DDTYPE    ANDNE'CD'                       B1       E22903E24202
     C***********DDTYPE    ANDNE'CL'                       B1       E22903E24202
     C***********DDTYPE    ANDNE'DL'                       B1       E22903E24202
     C***********DDIPFQ    ANDNE@IPFQ                      B1       E22903E24202
     C***********DDACTN    IFEQ 'A'                        B1             063371
     C***********@DSTS     ANDNE'C'                        B1             063371
     C***********DDIPFQ    ANDNE@IPFQ                      B1             063371
     C***********@TERM1    ANDNE'R'                                S01434 063371
     C***********DDACTN    OREQ 'A'                        B1             063371
     C/COPY WNCPYSRC,MM0089C408
     C           DDACTN    IFEQ 'A'                        B1             063371
     C           @DSTS     ANDEQ'C'                        B1
     C           DDIPFQ    ANDNE@IPFQ                      B1
     C           HHINTA    ANDEQ'N'                        B1
     C           @TERM1    ANDNE'R'                                       S01434
     C           DDTYPE    IFNE 'CD'                                      E24202
     C           DDTYPE    ANDNE'CL'                                      E24202
     C           DDTYPE    ANDNE'DL'                                      E24202
     C                     MOVE @IPFQ     DDIPFQ           *1
     C                     MOVE '1'       *IN23            *1
     C                     MOVE '1'       *IN41            *1
     C***********@DSTS     IFEQ 'C'                        B*2            063371
     C                     MOVEL'MMM0482' @MSGID           **2
     C***********          ELSE                            X*2            063371
     C***********          MOVEL'MMM0483' @MSGID           **2            063371
     C***********          END                             E*2            063371
     C************         END                             E*2      E22903E29975
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E*2            E29975
     C*
     C                     ELSE                            X1
     C*
     C**  If the next interest date is blank and the interest frequency
     C**  is not, this is an error.
     C           DDNDAT    IFEQ *BLANKS                    B*2
     C           DDIPFQ    ANDNE*BLANKS                    B*2
     C           DDIPFQ    ANDNE'N'                        B*2            AUS003
     C                     MOVE '1'       *IN23            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0434' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     END                             E*2
     C*
     C**  If the interest frequency is not M,Q,X,Y or blank it is an
     C**  error.
     C           DDIPFQ    IFNE *BLANK                     B*2
     C           DDIPFQ    ANDNE'M'                        B*2
     C           DDIPFQ    ANDNE'Q'                        B*2
     C           DDIPFQ    ANDNE'X'                        B*2
     C           DDIPFQ    ANDNE'Y'                        B*2
     C           DDIPFQ    ANDNE'N'                        B*2            AUS003
     C/COPY WNCPYSRC,MM0089C546
     C                     MOVE '1'       *IN23            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0436' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     END                             E*2
     C           DDIPFQ    IFEQ 'N'                        B*2            AUS003
     C           DDNDAT    ANDNE*BLANKS                    B*2            AUS003
     C                     MOVE '1'       *IN23            **2            AUS003
     C                     MOVE '1'       *IN41            **2            AUS003
     C                     MOVEL'MMM0436' @MSGID           **2            AUS003
     C                     CALL 'ZA0240'                   **2            AUS003
     C                     PARM           @MSGID           **2            AUS003
     C                     END                             E*2            AUS003
     C           DDCCY     IFNE 'AUD'                      B*2            AUS003
     C           DDIPFQ    ANDEQ'N'                        B*2            AUS003
     C                     MOVE '1'       *IN23            **2            AUS003
     C                     MOVE '1'       *IN41            **2            AUS003
     C*********************MOVEL'MMM0436' @MSGID           **2     AUS003 E46937
     C                     MOVEL'MMM0437' @MSGID           **2            E46937
     C                     CALL 'ZA0240'                   **2            AUS003
     C                     PARM           @MSGID           **2            AUS003
     C                     END                             E*2            AUS003
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C253
     C*
     C*  *-----------------------------*
     C*  * Validate Next Interest Date *
     C*  *-----------------------------*
     C*
     C                     MOVEL*BLANKS   WEICY   3                       CEU003
     C*                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C*                                                                   CEU003
     C           S01434    IFEQ 'Y'                                       CEU003
     C           DDIPDS    ANDEQ'Y'                                       CEU003
     C*                                                                   CEU003
     C           DDISCY    IFNE *BLANKS                                   CEU003
     C                     MOVELDDISCY    WEICY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELDDCCY     WEICY                           CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ELSE                                           CEU003
     C*                                                                   CEU003
     C           PMPSCY    IFNE *BLANKS                                   CEU003
     C           PMERCD    ANDEQ*BLANKS                                   CEU003
     C           *INL1     ANDEQ'0'                                       CEU003
     C                     MOVELPMPSCY    WEICY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELDDCCY     WEICY                           CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ELSE                                           CEU003
     C                     MOVELDDCCY     WEICY                           CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C**  The next interest date may only be amended if:
     C**  (a) The deal status is complete and the field is defined as
     C**      amendable on the MMCDAFLL file.
     C****(b)*The*deal*status*is*authorised*or*requiring*re-authorisation,E24405
     C********and*the*rundate*is*after*the*deal*input*date.***************E24405
     C**  (b) The deal status is authorised or requiring re-authorisation,E24405
     C**      and the rundate is after the deal input date and the        E24405
     C**      NEXT INTEREST DATE is not 0.                                E24405
     C/COPY WNCPYSRC,MM0089C254
     C           DDACTN    IFEQ 'A'                        B1
     C           DDNDAT    ANDNE@NDAT                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C470
     C           @DSTS     IFEQ 'C'                        B*2
     C           HHINTA    ANDNE'Y'                        B*2
     C/COPY WNCPYSRC,MM0089C477
     C                     MOVE @NDAT     DDNDAT           **2
     C                     MOVE '1'       *IN24            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0480' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     END                             E*2
     C*
     C           HKNIYY    IFNE 0                                         E24405
     C           @DSTS     IFEQ 'A'                        B*2
     C*****      RUND      ANDLE@TDYNO                     B*2            S01194
     C           BJRDNB    ANDLE@TDYNO                     B*2            S01194
     C           @DSTS     OREQ 'R'                        B*2
     C*****      RUND      ANDLEIKDVSD                     B*2            S01194
     C           BJRDNB    ANDLEIKDVSD                     B*2            S01194
     C                     MOVE @NDAT     DDNDAT           **2
     C                     MOVE '1'       *IN24            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0481' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     END                             E*2
     C                     END                                            E24405
     C                     END                             E1
     C*                                                                   AUS003
     C**   Processing for interest frequency 'N'.                         AUS003
     C**   For inserts calculate NDAT using VDAT.                         AUS003
     C**   For amends use RUND to calculate NDAT.                         AUS003
     C*                                                                   AUS003
     C           *IN24     IFEQ '0'                                       AUS003
     C           DDIPFQ    ANDEQ'N'                                       AUS003
     C           DDACTN    IFNE 'A'                                       AUS003
     C           DDVDAT    IFNE *BLANKS                                   AUS003
     C                     MOVE DDVDAT    DMMYXX  6                       AUS003
     C                     EXSR IDATE1                                    AUS003
     C                     END                                            AUS003
     C                     ELSE                                           AUS003
     C                     EXSR AMDFRQ                                    AUS003
     C                     END                                            AUS003
     C                     END                                            AUS003
     C*
     C**  If the date was not invalidly amended, carry out further
     C**  validation.  (Only if the date was not blank.)
     C           *IN24     IFEQ '0'                        B1
     C           DDNDAT    ANDNE*BLANKS                    B1
     C*
     C**  Validate that the date is valid as a date.
     C                     TESTN          DDNDAT     6263  *1
     C                     MOVE DDNDAT    @TEST            *1
     C                     TESTZ          @TEST          73*1
     C           *IN62     IFEQ '1'                        B*2
     C           *IN73     ANDEQ'1'                        B*2
     C           *IN63     OREQ '1'                        B*2
     C           *IN73     ANDEQ'1'                        B*2
     C                     MOVE DDNDAT    @DAT             **2
     C                     CALL 'ZA0270'                   **2
     C                     PARM           @DAT             **2
     C*****                PARM           DATF             **2            S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2
     C                     PARM           @NDYNO           **2
     C                     END                             E*2
     C*
     C**  If not, it is an error.
     C           *IN62     IFEQ '0'                        B*2
     C           *IN63     ANDEQ'0'                        B*2
     C           *IN73     OREQ '0'                        B*2
     C           @RTCDE    OREQ '1'                        B*2
     C                     MOVE '1'       *IN24            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0438' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  Check that the next interest date is after the value date.
     C**  (If the value date has been entered and is valid.)
     C                     ELSE                            X*2
     C           @VDYNO    IFNE *ZEROS                     B**3
     C************IN11     ANDEQ'0'                        B**3           091823
     C           @NDYNO    ANDLE@VDYNO                     B**3
     C           DDIPFQ    ANDNE'N'                                       E47130
     C           @VDYNO    ORNE *ZEROS                                    E47130
     C           *IN11     ANDEQ'0'                                       E47130
     C           @NDYNO    ANDLT@VDYNO                                    E47130
     C           DDIPFQ    ANDEQ'N'                                       E47130
     C                     MOVE '1'       *IN24            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0440' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C*
     C**  Check that the next interest date is before the mat. date.
     C**  (If the maturity date has been entered and is valid.)
     C           DDMDAT    IFNE *BLANKS                    B**3
     C           DDMDAT    ANDNE*ZEROS                     B**3
     C           *IN12     ANDEQ'0'                        B**3
     C           *IN24     ANDEQ'0'                        B**3
     C           DDIPFQ    ANDNE'N'                        B**3           AUS003
     C           @NDYNO    ANDGE@MDYNO                     B**3
     C                     MOVE '1'       *IN24            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0441' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C*
     C**  If the action code is 'A' the next interest date must be after
     C**  the last interest date and the interest accrual control date.
     C           DDACTN    IFEQ 'A'                        B**3
     C           @NDYNO    IFLE @LIDYN                     B***4
     C                     MOVE '1'       *IN24            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0442' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C           @NDYNO    IFLE @IADYN                     B***4
     C                     MOVE '1'       *IN24            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0443' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C**  If the deal type is non-blank.
     C           DDTYPE    IFNE *BLANKS                    B**3
     C           DDIPFQ    ANDNE'N'                        B**3           AUS003
     C*
     C****Find whether the date is a holiday in the deal currency.        E00032
     C*****                MOVE DDCCY     @@CCY            ***3           S01195
     C*****                Z-ADD@NDYNO    @@MNO            ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C*****                MOVE DDCCY     ZCCY             ***3     S01195E00032
     C*****                Z-ADD@NDYNO    ZDAYNO           ***3     S01195E00032
     C*****                MOVE *BLANKS   ZLOC             ***3     S01195E00032
     C*****                EXSR ZCHKH                      ***3     S01195E00032
     C/COPY WNCPYSRC,MM0089C427
     C*
     C**  If the date is not a working day in the deal currency and the
     C****receive*method*is*01,07,08,*and*the*deal*type*is*IT,CD,CI*or*   E00032
     C**  pay method is 01,07,08, and the deal type is IT,CD,CI or        E00032
     C**  TD, this is an error.
     C           DDTYPE    IFEQ 'IT'                       B***4
     C           DDTYPE    OREQ 'CD'                       B***4
     C           DDTYPE    OREQ 'CI'                       B***4
     C           DDTYPE    OREQ 'TD'                       B***4
     C*****      DDMOPM    IFEQ '01'                       B****5         S01177
     C*****      DDMOPM    OREQ '07'                       B****5         S01177
     C*****      DDMOPM    OREQ '08'                       B****5         S01177
     C           PMPSTM    IFEQ 01                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C           PMPSTM    OREQ 07                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C           PMPSTM    OREQ 08                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C*                                                                   E00032
     C**  Find whether the date is a holiday in the deal currency         E00032
     C**  at the pay nostro location.                                     E00032
     C**  First find pay nostro location.                                 E00032
      *  (database error handling done in access program)                 E00032
     C*                                                                   BHF894
     C           PMERCD    IFEQ *BLANKS                                   BHF894
     C*                                                                   BHF894
     C                     CALL 'AONOSTR0'                 *****5         E00032
     C                     PARM '*DBERR ' @RTCD   7        *****5         E00032
     C                     PARM '*KEY   ' @OPTN   7        *****5         E00032
     C                     PARM *BLANKS   @KEYA   6        *****5         E00032
     C***********          PARM DDCCY     @KEYB   3        *****5  E00032 CEU003
     C                     PARM WEICY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        *****5                      E00032 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        *****5         E00032
     C                     PARM PMPONS    @KEYE   2        *****5         E00032
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   E00032
     C*********************MOVE A7CSSN    ZLOC             *****5         E00032
     C                     MOVE A7NOSN    ZLOC             *****5         E00032
     C*                                                                   BHF894
     C                     ELSE                                           BHF894
     C                     MOVE *BLANKS   ZLOC                            BHF894
     C                     END                                            BHF894
     C*                                                                   BHF894
     C***********          MOVE DDCCY     ZCCY             *****5  E00032 CEU003
     C                     MOVE WEICY     ZCCY             *****5         CEU003
     C                     Z-ADD@NDYNO    ZDAYNO           *****5         E00032
     C                     EXSR ZCHKH                      *****5         E00032
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B*****6        S01195
     C           ZIND      IFEQ 'H'                        B*****6        S01195
     C                     MOVE '1'       *IN24            ******6
     C***********          MOVE '1'       *IN41            ******6        055836
     C                     MOVE '1'       *IN55            ******6        055836
     C*                                                                   CEU003
     C           WEICY     IFEQ DDCCY                                     CEU003
     C                     MOVEL'MMM0444' @MSGID           ******6
     C                     ELSE                                           CEU003
     C                     MOVEL'MMM3002' @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C/COPY WNCPYSRC,MM0089C330
     C                     CALL 'ZA0240'                   ******6
     C                     PARM           @MSGID           ******6
     C/COPY WNCPYSRC,MM0089C331
     C                     END                             E*****6
     C                     END                             E****5
     C*
     C**  If the date is not a working day in the deal currency and the
     C****pay*method*is*01,07,08,*and*the*deal*type*is*not*IT,CD,CI*or*   E00032
     C**  receive method is 01,07,08, and deal type is not IT,CD,CI or    E00032
     C**  TD, this is an error.
     C                     ELSE                            X***4
     C*****      DDORCM    IFEQ '01'                       B****5         S01177
     C*****      DDORCM    OREQ '07'                       B****5         S01177
     C*****      DDORCM    OREQ '08'                       B****5         S01177
     C           PMRSTM    IFEQ 01                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C           PMRSTM    OREQ 07                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C           PMRSTM    OREQ 08                         B****5         S01177
     C************IN77     ANDEQ'0'                        B****5   LN0234E48032
     C           *INL1     ANDEQ'0'                        B****5         E48032
     C*                                                                   E00032
     C**  Find whether the date is a holiday in the deal currency         E00032
     C**  at the receive nostro location.                                 E00032
     C**  First find receive nostro location.                             E00032
      *  (database error handling done in access program)                 E00032
     C*                                                                   BHF894
     C           PMERCD    IFEQ *BLANKS                                   BHF894
     C*                                                                   BHF894
     C                     CALL 'AONOSTR0'                 *****5         E00032
     C                     PARM '*DBERR ' @RTCD   7        *****5         E00032
     C                     PARM '*KEY   ' @OPTN   7        *****5         E00032
     C                     PARM *BLANKS   @KEYA   6        *****5         E00032
     C***********          PARM DDCCY     @KEYB   3        *****5  E00032 CEU003
     C                     PARM WEICY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        *****5                      E00032 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        *****5         E00032
     C                     PARM PMRONS    @KEYE   2        *****5         E00032
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   E00032
     C*********************MOVE A7CSSN    ZLOC             *****5         E00032
     C                     MOVE A7NOSN    ZLOC             *****5         E00032
     C*                                                                   BHF894
     C                     ELSE                                           BHF894
     C                     MOVE *BLANKS   ZLOC                            BHF894
     C                     END                                            BHF894
     C*                                                                   BHF894
     C***********          MOVE DDCCY     ZCCY             *****5  E00032 CEU003
     C                     MOVE WEICY     ZCCY                            CEU003
     C                     Z-ADD@NDYNO    ZDAYNO           *****5         E00032
     C                     EXSR ZCHKH                      *****5         E00032
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B*****6        S01195
     C           ZIND      IFEQ 'H'                        B*****6        S01195
     C                     MOVE '1'       *IN24            ******6
     C***********          MOVE '1'       *IN41            ******6        055836
     C                     MOVE '1'       *IN55            ******6        055836
     C*                                                                   CEU003
     C           WEICY     IFEQ DDCCY                                     CEU003
     C                     MOVEL'MMM0444' @MSGID           ******6
     C                     ELSE                                           CEU003
     C                     MOVEL'MMM3002' @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C/COPY WNCPYSRC,MM0089C332
     C                     CALL 'ZA0240'                   ******6
     C                     PARM           @MSGID           ******6
     C/COPY WNCPYSRC,MM0089C333
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C/COPY WNCPYSRC,MM0089C428
     C*
     C**  Find whether the date is a holiday in the local currency.
     C*****                MOVE LOCY      @@CCY            ***3           S01195
     C*****                Z-ADD@NDYNO    @@MNO            ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C                     MOVE BJLCCY    ZCCY             ***3           S01195
     C                     Z-ADD@NDYNO    ZDAYNO           ***3           S01195
     C                     MOVE BJSLCD    ZLOC             ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C*
     C****If*settlement*method*is*not*blank,00,01,07*or*08*and*it*is      LN0234
     C**  If settlement method is not 01,07 or 08 and it is               LN0234
     C**  not a working day in the local currency, it is an error.
     C**  (Only if not settled through a nostro)                          E81
     C*****      DDORCM    IFNE *BLANKS                    B***4          S01177
     C*****      DDORCM    ANDNE'00'                       B***4          S01177
     C*****      DDORCM    ANDNE'01'                       B***4          S01177
     C*****      DDORCM    ANDNE'07'                       B***4          S01177
     C*****      DDORCM    ANDNE'08'                       B***4          S01177
     C***********PMRSTM    IFNE *ZEROS                     B***4   S01177 LN0234
     C***********PMRSTM    ANDNE00                         B***4   S01177 LN0234
     C***********PMRSTM    ANDNE01                         B***4   S01177 LN0234
     C           PMRSTM    IFNE 01                         B***4          LN0234
     C           PMRSTM    ANDNE07                         B***4          S01177
     C           PMRSTM    ANDNE08                         B***4          S01177
     C************IN77     ANDEQ'0'                        B***4    LN0234E48032
     C           *INL1     ANDEQ'0'                        B***4          E48032
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B*****6        S01195
     C           ZIND      IFEQ 'H'                        B*****6        S01195
     C                     MOVE '1'       *IN24            *****5
     C***********          MOVE '1'       *IN41            *****5         055836
     C                     MOVE '1'       *IN55            *****5         055836
     C                     MOVEL'MMM0445' @MSGID           *****5
     C/COPY WNCPYSRC,MM0089C334
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C/COPY WNCPYSRC,MM0089C335
     C                     END                             E****5
     C                     END                             E***4
     C*
     C*****      DDMOPM    IFNE *BLANKS                    B***4          S01177
     C*****      DDMOPM    ANDNE'00'                       B***4          S01177
     C*****      DDMOPM    ANDNE'01'                       B***4          S01177
     C*****      DDMOPM    ANDNE'07'                       B***4          S01177
     C*****      DDMOPM    ANDNE'08'                       B***4          S01177
     C***********PMPSTM    IFNE *ZEROS                     B***4   S01177 LN0234
     C***********PMPSTM    ANDNE00                         B***4   S01177 LN0234
     C***********PMPSTM    ANDNE01                         B***4   S01177 LN0234
     C           PMPSTM    IFNE 01                         B***4          LN0234
     C           PMPSTM    ANDNE07                         B***4          S01177
     C           PMPSTM    ANDNE08                         B***4          S01177
     C************IN77     ANDEQ'0'                        B***4    LN0234E48032
     C           *INL1     ANDEQ'0'                        B***4          E48032
     C*
     C**  If ZIND = 'H' then the date is a holiday.                       S01195
     C*****      @@HIND    IFEQ 'H'                        B****5         S01195
     C           ZIND      IFEQ 'H'                        B****5         S01195
     C                     MOVE '1'       *IN24            *****5
     C***********          MOVE '1'       *IN41            *****5         055836
     C                     MOVE '1'       *IN55            *****5         055836
     C                     MOVEL'MMM0445' @MSGID           *****5
     C/COPY WNCPYSRC,MM0089C336
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C/COPY WNCPYSRC,MM0089C337
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  Store valid next interest date in Standard Deal format.
     C           *IN24     IFEQ '0'                        B1
     C           DDNDAT    ANDNE*BLANKS                    B1
     C                     Z-ADD@NDYNO    IKNIPD           *1
     C*********            Z-ADD@NDYNO    @@DAYN           *1
     C*********            EXSR ZA0710                     *1
     C*********            Z-ADD@@VDT     IKNIPD           *1
     C                     ELSE                            X1
     C                     Z-ADD0         IKNIPD           *1
     C                     END                             E1
     C*
     C           *IN24     IFEQ '1'                        B1             E24242
     C           *IN55     ANDEQ'1'                        B1             E24242
     C           DDNDAT    ANDNE*BLANKS                    B1             E24242
     C                     Z-ADD@NDYNO    IKNIPD           *1             E24242
     C                     END                             E1             E24242
     C           DDIPFQ    IFEQ 'N'                        B1             AUS003
     C                     MOVE *BLANKS   DDNDAT           B1             AUS003
     C                     END                             *1             AUS003
     C/COPY WNCPYSRC,MM0089C255
     C*
     C*  *--------------------------------*
     C*  * Validate Total Interest Amount *
     C*  *--------------------------------*
     C*
     C/COPY WNCPYSRC,MM0089C256
     C** The interest amount may not be amended.
     C           DDTOTI    IFNE @TOTI                      B1
     C           DDACTN    ANDEQ'A'                        B1
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C471
     C                     MOVE @TOTI     DDTOTI           *1
     C                     MOVE '1'       *IN25            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0492' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  The interest field must be entered.
     C                     ELSE                            X1
     C**  Skip the validation for Total Interest validation  in           E17603
     C**  Amendment & Authorisation mode.                                 E17603
     C           DDACTN    IFNE 'A'                        B*2            E17603
     C           DDACTN    ANDNE'X'                        B*2            E17603
     C           DDACTN    OREQ 'A'                                       S01434
     C           @TERM1    ANDEQ'R'                                       S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C128                                           S01408
     C*                                                                   S01408
     C*                                                                   E17603
     C           DDTOTI    IFEQ *BLANKS                    B*2
     C/COPY WNCPYSRC,MM0089C054
     C           S01468    IFEQ 'Y'                        B**3           S01468
     C           DDNTCE    IFEQ '  0'                      B**4           S01468
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP15                                           S01408
     C*                                                                   S01408
     C           DDTYPE    IFEQ 'CD'                       B***5          S01468
     C           DDTYPE    OREQ 'CL'                       ****5          S01468
     C           DDTYPE    OREQ 'DL'                       ****5          S01468
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP15                                           S01408
     C*                                                                   S01408
     C                     Z-ADDIKINTR    @@RATE           ****5          S01468
     C                     Z-ADDIKAMNP    @@AMT            ****5          S01468
     C                     MOVE DDICMT    ZZCALC           ****5          S01468
     C                     Z-ADD@VDYNO    ZZBEG            ****5          S01468
     C           ZZBEG     ADD  1         ZZEND            ****5          S01468
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP17                                           S01408
     C*                                                                   S01408
     C                     EXSR MM1030                     ****5          S01468
     C                     Z-ADD@@INTR    @TOTIN           ****5          S01468
     C                     GOTO SKIPV                      ****5          S01468
     C                     END                             E005           S01468
     C                     END                             E004           S01468
     C                     END                             E003           S01468
     C/COPY WNCPYSRC,MM0089C055
     C                     MOVE '1'       *IN25            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0451' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C/COPY WNCPYSRC,MM0089C056
     C           SKIPV     TAG                                            S01468
     C/COPY WNCPYSRC,MM0089C024
     C*
     C**  If the interest has been entered...
     C                     ELSE                            X*2
     C/COPY WNCPYSRC,MM0089C057
     C*
     C**  Check that the input amount is a valid number.
     C           *IN16     IFEQ '0'                        B**3
     C/COPY WNCPYSRC,MM0089C058
     C*****                Z-ADDCDP       @@IDP            ***3           S01194
     C*****      13        SUB  CDP       @@IINT           ***3           S01194
     C                     Z-ADDA6NBDP    @@IDP            ***3           S01194
     C           13        SUB  A6NBDP    @@IINT           ***3           S01194
     C                     MOVE *BLANKS   @@ALPH           ***3
     C                     MOVE DDTOTI    @@ALPH           ***3
     C                     MOVE 'N'       @@MTID                          E17279
     C                     EXSR ZA0840                     ***3
     C/COPY WNCPYSRC,MM0089C059
     C           @@ERCD    IFNE 0                          B***4
     C                     MOVE '1'       *IN25            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0452' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C*
     C**  If the amount is a valid number, cross validate the actual
     C**  amount. (Only if all the fields used are valid.)
     C**  amount. (Only if all the fields used are valid.)
     C**  amount. (Only if all the fields used are valid.)
     C**  amount. (Only if all the fields used are valid.)
     C                     ELSE                            X***4
     C*                                                                   070080
     C** CONTINUE WITH INTEREST CALCULATION VALIDATION ONLY IF THE        070080
     C** *IN11 (ERROR ON VALUE DATE) INDICATOR IS OFF, OR IF IT IS ON     070080
     C** AND THE ERROR IS ONLY A WARNING ERROR (*IN55 = ON).              070080
     C/COPY WNCPYSRC,MM0089C072
     C           *IN11     IFEQ '0'                        B****5
     C           *IN11     OREQ *ON                                       070080
     C           *IN55     ANDEQ*ON                                       070080
     C************IN12*****ANDEQ'0'                        B****5         070080
     C************IN12*****IFEQ *OFF                       B****5B 070080 072531
     C           *IN13     ANDEQ'0'                        B****5
     C           *IN16     ANDEQ'0'                        B****5
     C           *IN17     ANDEQ'0'                        B****5
     C           *IN19     ANDEQ'0'                        B****5
     C           *IN20     ANDEQ'0'                        B****5
     C           *IN21     ANDEQ'0'                        B****5
     C*
     C** ONLY CONTINUE WITH CALCUALTION IF NO ERROR WITH MATURITY         072531
     C** DATE OR IF THE ERROR IS ONLY A WARNING.                          072531
     C*                                                                   072531
     C           *IN12     IFEQ *OFF                                      072531
     C           *IN12     OREQ *ON                                       072531
     C           *IN55     ANDEQ*ON                                       072531
     C*                                                                   072531
     C**  Call/notice indicator.                                          E16047
     C           @NTCNM    IFEQ -999                       B**7           E16047
     C                     MOVE *BLANKS   IWRK    1        ***7           E16047
     C                     ELSE                            X**7           E16047
     C           @NTCNM    IFEQ *ZEROS                     B***8          E16047
     C                     MOVE 'C'       IWRK             ****8          E16047
     C                     ELSE                            X***8          E16047
     C                     MOVE 'N'       IWRK             ****8          E16047
     C                     END                             E***8          E16047
     C                     END                             E**7           E16047
     C*
     C**  Do not validate if the deal is CALL/NOTICE and a maturity
     C**  date has been entered.
     C***********HKCNTI    IFEQ 'C'                        B******7       E16047
     C***********DDMDAT    ANDEQ*BLANKS                    B******7       E16047
     C***********HKCNTI    OREQ 'N'                        B******7       E16047
     C***********DDMDAT    ANDEQ*BLANKS                    B******7       E16047
     C***********HKCNTI    ORNE 'N'                        B******7       E16047
     C***********HKCNTI    ANDNE'C'                        B******7       E16047
     C           IWRK      IFEQ 'C'                        B******7       E16047
     C           DDMDAT    ANDEQ*BLANKS                    B******7       E16047
     C           IWRK      OREQ 'N'                        B******7       E16047
     C           DDMDAT    ANDEQ*BLANKS                    B******7       E16047
     C           IWRK      ORNE 'N'                        B******7       E16047
     C           IWRK      ANDNE'C'                        B******7       E16047
     C*
     C**  Set up the fields for the execution of the routine to find
     C**  the total interest.
     C***********          Z-ADD@VDYNO    @@BEG            ******6        056095
     C                     Z-ADD@VDYNO    ZZBEG            ******6        056095
     C                     Z-ADD@@AMT     @TOTIN           ******6
     C*
     C           DDTYPE    IFEQ 'CD'                       B******7
     C           DDTYPE    OREQ 'CL'                       B******7
     C           DDTYPE    OREQ 'DL'                       B******7
     C           @NTCNM    IFEQ 0                          B*******8
     C***********@@BEG     ADD  1         @@END            ********8      056095
     C           ZZBEG     ADD  1         ZZEND            ********8      056095
     C                     ELSE                            X*******8
     C           @NTCNM    IFNE -999                       B********9
     C***********@@BEG     ADD  @NTCNM    @@END            *********9     056095
     C           ZZBEG     ADD  @NTCNM    ZZEND            *********9     056095
     C                     ELSE                            X********9
     C***********          Z-ADD@MDYNO    @@END            *********9     056095
     C                     Z-ADD@MDYNO    ZZEND            *********9     056095
     C                     END                             E********9
     C                     END                             E*******8
     C                     ELSE                            X******7
     C*                                                                   S01392
     C* IF FIRST & LAST DAY INTEREST, CALCULATE TO MATURITY DATE + 1      S01392
     C*                                                                   S01392
     C           DDFLID    IFEQ 'Y'                        B*******8      S01392
     C***********@MDYNO    ADD  1         @@END            ********8S01392056095
     C           @MDYNO    ADD  1         ZZEND            ********8      056095
     C                     ELSE                            X*******8      S01392
     C***********          Z-ADD@MDYNO    @@END            ********8S01392056095
     C                     Z-ADD@MDYNO    ZZEND            ********8      056095
     C                     END                             E*******8      S01392
     C*********************Z-ADD@MDYNO    @@END            *******7       S01392
     C                     END                             E******7
     C                     Z-ADDIKAMNP    @@AMT            ******6
     C                     Z-ADDIKINTR    @@RATE           ******6
     C***********          MOVE DDICMT    @@CALC           ******6        056095
     C                     MOVE DDICMT    ZZCALC           ******6        056095
     C                     MOVE DDRDFC    @@RDFC  1        ******6        S01392
     C*********************EXSR MM1007                     *******7       E17051
     C                     EXSR MM1030                     *******7       E17051
     C*
     C**  Find the difference between the input and calculated interest
     C**  - if the difference is greater than 1 currency unit, this is
     C**    an error.
     C/COPY WNCPYSRC,MM0089C060
     C           @TOTIN    SUB  @@INTR    @DIFI            ******6
     C*
     C           @DIFI     IFLT 0                          B******7
     C                     Z-SUB@DIFI     @DIFI            *******7
     C                     END                             E******7
     C*
     C***********CDP       IFEQ 0                          B*******8      E23026
     C***********@DIFI     ANDGT1                          B*******8      E23026
     C***********          MOVE '1'       *IN25            ********8      E23026
     C***********          END                             E*******8      E23026
     C***********                                                         E23026
     C***********CDP       IFEQ 1                          B*******8      E23026
     C***********@DIFI     DIV  10        @WK151    H      ********8      E23026
     C***********@WK151    IFGT 1                          B********9     E23026
     C***********          MOVE '1'       *IN25            *********9     E23026
     C***********          END                             E********9     E23026
     C***********          END                             E*******8      E23026
     C***********                                                         E23026
     C***********CDP       IFEQ 2                          B*******8      E23026
     C***********@DIFI     DIV  100       @WK152    H      ********8      E23026
     C***********@WK152    IFGT 1                          B********9     E23026
     C***********          MOVE '1'       *IN25            *********9     E23026
     C***********          END                             E********9     E23026
     C***********          END                             E*******8      E23026
     C***********                                                         E23026
     C***********CDP       IFEQ 3                          B*******8      E23026
     C***********@DIFI     DIV  1000      @WK153    H      ********8      E23026
     C***********@WK153    IFGT 1                          B********9     E23026
     C***********          MOVE '1'       *IN25            *********9     E23026
     C***********          END                             E********9     E23026
     C***********          END                             E*******8      E23026
     C*                                                                   E23026
     C/COPY WNCPYSRC,MM0089C066
     C           @DIFI     IFGT 0                                         E23026
     C                     MOVE '1'       *IN25                           E23026
     C                     END                                            E23026
     C*                                                                   E23026
     C/COPY WNCPYSRC,MM0089C067
     C*
     C**  If there is a difference in the input and calculated interest
     C**  amounts, format the calculated figure and output it in a message
     C           *IN25     IFEQ '1'                        B*******8
     C                     MOVE '1'       *IN41            ********8
     C*****                Z-ADDCDP       @@QECN           ********8      S01194
     C                     Z-ADDA6NBDP    @@QECN           ********8      S01194
     C                     Z-ADD@@INTR    @@AMTW           ********8
     C                     EXSR ZA0920                     ********8
     C                     MOVE *BLANKS   @DATA            ********8
     C                     MOVEL@@AMTD    @DATA            ********8
     C                     MOVEL'MMM0453' @MSGID           ********8
     C                     CALL 'ZA0440'                   ********8
     C                     PARM           @MSGID           ********8
     C                     PARM           @DATA            ********8
     C                     END                             E*******8
     C                     END                             E******7
     C/COPY WNCPYSRC,MM0089C091
     C                     END                             E*****6
     C                     ENDIF                           E****5B        070080
     C                     END                             E****5
     C/COPY WNCPYSRC,MM0089C092
     C                     END                             E***4
     C/COPY WNCPYSRC,MM0089C061
     C                     END                             E**3
     C/COPY WNCPYSRC,MM0089C062
     C                     END                             E*2
     C                     END                             E1             E17603
     C*
     C**  If the amount is valid, set up the numeric amount on the
     C**  Standard Deal format.
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C107                                           S01408
     C*                                                                   S01408
     C           *IN11     IFEQ '0'                        B1
     C           *IN12     ANDEQ'0'                        B1
     C           *IN13     ANDEQ'0'                        B1
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C108                                           S01408
     C*                                                                   S01408
     C           *IN16     ANDEQ'0'                        B1
     C           *IN17     ANDEQ'0'                        B1
     C           *IN19     ANDEQ'0'                        B1
     C           *IN20     ANDEQ'0'                        B1
     C           *IN25     ANDEQ'0'                        B1
     C***********DDACTN    ANDEQ'I'                        B1       E23044S01434
     C           DDACTN    IFEQ 'I'                                       S01434
     C           DDACTN    OREQ 'A'                                       S01434
     C           @TERM1    ANDEQ'R'                                       S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C109                                           S01408
     C*                                                                   S01408
     C                     Z-ADD@TOTIN    IKMTTI           *1
     C*********************MOVE @@ALPH    DDTOTI           *1             E18599
     C*********************MOVE @@ALPH    @TOTI            *1             E18599
     C**  Reformat the interest value for display                         E20282
     C                     Z-ADD@TOTIN    @@AMTW           *1             E20282
     C*****************    Z-ADDCDP       @@QECN           *1       E20282S01194
     C                     Z-ADDA6NBDP    @@QECN           *1             S01194
     C                     EXSR ZA0920                     *1             E20282
     C                     MOVE @@AMTD    DDTOTI           *1             E18599
     C                     MOVE @@AMTD    @TOTI            *1             E18599
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C110                                           S01408
     C*                                                                   S01408
     C                     END                             E1             S01434
     C                     END                             E1
     C*                                                                   E17020
     C**  Set up total interest for amended deals. Total interest is      E17020
     C**  added to IKMTTI in #ZJ for authorised deals.                    E17020
     C           DDACTN    IFEQ 'A'                                       E17020
     C           @TERM1    ANDNE'R'                                       S01434
     C                     Z-ADDHKMTTI    IKMTTI                          E17020
     C                     END                                            E17020
     C/COPY WNCPYSRC,MM0089C257
     C*
     C*  *------------------------------------------*
     C*  * Validate Interest Frequency Day in Month *
     C*  *------------------------------------------*
     C*
     C**  The payment day in month is only amendable if the deal is
     C**  complete, and the field is designated as amendable on the
     C**  file MMCDAFLL.
     C***********DDACTN    IFEQ 'A'                         B1      E22903E24202
     C***********@DSTS     ANDNE'A'                         B1      E22903E24202
     C***********HHINTA    ANDEQ'N'                         B1      E22903E24202
     C***********DDTYPE    ANDNE'CD'                        B1      E22903E24202
     C***********DDTYPE    ANDNE'CL'                        B1      E22903E24202
     C***********DDTYPE    ANDNE'DL'                        B1      E22903E24202
     C***********DDIPFQ    ANDNE@IPFQ                       B1      E22903E24202
     C***********DDACTN    IFEQ 'A'                        B1             087551
     C***********@DSTS     ANDNE'C'                        B1             087551
     C***********DDIPDM    ANDNE@IPDM                      B1             087551
     C***********@TERM1    ANDNE'R'                                 S01434087551
     C***********DDACTN    OREQ 'A'                        B1             087551
     C/COPY WNCPYSRC,MM0089C258
     C           DDACTN    IFEQ 'A'                        B1             087551
     C           @DSTS     ANDNE'C'                        B1
     C           DDIPDM    ANDNE@IPDM                      B1
     C           HHINTA    ANDEQ'N'                        B1             097564
     C           @TERM1    ANDNE'R'                                       S01434
     C*                                                                   143523
     C* IF CEU015 is supported, and the deal ccy is an 'in' ccy,          143523
     C*  it is possible to bring forward the maturity date                143523
     C*  in preparation for rolling over to Euros.  If this is done,      143523
     C*  the system will require that interest details do not fall        143523
     C*  after the new maturity date.  In this case, the existing         143523
     C*  interest frequency date in month should be allowed to be         143523
     C*  changed.                                                         143523
     C*                                                                   143523
     C                     MOVEL*BLANKS   @ALLOW  1                       143523
     C           CEU015    IFEQ 'Y'                                       143523
     C           @@ICST    ANDEQ'Y'                                       143523
     C           @NDAT     ANDGTDDMDAT                                    143523
     C           @NDAT     ANDNEDDNDAT                                    143523
     C                     MOVEL'Y'       @ALLOW                          143523
     C                     ENDIF                                          143523
     C*                                                                   143523
     C           DDTYPE    IFNE 'CD'                                      E24202
     C           DDTYPE    ANDNE'CL'                                      E24202
     C           DDTYPE    ANDNE'DL'                                      E24202
     C           @ALLOW    ANDEQ*BLANKS                                   143523
     C                     MOVE @IPDM     DDIPDM           *1
     C                     MOVE '1'       *IN26            *1
     C                     MOVE '1'       *IN41            *1
     C***********@DSTS     IFEQ 'C'                        B*2            087551
     C                     MOVEL'MMM0486' @MSGID           **2
     C***********          ELSE                            X*2            087551
     C***********          MOVEL'MMM0487' @MSGID           **2            087551
     C***********          END                             E*2            087551
     C************         END                             E*2      E22903E29975
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E*2            E29975
     C*
     C                     ELSE                            X1
     C           DDIPFQ    IFEQ 'N'                        B*2            AUS003
     C           DDIPDM    IFNE *BLANKS                    B**3           AUS003
     C                     MOVE '1'       *IN26            ***3           AUS003
     C                     MOVE '1'       *IN41            ***3           AUS003
     C                     MOVEL'MMM0455' @MSGID           ***3           AUS003
     C                     CALL 'ZA0240'                   ***3           AUS003
     C                     PARM           @MSGID           ***3           AUS003
     C                     END                             E**3           AUS003
     C                     ELSE                            X*2            AUS003
     C*                                                                   AUS003
     C*
     C**  If the interest frequency day in month is not blank, and is
     C**  not an integer between 00 and 31 it is an error.
     C           DDIPDM    IFNE *BLANKS                    B*2
     C                     TESTN          DDIPDM     6263  **2
     C                     MOVE DDIPDM    @TEST            **2
     C                     TESTZ          @TEST          73**2
     C*
     C           *IN62     IFEQ '1'                        B**3
     C           *IN73     ANDEQ'1'                        B**3
     C           *IN73     OREQ '1'                        B**3
     C           *IN63     ANDEQ'1'                        B**3
     C                     MOVE DDIPDM    @WK20            ***3
     C           @WK20     IFLT 0                          B***4
     C           @WK20     ORGT 31                         B***4
     C                     MOVE '1'       *IN26            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0455' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C           *IN62     IFEQ '0'                        B**3
     C           *IN63     ANDEQ'0'                        B**3
     C           *IN73     OREQ '0'                        B**3
     C                     MOVE '1'       *IN26            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0455' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C*
     C**  If the interest frequency day in month is not blank, and the
     C**  interest frequency is blank, this is an error.
     C           DDIPFQ    IFEQ *BLANKS                    B**3
     C                     MOVE '1'       *IN26            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0456' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E*2            AUS003
     C*
     C**  If the next interest date is not blank and the interest
     C**  payment day in month is blank or '00', set the day in month
     C*************  to the days part of the DDMMYY format next interest d
     C** to the days part of the value date
     C/COPY WNCPYSRC,MM0089C292
     C           DDNDAT    IFNE *BLANKS                    B*2
     C           DDIPFQ    ANDNE*BLANKS                    B*2
     C           *IN24     ANDEQ'0'                        B*2
     C           DDIPDM    IFEQ *BLANKS                    B**3
     C           DDIPDM    OREQ '00'                       B**3
     C           DDIPFQ    ANDNE*BLANK                     B**3
     C***********          MOVE DDVDAT    @@DTOU           ***3           052292
     C                     MOVE DDNDAT    @@DTOU           ***3           052292
     C*****      DATF      IFEQ 'D'                        B***4          S01194
     C           BJDFIN    IFEQ 'D'                        B***4          S01194
     C                     MOVE @@DAT1    DDIPDM           ****4
     C                     MOVE @@DAT1    @IPDM            ****4
     C                     ELSE                            X***4
     C                     MOVE @@DAT2    DDIPDM           ****4
     C                     MOVE @@DAT2    @IPDM            ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C293
     C                     END                             E1
     C*
     C*  *----------------------------*
     C*  * Validate Taxable Indicator *
     C*  *----------------------------*
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP87                                           S01408
     C*                                                                   S01408
     C*                                                                   S01383
     C** IF BRT SAR IS INSTALLED                                          S01383
     C*                                                                   S01383
     C           S01383    IFEQ 'Y'                        B0             S01383
     C*                                                                   S01383
     C**  If the taxable indicator does not have the value 'Y','N', 'X'   S01383
     C*   or blank, it is an error.                                       S01383
     C*                                                                   S01383
     C           DDMTAX    IFNE *BLANK                     B1             S01383
     C           DDMTAX    ANDNE'Y'                        B1             S01383
     C           DDMTAX    ANDNE'N'                        B1             S01383
     C           DDMTAX    ANDNE'X'                        B1             S01383
     C           CRE007    ANDNE'Y'                        B1             CRE007
     C                     MOVE '1'       *IN28            *1             S01383
     C                     MOVE '1'       *IN41            *1             S01383
     C                     MOVEL'MMM0590' @MSGID           *1             S01383
     C                     CALL 'ZA0240'                   *1             S01383
     C                     PARM           @MSGID           *1             S01383
     C*                                                                   S01383
     C**  If customer and deal type are valid,                            S01383
     C*                                                                   S01383
     C                     ELSE                            X1             S01383
     C           *IN10     IFEQ '0'                        B*2            S01383
     C           *IN03     ANDEQ'0'                        B*2            S01383
     C           DDTYPE    ANDNE*BLANKS                    B*2            S01383
     C           DDCUST    ANDNE*BLANKS                    B*2            S01383
     C*                                                                   S01383
     C**  If deal type is IT, TD or CD,                                   S01383
     C*                                                                   S01383
     C           DDTYPE    IFEQ 'IT'                       B**3           S01383
     C           DDTYPE    OREQ 'TD'                       B**3           S01383
     C           DDTYPE    OREQ 'CD'                       B**3           S01383
     C*                                                                   S01383
     C           IKCNUM    CHAINSDCBRTL1             65    ***3           S01383
     C*                                                                   S01383
     C           *IN65     IFEQ '1'                        B***4          S01383
     C           XRECI     ORNE 'D'                        B***4          S01383
     C                     MOVE '1'       *IN28            ****4          S01383
     C                     MOVE '1'       *IN41            ****4          S01383
     C                     MOVEL'MMM0591' @MSGID           ****4          S01383
     C                     CALL 'ZA0240'                   ****4          S01383
     C                     PARM           @MSGID           ****4          S01383
     C                     END                             E***4          S01383
      *                                                                   CRE007
      **  If the Account Holder Type is 'R' and the taxable indicator     CRE007
      **  does not have the value 'N' or 'X', it is an error.             CRE007
      *                                                                   CRE007
     C           ACHLRT    IFEQ 'R'                                       CRE007
      *                                                                   CRE007
     C           DDMTAX    IFNE *BLANK                                    CRE007
     C           DDMTAX    ANDNE'X'                                       CRE007
     C           DDMTAX    ANDNE'N'                                       CRE007
     C                     MOVE '1'       *IN28                           CRE007
     C                     MOVE '1'       *IN41                           CRE007
     C                     MOVEL'MMM0694' @MSGID                          CRE007
     C                     CALL 'ZA0240'                                  CRE007
     C                     PARM           @MSGID                          CRE007
     C                     ENDIF                                          CRE007
      *                                                                   CRE007
     C                     ELSE                                           CRE007
      *                                                                   CRE007
      **  If the taxable indicator does not have the value 'Y','N', 'X'   CRE007
      **  or blank, it is an error.                                       CRE007
      *                                                                   CRE007
     C           DDMTAX    IFNE *BLANK                     B***4          CRE007
     C           DDMTAX    ANDNE'Y'                        ****4          CRE007
     C           DDMTAX    ANDNE'N'                        ****4          CRE007
     C           DDMTAX    ANDNE'X'                        ****4          CRE007
     C                     MOVE '1'       *IN28            ****4          CRE007
     C                     MOVE '1'       *IN41            ****4          CRE007
     C                     MOVEL'MMM0590' @MSGID           ****4          CRE007
     C                     CALL 'ZA0240'                   ****4          CRE007
     C                     PARM           @MSGID           ****4          CRE007
     C                     ENDIF                           E***4          CRE007
     C*                                                                   S01383
     C**  Error if deal tax indicator is Y and customer                   S01383
     C**  is not liable for BRT                                           S01383
     C*                                                                   S01383
     C           DDMTAX    IFEQ 'Y'                        B***4          S01383
     C           TAXIND    IFEQ 'X'                        B****5         S01383
     C           TAXIND    OREQ 'N'                        *****5         S01383
     C                     MOVE '1'       *IN28            *****5         S01383
     C                     MOVE '1'       *IN41            *****5         S01383
     C                     MOVEL'MMM0592' @MSGID           *****5         S01383
     C                     CALL 'ZA0240'                   *****5         S01383
     C                     PARM           @MSGID           *****5         S01383
     C                     ELSE                            X****5         S01383
     C                     MOVE DDMTAX    @MTAX            *****5         S01383
     C                     END                             E****5         S01383
     C                     END                             E***4          S01383
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C119                                           S01408
     C*                                                                   S01408
     C*                                                                   S01383
     C**  Error if deal tax indicator is N and customer tax indicator     S01383
     C**  is L or P.                                                      S01383
     C*                                                                   S01383
     C           DDMTAX    IFEQ 'N'                        B***4          S01383
     C           TAXIND    IFEQ 'L'                        B****5         S01383
     C           TAXIND    OREQ 'P'                        *****5         S01383
     C                     MOVE '1'       *IN28            *****5         S01383
     C                     MOVE '1'       *IN41            *****5         S01383
     C                     MOVEL'MMM0593' @MSGID           *****5         S01383
     C                     CALL 'ZA0240'                   *****5         S01383
     C                     PARM           @MSGID           *****5         S01383
     C                     ELSE                            X****5         S01383
     C                     MOVE DDMTAX    @MTAX            *****5         S01383
     C                     END                             E****5         S01383
     C                     END                             E***4          S01383
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C120                                           S01408
     C*                                                                   S01408
     C*                                                                   S01383
     C**  Warning message if deal tax indicator is X and                  S01383
     C**  customer is BRT liable.                                         S01383
     C*                                                                   S01383
     C***********DDMTAX    IFEQ 'X'                        B***4   S01383 047780
     C***********          MOVE DDMTAX    @MTAX            ****4   S01383 047780
     C           TAXIND    IFEQ 'L'                        B****5         S01383
     C           TAXIND    OREQ 'P'                        *****5         S01383
     C           *INL1     IFEQ '0'                        B****6         E50108
     C           DDMTAX    ANDEQ'X'                                       047780
     C                     MOVE DDMTAX    @MTAX                           047780
     C                     MOVE '1'       *IN28            *****5         S01383
     C                     MOVE '1'       *IN55            *****5         S01383
     C***********          MOVEL'MMM0594' @MSGID           *****5  S01383 047780
     C                     MOVEL'MMM1050' @MSGID           *****5         047780
     C/COPY WNCPYSRC,MM0089C338
     C                     CALL 'ZA0240'                   *****5         S01383
     C                     PARM           @MSGID           *****5         S01383
     C/COPY WNCPYSRC,MM0089C339
     C                     END                             E***6          E50108
     C*                                                                   047780
     C                     ELSE                                           047780
     C*                                                                   047780
     C** Error message if deal tax indicator is not 'N' or blank          047780
     C** and customer is not liable to BRT. (Applied fix 044539.)         047780
     C*                                                                   047780
     C           DDMTAX    IFNE *BLANK                                    047780
     C           DDMTAX    ANDNE'N'                                       047780
     C                     MOVE '1'       *IN28                           047780
     C                     MOVE '1'       *IN41                           047780
     C                     MOVEL'MMM0594' @MSGID                          047780
     C                     CALL 'ZA0240'                                  047780
     C                     PARM           @MSGID                          047780
     C                     ELSE                                           047780
     C                     MOVE 'N'       DDMTAX                          047780
     C                     MOVE 'N'       @MTAX                           047780
     C                     END                             E****5         S01383
     C                     END                             E***4          S01383
      *                                                                   CRE007
     C                     ENDIF                                          CRE007
     C*                                                                   S01383
     C**  Default taxable indicator                                       S01383
     C*                                                                   S01383
     C           DDMTAX    IFEQ *BLANK                     B***4          S01383
     C           TAXIND    IFEQ 'L'                        B****5         S01383
     C           TAXIND    OREQ 'P'                        *****5         S01383
     C                     MOVE 'Y'       DDMTAX           *****5         S01383
     C                     MOVE 'Y'       @MTAX            *****5         S01383
     C                     ELSE                            X****5         S01383
     C                     MOVE TAXIND    DDMTAX           *****5         S01383
     C                     MOVE TAXIND    @MTAX            *****5         S01383
     C                     END                             E****5         S01383
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C118                                           S01408
      *                                                                   CRE007
      ** If Account holder type is 'R' default tax indicator to 'N'       CRE007
      *                                                                   CRE007
     C           ACHLRT    IFEQ 'R'                        B***5          CRE007
     C                     MOVE 'N'       DDMTAX                          CRE007
     C                     MOVE 'N'       @MTAX                           CRE007
      *                                                                   CRE007
     C                     ELSE                            X***5          CRE007
      *                                                                   CRE007
      ** If Deal is a Time Deposit (TD) and Principal amount is           CRE007
      ** >= 50,000 GBP default tax indicator to 'X'.                      CRE007
      *                                                                   CRE007
     C           CRE007    IFEQ 'Y'                        B***6          CRE007
      *                                                                   CRE007
     C           DDTYPE    IFEQ 'TD'                       B***7          CRE007
     C           TAXIND    ANDEQ'L'                                       CRE007
     C           DDTYPE    OREQ 'TD'                                      CRE007
     C           TAXIND    ANDEQ'P'                                       CRE007
      *                                                                   CRE007
      ** Access GBP curreny details                                       CRE007
      *                                                                   CRE007
     C                     MOVE IKAMNP    ULAMCO                          CRE007
      *                                                                   CRE007
     C                     CALL 'AOCURRR0'                                CRE007
     C                     PARM '*DBERR ' @RTCD   7                       CRE007
     C                     PARM '*KEY   ' @OPTN   7                       CRE007
     C                     PARM           BJLCCY                          CRE007
     C           SDCURR    PARM SDCURR    DSSDY                           CRE007
      *                                                                   CRE007
     C                     MOVE BJLCCY    ZCCYO   3                       CRE007
     C                     Z-ADDA6SPRT    ULRATO 138                      CRE007
     C                     Z-ADDA6NBDP    ZCDPO   10                      CRE007
     C                     MOVE A6MDIN    ULZMDO  1                       CRE007
      *                                                                   CRE007
      ** If Deal currency is not GBP then Access Deal CCY details         CRE007
      *                                                                   CRE007
     C           DDCCY     IFNE BJLCCY                     B***8          CRE007
      *                                                                   CRE007
     C                     CALL 'AOCURRR0'                                CRE007
     C                     PARM '*DBERR ' @RTCD   7                       CRE007
     C                     PARM '*KEY   ' @OPTN   7                       CRE007
     C                     PARM           DDCCY                           CRE007
     C           SDCURR    PARM SDCURR    DSSDY                           CRE007
      *                                                                   CRE007
     C                     Z-ADDIKAMNP    ZAMTCI 150                      CRE007
     C                     MOVE DDCCY     ZCCYI   3                       CRE007
     C                     Z-ADDA6SPRT    ULRATI 138                      CRE007
     C                     Z-ADDA6NBDP    ZCDPI   10                      CRE007
     C                     MOVE A6MDIN    ULZMDI  1                       CRE007
      *                                                                   CRE007
      ** Initialize Cross Exchange Rate to Zero                           CRE007
     C                     Z-ADD*ZEROS    ZEXCH                           CRE007
      *                                                                   CRE007
      ** If Mult/Div Indic. for 'FROM' is = Mult/Div Indic for 'TO'       CRE007
      ** Indic and Spot Rate for 'TO' Currency (ZRATET) is not = Zero     CRE007
     C           ULZMDI    IFEQ ULZMDO                                    CRE007
     C           ULRATO    ANDNE*ZEROS                                    CRE007
     C           ULRATI    DIV  ULRATO    ZEXCH                           CRE007
      *                                                                   CRE007
      ** If Milt/Div Indic for 'FROM' is Not = Mult/Div Indic For 'TO'    CRE007
      ** Indic or Spot Rate for 'TO' Currency (ULRATO) is = Zero          CRE007
     C                     ELSE                                           CRE007
     C           ULRATI    MULT ULRATO    ZEXCH                           CRE007
     C                     END                                            CRE007
      *                                                                   CRE007
      ** Move Mult/Div Indic for 'FROM' Currency to Cross Rate Mult/Div   CRE007
      ** Indicator (ZMD)                                                  CRE007
     C                     MOVE ULZMDI    ZMD                             CRE007
      *                                                                   CRE007
      ** Convert Amount                                                   CRE007
     C                     EXSR ZCONV                                     CRE007
      *                                                                   CRE007
     C                     MOVE ZAMTCO    ULAMCO 152                      CRE007
      *                                                                   CRE007
     C                     ENDIF                           E***8          CRE007
      *                                                                   CRE007
      ** Determine if Principal Amount is >= 50,000 in GBP                CRE007
      *                                                                   CRE007
     C           ULAMCO    IFGE 50000                      B***8          CRE007
     C                     MOVE 'X'       DDMTAX                          CRE007
     C                     MOVE 'X'       @MTAX                           CRE007
     C                     ENDIF                           E***8          CRE007
      *                                                                   CRE007
     C                     ENDIF                           E***7          CRE007
     C                     ENDIF                           E***6          CRE007
     C                     ENDIF                           E***5          CRE007
     C*                                                                   S01408
     C                     END                             E***4          S01383
     C*                                                                   S01383
     C**  If deal type is not IT, TD or CD,                               S01383
     C**  the Taxable Indicator should only be blank                      S01383
     C*                                                                   S01383
     C                     ELSE                            X**3           S01383
     C*                                                                   S01383
     C           DDMTAX    IFEQ *BLANK                     B***4          S01383
     C                     MOVE *BLANK    DDMTAX           ****4          S01383
     C                     MOVE *BLANK    @MTAX            ****4          S01383
     C                     ELSE                            X***4          S01383
     C                     MOVE '1'       *IN28            ****4          S01383
     C                     MOVE '1'       *IN41            ****4          S01383
     C                     MOVEL'MMM0595' @MSGID           ****4          S01383
     C                     CALL 'ZA0240'                   ****4          S01383
     C                     PARM           @MSGID           ****4          S01383
     C                     END                             E***4          S01383
     C                     END                             E**3           S01383
     C                     END                             E*2            S01383
     C                     END                             E1             S01383
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CVS4                                           S01408
     C*                                                                   S01408
     C*                                                                   S01383
     C** ELSE BRT SAR IS NOT INSTALLED                                    S01383
     C*                                                                   S01383
     C                     ELSE                            X0             S01383
     C/COPY WNCPYSRC,MM0089C444
     C*                                                                   S01383
     C**  The taxable indicator is only amendable if the deal is
     C**  complete.
     C           DDACTN    IFEQ 'A'                        B1
     C           @DSTS     ANDNE'C'                        B1
     C           DDMTAX    ANDNE@MTAX                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C239
     C                     MOVE @MTAX     DDMTAX           *1
     C                     MOVE '1'       *IN28            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0493' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C                     ELSE                            X1
      *                                                                                       CDL013
      *** if CAR CDL013 is installed.                                                         CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
     C                     MOVE *BLANKS   @MSGF  10                                           CDL013
     C                     MOVE *BLANKS   @MSGID 10                                           CDL013
     C                     MOVEL'SDUSRMSG'@MSGF                                               CDL013
      *                                                                                       CDL013
      *** if taxable indicator is BLANK set to Customer details value.                        CDL013
     C           DDMTAX    IFEQ *BLANKS                                                       CDL013
     C                     MOVE BBTAIN    DDMTAX                                              CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** if taxable ind is NOT within the range 0-9 - then ERROR.                            CDL013
     C           DDMTAX    IFNE '0'                                                           CDL013
     C           DDMTAX    ANDNE'1'                                                           CDL013
     C           DDMTAX    ANDNE'2'                                                           CDL013
     C           DDMTAX    ANDNE'3'                                                           CDL013
     C           DDMTAX    ANDNE'4'                                                           CDL013
     C           DDMTAX    ANDNE'5'                                                           CDL013
     C           DDMTAX    ANDNE'6'                                                           CDL013
     C           DDMTAX    ANDNE'7'                                                           CDL013
     C           DDMTAX    ANDNE'8'                                                           CDL013
     C           DDMTAX    ANDNE'9'                                                           CDL013
     C                     MOVEL'XXW0101' @MSGID                                              CDL013
     C                     CALL 'ZA0340'                                                      CDL013
     C                     PARM           @MSGF                                               CDL013
     C                     PARM           @MSGID                                              CDL013
     C                     MOVE '1'       *IN28                                               CDL013
     C                     MOVE '1'       *IN41                                               CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** If customer and deal type are valid,                                                CDL013
     C           DDTYPE    IFNE *BLANKS                                                       CDL013
     C           DDCUST    ANDNE*BLANKS                                                       CDL013
     C           *IN10     ANDEQ'0'                                                           CDL013
     C           *IN03     ANDEQ'0'                                                           CDL013
      *                                                                                       CDL013
      *** If customer type is 'N' and Tax Ind NE 0 - ERROR                                    CDL013
     C           BBCSTY    IFEQ 'N'                                                           CDL013
     C           DDMTAX    ANDNE'0'                                                           CDL013
     C                     MOVEL'XXW0100' @MSGID                                              CDL013
     C                     CALL 'ZA0340'                                                      CDL013
     C                     PARM           @MSGF                                               CDL013
     C                     PARM           @MSGID                                              CDL013
     C                     MOVE '1'       *IN28                                               CDL013
     C                     MOVE '1'       *IN41                                               CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** If deal type not 'IT', 'TD' or 'CD' and Tax Ind NE 0 - ERROR                        CDL013
     C           DDTYPE    IFNE 'IT'                                                          CDL013
     C           DDTYPE    ANDNE'TD'                                                          CDL013
     C           DDTYPE    ANDNE'CD'                                                          CDL013
     C           DDMTAX    ANDNE'0'                                                           CDL013
     C                     MOVEL'XXW0102' @MSGID                                              CDL013
     C                     CALL 'ZA0340'                                                      CDL013
     C                     PARM           @MSGF                                               CDL013
     C                     PARM           @MSGID                                              CDL013
     C                     MOVE '1'       *IN28                                               CDL013
     C                     MOVE '1'       *IN41                                               CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
     C                     ENDIF                                                              CDL013
     C                     ENDIF                                                              CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** otherwise perform Original validation.                                              CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP44                                           S01408
     C*                                                                   S01408
     C*
     C**  If the taxable indicator does not have the value 'Y','N' or
     C**  blank, it is an error.
     C           DDMTAX    IFNE *BLANK                     B*2
     C           DDMTAX    ANDNE'Y'                        B*2
     C           DDMTAX    ANDNE'N'                        B*2
     C                     MOVE '1'       *IN28            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0457' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C****If*customer*is*not*taxable*(Bit*1*of*CMIN*is*off.),*or*the***   S01194
     C**  If customer is not taxable (BBBOST on SDCUSTPD), or the         S01194
     C**  deal type is not IT,TD or CD, and the taxable indicator is Y
     C**  (Only check if both the customer and deal type are non-blank
     C**  and valid.)
     C                     ELSE                            X*2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CPG7                                           S01408
     C*                                                                   S01408
     C           *IN10     IFEQ '0'                        B**3
     C           *IN03     ANDEQ'0'                        B**3
     C           DDTYPE    ANDNE*BLANKS                    B**3
     C           DDCUST    ANDNE*BLANKS                    B**3
     C*****                TESTB'1'       CMIN       65    ***3           S01194
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C           BBTAIN    IFNE 'Y'                        B**3           S01194
     C           DDMTAX    ANDEQ'Y'                        B***4
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C100                                           S01408
     C*                                                                   S01408
     C                     MOVE '1'       *IN28            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0459' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     ELSE                            X***4
     C/COPY WNCPYSRC,MM0089C429
     C           DDTYPE    IFNE 'IT'                       B****5
     C           DDTYPE    ANDNE'TD'                       B****5
     C           DDTYPE    ANDNE'CD'                       B****5
     C           DDMTAX    ANDEQ'Y'                        B****5
     C                     MOVE '1'       *IN28            *****5
     C                     MOVE '1'       *IN41            *****5
     C                     MOVEL'MMM0458' @MSGID           *****5
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C                     END                             E****5
     C/COPY WNCPYSRC,MM0089C430
     C                     END                             E***4
     C                     END                             E**3
     C*
     C****If*customer*is**taxable*(Bit*1*of*CMIN*is*on.),*and*the*deal*   S01194
     C**  If customer is  taxable (BBBOST on SDCUSTPD), and the deal      S01194
     C**  type is IT,TD or CD, and the taxable indicator is blank, set
     C**  the indicator to 'Y'.
     C           *IN10     IFEQ '0'                        B**3
     C           *IN03     ANDEQ'0'                        B**3
     C           DDTYPE    ANDNE*BLANKS                    B**3
     C           DDCUST    ANDNE*BLANKS                    B**3
     C*****                TESTB'1'       CMIN       65    ***3           S01194
     C*****      *IN65     IFEQ '0'                        B***4          S01194
     C           BBTAIN    IFEQ 'Y'                        B***4          S01194
     C           DDMTAX    ANDEQ*BLANK                     B***4
     C/COPY WNCPYSRC,MM0089C431
     C           DDTYPE    IFEQ 'IT'                       B****5
     C           DDTYPE    OREQ 'TD'                       B****5
     C           DDTYPE    OREQ 'CD'                       B****5
     C                     MOVE 'Y'       DDMTAX           *****5
     C                     MOVE 'Y'       @MTAX            *****5
     C/COPY WNCPYSRC,MM0089C380
     C                     END                             E****5
     C/COPY WNCPYSRC,MM0089C432
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP45                                           S01408
     C*                                                                   S01408
     C                     END                             E1
     C                     END                             E0             S01383
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP88                                           S01408
     C*                                                                   S01408
     C*
     C*  *-------------------------------------------*
     C*  * Validate Certificate of Deposit Reference *
     C*  *-------------------------------------------*
     C*
     C**  If the deal type is not CI, and the reference is not blank
     C**  it is an error.
     C           DDTYPE    IFNE 'CI'                       B1
     C           *IN03     ANDNE'1'                        B1
     C           DDCDRF    ANDNE*BLANK                     B1
     C                     MOVE @CDRF     DDCDRF           *1
     C                     MOVE '1'       *IN29            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0460' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E1
     C*
     C*  *-------------------------------------------*
     C*  * Validate Certificate of Deposit Holder    *
     C*  *-------------------------------------------*
     C*
     C**  If the deal type is not CI, and the holder field is not blank
     C**  it is an error.
     C           DDTYPE    IFNE 'CI'                       B1
     C           *IN03     ANDNE'1'                        B1
     C           DDCDCH    ANDNE*BLANK                     B1
     C                     MOVE @CDCH     DDCDCH           *1
     C                     MOVE '1'       *IN30            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0461' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  If the holder field is not blank, continue validation.
     C                     ELSE                            X1
     C           DDCDCH    IFNE *BLANK                     B*2
     C*
     C****Check if the input is numeric.                                  S01194
     C*****                MOVE *BLANKS   @@ALPH           **2            S01194
     C*****                Z-ADD0         @@IDP            **2            S01194
     C*****                Z-ADD6         @@IINT           **2            S01194
     C*****                MOVE DDCDCH    @@ALPH           **2            S01194
     C*****                EXSR ZA0840                     **2            S01194
     C*****                                                               S01194
     C****If ZA0840 returns no errors, the result will be treated         S01194
     C****as a customer number, else it will be a shortname.              S01194
     C*****      @@ERCD    IFEQ 0                          B**3           S01194
     C*****                Z-ADD@@AMT     @CNUM            ***3           S01194
     C*****      @CLTKY    CHAINCLINT                65    ***3           S01194
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C*****      RECI      OREQ '*'                        B***4          S01194
     C*****                MOVE '1'       *IN30            ****4          S01194
     C*****                MOVE '1'       *IN41            ****4          S01194
     C*****                MOVEL'MMM0462' @MSGID           ****4          S01194
     C*****                CALL 'ZA0240'                   ****4          S01194
     C*****                PARM           @MSGID           ****4          S01194
     C*****                END                             E***4          S01194
     C*****                ELSE                            X**3           S01194
     C*****      DDCDCH    CHAINSNAME                65    ***3           S01194
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C*****      RECI      OREQ '*'                        B***4          S01194
     C*****                MOVE '1'       *IN30            ****4          S01194
     C*****                MOVE '1'       *IN41            ****4          S01194
     C*****                MOVEL'MMM0462' @MSGID           ****4          S01194
     C*****                CALL 'ZA0240'                   ****4          S01194
     C*****                PARM           @MSGID           ****4          S01194
     C*****                END                             E***4          S01194
     C*****                END                             E**3           S01194
     C                     CALL 'AOCUSTR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM DDCDCH    @KEY1  10        **2            S01194
     C                     PARM *BLANKS   @KYST   7        **2            S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C***********@KYST     OREQ 'ERROR  '                  ***3     S01194BHF079
     C           @KYST     OREQ '*ERROR '                  ***3           BHF079
     C                     MOVE '1'       *IN30            ***3           S01194
     C                     MOVE '1'       *IN41            ***3           S01194
     C                     MOVEL'MMM0462' @MSGID           ***3           S01194
     C                     CALL 'ZA0240'                   ***3           S01194
     C                     PARM           @MSGID           ***3           S01194
     C                     ELSE                                           E70
     C********   DDCDCH    IFEQ '?'                                   E70 088263
     C                     MOVELDDCDCH    CUS1ST                          088263
     C           CUS1ST    IFEQ '?'                                       088263
     C                     MOVELBBCUST    DDCDCH                          E70
     C                     END                             E**3           E70
     C                     END                             E**3           S01194
     C*
     C**  If no error has so far occurred on the validation of the
     C**  holder, the deal customer is valid, and the action code is
     C**  'I', and the deal customer no. is different to the holder
     C**  customer no., this is an error.
     C           *IN30     IFEQ '0'                        B**3
     C           *IN10     ANDEQ'0'                        B**3
     C           DDCUST    ANDNE*BLANK                     B**3
     C           DDACTN    ANDEQ'I'                        B**3
     C                     MOVELBBCUST    CNUM             ***3           S01194
     C           IKCNUM    IFNE CNUM                       B***4
     C                     MOVE '1'       *IN30            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0463' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  If the field is valid, set up the customer number on the
     C**  Standard Deal format.
     C           *IN30     IFEQ '0'                        B1
     C           DDCDCH    ANDNE*BLANKS                    B1
     C*****                Z-ADDCNUM      IKMCDH           *1             S01194
     C                     MOVELBBCUST    IKMCDH           *1             S01194
     C                     END                             E1
     C*
     C**  If the deal type is 'CI', the action is 'I', and the            E14035
     C**  holder field is blank, set up the holder customer number        E14035
     C**  on the Standard Deal format to be the same as the deal          E14035
     C**  customer number. (Required because CD Held By field is          E14035
     C*   mandatory for MIDAS processing of CDs Issued).                  E14035
     C           *IN30     IFEQ '0'                        B1             E14035
     C           DDTYPE    ANDEQ'CI'                       B1             E14035
     C***********DDACTN    ANDEQ'I'                        B1      E14035 075360
     C           DDCDCH    ANDEQ*BLANKS                    B1             E14035
     C**********           Z-ADDIKCNUM    IKMCDH           *1                         E14035 CSD027A
     C                     MOVE IKCNUM    IKMCDH           *1                                CSD027A
     C                     END                             E1             E14035
     C*
     C*  *--------------------------------------------*
     C*  * Validate Interest Capitalisation Indicator *
     C*  *--------------------------------------------*
     C*
     C**  The interest capitalisation indicator is only amendable if
     C**  the deal is complete, and the field is designated as
     C**  amendable on the file MMCDAFLL.
     C           DDACTN    IFEQ 'A'                        B1
     C           @DSTS     ANDNE'C'                        B1
     C           DDCPTI    ANDNE@CPTI                      B1
     C           @TERM1    ANDNE'R'                                       S01434
     C           DDACTN    OREQ 'A'                        B1
     C           @DSTS     ANDEQ'C'                        B1
     C           DDCPTI    ANDNE@CPTI                      B1
     C           HHINTA    ANDEQ'N'                        B1
     C           @TERM1    ANDNE'R'                                       S01434
     C                     MOVE @CPTI     DDCPTI           *1
     C                     MOVE '1'       *IN27            *1
     C                     MOVE '1'       *IN41            *1
     C           @DSTS     IFEQ 'C'                        B*2
     C                     MOVEL'MMM0488' @MSGID           **2
     C                     ELSE                            X*2
     C                     MOVEL'MMM0489' @MSGID           **2
     C                     END                             E*2
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C                     ELSE                            X1
     C*
     C**  If the interest capitalisation indicator is not blank, or
     C**  'Y',it is an error.
     C           DDCPTI    IFNE *BLANKS                    B*2
     C/COPY WNCPYSRC,MM0089C149
     C           DDCPTI    ANDNE'Y'                        B*2
     C/COPY WNCPYSRC,MM0089C512
     C                     MOVE '1'       *IN27            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0465' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C/COPY WNCPYSRC,MM0089C150
     C*
     C**  If the interest capitalisation indicator is 'Y', and the
     C**  deal type is not CL,DL or CD, it is an error.
     C                     ELSE                            X*2
     C/COPY WNCPYSRC,MM0089C227
     C           *IN03     IFEQ '0'                        B**3
     C           DDTYPE    ANDNE'CL'                       B**3
     C           DDTYPE    ANDNE'DL'                       B**3
     C           DDTYPE    ANDNE'CD'                       B**3
     C           DDCPTI    ANDEQ'Y'                        B**3
     C/COPY WNCPYSRC,MM0089C226
     C                     MOVE '1'       *IN27            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0466' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C/COPY WNCPYSRC,MM0089C153
     C*                                                                   AUS003
     C           *IN03     IFEQ '0'                        B**3           AUS003
     C           DDCPTI    ANDEQ'Y'                        B**3           AUS003
     C           DDIPFQ    ANDEQ'N'                        B**3           AUS003
     C                     MOVE '1'       *IN27            ***3           AUS003
     C                     MOVE '1'       *IN41            ***3           AUS003
     C                     MOVEL'MMM0466' @MSGID           ***3           AUS003
     C                     CALL 'ZA0240'                   ***3           AUS003
     C                     PARM           @MSGID           ***3           AUS003
     C                     END                             E**3           AUS003
     C/COPY WNCPYSRC,MM0089C093
     C*                                                                   AUS003
     C                     END                             E*2
     C                     END                             E1
     C*                                                                   S01392
     C*  *--------------------------------------*                         S01392
     C*  * Validate Front Up Interest Indicator *                         S01392
     C*  *--------------------------------------*                         S01392
     C*                                                                   S01392
     C*                                                                   S01392
     C**  The Front Up Indicator is only amendable if the deal is incmplteS01392
     C*                                                                   S01392
     C/COPY WNCPYSRC,MM0089C259
     C           DDACTN    IFEQ 'A'                        B1             S01392
     C           @DSTS     ANDNE'C'                        B1             S01392
     C           DDFUID    ANDNE@FUID                      B1             S01392
     C           @TERM1    ANDNE'R'                                       S01434
     C                     MOVE @FUID     DDFUID           *1             S01392
     C                     MOVE '1'       *IN66            *1             S01392
     C                     MOVE '1'       *IN41            *1             S01392
     C                     MOVEL'MMM0601' @MSGID           *1             S01392
     C                     CALL 'ZA0240'                   *1             S01392
     C                     PARM           @MSGID           *1             S01392
     C*                                                                   S01392
     C                     ELSE                            X1             S01392
     C*                                                                   S01391
     C** Default if the Japanese Sub Module is not installed              S01391
     C*                                                                   S01391
     C           S01391    IFNE 'Y'                                       S01391
     C           DDFUID    ANDEQ' '                                       S01391
     C                     MOVE 'N'       DDFUID                          S01391
     C                     END                                            S01391
     C*                                                                   053519
     C** Take the Front Up Indicator on the Deal Sub-Types file as        053519
     C** default upon input.                                              053519
     C*                                                                   053519
     C           DDACTN    IFEQ 'I'                                       053519
     C           DDFUID    ANDEQ*BLANK                                    053519
     C                     MOVE ASFUID    DDFUID                          053519
     C           DDFUID    IFEQ *BLANK                                    053519
     C                     MOVE 'N'       DDFUID                          053519
     C                     END                                            053519
     C                     END                                            053519
     C*                                                                   S01392
     C**  If the Front Up Indicator does not have the value 'Y','N'       S01392
     C**  it is an error.                                                 S01392
     C*                                                                   S01392
     C           DDFUID    IFNE 'Y'                        B*2            S01392
     C           DDFUID    ANDNE'N'                        B*2            S01392
     C                     MOVE '1'       *IN66            **2            S01392
     C                     MOVE '1'       *IN41            **2            S01392
     C                     MOVEL'MMM0602' @MSGID           **2            S01392
     C                     CALL 'ZA0240'                   **2            S01392
     C                     PARM           @MSGID           **2            S01392
     C                     END                                            S01392
     C*                                                                   053519
     C**  As the Front Up Indicator is now defaulted by the system,       053519
     C**  the checking against the Deal Sub-Types file should only be     053519
     C**  done for Input function.                                        053519
     C*                                                                   S01392
     C**  If the Front Up Indicator does not match the value              S01392
     C**  from the Deal Sub-Types file, it is an error.                   S01392
     C** In addition, this checking should not be done if the deal        064243
     C** subtype has not yet been entered.                                064243
     C*                                                                   S01392
     C           DDFUID    IFNE ASFUID                     B*2            S01392
     C           DDACTN    ANDEQ'I'                        B*2            053519
     C           DDSTYP    ANDNE*BLANKS                    B*2            064243
     C/COPY WNCPYSRC,MM0089C472
     C                     MOVE '1'       *IN66            **2            S01392
     C                     MOVE '1'       *IN41            **2            S01392
     C                     MOVEL'MMM0603' @MSGID           **2            S01392
     C                     CALL 'ZA0240'                   **2            S01392
     C                     PARM           @MSGID           **2            S01392
     C                     ELSE                            X*2            S01392
     C*                                                                   S01392
     C** If the Front Up Indicator is 'Y' Check the following:            S01392
     C**  the Deal Type is IT, IP, TD or TI                               S01392
     C**  the Tax Indicator is not 'Y'                                    S01392
     C**  the Interest Payment Frequency is blank                         S01392
     C**  the Next interest Payment Date is blank                         S01392
     C*                                                                   S01392
     C           DDFUID    IFEQ 'Y'                        B**3           S01392
     C           DDTYPE    LOKUPTABTFU                   99*              S01392
     C           *IN99     IFEQ '0'                        B***4          S01392
     C           DDMTAX    OREQ 'Y'                        B***4          S01392
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP86                                           S01408
     C*                                                                   S01408
     C           DDIPFQ    ORNE *BLANK                     B***4          S01392
     C           DDNDAT    ORNE *BLANK                     B***4          S01392
      *                                                                                       CDL013
     C           DDMTAX    ORNE '0'                                                           CDL013
      *                                                                                       CDL013
     C/COPY WNCPYSRC,MM0089C529
     C                     MOVE '1'       *IN66            ****4          S01392
     C                     MOVE '1'       *IN41            ****4          S01392
      *                                                                                       CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
     C                     MOVE *BLANKS   @MSGF  10                                           CDL013
     C                     MOVE *BLANKS   @MSGID 10                                           CDL013
     C                     MOVEL'SDUSRMSG'@MSGF                                               CDL013
     C                     MOVEL'XXW0103' @MSGID                                              CDL013
     C                     CALL 'ZA0340'                                                      CDL013
     C                     PARM           @MSGF                                               CDL013
     C                     PARM           @MSGID                                              CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP89                                           S01408
     C*                                                                   S01408
     C                     MOVEL'MMM0604' @MSGID           ****4          S01392
     C                     CALL 'ZA0240'                   ****4          S01392
     C                     PARM           @MSGID           ****4          S01392
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     END                             E***4          S01392
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP90                                           S01408
      *                                                                   S01408
     C                     END                             E**3           S01392
     C                     END                             E*2            S01392
     C                     END                             E1             S01392
     C/COPY WNCPYSRC,MM0089C260
     C*                                                                   S01392
     C*  *----------------------------------------------*                 S01392
     C*  * Validate First & Last Day Interest Indicator *                 S01392
     C*  *----------------------------------------------*                 S01392
     C*                                                                   S01392
     C**The First & Last Day Ind is only amendable if the deal is incmplteS01392
     C*                                                                   S01392
     C/COPY WNCPYSRC,MM0089C261
     C           DDACTN    IFEQ 'A'                        B1             S01392
     C           @DSTS     ANDNE'C'                        B1             S01392
     C           DDFLID    ANDNE@FLID                      B1             S01392
     C           @TERM1    ANDNE'R'                                       S01434
     C                     MOVE @FLID     DDFLID           *1             S01392
     C                     MOVE '1'       *IN67            *1             S01392
     C                     MOVE '1'       *IN41            *1             S01392
     C                     MOVEL'MMM0605' @MSGID           *1             S01392
     C                     CALL 'ZA0240'                   *1             S01392
     C                     PARM           @MSGID           *1             S01392
     C*                                                                   S01392
     C                     ELSE                            X1             S01392
     C* Default                                                           S01392
     C           DDFLID    IFEQ ' '                                       S01392
     C                     MOVE 'N'       DDFLID                          S01392
     C                     END                                            S01392
     C*                                                                   S01392
     C**  If the First & Last Day Ind does not have the value 'Y','N'     S01392
     C**  it is an error.                                                 S01392
     C*                                                                   S01392
     C           DDFLID    IFNE 'Y'                        B*2            S01392
     C           DDFLID    ANDNE'N'                        B*2            S01392
     C                     MOVE '1'       *IN67            **2            S01392
     C                     MOVE '1'       *IN41            **2            S01392
     C                     MOVEL'MMM0606' @MSGID           **2            S01392
     C                     CALL 'ZA0240'                   **2            S01392
     C                     PARM           @MSGID           **2            S01392
     C                     END                                            S01392
     C*                                                                   S01392
     C**  If the First & Last Day Ind from the Deal Sub-Types file is 'N' S01392
     C**  that input must be 'N'                                          S01392
     C*                                                                   S01392
     C           ASFLID    IFEQ 'N'                        B*2            S01392
     C           DDFLID    ANDNE'N'                        B*2            S01392
     C                     MOVE '1'       *IN67            **2            S01392
     C                     MOVE '1'       *IN41            **2            S01392
     C                     MOVEL'MMM0607' @MSGID           **2            S01392
     C                     CALL 'ZA0240'                   **2            S01392
     C                     PARM           @MSGID           **2            S01392
     C                     ELSE                            X*2            S01392
     C*                                                                   S01392
     C** If the First & Last Day Ind is 'Y' Check the following:          S01392
     C**  the Deal Type is IT, IP, TD or TI                               S01392
     C**  the Tax Indicator is not 'Y'                                    S01392
     C**  the Interest Payment Frequency is blank                         S01392
     C**  the Next interest Payment Date is blank                         S01392
     C*                                                                   S01392
     C           DDFLID    IFEQ 'Y'                        B**3           S01392
     C           DDTYPE    LOKUPTABTFU                   99*              S01392
     C           *IN99     IFEQ '0'                        B***4          S01392
     C           DDMTAX    OREQ 'Y'                        B***4          S01392
     C           DDIPFQ    ORNE *BLANK                     B***4          S01392
     C           DDNDAT    ORNE *BLANK                     B***4          S01392
     C                     MOVE '1'       *IN67            ****4          S01392
     C                     MOVE '1'       *IN41            ****4          S01392
     C                     MOVEL'MMM0608' @MSGID           ****4          S01392
     C                     CALL 'ZA0240'                   ****4          S01392
     C                     PARM           @MSGID           ****4          S01392
     C                     END                             E***4          S01392
     C                     END                             E**3           S01392
     C                     END                             E*2            S01392
     C                     END                             E1             S01392
     C/COPY WNCPYSRC,MM0089C262
     C*                                                                   S01392
     C*  *----------------------------------------*                       S01392
     C*  * Validate Round Down Interest Indicator *                       S01392
     C*  *----------------------------------------*                       S01392
     C*                                                                   S01392
     C** The Round Down Int Ind is not amendable                          S01392
     C*                                                                   S01392
     C           DDACTN    IFEQ 'A'                        B1             S01392
     C           DDRDFC    ANDNE@RDFC                      B1             S01392
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C473
     C                     MOVE @RDFC     DDRDFC           *1             S01392
     C                     MOVE '1'       *IN68            *1             S01392
     C                     MOVE '1'       *IN41            *1             S01392
     C                     MOVEL'MMM0609' @MSGID           *1             S01392
     C                     CALL 'ZA0240'                   *1             S01392
     C                     PARM           @MSGID           *1             S01392
     C*                                                                   S01392
     C                     ELSE                            X1             S01392
     C*                                                                   S01392
     C* If Round Down Int Ind on Currency or Branch is 'N'                S01392
     C* then Round Down Int Ind on deal will be 'N'                       S01392
     C*                                                                   S01392
     C           CYRDFC    IFEQ 'N'                                       s01392
     C           BRRDFC    OREQ 'N'                                       S01392
     C                     MOVE 'N'       DDRDFC                          S01392
     C                     END                                            S01392
     C*                                                                   S01392
     C**  If the Round Down Int Ind does not have the value 'Y','N'       S01392
     C**  it is an error.                                                 S01392
     C*                                                                   S01392
     C           DDRDFC    IFNE 'Y'                        B*2            S01392
     C           DDRDFC    ANDNE'N'                        B*2            S01392
     C                     MOVE '1'       *IN68            **2            S01392
     C                     MOVE '1'       *IN41            **2            S01392
     C                     MOVEL'MMM0610' @MSGID           **2            S01392
     C                     CALL 'ZA0240'                   **2            S01392
     C                     PARM           @MSGID           **2            S01392
     C                     END                             E*2            S01392
     C                     END                             E1             S01392
      *                                                                   CEU015
      **  Initialise In-currency-to-euros-indicator and                   CEU015
      **  Related-deal-currency-workfield                                 CEU015
     C                     MOVE *BLANKS   @ICEUR  1                       CEU015
     C                     MOVE *BLANKS   @RDCCY  3                       CEU015
     C*
     C*  *----------------------------*
     C*  * Validate Rollover Deal No. *
     C*  *----------------------------*
     C*
     C**  The Rollover Deal No. may not be amended.
     C           DDACTN    IFEQ 'A'                        B1
     C/COPY WNCPYSRC,MM0089C078
     C*********  DDDADN    ANDNE@DADN                      B1             BHF364
     C           DDDADN    IFNE @DADN                      B2             BHF364
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CCP2                                           S01408
     C*                                                                   S01408
     C                     MOVE @DADN     DDDADN           *1
     C                     MOVE '1'       *IN09            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0402' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E2             BHF364
     C*                                                                   079765
     C**  If the following fields have changed, it is an error;           079765
     C****Deal*type,*deal*sub-type,*customer,*currency,*branch*code*079765088852
     C**  Deal type, customer, currency, branch code                      088852
     C*                                                                   079765
     C           DDDADN    IFNE *BLANKS                                   079765
     C           DDDADN    ANDNE*ZEROS                                    079765
     C           *IN09     ANDEQ'0'                                       079765
     C           *IN03     ANDEQ'0'                                       079765
     C************IN04     ANDEQ'0'                                 079765088852
     C           *IN10     ANDEQ'0'                                       079765
     C           *IN16     ANDEQ'0'                                       079765
     C           *IN06     ANDEQ'0'                                       079765
     C           HKMTYP    IFNE DDTYPE                                    079765
     C           HKCNUM    ORNE IKCNUM                                    079765
     C***********HKSTYP    ORNE DDSTYP                              079765088852
     C           HKCCY     ORNE DDCCY                                     079765
     C           HKBRCA    ORNE DDBRCA                                    079765
     C                     MOVE '1'       *IN09                           079765
     C                     MOVE '1'       *IN41                           079765
     C                     MOVEL'MMM0186' @MSGID                          079765
     C                     CALL 'ZA0240'                                  079765
     C                     PARM           @MSGID                          079765
     C                     END                                            079765
     C                     END                                            079765
     C*
     C           DDDADN    IFNE *BLANKS                                   103237
     C           DDDADN    ANDNE*ZEROS                                    103237
     C           *IN09     ANDEQ'0'                                       103237
     C           *IN04     ANDEQ'0'                                       103237
     C           HKSTYP    ANDNEDDSTYP                                    103237
     C                     MOVE '1'       *IN09                           103237
     C                     MOVE '1'       *IN55                           103237
     C                     MOVEL'MMM0689' @MSGID                          103237
     C                     CALL 'ZA0240'                                  103237
     C                     PARM           @MSGID                          103237
     C                     END                                            103237
     C*                                                                   103237
     C***********          ELSE                            X1             E25562
     C/COPY WNCPYSRC,MM0089C079
     C                     END                                            E25562
     C*                                                                   E25562
     C           DDACTN    IFEQ 'I'                                       E25562
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CCP3                                           S01408
     C*                                                                   S01408
     C*
     C**  If the deal type is CD,CL or DL, and the rollover deal no.
     C**  is non-blank or zero, it is an error.
     C           *IN03     IFEQ '0'                        B*2
     C           DDTYPE    IFEQ 'CL'                       B**3
     C           DDTYPE    OREQ 'DL'                       B**3
     C           DDTYPE    OREQ 'CD'                       B**3
     C           DDDADN    IFNE *BLANKS                    B***4
     C           DDDADN    ANDNE*ZEROS                     B***4
     C                     MOVE '1'       *IN09            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0182' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  If the rollover deal no. is non-zero, and no validation error
     C**  has occurred, validate the rollover deal no. further.
     C           *IN03     IFEQ '0'                        B*2
     C           *IN09     ANDEQ'0'                        B*2
     C           DDDADN    ANDNE*BLANKS                    B*2
     C           DDDADN    ANDNE*ZEROS                     B*2
     C*
     C**  Chain to the deals file, using the rollover deal no. as a key
     C**  - *IN65 set on if the record is not found.
     C                     MOVE DDDADN    @DLKEY           **2
     C           @DLKEY    CHAINMMDEALLL             65    **2
     C*
     C**  Check that the correct record format has been accessed.
     C           RECORD    IFNE 'MMDELDP0'                 B**3
     C           *IN65     ANDEQ'0'                        B**3
     C                     MOVE '1'       *IN09            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0158' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C/COPY WNCPYSRC,MM0089C514
     C*
     C**  If the correct format was accessed, and no valid record is
     C**  found, it is an error.
     C           *IN09     IFEQ '0'                        B**3
     C           *IN65     IFEQ '1'                        B***4
     C           HKDLTF    ORNE *BLANKS                    B***4
     C           HKDSTS    OREQ 'M'                        B***4          E22412
     C*                                                                   E20611
     C*   If the deal was not found in mode A or X this is because        E20611
     C* it has been dropped from the files after maturity. This is        E20611
     C* not an error so only issue a warning error on this field.         E20611
     C* Also issue warning when deal is found and matured.                E22412
     C           DDACTN    IFNE 'A'                        B***5          E20611
     C           DDACTN    ANDNE'X'                        ****5          E20611
     C                     MOVE '1'       *IN09            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0184' @MSGID           ****4
     C                     ELSE                            X***5          E20611
      *                                                                   E50108
     C/COPY WNCPYSRC,MM0089C155
     C           *INL1     IFEQ '0'                        B***7          E50108
     C                     MOVE '1'       *IN55            ****5          E20611
     C                     MOVEL'MMM1044' @MSGID           ****5          E20611
     C                     END                             E***7          E50108
     C/COPY WNCPYSRC,MM0089C156
      *                                                                   E50108
     C           HKDSTS    IFEQ 'M'                        B***6          E22412
     C           *INL1     ANDEQ'0'                        B***6          E50108
     C                     MOVE '1'       *IN55            ****6          E22412
     C***********          MOVEL'MMM1046' @MSGID           ****6    E22412081888
     C                     END                             E***6          E22412
     C                     END                             E***5          E20611
     C/COPY WNCPYSRC,MM0089C340
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C/COPY WNCPYSRC,MM0089C341
     C                     ELSE                            X***4
     C*
     C**  If the deal has been deleted, it is an error.
     C           HKDDLT    IFEQ 'D'                        B****5
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP27                                           S01408
     C*                                                                   S01408
     C                     MOVE '1'       *IN09            *****5
     C                     MOVE '1'       *IN41            *****5
     C                     MOVEL'MMM0183' @MSGID           *****5
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C                     ELSE                            X****5
     C*
     C**  If the rolled over by deal no. is non-blank and not the
     C**  same as the no. of the deal being maintained, it is an error.
     C           HKROBY    IFNE *BLANKS                    B*****6
     C           HKROBY    ANDNE'000000'                   B*****6        E20609
     C           HKROBY    ANDNEDDDLNO                     B*****6
     C                     MOVE '1'       *IN09            ******6
     C                     MOVE '1'       *IN41            ******6
     C                     MOVEL'MMM0189' @MSGID           ******6
     C                     CALL 'ZA0240'                   ******6
     C                     PARM           @MSGID           ******6
     C                     END                             E*****6
     C*
     C**  If the related deal status code is not 'A' or 'R', it is an
     C**  error.
     C           HKDSTS    IFNE 'A'                        B*****6
     C           HKDSTS    ANDNE'R'                        B*****6
     C                     MOVE '1'       *IN09            ******6
     C                     MOVE '1'       *IN41            ******6
     C                     MOVEL'MMM0254' @MSGID           ******6
     C                     CALL 'ZA0240'                   ******6
     C                     PARM           @MSGID           ******6
     C                     END                             E*****6
      *                                                                   S01486
      ** If screen Portfolio set to default reference for R997            S01486
      ** check against '9997'                                             S01486
     C* Only default WWPTF1 if Portfolio Management Module is on          109628
     C           BGPFMG    IFEQ 'Y'                                       109628
     C           DDPTFR    IFEQ FCR997                                    S01486
     C           I#PORS    ANDNE'B'                                       104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,MM0089C389
     C           I#PORS    OREQ 'B'                                       104058
     C           DDPTFR    ANDNE*BLANKS                                   104058
     C           DDPTFR    ANDEQFCR997                                    104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,MM0089C390
     C                     MOVE '9997'    WWPTF1  4                       S01486
     C                     ELSE                                           S01486
     C                     MOVE DDPTFR    WWPTF1                          S01486
     C                     END                                            S01486
     C                     ELSE                                           109628
     C                     MOVE *BLANKS   WWPTF1                          109628
     C                     MOVE *BLANKS   HKPTFR                          109628
     C                     END                                            109628
     C*
     C*
     C**  If the following fields on the related deal are not the same
     C**  as those on the maintained deal, it is an error;
     C*****Deal*type,*deal*sub-type,*customer,*currency,*branch*code***   S01282
     C**   Deal type, customer, currency, branch code                     S01282
     C**   (either entered code or default code).
     C*****                MOVE HKBRCD    @BRCD1           *****5         S01117
     C                     MOVE HKBRCA    @BRCA1           *****5         S01117
      *                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           DDCCY     ANDEQBKEURO                                    CEU015
      *                                                                   CEU015
      *  access currency file                                             CEU015
      *  (database error handling done in access program)                 CEU015
     C                     CALL 'AOCURRR0'                                CEU015
     C                     PARM '*DBERR ' @RTCD   7                       CEU015
     C                     PARM '*KEY   ' @OPTN   7                       CEU015
     C                     PARM HKCCY     @AJCD   3                       CEU015
     C           SDCURR    PARM SDCURR    DSSDY                           CEU015
      *                                                                   CEU015
     C           A6INCY    IFEQ 'Y'                                       CEU015
     C           A6TPSD    ANDLEBJRDNB                                    CEU015
     C                     MOVE 'Y'       @ICEUR                          CEU015
     C                     MOVE HKCCY     @RDCCY                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C           *IN03     IFEQ '0'                        B*****6
     C           *IN04     ANDEQ'0'                        B*****6
     C           *IN10     ANDEQ'0'                        B*****6
     C           *IN16     ANDEQ'0'                        B*****6
     C           *IN06     ANDEQ'0'                        B*****6
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CVS2                                           S01408
     C*                                                                   S01408
     C*********  HKTYPE    IFNE DDTYPE                     B******7       E12663
     C           HKMTYP    IFNE DDTYPE                                    E12663
     C***********HKSTYP    ORNE DDSTYP                     B******7       S01282
     C           HKCNUM    ORNE IKCNUM                     B******7
     C***********HKSTYP    ORNE DDSTYP                              079765088852
     C           HKCCY     ORNE DDCCY                      B******7
     C           @ICEUR    ANDNE'Y'                                       CEU015
     C           HKPTFR    ORNE WWPTF1                     B******7       S01486
     C*****      @BRCD1    ORNE DDBRCD                     B******7       S01117
     C           @BRCA1    ORNE DDBRCA                     B******7       S01117
     C                     MOVE '1'       *IN09            *******7
     C                     MOVE '1'       *IN41            *******7
     C                     MOVEL'MMM0186' @MSGID           *******7
     C                     CALL 'ZA0240'                   *******7
     C                     PARM           @MSGID           *******7
     C                     END                             E******7
     C*                                                                  S01408
     C           HKSTYP    IFNE DDSTYP                                    103237
     C                     MOVE '1'       *IN09                           103237
     C                     MOVE '1'       *IN55                           103237
     C                     MOVEL'MMM0688' @MSGID                          103237
     C                     CALL 'ZA0240'                                  103237
     C                     PARM           @MSGID                          103237
     C                     END                                            103237
     C*                                                                   103237
     C/COPY WNCPYSRC,MM0089CVS3                                          S01408
     C*                                                                  S01408
     C                     END                             E*****6
     C*
     C**  Format the maturity date of the associated deal.
     C                     Z-ADDHKMDYY    @YEAR            *****5
     C                     Z-ADDHKMDMM    @MNTH            *****5
     C                     Z-ADDHKMDDD    @DAY             *****5
     C           @DATE     IFEQ 0                          B*****6
     C                     MOVE *ZEROS    @MRDYN           ******6
     C                     ELSE                            X*****6
     C***********          Z-ADD@DATE     @@DTIN           ******6        056095
     C***********          EXSR ZA0680                     ******6        056095
     C***********          Z-ADD@@MDNO    @MRDYN           ******6        056095
     C                     Z-ADD@DATE     ZZDTIN           ******6        056095
     C                     EXSR ZDAT10                     ******6        056095
     C                     Z-ADDZZMDNO    @MRDYN           ******6        056095
     C                     END                             E*****6
     C*
     C**  The value date of the maintained deal must be the same as the
     C**  maturity date on the related deal.  If not, it is an error.
     C           @VDYNO    IFNE @MRDYN                     B*****6
     C                     MOVE '1'       *IN09            ******6
     C                     MOVE '1'       *IN41            ******6
     C                     MOVEL'MMM0187' @MSGID           ******6
     C                     CALL 'ZA0240'                   ******6
     C                     PARM           @MSGID           ******6
     C                     END                             E*****6
     C/COPY WNCPYSRC,MM0089C501
     C*
     C**  If none of the fields used are invalid or blank, calculate
     C**  the interest at maturity.
     C** Deal date and Next Interest Date may have a warning error        065460
     C** in which case, still need to calculate interest, otherwise       065460
     C** Rollover deal amount does not get output to DEALSDC              065460
     C*                                                                   065460
     C** Warning message on deal date                                     065460
     C*                                                                   065460
     C           *IN55     IFEQ '1'                        B*****6        065460
     C           *IN05     ANDEQ'1'                        B*****6        065460
     C           *IN02     ANDEQ'0'                        B*****6        065460
     C*********  *IN09     ANDEQ'0'                        B*****6  065460103237
     C           *IN17     ANDEQ'0'                        B*****6        065460
     C           *IN21     ANDEQ'0'                        B*****6        065460
     C           *IN23     ANDEQ'0'                        B*****6        065460
     C           *IN25     ANDEQ'0'                        B*****6        065460
     C           *IN28     ANDEQ'0'                        B*****6        065460
     C*                                                                   065460
     C** Warning message on next interest date                            065460
     C*                                                                   065460
     C           *IN55     OREQ '1'                        B*****6        065460
     C           *IN24     ANDEQ'1'                        B*****6        065460
     C           *IN02     ANDEQ'0'                        B*****6        065460
     C*********  *IN09     ANDEQ'0'                        B*****6  065460103237
     C           *IN17     ANDEQ'0'                        B*****6        065460
     C           *IN21     ANDEQ'0'                        B*****6        065460
     C           *IN23     ANDEQ'0'                        B*****6        065460
     C           *IN25     ANDEQ'0'                        B*****6        065460
     C           *IN28     ANDEQ'0'                        B*****6        065460
     C*                                                                   065460
     C** Warning message on rollover deal number                          103237
     C*                                                                   103237
     C           *IN55     OREQ '1'                        B*****6        103237
     C           *IN09     ANDEQ'1'                        B*****6        103237
     C           *IN02     ANDEQ'0'                        B*****6        103237
     C           *IN17     ANDEQ'0'                        B*****6        103237
     C           *IN21     ANDEQ'0'                        B*****6        103237
     C           *IN23     ANDEQ'0'                        B*****6        103237
     C           *IN25     ANDEQ'0'                        B*****6        103237
     C           *IN28     ANDEQ'0'                        B*****6        103237
     C*                                                                   103237
     C************IN02     IFEQ '0'                        B*****6        065460
     C           *IN02     OREQ '0'                        B*****6        065460
     C           *IN05     ANDEQ'0'                        B*****6
     C           *IN09     ANDEQ'0'                        B*****6
     C           *IN17     ANDEQ'0'                        B*****6
     C           *IN21     ANDEQ'0'                        B*****6
     C           *IN23     ANDEQ'0'                        B*****6
     C           *IN24     ANDEQ'0'                        B*****6
     C           *IN25     ANDEQ'0'                        B*****6
     C           *IN28     ANDEQ'0'                        B*****6
     C*
     C**  Access the record for the associated deal on the DEALS file,
     C**  in order to find the interest to date.  If no valid record is
     C**  found, it is a database error.
     C           @DLKEY    CHAINDEALSDCF             65    ******6
     C*
     C           *IN65     IFEQ '1'                        B******7
     C           RECI      OREQ '*'                        B******7
     C                     MOVE '1'       *INLR            *******7
     C                     MOVE '1'       *INU7            *******7
     C                     MOVE '1'       *INU8            *******7
     C                     MOVE '1'       *INKC            ***************
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVEL'DEALS   'DBFILE           * DBERROR 003 *
     C                     MOVEL@DLKEY    DBKEY            ***************
     C                     MOVE '003'     DBASE            *******7
     C                     OUT  LDA                                       E24039
     C                     EXSR #C                         *******7
     C                     END                             E******7
     C*
     C**  Format the value date of the associated deal.
     C                     Z-ADDHKVDYY    @YEAR            *****5
     C                     Z-ADDHKVDMM    @MNTH            *****5
     C                     Z-ADDHKVDDD    @DAY             *****5
     C           @DATE     IFEQ 0                          B*****6
     C                     MOVE *ZEROS    @@VDAT           ******6
     C                     ELSE                            X*****6
     C***********          Z-ADD@DATE     @@DTIN           ******6        056095
     C***********          EXSR ZA0680                     ******6        056095
     C***********          Z-ADD@@MDNO    @@VDAT           ******6        056095
     C                     Z-ADD@DATE     ZZDTIN           ******6        056095
     C                     EXSR ZDAT10                     ******6        056095
     C                     Z-ADDZZMDNO    @@VDAT           ******6        056095
     C                     END                             E*****6
     C*
     C**  Format the maturity date of the associated deal.
     C                     Z-ADDHKNIYY    @YEAR            *****5
     C                     Z-ADDHKNIMM    @MNTH            *****5
     C                     Z-ADDHKNIDD    @DAY             *****5
     C           @DATE     IFEQ 0                          B*****6
     C                     MOVE *ZEROS    @@NXIP           ******6
     C                     ELSE                            X*****6
     C***********          Z-ADD@DATE     @@DTIN           ******6        056095
     C***********          EXSR ZA0680                     ******6        056095
     C***********          Z-ADD@@MDNO    @@NXIP           ******6        056095
     C                     Z-ADD@DATE     ZZDTIN           ******6        056095
     C                     EXSR ZDAT10                     ******6        056095
     C                     Z-ADDZZMDNO    @@NXIP           ******6        056095
     C                     END                             E*****6
     C*
     C*********************Z-ADDAIPD      @@INTD           ******6        E17710
     C*********************Z-ADDIKMTTI    @@TINT           ******6        E17710
     C*                                                                   CEU003
     C                     MOVEL*BLANKS   WHKCY   3                       CEU003
     C*                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           HKSTCY    ANDNE*BLANKS                                   CEU003
     C           PMERCD    ANDEQ*BLANKS                                   CEU003
     C                     MOVELHKSTCY    WHKCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELHKCCY     WHKCY                           CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     Z-ADDIPRD      @@INTD           ******6        E17710
     C                     Z-ADDHKMTTI    @@TINT           ******6        E17710
     C                     MOVE HKIPFQ    @@INFQ           ******6
     C                     MOVE HKICMT    @@INCM           ******6
     C                     Z-ADDHKAMNP    @@DLAM           ******6
     C                     Z-ADDHKINTR    @@EIRT           ******6
     C                     MOVE HKMTAX    @@MTXI           ******6
     C                     MOVE HKRDFC    @@RDFC           ******6        S01392
     C                     Z-ADDHKDN38    @@DEAL           ******6
     C*****                MOVE HKCCY     @@CCY            ******6        S01195
     C***********          MOVE HKCCY     ZCCY             ******6 S01195 CEU003
     C                     MOVE WHKCY     ZCCY                            CEU003
     C                     MOVE @MRDYN    @@BRMD  50       ******6        S01383
     C*                                                                   S01195
     C**  Check whether loan or deposit in order to set up location       S01195
     C           HKAMNP    IFGT 0                          B******7 DEP   S01195
     C*                                                                   S01195
     C*  Set up location used by ZCHKH - if Our PAY Settlement            S01195
     C*  Method is a nostro then use nostro code and currency to find     S01195
     C*  Nostro Location                                                  S01195
     C           HKPSTM    IFEQ 01                         B*******8      S01195
     C           HKPSTM    OREQ 02                         ********8      S01195
     C           HKPSTM    OREQ 07                         ********8      S01195
     C           HKPSTM    OREQ 08                         ********8      S01195
     C           HKPSTM    OREQ 12                         ********8      S01195
     C*                                                                   S01195
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AONOSTR0'                 ********8      S01194
     C                     PARM '*DBERR ' @RTCD   7        ********8      S01194
     C                     PARM '*KEY   ' @OPTN   7        ********8      S01194
     C                     PARM *BLANKS   @KEYA   6        ********8      S01194
     C***********          PARM HKCCY     @KEYB   3        ********8S01194CEU003
     C                     PARM WHKCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        ********8                   S01194 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        ********8      S01194
     C                     PARM HKPONS    @KEYE   2        ********8      S01194
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01195
     C*********************MOVE A7CSSN    ZLOC             ********8      S01195
     C                     MOVE A7NOSN    ZLOC             ********8      S01195
     C*                                                                   S01195
     C                     ELSE                            X*******8      S01195
     C*****                MOVE *BLANKS   ZLOC             ******S01195   S01195
     C                     MOVE BJSLCD    ZLOC             ********8      LN0023
     C                     END                             E*******8      S01195
     C*                                                                   S01195
     C                     ELSE                            X******7       S01195
     C*                                                                   S01195
     C**  HKAMNP is less than zero so deal is a loan                      S01195
     C*  Set up location used by ZCHKH - if Our receive Settlement        S01195
     C*  Method is a nostro then use nostro code and currency to find     S01195
     C*  Nostro Location                                                  S01195
     C*                                                                   S01195
     C           HKRSTM    IFEQ 01                         B*******8      S01195
     C           HKRSTM    OREQ 02                         ********8      S01195
     C           HKRSTM    OREQ 07                         ********8      S01195
     C           HKRSTM    OREQ 08                         ********8      S01195
     C           HKRSTM    OREQ 12                         ********8      S01195
     C*                                                                   S01195
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AONOSTR0'                 ********8      S01194
     C                     PARM '*DBERR ' @RTCD   7        ********8      S01194
     C                     PARM '*KEY   ' @OPTN   7        ********8      S01194
     C                     PARM *BLANKS   @KEYA   6        ********8      S01194
     C***********          PARM HKCCY     @KEYB   3        ********8S01194CEU003
     C                     PARM WHKCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        ********8                   S01194 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        ********8      S01194
     C                     PARM HKRONS    @KEYE   2        ********8      S01194
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01195
     C*********************MOVE A7CSSN    ZLOC             ********8      S01195
     C                     MOVE A7NOSN    ZLOC             ********8      S01195
     C*                                                                   S01195
     C                     ELSE                            X*******8      S01195
     C*****                MOVE *BLANKS   ZLOC             ********S01195 LN0023
     C                     MOVE BJSLCD    ZLOC             ********8      LN0023
     C                     END                             E*******8      S01195
     C*                                                                   S01195
     C                     END                             E******7       S01195
     C*                                                                   S01195
     C                     EXSR MM1010                     ******6
      *                                                                   CEU015
      **  Initialise rollover-principal-workfield                         CEU015
     C           *LIKE     DEFN IKAMNP    @ROPCL                          CEU015
     C                     Z-ADDIKAMNP    @ROPCL                          CEU015
      *                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           @ICEUR    ANDEQ'Y'                                       CEU015
      *                                                                   CEU015
     C                     CALL 'EU0200'                                  CEU015
     C                     PARM *BLANKS   P@RTCD  7        RETURN CODE    CEU015
     C                     PARM IKAMNP    P@FRAM 183       TRANS AMT      CEU015
     C                     PARM DDCCY     P@FRCY  3        TRANS CCY      CEU015
     C                     PARM HKCCY     P@TOCY  3        SETTL CCY      CEU015
     C                     PARM           P@OUTA 150       SETTL AMT      CEU015
     C                     PARM           P@INTA 183       INT SET AMT    CEU015
     C                     PARM           P@EXRT 159       EXCH RATE      CEU015
     C                     PARM           P@MDIN  1        M/D IND        CEU015
      *                                                                   CEU015
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU015
     C                     MOVE '031'     DBASE            **********     CEU015
     C                     MOVELDDCCY     DBKEY            *  31    *     CEU015
     C                     MOVEL'EU0200'  DBFILE           **********     CEU015
     C                     EXSR *PSSR                                     CEU015
     C                     MOVE *ON       *INKC                           CEU015
     C                     EXSR #C                                        CEU015
     C                     ELSE                                           CEU015
     C                     Z-ADDP@OUTA    @ROPCL                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
     C*                                                                   E12686
     C** SETUP RELATED DEAL FIELD FOR PRINCIPAL AMOUNT                    E12686
     C                     Z-ADDHKAMNP    IKRBAT                          E12686
     C*                                                                   E12686
     C*
     C**  Total up the interest at maturity and the deal amount for
     C**  the associated deal.  If the new deal amount is greater, it
     C**  is an error.
     C**  First, ensure all amounts are +ve.  Then, take into account
     C**  the negative interest indicator.
     C           HKAMNP    IFLT 0                          B******7
     C                     Z-SUBHKAMNP    HKAMNP           *******7
     C                     END                             E******7
     C           @@INMT    IFLT 0                          B******7       E17710
     C                     Z-SUB@@INMT    @@INMT           *******7       E17710
     C                     END                             E******7       E17710
     C*
     C           HKNGVI    IFEQ 'Y'                        B******7
     C           HKAMNP    SUB  @@INMT    @TOTL            *******7
     C                     ELSE                            X******7
     C           HKAMNP    ADD  @@INMT    @TOTL            *******7
     C                     END                             E******7
     C*
     C           DDIPFQ    IFEQ 'N'                                       AUS003
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP80                                           S01408
     C*                                                                   S01408
     C***********IKAMNP    IFGT HKAMNP                             AUS003 CEU015
     C           @ROPCL    IFGT HKAMNP                                    CEU015
     C           S01434    ANDNE'Y'                                       079157
     C                     MOVE '1'       *IN09                           AUS003
     C                     MOVE '1'       *IN41                           AUS003
     C                     MOVEL'MMM0188' @MSGID                          AUS003
     C                     CALL 'ZA0240'                                  AUS003
     C                     PARM           @MSGID                          AUS003
     C                     END                                            AUS003
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP78                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           AUS003
     C*                                                                   AUS003
     C* ERROR IF UP FRONT INTEREST INDICATORS DO NOT MATCH                S01392
     C*    OR IF UP FRONT INDICATOR IS 'Y' AND PRINCIPAL OF ROLLOVER      S01392
     C*       DEAL IS NOT EQUAL TO PRINCIPAL OF ROLLED OVER DEAL          S01392
     C*                                                                   S01392
     C           DDFUID    IFNE HKFUID                                    S01392
     C           DDFUID    OREQ 'Y'                                       S01392
     C***********HKAMNP    ANDNEIKAMNP                             S01392 CEU015
     C           HKAMNP    ANDNE@ROPCL                                    CEU015
     C                     MOVE '1'       *IN09                           S01392
     C                     MOVE '1'       *IN41                           S01392
     C                     MOVEL'MMM0611' @MSGID                          S01392
     C                     CALL 'ZA0240'                                  S01392
     C                     PARM           @MSGID                          S01392
     C                     ELSE                                           S01392
     C*                                                                   S01392
     C* IF NOT UP FRONT INTEREST, PRINCIPAL OF ROLLOVER DEAL              S01392
     C* MUST NOT BE GREATER THAN PRINCIPAL + INTEREST OF ROLLED OVER DEAL S01392
     C*                                                                   S01392
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP77                                           S01408
     C*                                                                   S01408
     C***********IKAMNP    IFGT @TOTL                      B******7       CEU015
     C           @ROPCL    IFGT @TOTL                      B******7       CEU015
     C           S01434    ANDNE'Y'                                       079157
     C                     MOVE '1'       *IN09            *******7
     C                     MOVE '1'       *IN41            *******7
     C                     MOVEL'MMM0188' @MSGID           *******7
     C                     CALL 'ZA0240'                   *******7
     C                     PARM           @MSGID           *******7
     C                     END                                            S01392
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP79                                           S01408
     C*                                                                   S01408
     C                     END                                            AUS003
     C                     END                             E******7
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2            E25562
     C                     END                             E1             E25562
     C*
     C**  Chain to the deals file, if the action code is not I, to set
     C**  up the file fields with the current deal's values.
     C           DDACTN    IFNE 'I'                        B**3
     C/COPY WNCPYSRC,MM0089C080
     C                     MOVE DDDLNO    @DLKEY           ***3
     C           @DLKEY    CHAINMMDEALLL             65    ***3
     C                     END                             E**3
     C***********          END                             E*2            E25562
     C***********          END                             E1             E25562
     C*
     C*  *--------------------------------------------*                   S01117
     C*  * Validate Originating Branch                *                   S01117
     C*  *--------------------------------------------*                   S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,MM0089CP99                                           S01408
     C** If the Originating Branch field is blank                         S01117
      ** Set up the originating branch code field with default value      S01117
      ** only if booking branch not in error                              S01117
     C           DDORBR    IFEQ *BLANKS                    B1             S01117
     C           *IN06     ANDEQ*ZERO                      B1             S01117
     C                     MOVE DDBRCA    DDORBR           *1             S01117
     C                     MOVE DDBRCA    @ORBR            *1             S01117
     C                     END                             E1             S01117
      *                                                                   S01117
      ** Originating branch code validation only when MULTI-BRANCHING     S01117
      ** indicator is on, field is user-validated and there is something  S01117
      *  to validate                                                      S01117
      *                                                                   S01117
     C           @MBIN     IFEQ 'Y'                        B1             S01117
     C*****      OBIN      ANDEQ'Y'                        *1       S01117S01194
     C           BKOBRU    ANDEQ'Y'                        *1             S01194
     C           DDORBR    ANDNE*BLANKS                    *1             S01117
      *                                                                   S01117
      ***Orig. branch code is not amendable for R and A status deals      S01117
      ***and depends what is on file LF/FXCDAFLL for status C             S01117
     C*****      DDACTN    IFEQ 'A'                        B*2            S01117
     C*****      @DSTS     ANDNE'C'                        **2            S01117
     C*****      DDORBR    ANDNE@ORBR                      **2            S01117
     C*****      DDACTN    OREQ 'A'                        **2            S01117
     C*****      @DSTS     ANDEQ'C'                        **2            S01117
     C*****      DDORBR    ANDNE@ORBR                      **2            S01117
     C*****      HHBRCA    ANDEQ'N'                        **2            S01117
     C*****                MOVE @ORBR     DDORBR           **2            S01117
     C*****                MOVE '1'       *IN54            **2            S01117
     C*****                MOVE '1'       *IN41            **2            S01117
     C*****      @DSTS     IFEQ 'C'                        B**3           S01117
     C*****                MOVEL'MMM0380' @MSGID           ***3           S01117
     C*****                ELSE                            X**3           S01117
     C*****                MOVEL'MMM0381' @MSGID           ***3           S01117
     C*****                END                             E**3           S01117
     C*****                CALL 'ZA0240'                   **2            S01117
     C*****                PARM           @MSGID           **2            S01117
     C*****                ELSE                            X*2            S01117
      *                                                                   S01117
     C****Check*that the Branch Code exists on FDBRNCLL.                  S01117
     C****Set*up key for FDBRNCLL.                                        S01117
     C*****                MOVE *BLANKS   @KEY             *1             S01117
     C*****                MOVE '10'      @KEY1            *1             S01117
     C*****                MOVE DDORBR    @KEY             *1             S01117
     C*****      @KEY      CHAINFDBRNCLL             65    *1             S01117
     C*****      *IN65     IFEQ '1'                        B*2            S01117
     C*****      RECI      OREQ '*'                        B*2            S01117
     C**  Check that the Branch Code exists on SDBRCHPD.                  S01117
     C**********           CALL 'AOBRCHR0'                 *1             S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7        *1             S01194
     C                     PARM '*KEY   ' @OPTN   7        *1             S01194
     C                     PARM DDORBR    @DSNB   3        *1             S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                     B*2            S01194
     C                     MOVE '1'       *IN54            **2            S01117
     C                     MOVE '1'       *IN41            **2            S01117
     C                     MOVEL'FXM0289' @MSGID           **2            S01117
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C                     ELSE                            X*2            S01117
      * PROCESS FOR USE OF '?'                                            S01117
     C                     MOVELA8BRCD    DDORBR           **2            S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
      *                                                                   S01117
      ** Validate Orig. branch against user if no errors found so far     S01117
      **  and user validation flag is on                                  S01117
      *                                                                   S01117
     C           *IN54     IFEQ '0'                        B*2            S01117
     C*****      OBUV      ANDEQ'Y'                        B*2      S01117S01194
     C           BKOBUV    ANDEQ'Y'                        B*2            S01194
      *                                                                   S01117
     C                     CALL 'ZVOBU'                    **2            S01117
     C                     PARM DDORBR    ZOBRX   3        **2            S01117
     C                     PARM           ERR     10       **2            S01117
     C           ERR       IFEQ 1                          B**3           S01117
     C                     MOVE '1'       *IN54            ***3           S01117
     C                     MOVE '1'       *IN41            ***3           S01117
     C                     MOVEL'FXM0287' @MSGID           ***3           S01117
     C                     CALL 'ZA0240'                   ***3           S01117
     C                     PARM           @MSGID           ***3           S01117
     C                     END                             E**3           S01117
      *                                                                   S01117
     C           ERR       IFEQ 2                          B**3           S01117
     C                     MOVE '1'       *IN54            ***3           S01117
     C                     MOVE '1'       *IN41            ***3           S01117
     C                     MOVEL'FXM0288' @MSGID           ***3           S01117
     C                     CALL 'ZA0240'                   ***3           S01117
     C                     PARM           @MSGID           ***3           S01117
     C                     END                             E**3           S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
     C                     END                             E1             S01117
      *                                                                   S01117
     C*  *--------------------------------------------*                   S01117
     C*  * Validate Profit Centre                     *                   S01117
     C*  *--------------------------------------------*                   S01117
     C*                                                                   S01117
     C*****      PFUS      IFEQ 'Y'                        B1       S01117S01194
     C           BKPRCU    IFEQ 'Y'                        B1             S01194
      *                                                                   S01117
     C           DDACTN    IFEQ 'A'                        B*2            S01117
     C           DDPRFC    ANDNE@PRFC                      **2            S01117
     C*****      PFCH      ANDNE'Y'                        **2      S01117S01194
     C           BKPRCA    ANDNE'Y'                        **2            S01194
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C474
     C                     MOVE '1'       *IN41            **2            S01117
     C                     MOVE '1'       *IN31            **2            S01117
     C                     MOVEL'FXM4002' @MSGID           **2            S01117
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C                     GOTO #ZI9                       **2            S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
     C***********DDACTN    IFEQ 'A'                        B*2     S01117 LN0558
     C***********DDPRFC    ANDEQ*BLANKS                    **2     S01117 LN0558
     C*****      PCDU      ANDEQ'Y'                        **2      S01117S01194
     C***********BKPCDU    ANDEQ'Y'                        **2     S01194 LN0558
     C***********DDACTN    OREQ 'I'                        **2     S01117 LN0558
     C           DDACTN    IFEQ 'I'                        **2            LN0558
     C           DDPRFC    ANDEQ*BLANKS                    **2            S01117
     C*****      PCDU      ANDEQ'Y'                        **2      S01117s01194
     C           BKPCDU    ANDEQ'Y'                        **2            S01194
     C           *IN10     ANDNE'1'                                       176510
      *                                                                   S01117
      ** MUST SET UP SOME FIELDS                                          S01117
     C*********************MOVE DEPT      @DEPT1           **2     S01117 E270
     C*********************MOVE @USER     @USER1           **2     S01117 E270
     C*********************MOVE CNUM      @CUST1           **2     S01117 E270
     C*********************MOVE BBACOC    @ACOF1           **2     S01117 E270
     C*********************MOVE DDTYPE    @DLTP1           **2     S01117 E270
     C**********           MOVELDDTYPE    TRTP    5        **2                           E270 CSE006
     C                     MOVELDDTYPE    TRTPW   5        **2                                CSE006
     C*                                                            LN0390 176510
     C****If*customer*in*error*ensure*account*officer*parameter*is*LN0390 176510
     C****blank.************************************************** LN0390 176510
     C******     *IN10     IFEQ '1'                        B**3    LN0390 176510
     C******               MOVE *BLANKS   ACOF             ***3    LN0390 176510
     C******               ELSE                            X**3    LN0390 176510
     C******               MOVE BBACOC    ACOF             ***3    LN0390 176510
     C******               MOVE BBCUST    CUST             ***3    LN0390 176510
     C******               END                             E**3    LN0390 176510
     C*                                                                   LN0390
     C                     CALL 'AOPRFMR0'                 **2            S01117
     C                     PARM *BLANKS   @RTCD            **2            S01117
     C*********************PARM           @PORC            **2     S01117 E270
     C                     PARM DDBOKC    BOOK    2        Book Code      E270
     C**********           PARM           TRTP    5        Transacton Type               E270 CSE006
     C                     PARM           TRTPW            Transacton Type                    CSE006
     C                     PARM DDSTYP    SUTP    2        Sub Type       E270
     C                     PARM DDBRCA    BRAN    3        Branch Code    E270
     C                     PARM DEPT      DEPT1   3        Deptment Code  E270
     C                     PARM @USER     USER   10        User           E270
     C*********************PARM BBACOC    ACOF    2        Account OffE270LN0390
     C*********************PARM @CUST     CUST    6        Customer erE270LN0390
     C********             PARM           ACOF    2        Account LN0390 176510
     C********             PARM           CUST    6        CustomerLN0390 176510
     C                     PARM BBACOC    ACOF    2        Account Officer176510
     C                     PARM @CUST     CUST    6        Customer Number176510
     C           DDPRFC    PARM           PRFC    4        Profit CentrE  E270
      *                                                                   S01117
     C***********@RTCD     IFNE *BLANKS                    B**3    S01117 E270
     C           @RTCD     IFEQ '2'                        B**3           E270
     C                     MOVE '1'       *IN41            ***3           S01117
     C                     MOVE '1'       *IN31            ***3           S01117
     C                     MOVEL'FXM4001' @MSGID           ***3           S01117
     C                     CALL 'ZA0240'                   ***3           S01117
     C                     PARM           @MSGID           ***3           S01117
     C                     GOTO #ZI9                       ***3           S01117
     C                     END                             E**3           S01117
      *                                                                   S01117
     C*********************MOVE @PRFC1    DDPRFC           **2     S01117 E270
     C                     END                             E*2            S01117
      *                                                                   S01117
     C           DDACTN    IFEQ 'A'                        B*2            S01117
     C           DDPRFC    ANDNE*BLANKS                    **2            S01117
     C           DDACTN    OREQ 'I'                        **2            S01117
     C           DDPRFC    ANDNE*BLANKS                    **2            S01117
     C           DDACTN    OREQ 'A'                                       120827
     C           BGN0ST    ANDEQ'Y'                                       120827
     C           DDACTN    OREQ 'I'                                       120827
     C           BGN0ST    ANDEQ'Y'                                       120827
     C                     CALL 'AOPRFCR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD            **2            S01194
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM DDPRFC    @WKPR   4        **2            S01194
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C********             MOVE *BLANKS   @K101   4        **2            S01194
     C********             MOVE DDPRFC    @K101            **2            S01194
     C********   @K101     CHAINSDPRFCL1             65    **2            S01194
     C********   *IN65     IFEQ '1'                        B**3           S01194
     C                     MOVE '1'       *IN41            ***3           S01117
     C                     MOVE '1'       *IN31            ***3           S01117
     C                     MOVEL'FXM4001' @MSGID           ***3           S01117
     C                     CALL 'ZA0240'                   ***3           S01117
     C                     PARM           @MSGID           ***3           S01117
     C                     GOTO #ZI9                       ***3           S01117
     C                     ELSE                                           E70
     C                     MOVELDSPCCD    DDPRFC                          E70
     C                     END                             E**3           S01117
     C                     END                             E*2            S01117
      *
     C                     END                             E1             S01117
     C/COPY WNCPYSRC,MM0089C475
     C*                                                                   S01434
     C** *--------------------------------------------*                   S01434
     C** * Validate Automatic Rollover Indicator      *                   S01434
     C** *--------------------------------------------*                   S01434
     C*                                                                   S01434
     C** Only validate if Enhanced Rollovers processing switched on       S01434
     C*                                                                   S01434
     C           S01434    IFEQ 'Y'                                       S01434
     C*                                                                   079775
     C** Not allowed to amend Automatic Rollover Indicator once deal      079775
     C** has been rolled over                                             079775
     C*                                                                   079775
     C           DDACTN    IFEQ 'A'                                       079775
     C           DDAURO    ANDNE@AURO                                     079775
     C           HKROBY    ANDNE*BLANKS                                   079775
     C                     SETON                     8041                 079775
     C                     MOVEL'MMM0654' @MSGID                          079775
     C                     CALL 'ZA0240'                                  079775
     C                     PARM           @MSGID                          079775
     C                     ELSE                                           079775
     C*                                                                   S01434
     C           DDAURO    IFEQ *BLANKS                                   S01434
     C                     MOVEL'N'       DDAURO                          S01434
     C/COPY WNCPYSRC,MM0089C240
     C                     END                                            S01434
     C*                                                                   S01434
     C           DDAURO    IFNE 'N'                                       S01434
     C           DDAURO    ANDNE'Y'                                       S01434
     C                     SETON                     8041                 S01434
     C                     MOVEL'MMM0622' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            079775
     C*                                                                   S01434
     C                     ELSE                                           S01434
     C                     MOVE 'N'       DDAURO                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** *---------------------------------------------*                  S01434
     C** * Validate Interest Paid Separately Indicator *                  S01434
     C** *---------------------------------------------*                  S01434
     C*                                                                   S01434
     C** Only validate if Enhanced Rollovers processing switched on       S01434
     C*                                                                   S01434
     C           S01434    IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C           DDIPDS    IFEQ *BLANKS                                   S01434
     C                     MOVEL'N'       DDIPDS                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C           DDIPDS    IFNE 'N'                                       S01434
     C           DDIPDS    ANDNE'Y'                                       S01434
     C                     SETON                     8141                 S01434
     C                     MOVEL'MMM0623' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C                     ELSE                                           S01434
     C                     MOVE 'N'       DDIPDS                          S01434
     C                     END                                            S01434
     C*                                                                   CEU003
     C** *---------------------------------------*                        CEU003
     C** * Validate Interest Settlement Currency *                        CEU003
     C** *---------------------------------------*                        CEU003
     C*                                                                   CEU003
     C                     MOVE *BLANK    WINCY   1                       CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C*                                                                   CEU003
     C           A6INCY    IFEQ 'Y'                                       CEU003
     C***********@VDYNO    ANDGEA6TPSD                             CEU003 134935
     C           *IN11     ANDEQ'0'                                       CEU003
     C                     MOVE 'Y'       WINCY                           CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C           S01434    IFEQ 'Y'                                       CEU003
     C           DDISCY    ANDNE*BLANKS                                   CEU003
     C           *INL1     ANDEQ'1'                                       CEU003
     C*                                                                   CEU003
     C           DDIPDS    IFEQ 'Y'                                       CEU003
     C*                                                                   CEU003
     C                     CALL 'AOCURRR0'                                CEU003
     C                     PARM *BLANKS   PRTCD                           CEU003
     C                     PARM '*KEY    'POPTN                           CEU003
     C                     PARM DDISCY    PCURR   3                       CEU003
     C           SDCURR    PARM SDCURR    DSSDY                           CEU003
     C*                                                                   CEU003
     C**  Invalid interest settlement ccy                                 CEU003
     C*                                                                   CEU003
     C           PRTCD     IFNE *BLANKS                                   CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN88                    CEU003 136728
     C                     MOVE '1'       *IN57                           136728
     C                     MOVEL'MMM0083' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ELSE                                           CEU003
     C*                                                                   CEU003
     C                     MOVELA6CYCD    DDISCY                          CEU003
     C*                                                                   CEU003
     C           DDCCY     IFEQ BKEURO                                    CEU003
     C*                                                                   CEU003
     C***********@VDYNO    IFLT A6TPSD                             CEU003 134935
     C************IN11     OREQ '1'                                CEU003 134935
     C***********          MOVEL'N'       A6INCY                   CEU003 134935
     C***********          ENDIF                                   CEU003 134935
     C*                                                                   CEU003
     C**  Transaction ccy is Euro but interest settlement ccy is not      CEU003
     C**  an 'In' ccy and part of EMU during value date                   CEU003
     C*                                                                   CEU003
     C           A6INCY    IFNE 'Y'                                       CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN88                    CEU003 136728
     C                     MOVE '1'       *IN57                           136728
     C                     MOVEL'MMM0082' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ELSE                                           CEU003
     C*                                                                   CEU003
     C           WINCY     IFEQ 'Y'                                       CEU003
     C*                                                                   CEU003
     C**  Transaction ccy is an 'In' ccy but interest settlement ccy      CEU003
     C**  is not Euro                                                     CEU003
     C*                                                                   CEU003
     C           DDISCY    IFNE BKEURO                                    CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN88                    CEU003 136728
     C                     MOVE '1'       *IN57                           136728
     C                     MOVEL'MMM0081' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ELSE                                           CEU003
     C*                                                                   CEU003
     C**  Transaction ccy is an 'Out' ccy but interest settlement ccy     CEU003
     C**  is not blank                                                    CEU003
     C*                                                                   CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN88                    CEU003 136728
     C                     MOVE '1'       *IN57                           136728
     C                     MOVEL'MMM0091' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C**  Interest paid separately indicator is not Y but interest        CEU003
     C**  settlement ccy is not blank                                     CEU003
     C*                                                                   CEU003
     C                     ELSE                                           CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN88                    CEU003 136728
     C                     MOVE '1'       *IN57                           136728
     C                     MOVEL'MMM0089' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C** *---------------------------------------------*                  CEU003
     C** * Validate Interest 'In' Currency in Field 72 *                  CEU003
     C** *---------------------------------------------*                  CEU003
     C*                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           S01434    ANDEQ'Y'                                       CEU003
     C           DDII72    ANDNE*BLANKS                                   CEU003
     C           *INL1     ANDEQ'1'                                       CEU003
     C*                                                                   CEU003
     C           DDIPDS    IFEQ 'Y'                                       CEU003
     C*                                                                   CEU003
     C           DDIMET    IFNE '01'                                      CEU003
     C           DDIMET    ANDNE'08'                                      CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN89                    CEU003 136728
     C                     MOVE '1'       *IN34                           136728
     C                     MOVEL'MMM0084' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C           DDTYPE    IFNE 'IT'                                      CEU003
     C           DDTYPE    ANDNE'TD'                                      CEU003
     C           DDTYPE    ANDNE'CD'                                      CEU003
     C           DDTYPE    ANDNE'CI'                                      CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN89                    CEU003 136728
     C                     MOVE '1'       *IN34                           136728
     C                     MOVEL'MMM0092' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     CALL 'AOCURRR0'                                CEU003
     C                     PARM *BLANKS   PRTCD                           CEU003
     C                     PARM '*KEY    'PRTCD                           CEU003
     C                     PARM DDII72    PCURR                           CEU003
     C           SDCURR    PARM SDCURR    DSSDY                           CEU003
     C*                                                                   CEU003
     C           PRTCD     IFNE *BLANKS                                   CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN89                    CEU003 136728
     C                     MOVE '1'       *IN34                           136728
     C                     MOVEL'MMM0085' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ELSE                                           CEU003
     C*                                                                   CEU003
     C                     MOVELA6CYCD    DDII72                          CEU003
     C           DDCCY     IFEQ BKEURO                                    CEU003
     C           DDISCY    ANDEQ*BLANKS                                   CEU003
     C           DDISCY    OREQ BKEURO                                    CEU003
     C           WINCY     ANDEQ'Y'                                       CEU003
     C*                                                                   CEU003
     C           DDCCY     IFEQ BKEURO                                    CEU003
     C*                                                                   CEU003
     C***********@VDYNO    IFLT A6TPSD                             CEU003 134935
     C************IN11     OREQ '1'                                CEU003 134935
     C***********          MOVE 'N'       A6INCY                   CEU003 134935
     C***********          ENDIF                                   CEU003 134935
     C*                                                                   CEU003
     C           A6INCY    IFNE 'Y'                                       CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN89                    CEU003 136728
     C                     MOVE '1'       *IN34                           136728
     C                     MOVEL'MMM0086' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ELSE                                           CEU003
     C*                                                                   CEU003
     C           DDII72    IFNE DDCCY                                     CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN89                    CEU003 136728
     C                     MOVE '1'       *IN34                           136728
     C                     MOVEL'MMM0088' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ELSE                                           CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN89                    CEU003 136728
     C                     MOVE '1'       *IN34                           136728
     C                     MOVEL'MMM0087' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ELSE                                           CEU003
     C                     MOVE '1'       *IN41                           CEU003
     C***********          MOVE '1'       *IN89                    CEU003 136728
     C                     MOVE '1'       *IN34                           136728
     C                     MOVEL'MMM0090' @MSGID                          CEU003
     C                     CALL 'ZA0240'                                  CEU003
     C                     PARM           @MSGID                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   S01434
     C** *--------------------------------------------*                   S01434
     C** * Validate Interest Settlement Method        *                   S01434
     C** *--------------------------------------------*                   S01434
     C*                                                                   S01434
     C** Only validate if Enhanced Rollovers processing switched on       S01434
     C*                                                                   S01434
     C           S01434    IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C           DDIPDS    IFEQ 'Y'                                       S01434
     C           DDIMET    LOKUPTABSET                   85               S01434
     C*                                                                   S01434
     C** Has to be a valid settlement method                              S01434
     C*                                                                   S01434
     C           *IN85     IFEQ '0'                                       S01434
     C           DDIMET    IFNE *BLANKS                                   S01434
     C                     SETON                     8541                 S01434
     C                     MOVEL'MMM0631' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** Retail module has to be switched on for methods 04 and 14        S01434
     C*                                                                   S01434
     C                     SETOF                     85                   S01434
     C           DDIMET    IFEQ '04'                                      S01434
     C           DDIMET    OREQ '14'                                      S01434
     C           BGRTBN    IFNE 'Y'                                       S01434
     C                     SETON                     8541                 S01434
     C                     MOVEL'MMM0632' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Prime Retail account has to exist for settlement method 04       S01434
     C*                                                                   S01434
     C           *IN85     IFEQ '0'                                       S01434
     C           DDIMET    ANDEQ'04'                                      S01434
     C                     CALL 'AOACCTR0'                                S01434
     C                     PARM *BLANKS   @RTCD                           S01434
     C                     PARM '*KEY   ' @OPTN                           S01434
     C                     PARM *BLANKS   @RETL  10                       S01434
     C***********          PARM DDCNUM    @CNUM   6                S01434 090480
     C/COPY WNCPYSRC,MM0089C493
     C                     PARM DDCUST    @CNUM   6                       090480
     C/COPY WNCPYSRC,MM0089C494
     C***********          PARM DDCCY     @CYCD   3                S01434 CEU003
     C                     PARM WEICY     @CYCD   3                       CEU003
     C**********           PARM BMACCD    @ACCD   4                                    S01434 CGL029
     C                     PARM BMACCD    @ACCD  10                                           CGL029
     C                     PARM '01'      @ACSN   2                       S01434
     C                     PARM DDBRCA    @DSNB                           S01434
     C           SDACNT    PARM SDACNT    DSSDY                           S01434
     C*                                                                   S01434
     C           @RTCD     IFNE *BLANKS                                   S01434
     C                     SETON                     8541                 S01434
     C                     MOVEL'MMM0633' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           088044
     C           RECI      IFNE 'D'                                       088044
     C                     SETON                     8541                 088044
     C           @CNUM     CAT  '-'       @DATA     P                     088044
     C                     CAT  @CYCD     @DATA                           088044
     C                     CAT  '-'       @DATA                           088044
     C                     CAT  @ACCD     @DATA                           088044
     C                     CAT  '-'       @DATA                           088044
     C                     CAT  @ACSN     @DATA                           088044
     C                     MOVEL'BBM0130' @MSGID                          088044
     C                     CALL 'ZA0440'                                  088044
     C                     PARM           @MSGID                          088044
     C                     PARM           @DATA                           088044
     C                     END                                            088044
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Computer Suspense account has to exist for method 06             S01434
     C*                                                                   S01434
     C           *IN85     IFEQ '0'                                       S01434
     C           DDIMET    ANDEQ'06'                                      S01434
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C136                                           S01408
      *                                                                   S01408
     C                     CALL 'AOACCTR0'                                S01434
     C                     PARM *BLANKS   @RTCD                           S01434
     C                     PARM '*KEY   ' @OPTN                           S01434
     C                     PARM *BLANKS   @RETL  10                       S01434
     C                     PARM A8BICN    @CNUM   6                       S01434
     C***********          PARM DDCCY     @CYCD   3                S01434 CEU003
     C                     PARM WEICY     @CYCD   3                       CEU003
     C**********           PARM BKACCD    @ACCD   4                                    S01434 CGL029
     C                     PARM BKACCD    @ACCD                                               CGL029
     C                     PARM '01'      @ACSN   2                       S01434
     C                     PARM DDBRCA    @DSNB   3                       S01434
     C           SDACNT    PARM SDACNT    DSSDY                           S01434
     C*                                                                   S01434
     C           @RTCD     IFNE *BLANKS                                   S01434
     C                     SETON                     8541                 S01434
     C                     MOVEL'MMM0634' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           088044
     C           RECI      IFNE 'D'                                       088044
     C                     SETON                     8541                 088044
     C           @CNUM     CAT  '-'       @DATA     P                     088044
     C                     CAT  @CYCD     @DATA                           088044
     C                     CAT  '-'       @DATA                           088044
     C                     CAT  @ACCD     @DATA                           088044
     C                     CAT  '-'       @DATA                           088044
     C                     CAT  @ACSN     @DATA                           088044
     C                     MOVEL'BBM0130' @MSGID                          088044
     C                     CALL 'ZA0440'                                  088044
     C                     PARM           @MSGID                          088044
     C                     PARM           @DATA                           088044
     C                     END                                            088044
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Deal currency has to be USD for settlement method 07             S01434
     C*                                                                   S01434
     C           *IN85     IFEQ '0'                                       S01434
     C           DDIMET    ANDEQ'07'                                      S01434
     C***********DDCCY     ANDNEBLUSCY                             S01434 CEU003
     C           WEICY     ANDNEBLUSCY                                    CEU003
     C                     SETON                     8541                 S01434
     C                     MOVEL'MMM0635' @MSGID                          S01434
     C                     MOVE *BLANKS   @DATA                           S01434
     C                     MOVELBLUSCY    @DATA                           S01434
     C                     CALL 'ZA0440'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     PARM           @DATA                           S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** Should not be input if Interest Paid Separately is No            S01434
     C*                                                                   S01434
     C           DDIMET    IFNE *BLANKS                                   S01434
     C                     SETON                     8541                 S01434
     C                     MOVEL'MMM0650' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C           DDINSA    IFNE *BLANKS                                   077939
     C                     SETON                     8641                 077939
     C                     MOVEL'MMM0651' @MSGID                          077939
     C                     CALL 'ZA0240'                                  077939
     C                     PARM           @MSGID                          077939
     C                     END                                            077939
     C           DDINOS    IFNE *BLANKS                                   077939
     C                     SETON                     8741                 077939
     C                     MOVEL'MMM0647' @MSGID                          077939
     C                     CALL 'ZA0240'                                  077939
     C                     PARM           @MSGID                          077939
     C                     END                                            077939
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C                     MOVE *BLANKS   DDIMET                          S01434
     C                     MOVE *BLANKS   DDINSA                          077939
     C                     MOVE *BLANKS   DDINOS                          077939
     C                     END                                            S01434
     C*                                                                   S01434
     C** *--------------------------------------------*                   S01434
     C** * Validate Interest Settlement Account       *                   S01434
     C** *--------------------------------------------*                   S01434
     C*                                                                   S01434
     C** Move screen fields into field so can be checked                  S01434
     C*                                                                   S01434
     C           *IN36     IFEQ '1'                                       S01434
     C                     MOVELDDINSA    @@INSA                          S01434
     C                     ELSE                                           S01434
     C                     MOVELDDINSN    @@INSA                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Only validate if Enhanced Rollovers processing switched on       S01434
     C*                                                                   S01434
     C           S01434    IFEQ 'Y'                                       S01434
     C           DDIPDS    IFEQ 'Y'                                       S01434
     C           *IN85     IFEQ '0'                                       S01434
     C*                                                                   S01434
     C** Some settlement methods do not require a settlement account      S01434
     C*                                                                   S01434
     C           DDIMET    IFEQ *BLANKS                                   S01434
     C           DDIMET    OREQ '00'                                      S01434
     C           DDIMET    OREQ '04'                                      S01434
     C           DDIMET    OREQ '06'                                      S01434
     C           @@INSA    IFNE *BLANKS                                   S01434
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C138                                           S01408
      *                                                                   S01408
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0636' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C139                                           S01408
      *                                                                   S01408
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** Settlement method 03 can not have a settlement account           S01434
     C*                                                                   S01434
     C           DDIMET    IFNE '03'                                      S01434
     C           @@INSA    IFEQ *BLANKS                                   S01434
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0637' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Some settlement methods have to have a nostro number             S01434
     C*                                                                   S01434
     C           *IN86     IFEQ '0'                                       S01434
     C           DDIMET    IFEQ '01'                                      S01434
     C           DDIMET    OREQ '02'                                      S01434
     C           DDIMET    OREQ '07'                                      S01434
     C           DDIMET    OREQ '08'                                      S01434
     C           DDIMET    OREQ '12'                                      S01434
     C           IZ013     IFNE *BLANKS                                   S01434
     C           *IN36     ANDEQ'1'                                       125411
     C           IZ010     ORNE *BLANKS                                   125411
     C           *IN36     ANDEQ'0'                                       125411
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0638' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** Validate nostro number                                           S01434
     C*                                                                   S01434
     C***********          MOVELDDCCY     @KEYB                    S01434 CEU003
     C                     MOVELWEICY     @KEYB                           CEU003
     C                     MOVELINOST     @KEYE                           S01434
     C                     CALL 'AONOSTR0'                                S01434
     C                     PARM *BLANKS   @RTCD                           S01434
     C                     PARM '*KEY   ' @OPTN                           S01434
     C                     PARM *BLANKS   @KEYA                           S01434
     C                     PARM           @KEYB                           S01434
     C                     PARM *BLANKS   @KEYC                           S01434
     C                     PARM *BLANKS   @KEYD                           S01434
     C                     PARM           @KEYE                           S01434
     C                     PARM *BLANKS   @KEYF                           S01434
     C                     PARM *BLANKS   @KEYG                           S01434
     C                     PARM *BLANKS   @KEYH                           S01434
     C           SDNOST    PARM SDNOST    DSFDY                           S01434
     C*                                                                   S01434
     C           @RTCD     IFNE *BLANKS                                   S01434
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0639' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** If a settlement account has been entered for settlement method   S01434
     C** 03, then it should be a deal number                              S01434
     C*                                                                   S01434
     C           DDIMET    IFEQ '03'                                      S01434
     C           @@INSA    ANDNE*BLANKS                                   S01434
     C                     MOVE ICUST     WWCUST  60                      S01434
     C                     MOVE WWCUST    WACUST  6                       S01434
     C           ICUST     IFNE WACUST                                    S01434
     C           IZ009     ORNE *BLANKS                                   S01434
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0640' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Need a valid account for settlement method 05                    S01434
     C*                                                                   S01434
     C           DDIMET    IFEQ '05'                                      S01434
     C**********           MOVE IINSN     WWINSN 120                                   S01434 CGL029
     C**********           MOVE WWINSN    WAINSN 12                                    S01434 CGL029
     C                     MOVE IINSN     WWINSN 180                                          CGL029
     C                     MOVE WWINSN    WAINSN 18                                           CGL029
     C           IINSN     IFNE WAINSN                                    S01434
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0641' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C                     CALL 'AOACCTR0'                                S01434
     C                     PARM *BLANKS   @RTCD                           S01434
     C                     PARM '*KEY   ' @OPTN                           S01434
     C                     PARM *BLANKS   @RETL                           S01434
     C                     PARM ICUST     @CNUM                           S01434
     C***********          PARM DDCCY     @CYCD                    S01434 CEU003
     C                     PARM WEICY     @CYCD                           CEU003
     C                     PARM IACOD     @ACCD                           S01434
     C                     PARM IACSQ     @ACSN                           S01434
     C***********          PARM IBRCA     @DSNB                     S01434125411
     C***********          PARM BJSBRC    @DSNB                     125411163715
     C                     PARM IBRCA     @DSNB                           163715
     C           SDACNT    PARM SDACNT    DSSDY                           S01434
     C*                                                                   S01434
     C           @RTCD     IFNE *BLANKS                                   S01434
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0642' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           088044
     C           RECI      IFNE 'D'                                       088044
     C                     SETON                     8641                 088044
     C           @CNUM     CAT  '-'       @DATA     P                     088044
     C                     CAT  @CYCD     @DATA                           088044
     C                     CAT  '-'       @DATA                           088044
     C                     CAT  @ACCD     @DATA                           088044
     C                     CAT  '-'       @DATA                           088044
     C                     CAT  @ACSN     @DATA                           088044
     C                     MOVEL'BBM0130' @MSGID                          088044
     C                     CALL 'ZA0440'                                  088044
     C                     PARM           @MSGID                          088044
     C                     PARM           @DATA                           088044
     C                     END                                            088044
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Need a valid retail account for settlement method 14             S01434
     C*                                                                   S01434
     C           DDIMET    IFEQ '14'                                      S01434
     C           IZ004     IFNE *BLANKS                                   S01434
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0643' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C                     MOVE IRETL     WWRETL 100                      S01434
     C                     MOVE WWRETL    WARETL 10                       S01434
     C*                                                                   S01434
     C           IRETL     IFNE WARETL                                    S01434
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0644' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C                     CALL 'AOACCTR0'                                S01434
     C                     PARM *BLANKS   @RTCD                           S01434
     C                     PARM '*KEY   ' @OPTN                           S01434
     C                     PARM IRETL     @RETL                           S01434
     C                     PARM *BLANKS   @CNUM                           S01434
     C                     PARM *BLANKS   @CYCD                           S01434
     C                     PARM *BLANKS   @ACCD                           S01434
     C                     PARM *BLANKS   @ACSN                           S01434
     C                     PARM *BLANKS   @DSNB                           S01434
     C           SDACNT    PARM SDACNT    DSSDY                           S01434
     C*                                                                   S01434
     C           @RTCD     IFNE *BLANKS                                   S01434
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0645' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C           RECI      IFNE 'D'                                       088044
     C                     SETON                     8641                 088044
     C                     MOVEL@RETL     @DATA     P                     088044
     C                     MOVEL'BBM0130' @MSGID                          088044
     C                     CALL 'ZA0440'                                  088044
     C                     PARM           @MSGID                          088044
     C                     PARM           @DATA                           088044
     C                     ELSE                                           088044
     C*                                                                   S01434
     C** Currency of the retail account should be the same as the         S01434
     C** currency of the deal                                             S01434
     C*                                                                   S01434
     C***********DDCCY     IFNE CCY                                S01434 CEU003
     C           WEICY     IFNE CCY                                       CEU003
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0646' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            088044
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** Should not be input if Interest Paid Separately is No            S01434
     C*                                                                   S01434
     C           @@INSA    IFNE *BLANKS                                   S01434
     C                     SETON                     8641                 S01434
     C                     MOVEL'MMM0651' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C                     MOVE *BLANKS   @@INSA                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** *--------------------------------------------*                   S01434
     C** * Validate Rollover Frequency                *                   S01434
     C** *--------------------------------------------*                   S01434
     C*                                                                   S01434
     C** Only validate if Enhanced Rollovers processing switched on       S01434
     C*                                                                   S01434
     C           S01434    IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C** It has to be input if Automatic Rollover is Y                    S01434
     C*                                                                   S01434
     C           DDAURO    IFEQ 'Y'                                       S01434
     C           DDROFQ    IFEQ *BLANKS                                   S01434
     C                     SETON                     8241                 S01434
     C                     MOVEL'MMM0624' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C           DDROFQ    LOKUPTABFRQ                   82               S01434
     C           *IN82     IFEQ '0'                                       S01434
     C                     SETON                     8241                 S01434
     C                     MOVEL'MMM0625' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C                     SETOF                     82                   S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C           DDROFQ    IFNE *BLANKS                                   S01434
     C                     SETON                     8241                 S01434
     C                     MOVEL'MMM0626' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C                     MOVE *BLANKS   DDROFQ                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** *-------------------------------------------*                    S01434
     C** * Validate Rollover Day Number              *                    S01434
     C** *-------------------------------------------*                    S01434
     C*                                                                   S01434
     C** Only validate if Enhanced Rollovers processing switched on       S01434
     C*                                                                   S01434
     C           S01434    IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C           DDROFQ    LOKUPTABFQ2                   83               S01434
     C*                                                                   S01434
     C           DDAURO    IFEQ 'Y'                                       S01434
     C           *IN83     IFEQ '1'                                       S01434
     C                     SETOF                     83                   S01434
     C*                                                                   S01434
     C** Rollover Day Number has to be input if the Rollover              S01434
     C** Frequency requires a day number                                  S01434
     C*                                                                   S01434
     C           DDRLDN    IFEQ *BLANKS                                   S01434
     C                     SETON                     8341                 S01434
     C                     MOVEL'MMM0627' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** Rollover Day Number has to be a number                           S01434
     C*                                                                   S01434
     C                     TESTN          DDRLDN     6263                 S01434
     C                     MOVE DDRLDN    @TEST                           S01434
     C                     TESTZ          @TEST          73               S01434
     C*                                                                   S01434
     C           *IN62     IFEQ '0'                                       S01434
     C           *IN63     ANDEQ'0'                                       S01434
     C           *IN73     OREQ '0'                                       S01434
     C                     SETON                     8341                 S01434
     C                     MOVEL'MMM0628' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Rollover Day Number has to be a valid day number                 S01434
     C*                                                                   S01434
     C           *IN62     IFEQ '1'                                       S01434
     C           *IN73     ANDEQ'1'                                       S01434
     C           *IN73     OREQ '1'                                       S01434
     C           *IN63     ANDEQ'1'                                       S01434
     C                     MOVE DDRLDN    @WK20                           S01434
     C           @WK20     IFLT 0                                         S01434
     C           @WK20     ORGT 31                                        S01434
     C                     SETON                     8341                 S01434
     C                     MOVEL'MMM0629' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Rollover Day Number should not be input if the Rollover          S01434
     C** Frequency does not require a day number                          S01434
     C*                                                                   S01434
     C                     ELSE                                           S01434
     C           DDRLDN    IFNE *BLANKS                                   S01434
     C                     SETON                     8341                 S01434
     C                     MOVEL'MMM0630' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** Should not be input if Automatic Rollover is No                  S01434
     C*                                                                   S01434
     C           DDRLDN    IFNE *BLANKS                                   S01434
     C                     SETON                     8341                 S01434
     C                     MOVEL'MMM0652' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C                     MOVE *BLANKS   DDRLDN                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** *-------------------------------------------*                    S01434
     C** * Validate Interest Counterparty Nostro     *                    S01434
     C** *-------------------------------------------*                    S01434
     C*                                                                   S01434
     C** Only validate if Enhanced Rollovers processing switched on       S01434
     C*                                                                   S01434
     C           S01434    IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C** Should only be input if Interest Settlement Method entered       S01434
     C*                                                                   S01434
     C           DDINOS    IFNE *BLANKS                                   S01434
     C           DDIMET    IFEQ *BLANKS                                   S01434
     C           DDIMET    OREQ '00'                                      S01434
     C                     SETON                     8741                 S01434
     C                     MOVEL'MMM0647' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** See if it is a customer number                                   S01434
     C*                                                                   S01434
     C                     CALL 'AOCUSTR0'                                S01434
     C                     PARM *BLANKS   @RTCD                           S01434
     C                     PARM '*KEY   ' @OPTN                           S01434
     C                     PARM DDINOS    @KEY1                           S01434
     C                     PARM *BLANKS   @KYST                           S01434
     C           SDCUST    PARM SDCUST    DSSDY                           S01434
      *                                                                   109308
      * If a valid customer has been selected from the prompt screen      109308
      * then set the screen field value accordingly                       109308
      *                                                                   109308
     C           @RTCD     IFEQ *BLANKS                                   109308
     C           @OPTN     ANDEQ'*KEY   '                                 109308
     C           @KYST     ANDEQ'*CNUM  '                                 109308
     C                     MOVE *BLANKS   DDINOS                          109308
     C                     MOVEL@KEY1     DDINOS                          109308
     C                     ENDIF                                          109308
     C*                                                                   S01434
     C           @RTCD     IFNE *BLANKS                                   S01434
     C           @KYST     IFEQ '*CNUM  '                                 S01434
     C                     SETON                     8741                 S01434
     C                     MOVEL'MMM0648' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** See if it is a counterparty nostro                               S01434
     C*                                                                   S01434
     C                     CALL 'AOCNSTR0'                                S01434
     C                     PARM *BLANKS   @RTCD                           S01434
     C                     PARM '*KEY   ' @OPTN                           S01434
     C                     PARM INOSN     @ARCD                           S01434
     C           SDCNST    PARM SDCNST    DSFDY                           S01434
      *                                                                   109308
      * If a valid counterparty nostro has been selected from the         109308
      * prompt screen then set the screen field value accordingly         109308
      *                                                                   109308
     C           @RTCD     IFEQ *BLANKS                                   109308
     C           @OPTN     ANDEQ'*KEY   '                                 109308
     C                     MOVE *BLANKS   DDINOS                          109308
     C                     MOVEL@ARCD     INOSN                           109308
     C                     ENDIF                                          109308
     C*                                                                   S01434
     C           @RTCD     IFNE *BLANKS                                   S01434
     C           IZZ02     ORNE *BLANKS                                   S01434
     C                     SETON                     8741                 S01434
     C                     MOVEL'MMM0649' @MSGID                          S01434
     C                     CALL 'ZA0240'                                  S01434
     C                     PARM           @MSGID                          S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     ELSE                                           S01434
     C                     MOVE *BLANKS   DDINOS                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** *----------------------------------------------*                 S01434
     C** * Setting up Rollover Warning Period Indicator *                 S01434
     C** *----------------------------------------------*                 S01434
     C*                                                                   S01434
     C** If a new deal set to No                                          S01434
     C*                                                                   S01434
     C           DDACTN    IFEQ 'I'                                       S01434
     C                     MOVE 'N'       IKWRPI                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** If input from MM5310 set to No                                   S01434
     C*                                                                   S01434
     C           DDACTN    IFEQ 'A'                                       S01434
     C           @TERM1    ANDEQ'R'                                       S01434
     C                     MOVE 'N'       IKWRPI                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** If an amend but not from MM5310 and Automatic Rollover           S01434
     C** Indicator has been changed from Yes to No then set to Yes        S01434
     C*                                                                   S01434
     C           DDACTN    IFEQ 'A'                                       S01434
     C           @TERM1    ANDNE'R'                                       S01434
     C           DDAURO    ANDEQ'N'                                       S01434
     C           DDAURO    ANDNEHKAURO                                    S01434
     C                     MOVE 'Y'       IKWRPI                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CVSF                                           S01408
     C*                                                                   S01408
     C*  *--------------------------------------------*
     C*  * Validate Settlement Instructions           *
     C*  *--------------------------------------------*
     C*
     C********   *IN77     IFEQ '1'                                 S01177AUS007
     C           *INL1     IFEQ '1'                                       AUS007
     C                     GOTO #ZI9                       *1             S01177
     C                     END                                            S01177
     C*                                                                   S01177
     C**  If no error has been found in the validation so far, validate
     C**  the settlement instructions.
     C           *IN41     IFEQ '0'                        B1
     C                     MOVE '0'       *IN66            *1
     C*
     C****Determine which date is to be used for event date for receive   S01177
     C****instructions, and set it up.                                    S01177
     C*****                                                               S01177
     C****Set up the value date as the event date and set up the event    S01177
     C****date name to be 'Value Date'.                                   S01177
     C*****                Z-ADD@VDYNO    @EDAT            *1             S01177
     C*****                MOVEL@V,2      @ENAM            *1             S01177
     C*****                MOVE 'V'       @EFLG            *1             S01177
     C*****                                                               S01177
     C****If the deal type is not IT,TD,CI or CD, the event date will     S01177
     C****be different.                                                   S01177
     C*****      DDTYPE    IFNE 'IT'                       B*2            S01177
     C*****      DDTYPE    ANDNE'TD'                       B*2            S01177
     C*****      DDTYPE    ANDNE'CI'                       B*2            S01177
     C*****      DDTYPE    ANDNE'CD'                       B*2            S01177
     C*****                EXSR #ZIB                       **2            S01177
     C*****                END                             E*2            S01177
     C*                                                                   S01177
     C** Set up parameters for call to SD2410  in case first screen       S01177
     C*     has been changed                                              S01177
     C*                                                                   S01177
     C                     MOVE DDACTN    PMACTC                          S01177
     C                     MOVE 'MMLD'    PMCPGM                          S01177
     C                     MOVE DDTYPE    PMTTYP                          S01177
     C                     MOVE DDCUST    PMCSNM                          S01177
     C                     MOVE DDCCY     PMRCCY                          S01177
     C                     MOVE DDCCY     PMPCCY                          S01177
     C/COPY WNCPYSRC,MM0089C025
     C                     MOVE DDFEDF    PMFFND                          S01177
     C/COPY WNCPYSRC,MM0089C026
     C                     MOVE DDBRCA    PMBRCA                          S01177
     C*                                                                   S01177
     C** Set up Date of Payment and Receipt                               S01177
     C                     EXSR #ZK                                       S01177
      *                                                                   S01117
      ** Must blank out settlement branches, this is handled and          S01117
      ** validated by SD2410,  unless settlement method is '05'           S01117
     C           PMRSTM    IFNE 05                                        S01117
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C140                                           S01408
      *                                                                   S01408
     C           DDACTN    IFEQ 'A'                                       E30473
     C           PMPRCV    ANDEQ'Y'                                       E30473
     C                     ELSE                                           E30473
     C                     MOVE *BLANKS   PMROBR                          S01117
     C                     END                                            E30473
     C                     ELSE                                           E83
      * SETUP DEFAULT BRANCH FOR '05' IF MBIN IS OFF                      E83
     C           @MBIN     IFEQ 'N'                                       E83
     C                     MOVE BJSBRC    PMROBR                          E83
     C                     END                                            E83
      *
     C                     END                                            S01117
     C           PMPSTM    IFNE 05                                  S01117E30473
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C141                                           S01408
      *                                                                   S01408
     C           DDACTN    IFEQ 'A'                                       E30473
     C           PMPPAY    ANDEQ'Y'                                       E30473
     C                     ELSE                                           E30473
     C                     MOVE *BLANKS   PMPOBR                          S01117
     C                     END                                            E30473
     C                     ELSE                                           E83
      * SETUP DEFAULT BRANCH FOR '05' IF MBIN IS OFF                      E83
     C           @MBIN     IFEQ 'N'                                       E83
     C                     MOVE BJSBRC    PMPOBR                          E83
     C                     END                                            E83
      *
     C                     END                                            S01117
     C*                                                                   S01177
     C** Call settlement screen validation program                        S01177
     C*****                CALL 'SDKUUPR'                          S01177 E214
     C                     CALL 'SD2410'                                  E214
     C*****                PARM           @PARM1                          S01177
     C                     PARM           @PARM2                          S01177
     C                     PARM           @PARM3                          S01177
     C                     PARM           WDUMMY                          CEU003
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CSF1                                           S01408
     C*                                                                   S01408
     C                     END                                            S01177
     C*                                                                   S01177
     C** Terminate program if database error returned                     S01177
     C*                                                                   S01177
     C           PMDBSE    IFNE *ZEROS                                    S01177
     C                     MOVE '1'       *INLR            *1             S01177
     C                     MOVE '1'       *INU7            *1             S01177
     C                     MOVE '1'       *INU8            *1             S01177
     C                     MOVE '1'       *INKC            ***************S01177
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVELPMDBFL    DBFILE           * DBERROR 029 *S01177
     C                     MOVE PMDBSE    DBASE            ***************S01177
     C                     MOVELPMDBKY    DBKEY            *1             S01177
     C                     MOVELPMDPGM    DBPGM            *1             S01177
     C                     OUT  LDA                                       E24039
     C                     GOTO #ZI9                       *1             S01177
     C                     END                             E1             S01177
     C*                                                                   S01177
     C*                                                                   S01177
     C/COPY WNCPYSRC,MM0089C206
     C** If validation errors have occured do not allow update            S01177
     C           PMERCD    IFNE *BLANKS                                   S01177
     C/COPY WNCPYSRC,MM0089C275
     C                     MOVE '1'       *IN41                           S01177
     C                     MOVE '1'       *IN66                           S01177
     C*********************MOVEL'MMM1040' @MSGID                S01177    S01227
     C                     MOVEL'MMM1042' @MSGID                          S01227
     C                     CALL 'ZA0240'                                  S01177
     C                     PARM           @MSGID                          S01177
     C                     END                                            S01177
     C/COPY WNCPYSRC,MM0089C207
     C*                                                                   S01177
     C** If errors then no furthur checks required                        060936
     C*                                                                   060936
     C           *IN41     IFEQ '1'                                       060936
     C                     GOTO #ZI9                                      060936
     C                     END                                            060936
     C*                                                                   060936
     C**  Set up pay and receive instructions                             060936
     C*                                                                   060936
     C           PMRSTM    IFEQ 04                                        060936
     C           PMPSTM    OREQ 04                                        060936
     C                     MOVELPMPCYA    @WK6    6                       060936
     C                     MOVE '01'      @WK6                            060936
     C                     END                                            060936
     C*                                                                   060936
     C           PMRSTM    IFEQ 04                                        060936
     C                     MOVELPMCSNM    IKMORI                          060936
     C                     MOVE @WK6      IKMORI                          060936
     C                     END                                            060936
     C*                                                                   060936
     C           PMPSTM    IFEQ 04                                        060936
     C                     MOVELPMCSNM    IKMOPI                          060936
     C                     MOVE @WK6      IKMOPI                          060936
     C                     END                                            060936
     C*                                                                   060936
     C****Set up parameters for receive instructions, and call #ZIA to    S01177
     C****carry out defaulting and validation.                            S01177
     C*****                MOVE *BLANK    @RECHK  1        *1             S01177
     C*****                MOVE DDORCM    @SMT             *1             S01177
     C*****                MOVE 'R'       @PRIND           *1             S01177
     C*****                MOVE DDMCPI    @THEIR           *1             S01177
     C*****                MOVE DDMORI    @OUR             *1             S01177
     C*****                MOVE DDMFAO    @FORAC           *1             S01177
     C*****                MOVE DDSPEC    @SPECI 35        *1      E13747 S01177
     C*****                MOVE DDVDAT    @VALD            *1             S01177
     C*****                EXSR #ZIA                       *1             S01177
     C*****                MOVE @SMT      DDORCM           *1             S01177
     C*****                MOVE @OUR      DDMORI           *1             S01177
     C*****                MOVE @THEIR    DDMCPI           *1             S01177
     C*
     C****Determine which date is to be used for event date for pay       S01177
     C****instructions, and set it up.                                    S01177
     C*
     C****Set up the value date as the event date and set up the event    S01177
     C****date name to be 'Value Date'.                                   S01177
     C*****                Z-ADD@VDYNO    @EDAT            *1             S01177
     C*****                MOVEL@V,2      @ENAM            *1             S01177
     C*****                MOVE 'V'       @EFLG            *1             S01177
     C*
     C****If the deal type is IT,TD,CI or CD, the event date will be      S01177
     C****different.                                                      S01177
     C*****      DDTYPE    IFEQ 'IT'                       B*2            S01177
     C*****      DDTYPE    OREQ 'TD'                       B*2            S01177
     C*****      DDTYPE    OREQ 'CI'                       B*2            S01177
     C*****      DDTYPE    OREQ 'CD'                       B*2            S01177
     C*****                EXSR #ZIB                       **2            S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C****Set up parameters for pay instructions, and call #ZIA to        S01177
     C****carry out defaulting and validation.                            S01177
     C*****                MOVE DDMOPM    @SMT             *1             S01177
     C*****                MOVE 'P'       @PRIND           *1             S01177
     C*****                MOVE DDMCRI    @THEIR           *1             S01177
     C*****                MOVE DDMOPI    @OUR             *1             S01177
     C*****                MOVE DDMFAO    @FORAC           *1             S01177
     C*****                MOVE DDSPEC    @SPECI           *1      E13747 S01177
     C*****                EXSR #ZIA                       *1             S01177
     C*****                MOVE @SMT      DDMOPM           *1             S01177
     C*****                MOVE @OUR      DDMOPI           *1             S01177
     C*****                MOVE @THEIR    DDMCRI           *1             S01177
     C*****                MOVE @FORAC    DDMFAO           *1             S01177
     C*****                MOVE @SPECI    DDSPEC           *1      E13747 S01177
     C*****                MOVE '0'       *IN67            *1             S01177
     C*****                                                               S01177
     C****If default settlement instructions have been assigned           S01177
     C*****  then value, maturity and next interest dates must be         S01177
     C*****  rechecked                                                    S01177
     C*****      @RECHK    IFEQ 'Y'                        B*2            S01177
     C*****                EXSR #ZIC                       **2            S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C*****                END                             E1             S01177
     C*****                MOVE DDCUST    @XCUST                          S01177
     C*****                                                               S01177
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP48                                           S01408
     C*                                                                   S01408
     C*
     C           #ZI9      ENDSR                           **#ZI9**
      /EJECT                                                              S01443
      ****************************************************************    S01443
      *                                                              *    S01443
      *     #TSPN  -  Determine time span of deal                    *    S01443
      *                                                              *    S01443
      *     CALLED BY: #ZI - validate input fields for Input, amend  *    S01443
      *                      and authorise                           *    S01443
      *                                                              *    S01443
      *     CALLS: ZDATE1 - convert date in DDMMYY or MMDDYY format  *    S01443
      *                     to Midas day number                      *    S01443
      *                                                              *    S01443
     C****************************************************************    S01443
     C*                                                                   S01443
     C           #TSPN     BEGSR                                          S01443
     C                     Z-ADD0         @DDA1                           S01443
     C                     Z-ADD0         @VDA1                           S01443
     C                     Z-ADD0         @MDA1                           S01443
      *                                                                   S01443
      ** Convert dates from DDMMYY to midas day number format             S01443
      *                                                                   S01443
     C           BJDFIN    IFEQ 'D'                                       S01443
     C                     MOVE '0'       *IN98                           S01443
     C                     ELSE                                           S01443
     C                     MOVE '1'       *IN98                           S01443
     C                     END                                            S01443
     C*                                                                   S01443
     C           DDVDAT    IFNE *BLANK                     B1             S01443
     C                     MOVE DDVDAT    ZDATE                           S01443
     C                     EXSR ZDATE1                                    S01443
     C           *IN99     IFEQ '0'                        B*2            S01443
     C                     Z-ADDZDAYNO    @VDA1   50                      S01443
     C                     END                             E*2            S01443
     C                     END                             E1             S01443
      *                                                                   S01443
     C           DDMDAT    IFNE *BLANK                     B1             S01443
     C                     MOVE DDMDAT    ZDATE                           S01443
     C                     EXSR ZDATE1                                    S01443
     C           *IN99     IFEQ '0'                        B*2            S01443
     C                     Z-ADDZDAYNO    @MDA1   50                      S01443
     C                     END                             E*2            S01443
     C                     END                             E1             S01443
      *                                                                   S01443
     C           DDDLDT    IFNE *BLANK                     B1             S01443
     C                     MOVE DDDLDT    ZDATE                           S01443
     C                     EXSR ZDATE1                                    S01443
     C           *IN99     IFEQ '0'                        B*2            S01443
     C                     Z-ADDZDAYNO    @DDA1   50                      S01443
     C                     END                             E*2            S01443
     C                     END                             E1             S01443
      *                                                                   S01443
      ** Calculate day after deal date and day after value date           S01443
      *                                                                   S01443
     C           @VDA1     ADD  1         @VDAP   50                      S01443
     C           @DDA1     ADD  1         @DDAP   50                      S01443
      *                                                                   S01443
      ** Calculate the difference between the maturity and value date     S01443
      *                                                                   S01443
     C           @MDA1     SUB  @VDA1     @DIFF   60                      S01443
      *                                                                   S01443
      ** If the maturity date is less than 10 days after value date       S01443
      *                                                                   S01443
     C           @DIFF     IFLE 10                          B1            S01443
     C                     MOVE 'W'       UTPRD2                          S01443
     C                     Z-ADD1         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date equals 0, or is the day after value         S01443
      ** date, and the value date equals deal date                        S01443
      *                                                                   S01443
     C           @MDA1     IFEQ 0                           B1            S01443
     C           @MDA1     OREQ @VDAP                                     S01443
     C           @VDA1     ANDEQ@DDA1                                     S01443
     C                     MOVE 'D'       UTPRD2                          S01443
     C                     Z-ADD1         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is the day after value date and the         S01443
      ** value date is the day after deal date                            S01443
      *                                                                   S01443
     C           @MDA1     IFEQ @VDAP                       B1            S01443
     C           @VDA1     ANDEQ@DDAP                                     S01443
     C                     MOVE 'D'       UTPRD2                          S01443
     C                     Z-ADD2         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is the day after value date and the         S01443
      ** value date is more than one day  after the deal date             S01443
      *                                                                   S01443
     C           @MDA1     IFEQ @VDAP                       B1            S01443
     C           @VDA1     ANDGT@DDAP                                     S01443
     C                     MOVE 'D'       UTPRD2                          S01443
     C                     Z-ADD3         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 10 days after value date    S01443
      *                                                                   S01443
     C           @DIFF     IFGT 10                          B1            S01443
     C                     MOVE 'W'       UTPRD2                          S01443
     C                     Z-ADD2         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 17 days after value date    S01443
      *                                                                   S01443
     C           @DIFF     IFGT 17                          B1            S01443
     C                     MOVE 'W'       UTPRD2                          S01443
     C                     Z-ADD3         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 25 days after value date    S01443
      *                                                                   S01443
     C           @DIFF     IFGT 25                          B1            S01443
     C                     MOVE 'M'       UTPRD2                          S01443
     C                     Z-ADD1         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 46 days after value date    S01443
      *                                                                   S01443
     C           @DIFF     IFGT 46                          B1            S01443
     C                     MOVE 'M'       UTPRD2                          S01443
     C                     Z-ADD2         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 77 days after value date    S01443
      *                                                                   S01443
     C           @DIFF     IFGT 77                          B1            S01443
     C                     MOVE 'M'       UTPRD2                          S01443
     C                     Z-ADD3         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 165 days after value date   S01443
      *                                                                   S01443
     C           @DIFF     IFGT 165                         B1            S01443
     C                     MOVE 'M'       UTPRD2                          S01443
     C                     Z-ADD6         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 255 days after value date   S01443
      *                                                                   S01443
     C           @DIFF     IFGT 255                         B1            S01443
     C                     MOVE 'M'       UTPRD2                          S01443
     C                     Z-ADD9         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 317 days after value date   S01443
      *                                                                   S01443
     C           @DIFF     IFGT 317                         B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD1         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 548 days after value date   S01443
      *                                                                   S01443
     C           @DIFF     IFGT 548                         B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD2         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 913 days after value date   S01443
      *                                                                   S01443
     C           @DIFF     IFGT 913                         B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD3         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 1278 days after value date  S01443
      *                                                                   S01443
     C           @DIFF     IFGT 1278                        B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD4         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 1643 days after value date  S01443
      *                                                                   S01443
     C           @DIFF     IFGT 1643                        B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD5         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 2008 days after value date  S01443
      *                                                                   S01443
     C           @DIFF     IFGT 2008                        B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD6         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 2373 days after value date  S01443
      *                                                                   S01443
     C           @DIFF     IFGT 2373                        B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD7         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 2738 days after value date  S01443
      *                                                                   S01443
     C           @DIFF     IFGT 2738                        B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD8         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 3103 days after value date  S01443
      *                                                                   S01443
     C           @DIFF     IFGT 3103                        B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD9         UPRD2                           S01443
     C                     END                              E1            S01443
      *                                                                   S01443
      ** If the maturity date is greater than 3468 days after value date  S01443
      *                                                                   S01443
     C           @DIFF     IFGT 3468                        B1            S01443
     C                     MOVE 'Y'       UTPRD2                          S01443
     C                     Z-ADD10        UPRD2                           S01443
     C                     END                              E1            S01443
     C                     ENDSR                                          S01443
      /EJECT
     C****************************************************************
     C*     ZA1160 -  Convert scaled rate to unscaled rate.          *
     C*                                                              *
     C*     CALLS:                                                   *
     C*                                                              *
     C*     INPUT:   @@SEXP - Scaling exponent.                      *
     C*              @@INRT - Rate to be unscaled.                   *
     C*                                                              *
     C*     OUTPUT:  @@USRT - Unscaled rate.                         *
     C*                                                              *
     C*     USES:    @SF    - Array of scaling factors.              *
     C*              @@C    - Index for array @SF.                   *
     C*              @@SCAF - Scaling factor.                        *
     C*                                                              *
     C*     LAST AMEND NO. 000000             DATE   XX/XX/XX        *
     C****************************************************************
     C*
     C           ZA1160    BEGSR
     C*
     C**  Define and initialise fields used and output fields.
     C                     Z-ADD@@SEXP    @@SEXP  10
     C                     Z-ADD@@INRT    @@INRT 128
     C*
     C                     Z-ADD*ZEROS    @@USRT 128
     C*
     C                     Z-ADD*ZEROS    @@C     20
     C                     Z-ADD*ZEROS    @@SCAF 100
     C*
     C**  If the input rate is zero, the output rate is zero, by-pass
     C**  further processing.
     C           @@INRT    CABEQ0         ZA1169
     C*
     C**  Determine the scaling factor from the scaling exponent.
     C                     Z-ADD@@SEXP    @@C
     C                     ADD  1         @@C
     C                     Z-ADD@SF,@@C   @@SCAF
     C*
     C**  Calculate the unscaled rate.
     C           @@INRT    DIV  @@SCAF    @@USRT    H
     C*
     C           ZA1169    ENDSR                           **ZA1169**
      /EJECT
     C*****************************************************************
     C*****                                                           *   S01177
     C**#ZIB     - Set up event date fields.                          *   S01177
     C*****                                                           *   S01177
     C**CALLS             -                                           *   S01177
     C*****                                                           *   S01177
     C**CALLED BY  #ZI    - Validates the screen input for I,A and X. *   S01177
     C*****                                                           *   S01177
     C**FLDS USED: @MDYNO - Maturity date (MIDAS day no.)             *   S01177
     C*****        @EDAT  - Event date.                               *   S01177
     C*****        @V     - Event name array.                         *   S01177
     C*****        @ENAM  - Event name.                               *   S01177
     C*****        @EFLG  - Event flag.                               *   S01177
     C*****        @NDYNO - Next interest date (MIDAS day no.)        *   S01177
     C*****                                                           *   S01177
     C*****************************************************************   S01177
     C*****      #ZIB      BEGSR                                          S01177
     C*****                                                               S01177
     C****If the maturity date has been entered, reset the event date     S01177
     C****to be the maturity date.                                        S01177
     C*****      DDMDAT    IFNE *BLANKS                    B1             S01177
     C*****                Z-ADD@MDYNO    @EDAT            *1             S01177
     C*****                MOVEL@V,4      @ENAM            *1             S01177
     C*****                MOVE 'M'       @EFLG            *1             S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C****If the action code is 'A', no maturity date has been entered    S01177
     C****and the deal type is CL or DL, reset the event date to be the   S01177
     C****run date.                                                       S01177
     C*****      DDACTN    IFEQ 'A'                        B1             S01177
     C*****      DDMDAT    ANDEQ*BLANKS                    B1             S01177
     C*****      DDTYPE    IFEQ 'CL'                       B*2            S01177
     C*****      DDTYPE    OREQ 'DL'                       B*2            S01177
     C*****                Z-ADDRUND      @EDAT            **2            S01177
     C*****                MOVEL@V,1      @ENAM            **2            S01177
     C*****                MOVE 'R'       @EFLG            **2            S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C****If the action code is 'A', and the next interest date has       S01177
     C****been entered, reset the event date to be the next interest      S01177
     C****date.                                                           S01177
     C*****      DDACTN    IFEQ 'A'                        B1             S01177
     C*****      DDNDAT    ANDNE*BLANKS                    B1             S01177
     C*****                Z-ADD@NDYNO    @EDAT            *1             S01177
     C*****                MOVEL@V,3      @ENAM            *1             S01177
     C*****                MOVE 'I'       @EFLG            *1             S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*****      #ZIB9     ENDSR                           **#ZIB9**      S01177
      /EJECT
     C*****************************************************************
     C*                                                               *   S01177
     C* #ZIA     - Validates the setttlement instructions.            *   S01177
     C*                                                               *   S01177
     C* CALLS    #ZIAA    - Perform account checks.                   *   S01177
     C*          ZA0240   - Sends a msg to the program message queue. *   S01177
     C*          ZA0440   - Sends a msg with data to the pgm msg queue*   S01177
     C*          ZA0840   - Validate alpha versions of numeric fields.*   S01177
     C*                                                               *   S01177
     C* CALLED BY  #ZI    - Validates the screen input for I,A and X. *   S01177
     C*                                                               *   S01177
     C* FLDS USED  @SMT   - Settlement method.                        *   S01177
     C*            @PRIND - Pay/receive indicator.                    *   S01177
     C*            @THEIR - Their instructions.                       *   S01177
     C*            @OUR   - Our instructions.                         *   S01177
     C*            @FORAC - For the account of.                       *   S01177
     C*            @MSGID - Message id field.                         *   S01177
     C*            @XCUST - Stored customer number.                   *   S01177
     C*************@CYCCY*-*Currency*sub-field*of*FDCCCYLL*file*key.***   E13747
     C*************@CYCNM*-*Customer*number*sub-field*of*FDCCCYLL*key.*   E13747
     C*************@CYKEY*-*FDCCCYLL*file*key.*************************   E13747
     C*            @CYCCY - Currency sub-field of STDSI file key.     *   E13747
     C*            @CYCNM - Customer number sub-field of STDSI key.   *   E13747
     C*            @CTTP  - Module type sub-field of STDSI file key.  *   E13747
     C*            @CYKEY - STDSI file key.                           *   E13747
     C*            @DMTD  - Default settlement method.                *
     C*************@NSCNO*-*Customer*number*sub-field*of*FDNOSTLL*key.*   E13747
     C*************@NSCCY*-*Currency*sub-field*of*FDNOSTLL*file*key.***   E13747
     C*************@NSKEY*-*FDNOSTLL*file*key.*************************   E13747
     C*            @TEMP  - Work field.                               *
     C*************@SNNM2*-*Sub-field*of*file*key*for*FDSNAMLL.********   E13747
     C*************@SNNM1*-*Sub-field*of*file*key*for*FDSNAMLL.********   E13747
     C*************@SNKEY*-*Key*for*file*FDSNAMLL.*********************   E13747
     C*            @8     - Work field.                               *
     C*            @STS   - Future status of deal.                    *
     C*            @@IINT - No. of integers field.                    *
     C*            @@IDP  - Decimal places field.                     *
     C*            @@ALPH - Alpha amount for validation.              *
     C*            @@ERCD - Error code.                               *
     C*            @DATA  - DS to set up data for screen messages.    *
     C*            @@AMT  - Output amount field.                      *
     C*            @TEMP2 - Work field.                               *
     C*            @KEY   - Key field for MIDAS file.                 *
     C*            @KEY1  - Subfield of @KEY.                         *
     C*            @TEMP3 - Work field.                               *
     C*            @TEMT4 - Work field.                               *
     C*            @ACCNM - Customer no. sub-field of ACCNT file key. *
     C*            @ACCCY - Currency sub-field of ACCNT file key.     *
     C*            @ACCDE - Account code sub-field of ACCNT file key. *
     C*            @ACSEQ - Account seq. no. sub-field of ACCNT key.  *
     C*            @WK25  - Work field.                               *
     C*            @WK5A  - Work field.                               *
     C*            @ENAM  - Event name.                               *
     C*            @ERCD  - Error code.                               *
     C*            @TEMP5 - Work field.                               *
     C*            @MOPI  - Stored version of DDMOPI.                 *
     C*            @MORI  - Stored version of DDMORI.                 *
     C*            @X1    - Work field.                               *
     C*            @TEN   - Flag to indicate our instr. are 10N.      *
     C*            @TEND  - Field to hold 10 long our instructions.   *
     C*            @TWLV  - Flag to indicate our instr. are 12N.      *
     C*            @CUN   - Customer number.                          *
     C*            @ACD   - Account code.                             *
     C*            @SEQ   - Account sequence no.                      *
     C*            @WK35  - Work field.                               *
     C*            @T11   - Work field.                               *
     C*            @REKEY - Key to the FDRETALL file.                 *
     C*            @RET   - Flag to indicate FDRETALL read.           *
     C*            @WK30  - Work field.                               *
     C*            @WK10  - Work field.                               *
     C*****        @CNUM  - Customer number.                          *   S01194
     C*****        @CLTKY - Key to client file.                       *   S01194
     C*                                                               *
     C*****************************************************************
     C*****      #ZIA      BEGSR                                          S01177
     C*****                                                               S01177
     C*****-------------------------------------------*                   S01177
     C*****Preliminary Validation and Defaulting      *                   S01177
     C*****-------------------------------------------*                   S01177
     C*****                                                               S01177
     C****If the customer field is blank, then all settlement             S01177
     C****instructions must also be blank.                                S01177
     C*****      DDCUST    IFEQ *BLANKS                    B1             S01177
     C*****      @SMT      IFNE *BLANKS                    B*2            S01177
     C*****      @THEIR    ORNE *BLANKS                    B*2            S01177
     C*****      @OUR      ORNE *BLANKS                    B*2            S01177
     C*****      @FORAC    ORNE *BLANKS                    B*2            S01177
     C*****                MOVE '1'       *IN41            **2            S01177
     C*****      *IN66     IFEQ '0'                        B**3           S01177
     C*****                MOVE '1'       *IN66            ***3           S01177
     C*****                MOVEL'MMM0210' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                END                             E**3           S01177
     C*****      @PRIND    IFEQ 'R'                        B**3           S01177
     C*****      DDORCM    IFNE *BLANKS                    B***4          S01177
     C*****                MOVE '1'       *IN31            ****4          S01177
     C*****                END                             E***4          S01177
     C*****      DDMORI    IFNE *BLANKS                    B***4          S01177
     C*****                MOVE '1'       *IN33            ****4          S01177
     C*****                END                             E***4          S01177
     C*****      DDMCPI    IFNE *BLANKS                    B***4          S01177
     C*****                MOVE '1'       *IN35            ****4          S01177
     C*****                END                             E***4          S01177
     C*****      DDMFAO    IFNE *BLANKS                    B***4          S01177
     C*****                MOVE '1'       *IN37            ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****      @PRIND    IFEQ 'P'                        B**3           S01177
     C*****      DDMOPM    IFNE *BLANKS                    B***4          S01177
     C*****                MOVE '1'       *IN32            ****4          S01177
     C*****                END                             E***4          S01177
     C*****      DDMOPI    IFNE *BLANKS                    B***4          S01177
     C*****                MOVE '1'       *IN34            ****4          S01177
     C*****                END                             E***4          S01177
     C*****      DDMCRI    IFNE *BLANKS                    B***4          S01177
     C*****                MOVE '1'       *IN36            ****4          S01177
     C*****                END                             E***4          S01177
     C*****      DDMFAO    IFNE *BLANKS                    B***4          S01177
     C*****                MOVE '1'       *IN37            ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                GOTO #ZIA9                      **2            S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C****If the customer number is non blank and if customer number      S01177
     C**  was previously blank when last displayed on screen, or
     C**  action is insert and default processing has not already
     C**  been done, do default processing
     C*****      DDCUST    IFNE *BLANKS                    B1             S01177
     C*****      DDCUST    ANDNE@XCUST                     B1             S01177
     C*****      @XCUST    ANDEQ*BLANKS                    B1             S01177
     C*****      DDACTN    OREQ 'I'                        B1             S01177
     C*****      DDCUST    ANDNE*BLANKS                    B1             S01177
     C*****      *IN67     ANDEQ'0'                        B1             S01177
     C*****      @PRIND    IFEQ 'P'                        B*2            S01177
     C*****                MOVE '1'       *IN67            **2            S01177
     C*****                END                             E*2            S01177
     C*****                MOVE DDCCY     @CYCCY           *1             S01177
     C*****                MOVE IKCNUM    @CYCNM           *1             S01177
     C*****                MOVE 'MM'      @CTTP            *1      E13747 S01177
     C********** @CYKEY    CHAINFDCCCYLL             68    *1      E13747 S01177
     C*****      @CYKEY    CHAINSTDSI                68    *1      E13747 S01177
     C*****                                                        E13747 S01177
     C** If the default record not found, set default settlement method   E13747
     C** to '00', else move the default pay receive method                E13747
     C*                                                                   E13747
     C** NOTE :- DUE TO ERRORS ON STANDARD SETTLEMENT INPUT CAUSING THE   E13747
     C**         STANDARD SETTLEMENT FILE TO BE UPDATED INCORRECTLY,      E13747
     C**         I.E. RECEIPT INSTNS. UPDATED TO SELL CCY SETTLEMENT;     E13747
     C**              WHEREAS PAY INSTNS. TO PURCHASED CCY SETTLEMENT.    E13747
     C**         THE SETTING UP OF THE FOLLOWING DEFAULT METHODS IS       E13747
     C**         DELIBERATLY INCORRECT, SO THAT THE MASTER FILES ARE      E13747
     C**         UPDATED CORRECTLY.                                       E13747
     C**                                                                  E13747
     C*****      *IN68     IFEQ '1'                        B*2     E13747 S01177
     C*****      RECI      OREQ '*'                        B*2     E13747 S01177
     C*****                MOVE '00'      @DMTD   2        **2     E13747 S01177
     C*****                ELSE                            **2     E13747 S01177
     C*****      @PRIND    IFEQ 'P'                        B**3    E13747 S01177
     C*****                MOVE PCST      @DMTD            ***3    E13747 S01177
     C*****                END                             E**3    E13747 S01177
     C*****      @PRIND    IFEQ 'R'                        B**3    E13747 S01177
     C*****                MOVE SCST      @DMTD            ***3    E13747 S01177
     C*****                END                             E**3    E13747 S01177
     C*****                                                        E13747 S01177
     C*---------------------------------------------------------------*   E13747
     C****If*the pay/receive method is blank and the default method       E13747
     C****exists, then move the default method into the default pay/      E13747
     C****receive method field.                                           E13747
     C********** *IN68     IFEQ '0'                        B*2            E13747
     C********** CCDLTF    ANDEQ*BLANKS                    B*2            E13747
     C********** CCDMTD    IFEQ 'NA    '                   B**3           E13747
     C********** CCDMTD    OREQ *BLANKS                    ***3           E13747
     C**********           MOVE '00'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'TELX  '                   B**3           E13747
     C**********           MOVE '01'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'CHIPS '                   B**3           E13747
     C**********           MOVE '07'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'SWIFT '                   B**3           E13747
     C**********           MOVE '08'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'CSENT '                   B**3           E13747
     C**********           MOVE '02'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'CCOLL '                   B**3           E13747
     C**********           MOVE '12'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'COMP  '                   B**3           E13747
     C**********           MOVE '03'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'PCURR '                   B**3           E13747
     C**********           MOVE '04'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'CURR  '                   B**3           E13747
     C**********           MOVE '14'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'MACC  '                   B**3           E13747
     C**********           MOVE '05'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C********** CCDMTD    IFEQ 'SUSP  '                   B**3           E13747
     C**********           MOVE '06'      @DMTD            ***3           E13747
     C**********           END                             E**3           E13747
     C*---------------------------------------------------------------*   E13747
     C*****                                                               S01177
     C*****      @SMT      IFEQ *BLANKS                    B**3           S01177
     C*****                MOVE @DMTD     @SMT             ***3           S01177
     C*****                MOVE 'Y'       @RECHK           ***3           S01177
     C*****                END                             E**3           S01177
     C*****                                                               S01177
     C**  If the settlement method is the same as the default, carry
     C**  out any defaulting required.
     C*****      @SMT      IFEQ @DMTD                      B**3           S01177
     C*****                                                               S01177
     C**  If our instructions are blank, default instructions exist
     C**  and settlement method is not 00, set up our instructions
     C**  with the default.
     C*****      @OUR      IFEQ *BLANKS                    B***4          S01177
     C*****      @DMTD     ANDNE'00'                       B***4          S01177
     C*****                                                               S01177
     C*****      @PRIND    IFEQ 'P'                        B****5  E13747 S01177
     C*****                MOVELOPCA      @OUR             *****5  E13747 S01177
     C*****                END                             E****5  E13747 S01177
     C*****      @PRIND    IFEQ 'R'                        B****5  E13747 S01177
     C*****                MOVELOSCA      @OUR             *****5  E13747 S01177
     C*****                END                             E****5  E13747 S01177
     C*****                                                        E13747 S01177
     C*---------------------------------------------------------------*   E13747
     C****If*the settlement method is 01,07 or 08, move the bank's        E13747
     C****default nostro number to the our instructions field.            E13747
     C********** @DMTD     IFEQ '01'                       B****5         E13747
     C********** @DMTD     OREQ '07'                       B****5         E13747
     C********** @DMTD     OREQ '08'                       B****5         E13747
     C**********                                                          E13747
     C****Access the nostro file using the nostro shortname and deal      E13747
     C****to*find the corresponding nostro number.                        E13747
     C**********           MOVE NSNM      @NSCNO           *****5         E13747
     C**********           MOVE DDCCY     @NSCCY           *****5         E13747
     C********** @NSKEY    CHAINFDNOSTLL             65    *****5         E13747
     C********** *IN65     IFEQ '1'                        B*****6        E13747
     C********** RECI      OREQ '*'                        B*****6        E13747
     C**********           MOVE *BLANKS   @OUR             ******6        E13747
     C**********           ELSE                            X*****6        E13747
     C**********           MOVE *BLANKS   @OUR             ******6        E13747
     C**********           MOVELNOSN      @OUR             ******6        E13747
     C**********           END                             E*****6        E13747
     C**********           END                             E****5         E13747
     C**********                                                          E13747
     C****If*the settlement method is 05,04 or 14, move the default       E13747
     C****settlement instructions to the our instructions field.          E13747
     C********** @DMTD     IFEQ '05'                       B****5         E13747
     C********** @DMTD     OREQ '04'                       B****5         E13747
     C********** @DMTD     OREQ '14'                       B****5         E13747
     C**********           MOVE *BLANKS   @OUR             *****5         E13747
     C**********                                                          E13747
     C********** @DMTD     IFEQ '14'                       B*****6        E13747
     C**********           MOVELCCACNO    @OUR             ******6        E13747
     C**********           END                             E*****6        E13747
     C**********                                                          E13747
     C********** @DMTD     IFEQ '05'                       B*****6        E13747
     C**********           MOVELIKCNUM    @OUR             ******6        E13747
     C**********           MOVELCCACOD    @TEMP            ******6        E13747
     C**********           MOVE CCACSQ    @TEMP            ******6        E13747
     C**********           MOVE @TEMP     @OUR             ******6        E13747
     C**********           END                             E*****6        E13747
     C**********           END                             E****5         E13747
     C*---------------------------------------------------------------*   E13747
     C*****                                                               S01177
     C*****                END                             E***4          S01177
     C*****                                                               S01177
     C**  If their instructions are blank, default instructions exist
     C**  and settlement method is not 00, set up their instructions
     C**  with the default.
     C*****      @THEIR    IFEQ *BLANKS                    B***4          S01177
     C*****      @DMTD     ANDNE'00'                       B***4          S01177
     C*****                                                               S01177
     C*****      @PRIND    IFEQ 'P'                        B****5  E13747 S01177
     C*****                MOVELTPCN      @THEIR           *****5  E13747 S01177
     C*****                MOVELFACO      @FORAC           *****5  E13747 S01177
     C*****                MOVELSPI       @SPECI           *****5  E13747 S01177
     C*****                END                             E****5  E13747 S01177
     C*****      @PRIND    IFEQ 'R'                        B****5  E13747 S01177
     C*****                MOVELTSCN      @THEIR           *****5  E13747 S01177
     C*****                END                             E****5  E13747 S01177
     C*****                                                        E13747 S01177
     C*---------------------------------------------------------------*   E13747
     C****If*the settlement method is 01,07 or 08, set up the their       E13747
     C****instructions field to hold the customer shortname.              E13747
     C********** @DMTD     IFEQ '01'                       B****5         E13747
     C********** @DMTD     OREQ '07'                       *****5         E13747
     C********** @DMTD     OREQ '08'                       *****5         E13747
     C**********           MOVELCCCSN1    @THEIR           *****5         E13747
     C**********           MOVE CCCSN2    @THEIR           *****5         E13747
     C**********                                                          E13747
     C****Check*to see if the shortname is on the file SNAME.             E13747
     C********** @THEIR    CHAINSNAME                65    *****5         E13747
     C**********                                                          E13747
     C****If*it*is not it will need converting to back office             E13747
     C****counterparty nostro shortname.                                  E13747
     C********** *IN65     IFEQ '1'                        B*****6        E13747
     C********** RECI      OREQ '*'                        B*****6        E13747
     C**********           MOVE @THEIR    @SNNM2           ******6        E13747
     C**********           MOVEL@THEIR    @SNNM1           ******6        E13747
     C**********                                                          E13747
     C****Access the file FDSNAMLL, to obtain the 8 letter counterparty   E13747
     C****nostro shortname.  If it is not found, this is a database       E13747
     C****error.                                                          E13747
     C********** @SNKEY    CHAINFDSNAMLL             65    ******6        E13747
     C********** *IN65     IFEQ '1'                        B******7       E13747
     C********** RECI      OREQ '*'                        B******7       E13747
     C**********           MOVE '1'       *INU7            *******7       E13747
     C**********           MOVE '1'       *INU8            *******7       E13747
     C**********           MOVE '1'       *INLR            *******7       E13747
     C**********           MOVE '1'       *INKA            ***************E13747
     C**********           MOVEL'FDSNAMLL'DBFILE           * DBERROR 004 *E13747
     C**********           MOVEL@THEIR    DBKEY            ***************E13747
     C**********           MOVE '004'     DBASE            *******7       E13747
     C**********           EXSR #C                         *******7       E13747
     C**********           ELSE                            X******7       E13747
     C**********           MOVE KEY       @8               *******7       E13747
     C**********           MOVE *BLANKS   @THEIR           *******7       E13747
     C**********           MOVEL@8        @THEIR           *******7       E13747
     C**********           END                             E******7       E13747
     C**********           END                             E*****6        E13747
     C**********           END                             E****5         E13747
     C*---------------------------------------------------------------*   E13747
     C*****                                                               S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C**  If either of the our or their instructions fields contains
     C**  'NODEF' fill the field with blanks.
     C*****      @OUR      IFEQ 'NODEF'                    B1             S01177
     C*****                MOVE *BLANKS   @OUR             *1             S01177
     C*****                END                             E1             S01177
     C*****      @THEIR    IFEQ 'NODEF'                    B1             S01177
     C*****                MOVE *BLANKS   @THEIR           *1             S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*  *----------------------------*
     C*  * Settlement Type Validation *
     C*  *----------------------------*
     C*****                                                               S01177
     C**  Check to see if the settlement method needs validating
     C*****                MOVE '0'       *IN69                           S01177
     C*****      @SMT      IFEQ *BLANKS                    B1             S01177
     C*****      ICOITM    ANDEQ'Y'                        B1             S01177
     C*****      @STS      ANDEQ'C'                        B1             S01177
     C*****      @SMT      ORNE *BLANKS                    B1             S01177
     C*****      @STS      ORNE 'C'                        B1             S01177
     C*****                                                               S01177
     C**  Validate the settlement method, it must be one of blank
     C**  00, 01, 02, 03, 04, 05, 06, 07, 08, 12, or 14
     C*****      @SMT      IFNE *BLANKS                    B*2            S01177
     C*****      @SMT      ANDNE'00'                       B*2            S01177
     C*****      @SMT      ANDNE'01'                       B*2            S01177
     C*****      @SMT      ANDNE'02'                       B*2            S01177
     C*****      @SMT      ANDNE'03'                       B*2            S01177
     C*****      @SMT      ANDNE'04'                       B*2            S01177
     C*****      @SMT      ANDNE'05'                       B*2            S01177
     C*****      @SMT      ANDNE'06'                       B*2            S01177
     C*****      @SMT      ANDNE'07'                       B*2            S01177
     C*****      @SMT      ANDNE'08'                       B*2            S01177
     C*****      @SMT      ANDNE'12'                       B*2            S01177
     C*****      @SMT      ANDNE'14'                       B*2            S01177
     C*****      @SMT      OREQ '02'                       B*2            S01177
     C*****      @PRIND    ANDEQ'R'                        B*2            S01177
     C*****      @SMT      OREQ '12'                       B*2            S01177
     C*****      @PRIND    ANDEQ'P'                        B*2            S01177
     C*****                MOVE '1'       *IN69            **2            S01177
     C*****                MOVEL'MMM0211' @MSGID           **2            S01177
     C*****                CALL 'ZA0240'                   **2            S01177
     C*****                PARM           @MSGID           **2            S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  If settlement method is blanks change it to 00.
     C*****      @SMT      IFEQ *BLANKS                    B*2            S01177
     C*****                MOVE '00'      @SMT             **2            S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  If settlement type is 04 or 14 and the retail indicator is
     C**  off on TABTB10, then it is an error.
     C*****      @SMT      IFEQ '14'                       B*2            S01177
     C*****      @SMT      OREQ '04'                       B*2            S01177
     C*****                TESTB'2'       MODI1          65**2            S01177
     C*****      *IN65     IFEQ '0'                        B**3           S01177
     C*****                MOVE '1'       *IN69            ***3           S01177
     C*****                MOVEL'MMM0212' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  If the settlement type is 14 and retail account numbers are
     C**  not supported (Retail Acct. Nos. field on TABTB20 is 'N'),
     C**  the settlement method is invalid.
     C*****      @SMT      IFEQ '14'                       B*2            S01177
     C*****      RACN      ANDEQ'N'                        B*2            S01177
     C*****                MOVE '1'       *IN69            **2            S01177
     C*****                MOVEL'MMM0213' @MSGID           **2            S01177
     C*****                CALL 'ZA0240'                   **2            S01177
     C*****                PARM           @MSGID           **2            S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  If the settlement type is 07, the currency code must be the
     C**  one for US dollars,as held on FXTB40LL.
     C*****      @SMT      IFEQ '07'                       B*2            S01177
     C*****      USCY      ANDNEDDCCY                      B*2            S01177
     C*****                MOVE '1'       *IN69            **2            S01177
     C*****                MOVEL'MMM0214' @MSGID           **2            S01177
     C*****                CALL 'ZA0240'                   **2            S01177
     C*****                PARM           @MSGID           **2            S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C**  If an error occurred, set on reverse image indicators for
     C**  either the pay or receive method.
     C*****      *IN69     IFEQ '1'                        B1             S01177
     C*****      @PRIND    IFEQ 'R'                        B*2            S01177
     C*****                MOVE '1'       *IN31            **2            S01177
     C*****                ELSE                            X*2            S01177
     C*****                MOVE '1'       *IN32            **2            S01177
     C*****                END                             E*2            S01177
     C*****                MOVE '1'       *IN41            *1             S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*  *---------------------------*
     C*  * Validate Our Instructions *
     C*  *---------------------------*
     C*****                                                               S01177
     C**  Check to see if any validation is necessary.
     C*****                MOVE '0'       *IN69                           S01177
     C*****      @STS      IFEQ 'C'                        B1             S01177
     C*****      ICOITM    ANDEQ'Y'                        B1             S01177
     C*****      @OUR      ANDEQ*BLANKS                    B1             S01177
     C*****      @OUR      ORNE *BLANKS                    B1             S01177
     C*****      @SMT      OREQ '04'                       B1             S01177
     C*****      @STS      ORNE 'C'                        B1             S01177
     C*****                                                               S01177
     C**  If settlement type is 00 or 06, then ours instructions must
     C**  be blanks.
     C*****      @SMT      IFEQ '00'                       B*2            S01177
     C*****      @OUR      ANDNE*BLANKS                    B*2            S01177
     C*****      @SMT      OREQ '06'                       B*2            S01177
     C*****      @OUR      ANDNE*BLANKS                    B*2            S01177
     C*****                MOVE '1'       *IN69            **2            S01177
     C*****                MOVEL'MMM0216' @MSGID           **2            S01177
     C*****                CALL 'ZA0240'                   **2            S01177
     C*****                PARM           @MSGID           **2            S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  If the settlement type is 01,02,12,07 or 08, and our
     C**  instructions are not blanks...
     C*****      @SMT      IFEQ '01'                       B*2            S01177
     C*****      @SMT      OREQ '02'                       B*2            S01177
     C*****      @SMT      OREQ '12'                       B*2            S01177
     C*****      @SMT      OREQ '07'                       B*2            S01177
     C*****      @SMT      OREQ '08'                       B*2            S01177
     C*****      @OUR      IFNE *BLANKS                    B**3           S01177
     C*****                                                               S01177
     C**  If our instructions is not a 2 digit number it is invalid.
     C*****                Z-ADD2         @@IINT           ***3           S01177
     C*****                Z-ADD0         @@IDP            ***3           S01177
     C*****                MOVE *BLANKS   @@ALPH           ***3           S01177
     C*****                MOVE @OUR      @@ALPH           ***3           S01177
     C*****                EXSR ZA0840                     ***3           S01177
     C*****      @@ERCD    IFNE 0                          B***4          S01177
     C*****                MOVE '1'       *IN69            ****4          S01177
     C*****                MOVEL'MMM0217' @MSGID           ****4          S01177
     C*****                MOVE *BLANKS   @DATA            ****4          S01177
     C*****                MOVEL@SMT      @DATA            ****4          S01177
     C*****                CALL 'ZA0440'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                PARM           @DATA            ****4          S01177
     C*****                ELSE                            X***4          S01177
     C*****                                                               S01177
     C**  If the instructions are valid so far combine them with the
     C**  deal currency to form a key to the nostro file.
     C*****                Z-ADD@@AMT     @TEMP2           ****4          S01177
     C*****                MOVE *BLANKS   @KEY             ****4          S01177
     C*****                MOVE '70'      @KEY1            ****4          S01177
     C*****                MOVELDDCCY     @TEMP3           ****4          S01177
     C*****                MOVE @TEMP2    @TEMP3           ****4          S01177
     C*****                MOVE @TEMP3    @KEY             ****4          S01177
     C*****                                                               S01177
     C**  If our instructions are not 00, validate the nostro number.
     C**  (00 is always valid.)  If no live record is found, this is
     C**  an error.
     C*****      @TEMP2    IFNE 00                         B****5         S01177
     C*****      @KEY      CHAINFDTBLILL             65    *****5         S01177
     C*****      *IN65     IFEQ '1'                        B*****6        S01177
     C*****      RECI      OREQ '*'                        B*****6        S01177
     C*****                MOVE '1'       *IN69            ******6        S01177
     C*****                MOVEL'MMM0218' @MSGID           ******6        S01177
     C*****                MOVE *BLANKS   @DATA            ******6        S01177
     C*****                MOVE @OUR      @TEMT4           ******6        S01177
     C*****                MOVELDDCCY     @TEMT4           ******6        S01177
     C*****                MOVEL@TEMT4    @DATA            ******6        S01177
     C*****                CALL 'ZA0440'                   ******6        S01177
     C*****                PARM           @MSGID           ******6        S01177
     C*****                PARM           @DATA            ******6        S01177
     C*****                                                               S01177
     C**  If a live record exists, carry out account checks.  Access
     C**  the ACCNT file using fields retrieved from the nostro file.
     C*****                ELSE                            X*****6        S01177
     C*****                Z-ADDCNUM      @ACCNM           ******6        S01177
     C*****                MOVE CCY       @ACCCY           ******6        S01177
     C*****                Z-ADDACOD      @ACCDE           ******6        S01177
     C*****                Z-ADDACSQ      @ACSEQ           ******6        S01177
     C*****                EXSR #ZIAA                      ******6        S01177
     C*****                                                               S01177
     C**  Set up error messages according to the results of the account
     C**  checks.
     C*****                MOVE *BLANKS   @WK25            ******6        S01177
     C*****                MOVE *BLANKS   @WK5A            ******6        S01177
     C*****                MOVELCCY       @WK5A            ******6        S01177
     C**********           MOVE NOSN      @WK5A            ******6 E13747 S01177
     C*****                MOVE @OUR      @WK5A            ******6 E13747 S01177
     C*****                MOVE @ENAM     @WK25            ******6        S01177
     C*****                MOVEL@WK5A     @WK25            ******6        S01177
     C*****      @ERCD     IFEQ 1                          B******7       S01177
     C*****                MOVEL'MMM0232' @MSGID           *******7       S01177
     C*****                END                             E******7       S01177
     C*****      @ERCD     IFEQ 2                          B******7       S01177
     C*****                MOVEL'MMM0233' @MSGID           *******7       S01177
     C*****                END                             E******7       S01177
     C*****      @ERCD     IFEQ 3                          B******7       S01177
     C*****                MOVEL'MMM0235' @MSGID           *******7       S01177
     C*****                END                             E******7       S01177
     C*****      @ERCD     IFNE 0                          B******7       S01177
     C*****                MOVE '1'       *IN69            *******7       S01177
     C*****                CALL 'ZA0440'                   *******7       S01177
     C*****                PARM           @MSGID           *******7       S01177
     C*****                PARM           @WK25            *******7       S01177
     C*****                ELSE                            X******7       S01177
     C*****                                                               S01177
     C**  Set up valid our instructions field.
     C*****                Z-ADD@@AMT     @TEMP2           *******7       S01177
     C*****                MOVE *BLANKS   @OUR             *******7       S01177
     C*****                MOVEL@TEMP2    @OUR             *******7       S01177
     C*****                END                             E******7       S01177
     C*****                END                             E*****6        S01177
     C*****                END                             E****5         S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  If the settlement type is 03, our  instructions must contain
     C**  either blanks or a 6 digit number.
     C*****      @SMT      IFEQ '03'                       B*2            S01177
     C*****      @OUR      ANDNE*BLANKS                    B*2            S01177
     C*****                Z-ADD0         @@IDP            **2            S01177
     C*****                Z-ADD6         @@IINT           **2            S01177
     C*****                MOVE *BLANKS   @@ALPH           **2            S01177
     C*****                MOVE @OUR      @@ALPH           **2            S01177
     C*****                EXSR ZA0840                     **2            S01177
     C*****      @@ERCD    IFEQ 0                          B**3           S01177
     C*****                MOVE *BLANKS   @OUR             ***3           S01177
     C*****                Z-ADD@@AMT     @TEMP5           ***3           S01177
     C*****                MOVEL@TEMP5    @OUR             ***3           S01177
     C*****                ELSE                            X**3           S01177
     C*****                MOVE '1'       *IN69            ***3           S01177
     C*****                MOVEL'MMM0219' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  If our instructions for settlement type 04, are not blank and
     C**  are not the same as the value on file, it is an error.
     C*****      @SMT      IFEQ '04'                       B*2            S01177
     C*****      DDACTN    IFEQ 'I'                        B**3           S01177
     C*****      @OUR      ANDNE*BLANKS                    B**3           S01177
     C*****      DDACTN    ORNE 'I'                        B**3           S01177
     C*****      @PRIND    ANDEQ'R'                        B**3           S01177
     C*****      DDMORI    ANDNEHKMORI                     B**3           S01177
     C*****      DDMORI    ANDNE*BLANKS                    B**3           S01177
     C*****      DDACTN    ORNE 'I'                        B**3           S01177
     C*****      @PRIND    ANDEQ'P'                        B**3           S01177
     C*****      DDMOPI    ANDNEHKMOPI                     B**3           S01177
     C*****      DDMOPI    ANDNE*BLANKS                    B**3           S01177
     C*****                MOVE '1'       *IN69            ***3           S01177
     C*****      @PRIND    IFEQ 'P'                        B***4          S01177
     C*****                MOVE @MOPI     DDMOPI           ****4          S01177
     C*****                ELSE                            X***4          S01177
     C*****                MOVE @MORI     DDMORI           ****4          S01177
     C*****                END                             E***4          S01177
     C*****                MOVEL'MMM0220' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                                                               S01177
     C**  Otherwise, perform account checks.
     C*****                ELSE                            X**3           S01177
     C*****                Z-ADDIKCNUM    @ACCNM           ***3           S01177
     C*****                MOVE DDCCY     @ACCCY           ***3           S01177
     C*****                Z-ADDCADC      @ACCDE           ***3           S01177
     C*****                Z-ADD1         @ACSEQ           ***3           S01177
     C*****                EXSR #ZIAA                      ***3           S01177
     C*****                                                               S01177
     C**  Set up error messages according to the results of the account
     C**  checks.
     C*****      @ERCD     IFEQ 1                          B***4          S01177
     C*****                MOVEL'MMM0236' @MSGID           ****4          S01177
     C*****                CALL 'ZA0240'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                END                             E***4          S01177
     C*****                MOVE *BLANKS   @WK25            ***3           S01177
     C*****                MOVEL@ENAM     @WK25            ***3           S01177
     C*****      @ERCD     IFEQ 2                          B***4          S01177
     C*****                MOVEL'MMM0237' @MSGID           ****4          S01177
     C*****                CALL 'ZA0440'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                PARM           @WK25            ****4          S01177
     C*****                END                             E***4          S01177
     C*****      @ERCD     IFEQ 3                          B***4          S01177
     C*****                MOVEL'MMM0239' @MSGID           ****4          S01177
     C*****                CALL 'ZA0440'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                PARM           @WK25            ****4          S01177
     C*****                END                             E***4          S01177
     C*****      @ERCD     IFNE 0                          B***4          S01177
     C*****                MOVE '1'       *IN69            ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  Validate our instructions for settlement type 05.
     C*****      @SMT      IFEQ '05'                       B*2            S01177
     C*****                                                               S01177
     C**  Check whether our instructions are a 10 digit number.
     C*****                Z-ADD10        @@IINT           **2            S01177
     C*****                Z-ADD0         @@IDP            **2            S01177
     C*****                MOVE *BLANKS   @@ALPH           **2            S01177
     C*****                MOVE @OUR      @@ALPH           **2            S01177
     C*****                EXSR ZA0840                     **2            S01177
     C*****                                                               S01177
     C**  If the instructions are valid, reallign the number and set a
     C**  flag to indicate that they are ten long.
     C*****                MOVE @OUR      @X1              **2            S01177
     C*****      @@ERCD    IFEQ 0                          B**3           S01177
     C*****      @OUR      ANDNE*BLANKS                    B**3           S01177
     C*****      @X1       ANDEQ*BLANKS                    B**3           S01177
     C*****                MOVE 'Y'       @TEN             ***3           S01177
     C*****                Z-ADD@@AMT     @TEND            ***3           S01177
     C*****                MOVE *BLANKS   @OUR             ***3           S01177
     C*****                MOVEL@TEND     @OUR             ***3           S01177
     C*****                ELSE                            X**3           S01177
     C*****                                                               S01177
     C**  If the number is not 10 digits long, check whether it is 12
     C**  long.
     C*****                Z-ADD0         @@IDP            ***3           S01177
     C*****                MOVE *BLANKS   @@ALPH           ***3           S01177
     C*****                MOVE @OUR      @@ALPH           ***3           S01177
     C*****                Z-ADD12        @@IINT           ***3           S01177
     C*****                EXSR ZA0840                     ***3           S01177
     C*****                                                               S01177
     C**  If the number is twelve digits long, set the ten long flag to
     C**  'N', and set up the our instructions field.
     C*****      @@ERCD    IFEQ 0                          B***4          S01177
     C*****      @OUR      ANDNE*BLANKS                    B***4          S01177
     C*****                MOVE 'N'       @TEN             ****4          S01177
     C*****                Z-ADD@@AMT     @TWLV            ****4          S01177
     C*****                MOVE *BLANKS   @OUR             ****4          S01177
     C*****                MOVEL@TWLV     @OUR             ****4          S01177
     C*****                ELSE                            *X**4          S01177
     C*****                                                               S01177
     C**  If the instructions are neither 10 nor 12 digits long, it is
     C**  an error.
     C*****                MOVE '1'       *IN69            ****4          S01177
     C*****                MOVEL'MMM0221' @MSGID           ****4          S01177
     C*****                CALL 'ZA0240'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                                                               S01177
     C**  If no error in our instructions has so far been found, access
     C**  ACCNT file and perform account checks.
     C*****      *IN69     IFEQ '0'                        B**3           S01177
     C*****                Z-ADD@CUN      @ACCNM           ***3           S01177
     C*****                MOVE DDCCY     @ACCCY           ***3           S01177
     C*****                Z-ADD@ACD      @ACCDE           ***3           S01177
     C*****      @TEN      IFEQ 'Y'                        B***4          S01177
     C*****      @SEQ      OREQ 0                          ****4          S01177
     C*****                Z-ADD1         @ACSEQ           ****4          S01177
     C*****                ELSE                            X***4          S01177
     C*****                Z-ADD@SEQ      @ACSEQ           ****4          S01177
     C*****                END                             E***4          S01177
     C*****                EXSR #ZIAA                      ***3           S01177
     C*****                                                               S01177
     C**  Set up error messages according to the results of the account
     C**  checks.
     C*****      @ERCD     IFEQ 1                          B***4          S01177
     C*****                MOVEL'MMM0256' @MSGID           ****4          S01177
     C*****                END                             E***4          S01177
     C*****      @ERCD     IFEQ 2                          B***4          S01177
     C*****                MOVEL'MMM0257' @MSGID           ****4          S01177
     C*****                END                             E***4          S01177
     C*****      @ERCD     IFEQ 3                          B***4          S01177
     C*****                MOVEL'MMM0259' @MSGID           ****4          S01177
     C*****                END                             E***4          S01177
     C*****      @ERCD     IFNE 0                          B***4          S01177
     C*****                MOVE *BLANKS   @WK35            ****4          S01177
     C*****                MOVE *BLANKS   @T11             ****4          S01177
     C*****                MOVEL@OUR      @T11             ****4          S01177
     C*****                MOVE DDCCY     @T11             ****4          S01177
     C*****                MOVEL@T11      @WK35            ****4          S01177
     C*****                MOVE @ENAM     @WK35            ****4          S01177
     C*****                CALL 'ZA0440'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                PARM           @WK35            ****4          S01177
     C*****                MOVE '1'       *IN69            ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  Validate our instructions for settlement type 14.
     C*****      @SMT      IFEQ '14'                       B*2            S01177
     C*****                                                               S01177
     C**  If our instructions are blank or the number is not a 10 digit
     C**  retail account code, then it is invalid.
     C*****      @OUR      IFNE *BLANKS                    B**3           S01177
     C*****                Z-ADD10        @@IINT           ***3           S01177
     C*****                Z-ADD0         @@IDP            ***3           S01177
     C*****                MOVE *BLANKS   @@ALPH           ***3           S01177
     C*****                MOVE @OUR      @@ALPH           ***3           S01177
     C*****                EXSR ZA0840                     ***3           S01177
     C*****                END                             E**3           S01177
     C*****                                                               S01177
     C*****      @OUR      IFEQ *BLANKS                    B**3           S01177
     C*****      @@ERCD    ORNE 0                          B**3           S01177
     C*****                MOVE '1'       *IN69            ***3           S01177
     C*****                MOVEL'MMM0222' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                ELSE                            X**3           S01177
     C*****                                                               S01177
     C**  Check to see whether the retail account exists.
     C*****                Z-ADD@@AMT     @REKEY           ***3           S01177
     C*****      @REKEY    CHAINFDRETALL             65    ***3           S01177
     C*****                                                               S01177
     C**  If no live record exists, it is an error.
     C*****      *IN65     IFEQ '1'                        B***4          S01177
     C*****      RECI      OREQ '*'                        B***4          S01177
     C*****                MOVE '1'       *IN69            ****4          S01177
     C*****                MOVEL'MMM0223' @MSGID           ****4          S01177
     C*****                MOVE *BLANKS   @DATA            ****4          S01177
     C*****                MOVEL@REKEY    @DATA            ****4          S01177
     C*****                CALL 'ZA0440'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                PARM           @DATA            ****4          S01177
     C*****                ELSE                            X***4          S01177
     C*****                                                               S01177
     C**  Check the currency of the account equals the deal currency.
     C*****      CCY       IFNE DDCCY                      B****5         S01177
     C*****                MOVE '1'       *IN69            *****5         S01177
     C*****                MOVE *BLANKS   @DATA            *****5         S01177
     C*****                MOVEL@REKEY    @DATA            *****5         S01177
     C*****                MOVEL'MMM0224' @MSGID           *****5         S01177
     C*****                CALL 'ZA0440'                   *****5         S01177
     C*****                PARM           @MSGID           *****5         S01177
     C*****                PARM           @DATA            *****5         S01177
     C*****                ELSE                            X****5         S01177
     C*****                                                               S01177
     C**  If the instructions are valid so far, perform account checks.
     C**  The flag @RET is set to 'Y' to prevent ACCNT being reread.
     C** set on the retail account read indicator
     C*****                MOVE 'Y'       @RET             *****5         S01177
     C*****                EXSR #ZIAA                      *****5         S01177
     C*****                MOVE 'N'       @RET             *****5         S01177
     C*****                                                               S01177
     C**  Set up error messages according to the results of the account
     C**  checks.
     C*****                MOVE *BLANKS   @WK30            *****5         S01177
     C*****      @ERCD     IFEQ 1                          B*****6        S01177
     C*****                MOVEL'MMM0240' @MSGID           ******6        S01177
     C*****                MOVE @@AMT     @WK10            ******6        S01177
     C*****                MOVEL@WK10     @WK30            ******6        S01177
     C*****                END                             E*****6        S01177
     C*****      @ERCD     IFEQ 2                          B*****6        S01177
     C*****                MOVEL'MMM0241' @MSGID           ******6        S01177
     C*****                MOVE @@AMT     @WK10            ******6        S01177
     C*****                MOVEL@WK10     @WK30            ******6        S01177
     C*****                MOVE @ENAM     @WK30            ******6        S01177
     C*****                END                             E*****6        S01177
     C*****      @ERCD     IFEQ 3                          B*****6        S01177
     C*****                MOVEL'MMM0243' @MSGID           ******6        S01177
     C*****                MOVEL@ENAM     @WK30            ******6        S01177
     C*****                END                             E*****6        S01177
     C*****      @ERCD     IFNE 0                          B*****6        S01177
     C*****                MOVE '1'       *IN69            ******6        S01177
     C*****                CALL 'ZA0440'                   ******6        S01177
     C*****                PARM           @MSGID           ******6        S01177
     C*****                PARM           @WK30            ******6        S01177
     C*****                END                             E*****6        S01177
     C*****                END                             E****5         S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C**  If any errors have occurred in the validation of our instr-
     C**  uctions, set up the relevant fields to be in reverse image.
     C*****      *IN69     IFEQ '1'                        B1             S01177
     C*****      @PRIND    IFEQ 'R'                        B*2            S01177
     C*****                MOVE '1'       *IN33            **2            S01177
     C*****                ELSE                            X*2            S01177
     C*****                MOVE '1'       *IN34            **2            S01177
     C*****                END                             E*2            S01177
     C*****                MOVE '1'       *IN41            *1             S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*  *-----------------------------*
     C*  * Validate Their Instructions *
     C*  *-----------------------------*
     C*****                                                               S01177
     C*****                MOVE '0'       *IN69                           S01177
     C*****                MOVE '0'       *IN65                           S01177
     C*****                                                               S01177
     C**  Check to see if any validation is necessary.
     C*****      @THEIR    IFEQ *BLANKS                    B1             S01177
     C*****      @STS      ANDEQ'C'                        B1             S01177
     C*****      ICCITM    ANDEQ'Y'                        B1             S01177
     C*****      @THEIR    ORNE *BLANKS                    B1             S01177
     C*****      @STS      ORNE 'C'                        B1             S01177
     C*****                                                               S01177
     C**  If the settlement type is not 01,07,08 and their settlement
     C**  instructions are not blank, it is an error.
     C*****      @THEIR    IFNE *BLANKS                    B*2            S01177
     C*****      @SMT      IFNE '01'                       B**3           S01177
     C*****      @SMT      ANDNE'07'                       B**3           S01177
     C*****      @SMT      ANDNE'08'                       B**3           S01177
     C*****      @PRIND    IFEQ 'R'                        B***4          S01177
     C*****                MOVE '1'       *IN35            ****4          S01177
     C*****                ELSE                            X***4          S01177
     C*****                MOVE '1'       *IN36            ****4          S01177
     C*****                END                             E***4          S01177
     C*****                MOVEL'MMM0226' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                ELSE                            X**3           S01177
     C*****                                                               S01177
     C**  If the field contains 6 numeric characters, then use the
     C**  customer number to chain to CLINT.
     C*****                Z-ADD0         @@IDP            ***3           S01177
     C*****                Z-ADD6         @@IINT           ***3           S01177
     C*****                MOVE *BLANKS   @@ALPH           ***3           S01177
     C*****                MOVE @THEIR    @@ALPH           ***3           S01177
     C*****                EXSR ZA0840                     ***3           S01177
     C*****      @@ERCD    IFEQ 0                          B***4          S01177
     C*****                Z-ADD@@AMT     @CNUM            ****4          S01177
     C*****      @CLTKY    CHAINCLINT                65    ****4          S01177
     C*****      RECI      IFNE 'D'                        B****5         S01177
     C*****                MOVE '1'       *IN65            *****5         S01177
     C*****                END                             E****5         S01177
     C*****      *IN65     IFEQ '0'                        B****5         S01177
     C*****                MOVE *BLANKS   @THEIR           *****5         S01177
     C*****                MOVEL@CNUM     @THEIR           *****5         S01177
     C*****                END                             E****5         S01177
     C*****                END                             E***4          S01177
     C*****                                                               S01177
     C**  If the field is not 6 numeric characters, then try to access
     C**  SNAME using the field as a shortname.
     C*****      *IN65     IFEQ '1'                        B***4          S01177
     C*****      @@ERCD    ORNE 0                          B***4          S01177
     C*****      @THEIR    CHAINSNAME                65    ****4          S01177
     C*****      RECI      IFNE 'D'                        B****5         S01177
     C*****                MOVE '1'       *IN65            *****5         S01177
     C*****                END                             E****5         S01177
     C*****                END                             E***4          S01177
     C*****                                                               S01177
     C**  If the field is not a valid key for either of the files
     C**  accessed so far, and the settlement type is 01, use the
     C**  first 8 chars. as a key to FDCPTILL.
     C*****      *IN65     IFEQ '1'                        B***4          S01177
     C*****      @SMT      ANDEQ'01'                       B***4          S01177
     C*****                MOVE *BLANKS   @KEY             ****4          S01177
     C*****                MOVE '71'      @KEY1            ****4          S01177
     C*****                MOVEL@THEIR    @8               ****4          S01177
     C*****                MOVE @8        @KEY             ****4          S01177
     C*****      @KEY      CHAINFDCPTILL             65    ****4          S01177
     C*****      RECI      IFNE 'D'                        B****5         S01177
     C*****                MOVE '1'       *IN65            *****5         S01177
     C*****                END                             E****5         S01177
     C*****      *IN65     IFEQ '0'                        B****5         S01177
     C*****                MOVELCSN1      CSNM             *****5         S01177
     C*****                MOVE CSN2      CSNM             *****5         S01177
     C*****                END                             E****5         S01177
     C*****                END                             E***4          S01177
     C*****                                                               S01177
     C**  If the field is not a valid key for any of the three files
     C**  accessed so far, this is an error.
     C*****      *IN65     IFEQ '1'                        B***4          S01177
     C*****      @SMT      IFEQ '01'                       B****5         S01177
     C*****                MOVEL'MMM0227' @MSGID           *****5         S01177
     C*****                ELSE                            X****5         S01177
     C*****                MOVEL'MMM0228' @MSGID           *****5         S01177
     C*****                END                             E****5         S01177
     C*****                CALL 'ZA0240'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*******    @PRIND    IFEQ 'R'                        B****5
     C*******              MOVE '1'       *IN35            *****5
     C*******              ELSE                            X****5
     C*******              MOVE '1'       *IN36            *****5
     C*******              END                             E****5
     C*******              MOVE '1'       *IN41            ****4
     C*****                END                             E***4          S01177
     C*****                                                               S01177
     C**  If a customer settlement nostro has been found must check
     C**  that it has the correct location code for the deal currency.
     C*****      *IN65     IFEQ '0'                        B***4          S01177
     C**********           MOVE CSNM      @NSCNO           ****4   E14363 S01177
     C**********           MOVE DDCCY     @NSCCY           ****4   E14363 S01177
     C********** @NSPKY    CHAINFDNOSTLL             65    ****4   E14363 S01177
     C********** *IN65     IFEQ '1'                        B****5  E14363 S01177
     C********** RECI      ORNE 'D'                        B****5  E14363 S01177
     C**********           MOVE '1'       *IN69            *****5  E14363 S01177
     C**********           MOVEL'MMM0218' @MSGID           *E13873 E14363 S01177
     C**********           MOVEL'MMM0284' @MSGID           *E13873 E14363 S01177
     C**********           MOVE *BLANKS   @DATA            *****5  E14363 S01177
     C**********           MOVE @THEIR    @TEMT5 13        *****5  E14363 S01177
     C**********           MOVELDDCCY     @TEMT5           *****5  E14363 S01177
     C**********           MOVEL@TEMT5    @DATA            *****5  E14363 S01177
     C**********           CALL 'ZA0440'                   *****5  E14363 S01177
     C**********           PARM           @MSGID           *****5  E14363 S01177
     C**********           PARM           @DATA            *****5  E14363 S01177
     C**********           END                             E****5  E14363 S01177
     C*****                MOVE CSNM      @LCOD   3        ****4   E14363 S01177
     C*****      @LCOD     CHAINFDLCY1LL             60    ****4   E14363 S01177
     C*****                                                        E14363 S01177
     C**  If the chain fails or RECI is not 'D' then it is a data base    E14363
     C**  error.                                                          E14363
     C*****      *IN60     IFEQ '1'                        B****5  E14363 S01177
     C*****      RECI      ORNE 'D'                        *****5  E14363 S01177
     C*****                MOVE '1'       *INU7            *****5  E14363 S01177
     C*****                MOVE '1'       *INU8            ********E14363 S01177
     C*****                MOVEL'FDLCY1LL'DBFILE           * DBERROR 009 *S01177
     C*****                MOVEL@LCOD     DBKEY            ********E14363 S01177
     C*****                MOVE '009'     DBASE            *****5  E14363 S01177
     C*****                MOVE '1'       *INLR            *****5  E14363 S01177
     C*****                MOVE '1'       *INKA            *****5  E14363 S01177
     C*****                DUMP                            *****5  E14363 S01177
     C*****                GOTO #ZIA9                      *****5  E14363 S01177
     C*****                END                             E****5  E14363 S01177
     C*****                                                        E14363 S01177
     C**  Compare deal currency with location code currency.              E14363
     C*****      DDCCY     IFNE LCLCCY                     B****5  E14363 S01177
     C*****                MOVE '1'       *IN65            *****5  E14363 S01177
     C*****                END                             E****5  E14363 S01177
     C*****                                                        E14363 S01177
     C*****      *IN65     IFEQ '1'                        B****5  E14363 S01177
     C*****                MOVE '1'       *IN69            *****5  E14363 S01177
     C*****                MOVEL'MMM0284' @MSGID           *****5  E14363 S01177
     C*****                MOVE *BLANKS   @DATA            *****5  E14363 S01177
     C*****                MOVE @THEIR    @TEMT5 13        *****5  E14363 S01177
     C*****                MOVELDDCCY     @TEMT5           *****5  E14363 S01177
     C*****                MOVEL@TEMT5    @DATA            *****5  E14363 S01177
     C*****                CALL 'ZA0440'                   *****5  E14363 S01177
     C*****                PARM           @MSGID           *****5  E14363 S01177
     C*****                PARM           @DATA            *****5  E14363 S01177
     C*****                END                             E****5  E14363 S01177
     C*****                                                               S01177
     C*****                END                             E***4          S01177
     C*****      *IN65     IFEQ '1'                        B***4          S01177
     C*****      @PRIND    IFEQ 'R'                        B****5         S01177
     C*****                MOVE '1'       *IN35            *****5         S01177
     C*****                ELSE                            X****5         S01177
     C*****                MOVE '1'       *IN36            *****5         S01177
     C*****                END                             E****5         S01177
     C*****                MOVE '1'       *IN41            ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*  *-------------------------*
     C*  * Validate For Account Of *
     C*  *-------------------------*
     C*****                                                               S01177
     C**  If the 'Pay' instructions are being validated, and the for
     C**  account of field is not blank, validate the field.
     C*****      @PRIND    IFEQ 'P'                        B1             S01177
     C*****      @FORAC    IFNE *BLANKS                    B*2            S01177
     C*****                                                               S01177
     C**  If the pay method is not 01,07 or 08, it is an error.
     C*****      @SMT      IFNE '01'                       B**3           S01177
     C*****      @SMT      ANDNE'07'                       B**3           S01177
     C*****      @SMT      ANDNE'08'                       B**3           S01177
     C*****                MOVE '1'       *IN37            ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                MOVEL'MMM0231' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                ELSE                            X**3           S01177
     C*****                                                               S01177
     C**  If the for account of field is 6 numeric characters, use it
     C**  to chain to CLINT.
     C*****                Z-ADD0         @@IDP            ***3           S01177
     C*****                Z-ADD6         @@IINT           ***3           S01177
     C*****                MOVE *BLANKS   @@ALPH           ***3           S01177
     C*****                MOVE @FORAC    @@ALPH           ***3           S01177
     C*****                EXSR ZA0840                     ***3           S01177
     C*****      @@ERCD    IFEQ 0                          B***4          S01177
     C*****                Z-ADD@@AMT     @CNUM            ****4          S01177
     C*****      @CLTKY    CHAINCLINT                65    ****4          S01177
     C*****      RECI      IFNE 'D'                        B****5         S01177
     C*****                MOVE '1'       *IN65            *****5         S01177
     C*****                END                             E****5         S01177
     C*****      *IN65     IFEQ '0'                        B****5         S01177
     C*****                MOVE *BLANKS   @FORAC           *****5         S01177
     C*****                MOVEL@CNUM     @FORAC           *****5         S01177
     C*****                END                             E****5         S01177
     C*****                END                             E***4          S01177
     C*****                                                               S01177
     C**  If the field is not 6 numeric characters, then try to access
     C**  SNAME using the field as a shortname.
     C*****      *IN65     IFEQ '1'                        B***4          S01177
     C*****      @@ERCD    ORNE 0                          B***4          S01177
     C*****      @FORAC    CHAINSNAME                65    ****4          S01177
     C*****      RECI      IFNE 'D'                        B****5         S01177
     C*****                MOVE '1'       *IN65            *****5         S01177
     C*****                END                             E****5         S01177
     C*****                END                             E***4          S01177
     C*****                                                               S01177
     C**  If the field is not a valid key for either of the files
     C**  accessed so far, and the settlement type is 01, use the
     C**  first 8 chars. as a key to FDCPTILL.
     C*****      *IN65     IFEQ '1'                        B***4          S01177
     C*****      @SMT      ANDEQ'01'                       B***4          S01177
     C*****                MOVE *BLANKS   @KEY             ****4          S01177
     C*****                MOVE '71'      @KEY1            ****4          S01177
     C*****                MOVEL@FORAC    @8               ****4          S01177
     C*****                MOVE @8        @KEY             ****4          S01177
     C*****      @KEY      CHAINFDCPTILL             65    ****4          S01177
     C*****      RECI      IFNE 'D'                        B****5         S01177
     C*****                MOVE '1'       *IN65            *****5         S01177
     C*****                END                             E****5         S01177
     C*****                END                             E***4          S01177
     C*****                                                               S01177
     C**  If the field is not a valid key for any of the three files
     C**  accessed so far, this is an error.
     C*****      *IN65     IFEQ '1'                        B***4          S01177
     C*****      @SMT      IFEQ '01'                       B****5         S01177
     C*****                MOVEL'MMM0229' @MSGID           *****5         S01177
     C*****                ELSE                            X****5         S01177
     C*****                MOVEL'MMM0230' @MSGID           *****5         S01177
     C*****                END                             E****5         S01177
     C*****                CALL 'ZA0240'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                MOVE '1'       *IN41            ****4          S01177
     C*****                MOVE '1'       *IN37            ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*****      #ZIA9     ENDSR                           **#ZIA9**      S01177
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZIC     - Revalidate dates after assignment of settlement    *
     C*              instruction defaults for those validation checks *
     C*              which relate to pay/receive method               *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #ZI    - Validates the screen input for I,A and X. *
     C*                                                               *
     C* FLDS USED: @MSGID - Message id field.                         *
     C*                                                               *
     C*****************************************************************
     C*****      #ZIC      BEGSR                                          S01177
     C*****                                                               S01177
     C*  *------------------------*
     C*  * Revalidate Value Date  *
     C*  *------------------------*
     C*****                                                               S01177
     C**  Find whether the date is a holiday in the deal currency.
     C*****                MOVE DDCCY     @@CCY                           S01177
     C*****                Z-ADDIKDVSD    @@MNO                           S01177
     C*****                EXSR ZA0830                                    S01177
     C*****                                                               S01177
     C**  If the date is not a working day in the deal currency and the
     C**  receive method is 01,07,08, and the deal type is IT,CD,CI or
     C**  TD, this is an error.
     C*****      DDTYPE    IFEQ 'IT'                       B1             S01177
     C*****      DDTYPE    OREQ 'CD'                       B1             S01177
     C*****      DDTYPE    OREQ 'CI'                       B1             S01177
     C*****      DDTYPE    OREQ 'TD'                       B1             S01177
     C*****                                                               S01177
     C*****      DDORCM    IFEQ '01'                       B*2            S01177
     C*****      DDORCM    OREQ '07'                       B*2            S01177
     C*****      DDORCM    OREQ '08'                       B*2            S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B**3           S01177
     C*****                MOVE '1'       *IN11            ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                MOVEL'MMM0129' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  If the date is not a working day in the deal currency and the
     C**  pay method is 01,07,08, and the deal type is not IT,CD,CI or
     C**  TD, this is an error.
     C*****                ELSE                            X1             S01177
     C*****                                                               S01177
     C*****      DDMOPM    IFEQ '01'                       B*2            S01177
     C*****      DDMOPM    OREQ '07'                       B*2            S01177
     C*****      DDMOPM    OREQ '08'                       B*2            S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B**3           S01177
     C*****                MOVE '1'       *IN11            ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                MOVEL'MMM0129' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C**  Find whether the date is a holiday in the local currency.
     C*****                MOVE LOCY      @@CCY                           S01177
     C*****                Z-ADDIKDVSD    @@MNO                           S01177
     C*****                EXSR ZA0830                                    S01177
     C*****                                                               S01177
     C**  If settlement method is not blank,00,01,07 or 08 and it is
     C**  not a working day in the local currency, it is an error.
     C*****      DDORCM    IFNE *BLANKS                    B1             S01177
     C*****      DDORCM    ANDNE'00'                       B1             S01177
     C*****      DDORCM    ANDNE'01'                       B1             S01177
     C*****      DDORCM    ANDNE'07'                       B1             S01177
     C*****      DDORCM    ANDNE'08'                       B1             S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B*2            S01177
     C*****                MOVE '1'       *IN11            **2            S01177
     C*****                MOVE '1'       *IN41            **2            S01177
     C*****                MOVEL'MMM0131' @MSGID           **2            S01177
     C*****                CALL 'ZA0240'                   **2            S01177
     C*****                PARM           @MSGID           **2            S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*****      DDMOPM    IFNE *BLANKS                    B1             S01177
     C*****      DDMOPM    ANDNE'00'                       B1             S01177
     C*****      DDMOPM    ANDNE'01'                       B1             S01177
     C*****      DDMOPM    ANDNE'07'                       B1             S01177
     C*****      DDMOPM    ANDNE'08'                       B1             S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B*2            S01177
     C*****                MOVE '1'       *IN11            **2            S01177
     C*****                MOVE '1'       *IN41            **2            S01177
     C*****                MOVEL'MMM0131' @MSGID           **2            S01177
     C*****                CALL 'ZA0240'                   **2            S01177
     C*****                PARM           @MSGID           **2            S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*  *--------------------------*
     C*  * Revalidate Maturity Date *
     C*  *--------------------------*
     C*****                                                               S01177
     C*****      IKMATD    IFNE *ZERO                      B1             S01177
     C*****                                                               S01177
     C**  Find whether the date is a holiday in the deal currency.
     C*****                MOVE DDCCY     @@CCY            *1             S01177
     C*****                Z-ADDIKMATD    @@MNO            *1             S01177
     C*****                EXSR ZA0830                     *1             S01177
     C*****                                                               S01177
     C**  If the date is not a working day in the deal currency and the
     C**  receive method is 01,07,08, and the deal type is IT,CD,CI or
     C**  TD, this is an error.
     C*****      DDTYPE    IFEQ 'IT'                       B*2            S01177
     C*****      DDTYPE    OREQ 'CD'                       B*2            S01177
     C*****      DDTYPE    OREQ 'CI'                       B*2            S01177
     C*****      DDTYPE    OREQ 'TD'                       B*2            S01177
     C*****                                                               S01177
     C*****      DDMOPM    IFEQ '01'                       B**3           S01177
     C*****      DDMOPM    OREQ '07'                       B**3           S01177
     C*****      DDMOPM    OREQ '08'                       B**3           S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B***4          S01177
     C*****                MOVE '1'       *IN12            ****4          S01177
     C*****                MOVE '1'       *IN41            ****4          S01177
     C*****                MOVEL'MMM0134' @MSGID           ****4          S01177
     C*****                CALL 'ZA0240'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                                                               S01177
     C**  If the date is not a working day in the deal currency and the
     C**  pay method is 01,07,08, and the deal type is not IT,CD,CI or
     C**  TD, this is an error.
     C*****                ELSE                            X*2            S01177
     C*****                                                               S01177
     C*****      DDORCM    IFEQ '01'                       B**3           S01177
     C*****      DDORCM    OREQ '07'                       B**3           S01177
     C*****      DDORCM    OREQ '08'                       B**3           S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B***4          S01177
     C*****                MOVE '1'       *IN12            ****4          S01177
     C*****                MOVE '1'       *IN41            ****4          S01177
     C*****                MOVEL'MMM0134' @MSGID           ****4          S01177
     C*****                CALL 'ZA0240'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                                                               S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  Find whether the date is a holiday in the local currency.
     C*****                MOVE LOCY      @@CCY            *1             S01177
     C*****                Z-ADDIKMATD    @@MNO            *1             S01177
     C*****                EXSR ZA0830                     *1             S01177
     C*****                                                               S01177
     C**  If settlement method is not blank,00,01,07 or 08 and it is
     C**  not a working day in the local currency, it is an error.
     C*****      DDORCM    IFNE *BLANKS                    B*2            S01177
     C*****      DDORCM    ANDNE'00'                       B*2            S01177
     C*****      DDORCM    ANDNE'01'                       B*2            S01177
     C*****      DDORCM    ANDNE'07'                       B*2            S01177
     C*****      DDORCM    ANDNE'08'                       B*2            S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B**3           S01177
     C*****                MOVE '1'       *IN12            ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                MOVEL'MMM0135' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C*****      DDMOPM    IFNE *BLANKS                    B*2            S01177
     C*****      DDMOPM    ANDNE'00'                       B*2            S01177
     C*****      DDMOPM    ANDNE'01'                       B*2            S01177
     C*****      DDMOPM    ANDNE'07'                       B*2            S01177
     C*****      DDMOPM    ANDNE'08'                       B*2            S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B**3           S01177
     C*****                MOVE '1'       *IN12            ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                MOVEL'MMM0135' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*  *-------------------------------*
     C*  * Revalidate Next Interest Date *
     C*  *-------------------------------*
     C*****                                                               S01177
     C*****      IKNIPD    IFNE *ZERO                      B1             S01177
     C*****                                                               S01177
     C**  Find whether the date is a holiday in the deal currency.
     C*****                MOVE DDCCY     @@CCY            *1             S01177
     C*****                Z-ADDIKNIPD    @@MNO            *1             S01177
     C*****                EXSR ZA0830                     *1             S01177
     C*****                                                               S01177
     C**  If the date is not a working day in the deal currency and the
     C**  receive method is 01,07,08, and the deal type is IT,CD,CI or
     C**  TD, this is an error.
     C*****      DDTYPE    IFEQ 'IT'                       B*2            S01177
     C*****      DDTYPE    OREQ 'CD'                       B*2            S01177
     C*****      DDTYPE    OREQ 'CI'                       B*2            S01177
     C*****      DDTYPE    OREQ 'TD'                       B*2            S01177
     C*****                                                               S01177
     C*****      DDMOPM    IFEQ '01'                       B**3           S01177
     C*****      DDMOPM    OREQ '07'                       B**3           S01177
     C*****      DDMOPM    OREQ '08'                       B**3           S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B***4          S01177
     C*****                MOVE '1'       *IN24            ****4          S01177
     C*****                MOVE '1'       *IN41            ****4          S01177
     C*****                MOVEL'MMM0444' @MSGID           ****4          S01177
     C*****                CALL 'ZA0240'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                                                               S01177
     C**  If the date is not a working day in the deal currency and the
     C**  pay method is 01,07,08, and the deal type is not IT,CD,CI or
     C**  TD, this is an error.
     C*****                ELSE                            X*2            S01177
     C*****                                                               S01177
     C*****      DDORCM    IFEQ '01'                       B**3           S01177
     C*****      DDORCM    OREQ '07'                       B**3           S01177
     C*****      DDORCM    OREQ '08'                       B**3           S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B***4          S01177
     C*****                MOVE '1'       *IN24            ****4          S01177
     C*****                MOVE '1'       *IN41            ****4          S01177
     C*****                MOVEL'MMM0444' @MSGID           ****4          S01177
     C*****                CALL 'ZA0240'                   ****4          S01177
     C*****                PARM           @MSGID           ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01177
     C*****                                                               S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C**  Find whether the date is a holiday in the local currency.
     C*****                MOVE LOCY      @@CCY            *1             S01177
     C*****                Z-ADDIKNIPD    @@MNO            *1             S01177
     C*****                EXSR ZA0830                     *1             S01177
     C*****                                                               S01177
     C**  If settlement method is not blank,00,01,07 or 08 and it is
     C**  not a working day in the local currency, it is an error.
     C*****      DDORCM    IFNE *BLANKS                    B*2            S01177
     C*****      DDORCM    ANDNE'00'                       B*2            S01177
     C*****      DDORCM    ANDNE'01'                       B*2            S01177
     C*****      DDORCM    ANDNE'07'                       B*2            S01177
     C*****      DDORCM    ANDNE'08'                       B*2            S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B**3           S01177
     C*****                MOVE '1'       *IN24            ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                MOVEL'MMM0445' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C*****      DDMOPM    IFNE *BLANKS                    B*2            S01177
     C*****      DDMOPM    ANDNE'00'                       B*2            S01177
     C*****      DDMOPM    ANDNE'01'                       B*2            S01177
     C*****      DDMOPM    ANDNE'07'                       B*2            S01177
     C*****      DDMOPM    ANDNE'08'                       B*2            S01177
     C*****                                                               S01177
     C**  If @@HIND = 'H' then the date is a holiday.
     C*****      @@HIND    IFEQ 'H'                        B**3           S01177
     C*****                MOVE '1'       *IN24            ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                MOVEL'MMM0445' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                                                               S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*****      #ZIC9     ENDSR                           **#ZIC9**      S01177
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZIAA    - Perform account checks.                            *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #ZIA   - Validates the setttlement instructions.   *
     C*                                                               *
     C* FLDS USED  @ERCD  - Error code.                               *
     C*            @RET   - FDRETALL file has been read.              *
     C*************@ACKEY*-*Key*to*file*ACCNT.****************************S01319
     C*            @EDAT  - Event date.                               *
     C*            @WK5   - Work field.                               *
     C*                                                               *
     C*****************************************************************
     C*****      #ZIAA     BEGSR                                          S01177
     C*****                                                               S01177
     C**  Initialise the error code to 0.
     C*****                Z-ADD0         @ERCD                           S01177
     C*****                                                               S01177
     C**  Access the ACCNT file, if it has not been accessed already.
     C*****      @RET      IFNE 'Y'                        B1             S01177
     C*****      @ACKEY    CHAINACCNT                65    *1             S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C**  If the account is not live or not found, return error 1.
     C*****      *IN65     IFEQ '1'                        B1             S01177
     C*****      @RET      ANDNE'Y'                        B1             S01177
     C*****      RECI      OREQ '*'                        B1             S01177
     C*****      @RET      ANDNE'Y'                        B1             S01177
     C*****                Z-ADD1         @ERCD            *1             S01177
     C*****                ELSE                            X1             S01177
     C*****                                                               S01177
     C**  If the account is retail.
     C*****      ATYP      IFEQ 'R'                        B*2            S01177
     C*****                                                               S01177
     C**  If the event date is earlier than the date the account was
     C**  opened, then it is an error.
     C*****      @EDAT     IFLT DACO                       B**3           S01177
     C*****                Z-ADD2         @ERCD            ***3           S01177
     C*****                GOTO #ZIAA9                     ***3           S01177
     C*****                END                             E**3           S01177
     C*****                                                               S01177
     C**  If the event date of the deal is less than the run date minus
     C**  the back value limit period number of days then it is an
     C**  it is an error.
     C*****      RUND      SUB  BVLP      @WK5             **2            S01177
     C*****      @EDAT     IFLT @WK5                       B**3           S01177
     C*****                Z-ADD3         @ERCD            ***3           S01177
     C*****                END                             E**3           S01177
     C*****                END                             E*2            S01177
     C*****                END                             E1             S01177
     C*****                                                               S01177
     C*****      #ZIAA9    ENDSR                           **#ZIAA9**     S01177
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZO      - Validate deal number and action code.              *
     C*                                                               *
     C* CALLS    ZA0240   - Sends a msg to the program message queue. *
     C*          #ZE      - Clears all screen fields.                 *
     C*          #ZEA     - Clear standard deal                       *   E18139
     C*                                                               *
     C* CALLED BY  #B     - Main processing.                          *
     C*            #BD    - Enter processing.                         *
     C*                                                               *
     C* FLDS USED  @DLNO  - Stored version of DDDLNO.                 *
     C*            @AUTO  - Auto deal number indicator.               *
     C*            @MSGID - Message id field.                         *
     C*            @TEST  - Field to test numeric fields' right byte. *
     C*            @DLKEY - Numeric key to deal file.                 *
     C*            @DKEY  - Numeric key to deal file for related.     *
     C*            @MOD13 - Retail module is in system.               *
     C*            @DEAMN - Deal no used to access DEAMS file.        *
     C*            @VDYY  - Value date key field for DEAMS file.      *
     C*            @VDMM  - Value date key field for DEAMS file.      *
     C*            @VDDD  - Value date key field for DEAMS file.      *
     C*            @DEAMS - DEAM sequence no.                         *
     C*            @DEAMK - DEAM file key.                            *
     C*            @DA38  - Deal no for DEAM.                         *
     C*            @WK11  - Work field.                               *
     C*            @WK22  - Work field.                               *
     C*                                                               *
     C*****************************************************************
     C           #ZO       BEGSR
     C                     MOVE '0'       *IN38
     C                     MOVE '0'       *IN39                           BHF632
     C*                                                                   E20376
     C                     MOVE 'N'       @MAN                            E20376
     C*                                                                   E20376
     C*
     C*  *------------------------*
     C*  * Preliminary Validation *
     C*  *------------------------*
     C*
     C**  If the action code is not 'I', or the deal number has
     C**  changed, set off the auto deal number indicator so that
     C**  validation is not by-passed.
     C           DDACTN    IFNE 'I'                        B1
     C           DDDLNO    ORNE @DLNO                      B1
     C                     MOVE 'N'       @AUTO            *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C276
     C*
     C**  If the auto deal number indicator is 'Y', the action code is
     C**  valid and the deal no. has been generated; by-pass
     C**  preliminary validation.
     C           @AUTO     CABEQ'Y'       #ZO9
     C*
     C**  Check that the action code is valid; if authorizations are
     C**  not in the system, then action code X is not allowed.
     C***********H1BOAR****IFEQ*'N'************************B1*************S01319
     C           BNMMAU    IFEQ 'N'                        B1             S01319
     C           DDACTN    ANDNE*BLANK                     B1
     C           DDACTN    ANDNE'I'                        B1
     C           DDACTN    ANDNE'A'                        B1
     C           DDACTN    ANDNE'D'                        B1
     C           DDACTN    ANDNE'E'                        B1
     C                     MOVE '1'       *IN01            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0161' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E1
     C*
     C***********H1BOAR****IFNE*'N'************************B1*************S01319
     C           BNMMAU    IFNE 'N'                        B1             S01319
     C           DDACTN    ANDNE*BLANK                     B1
     C           DDACTN    ANDNE'I'                        B1
     C           DDACTN    ANDNE'A'                        B1
     C           DDACTN    ANDNE'D'                        B1
     C           DDACTN    ANDNE'E'                        B1
     C           DDACTN    ANDNE'X'                        B1
     C                     MOVE '1'       *IN01            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0160' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E1
     C*
     C****The*action*code*defaults*to*E*if*blank.*************************S01319
     C***********DDACTN****IFEQ**BLANK*********************B1*************S01319
     C*********************MOVE*'E'*******DDACTN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C****If*the*user*is*not*an*authorizations*officer*and*action*code****S01319
     C****is*X*it*is*an*error.********************************************S01319
     C***********DDACTN****IFEQ*'X'************************B1*************S01319
     C***********IQMMAO****ANDEQ'N'************************B1*************S01319
     C*********************MOVE*'1'********IN01*************1*************S01319
     C*********************MOVE*'1'********IN41*************1*************S01319
     C*********************MOVEL'MMM0175'*@MSGID************1*************S01319
     C*********************CALL*'ZA0240'********************1*************S01319
     C*********************PARM***********@MSGID************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C****If*the*user*is*not*a*settlements*officer*and*the*action*code****S01319
     C****is*I,A*or*D,*it*is*an*error.************************************S01319
     C***********DDACTN****IFEQ*'I'************************B1*************S01319
     C***********IQMMSO****ANDEQ'N'************************B1*************S01319
     C***********DDACTN****OREQ*'D'************************B1*************S01319
     C***********IQMMSO****ANDEQ'N'************************B1*************S01319
     C***********DDACTN****OREQ*'A'************************B1*************S01319
     C***********IQMMSO****ANDEQ'N'************************B1*************S01319
     C*********************MOVE*'1'********IN01*************1*************S01319
     C*********************MOVE*'1'********IN41*************1*************S01319
     C*********************MOVEL'MMM0176'*@MSGID************1*************S01319
     C*********************CALL*'ZA0240'********************1*************S01319
     C*********************PARM***********@MSGID************1*************S01319
     C*********************END*****************************E1*************S01319
     C*
     C**  If the deal number is not blank, check that it is numeric.
     C                     TESTN          DDDLNO     62
     C                     MOVE DDDLNO    @TEST
     C                     TESTZ          @TEST          73
     C           DDDLNO    IFNE *BLANKS                    B1
     C           *IN62     ANDEQ'0'                        B1
     C           DDDLNO    ORNE *BLANKS                    B1
     C           *IN73     ANDEQ'0'                        B1
     C                     MOVE '1'       *IN02            *1
     C                     MOVE '1'       *IN41            *1
     C                     MOVEL'MMM0162' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E1
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C132                                           S01408
      *                                                                   S01408
     C*
     C**  Carry out no further validation if errors occurred.
     C           *IN41     CABEQ'1'       #ZO8
     C*
     C**  Set up the deal number as a numeric field.
     C                     MOVE DDDLNO    @DLKEY
     C/COPY WNCPYSRC,MM0089C277
     C*
     C*  *--------------------------------*
     C*  * Validation for Action Code 'E' *
     C*  *--------------------------------*
     C*
     C           DDACTN    IFEQ 'E'                        B1
     C/COPY WNCPYSRC,MM0089C278
     C*
     C**  If the deal number is blank, it is an error.
     C           DDDLNO    IFEQ *BLANKS                    B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0111' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C/COPY WNCPYSRC,MM0089C279
     C                     END                             E*2
     C*
     C**  If there is no valid record on MMDEALLL, it is an error.
     C           @DLKEY    CHAINMMDEALLL             65    *1
     C*
     C**  Check that the correct record format has been accessed.
     C           RECORD    IFNE 'MMDELDP0'                 B*2
     C           *IN65     ANDEQ'0'                        B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0158' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP41                                           S01408
     C*                                                                   S01408
     C*
     C**  Check for a valid record.
     C           *IN65     IFEQ '1'                        B*2
     C           HKDLTF    ORNE *BLANKS                    B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0167' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     ELSE                            X*2
     C*
     C**  If the deal status is not C,A or R, it is an error.
     C           HKDSTS    IFNE 'C'                        B**3
     C           HKDSTS    ANDNE'A'                        ***3
     C           HKDSTS    ANDNE'R'                        ***3
     C           HKDSTS    ANDNE'M'                        ***3           BH1117
     C/COPY WNCPYSRC,MM0089C208
     C                     MOVE '1'       *IN02            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0168' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     GOTO #ZO8                       ***3
     C                     END                             E**3
     C/COPY WNCPYSRC,MM0089C520
     C                     END                             E*2
     C                     END                             E1
     C*
     C*  *--------------------------------*
     C*  * Validation for Action Code 'X' *
     C*  *--------------------------------*
     C*
     C           DDACTN    IFEQ 'X'                        B1
     C/COPY WNCPYSRC,MM0089C280
     C*
     C**  If the deal number is blank, it is an error.
     C           DDDLNO    IFEQ *BLANKS                    B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0111' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C281
     C*
     C**  If there is no valid, undeleted record on MMDEALLL, it is an
     C**  error.
     C           @DLKEY    CHAINMMDEALLL             65    *1
     C*
     C**  Check that the correct record format has been accessed.
     C           RECORD    IFNE 'MMDELDP0'                 B*2
     C           *IN65     ANDEQ'0'                        B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0158' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C515
     C*
     C**  Check for a valid record.
     C           *IN65     IFEQ '1'                        B*2
     C           HKDLTF    ORNE *BLANK                     B*2
     C           HKDDLT    ORNE *BLANK                     B*2
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP28                                           S01408
     C*                                                                   S01408
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0165' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     ELSE                            X*2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP61                                           S01408
     C*                                                                   S01408
     C*
     C**  If the deal status is not C or R, it is an error.
     C           HKDSTS    IFNE 'C'                        B**3
     C           HKDSTS    ANDNE'R'                        B**3
     C                     MOVE '1'       *IN02            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0171' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     ELSE                            X**3
     C*
     C**  If the rollover/bought/sold indicator is N, use the deal's
     C**  related deal number to access the related deal.
     C           HKRBSI    IFEQ 'N'                        B***4
     C                     MOVE HKDADN    @DKEY            ****4
     C           @DKEY     CHAINMMDEALLL             65    ****4
     C*
     C**  Check that the correct record format has been accessed.
     C           RECORD    IFNE 'MMDELDP0'                 B****5
     C           *IN65     ANDEQ'0'                        B****5
     C                     MOVE '1'       *IN09            *****5
     C                     MOVE '1'       *IN41            *****5
     C                     MOVEL'MMM0158' @MSGID           *****5
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C                     GOTO #ZO8                       *****5
     C                     END                             E****5
     C*
     C**  If no valid record is found, or the record does not have a
     C**  status of 'A' or 'R', it is an error.
     C* - If associated deal is not found (already historic)              086484
     C*   and status 'R' required Reauth. allows authorisation            086484
     C* - If associated deal is matured  allows authorisation             086484
     C           *IN65     IFEQ '1'                        B****5
     C           HKDSTS    ANDNE'R'                        B****5         086484
     C           HKDLTF    ORNE *BLANK                     B****5
     C           HKDSTS    ORNE 'A'                        B****5
     C           HKDSTS    ANDNE'R'                        B****5
     C           HKDSTS    ANDNE'M'                        B****5         086484
     C                     MOVE '1'       *IN02            *****5
     C                     MOVE '1'       *IN41            *****5
     C                     MOVEL'MMM0173' @MSGID           *****5
     C                     CALL 'ZA0240'                   *****5
     C                     PARM           @MSGID           *****5
     C*
     C**  Chain to the deals file, to set up the file fields with the
     C**  current deal's values.
     C                     MOVE DDDLNO    @DLKEY           *****5
     C           @DLKEY    CHAINMMDEALLL             65    *****5
     C                     GOTO #ZO8                       *****5
     C                     END                             E****5
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP52                                           S01408
     C*                                                                   S01408
     C                     END                             E***4
     C                     END                             E**3
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CVS5                                           S01408
     C*                                                                   S01408
     C                     END                             E*2
      *                                                                                       CDL010
      ** User cannot authorise an authorised deal or deal requires                            CDL010
      ** double authorisation.                                                                CDL010
      *                                                                                       CDL010
     C           CDL010    IFEQ 'Y'                        **B1                               CDL010
     C           HKUSER    ANDEQZUSER                                                         CDL010
     C                     MOVE '1'       *IN02                                               CDL010
     C                     MOVE '1'       *IN41                                               CDL010
     C                     MOVEL'MMM0702' @MSGID                                              CDL010
     C                     CALL 'ZA0240'                                                      CDL010
     C                     PARM           @MSGID                                              CDL010
     C                     GOTO #ZO8                                                          CDL010
     C                     ENDIF                           **E1                               CDL010
      *                                                                                       CDL010
     C                     END                             E1
     C*
     C*  *--------------------------------*
     C*  * Validation for Action Code 'I' *
     C*  *--------------------------------*
     C*
     C**  Validate the action code and deal no. for action code 'I',
     C**  but only if the deal no. is not to be generated.
     C           DDACTN    IFEQ 'I'                        B1
     C           DDDLNO    ANDNE*BLANKS                    B1
     C*
     C****Check*that*the*deal*does*not*exist*on*the*DEALS,*FXDEALLL or    E18569
     C**  Check that the deal does not exist on the DEALS, CADENQLL or    E18569
     C*** MMDEALL*file; if it does it is an error.                        E18569
     C********** @DLKEY    CHAINMMDEALLL             65    *1             E18569
     C********** *IN65     IFEQ '0'                        B*2            E18569
     C**********           MOVE '1'       *IN02            **2            E18569
     C**********           MOVE '1'       *IN41            **2            E18569
     C**********           MOVEL'MMM0163' @MSGID           **2            E18569
     C**********           CALL 'ZA0240'                   **2            E18569
     C**********           PARM           @MSGID           **2            E18569
     C**********           GOTO #ZO8                       **2            E18569
     C**********           END                             E*2            E18569
     C*                                                                   E18569
     C**  Check for a valid record.                                       E18569
     C********** *IN65     IFEQ '1'                        B*2            E18569
     C********** @DLKEY    CHAINDEALSDBF             65    **2            E18569
     C********** *IN65     IFEQ '0'                        B**3           E18569
     C********** RECI      ANDEQ'*'                        B**3           E18569
     C**********           MOVE '1'       *IN65            ***3           E18569
     C**********           END                             E**3           E18569
     C********** @MOD13    IFEQ 'Y'                        B**3           E18569
     C********** *IN65     ANDEQ'1'                        B**3           E18569
     C********** @DLKEY    CHAINFXDEALLL             65    ***3           E18569
     C********** *IN65     IFEQ '0'                        B***4          E18569
     C********** FHDLTF    ANDNE*BLANK                     B***4          E18569
     C**********           MOVE '1'       *IN65            ****4          E18569
     C**********           END                             E***4          E18569
     C**********           END                             E**3           E18569
     C**********           END                             E*2            E18569
     C*
     C***********@DLKEY    SETLLCADENQLL                 65*1      E18569 042960
     C************IN65     IFEQ '0'                        B*2     E18569 042960
     C***********@DLKEY    SETLLDEALS                    65**2     E18569 042960
     C***********          END                             E*2     E18569 042960
     C************IN65     IFEQ '0'                        B*2     BH1059 042960
     C***********@DLKEY    SETLLDEALSH                   65**2     BH1059 042960
     C***********          END                             E*2     BH1059 042960
     C********** *IN65 *** IFEQ '0' ********************** B*2 ****       E18569
     C*                                                                   042960
     C** Check that the deal does not exist on any Deals File             042960
     C** Midas or DRS, if it does it's an error.                          042960
     C*                                                                   042960
     C           @DLKEY    SETLLDEALSALL                 65               042960
     C*                                                                   042960
     C           *IN65     IFEQ '1'                        B*2            E18569
     C           @TERM1    ANDNE'R'                                       S01434
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0163' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C*
     C**  Check that the deal number is in the allowed range.
     C           @TERM1    IFNE 'R'                                       S01434
     C           @DLKEY    IFLT NORDLN                     B*2
     C           @DLKEY    OREQ 999999                     B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0164' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C                     END                                            S01434
     C                     END                             E1
      *                                                                   CAC001
      **  If action code is 'I' and deal no. changed, initialise          CAC001
      **  funding info fields & previous spread/rate field                CAC001
      *                                                                   CAC001
     C           DDACTN    IFEQ 'I'                                       CAC001
     C           DDDLNO    ANDNEWSDLNO                                    CAC001
     C                     Z-ADD0         WFSRP                           CAC001
     C                     MOVE *BLANKS   WFSGN                           CAC001
     C                     MOVE *BLANKS   WFPRC                           CAC001
     C                     MOVE *BLANKS   WSSPRT 12                       CAC001
     C                     MOVE *BLANKS   WSBSRC  2                       CAC001
     C                     MOVE *BLANKS   WLOOP                           CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,MM0089C282
     C*
     C*  *--------------------------------*
     C*  * Validation for Action Code 'A' *
     C*  *--------------------------------*
     C*
     C           DDACTN    IFEQ 'A'                        B1
     C/COPY WNCPYSRC,MM0089C283
     C*
     C**  If the deal number is blank, it is an error.
     C           DDDLNO    IFEQ *BLANKS                    B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0111' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C284
     C*
     C**  If there is no valid, undeleted record on MMDEALLL, it is an
     C**  error.
     C           @DLKEY    CHAINMMDEALLL             65    *1
     C*
     C**  Check that the correct record format has been accessed.
     C           RECORD    IFNE 'MMDELDP0'                 B*2
     C           *IN65     ANDEQ'0'                        B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0158' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C*
     C**  Check for a valid record.
     C           *IN65     IFEQ '1'                        B*2
     C           HKDLTF    ORNE *BLANK                     B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0167' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C*
     C**  If the deal has been deleted, then it may not be amended.
     C           HKDDLT    IFNE *BLANK                     B*2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP53                                           S01408
     C*                                                                   S01408
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0172' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C*
     C**  If the record exists, its status must be C,A or R.
     C           HKDSTS    IFNE 'C'                        B*2
     C           HKDSTS    ANDNE'A'                        B*2
     C           HKDSTS    ANDNE'R'                        B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0166' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C502
     C                     END                             E1
     C*
     C*  *--------------------------------*
     C*  * Validation for Action Code 'D' *
     C*  *--------------------------------*
     C*
     C           DDACTN    IFEQ 'D'                        B1
     C*
     C**  If the deal number is blank, it is an error.
     C           DDDLNO    IFEQ *BLANKS                    B*2
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0111' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C285
     C*
     C**  If there is no valid, undeleted record on MMDEALLL, it is an
     C**  error.
     C           @DLKEY    CHAINMMDEALLL             65    *1
     C*
     C**  Check that the correct record format has been accessed.
     C           RECORD    IFNE 'MMDELDP0'                 B*2
     C           *IN65     ANDEQ'0'                        B*2
     C/COPY WNCPYSRC,MM0089C172
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0158' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C*
     C**  Check for a valid record.
     C           *IN65     IFEQ '1'                        B*2
     C           HKDLTF    ORNE *BLANK                     B*2
     C/COPY WNCPYSRC,MM0089C173
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0167' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C*
     C**  If a valid record exists and the deal deleted indicator is
     C**  not blank, it is an error.
     C           HKDDLT    IFNE *BLANK                     B*2
     C/COPY WNCPYSRC,MM0089C174
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0172' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C*                                                                   S01354
     C**  Disallow deletion of Internal Funding Deals                     S01354
     C*                                                                   S01354
     C           HKTYPE    IFEQ 'IL'                       B*2            S01354
     C           HKTYPE    OREQ 'ID'                       B*2            S01354
     C/COPY WNCPYSRC,MM0089C175
     C                     MOVE '1'       *IN03            **2            S01354
     C                     MOVE '1'       *IN41            **2            S01354
     C                     MOVEL'MMM0112' @MSGID           **2            S01354
     C                     CALL 'ZA0240'                   **2            S01354
     C                     PARM           @MSGID           **2            S01354
     C                     GOTO #ZO8                       **2            S01354
     C                     END                             E*2            S01354
     C*
     C****The*deal*status*must*be*C,A*or*R.***                            093081
     C**  The deal status must be C or A.                                 093081
     C           HKDSTS    IFNE 'C'                        B*2
     C           HKDSTS    ANDNE'A'                        B*2
     C***********HKDSTS    ANDNE'R'                        B*2            093081
     C/COPY WNCPYSRC,MM0089C176
     C                     MOVE '1'       *IN02            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM0169' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     GOTO #ZO8                       **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C238
     C*
     C**  Access the deal amendments file; if a live amendment exists
     C**  for the deal, this is an error.
     C**  Set the deam file pointer to be before any deam for the deal.
     C                     MOVE DDDLNO    @DEAMN           *1
     C                     MOVE *ZEROS    @VDYY            *1
     C                     MOVE *ZEROS    @VDMM            *1
     C                     MOVE *ZEROS    @VDDD            *1
     C                     MOVE *ZEROS    @DEAMS           *1
     C           @DEAMK    SETLLMMLVDMLL                   *1
     C*
     C**  Read the next record on file.
     C                     READ MMLVDMLL                 65*1
     C                     MOVE HNDA38    @DA38            *1
     C*
     C**  Read through the deal amendments until one of the following
     C**  conditions obtains...
     C**  - the end of file has been reached.
     C**  - the deal no. of the record found is not the same as that
     C**    used in the access.
     C**  - a valid deal amendment has been found; an error.
     C           *IN65     DOWEQ'0'                        B*2
     C           @DA38     IFEQ DDDLNO                     B**3
     C/COPY WNCPYSRC,MM0089C177
     C                     MOVE '1'       *IN02            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0170' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     GOTO #ZO8                       ***3
     C                     ELSE                            X**3
     C                     MOVE '1'       *IN65            ***3
     C                     END                             E**3
     C                     READ MMLVDMLL                 65**2
     C                     END                             E*2
     C*
     C****If*the*rollover*deal number is not blank, use the value to      E16042
     C****access*the*deals*file.  If a live record is found with a        E16042
     C****rollover/bought/sold indicator of 'N' or 'A', it is an error.   E16042
      *                                                                   E16042
     C** IF THE 'ROLLED OVER BY' IS NOT BLANK, USE IT'S VALUE TO ACCESS   E16042
     C** THE DRS DEALS FILE. IF A LIVE RECORD IS FOUND, IT IS AN ERROR.   E16042
      *                                                                   E16042
     C***********HKDADN    IFNE *BLANKS                    B*2            E16042
     C***********          MOVE HKDADN    @DKEY            **2            E16042
     C           HKROBY    IFNE *BLANKS                    B*2            E16042
     C                     MOVE HKROBY    @DKEY            **2            E16042
     C           @DKEY     CHAINMMDEALLL             65    **2
     C           *IN65     IFEQ '0'                        B**3
     C           HKDLTF    ANDEQ*BLANKS                    B**3
     C           HKDDLT    ANDNE'D'                        B**3
     C***********HKRBSI    IFEQ 'N'                        B***4          E16042
     C***********HKRBSI    OREQ 'O'                        B***4          E16042
     C/COPY WNCPYSRC,MM0089C178
     C                     MOVE '1'       *IN02            ****4
     C                     MOVE '1'       *IN41            ****4
     C                     MOVEL'MMM0174' @MSGID           ****4
     C                     CALL 'ZA0240'                   ****4
     C                     PARM           @MSGID           ****4
     C***********          END                             E***4          E16042
     C                     END                             E**3
     C*
     C**  Chain to the deals file, to set up the file fields with the
     C**  current deal's values.
     C                     MOVE DDDLNO    @DLKEY           **2
     C           @DLKEY    CHAINMMDEALLL             65    **2
     C*
     C**  If an error has occurred, bypass secondary validation.
     C           *IN02     IFEQ '0'                        B**3
     C                     GOTO #ZO8                       ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
      *                                                                   CAC001
      **  Save deal no. to previous deal no. field                        CAC001
      *                                                                   CAC001
     C                     MOVE DDDLNO    WSDLNO  6                       CAC001
     C*
     C*  *-----------------------------------------------*                S01117
     C*  * Access Security Checking                      *                S01117
     C*  *-----------------------------------------------*                S01117
     C*                                                                   S01117
      *                                                                   S01117
      **  If no multibranching only need to do user validation            S01117
      *                                                                   S01117
     C           @MBIN     IFEQ 'N'                        B1             S01117
      *                                                                   S01117
      ** validate action codes for user                                   S01117
     C                     CALL 'ZVACTU'                   *1             S01117
     C                     PARM DDACTN    ZACTN   1        *1             S01117
     C                     PARM           ERR     10       *1             S01117
      *                                                                   S01117
     C           ERR       IFEQ 1                          B*2            S01117
      * This action code invalid for user                                 S01117
     C                     MOVE '1'       *IN01            **2            S01117
     C                     MOVE '1'       *IN02            **2            S01117
     C                     MOVE '1'       *IN41            **2            S01117
     C                     MOVEL'FXM0292' @MSGID           **2            S01117
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C                     GOTO #ZO8                       **2            S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
     C                     END                             E1             S01117
      *                                                                   S01117
      ** IF MULTIBRANCHED                                                 S01117
     C           @MBIN     IFEQ 'Y'                        B1             S01117
     C/COPY WNCPYSRC,MM0089CP95                                           S01408
      *                                                                   S01117
      ** Set up the booking branch code field with default value if       S01117
      ** insert                                                           S01117
     C           DDACTN    IFEQ 'I'                        B*2            S01117
     C           DDBRCA    IFEQ *BLANKS                    B**3           S01117
     C                     MOVE BRC       ZBR              ***3           S01117
     C                     MOVE BRC       DDBRCA           ***3           S01117
     C                     ELSE                            X**3           S01117
     C                     MOVE DDBRCA    ZBR              ***3           S01117
     C                     END                             E**3           S01117
     C                     ELSE                            X*2
      ** Set up the booking branch code field with value from             S01117
      ** file if not insert                                               S01117
     C                     MOVE HKBRCA    ZBR              **2            S01117
     C                     END                             E*2            S01117
      **                                                                  S01117
      ** if insert check branch exists on file                            S01117
     C           DDACTN    IFEQ 'I'                        B*2            S01117
     C**********           CALL 'AOBRCHR0'                 **2      S01117S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7        **2      S01117S01194
     C                     PARM '*KEY   ' @OPTN   7        **2      S01117S01194
     C                     PARM DDBRCA    @DSNB   3        **2      S01117S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                             S01117S01194
     C           @RTCD     IFNE *BLANKS                    B**3     S01117S01194
     C                     MOVE '1'       *IN06            ***3           S01117
     C                     MOVE '1'       *IN41            ***3           S01117
     C                     MOVEL'MMM0115' @MSGID           ***3           S01117
     C                     CALL 'ZA0240'                   ***3           S01117
     C                     PARM           @MSGID           ***3           S01117
     C                     GOTO #ZO8                       ***3           S01117
      *                                                                   S01117
      ** PROCESS FOR '?'                                                  S01117
     C                     ELSE                            X**3           S01117
     C                     MOVELA8BRCD    ZBR              ***3           S01117
     C                     MOVELA8BRCD    DDBRCA           ***3           S01117
     C                     END                             E**3           S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
      * do user validation for all action codes                           S01117
     C                     CALL 'ZVACTBU'                  *1             S01117
     C                     PARM DDACTN    ZACTN   1        *1             S01117
     C                     PARM           ZBR     3        *1             S01117
     C                     PARM           ERR     10       *1             S01117
     C/COPY WNCPYSRC,MM0089CP96                                           S01408
      *                                                                   S01117
     C           ERR       IFEQ 1                          B*2            S01117
      * no valid action codes for user/branch combination                 S01117
     C                     MOVE '1'       *IN01            **2            S01117
     C                     MOVE '1'       *IN41            **2            S01117
     C** (if Insert then highlight branch field else deal number)         S01117
     C           DDACTN    IFEQ 'I'                        B**3           S01117
     C                     MOVE '1'       *IN06            ***3           S01117
     C                     ELSE                            X**3           S01117
     C                     MOVE '1'       *IN02            ***3           S01117
     C                     END                             E**3           S01117
     C                     MOVEL'FXM0290' @MSGID           **2            S01117
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C                     GOTO #ZO8                       **2            S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
     C           ERR       IFEQ 2                          B*2            S01117
      * this action code invalid for user/branch combination              S01117
     C                     MOVE '1'       *IN01            **2            S01117
     C                     MOVE '1'       *IN41            **2            S01117
     C** (if Insert then highlight branch field else deal number)         S01117
     C           DDACTN    IFEQ 'I'                        B**3           S01117
     C                     MOVE '1'       *IN06            ***3           S01117
     C                     ELSE                            X**3           S01117
     C                     MOVE '1'       *IN02            ***3           S01117
     C                     END                             E**3           S01117
     C                     MOVEL'FXM0291' @MSGID           **2            S01117
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C                     GOTO #ZO8                       **2            S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
      ** If orig branch is user validated and this is not an enquiry      S01117
      **  or an insert then validate originating branch                   S01117
      **  (NB. user validation for Orig. Brch done later if Insert)       S01117
      *                                                                   S01117
     C*****      OBUV      IFEQ 'Y'                        B*2      S01117S01194
     C           BKOBUV    IFEQ 'Y'                        B*2            S01194
     C           DDACTN    ANDNE'E'                        B*2            S01117
     C           DDACTN    ANDNE'I'                        B*2            S01117
     C                     CALL 'ZVOBU'                    **2            S01117
     C                     PARM HKORBR    ZOBRX   3        **2            S01117
     C                     PARM           ERR     10       **2            S01117
     C           ERR       IFEQ 1                          B**3           S01117
      * no valid origination branches for this user                       S01117
     C                     MOVE '1'       *IN01            ***3           S01117
     C                     MOVE '1'       *IN02            ***3           S01117
     C                     MOVE '1'       *IN41            ***3           S01117
     C                     MOVEL'FXM0287' @MSGID           ***3           S01117
     C                     CALL 'ZA0240'                   ***3           S01117
     C                     PARM           @MSGID           ***3           S01117
     C                     GOTO #ZO8                       ***3           S01117
     C                     END                             E**3           S01117
     C           ERR       IFEQ 2                          B**3           S01117
      ** this originating branch invalid for user                         S01117
     C                     MOVE '1'       *IN01            ***3           S01117
     C                     MOVE '1'       *IN02            ***3           S01117
     C                     MOVE '1'       *IN41            ***3           S01117
     C                     MOVEL'FXM0288' @MSGID           ***3           S01117
     C                     CALL 'ZA0240'                   ***3           S01117
     C                     PARM           @MSGID           ***3           S01117
     C                     GOTO #ZO8                       ***3           S01117
     C                     END                             E**3           S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
     C                     END                             E1             S01117
     C/COPY WNCPYSRC,MM0089C517
      *
     C*  *-----------------------------------------------*
     C*  * Secondary Validation for Action Code I,A or D *
     C*  *-----------------------------------------------*
     C*
     C****If*the*user*authority*checks*are*being*bypassed,*or*the*********S01319
     C****action*code*is*not*I,A*or*D,*by-pass*further*processing.********S01319
     C**  If action code is not I,A or D, by-pass further processing.     S01319
     C***********IDIRO*****CABEQ'Y'*******#ZO9****************************S01319
     C           DDACTN    CABEQ'X'       #ZO9
     C           DDACTN    CABEQ'E'       #ZO9
     C*
     C****Cross*validate*deal*status*and*action*code*for*the**************S01319
     C****settlement*officer.*********************************************S01319
     C********************************************************************S01319
     C****If*the*action*code*is*'I',*and*settlement*officers*are*not******S01319
     C****allowed*to*insert*deals,*it*is*an*error.************************S01319
     C***********DDACTN****IFEQ*'I'************************B1*************S01319
     C***********IPSOIC****ANDEQ'N'************************B1*************S01319
     C*********************MOVE*'1'********IN01*************1*************S01319
     C*********************MOVE*'1'********IN41*************1*************S01319
     C*********************MOVEL'MMM0177'*@MSGID************1*************S01319
     C*********************CALL*'ZA0240'********************1*************S01319
     C*********************PARM***********@MSGID************1*************S01319
     C*********************GOTO*#ZO8************************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C****If*the*action*code*is*'A',*settlement*officers*are*not**********S01319
     C****allowed*to*amend*deals,*and*the*deal*status*is*A*or*R,*it*is****S01319
     C****an*error.*******************************************************S01319
     C***********DDACTN****IFEQ*'A'************************B1*************S01319
     C***********IPSOAA****ANDEQ'N'************************B1*************S01319
     C***********HKDSTS****IFEQ*'A'************************B*2************S01319
     C***********HKDSTS****OREQ*'R'************************B*2************S01319
     C*********************MOVE*'1'********IN01**************2************S01319
     C*********************MOVE*'1'********IN02**************2************S01319
     C*********************MOVE*'1'********IN41**************2************S01319
     C*********************MOVEL'MMM0178'*@MSGID*************2************S01319
     C*********************CALL*'ZA0240'*********************2************S01319
     C*********************PARM***********@MSGID*************2************S01319
     C*********************GOTO*#ZO8*************************2************S01319
     C*********************END*****************************E*2************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C****If*the*action*code*is*'D',*settlement*officers*are*not**********S01319
     C****allowed*to*delete*deals,*and*the*deal*status*is*C,*it*is*an*****S01319
     C****error.**********************************************************S01319
     C***********DDACTN****IFEQ*'D'************************B1*************S01319
     C***********HKDSTS****ANDEQ'C'************************B1*************S01319
     C***********IPSODC****ANDEQ'N'************************B1*************S01319
     C*********************MOVE*'1'********IN01*************1*************S01319
     C*********************MOVE*'1'********IN02*************1*************S01319
     C*********************MOVE*'1'********IN41*************1*************S01319
     C*********************MOVEL'MMM0179'*@MSGID************1*************S01319
     C*********************CALL*'ZA0240'********************1*************S01319
     C*********************PARM***********@MSGID************1*************S01319
     C*********************GOTO*#ZO8************************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C****If*the*action*code*is*'D',*settlement*officers*are*not**********S01319
     C****allowed*to*delete*deals,*and*the*deal*status*is*A*or*R,*it*is***S01319
     C****an*error.*******************************************************S01319
     C***********DDACTN****IFEQ*'D'************************B1*************S01319
     C***********IPSODA****ANDEQ'N'************************B1*************S01319
     C***********HKDSTS****IFEQ*'A'************************B*2************S01319
     C***********HKDSTS****OREQ*'R'************************B*2************S01319
     C*********************MOVE*'1'********IN01**************2************S01319
     C*********************MOVE*'1'********IN02**************2************S01319
     C*********************MOVE*'1'********IN41**************2************S01319
     C*********************MOVEL'MMM0180'*@MSGID*************2************S01319
     C*********************CALL*'ZA0240'*********************2************S01319
     C*********************PARM***********@MSGID*************2************S01319
     C*********************GOTO*#ZO8*************************2************S01319
     C*********************END*****************************E*2************S01319
     C*********************END*****************************E1*************S01319
     C*
     C**  If processing is not insert and an error has occurred, then
     C**  clear all the fields except the action and deal number.
     C           #ZO8      TAG                             **#ZO8**
     C*
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP37                                           S01408
     C*                                                                   S01408
     C           DDACTN    IFNE 'I'                        B1
     C           *IN41     ANDEQ'1'                        B1
     C                     MOVE DDACTN    @WK11            *1
     C                     MOVE DDDLNO    @WK22            *1
     C                     EXSR #ZE                        *1
     C                     EXSR #ZEA                       *1             E18139
     C                     MOVE @WK11     DDACTN           *1
     C                     MOVE @WK22     DDDLNO           *1
     C                     END                             E1
     C*
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP38                                           S01408
     C*                                                                   S01408
     C           #ZO9      ENDSR                           **#ZO9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZP      - Enter processing for action code X.                *
     C*                                                               *
     C*          #ZF      - Resets screen fileds with stored values.  *
     C*          #ZG      - Update processing.                        *
     C*          #ZI      - Validates the screen input for I,A and X. *
     C*          ZA0240   - Sends a msg to the program message queue. *
     C*                                                               *
     C* CALLED BY  #BD    - Enter processing.                         *
     C*            #BFC   -  F15 processing - authorise handling.     *
     C*                                                               *
     C* FLDS USED  @DLNO  - Stored version of DDDLNO.                 *
     C*            @MSGID - Message id field.                         *
     C*            @TYPE  - Stored version of DDTYPE.                 *
     C*            @STYP  - Stored version of DDSTYP.                 *
     C*            @DLDT  - Stored version of DDDLDT.                 *
     C*****        @BRCD  - Stored version of DDBRCD.                 *   S01117
     C*            @BRCA  - Stored version of DDBRCA.                 *   S01117
     C*            @BKCD  - Stored version of DDBKCD.                 *
     C*            @BRKG  - Stored version of DDBRKG.                 *
     C*            @DADN  - Stored version of DDDADN.                 *
     C*            @CUST  - Stored version of DDCUST.                 *
     C*            @VDAT  - Stored version of DDVDAT.                 *
     C*            @MDAT  - Stored version of DDMDAT.                 *
     C*            @NTCE  - Stored version of DDNTCE.                 *
     C*************@FCLY**-*Stored*version*of*DDFCLY.******************   E25515
     C*            @ACSQ  - Stored version of DDACSQ.                 *
     C*            @CCY   - Stored version of DDCCY.                  *
     C*            @AMNP  - Stored version of DDAMNP.                 *
     C*            @BRAT  - Stored version of DDBRAT.                 *
     C*            @BSRC  - Stored version of DDBSRC.                 *
     C*            @SPRT  - Stored version of DDSPRT.                 *
     C*            @ICMT  - Stored version of DDICMT.                 *
     C*            @NGVI  - Stored version of DDNGVI.                 *
     C*            @IPFQ  - Stored version of DDIPFQ.                 *
     C*            @NDAT  - Stored version of DDNDAT.                 *
     C*            @TOTI  - Stored version of DDTOTI.                 *
     C*            @IPDM  - Stored version of DDIPDM.                 *
     C*            @CPTI  - Stored version of DDCPTI.                 *
     C*            @MTAX  - Stored version of DDMTAX.                 *
     C*            @CDRF  - Stored version of DDCDRF.                 *
     C*            @CDCH  - Stored version of DDCDCH.                 *
     C*            @FUID  - Stored version of DDFUID                  *   S01392
     C*            @FLID  - Stored version of DDFLID                  *   S01392
     C*            @RDFC  - Stored version of DDRDFC                  *   S01392
     C*            @ORBR  - stored orig. branch                       *   S01117
     C*            @PRFC  - stored profit centre                      *   S01117
     C******       @ORCM  - Stored version of DDORCM.                 *   S01177
     C******       @MOPM  - Stored version of DDMOPM.                 *   S01177
     C******       @MORI  - Stored version of DDMORI.                 *   S01177
     C******       @MOPI  - Stored version of DDMOPI.                 *   S01177
     C******       @MCPI  - Stored version of DDMCPI.                 *   S01177
     C******       @MCRI  - Stored version of DDMCRI.                 *   S01177
     C******       @MFAO  - Stored version of DDMFAO.                 *   S01177
     C******       @SPEC  - Stored version of DDSPEC.                 *   S01177
     C*            @RSTM  - stored rcpt settlement method             *   S01177
     C*            @RONS  - stored rcpt our nostro                    *   S01177
     C*            @RIBN  - stored rcpt intermed bank no.             *   S01177
     C*            @RIBA  - stored rcpt intermed bank a/c line        *   S01177
     C*            @ROBN  - stored rcpt ordering bank no.             *   S01177
     C*            @ROCN  - stored rcpt ordering customer no.         *   S01177
     C*            @PSTM  - stored pay settlement method              *   S01177
     C*            @PONS  - stored pay our nostro                     *   S01177
     C*            @PIBN  - stored pay intermed bank no.              *   S01177
     C*            @PIBA  - stored pay intermed bank a/c line         *   S01177
     C*            @POBN  - stored pay ordering bank no.              *   S01177
     C*            @POCN  - stored pay ordering customer no.          *   S01177
     C*            @RCRN  - stored receiver correspondant no.         *   S01177
     C*            @RCRA  - stored receiver corr a/c line             *   S01177
     C*            @RVNO  - stored receiver no.                       *   S01177
     C*            @AWBN  - stored a/c with bank no.                  *   S01177
     C*            @AWBA  - stored a/c with bank a/c line             *   S01177
     C*            @BENN  - stored beneficiary no.                    *   S01177
     C*            @BENA  - stored beneficiary a/c line               *   S01177
     C*            @DTP1  - stored details of payment 1               *   S01177
     C*            @DTP2  - stored details of payment 2               *   S01177
     C*            @DTP3  - stored details of payment 3               *   S01177
     C*            @DTP4  - stored details of payment 4               *   S01177
     C*            @DCHG  - stored details of charges                 *   S01177
     C*            @BTB1  - stored bank to bank info 1                *   S01177
     C*            @BTB2  - stored bank to bank info 2                *   S01177
     C*            @BTB3  - stored bank to bank info 3                *   S01177
     C*            @BTB4  - stored bank to bank info 4                *   S01177
     C*            @BTB5  - stored bank to bank info 5                *   S01177
     C*            @BTB6  - stored bank to bank info 6                *   S01177
     C*            @CVMR  - cover MT202 required                      *   E22405
     C*            @BOKC  - Stored version of DDBOKC.                 *   S01165
     C*            @LNKN  - Stored version of DDLNKN.                 *   S01165
     C*            @DRID  - Stored version of DDDRID.                 *   S01176
     C*            @DDMR  - Stored version of DDDDMR.                 *   S01176
     C*            @TERM  - Termination parameter.                    *
     C*                                                               *
     C*****************************************************************
     C           #ZP       BEGSR
      *                                                                   CAC001
      **  If Analytical Accounting is installed, action code was          CAC001
      **  changed from 'E' to 'X', and F19 was pressed, display error     CAC001
      **  message and F19 would be disabled                               CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *INKT     ANDEQ*ON                                       CAC001
     C                     MOVE '1'       *IN41                           CAC001
     C                     MOVEL'MMM2700' @MSGID                          CAC001
     C                     CALL 'ZA0240'                                  CAC001
     C                     PARM           @MSGID                          CAC001
     C                     GOTO #ZP9                                      CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   E12415
     C                     MOVE DDDLNO    @DLKEY           *1             E12415
     C/COPY WNCPYSRC,MM0089C286
     C*
     C**  If key work fields are not the same as screen fields, then
     C**  the record is not already being displayed.
     C           DDDLNO    IFNE @DLNO                      B1
     C           DDDLNO    OREQ *BLANKS                    B1
     C*                                                                   E12415
     C* IF A RELATED DEAL EXISTS;THEN AT THIS POINT THE PROGRAM           E12415
     C* HOLDS FILE VARIABLES FOR THAT RELATED DEAL - THEREFORE            E12415
     C* CHAIN BACK TO THE ORIGINAL DEAL                                   E12415
     C*                                                                   E12415
     C           @DLKEY    ORNE HKDN38                                    E12415
     C/COPY WNCPYSRC,MM0089C287
     C*
     C*********st record accessed on deals file during initial(#ZO)       E12415
     C******lidation was of related deal:re-access deal before display.   E12415
     C*                                                                   E12415
     C******               MOVE DDDLNO    @DLKEY           *1             E12415
     C********   @DLKEY    IFNE HKDN38                     B*2            E12415
     C*
     C**  If there is no valid, undeleted record on MMDEALLL, it is an
     C**  error.
     C           @DLKEY    CHAINMMDEALLL             65    **2
     C*
     C**  Check that the correct record format has been accessed.
     C           RECORD    IFNE 'MMDELDP0'                 B**3
     C           *IN65     ANDEQ'0'                        B**3
     C                     MOVE '1'       *IN02            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0158' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C*
     C**  Check for a valid record.
     C           *IN65     IFEQ '1'                        B**3
     C           HKDLTF    ORNE *BLANK                     B**3
     C           HKDDLT    ORNE *BLANK                     B**3
     C                     MOVE '1'       *IN02            ***3
     C                     MOVE '1'       *IN41            ***3
     C                     MOVEL'MMM0165' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  Display file on screen.
     C           *IN41     IFEQ '0'                        B*2
     C                     EXSR #ZD                        **2
     C/COPY WNCPYSRC,MM0089C094
     C******               END                             E*2            E12415
     C*
     C                     ELSE                            X1
     C*
     C**  If the action code is not X, it is invalid.
     C           DDACTN    IFNE 'X'                        B*2
     C*
     C**  Set up error output for screen.
     C                     MOVE '1'       *IN41            **2
     C                     MOVE '1'       *IN01            **2
     C                     MOVEL'MMM1025' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     END                             E*2
     C*
     C**  If error found
     C**  Restore former field values.
     C           *IN41     IFEQ '1'                        B*2
     C                     EXSR #ZF                        **2
     C*
     C**  By-pass further authorisation processing.
     C                     GOTO #ZP9                       **2
     C*
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C484
     C*
     C**  Record was displayed last cycle: check that no amendments to
     C**  fields have been made.
     C           DDDLNO    IFNE @DLNO                      B*2
     C           DDTYPE    ORNE @TYPE                      B*2
     C           DDSTYP    ORNE @STYP                      B*2
     C/COPY WNCPYSRC,MM0089C027
     C           DDFEDF    ORNE @FEDF                      **2            S01136
     C/COPY WNCPYSRC,MM0089C028
     C           DDDLDT    ORNE @DLDT                      B*2
     C*****      DDBRCD    ORNE @BRCD                      B*2            S01117
     C           DDBRCA    ORNE @BRCA                      B*2            S01117
     C           DDBKCD    ORNE @BKCD                      B*2
     C           DDBRKG    ORNE @BRKG                      B*2
     C           DDDADN    ORNE @DADN                      B*2
     C           DDCUST    ORNE @CUST                      B*2
     C/COPY WNCPYSRC,MM0089C485
     C           DDVDAT    ORNE @VDAT                      B*2
     C           DDMDAT    ORNE @MDAT                      B*2
     C           DDNTCE    ORNE @NTCE                      B*2
     C***********DDFCLY    ORNE @FCLY                      B*2            E25515
     C           DDPTFR    ORNE @PTFR                      B*2            S01486
     C           DDACSQ    ORNE @ACSQ                      B*2
     C           DDCCY     ORNE @CCY                       B*2
     C           DDAMNP    ORNE @AMNP                      B*2
     C           DDBRAT    ORNE @BRAT                      B*2
     C           DDBSRC    ORNE @BSRC                      B*2
     C           DDSPRT    ORNE @SPRT                      B*2
     C           DDICMT    ORNE @ICMT                      B*2
     C           DDNGVI    ORNE @NGVI                      B*2
     C           DDIPFQ    ORNE @IPFQ                      B*2
     C           DDNDAT    ORNE @NDAT                      B*2
     C           DDTOTI    ORNE @TOTI                      B*2
     C           DDIPDM    ORNE @IPDM                      B*2
     C           DDCPTI    ORNE @CPTI                      B*2
     C           DDMTAX    ORNE @MTAX                      B*2
     C           DDCDRF    ORNE @CDRF                      B*2
     C           DDCDCH    ORNE @CDCH                      B*2
     C           DDFUID    ORNE @FUID                      B*2            S01392
     C           DDFLID    ORNE @FLID                      B*2            S01392
     C           DDRDFC    ORNE @RDFC                      B*2            S01392
     C           DDORBR    ORNE @ORBR                      **2            S01117
     C           DDPRFC    ORNE @PRFC                      **2            S01117
     C*****      DDORCM    ORNE @ORCM                      B*2            S01177
     C*****      DDMOPM    ORNE @MOPM                      B*2            S01177
     C*****      DDMORI    ORNE @MORI                      B*2            S01177
     C*****      DDMOPI    ORNE @MOPI                      B*2            S01177
     C*****      DDMCPI    ORNE @MCPI                      B*2            S01177
     C*****      DDMCRI    ORNE @MCRI                      B*2            S01177
     C*****      DDMFAO    ORNE @MFAO                      B*2            S01177
     C*****      DDSPEC    ORNE @SPEC                      B*2            S01177
     C           DDBOKC    ORNE @BOKC                      B*2            S01165
     C           DDLNKN    ORNE @LNKN                      B*2            S01165
     C           DDDRID    ORNE @DRID                      B*2            S01176
     C           DDDDMR    ORNE @DDMR                      B*2            S01176
     C           DDAURO    ORNE @AURO                                     S01434
     C           DDIPDS    ORNE @IPDS                                     S01434
     C           DDROFQ    ORNE @ROFQ                                     S01434
     C           DDRLDN    ORNE @RLDN                                     S01434
     C           DDIMET    ORNE @IMET                                     S01434
     C           DDINSA    ORNE @INSA                                     S01434
     C           *IN36     ANDEQ'1'                                       S01434
     C           DDINSN    ORNE @INSA                                     S01434
     C           *IN36     ANDEQ'0'                                       S01434
     C           DDINOS    ORNE @INOS                                     S01434
     C           DDCNNA    ORNE @CNNA                                     S01434
     C           DDISCY    ORNE @ISCY                                     CEU003
     C           DDII72    ORNE @II72                                     CEU003
     C** also check second screen parms                                   S01177
     C           PMRSTM    ORNE @RSTM                      **2            S01177
     C           PMRONS    ORNE @RONS                      **2            S01177
     C           PARIBN    ORNE @RIBN                      **2            S01177
     C           PMRIBA    ORNE @RIBA                      **2            S01177
     C           PAROBN    ORNE @ROBN                      **2            S01177
     C           PAROCN    ORNE @ROCN                      **2            S01177
     C           PMPSTM    ORNE @PSTM                      **2            S01177
     C           PMPONS    ORNE @PONS                      **2            S01177
     C           PAPIBN    ORNE @PIBN                      **2            S01177
     C           PMPIBA    ORNE @PIBA                      **2            S01177
     C           PAPOBN    ORNE @POBN                      **2            S01177
     C           PAPOCN    ORNE @POCN                      **2            S01177
     C           PARCRN    ORNE @RCRN                      **2            S01177
     C           PMRCRA    ORNE @RCRA                      **2            S01177
     C           PARVNO    ORNE @RVNO                      **2            S01177
     C           PAAWBN    ORNE @AWBN                      **2            S01177
     C           PMAWBA    ORNE @AWBA                      **2            S01177
     C           PABENN    ORNE @BENN                      **2            S01177
     C           PMBENA    ORNE @BENA                      **2            S01177
     C           PMDTP1    ORNE @DTP1                      **2            S01177
     C           PMDTP2    ORNE @DTP2                      **2            S01177
     C           PMDTP3    ORNE @DTP3                      **2            S01177
     C           PMDTP4    ORNE @DTP4                      **2            S01177
     C           PMDCHG    ORNE @DCHG                      **2            S01177
     C           PMBTB1    ORNE @BTB1                      **2            S01177
     C           PMBTB2    ORNE @BTB2                      **2            S01177
     C           PMBTB3    ORNE @BTB3                      **2            S01177
     C           PMBTB4    ORNE @BTB4                      **2            S01177
     C           PMBTB5    ORNE @BTB5                      **2            S01177
     C           PMBTB6    ORNE @BTB6                      **2            S01177
     C           PMCVMR    ORNE @CVMR                      **2            E22405
     C           PMROBR    ORNE @ROBR                      **2            S01117
     C           PMPOBR    ORNE @POBR                      **2            S01117
     C           DDRACD    ORNE @RACD                      B*2            AUS007
     C           PMRSCY    ORNE @STCY                                     CEU003
     C           PMPSCY    ORNE @STCY                                     CEU003
     C           PMIC72    ORNE @IC72                                     CEU003
     C           PMIERI    ORNE @IERI                                     CEU003
     C*
     C**  Set up error output.
     C                     MOVE '1'       *IN01            **2
     C                     MOVE '1'       *IN41            **2
     C                     MOVEL'MMM1026' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  Restore former field values, and by-pass further
     C**  authorisation processing.
     C                     EXSR #ZF                        **2
     C                     GOTO #ZP9                       **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C*                                                                   S01177
     C**  Allow  call to SD2410  to validate settlement details           S01177
     C**************       MOVE '0'       *IN77                     S01177AUS007
     C**************       MOVE '0'       *INL1                     AUS007121483
     C                     MOVE '1'       *INL1                           121483
     C/COPY WNCPYSRC,MM0089C433
     C*                                                                   S01177
     C**  Validate screen input.
     C                     EXSR #ZI
     C           @TERM     CABEQ'E'       #ZP9
     C/COPY WNCPYSRC,MM0089C342
     C           *IN41     CABEQ'1'       #ZP9
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CPG5                                           S01408
      *                                                                   S01408
     C*
     C**  The entry must now be valid, call update processing.
     C                     EXSR #ZG
     C*
     C*
     C           #ZP9      ENDSR                           **#ZP9**
      /EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZDAT10Z2                                               056095
     C*******************************************************************
     C***********                                                         056095
     C**ZA0680*-*THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO         056095
     C***********MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)         056095
     C***********                                                         056095
     C**CALLED*BY :                                                       056095
     C***********                                                         056095
     C**CALLS*:**                                                         056095
     C***********                                                         056095
     C**INPUT**:*@@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   056095
     C***********                                                         056095
     C**OUTPUT*:*@@MDNO MIDAS DAY NUMBER  (SIZE : 5N)                     056095
     C***********                                                         056095
     C**USES*:***@@CC   NUMBER OF CENTURIES IN DATE                       056095
     C***********@@DAY  DAY NUMBER                                        056095
     C***********@@REM  REMAINDER FROM DIVIDE                             056095
     C***********@@MTH  MONTH NUMBER                                      056095
     C***********@MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       MONTH                                             056095
     C***********@@WK2  WORK FIELD (2,0)                                  056095
     C***********@@WK5  WORK FIELD (5,0)                                  056095
     C***********@@YYYY YEAR (4 CHARACTER)                                056095
     C***********@@YY   YEAR (2 CHARACTER)                                056095
     C***********@YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       A FOUR YEAR PERIOD                                056095
     C***********                                                         056095
     C******************************************************************* 056095
     C***********                                                         056095
     C***********ZA0680    BEGSR                                          056095
     C***********                                                         056095
     C****CLEAR*OUT ANY 'OLD' DATA IN FIELD                               056095
     C***********          Z-ADD0         @@MDNO  50                      056095
     C***********                                                         056095
     C***********@@DTIN    CABEQ0         ZA0689                          056095
     C***********                                                         056095
     C*****IF*DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING          056095
     C*****WORK*OUT THE NUMBER OF CENTURIES PASSED SINCE 1971,            056095
     C*****BY*SUBTRACTING 1972 FROM THE YEAR FIELD.                       056095
     C***********@@YYYY    IFGE 2072                       B1             056095
     C***********@@YYYY    SUB  1972      @@YYYY           *1             056095
     C***********                                                         056095
     C*****MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)             056095
     C*****THEN*RESTORE THE YEAR WHICH WAS INPUT BACK TO THE              056095
     C*****ORIGINAL VALUE BEFORE CONTINUING WITH NORMAL CALCULATIONS.     056095
     C***********                                                         056095
     C***********@@CC      MULT 36524     @@MDNO           *1             056095
     C***********@@YYYY    ADD  1972      @@YYYY           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C***********@@YYYY    ADD  28        @@WK2   20                      056095
     C***********                                                         056095
     C***********@@WK2     DIV  4         @@WK2                           056095
     C***********          MVR            @@REM   10                      056095
     C***********                                                         056095
     C******MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD                056095
     C***********@@WK2     MULT 1461      @@WK5   50                      056095
     C***********          ADD  @@WK5     @@MDNO                          056095
     C***********                                                         056095
     C****CHECK*REMAINDER AND MONTH NUMBER                                056095
     C***********@@REM     IFEQ 0                          B1             056095
     C***********@@MTH     ANDGT2                          B1             056095
     C***********          ADD  1         @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****YEAR*NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR               056095
     C***********@@REM     IFNE 0                          B1             056095
     C***********          ADD  @YD,@@REM @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****ADD*MONTHS THIS YEAR                                            056095
     C***********          ADD  @MD,@@MTH @@MDNO                          056095
     C***********                                                         056095
     C****ADD*DAYS THIS MONTH                                             056095
     C***********          ADD  @@DAY     @@MDNO                          056095
     C***********                                                         056095
     C***********ZA0689    ENDSR                           **ZA0689 TAG** 056095
      /EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZDATE9Z3                                               056095
     C*****************************************************************
     C***********                                                     *   056095
     C********TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *   056095
     C***********                                                     *   056095
     C********SUBROUTINE                                                  056095
     C********PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *   056095
     C********THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *   056095
     C********SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *   056095
     C********IF*'@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   056095
     C********'@@VDT'  IN 'YYYYMMDD' FORMAT.                          *   056095
     C***********                                                     *   056095
     C**NOTE:*FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS                  056095
     C***********                                                     *   056095
     C********1)*@@DAYN   LENGTH 5,0.                                 *   056095
     C***********                                                     *   056095
     C********FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *   056095
     C***********                                                     *   056095
     C********1)*@@VDT    LENGTH 8,0 DEFINED BY A DS.                 *   056095
     C********2)*@@RTN    LENGTH 1,0.                                 *   056095
     C********3)*@@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *   056095
     C********4)*@@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *   056095
     C********5)*@@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *   056095
     C********6)*@@RDAY   LENGTH 5,0.                                 *   056095
     C********7)*@@LEAP   LENGTH 1,0.                                     056095
     C***********                                                     *   056095
     C********INDICATORS USED ARE:                                    *   056095
     C***********                                                     *   056095
     C********1)*80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *   056095
     C********2)*81       CHECK FOR LOW ON ARRAY @MD.                 *   056095
     C***********                                                     *   056095
     C**INPUT*FIELD:       @@DAYN                                     *   056095
     C***********                                                     *   056095
     C**OUTPUT*FIELD:      @@VDT                                      *   056095
     C***********                                                     *   056095
     C**WORK*FIELDS:       @@RTN                                      *   056095
     C***********          @@Z71Y                                     *   056095
     C***********          @@RDAY                                     *   056095
     C***********          @@LEAP                                     *   056095
     C***********          @@I                                        *   056095
     C***********          @@J                                        *   056095
     C***********                                                     *   056095
     C**ARRAYS*USED:       @YD COMPILE TIME ARRAY.                        056095
     C***********          @MD COMPILE TIME ARRAY.                        056095
     C***********                                                         056095
     C*****************************************************************   056095
     C***********                                                         056095
     C***********ZA0710    BEGSR                                          056095
     C***********                                                         056095
     C***********          SETOF                     8081                 056095
     C***********          Z-ADD0         @@RTN   10                      056095
     C***********          Z-ADD0         @@VDT                           056095
     C***********          Z-ADD1         @@I     20                      056095
     C***********          Z-ADD1         @@J     20                      056095
     C***********          Z-ADD1         @@LEAP  10                      056095
     C***********                                                         056095
     C***********@@DAYN    CABEQ0         ZA0719                          056095
     C***********                                                         056095
     C***********@@DAYN    IFLT 1                                         056095
     C***********          Z-ADD1         @@RTN                           056095
     C***********          GOTO ZA0719                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**DIVISION*TO DETERMINE WETHER LEAP YEAR.                           056095
     C***********                                                         056095
     C***********@@DAYN    DIV  1461      @@Z71Y                          056095
     C***********          MVR            @@RDAY  50                      056095
     C***********                                                         056095
     C**CALCULATING YEAR.                                                 056095
     C***********                                                         056095
     C***********@@Z71Y    MULT 4         @@Z71Y                          056095
     C***********          ADD  1972      @@Z71Y                          056095
     C***********                                                         056095
     C**CHECKING*IF YEAR IS GREATER THAN OR EQUAL TO 2100                 056095
     C***********                                                         056095
     C***********@@Z71Y    IFGE 2100                                      056095
     C***********          ADD  @@SSY2    @@RDAY                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**LOKUP*ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE        056095
     C**HAVE*PASSED.                                                      056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@YD,@@I                8080               056095
     C***********                                                         056095
     C**IF*YEAR*IS A LEAP YEAR SSLEAP IS SET TO ZERO.                     056095
     C***********                                                         056095
     C************IN80     IFEQ '0'                                       056095
     C***********          Z-ADD0         @@LEAP                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**ADD*INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 1                                         056095
     C***********@@RDAY    SUB  @YD,@@I   @@RDAY                          056095
     C***********          ADD  @@I       @@Z71Y                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**PROCESSING FOR A LEAP YEAR.                                       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 0                                         056095
     C***********                                                         056095
     C**IF*'@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.                   056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 60                                        056095
     C***********          Z-ADD29        @@Z71D                          056095
     C***********          Z-ADD2         @@Z71M                          056095
     C***********          GOTO ZA0711                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**IF*'@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN    056095
     C**PROCEED*AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP     056095
     C**YEAR.*NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.          056095
     C***********                                                         056095
     C***********@@RDAY    IFGT 60                                        056095
     C***********@@RDAY    SUB  1         @@RDAY                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C***********          END                                            056095
     C***********                                                         056095
     C**IF*DAY*'@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS      056095
     C**IN*4*YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR      056095
     C**GROUP.***                                                         056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 0                                         056095
     C***********          Z-ADD31        @@Z71D                          056095
     C***********          Z-ADD12        @@Z71M                          056095
     C***********          SUB  1         @@Z71Y                          056095
     C***********          GOTO ZA0711                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**LOOK*UP*ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'         056095
     C**OCCURS*IN                                                         056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@MD,@@J                81                 056095
     C***********          Z-ADD@@J       @@Z71M                          056095
     C***********@@RDAY    SUB  @MD,@@J   @@Z71D                          056095
     C***********                                                         056095
     C**DS*@@VDT* IS RETURNED IN YYYYMMDD FORMAT                          056095
     C***********                                                         056095
     C***********ZA0711    TAG                                            056095
     C***********                                                         056095
     C***********          MOVE @@Z71Y    @@YR                            056095
     C***********                                                         056095
     C***********ZA0719    ENDSR                                          056095
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  SUBROUTINE ZA0770 - THIS SUBROUTINE RECEIVES A 8/0 INPUT     *
     C*                      DATE - FORMAT YYYYMMDD AND OUTPUTS A     *
     C******                 6/0 DATE. IF FIELD DATF ON TABTB10 =     *   S01194
     C******                 'M' OUTPUT FORMAT MMDDYY. IF FIELD       *   S01194
     C******                 DATF = 'D' OUTPUT FORMAT DDMMYY.         *   S01194
     C*                      6/0 DATE. IF FIELD DATE FORMAT (SDBANKPD)*   S01194
     C*                      'M' OUTPUT FORMAT MMDDYY. IF DATE        *   S01194
     C*                      FORMAT = 'D' OUTPUT FORMAT DDMMYY.       *   S01194
     C*                                                               *
     C*  CALLED BY   :                                                *
     C*                                                               *
     C*  INPUT       : @@DTIN  - DATE INPUT (8,0)                     *
     C*  OUTPUT      : @@DTOU  - DATE OUTPUT (6,0)                    *
     C*                                                               *
     C*  WORK FIELDS : @@YYY   - YEAR IN (2,0)                        *
     C*              : @@MM    - MONTH IN (2,0)                       *
     C*              : @@DD    - DAY IN (2,0)                         *
     C*                                                               *
     C*              : @@DAT1  - IF DATE DD/MM/YY DAY ELSE MONTH (2,0)*
     C*              : @@DAT2  - IF DATE DD/MM/YY MONTH ELSE DAY (2,0)*
     C*                                                               *
     C*****************************************************************
     C           ZA0770    BEGSR
     C*
     C                     Z-ADD@@YY      @@YYY
     C*
     C****DATF = 'D' CONVERT TO MMDDYY FORMAT                             S01194
     C*****      DATF      IFEQ 'D'                        B1             S01194
     C**  DATE FORMAT = 'D' CONVERT TO MMDDYY FORMAT                      S01194
     C           BJDFIN    IFEQ 'D'                        B1             S01194
     C                     Z-ADD@@DD      @@DAT1           *1
     C                     Z-ADD@@MM      @@DAT2           *1
     C                     END                             E1
     C*
     C*
     C****DATF*= 'M' CONVERT TO MMDDYY FORMAT                             S01194
     C*****      DATF      IFEQ 'M'                        B1             S01194
     C**  DATE FORMAT = 'M' CONVERT TO MMDDYY FORMAT                      S01194
     C           BJDFIN    IFEQ 'M'                        B1             S01194
     C                     Z-ADD@@DD      @@DAT2           *1
     C                     Z-ADD@@MM      @@DAT1           *1
     C                     END                             E1
     C*
     C**  MOVE YEAR PART OF DATA STRUCTURE
     C                     MOVE @@YYY     @@YY
     C*
     C           ZA0779    ENDSR                           ***ZA0779***
      /EJECT
     C********************************************************************
     C*****                                                               S01195
     C**ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY       S01195
     C*****      IS A HOLIDAY IN A PARTICULAR CURRENCY                    S01195
     C*****                                                               S01195
     C**CALLED BY :                                                       S01195
     C*****                                                               S01195
     C**CALLS :                                                           S01195
     C*****                                                               S01195
     C**INPUT  : @@MNO  MIDAS DAY NUMBER 5N                               S01195
     C*****      @@CCY  CURRENCY CODE 3A                                  S01195
     C*****                                                               S01195
     C**OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A                  S01195
     C*****                                                               S01195
     C**USES :   @@MNO  MIDAS DAY NUMBER                                  S01195
     C*****      @@CCY  CURRENCY CODE                                     S01195
     C*****      @@ONCE FIRST TIME THROUGH INDICATOR                      S01195
     C*****      @@CY1  FIRST HALF OF CURRENCY ARRAY                      S01195
     C*****      @@CY2  SECOND HALF OF CURRENCY ARRAY                     S01195
     C*****      @@MNO6 MIDAS NUMBER WITH TRAILING BLANK                  S01195
     C*****      @@HIND HOLIDAY/WORKING DAY INDICATOR                     S01195
     C*****      @@INEX INCLUDE/EXCLUDE INDICATOR                         S01195
     C*****                                                               S01195
     C*****      INDICATORS                                               S01195
     C*****      80 RECORD NOT FOUND                                      S01195
     C*****      81 CURRENCY NOT FOUND ON RECORD                          S01195
     C*****                                                               S01195
     C********************************************************************S01195
     C*****      ZA0830    BEGSR                                          S01195
     C*****                                                               S01195
     C*****   CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH                 S01195
     C*****      @@ONCE    IFNE 'Y'                        B1             S01195
     C*****                 *   FDTABJLL                   *1             S01195
     C*****                MOVE 'Y'       @@ONCE  1        *1             S01195
     C*****                END                             E1             S01195
     C*****                                                               S01195
     C***BLANK OUT ARRAY                                                  S01195
     C*****                MOVE *BLANKS   @@CY1                           S01195
     C*****                MOVE *BLANKS   @@CY2                           S01195
     C*****                                                               S01195
     C***ACCESS TABLE ON FIRST KEY                                        S01195
     C*****                MOVEL@@MNO     @@MNO6  6                       S01195
     C*****                MOVE @@MNO6    SS0830 12                       S01195
     C*****                MOVEL'22    '  SS0830                          S01195
     C*****                MOVE '1'       SS0830                          S01195
     C*****      SS0830    CHAINTABLETJF             80                   S01195
     C*****                                                               S01195
     C***IF RECORD NOT FOUND OR DELETED                                   S01195
     C*****      *IN80     IFEQ '1'                        B1             S01195
     C*****      RECI      OREQ '*'                        *1             S01195
     C*****                MOVE 'W'       @@HIND           *1             S01195
     C*****                GOTO ZA0839                     *1             S01195
     C*****                END                             E1             S01195
     C*****                                                               S01195
     C***MOVE FIRST 25 CURRENCIES TO ARRAY                                S01195
     C*****                MOVE HCCY      @@CY1                           S01195
     C*****                                                               S01195
     C***ACCESS TABLE ON SECOND KEY                                       S01195
     C*****                MOVE '2'       SS0830                          S01195
     C*****      SS0830    CHAINTABLETJF             80                   S01195
     C*****                                                               S01195
     C***IF SECOND RECORD FOUND AND NOT DELETED                           S01195
     C*****      *IN80     IFEQ '0'                        B1             S01195
     C*****      RECI      ANDNE'*'                        *1             S01195
     C*****                MOVE HCCY      @@CY2            *1             S01195
     C*****                END                             E1             S01195
     C*****                                                               S01195
     C***SEARCH ARRAY FOR INPUT CURRENCY                                  S01195
     C*****      @@CCY     LOKUP@CY                      81               S01195
     C*****                                                               S01195
     C***IF INPUT CURRENCY IS IN ARRAY                                    S01195
     C*****      *IN81     IFEQ '1'                        B1             S01195
     C*****                                                               S01195
     C***IF INCLUDE/EXCLUDE INDICATOR EQ 'E'                              S01195
     C*****      INEX      IFEQ 'E'                        B*2            S01195
     C*****                MOVE 'W'       @@HIND  1        **2            S01195
     C*****                ELSE                            X*2            S01195
     C*****                MOVE 'H'       @@HIND           **2            S01195
     C*****                END                             E*2            S01195
     C*****                END                             E1             S01195
     C*****                                                               S01195
     C***IF INPUT CURRENCY IS NOT IN ARRAY                                S01195
     C*****      *IN81     IFEQ '0'                        B1             S01195
     C*****                                                               S01195
     C***IF INCLUDE/EXCLUDE INDICATOR EQ 'I'                              S01195
     C*****      INEX      IFEQ 'I'                        B*2            S01195
     C*****                MOVE 'W'       @@HIND           **2            S01195
     C*****                ELSE                            X*2            S01195
     C*****                MOVE 'H'       @@HIND           **2            S01195
     C*****                END                             E*2            S01195
     C*****                END                             E1             S01195
     C*****      ZA0839    ENDSR                                          S01195
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  ZA0840 - This subroutine will take as input a 16A field      *
     C*           a 1N number of integers and a 1N number of decimal  *
     C*           places. Ignoring the leading and trailing blanks    *
     C*           it will ensure that the field contains only numeric *
     C*           characters and a decimal point, and that it has no  *
     C*           embedded blanks, or more than one decimal point.    *
     C*           It will also check that the number of figures before*
     C*           and after the decimal point do not exceed the input *
     C*           parameters. The subroutine will output the number as*
     C*           a 16A field and a 15N field, along with an error    *
     C*           code. The alpha field will be right aligned with    *
     C*           the leading zeros blanked, and trailing blanks zero *
     C*           filled. The number returned will be 15 long with 0  *
     C*           decimal places. The error code will contain 0 if    *
     C*           there was no error, 1 if there was a non-numeric    *
     C*           character found, and 2 if the number of decimal     *
     C*           places are wrong.                                   *
     C*                                                               *
     C*  Input  : @@ALPH - 16A field containing the field to validate *
     C*           @@IDP  - number of decimal places                   *
     C*           @@IINT - number of integers                         *
      *           @@MTID - Millions/Thousands id (Y = function on)    *   E17279
     C*                                                               *
     C*  Output : @@ALPH - 16A field for display                      *
     C*           @@AMT  - 15N field for calculation                  *
     C*           @@ERCD - 1N error code                              *
     C*                                                               *
     C*  Uses   : @F     - array of 16 elements 1 character long      *
     C*           @G     - array of 16 elements 1 character long      *
     C*           @@CADP - calculated number of decimal places        *
     C*           @@CINT - calculated number of integers              *
     C*           @@PIDP - position of dp in input array              *
     C*           @@PODP - position of dp in output array             *
     C*           @@C    - index for array @F                         *
     C*           @@D    - index for array @G                         *
     C*           @@WK7  - workfield used for converting array element*
     C*                    to a 1N number.                            *
     C*           @H     - array containing powers of 10              *
     C*           @@E    - index to array @H                          *
     C*           @@WK5  - work field                                 *
     C*           @@ALP1 - feild used to right align 0 decimal places *
      *           @@MIEA - maximum input elements allowed             *   E17279
      *           @@FEL  - first integer element of array @F          *   E17279
      *           @@MTF  - millions or thousands (M or T) flag        *   E17279
      *           @@S    - counter                                    *   E17279
      *           @@S1   - number of decimals after the decimal place *   E17279
      *           @@S2   - counter                                    *   E17279
      *           @@MRTS - tests decimal elements for M or T          *   E17279
     C*****************************************************************
     C*
     C           ZA0840    BEGSR
     C*
     C** initialize the fields and the arrays
     C***********          MOVE '0'       *IN81                           S01434
     C***********          MOVE '0'       *IN82                           S01434
     C                     Z-ADD0         IN81    10                      S01434
     C                     Z-ADD0         IN82    10                      S01434
     C                     MOVE 'N'       @@MTF   1                       E17279
     C                     MOVE 'N'       @@MRT   1                       E17279
     C                     MOVE ' '       @@MRTS  1                       E17279
     C                     Z-ADD0         @@ERCD  10
     C                     Z-ADD0         @@AMT  150
     C                     MOVEA*BLANKS   @G
     C                     MOVEA@@ALPH    @F
     C                     MOVE *BLANKS   @@ALPH 16
     C                     Z-ADD0         @@WK7   10
     C                     Z-ADD0         @@CADP  30
     C                     Z-ADD0         @@CINT  30
     C                     Z-ADD0         @@PIDP  30
     C                     Z-ADD0         @@PODP  30
     C                     Z-ADD0         @@C     20
     C                     Z-ADD0         @@D     20
     C                     Z-ADD0         @@E     20
     C                     Z-ADD0         @@K     20                      E17279
     C*
     C** define the input fields
     C           *LIKE     DEFN @@CADP    @@IDP
     C           *LIKE     DEFN @@CINT    @@IINT
     C           *LIKE     DEFN HKAMNP    @@DAMT                          E46993
     C           *LIKE     DEFN HKBRAT    @@RATS                          E46993
     C*
     C** first check that the number input will not produce a number
     C** output with more than 15 figures.
     C           @@IDP     ADD  @@IINT    @@WK2   20
     C           @@WK2     IFGT 15                         B1
     C                     Z-ADD2         @@ERCD           *1
     C                     GOTO ZA0849                     *1
     C                     END                             E1
     C*
     C** work through input array, ignoring leading zeros and blanks,
     C** also blanking the leading zeros in the input array.
     C***********          MOVE '0'       *IN83                           S01434
     C                     Z-ADD0         IN83    10                      S01434
     C                     ADD  1         @@C
     C           @@C       DOWLE16                         B1
     C************IN83     ANDEQ'0'                        *1             S01434
     C           IN83      ANDEQ0                                         S01434
     C           @F,@@C    IFNE ' '                        B*2
     C           @F,@@C    ANDNE'0'                        **2
     C***********          MOVE '1'       *IN83            **2            S01434
     C                     Z-ADD1         IN83                            S01434
     C                     SUB  1         @@C              **2
     C                     END                             E*2
     C                     ADD  1         @@C              **2
     C                     END                             E1
      * Following code removed. As the code above ignores 0 then @@C      E23032
      * currently contains the first non-zero element.                    E23032
      * If first integer is a zero subtract 1 from @@C to provide   E17279E23032
      * correct first integer element of the array.                 E17279E23032
     C           @@C       IFNE 1                                   E17279E23032
     C                     SUB  1         @@C                       E17279E23032
     C           @F,@@C    IFNE '0'                                 E17279E23032
     C                     ADD  1         @@C                       E17279E23032
     C                     END                                      E17279E23032
     C                     END                                      E17279E23032
     C                     Z-ADD@@C       @@FEL   20                      E17279
     C*
     C** check the integer part of the number for valid characters.
     C           @@C       DOWLE16                         B1
     C***********@F,@@C****ANDNE'.'                        *1             073516
     C           @F,@@C    ANDNEBNDCSP                     *1             073516
     C           @F,@@C    ANDNE' '                        *1
     C*
     C** check for non numeric characters
      ** If @@MTID = Y ,allow M or T - for millions and thousands         E17279
      ** processing.                                                      E17279
     C           @F,@@C    IFGT '9'                        B*2
     C           @F,@@C    ORLT '0'                        **2
     C           @F,@@C    IFEQ 'M'                        **2            E17279
     C           @@MTID    ANDNE'Y'                                       E17279
     C           @F,@@C    OREQ 'T'                        **2            E17279
     C           @@MTID    ANDNE'Y'                                       E17279
     C           @F,@@C    ORNE 'M'                        **2            E17279
     C           @F,@@C    ANDNE'T'                                       E17279
     C                     Z-ADD0         @@AMT            **2
     C                     Z-ADD1         @@ERCD           **2
     C                     GOTO ZA0849                     **2
     C                     END                                            E17279
     C*
     C                     ELSE                            X*2
     C*
     C           @F,@@C    IFNE 'M'                                       E17279
     C           @F,@@C    ANDNE'T'                                       E17279
     C                     ADD  1         @@CINT           **2
     C                     END                                            E17279
     C*
     C** check number of integers is not greater than that required
     C           @@CINT    IFGT @@IINT                     B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD2         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
     C*
     C** multiply the output amount by 10 then add the number in
     C** the input array element being processed.
     C           @F,@@C    IFNE 'M'                                       E17279
     C           @F,@@C    ANDNE'T'                                       E17279
     C           @@AMT     MULT 10        @@AMT            **2
     C                     MOVE @F,@@C    @@WK7            **2
     C           @@AMT     ADD  @@WK7     @@AMT            **2
     C                     END                                            E17279
     C                     END                             E*2
      *                                                                   E17279
      ** MT or TM etc not allowed.                                        E17279
      *                                                                   E17279
     C           @@MTF     IFEQ 'Y'                                       E17279
     C           @F,@@C    IFEQ 'M'                                       E17279
     C           @F,@@C    OREQ 'T'                                       E17279
     C                     Z-ADD0         @@AMT                           E17279
     C                     Z-ADD1         @@ERCD                          E17279
     C                     GOTO ZA0849                                    E17279
     C                     END                                            E17279
     C                     END                                            E17279
      *                                                                   E17279
     C           @F,@@C    IFEQ 'M'                                       E17279
     C                     MOVE 'Y'       @@MTF                           E17279
     C           @@C       SUB  1         @@K                             E17279
      * If M entered alone add 1 @@amt.                                   E17279
     C           @@AMT     IFEQ 0                                         E17279
     C           @F,@@K    ANDNE'0'                                       E17279
     C                     Z-ADD1         @@AMT                           E17279
     C                     END                                            E17279
     C           @@AMT     MULT 1000000   @@AMT                           E17279
     C                     Z-ADD6         @@MIEA  20                      E17279
     C                     END                                            E17279
      *                                                                   E17279
     C           @F,@@C    IFEQ 'T'                                       E17279
     C                     MOVE 'Y'       @@MTF                           E17279
     C           @@C       SUB  1         @@K                             E17279
      * If T entered alone add 1 @@amt.                                   E17279
     C           @@AMT     IFEQ 0                                         E17279
     C           @F,@@K    ANDNE'0'                                       E17279
     C                     Z-ADD1         @@AMT                           E17279
     C                     END                                            E17279
     C           @@AMT     MULT 1000      @@AMT                           E17279
     C                     Z-ADD3         @@MIEA                          E17279
     C                     END                                            E17279
     C*
     C** increase array index
     C                     ADD  1         @@C              *1
     C                     END                             E1
     C*
     C** set up position of decimal point in input array
     C                     Z-ADD@@C       @@PIDP
     C*
     C** if the character pointed to is a decimal point add 1 to the
     C** index
     C           @@C       IFLE 16                         B1
     C***********@F,@@C****ANDEQ'.'                        *1             073516
     C           @F,@@C    ANDEQBNDCSP                     *1             073516
     C                     ADD  1         @@C              *1
     C***********          MOVE '1'       *IN82            *1             S01434
     C                     Z-ADD1         IN82                            S01434
     C                     END                             E1
      * Set Maximum input elements allowed to the correct figure.         E17279
     C           @@MTF     IFEQ 'Y'                                       E17279
     C           @@C       SUB  @@FEL     @@FEL                           E17279
     C           @@FEL     ADD  @@MIEA    @@MIEA                          E17279
     C                     ELSE                                           E17279
     C           @@C       SUB  @@FEL     @@MIEA                          E17279
     C                     END                                            E17279
      *                                                                   E17279
      ** Read through array checking to see if there is an M or T.        E17279
     C                     Z-ADD@@C       @@S     20                      E17279
     C                     Z-ADD@@C       @@S1    20                      E17279
     C           @@S       DOWLE16                                        E17279
     C           @F,@@S    IFEQ 'M'                                       E17279
     C           @F,@@S    OREQ 'T'                                       E17279
     C                     MOVEA@F,@@S    @@MRTS                          E17279
     C                     MOVE 'Y'       @@MRT                           E17279
     C                     Z-ADD@@S       @@S2    20                      E17279
     C                     END                                            E17279
     C                     ADD  1         @@S                             E17279
     C                     END                                            E17279
      * Calculate the number of decimals after the decimal point.         E17279
     C           @@S2      SUB  @@S1      @@S1                            E17279
      * In thousands - only 3 decimal places allowed.                     E17279
     C           @@MRTS    IFEQ 'T'                                       E17279
     C           @@S1      IFGT 3                                         E17279
     C                     Z-ADD0         @@AMT                           E17279
     C                     Z-ADD1         @@ERCD                          E17279
     C                     GOTO ZA0849                     ***3           E17279
     C                     END                             E**3           E17279
     C                     END                             E**3           E17279
      * In millions  - only 6 decimal places allowed.                     E17279
     C           @@MRTS    IFEQ 'M'                                       E17279
     C           @@S1      IFGT 6                                         E17279
     C                     Z-ADD0         @@AMT            ***3           E17279
     C                     Z-ADD1         @@ERCD                          E17279
     C                     GOTO ZA0849                     ***3           E17279
     C                     END                             E**3           E17279
     C                     END                             E**3           E17279
     C*
     C** now validate the decimal part of the number
     C           @@C       DOWLE16                         B1
     C*
     C** if a blank is found set on the blank input indicator
     C           @F,@@C    IFEQ ' '                        B*2
     C***********          MOVE '1'       *IN81            **2            S01434
     C                     Z-ADD1         IN81                            S01434
     C                     END                             E*2
     C*
     C** if the figure is numeric, check that the number of decimal
     C** places does not exceed that specified, and that no blanks
     C** have been entered.
     C           @F,@@C    IFGE '0'                        B*2
     C           @F,@@C    ANDLE'9'                        **2
     C           @F,@@C    OREQ 'T'                        **2            E17279
     C           @@MTID    ANDEQ'Y'                                       E17279
     C           @F,@@C    OREQ 'M'                        **2            E17279
     C           @@MTID    ANDEQ'Y'                                       E17279
      *                                                                   E17279
     C           @@MRT     IFNE 'Y'                                       E17279
     C                     ADD  1         @@CADP           **2
     C                     END                                            E17279
     C*
     C           @@CADP    IFGT @@IDP                      B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD2         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
     C*
     C************IN81     IFEQ '1'                        B**3           S01434
     C           IN81      IFEQ 1                                         S01434
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD1         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
     C*
     C** update output amount
     C           @F,@@C    IFNE 'M'                                       E17279
     C           @F,@@C    ANDNE'T'                                       E17279
     C           @@AMT     MULT 10        @@AMT            **2
     C                     MOVE @F,@@C    @@WK7            **2
     C                     ADD  @@WK7     @@AMT            **2
     C                     END                                            E17279
      * MT or TM etc not allowed.                                         E17279
     C           @@MTF     IFEQ 'Y'                                       E17279
     C           @F,@@C    IFEQ 'M'                                       E17279
     C           @F,@@C    OREQ 'T'                                       E17279
     C                     Z-ADD0         @@AMT            ***3           E17279
     C                     Z-ADD1         @@ERCD                          E17279
     C                     GOTO ZA0849                                    E17279
     C                     END                                            E17279
     C                     END                                            E17279
      *                                                                   E17279
     C           @F,@@C    IFEQ 'M'                                       E17279
     C                     MOVE 'Y'       @@MTF                           E17279
      * Multiply @@amt by the correct factor and add the number           E17279
      * digits to @@MIEA.                                                 E17279
     C           @@S1      IFEQ 1                                         E17279
     C           @@AMT     MULT 1000000   @@AMT                           E17279
     C                     ADD  6         @@MIEA                          E17279
     C                     END                                            E17279
     C           @@S1      IFEQ 2                                         E17279
     C           @@AMT     MULT 100000    @@AMT                           E17279
     C                     ADD  5         @@MIEA                          E17279
     C                     END                                            E17279
     C           @@S1      IFEQ 3                                         E17279
     C           @@AMT     MULT 10000     @@AMT                           E17279
     C                     ADD  4         @@MIEA                          E17279
     C                     END                                            E17279
     C           @@S1      IFEQ 4                                         E17279
     C           @@AMT     MULT 1000      @@AMT                           E17279
     C                     ADD  3         @@MIEA                          E17279
     C                     END                                            E17279
     C           @@S1      IFEQ 5                                         E17279
     C           @@AMT     MULT 100       @@AMT                           E17279
     C                     ADD  2         @@MIEA                          E17279
     C                     END                                            E17279
     C           @@S1      IFEQ 6                                         E17279
     C           @@AMT     MULT 10        @@AMT                           E17279
     C                     ADD  1         @@MIEA                          E17279
     C                     END                                            E17279
      *                                                                   E17279
     C                     END                                            E17279
      *                                                                   E17279
     C           @F,@@C    IFEQ 'T'                                       E17279
     C                     MOVE 'Y'       @@MTF                           E17279
      * Multiply @@amt by the correct factor and add the number           E17279
      * digits to @@MIEA.                                                 E17279
     C           @@S1      IFEQ 1                                         E17279
     C           @@AMT     MULT 1000      @@AMT                           E17279
     C                     ADD  3         @@MIEA                          E17279
     C                     END                                            E17279
     C           @@S1      IFEQ 2                                         E17279
     C           @@AMT     MULT 100       @@AMT                           E17279
     C                     ADD  2         @@MIEA                          E17279
     C                     END                                            E17279
     C           @@S1      IFEQ 3                                         E17279
     C           @@AMT     MULT 10        @@AMT                           E17279
     C                     ADD  1         @@MIEA                          E17279
     C                     END                                            E17279
      *                                                                   E17279
     C                     END                                            E17279
     C*
     C                     ELSE                            X*2
     C*
     C** if the character is not numeric and not a blank then it is
     C** invalid
     C           @F,@@C    IFNE ' '                        B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD1         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C** increase index
     C                     ADD  1         @@C              *1
     C*
     C                     END                             E1
      * Check that the number of elements input does not exceed allowed   E17279
     C           @@MIEA    ADD  @@IDP     @@MIEA                          E17279
     C           @@MIEA    IFGT 14                         B1             E17279
     C                     Z-ADD2         @@ERCD           *1             E17279
     C                     GOTO ZA0849                     *1             E17279
     C                     END                             E1             E17279
     C*
     C** correct the output number for any decimal places not input
     C** in the alpha field.
     C           @@IDP     SUB  @@CADP    @@E
     C*
     C** increase the index by one to get correct array entry
      ** If @@IDP = 0 add 1 to @@E to prevent array index error.          E17279
     C           @@MRT     IFEQ 'N'                                       E17279
     C           @@IDP     OREQ 0                                         E17279
     C                     ADD  1         @@E
     C                     END                                            E17279
     C           @@AMT     MULT @H,@@E    @@AMT
      *                                                                   E17279
     C           @@MRT     IFEQ 'Y'                                       E17279
     C           @@IDP     ANDEQ0                                         E17279
     C           @@AMT     DIV  10        @@AMT                           E17279
     C                     END                                            E17279
     C*
     C** now format the output alpha field, first calculate where
     C** the decimal point goes
     C           16        SUB  @@IDP     @@PODP
     C           @@PODP    SUB  1         @@PIDP
     C*
     C** if there are no decimal points set the position to 17
     C           @@IDP     IFEQ 0                          B1
     C                     Z-ADD17        @@PODP           *1
     C                     END                             E1
     C*
     C** move the output number into the input array
     C                     MOVEA*BLANKS   @F
     C                     MOVE @@AMT     @@AMTA 15
     C                     MOVEA@@AMTA    @F
     C*
     C** set up indexes
     C                     Z-ADD1         @@C
     C                     Z-ADD1         @@D
     C***********          MOVE '0'       *IN80                           S01434
     C                     Z-ADD0         IN80    10                      S01434
     C*
     C** now fill up the output array
     C           @@D       DOWLE16                         B1
     C*
     C** insert decimal point if the position is found
     C           @@D       IFEQ @@PODP                     B*2
     C*********************MOVE '.'       @G,@@D           **2            073516
     C                     MOVE BNDCSP    @G,@@D           **2            073516
     C                     ADD  1         @@D              **2
     C                     END                             E*2
     C*
     C** insert the zero before the decimal point
     C************IN80     IFEQ '0'                        B*2            S01434
     C           IN80      IFEQ 0                                         S01434
     C           @@D       ANDEQ@@PIDP                     **2
     C           @F,@@C    ANDEQ'0'                        **2
     C***********          MOVE '1'       *IN80            **2            S01434
     C                     Z-ADD1         IN80                            S01434
     C                     MOVE '0'       @G,@@D           **2
     C                     END                             E*2
     C*
     C** blank leading zeros
     C************IN80     IFEQ '0'                        B*2            S01434
     C           IN80      IFEQ 0                                         S01434
     C           @F,@@C    ANDEQ'0'                        **2
     C                     MOVE ' '       @G,@@D           **2
     C                     END                             E*2
     C*
     C** move a normal character
     C           @F,@@C    IFGE '1'                        B*2
     C           @F,@@C    ANDLE'9'                        **2
     C                     MOVE @F,@@C    @G,@@D           **2
     C***********          MOVE '1'       *IN80            **2            S01434
     C                     Z-ADD1         IN80                            S01434
     C                     END                             E*2
     C*
     C** non blanked zero
     C           @F,@@C    IFEQ '0'                        B*2
     C************IN80     ANDEQ'1'                        **2            S01434
     C           IN80      ANDEQ1                                         S01434
     C                     MOVE '0'       @G,@@D           **2
     C                     END                             E*2
     C*
     C                     ADD  1         @@C              *1
     C                     ADD  1         @@D              *1
     C                     END                             E1
     C*
     C*
     C** put output array into output amount
     C                     MOVEA@G        @@ALPH
     C*
     C** align figure with zero decimal places.
     C           @@IDP     IFEQ 0                          B1
     C                     MOVE *BLANKS   @@ALP1 17        *1
     C                     MOVE @@ALPH    @@ALP1           *1
     C                     MOVEL@@ALP1    @@ALPH           *1
     C                     END                             E1
     C*
     C           ZA0849    ENDSR                           ZA0849 TAG
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*       TITLE:BACK OFFICE AMOUNT EDITOR .                       *
     C*                                                               *
     C*       SUBROUTINE ZA0920 ACCEPTS AN AMOUNT FIELD (13N) AND     *
     C*       A FIELD (1N) SPECIFYING NO. OF DECIMALS AND WITH THIS   *
     C*       CONVERTS THE AMOUNT INTO AN ALPHAMERIC FIELD (14A)      *
     C*       WITH THE REQUIRED DECIMAL PLACE.                        *
     C*                                                               *
     C*                                                               *
     C* INPUT  :@@AMTW AMOUNT      FORMAT(13N)                     *
     C*         @@QECN DECIMAL NO. FORMAT(1N)                     *
     C*                                                               *
     C* OUTPUT :@@AMTD AMOUNT WITH DECIMAL FORMAT(14A)                *
     C*                                                               *
     C* USES :  @@AMTW AMOUNT FIELD PASSED                            *
     C*         @@QECN NO. OF DECIMAL FIELD                           *
     C*         @@QECW POSITION ON ARRAY @Z  FOR A DECIMAL POINT     *
     C*         @@SIG  POSITION ON ARRAY THAT CANNOT BE BLANK         *
     C*         @@Z    INDEX FOR ARRAY @Z                             *
     C*         @@Q    INDEX FOR ARRAY @Q                             *
     C*         @@SWT  SWITCH SAYING ZERO HAS BEEN SUPPRESSED         *
     C*         @@SWT1 SWITCH SAYING ZERO SUPPRESSION OVER            *
     C*                                                               *
     C* ARRAYS:  @Z ARRAY USED FOR DECIMAL ALIGNMENT                  *
     C*          @Q ARRAY USED FOR STORING AMOUNT PASSED TO THE SR    *
     C*                                                               *
     C*****************************************************************
     C*                                                               *
     C           ZA0920    BEGSR
     C*
     C* INITIALIZATION
     C                     MOVE '0'       @@SWT1  1
     C*
     C* FINDING WHERE DECIMAL POSITION IS
     C*
     C           14        SUB  @@QECN    @@QECW  20
     C*
     C* FINDING OUT MOST SIGNIFICANT POSITION
     C*
     C           @@QECW    SUB  1         @@SIG   20
     C                     MOVEA*BLANKS   @Z
     C                     Z-ADD1         @@Q     20
     C*
     C* CHECK TO SEE IF NO.OF DECIMAL PLACES IS ZERO. IF ZERO
     C* THEN SIGNIFICANT POSITION IS 14 AND POSITION 1 IS BLANK
     C           @@QECW    IFEQ 14
     C                     Z-ADD14        @@SIG
     C                     Z-ADD2         @@Z     20
     C                     ELSE
     C                     Z-ADD1         @@Z     20
     C                     END
     C*
     C* PERFORMING ACTUAL MOVEMENT
     C           @@Z       DOWLT15
     C           @@Q       ANDLT14
     C*
     C* SWITCH FOR ZERO SUPPRESSION
     C                     MOVE '0'       @@SWT
     C*
     C* IF ELEMENT OF ARRAY @Q  IS ZERO AND INDEX @@Z FOR ARRAY @Z
     C* IS *LT SIG.POSITION AND ALSO *LT DECIMAL POSITION THEN ZERO
     C* CAN BE SUPPRESSED AND ZERO SUPPRESSION SWITCH IS SETON
     C*
     C           @Q,@@Q    IFEQ 0
     C           @@SWT1    ANDEQ'0'
     C           @@Z       ANDLT@@SIG
     C           @@Z       ANDLT@@QECW
     C                     MOVE *BLANK    @Z,@@Z
     C                     MOVE '1'       @@SWT   1
     C                     END
     C*
     C* IF INDEX @@Z FOR ARRAY @Z IS EQUAL TO THE DECIMAL POSITION
     C* AND NOT EQUAL TO THE LENGTH OF THE ARRAY @Z(14) THEN MOVE
     C* DECIMAL POSITION AND INCREMENT @@Z BY 1
     C*
     C           @@Z       IFEQ @@QECW
     C           @@Z       ANDNE14
     C*********************MOVE '.'       @Z,@@Z                          073516
     C                     MOVE BNDCSP    @Z,@@Z                          073516
     C                     ADD  1         @@Z
     C                     END
     C*
     C* IF ZERO HAS NOT BEEN SUPPRESSED THEN MOVE ELEMENT FROM ARRAY
     C* @Q TO @Z.SETON ZERO SUPPRESSION SWITCH OVER(@@SWT1)
     C           @@SWT     IFEQ '0'
     C                     MOVE @Q,@@Q    @Z,@@Z
     C                     MOVE '1'       @@SWT1
     C                     END
     C*
     C                     ADD  1         @@Q
     C                     ADD  1         @@Z
     C*
     C                     END
      *
      * Dummy moves for definition of work fields.
     C                     GOTO ZA0929
     C                     MOVE @@QECN    @@QECN  10
      *
     C           ZA0929    ENDSR
      /EJECT
     C****************************************************************
     C*                                                              *
     C*     ZA1020 -  Convert Amount to Display                      *
     C*                                                              *
     C*     CALLS:                                                   *
     C*                                                              *
     C*     INPUT:   @@IAMT - Input amount.                          *
     C*              @@CRET - Number of characters to return.        *
     C*              @@CDP  - Currency decimal places.               *
     C*                                                              *
     C*     OUTPUT:  @@ADSP - Amount to display.                     *
     C*                                                              *
     C*     USES:    @@C    Index for array @D.                      *
     C*              @@D    Index for array @E.                      *
     C*              @@E    Index for array @D.                      *
     C*              @@F    Work field.                              *
     C*              @@G    Index for array @E.                      *
     C*              @@H    Index for array @C.                      *
     C*              @@MAX  Maximum no. of integer positions.        *
     C*              @@CNT1 Counter field.                           *
     C*              @@CNT2 Counter field.                           *
     C*              @@RES  Result of a division operation.          *
     C*              @@REMD Remainder of a division operation.       *
     C*              @@CMOV No. of characters set up to be returned. *
     C*              @@DIFF Difference between @@CMOV and @@CRET.    *
     C*              @C     Work array.                              *
     C*              @D     Array for input amount.                  *
     C*              @E     Array to set up display amount.          *
     C*              @@CRET Number of chars. that must be returned.  *
     C*              @@AMDS Data structure to convert input amount   *
     C*                     to alpha field.                          *
     C*                                                              *
     C****************************************************************
     C*
     C           ZA1020    BEGSR
     C*
     C**  Define and initialise fields used.
     C                     Z-ADD@@IAMT    @@IAMT 150
     C                     Z-ADD@@CRET    @@CRET  20
     C                     Z-ADD@@CDP     @@CDP   10
     C                     MOVE *BLANKS   @@ADSP 21
     C*
     C                     Z-ADD*ZEROS    @@C     20
     C                     Z-ADD*ZEROS    @@D     20
     C                     Z-ADD*ZEROS    @@E     20
     C                     Z-ADD*ZEROS    @@F     20
     C                     Z-ADD*ZEROS    @@G     20
     C                     Z-ADD*ZEROS    @@H     20
     C                     Z-ADD*ZEROS    @@MAX   20
     C                     Z-ADD*ZEROS    @@CNT1  20
     C                     Z-ADD*ZEROS    @@CNT2  20
     C                     Z-ADD*ZEROS    @@RES   20
     C                     Z-ADD*ZEROS    @@CMOV  20
     C                     Z-ADD*ZEROS    @@DIFF  20
     C                     Z-ADD*ZEROS    @@REMD  10
     C                     Z-ADD*ZEROS    @@MRET  20
     C*
     C**  Initialise arrays.
     C                     MOVEA*BLANKS   @C
     C                     MOVEA*BLANKS   @D
     C                     MOVEA*BLANKS   @E
     C*
     C**  Take modulus of input amount.
     C           @@IAMT    IFLT *ZERO                      B1
     C                     Z-SUB@@IAMT    @@IAMT           *1
     C                     END                             E1
     C*
     C**  Move input amount to @D.
     C                     MOVEA@@AMDS    @D
     C*
     C**  Move decimal portion of amount to @E.
     C                     Z-ADD15        @@C
     C                     Z-ADD21        @@D
     C*
     C           21        SUB  @@CDP     @@MAX
     C           @@D       DOWGT@@MAX                      B1
     C                     MOVE @D,@@C    @E,@@D           *1
     C                     SUB  1         @@C              *1
     C                     SUB  1         @@D              *1
     C                     END                             E1
     C*
     C**  Move decimal separator to @E.
     C           @@CDP     IFNE 0                          B1
     C*********************MOVE*IDDCSP****@E,@@D************1*************S01319
     C                     MOVE BNDCSP    @E,@@D           *1             S01319
     C                     SUB  1         @@D              *1
     C                     END                             E1
     C*
     C**  Find position of last character to be moved.
     C                     Z-ADD1         @@E
     C*
     C           @@E       DOWLT15                         B1
     C           @D,@@E    ANDEQ'0'                        *1
     C                     ADD  1         @@E              *1
     C                     END                             E1
     C*
     C**  Move integer portion of amount to @E.
     C                     Z-ADD0         @@CNT1
     C                     Z-ADD0         @@CNT2
     C*
     C           @@C       DOWGT@@E                        B1
     C                     MOVE @D,@@C    @E,@@D           *1
     C                     ADD  1         @@CNT1           *1
     C                     SUB  1         @@C              *1
     C                     SUB  1         @@D              *1
     C*
     C**  Insert thousand separators.
     C           @@CNT1    DIV  3         @@RES            *1
     C                     MVR            @@REMD           *1
     C           @@REMD    IFEQ 0                          B*2
     C           @@CNT2    ANDLT5                          **2
     C*********************MOVE*IDTHSP****@E,@@D*************2************S01319
     C                     MOVE BNTHSP    @E,@@D           **2            S01319
     C                     ADD  1         @@CNT2           **2
     C                     Z-ADD@@D       @@F              **2
     C                     SUB  1         @@D              **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  Move last character.
     C                     MOVE @D,@@C    @E,@@D
     C*
     C**  Calculate the number of characters that must be returned.
     C           22        SUB  @@D       @@CMOV
     C           @@CMOV    SUB  @@CNT2    @@MRET
     C*
     C**  If number of characters to be returned is greater than the
     C**  number that must be returned.
     C           @@MRET    IFGT @@CRET                     B1
     C*
     C**  Output the required no. of characters, but all '*'.
     C           22        SUB  @@CRET    @@G              *1
     C                     MOVEA*BLANKS   @E               *1
     C                     MOVEA*ALL'*'   @E,@@G           *1
     C                     GOTO ZA1028                     *1
     C                     END                             E1
     C*
     C**  If number of characters moved is greater than number to be
     C**  returned, drop thousand separators until satisfied.
     C           @@CMOV    SUB  @@CRET    @@DIFF
     C           @@DIFF    IFGT 0                          B1
     C                     DO   @@DIFF                     B*2
     C                     Z-ADD1         @@G              **2
     C                     Z-ADD2         @@H              **2
     C           @@G       DOWLE21                         B**3
     C                     MOVE @E,@@G    @C,@@H           ***3
     C                     ADD  1         @@G              ***3
     C                     ADD  1         @@H              ***3
     C           @@G       IFEQ @@F                        B***4
     C                     ADD  1         @@G              ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     MOVEA@C        @E               **2
     C                     ADD  4         @@F              **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  Tag ZA1028.
     C           ZA1028    TAG                             **ZA1028**
     C*
     C**  Move @E to display field.
     C                     MOVEA@E        @@ADSP
     C*
     C           ZA1029    ENDSR                           **ZA1029**
      /EJECT
     C********************************************************************
     C*
     C* MM1004 - CALCULATE THE NEXT INTEREST PAYMENT DATE
     C*
     C* CALLED BY :
     C*
     C**CALLS :  ZA0830, A COMMON ROUTINE TO DETERMINE WHETHER A DATE     S01195
     C*****      IS A WORKING DAY OR A HOLIDAY.                           S01195
     C**CALLS*:**ZA0680,*A*COMMON*ROUTINE*TO*CONVERT*DATE*IN*YYYYMMDS01195056095
     C* CALLS :  ZDAT10, A COMMON ROUTINE TO CONVERT DATE IN YYYYMMDD     056095
     C*          FORMAT TO MIDAS DAY NUMBER.
     C********:**ZA0710,*A*COMMON*ROUTINE*TO*CONVERT*MIDAS*DAY*NUMBER**   056095
     C*       :  ZDATE9, A COMMON ROUTINE TO CONVERT MIDAS DAY NUMBER     056095
     C*          TO DATE FORMAT OF YYYYMMDD.
     C*       :  ZCHKH,  A COMMON ROUTINE TO DETERMINE WHETHER A DATE     S01195
     C*          IS A WORKING DAY OR A HOLIDAY.                           S01195
     C*
     C* INPUT  : @@STRT START DATE                           (8N)
     C*          @@FREQ PAYMENT FREQUENCY                    (1A)
     C*****      @@CCY  CURRENCY CODE                        (3A)         S01195
     C*          @@MDAY INTEREST PAYMENT DAY IN THE MONTH    (2N)
     C*          @@MDAT MATURITY DATE                        (8N)
     C*          ZCCY   CURRENCY CODE                        (3A)         S01195
     C*          ZLOC   LOCATION CODE                        (3A)         S01195
     C*
     C* OUTPUT : @@NDAT NEXT PAYMENT DATE (MIDAS DAY NUMBER) (8N)
     C*
     C**USES*:***@@DTIN*DATE*PASSED*TO***********SR*ZA0680***(8N)******   056095
     C***********@@MDNO*MIDAS*DAY*NUMBER*FROM****SR*ZA0680***(5N)******   056095
     C* USES :   ZZDTIN DATE PASSED TO           SR ZDAT10   (8N)         056095
     C*          ZZMDNO MIDAS DAY NUMBER FROM    SR ZDAT10   (5N)         056095
     C*****      @@MNO  DAY NUMBER PASSED TO     SR ZA0830   (5N)         S01195
     C*****      @@HIND HOLIDAY/WORKING DAY IND. SR ZA0830   (1A)         S01195
     C***********@@DAYN*DAY*NUMBER*PASSED*TO*****SR*ZA0710***(5N)******   056095
     C***********@@VDT**DATE*IN*FORMAT*YYYYMMDD**SR*ZA0710***(8N)******   056095
     C*          @@DAYN DAY NUMBER PASSED TO     SR ZDATE9   (5N)         056095
     C*          @@VDT  DATE IN FORMAT YYYYMMDD  SR ZDATE9   (8N)         056095
     C*          @@DNO  WORK FIELD - DAY NUMBER              (5N)
     C*          @@CCY  CURRENCY CODE                        (3A)
     C*          @@WF16 WORK FIELD - # DAYS IN THE MONTH     (2N)
     C*          @@HWIN WORK FIELD - HOLIDAY/WORK INDICATOR  (1A)
     C*          @@WKDT WORK FIELDS DS TO MANIPULATE DATE    (8N)
     C*          @@WKYY WORK FIELDS DS  - YEAR FIELD YYYY    (4N)
     C*          @@WKY  WORK FIELDS DS  - YEAR FIELD   YY    (2N)
     C*          @@WKM  WORK FIELDS DS  - MONTH FIELD        (2N)
     C*          @@WKD  WORK FIELDS DS  - DAY FIELD          (2N)
     C*          @@WKD2 WORK FIELDS - MAXIMUM DAYS IN MONTH  (2N)
     C*          @@REM2 LEAP YEAR CALCS - REMAINDER FIELD    (3N)
     C*
     C********************************************************************
     C           MM1004    BEGSR
     C*
     C** Re-set the indicators used within this subroutine.
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN82
     C*
     C** Move the start date input into a working fields DS.
     C                     MOVE @@STRT    @@WKDS
     C*
     C** IF     the interest payment day in month is blank
     C**        THEN     substitue day from start date into that field.
     C** END
     C*
     C           @@MDAY    IFEQ 0                          B1
     C                     Z-ADD@@WKD     @@MDAY  20       *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is blank
     C**        THEN next interest date is set to maturity date
     C** END
     C*
     C           @@FREQ    IFEQ *BLANK                     B1
     C                     Z-ADD@@MDAT    @@NDAT           *1
     C                     GOTO M10049                     *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is monthly
     C**        THEN     increment the month by 1.
     C** END
     C           @@FREQ    IFEQ 'M'                        B1
     C                     ADD  1         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is quarterly.
     C**        THEN     increment the month by 3.
     C** END
     C           @@FREQ    IFEQ 'Q'                        B1
     C                     ADD  3         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is six-monthly
     C**        THEN     increment the month by 6.
     C** END
     C           @@FREQ    IFEQ 'X'                        B1
     C                     ADD  6         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is yearly
     C**        THEN     increment the year by 1.
     C** END
     C           @@FREQ    IFEQ 'Y'                        B1
     C                     ADD  1         @@WKYY           *1
     C                     END                             E1
     C*
     C** Substitute day in month into the day field.
     C*
     C                     Z-ADD@@MDAY    @@WKD
     C*
     C** IF     the new month now exceeds 12
     C**        THEN     subtract 12 from the month
     C**                 increment the year by 1
     C** END
     C*
     C           @@WKM     IFGT 12                         B1
     C           @@WKM     SUB  12        @@WKM            *1
     C                     ADD  1         @@WKYY           *1
     C                     END                             E1
     C*
     C** IF     the days now exceed the number of days for that month
     C**        THEN     substitue the maximum # of days to that field
     C**              IF     leap year and month is February
     C**                     THEN     add an extra day to the day field
     C**              END
     C** END
     C*
     C***********          MOVE @M,@@WKM  @@WKD2  20     80               S01434
     C                     MOVE @M,@@WKM  @@WKD2  20                      S01434
     C           @@WKD2    IFEQ 0                                         S01434
     C                     Z-ADD1         IN80                            S01434
     C                     ELSE                                           S01434
     C                     Z-ADD0         IN80                            S01434
     C                     END                                            S01434
     C           @@WKD     IFGT @@WKD2                     E1
     C                     Z-ADD@@WKD2    @@WKD            *1
     C*
     C** Test for leap year, and turn of century leap year.
     C** NB: only every 400 years is a leap year.
     C           @@WKY     IFEQ 0                          B*2
     C           @@WKYY    DIV  400       @@WF16  30       **2
     C***********          MVR            @@REM2  30     82**2            S01434
     C                     MVR            @@REM2  30                      S01434
     C                     ELSE                            X*2
     C           @@WKYY    DIV  4         @@WF16           **2
     C***********          MVR            @@REM2         82**2            S01434
     C                     MVR            @@REM2                          S01434
     C                     END                             E*2
     C           @@REM2    IFEQ 0                                         S01434
     C                     Z-ADD1         IN82                            S01434
     C                     ELSE                                           S01434
     C                     Z-ADD0         IN82                            S01434
     C                     END                                            S01434
     C*
     C************IN82     IFEQ '1'                        B*2            S01434
     C           IN82      IFEQ 1                                         S01434
     C           @@WKM     IFEQ 2                          B**3
     C                     ADD  1         @@WKD            ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** Convert payment date to midas format.
     C*
     C***********          Z-ADD@@WKDT    @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********          Z-ADD@@MDNO    @@DNO   50                      056095
     C                     Z-ADD@@WKDT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    @@DNO   50                      056095
     C*
     C** DOWHILE     payment date is NOT a valid woking day
     C**             increment the day number
     C** WEND
     C*
     C           @@HWIN    DOUEQ'W'                        B1
     C*****                Z-ADD@@DNO     @@MNO   50       *1             S01195
     C*****                EXSR ZA0830                     *1             S01195
     C*****                MOVE @@HIND    @@HWIN  1        *1             S01195
     C                     Z-ADD@@DNO     ZDAYNO           *1             S01195
     C                     EXSR ZCHKH                      *1             S01195
     C                     MOVE ZIND      @@HWIN  1        *1             S01195
     C           @@HWIN    IFNE 'W'                        B*2
     C                     ADD  1         @@DNO            **2
     C                     END                             E**2
     C                     END                             E1
     C*
     C** Convert payment day number back to YYYYMMDD format.
     C*
     C                     Z-ADD@@DNO     @@DAYN  50
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     @@NDAT  80
     C                     GOTO M10049
     C*
     C**  Unexecuted code to define fields
     C                     MOVEL@@FREQ    @@FREQ  1
     C                     MOVEL@@STRT    @@STRT  80
     C                     MOVEL@@MDAT    @@MDAT  80
     C                     MOVEL@@CCY     @@CCY   3
     C*
     C           M10049    ENDSR
      /EJECT
     C*****************************************************************
     C*   MM1007 - CALCULATE INTEREST                                 *
     C*                                                               *
     C*  CALLED BY    -                                               *
     C*                                                               *
     C*  CALLS        -   MM1009 CALCULATE NO. OF INTEREST DAYS       *
     C*                                                               *
     C*  FIELDS INPUT @@BEG  - START DATE OF PERIOD                   *
     C*               @@END  - END DATE OF PERIOD                     *
     C*               @@CALC - INTEREST CALCULATION METHOD            *
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *
     C*               @@RATE - INTEREST RATE 11,7                     *
     C*                                                               *
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *
     C*                                                               *
     C*  WORK FIELDS   @@W155 - 15,5
     C*                                                               *
     C*****************************************************************
     C****       MM1007    BEGSR                                          E17051
     C*
     C*   CALCULATE NUMBER OF INTEREST DAYS
     C****                 EXSR MM1009                                    E17051
     C*
     C****       @@CALC    IFEQ '2'                        *** B 1        E17051
     C****       @@CALC    OREQ '3'                                       E17051
     C****       @@CALC    OREQ '5'                                       E17051
     C****       @@AMT     DIV  36000     @@W155 155                      E17051
     C****                 END                             *** E 1        E17051
     C*
     C****       @@CALC    IFEQ '1'                        *** B 1        E17051
     C****       @@CALC    OREQ '4'                                       E17051
     C****       @@AMT     DIV  36500     @@W155                          E17051
     C****                 END                              *** E 1       E17051
     C*
     C****       @@CALC    IFEQ '6'                         *** B 1       E17051
     C****       @@AMT     DIV  36600     @@W155                          E17051
     C****                 END                              *** E 1       E17051
     C*
     C****                 MULT @@RATE    @@W155                          E17051
     C****       @@W155    MULT @@INDY    @@INTR 150H                     E17051
     C*
     C****       M10079    ENDSR                                          E17051
     C*****************************************************************   E17051
     C/EJECT                                                              E17051
     C*****************************************************************   E17051
     C****MM1030*- CALCULATE INTEREST                              E17051 S01392
     C***********  (MM1030 INCLUDES ADJUSTMENT FOR ERROR IN DIVISIOE17051 S01392
     C***********                                                  E17051 S01392
     C***CALLED*BY    -                                            E17051 S01392
     C***********                                                  E17051 S01392
     C***CALLS***     -   MM1009 CALCULATE NO. OF INTEREST DAYS    E17051 S01392
     C***********                                                  E17051 S01392
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                E17051 S01392
     C***********     @@END  - END DATE OF PERIOD                  E17051 S01392
     C***********     @@CALC - INTEREST CALCULATION METHOD         E17051 S01392
     C***********     @@AMT  - PRINCIPAL AMOUNT  15N               E17051 S01392
     C***********     @@RATE - INTEREST RATE 11,7                  E17051 S01392
     C***********                                                  E17051 S01392
     C***FIELDS*OUTPUT @@INTR - INTEREST 15,0                      E17051 S01392
     C***********                                                  E17051 S01392
     C***WORK*FIELDS   @@W155 - 15,5                               E17051 S01392
     C***********      @@YEAR - (NUMBER OF DAYS IN YEAR) x 100     E17051 S01392
     C***********      @@WDIV - 15,5  HOLDS RESULT OF DIVISION     E17051 S01392
     C***********      @@ERR  - 15,9  ROUNDING ERROR               E17051 S01392
     C***********      @@AMTR - 15,1  AMOUNT FROM ROUNDING ERROR   E17051 S01392
     C***********               CAN BE 15,1 SINCE IT IS NOT POSSIBLE17051 S01392
     C***********               TO INPUT 15 BYTE FIELDS IN DRS.    E17051 S01392
     C***********                                                  E17051 S01392
     C***********************************************************  E17051 S01392
     C***********MM1030    BEGSR                                   E17051 S01392
     C***********                                                  E17051 S01392
     C****CALCULATE NUMBER OF INTEREST DAYS                        E17051 S01392
     C***********          EXSR MM1009                             E17051 S01392
     C***********                                                  E17051 S01392
     C***********@@CALC    IFEQ '2'                        *** B   E17051 S01392
     C***********@@CALC    OREQ '3'                                E17051 S01392
     C***********@@CALC    OREQ '5'                                E17051 S01392
     C***********@@AMT     DIV  36000     @@WDIV 155               E17051 S01392
     C***********          Z-ADD36000     @@YEAR  50               E17051 S01392
     C***********          END                             *** E 1 E17051 S01392
     C***********                                                  E17051 S01392
     C***********@@CALC    IFEQ '1'                        *** B 1 E17051 S01392
     C***********@@CALC    OREQ '4'                                E17051 S01392
     C***********@@AMT     DIV  36500     @@WDIV                   E17051 S01392
     C***********          Z-ADD36500     @@YEAR                   E17051 S01392
     C***********          END                              *** E 1E17051 S01392
     C***********                                                  E17051 S01392
     C***********@@CALC    IFEQ '6'                         *** B 1E17051 S01392
     C***********@@AMT     DIV  36600     @@WDIV                   E17051 S01392
     C***********          Z-ADD36600     @@YEAR                   E17051 S01392
     C***********          END                              *** E  E17051 S01392
     C***********                                                  E17051 S01392
     C***********@@WDIV    MULT @@RATE    @@W155 155               E17051 S01392
     C***********                                                  E17051 S01392
     C****MULTIPLY @@WDIV BY @@YEAR TO GET ORIGINAL AMOUNT. THE R  E17051 S01392
     C****COULD*DIFFER FROM THE ORIGINAL DUE TO ROUNDING ERROR ON  E17051 S01392
     C****DIVISION.                                                E17051 S01392
     C***********@@WDIV    MULT @@YEAR    @@AMTR 151               E17051 S01392
     C***********                                                  E17051 S01392
     C****CALCULATE THE ERROR AND DO SAME ARITHMETICAL OPERATIONS AE17051 S01392
     C*** @@AMT*ABOVE.                                             E17051 S01392
     C***********@@AMT     SUB  @@AMTR    @@ERR  159               E17051 S01392
     C***********          MULT @@RATE    @@ERR                    E17051 S01392
     C***********          DIV  @@YEAR    @@ERR                    E17051 S01392
     C***********                                                  E17051 S01392
     C****ADD*RESULT FROM ERROR CALCULATIONS BACK TO THE RESULT FROE17051 S01392
     C****CALCULATIONS ON PRINCIPAL AMOUNT.                        E17051 S01392
     C***********          ADD  @@ERR     @@W155                   E17051 S01392
     C***********                                                  E17051 S01392
     C****MULTIPLY BY THE PERIOD TO OBTAIN THE INTEREST.           E17051 S01392
     C***********@@W155    MULT @@INDY    @@INTR 150H              E17051 S01392
     C***********                                                  E17051 S01392
     C***********M10309    ENDSR                                   E17051 S01392
     C*****************************************************************   S01392
     C*                                                               *   S01392
     C*   MM1030 - CALCULATE INTEREST                                 *   S01392
     C*                                                               *   S01392
     C*  CALLED BY    -                                               *   S01392
     C*                                                               *   S01392
     C***CALLS********-***MM1009*CALCULATE*NO.*OF*INTEREST*DAYS*****S01392056095
     C*  CALLS        -   ZINTDY CALCULATE NO. OF INTEREST DAYS       *   056095
     C*                                                               *   S01392
     C***FIELDS*INPUT*@@BEG**-*START*DATE*OF*PERIOD*****************S01392056095
     C****************@@END**-*END*DATE*OF*PERIOD*******************S01392056095
     C****************@@CALC*-*INTEREST*CALCULATION*METHOD**********S01392056095
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   056095
     C*               ZZEND  - END DATE OF PERIOD                     *   056095
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   056095
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C*               @@RATE - INTEREST RATE 11,7                     *   S01392
     C*               @@RDFC - ROUND DOWN FACILITY IND 1              *   S01392
     C*                                                               *   S01392
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C*                                                               *   S01392
     C*  WORK FIELDS   @@W157 - 15,5                                  *   S01392
     C***********      @@W150 - 15,0                            *   S01392049499
     C*                @@W210 - 21,0                                  *   049499
     C*                @@YEAR - (NUMBER OF DAYS IN YEAR) x 100        *   S01392
     C*                                                               *   S01392
     C*****************************************************************   S01392
     C           MM1030    BEGSR                                          S01392
     C*                                                                   117785
     C** Proceed only if Calc Method is a valid one.                      117785
     C*                                                                   117785
     C           ZZCALC    IFEQ '1'                                       117785
     C           ZZCALC    OREQ '2'                                       117785
     C           ZZCALC    OREQ '3'                                       117785
     C           ZZCALC    OREQ '4'                                       117785
     C           ZZCALC    OREQ '5'                                       117785
     C           ZZCALC    OREQ '6'                                       117785
     C           ZZCALC    OREQ '0'                                                          CER016A
     C/COPY WNCPYSRC,MM0089C076
     C*                                                                   S01392
     C*   CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C*                                                                   S01392
     C***********          EXSR MM1009                              S01392056095
     C                     EXSR ZINTDY                                    056095
     C/COPY WNCPYSRC,MM0089C209
     C*                                                                   S01392
     C***********@@CALC    IFEQ '2'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '3'                                 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C           ZZCALC    IFEQ '2'                        *** B 1        056095
     C           ZZCALC    OREQ '3'                                       056095
     C           ZZCALC    OREQ '5'                                       056095
     C           ZZCALC    OREQ '0'                                                          CER016A
     C                     Z-ADD36000     @@YEAR  50                      S01392
     C                     END                             *** E 1        S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '1'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '4'                                 S01392056095
     C           ZZCALC    IFEQ '1'                        *** B 1        056095
     C           ZZCALC    OREQ '4'                                       056095
     C                     Z-ADD36500     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '6'                         *** B 1 S01392056095
     C           ZZCALC    IFEQ '6'                         *** B 1       056095
     C                     Z-ADD36600     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C           ZZCALC    IFEQ '6'                                       163136
     C           INT6DY    MULT @@RATE    @@W157                          163136
     C                     ELSE                                           163136
      *                                                                   163136
     C***********@@INDY    MULT @@RATE    @@W157 157                S01392056095
     C           ZZINDY    MULT @@RATE    @@W157 157                      056095
      *                                                                   163136
     C                     END                                            163136
      *                                                                   163136
     C***********@@W157    MULT @@AMT     @@W150 150H               S01392049499
     C           @@W157    MULT @@AMT     @@W210 210H                     049499
     C*                                                                   S01392
     C**  ROUND DOWN IF ROUND DOWN INDICATOR IS 'Y'                       S01392
     C*                                                                   S01392
     C           @@RDFC    IFEQ 'Y'                                       S01392
     C***********@@W150    DIV  @@YEAR    @@INTR                    S01392049499
     C           @@W210    DIV  @@YEAR    @@INTR                          049499
     C                     ELSE                                           S01392
     C***********@@W150    DIV  @@YEAR    @@INTR 150H               S01392049499
     C           @@W210    DIV  @@YEAR    @@INTR 150H                     049499
     C                     END                                            S01392
     C/COPY WNCPYSRC,MM0089C077
     C                     END                                            117785
     C*                                                                   S01392
     C           M10309    ENDSR                                          S01392
     C*****************************************************************
      /EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZINTDYZ2                                               056095
     C*****************************************************************
     C****MM1009*- CALCULATE THE NUMBER OF INTEREST DAYS              *   056095
     C***********                                                     *   056095
     C***CALLED*BY    -                                               *   056095
     C***********                                                     *   056095
     C***CALLS***     -   ZA0710 CONVERT MIDAS DAY NUMBER TO YMD DATE *   056095
     C***********                                                     *   056095
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                   *   056095
     C***********     @@END  - END DATE OF PERIOD                     *   056095
     C***********     @@CALC - INTEREST CALCULATION METHOD            *   056095
     C***********                                                     *   056095
     C***FIELDS*OUTPUT @@INDY - NO. OF INTEREST DAYS                  *   056095
     C***********                                                     *   056095
     C***WORKFIELDS   @@WN5   - WORK FIELD 5N                         *   056095
     C***********     @@WN5A  - WORK FIELD 5N                         *   056095
     C***********     @@WDAT  - WORK FIELD 5N                         *   056095
     C***********     @@DAYN  - WORK FIELD 5N                         *   056095
     C***********     @@P1    - WORK FIELD 5N                         *   056095
     C***********     @@P2    - WORK FIELD 5N                         *   056095
     C***********     @@P3    - WORK FIELD 5N                         *   056095
     C***********     @@LPNM  - WORKFIELD USED IN SETTING UP @@TG10   *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********MM1009    BEGSR                                          056095
     C***********                                                         056095
     C***********          MOVE @@BEG     @@BEG   50                      056095
     C***********          MOVE @@END     @@END   50                      056095
     C***********          MOVE @@CALC    @@CALC  1                       056095
     C***********          Z-ADD*ZEROS    @@INDY                          056095
     C***********          Z-ADD*ZEROS    @@LPNM                          056095
     C***********                                                         056095
     C***FIND*NUMBER OF DAYS DIFFERENCE BETWEEN DATES                     056095
     C***********                                                         056095
     C***********@@END     SUB  @@BEG     @@WDAT  50                      056095
     C***********                                                         056095
     C*****FOR*CALCULATION METHODS 3,4 OR 5.                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***********@@CALC    OREQ '4'                                       056095
     C***********@@CALC    OREQ '5'                                       056095
     C***********                                                         056095
     C***********          Z-ADD@@BEG     @@DAYN  50                      056095
     C***********          EXSR ZA0710                                    056095
     C***********          Z-ADD@@VDT     @@DATA                          056095
     C***********                                                         056095
     C***********          Z-ADD@@END     @@DAYN                          056095
     C***********          EXSR ZA0710                                    056095
     C***********          Z-ADD@@VDT     @@DATB                          056095
     C***IF*IN*SAME MONTH                                                 056095
     C***********@@YY1     IFEQ @@YY2                      **** B 2       056095
     C***********@@MM1     IFEQ @@MM2                      **** B 3       056095
     C***********@@DD2     SUB  @@DD1     @@INDY                          056095
     C***********          GOTO M10099                     --------->     056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C**IF*NOT*3,4 OR 5    ****                                           056095
     C**EXIT*PROCESSING                                                   056095
     C***********          Z-ADD@@WDAT    @@INDY  50       - LOAD OUTPT   056095
     C***********          GOTO M10099                     ----------->   056095
     C***********          END                             **** E 1       056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***CALC*NO. DAYS IN FIRST MONTH                                     056095
     C***********@@MM1     IFNE 2                          **** B 2 DT0013056095
     C***********30        SUB  @@DD1     @@P1    50   80                 056095
     C***IF*<*0,*INITIALISE TO 0                                          056095
     C***80******          Z-ADD*ZEROS    @@P1                            056095
     C***********                                                         056095
     C***********          ELSE                            **** X   DT0013056095
     C***TEST*IF*LEAP*     ****                                     DT0013056095
     C***YEAR****                                                   DT0013056095
     C***********@@YY1     DIV  4         @@WN5                     DT0013056095
     C***********          MVR            @@WN5          80         DT0013056095
     C***********                                                   DT0013056095
     C************IN80     IFEQ '1'                        **** B 3 DT0013056095
     C***********29        SUB  @@DD1     @@P1    50                DT0013056095
     C***********          ELSE                                     DT0013056095
     C***IF*NOT*LEAP*      ++++                                     DT0013056095
     C***********28        SUB  @@DD1     @@P1    50                DT0013056095
     C***********          END                             **** E 3 DT0013056095
     C***********          END                             **** E 2 DT0013056095
     C***CALC.*NO. DAYS IN LAST MONTH                                     056095
     C***********@@DD2     IFLE 30                         **** B 2       056095
     C***********          Z-ADD@@DD2     @@P2    50                      056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********          Z-ADD30        @@P2                            056095
     C***********          END                             **** E 2       056095
     C***CALC*NO. DAYS IN INTERVENING MONTHS                              056095
     C***********@@YY2     IFEQ @@YY1                      **** B 2       056095
     C***********@@MM2     SUB  @@MM1     @@P3    50                      056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 30        @@P3                            056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********@@YY2     SUB  @@YY1     @@P3                            056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 360       @@P3                            056095
     C***********                                                         056095
     C**FIND*NO.*OF MONTHS FOR THE TWO PARTIAL YEARS                      056095
     C***********12        SUB  @@MM1     @@WN5A  50                      056095
     C***********          MULT 30        @@WN5A                          056095
     C***********                                                         056095
     C***********@@MM2     SUB  1         @@WN5                           056095
     C***********@@WN5     MULT 30        @@WN5                           056095
     C***ACCUMULATE                                                       056095
     C***********@@WN5A    ADD  @@WN5     @@WN5A                          056095
     C***********@@P3      ADD  @@WN5A    @@P3                            056095
     C***********          END                             **** E 2       056095
     C***FINAL*SUM                                                        056095
     C***********                                                         056095
     C***********@@P1      ADD  @@P2      @@INDY                          056095
     C***********          ADD  @@P3      @@INDY                          056095
     C***********          END                             **** E 1       056095
     C***FOR*METHODS 4 AND 5                                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '4'                        **** B 1       056095
     C***********@@CALC    OREQ '5'                                       056095
     C****CALCULATE NUMBER OF LEAP YEARS BETWEEN START AND END DATES      056095
     C***********@@MM1     IFLE 2                          **** B 2       056095
     C***********@@YY1     DIV  4         @@WN5   50                   YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM  50                      056095
     C***********          END                             **** E 3       056095
     C***BYPASS*IF YEARS ARE THE SAME                                     056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          GOTO M10099                     ---------->    056095
     C***********          END                             **** E 2       056095
     C***LOOP*TO*CALCULATE NO. LEAP YEARS                                 056095
     C***********@@YY1     DOWNE@@YY2                      **** B 2       056095
     C***INCREMENT START YEAR                                             056095
     C***********          ADD  1         @@YY1                           056095
     C***********                                                         056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@MM2     IFGT 2                          **** B 4       056095
     C***********@@YY2     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***INCREMENT IF LEAP YEAR                                           056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 4      056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          END                              **** E 3      056095
     C***********@@YY1     IFNE @@YY2                       **** B 3      056095
     C***********@@YY1     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 3      056095
     C***********          END                              **** E 2      056095
     C***********          END                              **** E 1      056095
     C***********                                                         056095
     C***********M10099    ENDSR                           ***M10099***   056095
     C/EJECT
     C*****************************************************************
     C*   MM1010 - CALCULATION OF INTEREST AT MATURITY                *
     C*                                                               *
     C***FILES*EXPECTED**-**FXTB40LL**                                *
     C*  FILES EXPECTED  -  SDDEALPD                                  *
     C*                  -  MMDEAMLL  DEAL AMENDMENTS FILE            *
     C*                  -  SDCBRTL1  BRT CUSTOMER DETAILS FILE       *   S01383
     C*                                                               *
     C*  CALLED BY    -                                               *
     C*                                                               *
     C***CALLS********-**MM1007, CALCULATE INTEREST.                  *   E17051
     C*  CALLS        -  MM1030, CALCULATE INTEREST.                  *   E17051
     C*               -  MM1004, DETERMINE DATE OF NEXT PAYMENT.      *
     C*                                                               *
     C*  FIELDS INPUT @@TINT - TOTAL INTEREST                         *
     C*               @@INTD - INTEREST TO DATE                       *
     C*               @@INFQ - INTEREST PAYMENT FREQUENCY             *
     C*               @@NXIP - NEXT INTEREST PAYMENT DATE             *
     C*               @@VDAT - VALUE DATE                             *
     C*               @@INCM - INTEREST CALCULATION METHOD            *
     C*               @@DLAM - DEAL AMOUNT                            *
     C*               @@EIRT - EFFECTIVE INTEREST RATE                *
     C*               @@MTXI - TAXABLE INDICATOR                      *
     C*               @@DEAL - DEAL NUMBER   6N                       *
     C*               @@BRMD - MATURITY DATE FOR BRT CALCULATION      *   S01383
     C*               @BRTRT - BRT TAX RATE FROM LF/SDBRTDL1          *   S01383
     C*               @BTAXR - @BRTRT MULT. BY 1 OR 0.5               *   S01383
     C*                                                               *
     C*  FIELD OUTPUT @@INMT - INTEREST AT MATURITY                   *
     C*                                                               *
     C*  WORKFIELDS   @O     - ARRAY FIELD HOLDING FORMATTED AMOUNT   *
     C*               @@A    - INDEX FIELD FOR REFERENCING @O         *
     C*                                                               *
     C*****************************************************************
     C           MM1010    BEGSR
     C*
     C*   INITIALISE FIELDS
     C*****                MOVEL'01'      @@KEY  12                       S01194
     C*****                MOVE '40'      @@KEY                           S01194
     C                     Z-ADD*ZEROS    @@NPDT  50
     C                     Z-ADD@@DEAL    @@DEAL  60
     C*
     C****TEST IF RECORD HAS ALREADY BEEN READ - IF NOT READ IT           S01194
     C***** SDDEALPD IS NOW READ IN #A SO NO NEED FOR THIS                S01194
     C*****      KEY       IFNE @@KEY                      *** B 1        S01194
     C*****      @@KEY     CHAINFXTB40LL             90                   S01194
     C*****                END                             *** E 1        S01194
     C*
     C*   CALCULATE TAX AMOUNT
     C*   (ZERO IF TAX INDICATOR IS NOT 'Y')                              S01383
      *                                                                                       CDL013
      *** if CAR CDL013 is installed.                                                         CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
      *** if Tax indicator is ZERO set WHT rate to ZERO.                                      CDL013
     C           @@MTXI    IFEQ '0'                                                           CDL013
     C                     Z-ADD0         ULWHTR  52                                          CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** Set WHT rate.                                                                       CDL013
     C                     SELEC                                                              CDL013
     C           @@MTXI    WHEQ '1'                                                           CDL013
     C                     Z-ADDETXR1     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '2'                                                           CDL013
     C                     Z-ADDETXR2     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '3'                                                           CDL013
     C                     Z-ADDETXR3     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '4'                                                           CDL013
     C                     Z-ADDETXR4     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '5'                                                           CDL013
     C                     Z-ADDETXR5     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '6'                                                           CDL013
     C                     Z-ADDETXR6     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '7'                                                           CDL013
     C                     Z-ADDETXR7     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '8'                                                           CDL013
     C                     Z-ADDETXR8     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '9'                                                           CDL013
     C                     Z-ADDETXR9     ULWHTR                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** If WHT rate is ZERO set tax amount to ZERO.                                         CDL013
     C           ULWHTR    IFEQ *ZERO                                                         CDL013
     C                     Z-ADD0         @@TXAM                                              CDL013
      *                                                                                       CDL013
      *** otherwise calculate tax amount.                                                     CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** if Deal Ccy is equal to Base Ccy round down Interest Amount.                        CDL013
      ** and CDL081 is off                                                                    CDL081
      *                                                                                       CDL081
     C           DDCCY     IFEQ BJCYCD                                                        CDL013
     C           CDL081    ANDEQ'N'                                                           CDL081
      *                                                                                       CDL013
      *** set work adjustment field according to decimal places.                              CDL013
     C                     SELEC                                                              CDL013
     C           A6NBDP    WHEQ 1                                                             CDL013
     C                     Z-ADD10        ULWKAD  40                                          CDL013
     C           A6NBDP    WHEQ 2                                                             CDL013
     C                     Z-ADD100       ULWKAD                                              CDL013
     C           A6NBDP    WHEQ 3                                                             CDL013
     C                     Z-ADD1000      ULWKAD                                              CDL013
     C           A6NBDP    WHEQ 0                                                             CDL013
     C                     Z-ADD1         ULWKAD                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
      *** round down Interest Amount.                                                         CDL013
     C           @@TINT    DIV  ULWKAD    ULTINT 150                                          CDL013
     C                     MULT ULWKAD    ULTINT                                              CDL013
      *                                                                                       CDL013
      *** calculate and then round down Tax Amount.                                           CDL013
     C           ULTINT    MULT ULWHTR    @@TXAM                                              CDL013
     C                     DIV  100       @@TXAM                                              CDL013
     C           @@TXAM    DIV  ULWKAD    ULTXAM 150                                          CDL013
     C           ULTXAM    MULT ULWKAD    @@TXAM                                              CDL013
      *                                                                                       CDL013
      *** otherwise (Deal Ccy NOT = Base Ccy) calculate Tax amount                            CDL013
      *** without rounding down.                                                              CDL013
     C                     ELSE                                                               CDL013
     C           @@TINT    MULT ULWHTR    @@TXAM                                              CDL013
      *                                                                                       CDL081
      ** Check if tax amount is to be rounded down                                            CDL081
      *                                                                                       CDL081
     C           DDCCY     IFEQ BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C           DDCCY     ORNE BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#NBRD    ANDEQ'Y'                                                           CDL081
     C                     DIV  100       @@TXAM                                              CDL081
     C                     ELSE                                                               CDL081
     C                     DIV  100       @@TXAM    H                                         CDL013
     C                     ENDIF                                                              CDL081
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** otherwise perform Original Tax calculations.                                        CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP84                                           S01408
     C*                                                                   S01408
     C*                                                                   S01383
     C           @@MTXI    IFEQ *BLANKS                    *** B 1
     C           @@MTXI    OREQ 'X'                                       S01383
     C           @@MTXI    OREQ 'N'                                       DT0073
     C                     Z-ADD*ZEROS    @@TXAM 155
     C                     ELSE                            *** X
      *                    ****
     C                     Z-ADD*ZEROS    @@TXAM                          S01383
     C/COPY WNCPYSRC,MM0089C412
     C*                                                                   S01383
     C** IF BRT SAR INSTALLED                                             S01383
     C*                                                                   S01383
     C           S01383    IFEQ 'Y'                        *** B 2        S01383
     C*                                                                   S01383
     C           @@BRMD    IFGT 0                          *** B 3        S01383
     C*                                                                   S01383
     C           @@BRMD    IFGE DEFF                       *** B 4        S01383
     C                     Z-ADDBRTR      @BRTRT  75                      S01383
     C                     ELSE                                           S01383
     C                     Z-ADDPBRTR     @BRTRT                          S01383
     C                     END                             *** E 4        S01383
     C*                                                                   S01383
     C** ACCESS SDCBRTL1 FOR DEAL CUSTOMER'S BRT TAX INDICATOR (TAXIND)   S01383
     C** Only continue if record found on SDCBRTL1                        S01383
     C*                                                                   S01383
     C           IKCNUM    CHAINSDCBRTL1             65                   S01383
     C*                                                                   S01383
     C           *IN65     IFEQ '0'                        *** B 4        S01383
     C           XRECI     ANDEQ'D'                        *** B 4        S01383
     C*                                                                   S01383
     C           TAXIND    IFEQ 'L'                        *** B 5        S01383
     C           TAXIND    OREQ 'P'                                       S01383
     C*                                                                   S01383
     C** TAX RATE FOR PART-LIABLE CUSTOMERS IS HALF THE BASIC RATE.       S01383
     C*                                                                   S01383
     C           TAXIND    IFEQ 'L'                        *** B 6        S01383
     C                     Z-ADD@BRTRT    @BTAXR  86                      S01383
     C                     ELSE                                X 6        S01383
     C           0.5       MULT @BRTRT    @BTAXR                          S01383
     C                     END                             *** E 6        S01383
     C*                                                                   S01383
     C***********@@TINT    MULT @BTAXR    @@TXAM                    S01383082887
     C***********@@TXAM    DIV  100       @@TXAM                    S01383082887
     C/COPY WNCPYSRC,MM0089C413
     C           @@TINT    MULT @BTAXR    @@TXAW 155H                     082887
     C/COPY WNCPYSRC,MM0089C414
     C           @@TXAW    DIV  100       @@TXAM    H                     082887
     C                     END                             *** E 5        S01383
     C*                                                                   S01383
     C                     END                             *** E 4        S01383
     C                     END                             *** E 3        S01383
     C*                                                                   S01383
     C** ELSE BRT SAR NOT INSTALLED                                       S01383
     C*                                                                   S01383
     C                     ELSE                            *** X 2        S01383
     C*****      @@TINT    MULT TAXR      @@TXAM                          S01194
     C***********@@TINT    MULT BNHKTR    @@TXAM                    S01194082887
     C***********@@TXAM    DIV  100       @@TXAM    H                     082887
     C/COPY WNCPYSRC,MM0089C415
     C           @@TINT    MULT BNHKTR    @@TXAW    H                     082887
     C/COPY WNCPYSRC,MM0089C416
     C           @@TXAW    DIV  100       @@TXAM    H                     082887
     C                     END                             *** E 2        S01383
     C                     END                             *** E 1
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP85                                           S01408
     C*                                                                   S01408
     C*
     C*  FIND INTEREST AT MATURITY - NO INTERIM PAYMENTS
     C*
     C           @@NXIP    IFEQ *ZEROS                     *** B 1
     C           FXKEY     KLIST
     C                     KFLD           @@DEAL
      *  CHECK THERE ARE NO DEAL AMENDMENTS
     C           @@DEAL    CHAINMMDEAMLL             90
     C           *IN90     IFEQ '1'
     C           @@TINT    SUB  @@INTD    @@INMT 150        *** B 2
     C                     SUB  @@TXAM    @@INMT
     C                     GOTO M11010                      ---------->
     C                     END                              *** E 2
      *
     C                     END                              *** E 1
      *
      *  CHECK THERE ARE NO DEAL AMENDMENTS
     C           @@DEAL    CHAINMMDEAMLL             90
      *  IF THERE ARE GET THE LATEST
     C           *IN90     IFEQ '0'                         *** B 1
     C           @@EOF     DOUEQ'Y'                         *** B 2
     C           @@DEAL    READEMMDEAMLL                 90
     C   90                MOVE 'Y'       @@EOF   1
     C                     END                              *** E 2
      *REFORMAT DATE FROM YYYMMDD TO MIDAS FORM
     C** REFORMAT DEAM VALUE DATE                                         E12306
     C*********            Z-ADD@@NXIP    @@DTIN                          E12306
     C***********          Z-ADDHNDATE    @@DTIN                    E12306056095
     C***********          EXSR ZA0680                                    056095
     C                     Z-ADDHNDATE    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
      *   STORE DATE
     C***********          Z-ADD@@MDNO    @@ENDD  50                      056095
     C                     Z-ADDZZMDNO    @@ENDD  50                      056095
     C                     ELSE                            *** X
      *  IF NO AMENDMENTS  ****
      *  DETERMINE END DATE
      *
     C           @@NXIP    IFNE *ZEROS                     *** B 2
     C           @@INFQ    IFEQ *BLANKS                    *** B 3
     C*   LOAD FIELD
     C                     Z-ADD@@NXIP    @@ENDD
     C                     ELSE                            *** X
     C*                    ****
     C                     Z-ADD@@NXIP    @@DAYN
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
      *  LOAD INPUT PARAMETER
     C                     Z-ADD@@VDT     @@STRT  80
     C                     MOVE @@INFQ    @@FREQ  1
     C*  CALL COMMON ROUTINE
     C                     EXSR MM1004
     C*  LOAD RETURNED PARAMETER - AND REFORMAT
     C***********          Z-ADD@@NDAT    @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********          Z-ADD@@MDNO    @@ENDD                          056095
     C                     Z-ADD@@NDAT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    @@ENDD                          056095
      *
     C                     END                             *** E 3
     C                     END                             *** E 2
     C                     END                             *** E 1
      *
      *   CALCULATE INTEREST THAT WILL BE PAID PRIOR TO MATURITY
      *
      *   LOAD PARAMETERS
      *   ===============
      *
     C***********          Z-ADD@@VDAT    @@BEG                           056095
     C***********          Z-ADD@@ENDD    @@END                           056095
     C***********          MOVE @@INCM    @@CALC                          056095
     C                     Z-ADD@@VDAT    ZZBEG                           056095
     C                     Z-ADD@@ENDD    ZZEND                           056095
     C                     MOVE @@INCM    ZZCALC                          056095
     C                     Z-ADD@@DLAM    @@AMT  150
     C                     Z-ADD@@EIRT    @@RATE 117
     C*
     C*   CALL COMMON ROUTINE
     C*********************EXSR MM1007                                    E17051
     C                     EXSR MM1030                                    E17051
     C*
     C*   CALCULATE INTEREST AT MATURITY
     C**  ASSUME BRT TAX RATE SAME AT PRIOR PAYMENT AS AT MATURITY        S01383
     C*
     C           @@TINT    SUB  @@INTR    @@INMT
     C           @@INMT    SUB  @@TXAM    @@INMT
      *
      *  DEFINE INPUT FIELDS WHICH HAVE NOT BEEN DEFINED ALREADY
     C                     GOTO M11010
     C                     Z-ADD0         @@TINT 150
     C                     Z-ADD0         @@INTD 130
     C                     MOVE *BLANK    @@INFQ  1
     C                     Z-ADD0         @@NXIP  50
     C                     Z-ADD0         @@VDAT  50
     C                     MOVE *BLANK    @@INCM  1
     C                     Z-ADD0         @@DLAM 150
     C                     Z-ADD0         @@EIRT 117
     C                     MOVE *BLANK    @@MTXI  1
      *
     C           M11010    ENDSR
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZJ      - Move screen fields into standard deal fmt.         *
     C*                                                               *
     C* CALLS    MM1010   - Calculation of interest at maturity.      *
     C*          ZA0270   - Alpha date to MIDAS day no. conversion.   *
     C***********ZA0710***-*MIDAS*day*no.*to*YYYYMMDD*conversion.******   056095
     C*          ZDATE9   - MIDAS day no. to YYYYMMDD conversion.     *   056095
     C*          ZA0770   - YYYYMMDD to MMDDYY or DDMMYY conversion.  *
     C*          ZA0840   - Validate alpha versions of numeric fields.*
     C*                                                               *
     C* CALLED BY  #ZG    - Update processing.                        *
     C*            #BDAA  - Processing for insert of new record.   .  *
     C*                                                               *
     C* FLDS USED  @DSTS  - Present status of deal.                   *
     C*            @JOB   - Job description.                          *
     C*            @YEAR  - Field to hold year and century.           *
     C*            @MNTH  - Field to hold month (MM).                 *
     C*            @DAY   - Field to hold day (DD).                   *
     C*            @DATE  - Date (YYYYMMDD).                          *
     C*            @@DTIN - Date (YYYYMMDD).                          *
     C*            @@DTOU - Date (MMDDYY or DDMMYY).                  *
     C*            @DAT   - Date.(DDMMYY or MMDDYY).                  *
     C*            @RTCDE - Return code.                              *
     C*            @@DAYN - MIDAS day no.                             *
     C*            @@VDT  - Date (YYYYMMDD).                          *
     C*            @STS   - Future status of deal.                    *
     C*            @DLKEY - Numeric key to deal file.                 *
     C*            @@INTD - Interest to date.                         *
     C*            @@TINT - Total interest.                           *
     C*            @@INFQ - Interest payment frequency.               *
     C*            @@NXIP - Next interest payment date.               *
     C*            @@VDAT - Value date.                               *
     C*            @@INCM - Interest calculation method.              *
     C*            @@DLAM - Deal amount.                              *
     C*            @@EIRT - Effective interest rate.                  *
     C*            @@MTXI - MIDAS taxable indicator.                  *
     C*            @@DEAL - Deal number.                              *
     C*            @@INMT - Interest at maturity.                     *
     C*            @@CCY  - Currency code.                            *
     C*            @KEY   - Key field for MIDAS file.                 *
     C*            @KEY1  - Subfield of @KEY.                         *
     C*            @5     - Work field.                               *
     C*            @2     - Work field.                               *
     C*            @@IDP  - Decimal places field.                     *
     C*            @@IINT - No. of integers field.                    *
     C*            @@ALPH - Alpha amount for validation.              *
     C*            @@ERCD - Error code.                               *
     C*            @@AMT  - Output amount field.                      *
     C******       @CNUM  - Customer number.                          *   S01194
     C******       @CLTKY - Key to client file.                       *   S01194
     C*            @@BRMD - Maturity date for BRT calculation         *   S01383
     C*            @8     - Work field.                               *
     C*                                                               *
     C*****************************************************************
     C           #ZJ       BEGSR
     C/COPY WNCPYSRC,MM0089C095
     C*                                                                   044740
     C** Retrieve true shortname for customer.                            044740
     C*                                                                   044740
     C                     MOVELHKCNUM    @CUSNO 10                       044740
     C/COPY WNCPYSRC,MM0089C225
     C                     CALL 'AOCUSTR0'                                044740
     C                     PARM '       ' @RTCD                           044740
     C                     PARM '*KEY   ' @OPTN                           044740
     C                     PARM @CUSNO    @KEY1                           044740
     C                     PARM '       ' @KYST                           044740
     C           SDCUST    PARM SDCUST    DSSDY                           044740
     C*                                                                   044740
     C           @RTCD     IFNE *BLANK                                    044740
     C           @KYST     OREQ '*ERROR'                                  044740
     C                     MOVE '1'       *IN10                           044740
     C                     MOVE '1'       *IN41                           044740
     C                     MOVEL'MMM0205' @MSGID                          044740
     C                     CALL 'ZA0240'                                  044740
     C                     PARM           @MSGID                          044740
     C                     ELSE                                           044740
     C                     MOVE BBCSSN    HKCSNM                          044740
     C                     END                                            044740
     C/COPY WNCPYSRC,MM0089C096
     C*
     C*  *------------------------------------------------------------*
     C*  * Set Up Standard Deal Format for Authorisation and Deletion *
     C*  *------------------------------------------------------------*
     C*
     C**  If the deal is being authorised or deleted, move the fields
     C**  from the deals file to the standard deal.
     C           DDACTN    IFEQ 'X'                        B1
     C           DDACTN    OREQ 'D'                        B1
     C                     MOVE 'IK'      IKRCID           *1
     C                     MOVE HKDLTF    IKDLTF           *1
     C                     MOVE HKDLUP    IKDLUP           *1
     C                     MOVE HKMLUP    IKMLUP           *1
     C                     MOVE HKYLUP    IKYLUP           *1
     C                     MOVE HKTLUP    IKTLUP           *1
     C                     MOVE HKCHTP    IKCHTP           *1
     C                     MOVE HKLCD     IKLCD            *1
     C                     MOVE HKLUID    IKLUID           *1
     C                     MOVE HKPCDN    IKPCDN           *1
     C                     MOVE DDDLNO    IKDN38           *1
     C                     MOVE HKDADN    IKDADN           *1
     C                     Z-ADDHKAMNP    IKRBAT                          093843
     C                     MOVE HKBKCD    IKBKCD           *1
     C                     MOVE HKCCY     IKCCY            *1
     C                     MOVE HKCYDP    IKCYDP           *1
     C                     MOVE HKVDYY    IKVDYY           *1
     C                     MOVE HKVDMM    IKVDMM           *1
     C                     MOVE HKVDDD    IKVDDD           *1
     C           DDACTN    IFEQ 'D'                        B*2
     C                     MOVE 'D'       IKDDLT           **2
     C                     ELSE                            X*2
     C                     MOVE *BLANKS   IKDDLT           **2
     C                     END                             E*2
     C                     MOVE @STS      IKDSTS           *1
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP29                                           S01408
     C*                                                                   S01408
     C                     MOVE HKMTYP    IKMTYP           *1
     C                     MOVE HKRBSI    IKRBSI           *1
     C                     MOVE HKTYPE    IKTYPE           *1
     C                     MOVE HKSTYP    IKSTYP           *1
     C                     MOVE HKCSNM    IKCSNM           *1
     C                     MOVE HKCNUM    IKCNUM           *1
     C                     MOVE HKAMNP    IKAMNP           *1
     C                     MOVE HKINTR    IKINTR           *1
     C*****                MOVE HKBRCD    IKBRCD           *1             S01117
     C                     MOVE HKBRCA    IKBRCA           *1             S01117
     C                     MOVE HKDBRC    IKDBRC           *1
     C                     MOVE HKDDYY    IKDDYY           *1
     C                     MOVE HKDDMM    IKDDMM           *1
     C                     MOVE HKDDDD    IKDDDD           *1
     C                     MOVE HKBRKG    IKBRKG           *1
     C                     MOVE HKBKCY    IKBKCY           *1
     C                     MOVE HKBCDP    IKBCDP           *1
     C                     MOVE HKFEDF    IKFEDF           *1
     C                     MOVE HKPTFR    IKPTFR                          S01486
     C                     MOVE HKCDRF    IKCDRF           *1
     C                     MOVE HKPCTN    IKPCTN           *1
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP30                                           S01408
     C*                                                                   S01408
     C                     MOVE DDACTN    IKLACT           *1
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP31                                           S01408
     C*                                                                   S01408
     C                     MOVE HKTIME    IKTIME           *1
     C                     MOVE HKDUSC    IKDUSC           *1
     C           DDACTN    IFEQ 'X'                        B*2
     C                     MOVEL@USER     IKAOFR           **2
     C                     ELSE                            X*2
     C                     MOVE HKAOFR    IKAOFR           **2
     C                     END                             E*2
     C                     MOVE HKSLYY    IKSLYY           *1
     C                     MOVE HKSLMM    IKSLMM           *1
     C                     MOVE HKSLDD    IKSLDD           *1
     C                     MOVE HKROBY    IKROBY           *1
     C                     MOVE HKSPRD    IKSPRD           *1
     C                     MOVE HKIIRT    IKIIRT           *1
     C                     MOVE HKNIYY    IKNIYY           *1
     C                     MOVE HKNIMM    IKNIMM           *1
     C                     MOVE HKNIDD    IKNIDD           *1
     C                     MOVE HKIPFQ    IKIPFQ           *1
     C                     MOVE HKICMT    IKICMT           *1
     C                     MOVE HKIPDM    IKIPDM           *1
     C                     MOVE HKCPTI    IKCPTI           *1
     C                     MOVE HKCNTI    IKCNTI           *1
     C                     MOVE HKACSQ    IKACSQ           *1
     C                     MOVE HKNGVI    IKNGVI           *1
     C                     MOVE HKMTTI    IKMTTI           *1
     C                     MOVE HKMTAX    IKMTAX           *1
     C                     MOVE HKMCDH    IKMCDH           *1
     C                     MOVE HKIAYY    IKIAYY           *1
     C                     MOVE HKIAMM    IKIAMM           *1
     C                     MOVE HKIADD    IKIADD           *1
     C                     MOVE HKBSRC    IKBSRC           *1
     C                     MOVE HKDBSR    IKDBSR           *1
     C                     MOVE HKMDYY    IKMDYY           *1
     C                     MOVE HKMDMM    IKMDMM           *1
     C                     MOVE HKMDDD    IKMDDD           *1
     C                     MOVE HKNTCE    IKNTCE           *1
     C***********          MOVE HKFCLY    IKFCLY           *1             E25515
     C                     MOVE HKIMAT    IKIMAT           *1
     C                     MOVE HKBRAT    IKBRAT           *1
     C                     MOVE HKMMDI    IKMMDI           *1
     C                     MOVE HKDORM    IKDORM           *1
     C                     MOVE HKORCM    IKORCM           *1
     C                     MOVE HKDORI    IKDORI           *1
     C                     MOVE HKMORI    IKMORI           *1
     C                     MOVE HKDCPI    IKDCPI           *1
     C                     MOVE HKMCPI    IKMCPI           *1
     C                     MOVE HKDOPM    IKDOPM           *1
     C                     MOVE HKMOPM    IKMOPM           *1
     C                     MOVE HKDOPI    IKDOPI           *1
     C                     MOVE HKMOPI    IKMOPI           *1
     C                     MOVE HKDCRI    IKDCRI           *1
     C                     MOVE HKMCRI    IKMCRI           *1
     C                     MOVE HKDFAC    IKDFAC           *1
     C                     MOVE HKMFAO    IKMFAO           *1
     C                     MOVE HKSPEC    IKSPEC           *1
     C                     MOVE HKFUID    IKFUID           *1             S01392
     C                     MOVE HKFLID    IKFLID           *1             S01392
     C                     MOVE HKRDFC    IKRDFC           *1             S01392
     C                     MOVE HKORBR    IKORBR           *1             S01117
     C                     MOVE HKPRFC    IKPRFC           *1             S01117
     C                     MOVE HKRSTM    IKRSTM           *1             S01177
     C                     MOVE HKRONS    IKRONS           *1             S01177
     C                     MOVE HKRIBN    IKRIBN           *1             S01177
     C                     MOVE HKRIBA    IKRIBA           *1             S01177
     C                     MOVE HKROBN    IKROBN           *1             S01177
     C                     MOVE HKROCN    IKROCN           *1             S01177
     C                     MOVE HKPSTM    IKPSTM           *1             S01177
     C                     MOVE HKPONS    IKPONS           *1             S01177
     C                     MOVE HKPIBN    IKPIBN           *1             S01177
     C                     MOVE HKPIBA    IKPIBA           *1             S01177
     C                     MOVE HKPOBN    IKPOBN           *1             S01177
     C                     MOVE HKPOCN    IKPOCN           *1             S01177
     C                     MOVE HKRCRN    IKRCRN           *1             S01177
     C                     MOVE HKRCRA    IKRCRA           *1             S01177
     C                     MOVE HKRVNO    IKRVNO           *1             S01177
     C                     MOVE HKAWBN    IKAWBN           *1             S01177
     C                     MOVE HKAWBA    IKAWBA           *1             S01177
     C                     MOVE HKBENN    IKBENN           *1             S01177
     C                     MOVE HKBENA    IKBENA           *1             S01177
     C                     MOVE HKDTP1    IKDTP1           *1             S01177
     C                     MOVE HKDTP2    IKDTP2           *1             S01177
     C                     MOVE HKDTP3    IKDTP3           *1             S01177
     C                     MOVE HKDTP4    IKDTP4           *1             S01177
     C                     MOVE HKDCHG    IKDCHG           *1             S01177
     C                     MOVE HKBTB1    IKBTB1           *1             S01177
     C                     MOVE HKBTB2    IKBTB2           *1             S01177
     C                     MOVE HKBTB3    IKBTB3           *1             S01177
     C                     MOVE HKBTB4    IKBTB4           *1             S01177
     C                     MOVE HKBTB5    IKBTB5           *1             S01177
     C                     MOVE HKBTB6    IKBTB6           *1             S01177
     C                     MOVE HKCVMR    IKCVMR           *1             E22405
     C                     MOVE HKROBR    IKROBR           *1             S01117
     C                     MOVE HKPOBR    IKPOBR           *1             S01117
     C*
     C                     Z-ADDHKVDYY    @YEAR            *1
     C                     Z-ADDHKVDMM    @MNTH            *1
     C                     Z-ADDHKVDDD    @DAY             *1
     C                     MOVE HKBOKC    IKBOKC           *1             S01165
     C                     MOVE HKLNKN    IKLNKN           *1             S01165
     C                     MOVE HKDRID    IKDRID           *1             S01176
     C                     MOVE HKDDMR    IKDDMR           *1             S01176
     C                     MOVE HKAURO    IKAURO                          S01434
     C                     MOVE HKIPDS    IKIPDS                          S01434
     C                     MOVE HKROFQ    IKROFQ                          S01434
     C                     MOVE HKRLDN    IKRLDN                          S01434
     C                     MOVE HKIMET    IKIMET                          S01434
     C                     MOVE HKINSA    IKINSA                          S01434
     C                     MOVE HKINOS    IKINOS                          S01434
     C                     MOVE HKCNNA    IKCNNA                          S01434
     C                     MOVE HKSTCY    IKSTCY                          CEU003
     C                     MOVE HKIC72    IKIC72                          CEU003
     C                     MOVE HKISCY    IKISCY                          CEU003
     C                     MOVE HKII72    IKII72                          CEU003
     C                     MOVE HKRTFC    IKRTFC                          CEU015
     C                     Z-ADDHKORDA    IKORDA                          145001
     C           @DATE     IFEQ 0                          B*2
     C                     Z-ADD0         IKDVSD           **2
     C                     ELSE                            X*2
     C                     Z-ADD@DATE     @@DTIN           **2
     C                     EXSR ZA0770                     **2
     C                     MOVE @@DTOU    @DAT             **2
     C                     CALL 'ZA0270'                   **2
     C                     PARM           @DAT             **2
     C*****                PARM           DATF             **2            S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2
     C                     PARM           IKDVSD           **2
     C                     END                             E*2
     C*
     C                     Z-ADDHKDDYY    @YEAR            *1
     C                     Z-ADDHKDDMM    @MNTH            *1
     C                     Z-ADDHKDDDD    @DAY             *1
     C           @DATE     IFEQ 0                          B*2
     C                     Z-ADD0         IKDDND           **2
     C                     ELSE                            X*2
     C                     Z-ADD@DATE     @@DTIN           **2
     C                     EXSR ZA0770                     **2
     C                     MOVE @@DTOU    @DAT             **2
     C                     CALL 'ZA0270'                   **2
     C                     PARM           @DAT             **2
     C*****                PARM           DATF             **2            S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2
     C                     PARM           IKDDND           **2
     C                     END                             E*2
     C*
     C*****                MOVE RUND      IKDLAD           *1             S01194
     C                     MOVE BJRDNB    IKDLAD           *1             S01194
     C*
     C                     Z-ADDHKNIYY    @YEAR            *1
     C                     Z-ADDHKNIMM    @MNTH            *1
     C                     Z-ADDHKNIDD    @DAY             *1
     C           @DATE     IFEQ 0                          B*2
     C                     Z-ADD0         IKNIPD           **2
     C                     ELSE                            X*2
     C                     Z-ADD@DATE     @@DTIN           **2
     C                     EXSR ZA0770                     **2
     C                     MOVE @@DTOU    @DAT             **2
     C                     CALL 'ZA0270'                   **2
     C                     PARM           @DAT             **2
     C*****                PARM           DATF             **2            S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2
     C                     PARM           IKNIPD           **2
     C                     END                             E*2
     C*
     C                     Z-ADDHKSLYY    @YEAR            *1
     C                     Z-ADDHKSLMM    @MNTH            *1
     C                     Z-ADDHKSLDD    @DAY             *1
     C           @DATE     IFEQ 0                          B*2
     C                     Z-ADD0         IKSLID           **2
     C                     ELSE                            X*2
     C                     Z-ADD@DATE     @@DTIN           **2
     C                     EXSR ZA0770                     **2
     C                     MOVE @@DTOU    @DAT             **2
     C                     CALL 'ZA0270'                   **2
     C                     PARM           @DAT             **2
     C*****                PARM           DATF             **2            S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2
     C                     PARM           IKSLID           **2
     C                     END                             E*2
     C*
     C                     Z-ADDHKMDYY    @YEAR            *1
     C                     Z-ADDHKMDMM    @MNTH            *1
     C                     Z-ADDHKMDDD    @DAY             *1
     C           @DATE     IFEQ 0                          B*2
     C                     Z-ADD0         IKMATD           **2
     C                     ELSE                            X*2
     C                     Z-ADD@DATE     @@DTIN           **2
     C                     EXSR ZA0770                     **2
     C                     MOVE @@DTOU    @DAT             **2
     C                     CALL 'ZA0270'                   **2
     C                     PARM           @DAT             **2
     C*****                PARM           DATF             **2            S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2
     C                     PARM           IKMATD           **2
     C                     END                             E*2
     C*
     C                     Z-ADDHKIAYY    @YEAR            *1
     C                     Z-ADDHKIAMM    @MNTH            *1
     C                     Z-ADDHKIADD    @DAY             *1
     C           @DATE     IFEQ 0                          B*2
     C                     Z-ADD0         IKIACD           **2
     C                     ELSE                            X*2
     C                     Z-ADD@DATE     @@DTIN           **2
     C                     EXSR ZA0770                     **2
     C                     MOVE @@DTOU    @DAT             **2
     C                     CALL 'ZA0270'                   **2
     C                     PARM           @DAT             **2
     C*****                PARM           DATF             **2            S01194
     C                     PARM           BJDFIN           **2            S01194
     C                     PARM           @RTCDE           **2
     C                     PARM           IKIACD           **2
     C                     END                             E*2
     C*
     C**  Set up transaction date in YYYYMMDD format.
     C           DDACTN    IFEQ 'I'                        B*2            BH1114
     C*****                Z-ADDRUND      @@DAYN           *1             S01194
     C                     Z-ADDBJRDNB    @@DAYN           *1             S01194
     C***********          EXSR ZA0710                     *1             056095
     C                     EXSR ZDATE9                     *1             056095
     C                     Z-ADD@@VDT     @DATE            *1
     C                     Z-ADD@YEAR     IKDTYY           *1
     C                     Z-ADD@MNTH     IKDTMM           *1
     C                     Z-ADD@DAY      IKDTDD           *1
     C                     ELSE                            X*2            BH1114
     C                     Z-ADDHKDTYY    IKDTYY           **2            BH1114
     C                     Z-ADDHKDTMM    IKDTMM           **2            BH1114
     C                     Z-ADDHKDTDD    IKDTDD           **2            BH1114
     C                     END                             E*2            BH1114
      *                                                                   CAC001
      **  If Anal Accntg is installed, updated funding info fields        CAC001
      **  only if deal type is not 'IL', 'ID'.                            CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           HKMTYP    ANDNE'IL'                                      CAC001
     C           HKMTYP    ANDNE'ID'                                      CAC001
     C                     Z-ADDHKFSRP    IKFSRP                          CAC001
     C                     MOVE HKFSGN    IKFSGN                          CAC001
     C                     MOVE HKFPRC    IKFPRC                          CAC001
     C                     Z-ADDIKIACD    IKFCTD                          CAC001
     C                     ENDIF                                          CAC001
     C                     END                             E1
     C*
     C*  *--------------------------------------------------------*
     C*  * Set Up Standard Deal Format for Inserts and Amendments *
     C*  *--------------------------------------------------------*
     C*
     C**  Set up standard deal for inserts.
     C           DDACTN    IFEQ 'I'                        B1
     C           DDACTN    OREQ 'A'                        B1
     C*                                                                   S01117
     C**  Originating Branch & Profit Centre                              S01117
     C                     MOVE DDPRFC    IKPRFC           *1             S01117
     C                     MOVE DDORBR    IKORBR           *1             S01117
     C*
     C**  PC deal number - If action is I, set up with blanks,
     C**  otherwise use value from file.
     C           DDACTN    IFEQ 'I'                        B*2
     C/COPY WNCPYSRC,MM0089C081
     C                     MOVE *BLANKS   IKPCDN           **2
     C                     ELSE                            X*2
     C                     MOVE HKPCDN    IKPCDN           **2
     C                     END                             E*2
     C*
     C**  Deal number.
     C           DDACTN    IFEQ 'I'                        B*2            E19346
     C           @AUTO     ANDEQ'Y'                        B*2            E19346
     C                     MOVE DDSIMG    IKDN38           **2            E19346
     C                     ELSE                            X*2            E19346
     C                     MOVE DDDLNO    IKDN38           *1
     C                     END                             E*2            E19346
     C*                                                                   044740
     C** Customer.                                                        044740
     C*                                                                   044740
     C/COPY WNCPYSRC,MM0089C097
     C**********           MOVE HKCSNM    IKCSNM                   044740 170254
     C/COPY WNCPYSRC,MM0089C098
     C*
     C**  Rollover deal number.
     C                     MOVE DDDADN    IKDADN           *1
     C*                                                                   093843
     C**  Rollover deal amount                                            093843
     C                     Z-ADDHKAMNP    IKRBAT                          093843
     C*
     C**  Broker code.
     C                     MOVE DDBKCD    IKBKCD           *1
     C*
     C**  Deal currency.
     C                     MOVE DDCCY     IKCCY            *1
     C**  Book code.                                                      S01165
     C           DDBOKC    IFNE *BLANKS                                   027568
     C                     MOVE DDBOKC    IKBOKC           *1             S01165
     C                     END                                            027568
     C*                                                                   S01165
     C**  Linked reference number.                                        S01165
     C                     MOVE DDLNKN    IKLNKN           *1             S01165
     C*                                                                   S01176
     C**  Repo/Pledge Indicator                                           S01176
     C                     MOVE DDDRID    IKDRID           *1             S01176
     C*                                                                   S01176
     C**  Repo/Pledge Number                                              S01176
     C                     MOVE DDDDMR    IKDDMR           *1             S01176
     C*
     C**  Set up value/start date in YYYYMMDD format.
     C                     Z-ADDIKDVSD    @@DAYN           *1
     C***********          EXSR ZA0710                     *1             056095
     C                     EXSR ZDATE9                     *1             056095
     C                     Z-ADD@@VDT     @DATE            *1
     C                     Z-ADD@YEAR     IKVDYY           *1
     C                     Z-ADD@MNTH     IKVDMM           *1
     C                     Z-ADD@DAY      IKVDDD           *1
     C*
     C**  Set up transaction date in YYYYMMDD format.
     C           DDACTN    IFNE 'A'                        B*2            E23511
     C*****                Z-ADDRUND      @@DAYN           *1             S01194
     C                     Z-ADDBJRDNB    @@DAYN           *1             S01194
     C***********          EXSR ZA0710                     *1             056095
     C                     EXSR ZDATE9                     *1             056095
     C                     Z-ADD@@VDT     @DATE            *1
     C                     Z-ADD@YEAR     IKDTYY           *1
     C                     Z-ADD@MNTH     IKDTMM           *1
     C                     Z-ADD@DAY      IKDTDD           *1
     C                     ELSE                             X2            E23511
     C                     MOVE HKDTYY    IKDTYY           **2            E23511
     C                     MOVE HKDTMM    IKDTMM           **2            E23511
     C                     MOVE HKDTDD    IKDTDD           **2            E23511
     C                     END                             E*2            E23511
     C*
     C**  Deal deleted indicator.
     C                     MOVE *BLANKS   IKDDLT           *1
     C*
     C**  Status indicator.
     C                     MOVE @STS      IKDSTS           *1
     C/COPY WNCPYSRC,MM0089C434
     C*
     C**  Set up deal type.
     C           DDTYPE    IFEQ 'IT'                       B*2
     C           DDTYPE    OREQ 'IP'                       B*2
     C           DDTYPE    OREQ 'TD'                       B*2
     C           DDTYPE    OREQ 'CI'                       B*2
     C           DDTYPE    OREQ 'DL'                       B*2
     C                     MOVE DDTYPE    IKTYPE           **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C435
     C*
     C           DDTYPE    IFEQ 'TI'                       B*2
     C                     MOVE 'TL'      IKTYPE           **2
     C                     END                             E*2
     C*
     C           DDTYPE    IFEQ 'CD'                       B*2
     C                     MOVE 'CT'      IKTYPE           **2
     C                     END                             E*2
     C*
     C           DDTYPE    IFEQ 'CL'                       B*2
     C                     MOVE 'CP'      IKTYPE           **2
     C                     END                             E*2
     C*
     C           DDTYPE    IFEQ 'LN'                       B*2
     C                     MOVE 'CL'      IKTYPE           **2
     C                     END                             E*2
     C*
     C**  Rollover/bought/sold indicator.
     C           DDACTN    IFEQ 'I'                        B*2
     C/COPY WNCPYSRC,MM0089C528
     C           DDDADN    IFEQ *ZEROS                     B**3
     C           DDDADN    OREQ *BLANKS                    B**3
     C                     MOVE *BLANKS   IKRBSI           ***3
     C                     ELSE                            X**3
     C                     MOVE 'N'       IKRBSI           ***3
     C                     END                             E**3
     C*                                                                   079768
     C** If Amendment, move field contents                                079768
     C*                                                                   079768
     C                     ELSE                                           079768
     C                     MOVE HKRBSI    IKRBSI                          079768
     C                     END                             E*2
     C*
     C**  MIDAS deal type.
     C                     MOVE DDTYPE    IKMTYP           *1
     C*
     C**  Deal sub-type.
     C                     MOVE DDSTYP    IKSTYP           *1
     C*
     C**  Amount.  Set up with the correct sign.
     C           DDACTN    IFNE 'A'                        B*2            084659
     C           DDTYPE    IFEQ 'IP'                       B*2
     C           DDTYPE    OREQ 'TI'                       B*2
     C           DDTYPE    OREQ 'CL'                       B*2
     C           DDTYPE    OREQ 'LN'                       B*2
     C           DDTYPE    OREQ 'DL'                       B*2
     C                     Z-SUBIKAMNP    IKAMNP           **2
     C                     END                             E*2
     C                     END                             E*2            084659
     C*
     C**  Interest rate.  Set up with the correct sign.
     C           DDNGVI    IFEQ 'Y'                        B*2
     C                     Z-SUBIKINTR    IKINTR           **2
     C                     END                             E*2
     C*
     C**  MIDAS branch code.
     C*****                MOVE DDBRCD    IKBRCD           *1             S01117
     C           DDBRCA    IFEQ *BLANKS                    B*2            S01194
     C                     MOVE BJSBRC    IKBRCA           **2            S01194
     C                     ELSE                            X*2            S01194
     C                     MOVE DDBRCA    IKBRCA           **2            S01117
     C                     END                             E*2            S01194
     C*
     C**  Deal sub-type.
     C                     MOVE DDSTYP    IKSTYP           *1
     C*
     C**  Set up deal done date in YYYYMMDD format.
     C                     Z-ADDIKDDND    @@DAYN           *1
     C***********          EXSR ZA0710                     *1             056095
     C                     EXSR ZDATE9                     *1             056095
     C                     Z-ADD@@VDT     @DATE            *1
     C                     Z-ADD@YEAR     IKDDYY           *1
     C                     Z-ADD@MNTH     IKDDMM           *1
     C                     Z-ADD@DAY      IKDDDD           *1
     C*
     C**  Federal funds indicator.
     C******               MOVE *BLANKS   IKFEDF           *1             S01136
     C/COPY WNCPYSRC,MM0089C029
     C                     MOVE DDFEDF    IKFEDF           *1             S01136
     C/COPY WNCPYSRC,MM0089C030
     C*
     C**  CD reference.
     C                     MOVE DDCDRF    IKCDRF           *1
     C*
     C**  PC transaction number.
     C                     MOVE *ZEROS    IKPCTN           *1
     C*
     C**  Last action.
     C           @TERM1    IFEQ 'R'                                       077554
     C                     MOVE 'I'       IKLACT                          077554
     C                     ELSE                                           077554
     C                     MOVE DDACTN    IKLACT           *1
     C                     END                                            077554
     C*
     C**  Time.
     C                     TIME           IKTIME           *1
     C*
     C**  User code.
     C           DDACTN    IFEQ 'I'                        B*2
     C           @TERM1    OREQ 'R'                        B*2            091554
     C                     MOVEL@USER     IKDUSC           **2
     C                     ELSE                            X*2
     C                     MOVE HKDUSC    IKDUSC           **2
     C                     END                             E*2
     C*
     C**  Authorisation officer.
     C           DDACTN    IFEQ 'I'                        B*2
     C           @STS      IFEQ 'A'                        B**3
     C                     MOVE @USER     IKAOFR           ***3
     C                     ELSE                            X**3
     C                     MOVE *BLANKS   IKAOFR           ***3
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     MOVE HKAOFR    IKAOFR           **2
     C                     END                             E*2
     C*
     C**  Start/last interest date.
     C                     Z-ADDIKVDYY    IKSLYY           *1
     C                     Z-ADDIKVDMM    IKSLMM           *1
     C                     Z-ADDIKVDDD    IKSLDD           *1
     C*
     C** Rolled over by.
     C** If Insertion, blank out field                                    079768
     C*                                                                   079768
     C           DDACTN    IFEQ 'I'                                       079768
     C                     MOVE *BLANKS   IKROBY           *1
     C                     ELSE                                           079768
     C*                                                                   079768
     C** If Amendment, move field contents                                079768
     C*                                                                   079768
     C                     MOVE HKROBY    IKROBY                          079768
     C                     END                                            079768
     C*
     C**  Spread rate if base rate code has been entered, input
     C**  interest, if not.
     C           DDBSRC    IFNE *BLANKS                    B*2
     C                     MOVE @SPRD     IKSPRD           **2
     C                     ELSE                            X*2
     C                     MOVE @SPRD     IKIIRT           **2
     C           DDNGVI    IFEQ 'Y'                        B**3
     C                     Z-SUBIKIIRT    IKIIRT           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  Set up next interest payment date in YYYYMMDD format.
     C                     Z-ADDIKNIPD    @@DAYN           *1
     C***********          EXSR ZA0710                     *1             056095
     C                     EXSR ZDATE9                     *1             056095
     C                     Z-ADD@@VDT     @DATE            *1
     C                     Z-ADD@YEAR     IKNIYY           *1
     C                     Z-ADD@MNTH     IKNIMM           *1
     C                     Z-ADD@DAY      IKNIDD           *1
     C*
     C**  Interest payment frequency.
     C/COPY WNCPYSRC,MM0089C151
     C                     MOVE DDIPFQ    IKIPFQ           *1
     C*
     C**  Interest calculation method.
     C/COPY WNCPYSRC,MM0089C401
     C                     MOVE DDICMT    IKICMT           *1
     C/COPY WNCPYSRC,MM0089C402
     C*
     C**  Interest payment day in month.
     C                     MOVE DDIPDM    IKIPDM           *1
     C           DDIPFQ    IFEQ 'N'                                       AUS003
     C                     MOVE '31'      IKIPDM                          AUS003
     C                     END                                            AUS003
     C*
     C**  Capitalise interest indicator.
     C/COPY WNCPYSRC,MM0089C152
     C                     MOVE DDCPTI    IKCPTI           *1
     C*
     C**  Notice days.
     C                     Z-ADD@NTCNM    IKNTCE           *1
     C*                                                                   S01486
     C**  Portfolio reference.                                            S01486
     C*                                                                   S01486
     C           DDPTFR    IFEQ FCR997                                    S01486
     C           I#PORS    ANDNE'B'                                       104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,MM0089C391
     C           I#PORS    OREQ 'B'                                       104058
     C           DDPTFR    ANDNE*BLANKS                                   104058
     C           DDPTFR    ANDEQFCR997                                    104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,MM0089C392
     C                     MOVE '9997'    IKPTFR                          S01486
     C                     ELSE                                           S01486
     C                     MOVE DDPTFR    IKPTFR                          S01486
     C                     END                                            S01486
     C*
     C**  Call/notice indicator.
     C           DDACTN    IFEQ 'I'                        B*2
     C           @NTCNM    IFEQ -999                       B**3
     C                     MOVE *BLANKS   IKCNTI           ***3
     C                     ELSE                            X**3
     C           IKNTCE    IFEQ *ZEROS                     B***4
     C                     MOVE 'C'       IKCNTI           ****4
     C                     ELSE                            X***4
     C                     MOVE 'N'       IKCNTI           ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     MOVE HKCNTI    IKCNTI           **2
     C                     END                             E*2
     C*
     C**  Negative interest indicator.
     C                     MOVE DDNGVI    IKNGVI           *1
     C*
     C**  MIDAS taxable indicator.
     C                     MOVE DDMTAX    IKMTAX           *1
     C*                                                                   S01392
     C**  Interest Up Front Indicator                                     S01392
     C*                                                                   S01392
     C                     MOVE DDFUID    IKFUID                          S01392
     C*                                                                   S01392
     C**  First & Last Day Interest Indicator                             S01392
     C*                                                                   S01392
     C                     MOVE DDFLID    IKFLID                          S01392
     C*                                                                   S01392
     C**  Round Down Indicator                                            S01392
     C*                                                                   S01392
     C                     MOVE DDRDFC    IKRDFC                          S01392
     C*                                                                   S01434
     C**  Automatic Rollover Indicator                                    S01434
     C*                                                                   S01434
     C                     MOVE DDAURO    IKAURO                          S01434
     C*                                                                   S01434
     C**  Interest Paid Separately Indicator                              S01434
     C*                                                                   S01434
     C                     MOVE DDIPDS    IKIPDS                          S01434
     C*                                                                   S01434
     C**  Rollover Frequency                                              S01434
     C*                                                                   S01434
     C                     MOVE DDROFQ    IKROFQ                          S01434
     C*                                                                   S01434
     C**  Rollover Day Number                                             S01434
     C*                                                                   S01434
     C                     MOVE DDRLDN    IKRLDN                          S01434
     C           DDRLDN    IFEQ *BLANKS                                   S01434
     C                     Z-ADD0         IKRLDN                          S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C**  Interest Settlement Method                                      S01434
     C*                                                                   S01434
     C                     MOVE DDIMET    IKIMET                          S01434
     C*                                                                   S01434
     C**  Interest Settlement Account                                     S01434
     C*                                                                   S01434
     C                     MOVEL@@INSA    IKINSA                          S01434
     C*                                                                   S01434
     C**  Interest Counterparty Nostro                                    S01434
     C*                                                                   S01434
     C                     MOVE DDINOS    IKINOS                          S01434
     C*                                                                   CEU003
     C**  Interest settlement ccy and Interest 'In' ccy in field 72       CEU003
     C*                                                                   CEU003
     C                     MOVE DDISCY    IKISCY                          CEU003
     C                     MOVE DDII72    IKII72                          CEU003
     C*                                                                   S01434
     C**  Confirmation Narrative                                          S01434
     C*                                                                   S01434
     C                     MOVE DDCNNA    IKCNNA                          S01434
     C*
     C**  Interest accrual control date.
     C                     Z-ADDIKVDYY    IKIAYY           *1
     C                     Z-ADDIKVDMM    IKIAMM           *1
     C                     Z-ADDIKVDDD    IKIADD           *1
     C                     Z-ADDIKDVSD    IKIACD           *1
     C*
     C**  MIDAS base rate code.
     C                     MOVE DDBSRC    IKBSRC           *1
     C*
     C**  Maturity date.
     C           DDMDAT    IFNE *BLANKS                    B*2
     C                     Z-ADDIKMATD    @@DAYN           **2
     C***********          EXSR ZA0710                     **2            056095
     C                     EXSR ZDATE9                     **2            056095
     C                     Z-ADD@@VDT     @DATE            **2
     C                     Z-ADD@YEAR     IKMDYY           **2
     C                     Z-ADD@MNTH     IKMDMM           **2
     C                     Z-ADD@DAY      IKMDDD           **2
     C                     END                             E*2
     C***********                                                         E25515
     C****Facility.*                                                      E25515
     C***********          MOVE DDFCLY    IKFCLY           *1             E25515
     C*
     C**  If the deal status is R or A, retrieve the interest to date
     C**  from the deals file.  If no valid record is found, it is a
     C**  database error.  Otherwise, set the value to zero.
     C           @TERM1    IFNE 'R'                                       S01434
     C           @DSTS     IFEQ 'R'                        B*2
     C           @DSTS     OREQ 'A'                        B*2
     C                     MOVE DDDLNO    @DLKEY           **2
     C           @DLKEY    CHAINDEALSDCF             65    **2
     C*
     C           *IN65     IFEQ '1'                        B**3
     C           RECI      OREQ '*'                        B**3
     C                     MOVE '1'       *INLR            ***3
     C                     MOVE '1'       *INU7            ***3
     C                     MOVE '1'       *INU8            ***3
     C                     MOVE '1'       *INKC            ***************
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVEL'DEALS   'DBFILE           * DBERROR 005 *
     C                     MOVEL@DLKEY    DBKEY            ***************
     C                     MOVE '005'     DBASE            ***3
     C                     OUT  LDA                                       E24039
     C                     EXSR #C                         ***3
     C                     END                             E**3
     C*
     C           AIPD      IFLT 0                          B**3
     C                     Z-SUBAIPD      @@INTD           ***3
     C                     ELSE                            X**3
     C                     Z-ADDAIPD      @@INTD           ***3
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     Z-ADD*ZEROS    @@INTD           **2
     C                     END                             E*2
     C                     END                             E*2            S01434
     C*
     C**  Interest at maturity.
     C           IKMTTI    IFLT 0                          B*2
     C                     Z-SUBIKMTTI    @@TINT           **2
     C                     ELSE                            X*2
     C                     Z-ADDIKMTTI    @@TINT           **2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C388
     C                     MOVE IKIPFQ    @@INFQ           *1
     C                     Z-ADDIKNIPD    @@NXIP           *1
     C                     Z-ADDIKDVSD    @@VDAT           *1
     C                     MOVE IKICMT    @@INCM           *1
     C           IKAMNP    IFLT 0                          B*2
     C                     Z-SUBIKAMNP    @@DLAM           **2
     C                     ELSE                            X*2
     C                     Z-ADDIKAMNP    @@DLAM           **2
     C                     END                             E*2
     C           IKINTR    IFLT 0                          B*2
     C                     Z-SUBIKINTR    @@EIRT           **2
     C                     ELSE                            X*2
     C                     Z-ADDIKINTR    @@EIRT           **2
     C                     END                             E*2
     C                     MOVE IKMTAX    @@MTXI           *1
     C                     MOVE IKRDFC    @@RDFC           *1             S01392
     C                     Z-ADDIKDN38    @@DEAL           *1
     C*****                MOVE IKCCY     @@CCY            *1             S01195
     C***********          MOVE IKCCY     ZCCY             *1      S01195 CEU003
     C                     MOVE WEFCY     ZCCY                            CEU003
     C*                                                                   S01383
     C** Calculate maturity date for BRT tax calculations                 S01383
     C*                                                                   S01383
     C           DDTYPE    IFEQ 'CD'                       B*2            S01383
     C           DDTYPE    OREQ 'CL'                       **2            S01383
     C           DDTYPE    OREQ 'DL'                       **2            S01383
     C           @NTCNM    IFEQ 0                          B**3           S01383
     C           @@VDAT    ADD  1         @@BRMD           ***3           S01383
     C                     ELSE                            X**3           S01383
     C           @NTCNM    IFNE -999                       B***4          S01383
     C           @@VDAT    ADD  @NTCNM    @@BRMD           ****4          S01383
     C                     ELSE                            X***4          S01383
     C                     Z-ADDIKMATD    @@BRMD           ****4          S01383
     C                     END                             E***4          S01383
     C                     END                             E**3           S01383
     C                     ELSE                            X*2            S01383
     C                     Z-ADDIKMATD    @@BRMD           **2            S01383
     C                     END                             E*2            S01383
     C*                                                                   S01195
     C**  Check whether loan or deposit in order to set up location       S01195
     C           IKAMNP    IFGT 0                          B*2  DEPOSIT   S01195
     C*                                                                   S01195
     C*  Set up location used by ZCHKH - if Our PAY Settlement            S01195
     C*  Method is a nostro then use nostro code and currency to find     S01195
     C*  Nostro Location                                                  S01195
     C           IKPSTM    IFEQ 01                         B**3           S01195
     C           IKPSTM    OREQ 02                         ***3           S01195
     C           IKPSTM    OREQ 07                         ***3           S01195
     C           IKPSTM    OREQ 08                         ***3           S01195
     C           IKPSTM    OREQ 12                         ***3           S01195
     C*                                                                   S01195
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AONOSTR0'                 ***3           S01194
     C                     PARM '*DBERR ' @RTCD   7        ***3           S01194
     C                     PARM '*KEY   ' @OPTN   7        ***3           S01194
     C                     PARM *BLANKS   @KEYA   6        ***3           S01194
     C***********          PARM IKCCY     @KEYB   3        ***3    S01194 CEU003
     C                     PARM WEFCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        ***3                        S01194 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        ***3           S01194
     C                     PARM IKPONS    @KEYE   2        ***3           S01194
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01195
     C*********************MOVE A7CSSN    ZLOC             ***3           S01195
     C                     MOVE A7NOSN    ZLOC             ***3           S01195
     C*                                                                   S01195
     C                     ELSE                            X**3           S01195
     C*****                MOVE *BLANKS   ZLOC             ***3    S01195 LN0023
     C                     MOVE BJSLCD    ZLOC             ***3           LN0023
     C                     END                             E**3           S01195
     C*                                                                   S01195
     C                     ELSE                            X*2            S01195
     C*                                                                   S01195
     C**  IKAMNP is less than zero so deal is a loan                      S01195
     C*  Set up location used by ZCHKH - if Our receive Settlement        S01195
     C*  Method is a nostro then use nostro code and currency to find     S01195
     C*  Nostro Location                                                  S01195
     C*                                                                   S01195
     C           IKRSTM    IFEQ 01                         B**3           S01195
     C           IKRSTM    OREQ 02                         ***3           S01195
     C           IKRSTM    OREQ 07                         ***3           S01195
     C           IKRSTM    OREQ 08                         ***3           S01195
     C           IKRSTM    OREQ 12                         ***3           S01195
     C*                                                                   S01195
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AONOSTR0'                 ***3           S01194
     C                     PARM '*DBERR ' @RTCD   7        ***3           S01194
     C                     PARM '*KEY   ' @OPTN   7        ***3           S01194
     C                     PARM *BLANKS   @KEYA   6        ***3           S01194
     C***********          PARM IKCCY     @KEYB   3        ***3    S01194 CEU003
     C                     PARM WEFCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        ***3                        S01194 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        ***3           S01194
     C                     PARM IKRONS    @KEYE   2        ***3           S01194
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01195
     C*********************MOVE A7CSSN    ZLOC             ***3           S01195
     C                     MOVE A7NOSN    ZLOC             ***3           S01195
     C*                                                                   S01195
     C                     ELSE                            X**3           S01195
     C*****                MOVE *BLANKS   ZLOC             ***3   S01195  LN0023
     C                     MOVE BJSLCD    ZLOC             ***3           LN0023
     C                     END                             E**3           S01195
     C*                                                                   S01195
     C                     END                             E*2            S01195
     C*                                                                   S01195
     C                     EXSR MM1010                     *1
     C           DDNGVI    IFEQ 'Y'                        B*2
     C                     Z-SUB@@INMT    IKIMAT           **2
     C                     ELSE                            X*2
     C                     Z-ADD@@INMT    IKIMAT           **2
     C                     END                             E*2
     C*
     C**  MIDAS total interest amount.  Set up with the opposite sign
     C**  total the deal amount.
     C           DDTYPE    IFNE 'IP'                       B*2
     C           DDTYPE    ANDNE'TI'                       B*2
     C           DDTYPE    ANDNE'CL'                       B*2
     C           DDTYPE    ANDNE'LN'                       B*2
     C           DDTYPE    ANDNE'DL'                       B*2
     C                     Z-SUBIKMTTI    IKMTTI           **2
     C                     END                             E*2
     C*
     C**  Receive method.
     C*****      DDORCM    IFEQ '00'                       B*2            S01177
     C           PMRSTM    IFEQ 00                         B*2            S01177
     C                     MOVE *BLANKS   IKDORM           **2
     C                     END                             E*2
     C*****      DDORCM    IFEQ '01'                       B*2            S01177
     C           PMRSTM    IFEQ 01                         B*2            S01177
     C                     MOVE 'TELX '   IKDORM           **2
     C                     END                             E*2
     C*****      DDORCM    IFEQ '07'                       B*2            S01177
     C           PMRSTM    IFEQ 07                         B*2            S01177
     C                     MOVE 'CHIPS'   IKDORM           **2
     C                     END                             E*2
     C*****      DDORCM    IFEQ '08'                       B*2            S01177
     C           PMRSTM    IFEQ 08                         B*2            S01177
     C                     MOVE 'SWIFT'   IKDORM           **2
     C                     END                             E*2
     C*****      DDORCM    IFEQ '12'                       B*2            S01177
     C           PMRSTM    IFEQ 12                         B*2            S01177
     C                     MOVE 'CCOLL'   IKDORM           **2
     C                     END                             E*2
     C*****      DDORCM    IFEQ '03'                       B*2            S01177
     C           PMRSTM    IFEQ 03                         B*2            S01177
     C                     MOVE 'COMP '   IKDORM           **2
     C                     END                             E*2
     C*****      DDORCM    IFEQ '04'                       B*2            S01177
     C           PMRSTM    IFEQ 04                         B*2            S01177
     C                     MOVE 'PCURR'   IKDORM           **2
     C                     END                             E*2
     C*****      DDORCM    IFEQ '14'                       B*2            S01177
     C           PMRSTM    IFEQ 14                         B*2            S01177
     C                     MOVE 'CURR '   IKDORM           **2
     C                     END                             E*2
     C*****      DDORCM    IFEQ '05'                       B*2            S01177
     C           PMRSTM    IFEQ 05                         B*2            S01177
     C                     MOVE 'MACC '   IKDORM           **2
     C                     END                             E*2
     C*****      DDORCM    IFEQ '06'                       B*2            S01177
     C           PMRSTM    IFEQ 06                         B*2            S01177
     C                     MOVE 'SUSP '   IKDORM           **2
     C                     END                             E*2
     C******     DDORCM    IFEQ '02'                       B*2
     C******               MOVE 'CSENT'   IKDORM           **2
     C******               END                             E*2
     C           PMRSTM    IFEQ 02                         B*2            047736
     C                     MOVE 'CSENT'   IKDORM           **2            047736
     C                     END                             E*2            047736
     C*
     C**  MIDAS receive method.
     C*****                MOVE DDORCM    IKORCM           *1             S01177
     C                     MOVELPMRSTM    IKORCM           *1             S01177
     C                     MOVELPMRSTM    IKRSTM           *1             S01177
     C*
     C**  Our receive instructions.  If the settlement method is 01,02,
     C**  07,08 or 12, convert the MIDAS nostro number to a shortname
     C*****      DDMORI    IFNE *BLANKS                    B*2            S01177
     C*****      DDORCM    IFEQ '01'                       B**3           S01177
     C******     DDORCM    OREQ '02'                       B**3
     C*****      DDORCM    OREQ '07'                       B**3           S01177
     C*****      DDORCM    OREQ '08'                       B**3           S01177
     C*****      DDORCM    OREQ '12'                       B**3           S01177
     C*
     C           PMRONS    IFNE *BLANKS                    B*2            S01177
     C           PMRSTM    IFEQ 01                         B**3           S01177
     C           PMRSTM    OREQ 02                         ***3           E00032
     C           PMRSTM    OREQ 12                         ***3           S01177
     C           PMRSTM    OREQ 07                         ***3           S01177
     C           PMRSTM    OREQ 08                         ***3           S01177
     C*                                                                   S01177
     C****Set up the key to the nostro table.                             S01194
     C*****                MOVE *BLANKS   @KEY             ***3           S01194
     C*****                MOVE '70'      @KEY1            ***3           S01194
     C*****                MOVELDDCCY     @5               ***3           S01194
     C*****                MOVELDDMORI    @2               ***3           S01177
     C*****                MOVELPMRONS    @2      2        ***3     S01177S01194
     C*****                MOVE @2        @5               ***3           S01194
     C*****                MOVE @5        @KEY             ***3           S01194
     C*
     C**  Bypass the validation of Nostro No. if it is 00. This is
     C**  always valid.
     C           @2        IFEQ '00'                       B***4
     C                     MOVEL*BLANKS   IKDORI           ****4
     C                     ELSE                            X***4
     C*****      @KEY      CHAINFDTBLILL             65    ****4          S01194
     C*****      *IN65     IFEQ '1'                        B****5         S01194
     C*****      RECI      OREQ '*'                        B****5         S01194
     C*****                MOVE '1'       *INLR            *****5         S01194
     C*****                MOVE '1'       *INKA            *****5         S01177
     C*****                MOVE '1'       *INKC            *****5         S01177
     C*****                MOVE '1'       *INU7            *****5         S01194
     C*****                MOVE '1'       *INU8            ***************S01194
     C*****                MOVEL'FDTBLILL'DBFILE           * DBERROR 006 *S01194
     C*****                MOVEL@KEY      DBKEY            ***************S01194
     C*****                MOVE '006'     DBASE            *****5         S01194
     C*****                EXSR #C                         *****5         S01194
     C*****                END                             E****5         S01194
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AONOSTR0'                 ****4          S01194
     C                     PARM '*DBERR ' @RTCD   7        ****4          S01194
     C                     PARM '*KEY   ' @OPTN   7        ****4          S01194
     C                     PARM *BLANKS   @KEYA   6        ****4          S01194
     C***********          PARM DDCCY     @KEYB   3        ****4   S01194 CEU003
     C                     PARM WEFCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        ****4                       S01194 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        ****4          S01194
     C                     PARM PMRONS    @KEYE   2        ****4          S01194
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
     C*****                MOVELCSNM      IKDORI           ****4          S01194
     C*********************MOVELA7CSSN    IKDORI           ****4          S01194
     C                     MOVELA7NOSN    IKDORI           ****4          S01194
     C                     END                             E***4
     C                     ELSE                            X**3
     C*****                MOVE DDMORI    IKDORI           ***3           S01177
     C                     MOVELPMRONS    IKDORI           ***3           S01177
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     MOVE *BLANKS   IKDORI           **2
     C                     END                             E*2
     C*
     C**  MIDAS receive instructions.
     C*****                MOVE DDMORI    IKMORI           *1             S01177
     C           PMRSTM    IFNE 04                                        060936
     C                     MOVELPMRONS    IKMORI           *1             S01177
     C                     END                                            060936
     C                     MOVELPMRONS    IKRONS           *1             S01177
     C*
     C**  Customer pay instructions.  If it is a customer number, convert
     C**  to a shortname.
     C*****      DDMCPI    IFNE *BLANKS                    B*2            S01177
     C           PARIBN    IFNE *BLANKS                    B*2            S01177
     C*****                Z-ADD0         @@IDP            **2            S01194
     C*****                Z-ADD6         @@IINT           **2            S01194
     C*****                MOVE *BLANKS   @@ALPH           **2            S01194
     C*****                MOVE DDMCPI    @@ALPH           **2            S01177
     C*****                MOVE PARIBN    @@ALPH           **2      S01177S01194
     C*****                EXSR ZA0840                     **2            S01194
     C*****      @@ERCD    IFEQ 0                          B**3           S01194
     C*****                Z-ADD@@AMT     @CNUM            ***3           S01194
     C*****      @CLTKY    CHAINCLINT                65    ***3           S01194
     C*****      *IN65     IFEQ '0'                        B***4          S01194
     C*****      RECI      ANDNE'D'                        B***4          S01194
     C*****                MOVE '1'       *IN65            ****4          S01194
     C*****                END                             E***4          S01194
     C*****      *IN65     IFEQ '0'                        B***4          S01194
     C*****                MOVE CSNM      IKDCPI           ****4          S01194
     C*****                END                             E***4          S01194
     C*****                END                             E**3           S01194
     C                     CALL 'AOCUSTR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM PARIBN    @KEY1  10        **2            S01194
     C                     PARM *BLANKS   @KYST   7        **2            S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFEQ *BLANKS                    B**3           S01194
     C           @KYST     ANDNE'ERROR  '                  ***3     S01194BHF079
     C           @KYST     ANDNE'*ERROR '                  ***3           BHF079
     C***********          MOVE BBCSSN    IKDCPI           ***3     S01194091825
     C                     MOVE BBCSSN    IKDCRI           ***3           091825
     C                     ELSE                            X**3           S01194
     C*****      @@ERCD    IFNE 0                          B**3           S01177
     C*****      *IN65     OREQ '1'                        ***3           S01177
     C*****      DDMCPI    CHAINSNAME                65    ***3           S01177
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C*****      RECI      ORNE 'D'                        B***4          S01194
     C*****                MOVE *BLANKS   @KEY             ****4          S01194
     C*****                MOVE '71'      @KEY1            ****4          S01194
     C*****                MOVELDDMCPI    @8               ****4          S01177
     C*****                MOVELPARIBN    @8      8        ****4    S01177S01194
     C*****                MOVE @8        @KEY             ****4          S01194
     C*****      @KEY      CHAINFDCPTILL             65    ****4          S01194
     C*****      *IN65     IFEQ '1'                        B****5         S01194
     C*****      RECI      ORNE 'D'                        B****5         S01194
     C*****                MOVE '1'       *INLR            ****4
     C*****                MOVE '1'       *INKA            *****5         S01177
     C*****                MOVE '1'       *INKC            ****4          S01177
     C*****                MOVE '1'       *INU7            ****4
     C*****                MOVE '1'       *INU8            ***************
     C*****                MOVEL'FDCPTILL'DBFILE           * DBERROR 007 *S01194
     C*****                MOVEL@KEY      DBKEY            ***************S01194
     C*****                MOVE '007'     DBASE            ****4
     C*****                EXSR #C                         ****4
     C*****                ELSE                            X***4
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AOCNSTR0'                 ***3           S01194
     C                     PARM '*DBERR ' @RTCD   7        ***3           S01194
     C                     PARM '*KEY   ' @OPTN   7        ***3           S01194
     C                     PARM PARIBN    @ARCD   8        ***3           S01194
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
     C*****                MOVELCSN1      IKDCPI           *****5         S01194
     C*****                MOVE CSN2      IKDCPI           *****5         S01194
     C******************** MOVELAWCSN1    IKDCPI           ****4    S01194E25683
     C******************** MOVE AWCSN2    IKDCPI           ****4    S01194E25683
     C***********          MOVELPARIBN    IKDCPI                    E25683091825
     C                     MOVELPARIBN    IKDCRI                          091825
     C*****                END                             E***4
     C*****                ELSE                            X***4          S01177
     C*****                MOVE DDMCPI    IKDCPI           ****4          S01177
     C*****                END                             E***4          S01177
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     MOVE *BLANKS   IKDCPI           **2
     C                     END                             E*2
     C*
     C**  MIDAS customer pay instructions.
     C*****                MOVE DDMCPI    IKMCPI           *1             S01177
     C***********          MOVELPARIBN    IKMCPI           *1       S01177091825
     C                     MOVELPARIBN    IKMCRI           *1             091825
     C                     MOVELPARIBN    IKRIBN           *1             S01177
     C*
     C**  Pay method.
     C*****      DDMOPM    IFEQ '00'                       B*2            S01177
     C           PMPSTM    IFEQ 00                         B*2            S01177
     C                     MOVE *BLANKS   IKDOPM           **2
     C                     END                             E*2
     C*****      DDMOPM    IFEQ '01'                       B*2            S01177
     C           PMPSTM    IFEQ 01                         B*2            S01177
     C                     MOVE 'TELX '   IKDOPM           **2
     C                     END                             E*2
     C*****      DDMOPM    IFEQ '07'                       B*2            S01177
     C           PMPSTM    IFEQ 07                         B*2            S01177
     C                     MOVE 'CHIPS'   IKDOPM           **2
     C                     END                             E*2
     C*****      DDMOPM    IFEQ '08'                       B*2            S01177
     C           PMPSTM    IFEQ 08                         B*2            S01177
     C                     MOVE 'SWIFT'   IKDOPM           **2
     C                     END                             E*2
     C******     DDMOPM    IFEQ '12'                       B*2
     C******               MOVE 'CCOLL'   IKDOPM           **2
     C******               END                             E*2
     C           PMPSTM    IFEQ 12                         B*2            047736
     C                     MOVE 'CCOLL'   IKDOPM           **2            047736
     C                     END                             E*2            047736
     C*****      DDMOPM    IFEQ '03'                       B*2            S01177
     C           PMPSTM    IFEQ 03                         B*2            S01177
     C                     MOVE 'COMP '   IKDOPM           **2
     C                     END                             E*2
     C*****      DDMOPM    IFEQ '04'                       B*2            S01177
     C           PMPSTM    IFEQ 04                         B*2            S01177
     C                     MOVE 'PCURR'   IKDOPM           **2
     C                     END                             E*2
     C*****      DDMOPM    IFEQ '14'                       B*2            S01177
     C           PMPSTM    IFEQ 14                         B*2            S01177
     C                     MOVE 'CURR '   IKDOPM           **2
     C                     END                             E*2
     C*****      DDMOPM    IFEQ '05'                       B*2            S01177
     C           PMPSTM    IFEQ 05                         B*2            S01177
     C                     MOVE 'MACC '   IKDOPM           **2
     C                     END                             E*2
     C*****      DDMOPM    IFEQ '06'                       B*2            S01177
     C           PMPSTM    IFEQ 06                         B*2            S01177
     C                     MOVE 'SUSP '   IKDOPM           **2
     C                     END                             E*2
     C*****      DDMOPM    IFEQ '02'                       B*2            S01177
     C           PMPSTM    IFEQ 02                         B*2            S01177
     C                     MOVE 'CSENT'   IKDOPM           **2
     C                     END                             E*2
     C*
     C**  MIDAS pay method.
     C*****                MOVE DDMOPM    IKMOPM           *1             S01177
     C                     MOVELPMPSTM    IKMOPM           *1             S01177
     C                     MOVELPMPSTM    IKPSTM           *1             S01177
     C*
     C**  Our pay instructions.  If the settlement type is 01,02,
     C**  07,08 or 12, convert the nostro number to a shortname.
     C*****      DDMOPI    IFNE *BLANKS                    B*2            S01177
     C*******    DDMOPI    IFEQ '01'                       B**3
     C*******    DDMOPI    OREQ '02'                       B**3
     C*******    DDMOPI    OREQ '07'                       B**3
     C*******    DDMOPI    OREQ '08'                       B**3
     C*****      DDMOPM    IFEQ '01'                       B**3           S01177
     C*****      DDMOPM    OREQ '02'                       B**3           S01177
     C*****      DDMOPM    OREQ '07'                       B**3           S01177
     C*****      DDMOPM    OREQ '08'                       B**3           S01177
     C******     DDMOPI    OREQ '12'                       B**3
     C*
     C           PMPONS    IFNE *BLANKS                    B*2            S01177
     C           PMPSTM    IFEQ 01                         B**3           S01177
     C           PMPSTM    OREQ 02                         ***3           S01177
     C           PMPSTM    OREQ 07                         ***3           S01177
     C           PMPSTM    OREQ 08                         ***3           S01177
     C           PMPSTM    OREQ 12                         ***3           E00032
     C****Set*up the key to the nostro table.                             S01194
     C*****                MOVE *BLANKS   @KEY             ***3           S01194
     C*****                MOVE '70'      @KEY1            ***3           S01194
     C*****                MOVELDDCCY     @5               ***3           S01194
     C*****                MOVELDDMOPI    @2               ***3           S01177
     C*****                MOVELPMPONS    @2               ***3     S01177S01194
     C*****                MOVE @2        @5               ***3           S01194
     C*****                MOVE @5        @KEY             ***3           S01194
     C*
     C**  Bypass the validation of Nostro No. if it is 00. This is
     C**  always valid.
     C           @2        IFEQ '00'                       B***4
     C                     MOVEL*BLANKS   IKDOPI           ****4
     C                     ELSE                            X***4
     C*****      @KEY      CHAINFDTBLILL             65    ****4          S01194
     C*****      *IN65     IFEQ '1'                        B****5         S01194
     C*****      RECI      OREQ '*'                        B****5         S01194
     C*****                MOVE '1'       *INLR            *****5         S01194
     C*****                MOVE '1'       *INKA            *****5         S01177
     C*****                MOVE '1'       *INKC            *****5   S01177S01194
     C*****                MOVE '1'       *INU7            *****5         S01194
     C*****                MOVE '1'       *INU8            ***************S01194
     C*****                MOVEL'FDTBLILL'DBFILE           * DBERROR 008 *S01194
     C*****                MOVEL@KEY      DBKEY            ***************S01194
     C*****                MOVE '008'     DBASE            *****5         S01194
     C*****                EXSR #C                         *****5         S01194
     C*****                END                             E****5         S01194
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AONOSTR0'                 ****4          S01194
     C                     PARM '*DBERR ' @RTCD   7        ****4          S01194
     C                     PARM '*KEY   ' @OPTN   7        ****4          S01194
     C                     PARM *BLANKS   @KEYA   6        ****4          S01194
     C***********          PARM DDCCY     @KEYB   3        ****4   S01194 CEU003
     C                     PARM WEFCY     @KEYB   3                       CEU003
     C**********           PARM *BLANKS   @KEYC   4        ****4                       S01194 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2        ****4          S01194
     C                     PARM PMPONS    @KEYE   2        ****4          S01194
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
     C*****                MOVELCSNM      IKDOPI           ****4
     C*********************MOVELA7CSSN    IKDOPI           ****4
     C                     MOVELA7NOSN    IKDOPI           ****4
     C                     END                             E***4
     C                     ELSE                            X**3
     C*****                MOVE DDMOPI    IKDOPI           ***3           S01177
     C                     MOVELPMPONS    IKDOPI           ***3           S01177
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     MOVE *BLANKS   IKDOPI           **2
     C                     END                             E*2
     C*
     C**  MIDAS our pay instructions.
     C*****                MOVE DDMOPI    IKMOPI           *1             S01177
     C           PMPSTM    IFNE 04                                        060936
     C                     MOVELPMPONS    IKMOPI           *1             S01177
     C                     END                                            060936
     C                     MOVELPMPONS    IKPONS           *1             S01177
     C*
     C**  Customer receive instructions.  If it is a customer
     C**  number then convert it to a shortname.
     C*****      DDMCRI    IFNE *BLANKS                    B*2            S01177
     C           PAAWBN    IFNE *BLANKS                    B*2            S01177
     C*****                Z-ADD0         @@IDP            **2            S01194
     C*****                Z-ADD6         @@IINT           **2            S01194
     C*****                MOVE *BLANKS   @@ALPH           **2            S01194
     C*****                MOVE DDMCRI    @@ALPH           **2            S01177
     C*****                MOVE PAAWBN    @@ALPH           **2            S01177
     C*****                EXSR ZA0840                     **2            S01194
     C*****      @@ERCD    IFEQ 0                          B**3           S01194
     C*****                Z-ADD@@AMT     @CNUM            ***3           S01194
     C*****      @CLTKY    CHAINCLINT                65    ***3           S01194
     C*****      *IN65     IFEQ '0'                        B***4          S01194
     C*****      RECI      ANDNE'D'                        B***4          S01194
     C*****                MOVE '1'       *IN65            ****4          S01194
     C*****                END                             E***4          S01194
     C*****      *IN65     IFEQ '0'                        B***4          S01194
     C*****                MOVE CSNM      IKDCRI           ****4          S01194
     C*****                END                             E***4          S01194
     C*****                END                             E**3           S01194
     C*****      @@ERCD    IFNE 0                          B**3           S01177
     C*****      *IN65     OREQ '1'                        ***3           S01177
     C*****      DDMCRI    CHAINSNAME                65    ***3           S01177
     C*****      *IN65     IFEQ '1'                        B***4          S01194
     C*****      RECI      OREQ '*'                        B***4          S01194
     C*****                MOVE *BLANKS   @KEY             ****4          S01194
     C*****                MOVE '71'      @KEY1            ****4          S01194
     C*****                MOVELDDMCRI    @8               ****4          S01177
     C*****                MOVELPAAWBN    @8               ****4          S01177
     C*****                MOVE @8        @KEY             ****4          S01194
     C*****      @KEY      CHAINFDCPTILL             65    ****4          S01194
     C*****      *IN65     IFEQ '1'                        B****5         S01194
     C*****      RECI      OREQ '*'                        B****5         S01194
     C                     CALL 'AOCUSTR0'                 **2            S01194
     C                     PARM *BLANKS   @RTCD   7        **2            S01194
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM PAAWBN    @KEY1  10        **2            S01194
     C                     PARM *BLANKS   @KYST   7        **2            S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFEQ *BLANKS                    B**3           S01194
     C           @KYST     ANDNE'ERROR  '                  ***3     S01194BHF079
     C           @KYST     ANDNE'*ERROR '                  ***3           S01194
     C                     MOVE BBCSSN    IKDCPI           ***3           S01194
     C                     ELSE                            X**3           S01194
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AOCNSTR0'                 ***3           S01194
     C                     PARM '*DBERR ' @RTCD   7        ***3           S01194
     C                     PARM '*KEY   ' @OPTN   7        ***3           S01194
     C                     PARM PAAWBN    @ARCD   8        ***3           S01194
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
     C*****                MOVE '1'       *INLR            ****4          S01194
     C*****                MOVE '1'       *INKA            ****4          S01177
     C*****                MOVE '1'       *INKC            ****4    S01177S01194
     C*****                MOVE '1'       *INU7            ***************S01194
     C*****                MOVE '1'       *INU8            * DBERROR 029 *S01194
     C*****                MOVEL'FDCPTILL'DBFILE           ***************S01194
     C*****                MOVEL@KEY      DBKEY            *****5         S01194
     C*****                MOVE '029'     DBASE            ****4          S01194
     C*****                EXSR #C                         ****4          S01194
     C*****                ELSE                            X***4          S01194
     C*****                MOVELCSN1      IKDCRI           *****5         S01194
     C*****                MOVE CSN2      IKDCRI           *****5         S01194
     C******************** MOVELAWCSN1    IKDCRI           ****4    S01194E25683
     C******************** MOVE AWCSN2    IKDCRI           ****4    S01194E25683
     C                     MOVELPAAWBN    IKDCRI                          E25683
     C*****                END                             E***4          S01194
     C*****                ELSE                            X***4          S01177
     C*****                MOVE DDMCRI    IKDCRI           ****4          S01177
     C*****                END                             E***4          S01177
     C                     END                             E**3
     C                     ELSE                            X*2
     C***********          MOVE *BLANKS   IKDCRI           **2            091825
     C                     MOVE *BLANKS   IKDCPI           **2            091825
     C                     END                             E*2
     C*
     C**  MIDAS customers receive instructions.
     C*****                MOVE DDMCRI    IKMCRI           *1             S01177
     C                     MOVELPAAWBN    IKAWBN           *1             S01177
     C***********          MOVELPAAWBN    IKMCRI           *1       S01177091825
     C                     MOVELPAAWBN    IKMCPI           *1             091825
     C*
     C****For account of.  If it is a customer number then convert
     C****it to a shortname.
     C*****      DDMFAO    IFNE *BLANKS                    B*2            S01177
     C**  Access customer details via access program
     C           PABENN    IFNE *BLANKS                    B*2            S01177
     C*****                Z-ADD0         @@IDP            **2            S01194
     C*****                Z-ADD6         @@IINT           **2            S01194
     C*****                MOVE *BLANKS   @@ALPH           **2            S01194
     C*****                MOVE DDMFAO    @@ALPH           **2            S01177
     C*****                MOVE PABENN    @@ALPH           **2      S01177S01194
     C*****                EXSR ZA0840                     **2            S01194
     C*****      @@ERCD    IFEQ 0                          B**3           S01194
     C*****                Z-ADD@@AMT     @CNUM            ***3           S01194
     C*****      @CLTKY    CHAINCLINT                65    ***3           S01194
     C*****      *IN65     IFEQ '0'                        B***4          S01194
     C*****      RECI      ANDNE'D'                        B***4          S01194
     C*****                MOVE '1'       *IN65            ****4          S01194
     C*****                END                             E***4          S01194
     C*****      *IN65     IFEQ '0'                        B***4          S01194
     C*****                MOVE CSNM      IKDFAC           ****4          S01177
     C*****                MOVE CSNM      IKDFAC           ****4    S01177S01194
     C*****                END                             E***4          S01194
     C*****                ELSE                            X**3           S01177
     C*****      DDMFAO    CHAINSNAME                65    ***3           S01177
     C*****      *IN65     IFEQ '0'                        B***4          S01177
     C*****                MOVE CSNM      IKDFAC           ****4          S01177
     C*****                END                             E***4          S01177
     C*****                END                             E**3           S01194
     C*****      *IN65     IFEQ '1'                        B**3           S01194
     C*****      RECI      OREQ '*'                        B**3           S01194
     C*****                MOVE '1'       *INLR            ***3           S01194
     C*****                MOVE '1'       *INKA            ***3           S01177
     C*****                MOVE '1'       *INKC            ***3     S01177S01194
     C*****                MOVE '1'       *INU7            ***3           S01194
     C*****                MOVE '1'       *INU8            ***************S01194
     C*****                MOVEL'CLINT   'DBFILE           * DBERROR 010 *S01194
     C*****                MOVELDDMFAO    DBKEY            ***************S01177
     C*****                MOVELPABENN    DBKEY            *********S01177S01194
     C*****                MOVE '010'     DBASE            ***3           S01194
     C*****                EXSR #C                         ***3           S01194
     C*****                END                             E**3           S01194
      ***(database*error*handling*done*in*access*program)           S01194E25678
     C                     CALL 'AOCUSTR0'                 **2            S01194
     C*********************PARM '*DBERR ' @RTCD   7        **2      S01194E25678
     C                     PARM *BLANKS   @RTCD   7        **2            E25678
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM PABENN    @KEY1  10        **2            S01194
     C                     PARM *BLANKS   @KYST   7        **2            S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*
     C           @RTCD     IFEQ *BLANKS                                   E16027
     C                     MOVE BBCSSN    IKDFAC           **2      S01177S01194
     C*                                                                   E16027
     C** If up to this point the for account of cannot be found, try to   E16027
     C** search the counter party nostros.                                E16027
     C*                                                                   E16027
     C                     ELSE                                           E16027
     C                     CALL 'AOCNSTR0'                                E16027
     C                     PARM '*DBERR ' @RTCD   7                       E16027
     C                     PARM '*KEY   ' @OPTN   7                       E16027
     C                     PARM PABENN    @CNKY   8                       E16027
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
     C*                                                                   E16027
     C           @RTCD     IFNE *BLANKS                                   E16027
     C                     MOVE '1'       *INLR                           E16027
     C                     MOVE '1'       *INKC                           E16027
     C                     MOVE '1'       *INU7            ***************E16027
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVEL'SDCNSTPD'DBFILE           * DB ERROR 010*E16027
     C                     MOVELPABENN    DBKEY            ***************E16027
     C                     MOVE '010'     DBASE                           E16027
     C                     OUT  LDA                                       E24039
     C                     EXSR #C                                        E16027
     C*                                                                   E16027
     C                     ELSE                                           E16027
     C******************** MOVELAWCSN1    IKDFAC                    E16027E25683
     C******************** MOVE AWCSN2    IKDFAC                    E16027E25683
     C                     MOVELPABENN    IKDFAC                          E25683
     C                     END                                            E16027
     C*                                                                   E16027
     C                     END                                            E16027
032  C*                                                                   E16027
     C                     ELSE                            X*2
     C                     MOVE *BLANKS   IKDFAC           **2
     C                     END                             E*2
     C*
     C**  MIDAS for account of.
     C*****                MOVE DDMFAO    IKMFAO           *1             S01177
     C                     MOVELPABENN    IKMFAO           *1             S01177
     C                     MOVELPABENN    IKBENN           *1             S01177
     C*
     C**  Special instructions.
     C*****                MOVE DDSPEC    IKSPEC           *1             S01177
     C                     MOVE PMBTB1    IKSPEC           *1             S01177
     C                     MOVE PMBTB1    IKBTB1           *1             S01177
     C                     MOVE PMBTB2    IKBTB2           *1             S01177
     C                     MOVE PMBTB3    IKBTB3           *1             S01177
     C                     MOVE PMBTB4    IKBTB4           *1             S01177
     C                     MOVE PMBTB5    IKBTB5           *1             S01177
     C                     MOVE PMBTB6    IKBTB6           *1             S01177
     C*                                                                   E22405
     C**  Cover MT202 required.                                           E22405
     C                     MOVE PMCVMR    IKCVMR           *1             E22405
     C*
     C**  Start/last interest date.
     C*****                Z-ADDRUND      IKDLAD           *1             S01194
     C                     Z-ADDBJRDNB    IKDLAD           *1             S01194
     C*
     C** setup the NEW standard deal fields                               S01177
     C                     MOVELPMRIBA    IKRIBA           *1             S01177
     C                     MOVELPAROBN    IKROBN           *1             S01177
     C                     MOVELPAROCN    IKROCN           *1             S01177
     C                     MOVELPAPIBN    IKPIBN           *1             S01177
     C                     MOVELPMPIBA    IKPIBA           *1             S01177
     C                     MOVELPAPOBN    IKPOBN           *1             S01177
     C                     MOVELPAPOCN    IKPOCN           *1             S01177
     C                     MOVELPARCRN    IKRCRN           *1             S01177
     C                     MOVELPMRCRA    IKRCRA           *1             S01177
     C                     MOVELPARVNO    IKRVNO           *1             S01177
     C                     MOVELPMAWBA    IKAWBA           *1             S01177
     C                     MOVELPMBENA    IKBENA           *1             S01177
     C                     MOVELPMDTP1    IKDTP1           *1             S01177
     C                     MOVELPMDTP2    IKDTP2           *1             S01177
     C                     MOVELPMDTP3    IKDTP3           *1             S01177
     C                     MOVELPMDTP4    IKDTP4           *1             S01177
     C                     MOVELPMDCHG    IKDCHG           *1             S01177
     C                     MOVELPMROBR    IKROBR           *1             S01117
     C                     MOVELPMPOBR    IKPOBR           *1             S01117
     C                     MOVELPMPSCY    IKSTCY                          CEU003
     C                     MOVELPMIC72    IKIC72                          CEU003
      *                                                                   CEU015
     C           @TERM1    IFNE 'R'                                       CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           @ICEUR    ANDEQ'Y'                                       CEU015
     C                     MOVE @RDCCY    IKRTFC                          CEU015
      *                                                                   145001
     C                     CALL 'EU0200'                                  145001
     C                     PARM *BLANKS   P@RTCD  7        Return Code    145001
     C                     PARM IKAMNP    P@FRAM 183       Princ Amt      145001
     C                     PARM IKCCY     P@FRCY  3        Trans Ccy      145001
     C                     PARM IKRTFC    P@TOCY  3        Orig  Ccy      145001
     C                     PARM           P@OUTA 150       Settl Amt      145001
     C                     PARM           P@INTA 183       Int Set Amt    145001
     C                     PARM           P@EXRT 159       Exch Rate      145001
     C                     PARM           P@MDIN  1        M/D Ind        145001
      *                                                                   145001
     C           P@RTCD    IFEQ '*ERROR*'                                 145001
     C                     MOVELHKCCY     DBKEY6  6                       145001
     C                     MOVE HKRTFC    DBKEY6                          145001
     C                     MOVE '033'     DBASE            **********     145001
     C                     MOVELDBKEY6    DBKEY            *  33    *     145001
     C                     MOVEL'EU0200'  DBFILE           **********     145001
     C                     EXSR *PSSR                                     145001
     C                     MOVE *ON       *INKC                           145001
     C                     EXSR #C                                        145001
     C                     ELSE                                           145001
      *                                                                   145001
     C           P@OUTA    IFLT *ZERO                                     145001
     C                     Z-SUBP@OUTA    P@OUTA                          145001
     C                     ENDIF                                          145001
      *                                                                   145001
     C                     Z-ADDP@OUTA    IKORDA                          145001
     C                     ENDIF                                          145001
      *                                                                   145001
     C                     ELSE                                           CEU015
     C                     MOVE *BLANKS   IKRTFC                          CEU015
     C                     Z-ADD*ZEROS    IKORDA                          145001
     C                     ENDIF                                          CEU015
     C                     ELSE                                           CEU015
     C                     MOVE HKRTFC    IKRTFC                          CEU015
     C                     Z-ADDHKORDA    IKORDA                          145001
     C                     ENDIF                                          CEU015
     C*
     C                     END                             E1
     C*
     C**  Set up MIDAS action code according to current status, future
     C**  status, and whether authorisationn or re-authorisation is
     C**  required.
     C*                                                                   S01434
     C           DDACTN    IFEQ 'I'                        B1
     C***********H1BOAR****IFEQ*'N'************************B*2************S01319
     C           BNMMAU    IFEQ 'N'                        B*2            S01319
     C           @STS      ANDEQ'A'                        B*2
     C                     MOVE 'I'       IKMACT           **2
     C                     END                             E*2
     C*
     C***********H1BOAR****IFEQ*'Y'************************B*2************S01319
     C           BNMMAU    IFEQ 'Y'                        B*2            S01319
     C           @STS      ANDEQ'C'                        B*2
     C                     MOVE *BLANKS   IKMACT           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           DDACTN    IFEQ 'A'                        B1
     C           @DSTS     IFEQ 'C'                        B*2
     C           @STS      ANDEQ'C'                        B*2
     C                     MOVE *BLANKS   IKMACT           **2
     C                     END                             E*2
     C*
     C           @DSTS     IFEQ 'A'                        B*2
     C           @STS      ANDEQ'R'                        B*2
     C***********H1RADL****ANDEQ'Y'************************B*2************S01319
     C           BNMMRA    ANDEQ'Y'                        B*2            S01319
     C           @DSTS     OREQ 'A'                        B*2
     C           @STS      ANDEQ'A'                        B*2
     C***********H1RADL****ANDEQ'N'************************B*2************S01319
     C           BNMMRA    ANDEQ'N'                        B*2            S01319
     C           @DSTS     OREQ 'R'                        B*2
     C           @STS      ANDEQ'R'                        B*2
     C***********H1RADL****ANDEQ'Y'************************B*2************S01319
     C           BNMMRA    ANDEQ'Y'                        B*2            S01319
     C***********          MOVE 'A'       IKMACT           **2            S01434
     C           @TERM1    IFEQ 'R'                                       S01434
     C                     MOVE 'I'       IKMACT                          S01434
     C                     ELSE                                           S01434
     C                     MOVE 'A'       IKMACT                          S01434
     C                     END                                            S01434
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP32                                           S01408
     C*                                                                   S01408
     C           DDACTN    IFEQ 'D'                        B1
     C           @DSTS     IFEQ 'C'                        B*2
     C                     MOVE *BLANKS   IKMACT           **2
     C                     ELSE                            X*2
     C                     MOVE 'R'       IKMACT           **2
     C                     END                             E*2
     C                     END                             E1
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP33                                           S01408
     C*                                                                   S01408
     C*
     C********   @DSTS     IFEQ 'A'                        B*2
     C********   @DSTS     OREQ 'R'                        B*2
     C********   H1RADL    ANDEQ'N'                        B*2
     C********             MOVE 'R'       IKMACT           **2
     C********             END                             E*2
     C********             END                             E1
     C*
     C           DDACTN    IFEQ 'X'                        B1
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP34                                           S01408
     C*                                                                   S01408
     C***********H1BOAR****IFEQ*'Y'************************B*2************S01319
     C           BNMMAU    IFEQ 'Y'                        B*2            S01319
     C           @DSTS     ANDEQ'C'                        B*2
     C           @STS      ANDEQ'A'                        B*2
     C                     MOVE 'I'       IKMACT           **2
     C                     END                             E*2
     C*
     C***********H1BOAR****IFEQ*'Y'************************B*2************S01319
     C***********H1RADL****ANDEQ'Y'************************B*2************S01319
     C           BNMMAU    IFEQ 'Y'                        B*2            S01319
     C           BNMMRA    ANDEQ'Y'                        B*2            S01319
     C           @DSTS     ANDEQ'R'                        B*2
     C           @STS      ANDEQ'A'                        B*2
     C                     MOVE 'A'       IKMACT           **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  Set up last change date in YYYYMMDD format.
     C*****                Z-ADDRUND      @@DAYN                          S01194
     C                     Z-ADDBJRDNB    @@DAYN                          S01194
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     IKLDAT
     C*
     C**  Machine date.
     C                     MOVE UDATE     IKMCHD
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP47                                           S01408
      *                                                                   S01408
     C*
     C           #ZJ9      ENDSR                           **#ZJ9**
      /EJECT
     C*****************************************************************   S01177
     C*                                                               *   S01177
     C* #ZK      - Set up Date of Payment and Receipt                 *   S01177
     C*                                                               *   S01177
     C* CALLS                                                         *   S01177
     C*                                                               *   S01177
     C* CALLED BY  #BE    - CF14 processing.                          *   S01177
     C*            #ZI    - Validates the screen input.               *   S01177
     C*                                                               *   S01177
     C* FLDS USED         -                                           *   S01177
     C*            @VDYNO - Value date day no.                        *   S01177
     C*            @MDYNO - Maturity date (MIDAS day no.)             *   S01177
     C*            @NDYNO - Next interest date (MIDAS day no.)        *   S01177
     C*            @NTCNM - Notice days (numeric)                     *   S01177
     C*                                                               *   S01177
     C*****************************************************************   S01177
     C           #ZK       BEGSR                                          S01177
     C*                                                                   S01177
     C           DDTYPE    IFEQ 'IT'                       B1             S01177
     C           DDTYPE    OREQ 'TD'                       *1             S01177
     C           DDTYPE    OREQ 'CI'                       *1             S01177
     C           DDTYPE    OREQ 'CD'                       *1             S01177
     C                     Z-ADD@VDYNO    PMDTRC           *1             S01177
     C***********          Z-ADD@MDYNO    PMDTPY           *1       S01177E22936
     C*******              Z-ADD@VDYNO    PMDTPY           *1       E22936075430
     C                     Z-ADD@MDYNO    PMDTPY           *1             075430
     C*                                                                   S01177
     C** IF MATURITY DATE NON ZERO ADD TO PAYMENT DATE OTHERWISE FOR      S01177
     C** FOR CALL NOTICE DEALS PAYMENT DATE = VALUE DATE + NOTICE DAYS    S01177
     C           DDTYPE    IFEQ 'CD'                       B*2            S01177
     C           @MDYNO    IFNE 0                          B**3           S01177
     C                     Z-ADD@MDYNO    PMDTPY           ***3           S01177
     C                     ELSE                            X**3           S01177
     C           @NDYNO    IFNE 0                          B***4          S01177
     C                     Z-ADD@NDYNO    PMDTPY           ****4          S01177
     C                     ELSE                            X***4          S01177
     C           PMRUND    SUB  PMBVPD    BVDAT   50                      088380
     C           @VDYNO    IFLT BVDAT                                     088380
     C                     Z-ADDPMRUND    PMDTPY                          088380
     C                     ELSE                                           088380
     C                     Z-ADD@VDYNO    PMDTPY           ****4          S01177
     C                     END                                            088380
     C                     ADD  @NTCNM    PMDTPY           ****4          S01177
     C                     END                             E***4          S01177
     C                     END                             E**3           S01177
     C                     END                             E*2            S01177
     C*                                                                   S01177
     C                     ELSE                            X1             S01177
     C*                                                                   S01177
     C                     Z-ADD@VDYNO    PMDTPY           *1             S01177
     C                     Z-ADD@MDYNO    PMDTRC           *1             S01177
     C           DDTYPE    IFEQ 'CL'                       B*2            S01177
     C           DDTYPE    OREQ 'DL'                       **2            S01177
     C           @MDYNO    IFNE 0                          B**3           S01177
     C                     Z-ADD@MDYNO    PMDTRC           ***3           S01177
     C                     ELSE                            X**3           S01177
     C           @NDYNO    IFNE 0                          B***4          S01177
     C                     Z-ADD@NDYNO    PMDTRC           ****4          S01177
     C                     ELSE                            X***4          S01177
     C           PMRUND    SUB  PMBVPD    BVDAT   50                      088380
     C           @VDYNO    IFLT BVDAT                                     088380
     C                     Z-ADDPMRUND    PMDTRC                          088380
     C                     ELSE                                           088380
     C                     Z-ADD@VDYNO    PMDTRC           ****4          S01177
     C                     END                                            088380
     C                     ADD  @NTCNM    PMDTRC           ****4          S01177
     C                     END                             E***4          S01177
     C                     END                             E**3           S01177
     C                     END                             E*2            S01177
     C                     END                             E1             S01177
     C*                                                                   S01177
     C           #ZK9      ENDSR                           **#ZK9**       S01177
      /EJECT                                                              S01177
     C*****************************************************************
     C*                                                               *
     C* #ZG      - Update processing.                                 *
     C*                                                               *
     C* CALLS    #ZA      - Resets screen error indicators and MSGQ.  *
     C*          #ZD      - Sets up screen with file values.          *
     C*          #ZE      - Clears all screen fields.                 *
     C*          #ZEA     - Clear standard deal                       *   E18139
     C*          #ZJ      - Move screen fields into standard deal fmt.*
     C*          MM0078   - Update front office data base.            *
     C***********MM0082***-*Update*back*office*data*base.             *   082738
     C*          MM0083   - Update back office data base.             *   082738
     C*          ZA0250   - Clears error message queue.               *
     C*          ZA0440   - Sends a msg with data to the pgm msg queue*
     C*          ZTNLU1   - Locks and updates trans. no. data area.   *
     C*                                                               *
     C* CALLED BY  #ZC    - Enter processing for action code A.       *
     C*            #ZM    - F10  processing.                          *
     C*            #ZP    - Enter processing for action code X.       *
     C*                                                               *
     C* FLDS USED  @DLKEY - Numeric key to deal file.                 *
     C*            @DATA  - DS to set up data for screen messages.    *
     C*            @TXT   - Field holding 'Deal Number' text.         *
     C*            @DATA1 - Sub-field of @DATA.                       *
     C*            @DATA2 - Sub-field of @DATA.                       *
     C*            @MSGID - Message id field.                         *
     C*            @DLUP  - Stored day of last update.                *
     C*            @MLUP  - Stored month of last update.              *
     C*            @YLUP  - Stored year of last update.               *
     C*            @TLUP  - Stred time of last update.                *
     C*            @RLSFL - File exception format.                    *
     C*            @DATAA - Field used to set up @DATA.               *
     C*            @TERM  - Termination parameter.                    *
     C*************@BOF***-*Called*from*back*office*field.****************S01319
     C*            @TDIN  - This deal indicator.                      *
     C*            @SLDS  - Data structure with MMSTDLPP format.      *
     C*            @SSDS  - Standard deal DS based on N.A.s sold.     *
     C*            @SBDS  - Standard deal DS based on N.A.s bought.   *
     C*            @SADS  - Standard deal DS based on DEAMS.          *
     C*                                                               *
     C*****************************************************************
     C           #ZG       BEGSR
     C/COPY WNCPYSRC,MM0089C099
     C*
     C**  Chain to record to be updated to check for external update
     C**  and to lock the record to prevent external update.
     C**  - *IN72 set on if the record is not found.
     C**  - *IN79 set on if the record is locked.
     C                     MOVE DDDLNO    @DLKEY
     C                     MOVE *IN79     W1IN79  1                       CEU003
     C           @DLKEY    CHAINMMDEAULL             7279
     C                     MOVE *IN79     W2IN79  1                       CEU003
     C                     MOVE W1IN79    *IN79                           CEU003
     C*
     C**  If no record for that key exists, *IN72 is set on.
     C           *IN72     IFEQ '1'                        B1
     C*
     C                     MOVELDDDLNO    DBKEY            *1
     C           *LOCK     IN   LDA                                       E24039
     C                     MOVEL'MMDEAULL'DBFILE           ***************
     C                     MOVEL'011'     DBASE            * DBERROR 011 *
     C                     OUT  LDA                        ***************E24039
     C                     MOVE '1'       *INU7            ***************
     C                     MOVE '1'       *INU8            *1
     C                     MOVE '1'       *INKC            *1
     C*
     C**  By-pass further update processing.
     C                     EXSR #C                         *1
     C                     END                             E1
     C*
     C**  If *IN79 is on then the record is locked.
     C************IN79     IFEQ '1'                        B1             CEU003
     C           W2IN79    IFEQ '1'                                       CEU003
     C*
     C**  Clear the screen error message queue.
     C                     EXSR #ZA                        *1
     C*
     C**  Set up error output to screen.
     C                     MOVE *BLANKS   @DATA            *1
     C                     MOVEL@TXT,1    @DATA1           *1
     C                     MOVELDDDLNO    @DATA2           *1
     C                     MOVEL'MMM1011' @MSGID           *1
     C                     CALL 'ZA0440'                   *1
     C                     PARM           @MSGID           *1
     C                     PARM           @DATA            *1
     C*
     C**  By-pass further update processing.
     C                     GOTO #ZG9                       *1
     C*
     C                     END                             E1
     C*
     C**  If any of the date and time fields have changed since
     C**  the file was initially read, then the record has been
     C**  updated by another workstation.
     C           @DLUP     IFNE HKDLUP                     B1
     C           @MLUP     ORNE HKMLUP                     B1
     C           @YLUP     ORNE HKYLUP                     B1
     C           @TLUP     ORNE HKTLUP                     B1
     C*
     C**  - If last change type is A update was an amendment.
     C           HKLACT    IFEQ 'A'                        B*2
     C*
     C                     MOVEL'MMM1013' @MSGID           **2
     C*
     C**  Set on indicator to show that an external transaction has
     C**  taken place - used to prevent new field values from being
     C**  blanked at the end of select processing.
     C***********          MOVE '1'       *IN78            **2            S01434
     C                     Z-ADD1         IN78                            S01434
     C*
     C                     END                             E*2
     C*
     C**  - If last change type is D update was an deletion.
     C           HKLACT    IFEQ 'D'                        B*2
     C*
     C                     MOVEL'MMM1014' @MSGID           **2
     C*
     C**  Set on indicator to show that an external transaction has
     C**  taken place - used to prevent new field values from being
     C**  blanked at the end of select processing.
     C***********          MOVE '1'       *IN78            **2            S01434
     C                     Z-ADD1         IN78                            S01434
     C*
     C                     END                             E*2
     C*
     C**  - If last change type is X update was an authorization
     C           HKLACT    IFEQ 'X'                        B*2
     C*
     C                     MOVEL'MMM1035' @MSGID           **2
     C*
     C**  Set on indicator to show that an external transaction has
     C**  taken place - used to prevent new field values from being
     C**  blanked at the end of select processing.
     C***********          MOVE '1'       *IN78            **2            S01434
     C                     Z-ADD1         IN78                            S01434
     C*
     C                     END                             E*2
     C*
     C**  Set up error output to screen.
     C                     MOVE *BLANKS   @DATA            *1
     C                     MOVEL@TXT,1    @DATA1           *1
     C                     MOVELDDDLNO    @DATA2           *1
     C                     CALL 'ZA0440'                   *1
     C                     PARM           @MSGID           *1
     C                     PARM           @DATA            *1
     C*
     C**  - If last change type is I or A, display new field values.
     C           HKLACT    IFEQ 'X'                        B*2
     C           HKLACT    OREQ 'A'                        B*2
     C*
     C**  Set up screen and work fields with newly changed values (i.e.
     C**  from chain to update file).
     C                     EXSR #ZD                        **2
     C           DDACTN    IFNE 'X'                        B**3
     C                     MOVE 'E'       DDACTN           ***3
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  - If last change type is D update was an deletion.
     C           HKLACT    IFEQ 'D'                        B*2
     C*
     C**  Clear screen fields.
     C                     EXSR #ZE                        **2
     C*                                                                   E18139
     C**  And standard deal fields                                        E18139
     C                     EXSR #ZEA                       **2            E18139
     C*
     C                     END                             E*2
     C*
     C**  Release locked record.
     C                     EXCPT@RLSFL                     *1
     C*
     C**  By-pass further update processing.
     C                     GOTO #ZG9                       *1
     C*
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C288
     C*
     C**  Update validation is now complete - setup file fields.
     C**  Retrieve the MIDAS date and set up the file fields.
     C**  Fill up the other fields.
     C                     EXSR #ZJ
      *                                                                   CAC001
      **  Initialise Funding Information fields                           CAC001
      **  if Analytical is on and deal type is not 'IL', 'ID'.            CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           DDTYPE    ANDNE'IL'                                      CAC001
     C           DDTYPE    ANDNE'ID'                                      CAC001
     C                     Z-ADDHKFSRP    WFSRP                           CAC001
     C                     MOVE HKFSGN    WFSGN                           CAC001
     C                     MOVE HKFPRC    WFPRC                           CAC001
     C                     ELSE                                           CAC001
     C                     Z-ADD*ZEROS    WFSRP                           CAC001
     C                     MOVE *BLANKS   WFSGN                           CAC001
     C                     MOVE *BLANKS   WFPRC                           CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,MM0089C063
     C*
     C**  Send a confirmation message.
     C*                                                                   054889
     C           DDACTN    IFEQ 'X'                                       054889
     C           @NOPMS    ANDEQ3                                         054889
     C/COPY WNCPYSRC,MM0089C243
     C                     ELSE                                           054889
     C*                                                                   054889
     C           DDACTN    IFNE 'D'                        B1
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CCP6                                           S01408
      *                                                                   S01408
     C* Delete check on @NOPMS to force acceptance screen for range       E20989
     C* authorisation - same as MM0026 and MM0027.                        E20989
     C********** @NOPMS ** ANDNE3 ************************ B1             E20989
     C                     MOVE *BLANKS   @DATA            *1
     C           DDACTN    IFEQ 'A'                        B*2
     C                     MOVEL'amend'   @DATA            **2
     C                     END                             E*2
     C           DDACTN    IFEQ 'I'                        B*2
     C                     MOVEL'insert'  @DATA            **2
     C**  Do not display FEEDBACK information (or DELETED)                S01184
     C                     MOVE '1'       *IN94                           S01184
     C                     MOVE '0'       *IN39                           S01184
     C                     ELSE                                           S01184
     C                     MOVE '0'       *IN94                           S01184
     C                     END                             E*2
     C           DDACTN    IFEQ 'X'                        B*2
     C                     MOVEL'authoriz'@DATAA           **2
     C                     MOVE 'e'       @DATAA           **2
     C                     MOVEL@DATAA    @DATA            **2
     C                     END                             E*2
     C           *IN55     IFEQ '1'                        B*2            E12365
     C                     MOVEL'MMM1039' @MSGID           **2            E12365
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C114                                           S01408
     C*                                                                   S01408
     C                     CALL 'ZA0440'                   **2            E12365
     C                     PARM           @MSGID           **2            E12365
     C                     PARM           @DATA            **2            E12365
     C/COPY WNCPYSRC,MM0089C349
     C                     ELSE                            X*2            E12365
     C*                                                                   059667
     C           DDACTN    IFNE 'X'                                       059667
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP10                                           S01408
     C*                                                                   S01408
     C                     MOVEL'MMM1036' @MSGID           **2
     C                     CALL 'ZA0250'                   **2
     C                     CALL 'ZA0440'                   **2
     C                     PARM           @MSGID           **2
     C                     PARM           @DATA            **2
     C/COPY WNCPYSRC,MM0089C350
     C                     ELSE                                           059667
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP11                                           S01408
     C*                                                                   S01408
     C                     MOVEL'MMX1036' @MSGID                          059667
     C                     CALL 'ZA0250'                                  059667
     C                     CALL 'ZA0440'                                  059667
     C                     PARM           @MSGID                          059667
     C                     PARM           @DATA                           059667
     C/COPY WNCPYSRC,MM0089C210
     C                     END                                            059667
     C                     END                             E*2            E12365
      *                                                                   CAC001
     C           TSKEY2    TAG                                            CAC001
     C                     MOVE '1'       *IN50            *1
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C137                                           S01408
      *                                                                   S01408
     C                     WRITEMM0089S0                   *1
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP13                                           S01408
     C*                                                                   S01408
     C                     WRITEMM0089D3                   *1             S01199
     C                     WRITEMM0089D0                   *1
     C*********************READ MM0089S0                 60*1             S01199
     C/COPY WNCPYSRC,MM0089C211
     C                     READ MM0089D3                 60*1             S01199
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP12                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP14                                           S01408
     C*                                                                   S01408
      **  Do not clear messages if F19 was pressed                        CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ *OFF                                      CAC001
     C                     CALL 'ZA0250'                   *1
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C/COPY WNCPYSRC,MM0089C179
     C                     MOVE '0'       *IN50            *1
     C/COPY WNCPYSRC,MM0089C180
     C                     MOVE '1'       *IN41            *1
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CCP5                                           S01408
      *                                                                   S01408
     C           *INKL     IFEQ '1'                        B*2
     C/COPY WNCPYSRC,MM0089C212
     C                     MOVE '0'       *INKL            **2
     C/COPY WNCPYSRC,MM0089C213
     C*                                                                   S01177
     C**  if this SR was called via SELECT processing and F12 has been    S01177
     C**  pressed in response to prompt, reset ACTION CODE to 'E'         S01177
     C************IN35     IFEQ '1'                        B**3    S01177 136728
     C           WIN35     IFEQ '1'                        B**3           136728
     C                     MOVE 'E'       DDACTN           ***3           S01177
     C***********          SETOF                     35    E**3    S01177 136728
     C                     MOVEL'0'       WIN35   1        E**3           136728
     C                     END                             E**3           S01177
     C*                                                                   S01177
     C                     GOTO #ZG9                       **2
     C                     ELSE                            X*2            S01241
      *                                                                   CAC001
      **  If Analytical Accounting is installed and F19 pressed, set up   CAC001
      **  parameters for window manager                                   CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                                       CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
     C           *INKT     ANDEQ*ON                                       CAC001
     C                     MOVE 'KT'      KEY                             CAC001
     C                     MOVE *BLANKS   WTPRC                           CAC001
      *                                                                   CAC001
     C           DDACTN    IFEQ 'A'                                       CAC001
     C                     MOVE 'A'       WACTN                           CAC001
     C                     MOVE HKDSTS    WDSTS                           CAC001
     C                     MOVE DDPRFC    WPRFC                           CAC001
     C                     MOVE DDCCY     WCCY                            CAC001
     C                     MOVE BJLCCY    WLCCY                           CAC001
     C                     MOVE 'N'       WRATF                           CAC001
     C                     Z-ADDHKINTR    WINTR                           CAC001
     C                     MOVE 'N'       WFRC                            CAC001
      *                                                                   CAC001
     C                     ELSE                                           CAC001
     C           DDACTN    IFEQ 'X'                                       CAC001
     C                     MOVE 'E'       WACTN                           CAC001
     C                     MOVE 'D'       WDSTS                           CAC001
     C                     Z-ADD0         WINTR                           CAC001
     C                     MOVE *BLANKS   WPRFC                           CAC001
     C                     MOVE *BLANKS   WCCY                            CAC001
     C                     MOVE *BLANKS   WLCCY                           CAC001
     C                     MOVE *BLANKS   WRATF                           CAC001
     C                     MOVE 'N'       WFRC                            CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,MM0089C405
      *                                                                   CAC001
      **  Call window manager WN0010 for the optional window              CAC001
      *                                                                   CAC001
     C                     CALL 'WN0010'                                  CAC001
     C                     PARM 'MM0089  '#PGM   10                       CAC001
     C                     PARM           KEY     2                       CAC001
     C                     PARM DDACTN    ACTION  1                       CAC001
     C                     PARM           DATA                            CAC001
     C                     PARM *BLANKS   #RTRN   7                       CAC001
     C                     PARM           SPARE 256                       CAC001
      *                                                                   CAC001
      **  Check return code                                               CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
     C           #RTRN     WHEQ 'Y2U9999'                                 CAC001
     C                     MOVE '1'       *INKC                           CAC001
     C                     GOTO #ZG9                                      CAC001
     C           #RTRN     WHNE *BLANKS                                   CAC001
     C           #RTRN     ANDNE'USR0790'                                 CAC001
     C/COPY WNCPYSRC,MM0089C384
     C                     CALL 'SNDERMSG'                                CAC001
     C                     PARM 'MM0089'  ZAPGM  10        Program queue  CAC001
     C                     PARM           ZAPGRL  5        Rel queue      CAC001
     C                     PARM #RTRN     ZAMSID  7        Msg Id.        CAC001
     C                     PARM 'WNMSGF'  ZAMSGF 10        Msg file.      CAC001
     C                     PARM           ZAMSDA132        Message data.  CAC001
     C                     PARM           ZAMSTP  7        Message type.  CAC001
     C/COPY WNCPYSRC,MM0089C385
      *                                                                   CAC001
      **  Clear all fields                                                CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    ZAPGM            Program queue  CAC001
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      CAC001
     C                     MOVEL*BLANK    ZAMSID           Message Id.    CAC001
     C                     MOVEL*BLANK    ZAMSGF           Message file.  CAC001
     C                     MOVEL*BLANK    ZAMSDA           Message data.  CAC001
     C                     MOVEL*BLANK    ZAMSTP           Message type.  CAC001
      *                                                                   CAC001
      **  If ENTER pressed from window, store funding info fields to      CAC001
      **  standard deals if insert or amend of unauthorised deal          CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ *BLANKS                                   CAC001
     C           DDACTN    IFEQ 'I'                                       CAC001
     C           DDACTN    OREQ 'A'                                       CAC001
     C           IKDSTS    ANDNE'A'                                       CAC001
     C                     Z-ADDWFSRP     IKFSRP                          CAC001
     C                     MOVE WFSGN     IKFSGN                          CAC001
     C                     MOVE WFPRC     IKFPRC                          CAC001
     C                     Z-ADDIKDVSD    IKFCTD                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDSL                                          CAC001
     C/COPY WNCPYSRC,MM0089C507
     C                     GOTO TSKEY2                                    CAC001
     C                     ENDIF                                          CAC001
      *===================================================================S01241
      *    WINDOW PROCESSING                                              S01241
      *                                                                   S01241
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,MM0089MOV2                                           S01241
      *                                                                   S01241
     C           DDACTN    IFEQ 'X'                                       059667
     C                     EXSR #BE                                       059667
     C                     MOVE '0'       *INL1                           121483
     C                     EXSR #ZI                                       121483
      *                                                                   087923
      * IF F3 TAKEN, EXIT PGM                                             087923
     C           *INKC     IFEQ *ON                                       087923
     C                     EXSR #C                                        087923
     C                     END                                            087923
      *                                                                   087923
     C/COPY WNCPYSRC,MM0089C351
     C           PMERCD    IFNE *BLANKS                                   121483
     C                     GOTO #ZG9                                      121483
     C                     ELSE                                           121483
     C           *IN55     IFEQ '1'                                       059667
     C                     MOVEL'MMM1030' @MSGID                          059667
     C                     CALL 'ZA0440'                                  059667
     C                     PARM           @MSGID                          059667
     C                     PARM           @DATA                           059667
     C                     ELSE                                           059667
     C                     MOVEL'MMM1036' @MSGID                          059667
     C                     CALL 'ZA0250'                                  059667
     C                     CALL 'ZA0440'                                  059667
     C                     PARM           @MSGID                          059667
     C                     PARM           @DATA                           059667
     C                     END                                            059667
     C                     END                                            121483
     C/COPY WNCPYSRC,MM0089CP67                                           S01408
     C*                                                                   S01408
     C                     WRITEMM0089S0                                  059667
     C                     WRITEMM0089D2                                  059667
     C                     WRITEMM0089D0                                  059667
     C/COPY WNCPYSRC,MM0089C214
     C                     READ MM0089D0                 60               059667
     C/COPY WNCPYSRC,MM0089CP68                                           S01408
     C*                                                                   S01408
      *                                                                   087923
      * IF F3 TAKEN, EXIT PGM                                             087923
     C           *INKC     IFEQ *ON                                       087923
     C                     EXSR #C                                        087923
     C                     END                                            087923
      *                                                                   087923
     C                     CALL 'ZA0250'                                  059667
     C/COPY WNCPYSRC,MM0089C181
     C                     MOVE '0'       *IN50                           059667
     C/COPY WNCPYSRC,MM0089C182
     C                     MOVE '1'       *IN41                           059667
     C/COPY WNCPYSRC,MM0089C215
     C           *INKL     IFEQ '1'                                       059667
     C                     MOVE '0'       *INKL                           059667
     C*                                                                   059667
     C** If this subroutine was called via select processing              059667
     C** and F12 has been pressed in response to auth. prompt,            059667
     C** reset action code to 'E'.                                        059667
     C*                                                                   059667
     C************IN35     IFEQ '1'                                059667 136728
     C           WIN35     IFEQ '1'                                       136728
     C                     MOVE 'E'       DDACTN                          059667
     C***********          SETOF                     35            059667 136728
     C                     MOVEL'0'       WIN35                           136728
     C                     END                                            059667
     C*                                                                   059667
     C                     EXCPT@RLSFL                                    059667
     C                     GOTO #ZG9                                      059667
     C                     END                                            059667
     C                     END                                            059667
     C/COPY WNCPYSRC,MM0089C046
     C                     EXSR #WIND                      **2            S01241
     C/COPY WNCPYSRC,MM0089C047
     C***********#RTRN     IFEQ 'USR0790'                  B**3     S01241E22219
     C           #RTRN     IFNE *BLANKS                    B**3     S01241E22219
     C                     GOTO #ZG9                       ***3           S01241
     C                     END                             E**3           S01241
     C/COPY WNCPYSRC,MM0089C064
     C                     END                             E*2
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CCP9                                           S01408
      *                                                                   S01408
      *                                                                   S01241
     C                     ELSE                            X1             S01241
      *                                                                   S01241
      *    WINDOW PROCESSING                                              S01241
      *                                                                   S01241
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,MM0089MOV3                                           S01241
      *                                                                   S01241
     C/COPY WNCPYSRC,MM0089C073
     C                     EXSR #WIND                      **1            S01241
     C/COPY WNCPYSRC,MM0089C395
     C***********#RTRN     IFEQ 'USR0790'                  B**3     S01241E22219
     C           #RTRN     IFNE *BLANKS                    B**3     S01241E22219
     C/COPY WNCPYSRC,MM0089C522
     C                     GOTO #ZG9                       ***2           S01241
     C                     END                             E**2           S01241
      *                                                                   S01241
      *===================================================================S01241
     C                     END                             E1
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CPG3                                           S01408
      *                                                                   S01408
     C                     END                                            054889
     C/COPY WNCPYSRC,MM0089C183
     C*                                                                   E18139
     C**  Enable user to input next deal details while files are          E18139
     C**  being updated for deal just entered                             E18139
     C*                                                                   E18139
     C**  Blank screen fields                                             E18139
     C                     EXSR #ZE                                       E18139
     C*                                                                   E18139
     C**  Reset error processing                                          E18139
     C                     EXSR #ZA                                       E18139
     C/COPY WNCPYSRC,MM0089C216
     C*                                                                   E18139
     C**  Write input screen                                              E18139
     C*                                                                   E20989
     C*   Bypass if in range authorisation or if called through F15       E20989
     C* processing (@@@BPS = 'Y')                                         E20989
     C           @@@BPS    IFNE 'Y'                                       E20989
      *                                                                   E20989
     C/COPY WNCPYSRC,MM0089CP69                                           S01408
     C*                                                                   S01408
      **  Retrieve time and place in screen field.                        E20989
     C                     TIME           DDTIME                          E20989
      *                                                                   E20989
     C/COPY WNCPYSRC,MM0089C048
     C                     WRITEMM0089S0                                  E18139
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP13                                           S01408
     C*                                                                   S01408
     C                     WRITEMM0089D3                                  S01199
     C                     WRITEMM0089D0                                  E18139
     C/COPY WNCPYSRC,MM0089C352
     C*                                                                   E18139
     C***********          SETON                     57            E18139 136728
     C                     MOVEL'1'       WIN57                           136728
     C*                                                                   E20989
     C/COPY WNCPYSRC,MM0089CP70                                           S01408
     C*                                                                   S01408
     C                     END                                            E20989
     C/COPY WNCPYSRC,MM0089C184
     C                     MOVE *BLANKS   @@@BPS                          E20989
     C*                                                                   AUS007
     C** Update FORAT file if BKRAT is to be updated in further           AUS007
     C** processing - i.e. when deal authorised                           AUS007
     C*                                                                   AUS007
     C           AUS007    IFEQ 'Y'                                       AUS007
     C           @@RACD    IFNE *BLANKS                                   AUS007
     C           IKDN38    CHAINFORAT                65                   AUS007
     C           *IN65     IFEQ '0'                                       AUS007
     C                     MOVE @@RACD    RACD                            AUS007
     C                     MOVE IKDN38    DLNO                            AUS007
     C           DDACTN    IFEQ 'D'                                       AUS007
     C                     MOVE 'R'       RECI                            AUS007
     C                     ELSE                                           AUS007
     C                     MOVE 'D'       RECI                            AUS007
     C                     END                                            AUS007
     C                     UPDATFORATAAF                                  AUS007
     C                     ELSE                                           AUS007
     C                     MOVE @@RACD    RACD                            AUS007
     C                     MOVE IKDN38    DLNO                            AUS007
     C                     Z-ADD0         BACD                            AUS007
     C                     Z-ADD0         BRPD                            AUS007
     C                     Z-ADD0         BAPD                            AUS007
     C                     MOVE 'D'       RECI                            AUS007
     C                     WRITEFORATAAF                                  AUS007
     C                     END                                            AUS007
     C                     END                                            AUS007
     C                     END                                            AUS007
     C/COPY WNCPYSRC,MM0089C145
     C*
     C**  Update the front office files.
     C                     EXSR ZTNLU1
     C*                                                                   S01408
     C** Core hook for externalisation,                                   S01408
     C/COPY WNCPYSRC,MM0089CBDU                                           S01408
     C*                                                                   S01408
     C                     CALL 'MM0078'
     C***********          PARM           @TERM                           DT0010
     C                     PARM           @TERM   1                       DT0010
     C*********************PARM*'B'*******@BOF****************************S01319
     C                     PARM 'L'       @TDIN
     C                     PARM           @SLDS
     C                     PARM           @SSDS
     C                     PARM           @SBDS
     C                     PARM           @SADS
     C                     PARM           Z#BSTS                          082738
     C                     PARM           Z#ASTS                          082738
     C                     PARM           Z#WSTS                          082738
     C/COPY WNCPYSRC,MM0089C518
     C           @TERM     IFEQ 'E'                        B1
     C           @TERM1    IFNE 'R'                                       S01434
     C                     ROLBK                           *1
     C                     END                                            S01434
     C                     MOVE '1'       *INKC            *1
     C                     EXSR #C                         *1
     C                     END                             E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C116                                           S01408
     C*                                                                   S01408
     C*
     C**  Remove COMIT so that DRS-MIDAS updates done in same comit cycle E14354
     C***********                                                         E14354
     C****Commit the file updates.                                        E14354
     C***********CMTTXT    COMIT
     C*
     C** Set up parameter to tell AOOUMMU0 that Auto Rollover Program     082738
     C** MM5310 is calling this program. MM5310 calls this program with   082738
     C** 'R' in parameter @TERM1. Pass this value to AOOUMMU0 which is    082738
     C** called by MM0083 in parameter @@AURO.                            082738
     C                     MOVE @TERM1    @@AURO  1                       082738
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP64                                           S01408
     C*                                                                   S01408
     C*
     C**  Update the MIDAS files.
     C*********************CALL 'MM0082'                                  082738
     C                     CALL 'MM0083'                                  082738
     C                     PARM           @TERM
     C                     PARM 'L'       @TDIN                           S01319
     C                     PARM           @SLDS                           S01319
     C                     PARM           @SSDS                           S01319
     C                     PARM           @SBDS                           S01319
     C                     PARM           @SADS                           S01319
     C                     PARM           @@RACD                          AUS007
     C                     PARM           Z#BSTS                          082738
     C                     PARM           Z#ASTS                          082738
     C                     PARM           Z#WSTS                          082738
     C                     PARM           @@AURO                          082738
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C130                                           S01408
      *                                                                   S01408
     C           @TERM     IFEQ 'E'                        B1
     C           @TERM1    IFNE 'R'                                       S01434
     C                     ROLBK                           *1
     C                     END                                            S01434
     C                     MOVE '1'       *INKC            *1
     C                     EXSR #C                         *1
     C                     END                             E1
      *
     C/COPY WNCPYSRC,MM0089C154
      *
      *                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP49                                           S01408
      *                                                                   S01408
     C*
     C**  Commit the file updates.
     C           @TERM1    IFNE 'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C244
     C           CMTTXT    COMIT
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP81                                           S01408
      *                                                                   S01408
     C                     ELSE                                           S01434
     C                     MOVE 'Y'       RTRN                            S01434
     C                     END                                            S01434
     C/COPY WNCPYSRC,MM0089C234
     C*
     C****Set up successful file maintenance message.                     E18139
     C******               MOVE *BLANKS   @DATA                           E18139
     C******               MOVEL@TXT,1    @DATA1                          E18139
     C******               MOVELDDDLNO    @DATA2                          E18139
     C******                                                              E18139
     C****If action code is A, record has been amended.                   E18139
     C******     DDACTN    IFEQ 'A'                        B1             E18139
     C******               MOVEL'MMM1016' @MSGID           *1             E18139
     C******               END                             E1             E18139
     C******                                                              E18139
     C****If action code is D, record has been deleted.                   E18139
     C******     DDACTN    IFEQ 'D'                        B1             E18139
     C******               MOVEL'MMM1017' @MSGID           *1             E18139
     C******               END                             E1             E18139
     C******                                                              E18139
     C****If action code is I, record has been inserted.                  E18139
     C******     DDACTN    IFEQ 'I'                        B1             E18139
     C******               MOVEL'MMM1018' @MSGID           *1             E18139
     C******               END                             E1             E18139
     C******                                                              E18139
     C****If action code is X, record has been authorized                 E18139
     C******     DDACTN    IFEQ 'X'                        B1             E18139
     C******               MOVEL'MMM1027' @MSGID           *1             E18139
     C******               END                             E1             E18139
     C******                                                              E18139
     C****Blank screen fields.                                            E18139
     C******               EXSR #ZE                                       E18139
     C******                                                              E18139
     C****Reset error processing.                                         E18139
     C******               EXSR #ZA                                       E18139
     C******                                                              E18139
     C****Send successful file maintenance message.                       E18139
     C******               CALL 'ZA0440'                                  E18139
     C******               PARM           @MSGID                          E18139
     C******               PARM           @DATA                           E18139
     C*
      **  Blank standard deal fields                                      E18139
     C                     EXSR #ZEA                                      E18139
     C*                                                                   E18139
      * S01227 - Set up flag for use by Extended Settlements              S01227
     C                     MOVE 'Y'       PMFRST                          S01227
     C*
     C*                                                                   S01434
     C           @TERM1    IFEQ 'R'                                       S01434
     C                     MOVE '1'       *INKC                           S01434
     C                     END                                            S01434
     C/COPY WNCPYSRC,MM0089C353
     C*                                                                   S01434
     C           #ZG9      ENDSR                           **#ZG9**
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP82                                           S01408
      *                                                                   S01408
      /EJECT
     C*****************************************************************   AUS003
     C*                                                               *   AUS003
     C* AMDFRQ   - Set next Interest date to current moth for         *   AUS003
     C*            amendment of freq. to 'N'                          *   AUS003
     C*                                                               *   AUS003
     C* CALLS    IDATE1   - Set next interest date for frequency 'N'  *   AUS003
     C*                     to last date of the month                 *   AUS003
     C***********ZA0710***-*Convert*Midas*day*number*to*YMD*date****AUS003056095
     C*          ZDATE9   - Convert Midas day number to YMD date      *   056095
     C*          ZA0770   - YYYYMMDD to MMDDYY or DDMMYY conversion.  *   AUS003
     C*                                                               *   AUS003
     C* CALLED BY  #ZI    - Validates the screen input for I,A and X. *   AUS003
     C*                                                               *   AUS003
     C*                                                               *   AUS003
     C*****************************************************************   AUS003
     C*                                                                   AUS003
     C           AMDFRQ    BEGSR                                          AUS003
     C                     Z-ADDBJRDNB    @@DAYN                          AUS003
     C***********          EXSR ZA0710                              AUS003056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     @@DTIN                          AUS003
     C                     EXSR ZA0770                                    AUS003
     C                     MOVE @@DTOU    DMMYXX                          AUS003
     C                     EXSR IDATE1                                    AUS003
     C                     ENDSR                                          AUS003
      /EJECT                                                              AUS003
     C*****************************************************************   AUS003
     C*                                                               *   AUS003
     C* IDATE1   - Set next Interest date For Frequency 'N' to last   *   AUS003
     C*            date of current month                              *   AUS003
     C*                                                               *   AUS003
     C* CALLED BY  #ZI    - Validates the screen input for I,A and X. *   AUS003
     C*            AMDFRQ - Set next Interest date to current month   *   AUS003
     C*                     for amendment of freq. to 'N'             *   AUS003
     C*                                                               *   AUS003
     C*****************************************************************   AUS003
     C*                                                                   AUS003
     C           IDATE1    BEGSR                                          AUS003
     C*                                                                   AUS003
     C                     MOVE DMMYXX    DATEW1  40                      AUS003
     C                     MOVE DMMYXX    DATEW2  20                      AUS003
     C                     MOVELDATEW1    MT      20                      AUS003
     C                     MOVE @M,MT     MT1     20                      AUS003
     C           MT        IFEQ 2                                         AUS003
     C           DATEW2    DIV  4         YR1     20                      AUS003
     C                     MVR            YR2     20                      AUS003
     C           YR2       IFEQ 0                                         AUS003
     C                     Z-ADD29        MT1                             AUS003
     C                     END                                            AUS003
     C                     END                                            AUS003
     C                     MOVE DATEW1    DDNDAT                          AUS003
     C                     MOVELMT1       DDNDAT                          AUS003
     C                     ENDSR                                          AUS003
      /EJECT                                                              AUS003
     C*****************************************************************
     C*                                                               *
     C* #BDAA    - Processing for insert of new record.               *
     C*                                                               *
     C* CALLS    #ZA      - Resets screen error indicators and MSGQ.  *
     C*          #ZE      - Clears all screen fields.                 *
     C*          #ZEA     - Clear standard deal                       *   E18139
     C*          #ZJ      - Move screen fields into standard deal fmt.*
     C*          MM0078   - Update front office data base.            *
     C***********MM0082***-*Update*back*office*data*base.             *   082738
     C*          MM0083   - Update back office data base.             *   082738
     C*          ZA0250   - Clears error message queue.               *
     C*          ZA0250   - Clears error message queue.               *
     C*          ZA0440   - Sends a msg with data to the pgm msg queue*
     C*                                                               *
     C* CALLED BY  #BDA   - Enter processing for action code I.       *
     C*                                                               *
     C* FLDS USED  @DATA  - DS to set up data for screen messages.    *
     C*            @MSGID - Message id field.                         *
     C*            @DLDS  - DS with format of MMDELDPP                *
     C*            @TERM  - Termination parameter.                    *
     C*************@BOF***-*Called*from*back*office*field.****************S01319
     C*            @TDIN  - This deal indicator.                      *
     C*            @SLDS  - Data structure with MMSTDLPP format.      *
     C*            @SSDS  - Standard deal DS based on N.A.s sold.     *
     C*            @SBDS  - Standard deal DS based on N.A.s bought.   *
     C*            @SADS  - Standard deal DS based on DEAMS.          *
     C*            @TXT   - Field holding 'Deal Number' text.         *
     C*            @DATA1 - Sub-field of @DATA.                       *
     C*            @DATA2 - Sub-field of @DATA.                       *
     C*            WTCCY  - Temporary stored version of DDCCY.        *   057977
     C*            WTBRAT - Temporary stored version of DDBRAT.       *   057977
     C*            WINKL  - Sets to '1' if F12 was pressed after the  *   057977
     C*                     validation of the Extended Settlements.   *   057977
     C*                                                               *
     C*****************************************************************
     C           #BDAA     BEGSR
     C/COPY WNCPYSRC,MM0089C065
     C*
     C**  Send a confirmation message.
     C                     MOVE *BLANKS   @DATA
     C                     MOVEL'insert'  @DATA
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CCP4                                           S01408
      *                                                                   S01408
     C           *IN55     IFEQ '1'                        B1             E12365
     C                     MOVEL'MMM1039' @MSGID           *1             E12365
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C115                                           S01408
     C*                                                                   S01408
     C                     CALL 'ZA0440'                   *1             E12365
     C                     PARM           @MSGID           *1             E12365
     C                     PARM           @DATA            *1             E12365
     C                     ELSE                            X1             E12365
     C                     MOVEL'MMM1036' @MSGID           *1
     C                     CALL 'ZA0250'                   *1
     C                     CALL 'ZA0440'                   *1
     C                     PARM           @MSGID           *1
     C                     PARM           @DATA            *1
     C                     END                             E1             E12365
     C*                                                                   S01408
     C** Core hook for externalisation,                                   S01408
     C/COPY WNCPYSRC,MM0089CICE                                           S01408
     C*                                                                   S01408
     C           TSKEY1    TAG                                            CAC001
     C                     MOVE '1'       *IN50
     C**  Do not display FEEDBACK information (or DELETED)                S01184
     C                     MOVE '1'       *IN94                           S01184
     C                     MOVE '0'       *IN39                           S01184
     C/COPY WNCPYSRC,MM0089C495
     C                     WRITEMM0089S0
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP13                                           S01408
     C*                                                                   S01408
     C                     WRITEMM0089D3                                  S01199
     C                     WRITEMM0089D0
     C*********************READ MM0089S0                 60               S01199
     C                     READ MM0089D3                 60               S01199
     C/COPY WNCPYSRC,MM0089C264                                           S01408
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP14                                           S01408
     C*                                                                   S01408
      **  Do not clear messages when window disappears and previous       CAC001
      **  screen restored                                                 CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ *OFF                                      CAC001
     C           WLOOP     ANDEQ*BLANKS                                   CAC001
     C           *INKL     OREQ *ON                                       CAC001
     C                     CALL 'ZA0250'
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C/COPY WNCPYSRC,MM0089C185
     C                     MOVE '0'       *IN50
     C/COPY WNCPYSRC,MM0089C186
     C                     MOVE '0'       *IN94                           S01184
     C************INKL     CABEQ'1'       #BDAA9                          057977
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CPG6                                           S01408
      *                                                                   S01408
     C*                                                                   057977
     C**  If F12 was pressed after the Extended Settlement Screen         057977
     C**  validation set on @INKL to activate the checking whether        057977
     C**  the deal currency was changed.                                  057977
     C*                                                                   057977
     C           *INKL     IFEQ '1'                                       S01443
     C/COPY WNCPYSRC,MM0089C540
     C                     MOVE '0'       *IN20                           S01443
     C                     MOVE '0'       *IN55                           S01443
     C                     END                                            S01443
     C*                                                                   S01443
     C           *INKL     IFEQ '1'                                       057977
     C                     MOVE '1'       WINKL   1                       057977
     C                     MOVE DDCCY     WTCCY   3                       057977
     C                     MOVE DDBRAT    WTBRAT 13                       057977
     C                     GOTO #BDAA9                                    057977
     C                     END                                            057977
      *                                                                   CAC001
      **  If Analytical Accounting is installed and F19 pressed, set up   CAC001
      **  parameters for window manager                                   CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                                       CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
     C           *INKT     IFEQ *ON                                       CAC001
     C           DDSPRT    ORNE WSSPRT                                    CAC001
     C           WFPRC     ANDNE*BLANKS                                   CAC001
     C           DDBSRC    ORNE WSBSRC                                    CAC001
     C           WFPRC     ANDNE*BLANKS                                   CAC001
     C                     MOVE 'KT'      KEY                             CAC001
     C                     MOVE 'I'       WACTN                           CAC001
     C                     MOVE 'D'       WDSTS                           CAC001
     C                     Z-ADDIKINTR    WINTR                           CAC001
     C                     MOVE DDPRFC    WPRFC                           CAC001
     C                     MOVE DDCCY     WCCY                            CAC001
     C                     MOVE BJLCCY    WLCCY                           CAC001
     C                     MOVE 'N'       WRATF                           CAC001
     C                     MOVE *BLANKS   WTPRC                           CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ *ON                                       CAC001
     C                     MOVE 'N'       WFRC                            CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'Y'       WFRC                            CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,MM0089C406
      *                                                                   CAC001
      **  Call window manager WN0010 for the optional window              CAC001
      *                                                                   CAC001
     C                     CALL 'WN0010'                                  CAC001
     C                     PARM 'MM0089  '#PGM   10                       CAC001
     C                     PARM           KEY     2                       CAC001
     C                     PARM DDACTN    ACTION  1                       CAC001
     C                     PARM           DATA                            CAC001
     C                     PARM *BLANKS   #RTRN   7                       CAC001
     C                     PARM           SPARE 256                       CAC001
      *                                                                   CAC001
      **  Check return code                                               CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
     C           #RTRN     WHEQ 'Y2U9999'                                 CAC001
     C                     MOVE '1'       *INKC                           CAC001
     C                     GOTO #BDAA9                                    CAC001
     C           #RTRN     WHNE *BLANKS                                   CAC001
     C           #RTRN     ANDNE'USR0790'                                 CAC001
     C/COPY WNCPYSRC,MM0089C386
     C                     CALL 'SNDERMSG'                                CAC001
     C                     PARM 'MM0089'  ZAPGM  10        Program queue  CAC001
     C                     PARM           ZAPGRL  5        Rel queue      CAC001
     C                     PARM #RTRN     ZAMSID  7        Msg Id.        CAC001
     C                     PARM 'WNMSGF'  ZAMSGF 10        Msg file.      CAC001
     C                     PARM           ZAMSDA132        Message data.  CAC001
     C                     PARM           ZAMSTP  7        Message type.  CAC001
     C/COPY WNCPYSRC,MM0089C387
      *                                                                   CAC001
      **  Clear all fields                                                CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    ZAPGM            Program queue  CAC001
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      CAC001
     C                     MOVEL*BLANK    ZAMSID           Message Id.    CAC001
     C                     MOVEL*BLANK    ZAMSGF           Message file.  CAC001
     C                     MOVEL*BLANK    ZAMSDA           Message data.  CAC001
     C                     MOVEL*BLANK    ZAMSTP           Message type.  CAC001
      *                                                                   CAC001
      **  If ENTER pressed from window, store funding info fields to      CAC001
      **  standard deals                                                  CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ *BLANKS                                   CAC001
     C                     Z-ADDWFSRP     IKFSRP                          CAC001
     C                     MOVE WFSGN     IKFSGN                          CAC001
     C                     MOVE WFPRC     IKFPRC                          CAC001
     C                     Z-ADDIKDVSD    IKFCTD                          CAC001
      *                                                                   CAC001
      **  Save spread/rate and base rate code for checking of possible    CAC001
      **  of possible change later                                        CAC001
      *                                                                   CAC001
     C                     MOVE DDSPRT    WSSPRT                          CAC001
     C                     MOVE DDBSRC    WSBSRC                          CAC001
     C                     ENDSL                                          CAC001
     C/COPY WNCPYSRC,MM0089C508
      *                                                                   CAC001
      **  If window was not forced or F12 was pressed from window,        CAC001
      **  test command key again                                          CAC001
      *                                                                   CAC001
     C           WFRC      IFEQ 'N'                                       CAC001
     C           #RTRN     OREQ 'USR0790'                                 CAC001
     C                     MOVE 'Y'       WLOOP   1                       CAC001
     C                     GOTO TSKEY1                                    CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   S01408
     C** Core hook for externalisation,                                   S01408
     C/COPY WNCPYSRC,MM0089CICS                                           S01408
     C*
     C**  Blank out the record for output.
     C                     MOVE *BLANKS   @DLDS
     C                     Z-ADD0         HKDLUP
     C                     Z-ADD0         HKYLUP
     C                     Z-ADD0         HKTLUP
     C                     Z-ADD0         HKLCD
     C                     Z-ADD0         HKCYDP
     C                     Z-ADD0         HKVDYY
     C                     Z-ADD0         HKVDMM
     C                     Z-ADD0         HKVDDD
     C                     Z-ADD0         HKDTYY
     C                     Z-ADD0         HKDTMM
     C                     Z-ADD0         HKDTDD
     C**********           Z-ADD0         HKCNUM                                             CSD027A
     C                     MOVE *BLANKS   HKCNUM                                             CSD027A
     C                     Z-ADD0         HKAMNP
     C                     Z-ADD0         HKINTR
     C*****                Z-ADD0         HKBRCD                          S01117
     C                     Z-ADD0         HKDDYY
     C                     Z-ADD0         HKDDMM
     C                     Z-ADD0         HKDDDD
     C                     Z-ADD0         HKBRKG
     C                     Z-ADD0         HKBCDP
     C                     Z-ADD0         HKPCTN
     C                     Z-ADD0         HKTIME
     C                     Z-ADD0         HKLDAT
     C                     Z-ADD0         HKSLYY
     C                     Z-ADD0         HKSLMM
     C                     Z-ADD0         HKSLDD
     C                     Z-ADD0         HKSPRD
     C                     Z-ADD0         HKIIRT
     C                     Z-ADD0         HKNIYY
     C                     Z-ADD0         HKNIMM
     C                     Z-ADD0         HKNIDD
     C                     Z-ADD0         HKIPDM
     C                     Z-ADD0         HKACSQ
     C                     Z-ADD0         HKMTTI
     C**********           Z-ADD0         HKMCDH                                             CSD027A
     C                     MOVE *BLANKS   HKMCDH                                             CSD027A
     C                     Z-ADD0         HKIAYY
     C                     Z-ADD0         HKIAMM
     C                     Z-ADD0         HKIADD
     C                     Z-ADD0         HKMDYY
     C                     Z-ADD0         HKMDMM
     C                     Z-ADD0         HKMDDD
     C                     Z-ADD0         HKNTCE
     C                     Z-ADD0         HKFCLY
     C                     Z-ADD0         HKIMAT
     C                     Z-ADD0         HKBRAT
     C                     Z-ADD0         HKORCM
     C                     Z-ADD0         HKMOPM
     C                     Z-ADD0         HKLNKN                          S01165
     C                     Z-ADD0         HKRSTM                          S01177
     C**********           Z-ADD0         HKROBN                                      S01177 CSD027A
     C**********           Z-ADD0         HKROCN                                      S01177 CSD027A
     C                     MOVE *BLANKS   HKROBN                                             CSD027A
     C                     MOVE *BLANKS   HKROCN                                             CSD027A
     C                     Z-ADD0         HKPSTM                          S01177
     C**********           Z-ADD0         HKPOBN                                      S01177 CSD027A
     C**********           Z-ADD0         HKPOCN                                      S01177 CSD027A
     C                     MOVE *BLANKS   HKPOBN                                             CSD027A
     C                     MOVE *BLANKS   HKPOCN                                             CSD027A
     C*
     C**  Move '*' into the logical delete flag.
     C                     MOVE '*'       HKDLTF
     C/COPY WNCPYSRC,MM0089C217
     C*                                                                   E19346
     C           DDACTN    IFEQ 'I'                        B1             E19346
     C           @AUTO     ANDEQ'Y'                        B1             E19346
     C/COPY WNCPYSRC,MM0089C235
     C           DDDLNO    IFEQ *BLANKS                    B*2            E19346
     C           DDDLNO    OREQ *ZEROS                     **2            E19346
     C/COPY WNCPYSRC,MM0089C187
     C**  Check for a live record on CADLFALL.                            E19346
     C           *IN65     DOUEQ'0'                        B**3           E19346
     C           1         SETLLCADLFALL                   ***3           E19346
     C                     READ CADLFALL                 65***3           E19346
     C*                                                                   E19346
     C**  If a live record is found, delete it.                           E19346
     C           *IN65     IFEQ '0'                        B***4          E19346
     C                     DELETCADLFAP0                   ****4          E19346
     C*                                                                   E19346
     C**  Otherwise, call the regeneration program.                       E19346
     C                     ELSE                            X***4          E19346
     C                     CALL 'CA0040'                   ****4          E19346
     C                     PARM           @TERM            ****4          E19346
     C*                                                                   E19346
     C**  If an error occurs in the called program, perform a rollback,   E19346
     C**  and by-pass all further processing.                             E19346
     C           @TERM     IFEQ 'E'                        B****5         E19346
     C           @TERM1    IFNE 'R'                                       S01434
     C                     ROLBK                           *****5         E19346
     C                     END                                            S01434
     C***********          MOVE '1'       *INKC                    E19346 043277
     C***********          EXSR #C                         *****5  E19346 043277
     C                     MOVE '1'       *IN02            *****5         043277
     C                     MOVE '1'       *IN41            *****5         043277
     C                     MOVE '0'       *IN55            *****5         S01443
     C                     MOVE '0'       *IN20            *****5         S01443
     C                     MOVE ' '       @TERM            *****5         043277
     C                     CALL 'ZA0240'                   *****5         043277
     C                     PARM 'MMM0145' @MSGID           *****5         043277
     C                     GOTO #BDAA9                     *****5         043277
     C                     END                             E****5         E19346
     C                     END                             E***4          E19346
     C                     END                             E**3           E19346
     C/COPY WNCPYSRC,MM0089C188
     C*                                                                   E19346
     C**  Set up the generated Deal No. in the insert message field.      E19346
     C                     MOVE FKDN38    DDSIMG  60       **2            E19346
     C                     END                             E*2            E19346
     C/COPY WNCPYSRC,MM0089C236
     C                     END                             E1             E19346
     C*
     C/COPY WNCPYSRC,MM0089C112                                           S01408
     C**  Set up the deal number.
     C************         MOVE DDDLNO    HKDN38                          E19346
     C           @AUTO     IFEQ 'Y'                                       E20041
     C                     MOVE DDSIMG    HKDN38                          E19346
     C                     ELSE                                           E20041
     C                     MOVE DDDLNO    HKDN38                          E20041
     C                     END                                            E20041
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CCP8                                           S01408
      *
      *
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,MM0089MOV4                                           S01241
     C/COPY WNCPYSRC,MM0089C396
      *                                                                   S01241
     C                     EXSR #WIND                      *1             S01241
     C/COPY WNCPYSRC,MM0089C397
     C***********#RTRN     IFEQ 'USR0790'                  B*2      S01241E22219
     C           #RTRN     IFNE *BLANKS                    B*2      S01241E22219
     C/COPY WNCPYSRC,MM0089C407
     C                     GOTO #BDAA9                     **2            S01241
     C                     END                             E*2            S01241
     C**                                                                  S01408
     C/COPY WNCPYSRC,MM0089CPG4                                           S01408
     C*                                                                   S01408
     C*
     C**  Write the new record to reserve one position in the file.
     C*****************    WRITEMMDLDUP0                                  107546
     C                     Z-ADD0         HKBCAM                                              CLE025
     C                     WRITEMMDLDUP0               79                 107546
     C** If the write is unsuccessful it is most likely because the       107546
     C** deal number already exists so send message to say this.          107546
     C           *IN79     IFEQ '1'                                       107546
     C*                                                                   107546
     C**  Clear program message queue.                                    107546
     C                     CALL 'ZA0250'                                  107546
     C*                                                                   107546
     C** Send message - 'Record inserted by another workstation.'         107546
     C                     MOVE '1'       *IN02                           107546
     C                     MOVE '1'       *IN41                           107546
     C                     MOVE '0'       *IN55                           107546
     C                     MOVE '0'       *IN20                           107546
     C                     MOVE ' '       @TERM                           107546
     C                     MOVE *BLANKS   @DATA                           107546
     C                     MOVEL@TXT,1    @DATA1                          107546
     C                     MOVELDDDLNO    @DATA2                          107546
     C                     MOVEL'MMM1015' @MSGID                          107546
     C                     CALL 'ZA0440'                                  107546
     C                     PARM           @MSGID                          107546
     C                     PARM           @DATA                           107546
     C                     GOTO #BDAA9                                    107546
     C                     ENDIF                                          107546
     C/COPY WNCPYSRC,MMH00175
     C*
     C**  Fill up the other fields.
     C                     EXSR #ZJ
     C**  Enable user to input next deal details while files              E18139
     C**  are being updated for deal just entered                         E18139
     C*                                                                   E18139
     C/COPY WNCPYSRC,MM0089C218
     C**  Blank screen fields                                             E18139
     C                     EXSR #ZE                                       E18139
     C/COPY WNCPYSRC,MM0089C219
     C*                                                                   E18139
     C**  Reset error processing                                          E18139
     C                     EXSR #ZA                                       E18139
     C*                                                                   E18139
     C**  Write input screen                                              E18139
     C*                                                                   E20989
     C*   Bypass if in range authorisation or if called through F15       E20989
     C* processing (@@@BPS = 'Y')                                         E20989
     C           @@@BPS    IFNE 'Y'                                       E20989
      *                                                                   E20989
     C/COPY WNCPYSRC,MM0089CP71                                           S01408
     C*                                                                   S01408
      **  Retrieve time and place in screen field.                        E20989
     C                     TIME           DDTIME                          E20989
      *                                                                   E20989
     C/COPY WNCPYSRC,MM0089C049
     C                     WRITEMM0089S0                                  E18139
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP13                                           S01408
     C*                                                                   S01408
     C                     WRITEMM0089D3                                  S01199
     C                     WRITEMM0089D0                                  E18139
     C/COPY WNCPYSRC,MM0089C354
     C*                                                                   E18139
     C***********          SETON                     57            E18139 136728
     C                     MOVEL'1'       WIN57                           136728
     C*                                                                   E20989
     C/COPY WNCPYSRC,MM0089CP72                                           S01408
     C*                                                                   S01408
     C                     END                                            E20989
     C                     MOVE *BLANKS   @@@BPS                          E20989
     C           @@RACD    IFNE *BLANKS                                   046323
     C                     MOVE @@RACD    RACD                            046323
     C                     MOVE IKDN38    DLNO                            046323
     C                     Z-ADD0         BACD                            046323
     C                     Z-ADD0         BRPD                            046323
     C                     Z-ADD0         BAPD                            046323
     C                     MOVE 'D'       RECI                            046323
     C                     WRITEFORATAAF                                  046323
     C                     END                                            046323
     C*                                                                   S01408
     C** Core hook for externalisation,                                   S01408
     C/COPY WNCPYSRC,MM0089CCBU                                           S01408
     C*                                                                   S01408
     C*                                                                   E18139
     C*
     C**  Call the program to update the front office files.
     C                     CALL 'MM0078'
     C                     PARM           @TERM
     C*********************PARM*'B'*******@BOF****************************S01319
     C                     PARM 'L'       @TDIN
     C                     PARM           @SLDS
     C                     PARM           @SSDS
     C                     PARM           @SBDS
     C                     PARM           @SADS
     C                     PARM           Z#BSTS                          082738
     C                     PARM           Z#ASTS                          082738
     C                     PARM           Z#WSTS                          082738
     C/COPY WNCPYSRC,MM0089C519
     C           @TERM     IFEQ 'E'                        B1
     C           @TERM1    IFNE 'R'                                       S01434
     C                     ROLBK                           *1
     C                     END                                            S01434
     C                     MOVE '1'       *INKC            *1
     C                     EXSR #C                         *1
     C                     END                             E1
     C*
     C**  REMOVE COMIT SO THAT MIDAS-DRS UPDATED IN SAME COMIT CYCLE.     E17021
     C****Commit*the*file*updates.                                        E17021
     C******     CMTTXT    COMIT                                          E17021
     C*
     C** Set up parameter to tell AOOUMMU0 that Auto Rollover Program     082738
     C** MM5310 is calling this program. MM5310 calls this program with   082738
     C** 'R' in parameter @TERM1. Pass this value to AOOUMMU0 which is    082738
     C** called by MM0083 in parameter @@AURO.                            082738
     C                     MOVE @TERM1    @@AURO                          082738
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP65                                           S01408
     C*                                                                   S01408
     C*                                                                   082738
     C**  Call the program to update the MIDAS files.
     C**  Call the program to update the MIDAS files.
     C*********************CALL 'MM0082'                                  082738
     C                     CALL 'MM0083'                                  082738
     C                     PARM           @TERM
     C                     PARM 'L'       @TDIN                           S01319
     C                     PARM           @SLDS                           S01319
     C                     PARM           @SSDS                           S01319
     C                     PARM           @SBDS                           S01319
     C                     PARM           @SADS                           S01319
     C                     PARM           @@RACD                          AUS007
     C                     PARM           Z#BSTS                          082738
     C                     PARM           Z#ASTS                          082738
     C                     PARM           Z#WSTS                          082738
     C                     PARM           @@AURO                          082738
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C131                                           S01408
      *                                                                   S01408
     C           @TERM     IFEQ 'E'                        B1
     C           @TERM1    IFNE 'R'                                       S01434
     C                     ROLBK                           *1
     C                     END                                            S01434
     C                     MOVE '1'       *INKC            *1
     C                     EXSR #C                         *1
     C                     END                             E1
      *                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP49                                           S01408
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089C265                                           S01408
     C*
     C**  Commit the file updates.
     C           @TERM1    IFNE 'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C355
     C           CMTTXT    COMIT
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP83                                           S01408
      *                                                                   S01408
     C                     ELSE                                           S01434
     C                     MOVE 'Y'       RTRN                            S01434
     C                     END                                            S01434
     C/COPY WNCPYSRC,MM0089C237
     C*                                                                   E19346
     C**   Set up successful insert message       *                       E19346
     C           @MAN      IFNE 'Y'                                       E20041
     C***********DDDLNO    IFEQ *BLANKS                            E19346 E20041
     C***********DDDLNO    OREQ *ZEROS                             E19346 E20041
     C                     MOVE '1'       *IN61                           E19346
     C***********          WRITEMM0089D0                           E19346 E20041
     C/COPY WNCPYSRC,MM0089C498
     C                     WRITEMM0089D2                                  E20041
     C/COPY WNCPYSRC,MM0089C499
     C                     MOVE '0'       *IN61                           E19346
     C                     END                                            E19346
     C/COPY WNCPYSRC,MM0089C356
     C*
     C****Set up the successful maintenance message.                      E18139
     C******               MOVE *BLANKS   @DATA                           E18139
     C******               MOVEL@TXT,1    @DATA1                          E18139
     C******               MOVELDDDLNO    @DATA2                          E18139
     C******               MOVEL'MMM1018' @MSGID                          E18139
     C******                                                              E18139
     C****Blank screen fields.                                            E18139
     C******               EXSR #ZE                                       E18139
     C******                                                              E18139
     C****Reset error processing.                                         E18139
     C******               EXSR #ZA                                       E18139
     C******                                                              E18139
     C****Send successful maintenance message to screen.                  E18139
     C******               CALL 'ZA0440'                                  E18139
     C******               PARM           @MSGID                          E18139
     C******               PARM           @DATA                           E18139
     C*
     C**  Blank standard deal fields                                      E18139
     C                     EXSR #ZEA                                      E18139
     C*                                                                   E18139
      * S01227 - Set up flag for use by Extended Settlements              S01227
     C                     MOVE 'Y'       PMFRST                          S01227
     C/COPY WNCPYSRC,MM0089C357
      *                                                                   S01227
     C           #BDAA9    ENDSR                           **#BDAA9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* ZTNLU1   - locks and updates trans no data area               *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #ZG    - Update processing.                        *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           ZTNLU1    BEGSR
     C*
     C**  Set up comit text.
     C                     MOVE 'MM'      MDID
     C                     MOVEL'MM0089'  PGMN
     C                     MOVE DDWID     WSIDX
     C                     TIME           MTIME
     C                     MOVE DDACTN    ACTCDX
     C*
     C**  Increment transaction number of last update.
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN
     C                     MOVE FNATN     ZZWK05
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C*
     C           ZTNLU9    ENDSR                           **ZTNLU9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZB      - Enter processing for action code D.                *
     C*                                                               *
     C* CALLS    #ZF      - Resets screen fileds with stored values.  *
     C*          #ZD      - move file to screen                       *   S01177
     C*          ZA0240   - Sends a msg to the program message queue. *
     C*                                                               *
     C* CALLED BY  #BD    - Enter processing.                         *
     C*            #BFB   -  F15 processing - delete handling.        *
     C*                                                               *
     C* FLDS USED  @DLNO  - Stored version of DDDLNO.                 *
     C*            @MSGID - Message id field.                         *
     C*            @TYPE  - Stored version of DDTYPE.                 *
     C*            @STYP  - Stored version of DDSTYP.                 *
     C*            @DLDT  - Stored version of DDDLDT.                 *
     C*****        @BRCD  - Stored version of DDBRCD.                 *   S01117
     C*            @BRCA  - Stored version of DDBRCA.                 *   S01117
     C*            @BKCD  - Stored version of DDBKCD.                 *
     C*            @BRKG  - Stored version of DDBRKG.                 *
     C*            @DADN  - Stored version of DDDADN.                 *
     C*            @CUST  - Stored version of DDCUST.                 *
     C*            @VDAT  - Stored version of DDVDAT.                 *
     C*            @MDAT  - Stored version of DDMDAT.                 *
     C*            @NTCE  - Stored version of DDNTCE.                 *
     C*************@FCLY**-*Stored*version*of*DDFCLY.******************   E25515
     C*            @ACSQ  - Stored version of DDACSQ.                 *
     C*            @CCY   - Stored version of DDCCY.                  *
     C*            @AMNP  - Stored version of DDAMNP.                 *
     C*            @BRAT  - Stored version of DDBRAT.                 *
     C*            @BSRC  - Stored version of DDBSRC.                 *
     C*            @SPRT  - Stored version of DDSPRT.                 *
     C*            @ICMT  - Stored version of DDICMT.                 *
     C*            @NGVI  - Stored version of DDNGVI.                 *
     C*            @IPFQ  - Stored version of DDIPFQ.                 *
     C*            @NDAT  - Stored version of DDNDAT.                 *
     C*            @TOTI  - Stored version of DDTOTI.                 *
     C*            @IPDM  - Stored version of DDIPDM.                 *
     C*            @CPTI  - Stored version of DDCPTI.                 *
     C*            @MTAX  - Stored version of DDMTAX.                 *
     C*            @CDRF  - Stored version of DDCDRF.                 *
     C*            @CDCH  - Stored version of DDCDCH.                 *
     C*            @FUID  - Stored version of DDFUID                  *   S01392
     C*            @FLID  - Stored version of DDFLID                  *   S01392
     C*            @RDFC  - Stored version of DDRDFC                  *   S01392
     C*            @ORBR  - stored orig. branch                       *   S01117
     C*            @PFRC  - stored profit centre                      *   S01117
     C******       @ORCM  - Stored version of DDORCM.                 *   S01177
     C******       @MOPM  - Stored version of DDMOPM.                 *   S01177
     C******       @MORI  - Stored version of DDMORI.                 *   S01177
     C******       @MOPI  - Stored version of DDMOPI.                 *   S01177
     C******       @MCPI  - Stored version of DDMCPI.                 *   S01177
     C******       @MCRI  - Stored version of DDMCRI.                 *   S01177
     C******       @MFAO  - Stored version of DDMFAO.                 *   S01177
     C******       @SPEC  - Stored version of DDSPEC.                 *   S01177
     C*            @RSTM  - stored rcpt settlement method             *   S01177
     C*            @RONS  - stored rcpt our nostro                    *   S01177
     C*            @RIBN  - stored rcpt intermed bank no.             *   S01177
     C*            @RIBA  - stored rcpt intermed bank a/c line        *   S01177
     C*            @ROBN  - stored rcpt ordering bank no.             *   S01177
     C*            @ROCN  - stored rcpt ordering customer no.         *   S01177
     C*            @PSTM  - stored pay settlement method              *   S01177
     C*            @PONS  - stored pay our nostro                     *   S01177
     C*            @PIBN  - stored pay intermed bank no.              *   S01177
     C*            @PIBA  - stored pay intermed bank a/c line         *   S01177
     C*            @POBN  - stored pay ordering bank no.              *   S01177
     C*            @POCN  - stored pay ordering customer no.          *   S01177
     C*            @RCRN  - stored receiver correspondant no.         *   S01177
     C*            @RCRA  - stored receiver corr a/c line             *   S01177
     C*            @RVNO  - stored receiver no.                       *   S01177
     C*            @AWBN  - stored a/c with bank no.                  *   S01177
     C*            @AWBA  - stored a/c with bank a/c line             *   S01177
     C*            @BENN  - stored beneficiary no.                    *   S01177
     C*            @BENA  - stored beneficiary a/c line               *   S01177
     C*            @DTP1  - stored details of payment 1               *   S01177
     C*            @DTP2  - stored details of payment 2               *   S01177
     C*            @DTP3  - stored details of payment 3               *   S01177
     C*            @DTP4  - stored details of payment 4               *   S01177
     C*            @DCHG  - stored details of charges                 *   S01177
     C*            @BTB1  - stored bank to bank info 1                *   S01177
     C*            @BTB2  - stored bank to bank info 2                *   S01177
     C*            @BTB3  - stored bank to bank info 3                *   S01177
     C*            @BTB4  - stored bank to bank info 4                *   S01177
     C*            @BTB5  - stored bank to bank info 5                *   S01177
     C*            @BTB6  - stored bank to bank info 6                *   S01177
     C*            @CVMR  - cover MT202 required                      *   E22405
     C*            @BOKC  - Stored version of DDBOKC.                 *   S01165
     C*            @LNKN  - Stored version of DDLNKN.                 *   S01165
     C*            @DRID  - Stored version of DDDRID.                 *   S01176
     C*            @DDMR  - Stored version of DDDDMR.                 *   S01176
     C*            @RACD  - Stored version of DDRACD.                 *   AUS007
     C*                                                               *
     C*****************************************************************
     C           #ZB       BEGSR
     C/COPY WNCPYSRC,MM0089C289
     C*
     C**  If key work fields are not the same as screen fields, then
     C**  the record is not already being displayed.
     C           DDDLNO    IFNE @DLNO                      B1
     C           DDDLNO    OREQ *BLANKS                    B1
     C/COPY WNCPYSRC,MM0089C290
     C*
     C**  Display file on screen.
     C                     EXSR #ZD                        *1
     C/COPY WNCPYSRC,MM0089C146
     C*
     C                     ELSE                            X1
     C/COPY WNCPYSRC,MM0089C436
     C*
     C**  If the action code is not D, it is invalid.
     C           DDACTN    IFNE 'D'                        B*2
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP35                                           S01408
     C*                                                                   S01408
     C*
     C**  Set up error output for screen.
     C                     MOVE '1'       *IN01            **2
     C                     MOVEL'MMM1005' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  Restore former field values.
     C                     EXSR #ZF                        **2
     C                     MOVE 'D'       DDACTN           **2
     C*
     C**  By-pass further Delete processing.
     C                     GOTO #ZB9                       **2
     C*
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C486
     C*
     C**  Record was displayed last cycle: check that no amendments to
     C**  fields have been made.
     C           DDDLNO    IFNE @DLNO                      B*2
     C           DDTYPE    ORNE @TYPE                      B*2
     C           DDSTYP    ORNE @STYP                      B*2
     C/COPY WNCPYSRC,MM0089C031
     C           DDFEDF    ORNE @FEDF                      B*2            S01136
     C/COPY WNCPYSRC,MM0089C032
     C           DDDLDT    ORNE @DLDT                      B*2
     C*****      DDBRCD    ORNE @BRCD                      B*2            S01117
     C           DDBRCA    ORNE @BRCA                      B*2            S01117
     C           DDBKCD    ORNE @BKCD                      B*2
     C           DDBRKG    ORNE @BRKG                      B*2
     C           DDDADN    ORNE @DADN                      B*2
     C           DDCUST    ORNE @CUST                      B*2
     C/COPY WNCPYSRC,MM0089C487
     C           DDVDAT    ORNE @VDAT                      B*2
     C           DDMDAT    ORNE @MDAT                      B*2
     C           DDNTCE    ORNE @NTCE                      B*2
     C***********DDFCLY    ORNE @FCLY                      B*2            E25515
     C           DDPTFR    ORNE @PTFR                      B*2            S01486
     C           DDACSQ    ORNE @ACSQ                      B*2
     C           DDCCY     ORNE @CCY                       B*2
     C           DDAMNP    ORNE @AMNP                      B*2
     C           DDBRAT    ORNE @BRAT                      B*2
     C           DDBSRC    ORNE @BSRC                      B*2
     C           DDSPRT    ORNE @SPRT                      B*2
     C           DDICMT    ORNE @ICMT                      B*2
     C           DDNGVI    ORNE @NGVI                      B*2
     C           DDIPFQ    ORNE @IPFQ                      B*2
     C           DDNDAT    ORNE @NDAT                      B*2
     C           DDTOTI    ORNE @TOTI                      B*2
     C           DDIPDM    ORNE @IPDM                      B*2
     C           DDCPTI    ORNE @CPTI                      B*2
     C           DDMTAX    ORNE @MTAX                      B*2
     C           DDCDRF    ORNE @CDRF                      B*2
     C           DDCDCH    ORNE @CDCH                      B*2
     C           DDFUID    ORNE @FUID                      B*2            S01392
     C           DDFLID    ORNE @FLID                      B*2            S01392
     C           DDRDFC    ORNE @RDFC                      B*2            S01392
     C           DDORBR    ORNE @ORBR                      **2            S01117
     C           DDPRFC    ORNE @PRFC                      **2            S01117
     C*****      DDORCM    ORNE @ORCM                      B*2            S01177
     C*****      DDMOPM    ORNE @MOPM                      B*2            S01177
     C*****      DDMORI    ORNE @MORI                      B*2            S01177
     C*****      DDMOPI    ORNE @MOPI                      B*2            S01177
     C*****      DDMCPI    ORNE @MCPI                      B*2            S01177
     C*****      DDMCRI    ORNE @MCRI                      B*2            S01177
     C*****      DDMFAO    ORNE @MFAO                      B*2            S01177
     C*****      DDSPEC    ORNE @SPEC                      B*2            S01177
     C           DDBOKC    ORNE @BOKC                      B*2            S01165
     C           DDLNKN    ORNE @LNKN                      B*2            S01165
     C           DDDRID    ORNE @DRID                      B*2            S01176
     C           DDDDMR    ORNE @DDMR                      B*2            S01176
     C           DDRACD    ORNE @RACD                      B*2            AUS007
     C           DDAURO    ORNE @AURO                                     S01434
     C           DDIPDS    ORNE @IPDS                                     S01434
     C           DDROFQ    ORNE @ROFQ                                     S01434
     C           DDRLDN    ORNE @RLDN                                     S01434
     C           DDIMET    ORNE @IMET                                     S01434
     C           DDINSA    ORNE @INSA                                     S01434
     C           *IN36     ANDEQ'1'                                       S01434
     C           DDINSN    ORNE @INSA                                     S01434
     C           *IN36     ANDEQ'0'                                       S01434
     C           DDINOS    ORNE @INOS                                     S01434
     C           DDCNNA    ORNE @CNNA                                     S01434
     C           DDISCY    ORNE @ISCY                                     CEU003
     C           DDII72    ORNE @II72                                     CEU003
     C*                                                                   S01177
     C** also check second screen parms                                   S01177
     C           PMRSTM    ORNE @RSTM                      **2            S01177
     C           PMRONS    ORNE @RONS                      **2            S01177
     C           PARIBN    ORNE @RIBN                      **2            S01177
     C           PMRIBA    ORNE @RIBA                      **2            S01177
     C           PAROBN    ORNE @ROBN                      **2            S01177
     C           PAROCN    ORNE @ROCN                      **2            S01177
     C           PMPSTM    ORNE @PSTM                      **2            S01177
     C           PMPONS    ORNE @PONS                      **2            S01177
     C           PAPIBN    ORNE @PIBN                      **2            S01177
     C           PMPIBA    ORNE @PIBA                      **2            S01177
     C           PAPOBN    ORNE @POBN                      **2            S01177
     C           PAPOCN    ORNE @POCN                      **2            S01177
     C           PARCRN    ORNE @RCRN                      **2            S01177
     C           PMRCRA    ORNE @RCRA                      **2            S01177
     C           PARVNO    ORNE @RVNO                      **2            S01177
     C           PAAWBN    ORNE @AWBN                      **2            S01177
     C           PMAWBA    ORNE @AWBA                      **2            S01177
     C           PABENN    ORNE @BENN                      **2            S01177
     C           PMBENA    ORNE @BENA                      **2            S01177
     C           PMDTP1    ORNE @DTP1                      **2            S01177
     C           PMDTP2    ORNE @DTP2                      **2            S01177
     C           PMDTP3    ORNE @DTP3                      **2            S01177
     C           PMDTP4    ORNE @DTP4                      **2            S01177
     C           PMDCHG    ORNE @DCHG                      **2            S01177
     C           PMBTB1    ORNE @BTB1                      **2            S01177
     C           PMBTB2    ORNE @BTB2                      **2            S01177
     C           PMBTB3    ORNE @BTB3                      **2            S01177
     C           PMBTB4    ORNE @BTB4                      **2            S01177
     C           PMBTB5    ORNE @BTB5                      **2            S01177
     C           PMBTB6    ORNE @BTB6                      **2            S01177
     C           PMCVMR    ORNE @CVMR                      **2            E22405
     C           PMROBR    ORNE @ROBR                      **2            S01117
     C           PMPOBR    ORNE @POBR                      **2            S01117
     C           PMRSCY    ORNE @STCY                                     CEU003
     C           PMPSCY    ORNE @STCY                                     CEU003
     C           PMIC72    ORNE @IC72                                     CEU003
     C           PMIERI    ORNE @IERI                                     CEU003
     C*
     C**  Set up error output.
     C                     MOVE '1'       *IN01            **2
     C                     MOVEL'MMM1004' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  Restore field values.
     C                     EXSR #ZF                        **2
     C                     MOVE 'D'       DDACTN           **2
     C                     GOTO #ZB9                       **2
     C                     END                             E*2
     C                     END                             E1
     C*
      ***SAVE*DEAL*STATUS*SO*MM0082*WILL*NOT*TRY*TO*PROCESS***ME2380      082738
      ** SAVE DEAL STATUS SO MM0083 WILL NOT TRY TO PROCESS   ME2380      082738
      ** MIDAS DEALS.                                         ME2380
     C                     MOVE HKDSTS    @STS             *1 ME2380
     C                     MOVE HKDSTS    @DSTS            *1 ME2380
     C*
     C**  The entry must now be valid, enable the F10 processing.
     C                     MOVE '1'       *IN42
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP59                                           S01408
     C*
     C           #ZB9      ENDSR                           **#ZB9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZM      -  F10 processing.                                   *
     C*                                                               *
     C* CALLS    ZA0240   - Sends a msg to the program message queue. *
     C*          #ZF      - Resets screen fileds with stored values.  *
     C*          #ZG      - Update processing.                        *
     C*                                                               *
     C* CALLED BY  #B     - Main processing.                          *
     C*            #BFB   -  F15 processing - delete handling.        *
     C*            #ZB    - delete processing                         *   S01177
     C*                                                               *
     C* FLDS USED  @MSGID - Message id field.                         *
     C*            @DLNO  - Stored version of DDDLNO.                 *
     C*            @TYPE  - Stored version of DDTYPE.                 *
     C*            @STYP  - Stored version of DDSTYP.                 *
     C*            @DLDT  - Stored version of DDDLDT.                 *
     C*****        @BRCD  - Stored version of DDBRCD.                 *   S01117
     C*            @BRCA  - Stored version of DDBRCA.                 *   S01117
     C*            @BKCD  - Stored version of DDBKCD.                 *
     C*            @BRKG  - Stored version of DDBRKG.                 *
     C*            @DADN  - Stored version of DDDADN.                 *
     C*            @CUST  - Stored version of DDCUST.                 *
     C*            @VDAT  - Stored version of DDVDAT.                 *
     C*            @MDAT  - Stored version of DDMDAT.                 *
     C*            @NTCE  - Stored version of DDNTCE.                 *
     C*************@FCLY**-*Stored*version*of*DDFCLY.******************   E25515
     C*            @ACSQ  - Stored version of DDACSQ.                 *
     C*            @CCY   - Stored version of DDCCY.                  *
     C*            @AMNP  - Stored version of DDAMNP.                 *
     C*            @BRAT  - Stored version of DDBRAT.                 *
     C*            @BSRC  - Stored version of DDBSRC.                 *
     C*            @SPRT  - Stored version of DDSPRT.                 *
     C*            @ICMT  - Stored version of DDICMT.                 *
     C*            @NGVI  - Stored version of DDNGVI.                 *
     C*            @IPFQ  - Stored version of DDIPFQ.                 *
     C*            @NDAT  - Stored version of DDNDAT.                 *
     C*            @TOTI  - Stored version of DDTOTI.                 *
     C*            @IPDM  - Stored version of DDIPDM.                 *
     C*            @CPTI  - Stored version of DDCPTI.                 *
     C*            @MTAX  - Stored version of DDMTAX.                 *
     C*            @CDRF  - Stored version of DDCDRF.                 *
     C*            @CDCH  - Stored version of DDCDCH.                 *
     C*            @FUID  - Stored version of DDFUID                  *   S01392
     C*            @FLID  - Stored version of DDFLID                  *   S01392
     C*            @RDFC  - Stored version of DDRDFC                  *   S01392
     C*            @ORBR  - stored orig. branch                       *   S01117
     C*            @PRFC  - stored profit centre                      *   S01117
     C******       @ORCM  - Stored version of DDORCM.                 *   S01177
     C******       @MOPM  - Stored version of DDMOPM.                 *   S01177
     C******       @MORI  - Stored version of DDMORI.                 *   S01177
     C******       @MOPI  - Stored version of DDMOPI.                 *   S01177
     C******       @MCPI  - Stored version of DDMCPI.                 *   S01177
     C******       @MCRI  - Stored version of DDMCRI.                 *   S01177
     C******       @MFAO  - Stored version of DDMFAO.                 *   S01177
     C******       @SPEC  - Stored version of DDSPEC.                 *   S01177
     C*            @RSTM  - stored rcpt settlement method             *   S01177
     C*            @RONS  - stored rcpt our nostro                    *   S01177
     C*            @RIBN  - stored rcpt intermed bank no.             *   S01177
     C*            @RIBA  - stored rcpt intermed bank a/c line        *   S01177
     C*            @ROBN  - stored rcpt ordering bank no.             *   S01177
     C*            @ROCN  - stored rcpt ordering customer no.         *   S01177
     C*            @PSTM  - stored pay settlement method              *   S01177
     C*            @PONS  - stored pay our nostro                     *   S01177
     C*            @PIBN  - stored pay intermed bank no.              *   S01177
     C*            @PIBA  - stored pay intermed bank a/c line         *   S01177
     C*            @POBN  - stored pay ordering bank no.              *   S01177
     C*            @POCN  - stored pay ordering customer no.          *   S01177
     C*            @RCRN  - stored receiver correspondant no.         *   S01177
     C*            @RCRA  - stored receiver corr a/c line             *   S01177
     C*            @RVNO  - stored receiver no.                       *   S01177
     C*            @AWBN  - stored a/c with bank no.                  *   S01177
     C*            @AWBA  - stored a/c with bank a/c line             *   S01177
     C*            @BENN  - stored beneficiary no.                    *   S01177
     C*            @BENA  - stored beneficiary a/c line               *   S01177
     C*            @DTP1  - stored details of payment 1               *   S01177
     C*            @DTP2  - stored details of payment 2               *   S01177
     C*            @DTP3  - stored details of payment 3               *   S01177
     C*            @DTP4  - stored details of payment 4               *   S01177
     C*            @DCHG  - stored details of charges                 *   S01177
     C*            @BTB1  - stored bank to bank info 1                *   S01177
     C*            @BTB2  - stored bank to bank info 2                *   S01177
     C*            @BTB3  - stored bank to bank info 3                *   S01177
     C*            @BTB4  - stored bank to bank info 4                *   S01177
     C*            @BTB5  - stored bank to bank info 5                *   S01177
     C*            @BTB6  - stored bank to bank info 6                *   S01177
     C*            @CVMR  - cover MT202 required                      *   E22405
     C*            @BOKC  - Stored version of DDBOKC.                 *   S01165
     C*            @LNKN  - Stored version of DDLNKN.                 *   S01165
     C*            @DRID  - Stored version of DDDRID.                 *   S01176
     C*            @DDMR  - Stored version of DDDDMR.                 *   S01176
     C*            @RACD  - Stored version of DDRACD.                 *   AUS007
     C*                                                               *
     C*****************************************************************
     C           #ZM       BEGSR
     C/COPY WNCPYSRC,MM0089C189
     C*
     C**  If the action code is not D, it is invalid.
     C           DDACTN    IFNE 'D'                        B1
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CP36                                           S01408
     C*                                                                   S01408
     C*
     C**  Set up error output for screen.
     C                     MOVE '1'       *IN01            *1
     C                     MOVEL'MMM1005' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  Restore former field values.
     C                     EXSR #ZF                        *1
     C*
     C**  By-pass further F10 processing.
     C                     GOTO #ZM9                       *1
     C*
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C488
     C*
     C**  If any other fields have changed since the record was
     C**  displayed, delete processing is invalid.
     C           DDDLNO    IFNE @DLNO                      B1
     C           DDTYPE    ORNE @TYPE                      B1
     C           DDSTYP    ORNE @STYP                      B1
     C/COPY WNCPYSRC,MM0089C033
     C           DDFEDF    ORNE @FEDF                      B1             S01136
     C/COPY WNCPYSRC,MM0089C034
     C           DDDLDT    ORNE @DLDT                      B1
     C*****      DDBRCD    ORNE @BRCD                      B1             S01117
     C           DDBRCA    ORNE @BRCA                      B1             S01117
     C           DDBKCD    ORNE @BKCD                      B1
     C           DDBRKG    ORNE @BRKG                      B1
     C           DDDADN    ORNE @DADN                      B1
     C           DDCUST    ORNE @CUST                      B1
     C/COPY WNCPYSRC,MM0089C489
     C           DDVDAT    ORNE @VDAT                      B1
     C           DDMDAT    ORNE @MDAT                      B1
     C           DDNTCE    ORNE @NTCE                      B1
     C***********DDFCLY    ORNE @FCLY                      B1             E25515
     C           DDACSQ    ORNE @ACSQ                      B1
     C           DDCCY     ORNE @CCY                       B1
     C           DDAMNP    ORNE @AMNP                      B1
     C           DDBRAT    ORNE @BRAT                      B1
     C           DDBSRC    ORNE @BSRC                      B1
     C           DDSPRT    ORNE @SPRT                      B1
     C           DDICMT    ORNE @ICMT                      B1
     C           DDNGVI    ORNE @NGVI                      B1
     C           DDIPFQ    ORNE @IPFQ                      B1
     C           DDNDAT    ORNE @NDAT                      B1
     C           DDTOTI    ORNE @TOTI                      B1
     C           DDIPDM    ORNE @IPDM                      B1
     C           DDCPTI    ORNE @CPTI                      B1
     C           DDMTAX    ORNE @MTAX                      B1
     C           DDCDRF    ORNE @CDRF                      B1
     C           DDCDCH    ORNE @CDCH                      B1
     C           DDFUID    ORNE @FUID                      B1             S01392
     C           DDFLID    ORNE @FLID                      B1             S01392
     C           DDRDFC    ORNE @RDFC                      B1             S01392
     C           DDORBR    ORNE @ORBR                      *1             S01117
     C           DDPRFC    ORNE @PRFC                      *1             S01117
     C*****      DDORCM    ORNE @ORCM                      B1             S01177
     C*****      DDMOPM    ORNE @MOPM                      B1             S01177
     C*****      DDMORI    ORNE @MORI                      B1             S01177
     C*****      DDMOPI    ORNE @MOPI                      B1             S01177
     C*****      DDMCPI    ORNE @MCPI                      B1             S01177
     C*****      DDMCRI    ORNE @MCRI                      B1             S01177
     C*****      DDMFAO    ORNE @MFAO                      B1             S01177
     C*****      DDSPEC    ORNE @SPEC                      B1             S01177
     C           DDBOKC    ORNE @BOKC                      B1             S01165
     C           DDLNKN    ORNE @LNKN                      B1             S01165
     C           DDDRID    ORNE @DRID                      B1             S01176
     C           DDDDMR    ORNE @DDMR                      B1             S01176
     C           DDRACD    ORNE @RACD                      B1             AUS007
     C           DDAURO    ORNE @AURO                                     S01434
     C           DDIPDS    ORNE @IPDS                                     S01434
     C           DDROFQ    ORNE @ROFQ                                     S01434
     C           DDRLDN    ORNE @RLDN                                     S01434
     C           DDIMET    ORNE @IMET                                     S01434
     C           DDINSA    ORNE @INSA                                     S01434
     C           *IN36     ANDEQ'1'                                       S01434
     C           DDINSN    ORNE @INSA                                     S01434
     C           *IN36     ANDEQ'0'                                       S01434
     C           DDINOS    ORNE @INOS                                     S01434
     C           DDCNNA    ORNE @CNNA                                     S01434
     C           DDISCY    ORNE @ISCY                                     CEU003
     C           DDII72    ORNE @II72                                     CEU003
     C*
     C** also check second screen parms                                   S01177
     C           PMRSTM    ORNE @RSTM                      B1             S01177
     C           PMRONS    ORNE @RONS                      B1             S01177
     C           PARIBN    ORNE @RIBN                      B1             S01177
     C           PMRIBA    ORNE @RIBA                      B1             S01177
     C           PAROBN    ORNE @ROBN                      B1             S01177
     C           PAROCN    ORNE @ROCN                      B1             S01177
     C           PMPSTM    ORNE @PSTM                      B1             S01177
     C           PMPONS    ORNE @PONS                      B1             S01177
     C           PAPIBN    ORNE @PIBN                      B1             S01177
     C           PMPIBA    ORNE @PIBA                      B1             S01177
     C           PAPOBN    ORNE @POBN                      B1             S01177
     C           PAPOCN    ORNE @POCN                      B1             S01177
     C           PARCRN    ORNE @RCRN                      B1             S01177
     C           PMRCRA    ORNE @RCRA                      B1             S01177
     C           PARVNO    ORNE @RVNO                      B1             S01177
     C           PAAWBN    ORNE @AWBN                      B1             S01177
     C           PMAWBA    ORNE @AWBA                      B1             S01177
     C           PABENN    ORNE @BENN                      B1             S01177
     C           PMBENA    ORNE @BENA                      B1             S01177
     C           PMDTP1    ORNE @DTP1                      B1             S01177
     C           PMDTP2    ORNE @DTP2                      B1             S01177
     C           PMDTP3    ORNE @DTP3                      B1             S01177
     C           PMDTP4    ORNE @DTP4                      B1             S01177
     C           PMDCHG    ORNE @DCHG                      B1             S01177
     C           PMBTB1    ORNE @BTB1                      B1             S01177
     C           PMBTB2    ORNE @BTB2                      B1             S01177
     C           PMBTB3    ORNE @BTB3                      B1             S01177
     C           PMBTB4    ORNE @BTB4                      B1             S01177
     C           PMBTB5    ORNE @BTB5                      B1             S01177
     C           PMBTB6    ORNE @BTB6                      B1             S01177
     C           PMCVMR    ORNE @CVMR                      B1             E22405
     C           PMPOBR    ORNE @POBR                      B1             S01177
     C           PMROBR    ORNE @ROBR                      B1             S01177
     C           PMRSCY    ORNE @STCY                                     CEU003
     C           PMPSCY    ORNE @STCY                                     CEU003
     C           PMIC72    ORNE @IC72                                     CEU003
     C           PMIERI    ORNE @IERI                                     CEU003
     C**  Set up error output for screen.
     C                     MOVE '1'       *IN01            *1
     C                     MOVEL'MMM1004' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C**  Restore former field values.
     C                     EXSR #ZF                        *1
     C                     MOVE 'D'       DDACTN           *1
     C*
     C**  Reset indicator allowing F10 processing.
     C                     MOVE '0'       *IN42            *1
     C*
     C**  By-pass further F10 processing.
     C                     GOTO #ZM9                       *1
     C*
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C358
     C*
     C*
     C**  F10 processing must now be valid, update file.
     C                     EXSR #ZG
     C*
     C           #ZM9      ENDSR                           **#ZM9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #BF      -  F15 processing - select screen handling.          *
     C*                                                               *
     C* CALLS    #BFA     -  F15 processing - amend handling.         *
     C*          #BFB     -  F15 processing - delete handling.        *
     C*          #BFC     -  F15 processing - authorise handling.     *
     C*          #ZA      - Resets screen error indicators and MSGQ.  *
     C*          #ZD      - Sets up screen with file values.          *
     C*          #ZE      - Clears all screen fields.                 *
     C*          #ZEA     - Clear standard deal                       *   E18139
     C*          #ZL      - Displays, reads and resets screen.        *
     C*          #ZO      - Validate deal number and action code.     *
     C*          ZA0240   - Sends a msg to the program message queue. *
     C*          ZA0770   - YYYYMMDD to MMDDYY or DDMMYY conversion.  *
     C*          ZA1020   - Convert amount to display.                *
      *          #FEED    - Extract feedback information when         *   S01184
      *                     CONFIRMATION MATCHING module present      *   S01184
     C*                                                               *
     C* CALLED BY  #B     - Main processing.                          *
     C*                                                               *
     C* FLDS USED  @TEST  - Field to test numeric fields' right byte. *
     C*            @DLKEY - Numeric key to deal file.                 *
     C*            @MSGID - Message id field.                         *
     C*            @LIST  - Action codes allowed text for screen.     *
     C*            @RRN   - Screen sub-file relative record no.       *
     C*            @COUNT - Screen sub-file record counter.           *
     C*            @@IAMT - Input amount.                             *
     C*            @@CRET - No. of characters to be returned.         *
     C*            @@CDP  - No. of decimal places.                    *
     C*            @@ADSP - Amount to be displayed.                   *
     C*            @YEAR  - Field to hold year and century.           *
     C*            @MNTH  - Field to hold month (MM).                 *
     C*            @DAY   - Field to hold day (DD).                   *
     C*            @DATE  - Date (YYYYMMDD).                          *
     C*            @@DTIN - Date (YYYYMMDD).                          *
     C*            @@DTOU - Date (MMDDYY or DDMMYY).                  *
     C*                                                               *
     C*****************************************************************
     C           #BF       BEGSR
     C/COPY WNCPYSRC,MM0089C050
     C*
      ** Must first check user is authorised to action code 'E' if        S01117
      ** MBIN 'N'. (Even if action code is 'X' use 'E' b'cos CF15         S01117
      ** is an enquiry. Note MBIN 'Y' checking done later in subroutine   S01117
     C           @MBIN     IFEQ 'N'                        B1             S01117
      *                                                                   S01117
     C                     CALL 'ZVACTU'                   *1             S01117
     C                     PARM 'E'       ZACTN            *1             S01117
     C                     PARM           ERR              *1             S01117
      *                                                                   S01117
     C           ERR       IFEQ 1                          B*2            S01117
     C                     MOVE '1'       *IN01            **2            S01117
     C                     MOVE '1'       *IN41            **2            S01117
     C                     MOVEL'FXM0292' @MSGID           **2            S01117
     C                     CALL 'ZA0240'                   **2            S01117
     C                     PARM           @MSGID           **2            S01117
     C                     GOTO #BF9                       **2            S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
     C                     END                             E1             S01177
     C*                                                                   S01177
      * S01227 - Set up flag for use by Extended Settlements              S01227
     C                     MOVE 'Y'       PMFRST                          S01227
     C*                                                                   S01177
     C**  Clear "F10-CONFIRM" prompt if displayed before F15 pressed      S01177
     C                     MOVE '0'       *IN42                           S01177
     C**                                                                  S01184
     C**  Clear indicator which governs display of FEEDBACK on screen 1   S01184
     C**  on INSERTS                                                      S01184
     C                     MOVE '0'       *IN94                           S01184
     C*
     C**  Disable CMD/14 to prevent call to settlement screen             S01177
     C                     SETOF                     53                   S01177
     C** Core hook for externalisation.                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP19                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C**  Validate that the deal number is numeric or blank.
     C                     TESTN          DDDLNO     62
     C                     MOVE DDDLNO    @TEST
     C                     TESTZ          @TEST          73
     C           DDDLNO    IFEQ *BLANKS                    B1
     C           *IN62     OREQ '1'                        B1
     C           *IN73     ANDEQ'1'                        B1
     C                     MOVE DDDLNO    @DLKEY           *1
     C                     ELSE                            X1
     C                     MOVEL'MMM0162' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE '1'       *IN02            *1
     C                     MOVE '1'       *IN41            *1
     C                     GOTO #BF9                       *1
     C                     END                             E1
     C*
     C**  Initialisation for subfile processing.
     C/COPY WNCPYSRC,MM0089C530
     C*
     C**  Set on indicator to show that select processing is occurring.
     C                     MOVE '1'       *IN45
     C*
     C**  Initialise indicator showing end of selected records.
     C                     MOVE '0'       *IN58
     C*
     C**  Set up Action Code text for screen for select processing.
     C                     MOVE DDLIST    @LIST
     C                     MOVEL'( '      DDLIST
     C*
     C**  Initialise program field for subfile relative record number.
     C                     Z-ADD0         @RRN
     C*
     C**  Initialise screen and write main screen without displaying
     C**  to clear msgq.
     C                     EXSR #ZA
      *                                                                   S01486
      ** Save the value of indicator 47.                                  S01486
     C                     MOVE *IN47     SVIN47  1                       S01486
      *                                                                   S01486
     C                     MOVE '1'       *IN47
     C/COPY WNCPYSRC,MM0089C359
     C                     WRITEMM0089S0
     C/COPY WNCPYSRC,MM0089C360
     C                     MOVE '0'       *IN47
      *                                                                   S01486
      ** Restore the value of indicator 47.                               S01486
     C                     MOVE SVIN47    *IN47                           S01486
     C*
     C**  Clear subfile before refilling by writing control record
     C**  with SFLCLR active.
      *                                                                   S01486
      ** Save the value of indicator 46.                                  S01486
     C                     MOVE *IN46     SVIN46  1                       S01486
      *                                                                   S01486
     C                     MOVE '1'       *IN46
     C/COPY WNCPYSRC,MM0089C361
     C                     WRITEMM0089S2
     C/COPY WNCPYSRC,MM0089C362
     C                     MOVE '0'       *IN46
      *                                                                   S01486
      ** Restore the value of indicator 46.                               S01486
     C                     MOVE SVIN46    *IN46                           S01486
     C*
     C**  Write the select screen footer to the screen.
     C/COPY WNCPYSRC,MM0089C363
     C                     WRITEMM0089D1
     C/COPY WNCPYSRC,MM0089C364
     C*
     C**  Set on ROLLUP indicator to cause initial loop operation.
     C                     MOVE '1'       *IN51
     C*
     C**  Reset *IN70.
     C                     MOVE '0'       *IN70
     C*
     C**  Set file pointer on key displayed on screen.
     C/COPY WNCPYSRC,MM0089C531
     C           DDACTN    IFEQ 'X'                        B1
     C           @DLKEY    SETLLMMCMPLLL                   *1
     C                     ELSE                            X1
     C           @DLKEY    SETLLMMCARDLL                   *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C532
     C*
     C**  Reset *IN70.
     C                     MOVE '0'       *IN70
     C/COPY WNCPYSRC,MM0089C437
     C*
     C**  Read the file initially - if *IN70 is set on then the end of
     C**  the file has been reached.  Read until a valid record is
     C**  found or until no more records exist.
     C           *IN70     DOUEQ'1'                        B1
     C           HKDLTF    OREQ *BLANKS                    B1
     C           ERR       ANDEQ*ZERO                      *1             S01117
     C/COPY WNCPYSRC,MM0089C438
     C*
     C**  Read the file.
     C           DDACTN    IFEQ 'X'                        B*2
     C                     READ MMCMPLLL                 70**2
     C           HKDDLT    IFEQ 'D'                                       109269
     C                     MOVE 'D'       HKDLTF                          109269
     C                     ENDIF                                          109269
     C                     ELSE                            X*2
     C                     READ MMCARDLL                 70**2
     C                     END                             E*2
     C/COPY WNCPYSRC,MM0089C533
     C*
     C**  If *IN70 is on no more records exist - set up an error message.
     C           *IN70     IFEQ '1'                        B*2
     C*
     C                     MOVEL'MMM1007' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C*
     C**  Set file pointer on key displayed on screen.
     C/COPY WNCPYSRC,MM0089C534
     C           DDACTN    IFEQ 'X'                        B**3
     C           @DLKEY    SETLLMMCMPLLL                   ***3
     C                     ELSE                            X**3
     C           @DLKEY    SETLLMMCARDLL                   ***3
     C                     END                             E**3
     C/COPY WNCPYSRC,MM0089C535
     C*
     C**  Bypass further record handling for select processing.
     C                     GOTO #BF8                       **2
     C*
     C                     ELSE                            X*2            S01117
      ** if system is multibranched check branch/user authorities         S01117
      ** for each deal which may be displayed                             S01117
      ** Must also check for user authority to branch in mb system        S01117
     C           @MBIN     IFEQ 'Y'                        B**3           S01117
      *                                                                   S01117
      ** check booking branch, always use action code of 'E'              S01117
     C                     CALL 'ZVACTBU'                  ***3           S01117
     C                     PARM 'E'       ZACTN            ***3           S01117
     C                     PARM           HKBRCA           ***3           S01117
     C                     PARM           ERR              ***3           S01117
      *                                                                   S01117
      ** if originating branch used and no errors from prev               S01117
     C*****      OBUV      IFEQ 'Y'                        B***4    S01117S01194
     C           BKOBUV    IFEQ 'Y'                        B***4          S01194
     C           ERR       ANDEQ*ZERO                      B***4          S01117
     C                     CALL 'ZVOBU'                    ****4          S01117
     C                     PARM           HKORBR           ****4          S01117
     C                     PARM           ERR              ****4          S01117
     C                     END                             E***4          S01117
     C                     END                             E**3           S01117
     C                     END                             E*2
     C*
     C/COPY WNCPYSRC,MM0089C245
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C439
     C*
     C**  Processing for the Select Screen itself.
     C*
     C**  Read records from the file into the subfile until a page has
     C**  been filled or there are no more records.
     C**  Repeat the process until either the end of file, ROLLUP
     C**  has not been entered or F3 or F12 is input.
     C           *IN70     DOWNE'1'                        B1
     C           *IN51     ANDEQ'1'                        B1
     C*
     C**  Initialise program field for counting records written to
     C**  subfile page.
     C                     Z-ADD0         @COUNT           *1
     C*
     C**  For each record read, write a record to the screen subfile.
     C**  do this until - End of file. *IN70.
     C**                - The subfile page has been filled.
     C           *IN70     DOWNE'1'                        B*2
     C           @COUNT    ANDLT14                         B*2
     C*
     C**  Increment the relative record no. and records written fields.
     C                     ADD  1         @RRN             **2
     C                     ADD  1         @COUNT           **2
     C*
     C**  Set up the subfile fields.
     C                     MOVE *BLANK    DDOPT            **2
     C                     Z-ADD@RRN      DDSFRN           **2
     C*
     C                     MOVE HKDN38    DDDLNO           **2
     C                     MOVE HKMTYP    DDTYPE           **2
     C*
     C**  Set up deal currency and amount.
     C                     MOVE HKCCY     DDCCY            **2
     C           HKAMNP    IFLT 0                          B**3
     C                     Z-SUBHKAMNP    @@IAMT           ***3
     C                     ELSE                            X**3
     C                     Z-ADDHKAMNP    @@IAMT           ***3
     C                     END                             E**3
     C                     Z-ADD17        @@CRET           **2
     C                     Z-ADDHKCYDP    @@CDP            **2
     C                     EXSR ZA1020                     **2
     C                     MOVE @@ADSP    DDSAMN           **2
     C*
     C**  Set up deal status and customer number.
     C                     MOVE HKDSTS    DDDSTS           **2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C142                                           S01408
     C*                                                                   S01408
     C                     MOVE HKCNUM    DDCNUM           **2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C143                                           S01408
     C*                                                                   S01408
     C*
     C**  Set up value date.
     C           HKVDYY    IFNE *ZEROS                     B**3
     C           HKVDMM    ANDNE*ZEROS                     B**3
     C           HKVDDD    ANDNE*ZEROS                     B**3
     C                     Z-ADDHKVDYY    @YEAR            ***3
     C                     Z-ADDHKVDMM    @MNTH            ***3
     C                     Z-ADDHKVDDD    @DAY             ***3
     C                     Z-ADD@DATE     @@DTIN           ***3
     C                     EXSR ZA0770                     ***3
     C                     MOVE @@DTOU    DDVDAT           ***3
     C                     ELSE                            X**3
     C                     MOVE *BLANKS   DDVDAT           ***3
     C                     END                             E**3
     C*
     C**  Set up notice days or maturity date.
     C           HKMDYY    IFNE *ZEROS                     B**3
     C           HKMDMM    ANDNE*ZEROS                     B**3
     C           HKMDDD    ANDNE*ZEROS                     B**3
     C           HKNTCE    IFEQ -999                       B***4
     C                     MOVE *BLANKS   DDMDAT           ****4
     C                     Z-ADDHKMDYY    @YEAR            ****4
     C                     Z-ADDHKMDMM    @MNTH            ****4
     C                     Z-ADDHKMDDD    @DAY             ****4
     C                     Z-ADD@DATE     @@DTIN           ****4
     C                     EXSR ZA0770                     ****4
     C                     MOVE @@DTOU    DDMDAT           ****4
     C                     ELSE                            X***4
     C                     MOVE *BLANKS   DDMDAT           ****4
     C                     END                             E***4
     C                     ELSE                            X**3
     C           HKNTCE    IFEQ *ZEROS                     B***4
     C                     MOVE *BLANKS   DDMDAT           ****4
     C                     MOVE 'CALL  '  DDMDAT           ****4
     C                     ELSE                            X***4
     C                     MOVE *BLANKS   DDMDAT           ****4
     C                     Z-ADDHKNTCE    @@AMTW           ****4
     C                     Z-ADD0         @@QECN           ****4
     C                     EXSR ZA0920                     ****4
     C                     MOVE @@AMTD    DDMDAT           ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C**  If the deal has been deleted then set on *IN39.
     C           HKDDLT    IFEQ 'D'                        B**3
     C                     MOVE '1'       *IN39            ***3
     C*********************MOVE 'DELETED' DDTEXT                    S01184S01304
     C                     MOVEL'ZZGBMSGF'MSGNM                           S01304
     C***********          MOVEL'ZZM1607' MSGDNB                    S01304DT0170
     C                     MOVEL'ZZM1614' MSGDNB                          DT0170
     C                     CALL 'SDRTVTXT'                                S01304
     C                     PARM           MSGDNB  7                       S01304
     C                     PARM           MSGNM  10                       S01304
     C                     PARM           MSGTXT 80                       S01304
     C                     MOVELMSGTXT    DDTEXT                          S01304
     C                     ELSE                            X**3
     C*                                                                   S01184
     C                     MOVE '0'       *IN39            ***3
     C                     MOVE *BLANKS   DDTEXT                          S01184
     C                     MOVE *BLANKS   @TEXT                           S01184
     C*                                                                   S01184
     C** if CONFIRMATION MATCHING present get match status feedback       S01184
     C           BGCFMT    IFEQ 'Y'                                       S01184
     C                     EXSR #FEED                                     S01184
     C                     END                                            S01184
     C*                                                                   S01184
     C                     END                             E**3
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP54                                           S01408
     C*                                                                   S01408
     C*
     C**  Write the record to the subfile.
     C                     WRITEMM0089S3                   **2
     C/COPY WNCPYSRC,MM0089C365
     C*
     C**  Until a valid record is found or until no more records exist
     C**  on the file.
     C           *IN70     DOUEQ'1'                        B**3
     C           HKDLTF    OREQ *BLANKS                    B**3
     C           ERR       ANDEQ*ZERO                      ***3           S01117
     C/COPY WNCPYSRC,MM0089C440
     C*
     C**  Read the file.
     C           DDACTN    IFEQ 'X'                        B***4
     C                     READ MMCMPLLL                 70****4
     C           HKDDLT    IFEQ 'D'                                       109269
     C                     MOVE 'D'       HKDLTF                          109269
     C                     ENDIF                                          109269
     C                     ELSE                            X***4
     C                     READ MMCARDLL                 70****4
     C                     END                             E***4
     C/COPY WNCPYSRC,MM0089C536
     C*
      ** if system is multibranched check branch/user authorities         S01117
      ** for each deal which may be displayed                             S01117
      ** Must also check for user authority to branch in mb system        S01117
     C           @MBIN     IFEQ 'Y'                        B***4          S01117
      *                                                                   S01117
      ** check booking branch, always use action code of 'E'              S01117
     C                     CALL 'ZVACTBU'                  ****4          S01117
     C                     PARM 'E'       ZACTN            ****4          S01117
     C                     PARM           HKBRCA           ****4          S01117
     C                     PARM           ERR              ****4          S01117
      *                                                                   S01117
      ** if originating branch used and no errors from prev               S01117
     C*****      OBUV      IFEQ 'Y'                        B****5   S01117S01194
     C           BKOBUV    IFEQ 'Y'                        B****5         S01194
     C           ERR       ANDEQ*ZERO                      B****5         S01117
     C                     CALL 'ZVOBU'                    *****5         S01117
     C                     PARM           HKORBR           *****5         S01117
     C                     PARM           ERR              *****5         S01117
     C                     END                             E****5         S01117
     C                     END                             E***4          S01117
     C/COPY WNCPYSRC,MM0089C246
     C                     END                             E**3
     C/COPY WNCPYSRC,MM0089C441
     C*
     C                     END                             E*2
     C*
     C**  Retrieve time and place in screen field.
     C                     TIME           DDTIME           *1
     C*
     C** if CONFIRMATION MATCHING present SET ON *IN92                    S01184
     C           BGCFMT    IFEQ 'Y'                                       S01184
     C                     MOVE '1'       *IN92                           S01184
     C                     END                                            S01184
     C*                                                                   S01184
     C**  Write the subfile control record to the screen to display
     C**  the subfile.
     C/COPY WNCPYSRC,MM0089C366
     C                     WRITEMM0089S2                   *1
     C*
     C**  Read the subfile control record to determine which records
     C**  have been selected and whether ROLLUP is required.
     C                     READ MM0089S2                 60*1
     C/COPY WNCPYSRC,MM0089C367
     C*
     C**  If F3  has been pressed, bypass further select processing.
     C           *INKC     CABEQ'1'       #BF9             *1
     C*
     C**  If F12 has been pressed, go to select processing termination.
     C           *INKL     CABEQ'1'       #BF8             *1
     C/COPY WNCPYSRC,MM0089C537
     C*
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C503
     C*
     C**  Processing for selected records.
     C*
     C**  Each selected record, is displayed and allowed to be amended
     C**  or deleted.
     C           *IN58     DOWNE'1'                        B1
     C*
     C**  Read the subfile for changed records - these are those that
     C**  have been selected.
     C**  Only process those for which the option field is blank.
     C           *IN58     DOUEQ'1'                        B*2
     C           DDOPT     ORNE *BLANK                     B*2
     C                     READCMM0089S3                 58**2
     C                     END                             E*2
     C*
     C**  If *IN58 is not on then changed records exist.
     C           *IN58     IFEQ '0'                        B*2
      *                                                                   136653
      **  Move DDACTN to @@ACTN. Introduced new field @@ACTN to save      136653
      **  previous DDACTN when it is 'X'.                                 136653
      *                                                                   136653
     C           DDACTN    IFEQ 'X'                                       136653
     C                     MOVE DDACTN    @@ACTN  1                       136653
     C                     END                                            136653
     C*
     C**  Move Action code E into screen field.
     C           DDACTN    IFNE 'X'                        B**3           109732
      *                                                                   136653
      **  Before moving 'E' to screen field, check @@ACTN if 'X'.         136653
      **  If yes, move 'X' to DDACTN. If no, move 'E' to DDACTN.          136653
      *                                                                   136653
     C           @@ACTN    IFEQ 'X'                                       136653
     C                     MOVE 'X'       DDACTN                          136653
     C                     ELSE                                           136653
     C                     MOVE 'E'       DDACTN           **2
     C                     END                                            136653
     C                     END                             E**3           109732
     C*
     C**  Move the subfile screen fields into program work fields.
     C                     MOVE DDDLNO    @DLKEY           **2
     C           @DLKEY    CHAINMMDEALLL             70    **2
     C*                                                                   S01184
     C* Set on indicator to show that #ZD called by F15 processing        S01184
     C* (for use by SR #FEED which is called by #ZD)                      S01184
     C                     MOVE '1'       *IN93                           S01184
     C                     EXSR #ZD                        **2
     C/COPY WNCPYSRC,MM0089C147
     C*
     C*                                                                   S01177
     C*     if user has changed the ACTION CODE and pressed ENTER         S01177
     C*     during 'X' or 'A' or 'D' processing then re-validate the      S01177
     C*     action code and process again (when action code changed       S01177
     C*     in #BFA, #BFB or #BFC control is returned to the start        S01177
     C*     of this loop)                                                 S01177
     C*                                                                   S01177
     C************IN34     DOUEQ'0'                        B**3    S01177 136728
     C           WIN34     DOUEQ'0'                        B**3           136728
     C*                                                                   S01177
     C*     if F12 pressed on screen 2 redisplay deal (AMEND,AUTH)        S01177
     C************IN33     DOUEQ'0'                        B***4   S01177 136728
     C***********          SETOF                     33    ****4   S01177 136728
     C           WIN33     DOUEQ'0'                        B***4          136728
     C                     MOVEL'0'       WIN33   1        ****4          136728
     C*                                                                   S01177
     C**  Process this loop until a valid action code has been entered.
     C           *IN01     DOUEQ'0'                        B**3
     C*
     C**  Enable CMD/14 to allow call to settlement screen                S01177
     C                     SETON                     53    *****5         S01177
     C*                                                                   S01177
     C**  Ensure that screen 1 is displayed at least once in loop         S01177
     C                     SETON                     32    *****5         S01177
     C*                                                                   S01177
     C**  Allow switching between screen 1 and screen 2                   S01177
     C           *IN32     DOWEQ'1'                        B*****6        S01177
     C                     SETOF                     32    ******6        S01177
     C*                                                                   S01177
     C**  Process the screen.                                             S01177
     C*                                                                   S01177
     C**  no need to re-display screen when action code changed and       S01177
     C**  ENTER pressed in #BFA, #BFB or #BFC                             S01177
     C************IN34     IFNE '1'                        B******7S01177 136728
     C           WIN34     IFNE '1'                        B******7       136728
     C           *IN41     OREQ '1'                        *******7       E21145
     C                     EXSR #ZL                        *******7
     C                     END                             E******7       S01177
     C*
     C**  If CA3 is input exit main processing immediately.               S01177
     C           *INKC     CABEQ'1'       #BF9             ******6        S01177
     C*
     C**  If CF12is input go to select processing termination.            S01177
     C           *INKL     CABEQ'1'       #BF8             ******6        S01177
     C/COPY WNCPYSRC,MM0089C051
     C*                                                                   S01177
     C**  If F14 is input display settlement screen (unless we            S01177
     C**  are already on screen 2 having changed action code and          S01177
     C**  pressed F14 in #BFA,#BFB or #BFC)                               S01177
     C************IN34     IFNE '1'                        B******7S01177 136728
     C           WIN34     IFNE '1'                        B******7       136728
     C           *INKN     IFEQ '1'                        B*******8      S01177
     C                     EXSR #BE                        ********8      S01177
     C           *INKC     CABEQ'1'       #BF9             ********8      S01177
     C*   F12 taken from screen 2                                         S01177
     C           *INKL     COMP '1'                      32********8      S01177
     C                     MOVE '0'       *INKL            ********8      S01177
     C                     ELSE                            X*******8      S01177
     C*   allow next selected deal to be displayed                        S01177
     C                     SETOF                     32    ********8      S01177
     C                     END                             E*******8      S01177
     C                     END                             E******7       S01177
     C                     END                             E*****6        S01177
     C*
     C* ENTER pressed                                                     S01177
     C*
     C**  Process screen input - depending upon input type.
     C*
     C**  If DDACTN is not A,D,E, it is invalid for select proc.
     C           DDACTN    IFNE 'A'                        B*****6
     C           DDACTN    ANDNE'D'                        B*****6
     C           DDACTN    ANDNE'E'                        B*****6
     C           DDACTN    ANDNE'X'                        B*****6
     C*
     C**  Set up error output for screen.
     C                     MOVE '1'       *IN01            ******6
     C                     MOVE '1'       *IN41            ****4          E21145
     C                     MOVEL'MMM1001' @MSGID           ******6
     C                     CALL 'ZA0240'                   ******6
     C                     PARM           @MSGID           ******6
     C*                                                                   BHF280
     C*  REDISPLAY SCREEN IF ACTION CODE IS INVALID, SETOF *IN34          BHF280
     C*                                                                   BHF280
     C***********          SETOF                     34            BHF280 136728
     C                     MOVEL'0'       WIN34   1                       136728
     C*                                                                   BHF280
     C                     ELSE                            X*****6
     C*
     C**  Validate action and deal no.
     C                     EXSR #ZO                        ******6
     C/COPY WNCPYSRC,MM0089C247
     C                     END                             E*****6
     C*
     C                     END                             E****5
     C*
     C***********          SETOF                     34    ****4   S01177 136728
     C                     MOVEL'0'       WIN34            ****4          136728
     C*   Force bypass of screen write during file update                 E20989
     C*   so as to return to the F15 Loop                                 E20989
     C                     MOVE 'Y'       @@@BPS                          E20989
     C*                                                                   E20989
     C*                                                                   S01177
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP55                                           S01408
     C*                                                                   S01408
     C**  If DDACTN is A, amend the record.
     C           DDACTN    CASEQ'A'       #BFA             *****5
     C**  If DDACTN is X, authorise the record
     C           DDACTN    CASEQ'X'       #BFC             *****5
     C**  If DDACTN is D, delete the record.
     C           DDACTN    CASEQ'D'       #BFB             *****5
     C                     END                             E****5
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP56                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C                     END                             E***4          S01177
     C*                                                                   S01177
     C                     END                             E**3           S01177
     C                     MOVE *BLANKS   @@@BPS                          E20989
     C*
     C**  If F3  is input exit main processing immediately.
     C           *INKC     CABEQ'1'       #BF9             **2
     C*
     C**  If F12 is input go to select processing termination.
     C           *INKL     CABEQ'1'       #BF8             **2
     C*
     C**  If a database error has occurred end processing.
     C           *INU7     CABEQ'1'       #BF9             **2
      *                                                                   136653
      ** If *IN58 is on, reset @@ACTN to blanks.                          136653
      *                                                                   136653
     C***********          END                             E*2            136653
     C                     ELSE                                           136653
     C                     MOVE *BLANKS   @@ACTN                          136653
     C                     END                                            136653
     C*                                                                   S01241
     C*   CALL WINDOW ON ENQUIRY                                          S01241
     C/COPY WNCPYSRC,MM0089C403
     C*                                                                   S01241
     C           DDACTN    IFEQ 'E'                                       S01241
     C           *IN58     ANDNE'1'                                       S01241
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,MM0089MOV5                                           S01241
      *                                                                   S01241
     C                     EXSR #WIND                                     S01241
     C/COPY WNCPYSRC,MM0089C398
     C                     END                                            S01241
     C*                                                                   S01241
     C/COPY WNCPYSRC,MM0089C052
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C053
     C*
     C**  Tag #BF8.
     C           #BF8      TAG                             #BF8 TAG
     C*
     C**  Termination of select processing.
     C*
     C**  Reset indicator showing whether select processing is in progress
     C                     MOVE '0'       *IN45
     C*
     C**  Reset Action Code text for screen.
     C                     MOVE @LIST     DDLIST
     C*
     C**  If values should remain on the screen to indicate an external
     C**  transaction, do not blank screen fields.
     C************IN78     CABEQ'1'       #BF9                            S01434
     C           IN78      CABEQ1         #BF9                            S01434
     C*
     C**  Blank out screen fields.
     C                     EXSR #ZE
     C*                                                                   E18139
     C**  And standard deal fields                                        E18139
     C                     EXSR #ZEA                                      E18139
     C*
     C*
      * S01227 - Set up flag for use by Extended Settlements              S01227
     C                     MOVE 'Y'       PMFRST                          S01227
      *                                                                   S01227
     C           #BF9      ENDSR                           **#BF9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #BFA     -  F15 processing - amend handling.                  *
     C*                                                               *
     C* CALLS    #ZC      - Enter processing for action code A.       *
     C*          #ZL      - Displays, reads and resets screen.        *
     C******     ZA0240   - Sends a msg to the program message queue. *   S01177
     C*                                                               *
     C* CALLED BY  #BF    -  F15 processing - select screen handling. *
     C*                                                               *
     C* FLDS USED  @MSGID - Message id field.                         *
     C*                                                               *
     C*****************************************************************
     C           #BFA      BEGSR
     C*
     C**  If an error occurred in the preliminary validation, display
     C**  the error message, and proceed with the next selected record.
     C           *IN41     IFEQ '1'                        B1
     C                     EXSR #ZL                        *1
     C                     GOTO #BFA9                      *1
     C                     END                             E1
     C*
     C**  Carry out processing until a valid input has been received.
     C           *IN41     DOUEQ'0'                        B1
     C*
     C**  If a database error has occurred end processing.
     C           *INU7     CABEQ'1'       #BFA9            *1
     C*
     C**  If *IN41 is on then an amend error has occurred.
     C           *IN41     IFEQ '1'                        B*2
     C*
     C**  Enable CMD/14 to allow call to settlement screen                S01177
     C                     SETON                     53    **2            S01177
     C** Core hook for externalisation.                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP19                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C**  Process the screen.
     C                     EXSR #ZL                        **2
     C*
     C**  If F3  is input exit main processing immediately.
     C           *INKC     CABEQ'1'       #BFA9            **2
     C*
     C**  If F12 is input go to select processing termination.
     C           *INKL     CABEQ'1'       #BFA9            **2
     C*
     C**  If F14 is input display settlement screen                       S01177
     C           *INKN     IFEQ '1'                        B**3           S01177
     C                     EXSR #BE                        ***3           S01177
     C*                                                                   S01177
     C*   If F3 was pressed in settlements screen return to #BF           S01177
     C**  where the program will be terminated                            S01177
     C           *INKC     CABEQ'1'       #BFA9            ***3           S01177
     C*                                                                   S01177
     C*   F12 pressed on screen 2                                         S01177
     C***********          SETON                     33    ***3    S01177 136728
     C                     MOVEL'1'       WIN33            ***3           136728
     C                     GOTO #BFA9                      ***3           S01177
     C*                                                                   S01177
     C                     END                             E**3           S01177
     C*                                                                   S01177
     C**  If the action code is now E, cease amend processing
     C**  for this record and display next selected deal, if any          S01177
     C           DDACTN    CABEQ'E'       #BFA9            **2
     C*
     C**  If the action code is has been changed from 'A' seton *IN34     S01177
     C**  so that it can be re-validated in the #BF loop and if valid     S01177
     C**  (i.e. it has been changed to 'X' or 'D') the appropriate        S01177
     C**  authorise or delete sub-routine will be executed                S01177
     C           DDACTN    IFNE 'A'                        B**3
     C***********          SETON                     34    ***3    S01177 136728
     C                     MOVEL'1'       WIN34            ***3           136728
     C                     GOTO #BFA9                      ***3           S01177
     C*
     C****Set up error output for screen.                                 S01177
     C*****                MOVE '1'       *IN01            ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                MOVEL'MMM1008' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C                     END                             E**3
     C                     END                             E*2
     C*                                                    *1
     C**  Process the input to the screen - amend processing.
     C                     EXSR #ZC                        *1
     C                     END                             E1
     C*
     C           #BFA9     ENDSR                           **#BFA9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #BFB     -  F15 processing - delete handling.                 *
     C*                                                               *
     C* CALLS    #ZB      - Enter processing for action code D.       *
     C*          #ZL      - Displays, reads and resets screen.        *
     C*          #ZM      - F10 processing.                           *
     C*                                                               *
     C* CALLED BY  #BF    -  F15 processing - select screen handling. *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #BFB      BEGSR
     C*
     C**  If an error occurred in the preliminary validation, display
     C**  the error message, and proceed with the next selected record.
     C           *IN41     IFEQ '1'                        B1
     C                     EXSR #ZL                        *1
     C                     GOTO #BFB9                      *1
     C                     END                             E1
     C*
     C**  Carry out processing until a valid input has been received.
     C           *IN42     DOUEQ'1'                        B1
     C           *IN42     IFNE '1'                        B*2            S01177
     C*
     C**  Process the input to the screen - delete processing.
     C                     EXSR #ZB                        **2
     C/COPY WNCPYSRC,MM0089C442
     C*
     C**  Enable CMD/14 to allow call to settlement screen                S01177
     C                     SETON                     53    **2            S01177
     C** Core hook for externalisation.                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP19                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C**  Process the screen.
     C                     EXSR #ZL                        **2
     C*
     C                     END                             E*2            S01177
     C*                                                                   S01177
     C**  If F3  is input exit main processing immediately.
     C           *INKC     CABEQ'1'       #BFB9            *1
     C*
     C**  If F12 is input go to select processing termination.
     C           *INKL     CABEQ'1'       #BFB9            *1
     C*
     C**  If F14 is input display settlement screen                       S01177
     C           *INKN     IFEQ '1'                        B*2            S01177
     C                     EXSR #BE                        **2            S01177
     C*                                                                   S01177
     C*   If F3 was pressed in settlements screen return to #BF           S01177
     C**  where the program is terminated                                 S01177
     C*                                                                   S01177
     C           *INKC     CABEQ'1'       #BFB9            **2            S01177
     C*                                                                   S01177
     C*   F12 pressed on screen 2 - RE-DISPLAY SCREEN 1 WITH PROMPT       S01177
     C***********          SETON                     33    **2     S01177 136728
     C                     MOVEL'1'       WIN33            **2            136728
     C                     GOTO #BFB9                      **2            S01177
     C*                                                                   S01177
     C                     END                             E*2            S01177
     C*                                                                   S01177
     C**  If F10 is input carry out F10 processing.   .
     C           *INKJ     IFEQ '1'                        B*2
     C*
     C**  Process F10.
     C                     EXSR #ZM                        **2
     C*
     C**  If a database error has occurred end processing.
     C           *INU7     CABEQ'1'       #BFB9            **2
     C*
     C**  If *IN01 is off, the deletion has been successful.
     C           *IN01     CABEQ'0'       #BFB9            **2
     C*
     C**  Process the screen.
     C                     EXSR #ZL                        **2
     C*
     C**  If F3 is input exit main processing immediately.
     C           *INKC     CABEQ'1'       #BFB9            **2
     C*
     C**  If F12 is input go to select processing termination.
     C           *INKL     CABEQ'1'       #BFB9            **2
     C*
     C                     END                             E*2
     C*
     C**  If the action code is now E, cease delete processing
     C**  for this record.
     C*                                                                   S01177
     C**  If the action code is has been changed from 'D' seton *IN14     S01177
     C**  so that it can be re-validated in the #BF loop and if valid     S01177
     C**  (i.e. it has been changed to 'A' or 'X' or 'E' the              S01177
     C**  appropriate amend or authorise sub-routine will be executed     S01177
     C**  or the next selected deal (if any) will be displayed            S01177
     C*                                                                   S01177
     C*****      DDACTN    CABEQ'E'       #BFB9            *1             S01177
     C           DDACTN    IFNE 'D'                        B*2            S01177
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP63                                           S01408
     C*                                                                   S01408
     C***********          SETON                     34    **2     S01177 136728
     C                     MOVEL'1'       WIN34            **2            136728
     C                     MOVE '0'       *IN42            **2            S01177
     C                     GOTO #BFB9                      **2            S01177
     C                     END                             E*2            S01177
     C*
     C                     END                             E1
     C*
     C                     MOVE '0'       *IN42                           S01177
     C*                                                                   S01177
     C           #BFB9     ENDSR                           **#BFB9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #BFC     -  F15 processing - authorise handling.              *
     C*                                                               *
     C* CALLS    #ZL      - Displays, reads and resets screen.        *
     C*          #ZP      - Enter processing for action code X.       *
     C*          ZA0240   - Sends a msg to the program message queue. *
     C*                                                               *
     C* CALLED BY  #BF    -  F15 processing - select screen handling. *
     C*                                                               *
     C* FLDS USED  @MSGID - Message id field.                         *
     C*                                                               *
     C*****************************************************************
     C           #BFC      BEGSR
     C*                                                                   S01177
     C**  use *IN35 to show that confirmation prompting has been called   S01177
     C**  from SELECT processing. If F12 is pressed in response to a      S01177
     C**  confirmation request the deal will be redisplayed with an       S01177
     C**  action code of 'E'.                                             S01177
     C***********          SETON                     35            S01177 136728
     C                     MOVEL'1'       WIN35                           136728
     C*
     C**  If an error occurred in the preliminary validation, display
     C**  the error message, and proceed with the next selected record.
     C           *IN41     IFEQ '1'                        B1
     C                     EXSR #ZL                        *1
     C                     GOTO #BFC9                      *1
     C                     END                             E1
     C*
     C**  Carry out processing until a valid input has been received.
     C           *IN41     DOUEQ'0'                        B1
     C*
     C**  If a database error has occurred end processing.
     C           *INU7     CABEQ'1'       #BFC9            *1
     C*
     C**  If *IN41 is on then an amend error has occurred.
     C           *IN41     IFEQ '1'                        B*2
     C*
     C**  Enable CMD/14 to allow call to settlement screen                S01177
     C                     SETON                     53    **2            S01177
     C** Core hook for externalisation.                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP19                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C**  Process the screen.
     C                     EXSR #ZL                        **2
     C*
     C**  If F3 is input exit main processing immediately.
     C           *INKC     CABEQ'1'       #BFC9            **2
     C*
     C**  If F12 is input go to select processing termination.
     C           *INKL     CABEQ'1'       #BFC9            **2
     C*
     C**  If F14 is input display settlement screen                       S01177
     C           *INKN     IFEQ '1'                        B**3           S01177
     C                     EXSR #BE                        ***3           S01177
     C*                                                                   S01177
     C*   If F3 was pressed in settlements screen, exit                   S01177
     C           *INKC     CABEQ'1'       #BFC9            ***3           S01177
     C*                                                                   S01177
     C*   F12 pressed on screen 2                                         S01177
     C***********          SETON                     33    ***3    S01177 136728
     C                     MOVEL'1'       WIN33            ***3           136728
     C                     GOTO #BFC9                                     S01177
     C*                                                                   S01177
     C                     END                             E**3           S01177
     C*                                                                   S01177
     C* ENTER pressed (or F12 from settlements screen)                    S01177
     C**  If the action code is now E, cease authorize processing
     C**  for this record.
     C           DDACTN    CABEQ'E'       #BFC9            **2
     C*
     C**  If the action code is has been changed from 'X' seton *IN14     S01177
     C**  so that it can be re-validated in the #BF loop and if valid     S01177
     C**  (i.e. it has been changed to 'A' or 'D') the appropriate        S01177
     C**  amend or delete sub-routine will be executed                    S01177
     C           DDACTN    IFNE 'X'                        B**3
     C***********          SETON                     34    ***3    S01177 136728
     C                     MOVEL'1'       WIN34            ***3           136728
     C                     GOTO #BFC9                      ***3           S01177
     C*
     C*****et up error output for screen.                                 S01177
     C*****                MOVE '1'       *IN01            ***3           S01177
     C*****                MOVE '1'       *IN41            ***3           S01177
     C*****                MOVEL'MMM1008' @MSGID           ***3           S01177
     C*****                CALL 'ZA0240'                   ***3           S01177
     C*****                PARM           @MSGID           ***3           S01177
     C*
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*                                                    *1
     C**  Process the input to the screen - amend processing.
     C                     EXSR #ZP                        *1
     C*
     C                     END                             E1
     C*
     C           #BFC9     ENDSR                           **#BFC9**
      *****************************************************************   S01184
      /EJECT                                                              S01184
      *****************************************************************   S01184
      *                                                               *   S01184
      * #FEED    - Extract feedback information when CONFIRMATION     *   S01184
      *            MATCHING module present                            *   S01184
      *                                                               *   S01184
      * CALLS             - None                                      *   S01184
      *                                                               *   S01184
      * CALLED BY  #ZD    - move file to store                        *   S01184
      *            #BF    - F15 processing                            *   S01184
      *                                                               *   S01184
      * FLDS USED         -                                           *   S01184
      *                                                               *   S01184
      *****************************************************************   S01184
     C           #FEED     BEGSR                                          S01184
     C*                                                                   S01184
     C* Set on CONFIRMATION MATCHING present indicator                    S01184
     C                     MOVE '1'       *IN92                           S01184
     C*                                                                   S01184
     C* Set off Broker involved indicator                                 S01184
     C                     MOVE '0'       *IN64                           S01184
     C*                                                                   S01184
     C* BROKER?                                                           S01184
     C           HKBKCD    IFEQ 'PHON'                                    S01184
     C           HKBKCD    OREQ 'TELX'                                    S01184
     C           HKBKCD    OREQ 'MAIL'                                    S01184
     C           HKBKCD    OREQ 'SWAP'                                    S01184
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C125                                           S01408
     C*                                                                   S01408
     C                     MOVE '1'       *IN64                           S01184
     C                     END                                            S01184
     C*                                                                   S01184
     C                     MOVE *BLANKS   @CTXT  15                       S01184
     C                     MOVE *BLANKS   @BTXT  15                       S01184
     C***********          MOVE *BLANKS   @WRK7   7                S01184 060779
     C***********          MOVE *BLANKS   @WRK10 10                S01184 060779
     C                     MOVE *BLANKS   @WRK8   8                       060779
     C                     MOVE *BLANKS   @WRK11 11                       060779
     C*                                                                   S01184
     C* Get most recent FEEDBACK record for deal                          S01184
     C***********          MOVEL'D'       @WRK7                    S01184 060779
     C***********          MOVE DDDLNO    @WRK7                    S01184 060779
     C***********          MOVEL@WRK7     @WRK10                   S01184 060779
     C***********          MOVE '999'     @WRK10                   S01184 060779
     C***********          MOVEL@WRK10    @REF   16                S01184 060779
     C*                                                                   060779
     C                     MOVEL'DL'      @WRK8                           060779
     C                     MOVE DDDLNO    @WRK8                           060779
     C                     MOVEL@WRK8     @WRK11                          060779
     C                     MOVE '999'     @WRK11                          060779
     C                     MOVEL@WRK11    @REF   16                       060779
     C           @REF      SETGTCFFEEDL0                                  S01184
      *                                                                   S01314
      ** Save value of *in37 as it is used elsewhere                      S01314
      *                                                                   S01314
     C                     MOVE *IN37     IN37    1                       S01314
     C                     READPCFFEEDL0                 37               S01184
     C           *IN37     IFEQ '0'                                       S01184
     C***********          MOVELIMRF      @@7     7                S01184 060779
     C***********@WRK7     COMP @@7                  3737          S01184 060779
     C                     MOVELIMRF      @@8     8                       060779
     C           @WRK8     COMP @@8                  3737                 060779
     C                     END                                            S01184
     C*                                                                   S01184
     C* if no record with DEAL key SET STATUSES TO 00 NO FEEDBACK YET     S01184
     C           *IN37     IFEQ '1'                                       S01184
     C                     MOVE '00'      @CPST   2                       S01184
     C                     MOVE '00'      @BKST   2                       S01184
     C                     ELSE                                           S01184
     C                     MOVE CPSX      @CPST                           S01184
     C                     MOVE BKSX      @BKST                           S01184
     C                     END                                            S01184
      *                                                                   S01314
      ** Restore value of *in37 as it is used elsewhere                   S01314
      *                                                                   S01314
     C                     MOVE IN37      *IN37                           S01314
     C*                                                                   S01184
     C* F15 (and #ZD not called by F15), set up STATUS CODES only, exit   S01184
     C           *IN45     IFEQ '1'                                       S01184
     C           *IN93     ANDEQ'0'                                       S01184
     C                     MOVE *BLANKS   @WRK5   5                       S01184
     C                     MOVE *BLANKS   @WRK6   6                       S01184
     C                     MOVEL@CPST     @WRK5                           S01184
     C           *IN64     IFEQ '1'                                       S01184
     C                     MOVE *BLANKS   @BKST                           S01184
     C                     END                                            S01184
     C                     MOVE @BKST     @WRK5                           S01184
     C                     MOVE *BLANKS   DDTEXT                          S01184
     C                     MOVE @WRK5     @WRK6                           S01184
     C                     MOVEL@WRK6     DDTEXT                          S01184
     C                     MOVE DDTEXT    @TEXT                           S01184
     C                     GOTO #FEED9                                    S01184
     C                     END                                            S01184
     C*                                                                   S01184
     C* Not F15 so find associated STATUS TEXT for counterparty           S01184
      *                                                                   S01314
      ** Save value of *in76 as it is used elsewhere                      S01314
      *                                                                   S01314
     C                     MOVE *IN76     IN76    1                       S01314
     C           @CPST     LOKUPTABA      TABB           76               S01184
     C                     MOVELTABB      DDCPTY                          S01184
     C                     MOVELDDCPTY    @CPTY                           S01184
     C*                                                                   S01184
     C* If Broker involved                                                S01184
     C************IN36     IFEQ '0'                                S01184 095180
     C           *IN64     IFEQ '0'                                       095180
     C           @BKST     LOKUPTABA      TABB           76               S01184
     C                     MOVELTABB      DDBROK                          S01184
     C                     MOVELDDBROK    @BROK                           S01184
     C                     END                                            S01184
      *                                                                   S01184
     C                     MOVE '0'       *IN93                           S01184
      *                                                                   S01314
      ** Restore value of *in76 as it is used elsewhere                   S01314
      *                                                                   S01314
     C                     MOVE IN76      *IN76                           S01314
      *                                                                   S01184
     C           #FEED9    ENDSR                           #FEED TAG      S01184
      *****************************************************************   S01184
      /COPY ZSRSRC,ZACCH                                                  S01195
      *
      /COPY ZSRSRC,ZCHKH                                                  S01195
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #A       - Initial processing.                                *
     C*                                                               *
     C* CALLS    #ZE      - Clears all screen fields.                 *
     C*          #ZEA     - Clear standard deal                       *   E18139
     C***********MM0031***-*Add*member*to*standard*deals*file*fmts.*******S01319
     C***********QCAEXEC**-*Perform*CL*command.************************   E20774
     C***********QCMDEXC**-*Perform*CL*command.*********************E20774S01319
     C***********ZA0150   - Access installation control data file.    *   S01194
     C*                                                               *
     C* CALLED BY  MAIN   - Top level of program.                     *
     C*                                                               *
     C* FLDS USED  @ACTN  - Stored version of DDACTN.                 *
     C*            @DLNO  - Stored version of DDDLNO.                 *
     C*            @TYPE  - Stored version of DDTYPE.                 *
     C*            @STYP  - Stored version of DDSTYP.                 *
     C*            @DLDT  - Stored version of DDDLDT.                 *
     C*****        @BRCD  - Stored version of DDBRCD.                 *   S01117
     C*            @BRCA  - Stored version of DDBRCA.                 *   S01117
     C*            @BKCD  - Stored version of DDBKCD.                 *
     C*            @BRKG  - Stored version of DDBRKG.                 *
     C*            @DADN  - Stored version of DDDADN.                 *
     C*            @CUST  - Stored version of DDCUST.                 *
     C*            @VDAT  - Stored version of DDVDAT.                 *
     C*            @MDAT  - Stored version of DDMDAT.                 *
     C*            @NTCE  - Stored version of DDNTCE.                 *
     C*************@FCLY**-*Stored*version*of*DDFCLY.******************   E25515
     C*            @ACSQ  - Stored version of DDACSQ.                 *
     C*            @CCY   - Stored version of DDCCY.                  *
     C*            @AMNP  - Stored version of DDAMNP.                 *
     C*            @BRAT  - Stored version of DDBRAT.                 *
     C*            @BSRC  - Stored version of DDBSRC.                 *
     C*            @SPRT  - Stored version of DDSPRT.                 *
     C*            @ICMT  - Stored version of DDICMT.                 *
     C*            @NGVI  - Stored version of DDNGVI.                 *
     C*            @IPFQ  - Stored version of DDIPFQ.                 *
     C*            @NDAT  - Stored version of DDNDAT.                 *
     C*            @TOTI  - Stored version of DDTOTI.                 *
     C*            @IPDM  - Stored version of DDIPDM.                 *
     C*            @CPTI  - Stored version of DDCPTI.                 *
     C*            @MTAX  - Stored version of DDMTAX.                 *
     C*            @CDRF  - Stored version of DDCDRF.                 *
     C*            @CDCH  - Stored version of DDCDCH.                 *
     C*            @FUID  - Stored version of DDFUID                  *   S01392
     C*            @FLID  - Stored version of DDFLID                  *   S01392
     C*            @RDFC  - Stored version of DDRDFC                  *   S01392
     C*            @ORBR  - stored originating branch                 *   S01117
     C*            @PRFC  - stored profit centre                      *   S01117
     C******       @ORCM  - Stored version of DDORCM.                 *   S01177
     C******       @MOPM  - Stored version of DDMOPM.                 *   S01177
     C******       @MORI  - Stored version of DDMORI.                 *   S01177
     C******       @MOPI  - Stored version of DDMOPI.                 *   S01177
     C******       @MCPI  - Stored version of DDMCPI.                 *   S01177
     C******       @MCRI  - Stored version of DDMCRI.                 *   S01177
     C******       @MFAO  - Stored version of DDMFAO.                 *   S01177
     C******       @SPEC  - Stored version of DDSPEC.                 *   S01177
     C*            @RSTM  - stored rcpt settlement method             *   S01177
     C*            @RONS  - stored rcpt our nostro                    *   S01177
     C*            @RIBN  - stored rcpt intermed bank no.             *   S01177
     C*            @RIBA  - stored rcpt intermed bank a/c line        *   S01177
     C*            @ROBN  - stored rcpt ordering bank no.             *   S01177
     C*            @ROCN  - stored rcpt ordering customer no.         *   S01177
     C*            @PSTM  - stored pay settlement method              *   S01177
     C*            @PONS  - stored pay our nostro                     *   S01177
     C*            @PIBN  - stored pay intermed bank no.              *   S01177
     C*            @PIBA  - stored pay intermed bank a/c line         *   S01177
     C*            @POBN  - stored pay ordering bank no.              *   S01177
     C*            @POCN  - stored pay ordering customer no.          *   S01177
     C*            @RCRN  - stored receiver correspondant no.         *   S01177
     C*            @RCRA  - stored receiver corr a/c line             *   S01177
     C*            @RVNO  - stored receiver no.                       *   S01177
     C*            @AWBN  - stored a/c with bank no.                  *   S01177
     C*            @AWBA  - stored a/c with bank a/c line             *   S01177
     C*            @BENN  - stored beneficiary no.                    *   S01177
     C*            @BENA  - stored beneficiary a/c line               *   S01177
     C*            @DTP1  - stored details of payment 1               *   S01177
     C*            @DTP2  - stored details of payment 2               *   S01177
     C*            @DTP3  - stored details of payment 3               *   S01177
     C*            @DTP4  - stored details of payment 4               *   S01177
     C*            @DCHG  - stored details of charges                 *   S01177
     C*            @BTB1  - stored bank to bank info 1                *   S01177
     C*            @BTB2  - stored bank to bank info 2                *   S01177
     C*            @BTB3  - stored bank to bank info 3                *   S01177
     C*            @BTB4  - stored bank to bank info 4                *   S01177
     C*            @BTB5  - stored bank to bank info 5                *   S01177
     C*            @BTB6  - stored bank to bank info 6                *   S01177
     C*            @CVMR  - cover MT202 required                      *   E22405
     C*            @DLNO  - stored deal number                        *   S01177
     C*            @BOKC  - Stored version of DDBOKC.                 *   S01165
     C*            @LNKN  - Stored version of DDLNKN.                 *   S01165
     C*            @DRID  - Stored version of DDDRID.                 *   S01176
     C*            @DDMR  - Stored version of DDDDMR.                 *   S01176
     C*            @MSGID - Message id field.                         *
     C*            @TEST  - Field to test numeric fields' right byte. *
     C*            @DLKEY - Numeric key to deal file.                 *
     C*            @IADT  - Interst accrual date.                     *
     C*            @LIDT  - Last interest date.                       *
     C*            @DLUP  - Stored day of last update.                *
     C*            @MLUP  - Stored month of last update.              *
     C*            @YLUP  - Stored year of last update.               *
     C*            @TLUP  - Stred time of last update.                *
     C*            @STS   - Future status of deal.                    *
     C*            @DSTS  - Present status of deal.                   *
     C*            @TDYNO - Transaction date day no.                  *
     C*            @DAT   - Date.(DDMMYY or MMDDYY).                  *
     C*            @RTCDE - Return code.                              *
     C*            @DAYNO - MIDAS day no.                             *
     C*            @WK1   - Work field.                               *
     C*            @VDYNO - Value date day no.                        *
     C*            @MDYNO - Maturity date (MIDAS day no.)             *
     C*            @IADYN - Interest accrual date (MIDAS day no.)     *
     C*            @LIDYN - Last interest date (MIDAS day no.)        *
     C*            @DA38  - Deal no for DEAM.                         *
     C*            @DMVD  - DEAM value date.                          *
     C*            @DMDYN - DEAM value date (MIDAS day no.)           *
     C*****        @BRCD1 - Alpha version of branch code.             *   S01117
     C*            @BRCA1 - Alpha version of branch code.             *   S01117
     C*            @ACSQN - Numeric version of account sequence no.   *
     C*            @RATE  - Interest field.                           *
     C*            @SPRD  - Interest spread.                          *
     C*            @NDYNO - Next interest date (MIDAS day no.)        *
     C*            @NTCEN - Numeric version of stored notice days.    *
     C*            @NTCNM - Numeric version of input notice days.     *
     C*            @DIFI  - Difference between input and calc. rate.  *
     C*            @WK151 - Work field (15,1)                         *
     C*            @WK152 - Work field (15,2)                         *
     C*            @WK153 - Work field (15,3)                         *
     C*            @WK20  - Work field (20A)                          *
     C*            @EDAT  - Event date.                               *
     C*            @ENAM  - Event name.                               *
     C*            @EFLG  - Event flag.                               *
     C*            @SMT   - Settlement method.                        *
     C*            @PRIND - Pay/receive indicator.                    *
     C*            @THEIR - Their instructions.                       *
     C*            @OUR   - Our instructions.                         *
     C*            @FORAC - For the account of.                       *
     C*            @XCUST - Stored customer number.                   *
     C*            @VALD  - Value date.                               *
     C*            @DMTD  - Default settlement method.                *
     C*            @TEMP  - Work field.                               *
     C*            @8     - Work field.                               *
     C*            @TEMP3 - Work field.                               *
     C*            @TEMP2 - Work field.                               *
     C*            @TEMP5 - Work field.                               *
     C*            @X1    - Work field.                               *
     C*            @TEN   - Flag to indicate our instr. are 10N.      *
     C*            @TEND  - Field to hold 10 long our instructions.   *
     C*            @TWLV  - Flag to indicate our instr. are 12N.      *
     C*            @T11   - Work field.                               *
     C*            @REKEY - Key to the FDRETALL file.                 *
     C*            @RET   - Flag to indicate FDRETALL read.           *
     C*            @ERCD  - Error code.                               *
     C*            @WK5   - Work field.                               *
     C*            @AUTO  - Auto deal number indicator.               *
     C*            @DKEY  - Numeric key to deal file for related.     *
     C*            @WK11  - Work field.                               *
     C*            @WK22  - Work field.                               *
     C*            @@CCY  - Currency code.                            *
     C*            @5     - Work field.                               *
     C*            @2     - Work field.                               *
     C*            @DATAA - Field used to set up @DATA.               *
     C*************@BOF***-*Called*from*back*office*field.****************S01319
     C*            @TDIN  - This deal indicator.                      *
     C*            @LIST  - Action codes allowed text for screen.     *
     C*            @RRN   - Screen sub-file relative record no.       *
     C*            @COUNT - Screen sub-file record counter.           *
     C*            @TOTL  - Interest and amount of rolled over deal.  *
     C*            @TOTIN - Total interest  field.                    *
     C*            @WK25  - Work field.                               *
     C*            @WK5A  - Work field.                               *
     C*            @WK35  - Work field.                               *
     C*            @WK30  - Work field.                               *
     C*            @WK10  - Work field.                               *
     C*            @MRDYN - Maturity date of related deal (MIDAS)     *
     C*            @JOB   - Job description.                          *
     C*            @KEY   - Key field for MIDAS file.                 *
     C*            @USER  - User description.                         *
     C*************@USRKY*-*Key*to*MMUSERLL.******************************S01319
     C******       @CLTKY - Key to client file.                       *   S01194
     C******       @CNUM  - Customer number.                          *   S01194
     C******       @RCDT  - Sub-field of key to CLINT file.           *   S01194
     C*************@CYCCY*-*Currency*sub-field*of*FDCCCYLL*file*key.***   E13747
     C*************@CYCNM*-*Customer*number*sub-field*of*FDCCCYLL*key.*   E13747
     C*************@CYKEY*-*FDCCCYLL*file*key.*************************   E13747
     C*            @CYCCY - Currency sub-field of STDSI file key.     *   E13747
     C*            @CYCNM - Customer number sub-field of STDSI key.   *   E13747
     C*            @CTTP  - Module type sub-field of STDSI file key.  *   E13747
     C*            @CYKEY - STDSI file key.                           *   E13747
     C*************@NSCNO*-*Customer*number*sub-field*of*FDNOSTLL*key.*   E13747
     C*************@NSCCY*-*Currency*sub-field*of*FDNOSTLL*file*key.***   E13747
     C*************@NSKEY*-*FDNOSTLL*file*key.*************************   E13747
     C*************@NSP***-*Sub-field*of*FDNOSTLL*file*key.************   E13747
     C*************@ACKEY*-*ACCNT*file*key.*******************************S01319
     C*************@ACCNM*-*Customer*no.*sub-field*of*ACCNT*file*key.*****S01319
     C*************@ACCCY*-*Currency*sub-field*of*ACCNT*file*key.*********S01319
     C*************@ACCDE*-*Account*code*sub-field*of*ACCNT*file*key.*****S01319
     C*************@ACSEQ*-*Account*seq.*no.*sub-field*of*ACCNT*key.******S01319
     C*************@SNNM2*-*Sub-field*of*file*key*for*FDSNAMLL.********   E13747
     C*************@SNNM1*-*Sub-field*of*file*key*for*FDSNAMLL.********   E13747
     C*************@SNKEY*-*Key*for*file*FDSNAMLL.*********************   E13747
     C*            @DEAMN - Deal no used to access DEAMS file.        *
     C*            @VDYY  - Value date key field for DEAMS file.      *
     C*            @VDMM  - Value date key field for DEAMS file.      *
     C*            @VDDD  - Value date key field for DEAMS file.      *
     C*            @DEAMS - DEAM sequence no.                         *
     C*            @DEAMK - DEAM file key.                            *
     C*************@FCLK1*-*Sub*field*of*facility*file*key.************   E25515
     C*************@FCLK2*-*Sub*field*of*facility*file*key.************   E25515
     C*************@FCLK3*-*Sub*field*of*facility*file*key.************   E25515
     C*************@FCLK4*-*Sub*field*of*facility*file*key.************   E25515
     C*************@FCLK**-*Facility*file*key.*************************   E25515
     C*            @BRATN - Numeric version of base ccy exchange rate.*
     C*            @LLIM  - Lower limit for exchange rate.            *
     C*            @ULIM  - Upper limit for exchange rate.            *
     C*            @TERM1 - Termination parameter.                    *
     C*            @RDLN  - Deal no requiring authorisation.          *
     C*            @ERR   - Error parameter.                          *
     C*            @NOPMS - No. of parameters pgm called with.        *
     C*            @TERM  - Termination parameter.                    *
     C*************@CUID**-*Userid.***************************************S01319
     C*************@JOBNO*-*Job*number.***********************************S01319
     C*************@CJON**-*Job*number-subfield*of*@CMDV.*****************S01319
     C*************@CEND**-*Subfield*of*@CMDV.****************************S01319
     C*************@CMDV**-*Data*for*QCAEXEC*override*command.*********   E20774
     C*************@CMDV**-*Data*for*QCMDEXC*override*command.******E20774S01319
     C*************@CMD***-*Parameter*for*QCAEXEC*command.*************   E20774
     C*************@CMD***-*Parameter*for*QCMDEXC*command.**********E20774S01319
     C*************@LNTH**-*Length*of*QCAEXEC*command.*****************   E20774
     C*************@LNTH**-*Length*of*QCMDEXC*command.**************E20774S01319
     C*            @TEMT4 - Work field.                               *
     C*                                                               *
     C*****************************************************************
     C           #A        BEGSR
     C*
     C           @TERM1    IFEQ 'R'                                       S01434
     C                     MOVE 'N'       RTRN                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C                     MOVEACPY@      CPY2@  80
     C**  If a simultaneous insert has occurred, by-pass initial
     C**  processing.
     C           STATUS    CABEQ01021     #A9
     C/COPY WNCPYSRC,MM0089C148
     C*
     C**  Call #ZE to initialise the standard deal etc.
     C                     EXSR #ZE
     C                     EXSR #ZEA                                      E18139
     C*
     C**  GET ZMUSER to access default branch.                            S01117
     C**                                                                  S01117
     C/COPY WNCPYSRC,MM0089C368
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C                     UNLCKZMUSER                                    S01117
     C/COPY WNCPYSRC,MM0089C369
     C**                                                                  S01117
     C**  GET RUNDAT to access MULTI-BRANCHING flag.                      S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           RUNDAT                          S01117
     C                     IN   RUNDAT                                    S01117
     C           @MBIN     IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN36                           S01117
     C***************      MOVE '1'       *IN76                           E61
     C********             ELSE                                           E61
     C********             MOVE '0'       *IN36                           E61
     C********             MOVE '0'       *IN76                           E61
     C                     END                                            S01117
     C**                                                                  S01117
     C**  Define program work fields with reference to file fields.
     C           *LIKE     DEFN DDACTN    @ACTN
     C           *LIKE     DEFN DDDLNO    @DLNO
     C           *LIKE     DEFN DDTYPE    @TYPE
     C           *LIKE     DEFN DDSTYP    @STYP
     C           *LIKE     DEFN DDDLDT    @DLDT
     C*****      *LIKE     DEFN DDBRCD    @BRCD                           S01117
     C           *LIKE     DEFN DDBRCA    @BRCA                           S01117
     C           *LIKE     DEFN DDBKCD    @BKCD
     C           *LIKE     DEFN DDBRKG    @BRKG
     C           *LIKE     DEFN DDDADN    @DADN
     C           *LIKE     DEFN DDCUST    @CUST
     C           *LIKE     DEFN DDVDAT    @VDAT
     C           *LIKE     DEFN DDMDAT    @MDAT
     C/COPY WNCPYSRC,MM0089C220
     C           *LIKE     DEFN DDNTCE    @NTCE
     C************LIKE     DEFN DDFCLY    @FCLY                           E25515
     C           *LIKE     DEFN DDACSQ    @ACSQ
     C           *LIKE     DEFN DDCCY     @CCY
     C           *LIKE     DEFN DDAMNP    @AMNP
     C           *LIKE     DEFN DDBRAT    @BRAT
     C           *LIKE     DEFN DDBSRC    @BSRC
     C           *LIKE     DEFN DDSPRT    @SPRT
     C           *LIKE     DEFN DDICMT    @ICMT
     C           *LIKE     DEFN DDNGVI    @NGVI
     C           *LIKE     DEFN DDIPFQ    @IPFQ
     C           *LIKE     DEFN DDNDAT    @NDAT
     C           *LIKE     DEFN DDTOTI    @TOTI
     C           *LIKE     DEFN DDIPDM    @IPDM
     C           *LIKE     DEFN DDCPTI    @CPTI
     C           *LIKE     DEFN DDMTAX    @MTAX
     C           *LIKE     DEFN DDCDRF    @CDRF
     C           *LIKE     DEFN DDCDCH    @CDCH
     C           *LIKE     DEFN DDFUID    @FUID                           S01392
     C           *LIKE     DEFN DDFLID    @FLID                           S01392
     C           *LIKE     DEFN DDRDFC    @RDFC                           S01392
     C           *LIKE     DEFN DDRDFC    BRRDFC                          S01392
     C           *LIKE     DEFN DDRDFC    CYRDFC                          S01392
     C           *LIKE     DEFN DDCPTY    @CPTY                           S01184
     C           *LIKE     DEFN DDBROK    @BROK                           S01184
     C           *LIKE     DEFN DDTEXT    @TEXT                           S01184
     C           *LIKE     DEFN DDORBR    @ORBR                           S01117
     C           *LIKE     DEFN DDPRFC    @PRFC                           S01117
     C           *LIKE     DEFN DDAURO    @AURO                           S01434
     C           *LIKE     DEFN DDIPDS    @IPDS                           S01434
     C           *LIKE     DEFN DDROFQ    @ROFQ                           S01434
     C           *LIKE     DEFN DDRLDN    @RLDN                           S01434
     C           *LIKE     DEFN DDIMET    @IMET                           S01434
     C           *LIKE     DEFN DDINSA    @INSA                           S01434
     C           *LIKE     DEFN DDINOS    @INOS                           S01434
     C           *LIKE     DEFN DDCNNA    @CNNA                           S01434
     C*****      *LIKE     DEFN DDORCM    @ORCM                           S01177
     C*****      *LIKE     DEFN DDMOPM    @MOPM                           S01177
     C*****      *LIKE     DEFN DDMORI    @MORI                           S01177
     C*****      *LIKE     DEFN DDMOPI    @MOPI                           S01177
     C*****      *LIKE     DEFN DDMCPI    @MCPI                           S01177
     C*****      *LIKE     DEFN DDMCRI    @MCRI                           S01177
     C*****      *LIKE     DEFN DDMFAO    @MFAO                           S01177
     C*****      *LIKE     DEFN DDSPEC    @SPEC                           S01177
     C           *LIKE     DEFN PMRSTM    @RSTM                           S01177
     C           *LIKE     DEFN PMRONS    @RONS                           S01177
     C           *LIKE     DEFN PARIBN    @RIBN                           S01177
     C           *LIKE     DEFN PMRIBA    @RIBA                           S01177
     C           *LIKE     DEFN PAROBN    @ROBN                           S01177
     C           *LIKE     DEFN PAROCN    @ROCN                           S01177
     C           *LIKE     DEFN PMPSTM    @PSTM                           S01177
     C           *LIKE     DEFN PMPONS    @PONS                           S01177
     C           *LIKE     DEFN PAPIBN    @PIBN                           S01177
     C           *LIKE     DEFN PMPIBA    @PIBA                           S01177
     C           *LIKE     DEFN PAPOBN    @POBN                           S01177
     C           *LIKE     DEFN PAPOCN    @POCN                           S01177
     C           *LIKE     DEFN PARCRN    @RCRN                           S01177
     C           *LIKE     DEFN PMRCRA    @RCRA                           S01177
     C           *LIKE     DEFN PARVNO    @RVNO                           S01177
     C           *LIKE     DEFN PAAWBN    @AWBN                           S01177
     C           *LIKE     DEFN PMAWBA    @AWBA                           S01177
     C           *LIKE     DEFN PABENN    @BENN                           S01177
     C           *LIKE     DEFN PMBENA    @BENA                           S01177
     C           *LIKE     DEFN PMDTP1    @DTP1                           S01177
     C           *LIKE     DEFN PMDTP1    @DTP2                           S01177
     C           *LIKE     DEFN PMDTP1    @DTP3                           S01177
     C           *LIKE     DEFN PMDTP1    @DTP4                           S01177
     C           *LIKE     DEFN PMDCHG    @DCHG                           S01177
     C           *LIKE     DEFN PMBTB1    @BTB1                           S01177
     C           *LIKE     DEFN PMBTB1    @BTB2                           S01177
     C           *LIKE     DEFN PMBTB1    @BTB3                           S01177
     C           *LIKE     DEFN PMBTB1    @BTB4                           S01177
     C           *LIKE     DEFN PMBTB1    @BTB5                           S01177
     C           *LIKE     DEFN PMBTB1    @BTB6                           S01177
     C           *LIKE     DEFN PMCVMR    @CVMR                           E22405
     C           *LIKE     DEFN PMPOBR    @POBR                           S01117
     C           *LIKE     DEFN PMROBR    @ROBR                           S01117
     C           *LIKE     DEFN DDBOKC    @BOKC                           S01165
     C           *LIKE     DEFN DDLNKN    @LNKN                           S01165
     C           *LIKE     DEFN DDDRID    @DRID                           S01176
     C           *LIKE     DEFN DDDDMR    @DDMR                           S01176
     C           *LIKE     DEFN DDRACD    @RACD                           AUS007
     C           *LIKE     DEFN DDRACD    @@RACD                          AUS007
     C*
     C**  Define program work fields.
     C                     MOVE *BLANKS   @MSGID 10
     C                     MOVE *BLANKS   @TEST   1
     C           *LIKE     DEFN HKDN38    @DLKEY
     C                     Z-ADD0         @IADT   60
     C                     Z-ADD0         @LIDT   60
     C           *LIKE     DEFN HKDLUP    @DLUP
     C           *LIKE     DEFN HKMLUP    @MLUP
     C           *LIKE     DEFN HKYLUP    @YLUP
     C           *LIKE     DEFN HKTLUP    @TLUP
     C           *LIKE     DEFN HKDSTS    @STS
     C           *LIKE     DEFN HKDSTS    @DSTS
     C           *LIKE     DEFN HKLCD     @TDYNO
     C                     Z-ADD0         @DAT    60
     C                     MOVE *BLANKS   @RTCDE  1
     C           *LIKE     DEFN HKLCD     @DAYNO
     C                     MOVE *BLANKS   @WK1    3
     C           *LIKE     DEFN HKLCD     @VDYNO
     C           *LIKE     DEFN HKLCD     @MDYNO
     C           *LIKE     DEFN HKLCD     @IADYN
     C           *LIKE     DEFN HKLCD     @LIDYN
     C           *LIKE     DEFN DDDLNO    @DA38
     C                     Z-ADD0         @DMVD   60
     C           *LIKE     DEFN HKLCD     @DMDYN
     C*****      *LIKE     DEFN @BRCD     @BRCD1                          S01117
     C           *LIKE     DEFN @BRCA     @BRCA1                          S01117
     C           *LIKE     DEFN HKACSQ    @ACSQN
     C           *LIKE     DEFN HKINTR    @RATE
     C           *LIKE     DEFN HKINTR    @SPRD
     C           *LIKE     DEFN HKLCD     @NDYNO
     C/COPY WNCPYSRC,MM0089C035
     C           *LIKE     DEFN HKFEDF    @FEDF
     C/COPY WNCPYSRC,MM0089C036
     C           *LIKE     DEFN HKNTCE    @NTCEN
     C           *LIKE     DEFN HKPTFR    @PTFR                           S01486
     C           *LIKE     DEFN HKAMNP    @DIFI
     C                     Z-ADD0         @WK151 151
     C                     Z-ADD0         @WK152 152
     C                     Z-ADD0         @WK153 153
     C           *LIKE     DEFN HKIPDM    @WK20
     C           *LIKE     DEFN HKLCD     @EDAT
     C                     MOVE *BLANKS   @ENAM  20
     C                     MOVE *BLANKS   @EFLG   1
     C                     MOVE *BLANKS   @SMT    2
     C                     MOVE *BLANKS   @PRIND  1
     C*********************MOVE**BLANKS***@THEIR*10***********************S01319
     C*********************MOVE**BLANKS***@OUR***12***********************S01319
     C                     MOVE *BLANKS   @FORAC 10
     C                     MOVE *BLANKS   @SPECI 35                       E13747
     C                     MOVE *BLANKS   @XCUST 10
     C                     MOVE *BLANKS   @VALD   6
     C                     MOVE *BLANKS   @DMTD   2
     C                     MOVE *BLANKS   @TEMP   6
     C                     MOVE *BLANKS   @8      8
     C                     MOVE *BLANKS   @TEMP3  5
     C           *LIKE     DEFN HKMOPM    @TEMP2
     C                     Z-ADD0         @TEMP5  60
     C                     MOVE *BLANKS   @X1     2
     C                     MOVE *BLANKS   @TEN    1
     C                     Z-ADD0         @TEND  100
     C                     Z-ADD0         @TWLV  120
     C                     MOVE *BLANKS   @T11   15
     C                     Z-ADD0         @REKEY 100
     C                     MOVE *BLANKS   @RET    1
     C                     Z-ADD0         @ERCD   10
     C           *LIKE     DEFN HKLCD     @WK5
     C                     MOVE *BLANKS   @AUTO   1
     C           *LIKE     DEFN HKDN38    @DKEY
     C                     MOVE *BLANKS   @WK11   1
     C                     MOVE *BLANKS   @WK22   6
     C                     MOVE *BLANKS   @5      5
     C                     MOVE *BLANKS   @2      2
     C                     MOVE *BLANKS   @DATAA  9
     C*********************MOVE**BLANKS***@BOF****1***********************S01319
     C                     MOVE *BLANKS   @TDIN   1
     C                     Z-ADD0         ZZWK05  50
     C                     MOVE *BLANKS   @LIST  11
     C                     Z-ADD0         @RRN    50
     C                     Z-ADD0         @COUNT  30
     C           *LIKE     DEFN HKAMNP    @TOTL
     C           *LIKE     DEFN HKAMNP    @TOTIN
     C                     MOVE *BLANKS   @WK25  25
     C                     MOVE *BLANKS   @WK5A   5
     C                     MOVE *BLANKS   @WK35  35
     C                     MOVE *BLANKS   @WK30  30
     C                     MOVE *BLANKS   @WK10  10
     C           *LIKE     DEFN HKLCD     @MRDYN
     C***********          Z-ADD0         @ULIM  139                      115152
     C                     Z-ADD0         @ULIM  309                      115152
     C                     Z-ADD0         @LLIM  139
     C           *LIKE     DEFN HKBRAT    @BRATN
     C                     MOVE *BLANKS   @TEMT4 15
     C                     Z-ADD0         @NTCNM  30
     C*
     C**  If the program was called from range authorisation and
     C**  this is not the first call to the program, by-pass first
     C**  time processing.
     C           @NOPMS    IFEQ 3                          B1
     C           @FTMI     ANDEQ'N'                        B1
     C                     GOTO #A8                        *1
     C                     END                             E1
     C                     MOVE 'N'       @FTMI   1
     C*
     C**  Initialise screen msg queue.
     C                     MOVEL'*'       DDPGMQ
     C*
     C**  Set on Message Subfile end indicator.
     C                     MOVE '1'       *IN59
     C*
     C**  Move workstation ID to screen field.
     C                     MOVEL@JOB      DDWID
     C*
     C**  Move program name into *LDA field.
     C           *NAMVAR   DEFN           LDA                             E24039
     C           *LOCK     IN   LDA                                       E24039
     C                     MOVEL'MM0089'  DBPGM
     C                     OUT  LDA                                       E24039
     C*********************OPEN*MMSSTSLL****************************E22161S01319
     C**************************************************************E22161S01319
     C****Read*the*first*and*only*record*on*MMSSTSLL.**************E22161*S01319
     C***********1*********CHAINMMSSTSLL*************60*************E22161S01319
     C**************************************************************E22161S01319
     C****If*no*valid*record*found*then*it*is*a*data*base*error.****E22161S01319
     C************IN60*****IFEQ*'1'************************B1*******E22161S01319
     C***********H1DLTF****OREQ*'*'************************X1*******E22161S01319
     C*********************MOVE*'1'********INU7*************1*******E22161S01319
     C*********************MOVE*'1'********INU8*********************E22161S01319
     C************LOCK*****IN***LDA*********************************E24039S01319
     C*********************MOVEL'MMSSTSLL'DBFILE*************DBERRORE22161S01319
     C*********************MOVEL*BLANKS***DBKEY*********************E22161S01319
     C*********************MOVE*'015'*****DBASE*************1*******E22161S01319
     C*********************OUT**LDA*********************************E24039S01319
     C*********************MOVE*'1'********INLR*************1*******E22161S01319
     C*********************MOVE*'1'********INKC*************1*******E22161S01319
     C**************************************************************E22161S01319
     C*********************EXSR*#C**************************1*******E22161S01319
     C*********************END*****************************E1*******E22161S01319
     C**********           CALL 'AODEALR0'                                S01319              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01319
     C                     PARM '*FIRST ' @OPTN   7                       S01319
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01319              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C*
     C**  Setup user details here and write input screen while files are  E18139
     C*   being opened.                                                   E18139
     C*                                                                   E18139
     C****Open*user*details*files***********************************E18139S01319
     C*********************OPEN*MMUSERLL****************************E18139S01319
     C**************************************************************E18139S01319
     C****Get*the*user*id*from*PSDS*and*use*this*to*chain*to*the****E18139S01319
     C****user*details.*********************************************E18139S01319
     C*********************MOVEL@USER*****@USRKY**3*****************E18139S01319
     C***********@USRKY****CHAINMMUSERLL*************60*************E18139S01319
     C**************************************************************E18139S01319
     C****If*the*user*is*not*on*file*treat*user*as*if*they*are******E18139S01319
     C****not*a*Settlement*Officer*or*Authorisation*Officer*********E18139S01319
     C************IN60*****IFEQ*'1'************************B1*******E18139S01319
     C***********IQDLTF****ORNE**BLANKS*********************1*******E18139S01319
     C*********************MOVE*'N'*******IQMMSO************1*******E18139S01319
     C*********************MOVE*'N'*******IQMMAO************1*******E18139S01319
     C*********************END*****************************E1*******E18139S01319
     C*                                                                   E18139
     C**  Set up Action Code text for screen.                             E18139
     C*                                                                   E18139
     C                     MOVEL'(I,A'    DDLIST                          S01319
     C                     MOVE ',D,E,X)' DDLIST                          S01319
     C****If*the*user*is*a*settlement*officer*and*not*an*authorisatiE18139S01319
     C****officer.**************************************************E18139S01319
     C***********IQMMSO****IFEQ*'Y'************************B1*******E18139S01319
     C***********IQMMAO****ANDEQ'N'*************************1*******E18139S01319
     C*********************MOVEL'(I,A'****DDLIST************1*******E18139S01319
     C*********************MOVE*',D,E,*)'*DDLIST************1*******E18139S01319
     C*********************END*****************************E1*******E18139S01319
     C**************************************************************E18139S01319
     C****If*the*user*is*an*authorisation*officer*and*not*a*settlemeE18139S01319
     C****officer.**************************************************E18139S01319
     C***********IQMMSO****IFEQ*'N'************************B1*******E18139S01319
     C***********IQMMAO****ANDEQ'Y'*************************1*******E18139S01319
     C*********************MOVEL'(*,*'****DDLIST************1*******E18139S01319
     C*********************MOVE*',*,E,X)'*DDLIST************1*******E18139S01319
     C*********************END*****************************E1*******E18139S01319
     C**************************************************************E18139S01319
     C****If*the*user*is*an*authorisation*officer*and*a*settlements*E18139S01319
     C****officer.**************************************************E18139S01319
     C***********IQMMSO****IFEQ*'Y'************************B1*******E18139S01319
     C***********IQMMAO****ANDEQ'Y'*************************1*******E18139S01319
     C*********************MOVEL'(I,A'****DDLIST************1*******E18139S01319
     C*********************MOVE*',D,E,X)'*DDLIST************1*******E18139S01319
     C*********************END*****************************E1*******E18139S01319
     C**************************************************************E18139S01319
     C****If*the*user*is*neither*an*authorisation*or*settlements****E18139S01319
     C****officer.**************************************************E18139S01319
     C***********IQMMSO****IFEQ*'N'************************B1*******E18139S01319
     C***********IQMMAO****ANDEQ'N'*************************1*******E18139S01319
     C*********************MOVEL'(*,*'****DDLIST************1*******E18139S01319
     C*********************MOVE*',*,E,*)'*DDLIST************1*******E18139S01319
     C*********************END*****************************E1*******E18139S01319
     C*                                                                   E18139
     C**  If the back office authorization is not required, omit type     E18139
     C**  X.                                                              E18139
     C***********H1BOAR****IFEQ*'N'************************B1*******E18139S01319
     C           BNMMAU    IFEQ 'N'                        B1             S01319
     C                     MOVE ' )'      DDLIST           *1             E18139
     C                     END                             E1             E18139
     C*                                                                   E60
     C** Access General Ledger details via access program                 E60
      *  (database error handling done in access program)                 E60
     C**********           CALL 'AOGELRR0'                                E60                 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       E60
     C                     PARM '*FIRST ' @OPTN   7                       E60
     C********** SDGELR    PARM SDGELR    DSFDY                           E60                 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*
      ** CHECK PROFIT CENTRES USED FLAG                                   E61
     C           BKPRCU    IFEQ 'Y'                                       S01194
     C                     MOVE '1'       *IN37                           S01117
     C                     END                                            S01117
      *
      ** CHECK ORIGINATING BRANCH USED FLAG
     C           BKOBRU    IFEQ 'Y'                                       E61
     C           @MBIN     ANDEQ'Y'                                       S01117
     C                     MOVE '1'       *IN76                           E61
     C                     END                                            S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CCP1                                           S01408
     C*                                                                   S01408
     C*                                                                   AUS007
     C** Access SAR details file to determine if Australian Brokerage     AUS007
     C** is switched on                                                   AUS007
     C*                                                                   AUS007
     C                     CALL 'AOSARDR0'                                AUS007
     C                     PARM *BLANKS   @RTCD                           AUS007
     C                     PARM '*VERIFY' @OPTN                           AUS007
     C                     PARM 'AUS007'  @SARD   6                       AUS007
     C           SCSARD    PARM SCSARD    DSFDY                           AUS007
     C           @RTCD     IFNE *BLANKS                                   AUS007
     C           @RTCD     ANDNE'*NRF   '                                 AUS007
     C           *LOCK     IN   LDA                        ***************AUS007
     C                     MOVEL'SCSARDPD'DBFILE           * DBERROR 013 *AUS007
     C                     MOVEL'013'     DBASE            ***************AUS007
     C                     MOVEL'AUS007'  DBKEY                           AUS007
     C                     OUT  LDA                                       AUS007
     C                     SETON                     U7U8LR               AUS007
     C                     MOVE '1'       *INKC                           AUS007
     C                     EXSR #C                                        AUS007
     C                     END                                            AUS007
     C           @RTCD     IFEQ *BLANK                                    AUS007
     C                     MOVEL'Y'       AUS007  1                       AUS007
     C                     SETON                     14                   AUS007
     C                     ELSE                                           AUS007
     C                     MOVEL'N'       AUS007                          AUS007
     C                     END                                            AUS007
     C*                                                                   S01434
     C** Access SAR details file to determine if Enhanced Rollovers       S01434
     C** is switched on                                                   S01434
     C*                                                                   S01434
     C                     CALL 'AOSARDR0'                                S01434
     C                     PARM *BLANKS   @RTCD                           S01434
     C                     PARM '*VERIFY' @OPTN                           S01434
     C                     PARM 'S01434'  @SARD                           S01434
     C           SCSARD    PARM SCSARD    DSFDY                           S01434
     C           @RTCD     IFNE *BLANKS                                   S01434
     C           @RTCD     ANDNE'*NRF   '                                 S01434
     C           *LOCK     IN   LDA                        ***************S01434
     C                     MOVEL'SCSARDPD'DBFILE           * DBERROR 014 *S01434
     C                     MOVEL'014'     DBASE            ***************S01434
     C                     MOVEL'S01434'  DBKEY                           S01434
     C                     OUT  LDA                                       S01434
     C                     SETON                     U7U8LR               S01434
     C                     MOVE '1'       *INKC                           S01434
     C                     EXSR #C                                        S01434
     C                     END                                            S01434
     C           @RTCD     IFEQ *BLANK                                    S01434
     C                     MOVEL'Y'       S01434  1                       S01434
     C                     SETON                     78                   S01434
     C                     ELSE                                           S01434
     C                     MOVEL'N'       S01434                          S01434
     C                     END                                            S01434
     C*                                                                   S01468
     C** Access SAR details file to determine if S01468 (changed          S01468
     C** validation for total interest field) is on.                      S01468
     C*                                                                   S01468
     C                     CALL 'AOSARDR0'                                S01468
     C                     PARM *BLANKS   @RTCD                           S01468
     C                     PARM '*VERIFY' @OPTN                           S01468
     C                     PARM 'S01468'  @SARD                           S01468
     C           SCSARD    PARM SCSARD    DSFDY                           S01468
     C           @RTCD     IFNE *BLANKS                                   S01468
     C           @RTCD     ANDNE'*NRF   '                                 S01468
     C           *LOCK     IN   LDA                        ***************S01468
     C                     MOVEL'SCSARDPD'DBFILE           * DBERROR 020 *S01468
     C                     MOVEL'020'     DBASE            ***************S01468
     C                     MOVEL'S01468'  DBKEY                           S01468
     C                     OUT  LDA                                       S01468
     C                     SETON                     U7U8LR               S01468
     C                     MOVE '1'       *INKC                           S01468
     C                     EXSR #C                                        S01468
     C                     END                                            S01468
     C           @RTCD     IFEQ *BLANK                                    S01468
     C                     MOVEL'Y'       S01468  1                       S01468
     C                     SETON                     78                   S01468
     C                     ELSE                                           S01468
     C                     MOVEL'N'       S01468                          S01468
     C                     END                                            S01468
     C/COPY WNCPYSRC,MM0089C523
     C*                                                                   144833
     C** Access Switchable Feature Details                                144833
     C*                                                                   144833
     C                     CALL 'AOSARDR0'                                144833
     C                     PARM *BLANKS   PRTCD   7                       144833
     C                     PARM '*VERIFY 'POPTN   7                       144833
     C                     PARM 'CEU003'  PSARD   6                       144833
     C           SCSARD    PARM SCSARD    DSSDY                           144833
     C*                                                                   144833
     C           PRTCD     IFEQ *BLANKS                                   144833
     C                     MOVE 'Y'       CEU003  1                       144833
     C                     ELSE                                           144833
     C                     MOVE 'N'       CEU003                          144833
     C                     ENDIF                                          144833
     C*                                                                   144833
     C           CEU003    IFEQ 'Y'                                       144833
     C           S01434    ANDEQ'Y'                                       144833
     C                     MOVE '0'       *IN33                           144833
     C                     MOVE '0'       *IN35                           144833
     C                     ELSE                                           144833
     C                     MOVE '1'       *IN33                           144833
     C                     MOVE '1'       *IN35                           144833
     C                     ENDIF                                          144833
     C/COPY WNCPYSRC,MM0089C509
      *                                                                   144833
      ** Access AOSARDR0 to check if CEU015 is installed                  144833
      *                                                                   144833
     C                     CALL 'AOSARDR0'                                144833
     C                     PARM *BLANKS   @RTCD   7                       144833
     C                     PARM '*VERIFY' @OPTN   7                       144833
     C                     PARM 'CEU015'  @SARD   6                       144833
      *                                                                   144833
     C           @RTCD     IFNE *BLANKS                                   144833
     C           @RTCD     ANDNE'*NRF   '                                 144833
     C           *LOCK     IN   LDA                        **********     144833
     C                     MOVEL'SCSARDPD'DBFILE           *  32    *     144833
     C                     MOVEL'032'     DBASE            **********     144833
     C                     MOVEL'CEU015'  DBKEY                           144833
     C                     OUT  LDA                                       144833
     C                     SETON                     U7U8LR               144833
     C                     MOVE '1'       *INKC                           144833
     C                     EXSR #C                                        144833
     C                     ENDIF                                          144833
      *                                                                   144833
     C           @RTCD     IFEQ *BLANKS                                   144833
     C                     MOVE 'Y'       CEU015  1                       144833
     C                     ELSE                                           144833
     C                     MOVE 'N'       CEU015                          144833
     C                     END                                            144833
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP46                                           S01408
     C*                                                                   S01408
     C*                                                                   E18139
      **  Retrieve time and place in screen field.                        E18139
     C                     TIME           DDTIME                          E18139
      *                                                                   E18139
      *                                                                   E18139
     C           @NOPMS    IFNE 3                                         LN0266
     C           @TERM1    ANDNE'R'                                       S01434
     C/COPY WNCPYSRC,MM0089C074
      *                                                                   S01241
      ****Read*the*file*SDMMODPD*to*find*if*WINDOW*flag*is*on       S01241S01314
     C*********************OPEN SDMMODPD                            S01241S01314
     C***********1         SETLLSDMMODPD                            E21835S01314
     C*********************READ SDMMODPD                 60         S01241S01314
     C************IN60     IFEQ '1'                        B1       S01241S01314
     C*********************MOVE '1'       *INU7            *1       S01241S01314
     C*********************MOVE '1'       *INU8            *********S01241S01314
     C*********************MOVEL'SDMMOD'  DBFILE           * DBERRORS01241S01314
     C*********************MOVEL*BLANKS   DBKEY            *********S01241S01314
     C*********************MOVE '129'     DBASE            *1       S01241S01314
     C*********************MOVE '1'       *INLR            *1       S01241S01314
     C*********************MOVE '1'       *INKC            *1       S01241S01314
     C*********************DUMP                            *1       S01241S01314
      *********************                                *1       S01241S01314
     C*********************GOTO #A9                        *1       S01241S01314
     C*********************ELSE                            X1       S01241S01314
     C***********          MOVE BGL5ST    @5ST    1        *1       S01241S01251
     C*********************MOVE BGWDPR    @5ST    1        *1       S01251S01314
     C*********************END                             E1       S01241S01314
     C*                                                                   S01486
     C***********                                                  105817 144833
     C***Access*Switchable*Feature*Details*************************CEU003 144833
     C***********                                                  CEU003 144833
     C***********          CALL 'AOSARDR0'                         CEU003 144833
     C***********          PARM *BLANKS   PRTCD   7                CEU003 144833
     C***********          PARM '*VERIFY 'POPTN   7                CEU003 144833
     C***********          PARM 'CEU003'  PSARD   6                CEU003 144833
     C***********SCSARD    PARM SCSARD    DSSDY                    CEU003 144833
     C***********                                                  CEU003 144833
     C***********PRTCD     IFEQ *BLANKS                            CEU003 144833
     C***********          MOVE 'Y'       CEU003  1                CEU003 144833
     C***********          ELSE                                    CEU003 144833
     C***********          MOVE 'N'       CEU003                   CEU003 144833
     C***********          ENDIF                                   CEU003 144833
     C***********                                                  CEU003 144833
     C***********CEU003    IFEQ 'Y'                                CEU003 144833
     C***********S01434    ANDEQ'Y'                                CEU003 144833
     C***********          MOVE '0'       *IN32                    CEU003 136728
     C***********          MOVE '0'       *IN79                    CEU003 136728
     C***********          MOVE '0'       *IN33                    136728 144833
     C***********          MOVE '0'       *IN35                    136728 144833
     C***********          ELSE                                    CEU003 144833
     C***********          MOVE '1'       *IN32                    CEU003 136728
     C***********          MOVE '1'       *IN79                    CEU003 136728
     C***********          MOVE '1'       *IN33                    136728 144833
     C***********          MOVE '1'       *IN35                    136728 144833
     C***********          ENDIF                                   CEU003 144833
      ***********                                                  CEU015 144833
      ** Access AOSARDR0 to check if CEU015 is installed           CEU015 144833
      ***********                                                  CEU015 144833
     C***********          CALL 'AOSARDR0'                         CEU015 144833
     C***********          PARM *BLANKS   @RTCD   7                CEU015 144833
     C***********          PARM '*VERIFY' @OPTN   7                CEU015 144833
     C***********          PARM 'CEU015'  @SARD   6                CEU015 144833
      ***********                                                  CEU015 144833
     C***********@RTCD     IFNE *BLANKS                            CEU015 144833
     C***********@RTCD     ANDNE'*NRF   '                          CEU015 144833
     C************LOCK     IN   LDA                        ********CEU015 144833
     C***********          MOVEL'SCSARDPD'DBFILE           *  32   CEU015 144833
     C***********          MOVEL'032'     DBASE            ********CEU015 144833
     C***********          MOVEL'CEU015'  DBKEY                    CEU015 144833
     C***********          OUT  LDA                                CEU015 144833
     C***********          SETON                     U7U8LR        CEU015 144833
     C***********          MOVE '1'       *INKC                    CEU015 144833
     C***********          EXSR #C                                 CEU015 144833
     C***********          ENDIF                                   CEU015 144833
      ***********                                                  CEU015 144833
     C***********@RTCD     IFEQ *BLANKS                            CEU015 144833
     C***********          MOVE 'Y'       CEU015  1                CEU015 144833
     C***********          ELSE                                    CEU015 144833
     C***********          MOVE 'N'       CEU015                   CEU015 144833
     C***********          END                                     CEU015 144833
      *                                                                   105817
      ** Access SDMMODPD                                                  105817
      *                                                                   105817
     C                     CALL 'AOMMODR0'                                105817
     C                     PARM '*DBERR ' @RTCD   7                       105817
     C                     PARM '*FIRST ' @OPTN   7                       105817
     C           SDMMOD    PARM SDMMOD    DSFDY                           105817
      *                                                                   105817
     C** Protect Portfolio Ref. field if module is not present            S01486
     C** AND Private Banking is not present                               CPB001
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'N'                                       S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE '1'       *IN47                           S01486
     C                     END                                            S01486
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C127                                           S01408
     C*                                                                   S01408
      **  Write input screen                                              E18139
     C                     WRITEMM0089S0                                  E18139
     C*                                                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP13                                           S01408
     C*                                                                   S01408
     C                     WRITEMM0089D3                                  S01199
     C                     WRITEMM0089D0                                  E18139
     C/COPY WNCPYSRC,MM0089C370
      *                                                                   E18139
     C***********          SETON                     57            E18139 136728
     C                     MOVEL'1'       WIN57                           136728
     C/COPY WNCPYSRC,MM0089C190
     C                     END                                            LN0266
      *                                                                   E18139
     C**  Open all the files
     C*****                OPEN ACCNT                                     S01177
     C                     OPEN CADLFALL
     C/COPY WNCPYSRC,MM0089C191
     C*****                OPEN CLINT                                     S01194
     C***********          OPEN DEALS                                     042960
     C***********          OPEN DEALSH                             BH1059 042960
     C                     OPEN DEALSALL                                  042960
     C***********          OPEN FACIL                                     E25515
     C*****                OPEN FDBRKRLL                                  S01194
     C*****                OPEN FDBRNCLL                                  S01194
     C*****                OPEN FDBSRTLL                                  S01194
     C**********           OPEN FDCCCYLL                                  E13747
     C*****                OPEN FDCCYTLL                                  S01194
     C*****                OPEN FDCPTILL                                  S01194
     C                     OPEN SDBRTDL1                                  S01383
     C                     OPEN SDCBRTL1                                  S01383
     C                     OPEN FDDLNMLL
     C*****                OPEN FDDLSTLL                                  S01194
     C*****                OPEN FDICDRLL                                  S01194
     C*********************OPEN*FDINSTLL**********************************S01319
     C*****                OPEN FDLCY1LL                           E14363 S01117
     C**********           OPEN FDNOSTLL                            E13747S01194
     C*****                OPEN FDRETALL                                  S01177
     C**********           OPEN FDSNAMLL                            E13747S01194
     C*****                OPEN FDTABJLL                                  S01195
     C*****                OPEN FDTBLILL                                  S01194
     C******************** OPEN FXDEALLL                                  E18569
     C***********          OPEN CADENQLL                           E18569 042960
     C*****                OPEN FXTB40LL                                  S01194
     C                     OPEN MMCARDLL
     C                     OPEN MMCDAFLL
     C                     OPEN MMCMPLLL
     C/COPY WNCPYSRC,MM0089C371
     C                     OPEN MMDEALLL
     C/COPY WNCPYSRC,MM0089C372
     C                     OPEN MMDEAMLL
     C                     OPEN MMDEAULL
     C                     OPEN MMLVDMLL
     C                     OPEN MMMCOMLL
     C******               OPEN MMSSTSLL                                  E22161
     C*********************OPEN*MMUAUTLL**********************************S01319
     C******               OPEN MMUSERLL                                  E18139
     C*****                OPEN SNAME                                     S01194
     C*****                OPEN STDSI                              E13747 S01177
     C*****                OPEN BOOKD                               S01165S01194
     C                     OPEN FDINTRLL                                  E18187
     C                     OPEN FDDTSTL1                                  AUS011
     C           AUS007    IFEQ 'Y'                                       AUS007
     C                     OPEN BROKR                                     AUS007
     C                     OPEN FORAT                                     AUS007
     C                     END                                            AUS007
     C/COPY WNCPYSRC,MM0089C263
     C*
     C****Call*subroutine to access ICD file for MIDAS run date.          S01194
     C*****                EXSR ZA0150                                    S01194
     C*****                                                               S01194
     C****Check for data base error.                                      S01194
     C*****      *IN80     IFEQ '1'                        B1             S01194
     C** Access Bank details via access program                           s01194
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C**                                                                  s01194
     C** Access MIDAS Modules details via access program                  s01194
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
     C**                                                                  S01383
     C** ACCESS SAR DETAILS FILE TO DETERMINE IF BRT SAR IS INSTALLED     S01383
     C** (DATABASE ERROR HANDLING DONE IN ACCESS PROGRAM)                 S01383
     C**                                                                  S01383
     C                     CALL 'AOSARDR0'                                S01383
     C                     PARM '       ' @RTCD                           S01383
     C                     PARM '*VERIFY' @OPTN                           S01383
     C                     PARM 'S01383'  @SARD   6                       S01383
     C           @RTCD     IFNE *BLANK                                    S01383
     C           @RTCD     ANDNE'*NRF   '                                 S01383
     C                     MOVE '1'       *INU7                           S01383
     C                     MOVE '1'       *INU8                           S01383
     C           *LOCK     IN   LDA                        ***************S01383
     C                     MOVEL'SCSARDPD'DBFILE           * DBERROR 012 *S01383
     C                     MOVEL'012'     DBASE            ***************S01383
     C                     MOVEL@RTCD     DBKEY                           S01383
     C                     OUT  LDA                                       S01383
     C                     MOVE '1'       *INLR            *1             S01383
     C                     MOVE '1'       *INKC            *1             S01383
     C                     EXSR #C                         *1             S01383
     C                     END                                            S01383
     C           @RTCD     IFEQ *BLANK                                    S01383
     C                     MOVEL'Y'       S01383  1                       S01383
     C                     END                                            S01383
     C*                                                                   S01383
     C** IF BRT SAR INSTALLED, ACCESS BRT INSTALLATION CONTROL DATA       S01383
     C*                                                                   S01383
     C           S01383    IFEQ 'Y'                                       S01383
     C                     MOVE 'D'       BRTKEY  1                       S01383
     C           BRTKEY    CHAINSDBRTDD0             60                   S01383
     C*                                                                   S01383
     C** if *in61 is on, then it is a data base error                     S01383
     C*                                                                   S01383
     C           *IN60     IFEQ '1'                                       S01383
     C                     MOVE '1'       *INU7                           S01383
     C                     MOVE '1'       *INU8                           S01383
     C           *LOCK     IN   LDA                        ***************S01383
     C                     MOVEL'SDBRTDPD'DBFILE           * DBERROR 013 *S01383
     C                     MOVEL'013'     DBASE            ***************S01383
     C                     MOVELBRTKEY    DBKEY                           S01383
     C                     OUT  LDA                                       S01383
     C                     MOVE '1'       *INLR            *1             S01383
     C                     MOVE '1'       *INKC            *1             S01383
     C                     EXSR #C                         *1             S01383
     C                     END                                            S01383
     C                     END                                            S01383
     C**                                                                  S01391
     C** ACCESS SAR DETAILS FILE TO DETERMINE IF JSM SAR IS INSTALLED     S01391
     C** (DATABASE ERROR HANDLING DONE IN ACCESS PROGRAM)                 S01391
     C**                                                                  S01391
     C                     CALL 'AOSARDR0'                                S01391
     C                     PARM '       ' @RTCD                           S01391
     C                     PARM '*VERIFY' @OPTN                           S01391
     C                     PARM 'S01391'  @SARD   6                       S01391
     C           @RTCD     IFNE *BLANK                                    S01391
     C           @RTCD     ANDNE'*NRF   '                                 S01391
     C                     MOVE '1'       *INU7                           S01391
     C                     MOVE '1'       *INU8                           S01391
     C           *LOCK     IN   LDA                        ***************S01391
     C                     MOVEL'SCSARDPD'DBFILE           * DBERROR 014 *S01391
     C                     MOVEL'014'     DBASE            ***************S01391
     C                     MOVEL@RTCD     DBKEY                           S01391
     C                     OUT  LDA                                       S01391
     C                     MOVE '1'       *INLR            *1             S01391
     C                     MOVE '1'       *INKC            *1             S01391
     C                     EXSR #C                         *1             S01391
     C                     END                                            S01391
     C           @RTCD     IFEQ *BLANK                                    S01391
     C                     MOVEL'Y'       S01391  1                       S01391
     C                     END                                            S01391
      *                                                                   CRE007
      ** Access SAR details to check if CRE007 is installed               CRE007
      *                                                                   CRE007
     C                     CALL 'AOSARDR0'                                CRE007
     C                     PARM *BLANKS   @RTCD                           CRE007
     C                     PARM '*VERIFY' @OPTN                           CRE007
     C                     PARM 'CRE007'  @SARD                           CRE007
      *                                                                   CRE007
     C           @RTCD     IFNE *BLANKS                                   CRE007
     C           @RTCD     ANDNE'*NRF   '                                 CRE007
     C           *LOCK     IN   LDA                        ************** CRE007
     C                     MOVEL'SCSARDPD'DBFILE           * DB ERROR 35* CRE007
     C                     MOVEL'035'     DBASE            ************** CRE007
     C                     MOVEL'CRE007  'DBKEY                           CRE007
     C                     OUT  LDA                                       CRE007
     C                     SETON                     U7U8LR               CRE007
     C                     MOVE '1'       *INKC                           CRE007
     C                     EXSR #C                                        CRE007
     C                     ENDIF                                          CRE007
      *                                                                   CRE007
     C           @RTCD     IFEQ *BLANKS                                   CRE007
     C                     MOVE 'Y'       CRE007  1                       CRE007
     C                     ELSE                                           CRE007
     C                     MOVE 'N'       CRE007                          CRE007
     C                     ENDIF                                          CRE007
      *                                                                   CRE007
      *                                                                   CDL010
      ** Access SAR details to check if CDL010 is installed               CDL010
      *                                                                   CDL010
     C                     CALL 'AOSARDR0'                                CDL010
     C                     PARM *BLANKS   @RTCD                           CDL010
     C                     PARM '*VERIFY' @OPTN                           CDL010
     C                     PARM 'CDL010'  @SARD                           CDL010
      *                                                                   CDL010
     C           @RTCD     IFNE *BLANKS                                   CDL010
     C           @RTCD     ANDNE'*NRF   '                                 CDL010
     C           *LOCK     IN   LDA                        ************** CDL010
     C                     MOVEL'SCSARDPD'DBFILE           * DB ERROR 36* CDL010
     C                     MOVEL'036'     DBASE            ************** CDL010
     C                     MOVEL'CDL010  'DBKEY                           CDL010
     C                     OUT  LDA                                       CDL010
     C                     SETON                     U7U8LR               CDL010
     C                     MOVE '1'       *INKC                           CDL010
     C                     EXSR #C                                        CDL010
     C                     ENDIF                                          CDL010
      *                                                                   CDL010
     C           @RTCD     IFEQ *BLANKS                                   CDL010
     C                     MOVE 'Y'       CDL010  1                       CDL010
     C                     ELSE                                           CDL010
     C                     MOVE 'N'       CDL010                          CDL010
     C                     ENDIF                                          CDL010
      *                                                                   CDL010
     C/COPY WNCPYSRC,MM0089C492
      *
      ** Set the WINDOW flag
     C                     MOVE BGWDPR    @5ST    1        *1             S01314
     C******                                                              S01194
     C****Read file FDICDRLL, format TABTB11.                             S01194
     C*****                MOVE *BLANKS   @KEY                            S01194
     C*****                MOVEL'01'      @KEY                            S01194
     C*****                MOVE '11'      @KEY                            S01194
     C*****      @KEY      CHAINFDICDRLL             60                   S01194
     C*****                                                               S01194
     C****If the chain fails or RECI is not 'D' then it is a data base    S01194
     C****error.                                                          S01194
     C*****      *IN60     IFEQ '1'                        B1             S01194
     C*****      RECI      OREQ '*'                        B1             S01194
     C*****                MOVE '1'       *INU7            *1             S01194
     C*****                MOVE '1'       *INU8            ***************S01194
     C*****                MOVEL'FDICDRLL'DBFILE           * DBERROR 012 *S01194
     C*****                MOVEL@KEY      DBKEY            ***************S01194
     C*****                MOVE '012'     DBASE            *1             S01194
     C*****                MOVE '1'       *INLR            *1             S01194
     C*****                MOVE '1'       *INKC            *1             S01194
     C*****                                                               S01194
     C*****                EXSR #C                         *1             S01194
     C*****                END                             E1             S01194
     C*                                                                   S01194
     C***Access*Deal*details*via*access*program*********************S01194S01319
     C***(database*error*handling*done*in*access*program)***********S01194S01319
     C*********************CALL*'AODEALR0'**************************S01194S01319
     C*********************PARM*'*DBERR*'*@RTCD***7*****************S01194S01319
     C*********************PARM*'*FIRST*'*@OPTN***7*****************S01194S01319
     C***********SDDEAL****PARM*SDDEAL****DSFDY*********************S01194S01319
     C*                                                                   S01194
     C** Access Trading details via access program                        S01194
      *  (database error handling done in access program)                 S01194
     C                     CALL 'AOTRADR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01194
     C*                                                                   S01194
     C** Access Retail details via access program                         S01194
      *  (database error handling done in access program)                 S01194
     C           BGRTBN    IFEQ 'Y'                                       E47225
     C           BGIOAC    OREQ 'Y'                                       E47225
     C                     CALL 'AORETLR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDRETL    PARM SDRETL    DSFDY                           S01194
     C                     END                                            E47225
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CP76                                           S01408
     C*                                                                   S01408
     C*
     C****Read file FDICDRLL, format TABTB20.                             S01194
     C*****                MOVE *BLANKS   @KEY                            S01194
     C*****                MOVEL'01'      @KEY                            S01194
     C*****                MOVE '20'      @KEY                            S01194
     C*****      @KEY      CHAINFDICDRLL             60                   S01194
     C*****                                                               S01194
     C****If the chain fails or RECI is not 'D' then a data base error    S01194
     C****has occurred.                                                   S01194
     C*****      *IN60     IFEQ '1'                        B1             S01194
     C*****      RECI      OREQ '*'                        *1             S01194
     C*****                MOVE '1'       *INU7            *1             S01194
     C*****                MOVE '1'       *INU8            ***************S01194
     C*****                MOVEL'FDICDRLL'DBFILE           * DBERROR 013 *S01194
     C*****                MOVEL@KEY      DBKEY            ***************S01194
     C*****                MOVE '013'     DBASE            *1             S01194
     C*****                MOVE '1'       *INLR            *1             S01194
     C*****                MOVE '1'       *INKC            *1             S01194
     C*****                                                               S01194
     C*****                EXSR #C                         *1             S01194
     C*****                END                             E1             S01194
     C*                                                                   S01194
     C***Access*General Ledger details via access program                 E60
      ***(database*error handling done in access program)                 E60
     C********             CALL 'AOGELRR0'                                E60
     C********             PARM '*DBERR ' @RTCD   7                       E60
     C********             PARM '*FIRST ' @OPTN   7                       E60
     C********             PARM           SDGELR                          E60
     C*
     C****Read*the*first*and*only*record*on*FDINSTLL.*********************S01319
     C***********1*********CHAINFDINSTLL*************60*******************S01319
     C********************************************************************S01319
     C****If*no*valid*record*found*then*it*is*a*data*base*error.**********S01319
     C************IN60*****IFEQ*'1'************************B1*************S01319
     C***********IDDLTF****OREQ*'*'************************X1*************S01319
     C*********************MOVE*'1'********INU7*************1*************S01319
     C*********************MOVE*'1'********INU8***************************S01319
     C************LOCK*****IN***LDA*********************************E24039S01319
     C*********************MOVEL'FDINSTLL'DBFILE*************DBERROR*014**S01319
     C*********************MOVEL*BLANKS***DBKEY***************************S01319
     C*********************MOVE*'014'*****DBASE*************1*************S01319
     C*********************OUT**LDA*********************************E24039S01319
     C*********************MOVE*'1'********INLR*************1*************S01319
     C*********************MOVE*'1'********INKC*************1*************S01319
     C********************************************************************S01319
     C*********************EXSR*#C**************************1*************S01319
     C*********************END*****************************E1*************S01319
     C*
     C***********                                                         E22161
     C****Read*the first and only record on MMSSTSLL.                     E22161
     C***********1         CHAINMMSSTSLL             60                   E22161
     C***********                                                         E22161
     C****If*no*valid record found then it is a data base error.          E22161
     C************IN60     IFEQ '1'                        B1             E22161
     C***********H1DLTF    OREQ '*'                        X1             E22161
     C***********          MOVE '1'       *INU7            *1             E22161
     C***********          MOVE '1'       *INU8            ***************E22161
     C***********          MOVEL'MMSSTSLL'DBFILE           * DBERROR 015 *E22161
     C***********          MOVEL*BLANKS   DBKEY            ***************E22161
     C***********          MOVE '015'     DBASE            *1             E22161
     C***********          MOVE '1'       *INLR            *1             E22161
     C***********          MOVE '1'       *INKC            *1             E22161
     C***********                                                         E22161
     C***********          EXSR #C                         *1             E22161
     C**********           END                             E1             E22161
     C*
     C**  Read the first and only record on MMMCOMLL.
     C           1         CHAINMMMCOMLL             60
     C*
     C**  If no valid record found then it is a data base error.
     C           *IN60     IFEQ '1'                        B1
     C           ICDLTF    OREQ '*'                        X1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            ***************
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVEL'MMMCOMLL'DBFILE           * DBERROR 016 *
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVE '016'     DBASE            *1
     C                     OUT  LDA                                       E24039
     C                     MOVE '1'       *INLR            *1
     C                     MOVE '1'       *INKC            *1
     C*
     C                     EXSR #C                         *1
     C                     END                             E1
     C******                                                              S01194
     C****Read file FXTB40LL, format TABTB40.                             S01194
     C*****                MOVE *BLANKS   @KEY                            S01194
     C*****                MOVEL'01'      @KEY                            S01194
     C*****                MOVE '40'      @KEY                            S01194
     C*****      @KEY      CHAINFXTB40LL             60                   S01194
     C*****                                                               S01194
     C****If the chain fails or RECI is not 'D' then a database error has S01194
     C****occurred.                                                       S01194
     C*****      *IN60     IFEQ '1'                        B1             S01194
     C*****      RECI      OREQ '*'                        *1             S01194
     C*****                MOVE '1'       *INU7            *1             S01194
     C*****                MOVE '1'       *INU8            ***************S01194
     C*****                MOVEL'FXTB40LL'DBFILE           * DBERROR 017 *S01194
     C*****                MOVEL@KEY      DBKEY            ***************S01194
     C*****                MOVE '017'     DBASE            *1             S01194
     C*****                MOVE '1'       *INLR            *1             S01194
     C*****                MOVE '1'       *INKC            *1             S01194
     C*****                                                               S01194
     C*****                EXSR #C                         *1             S01194
     C*****                END                             E1             S01194
     C*
      ** CHECK PROFIT CENTRES USED FLAG                                   E61
     C*****      PFUS      IFEQ 'Y'                                 S01117E61
     C********   BKLUST    IFEQ 'Y'                                       E61
     C********             MOVE '1'       *IN37                           E61
     C************         ELSE                                           E61
     C************         MOVE '0'       *IN37                           E61
     C********             END                                            E61
      ********                                                            E61
      ** CHECK ORIGINATING BRANCH USED FLAG                               E61
     C*****      OBIN      IFNE 'Y'                                 S01117S01194
     C********** BKL5ST    IFNE 'Y'                                       E61
     C********   BKL5ST    IFEQ 'Y'                                       E61
     C********   @MBIN     ANDEQ'Y'                                       E61
     C********             MOVE '1'       *IN76                           E61
     C***********          MOVE '0'       *IN76                           E61
     C********             END                                            E61
     C**                                                                  S01117
     C**  Read the first and only record on MMCDAFLL.
     C           1         CHAINMMCDAFLL             60
     C*
     C**  If no valid record found then it is a data base error.
     C           *IN60     IFEQ '1'                        B1
     C           HHDLTF    OREQ '*'                        X1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            ***************
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVEL'MMCDAFLL'DBFILE           * DBERROR 018 *
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVE '018'     DBASE            *1
     C                     OUT  LDA                                       E24039
     C                     MOVE '1'       *INLR            *1
     C                     MOVE '1'       *INKC            *1
     C*
     C                     EXSR #C                         *1
     C                     END                             E1
     C*
     C**  Read the first and only record on FDDLNMLL.
     C           1         CHAINFDDLNMLL             60
     C*
     C**  If no valid record found then it is a data base error.
     C           *IN60     IFEQ '1'                        B1
     C           NODLTF    OREQ '*'                        X1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            ***************
     C           *LOCK     IN   LDA                        ***************E24039
     C                     MOVEL'FDDLNMLL'DBFILE           * DBERROR 019 *
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVE '019'     DBASE            *1
     C                     OUT  LDA                                       E24039
     C                     MOVE '1'       *INLR            *1
     C                     MOVE '1'       *INKC            *1
     C*
     C                     EXSR #C                         *1
     C                     END                             E1
     C*
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     OPEN PMPORTPD                                  S01486
     C                     END                                            S01486
      *                                                                   S01486
      ** Do not display Portfolio Reference if Module is not present      S01486
      *                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
      *                                                                   S01486
      ** Access PM ICD File.                                              S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7          B:Return codeS01486
     C                     PARM '*FIRST'  @OPTN   7          I:Option     S01486
     C           SDPORT    PARM SDPORT    DSFDY              O:Rec format S01486
      *                                                                   S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVE '1'       *INU7                           S01486
     C                     MOVE '1'       *INU8                           S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL'SDPORTL0'DBFILE           ***************S01486
     C                     MOVEL*BLANKS   DBKEY            * DBERROR 30  *S01486
     C                     MOVE '030'     DBASE            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     MOVE '1'       *INLR            *1             S01486
     C                     MOVE '1'       *INKC                           S01486
     C                     EXSR #C                                        S01486
     C                     END                                            S01486
      *                                                                   S01486
      ** Define key for PMPORTPD                                          S01486
      *                                                                   S01486
     C           PMKEY     KLIST                                          S01486
     C                     KFLD           PNCNUM                          S01486
     C                     KFLD           DDPTFR                          S01486
     C                     END                                            S01486
      *                                                                   S01486
     C****Read*the*first*and*only*record*on*MMUAUTLL.*********************S01319
     C***********1*********CHAINMMUAUTLL*************60*******************S01319
     C********************************************************************S01319
     C****If*no*valid*record*found*then*it*is*a*data*base*error.**********S01319
     C************IN60*****IFEQ*'1'************************B1*************S01319
     C***********IPDLTF****OREQ*'*'************************B1*************S01319
     C*********************MOVE*'1'********INU7*************1*************S01319
     C*********************MOVE*'1'********INU8***************************S01319
     C*********************MOVEL'MMUAUTLL'DBFILE*************DBERROR*020**S01319
     C*********************MOVEL*BLANKS***DBKEY***************************S01319
     C*********************MOVE*'020'*****DBASE*************1*************S01319
     C*********************MOVE*'1'********INLR*************1*************S01319
     C*********************MOVE*'1'********INKC*************1*************S01319
     C********************************************************************S01319
     C*********************EXSR*#C**************************1*************S01319
     C*********************END*****************************E1*************S01319
     C*
     C****Get the user id from PSDS and use this to chain to the          E18139
     C****user details.                                                   E18139
     C******               MOVEL@USER     @USRKY  3                       E18139
     C******     @USRKY    CHAINMMUSERLL             60                   E18139
     C******                                                              E18139
     C****If the user is not on file treat user as if they are            E18139
     C****not a Settlement Officer or Authorisation Officer               E18139
     C******     *IN60     IFEQ '1'                        B1             E18139
     C******     IQDLTF    ORNE *BLANKS                    *1             E18139
     C******               MOVE 'N'       IQMMSO           *1             E18139
     C******               MOVE 'N'       IQMMAO           *1             E18139
     C******               END                             E1             E18139
     C******                                                              E18139
     C****Set up Action Code text for screen.                             E18139
     C******                                                              E18139
     C****If the user is a settlement officer and not an authorisation    E18139
     C****officer.                                                        E18139
     C******     IQMMSO    IFEQ 'Y'                        B1             E18139
     C******     IQMMAO    ANDEQ'N'                        *1             E18139
     C******               MOVEL'(I,A'    DDLIST           *1             E18139
     C******               MOVE ',D,E, )' DDLIST           *1             E18139
     C******               END                             E1             E18139
     C******                                                              E18139
     C****If the user is an authorisation officer and not a settlements   E18139
     C****officer.                                                        E18139
     C******     IQMMSO    IFEQ 'N'                        B1             E18139
     C******     IQMMAO    ANDEQ'Y'                        *1             E18139
     C******               MOVEL'( , '    DDLIST           *1             E18139
     C******               MOVE ', ,E,X)' DDLIST           *1             E18139
     C******               END                             E1             E18139
     C******                                                              E18139
     C****If the user is an authorisation officer and a settlements       E18139
     C****officer.                                                        E18139
     C******     IQMMSO    IFEQ 'Y'                        B1             E18139
     C******     IQMMAO    ANDEQ'Y'                        *1             E18139
     C******               MOVEL'(I,A'    DDLIST           *1             E18139
     C******               MOVE ',D,E,X)' DDLIST           *1             E18139
     C******               END                             E1             E18139
     C******                                                              E18139
     C****If the user is neither an authorisation or settlements          E18139
     C****officer.                                                        E18139
     C******     IQMMSO    IFEQ 'N'                        B1             E18139
     C******     IQMMAO    ANDEQ'N'                        *1             E18139
     C******               MOVEL'( , '    DDLIST           *1             E18139
     C******               MOVE ', ,E, )' DDLIST           *1             E18139
     C******               END                             E1             E18139
     C******                                                              E18139
     C****If the back office authorization is not required, omit type     E18139
     C****X.                                                              E18139
     C******     H1BOAR    IFEQ 'N'                        B1             E18139
     C******               MOVE ' )'      DDLIST           *1             E18139
     C******               END                             E1             E18139
     C*
     C** Set up settlement screen parameters from standing files:         S01177
     C*                                                                   S01177
     C**   Retail present indicator                                       S01177
     C*****                TESTB'7'       MODI2          65         S01177S01194
     C*****      *IN65     IFEQ '1'                                 S01177S01194
     C*****                MOVE 'Y'       PMRETP                    S01177S01194
     C*****                ELSE                                     S01177S01194
     C*****                MOVE 'N'       PMRETP                    S01177S01194
     C*****                END                                      S01177S01194
     C*********************MOVE BGRTBN    PMRETP                    S01194E23406
     C           BGRTBN    IFEQ 'Y'                                       E23406
     C           BGIOAC    OREQ 'Y'                                       E23406
     C                     MOVE 'Y'       PMRETP                          E23406
     C                     ELSE                                           E23406
     C                     MOVE 'N'       PMRETP                          E23406
     C                     END                                            E23406
     C*                                                                   S01177
     C**   Retail account numbers supported                               S01177
     C*****                MOVE RACN      PMRETS                    S01177S01194
     C                     MOVE BMRANR    PMRETS                          S01194
     C*                                                                   S01177
     C**   Prime current a/c code                                         S01177
     C*****                Z-ADDCADC      PMPCYA                    S01177S01194
     C                     MOVELBMACCD    PMPCYA                          S01194
     C*                                                                   S01177
     C**   Chips module indicators                                        S01177
     C*****                MOVE CHIM      PMCHIM                    S01177S01194
     C                     MOVE BGCHDL    PMCHIM                          S01194
     C*                                                                   S01177
     C**   Back value period                                              S01177
     C*****                Z-ADDBVLP      PMBVPD                    S01177S01194
     C                     Z-ADDBJBVPD    PMBVPD                          S01194
     C*                                                                   S01177
     C**   Run date in midas day no. format                               S01177
     C******               Z-ADDRUND      PMRUND                    S01177S01194
     C                     Z-ADDBJRDNB    PMRUND                    S01177S01194
     C*                                                                   S01177
     C**  Close single record files.
     C*****                CLOSEFDICDRLL                                  S01194
     C*********************CLOSEFDINSTLL**********************************S01319
     C*********************CLOSEMMSSTSLL**********************************S01319
     C                     CLOSEMMCDAFLL
     C                     CLOSEFDDLNMLL
     C*********************CLOSEMMUAUTLL**********************************S01319
     C*********************CLOSEMMUSERLL**********************************S01319
     C                     CLOSEMMMCOMLL
     C*********************CLOSESDMMODPD                            S01241S01314
     C*
     C****Key*lists.                                                      S01194
     C****       @CLTKY    KLIST                                          S01194
     C****                 KFLD           @CNUM   60                      S01194
     C****                 KFLD           @RCDT   1                       S01194
     C***********@CYKEY****KLIST******************************************S01319
     C*********************KFLD***********@CYCNM**60**********************S01319
     C*********************KFLD***********@CYCCY**3***********************S01319
     C*********************KFLD***********@CTTP***2***********************S01319
     C********** @NSKEY    KLIST                                          E13747
     C**********           KFLD           @NSCNO 10                       E13747
     C**********           KFLD           @NSCCY  3                       E13747
     C**********           KFLD           @NSP    1                       E13747
     C********** @NSPKY    KLIST                                          E13747
     C**********           KFLD           @NSCNO                          E13747
     C**********           KFLD           @NSCCY                          E13747
     C***********@ACKEY****KLIST******************************************S01319
     C*********************KFLD***********@ACCNM**60**********************S01319
     C*********************KFLD***********@ACCCY**3***********************S01319
     C*********************KFLD***********@ACCDE**40**********************S01319
     C*********************KFLD***********@ACSEQ**20**********************S01319
     C********** @SNKEY    KLIST                                          E13747
     C**********           KFLD           @SNNM1  7                       E13747
     C**********           KFLD           @SNNM2  3                       E13747
     C           @DEAMK    KLIST
     C                     KFLD           @DEAMN  60
     C                     KFLD           @VDYY   40
     C                     KFLD           @VDMM   20
     C                     KFLD           @VDDD   20
     C                     KFLD           @DEAMS  30
     C           BRKKEY    KLIST                                          AUS007
     C                     KFLD           BRKK1   4                       AUS007
     C                     KFLD           BRKK2   3                       AUS007
     C*                                                                   AUS011
     C** Deal type/subtype validation KLIST                               AUS011
     C*                                                                   AUS011
     C           @DTSTK    KLIST                                          AUS011
     C                     KFLD           DDTYPE                          AUS011
     C                     KFLD           DDSTYP                          AUS011
     C***********@FCLK     KLIST                                          E25515
     C***********          KFLD           @FCLK1  60                      E25515
     C***********          KFLD           @FCLK2  30                      E25515
     C***********          KFLD           @FCLK3  20                      E25515
     C***********          KFLD           @FCLK4  1                       E25515
     C***********                                                         E25515
     C****Set*up*key*sub-fields*which*are*constant.                       E25515
     C*********************MOVE 'P'       @NSP                            E13747
     C*****                MOVE 'A'       @RCDT                           S01194
     C***********          MOVE 'D'       @FCLK4                          E25515
     C*
     C**  Parameters passed into the program
     C           *ENTRY    PLIST
     C                     PARM           @TERM1  1
     C                     PARM           @RDLN   60
     C                     PARM           @ERR    1
     C                     PARM           NEWDN   6                       S01434
     C                     PARM           OLDDN   6                       S01434
     C                     PARM           RTRN    1                       S01434
     C/COPY WNCPYSRC,MM0089C192
     C*
     C           #A8       TAG                             **#A8**
     C**************                                                      S01218
     C****Access*the*data*area*MMOD*to*determine*whether*the*FX           S01218
     C****module*is*in*the*system.**If*it*is,*position*13*contains*a      S01218
     C****a*'Y'.                                                          S01218
     C************NAMVAR   DEFN           MMOD                            S01218
     C*********************IN   MMOD                                      S01218
     C*
     C****Attempt*to*add*member*to*the*standard*deals*file.***            DT0010
     C***********          CALL 'MM0031'                                  DT0010
     C***********          PARM           @TERM   1                       DT0010
     C***********@TERM     IFEQ 'E'                        B1             DT0010
     C***********          MOVE '1'       *INKC            *1             DT0010
     C***********          GOTO #A9                        *1             DT0010
     C***********          END                             E1             DT0010
     C*
     C****Override*Standard*Deal*to*correct*member.***********************S01319
     C*********************MOVEL@USER*****@CUID***************************S01319
     C*********************MOVE*@JOBNO****@CJON***************************S01319
     C*********************MOVE*')'*******@CEND***************************S01319
     C****Remove*any*embeDded*BLANKS*in*@CMDV***********************E15515S01319
     C*********************Z-ADD1*********@Y******20****************E15515S01319
     C*********************MOVEA*BLANKS***@EA***********************E15515S01319
     C*********************MOVEA*BLANKS***@IA***********************E15515S01319
     C*********************MOVEA@CMDV*****@IA***********************E15515S01319
     C***********1*********DO***10********@I******20****************E15515S01319
     C***********@IA,@I****IFNE*'*'*********************************E15515S01319
     C*********************MOVE*@IA,@I****@EA,@Y********************E15515S01319
     C*********************ADD**1*********@Y************************E15515S01319
     C*********************END**************************************E15515S01319
     C*********************END**************************************E15515S01319
     C*********************MOVEA@EA*******@CMDV*********************E15515S01319
     C*********************MOVE*@CMDV*****@CMD,1**************************S01319
     C*********************Z-ADD30********@LNTH***************************S01319
     C********************************************************************S01319
     C*********************CALL 'QCAEXEC'                                 E20774
     C*********************CALL*'QCMDEXC'***************************E20774S01319
     C*********************PARM***********@CMD,1**************************S01319
     C*********************PARM***********@LNTH**155**********************S01319
     C*
      * S01227 - Set up flag for use by Extended Settlements              S01227
     C                     MOVE 'Y'       PMFRST                          S01227
      *                                                                                       CDL013
      ***   Check if CAR CDL013 is installed                                                  CDL013
      *                                                                                       CDL013
     C                     CALL 'AOSARDR0'                                                    CDL013
     C                     PARM *BLANKS   @RTCD   7                                           CDL013
     C                     PARM '*VERIFY' @OPTN   7                                           CDL013
     C                     PARM 'CDL013'  @SARD   6                                           CDL013
     C                     PARM           DSFDY                                               CDL013
      *                                                                                       CDL013
      ***   CAR CDL013 is installed                                                           CDL013
      *                                                                                       CDL013
     C           @RTCD     IFEQ *BLANKS                                                       CDL013
     C                     MOVE '1'       CDL013  1                                           CDL013
     C                     OPEN SDSTAAL1                                                      CDL013
      *                                                                                       CDL013
      ***   CAR CDL013 is not installed                                                       CDL013
      *                                                                                       CDL013
     C                     ELSE                                                               CDL013
     C                     MOVE '0'       CDL013                                              CDL013
     C                     END                                                                CDL013
      *                                                                                       CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
      *** Access WHT ICD record to determine WHT rate.                                        CDL013
     C                     MOVEL*BLANKS   ULSTAX 10                                           CDL013
     C                     MOVEL'RETAIL'  ULSTAX                                              CDL013
     C           ULSTAX    CHAINSDSTAAL1             88                                       CDL013
      *                                                                                       CDL013
     C           *IN88     IFEQ '1'                                                           CDL013
     C                     MOVE '1'       *INLR                                               CDL013
     C                     MOVE '1'       *INU7                                               CDL013
     C                     MOVE '1'       *INU8                                               CDL013
     C                     MOVE '1'       *INKC                                               CDL013
     C           *LOCK     IN   LDA                        ***************                    CDL013
     C                     MOVEL'SDSTAAL1'DBFILE           * DBERROR 500 *                    CDL013
     C                     MOVELULSTAX    DBKEY            ***************                    CDL013
     C                     MOVE '500'     DBASE                                               CDL013
     C                     MOVELPMDPGM    DBPGM                                               CDL013
     C                     OUT  LDA                                                           CDL013
     C                     EXSR #C                                                            CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     CLOSESDSTAAL1                                                      CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL081
      ** Check if CDL081 is installed                                                         CDL081
      *                                                                                       CDL081
     C                     MOVE 'N'       CDL081  1                                           CDL081
     C                     CALL 'AOSARDR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD   7                                           CDL081
     C                     PARM '*VERIFY' POPTN   7                                           CDL081
     C                     PARM 'CDL081'  PSARD   6                                           CDL081
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           PRTCD     ANDNE'*NRF   '                                                     CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     MOVEL'075'     DBASE                                               CDL081
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL081
     C                     MOVEL'MM0089'  DBPGM                                               CDL081
     C                     MOVEL'CDL081'  DBKEY                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR #C                                                            CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C           PRTCD     IFEQ *BLANKS                                                       CDL081
     C                     MOVE 'Y'       CDL081                                              CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Access withholding tax round down system values if CDL081 is on                      CDL081
      *                                                                                       CDL081
     C           CDL081    IFEQ 'Y'                                                           CDL081
     C                     CALL 'AOSVALR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD                                               CDL081
     C                     PARM C#BASE    SVALK1 20                                           CDL081
     C                     PARM           SVAL1 200                                           CDL081
     C                     PARM C#NBAS    SVALK2 20                                           CDL081
     C                     PARM           SVAL2 200                                           CDL081
     C                     PARM *BLANK    SVALK3 20                                           CDL081
     C                     PARM           SVAL3 200                                           CDL081
     C                     PARM *BLANK    SVALK4 20                                           CDL081
     C                     PARM           SVAL4 200                                           CDL081
     C                     PARM *BLANK    SVALK5 20                                           CDL081
     C                     PARM           SVAL5 200                                           CDL081
     C                     PARM *BLANK    SVALK6 20                                           CDL081
     C                     PARM           SVAL6 200                                           CDL081
     C                     PARM *BLANK    SVALK7 20                                           CDL081
     C                     PARM           SVAL7 200                                           CDL081
     C                     PARM *BLANK    SVALK8 20                                           CDL081
     C                     PARM           SVAL8 200                                           CDL081
     C                     PARM *BLANK    SVALK9 20                                           CDL081
     C                     PARM           SVAL9 200                                           CDL081
     C                     PARM *BLANK    SVALK0 20                                           CDL081
     C                     PARM           SVAL10200                                           CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C           SVAL1     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK1    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C           SVAL2     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK2    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C                     MOVEL'076'     DBASE                                               CDL081
     C                     MOVEL'SDSVALPD'DBFILE                                              CDL081
     C                     MOVEL'MM0089'  DBPGM                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR #C                                                            CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Setup tax amount rounding down indicators                                            CDL081
      *                                                                                       CDL081
     C                     MOVELSVAL1     W#BSRD  1                                           CDL081
     C                     MOVELSVAL2     W#NBRD  1                                           CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CPG                                            S01408
     C*
     C*                                                                   CEU003
     C           *LIKE     DEFN PMPSCY    @STCY                           CEU003
     C           *LIKE     DEFN PMIC72    @IC72                           CEU003
     C           *LIKE     DEFN PMIERI    @IERI                           CEU003
     C           *LIKE     DEFN DDISCY    @ISCY                           CEU003
     C           *LIKE     DEFN DDII72    @II72                           CEU003
     C*                                                                   CEU003
     C           #A9       ENDSR                           **#A9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* #C       - Termination processing.                            *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  MAIN   - Top level of program.                     *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter.                    *
     C*            @NOPMS - No. of parameters program called with.    *
     C*            @TERM1 - Termination parameter.                    *
     C*                                                               *
     C*****************************************************************
     C           #C        BEGSR
     C*                                                                   E24039
     C** Move blanks into RCVSTR in LDA                                   E24039
     C           *LOCK     IN   LDA                                       E24039
     C                     MOVE *BLANKS   NOCHG1                          E24039
     C                     MOVE *BLANKS   RCVSTR                          E24039
     C                     MOVE *BLANKS   NOCHG2                          E24039
     C                     OUT  LDA                                       E24039
     C*
     C**  Call screen 2 with termination parameter to close programs      S01177
     C                     MOVE 'T'       PMTERM                          S01177
     C*****                CALL 'SDKTPVR'                          S01177 E214
     C/COPY WNCPYSRC,MM0089C194
     C                     CALL 'SD2400'                                  S01227
     C                     PARM           @PARM1                          S01177
     C                     PARM           @PARM2                          S01177
     C                     PARM           @PARM3                          S01177
     C                     PARM           DDDLNO                          BHF488
     C                     PARM           WDUMMY                          CEU003
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089CSFI                                           S01408
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C*NOTE: Next hook appears at more than one point in this source.
     C/COPY WNCPYSRC,MM0089CP18                                           S01408
     C*                                                                   S01408
     C*                                                                   S01177
     C**  Terminate program unless program called from range
     C**  authorisation.
     C           @TERM     IFNE 'E'                        B1
     C           @NOPMS    ANDNE3                          B1
     C/COPY WNCPYSRC,MM0089C500
     C           @TERM1    OREQ 'T'                        B1
     C                     MOVE '1'       *INLR            *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0089C193
     C*
     C**  If U7 or U8 are on, and the program was called from the
     C**  range authorisation program, then set on *INLR.
     C           *INU7     IFEQ '1'                        B1
     C           @TERM1    ANDNE'T'                        B1
     C           @TERM     OREQ 'E'                        B1
     C           @TERM1    ANDNE'T'                        B1
     C                     MOVE 'E'       @TERM1           *1
     C                     END                             E1
     C*
     C/COPY WNCPYSRC,MM0089C373
     C           *INU7     IFEQ '1'                        B1             E16041
     C                     DUMP                            *1             E16041
     C                     END                             E1             E16041
     C*
     C                     RETRN
     C*
     C           #C9       ENDSR                           **#C9**
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* INFSR    - Error checking SR for write to deals file.         *
     C*                                                               *
     C* CALLS    ZA0250   - Clears error message queue.               *
     C*          ZA0440   - Sends a msg with data to the pgm msg queue*
     C*          #ZD      - Sets up screen with file values.          *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @DLKEY - Numeric key to deal file.                 *
     C*            @DATA  - DS to set up data for screen messages.    *
     C*            @TXT   - Field to hold 'Deal Number' text.         *
     C*            @DATA1 - Sub-field of @DATA.                       *
     C*            @DATA2 - Sub-field of @DATA.                       *
     C*            @MSGID - Message id field.                         *
     C*                                                               *
     C*****************************************************************
     C           INFSR     BEGSR
     C*
     C           STATUS    IFEQ 01021                      B1
     C*
     C**  Chain to the file using the key, to see if it already exists.
     C**  - *IN72 set on if the record is not found.
     C                     MOVE DDDLNO    @DLKEY
     C***********@DLKEY    CHAINMMDEAULL             7279  *1             CEU003
     C           @DLKEY    CHAINMMDEAULL             72                   CEU003
     C*
     C**  If *IN72 is not on a valid record
     C**  exists on file.
     C           *IN72     IFEQ '0'                        B*2
     C*
     C**  Clear program message queue.
     C/COPY WNCPYSRC,MM0089C374
     C                     CALL 'ZA0250'                   **2
     C/COPY WNCPYSRC,MM0089C375
     C           @TERM1    IFNE 'R'                                       S01434
     C                     ROLBK                           **2
     C                     END                                            S01434
     C*
     C** Send message - 'Record inserted by another workstation.'
     C                     MOVE *BLANKS   @DATA            **2
     C                     MOVEL@TXT,1    @DATA1           **2
     C                     MOVELDDDLNO    @DATA2           **2
     C                     MOVEL'MMM1015' @MSGID           **2
     C                     CALL 'ZA0440'                   **2
     C                     PARM           @MSGID           **2
     C                     PARM           @DATA            **2
     C*
     C**  Set up screen and work fields with newly changed values (i.e.
     C**  from chain to update file).
     C                     EXSR #ZD                        *1
     C                     MOVE 'E'       DDACTN           *1
     C                     Z-ADD01021     STATUS           *1
     C                     MOVE '*DETC '  EXTTAG           **2
     C                     ELSE                            X*2
     C                     MOVE '*CANCL'  EXTTAG  6        **2
     C                     DUMP                            **2
     C                     END                             E*2
     C                     ELSE                            X1
     C                     MOVE '*CANCL'  EXTTAG  6        *1
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C           INFSR9    ENDSREXTTAG                     **INFSR9**
     **EJECT                                                              S01194
     C*****************************************************************   S01194
     C*****                                                           *   S01194
     C*****   SUBROUTINE ZA0150 - THIS SUBROUTINE CHAINS TO FILE LF/  *   S01194
     C*****   FDICDRLL TO GET THE INSTALLATION CONTROL DETAILS RECORD *   S01194
     C*****   1 (HELD ON PF/TABTB10)                                  *   S01194
     C*****   INDICATOR 80 IS SET ON IF THE CHAIN FAILS OR THE RECORD *   S01194
     C*****   IS FLAGGED FOR DELETION.                                *   S01194
     C*****   IF INDICATOR 80 IS SET ON DETAILS OF THE ATTEMPTED      *   S01194
     C*****   ACCESS ARE PLACED IN THE LDA.                           *   S01194
     C*****                                                           *   S01194
     C*****   FIELDS USED : SS0150 - KEY USED TO ACCESS FDICDRLL      *   S01194
     C*****                                                           *   S01194
     C*****************************************************************   S01194
     C*****                                                               S01194
     C*****      ZA0150    BEGSR                                          S01194
     C*****                                                               S01194
     C***SET UP KEY TO OBTAIN FORMAT TABTB10F '01        10'              S01194
     C*****                MOVEL'01'      SS0150 12                       S01194
     C*****                MOVE '10'      SS0150                          S01194
     C*****                                                               S01194
     C***CHAIN TO FILE FDICDRLL                                           S01194
     C*****      SS0150    CHAINFDICDRLL             80                   S01194
     C*****      RECI      IFNE 'D'                        B1             S01194
     C*****                MOVE '1'       *IN80            *1             S01194
     C*****                END                             E1             S01194
     C*****                                                               S01194
     C***DEAL WITH DATA BASE ERROR                                        S01194
     C*****      *IN80     IFEQ '1'                        ***************S01194
     C*****                MOVEL'FDICDRLL'DBFILE           *             *S01194
     C*****                MOVEL'900'     DBASE            * DBERROR 900 *S01194
     C*****                MOVELSS0150    DBKEY            *             *S01194
     C*****                END                             ***************S01194
     C*****                                                               S01194
     C*****      ZA0159    ENDSR                            ZA0159 TAG    S01194
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0089CEND                                           S01408
     C*                                                                   S01408
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR    - Program error handling routine.                    *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C           @DUMP     IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @DUMP   1                       S01117
     C                     DUMP
     C                     END                                            S01117
     C*
     C           #PSSR9    ENDSR                            **PSSR9**
      /EJECT                                                              S01443
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0089C117                                           S01408
     C*                                                                   S01408
     C/COPY ZSRSRC,ZDATE1Z2                                               S01443
     C/COPY ZSRSRC,ZCONVZ1                                                CRE007
     C/COPY WNCPYSRC,MM0089C037
      /EJECT
     OMMDLDUP0E                @RLSFL
      /EJECT
      *****************************************************************   056095
      *   The array @YD and @MD are now being used by SR. ZDATE9      *   056095
      *   before they are being used by SR. ZA0710.  The actual       *   056095
      *   changes were only made on the text, ZA0710 was changed      *   056095
      *   to ZDATE9.                                                  *   056095
      *****************************************************************   056095
     O*                                                                   S01408
     O/COPY WNCPYSRC,MM0089OOPG                                           S01408
     O*                                                                   S01408
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
** TEXT FOR KEY FIELD NAME
Deal Number
** TEXT FOR DEAL STATUS
COMPLETE
AUTHORIZED
REQUIRES REAUTHORIZATION
MATURED
** array of powers of 10 from 0 to 8  @@H
000000000000001
000000000000010
000000000000100
000000000001000
000000000010000
000000000100000
000000001000000
000000010000000
000000100000000
000001000000000
000010000000000
000100000000000
001000000000000
010000000000000
100000000000000
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** @M  USED BY SR. MM1004 - DAYS IN A MONTH
312831303130313130313031
** Array holding event date name for use in messages.
0000000001
0000000010
0000000100
0000001000
0000010000
0000100000
0001000000
0010000000
0100000000
1000000000
** TABA TABB (Counterparty/Broker status AND TEXT)
00NO FEEDBACK YET
01WAITING
02TIMED OUT
03SPLIT FM PAIR                                                           090749
50PROPOSED PAIR
51PAIRED ERROR-O
52PAIRED ERROR-T
53PAIRED ERROR-B
54PROPOSED INVEST
55DUPLICATE ERROR                                                         090749
56INVESTIGATION                                                           090749
91CORRECT                                                                 090749
92COMPLETE                                                                090749
93CANCEL                                                                  090749
97NONE EXPECTED
99PAIRED NO ERROR
** TABTFU                                                                 S01392
ITIPTDTI                                                                  S01392
** TABFRQ - Rollover Frequencies                                          S01434
ABDFGHKLMPQRSTWXY                                                         S01434
** TABFQ2 - Rollover Frequencies requiring day numbers                    S01434
BLMQRTXY                                                                  S01434
** TABSET - Interest Settlement Methods                                   S01434
0001020304050607081214                                                    S01434
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                       CRE007
0000001                                                                   CRE007
0000010                                                                   CRE007
0000100                                                                   CRE007
0001000                                                                   CRE007
0010000                                                                   CRE007
0100000                                                                   CRE007
1000000                                                                   CRE007
