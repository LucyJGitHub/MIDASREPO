     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Update liquidity exposures file')             *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MM Dealer Module
     F*                                                               *
     F*  MM0094 - UPDATE LIQUIDITY EXPOSURES FILE                     *
     F*                                                               *
     F*  Function:   This program updates the MM liquidity exposure   *
     F*  (I/C)       file (MMFLIQPP) during I/C.                      *
     F*                                                               *
     F*  Called by: MM0078  - Update MM database.                     *
     F*                                                               *
     F*  Calls    : ZA0270  - Convert date to Midas day number.       *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CDL096             Date 22Sep14               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      *                 CDL093             Date 08Apr14               *
      *                 AR996895           Date 25Nov12               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL038             Date 10May05               *
      *                 CDL033             Date 10Feb05               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 163136             Date 07Jul99               *
      *                 CAP002             Date 23Feb98               *
     F*                 126017             DATE 18Nov97               *
     F*                 097885             DATE 03FEB97               *
     F*                 CAC001             Date 01Feb96               *
     F*                 095244             Date 01Nov95               *
     F*                 095238             Date 31Oct95               *
     F*                 S01486             DATE 02NOV94               *
     F*                 061426             DATE 30SEP93               *
     F*                 056121             DATE 04NOV93               *
     F*                 056095             DATE 07JUN93               *
     F*                 S01378             DATE 13APR92               *
     F*                 S01392             DATE 01SEP92               *
     F*                 E36300             DATE 24FEB92               *
     F*                 RT0150             DATE 12JUN91               *
     F*                 DT0015             DATE 20MAR91               *
     F*                 S01177  REDUNDANT  DATE 25APR90               *
     F*                 E19709             DATE 20/10/89              *
     F*                 S01218             DATE 20/10/89              *
     F*                 E18380             DATE 20/10/89              *
     F*                 E17051             DATE 20/10/89              *
     F*                 S01194             DATE 12/07/89              *
     F*                 S01195             DATE 12/07/89              *
     F*                 E12413             DATE 15/03/88              *
     F*                 S01136             DATE 13/01/88              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CDL093 - MM Interest calculation type 9.                     *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus                                       *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL033 - Floating Rate CDs Issued                            *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
     F*  CDL010 - Prevent last user that actioned the trade from      *
     F*           authorising it.Recompile due to changes in MMDELDPP *
     F*           , MMDENBPP AND MMDENSPP.                            *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to ZINTDY changes                    *
     F*  163136 - Interest Calculation Method '6'  showing incorrect -*
     F*           ZERO - amount . Addition to Core #126017 which dealt*
     F*           with the issue. It introduced an additional  INT6DY *
     F*           field in s-routine ZINTDY in  /COPY ZSRSRC/ZINTDYZ2 *
     F*           which in turn is usually called from GLINTC s-routine
     F*           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
     F*           least a dozen other pgms that use ZINTDY but do     *
     F*           GLINTC-processing within the pgms calculation specs *
     F*  CAP002 - Changed as part of the MM APIs creation to          *
     F*           switch *INU7 and *INU8 of before they are used.     *
     F*           They are used for internal communication
     F*           within this program, but in some circumstances
     F*           they can be on before this program starts, so       *
     F*           error conditions can be incorrectly reported.       *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC - recompile program.           *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           Recompiled only.                                    *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*           Recompile only.                                     *
     F*  061426 - Recompile after ZDATE9 correction                   *
     F*  056121 - Increase size of work field to enable correct       *
     F*           calculation of interest on very large amounts.      *
     F*           (Similar to fix 049499 of MM0089 in MRSLIB1005)     *
     F*  056095 - Interest not calculated consistently in MM.         *
     F*           SR. MM1009 was externally defined as ZINTDY,        *
     F*           while SR. ZA0710 and ZA0680 were replaced by        *
     F*           the externally defined standard SR. ZDATE9 and      *
     F*           ZDAT10, respectively.  Seventeen MM programs        *
     F*           were amended.                                       *
     F*  S01378 - Facilitates the partial sale of a parcel            *
     F*           of negotiable instruments which have been           *
     F*           previously input to the system as a single          *
     F*           transaction (was MOF53). Recompile over new         *
     F*           standard deal entry parameter format.               *
     F*  S01392 - JAP.SUB-MODULE INCORPORATION (CORE)                 *
     F*           a) Front-Up Interest - interest added/deducted      *
     F*              at value date rather than maturity.              *
     F*           b) Interest rounded down (New version of MM1030)    *
     F*           c) First & Last day interest - int due for every    *
     F*              day that deal is live.                           *
     F*  E36300 - Maturity for notice deals calced as run date        *
     F*           plus working days instead of actual days.           *
     F*  RT0150 - RECOMPILE PROGRAM FOR CHANGE IN MMSTDSPP            *
     F*  DT0015 - RECOMPILED                                          *
     F*  S01177 - Recompiled for Extended Settlements.                *   S01177
     F*  E19709 - MMFLQULL should be opened with commit like in       *
     F*           arbritrage.                                         *
     F*  S01218 - Recompiled to include new file layouts for          *
     F*           capital markets dealing interface                   *
     F*  E18380 - Program was recompiled with new formats for the     *
     F*           standard deal files. This stops the book code       *
     F*           and linked reference number fields from being       *
     F*           overwritten.                                        *
     F*  E17051 - Use MM1030 for interest calculations since it       *
     F*           is more accurate than MM1007.                       *
     F*  S01195 - HOLIDAY PROCESSING                                  *
     F*  S01194 - NEW STANDING DATA                                   *
     F*  E12413 - LCCY FIELD FROM TABTB11 CHANGED TO LOCY FOR         *
     F*           THE LOCATION CURRENCY. SO THE CHECK FOR             *
     F*           WORKING DAY IN LOCAL CURRENCY WILL BE CORRECT.      *
     F*  S01136 - LF/FDINSTLL has been removed as none of its         *
     F*           fields are ever used.                               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F**  Indicator Function Summary                                  *
     F*                                                               *
     F* ID F  C  H  L    FUNCTION OF INDICATORS                       *
     F******* 60         Chain to FDINSTLL failed if on               *   S01136
     F*       61         No processing of last update fields required *
     F*                  if on                                        *
     F*       62         No processing of before fields required      *
     F*                  if on                                        *
     F*       63         No record for currency on liquidities file   *
     F*       65         Interest calculation has been performed      *
     F*       66         Calculation of maturity date needed          *
     F*                  Value date + notice days                     *
     F*       80         Chain to installation file failed            *
     F*       U6         Program exception/error condition has        *
     F*                  occurred                                     *
     F*       U7         Set on with U8 to signify file handling error*
     F*       U8         Set on with U7 to signify file handling error*
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/COPY WNCPYSRC,MM0094F001
     FMMDEALLLIF  E           K        DISK         KINFSR INFSR      UC
     F            MMDENBP0                          KIGNORE
     F            MMDENSP0                          KIGNORE
  ***F*DINSTLLIF  E ***********        DISK         KINFSR INFSR      UC
     F*DICDRLLIF**E**         K        DISK         KINFSR INFSR      UC  S01194
     F*****       TABTB20F                          KIGNORE               S01194
     F*DTABJLLIF  E           K        DISK         KINFSR INFSR  ****UC  S01195
     F*DCCYTLLIF**E**         K        DISK         KINFSR INFSR      UC  S01194
     FMMFLQULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT                E19709
     E*
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E                    CPY@    1   1 80                                S01194
      *
     E**  USED BY SR. ZA0830 - CURRENCY RECORDS
     E                    @CY        50  3
     E*
     E****ARRAY*FOR*SR.*ZA0710*-*CUMULATIVE*DAYS*IN*YEAR*FOR*4*YEAR*PERIOD056095
     E***********         @YD     4   4  5 0A                             056095
     E*
     E****ARRAY*FOR*SR.*ZA0710*-*CUMULATIVE*DAYS*IN*YEAR*PER*MONTH*****   056095
     E***********         @MD    13  13  5 0A                             056095
     E*                                                                   056095
     E/COPY ZSRSRC,ZDATE9Z1                                               056095
     E**  Array for SR. ZDATE9                                            056095
     E*
     E**  ARRAY OF PERIOD DATES CALCULATED
     E                    @PR        10  5 0
     E*
     E**  ARRAY OF LIQUIDITY VALUES FROM FILE
     E                    @L1        10 15 0
     E                    @L2         9 15 0
     E                    @L3        10 15 0
     E/EJECT
     I*
     I** Load liquidities array by renaming fields
     IMMFLIQP0
     I*
     I              HQLTCE                          @L1,1
     I              HQLTD1                          @L1,2
     I              HQLTD2                          @L1,3
     I              HQLTD3                          @L1,4
     I              HQLTD4                          @L1,5
     I              HQLTW1                          @L1,6
     I              HQLTM1                          @L1,7
     I              HQLTM2                          @L1,8
     I              HQLTM3                          @L1,9
     I              HQLTRM                          @L1,10
     I*
     I              HQLPCE                          @L3,1
     I              HQLPD1                          @L3,2
     I              HQLPD2                          @L3,3
     I              HQLPD3                          @L3,4
     I              HQLPD4                          @L3,5
     I              HQLPW1                          @L3,6
     I              HQLPM1                          @L3,7
     I              HQLPM2                          @L3,8
     I              HQLPM3                          @L3,9
     I              HQLPRM                          @L3,10
     I*
     I              HQCFIX                          @L2,1
     I              HQFXD1                          @L2,2
     I              HQFXD2                          @L2,3
     I              HQFXD3                          @L2,4
     I              HQFXD4                          @L2,5
     I              HQFXW1                          @L2,6
     I              HQFXM1                          @L2,7
     I              HQFXM2                          @L2,8
     I              HQFXM3                          @L2,9
     I*
     I              HQPDTD                          @PR,1
     I              HQPDD1                          @PR,2
     I              HQPDD2                          @PR,3
     I              HQPDD3                          @PR,4
     I              HQPDD4                          @PR,5
     I              HQPDW1                          @PR,6
     I              HQPDM1                          @PR,7
     I              HQPDM2                          @PR,8
     I              HQPDM3                          @PR,9
     I*
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@Z71Y**************   056095
     I*********** DS                                                      056095
     I***********                             1   40@@Z71Y                056095
     I***********                             1   10@@SSY1                056095
     I***********                             2   20@@SSY2                056095
     I***********                             3   30@@SSY3                056095
     I***********                             4   40@@SSY4                056095
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@VDT***************   056095
     I*********** DS                                                      056095
     I***********                             1   80@@VDT                 056095
     I***********                             1   40@@YR                  056095
     I***********                             5   60@@Z71M                056095
     I***********                             7   80@@Z71D                056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDATE9Z2                                               056095
     I**  Data structure for SR. ZDATE9                                   056095
     I*
     I            DS
     I/COPY ZSRSRC,ZHOLI                                          *****   S01195
     I/COPY WNCPYSRC,MM0094I001
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** EXTERNAL DS FOR BANK DETAILS                                     S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I** EXTERNAL DS FOR CURRENCY DETAILS                                 S01194
     I*
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     I****USED BY SR. ZA0830 - ARRAY DATA STRUCTURE               *****   S01195
     I****DATA STRUCTURE FOR SR. ZA0680 - DATE INPUT TO SUBROUTINE*****   S01195
     I*****                                   1 150 @CY           *****   S01195
     I*****                                   1  75 @@CY1         *****   S01195
     I*****                                  76 150 @@CY2         *****   S01195
     I*
     I            DS
     I                                        1   80@@DTIN
     I***********                             1   40@@YYYY                056095
     I***********                             3   40@@YY                  056095
     I                                        3   40@@YYY
     I                                        5   60@@MM
     I***********                             1   20@@CC                  056095
     I***********                             5   60@@MTH                 056095
     I***********                             7   80@@DAY                 056095
     I                                        7   80@@DD
     I**  DATASTRUCTURE FOR DATE IN TO CHANGE FORMAT
     I*                                                                   056095
     I/COPY ZSRSRC,ZDAT10Z1                                               056095
     I**  Data structure for SR. ZDAT10                                   056095
     I*
     I            DS                              6
     I                                        1   60@@DTOU
     I                                        1   20@@DAT1
     I                                        3   40@@DAT2
     I                                        5   60@@YYYO
     I**  DATASTRUCTURE TO CHANGE FORMAT TO MMDDYY / DDMMYY
     I*
     I*
     I**  DATA STRUCTURE HOLDING STARTING POINT DATE
     I            DS
     I                                        1   80@@STRT
     I                                        1   40@@STYR
     I                                        5   60@@STMT
     I                                        7   80@@STDY
     I*
     I**  DATA STRUCTURE HOLDING SPOT DATE
     I            DS
     I                                        1   80@@SPDD
     I                                        1   40@@SPYR
     I                                        5   60@@SPMT
     I                                        7   80@@SPDY
     I*
     I**  DATA STRUCTURE DAYS FOR DATE FORMAT DDMMYY
     I            DS
     I                                        1   60@@DATE
     I                                        1   20@@DAY2
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATA                056095
     I***********                             1   40@@YY1                 056095
     I***********                             5   60@@MM1                 056095
     I***********                             7   80@@DD1                 056095
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATB                056095
     I***********                             1   40@@YY2                 056095
     I***********                             5   60@@MM2                 056095
     I***********                             7   80@@DD2                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZINTDYZ1                                               056095
     I**  Data Structure for SR. ZINTDY                                   056095
     I*
     I***Key*to*access*currencies*file*FDCCYTLL***                        S01194
     I*****       DS                                                      S01194
     I*****                                   1  12 @KEY                  S01194
     I*****                                   9  11 @CUR                  S01194
     I*
     I** Split input run date.
     I            DS
     I                                        1   7 RUNA
     I                                        1   20@DLUP
     I                                        3   5 @MLUP
     I                                        6   70@YLUP
     I*
     I** Combine input maturity date fields
     I            DS
     I                                        1   80@MATD
     I                                        1   40I@MDYY
     I                                        5   60I@MDMM
     I                                        7   80I@MDDD
     I*
     I** Combine input value date fields
     I            DS
     I                                        1   80@START
     I                                        1   40I@VDYY
     I                                        5   60I@VDMM
     I                                        7   80I@VDDD
     I*
     I** Combine input interest date fields
     I            DS
     I                                        1   80@SLINT
     I                                        1   40I@SLYY
     I                                        5   60I@SLMM
     I                                        7   80I@SLDD
     I*
     I** Combine input next interest date fields
     I            DS
     I                                        1   80@NXINT
     I                                        1   40I@NIYY
     I                                        5   60I@NIMM
     I                                        7   80I@NIDD
     I*
     I** Combine input deal done date fields
     I            DS
     I                                        1   80@DEALD
     I                                        1   40I@DDYY
     I                                        5   60I@DDMM
     I                                        7   80I@DDDD
     I*
     I** Combine related deal done date fields
     I            DS
     I                                        1   80@DEALR
     I                                        1   40HKDDYY
     I                                        5   60HKDDMM
     I                                        7   80HKDDDD
     I*
     I**  Data structure with the format of the Standard Deals file.
     I@STDA     E DSMMSTDAPP
     I*
     I**  Data structure with the format of the Standard Deals file.
     I@STDB     E DSMMSTDBPP
     I              QQDORI                          QQDOR1                                    CGL029
     I              QQMORI                          QQMOR1                                    CGL029
     I              QQDOPI                          QQDOP1                                    CGL029
     I              QQMOPI                          QQMOP1                                    CGL029
     I              QQBORI                          QQBOR1                                    CGL029
     I              QQBOPI                          QQBOP1                                    CGL029
     I              QQRORI                          QQROR1                                    CGL029
     I              QQROPI                          QQROP1                                    CGL029
     I              QQRONS                          QQRON1                                    CGL029
     I              QQPONS                          QQPON1                                    CGL029
     I*
     I**  Data structure with the format of the Standard Deals file.
     I@STDL     E DSMMSTDLPP
     I              QQDORI                          QQDOR2                                    CGL029
     I              QQMORI                          QQMOR2                                    CGL029
     I              QQDOPI                          QQDOP2                                    CGL029
     I              QQMOPI                          QQMOP2                                    CGL029
     I              QQBORI                          QQBOR2                                    CGL029
     I              QQBOPI                          QQBOP2                                    CGL029
     I              QQRONS                          QQRON2                                    CGL029
     I              QQPONS                          QQPON2                                    CGL029
     I*
     I**  Data structure with the format of the Standard Deals file.
     I@STDS     E DSMMSTDSPP
     I              QQDORI                          QQDOR3                                    CGL029
     I              QQMORI                          QQMOR3                                    CGL029
     I              QQBORI                          QQBOR3                                    CGL029
     I              QQBOPI                          QQBOP3                                    CGL029
     I              QQRORI                          QQROR3                                    CGL029
     I              QQROPI                          QQROP3                                    CGL029
     I              QQRONS                          QQRON3                                    CGL029
     I              QQPONS                          QQPON3                                    CGL029
     I*
     IPSDS       SDS
     I/COPY WNCPYSRC,MM0094I003
     I*
     I**  Program status data structure.
     I**  Field containing program in use.
     I                                      201 208 @FILE
     I**  Field containing workstation  ID.
     I                                      244 253 @JOB
     I**  Field containing user ID.
     I                                      254 263 @USER
     I*
     I           UDS
     I**  Local data area for data base errors.
     I**  Field containing name of database file in error.
     I                                      134 141 DBFILE
     I**  Field containing key value causing database error.
     I                                      142 170 DBKEY
     I**  Field containing name of program causing database error.
     I                                      171 180 DBPGM
     I**  Field containing number of database error.
     I                                      181 183 DBASE
     I/COPY WNCPYSRC,MM0094I002
     ISCSARD    E DSSCSARDPD                                                                  CDL033
     C/EJECT
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* MAIN     - Controls processing                                *
     C*                                                               *
     C* CALLS    #A       - Initial processing                        *
     C*          #B       - Main processing                           *
     C*          #C       - Final processing                          *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C*
     C/COPY WNCPYSRC,MM0094C004
     C           @TERM     IFNE 'T'                        B1
     C                     EXSR #A                         *1
     C                     END                             E1
     C*
     C           @TERM     IFNE 'T'                        B1
     C           @TERM     ANDNE'E'                        *1
     C           *INU7     ANDNE'1'                        *1
     C                     EXSR #B                         *1
     C                     END                             E1
     C*
     C/COPY WNCPYSRC,MM0094C005
     C                     EXSR #C
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C* SUBROUTINES USED                                              *
     C*                                                               *
     C*  01  #BAA     - Load amount into period for input date        *
     C*  02  #B       - Main processing                               *
     C*  03  #BA      - Process deal by type                          *
     C*  04  #BB      - Load last update flds into common workflds    *
     C*  05  #BD      - Load before update flds to common workflds    *
     C***06**ZA0830   - Find if a day is a holiday for a currency *****   S01195
     C***07**MM1007   - Calculate interest amount                     *   E17051
     C*  07  MM1030   - Calculate interest amount                     *   E17051
     C***08**MM1009***-*Calculate*the*number*of*interest*days**********   056095
     C*  08  ZINTDY   - Calculate the number of interest days         *   056095
     C***09**MM1005***-*Find*number*of*working*days*forward************   E36300
     C*  10  #C       - Final processing                              *
     C*  11  #A       - Initial processing                            *
     C*  12  ZA0730   - Determine next working day                    *
     C*  13  MM1003   - Calculate a period date                       *
     C*  14  ZA0770   - Convert an 8 0 date to 6 0 format             *
     C***15**ZA0680***-*Convert*YYYYMMDD*to*a*midas*day*number*********   056095
     C***16**ZA0710***-*Convert*midas*day*no.*to*YYYYMMDD*format*******   056095
     C*  15  ZDAT10   - Convert YYYYMMDD to a midas day number        *   056095
     C*  16  ZDATE9   - Convert midas day no. to YYYYMMDD format      *   056095
     C*  17  #BC      - Load period dates array                       *
     C*  18  ZA0150   - Access installation file                      *
     C*  19  INFSR    - Unmonitored file error                        *
     C*  20  *PSSR    - Unmonitored program error                     *
     C*                                                               *
     C* EXTERNAL ROUTINE                                              *
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BAA     - Load amount into period for input date             *
     C*                                                               *
     C**CALLS****ZA0680***-*Convert*YYYYMMDD*to*a*midas*day*number*****   056095
     C* CALLS    ZDAT10   - Convert YYYYMMDD to a midas day number    *   056095
     C***********MM1005***-*Find*number*of*working*days*forward********   E36300
     C*                                                               *
     C* CALLED BY  #BA    - Process deal by type                      *
     C*                                                               *
     C* FLDS USED  @@INTR - Interest amount                           *
     C*            @AMT   - Amount                                    *
     C*************@@END**-*Maturity*date******************************   056095
     C*            ZZEND  - Maturity date                             *   056095
     C*            @DATEM - Date (midas day number)                   *
     C*            @DATE  - Date (YYYYMMDD)                           *
     C*************@@DTIN*-*Input*date*********************************   056095
     C*************@@MDNO*-*Midas*day*number*workfield*****************   056095
     C*            ZZDTIN - Input date                                *   056095
     C*            ZZMDNO - Midas day number workfield                *   056095
     C*            @NTCE  - Notice days                               *
     C*****        @@MNO  - Midas day number workfield            *****   S01195
     C*            @CCY   - Currency                                  *
     C*            @@CCY  - Currency                                  *
     C*            @@FWD  - No. of working days forward               *
     C*            @@FDAT - Forward date                              *
     C*            @D     - Work field                                *
     C*            @PR    - Period dates array                        *
     C*            @DELF  - Delete flag                               *
     C*            @ADSB  - Add or subtract indicator                 *
     C*            @COLUM - Column ind.(taken,placed or fixed)        *
     C*            @L2    - Fixed term liquidities array              *
     C*            @L1    - Taken liquidities array                   *
     C*            @L3    - Placed array                              *
     C*            @FUID  - Work field for Front-up interest indicator*   S01392
     C*                                                               *
     C*****************************************************************
     C           #BAA      BEGSR
     C*
     C** Load interest amount & midas date if interest calculation
     C** has just been performed.
     C           *IN65     IFEQ '1'                        B1
     C                     Z-ADD@@INTR    @AMT             *1
     C*                                                                   S01392
     C** If Front-up Interest indicator on interest is added/deducted     S01392
     C** at value date.                                                   S01392
     C           @FUID     IFEQ 'Y'                        B*2            S01392
     C***********          Z-ADD@@BEG     @DATEM           **2      S01392056095
     C                     Z-ADDZZBEG     @DATEM           **2            056095
     C                     ELSE                            X*2            S01392
     C***********          Z-ADD@@END     @DATEM  50       **2            056095
     C                     Z-ADDZZEND     @DATEM  50       **2            056095
     C                     END                             E*2            S01392
     C*                                                                   S01392
     C                     MOVE '0'       *IN65            *1
     C                     ELSE                            X1
     C*
     C** Convert date to midas day number for comparison with period
     C** dates or exit if not entered.
     C           @DATE     CABEQ0         #BAA9            *1
     C*
     C***********          Z-ADD@DATE     @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @DATEM           *1             056095
     C                     Z-ADD@DATE     ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    @DATEM           *1             056095
     C                     END                             E1
     C*
     C** If this is an uncalled call/notice deal calculate date
     C** of period to be updated : this is DEAL DONE date + notice
     C** (working) days.
     C           *IN66     IFEQ '1'                        B1
     C*
     C** Determine'maturity date'if not present
     C** This is the earliest possible date on which funds can be
     C** called for call/notice deals.
     C******     RUND      IFGT @DATEM                     B*2            S01194
     C           BJRDNB    IFGT @DATEM                     B*2            S01194
     C*
     C******               Z-ADDRUND      @DATEM           **2            S01194
     C                     Z-ADDBJRDNB    @DATEM           **2            S01194
     C                     END                             E*2
     C*
     C** Find number of working days forward represented by notice days
     C           @NTCE     IFNE 0                          B*2
     C                     ADD  @NTCE     @DATEM                          E36300
     C*****                Z-ADD@DATEM    @@MNO            **2    *****   S01195
     C************         Z-ADD@DATEM    ZDAYNO           **2     S01195 E36300
     C*****                MOVE @CCY      @@CCY            **2    *****   S01195
     C************         MOVE @CCY      ZCCY             **2     S01195 E36300
     C************         Z-ADD@NTCE     @@FWD   50       **2            E36300
     C************         EXSR MM1005                     **2            E36300
     C************         Z-ADD@@FDAT    @DATEM           **2            E36300
     C************         ELSE                                           E36300
     C*
     C***If*notice*days*are*zero*calculated*maturity*will*be*at           E36300
     C***spot.*******
     C** run date.
     C*****                MOVE @CCY      @CUR             **2            S01194
     C************         MOVE @CCY      @CUR    3        **2     S01194 E36300
     C*
     C**  Check file not already accessed.
     C***********@CUR      IFNE A6CYCD                     B**3    S01194 E36300
     C*****      @KEY      IFNE KEY                        B**3           S01194
     C*****      @KEY      CHAINFDCCYTLL             60    ***3           S01194
     C*****                                                               S01194
     C***DEAL*WITH DATA BASE ERROR                                        S01194
     C*****      *IN60     IFEQ '1'                        ***************S01194
     C*****                MOVEL'FDCCYTLL'DBFILE           *             *¢01194
     C*****                MOVEL'004'     DBASE            * DBERROR 004 *S01194
     C*****                MOVEL@KEY      DBKEY            *             *S01194
0951 C*                                                                N  S01194
     C***READ*CCY*DETAILS*VIA*ACCESS*PROGRAM                       S01194 E36300
     C************         CALL 'AOCURRR0'                         S01194 E36300
     C************         PARM '*MSG   ' @RTCD   7                S01194 E36300
     C************         PARM '*KEY   ' @OPTN   7                S01194 E36300
     C************         PARM @CUR      @AJCD   3                S01194 E36300
     C***********SDCURR    PARM SDCURR    DSSDY                    S01194 E36300
     C***********@RTCD     IFNE *BLANK                     B***4   S01194 E36300
     C************         MOVEL'SDCURRPD'DBFILE           **********1194 E36300
     C************         MOVEL'04'      DBASE            * DBERR 041194 E36300
     C************         MOVEL@OPTN     DBOPTN  7        ********S01194 E36300
     C************         MOVEL@AJCD     DBKEY            ****4    S01194E36300
     C************         MOVE '1'       *INU7            ***************E36300
     C************         MOVE '1'       *INU8            ****4          E36300
     C************         EXSR *PSSR                      ****4    S01194E36300
     C************         GOTO #BAA9                      ****4          E36300
     C************         END                             E***4          E36300
     C************         END                             E**3           E36300
     C*
     C*******              Z-ADDMSPD      @@DTIN           **2
     C*******              EXSR ZA0680                     **2
     C*******              Z-ADD@@MDNO    @DATEM           **2
     C*
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  If  date input is before todays date it will not affect
     C**  liquidities movements
     C******     @DATEM    CABLTRUND      #BAA9                           S01194
     C           @DATEM    CABLTBJRDNB    #BAA9                           S01194
     C*
     C** Determine period into which date falls
     C*
     C** Find dates position in array this corresponds to the
     C** field on the liquidities array which requires updating.
     C                     Z-ADD1         @D      20
     C           @PR,@D    DOWLT@DATEM                     B1
     C           @D        ANDLT10                         *1
     C                     ADD  1         @D               *1
     C                     END                             E1
     C*
     C************************
     C* Adjust period totals *
     C************************
     C** If delete flag is on (deal deleted or before update
     C** details on amendment need to be removed) then
     C** treat as a deletion by reversing input sign.
     C           @DELF     IFEQ 'Y'                        B1
     C           @ADSB     IFEQ '+'                        B*2
     C                     MOVE '-'       @ADSB   1        **2
     C                     ELSE                            X*2
     C                     MOVE '+'       @ADSB            **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Appropriate field in liquidities totals array is updated
     C** Decide which liquidities totals array to update.
     C**********
     C** FIXED *
     C**********
     C           @COLUM    IFEQ 'F'                        B1
     C*
     C** If > 3 months then do not adjust file for fixed deals
     C           @D        IFLT 10                         B*2
     C*
     C           @ADSB     IFEQ '+'                        B**3
     C           @L2,@D    ADD  @AMT      @L2,@D           ***3
     C                     ELSE                            X**3
     C** Subtract
     C           @L2,@D    SUB  @AMT      @L2,@D           ***3
     C                     END                             E**3
     C*
     C                     END                             E*2
     C                     END                             E1
     C*
     C**********
     C** TAKEN *
     C**********
     C           @COLUM    IFEQ 'T'                        B1
     C*
     C           @ADSB     IFEQ '+'                        B*2
     C           @L1,@D    ADD  @AMT      @L1,@D           **2
     C                     ELSE                            X*2
     C** Subtract
     C           @L1,@D    SUB  @AMT      @L1,@D           **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C***********
     C** PLACED *
     C***********
     C           @COLUM    IFEQ 'P'                        B1
     C*
     C           @ADSB     IFEQ '+'                        B*2
     C           @L3,@D    ADD  @AMT      @L3,@D           **2
     C                     ELSE                            X*2
     C** Subtract
     C           @L3,@D    SUB  @AMT      @L3,@D           **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  File must have been changed if this point reached so
     C**  set on update indicator
     C                     MOVE '1'       *IN64
     C*
     C           #BAA9     ENDSR                           **#BAA9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #B       - Main processing                                    *
     C*                                                               *
     C* CALLS    #BB      - Load last update flds into common workflds*
     C*          #BC      - Load period dates array                   *
     C*          #BA      - Process deal by type                      *
     C*          #BD      - Load before update flds to common workflds*
     C*                                                               *
     C* CALLED BY  MAIN   - Controls program                          *
     C*                                                               *
     C* FLDS USED  @DELF  - Delete flag                               *
     C*            @THDL  - Deal format passed to program             *
     C*            @LACT  - Last action                               *
     C*            @CCY   - Currency                                  *
     C*            @L1    - Taken liquidities array                   *
     C*            @L2    - Fixed term liquidities array              *
     C*            @L3    - Placed array                              *
     C*            @PR    - Period dates array                        *
     C*            @DLUP  - Day of last update                        *
     C*            @MLUP  - Month of last update                      *
     C*            @YLUP  - Year of last update                       *
     C*            @USER  - User i.d.                                 *
     C*            @FUID  - Work field for Front-up interest indicator*   S01392
     C*            @FLID  - Work field for First/Last day interest    *   S01392
     C*            @RDFC  - Work field for Round down interest        *   S01392
     C*            @BFUI  - Work field for Before Front-up int. ind   *   S01392
     C*            @BFLI  - Work field for Before First/Last day int. *   S01392
     C*            @BRDF  - Work field for Before Round down interest *   S01392
     C*                                                               *
     C*****************************************************************
     C           #B        BEGSR
     C*
     C*
     C** Determine record format passed to program & load fields
     C** used so that they can be treated as common.
     C                     EXSR #BB
     C*
     C***************************************
     C* VALIDATE DEAL TYPE IS OK FOR UPDATE *
     C***************************************
     C*
     C** Rate change amendments do not update liquidity exposure
     C*
     C           @THDL     IFEQ 'A'                        B1
     C           IGTYPE    ANDEQ'RC'                       B1
     C                     GOTO #B9                        *1
     C                     END                             E1
     C*
     C** If deletion set on delete flag
     C           @LACT     IFEQ 'D'                        B1
     C                     MOVE 'Y'       @DELF   1        *1
     C                     END                             E1
     C*
     C** If this is an amendment & all fields that might affect
     C** the liquidities file are unchanged then skip further
     C** processing.
     C           @LACT     IFEQ 'A'                        B1
     C*
     C** Determine record format passed to program & load fields
     C** used so that they can be treated as common.
     C                     EXSR #BD                        *1
     C*
     C***********@@BEG     IFEQ @@BBEG                     B*2            056095
     C***********@@END     ANDEQ@@BEND                     **2            056095
     C***********@@CALC    ANDEQ@BCALC                     **2            056095
     C           ZZBEG     IFEQ @@BBEG                     B*2            056095
     C           ZZEND     ANDEQ@@BEND                     **2            056095
     C           ZZCALC    ANDEQ@BCALC                     **2            056095
     C           @@AMT     ANDEQ@@BAMT                     **2
     C           @@RATE    ANDEQ@BRATE                     **2
     C           @AMT      ANDEQ@BAMT                      **2
     C           @CCY      ANDEQ@BCCY                      **2
     C           @NTCE     ANDEQ@BNTCE                     **2
     C           @FVAL     ANDEQ@BFVAL                     **2
     C           @SLINT    ANDEQ@BSLIN                     **2
     C           @NXINT    ANDEQ@BNXIN                     **2
     C           @MATD     ANDEQ@BMATD                     **2
     C           @START    ANDEQ@BSTAR                     **2
     C           @FUID     ANDEQ@BFUI                      **2            S01392
     C           @FLID     ANDEQ@BFLI                      **2            S01392
     C           @RDFC     ANDEQ@BRDF                      **2            S01392
     C                     GOTO #B9                        **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**********************************
     C* Access & update liquidity file *
     C**********************************
     C*
     C** Access liquidity file for currency
     C           @CCY      CHAINMMFLQULL             63
     C*
     C           *IN63     IFEQ '1'                        B1
     C           HQDLTF    OREQ '*'                        *1
     C*
     C** If record does not exist for currency then add a record
     C                     MOVE @CCY      HQCCY            *1          ***
     C                     MOVE 'HQ'      HQRCID           *1
     C                     MOVE ' '       HQDLTF           *1
     C*
     C**  Set date of last update to zeroes to ensure that period dates
     C**  will be calculated
     C                     Z-ADD0         HQDLUP           *1
     C                     MOVE *BLANKS   HQMLUP           *1
     C                     Z-ADD0         HQYLUP           *1
     C                     Z-ADD0         HQTLUP           *1
     C                     MOVE 'I'       HQCHTP           *1
     C                     Z-ADD0         @L1              *1
     C                     Z-ADD0         @L2              *1
     C                     Z-ADD0         @L3              *1
     C                     Z-ADD0         @PR              *1
     C                     ELSE                            X1
     C                     MOVE 'A'       HQCHTP           *1
     C                     END                             E1
     C*
     C** If period dates for this currency have not yet been calculated
     C** today then calculate them & load into the liquidities file.
     C           HQDLUP    IFNE @DLUP                      B1
     C           HQMLUP    ORNE @MLUP                      *1
     C           HQYLUP    ORNE @YLUP                      *1
     C                     EXSR #BC                        *1
     C           *INU7     IFEQ '1'                        B*2
     C                     EXCPTLIQUPD                     **2
     C                     GOTO #B9                        **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Process deals by type.
     C                     EXSR #BA
     C*
     C**  For amendment repeat processing for deal treating it as
     C**  a deletion & using original values which were used to
     C**  adjust liquidity file when this program was called for
     C**  initial deal.
     C           @LACT     IFEQ 'A'                        B1
     C*
     C** Set on delete flag
     C                     MOVE 'Y'       @DELF   1        *1
     C*
     C** Load before update fields to common fields.
     C***********          Z-ADD@@BBEG    @@BEG            *1             056095
     C***********          Z-ADD@@BEND    @@END            *1             056095
     C                     Z-ADD@@BBEG    ZZBEG            *1             056095
     C                     Z-ADD@@BEND    ZZEND            *1             056095
     C                     Z-ADD@@BAMT    @@AMT            *1
     C                     Z-ADD@BRATE    @@RATE           *1
     C                     Z-ADD@BAMT     @AMT             *1
     C                     Z-ADD@BNTCE    @NTCE            *1
     C                     Z-ADD@BFVAL    @FVAL            *1
     C                     Z-ADD@BSLIN    @SLINT           *1
     C                     Z-ADD@BNXIN    @NXINT           *1
     C                     Z-ADD@BMATD    @MATD            *1
     C                     Z-ADD@BSTAR    @START           *1
     C                     MOVE @BCCY     @CCY             *1
     C***********          MOVE @BCALC    @@CALC           *1             056095
     C                     MOVE @BCALC    ZZCALC           *1             056095
     C                     MOVE @BRDF     @RDFC            *1             S01392
     C                     MOVE @BFLI     @FLID            *1             S01392
     C                     MOVE @BFUI     @FUID            *1             S01392
     C*
     C** Process deals by type.
     C                     EXSR #BA                        *1
     C                     END                             E1
     C*
     C** Load date & time of last update fields
     C                     TIME           HQTLUP
     C*******              Z-ADDRUND      HQLCD                           S01194
     C                     Z-ADDBJRDNB    HQLCD                           S01194
     C                     MOVE @USER     HQLUID
     C                     Z-ADD@DLUP     HQDLUP
     C                     MOVE @MLUP     HQMLUP
     C                     Z-ADD@YLUP     HQYLUP
     C*
     C** If record did not exist on liquidities file for this currency
     C** before this call to program add record
     C           *IN63     IFEQ '1'                        B1
     C                     WRITEMMFLIQP0                   *1
     C                     ELSE                            X1             ME1080
     C*
     C** If file has been changed then update record.
     C           *IN64     IFEQ '1'                        B*2
     C*
     C** UPDATE Liquidity exposures file MMFLQULL
     C                     UPDATMMFLIQP0                   **2
     C                     ELSE                            X*2
     C                     EXCPTLIQUPD                     **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #B9       ENDSR                           **#B9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BA      - Process deal by type                               *
     C*                                                               *
     C* CALLS    #BAA     - Load amount into period for input date    *
     C***********MM1007   - Calculate interest amount                 *   E17051
     C*          MM1030   - Calculate interest amount                 *   E17051
     C*                                                               *
     C* CALLED BY  #B     - Main processing                           *
     C*                                                               *
     C* FLDS USED  @THDL  - Deal format passed to program             *
     C*            @TYPE  - Midas deal type                           *
     C*            @MATD  - Maturity date                             *
     C*            @COLUM - Column ind.(taken,placed or fixed)        *
     C*            @ADSB  - Add or subtract indicator                 *
     C*            @START - Value date                                *
     C*            @DATE  - Date (YYYYMMDD)                           *
     C*************@@BEG**-*Last*interest*date*or*maturity*if*sooner***   056095
     C*************@@END**-*Maturity*date******************************   056095
     C*            ZZBEG  - Last interest date or maturity if sooner  *   056095
     C*            ZZEND  - Maturity date                             *   056095
     C*            @DNWD  - Date of next working day                  *
     C*            @AMT   - Amount                                    *
     C*            @FLID  - First & Last Day interest indicator       *   S01392
     C*            @RDFC  - Round down interest indicator             *   S01392
     C*            @@RDFC - Work field used by MM1030 for RDI         *   S01392
     C*            @ENDSV - Work field used to save value of MDATE    *   S01392
     C*                                                               *
     C*****************************************************************
     C           #BA       BEGSR
     C*
     C** Process deals by type.
     C*
     C** Set off interest amount indicator
     C                     MOVE '0'       *IN65
     C** Set off uncalled call/notice indicator
     C                     MOVE '0'       *IN66
     C*******************************
     C** 1. LOAN/DEPOSIT CD ISSUED. *
     C*******************************
     C           @THDL     IFEQ 'L'                        B1
     C****************************************************
     C**  I/BANK TAKING;TIME DEPOSIT;C/N DEPOSIT(called) *
     C****************************************************
     C           @TYPE     IFEQ 'IT'                       B*2
     C           @TYPE     OREQ 'TD'                       **2
     C*
     C           @TYPE     OREQ 'CD'                       **2
     C           @MATD     ANDNE0                          **2
     C*
     C**************************************************
     C** I/BANK PLACING;TIME LOAN;CD ISSUED;           *
     C** C/N DEPOSIT TAKEN(called);DEMAND LOAN(called) *
     C**************************************************
     C           @TYPE     OREQ 'IP'                       B*2
     C           @TYPE     OREQ 'TI'                       **2
     C           @TYPE     OREQ 'CI'                       **2
     C/COPY WNCPYSRC,MM0094C008
      *                                                                                       CDL033
     C           @TYPE     OREQ 'CF'                                                          CDL033
     C           CDL033    ANDEQ'Y'                                                           CDL033
      *                                                                                       CDL033
     C*
     C           @TYPE     OREQ 'CL'                       **2
     C           @MATD     ANDNE0                          **2
     C*
     C           @TYPE     OREQ 'DL'                       **2
     C           @MATD     ANDNE0                          **2
     C*
     C**  Add principle amount at value date subtract principle at
     C**  maturity & interest at next interest date from fixed column.
     C                     MOVE 'F'       @COLUM  1        **2
     C                     MOVE '+'       @ADSB            **2
     C                     Z-ADD@START    @DATE   80       **2
     C*
     C**  Process principle
     C                     EXSR #BAA                       **2
     C*
     C                     MOVE '-'       @ADSB            **2
     C                     Z-ADD@MATD     @DATE            **2
     C                     EXSR #BAA                       **2
     C*
     C**  Process interest IF date details entered
     C***********@@BEG     IFNE 0                          B**3           056095
     C***********@@END     ANDNE0                          ***3           056095
     C           ZZBEG     IFNE 0                          B**3           056095
     C           ZZEND     ANDNE0                          ***3           056095
     C                     MOVE '-'       @ADSB            **2
     C                     MOVE @RDFC     @@RDFC  1        ***3           S01392
     C**                                                                  S01392
     C** If First & Last Day Interest indicator on add an extra           S01392
     C** day's interest. (First save maturity date as it is used          S01392
     C** elsewhere)                                                       S01392
     C*                                                                   S01392
     C***********          Z-ADD@@END     @ENDSV  50       ***3     S01392056095
     C                     Z-ADDZZEND     @ENDSV  50       ***3           056095
     C           @FLID     IFEQ 'Y'                        B***4          S01392
     C***********          ADD  1         @@END            ****4    S01392056095
     C                     ADD  1         ZZEND            ****4          056095
     C                     END                             E***4          S01392
     C*                                                                   S01392
     C*****                EXSR MM1007                     ***3           E17051
     C                     EXSR MM1030                     ***3           E17051
     C                     MOVE '1'       *IN65            ***3
     C***********          Z-ADD@ENDSV    @@END            ***3     S01392056095
     C                     Z-ADD@ENDSV    ZZEND            ***3           056095
     C                     EXSR #BAA                       ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C*********************************
     C** C/N DEPOSIT PLACED(uncalled) *
     C*********************************
     C******************************************************
     C** C/N DEPOSIT TAKEN(uncalled);DEMAND LOAN(uncalled) *
     C******************************************************
     C           @TYPE     IFEQ 'CD'                       B*2
     C           @MATD     ANDEQ0                          **2
     C*
     C           @TYPE     OREQ 'CL'                       **2
     C           @MATD     ANDEQ0                          **2
     C*
     C           @TYPE     OREQ 'DL'                       **2
     C           @MATD     ANDEQ0                          **2
     C*
     C**  Add principle to takings column
     C**  at calculated maturity of Deal
     C**  for CD or placing column for CL or DL
     C**  & to fixed column at value date.
      *
      ****************************************************************
      **  CALCULATED MATURITY DATE OF DEAL :-  The date on which deal*
      **  is made (deal done date) or run date if this is greater    *
      **  + number of working days forward represented by the        *
      **  notice days.                                               *
      ****************************************************************
      *
     C           @TYPE     IFEQ 'CD'                       B**3
     C           @MATD     ANDEQ0                          ***3
     C*
     C                     MOVE 'T'       @COLUM           ***3
     C                     ELSE                            X**3
     C                     MOVE 'P'       @COLUM           ***3
     C                     END                             E**3
     C*
     C                     MOVE '1'       *IN66            **2
     C*
     C                     MOVE '+'       @ADSB            **2
     C*******              Z-ADD@START    @DATE            **2
     C                     Z-ADD@DEALD    @DATE            **2
     C*
     C**  Process principle
     C                     EXSR #BAA                       **2
     C*
     C                     MOVE '0'       *IN66
     C                     MOVE 'F'       @COLUM           **2
     C                     MOVE '+'       @ADSB            **2
     C                     Z-ADD@START    @DATE            **2
     C*
     C**  Process principle
     C                     EXSR #BAA                       **2
     C*
     C                     END                             E*2
     C                     END                             E1
     C*
     C************************
     C** 2. DEAL AMENDMENTS. *
     C************************
     C           @THDL     IFEQ 'A'                        B1
     C********************
     C** SETTLE INTEREST *
     C********************
     C           @TYPE     IFEQ 'SI'                       B*2
     C*
     C** Interest settled on value date of 'SI' sign dependent
     C** on type of deal on which deam is made.
     C*
     C                     MOVE '+'       @ADSB            **2
     C                     Z-ADD@START    @DATE            **2
     C*
     C                     MOVE 'F'       @COLUM           **2
     C                     EXSR #BAA                       **2
     C                     END                             E*2
     C*
     C************************
     C** CAPITALISE INTEREST *
     C************************
     C           @TYPE     IFEQ 'CI'                       B*2
     C/COPY WNCPYSRC,MM0094C009
      *                                                                                       CDL033
     C           @TYPE     OREQ 'CF'                                                          CDL033
     C           CDL033    ANDEQ'Y'                                                           CDL033
      *                                                                                       CDL033
     C*
     C** Interest added at calculated maturity of deal,column dependent
     C** on type of deal on which deam is made.
     C                     MOVE '1'       *IN66
     C           IGOMDT    IFEQ 'CL'                       B**3
     C           IGOMDT    OREQ 'DL'                       ***3
     C*
     C                     MOVE 'P'       @COLUM           ***3
     C                     ELSE                            X**3
     C***************      MOVE 'F'       @COLUM           ***3           E12559
     C                     MOVE 'T'       @COLUM           ***3           E12559
     C                     END                             E**3
     C*                                                                   E12559
     C** Calculate interest amount.                                       E12559
     C***********          Z-ADD@START    @@DTIN           *1       E12559056095
     C***********          EXSR ZA0680                     *1       E12559056095
     C***********          Z-ADD@@MDNO    @DMVDT  50       *1       E12559056095
     C                     Z-ADD@START    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    @DMVDT  50       *1             056095
     C*                                                                   E12559
     C***********          Z-ADDIGRVDT    @@DTIN           *1       E12559056095
     C***********          EXSR ZA0680                     *1       E12559056095
     C***********          Z-ADD@@MDNO    @DLVDT  50       *1       E12559056095
     C                     Z-ADDIGRVDT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    @DLVDT  50       *1             056095
     C*                                                                   E12559
     C******     @DMVDT    IFGE RUND                       B*2      E12559S01194
     C           @DMVDT    IFGE BJRDNB                     B*2            S01194
     C           IGDA38    CHAINMMDEALLL             60    **2            E12559
     C           *IN60     IFEQ '1'                        B**3           E12559
     C                     MOVE '1'       *INU7            ***3           E12559
     C                     MOVE '1'       *INU8            ***************E12559
     C                     MOVEL'MMDEALLL'DBFILE           * DBERROR 008 *E12559
     C                     MOVELIGDA38    DBKEY            ***************E12559
     C                     MOVE '008'     DBASE            ***3           E12559
     C                     MOVE '1'       *INLR            ***3           E12559
     C                     GOTO #BA9                       ***3           E12559
     C                     END                             E**3           E12559
     C***********          MOVE HKICMT    @@CALC           **2      E12559056095
     C                     MOVE HKICMT    ZZCALC           **2            056095
     C                     Z-ADDHKINTR    @@RATE           **2            E12559
     C                     Z-ADDHKAMNP    @@AMT            **2            E12559
     C***********          Z-ADD@DLVDT    @@BEG            **2      E12559056095
     C***********          Z-ADD@DMVDT    @@END            **2      E12559056095
     C                     Z-ADD@DLVDT    ZZBEG            **2            056095
     C                     Z-ADD@DMVDT    ZZEND            **2            056095
     C*****                EXSR MM1007                     **2     E12559 E17051
     C                     EXSR MM1030                     **2            E17051
     C                     Z-ADD@@INTR    @AMT             **2            E12559
     C                     END                             E*2            E12559
     C*                                                                   E12559
     C*********************Z-ADD@START    @DATE            **2            E12559
     C                     Z-ADDIGRVDT    @DATE            **2            E12559
     C*
     C                     MOVE '+'       @ADSB            **2
     C                     EXSR #BAA                       **2
     C                     END                             E*2
     C*
     C******************************************
     C** PRINCIPLE INCREASE/PRINCIPLE DECREASE *
     C******************************************
     C           @TYPE     IFEQ 'PI'                       B*2
     C           @TYPE     OREQ 'PD'                       **2
     C*
     C** Principle added/subtracted at calculated mat. date,column,sign
     C** dependent on type of deal on which deam is made.
     C                     MOVE '+'       @ADSB            ***3
     C           IGOMDT    IFEQ 'CD'                       B**3
     C                     MOVE 'T'       @COLUM           ***3
     C                     ELSE                            X**3
     C*
     C** CL/DL Original deal
     C                     MOVE 'P'       @COLUM           ***3
     C                     END                             E**3
     C*
     C**  If uncalled place principle into taking/placing column at
     C**  at calculated maturity of RELATED deal
      *
      ****************************************************************
      **  CALCULATED MATURITY DATE OF DEAL :-  The date on which deal*
      **  is made (deal done date) or run date if this is greater    *
      **  + number of working days forward represented by the        *
      **  notice days.                                               *
      ****************************************************************
      *
     C           @MATD     IFEQ 0                          B**3
     C*
     C** Obtain deal done date of related deal
     C*
     C** Access deal if this has not been done.
     C           IGDA38    IFNE HKDN38                     B***4
     C           IGDA38    CHAINMMDEALLL             60    ****4
     C*
     C**  If the chain fails or record is deleted : it is a data base
     C**  error.
     C           *IN60     IFEQ '1'                        B****5
     C           HKDDLT    OREQ 'D'                        *****5
     C                     MOVE '1'       *INU7            *****5
     C                     MOVE '1'       *INU8            ***************
     C                     MOVEL'MMDEALLL'DBFILE           * DBERROR 003 *
     C******************** MOVEL@KEY      DBKEY            ***************S01194
     C                     MOVELIGDA38    DBKEY            ***************S01194
     C                     MOVE '003'     DBASE            *****5
     C                     MOVE '1'       *INLR            *****5
     C                     GOTO #BA9                       *****5
     C                     END                             E****5
     C                     END                             E***4
     C*
     C**  Load principle
     C                     MOVE '1'       *IN66            ***3
     C*******              Z-ADDIGRVDT    @DATE            ***3
     C                     Z-ADD@DEALR    @DATE            ***3
     C                     EXSR #BAA                       ***3
     C                     END                             E**3
     C*
     C**  Place principle into fixed term column at deam value date
     C**  Load principle
     C                     MOVE 'F'       @COLUM           **2
     C                     MOVE '0'       *IN66            **2
     C                     Z-ADD@START    @DATE            **2
     C                     EXSR #BAA                       **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C*********************************
     C** 3. NEGOTIABLE ASSETS BOUGHT  *
     C*********************************
     C           @THDL     IFEQ 'B'                        B1
     C*
     C                     MOVE 'F'       @COLUM           *1
     C**************************************
     C** PRIMARY CD;SECONDARY CD;BOND;BILL **************
     C** TREASURY BILL;BANK ACCEPTANCE TRADE ACCEPTANCE *
     C***************************************************
     C*
     C*  For types C1,C2,BP & BD
     C** Subtract purchase price at value date,add interest at first
     C** date due  & when the maturity date is the next working day
     C** add face value at maturity.
     C*
     C** For types TB,DA & TA Subtract purchase price at value date,
     C** & when the maturity date is the next working day
     C** add face value at maturity.
      *                                                                   S01378
      ** The reason for this is that NA's are very liquid (i.e. easily    S01378
      ** sold) so it is hardly worth including them on maturity date      S01378
      ** unless the maturity date is tomorrow and there is little         S01378
      ** chance of selling them (after all we have only just bought       S01378
      ** them). Well, I think this is the reason.                         S01378
     C                     MOVE '+'       @ADSB            *1
     C******               Z-ADD@START    @DATE            *1             s01149
     C                     Z-ADD@DEALD    @DATE            *1             s01149
     C*
     C**  Process principle
     C                     EXSR #BAA                       *1
     C*
     C**  Face value only added when the next working day is also
     C**  the maturity date
     C           @MATD     IFEQ @DNWD                      B*2
     C                     MOVE '-'       @ADSB            **2
     C                     Z-ADD@MATD     @DATE            **2
     C                     Z-ADDIHFVAL    @AMT             **2
     C                     EXSR #BAA                       **2
     C                     END                             E*2
     C*
     C           @TYPE     IFEQ 'C1'                       B*2
     C           @TYPE     OREQ 'C2'                       **2
     C           @TYPE     OREQ 'BP'                       **2
     C           @TYPE     OREQ 'BD'                       **2
     C*
     C**  Process interest IF date details entered
     C***********@@BEG     IFNE 0                          B**3           056095
     C***********@@END     ANDNE0                          ***3           056095
     C           ZZBEG     IFNE 0                          B**3           056095
     C           ZZEND     ANDNE0                          ***3           056095
     C                     MOVE '-'       @ADSB            **2
     C*****                EXSR MM1007                     ***3           E17051
     C                     EXSR MM1030                     ***3           E17051
     C                     MOVE '1'       *IN65            ***3
     C                     EXSR #BAA                       ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C*
     C*******************************
     C** 4. NEGOTIABLE ASSETS SOLD  *
     C*******************************
     C           @THDL     IFEQ 'S'                        B1
     C*
     C                     MOVE 'F'       @COLUM           *1
     C**************************************
     C** PRIMARY CD;SECONDARY CD;BOND;BILL **************
     C** TREASURY BILL;BANK ACCEPTANCE TRADE ACCEPTANCE *
     C***************************************************
     C*
     C** Add sale price at value date.
     C                     MOVE '+'       @ADSB            *1
     C                     Z-ADD@START    @DATE            *1
     C*
     C**  Process principle
     C                     EXSR #BAA                       *1
     C                     END                             E1
     C*
     C           #BA9      ENDSR                           **#BA9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BB      - Load last update flds into common workflds         *
     C*                                                               *
     C**CALLS****ZA0680***-*Convert*YYYYMMDD*to*a*midas*day*number*****   056095
     C* CALLS    ZDAT10   - Convert YYYYMMDD to a midas day number    *   056095
     C*                                                               *
     C* CALLED BY  #B     - Main processing                           *
     C*                                                               *
     C* FLDS USED  @THDL  - Deal format passed to program             *
     C*            @TYPE  - Midas deal type                           *
     C*            @LACT  - Last action                               *
     C*            @CCY   - Currency                                  *
     C*            @AMT   - Amount                                    *
     C*            @NTCE  - Notice days                               *
     C*************@@CALC*-*Calculation*method*************************   056095
     C*            ZZCALC - Calculation method                        *   056095
     C*            @@AMT  - Amount                                    *
     C*            @@RATE - Interest rate                             *
     C*            @FVAL  - Face value                                *
     C*            @SLINT - Start/last interest date                  *
     C*************@@DTIN*-*Input*date*********************************   056095
     C*************@@MDNO*-*Midas*day*number*workfield*****************   056095
     C*************@@BEG**-*Last*interest*date*or*maturity*if*sooner***   056095
     C*            ZZDTIN - Input date                                *   056095
     C*            ZZMDNO - Midas day number workfield                *   056095
     C*            ZZBEG  - Last interest date or maturity if sooner  *   056095
     C*            @NXINT - Next interest date                        *
     C*            @MATD  - Maturity date                             *
     C*************@@END**-*Maturity*date******************************   056095
     C*            ZZEND  - Maturity date                             *   056095
     C*            @START - Value date                                *
     C*            @MNINT  - Next int.date (day no.)                  *
     C*            @MMATD  - Maturity date (day no.)                  *
     C*            @FUID  - Work field for Front-up interest indicator*   S01392
     C*            @FLID  - Work field for First/Last day interest    *   S01392
     C*            @RDFC  - Work field for Round down interest        *   S01392
     C*                                                               *
     C*****************************************************************
     C           #BB       BEGSR
     C** DEAM.
     C           @THDL     IFEQ 'A'                        B1
     C                     MOVE IGMTYP    @TYPE   2        *1
     C                     MOVE IGLACT    @LACT   1        *1
     C                     MOVE IGCCY     @CCY    3        *1
     C                     Z-ADDIGAMNP    @AMT   150       *1
     C*
     C** Value & date
     C                     Z-ADDIGVDYY    I@VDYY           *1
     C                     Z-ADDIGVDMM    I@VDMM           *1
     C                     Z-ADDIGVDDD    I@VDDD           *1
     C*
     C                     Z-ADDIGONTC    @NTCE   30       *1
     C                     END                             E1
     C*
     C           @THDL     IFEQ 'L'                        B1
     C                     MOVE IKMTYP    @TYPE            *1
     C                     MOVE IKCCY     @CCY             *1
     C                     MOVE IKLACT    @LACT            *1
     C                     Z-ADDIKAMNP    @AMT             *1
     C*
     C** Value & maturity date
     C** Start of deal : value date
     C                     Z-ADDIKVDYY    I@VDYY           *1
     C                     Z-ADDIKVDMM    I@VDMM           *1
     C                     Z-ADDIKVDDD    I@VDDD           *1
     C*
     C                     Z-ADDIKMDYY    I@MDYY           *1
     C                     Z-ADDIKMDMM    I@MDMM           *1
     C                     Z-ADDIKMDDD    I@MDDD           *1
     C*
     C** Load fields required by MM1007 for calculation of interest.
     C** Start/last interest date
     C                     Z-ADDIKSLYY    I@SLYY           *1
     C                     Z-ADDIKSLMM    I@SLMM           *1
     C                     Z-ADDIKSLDD    I@SLDD           *1
     C** Next interest date
     C                     Z-ADDIKNIYY    I@NIYY           *1
     C                     Z-ADDIKNIMM    I@NIMM           *1
     C                     Z-ADDIKNIDD    I@NIDD           *1
     C** Deal done date
     C                     Z-ADDIKDDYY    I@DDYY           *1
     C                     Z-ADDIKDDMM    I@DDMM           *1
     C                     Z-ADDIKDDDD    I@DDDD           *1
     C*
     C                     Z-ADDIKNTCE    @NTCE            *1
     C***********          MOVE IKICMT    @@CALC           *1             056095
     C                     MOVE IKICMT    ZZCALC           *1             056095
     C                     Z-ADD@AMT      @@AMT  150       *1
     C                     Z-ADDIKINTR    @@RATE 117       *1
     C*                                                                   S01392
     C** Japanese Sub-Module fields.                                      S01392
     C                     MOVE IKFUID    @FUID            *1             S01392
     C                     MOVE IKFLID    @FLID            *1             S01392
     C                     MOVE IKRDFC    @RDFC            *1             S01392
     C                     END                             E1
     C*
     C** Negotiable assets bought
     C*
     C** Type, currency, and amount
     C*
     C           @THDL     IFEQ 'B'                        B1
     C*
     C                     MOVE IHMTYP    @TYPE            *1
     C                     MOVE IHLACT    @LACT            *1
     C                     MOVE IHCCY     @CCY             *1
     C                     Z-ADDIHAMNP    @AMT             *1
     C                     Z-ADDIHFVAL    @FVAL  150       *1
     C* Dates
     C                     Z-ADDIHVDYY    I@VDYY           *1
     C                     Z-ADDIHVDMM    I@VDMM           *1
     C                     Z-ADDIHVDDD    I@VDDD           *1
     C*
     C                     Z-ADDIHMDYY    I@MDYY           *1
     C                     Z-ADDIHMDMM    I@MDMM           *1
     C                     Z-ADDIHMDDD    I@MDDD           *1
     C*
     C                     Z-ADDIHLIYY    I@SLYY           *1
     C                     Z-ADDIHLIMM    I@SLMM           *1
     C                     Z-ADDIHLIDD    I@SLDD           *1
     C*
     C                     Z-ADDIHNIYY    I@NIYY           *1
     C                     Z-ADDIHNIMM    I@NIMM           *1
     C                     Z-ADDIHNIDD    I@NIDD           *1
     C*
     C***********          MOVE IHICMT    @@CALC           *1             056095
     C                     MOVE IHICMT    ZZCALC           *1             056095
     C                     Z-ADDIHFVAL    @@AMT            *1
     C                     Z-ADDIHFRAT    @@RATE           *1
     C                     END                             E1
     C*
     C**  Negotiable assets sold
     C*
     C           @THDL     IFEQ 'S'                        B1
     C*
     C**  Type, currency, and amount
     C*
     C                     MOVE ILMTYP    @TYPE            *1
     C                     MOVE ILLACT    @LACT            *1
     C                     MOVE ILCCY     @CCY             *1
     C                     MOVE ILAMNP    @AMT             *1
     C*   Dates
     C                     Z-ADDILVDYY    I@VDYY           *1
     C                     Z-ADDILVDMM    I@VDMM           *1
     C                     Z-ADDILVDDD    I@VDDD           *1
     C*
     C                     END                             E1
     C*
     C           @THDL     IFEQ 'L'                        B1
     C           @THDL     OREQ 'B'                        B1
     C*
     C** Convert dates to midas day number
     C           @SLINT    IFNE *ZEROS                     B*2
     C***********          Z-ADD@SLINT    @@DTIN           **2            056095
     C                     Z-ADD@SLINT    ZZDTIN           **2            056095
     C           @SLINT    IFLT @START                     B**3
     C***********          Z-ADD@START    @@DTIN           ***3           056095
     C                     Z-ADD@START    ZZDTIN           ***3           056095
     C                     END                             E**3
     C***********          EXSR ZA0680                     **2            056095
     C***********          Z-ADD@@MDNO    @@BEG            **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZBEG            **2            056095
     C                     ELSE                            X*2
     C***********          Z-ADD0         @@BEG            **2            056095
     C                     Z-ADD0         ZZBEG            **2            056095
     C                     END                             E*2
     C                     END                             E1
     C*
     C           @THDL     IFEQ 'L'                        B1
     C           @THDL     OREQ 'B'                        B1
     C*
     C***Load*earlier*of*NIDT*and*MDAT*to*midas*day*number*@@END*******   056095
     C** Load earlier of NIDT and MDAT to midas day number ZZEND          056095
     C*
     C           @NXINT    IFNE *ZEROS                     B*2
     C***********          Z-ADD@NXINT    @@DTIN           **2            056095
     C***********          EXSR ZA0680                     **2            056095
     C***********          Z-ADD@@MDNO    @@END            **2            056095
     C                     Z-ADD@NXINT    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZEND            **2            056095
     C/COPY WNCPYSRC,MM0094C006
     C                     ELSE                            **2
     C***********          Z-ADD0         @@END            **2            056095
     C                     Z-ADD0         ZZEND            **2            056095
     C                     END                             E*2
     C*
     C***********          Z-ADD@@END     @MNINT  50       *1             056095
     C                     Z-ADDZZEND     @MNINT  50       *1             056095
     C*
     C           @MATD     IFNE *ZEROS                     B*2
     C***********          Z-ADD@MATD     @@DTIN           **2            056095
     C***********          EXSR ZA0680                     **2            056095
     C***********          Z-ADD@@MDNO    @DATEM           **2            056095
     C                     Z-ADD@MATD     ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    @DATEM           **2            056095
     C                     ELSE                            X*2
     C                     Z-ADD0         @DATEM           **2
     C                     END                             E*2
     C*
     C                     Z-ADD@DATEM    @MMATD  50       *1
     C*
     C***********@DATEM    IFLT @@END                      B*2            056095
     C***********@@END     OREQ 0                          **2      MEXXX1056095
     C***********          Z-ADD@DATEM    @@END            **2            056095
     C           @DATEM    IFLT ZZEND                      B*2            056095
     C           ZZEND     OREQ 0                          **2            056095
     C                     Z-ADD@DATEM    ZZEND            **2            056095
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #BB9      ENDSR                           **#BB9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BD      - Load before update flds to common workflds         *
     C*                                                               *
     C**CALLS****ZA0680***-*Convert*YYYYMMDD*to*a*midas*day*number*****   056095
     C* CALLS    ZDAT10   - Convert YYYYMMDD to a midas day number    *   056095
     C*                                                               *
     C* CALLED BY  #B     - Main processing                           *
     C*                                                               *
     C* FLDS USED  @BSLIN - Start/last interest date                  *
     C*            @SLINT - Stored last interest date                 *
     C*            @BNXIN - Next interest date                        *
     C*            @NXINT - Stored next interest date                 *
     C*            @BMATD  - Maturity date                            *
     C*            @MATD  - Stored maturity date                      *
     C*            @BSTAR  - Value date                               *
     C*            @START - Stored value date                         *
     C*            @THDL  - Deal format passed to program             *
     C*            @BCCY   - Currency                                 *
     C*            @BAMT   - Amount                                   *
     C*            @BCALC - Calculation method                        *
     C*            @@BAMT  - Amount                                   *
     C*            @BRATE - Interest rate                             *
     C*            @BNTCE  - Notice days                              *
     C*            @BFVAL  - Face value                               *
     C*************@@DTIN*-*Input*date*********************************   056095
     C*************@@MDNO*-*Midas*day*number*workfield*****************   056095
     C*            ZZDTIN - Input date                                *   056095
     C*            ZZMDNO - Midas day number workfield                *   056095
     C*            @@BBEG  - Last interest date or maturity if sooner *
     C*            @@BEND  - Maturity date                            *
     C*            @MNINT  - Next int.date (day no.)                  *
     C*            @MMATD  - Maturity date (day no.)                  *
     C*            @BFUI  - Work field for Before Front-up int. ind   *   S01392
     C*            @BFLI  - Work field for Before First/Last day int. *   S01392
     C*            @BRDF  - Work field for Before Round down interest *   S01392
     C*                                                               *
     C*****************************************************************
     C           #BD       BEGSR
     C** DEAM.
     C           @THDL     IFEQ 'A'                        B1
     C                     MOVE IGBUCY    @BCCY            *1
     C                     Z-ADDIGBAMT    @BAMT            *1
     C*
     C** Value & Date
     C                     Z-ADDIGBVDT    @BSTAR           *1
     C*
     C                     END                             E1
     C*
     C           @THDL     IFEQ 'L'                        B1
     C                     MOVE IKBUCY    @BCCY            *1
     C                     Z-ADDIKBAMT    @BAMT            *1
     C*
     C** Value & maturity date
     C** Start of deal : value date
     C                     Z-ADDIKBVDT    @BSTAR           *1
     C*
     C                     Z-ADDIKBMTD    @BMATD           *1
     C*
     C** Load fields required by MM1007 for calculation of interest.
     C** Start/last interest date
     C                     Z-ADDIKBLID    @BSLIN           *1
     C** Next interest date
     C                     Z-ADDIKBNID    @BNXIN           *1
     C*
     C                     Z-ADDIKBNTC    @BNTCE           *1
     C                     MOVE IKBICM    @BCALC           *1
     C                     Z-ADD@AMT      @@BAMT           *1
     C                     Z-ADDIKBIRT    @BRATE           *1
     C*                                                                   S01392
     C** Japanese Sub-Module fields.                                      S01392
     C                     MOVE IKBFUI    @BFUI            *1             S01392
     C                     MOVE IKBFLI    @BFLI            *1             S01392
     C                     MOVE IKBRDF    @BRDF            *1             S01392
     C                     END                             E1
     C*
     C** Negotiable assets bought
     C*
     C** Type, currency, and amount
     C*
     C           @THDL     IFEQ 'B'                        B1
     C*
     C                     MOVE IHBUCY    @BCCY            *1
     C                     Z-ADDIHBAMT    @BAMT            *1
     C                     Z-ADDIHBFVL    @BFVAL           *1
     C* Dates
     C                     Z-ADDIHBVDT    @BSTAR           *1
     C*
     C                     Z-ADDIHBMTD    @BMATD           *1
     C*
     C                     Z-ADDIHBLID    @BSLIN           *1
     C*
     C                     Z-ADDIHBNID    @BNXIN           *1
     C*
     C                     MOVE IHBICM    @BCALC           *1
     C                     Z-ADDIHBFVL    @@BAMT           *1
     C                     Z-ADDIHBFRT    @BRATE           *1
     C                     END                             E1
     C*
     C**  Negotiable assets sold
     C*
     C           @THDL     IFEQ 'S'                        B1
     C*
     C**  Type, currency, and amount
     C*
     C                     MOVE ILBAMT    @BAMT            *1
     C*   Dates
     C                     Z-ADDILBVDT    @BSTAR           *1
     C*
     C                     END                             E1
     C*
     C           @THDL     IFEQ 'L'                        B1
     C           @THDL     OREQ 'B'                        B1
     C*
     C** Convert dates to midas day number (IF CHANGED)
     C           @SLINT    IFNE @BSLIN                     B*2
     C*
     C           @BSLIN    IFNE *ZEROS                     B**3
     C***********          Z-ADD@BSLIN    @@DTIN           ***3           056095
     C***********          EXSR ZA0680                     ***3           056095
     C***********          Z-ADD@@MDNO    @@BBEG           ***3           056095
     C                     Z-ADD@BSLIN    ZZDTIN           ***3           056095
     C                     EXSR ZDAT10                     ***3           056095
     C                     Z-ADDZZMDNO    @@BBEG           ***3           056095
     C                     ELSE                            X**3
     C                     Z-ADD0         @@BBEG           ***3
     C                     END                             E**3
     C*
     C                     ELSE                            X*2
     C***********          Z-ADD@@BEG     @@BBEG           **2            056095
     C                     Z-ADDZZBEG     @@BBEG           **2            056095
     C                     END                             E*2
     C                     END                             E1
     C*
     C           @THDL     IFEQ 'L'                        B1
     C           @THDL     OREQ 'B'                        B1
     C*
     C***Load*earlier*of*NIDT*and*MDAT*to*midas*day*number*@@END*******   056095
     C** Load earlier of NIDT and MDAT to midas day number ZZEND          056095
     C*
     C           @BNXIN    IFEQ @NXINT                     B*2
     C                     Z-ADD@MNINT    @@BEND           **2
     C                     ELSE                            X*2
     C           @BNXIN    IFNE *ZEROS                     B**3
     C***********          Z-ADD@BNXIN    @@DTIN           ***3           056095
     C***********          EXSR ZA0680                     ***3           056095
     C***********          Z-ADD@@MDNO    @@BEND           ***3           056095
     C                     Z-ADD@BNXIN    ZZDTIN           ***3           056095
     C                     EXSR ZDAT10                     ***3           056095
     C                     Z-ADDZZMDNO    @@BEND           ***3           056095
     C/COPY WNCPYSRC,MM0094C007
     C                     ELSE                            X**3
     C                     Z-ADD0         @@BEND           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C           @MATD     IFEQ @BMATD                     B*2
     C                     Z-ADD@MMATD    @DATEM           **2
     C                     ELSE                            X*2
     C           @BMATD    IFNE *ZEROS                     B**3
     C***********          Z-ADD@BMATD    @@DTIN           ***3           056095
     C***********          EXSR ZA0680                     ***3           056095
     C***********          Z-ADD@@MDNO    @DATEM           ***3           056095
     C                     Z-ADD@BMATD    ZZDTIN           ***3           056095
     C                     EXSR ZDAT10                     ***3           056095
     C                     Z-ADDZZMDNO    @DATEM           ***3           056095
     C                     ELSE                            X**3
     C                     Z-ADD0         @DATEM           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C           @DATEM    IFLT @@BEND                     B*2
     C           @@BEND    OREQ 0                          **2
     C                     Z-ADD@DATEM    @@BEND           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #BD9      ENDSR                           *** #BD9 ***
     C*
     C/EJECT
      *****                                                       *****   S01195
      **ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY****   S01195
      *****      IS A HOLIDAY IN A PARTICULAR CURRENCY            *****   S01195
      *****                                                       *****   S01195
      **CALLED BY :                                               *****   S01195
      *****                                                       *****   S01195
      **CALLS :                                                   *****   S01195
      *****                                                       *****   S01195
      **INPUT  : @@MNO  MIDAS DAY NUMBER 5N                       *****   S01195
      *****      @@CCY  CURRENCY CODE 3A                          *****   S01195
      *****                                                       *****   S01195
      **OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A          *****   S01195
      *****                                                       *****   S01195
      **USES :   @@MNO  MIDAS DAY NUMBER                          *****   S01195
      *****      @@CCY  CURRENCY CODE                             *****   S01195
      *****      @@ONCE FIRST TIME THROUGH INDICATOR              *****   S01195
      *****      @@CY1  FIRST HALF OF CURRENCY ARRAY              *****   S01195
      *****      @@CY2  SECOND HALF OF CURRENCY ARRAY             *****   S01195
      *****      @@MNO6 MIDAS NUMBER WITH TRAILING BLANK          *****   S01195
      *****      @@HIND HOLIDAY/WORKING DAY INDICATOR             *****   S01195
      *****      @@INEX INCLUDE/EXCLUDE INDICATOR                 *****   S01195
      *****                                                       *****   S01195
      *****      INDICATORS                                       *****   S01195
      *****      80 RECORD NOT FOUND                              *****   S01195
      *****      81 CURRENCY NOT FOUND ON RECORD                  *****   S01195
      *****                                                       *****   S01195
      *****************************************************************   S01195
     C*****      ZA0830    BEGSR                                  *****   S01195
      *****                                                       *****   S01195
      ***OPEN CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH         *****   S01195
     C*****      @@ONCE    IFNE 'Y'                        B1     *****   S01195
     C*****                OPEN FDTABJLL                   *1     *****   S01195
     C*****                MOVE 'Y'       @@ONCE  1        *1     *****   S01195
     C*****                END                             E1     *****   S01195
      *****                                                       *****   S01195
      ***BLANK OUT ARRAY                                          *****   S01195
     C*****                MOVE *BLANKS   @@CY1                   *****   S01195
     C*****                MOVE *BLANKS   @@CY2                   *****   S01195
      *****                                                       *****   S01195
      ***ACCESS TABLE ON FIRST KEY                                *****   S01195
     C*****                MOVEL@@MNO     @@MNO6  6               *****   S01195
     C*****                MOVE @@MNO6    @@0830 12               *****   S01195
     C*****                MOVEL'22    '  @@0830                  *****   S01195
     C*****                MOVE '1'       @@0830                  *****   S01195
     C*****      @@0830    CHAINTABLETJF             80           *****   S01195
      *****                                                       *****   S01195
      ***IF RECORD NOT FOUND OR DELETED                           *****   S01195
     C*****      *IN80     IFEQ '1'                        B1     *****   S01195
     C*****      RECI      OREQ '*'                        *1     *****   S01195
     C*****                MOVE 'W'       @@HIND           *1     *****   S01195
     C*****                GOTO ZA0839                     *1     *****   S01195
     C*****                END                             E1     *****   S01195
      *****                                                       *****   S01195
      ***MOVE FIRST 25 CURRENCIES TO ARRAY                        *****   S01195
     C*****                MOVE HCCY      @@CY1                   *****   S01195
      *****                                                       *****   S01195
      ***ACCESS TABLE ON SECOND KEY                               *****   S01195
     C*****                MOVE '2'       @@0830                  *****   S01195
     C*****      @@0830    CHAINTABLETJF             80           *****   S01195
      *****                                                       *****   S01195
      ***IF SECOND RECORD FOUND AND NOT DELETED                   *****   S01195
     C*****      *IN80     IFEQ '0'                        B1     *****   S01195
     C*****      RECI      ANDNE'*'                        *1     *****   S01195
     C*****                MOVE HCCY      @@CY2            *1     *****   S01195
     C*****                END                             E1     *****   S01195
      *****                                                       *****   S01195
      ***SEARCH ARRAY FOR INPUT CURRENCY                          *****   S01195
     C*****      @@CCY     LOKUP@CY                      81       *****   S01195
      *****                                                       *****   S01195
      ***IF INPUT CURRENCY IS IN ARRAY                            *****   S01195
     C*****      *IN81     IFEQ '1'                        B1     *****   S01195
      *****                                                       *****   S01195
      ***IF INCLUDE/EXCLUDE INDICATOR EQ 'E'                      *****   S01195
     C*****      INEX      IFEQ 'E'                        B*2    *****   S01195
     C*****                MOVE 'W'       @@HIND  1        **2    *****   S01195
     C*****                ELSE                            X*2    *****   S01195
     C*****                MOVE 'H'       @@HIND           **2    *****   S01195
     C*****                END                              *2    *****   S01195
     C*****                END                             E1     *****   S01195
      *****                                                       *****   S01195
      ***IF INPUT CURRENCY IS NOT IN ARRAY                        *****   S01195
     C*****      *IN81     IFEQ '0'                        B1     *****   S01195
      *****                                                       *****   S01195
      ***IF INCLUDE/EXCLUDE INDICATOR EQ 'I'                      *****   S01195
     C*****      INEX      IFEQ 'I'                        B*2    *****   S01195
     C*****                MOVE 'W'       @@HIND           **2    *****   S01195
     C*****                ELSE                            X*2    *****   S01195
     C*****                MOVE 'H'       @@HIND           **2    *****   S01195
     C*****                END                              *2    *****   S01195
     C*****                END                             E1     *****   S01195
     C*****      ZA0839    ENDSR                                  *****   S01195
      *****************************************************************   S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C***********************************************************************
     C/EJECT
     C*****************************************************************   E17051
     C*** MM1007 - CALCULATE INTEREST                                 *   E17051
     C*****                                                           *   E17051
     C***CALLED BY    -                                               *   E17051
     C*****                                                           *   E17051
     C***CALLS        -   MM1009 CALCULATE NO. OF INTEREST DAYS       *   E17051
     C*****                                                           *   E17051
     C***FIELDS INPUT @@BEG  - START DATE OF PERIOD                   *   E17051
     C*****           @@END  - END DATE OF PERIOD                     *   E17051
     C*****           @@CALC - INTEREST CALCULATION METHOD            *   E17051
     C*****           @@AMT  - PRINCIPAL AMOUNT  15N                  *   E17051
     C*****           @@RATE - INTEREST RATE 11,7                     *   E17051
     C*****                                                           *   E17051
     C***FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   E17051
     C*****                                                           *   E17051
     C***WORK FIELDS   @@W155 - 15,5                                      E17051
     C*****                                                           *   E17051
     C*****************************************************************   E17051
     C*****      MM1007    BEGSR                                          E17051
     C*****                                                               E17051
     C*** CALCULATE NUMBER OF INTEREST DAYS                               E17051
     C*****                EXSR MM1009                                    E17051
     C*****                                                               E17051
     C*****      @@CALC    IFEQ '2'                        *** B 1        E17051
     C*****      @@CALC    OREQ '3'                                       E17051
     C*****      @@CALC    OREQ '5'                                       E17051
     C*****      @@AMT     DIV  36000     @@W155 155                      E17051
     C*****                END                             *** E 1        E17051
     C*****                                                               E17051
     C*****      @@CALC    IFEQ '1'                        *** B 1        E17051
     C*****      @@CALC    OREQ '4'                                       E17051
     C*****      @@AMT     DIV  36500     @@W155                          E17051
     C*****                END                              *** E 1       E17051
     C*****                                                               E17051
     C*****      @@CALC    IFEQ '6'                         *** B 1       E17051
     C*****      @@AMT     DIV  36600     @@W155                          E17051
     C*****                END                              *** E 1       E17051
     C*****                                                               E17051
     C*****                MULT @@RATE    @@W155                          E17051
     C*****      @@W155    MULT @@INDY    @@INTR 150H                     E17051
     C*****                                                               E17051
     C*****      M10079    ENDSR                                          E17051
     C*****************************************************************
     C/EJECT                                                              E17051
     C**********************************************************   E17051 S01392
     C****MM1030 - CALCULATE INTEREST                              E17051 S01392
     C******       (MM1030 INCLUDES ADJUSTMENT FOR ERROR IN DIVISIOE17051 S01392
     C******                                                       E17051 S01392
     C***CALLED BY    -                                            E17051 S01392
     C******                                                       E17051 S01392
     C***CALLS        -   MM1009 CALCULATE NO. OF INTEREST DAYS    E17051 S01392
     C******                                                       E17051 S01392
     C***FIELDS INPUT @@BEG  - START DATE OF PERIOD                E17051 S01392
     C******          @@END  - END DATE OF PERIOD                  E17051 S01392
     C******          @@CALC - INTEREST CALCULATION METHOD         E17051 S01392
     C******          @@AMT  - PRINCIPAL AMOUNT  15N               E17051 S01392
     C******          @@RATE - INTEREST RATE 11,7                  E17051 S01392
     C******                                                       E17051 S01392
     C***FIELDS OUTPUT @@INTR - INTEREST 15,0                      E17051 S01392
     C******                                                       E17051 S01392
     C***WORK FIELDS   @@W155 - 15,5                               E17051 S01392
     C******           @@YEAR - (NUMBER OF DAYS IN YEAR) x 100     E17051 S01392
     C******           @@WDIV - 15,5  HOLDS RESULT OF DIVISION     E17051 S01392
     C******           @@ERR  - 15,9  ROUNDING ERROR               E17051 S01392
     C******           @@AMTR - 15,1  AMOUNT FROM ROUNDING ERROR CAE17051 S01392
     C******                    CAN BE 15,1 SINCE IT IS NOT POSSIBLE17051 S01392
     C******                    TO INPUT 15 BYTE FIELDS IN DRS.    E17051 S01392
     C******                                                       E17051 S01392
     C*************************************************************E17051 S01392
     C******     MM1030    BEGSR                                   E17051 S01392
     C******                                                       E17051 S01392
     C****CALCULATE NUMBER OF INTEREST DAYS                        E17051 S01392
     C******               EXSR MM1009                             E17051 S01392
     C******                                                       E17051 S01392
     C******     @@CALC    IFEQ '2'                        *** B 1 E17051 S01392
     C******     @@CALC    OREQ '3'                                E17051 S01392
     C******     @@CALC    OREQ '5'                                E17051 S01392
     C******     @@AMT     DIV  36000     @@WDIV 155               E17051 S01392
     C******               Z-ADD36000     @@YEAR  50               E17051 S01392
     C******               END                             *** E 1 E17051 S01392
     C******                                                       E17051 S01392
     C******     @@CALC    IFEQ '1'                        *** B 1 E17051 S01392
     C******     @@CALC    OREQ '4'                                E17051 S01392
     C******     @@AMT     DIV  36500     @@WDIV                   E17051 S01392
     C******               Z-ADD36500     @@YEAR                   E17051 S01392
     C******               END                              *** E 1E17051 S01392
     C******                                                       E17051 S01392
     C******     @@CALC    IFEQ '6'                         *** B 1E17051 S01392
     C******     @@AMT     DIV  36600     @@WDIV                   E17051 S01392
     C******               Z-ADD36600     @@YEAR                   E17051 S01392
     C******               END                              *** E 1E17051 S01392
     C******                                                       E17051 S01392
     C******     @@WDIV    MULT @@RATE    @@W155 155               E17051 S01392
     C******                                                       E17051 S01392
     C****MULTIPLY @@WDIV BY @@YEAR TO GET ORIGINAL AMOUNT. THE RESE17051 S01392
     C****COULD DIFFER FROM THE ORIGINAL DUE TO ROUNDING ERROR ON  E17051 S01392
     C****DIVISION.                                                E17051 S01392
     C******     @@WDIV    MULT @@YEAR    @@AMTR 151               E17051 S01392
     C******                                                       E17051 S01392
     C****CALCULATE THE ERROR AND DO SAME ARITHMETICAL OPERATIONS AE17051 S01392
     C****@@AMT ABOVE.                                             E17051 S01392
     C******     @@AMT     SUB  @@AMTR    @@ERR  159               E17051 S01392
     C******               MULT @@RATE    @@ERR                    E17051 S01392
     C******               DIV  @@YEAR    @@ERR                    E17051 S01392
     C******                                                       E17051 S01392
     C****ADD RESULT FROM ERROR CALCULATIONS BACK TO THE RESULT FROE17051 S01392
     C****CALCULATIONS ON PRINCIPAL AMOUNT.                        E17051 S01392
     C******               ADD  @@ERR     @@W155                   E17051 S01392
     C******                                                       E17051 S01392
     C****MULTIPLY BY THE PERIOD TO OBTAIN THE INTEREST.           E17051 S01392
     C******     @@W155    MULT @@INDY    @@INTR 150H              E17051 S01392
     C******                                                       E17051 S01392
     C******     M10309    ENDSR                                   E17051 S01392
     C*************************************************************E17051 S01392
      /EJECT
     C*****************************************************************   S01392
     C*                                                               *   S01392
     C*   MM1030 - CALCULATE INTEREST                                 *   S01392
     C*                                                               *   S01392
      *  (c) Misys International Banking Systems Ltd. 2001            *
     C*  CALLED BY    -                                               *   S01392
     C*                                                               *   S01392
     C***CALLS********-***MM1009*CALCULATE*NO.*OF*INTEREST*DAYS*****S01392056095
     C*  CALLS        -   ZINTDY CALCULATE NO. OF INTEREST DAYS       *   056095
     C*                                                               *   S01392
     C***FIELDS*INPUT*@@BEG**-*START*DATE*OF*PERIOD*****************S01392056095
     C****************@@END**-*END*DATE*OF*PERIOD*******************S01392056095
     C****************@@CALC*-*INTEREST*CALCULATION*METHOD**********S01392056095
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   056095
     C*               ZZEND  - END DATE OF PERIOD                     *   056095
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   056095
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C*               @@RATE - INTEREST RATE 11,7                     *   S01392
     C*               @@RDFC - ROUND DOWN FACILITY IND 1              *   S01392
     C*                                                               *   S01392
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C*                                                               *   S01392
     C*  WORK FIELDS   @@W157 - 15,5                                  *   S01392
     C*****************@@W150*-*15,0*******************************S01392 056121
     C*                @@W210 - 21,0                                  *   056121
     C*                @@YEAR - (NUMBER OF DAYS IN YEAR) x 100        *   S01392
     C*                                                               *   S01392
     C*****************************************************************   S01392
     C           MM1030    BEGSR                                          S01392
     C*                                                                   S01392
     C*   CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C/COPY WNCPYSRC,MM0094C001
     C*                                                                   S01392
     C***********          EXSR MM1009                              S01392056095
     C                     Z-ADDZZBEG     ZZBEG9  50                                          CDL093
     C                     Z-ADDZZEND     ZZEND9  50                                          CDL093
      *                                                                                       CDL093
      ** Check if 29th Feb is included                                                        CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
      *                                                                                       CDL093
      ** Convert start date to YYYYMMDD format                                                CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZBEG9    @@DAYN  50                                          CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATA  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY1   40                                          CDL093
      *                                                                                       CDL093
      ** Convert end date to YYYYMMDD format                                                  CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZEND9    @@DAYN                                              CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATB  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY2   40                                          CDL093
      *                                                                                       CDL093
     C                     EXSR #FEB29                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           IKNIPD    ANDNE*ZERO                                                         CDL093
     C           IKNIPD    ANDLTZZEND                                                         CDL093
      *                                                                                       CDL093
     C                     Z-ADDIKIPDM    @@IPDM  20                                          CDL093
     C                     CALL 'MM001031'                                                    CDL093
     C                     PARM           ZZBEG                                               CDL093
     C                     PARM           ZZEND                                               CDL093
     C                     PARM           IKNIPD                                              CDL093
     C                     PARM '9'       ZZCALC                                              CDL093
     C                     PARM           IKIPFQ                                              CDL093
     C                     PARM           @@AMT                                               CDL093
     C                     PARM           @@RATE                                              CDL093
     C                     PARM 'N'       RNDDWN  1                                           CDL093
     C                     PARM 'N'       FRSLST  1                                           CDL093
     C                     PARM           @@IPDM                                              CDL093
     C                     PARM           WINTR                                               CDL093
      *                                                                                       CDL093
     C                     Z-ADDWINTR     @@INTR                                              CDL093
     C           *LIKE     DEFN @@INTR    WINTR                                               CDL093
      *                                                                                       CDL093
     C                     GOTO INTCLC                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C                     EXSR ZINTDY                                    056095
      *                                                                                       CDL093
     C*                                                                   S01392
     C***********@@CALC    IFEQ '2'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '3'                                 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C           ZZCALC    IFEQ '2'                        *** B 1        056095
     C           ZZCALC    OREQ '3'                                       056095
     C           ZZCALC    OREQ '5'                                       056095
     C           ZZCALC    OREQ '0'                                                          CER016A
     C                     Z-ADD36000     @@YEAR  50                      S01392
     C                     END                             *** E 1        S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '1'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '4'                                 S01392056095
     C           ZZCALC    IFEQ '1'                        *** B 1        056095
     C           ZZCALC    OREQ '4'                                       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDNE'Y'                                                           CDL093
     C                     Z-ADD36500     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '6'                         *** B 1 S01392056095
     C           ZZCALC    IFEQ '6'                         *** B 1       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C                     Z-ADD36600     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C           ZZCALC    IFEQ '6'                                       163136
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           INT6DY    MULT @@RATE    @@W157                          163136
     C                     ELSE                                           163136
      *                                                                   163136
     C***********@@INDY    MULT @@RATE    @@W157 157                S01392056095
     C           ZZINDY    MULT @@RATE    @@W157 157                      056095
      *                                                                   163136
     C                     END                                            163136
      *                                                                   163136
     C***********@@W157    MULT @@AMT     @@W150 150H              S01392 056121
     C           @@W157    MULT @@AMT     @@W210 210H                     056121
     C*                                                                   S01392
     C**  ROUND DOWN IF ROUND DOWN INDICATOR IS 'Y'                       S01392
     C*                                                                   S01392
     C           @@RDFC    IFEQ 'Y'                                       S01392
     C***********@@W150    DIV  @@YEAR    @@INTR                   S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR                          056121
     C                     ELSE                                           S01392
     C***********@@W150    DIV  @@YEAR    @@INTR 150H              S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR 150H                     056121
     C                     END                                            S01392
     C*                                                                   S01392
      * Interest has been calculated                                                          CDL093
     C           INTCLC    TAG                                                                CDL093
     C                     MOVE *BLANK    @@RDFC                          S01392
     C/COPY WNCPYSRC,MM0094C002
     C*                                                                   S01392
     C           M10309    ENDSR                                          S01392
     C*****************************************************************
     C/EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZINTDYZ2                                               056095
     C*****************************************************************
     C****MM1009*- CALCULATE THE NUMBER OF INTEREST DAYS              *   056095
     C***********                                                     *   056095
     C***CALLED*BY    -                                               *   056095
     C***********                                                     *   056095
     C***CALLS***     -   ZA0710 CONVERT MIDAS DAY NUMBER TO YMD DATE *   056095
     C***********                                                     *   056095
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                   *   056095
     C***********     @@END  - END DATE OF PERIOD                     *   056095
     C***********     @@CALC - INTEREST CALCULATION METHOD            *   056095
     C***********                                                     *   056095
     C***FIELDS*OUTPUT @@INDY - NO. OF INTEREST DAYS                  *   056095
     C***********                                                     *   056095
     C***WORKFIELDS   @@WN5   - WORK FIELD 5N                         *   056095
     C***********     @@WN5A  - WORK FIELD 5N                         *   056095
     C***********     @@WDAT  - WORK FIELD 5N                         *   056095
     C***********     @@DAYN  - WORK FIELD 5N                         *   056095
     C***********     @@P1    - WORK FIELD 5N                         *   056095
     C***********     @@P2    - WORK FIELD 5N                         *   056095
     C***********     @@P3    - WORK FIELD 5N                         *   056095
     C***********     @@LPNM  - WORKFIELD USED IN SETTING UP @@TG10   *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********MM1009    BEGSR                                          056095
     C***********                                                         056095
     C***********          MOVE @@BEG     @@BEG   50                      056095
     C***********          MOVE @@END     @@END   50                      056095
     C***********          MOVE @@CALC    @@CALC  1                       056095
     C***********          Z-ADD*ZEROS    @@INDY                          056095
     C***********          Z-ADD*ZEROS    @@LPNM                          056095
     C***********                                                         056095
     C***FIND*NUMBER OF DAYS DIFFERENCE BETWEEN DATES                     056095
     C***********                                                         056095
     C***********@@END     SUB  @@BEG     @@WDAT  50                      056095
     C***********                                                         056095
     C*****FOR*CALCULATION METHODS 3,4 OR 5.                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***********@@CALC    OREQ '4'                                       056095
     C***********@@CALC    OREQ '5'                                       056095
     C***********                                                         056095
     C***********          Z-ADD@@BEG     @@DAYN  50                      056095
     C***********          EXSR ZA0710                                    056095
     C***********          Z-ADD@@VDT     @@DATA                          056095
     C***********                                                         056095
     C***********          Z-ADD@@END     @@DAYN                          056095
     C***********          EXSR ZA0710                                    056095
     C***********          Z-ADD@@VDT     @@DATB                          056095
     C***IF*IN*SAME MONTH                                                 056095
     C***********@@YY1     IFEQ @@YY2                      **** B 2       056095
     C***********@@MM1     IFEQ @@MM2                      **** B 3       056095
     C***********@@DD2     SUB  @@DD1     @@INDY                          056095
     C***********          GOTO M10099                     --------->     056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C**IF*NOT*3,4 OR 5    ****                                           056095
     C**EXIT*PROCESSING                                                   056095
     C***********          Z-ADD@@WDAT    @@INDY  50       - LOAD OUTPT   056095
     C***********          GOTO M10099                     ----------->   056095
     C***********          END                             **** E 1       056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***CALC*NO. DAYS IN FIRST MONTH                                     056095
     C***********@@MM1     IFNE 2                          **** B 2       056095
     C***********30        SUB  @@DD1     @@P1    50   80                 056095
     C***IF*<*0,*INITIALISE TO 0                                          056095
     C***80******          Z-ADD*ZEROS    @@P1                            056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C***TEST*IF*LEAP      ****                                           056095
     C***YEAR****                                                         056095
     C***********@@YY1     DIV  4         @@WN5                           056095
     C***********          MVR            @@WN5          80               056095
     C***********                                                         056095
     C************IN80     IFEQ '1'                        **** B 3       056095
     C***********29        SUB  @@DD1     @@P1    50                      056095
     C***********          ELSE                                           056095
     C***IF*NOT*LEAP       ++++                                           056095
     C***********28        SUB  @@DD1     @@P1    50                      056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***CALC.*NO. DAYS IN LAST MONTH                                     056095
     C***********@@DD2     IFLE 30                         **** B 2       056095
     C***********          Z-ADD@@DD2     @@P2    50                      056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********          Z-ADD30        @@P2                            056095
     C***********          END                             **** E 2       056095
     C***CALC*NO. DAYS IN INTERVENING MONTHS                              056095
     C***********@@YY2     IFEQ @@YY1                      **** B 2       056095
     C***********@@MM2     SUB  @@MM1     @@P3    50                      056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 30        @@P3                            056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********@@YY2     SUB  @@YY1     @@P3                            056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 360       @@P3                            056095
     C***********                                                         056095
     C**FIND*NO.*OF MONTHS FOR THE TWO PARTIAL YEARS                      056095
     C***********12        SUB  @@MM1     @@WN5A  50                      056095
     C***********          MULT 30        @@WN5A                          056095
     C***********                                                         056095
     C***********@@MM2     SUB  1         @@WN5                           056095
     C***********@@WN5     MULT 30        @@WN5                           056095
     C***ACCUMULATE                                                       056095
     C***********@@WN5A    ADD  @@WN5     @@WN5A                          056095
     C***********@@P3      ADD  @@WN5A    @@P3                            056095
     C***********          END                             **** E 2       056095
     C***FINAL*SUM                                                        056095
     C***********                                                         056095
     C***********@@P1      ADD  @@P2      @@INDY                          056095
     C***********          ADD  @@P3      @@INDY                          056095
     C***********          END                             **** E 1       056095
     C***FOR*METHODS 4 AND 5                                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '4'                        **** B 1       056095
     C***********@@CALC    OREQ '5'                                       056095
     C****CALCULATE NUMBER OF LEAP YEARS BETWEEN START AND END DATES      056095
     C***********@@MM1     IFLE 2                          **** B 2       056095
     C***********@@YY1     DIV  4         @@WN5   50                   YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM  50                      056095
     C***********          END                             **** E 3       056095
     C***BYPASS*IF YEARS ARE THE SAME                                     056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          GOTO M10099                     ---------->    056095
     C***********          END                             **** E 2       056095
     C***LOOP*TO*CALCULATE NO. LEAP YEARS                                 056095
     C***********@@YY1     DOWNE@@YY2                      **** B 2       056095
     C***INCREMENT START YEAR                                             056095
     C***********          ADD  1         @@YY1                           056095
     C***********                                                         056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@MM2     IFGT 2                          **** B 4       056095
     C***********@@YY2     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***INCREMENT IF LEAP YEAR                                           056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 4      056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          END                              **** E 3      056095
     C***********@@YY1     IFNE @@YY2                       **** B 3      056095
     C***********@@YY1     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 3      056095
     C***********          END                              **** E 2      056095
     C***********          END                              **** E 1      056095
     C***********                                                         056095
     C***********M10099    ENDSR                           ***M10099***   056095
     C*
     C/EJECT
     C***********************************************************************
     C****************************************************************    E36300
     C**MM1005*-*THIS*SUBROUTINE*FINDS*OUT*THE*NUMBER*OF*WORKING*DAYS*    E36300
     C***********FORWARD*FOR*A*SPECIFIC*CURRENCY*AGAINST*A*LOCAL******    E36300
     C***********CURRENCY.********************************************    E36300
     C****************************************************************    E36300
     C**CALLED*BY*:***************************************************    E36300
     C****************************************************************    E36300
     C**CALLS*:**ZA0830,*A*COMMON*ROUTINE*TO*DETERMINE*WHETHER*A*DATE1195 E36300
     C**CALLS*:**ZCHKH*,*A*COMMON*ROUTINE*TO*DETERMINE*WHETHER*A*DATE1195 E36300
     C***********IS*A*WORKING*DAY*OR*A*HOLIDAY.***********************    E36300
     C****************************************************************    E36300
     C**INPUT**:*@@MNO**MIDAS*DAY*NUMBER*5N************************S01195 E36300
     C***********@@CCY**CURRENCY*CODE*3A***************************S01195 E36300
     C**INPUT**:*ZDAYNO*MIDAS*DAY*NUMBER*5N************************S01195 E36300
     C***********ZCCY***CURRENCY*CODE*3A***************************S01195 E36300
     C***********@@FWD**NO.*OF*WORKING*DAYS*FORWARD*5N****************    E36300
     C****************************************************************    E36300
     C**OUTPUT*:*@@FDAT*FORWARD*DATE*(MIDAS*DAY*NUMBER)*5N************    E36300
     C****************************************************************    E36300
     C**USES*:***@@MNO**MIDAS*DAY*NUMBER***************************S01195 E36300
     C***********@@CCY**CURRENCY*CODE******************************S01195 E36300
     C**USES*:***ZDAYNO*MIDAS*DAY*NUMBER***************************S01195 E36300
     C***********ZCCY***CURRENCY*CODE******************************S01195 E36300
     C***********@@WF2**WORK*FIELD*5N*********************************    E36300
     C***********@@HIND*HOLIDAY/WORKING*DAY*INDICATOR**1A**********S01195 E36300
     C***********ZIND***HOLIDAY/WORKING*DAY*INDICATOR**1A**********S01195 E36300
     C***********@@FWD**NUMBER*OF*WORKING*DAYS*FORWARD*TO*LOOK*5N*****    E36300
     C****************************************************************    E36300
     C**FILES*:*THIS*PROGRAM*EXPECTS*FILE*FCICDRLL*TO*HAVE*BEEN*******    E36300
     C**********DEFINED*AND*ALREADY*ACCESSED*WITH*A*KEY*OF************    E36300
     C**********'01********11'.***************************************    E36300
     C****************************************************************    E36300
     C***********************************************************************
     C***********MM1005    BEGSR                                          E36300
     C***INITIALISE FIELDS                                                E36300
     C*********************Z-ADD@@MNO     @@MNO   50                      S01195
     C************         Z-ADDZDAYNO    ZDAYNO  50               S01195 E36300
     C************         Z-ADD*ZEROS    @@WF2   50                      E36300
     C************                                                        E36300
     C****LOOP*TO*PROCESS*INPUT*PARAMETERS****************************    E36300
     C************                                                        E36300
     C***********@@WF2     DOWLT@@FWD                      *** B 1        E36300
     C***INCREMENT*NUMBER*OF*WORK*DAYS********************************    E36300
     C************         ADD  1         @@WF2                           E36300
     C***INCREMENT*DATE***********************************************    E36300
     C*********************ADD  1         @@MNO                           S01195
     C************         ADD  1         ZDAYNO                   S01195 E36300
     C***LOOP*TO*OBTAIN*FIRST*WORKING*DAY*****************************    E36300
     C***********@@HIND****DOUEQ'W'*************************** B 2        S01195
     C***********ZIND      DOUEQ'W'                         ** B 2 S01195 E36300
     C***CALL*COMMON*ROUTINE*TO*DETERMINE*IF*WORKING*DAY**************    E36300
     C*********************EXSR ZA0830                                    S01195
     C************         EXSR ZCHKH                      ***3    S01195 E36300
     C***INCREMENT*NUMBER*OF*WORK*DAYS*-*IF*FOUND*TO*BE*HOLIDAY*******    E36300
     C***********@@HIND    IFEQ 'H'                        *** B 3        S01195
     C*********************ADD  1         @@MNO                           S01195
     C***********ZIND      IFEQ 'H'                        *** B 3 S01195 E36300
     C************         ADD  1         ZDAYNO                   S01195 E36300
     C************         END                             *** E 3        E36300
     C************         +                                              E36300
     C************         END                             *** E 2        E36300
     C************         ++                                             E36300
     C***TEST*IF*WORKING*DAY*FOR*LOCALS*******************************    E36300
     C*********************MOVE @@CCY     @@WA3   3                       S01195
     C*********************MOVE LCCY      @@CCY   3                       S01195
     C*********************MOVE *BLANKS   @@HIND  1                       S01195
     C************         MOVE ZCCY      @@WA3   3                S01195 E36300
     C************         MOVE BJLCCY    ZCCY    3                S01195 E36300
     C************         MOVE *BLANKS   ZIND    1                S01195 E36300
     C************                                                        E36300
     C***CALL*COMMON*ROUTINE*AGAIN************************************    E36300
     C*********************EXSR ZA0830                                    S01195
     C************         EXSR ZCHKH                      ***3    S01195 E36300
     C***RESTORE*FIELD*TO*ORIGINAL*VALUE******************************    E36300
     C*********************MOVE @@WA3     @@CCY   3                       S01195
     C************         MOVE @@WA3     ZCCY    3                       S01195
     C***IF*LOCAL*HOLIDAY*DECREMENT*COUNTER***************************    E36300
     C***********@@HIND****IFEQ 'H'                        *** B 2        S01195
     C***********ZIND      IFEQ 'H'                        *** B 2 S01195 E36300
     C************         SUB  1         @@WF2                           E36300
     C************         END                             *** E 2        E36300
     C************         +                                              E36300
     C************         END                             *** E 1        E36300
     C************         ++                                             E36300
     C***LOAD*OUTPUT*FIELD********************************************    E36300
     C*********************Z-ADD@@MNO     @@FDAT  50                      S01195
     C************         Z-ADDZDAYNO    @@FDAT  50               S01195 E36300
     C************                                                        E36300
     C***********M10059    ENDSR                                          E36300
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #C       - Final processing                                   *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  MAIN   - Controls program                          *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C           #C        BEGSR
     C*
     C** Set on LR & exit if termination parmater is 'T'
     C           @TERM     IFEQ 'T'                        B1
     C                     MOVE '1'       *INLR            *1
     C                     RETRN
     C                     GOTO #C9                        *1
     C                     END                             E1
     C*
     C**  If a data base error has occurred in one of the called
     C**  programs return without setting on
     C**  *INLR or closing the files.
     C           @TERM     IFEQ 'E'                        B1
     C                     RETRN                           *1
     C                     END                             E1
     C*
     C**  If a data base error has occurred in the program, set
     C**  termination parameter to 'E' & exit program
     C**  setting on *inLR
     C           *INU7     IFEQ '1'                        B1
     C                     MOVE 'E'       @TERM            *1
     C                     MOVE '1'       *INLR            *1
     C                     RETRN                           *1
     C                     GOTO #C9                        *1
     C                     END                             E1
     C*
     C                     RETRN
     C*
     C           #C9       ENDSR                           **#C9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #A       - Initial processing                                 *
     C*                                                               *
     C* CALLS    ZA0150   - Access installation file                  *
     C***********ZA0710***-*Convert*midas*day*no.*to*YYYYMMDD*format***   056095
     C*          ZDATE9   - Convert midas day no. to YYYYMMDD format  *   056095
     C*                                                               *
     C* CALLED BY  MAIN   - Controls program                          *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter                     *
     C*            @THDL  - Deal format passed to program             *
     C*            @STDL  - Standard deal d.s. : loans & deposits     *
     C*            @STDB  - Standard deal d.s. : N/A's bought         *
     C*            @STDS  - Standard deal d.s. : N/A's sold           *
     C*            @STDA  - Standard deal d.s. : deal amendments      *
     C*            @FIRST - Program has been called before indicator  *
     C*            @@RUND - Run date YYYYMMDD                         *
     C******       @KEY   - Key to currencies file                    *   S01194
     C*            @@DAYN - Midas day number                          *
     C*************@@VDT**-*Date*output*from*ZA0710********************   056095
     C*            @@VDT  - Date output from ZDATE9                   *   056095
     C*            @DNWD  - Date of next working day                  *
     C*            @FUID  - Work field for Front-up interest indicator*   S01392
     C*            @FLID  - Work field for First/Last day interest    *   S01392
     C*            @RDFC  - Work field for Round down interest        *   S01392
     C*            @BFUI  - Work field for Before Front-up int. ind   *   S01392
     C*            @BFLI  - Work field for Before First/Last day int. *   S01392
     C*            @BRDF  - Work field for Before Round down interest *   S01392
     C*                                                               *
     C*****************************************************************
     C           #A        BEGSR
     C*
      ** Switch off *INU7 and *INU8, in case they have been left on       CAP002
      ** by a program elsewhere in the structure.                         CAP002
     C                     CLEAR*INU7                                     CAP002
     C                     CLEAR*INU8                                     CAP002
      *                                                                   CAP002
     C                     MOVEACPY@      BIS@   80                       S01194
     C**  Parameter list .
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C                     PARM           @THDL   1
     C                     PARM           @STDL
     C                     PARM           @STDB
     C                     PARM           @STDS
     C                     PARM           @STDA
     C*
     C**  Move program name into *LDA field.
     C                     MOVEL'MM0094'  DBPGM
     C*
     C** INITIALISE INDICATORS & WORKFIELDS
     C*
     C                     MOVE '0'       *IN60
     C                     MOVE '0'       *IN63
     C                     MOVE '0'       *IN61
     C                     MOVE '0'       *IN62
     C                     MOVE '0'       *IN64
     C                     MOVE 'N'       @DELF
     C*
     C                     Z-ADD0         @@BBEG  50
     C                     Z-ADD0         @@BEND  50
     C                     Z-ADD0         @@BAMT 150
     C                     Z-ADD0         @BRATE 117
     C                     Z-ADD0         @BAMT  150
     C                     Z-ADD0         @BFVAL 150
     C                     Z-ADD0         @BSLIN  80
     C                     Z-ADD0         @BNXIN  80
     C                     Z-ADD0         @BMATD  80
     C                     Z-ADD0         @BSTAR  80
     C                     Z-ADD0         @BNTCE  30
     C                     MOVE *BLANK    @BCALC  1
     C                     MOVE *BLANKS   @BCCY   3
     C                     MOVE *BLANK    @BFUI   1                       S01392
     C                     MOVE *BLANK    @BFLI   1                       S01392
     C                     MOVE *BLANK    @BRDF   1                       S01392
     C                     MOVE *BLANK    @FUID   1                       S01392
     C                     MOVE *BLANK    @FLID   1                       S01392
     C                     MOVE *BLANK    @RDFC   1                       S01392
     C*
     C***********          Z-ADD0         @@BEG                           056095
     C***********          Z-ADD0         @@END                           056095
     C                     Z-ADD0         ZZBEG                           056095
     C                     Z-ADD0         ZZEND                           056095
     C                     Z-ADD0         @@AMT
     C                     Z-ADD0         @@RATE
     C                     Z-ADD0         @AMT
     C                     Z-ADD0         @FVAL
     C                     Z-ADD0         @SLINT
     C                     Z-ADD0         @NXINT
     C                     Z-ADD0         @MATD
     C                     Z-ADD0         @START
     C                     Z-ADD0         @NTCE
     C                     MOVE *BLANKS   @TYPE
     C***********          MOVE *BLANK    @@CALC                          056095
     C                     MOVE *BLANK    ZZCALC                          056095
     C                     MOVE *BLANKS   @CCY
     C*
     C**  Open files if first run
     C           @FIRST    IFNE 'Y'                        B1
     C                     MOVE 'Y'       @FIRST  1        *1
     C                     Z-ADD0         @@RUND           *1
     C*****                OPEN FDICDRLL                   *1             S01194
     C***********          OPEN FDCCYTLL                   *1             S01194
     C***********          OPEN FDINSTLL                   *1        **S01136**
     C                     OPEN MMFLQULL                   *1
     C                     OPEN MMDEALLL                   *1
     C*
     C***ACCESS*TABTB10**                                                 S01194
     C******                                                              S01194
     C******               EXSR ZA0150                     *1             S01194
     C******                                                              S01194
     C****Read file FDICDRLL, format TABTB11.                             S01194
     C******               MOVE *BLANKS   @KEY                            S01194
     C******               MOVEL'01'      @KEY                            S01194
     C******               MOVE '11'      @KEY                            S01194
     C******     @KEY      CHAINFDICDRLL             60                   S01194
     C******                                                              S01194
     C****If*the*chain fails or RECI is not 'D' then it is a data base    S01194
     C****error.**                                                        S01194
     C******     *IN60     IFEQ '1'                        B1             S01194
     C******     RECI      ORNE 'D'                        *1             S01194
     C** OBTAIN BANK DETAILS VIA ACCESS PROGRAM                           S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            ***************
     C                     MOVEL'01'      DBASE            * DBERR 01 *   S01194
     C                     MOVEL'SDBANKPD'DBFILE           ************   S01194
     C******               MOVEL'FDICDRLL'DBFILE           * DBERROR 001 *S01194
     C******               MOVEL@KEY      DBKEY            ***************S01194
     C******               MOVE '001'     DBASE            *1             S01194
     C                     MOVE '1'       *INLR            *1
     C                     EXSR *PSSR                                     S01194
     C*
     C                     GOTO #A9                        *1
     C                     END                             E1
     C*                                                                   S01194
     C** MOVE RUN DATE INTO RUNA TO SPLIT INTO FIELDS IN DATA STRUCTURE   S01194
     C                     MOVELBJMRDT    RUNA                            S01194
     C*
     C/COPY WNCPYSRC,MM0094C003
     C** Convert date of next working day to DDMMYYYY format
     C** for comparison with other dates
     C*****                Z-ADDDNWD      @@DAYN                          S01194
     C                     Z-ADDBJDNWD    @@DAYN                          S01194
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     @DNWD   80
     C*
     C** ACCESS FDINSTLL
     C********** 1         CHAINFDINSTLL             60    *1        **S01136**
     C*
     C** NO LIVE RECORD ON PF/FDINSTPP THEN DATABASE ERROR
     C*********  *IN60     IFEQ '1'                        B*2       **S01136**
     C*********  IDDLTF    OREQ '*'                        **2       **S01136**
     C*********            MOVE '005'     DBASE            ********* **S01136**
     C*********            MOVEL'FDINSTLL'DBFILE           *         **S01136**
     C*********            MOVE *BLANKS   DBKEY            * DBERROR **S01136**
     C*********            MOVE '1'       *INU7            *         **S01136**
     C*********            MOVE '1'       *INU8            ********* **S01136**
     C*********            GOTO #A9                        **2       **S01136**
     C*********            END                             E*2       **S01136**
     C*********                                                           S01194
     C***Load*key*used to access currencies file.                         S01194
     C*********            MOVE *BLANKS   @KEY             *1             S01194
     C*********            MOVEL'20'      @KEY             *1             S01194
     C*********            MOVE '1'       @KEY             *1             S01194
     C                     END                             E1
     C                     MOVE *BLANK    CDL033  1                                           CDL033
     C                     CALL 'AOSARDR0'                                                    CDL033
     C                     PARM *BLANKS   PRTCD   7                                           CDL033
     C                     PARM '*VERIFY' POPTN   7                                           CDL033
     C                     PARM 'CDL033'  PSARD   6                                           CDL033
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL033
      *                                                                                       CDL033
     C           PRTCD     IFEQ *BLANKS                                                       CDL033
     C                     MOVE 'Y'       CDL033                                              CDL033
     C                     ELSE                                                               CDL033
     C           PRTCD     IFNE '*NRF   '                                                     CDL033
     C                     MOVE '908'     DBASE                                               CDL033
     C                     MOVEL'CDL033  'DBKEY                                               CDL033
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL033
     C                     EXSR *PSSR                                                         CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C*
     C           #A9       ENDSR                           **#A9**
     C*
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*       TITLE:DETERMINE NEXT WORKING DAY.                       *
     C*                                                               *
     C********SUBROUTINE*ZA0730*EXPECTS*FIELD*'@@DTIN'*TO*BE***********   056095
     C*       SUBROUTINE ZA0730 EXPECTS FIELD 'ZZDTIN' TO BE          *   056095
     C*       PASSED TO IT IN 'YYYYMMDD' FORMAT.IT THEN DETERMINES    *
     C*       THE NEXT WORKING DAY AND RETURNS.                       *
     C*                                                               *
     C**INPUT**:@@DTIN*DATE*(YYYYMMDD)*-*IN*DATA*STRUCTURE*(SIZE*:*8N)*   056095
     C* INPUT  :ZZDTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)*   056095
     C*         @@CCY  CURRENCY CODE   - IN FORMAT(3A)                *
     C*                                                               *
     C* OUTPUT :@@VDT  DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)*
     C*                                                               *
     C**USES*:***@@MDNO*MIDAS*DAY*NO*USED*BY*SR*ZA0680*****************   056095
     C***********@@DAYN*MIDAS*DAY*NO*USED*BY*SR*ZA0710*****************   056095
     C* USES :   ZZMDNO MIDAS DAY NO USED BY SR ZDAT10                *   056095
     C*          @@DAYN MIDAS DAY NO USED BY SR ZDATE9                *   056095
     C*****      @@MNO  MIDAS DAY NO USED BY SR ZA0830                *
     C*          ZDAYNO MIDAS DAY NO USED BY SR ZA0830                *
     C*****      @@HIND HOLIDAY IND.RETURNED BY ZA0830                *
     C*          ZIND HOLIDAY IND.RETURNED BY ZA0830                  *
     C*                                                               *
     C*****************************************************************
     C           ZA0730    BEGSR
     C*
     C* CONVERT YYYYMMDD FORMAT TO MIDAS DAY NO.
     C*
     C***********          EXSR ZA0680                                    056095
     C                     EXSR ZDAT10                                    056095
     C*
     C           ZA0731    TAG
     C*
     C***********          ADD  1         @@MDNO  50                      056095
     C                     ADD  1         ZZMDNO  50                      056095
     C*
     C* CHECK IF DAY NO. IS A HOLIDAY          .
     C*
     C*****                Z-ADD@@MDNO    @@MNO   50
     C***********          Z-ADD@@MDNO    ZDAYNO                          056095
     C                     Z-ADDZZMDNO    ZDAYNO                          056095
     C*
     C*****                EXSR ZA0830                            *****   S01195
     C                     EXSR ZCHKH                                     S01195
     C*
     C*****      @@HIND    IFEQ 'H'
     C           ZIND      IFEQ 'H'
     C                     GOTO ZA0731
     C                     END
     C*
     C* CONVERT MIDAS DAY NO. TO YYYYMMDD FORMAT.
     C*
     C***********          Z-ADD@@MDNO    @@DAYN  50                      056095
     C                     Z-ADDZZMDNO    @@DAYN  50                      056095
     C*
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C*
     C           ZA0739    ENDSR                                       **
      /EJECT
      *****************************************************************
      *   MM1003 - CALCULATE A PERIOD DATE                            *
      *                                                               *
      *   PERIOD DATES ARE CALCULATED FOR THE FOLLOWING PERIODS       *
      *      PERIOD TYPE       PERIOD NUMBER     PERIOD SHORTNAME     *
      *           D                 -1             OVERNIGHT          *
      *           D                  0             TOMORROW / NEXT    *
      *           D                  1             SPOT / NEXT        *
      *           W                  1             1 WEEK             *
      *           W                  2             2 WEEK             *
      *           W                  3             3 WEEK             *
      *           M                  1             1 MONTH            *
      *           M                  2             2 MONTH            *
      *           M                  3             3 MONTH            *
      *           M                  6             6 MONTH            *
      *           M                  9             9 MONTH            *
      *           Y                  1             1 YEAR             *
      *                                                               *
      *  CALLED BY    -                                               *
      *                                                               *
      *  CALLS        -                                               *
      *                                                               *
      *  ZA0770       - CONVERT DATE YYYYMMDD TO DDMMYY               *
      *  ZA0830       - CHECK IF DAY IS A WORKING DAY                 *
      *  ZA0730       - FIND NEXT WORKING DAY                         *
      ***ZA0710*******-*CONVERT*MIDAS*DAY*NO*TO*YYYYMMDD***************   056095
      ***ZA0680*******-*CONVERT*DATE*TO*MIDAS*DAY*NUMBER***************   056095
      *  ZDATE9       - CONVERT MIDAS DAY NO TO YYYYMMDD              *   056095
      *  ZDAT10       - CONVERT DATE TO MIDAS DAY NUMBER              *   056095
      *                                                               *
      *  CALLS PROGRAM ZA0270 CONVERT DATE TO MIDAS DAY NUMBER WITH   *
      *                VALIDATION CHECK                               *
      *                                                               *
      *  FIELDS INPUT -                                               *
      *                                                               *
      *  @@CCY   3    - CURRENCY                                      *
      *  @@SPOT  8    - MONEY MARKET SPOT DATE                        *
      *  @@PNUM  1,0  - PERIOD NUMBER                                 *
      *  @@PTYP  1    - PERIOD TYPE                                   *
      ***RUND****5,0**-*MIDAS*RUN*DATE****                            *   S01194
      *  BJAKTX  5,0  - MIDAS RUN DATE                                *   S01194
      *                                                               *
      *  FIELDS OUTPUT                                                *
      *                                                               *
      *  @@PDAT  8,0  - PERIOD DATE                                   *
      *                                                               *
      *  WORK FIELDS                                                  *
      *                                                               *
      *  @@DTIN  8,0  - DATE INPUT TO ZA0770 IN YYYYMMDD FORMAT       *
      *  ZZDTIN  8,0  - DATE INPUT TO ZA0730 IN YYYYMMDD FORMAT       *   056095
      *  @@DFMT  1    - DATE FORMAT                                   *
      *  @@RTNC  1    - RETURN INDICATOR FROM ZA0270                  *
      *  @@DAYN  5,0  - MIDAS DAY NUMBER                              *
      ***@@MNO   5,0  - MIDAS DAY NUMBER                              *
      ***@@HIND  1    - HOLIDAY INDICATOR H OR W                      *
      *  @@ADD   3,0  - CALCULATION WORK FIELD                        *
      ***@@VDT***8,0**-*DATE*OUTPUT*FROM*ZA0710************************   056095
      *  @@VDT   8,0  - DATE OUTPUT FROM ZDATE9                       *   056095
      *  @@RUND  8    - RUN DATE IN YYYYMMDD FORMAT                   *
      *                                                               *
      *****************************************************************
      *
     C           MM1003    BEGSR
      *
     C                     Z-ADD*ZERO     @@STRT
     C                     Z-ADD*ZERO     @@DTIN
     C                     Z-ADD*ZERO     ZZDTIN                          056095
     C                     Z-ADD*ZERO     @@SPDD
     C                     Z-ADD*ZERO     @@DATE
     C                     Z-ADD*ZERO     @@DTOU
     C                     Z-ADD*ZERO     @@Z71Y
     C                     Z-ADD*ZERO     @@VDT
      *
     C                     MOVE @@SPOT    @@SPDD
      **  SET UP STARTING POINT DATE AS SPOT DATE
     C                     Z-ADD@@SPDD    @@STRT
      *
      **  ADD PERIOD NUMBERS TO DATE
     C           @@PTYP    IFEQ 'M'                        B1
     C                     ADD  @@PNUM    @@STMT           *1
     C           @@STMT    IFGT 12                         B*2
     C                     SUB  12        @@STMT           **2
     C                     ADD  1         @@STYR           **2
     C                     END                              *2
     C                     END                             E1
      *
     C           @@PTYP    IFEQ 'Y'                        B1
     C                     ADD  1         @@STYR           *1
     C                     END                             E1
      *
      **  CONVERT DATE FORMAT FROM YYYYMMDD TO DDMMYY
     C                     Z-ADD@@STRT    @@DTIN
     C                     EXSR ZA0770
     C                     Z-ADD@@DTOU    @@DATE
      *
     C           *LIKE     DEFN @@VDT     @@RUND
     C           @@RUND    IFEQ *ZERO                      B1
     C*********            Z-ADDRUND      @@DTIN           *1             S01194
     C***********          Z-ADDBJRDNB    @@DTIN           *1       S01194056095
     C***********          EXSR ZA0710                     *1             056095
     C                     Z-ADDBJRDNB    @@DAYN           *1             056095
     C                     EXSR ZDATE9                     *1             056095
     C                     Z-ADD@@VDT     @@RUND           *1
     C                     END                             E1
      *
     C                     MOVEL'D'       @@DFMT  1
     C                     MOVE @@DATE    @@DATC  60
      *
      **  CONVERT STARTING DATE TO MIDAS DAY NUMBER FORMAT
     C           @@RTNC    DOUEQ'0'                        B1
     C                     CALL 'ZA0270'                   *1
     C                     PARM           @@DATC           *1
     C*****                PARM           DATF             *1             S01194
     C                     PARM           BJDFIN           *1             S01194
     C           @@RTNC    PARM           @@RTNC  1        *1
     C           @@DAYN    PARM           @@DAYN  50       *1
      *
     C                     SUB  1         @@DAY2           *1
     C                     MOVE @@DATE    @@DATC           *1
      *
     C                     END                             E1
      *
     C*****                Z-ADD@@DAYN    @@MNO
     C                     Z-ADD@@DAYN    ZDAYNO
     C                     MOVEL@@RTNC    @@RTN
     C*
     C**  RESET STARTING POINT
     C***********          EXSR ZA0710                              ME1161056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     @@STRT                    ME1161
      *
      **  PROCESS PERIOD TYPE 'D'
     C           @@PTYP    IFEQ 'D'                        B1
      *
      **  IF PERIOD NUMBER = 1 FIND NEXT WORKING DAY
     C           @@PNUM    IFEQ 1                          B*2
     C*****      @@HIND    DOUEQ'W'                        B**3
     C           ZIND      DOUEQ'W'                        B**3
     C*****                ADD  1         @@MNO            ***3
     C                     ADD  1         ZDAYNO           ***3
     C*****                EXSR ZA0830                     ***3   *****   S01195
     C                     EXSR ZCHKH                                     S01195
     C                     END                              **3
     C                     END                              *2
      *
      **  IF PERIOD NUMBER NE 1 FIND TOMORROW/NEXT DAY (AND OVERNIGHT)
      ****IE*FIND*NEXT*WORKING*DAY*BEYOND*RUND*                           S01194
      **  IE FIND NEXT WORKING DAY BEYOND RUN DATE                        S01194
     C           @@PNUM    IFLT 1                          B*2
     C***********          Z-ADD@@RUND    @@DTIN           **2            056095
     C                     Z-ADD@@RUND    ZZDTIN           **2            056095
     C                     EXSR ZA0730                     **2
     C                     Z-ADD@@VDT     @@PDAT           **2
     C                     END                              *2
      *
      **  IF PERIOD NUMBER IS -1 FIND NEXT WORKING DAY TOMM/NEXT.
      ****IE*FIND*NEXT*WORKING*DAY*BEYOND*RUND****                        S01194
      **  IE FIND NEXT WORKING DAY BEYOND RUN DATE                        S01194
     C           @@PNUM    IFEQ 0                          B*2
     C***********          Z-ADD@@PDAT    @@DTIN           **2            056095
     C                     Z-ADD@@PDAT    ZZDTIN           **2            056095
     C                     EXSR ZA0730                     **2
     C                     Z-ADD@@VDT     @@PDAT           **2
     C                     END                              *2
      *
     C                     END                             E1
      *
      **  PROCESS PERIOD TYPE 'W'
     C           @@PTYP    IFEQ 'W'                        B1
      *
      **  INCREMENT DAY NUMBER
     C           @@PNUM    MULT 7         @@ADD   30       *1
     C*****4               ADD  @@ADD     @@MNO            *1
     C                     ADD  @@ADD     ZDAYNO           *1
      *
      **  FIND NEXT WORKING DAY
     C*****                EXSR ZA0830                     *1     *****   S01195
     C                     EXSR ZCHKH                                     S01195
     C*****      @@HIND    DOWEQ'H'                        B*2
     C           ZIND      DOWEQ'H'                        B*2
     C*****                ADD  1         @@MNO            **2
     C                     ADD  1         ZDAYNO           **2
     C*****                EXSR ZA0830                     **2    *****   S01195
     C                     EXSR ZCHKH                                     S01195
     C                     END                              *2
     C                     END                             E1
      *
      **  PROCESS PERIOD TYPE 'M' OR 'Y'
     C           @@PTYP    IFEQ 'M'                        B1
     C           @@PTYP    OREQ 'Y'                        *1
      *
      **  IS SPOT LAST WORKING DAY IN MONTH
     C***********          Z-ADD@@SPDD    @@DTIN           *1             056095
     C                     Z-ADD@@SPDD    ZZDTIN           *1             056095
     C                     EXSR ZA0730                     *1
     C           @@SPMT    IFNE @@Z71M                     B*2
     C                     Z-ADD1         @@STDY           **2
     C           @@STMT    IFEQ 12                         B**3
     C                     Z-ADD1         @@STMT           ***3
     C                     ADD  1         @@STYR           ***3
     C                     ELSE                            X**3
     C                     ADD  1         @@STMT           ***3
     C                     END                              **3
      *
      **  CONVERT STARTING DATE TO MIDAS DAY NUMBER FORMAT
     C***********          Z-ADD@@STRT    @@DTIN           **2            056095
     C***********          EXSR ZA0680                     **2            056095
     C                     Z-ADD@@STRT    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C*****                Z-ADD@@MDNO    @@MNO            **2
     C***********          Z-ADD@@MDNO    ZDAYNO           **2            056095
     C                     Z-ADDZZMDNO    ZDAYNO           **2            056095
     C*****      @@HIND    DOUEQ'W'                        B**3
     C           ZIND      DOUEQ'W'                        B**3
     C*****                SUB  1         @@MNO            ***3
     C                     SUB  1         ZDAYNO           ***3
     C*****                EXSR ZA0830                     ***3   *****   S01195
     C                     EXSR ZCHKH                                     S01195
     C                     END                              **3
     C                     GOTO M10038                     **2
     C                     END                              *2
      *
      **  IF THE STARTING POINT DAY IS A NON WORKING DAY AND THE NEXT
      **  WORKING DAY FALLS IN THE NEXT MONTH  FIND LAST WORKING DAY
      **  IN STARTING MONTH.
     C***********          Z-ADD@@STRT    @@DTIN           *1       ME1161056095
     C***********          EXSR ZA0680                     *1       ME1161056095
     C                     Z-ADD@@STRT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C*****                Z-ADD@@MDNO    @@MNO            *1       ME1161
     C***********          Z-ADD@@MDNO    ZDAYNO           *1       ME1161056095
     C                     Z-ADDZZMDNO    ZDAYNO           *1             056095
     C*****                EXSR ZA0830                     *1     *****   S01195
     C                     EXSR ZCHKH                                     S01195
     C*****      @@HIND    IFEQ 'H'                        B*2
     C           ZIND      IFEQ 'H'                        B*2
     C***********          Z-ADD@@STRT    @@DTIN           **2            056095
     C                     Z-ADD@@STRT    ZZDTIN           **2            056095
     C                     EXSR ZA0730                     **2
      *
     C           @@STMT    IFNE @@Z71M                     B**3
     C*****      @@HIND    DOUEQ'W'                        B***4
     C           ZIND      DOUEQ'W'                        B***4
     C*****                SUB  1         @@MNO            ****4
     C                     SUB  1         ZDAYNO           ****4
     C*****                EXSR ZA0830                     ****4  *****   S01195
     C                     EXSR ZCHKH                                     S01195
     C                     END                              ***4
     C*******              GOTO M10038                     ***3     ME1161
     C                     END                              **3
     C                     GOTO M10038                     ***3     ME1161
     C                     END                              *2
      *
      **  IF STARTING DATE IS A WORKING DAY IN CURRENCY & SPOT DATE
      **  IS NOT LAST WORKING DAY IN MONTH PERIOD DATE IS STARTING DAY
     C                     Z-ADD@@STRT    @@PDAT           *1
     C                     GOTO M10039                     *1
      *
     C                     END                             E1
      *
     C           M10038    TAG
      *
      **  CONVERT DATE TO YYYYMMDD FORMAT
     C*****                Z-ADD@@MNO     @@DAYN
     C                     Z-ADDZDAYNO    @@DAYN
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     @@PDAT  80
      *
     C                     GOTO M10039
      *
     C                     Z-ADD0         @@PNUM  10
     C                     MOVE *BLANKS   @@PTYP  1
     C                     MOVE *BLANKS   @@SPOT  8
      *
     C           M10039    ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*  SUBROUTINE ZA0770 - THIS SUBROUTINE RECEIVES A 8/0 INPUT     *
     C*                      DATE - FORMAT YYYYMMDD AND OUTPUTS A     *
     C********************** 6/0 DATE. IF FIELD DATF ON TABTB10 =     *   S01194
     C********************** 'M' OUTPUT FORMAT MMDDYY. IF FIELD       *   S01194
     C********************** DATF = 'D' OUTPUT FORMAT DDMMYY.         *   S01194
     C*                      6/0 DATE. IF FIELD DATE FORMAT (SDBANKPD)*   S01194
     C*                      IS 'M' OUTPUT FORMAT MMDDYY. IF DATE     *   S01194
     C*                      FORMAT IS 'D' OUTPUT FORMAT DDMMYY.      *   S01194
     C*                                                               *
     C*  CALLED BY   :                                                *
     C*                                                               *
     C*  INPUT       : @@DTIN  - DATE INPUT (8,0)                     *
     C*  OUTPUT      : @@DTOU  - DATE OUTPUT (6,0)                    *
     C*                                                               *
     C*  WORK FIELDS : @@YYY   - YEAR IN (2,0)                        *
     C*              : @@MM    - MONTH IN (2,0)                       *
     C*              : @@DD    - DAY IN (2,0)                         *
     C*                                                               *
     C*              : @@DAT1  - IF DATE DD/MM/YY DAY ELSE MONTH (2,0)*
     C*              : @@DAT2  - IF DATE DD/MM/YY MONTH ELSE DAY (2,0)*
     C*                                                               *
     C*****************************************************************
     C           ZA0770    BEGSR
     C*
     C****DATF*=*'D'*CONVERT*TO MMDDYY FORMAT                             S01194
     C*****      DATF      IFEQ 'D'                        B1             S01194
     C**  DATE FORMAT INDICATOR (BJFKST) = 'D' CONVERT TO MMDDYY FORMAT   S01194
     C           BJDFIN    IFEQ 'D'                        B1             S01194
     C                     Z-ADD@@DD      @@DAT1           *1
     C                     Z-ADD@@MM      @@DAT2           *1
     C                     END                             E1
     C*
     C*
     C****DATF*=*'M'*CONVERT*TO MMDDYY FORMAT                             S01194
     C***********DATF      IFEQ 'M'                        B1             S01194
     C**  DATE FORMAT INDICATOR (BJFKST) = 'M' CONVERT TO MMDDYY FORMAT   S01194
     C           BJDFIN    IFEQ 'M'                        B1             S01194
     C                     Z-ADD@@DD      @@DAT2           *1
     C                     Z-ADD@@MM      @@DAT1           *1
     C                     END                             E1
     C*
     C                     Z-ADD@@YYY     @@YYYO
     C*
     C           ZA0779    ENDSR                           ***ZA0779***
     C/EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZDAT10Z2                                               056095
     C*******************************************************************
     C***********                                                         056095
     C**ZA0680*-*THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO         056095
     C***********MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)         056095
     C***********                                                         056095
     C**CALLED*BY :                                                       056095
     C***********                                                         056095
     C**CALLS*:**                                                         056095
     C***********                                                         056095
     C**INPUT**:*@@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   056095
     C***********                                                         056095
     C**OUTPUT*:*@@MDNO MIDAS DAY NUMBER  (SIZE : 5N)                     056095
     C***********                                                         056095
     C**USES*:***@@CC   NUMBER OF CENTURIES IN DATE                       056095
     C***********@@DAY  DAY NUMBER                                        056095
     C***********@@REM  REMAINDER FROM DIVIDE                             056095
     C***********@@MTH  MONTH NUMBER                                      056095
     C***********@MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       MONTH                                             056095
     C***********@@WK2  WORK FIELD (2,0)                                  056095
     C***********@@WK5  WORK FIELD (5,0)                                  056095
     C***********@@YYYY YEAR (4 CHARACTER)                                056095
     C***********@@YY   YEAR (2 CHARACTER)                                056095
     C***********@YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       A FOUR YEAR PERIOD                                056095
     C***********                                                         056095
     C******LAST*AMEND NO. ME1257              DATE 02/04/87            * 056095
     C******When*date input is zero set output date to zeroes           * 056095
     C***********                                                         056095
     C******************************************************************* 056095
     C***********                                                         056095
     C***********ZA0680    BEGSR                                          056095
     C***********                                                         056095
     C****CLEAR*OUT ANY 'OLD' DATA IN FIELD                               056095
     C***********          Z-ADD0         @@MDNO  50                      056095
     C***********                                                         056095
     C***********@@DTIN    CABEQ0         ZA0689                    ME1257056095
     C***********                                                         056095
     C*****IF*DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING          056095
     C*****WORK*OUT THE NUMBER OF CENTURIES PASSED SINCE 1971,            056095
     C*****BY*SUBTRACTING 1972 FROM THE YEAR FIELD.                       056095
     C***********@@YYYY    IFGE 2072                       B1             056095
     C***********@@YYYY    SUB  1972      @@YYYY           *1             056095
     C***********                                                         056095
     C*****MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)             056095
     C*****THEN*RESTORE THE YEAR WHICH WAS INPUT BACK TO THE              056095
     C*****ORIGINAL VALUE BEFORE CONTINUING WITH NORMAL CALCULATIONS.     056095
     C***********                                                         056095
     C***********@@CC      MULT 36524     @@MDNO           *1             056095
     C***********@@YYYY    ADD  1972      @@YYYY           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C***********@@YYYY    ADD  28        @@WK2   20                      056095
     C***********                                                         056095
     C***********@@WK2     DIV  4         @@WK2                           056095
     C***********          MVR            @@REM   10                      056095
     C***********                                                         056095
     C******MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD                056095
     C***********@@WK2     MULT 1461      @@WK5   50                      056095
     C***********          ADD  @@WK5     @@MDNO                          056095
     C***********                                                         056095
     C****CHECK*REMAINDER AND MONTH NUMBER                                056095
     C***********@@REM     IFEQ 0                          B1             056095
     C***********@@MTH     ANDGT2                          B1             056095
     C***********          ADD  1         @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****YEAR*NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR               056095
     C***********@@REM     IFNE 0                          B1             056095
     C***********          ADD  @YD,@@REM @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****ADD*MONTHS THIS YEAR                                            056095
     C***********          ADD  @MD,@@MTH @@MDNO                          056095
     C***********                                                         056095
     C****ADD*DAYS THIS MONTH                                             056095
     C***********          ADD  @@DAY     @@MDNO                          056095
     C***********                                                         056095
     C***********ZA0689    ENDSR                           **ZA0689 TAG** 056095
      *****************************************************************
      /EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZDATE9Z3                                               056095
     C/COPY ZSRSRC,ZFEB29                                                                     CDL093
      *****************************************************************
     C***********                                                     *   056095
     C********TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *   056095
     C***********                                                     *   056095
     C********SUBROUTINE ZA0710 EXPECTS FIELD '@@DAYN' TO BE          *   056095
     C********PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *   056095
     C********THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *   056095
     C********SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *   056095
     C********IF*'@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   056095
     C********'@@VDT'  IN 'YYYYMMDD' FORMAT.                          *   056095
     C***********                                                     *   056095
     C**NOTE:*FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS                  056095
     C***********                                                     *   056095
     C********1)*@@DAYN   LENGTH 5,0.                                 *   056095
     C***********                                                     *   056095
     C********FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *   056095
     C***********                                                     *   056095
     C********1)*@@VDT    LENGTH 8,0 DEFINED BY A DS.                 *   056095
     C********2)*@@RTN    LENGTH 1,0.                                 *   056095
     C********3)*@@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *   056095
     C********4)*@@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *   056095
     C********5)*@@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *   056095
     C********6)*@@RDAY   LENGTH 5,0.                                 *   056095
     C********7)*@@LEAP   LENGTH 1,0.                                     056095
     C***********                                                     *   056095
     C********INDICATORS USED ARE:                                    *   056095
     C***********                                                     *   056095
     C********1)*80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *   056095
     C********2)*81       CHECK FOR LOW ON ARRAY @MD.                 *   056095
     C***********                                                     *   056095
     C**INPUT*FIELD:       @@DAYN                                     *   056095
     C***********                                                     *   056095
     C**OUTPUT*FIELD:      @@VDT                                      *   056095
     C***********                                                     *   056095
     C**WORK*FIELDS:       @@RTN                                      *   056095
     C***********          @@Z71Y                                     *   056095
     C***********          @@RDAY                                     *   056095
     C***********          @@LEAP                                     *   056095
     C***********          @@I                                        *   056095
     C***********          @@J                                        *   056095
     C***********                                                     *   056095
     C**ARRAYS*USED:       @YD COMPILE TIME ARRAY.                        056095
     C***********          @MD COMPILE TIME ARRAY.                        056095
     C***********                                                         056095
     C******LAST*AMEND NO. ME1257              DATE 02/04/87          *   056095
     C******When*date input is zero set output date to zeroes         *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********                                                         056095
     C***********ZA0710    BEGSR                                          056095
     C***********                                                         056095
     C***********          SETOF                     8081                 056095
     C***********          Z-ADD0         @@RTN   10                      056095
     C***********          Z-ADD0         @@VDT                           056095
     C***********          Z-ADD1         @@I     20                      056095
     C***********          Z-ADD1         @@J     20                      056095
     C***********          Z-ADD1         @@LEAP  10                      056095
     C***********                                                         056095
     C***********@@DAYN    CABEQ0         ZA0719                    ME1257056095
     C***********                                                         056095
     C***********@@DAYN    IFLT 1                                         056095
     C***********          Z-ADD1         @@RTN                           056095
     C***********          GOTO ZA0719                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**DIVISION*TO DETERMINE WETHER LEAP YEAR.                           056095
     C***********                                                         056095
     C***********@@DAYN    DIV  1461      @@Z71Y                          056095
     C***********          MVR            @@RDAY  50                      056095
     C***********                                                         056095
     C**CALCULATING YEAR.                                                 056095
     C***********                                                         056095
     C***********@@Z71Y    MULT 4         @@Z71Y                          056095
     C***********          ADD  1972      @@Z71Y                          056095
     C***********                                                         056095
     C**CHECKING*IF YEAR IS GREATER THAN OR EQUAL TO 2100                 056095
     C***********                                                         056095
     C***********@@Z71Y    IFGE 2100                                      056095
     C***********          ADD  @@SSY2    @@RDAY                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**LOKUP*ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE        056095
     C**HAVE*PASSED.                                                      056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@YD,@@I                8080               056095
     C***********                                                         056095
     C**IF*YEAR*IS A LEAP YEAR SSLEAP IS SET TO ZERO.                     056095
     C***********                                                         056095
     C************IN80     IFEQ '0'                                       056095
     C***********          Z-ADD0         @@LEAP                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**ADD*INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 1                                         056095
     C***********@@RDAY    SUB  @YD,@@I   @@RDAY                          056095
     C***********          ADD  @@I       @@Z71Y                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**PROCESSING FOR A LEAP YEAR.                                       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 0                                         056095
     C***********                                                         056095
     C**IF*'@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.                   056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 60                                        056095
     C***********          Z-ADD29        @@Z71D                          056095
     C***********          Z-ADD2         @@Z71M                          056095
     C***********          GOTO ZA0711                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**IF*'@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN    056095
     C**PROCEED*AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP     056095
     C**YEAR.*NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.          056095
     C***********                                                         056095
     C***********@@RDAY    IFGT 60                                        056095
     C***********@@RDAY    SUB  1         @@RDAY                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C***********          END                                            056095
     C***********                                                         056095
     C**IF*DAY*'@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS      056095
     C**IN*4*YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR      056095
     C**GROUP.***                                                         056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 0                                         056095
     C***********          Z-ADD31        @@Z71D                          056095
     C***********          Z-ADD12        @@Z71M                          056095
     C***********          SUB  1         @@Z71Y                          056095
     C***********          GOTO ZA0711                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**LOOK*UP*ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'         056095
     C**OCCURS*IN                                                         056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@MD,@@J                81                 056095
     C***********          Z-ADD@@J       @@Z71M                          056095
     C***********@@RDAY    SUB  @MD,@@J   @@Z71D                          056095
     C***********                                                         056095
     C**DS*@@VDT* IS RETURNED IN YYYYMMDD FORMAT                          056095
     C***********                                                         056095
     C***********ZA0711    TAG                                            056095
     C***********                                                         056095
     C***********          MOVE @@Z71Y    @@YR                            056095
     C***********                                                         056095
     C***********ZA0719    ENDSR                                          056095
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BC      - Load period dates array                            *
     C*                                                               *
     C**CALLS****ZA0710***-*Convert*midas*day*no.*to*YYYYMMDD*format***   056095
     C* CALLS    ZDATE9   - Convert midas day no. to YYYYMMDD format  *   056095
     C*          ZA0730   - Determine next working day                *
     C*          MM1003   - Calculate a period date                   *
     C***********ZA0680***-*Convert*YYYYMMDD*to*a*midas*day*number*****   056095
     C*          ZDAT10   - Convert YYYYMMDD to a midas day number    *   056095
     C*                                                               *
     C* CALLED BY  #B     - Main processing                           *
     C*                                                               *
     C* FLDS USED  @CCY   - Currency                                  *
     C*************@CUR   - Field in key to access currencies file    *   S01194
     C*            @CUR   - Key to currencies file                    *   S01194
     C*************@KEY   - Key to currencies file                    *   S01194
     C*            @@SPOT - MM spot date YYYYMMDD                     *
     C*            @@RUND - Run date YYYYMMDD                         *
     C*            @@DAYN - Midas day number                          *
     C*************@@VDT**-*Date*output*from*ZA0710********************   056095
     C*************@@DTIN*-*Input*date*********************************   056095
     C*            @@VDT  - Date output from ZDATE9                   *   056095
     C*            ZZDTIN - Input date                                *   056095
     C*            @@CCY  - Currency                                  *
     C*************@@MDNO*-*Midas*day*number*workfield*****************   056095
     C*            ZZMDNO - Midas day number workfield                *   056095
     C*            @PR    - Period dates array                        *
     C*            @@PNUM - Period number                             *
     C*            @@PTYP - Period type                               *
     C*            @@PDAT - Period date                               *
     C*                                                               *
     C*****************************************************************
     C           #BC       BEGSR
     C*
     C** Details required by MM1013 calculate period dates
     C*
     C***Determine*spot*Date*by*accessing*FDCCYTLL*for*this*currency**    S01194
     C** Determine spot Date by accessing details for this currency       S01194
     C************         MOVE @CCY      @CUR                            E36300
     C*****      @KEY      CHAINFDCCYTLL             60                   S01194
     C*****                                                               S01194
     C***DEAL*WITH DATA BASE ERROR                                        S01194
     C*****      *IN60     IFEQ '1'                        ***************S01194
     C*****                MOVEL'FDCCYTLL'DBFILE           *             *S01194
     C*****                MOVEL'002'     DBASE            * DBERROR 002 *S01194
     C*****                MOVEL@KEY      DBKEY            *             *S01194
0951 C*                                                                   S01194
     C** READ CCY DETAILS VIA ACCESS PROGRAM                              S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C***********          PARM @CUR      @AJCD   3                       S01194
     C                     PARM @CCY      @AJCD   3                S01194 E36300
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVEL'SDCURRPD'DBFILE           ************   S01194
     C                     MOVEL'02'      DBASE            * DBERR 02 *   S01194
     C                     MOVEL@OPTN     DBOPTN  7        ************   S01194
     C                     MOVEL@AJCD     DBKEY            *1             S01194
     C                     MOVE '1'       *INU7            *1             S01194
     C                     MOVE '1'       *INU8            *1
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #BC9                       *1
     C                     END                             E1
     C*
     C*****                MOVE MSPD      @@SPOT                          S01194
     C                     MOVE A6MMSD    @@SPOT                          S01194
     C*
     C** If period dates have not been calculated for this currency,
     C** then load period dates array
     C           @@RUND    IFEQ *ZERO                      B1
     C******               Z-ADDRUND      @@DAYN           *1             S01194
     C                     Z-ADDBJRDNB    @@DAYN           *1             S01194
     C***********          EXSR ZA0710                     *1             056095
     C                     EXSR ZDATE9                     *1             056095
     C                     Z-ADD@@VDT     @@RUND           *1
     C                     END                             E1
     C*
     C** Calculate today period date.
     C***********          Z-ADD@@RUND    @@DTIN                          056095
     C                     Z-ADD@@RUND    ZZDTIN                          056095
     C*****                MOVE @CCY      @@CCY                   *****   S01195
     C                     MOVE @CCY      ZCCY                            S01195
     C                     EXSR ZA0730
     C***********@@MDNO    SUB  1         @PR,1                           056095
     C           ZZMDNO    SUB  1         @PR,1                           056095
     C*
     C** Calculate D1 period date.
     C***********          Z-ADD@@VDT     @@DTIN                          056095
     C                     Z-ADD@@VDT     ZZDTIN                          056095
     C                     EXSR ZA0730
     C***********@@MDNO    SUB  1         @PR,2                           056095
     C           ZZMDNO    SUB  1         @PR,2                           056095
     C*
     C** Calculate D2 period date.
     C***********          Z-ADD@@VDT     @@DTIN                          056095
     C                     Z-ADD@@VDT     ZZDTIN                          056095
     C                     EXSR ZA0730
     C***********@@MDNO    SUB  1         @PR,3                           056095
     C           ZZMDNO    SUB  1         @PR,3                           056095
     C*
     C** Calculate D3 period date.
     C***********          Z-ADD@@VDT     @@DTIN                          056095
     C                     Z-ADD@@VDT     ZZDTIN                          056095
     C                     EXSR ZA0730
     C***********@@MDNO    SUB  1         @PR,4                           056095
     C           ZZMDNO    SUB  1         @PR,4                           056095
     C*
     C** Calculate D4 period date.
     C***********          Z-ADD@@VDT     @@DTIN                          056095
     C                     Z-ADD@@VDT     ZZDTIN                          056095
     C                     EXSR ZA0730
     C***********@@MDNO    SUB  1         @PR,5                           056095
     C           ZZMDNO    SUB  1         @PR,5                           056095
     C*
     C** Calculate W1 period date.
     C                     Z-ADD1         @@PNUM  10
     C                     MOVE 'W'       @@PTYP
     C                     EXSR MM1003
     C***********          Z-ADD@@PDAT    @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********@@MDNO    SUB  1         @PR,6                           056095
     C                     Z-ADD@@PDAT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C           ZZMDNO    SUB  1         @PR,6                           056095
     C*
     C** Calculate M1 period date.
     C                     Z-ADD1         @@PNUM
     C                     MOVE 'M'       @@PTYP
     C                     EXSR MM1003
     C***********          Z-ADD@@PDAT    @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********@@MDNO    SUB  1         @PR,7                           056095
     C                     Z-ADD@@PDAT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C           ZZMDNO    SUB  1         @PR,7                           056095
     C*
     C** Calculate M2 period date.
     C*******              MOVE MSPD      @@SPOT                          S01194
     C                     MOVE A6MMSD    @@SPOT                          S01194
     C                     Z-ADD2         @@PNUM
     C                     MOVE 'M'       @@PTYP
     C                     EXSR MM1003
     C***********          Z-ADD@@PDAT    @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********@@MDNO    SUB  1         @PR,8                     ME2063056095
     C                     Z-ADD@@PDAT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C           ZZMDNO    SUB  1         @PR,8                           056095
     C*
     C** Calculate M3 period date.
     C*****                MOVE MSPD      @@SPOT                          S01194
     C                     MOVE A6MMSD    @@SPOT                          S01194
     C                     Z-ADD3         @@PNUM
     C                     MOVE 'M'       @@PTYP
     C                     EXSR MM1003
     C***********          Z-ADD@@PDAT    @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********@@MDNO    SUB  1         @PR,9                     ME2063056095
     C                     Z-ADD@@PDAT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C           ZZMDNO    SUB  1         @PR,9                           056095
     C*
     C           #BC9      ENDSR                           **#BC9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************   S01194
     C******                                                          *   S01194
     C******  SUBROUTINE ZA0150 - THIS SUBROUTINE CHAINS TO FILE LF/  *   S01194
     C******  FDICDRLL TO GET THE INSTALLATION CONTROL DETAILS RECORD *   S01194
     C******  1 (HELD ON PF/TABTB10)                                  *   S01194
     C******  INDICATOR 80 IS SET ON IF THE CHAIN FAILS OR THE RECORD *   S01194
     C******  IS FLAGGED FOR DELETION.                                *   S01194
     C******  IF INDICATOR 80 IS SET ON DETAILS OF THE ATTEMPTED      *   S01194
     C******  ACCESS ARE PLACED IN THE LDA.                           *   S01194
     C******                                                          *   S01194
     C******  FIELDS USED : SS0150 - KEY USED TO ACCESS FDICDRLL      *   S01194
     C******                                                          *   S01194
     C*****************************************************************   S01194
     C*****                                                               S01194
     C*****      ZA0150    BEGSR                                          S01194
     C*****                                                               S01194
     C***SET UP KEY TO OBTAIN FORMAT TABTB10F '01        10'              S01194
     C*****                MOVEL'01'      SS0150 12                       S01194
     C*****                MOVE '10'      SS0150                          S01194
     C*****                                                               S01194
     C***CHAIN TO FILE FDICDRLL                                           S01194
     C*****      SS0150    CHAINFDICDRLL             80                   S01194
     C*****      RECI      IFNE 'D'                        B1             S01194
     C*****                MOVE '1'       *IN80            *1             S01194
     C*****                END                             E1             S01194
     C*****                                                               S01194
     C***DEAL WITH DATA BASE ERROR                                        S01194
     C*****      *IN80     IFEQ '1'                        ***************S01194
     C*****                MOVEL'FDICDRLL'DBFILE           *             *S01194
     C*****                MOVEL'900'     DBASE            * DBERROR 900 *S01194
     C*****                MOVELSS0150    DBKEY            *             *S01194
     C*****                MOVE '1'       *INU7            ***************S01194
     C*****                MOVE '1'       *INU8            *1             S01194
     C*****                END                             E1             S01194
     C*****                                                               S01194
     C*****      ZA0159    ENDSR                                          S01194
     C*****************************************************************   S01194
     C*EJECT                                                              S01194
     C*****************************************************************
     C*                                                               *
     C* INFSR    - Unmonitored file error                             *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @ERR2  - Error routine performed indicator         *
     C*            @TERM  - Termination parameter                     *
     C*            @FILE  - File in error                             *
     C*                                                               *
     C*****************************************************************
     C           INFSR     BEGSR
     C*
     C**  Set @ERR2 to 'Y' to prevent looping if further errors occur.
     C           @ERR2     IFNE 'Y'                        B1
     C*
     C                     MOVE 'Y'       @ERR2   1        *1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     MOVE 'E'       @TERM            *1
     C*
     C**  Set up fields in local data area.
     C                     MOVEL@FILE     DBFILE           *1
     C                     MOVEL'MM0094'  DBPGM            *1
     C                     MOVEL'992'     DBASE            *1
     C                     DUMP                            *1
     C*
     C                     END                             E1
     C*
     C**  Terminate processing immediately.
     C                     MOVE '1'       *INLR
     C*
     C                     RETRN
     C*
     C           INFSR9    ENDSR                           **INFSR9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR    - Unmonitored program error                          *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @ERR1  - Error routine performed indicator         *
     C*            @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C**  Set @ERR1 to 'Y' to prevent looping if further errors occur.
     C           @ERR1     IFNE 'Y'                        B1
     C*
     C                     MOVE 'Y'       @ERR1   1        *1
     C                     MOVE '1'       *INU6            *1
     C                     MOVE 'E'       @TERM            *1
     C*
     C**  Set up fields in local data area.
     C                     MOVEL'MM0094'  DBPGM            *1
     C                     MOVEL'991'     DBASE            *1
     C                     DUMP                            *1
     C*
     C                     END                             E1
     C*
     C**  Terminate processing immediately.
     C                     MOVE '1'       *INLR
     C*
     C                     RETRN
     C*
     C           #PSSR9    ENDSR                            ***PSSR9**
     C*
     C/EJECT
     OMMFLIQP0E                LIQUPD
      *****************************************************************
      *   The array @YD and @MD are now being used by SR. ZDATE9      *   056095
      *   before they are being used by SR. ZA0710.  The actual       *   056095
      *   changes were only made on the text, ZA0710 was changed      *   056095
      *   to ZDATE9.                                                  *   056095
      *****************************************************************   056095
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
