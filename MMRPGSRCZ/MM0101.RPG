     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Start of day re-org/deals file update')       *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MM Dealer Module
     F*                                                               *
     F*  MM0101 - START OF DAY RE-ORGANISATION/DEALS FILE UPDATE      *
     F*            (IF TREASURY MANAGEMENT INSTALLED)                 *E46391
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD053295           Date 13Apr19               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD038562           Date 29Jun16               *
      *                 CGL165             Date 23Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 01Sep14               *
      *                 MD024467A          Date 08May14               *
      *                 CDL093             Date 08Apr14               *
      *                 AR755195A          Date 13Dec13               *
      *                 AR755195           Date 13Dec13               *
      *                 AR937172           Date 11Jan13               *
      *                 AR970738           Date 04Dec12               *
      *                 AR996895           Date 25Nov12               *
      *                 CRE073             Date 06Dec10               *
      *                 AR588416           Date 19Aug10               *
      *                 252554A            Date 11Feb09               *
      *                 263666             Date 01Feb10               *
      *                 262922             Date 15Sep10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CDL081             Date 14Dec09               *
      *                 260340             Date 23May09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 222986             Date 26May06               *
      *                 CDL013             Date 08Jun06               *
      *                 CDL049             Date 11Jul06               *
      *                 BUG10705R          Date 09Mar06               *
      *                 CSD027             Date 09Dec05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL038             Date 10May05               *
      *                 CDL033             Date 10Feb05               *
      *                 CDL028             Date 07Feb05               *
      *                 BUG4092            Date 01Oct04               *
      *                 BUG3838            Date 21Jul04               *
      *                 CGL014             Date 20Oct03               *
      *                 CDL017             Date 17Mar03               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 204923             Date 29Apr02               *
      *                 CAS001             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 04Oct01               *
      *                 CIR007             Date 11May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CGL011             Date 20Sep99               *
      *                 CDL007             Date 19Oct99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 163136             Date 07Jul99               *
      *                 126017             Date 18Nov97               *
     F*                 097885             Date 03Feb97               *
     F*                 S01408             Date 24Apr96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 S01408             DATE 30OCT95               *
     F*                 CIR001             DATE 13JUN95               *
     F*                 061426             DATE 30SEP93               *
     F*                 056121             DATE 04NOV93               *
     F*                 056095             DATE 07JUN93               *
     F*                 E46391             DATE 01FEB93               *
     F*                 S01378             DATE 23APR92               *
     F*                 S01392             DATE 20JUL92               *
     F*                 E38323             DATE 31JUL92               *
     F*                 S01383             DATE 27APR92               *
     F*                 S01354             DATE 05FEB92               *
     F*                 E26582             DATE 15JAN92               *
     F*                 RT0150             DATE 15JAN92               *
     F*                 S01319             DATE 19SEP91               *
     F*                 E26289             DATE 11JUL91               *
     F*                 S01280             DATE 16JAN91               *
     F*                 S01328             DATE 04FEB91               *
     F*                 DT0015             DATE 20MAR91               *
     F*                 LN0662             DATE 31JAN91               *
     F*                 E21611             DATE 21JUL90               *
     F*                 S01251             DATE 03FEB90               *
     F*                 S01194             DATE 11JAN90               *
     F*                 S01195             DATE 10JAN90               *
     F*                 S01218             DATE 11/08/89              *
     F*                 E18541             DATE 22/06/89              *
     F*                 E18380             DATE 18/05/89              *
     F*                 E15079             DATE 22/11/88              *
     F*                 E14042             DATE 20/07/88              *
     F*                 E12306             DATE 26/04/88              *
     F*                 S01136             DATE 26/04/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD038562 - Incorrect Interest at Maturity. Make sure @@MDAY  *
      *             is initialized with the correct value.            *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  MD024467A - Fields updated in DEALSDC are not updated in     *
      *              MMDELDPP. Synchronize fields from DEALSDC and    *
      *              MMDELDPP.                                        *
      *  CDL093 - MM Interest calculation type 9.                     *
      *  AR755195A - Reopen. Update HKINTR and HKSTRT.                *
      *            - Applied for MD024110                             *
      *  AR755195 - Update CDL033 fields and total interest.          *
      *             (Child: AR755196)                                 *
      *           - Applied for MD024110                              *
      *  AR937172 - TOTI is always positive and is moved to HKMTTI.   *
      *             HKMTTI should be negative in deal types other     *
      *             than loans. Synced HKNGVI value assignment with   *
      *             MMLDNIVAL processing. (Child: AR937173)           *
      *  AR970738 - Drop credit lines extension records only for      *
      *             non-authorized deleted deals. Apply fix 263291A.  *
      *           - Wrong record format referenced in purging         *
      *             extension files. Changed DLDLDBD0 to DLDLDCD0.    *
      *             Apply fix 263291. (Child: AR970741)               *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  AR588416 - Parameter type mismatch on calling MMDELUDF.      *
      *  252554A - Delete the corresponding record in the UDF files   *
      *            during COB.                                        *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  262922 - Update the Next Interest Payment Date in MMDELDPP   *
      *           and MMDENBPP.                                       *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus                                       *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CDL081 - Tiered withholding tax rounding upgrade             *
      *  260340 - Updates HKMTTI with the value of TOTI.              *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  222986 - Update the total interest amount for parcelled      *
      *           interest bearing negotiable assets. Apply fix       *
      *           207707.                                             *
      *  CDL013 - Tiered Withholding Tax                              *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  BUG10705R- Remove extension records when MMDELDPP records    *
      *             are also deleted.                                 *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL033 - Floating Rate CDs Issued                            *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  BUG4092- CDL017 fields not being updated on MMDELDPP.        *
      *           Remove update of Settlement instructions for EM.    *
      *  BUG3838 - 'Complete' rollover deals generated in COB must not*
      *            be deleted.                                        *
      *  CGL014 - Collaterals Processing (Recompile)                  *
      *  CDL017 - Penalty Fees and Early Maturity of Fixed Term Deals *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
     F*  CDL010 - Prevent last user that actioned the trade from      *
     F*           authorising it.Recompile due to changes in MMDEAMPP *
     F*           , MMDELDPP, MMDENBPP AND MMDENSPP .                 *
      *  204923 - Rate Fix Days Adjustment (OIS)                      *
      *           (Recompiled over changed SDCURRPD)                  *
      *  CAS001 - Net Present Value (NPV) Accounting (Recompile)      *
      *  CPK014 - Release 4 packaging.  Rename of field which is too  *
      *           long for OPM program.                               *
      *  CIR007 - Overnight Index Swaps                               *
      *           (Recompiled over changed SDCURRPD)                  *
      *  CSD006 - Recompiled over changed SDCURRPD.                   *
      *  CDL008 - Continuous Linked Settlement (recompile SDCURRPD)   *
      *  CIR004 - Dealing Calculation Method Change                   *
      *  CGL011 - Collateral Processing for Midas                     *
      *           Recompiled due to changes in MMDELDPP               *
     F*  CDL007 - Deposit Breakdown Penalty                           *
      *  CDL006 - Dealing Fiduciary.                                  *
     F*  163136 - Interest Calculation Method '6'  showing incorrect -*
     F*           ZERO - amount . Addition to Core #126017 which dealt*
     F*           with the issue. It introduced an additional  INT6DY *
     F*           field in s-routine ZINTDY in  /COPY ZSRSRC/ZINTDYZ2 *
     F*           which in turn is usually called from GLINTC s-routine
     F*           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
     F*           least a dozen other pgms that use ZINTDY but do     *
     F*           GLINTC-processing within the pgms calculation specs *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC - recompile program.           *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  S01408 - Core hook MM0101CCP7 added                          *
     F*           Core hook MM0101CCP6 added                          *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  S01408 - Core hook MM0101FFP1 added                          *
     F*           Core hook MM0101CCP1 added                          *
     F*           Core hook MM0101CCP2 added                          *
     F*           Core hook MM0101CCP3 added                          *
     F*           Core hook MM0101CCP4 added                          *
     F*           Core hook MM0101CCP5 added                          *
     F*           Core hook MM0101OOP1 added                          *
     F*  CIR001 - Interest Rate Calendars                             *
     F*  061426 - Recompile after ZDATE9 correction                   *
     F*  056121 - Increase size of work field to enable correct       *
     F*           calculation of interest on very large amounts.      *
     F*           (Similar to fix 049499 of MM0089 in MRSLIB1005)     *
     F*  056095 - Interest not calculated consistently in MM.         *
     F*           SR. MM1009 was externally defined as ZINTDY,        *
     F*           while SR. ZA0710 and ZA0680 were replaced by        *
     F*           the externally defined standard SR. ZDATE9 and      *
     F*           ZDAT10, respectively.  (MM0101 is already using     *
     F*           ZDATE9 and ZDAT10.)  Seventeen MM programs were     *
     F*           amended.                                            *
     F*  E46391 - Amend header box to say this program run only       *
     F*           if TM on - MM0102 run for NON-TM system.            *
     F*  S01378 - Facilitates the partial sale of a parcel            *
     F*           of negotiable instruments which have been           *
     F*           previously input to the system as a single          *
     F*           transaction (was MOF53). Recompile over new         *
     F*           NA bought and NA sold formats and update            *
     F*           MMDENBPP to match DEALSDD re parcel fields          *
     F*  S01392 - JAP.SUB-MODULE INCORPORATION (CORE)                 *
     F*  E38323 - Recompiled due to a change in copy source ZFWDT sr  *
     F*  S01383 - BASIC RATE TAX INCORPORATION                        *
     F*  S01354 - Internal Funding Deals                              *
     F*  E26582 - Period Date on Discount Factors file needs to       *
     F*           be rolled forward same time as Interest Rates.      *
     F*           Spot Days must be Working Days. (For S01328)        *
     F*  RT0150 - RECOMPILE PROGRAM FOR CHANGE IN MMSTDSPP            *
     F*  S01319 - Remove redundant processing                         *
     F*  E26289 - MUST CALL TREASURY MGT PROCESSING ONLY IF           *
     F*           TREASURY MANAGEMENT MODULE IS ON SYSTEM             *
     F*  S01280 - Include FRA,IRS,FUTURES and CUSTOMER LENDING        *
     F*           modules.                                            *
     F*         - LDA fields set up incorrectly for some database     *
     F*           errors                                              *
     F*         - LDA being locked in causing problem during          *
     F*           call to TMC3360, since LE0480 also tries to         *
     F*           lock in LDA                                         *
     F*  S01328 - FRA/IRS REVALUATION -                               *
     F*           1) HANDLE RATES OUT TO 10 YEARS                     *
     F*           2) RECALCULATE PERIOD DATE FOR FRA/IRS RATES        *
     F*              - ADD SR. ZCPD AND RENAME ZA0710 AND ZA0680      *
     F*              TO ZDATE9 AND ZDAT10 RESPECTIVELY TO MAKE        *
     F*              THEM /COPY ROUTINES FOR USE WITHIN STANDARD      *
     F*              SR. ZCPD                                         *
     F*           3) ADD PERIOD DATE,IN MIDAS DAY NO.,TO FDINTRPP     *
     F*           4) RE-INSERT UPDATE OF FDCCYTLL SO THAT THE         *
     F*              PHYSICAL FILES, SDCURRPD AND TABTG10, ARE        *
     F*              KEPT IN LINE.                                    *
     F*  DT0015 - Recompiled over changed Screen File.                *
     F*  LN0662 - CHANGES TO SDCURRL0 AND L1                          *
     F*  E21611 - ONLY LIVE INTEREST RATE RECORDS TO BE PROCESSED     *
     F*  S01251 - SYNON FIELD/PROGRAM NAME CHANGES                    *
     F*             (CHANGED UNDER S01194)                            *
     F*  S01194 - AMENDMENT TO USE ACCESS OBJECTS                     *
     F*  S01195 - NEW HOLIDAY PROCESSING                              *
     F*  S01218 - Recompiled to include new file layouts for          *
     F*           capital markets dealing interface                   *
     F*  E18541 - OUTPUT THE CORRECT SPOT DATES TO SDCURRPD           *
     F*  E18380 - PROGRAM WAS RECOMPILED WITH NEW FORMATS FOR THE     *
     F*           STANDARD DEAL FILES. THIS STOPS THE BOOK CODE       *
     F*           AND LINKED REFERENCE NUMBER FIELDS FROM BEING       *
     F*           OVERWRITTEN.                                        *
     F*  E15079 - IF SPOT DAYS (SPDY) ON FDCCYTLL IS ZERO THEN        *
     F*           MONEY MARKET SPOT DATE (MSPD) IS LEFT AS ZERO.      *
     F*           IF SPOT DAYS FIELD IS ZERO THEN THE RUN DATE        *
     F*           SHOULD BE USED (IF NOT A HOLIDAY).                  *
     F*  E14042 - MULTISTREAMING START OF DAY PERFORMANCE             *
     F*           MODIFICATION,                                       *
     F*                                                               *
     F*****************************************************************
     F* ID F  C  H  L     FUNCTION OF INDICATORS                      *
     F* ----------------------------------------                      *
     F*                                                               *
     F*       50          AODEALR0 CALLED ONCE                        *   S01194
     F*       60          END OF FILE INDICATOR                       *
     F*       61          CHAIN FAIL                                  *
      *       62          Work indicator                              *                       CDL033
     F********66**********CHAIN FAIL ON SDCURRL1                E18541*   S01328
     F*       66          CHAIN FAIL ON SDCURRL0                      *   S01328
     F*       70          CHAIN FAIL - DATA BASE ERROR                *
     F*       U7 & U8     DATA BASE ERROR                             *
     F*****************************************************************
     F/COPY WNCPYSRC,MM0101F002
     FMMDEAULLUF  E           K        DISK         KINFSR *PSSR      UC
     F                                              KINFDS @DLSTS
     FMMDAMULLUF  E           K        DISK         KINFSR *PSSR      UC
     F*MDEALLLIF**E           K        DISK         KINFSR *PSSR      UC
     F************MMDELDP0                          KIGNORE
     F************MMDENSP0                          KIGNORE
     F************MMDELDP0                          KRENAMEMMDLNDP0
     F************MMDENBP0                          KRENAMEMMDLNBP0
     FMMDEAMLLIF  E           K        DISK         KINFSR *PSSR      UC
     F            MMDEAMP0                          KRENAMEMMDMAMP0
     FDEALS   IF  E           K        DISK         KINFSR *PSSR      UC
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     FDEAMS   IF  E           K        DISK         KINFSR *PSSR      UC
     F            DEAMSDHF                          KIGNORE
     F            DEAMSDJF                          KIGNORE
     FSDCBRTL1IF  E           K        DISK         KINFSR *PSSR      UC  S01383
     FSDBRTDL1IF  E           K        DISK         KINFSR *PSSR      UC  S01383
     F*FDCCYTLLUF**E**********K********DISK         KINFSR *PSSR      UC  S01194
     FFDCCYTLLUF  E           K        DISK         KINFSR *PSSR      UC  S01328
     F*FDTABJLLIF**E**********K********DISK         KINFSR *PSSR      UC  S01194
     F*FDICDRLLIF E           K        DISK         KINFSR *PSSR      UC  S01194
     F*ME1386     TABTB11F                          KIGNORE
     F*ME1386     TABTB20F                          KIGNORE
     FFDINTRLLUF  E           K        DISK         KINFSR *PSSR      UC
     FDLMMDFL2UF  E           K        DISK         KINFSR *PSSR      UC  E26582
     FDLFRARL1UF  E           K        DISK         KINFSR *PSSR      UC  S01328
     F            DLFIRSP0                          KRENAMEDLFRARP0       S01328
     FDLIRSRL1UF  E           K        DISK         KINFSR *PSSR      UC  S01328
     F            DLFIRSP0                          KRENAMEDLIRSRP0       S01328
     FDLSWPRL1UF  E           K        DISK         KINFSR *PSSR      UC  CIR001
     FDLIRDFL1UF  E           K        DISK         KINFSR *PSSR      UC  CIR001
      *                                                                                       CDL013
     FSDSTAAL1IF  E           K        DISK                           UC                      CDL013
      *                                                                                       CDL013
     F/COPY WNCPYSRC,MM0101FFP1                                           S01408
     F*FXTB40LLIF**E**********K********DISK         KINFSR *PSSR      UC  S01194
     F*
     F*SDCURRL1UF*E***********K        DISK         KINFSR *PSSR    E18541LN0662
     FSDCURRL0UF  E           K        DISK         KINFSR *PSSR      UC  LN0662
     F*
     F/COPY WNCPYSRC,MM0101F001
      *                                                                                       CDL033
     FDLFRSCL0UF  E           K        DISK                           UC                      CDL033
      ** Midas DL FRCD Issued Date Schedule update file                                       CDL033
      *                                                                                       CDL033
     FDLDEALL5UF  E           K        DISK         KINFSR *PSSR      UC                    BUG10705
     E/EJECT
     E                    CPY@    1   1 80                                S01194
     E* ARRAY FOR COPYRIGHT STATEMENT                                     S01194
     E********************@YD*****4***4**5*0A**********************       S01328
     E****ARRAY*FOR*SR.*ZA0710*-*CUMULATIVE*DAYS*IN*YEAR*FOR*4*YEAR PERIODS01328
     E****(ALSO*FOR*SR.*ZA0680)************************************       S01328
     E*************************************************************       S01328
     E****ARRAY*FOR*SR.*ZA0710*-*CUMULATIVE*DAYS*IN*YEAR*PER*MONTH*       S01328
     E****(ALSO*FOR*SR.*ZA0680)************************************       S01328
     E********************@MD****13**13**5*0A**********************       S01328
     E/COPY ZSRSRC,ZDATE9Z1                                               S01328
     E*
     E**  ARRAY FOR SR. ZA0850 - DAYS IN A MONTH (COMPILE TIME ARRAY)
     E                    @M     12  12  2 0
     E*
     E****USED*BY*SR.*ZA0830 - CURRENCY RECORDS                           S01195
     E********************@CY        50  3                                S01195
     E*
     E**  ARRAY HOLDING CURRENCY CODES
     E                    @@A       150  3
     E*
     E**  ARRAY HOLDING SPOT DATES
     E                    @@B       150  8 0
     E*
     E**  USED BY SR. XXXXXX - DEAL TYPES FOR LOAN/DEPOSITS
     E/COPY WNCPYSRC,MM0101E001
     E*********           @DT     7   7  2                               S01136
     E*********           @DT     9   9  2                         S01136 S01354
     E***********         @DT    11  11  2                         S01354 CDL006
     E**********          @DT    17  17  2                                             CDL006 CDL033
     E/COPY WNCPYSRC,MM0101E002
     E                    @DT    18  18  2                                                    CDL033
     E*
     E**  USED BY SR. XXXXXX - SIGNS FOR DEAL TYPES FOR LOAN/DEPOSITS
     E/COPY WNCPYSRC,MM0101E003
     E*********           @SN     7   7  1                               S01136
     E*********           @SN     9   9  1                         S01136 S01354
     E***********         @SN    11  11  1                         S01354 CDL006
     E**********          @SN    17  17  1                                             CDL006 CDL033
     E/COPY WNCPYSRC,MM0101E004
     E                    @SN    18  18  1                                                    CDL033
     E*                                                                   S01328
     E/COPY ZSRSRC,ZDATE2Z1                                               S01328
     E*                                                                   S01328
     E/COPY ZSRSRC,ZFREQBZ1                                               S01328
     E*
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E*                                                                   S01195
     E                    FXT     5   5  2                                                    CDL033
     E********************************************************************
     I/EJECT
     I********************************************************************
      *                                                                                       CPK014
     IFDINTRP0                                                                                CPK014
     I              HWTMESTMP                       HWTMST                                    CPK014
     I*
     IDEALSDDF
     I*
     I*
     IDEALSDEF
     I*
     I**  Rename fields to differentiate DEALSDC from SDBRTDL1 fields.    S01383
     I*                                                                   S01383
     ISDBRTDD0                                                            S01383
     I              LCD                             BRTLCD                S01383
     I              LCT                             BRTLCT                S01383
     I              CHTP                            BRCHTP                S01383
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
     I*                                                                   S01194
     I/COPY ZSRSRC,ZCPDZ1                                                 S01328
     I*                                                                   S01328
      **                                                                  S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** External DS for BANK Details                                     S01194
     I*                                                                   S01194
     ISDDEAL    E DSSDDEALPD                                              S01194
     I** EXTERNAL DS FOR DEALING DETAILS                                  S01194
     I*                                                                   S01194
     I*SDMMOD****E*DSSDMMODPD***********                            E26289S01319
     I***External*DS*for*Module*Details*                            E26289S01319
     I*
     ISCSARD    E DSSCSARDPD                                              CDL006
      ** External DS for SAR details                                      CDL006
      *                                                                   CDL006
     ISDNOST    E DSSDNOSTPD                                              CDL017
     I** EXTERNAL DS FOR NOSTRO DETAILS                                   CDL017
     I              QQACCD                          QQACC1                CDL017
     I*                                                                   CDL017
     I@STDLD    E DSMMSTDLPP
     I**  EXTERNAL DATA DATA STRUCTURE FOR STANDARD LOANS/DEPOSITS
     I*
     I@STDNB    E DSMMSTDBPP
     I**  EXTERNAL DATA DATA STRUCTURE FOR STANDARD NAS BOUGHT
     I              QQDORI                          QQDOR1                                    CGL029
     I              QQMORI                          QQMOR1                                    CGL029
     I              QQDOPI                          QQDOP1                                    CGL029
     I              QQMOPI                          QQMOP1                                    CGL029
     I              QQBORI                          QQBOR1                                    CGL029
     I              QQBOPI                          QQBOP1                                    CGL029
     I              QQRONS                          QQRON1                                    CGL029
     I              QQPONS                          QQPON1                                    CGL029
     I*
     I@STDNS    E DSMMSTDSPP
     I**  EXTERNAL DATA DATA STRUCTURE FOR STANDARD NAS SOLD
     I              QQDORI                          QQDOR2                                    CGL029
     I              QQMORI                          QQMOR2                                    CGL029
     I              QQBORI                          QQBOR2                                    CGL029
     I              QQBOPI                          QQBOP2                                    CGL029
     I              QQRORI                          QQROR2                                    CGL029
     I              QQROPI                          QQROP2                                    CGL029
     I              QQRONS                          QQRON2                                    CGL029
     I              QQPONS                          QQPON2                                    CGL029
     I*
     I@STDDM    E DSMMSTDAPP
     I**  EXTERNAL DATA DATA STRUCTURE FOR STANDARD DEAL AMENDMENTS
     I              QQDORI                          QQDOR3                                    CGL029
     I              QQMORI                          QQMOR3                                    CGL029
     I              QQDOPI                          QQDOP3                                    CGL029
     I              QQMOPI                          QQMOP3                                    CGL029
     I              QQBORI                          QQBOR3                                    CGL029
     I              QQBOPI                          QQBOP3                                    CGL029
     I              QQRORI                          QQROR3                                    CGL029
     I              QQROPI                          QQROP3                                    CGL029
     I              QQRONS                          QQRON3                                    CGL029
     I              QQPONS                          QQPON3                                    CGL029
     I*
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
     I**GENERAL*LEDGER*DETAILS*ACCESSED*VIA*ACCESS*PROGRAM*************            MD035545 MD047993
     I**********    QQACCD                          ACCDQQ                         MD035545 MD047993
     I*
     I**  PROGRAM STATUS DATA STRUCTURE
     I*PSDS*******SDS********                                             S01194
     I***********************               244 253 @JOB                  S01194
     I***********************               254 263 @USER                 S01194
     I*
     I****LOCAL*DATA*AREA***                                              S01279
     I***LDA********UDS                            256                    S01279
     I* DATA STRUCTURE CONTAINING DATABASE ERROR INFORMATION              S01279
     ILDA         DS                            256                       S01279
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I**  MMDEAULL FILE INFORMATION DATA STRUCTURE
     I@DLSTS      DS
     I                                       38  45 @DLPF
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@Z71Y**********       S01328
     I************DS***********************************************       S01328
     I****************************************1***40@@Z71Y*********       S01328
     I****************************************1***10@@SSY1*********       S01328
     I****************************************2***20@@SSY2*********       S01328
     I****************************************3***30@@SSY3*********       S01328
     I****************************************4***40@@SSY4*********       S01328
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@VDT***********       S01328
     I************DS***********************************************       S01328
     I****************************************1***80@@VDT**********       S01328
     I****************************************1***40@@YR***********       S01328
     I****************************************5***60@@Z71M*********       S01328
     I****************************************7***80@@Z71D*********       S01328
      *                                                                   S01328
     I/COPY ZSRSRC,ZDATE9Z2                                               S01328
      *                                                                   S01328
     I**  DATA STRUCTURE FOR SR. M1010 - DATE FIELD YYMMDD
     I            DS
     I                                        1   80HNDATE
     I                                        1   40HNVDYY
     I                                        5   60HNVDMM
     I                                        7   80HNVDDD
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATA                056095
     I***********                             1   40@@YY1                 056095
     I***********                             5   60@@MM1                 056095
     I***********                             7   80@@DD1                 056095
     I*
     I**  DATASTRUCTURE TO CHANGE FORMAT TO MMDDYY / DDMMYY
     I            DS                              6
     I                                        1   60@@DTOU
     I                                        1   20@@DAT1
     I                                        3   40@@DAT2
     I                                        5   60@@YYY
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATB                056095
     I***********                             1   40@@YY2                 056095
     I***********                             5   60@@MM2                 056095
     I***********                             7   80@@DD2                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZINTDYZ1                                               056095
     I**  Data Structure for SR. ZINTDY                                   056095
     I*                                                                   056095
     I****DATA*STRUCTURE*FOR*SR.*ZA0680*-*DATE*INPUT*TO*SUBROUTINE*****   S01328
     I            DS
     I**  DATA STRUCTURE FOR DATE INPUT TO VARIOUS SUBROUTINES            S01328
     I                                        1   80@@DTIN
     I***********                             1   40@@YYYY                056095
     I                                        3   40@@YY
     I                                        5   60@@MM
     I                                        7   80@@DD
     I****************************************1***20@@CC***************   S01328
     I****************************************5***60@@MTH**************   S01328
     I****************************************7***80@@DAY**************   S01328
      *                                                                   S01328
     I/COPY ZSRSRC,ZDAT10Z1                                               S01328
     I*
     I**  DATA STRUCTURE FOR SR. MM1004 - MANIPULATE DATE INPUT
     I@@WKDS      DS
     I                                        1   80@@WKDT
     I                                        1   40@@WKYY
     I                                        3   40@@WKY
     I                                        5   60@@WKM
     I                                        7   80@@WKD
     I*
     I************DS                                                      S01195
     I************                                                        S01195
     I****USED*BY*SR. ZA0830 - ARRAY DATA STRUCTURE                       S01195
     I*********************                   1 150 @CY                   S01195
     I*********************                   1  75 @@CY1                 S01195
     I*********************                  76 150 @@CY2                 S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I*
     I**  DATA STRUCTURE HOLDING STARTING POINT DATE
     I            DS
     I                                        1   80@@STRT
     I                                        1   40@@STYR
     I                                        5   60@@STMT
     I                                        7   80@@STDY
     I*
     I**  DATA STRUCTURE HOLDING SPOT DATE
     I            DS
     I                                        1   80@@SPDD
     I                                        1   40@@SPYR
     I                                        5   60@@SPMT
     I                                        7   80@@SPDY
     I*
     I**  DATA STRUCTURE DAYS FOR DATE FORMAT DDMMYY
     I            DS
     I                                        1   60@@DATE
     I                                        1   20@@DAY2
     I*
     I*
     I**  DATA STRUCTURE TO STORE DETAILS FOR MATURITY INTEREST CALCS
     I**  - NEW DETAILS
     I@NEWDT      DS
     I                                        1   40HKSLYY
     I                                        5   60HKSLMM
     I                                        7   80HKSLDD
     I                                        9  120HKNIYY
     I                                       13  140HKNIMM
     I                                       15  160HKNIDD
     I                                       17  17 @KDSTS
     I                                       18  210HKIAYY
     I                                       22  230HKIAMM
     I                                       24  250HKIADD
     I                                    P  26  317HKINTR
     I                                    P  32  377HKIIRT
     I                                    P  38  437HKSPRD
     I                                    P  44  510HKAMNP
     I                                       52  52 HKIPFQ
     I                                       53  540HKIPDM
     I                                       55  55 HKNGVI                                    CDL033
     I*
     I**  DATA STRUCTURE TO STORE DETAILS FOR MATURITY INTEREST CALCS
     I**  - OLD DETAILS
     I@OLDDT      DS
     I                                        1   40@SLYY
     I                                        5   60@SLMM
     I                                        7   80@SLDD
     I                                        9  120@NIYY
     I                                       13  140@NIMM
     I                                       15  160@NIDD
     I                                       17  17 @DSTS
     I                                       18  210@IAYY
     I                                       22  230@IAMM
     I                                       24  250@IADD
     I                                    P  26  317@INTR
     I                                    P  32  377@IIRT
     I                                    P  38  437@SPRD
     I                                    P  44  510@AMNP
     I                                       52  52 @IPFQ
     I                                       53  540@IPDM
     I                                       55  55 @NGVI                                     CDL033
     I**  DATA STRUCTURE TO DEFINE DEAL NO. - @DN38
     I            DS
     I                                        1   60@DN38
     I                                        1   60HKDN38
     I                                        1   60HLDN38
     I                                        1   60HMDN38
     I*
     I**  DATA STRUCTURE TO DEFINE DEAL DELETED INDICATOR - @DDLT
     I            DS
     I                                        1   1 @DDLT
     I                                        1   1 HKDDLT
     I                                        1   1 HLDDLT
     I                                        1   1 HMDDLT
     I*
     I**  DATA STRUCTURE TO DEFINE LOGICAL DELETE FLAG - @DLTF
     I            DS
     I                                        1   1 @DLTF
     I                                        1   1 HKDLTF
     I                                        1   1 HLDLTF
     I                                        1   1 HMDLTF
     I*
     I**  DATA STRUCTURE TO DEFINE DEAL STATUS - @HDSTS
     I            DS
     I                                        1   1 @HDSTS
     I                                        1   1 HKDSTS
     I                                        1   1 HLDSTS
     I                                        1   1 HMDSTS
     I*
     I**  RELATED DEAL ROLLOVER MATURITY DATE
     I            DS                                                      ME1427
     I                                        1   80@IKRMT                ME1427
     I                                        9  140@IKDDN                ME1427
     I                                        1   40HKMDYY                ME1427
     I                                        5   60HKMDMM                ME1427
     I                                        7   80HKMDDD                ME1427
     I                                        9  14 HKDADN                ME1427
      *                                                                                       CDL081
      ** Named constants                                                                      CDL081
      *                                                                                       CDL081
     I              'BasCcyTaxRoundDown'  C         C#BASE                                    CDL081
     I              'NBasCcyTaxRoundDown' C         C#NBAS                                    CDL081
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I/EJECT
     I/COPY WNCPYSRC,MM0101I001
     C********************************************************************
      *
      *                          PROGRAM SUMMARY
      *
      *                           INTRODUCTION
      *
      *This program runs during the Start-of-day processing after the new
      *run date has been entered.
      *
      *This program controls the rebuilding of a number of files in
      *readiness for the next days processing as well as updating for the
      *Deals/Deams files so they are inline with the MIDAS Deals/Deams
      *files.
      *
      *
      *                       ********************
      *
      *
      *
      *
      *                          PROCESS SUMMARY
      *
      *MMP0367 - Mainline & DEALS Update
      *
      *MMP0368 - DEAMS Update
      *
      *MMP0356 - Interest rates Period Dates Update.
      *
      *MMP0236 - Calls Revalue Profit/Loss.
      *
      *
      *DATA AREAS :        None
      *
      *SCREENS    :        None
      *
      *REPORTS    :        None
      *
      *DATA IN    :        None
      *
      *DATA OUT   :        None
      *
      *
      *                       ********************
      *
      *
      *                           PROCESS FLOW
      *
      *Overall Process:
      *
      * A. Perform initial processing.
      *
      * B. Perform main processing.
      *
      * C. Perform termination processing.
      *
      *Parameters:  Termination code (' ',T,E)
      *
      *Standard subroutines:
      *ZA0710*-*Convert*day*no.*to*YYYYMMDD*format.******************     S01328
      *ZA0830*-*Check*date*is a holiday.                                  S01195
      *
      *
      *                       ********************
      *
      *
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     INDEX TO SUBROUTINES                                         *
     C*                                                                  *
     C*  1. *PSSR  - DUMP                                                *
     C*  2. #A     - INITIAL PROCESSING                                  *
     C*  3. #AA    - CALCULATE MM SPOT DATE                              *
     C*  4. #B     - MAIN PROCESSING                                     *
     C*  5. #BA    - MM DEAL PROCESSING                                  *
     C***6.*#ZB    - INITIALISE STANDARD DEAL DATA STRUCTURES      ME1376*S01150
     C*  7. #BAA   - PREPARE AND UPDATE MMDELDPP - LOANS/DEPOSITS        *
     C*  8. #BAB   - PREPARE AND UPDATE MMDENBPP - NA'S BOUGHT           *
     C*  9. #BAC   - PREPARE AND UPDATE MMDENSPP - NA'S SOLD             *
     C**10.*#BAD   - PREPARE STD DEAL FOR ENQUIRIES - LOANS/DEPOSITS     *S01150
     C**11.*#BAE   - PREPARE STD DEAL FOR ENQUIRIES - NA'S BOUGHT        *S01150
     C**12.*#BAF   - PREPARE STD DEAL FOR ENQUIRIES - NA'S SOLD          *S01150
     C* 13. #BAG   - DELETE RELEVENT MM DEALS RECORD                     *
     C* 14. #BB    - MM DEAM PROCESSING                                  *
     C**15.*#BBA   - SELECT MM DEAMS RECORD FOR DELETE/ENQUIRIES         *S01150
     C**16.*#BBAA  - PREPARE FIELDS FOR STANDARD DEAM                    *S01150
     C**17.*#BC    - PERIOD DATES UPDATE                                 *
     C**17.*#BC****-*PERIOD*DATES*UPDATE FOR FDINTRPP               S01328E26582
     C* 17. #BC    - PERIOD DATES UPDATE FOR FDINTRPP AND DLMMDFL2       *E26582
     C* 17. #BD    - PERIOD DATES UPDATE FOR DLFRARPP                    *S01328
     C* 17. #BE    - PERIOD DATES UPDATE FOR DLIRSRPP                    *S01328
     C* 17. #BF    - PERIOD DATES UPDATE FOR DLSWPRPD                    *CIR001
     C/COPY WNCPYSRC,MM0101CCP1                                           S01408
     C* 18. #C     - TERMINATION PROCESSING                              *
     C**19.*#ZA    - UPDATE RELEVENT ENQUIRIES                           *S01150
     C* 20. MM1003 - CALCULATE A PERIOD DATE                             *
     C* 21. MM1004 - CALCULATES THE NEXT INTEREST DATE                   *
     C**22**MM1007*-*CALCULATES INTEREST                                 *S01392
     C* 22. MM1030 - CALCULATES INTEREST                                 *S01392
     C**23.*MM1009*-*CALCULATES*THE*NEXT*INTEREST*DATE*****************  *056095
     C* 23. ZINTDY - CALCULATES THE NEXT INTEREST DATE                   *056095
     C* 24. MM1010 - CALCULATES THE NUMBER OF INTEREST DAYS              *
     C**25.*ZA0680*-*CONVERTS*YYYYMMDD*DATE*TO*MIDAS*DAY*NO.**************S01328
     C* 25. ZDAT10 - CONVERTS YYYYMMDD DATE TO MIDAS DAY NO.             *S01328
     C**26.*ZA0710*-*CONVERTS*MIDAS*DAY*NO.*TO*YYYYMMDD*DATE*****        *S01328
     C* 26. ZDATE9 - Convert day no. to YYYYMMDD format.                 *S01328
     C* 27. ZA0730 - DETERMINE NEXT WORKING DAY                          *
     C* 28. ZA0770 - CONVERTS A YYYYMMDD DATE TO DDMMYY OR MMDDYY DATE   *
     C**29.*ZA0830*-*CALCULATES*THE NEXT INTEREST PAYMENT DATE           *S01195
     C* 29. ZDATE2 - Convert day no. to DDMMMYY format.                  *S01328
     C* 30. ZCPD   - Calculate a Period Date                             *S01328
     C*                                                                  *
     C*     INDEX TO PROGRAMS CALLED                                     *
     C*                                                                  *
     C*  1. MM0053 - REVALUE PROFIT AND LOSS                             *
     C***2.*MM0073 - NEAR DATE SUMMARY                                   *S01150
     C*  2. MM0173 - NEAR DATE SUMMARY                                   *S01150
     C***3.*MM0074 - CUSTOMER EXPOSURE UPDATE                            *S01150
     C*  3. MM0174 - CUSTOMER EXPOSURE UPDATE                            *S01150
     C***4.*MM0075 - FORWARD BOOK UPDATE                                 *S01150
     C*  4. MM0175 - FORWARD BOOK UPDATE                                 *S01150
     C***5.*MM0088 - ACTIVATE DEAL TICKET PRINT                          *S01319
     C***6.*MM0094 - LIQUIDITY EXPOSURE                                  *S01150
     C*  6. MM0194 - LIQUIDITY EXPOSURE                                  *S01150
     C*  7. MM0098 - NEAR DATES SUMMARY                                  *
     C*                                                                  *
     C********************************************************************
     C*
     C                     EXSR #A
     C*
     C           @TERM     CASEQ' '       #B
     C                     END
     C*
     C                     EXSR #C
     C*
     C                     RETRN
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
      *
      *                         DETAIL PROCESSING
      *
      * 1. Read a record from MM Deals file (MMDEALLL)
      *
      * 2. If end of file goto step 6.
      *
      * 3. Use deal number to chain to MIDAS Deals File (DEALS)
      *
      * 4. If record exists:
      *
      *     4.1 Prepare fields required for MM deal.
      *
      *     4.2 Update standard MM deal from details on DEALS as per
      *         R/MM0101,02/03/04 (depending upon deal type)
      *
      *     4.3 If deal deleted flag is not = 'D':
      *
      *          4.3.1 If logical delete flag is not = '*':
      *
      *                 4.3.1.1 If deal status is not = 'E' or 'M':
      *
      *                          4.3.1.1.1 Prepare standard deal from LF/
      *                                    DEALS and include Action code =
      *                                    = 'I'and Last action code = 'I'
      *                                    as per R/MM0101,05/06/07
      *
      *                          4.3.1.1.2 If deal is a negotiable asset
      *                                    sold:
      *                              4.3.1.2.2.1 Access N.A. bought
      *                                          with related deal
      *                                          number
      *                              4.3.1.2.2.2 Prepare related fields
      *                                          on N.A. sold (for a
      *                                          standard deal) with
      *                                          their equivalents from
      *                                          the N.A. bought as per
      *                                          R/MM0101,08
      *
      *******                    4.3.1.1.3 Call MM0073 - Near Date SummaryS01150
      *******                              Update                         S01150
      *                                                                   S01150
      *                          4.3.1.1.3 Call MM0173 - Near Date        S01150
      *                                    Summary Update                 S01150
      *                                                                   S01150
      *******                    4.3.1.1.4 Call MM0074 - Customer ExposureS01150
      *******                              Update                         S01150
      *
      *                          4.3.1.1.4 Call MM0174 - Customer         S01150
      *                                    Exposure Update                S01150
      *                                                                   S01150
      *******                    4.3.1.1.5 Call MM0075 - Forward Book UpdaS01150
      *
      *                          4.3.1.1.5 Call MM0175 - Forward Book     S01150
      *                                    Update                         S01150
      *                                                                   S01150
      *******                    4.3.1.1.6 Call MM0094 - Liquidity ExposurS01150
      *                                                                   S01150
      *                          4.3.1.1.6 Call MM0194 - Liquidity        S01150
      *                                    Exposure Update                s01150
      *  Else:
      *
      *     4.4 Delete MM Deal as per R/MM0101,09
      *
      * 5. Go to step 1.
      *
      * 6. Read a record from MM Deams file (MMDEAMLL)
      *
      * 7. If end of file goto step 12.
      *
      * 8. If deam type = 'SI':
      *
      *     8.1 If deal number is same as previous deal:
      *
      *          8.1.1 Goto step 6
      *
      * Else:
      *
      *          8.1.2 Save deal number
      *
      * 9. Use deal number to chain to MIDAS deams file (DEAMS)
      *
      *10. If record found:
      *
      *    10.1 If deal deleted flag is not = 'D'
      *
      *         10.1.1 If logical delete flag is not = '*'
      *
      *                10.1.1.1 If deal status is not = 'E' or 'M':
      *
      *                  10.1.1.1.1 Prepare standard deam where action
      *                             code = 'I' and last action code =
      *                             'I' as per R/MM0101,11
      *
      *                  10.1.1.1.2 Call MM0112 - File Rebuild Control    S01150
      *                                                                   S01150
      *******            10.1.1.1.2 Call MM0073 - Near Date Summary       S01150
      *******                       Update                                S01150
      *                                                                   S01150
      *******            10.1.1.1.2 Call MM0173 - Near Date Summary       S01150
      *******                       Update                                S01150
      *
      *******            10.1.1.1.3 Call MM0074 - Customer Exposure       S01150
      *******                       Update                                S01150
      *                                                                   S01150
      *******            10.1.1.1.3 Call MM0174 - Customer Exposure       S01150
      *******                       Update                                S01150
      *
      *******            10.1.1.1.4 Call MM0075 - Forward Book Update     S01150
      *                                                                   S01150
      *******            10.1.1.1.4 Call MM0175 - Forward Book Update     S01150
      *
      *******            10.1.1.1.5 Call MM0094 - Liquidity Exposure      S01150
      *                                                                   S01150
      *******            10.1.1.1.5 Call MM0194 - Liquidity Exposure      S01150
      *
      * Else:
      *
      *    10.4 Delete MMDEAM as per R/MM0101,12
      *
      *11. Go to step 6.
      *
      *12.*Execute process MMP0356 (P/MM0101,02) - Interest Rates Period Dates
      *    Update
      *
      *13.*Call MM0053 - Revalue profit and loss
      *
      *14.*Call*MM0088*-*Activate*deal*ticket*print                       S01319
      *
      *15.*Call MM0097 - Update MM Funds in nostro
      *
      *16.*Call MM0098 - Near dates summary adjustments
      *
      *17. Comit data base changes
      *
      *18. End.
      *
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #B - MAIN PROCESSING                                         *
     C*                                                                  *
     C*     CALLED BY  : CONTROL PROCESSING                              *
     C*                                                                  *
     C*     CALLS      : #BA                                             *
     C*                  #BB                                             *
     C*                  #BC - CALCULATE MM INTEREST RATES PERIOD DATE   *S01328
     C*                  #BD - CALCULATE FRA RATES PERIOD DATE           *S01328
     C*                  #BE - CALCULATE IRS PERIOD DATE                 *S01328
     C*                  #BF - CALCULATE SWAP PERIOD DATE                *CIR001
     C/COPY WNCPYSRC,MM0101CCP2                                           S01408
     C*******            MM0173                                          *
     C*******            MM0174                                          *
     C*******            MM0175                                          *
     C*******            MM0194                                          *
     C*******            MM0053                                          *
     C*******            MM0088                                          *
     C*******            MM0097                                          *
     C*******            MM0098                                          *
     C*                                                                  *
     C*     WORK FIELDS: @TERM    TERMINATION FLAG              (1A)     *
     C*                                                                  *
     C********************************************************************
     C*
     C           #B        BEGSR
     C*
     C**  PROCESS MM DEALS - THESE ARE UPDATED FROM DETAILS ON LF/DEALS
     C                     EXSR #BA
     C*
     C**  PROCESS MM DEAMS - THESE ARE UPDATED FROM DETAILS ON LF/DEAMS
     C           @TERM     IFEQ ' '                        B1
     C                     EXSR #BB                        *1
     C                     END                             E1
     C*                                                            S01150 E14042
     C**  CALL FILE REBUILD CONTROL PROGRAM                        S01150 E14042
     C*                                                            S01150 E14042
     C           @TERM     IFEQ ' '                        B1             E14042
     C                     CALL 'MM0112'                   *1             E14042
     C                     PARM           @TERM            *1             E14042
     C                     END                             E1             E14042
     C*                                                            S01150 E14042
     C**  CALL NECESSARY UPDATE PROGRAMS                           S01150 E14042
     C*                                                            S01150 E14042
     C**  MM0173 - NEAR DATES AND POSITIONS AND ENQUIRY FILE REBUILD      E14042
     C*          @TERM     IFEQ ' '                        B1      S01150 E14042
     C*                    CALL 'MM0173'                   *1      S01150 E14042
     C*                    PARM           @TERM            *1      S01150 E14042
     C*                    END                                     S01150 E14042
     C*                                                            S01150 E14042
     C**  MM0174 - CUSTOMER EXPOSURE ENQUIRY FILE REBUILD          S01150 E14042
     C*          @TERM     IFEQ ' '                        B1      S01150 E14042
     C*                    CALL 'MM0174'                   *1      S01150 E14042
     C*                    PARM           @TERM            *1      S01150 E14042
     C*                    END                                     S01150 E14042
     C*                                                            S01150 E14042
     C**  MM0175 - FORWARD BOOK  ENQUIRY FILE REBUILD              S01150 E14042
     C*          @TERM     IFEQ ' '                        B1      S01150 E14042
     C*                    CALL 'MM0175'                   *1      S01150 E14042
     C*                    PARM           @TERM            *1      S01150 E14042
     C*                    END                                     S01150 E14042
     C*                                                            S01150 E14042
     C**  MM0194 - LIQUIDITY EXPOSURE ENQUIRY FILE REBUILD         S01150 E14042
     C*          @TERM     IFEQ ' '                        B1      S01150 E14042
     C*                    CALL 'MM0194'                   *1      S01150 E14042
     C*                    PARM           @TERM            *1      S01150 E14042
     C*                    END                             E1      S01150 E14042
     C*
     C**  SETUP INTEREST RATES PERIOD DATES
     C           @TERM     IFEQ ' '                        B1
     C                     EXSR #BC                        *1
     C                     END                             E1
     C*                                                                   S01328
     C**  SETUP FRA RATES PERIOD DATES                                    S01328
     C           @TERM     IFEQ ' '                                       S01328
     C                     EXSR #BD                                       S01328
     C                     END                                            S01328
     C*                                                                   S01328
     C**  SETUP IRS RATES PERIOD DATES                                    S01328
     C           @TERM     IFEQ ' '                                       S01328
     C                     EXSR #BE                                       S01328
     C                     END                                            S01328
     C*                                                                   CIR001
     C**  SETUP SWAP RATES PERIOD DATES                                   CIR001
     C           @TERM     IFEQ ' '                                       CIR001
     C                     EXSR #BF                                       CIR001
     C                     END                                            CIR001
     C/COPY WNCPYSRC,MM0101CCP3                                           S01408
     C*
     C**  CALL NECESSARY UPDATE PROGRAMS
     C           @TERM     IFEQ ' '                        B1
     C*
     C**  MM0053 - REVALUE PROFIT AND LOSS
     C                     CALL 'MM0053'                   *1
     C                     PARM           @TERM            *1
     C                     END                             E1
     C*                                                                   S01280
     C**  TMC3360 - INCLUDE VALUES FROM LENDING/FRAS/IRS AND FUTURES.     S01280
     C****Only*processing*if*Treasury*Management*is*on*system*******E26289S01319
     C           @TERM     IFEQ ' '                        B1             S01280
     C***********BGTRMG****ANDEQ'Y'                        B1       E26289S01319
     C                     CALL 'TMC3360'                  *1             S01280
     C                     PARM           @TERM            *1             S01280
     C                     END                             E1             S01280
     C*
     C****MM0088 - ACTIVATE DEAL TICKET PRINT                             S01319
     C*****      @TERM     IFEQ ' '                        B1             S01319
     C*****                CALL 'MM0088'                   *1             S01319
     C*****                PARM           @TERM            *1             S01319
     C*****                END                             E1             S01319
     C*
     C**  MM0097 - UPDATE MM FUNDS IN NOSTRO                              E14042
     C******     @TERM     IFEQ ' '                        B3      FT0031 E14042
     C******               CALL 'MM0097'                   *3      FT0031 E14042
     C******               PARM           @TERM            *3      FT0031 E14042
     C******               PARM 'Y'       @COFF   1        *3      FT0031 E14042
     C*                                                                   E14042
     C**  MM0098 - NEAR DATES SUMMARY ADJUSTMENTS                         E14042
     C*          @TERM     IFEQ ' '                        B4             E14042
     C*                    CALL 'MM0098'                   *4             E14042
     C*                    PARM           @TERM            *4             E14042
     C*                    PARM 'Y'       @COFF   1        *3      FA0115 E14042
     C*                                                                   E14042
     C*                    END                             E4             E14042
     C*****                END                             E3      FT0031 E14042
     C*                    END                             E2             E14042
     C*                    END                             E1             E14042
     C*
     C           #B9       ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BA - MM DEAL PROCESSING                                     *
     C*                                                                  *
     C*     CALLED BY  : #B                                              *
     C*                                                                  *
     C*     CALLS      : #BAA -  PREPARE & UPDATE MMDELDPP - LD'S        *
     C*                  #BAB -  PREPARE & UPDATE MMDENBPP - NA'S BOUGHT *
     C*                  #BAC -  PREPARE & UPDATE MMDENSPP - NA'S SOLD   *
     C*                  #BAD -  PREPARE STD DEAL FOR ENQS - LD'S        *
     C*                  #BAE -  PREPARE STD DEAL FOR ENQS - NA'S SOLD   *
     C*                  #BAF -  PREPARE STD DEAL FOR ENQS - NA'S BOUGHT *
     C*                  #BAG -  DELETE RELEVENT MM DEALS RECORD         *
     C*                  #ZA  -  UPDATE RELEVENT ENQUIRIES               *
     C*                                                                  *
     C*     WORK FIELDS: @DN38    DEAL NUMBER                   (6N)     *
     C*                  @DLKY    DEAL NUMBER KEY LIST          KLIST    *
     C*                  @DEALN   DEAL NUMBER                   (6N)     *
     C*                  @DDLT    DEAL DELETED INDICATOR        (1A)     *
     C*                  @DLTF    LOGICAL DELETE FLAG           (1A)     *
     C*                  @HDSTS   DEAL STATUS INDICATOR         (1A)     *
     C*                  @DLPF    MM DEALS PHYSICAL FILE NAME   (8A)     *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BA       BEGSR
     C*
     C**  READ SEQUENTIALLY THROUGH MM DEALS FILE
     C           *IN60     DOUEQ'1'                        B1
     C                     READ MMDEAULL                 60
     C           *IN60     IFEQ '0'                        B2
     C*
     C**  ACCESS MIDAS DEALS FILE TO UPDATE RELEVENT FIELDS ON MMDEALLL.
     C**  IF A DEALS RECORD IS NOT FOUND DELETE MMDEALLL RECORD.
     C                     Z-ADD@DN38     @DEALN
     C           @DLKY     CHAINDEALS                61
     C           *IN61     IFEQ '0'                        B3
     C*
     C/COPY WNCPYSRC,MM0101C010
     C**  IF A DEALS RECORD IS FOUND PREPARE MM DEAL FIELDS (DEPENDING
     C**  UPON DEAL TYPE) AND UPDATE MMDEAULL
     C           @DLPF     CASEQ'MMDELDP0'#BAA             *3 LOANS/DEP
     C           @DLPF     CASEQ'MMDENBP0'#BAB             *3 N.A.S BOUGHT
     C           @DLPF     CASEQ'MMDENSP0'#BAC             *3 N.A.S SOLD
     C                     END                             *3
     C           @TERM     CABNE' '       #BA9             *3 ----------->
     C*
     C*
     C/COPY WNCPYSRC,MM0101C006
     C                     ELSE                            X3
     C*
     C**  IF DEALS RECORD NOT FOUND DELETE RELEVENT MM DEAL RECORD
     C/COPY WNCPYSRC,MM0101C007
     C                     EXSR #BAG                       *3
     C/COPY WNCPYSRC,MM0101C008
     C*
     C                     END                             E3
     C*
     C                     END                             E2
     C*
     C                     END                             E1
     C*
     C           #BA9      ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BAA - PREPARE AND UPDATE MMDELDPP - LOANS/DEPOSITS          *
     C*                                                                  *
     C*     CALLED BY  : #BA,                                            *
     C*                                                                  *
     C*     CALLS      : MM1010   INTEREST AT MATURITY CALCULATIONS      *
     C*******************ZA0710***CONVERT*MIDAS*DAY*NO.*TO*YYYYMMDD*******S01328
     C*                  ZDATE9   CONVERT MIDAS DAY NO. TO YYYYMMDD      *S01328
     C*                                                                  *
     C*     WORK FIELDS: @KDSTS   DEAL STATUS                   (1A)     *
     C*                  @OLDDT   OLD DETAILS } USED FOR MATUR-(54A)     *
     C*                  @NEWDT   NEW DETAILS } ITY INT. CALCS.(54A)     *
     C*                  @SLYY    START/LAST INTEREST DATE YEAR (4N)     *
     C*                  @SLMM       "          "      "   MTH  (2N)     *
     C*                  @SLDD       "          "      "   DAY  (2N)     *
     C*                  @NIYY    NEXT INTEREST PAYMENT YEAR    (4N)     *
     C*                  @NIMM      "     "       "     MTH     (2N)     *
     C*                  @NIDD      "     "       "     DAY     (2N)     *
     C*                  @DSTS    DEAL STATUS                   (1A)     *
     C*                  @IAYY    ACCRUAL CONTROL DATE YEAR     (4N)     *
     C*                  @IAMM      "        "     "   MTH      (2N)     *
     C*                  @IADD      "        "     "   DAY      (2N)     *
     C*                  @INTR    DEAL INTEREST RATE            (11,7N)  *
     C*                  @IIRT    INPUT   "      "              (11,7N)  *
     C*                  @SPRD    SPREAD RATE                   (11,7N)  *
     C*                  @AMNP    AMOUNT                        (15N)    *
     C*                  @IPFQ    INTEREST PAYMENT FREQUENCY    (1A)     *
     C*                  @IPDM       "     FREQUENCY DAY IN MTH (2N)     *
     C*                  @@BRMD   Maturity date for BRT calculation      *S01383
     C*                                                                  *
     C********************************************************************
     C*
     C           #BAA      BEGSR
     C*
     C**  ONLY THE FOLLOWING FIELDS ARE UPDATED FROM THE MIDAS DEALS FILE
     C*
     C*
     C**  SAVE DETAILS USED FOR MATURITY INTEREST CALCULATIONS
     C                     Z-ADDHKSLYY    @SLYY
     C                     Z-ADDHKSLMM    @SLMM
     C                     Z-ADDHKSLDD    @SLDD
     C                     Z-ADDHKNIYY    @NIYY
     C                     Z-ADDHKNIMM    @NIMM
     C                     Z-ADDHKNIDD    @NIDD
     C                     MOVE HKDSTS    @DSTS
     C                     Z-ADDHKIAYY    @IAYY
     C                     Z-ADDHKIAMM    @IAMM
     C                     Z-ADDHKIADD    @IADD
     C                     Z-ADDHKINTR    @INTR
     C                     Z-ADDHKIIRT    @IIRT
     C                     Z-ADDHKSPRD    @SPRD
     C                     MOVE HKNGVI    @NGVI                                               CDL033
     C                     Z-ADDHKAMNP    @AMNP
     C                     MOVE HKIPFQ    @IPFQ
     C                     Z-ADDHKIPDM    @IPDM
     C                     Z-ADDHKIPDM    @@MDAY                                            MD038562
     C**********           Z-ADDHKCNUM    @CNUM   60                                   S01383 CSD027
     C                     MOVE HKCNUM    @CNUM   6                                           CSD027
     C*
     C**  CONVERT DATES FROM MIDAS DAY NO. TO RELEVENT FORMAT
     C                     Z-ADDSLID      @@DAYN
     C                     Z-ADDSLID      HKSLID                                           MD024467A
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@Z71D    HKSLDD
     C                     Z-ADD@@Z71M    HKSLMM
     C                     Z-ADD@@YR      HKSLYY
     C*
     C                     Z-ADDNIDT      @@DAYN
     C                     Z-ADDNIDT      HKNIPD                                           MD024467A
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@Z71D    HKNIDD
     C                     Z-ADD@@Z71M    HKNIMM
     C                     Z-ADD@@YR      HKNIYY
     C                     Z-ADDNIDT      HKNIPD                                              262922
     C*
     C**  IF MIDAS RECORD HAS A RECORD ID OF 'M' UPDATE DRS DEAL STATUS
     C**  WITH 'M'
     C           RECI      IFEQ 'M'                        B1
     C                     MOVE 'M'       HKDSTS           *1
     C                     END                             E1
     C                     Z-ADDXKRCDT    HKRCDT                                            AR755195
     C                     Z-ADDXKINFD    HKINFD                                            AR755195
     C                     Z-ADDINTR      HKINTR                                           AR755195A
     C                     Z-ADDINTR      HKSTRT                                           AR755195A
     C*
     C                     Z-ADDIACD      @@DAYN
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@Z71D    HKIADD
     C                     Z-ADD@@Z71M    HKIAMM
     C                     Z-ADD@@YR      HKIAYY
     C*
     C                     MOVE IPFR      HKIPFQ
     C                     Z-ADDINTF      HKIPDM
     C*
     C**  IF MIDAS BASE RATE TYPE IS ZERO:
     C           BRTT      IFEQ 0                          B1
     C*                    Z-ADDRTSP      HKINTR           *1             ME1391
     C*                    Z-ADDRTSP      HKIIRT           *1             ME1391
     C**********           Z-ADDINTR      HKINTR           *1                       ME1391 AR755195A
     C                     Z-ADDINTR      HKIIRT           *1             ME1391
     C                     Z-ADD0         HKSPRD           *1             ME1391
     C*
     C**  REVERSE SIGNS OF INTEREST IF -VE INTEREST SIGN IS 'Y'
     C*          HKNGVI    IFEQ 'Y'                        B*2            ME1391
     C*                    Z-SUBHKINTR    HKINTR           **2            ME1391
     C*                    Z-SUBHKIIRT    HKIIRT           **2            ME1391
     C*                    END                             E*2            ME1391
     C*
     C                     ELSE                            X1
     C**********           Z-ADDINTR      HKINTR           *1                              AR755195A
     C                     MOVE BRTT      HKBSRC                                           MD024467A
     C                     MOVE BRTT      HKDBSR                                           MD024467A
     C                     MOVELCCY       HKDBSR                                           MD024467A
     C                     Z-ADDRTSP      HKSPRD           *1
     C                     Z-ADDRTSP      HKIIRT           *1             ME1391
     C                     END                             E1
     C/COPY WNCPYSRC,MM0101C017
      *                                                                                       CDL033
      ** If the effective interest is negative, update HKNGVI with 'Y'                        CDL033
      ** As field DSTI (bit 1) might not be accurate                                          CDL033
      *                                                                                       CDL033
     C           HKINTR    IFLT *ZERO                                                         CDL033
     C                     MOVE 'Y'       HKNGVI                                              CDL033
     C                     ELSE                                                               CDL033
     C**********           MOVE 'N'       HKNGVI                                     CDL033 AR937172
     C                     MOVE ' '       HKNGVI                                            AR937172
     C                     ENDIF                                                              CDL033
     C*
     C**  OBTAIN SIGN OF PRINCIPAL ACCORDING TO DEAL TYPE (MMT0014)
     C                     Z-ADD1         @X      20
     C           DTYP      LOKUP@DT,@X                   64
     C           *IN64     IFEQ '0'                        B1
     C           CDL006    OREQ 'N'                                       CDL006
     C           @X        ANDGE12                                        CDL006
     C           @X        ANDLE17                                        CDL006
     C           *LOCK     IN   LDA                                       S01280
     C                     Z-ADD001       DBASE            ***************
     C                     MOVEL'DEALSDC 'DBFILE           * DB ERROR 01 *
     C                     MOVELDTYP      DBKEY            ***************
     C                     MOVEL'MM0101'  DBPGM                           S01280
     C                     MOVE 'E'       @TERM            *1
     C                     DUMP                            *1
     C                     OUT  LDA                                       S01280
     C                     GOTO #BAA9                      *1
     C                     END                             E1
     C*
     C**  SET PRINCIPAL SIGN ACCORDING TO DEAL TYPE
     C                     Z-ADDPCPL      HKAMNP
     C           @SN,@X    IFEQ '-'                        B1
     C                     Z-SUBHKAMNP    HKAMNP
     C                     END                             E1
     C/COPY WNCPYSRC,MM0101C018
     C*
     C**  CALCULATE INTEREST AT MATURITY ONLY IF INTEREST DETAILS
     C**  HAVE CHANGED (HKDSTS HAD TO RENAMED IN DATA STRUCTURE TO PREVENT
     C**  CLASHING). ONLY UPDATE MMDELDPP IF DETAILS HAVE CHANGED.
     C                     MOVE HKDSTS    @KDSTS
     C           @OLDDT    IFNE @NEWDT                     B1
     C*                                                                   S01392
     C**  Front Up Interest deal has zero interest at maturity.           S01392
     C*                                                                   S01392
     C           FUID      IFEQ 'Y'                        B*2            S01392
     C                     Z-ADD0         HKIMAT           **2            S01392
     C                     ELSE                            X*2            S01392
     C                     Z-ADDTOTI      @@TINT           *1
     C                     Z-ADDIPRD      @@INTD           *1
     C                     MOVE HKIPFQ    @@INFQ           *1
     C                     Z-ADDNIDT      @@NXIP           *1
     C                     Z-ADDVDAT      @@VDAT           *1
     C                     MOVE HKICMT    @@INCM           *1
     C                     Z-ADDHKAMNP    @@DLAM           *1
     C*
     C**  IF MIDAS BASE RATE TYPE IS NOT 0, ADD INTEREST AND SPREAD RATES
     C                     Z-ADDRTSP      @@EIRT           *1
     C           BRTT      IFNE 0                          B*2
     C                     ADD  INTR      @@EIRT           **2
     C                     END                             E*2
     C                     MOVE ' '       @@MTXI           *1
     C                     Z-ADDHKDN38    @@DEAL           *1
     C*                                                                   S01383
     C** IF BRT SAR INSTALLED                                             S01383
     C*                                                                   S01383
     C           S01383    IFEQ 'Y'                                       S01383
     C/COPY WNCPYSRC,MMH00194
     C                     MOVE TAXI      @@MTXI           *1             S01383
     C                     END                                            S01383
     C*                                                                   S01383
     C** Calculate maturity date for BRT tax calculations                 S01383
     C*                                                                   S01383
     C           DTYP      IFEQ 'CD'                       B*2            S01383
     C           DTYP      OREQ 'CL'                       **2            S01383
     C           DTYP      OREQ 'DL'                       **2            S01383
     C           NOTD      IFEQ 0                          B**3           S01383
     C           VDAT      ADD  1         @@BRMD  50       ***3           S01383
     C                     ELSE                            X**3           S01383
     C           NOTD      IFNE -999                       B***4          S01383
     C           VDAT      ADD  NOTD      @@BRMD           ****4          S01383
     C                     ELSE                            X***4          S01383
     C                     Z-ADDMDAT      @@BRMD           ****4          S01383
     C                     END                             E***4          S01383
     C                     END                             E**3           S01383
     C                     ELSE                            X*2            S01383
     C                     Z-ADDMDAT      @@BRMD           **2            S01383
     C                     END                             E*2            S01383
     C                     EXSR MM1010                     *1
     C*                                                                   S01383
     C** ERROR HANDLING                                                   S01383
     C*                                                                   S01383
     C           @TERM     IFEQ 'E'                                       S01383
     C                     GOTO #BAA9                                     S01383
     C                     END                                            S01383
     C*
     C**  REVERSE SIGN OF INTEREST CALCULATED
     C                     Z-SUB@@INMT    HKIMAT           *1
     C                     END                             E*2            S01392
     C*                                                                   CDL007
     C**  Setup 'Record Printed' Field from PF/DEALSDC                    CDL007
     C                     MOVE PRIN      HKPRIN                          CDL007
      *                                                                   CDL017
      **  Update fields which may have been amended due to                CDL017
      **  an early maturity deal amendment event.                         CDL017
     C           FSCAND    IFNE *ZERO                                     CDL017
      *                                                                   CDL017
      ***Pay*settlement*instructions                                CDL017BUG4092
     C******************** MOVE PSTM      HKPSTM                    CDL017BUG4092
     C******************** MOVE PONS      HKPONS                    CDL017BUG4092
     C******************** MOVE PIBN      HKPIBN                    CDL017BUG4092
     C******************** MOVE PIBA      HKPIBA                    CDL017BUG4092
     C******************** MOVE POBN      HKPOBN                    CDL017BUG4092
     C******************** MOVE POCN      HKPOCN                    CDL017BUG4092
     C******************** MOVE RCRN      HKRCRN                    CDL017BUG4092
     C******************** MOVE RCRA      HKRCRA                    CDL017BUG4092
     C******************** MOVE RVNO      HKRVNO                    CDL017BUG4092
     C******************** MOVE AWBN      HKAWBN                    CDL017BUG4092
     C******************** MOVE AWBA      HKAWBA                    CDL017BUG4092
     C******************** MOVE BENN      HKBENN                    CDL017BUG4092
     C******************** MOVE BENA      HKBENA                    CDL017BUG4092
     C******************** MOVE DTP1      HKDTP1                    CDL017BUG4092
     C******************** MOVE DTP2      HKDTP2                    CDL017BUG4092
     C******************** MOVE DTP3      HKDTP3                    CDL017BUG4092
     C******************** MOVE DTP4      HKDTP4                    CDL017BUG4092
     C******************** MOVE DCHG      HKDCHG                    CDL017BUG4092
     C******************** MOVE BTB1      HKBTB1                    CDL017BUG4092
     C******************** MOVE BTB2      HKBTB2                    CDL017BUG4092
     C******************** MOVE BTB3      HKBTB3                    CDL017BUG4092
     C******************** MOVE BTB4      HKBTB4                    CDL017BUG4092
     C******************** MOVE BTB5      HKBTB5                    CDL017BUG4092
     C******************** MOVE BTB6      HKBTB6                    CDL017BUG4092
     C******************** MOVE POBR      HKPOBR                    CDL017BUG4092
     C******************** MOVE BRTT      HKBSRC                    CDL017BUG4092
     C******************** MOVELPSTM      HKMOPM                    CDL017BUG4092
     C******************** MOVELPONS      HKMOPI                    CDL017BUG4092
      ********************                                          CDL017BUG4092
      ***Default*payment*limited*instructions                       CDL017BUG4092
     C**********           SELEC                                    CDL017BUG4092
     C********** HKPSTM    WHEQ 0                                   CDL017BUG4092
     C**********           MOVEL*BLANKS   HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 1                                   CDL017BUG4092
     C**********           MOVEL'TELX'    HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 2                                   CDL017BUG4092
     C**********           MOVEL'CSENT'   HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 3                                   CDL017BUG4092
     C**********           MOVEL'COMP'    HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 4                                   CDL017BUG4092
     C**********           MOVEL'PCURR'   HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 5                                   CDL017BUG4092
     C**********           MOVEL'MACC'    HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 6                                   CDL017BUG4092
     C**********           MOVEL'SUSP'    HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 7                                   CDL017BUG4092
     C**********           MOVEL'CHIPS'   HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 8                                   CDL017BUG4092
     C**********           MOVEL'SWIFT'   HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 12                                  CDL017BUG4092
     C**********           MOVEL'CCOLL'   HKDOPM                    CDL017BUG4092
     C********** HKPSTM    WHEQ 14                                  CDL017BUG4092
     C**********           MOVEL'CURR'    HKDOPM                    CDL017BUG4092
     C**********           ENDSL                                    CDL017BUG4092
      **********                                                    CDL017BUG4092
      **Access*SDNOSTPD*to*get*nostro*shortname                     CDL017BUG4092
     C********** HKPSTM    IFEQ 1                                   CDL017BUG4092
     C********** HKPSTM    OREQ 2                                   CDL017BUG4092
     C********** HKPSTM    OREQ 7                                   CDL017BUG4092
     C********** HKPSTM    OREQ 8                                   CDL017BUG4092
     C********** HKPSTM    OREQ 12                                  CDL017BUG4092
     C**********           CALL 'AONOSTR0'                          CDL017BUG4092
     C**********           PARM '*DBERR ' @RTCD   7                 CDL017BUG4092
     C**********           PARM '*KEY   ' @OPTN   7                 CDL017BUG4092
     C**********           PARM *BLANKS   @KEYA   6                 CDL017BUG4092
     C**********           PARM HKCCY     @KEYB   3                 CDL017BUG4092
     C**********           PARM *BLANKS   @KEYC   4                 CDL017BUG4092
     C**********           PARM *BLANKS   @KEYD   2                 CDL017BUG4092
     C**********           PARM HKPONS    @KEYE   2                 CDL017BUG4092
     C**********           PARM *BLANKS   @KEYF   3                 CDL017BUG4092
     C**********           PARM *BLANKS   @KEYG  10                 CDL017BUG4092
     C**********           PARM *BLANKS   @KEYH   1                 CDL017BUG4092
     C********** SDNOST    PARM SDNOST    DSFDY                     CDL017BUG4092
     C**********           MOVE A7NOSN    HKDOPI                    CDL017BUG4092
     C**********           ELSE                                     CDL017BUG4092
     C**********           MOVELHKPONS    HKDOPI                    CDL017BUG4092
     C**********           ENDIF                                    CDL017BUG4092
     C*                                                                   CDL017
     C**  Convert new maturity date                                       CDL017
     C                     Z-ADDMDAT      HKMATD                          BUG4092
     C                     Z-ADDMDAT      @@DAYN                          CDL017
     C                     EXSR ZDATE9                                    CDL017
     C                     Z-ADD@@Z71D    HKMDDD                          CDL017
     C                     Z-ADD@@Z71M    HKMDMM                          CDL017
     C                     Z-ADD@@YR      HKMDYY                          CDL017
      *                                                                   CDL017
      **  Cancellation date and penalty pay/receive indicator             CDL017
     C                     MOVE FSCAND    HKCAND                          CDL017
     C                     MOVE FSPNPR    HKPNPR                          CDL017
     C                     Z-ADDPENA      HKPENA                                           MD024467A
      *                                                                   CDL017
     C                     ENDIF                                          CDL017
      *                                                                   CDL017
      ** Update Total Interest field of MMDELDPP                                              260340
      *                                                                                     AR937172
     C           HKMTTI    IFGE 0                                                           AR937172
     C                     Z-ADDTOTI      HKMTTI                                              260340
     C                     ELSE                                                             AR937172
     C                     Z-SUBTOTI      HKMTTI                                            AR937172
     C                     ENDIF                                                            AR937172
     C*
     C**  UPDATE PF/MMDELDPP
     C**********           EXCPTDELD                       *1                               AR755195
     C                     END                             E1
     C                     EXCPTDELD                                                        AR755195
     C*
     C           #BAA9     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BAB - PREPARE AND UPDATE MMDENBPP - NA'S BOUGHT             *
     C*                                                                  *
     C*     CALLED BY  : #BA,                                            *
     C*                                                                  *
     C******CALLS******:*ZA0710***CONVERT*MIDAS*DAY*NO.*TO*YYYYMMDD*******S01328
     C*     CALLS      : ZDATE9   CONVERT MIDAS DAY NO. TO YYYYMMDD      *S01328
     C*                                                                  *
     C*     WORK FIELDS:                                                 *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BAB      BEGSR
     C*
     C**  ONLY THE FOLLOWING FIELDS ARE UPDATED FROM THE MIDAS DEALS FILE
     C*
     C*
     C**  CONVERT DATES FROM MIDAS DAY NO. TO RELEVENT FORMAT
     C                     Z-ADDSLID      @@DAYN
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@Z71D    HLLIDD
     C                     Z-ADD@@Z71M    HLLIMM
     C                     Z-ADD@@YR      HLLIYY
     C*
     C                     Z-ADDNIDT      @@DAYN
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@Z71D    HLNIDD
     C                     Z-ADD@@Z71M    HLNIMM
     C                     Z-ADD@@YR      HLNIYY
     C                     Z-ADDNIDT      HLNIPD                                              262922
     C*
     C**  IF MIDAS RECORD HAS A RECORD ID OF 'M' UPDATE DRS DEAL STATUS
     C**  WITH 'M'
     C           RECI      IFEQ 'M'                        B1
     C                     MOVE 'M'       HLDSTS           *1
     C                     END                             E1
     C*
     C                     Z-ADDIACD      @@DAYN
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@Z71D    HLIADD
     C                     Z-ADD@@Z71M    HLIAMM
     C                     Z-ADD@@YR      HLIAYY
     C*
     C                     MOVE IPFR      HLIPFQ
     C                     Z-ADDINTF      HLIPDM
     C*
     C**  CALCULATE NA NET VALUE.
     C**  IF NA IS INTEREST BEARING CALCULATE NET VALUE AS:
     C**  NET VALUE = FACE VALUE + UNPAID INTEREST
     C           DTYP      IFEQ 'C1'                       B1             ME1350
     C           DTYP      OREQ 'C2'                       *1             ME1350
     C           DTYP      OREQ 'BP'                       *1             ME1350
     C           DTYP      OREQ 'BD'                       *1             ME1350
     C                     Z-ADDFVAL      HLNANV           *1             ME1350
     C                     ADD  AITC      HLNANV           *1             ME1350
     C                     ADD  AIAN      HLNANV           *1             ME1350
     C                     SUB  AIPD      HLNANV           *1             ME1350
     C                     SUB  AIAP      HLNANV           *1             ME1350
     C*
     C**  ...... NET VALUE = FACE VALUE + DISCOUNT AMOUNT
     C                     ELSE                            X1             ME1350
     C                     Z-ADDFVAL      HLNANV           *1             ME1350
     C                     ADD  DPTD      HLNANV           *1             ME1350
     C                     SUB  DISA      HLNANV           *1             ME1350
     C                     END                             E1             ME1350
      *                                                                   S01378
      ** Parcelled NA's purchased also have following fields updated      S01378
      ** (reduced) by DL0280 to reflect any NA's sold entered as they     S01378
      ** reach their value date.                                          S01378
     C                     Z-ADDPSZE      HLPSZE                          S01378
     C                     Z-ADDNSLD      HLNSLD                          S01378
     C                     Z-SUBPUPR      HLAMNP                          S01378
     C                     Z-ADDTOTI      HLMTTI                                              222986
     C                     Z-ADDFVAL      HLFVAL                          S01378
     C                     Z-ADDDISA      HLDCAM                          S01378
     C*
     C**  UPDATE PF/MMDENBPP
     C                     EXCPTDENB
     C*
     C           #BAB9     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BAC - PREPARE AND UPDATE MMDENSPP - NA'S SOLD               *
     C*                                                                  *
     C*     CALLED BY  : #BA,                                            *
     C*                                                                  *
     C******CALLS******:*ZA0710***CONVERT*MIDAS*DAY*NO.*TO*YYYYMMDD*******S01328
     C*     CALLS      : ZDATE9   CONVERT MIDAS DAY NO. TO YYYYMMDD      *S01328
     C*                                                                  *
     C*     WORK FIELDS:                                                 *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BAC      BEGSR
     C*
     C**  ONLY THE FOLLOWING FIELDS ARE UPDATED FROM THE MIDAS DEALS FILE
     C*
     C*
     C**  CONVERT DATES FROM MIDAS DAY NO. TO RELEVENT FORMAT
     C                     Z-ADDSLID      @@DAYN
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@Z71D    HMLIDD
     C                     Z-ADD@@Z71M    HMLIMM
     C                     Z-ADD@@YR      HMLIYY
     C*
     C*****************    Z-ADDNIPD      @@DAYN                          S01136
     C*****************    EXSR ZA0710                                    S01136
     C*****************    Z-ADD@@Z71D    HMNIDD                          S01136
     C*****************    Z-ADD@@Z71M    HMNIMM                          S01136
     C*****************    Z-ADD@@YR      HMNIYY                          S01136
     C*                                                                   S01136
     C** NEXT INTEREST PAY DATE NOT RELEVANT TO N/A'S SOLD                S01136
     C                     Z-ADD0         HMNIDD                          S01136
     C                     Z-ADD0         HMNIMM                          S01136
     C                     Z-ADD0         HMNIYY                          S01136
     C*
     C**  IF MIDAS RECORD HAS A RECORD ID OF 'M' UPDATE DRS DEAL STATUS
     C**  WITH 'M'
     C           RECI      IFEQ 'M'                        B1
     C                     MOVE 'M'       HMDSTS           *1
     C                     END                             E1
     C*
     C**  FOR NA'S SOLD ACCESS THE RELATED NA BOUGHT TO UPDATE RELATED
     C**  FIELDS ON PF/MMDENSPP - DB ERROR IF NOT FOUND
     C                     MOVE HMDADN    @DEALN  60
     C           @DLKY     CHAINDEALS                61
     C           *IN61     IFEQ '1'                        B1
     C           *LOCK     IN   LDA                                       S01280
     C                     Z-ADD002       DBASE            ***************
     C                     MOVEL'DEALS'   DBFILE           * DB ERROR 02 *
     C                     MOVEL@DEALN    DBKEY            ***************
     C                     MOVEL'MM0101'  DBPGM                           S01280
     C                     MOVE 'E'       @TERM            *1
     C                     DUMP                            *1
     C                     OUT  LDA                                       S01280
     C                     GOTO #BAC9                      *1
     C                     END                             E1
     C*
     C                     MOVE HLIPFQ    HMIPFQ
     C                     Z-ADDHLIPDM    HMIPDM
     C*
     C*
     C**  UPDATE PF/MMDENSPP
     C                     EXCPTDENS
     C*
     C           #BAC9     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BAG - DELETE RELEVENT MM DEALS RECORD                       *
     C*                                                                  *
     C*     CALLED BY  : #BA,                                            *
     C*                                                                  *
     C*     CALLS      :                                                 *
     C*                                                                  *
     C*     WORK FIELDS: @DLPF    MM DEAL FORMAT NAME           (8A)     *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BAG      BEGSR
     C*
     C**  DELETE RELEVENT FORMAT
     C*
     C           @DLPF     IFEQ 'MMDELDP0'                 B1 LOANS/DEP
     C           HKDSTS    IFNE 'C'                                                          BUG3838
     C           HKDDLT    OREQ 'D'                                                          BUG3838
     C                     DELETMMDELDP0                   *1
      *                                                                                      252554A
      ** Delete the corresponding record in the UDF files.                                   252554A
      *                                                                                      252554A
     C                     Z-ADDHKDN38    PDDLNO  60                                        AR588416
     C                     CALL 'MMDELUDF'                                                   252554A
     C**********           PARM           HKDN38                                    252554A AR588416
     C                     PARM           PDDLNO                                            AR588416
     C                     PARM 'LDNI'    #API    4                                          252554A
      *                                                                                      252554A
     C                     EXSR DELEXT                                                      BUG10705
     C                     ENDIF                                                             BUG3838
     C/COPY WNCPYSRC,MM0101C009
      *                                                                                       CDL033
      ** Remove records of deleted CF deal in files DLFRSCPD                                  CDL033
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C                     EXSR CKDEAL                                                        CDL033
     C           @FXT      IFEQ *ON                                                           CDL033
     C           HKMTYP    OREQ 'CF'                                                          CDL033
      *                                                                                       CDL033
     C           HKDN38    SETLLDLFRSCL0                                                      CDL033
     C           HKDN38    READEDLFRSCL0                 62                                   CDL033
     C           *IN62     DOWEQ*OFF                                                          CDL033
     C                     DELETDLFRSCL0                                                      CDL033
     C           HKDN38    READEDLFRSCL0                 62                                   CDL033
     C                     ENDDO                                                              CDL033
      *                                                                                       CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
     C/COPY WNCPYSRC,MMH00195
      *                                                                                       CDL033
     C                     END                             E1
     C           @DLPF     IFEQ 'MMDENBP0'                 B1 N.A.S BOUGHT
     C                     DELETMMDENBP0                   *1
      *                                                                                      252554A
      ** Delete the corresponding record in the UDF files.                                   252554A
      *                                                                                      252554A
     C                     Z-ADDHLDN38    PDDLNO                                            AR588416
     C                     CALL 'MMDELUDF'                                                   252554A
     C**********           PARM           HLDN38                                    252554A AR588416
     C                     PARM           PDDLNO                                            AR588416
     C                     PARM 'NASP'    #API    4                                          252554A
      *                                                                                      252554A
     C/COPY WNCPYSRC,MM0101C011
     C                     END                             E1
     C           @DLPF     IFEQ 'MMDENSP0'                 B1 N.A.S SOLD
     C                     DELETMMDENSP0                   *1
      *                                                                                      252554A
      ** Delete the corresponding record in the UDF files.                                   252554A
      *                                                                                      252554A
     C                     Z-ADDHMDN38    PDDLNO                                            AR588416
     C                     CALL 'MMDELUDF'                                                   252554A
     C**********           PARM           HMDN38                                    252554A AR588416
     C                     PARM           PDDLNO                                            AR588416
     C                     PARM 'NASS'    #API    4                                          252554A
      *                                                                                      252554A
     C                     END                             E1
     C*
     C           #BAG9     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BB - MM DEAM PROCESSING                                     *
     C*                                                                  *
     C*     CALLED BY  : #B                                              *
     C*                                                                  *
     C******CALLS      : #BBA - SELECT MM DEAMS RECORD DELETE/ENQUIRIES  *S01150
     C*     CALLS      : ZDAT10 - CONVERTS YYYYMMDD TO MIDAS DAY NUMBER  *S01328
     C*                                                                  *
     C*     WORK FIELDS: @DNSAV   SAVED DEAL NUMBER             (6N)     *
     C*                  @DLNO    DEAL NUMBER                   (6N)     *
     C*                  @VDAT    VALUE DATE                    (6N)     *
     C*                  @DASN    DEAL AMEND SEQ. NO.           (6N)     *
     C*                  @DMKY    DEAM KEY LIST                 KLIST    *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BB       BEGSR
     C*
     C**  READ SEQUENTIALLY THROUGH MM DEAMS FILE
     C           *IN60     DOUEQ'1'                        B1
     C                     READ MMDAMULL                 60*1
     C           *IN60     IFEQ '0'                        B*2
     C*
     C**  ACCESS MIDAS DEAMS FILE TO SETUP STANDARD DEAMS FIELDS.
     C**  IF A DEAMS RECORD IS NOT FOUND DELETE MMDAMULL RECORD.
     C*
     C***********          Z-ADDHNVDYY    @@YYYY                          056095
     C***********          Z-ADDHNVDMM    @@MM                            056095
     C***********          Z-ADDHNVDDD    @@DD                            056095
     C*********************EXSR ZA0680                                    S01328
     C***********          Z-ADD@@DTIN    ZZDTIN                    S01328056095
     C                     Z-ADDHNVDYY    ZWYYYY                          056095
     C                     Z-ADDHNVDMM    ZWMTH                           056095
     C                     Z-ADDHNVDDD    ZWDAY                           056095
     C                     EXSR ZDAT10                                    S01328
     C*
     C           @DMKY     KLIST
     C                     KFLD           @DLNO   60
     C                     KFLD           @VDAT   50
     C                     KFLD           @DASN   30
     C*
     C                     Z-ADDHNDA38    @DLNO
     C*********************Z-ADD@@MDNO    @VDAT                           S01328
     C                     Z-ADDZZMDNO    @VDAT                           S01328
     C                     Z-ADDHNDS38    @DASN
     C           @DMKY     CHAINDEAMS                61
     C           *IN61     IFEQ '1'                        B**3
     C                     DELETMMDEAMP0                   ***3
     C/COPY WNCPYSRC,MM0101C003
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #BB9      ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
      *
      *                             PROCESSES
      *
      * P/MM0101,02 - Interest Rates Period Dates Update (MMP0356)
      *
      * 1. Set lower limits on file LF/FDINTRLL
      *
      * 2. Read file LF/FDINTRLL
      *
      * 3. If change of currency:
      *
      * 4. Set lower limits on file LF/FDINTRLL
      *
      *     4.1 Access spot date for relevent currency held in arrays that
      *         were set up in P/MM0101,01
      *
      * 5. Set up details for MM1003 (Period date determine)
      *
      * 6. Execute MM1003
      *
      * 7. If data base error:
      *
      *     7.1 Set up data base error details
      *
      *     7.2 Go to end of subroutine
      *
      * Else
      *
      *     7.3 Update FDINTRILL as per R/MM0101,
      *
      * 8. Go to step 2
      *
      * 9. End of subroutine
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*  #BC - THIS SUBROUTINE DETERMINES THE PERIOD DATES FOR        *
     C*********RECORDS*ON FILE FDINTRLL (P/MM0101,02)                 *   E26582
     C*        RECORDS ON FILE FDINTRLL AND DLMMDFL2 (P/MM0101,02)    *   E26582
     C*                                                               *
     C*  CALLED BY:  #B                                               *
     C*                                                               *
     C*  CALLS:      MM1003                                           *
     C*                                                               *
     C*  USES:       @@PCCY    CURRENCY CODE ON PREVIOUS RECORD       *
     C*              @@A       ARRAY HOLDING CURRENCY CODES           *
     C*              @@B       ARRAY HOLDING SPOT DATES               *
     C*              @I        INDEX FOR ARRAYS @@A AND @@B           *
     C*                                                               *
     C*              @@SPOT    SPOT DATE INPUT PARAMETER TO MM1003    *
     C*              @@CCY     CURRENCY INPUT PARAMETER TO MM1003     *
     C*              @@PTYP    PERIOD TYPE INPUT PARAMETER TO MM1003  *
     C*              @@PNUM    PERIOD NUMBER INPUT PARAMETER TO MM1003*
     C*              @@PDAT    PERIOD DATE PARAMETER RETURNED FROM    *
     C*                        MM1003                                 *
     C*                                                               *
     C*              *IN70     DATA BASE ERROR ON FDCCYTLL            *
     C****************IN60     END OF FILE INDICATOR FOR FDINTRLL     *   E26582
     C*              *IN60     END OF FILE IND FOR FDINTRLL/DLMMDFL2  *   E26582
     C*                                                               *
     C*****************************************************************
     C*
     C           #BC       BEGSR
     C*
     C**  SET UP KEY TO ACCESS FDINTRLL
     C                     MOVE *BLANKS   @@SKEY  3
     C*
     C**  SET LOWER LIMITS ON FILE FDINTRLL
     C           @@SKEY    SETLLFDINTRLL
     C*
     C**  INITIALISE CURRENCY WORK FIELD AND INDEX FOR ARRAYS
     C                     MOVE *BLANKS   @@PCCY  3
     C                     Z-ADD1         @I      30
     C*
     C**  INITIALISE INDICATOR
     C                     MOVE '0'       *IN60
     C*
     C**  READ FILE FDINTRLL
     C           *IN60     DOWEQ'0'                        B1
     C*
     C                     READ FDINTRLL                 60*1
     C*
     C**  IF *IN60 ON, THEN END OF FILE
     C           *IN60     IFEQ '0'                        B*2
     C*** AND ONLY PROCESS IF A LIVE RECORD                               E21611
     C           HWDLTF    ANDEQ*BLANK                     **2            E21611
     C*
     C*** IF THE PERIOD DATE TYPE IS 'YEAR' THEN READ DISCOUNT FACTORS    E26582
     C*** FILE FOR CORRESPONDING RECORD.  IF THE CURRENCY AND PERIOD      E26582
     C*** NUMBER DO NOT MATCH THOSE OF FDINTRPP, OR IF END OF FILE        E26582
     C*** ENCOUNTERED, THEN PROCESS A DATABASE ERROR.                     E26582
     C           HWTPRD    IFEQ 'Y'                                       E26582
     C                     READ DLMMDFL2                 60               E26582
     C           DFCCY     IFNE HWCCY                                     E26582
     C           DFPRD     ORNE HWPRD                                     E26582
     C           *IN60     OREQ '1'                                       E26582
     C           *LOCK     IN   LDA                                       E26582
     C                     MOVEL'DLMMDFL2'DBFILE                          E26582
     C                     MOVELHWCCY     DBKEY                           E26582
     C                     MOVEL'MM0101'  DBPGM            ***************E26582
     C                     Z-ADD008       DBASE            * DBERROR 008 *E26582
     C                     MOVE 'E'       @TERM            ***************E26582
     C                     OUT  LDA                                       E26582
     C                     DUMP                                           E26582
     C                     GOTO #BC9                                      E26582
     C                     END                                            E26582
     C                     END                                            E26582
     C*                                                                   E26582
     C**  IF CHANGE OF CURRENCY, ACCESS SPOT DATE FOR RELEVANT
     C**  CURRENCY
     C           HWCCY     IFNE @@PCCY                     B**3
     C           HWCCY     LOKUP@@A,@I                   70***3
     C*
     C**  IF CURRENCY NOT FOUND, THEN DATA BASE ERROR HAS OCCURRED
     C           *IN70     IFEQ '0'                        B***4
     C           *LOCK     IN   LDA                                       S01280
     C**********           MOVEL'FDCCYTLL'DBFILE           ****4          S01280
     C                     MOVEL'SDCURRL1'DBFILE           ****4          S01280
     C                     MOVELHWCCY     DBKEY            ****4
     C                     MOVEL'MM0101'  DBPGM            ***************
     C                     Z-ADD003       DBASE            * DBERROR 003 *
     C                     MOVE 'E'       @TERM            ***************
     C                     OUT  LDA                                       S01280
     C                     DUMP                            ****4
     C                     GOTO #BC9                       ****4
     C                     END                             E***4
     C*
     C**  SET UP CURRENCY AND SPOT DATE INPUT PARAMETERS FOR
     C**  SUBROUTINE MM1003
     C                     MOVE @@B,@I    @@SPOT           ***3
     C*********************MOVE HWCCY     @@CCY   3        ***3           S01195
     C                     MOVE HWCCY     ZCCY    3        ***3           S01195
     C*
     C**  RESET *IN70
     C                     MOVE '0'       *IN70            ***3
     C*
     C**  STORE CURRENCY CODE
     C                     MOVE HWCCY     @@PCCY           ***3
     C*
     C                     END                             E**3
     C*
     C**  SET UP PERIOD TYPE INPUT PARAMETER FOR SUBROUTINE MM1003
     C                     MOVE HWTPRD    @@PTYP  1        **2
     C*
     C**  SET UP PERIOD NUMBER INPUT PARAMETER FOR SUBROUTINE
     C**  MM1003
     C                     Z-ADDHWPRD     @@PNUM           **2
     C*
     C**  IF PERIOD TYPE IS 'D', SUBTRACT 2 FROM PERIOD NUMBER
     C           HWTPRD    IFEQ 'D'                        B**3
     C                     SUB  2         @@PNUM           ***3
     C                     END                             E**3
     C*
     C**  EXECUTE SUBROUTINE MM1003
     C                     EXSR MM1003                     **2
     C*
     C**  UPDATE FILE FDINTRLL
     C                     MOVE @@PDAT    HWPRDD           **2
     C                     MOVE @@PRDN    HWPRDN           **2            S01328
     C*
     C                     EXCPTUPDPDD                     **2
     C*                                                                   E26582
     C*** IF THE PERIOD DATE TYPE IS 'YEAR' THEN UPDATE THE DISCOUNT      E26582
     C*** FACTORS FILE FOR CORRESPONDING RECORD.                          E26582
     C           HWTPRD    IFEQ 'Y'                                       E26582
     C                     MOVE @@PRDN    DFPRDN                          E26582
     C                     EXCPTUPDPDE                                    E26582
     C                     END                                            E26582
     C*
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #BC9      ENDSR
     C*
     C********************************************************************
     C/EJECT                                                              S01328
     C*****************************************************************   S01328
     C*                                                               *   S01328
     C*  #BD - THIS SUBROUTINE DETERMINES THE PERIOD DATES FOR        *   S01328
     C*        RECORDS ON FILE DLFRARL1 - FRA RATES TABLE             *   S01328
     C*                                                               *   S01328
     C*  CALLED BY:  #B                                               *   S01328
     C*                                                               *   S01328
     C*  CALLS:      ZCPD - CALCULATE A PERIOD DATE                   *   S01328
     C*                                                               *   S01328
     C*  USES:       @@PCCY    CURRENCY CODE ON PREVIOUS RECORD       *   S01328
     C*              @@KFI     KLIST FOR FRA AND IRS RATES TABLES     *   S01328
     C*                                                               *   S01328
     C*              BJRDNB    RUN DAY NUMBER FROM SDBANKPD           *   S01328
     C*              BJCYCD    LOCAL CURRENCY FROM SDBANKPD           *   S01328
     C*                                                               *   S01328
     C*              FRDLTF    INPUT FROM DLFRARL1 - DELETE FLAG      *   S01328
     C*              FRCCY     INPUT FROM DLFRARL1 - CURRENCY         *   S01328
     C*              FRPDYR    INPUT FROM DLFRARL1 - NUMBER OF YEARS  *   S01328
     C*              FRPDMN    INPUT FROM DLFRARL1 - NUMBER OF MONTHS *   S01328
     C*              FRPDDY    INPUT FROM DLFRARL1 - NUMBER OF DAYS   *   S01328
     C*              FRVMDN    OUTPUT TO DLFRARL1 - VALUE DATE (5,0)  *   S01328
     C*              FRVDMY    OUTPUT TO DLFRARL1 - VALUE DATE (7A)   *   S01328
     C*                                                               *   S01328
     C*              ZINDT     INPUT TO ZCPD - SPOT DATE              *   S01328
     C*              ZNYR      INPUT TO ZCPD - NUMBER OF YEARS        *   S01328
     C*              ZNMN      INPUT TO ZCPD - NUMBER OF MAONTHS      *   S01328
     C*              ZNDY      INPUT TO ZCPD - NUMBER OF DAYS         *   S01328
     C*              ZPDNO     OUTPUT FROM ZCPD - PERIOD DATE (5,0)   *   S01328
     C*              ZPDTE     OUTPUT FROM ZCPD - PERIOD DATE (7A)    *   S01328
     C*                                                               *   S01328
     C*              *IN60     END OF FILE INDICATOR FOR DLFRARL1     *   S01328
     C*                                                               *   S01328
     C*****************************************************************   S01328
     C*                                                                   S01328
     C           #BD       BEGSR                                          S01328
     C*                                                                   S01328
     C**  SET LOWER LIMITS ON FRA RATES TABLE                             S01328
     C           @@KFI     SETLLDLFRARL1                                  S01328
     C*                                                                   S01328
     C**  INITIALISE INDICATOR                                            S01328
     C                     MOVE '0'       *IN60                           S01328
     C*                                                                   S01328
     C**  READ FRA RATES TABLE FOR EACH LIVE RECORD ON FILE               S01328
     C           *IN60     DOWEQ'0'                                       S01328
     C*                                                                   S01328
     C                     READ DLFRARL1                 60               S01328
     C*                                                                   S01328
     C**  IF *IN60 OFF (NOT END OF FILE), AND RECORD LIVE THEN            S01328
     C           *IN60     IFEQ '0'                                       S01328
     C           FRDLTF    ANDEQ*BLANK                                    S01328
     C*                                                                   S01328
     C**  SET UP NUMBER OF YEARS, MONTHS AND DAYS FOR SR ZCPD             S01328
     C                     MOVELFRPDYR    ZNYR                            S01328
     C                     MOVELFRPDMN    ZNMN                            S01328
     C                     MOVELFRPDDY    ZNDY                            S01328
     C*                                                                   S01328
     C**  IF CHANGE OF CURRENCY - SET UP CURRENCY AND SPOT FOR ZCPD       S01328
     C           FRCCY     IFNE @@PCCY                                    S01328
     C*                                                                   S01328
     C**  IF CURRENCY THE SAME AS THE LOCAL CURRENCY SPOT DATE IS TODAY   S01328
     C           FRCCY     IFEQ BJCYCD                                    S01328
     C                     Z-ADDBJRDNB    ZINDT                           S01328
     C                     ELSE                                           S01328
     C*                                                                   S01328
     C****ELSE*SPOT*DATE*IS*TWO*DAYS*FROM*TODAY******************* S01328 E26582
     C***********BJRDNB    ADD  2         ZINDT                    S01328 E26582
      *                                                                   E26582
     C**  ELSE SPOT DATE IS TWO WORKING DAYS FROM TODAY                   E26582
     C                     MOVE FRCCY     ZCCY                            E26582
     C                     MOVE *BLANKS   ZLOC                            E26582
     C                     Z-ADDBJRDNB    ZDAYNO                          E26582
     C                     Z-ADD2         ZNRDYS                          E26582
     C                     EXSR ZFWDT                                     E26582
     C                     Z-ADDZDYNBR    ZINDT                           E26582
     C                     END                                            S01328
     C**  STORE CURRENCY                                                  S01328
     C                     MOVE FRCCY     @@PCCY                          S01328
     C                     END                                            S01328
     C*                                                                   S01328
     C**  CALCULATE THE PERIOD DATE                                       S01328
     C                     EXSR ZCPD                                      S01328
     C*                                                                   S01328
     C**  UPDATE FRA RATES TABLE WITH PERIOD DATE                         S01328
     C                     MOVE ZPDNO     FRVMDN                          S01328
     C                     MOVE ZPDTE     FRVDMY                          S01328
     C*                                                                   S01328
     C                     EXCPTUPDPDF                                    S01328
     C*                                                                   S01328
     C                     END                                            S01328
     C*                                                                   S01328
     C                     END                                            S01328
     C*                                                                   S01328
     C           #BD9      ENDSR                                          S01328
     C*                                                                   S01328
     C*****************************************************************   S01328
     C/EJECT                                                              S01328
     C*****************************************************************   S01328
     C*                                                               *   S01328
     C*  #BE - THIS SUBROUTINE DETERMINES THE PERIOD DATES FOR        *   S01328
     C*        RECORDS ON FILE DLIRSRL1 - IRS RATES TABLE             *   S01328
     C*                                                               *   S01328
     C*  CALLED BY:  #B                                               *   S01328
     C*                                                               *   S01328
     C*  CALLS:      ZCPD - CALCULATE A PERIOD DATE                   *   S01328
     C*                                                               *   S01328
     C*  USES:       @@PCCY    CURRENCY CODE ON PREVIOUS RECORD       *   S01328
     C*              @@KFI     KLIST FOR FRA AND IRS RATES TABLES     *   S01328
     C*                                                               *   S01328
     C*              BJRDNB    RUN DAY NUMBER FROM SDBANKPD           *   S01328
     C*              BJCYCD    LOCAL CURRENCY FROM SDBANKPD           *   S01328
     C*                                                               *   S01328
     C*              IRDLTF    INPUT FROM DLIRSRL1 - DELETE FLAG      *   S01328
     C*              IRCCY     INPUT FROM DLIRSRL1 - CURRENCY         *   S01328
     C*              IRPDYR    INPUT FROM DLIRSRL1 - NUMBER OF YEARS  *   S01328
     C*              IRPDMN    INPUT FROM DLIRSRL1 - NUMBER OF MONTHS *   S01328
     C*              IRPDDY    INPUT FROM DLIRSRL1 - NUMBER OF DAYS   *   S01328
     C*              IRMMDN    OUTPUT TO DLIRSRL1 - VALUE DATE (5,0)  *   S01328
     C*              IRMDMY    OUTPUT TO DLIRSRL1 - VALUE DATE (7A)   *   S01328
     C*                                                               *   S01328
     C*              ZINDT     INPUT TO ZCPD - SPOT DATE              *   S01328
     C*              ZNYR      INPUT TO ZCPD - NUMBER OF YEARS        *   S01328
     C*              ZNMN      INPUT TO ZCPD - NUMBER OF MAONTHS      *   S01328
     C*              ZNDY      INPUT TO ZCPD - NUMBER OF DAYS         *   S01328
     C*              ZPDNO     OUTPUT FROM ZCPD - PERIOD DATE (5,0)   *   S01328
     C*              ZPDTE     OUTPUT FROM ZCPD - PERIOD DATE (7A)    *   S01328
     C*                                                               *   S01328
     C*              *IN60     END OF FILE INDICATOR FOR DLIRSRL1     *   S01328
     C*                                                               *   S01328
     C*****************************************************************   S01328
     C*                                                                   S01328
     C           #BE       BEGSR                                          S01328
     C*                                                                   S01328
     C**  SET LOWER LIMITS ON IRS RATES TABLE                             S01328
     C           @@KFI     SETLLDLIRSRL1                                  S01328
     C*                                                                   S01328
     C**  INITIALISE INDICATOR                                            S01328
     C                     MOVE '0'       *IN60                           S01328
     C*                                                                   S01328
     C**  READ IRS RATES TABLE FOR EACH LIVE RECORD ON FILE               S01328
     C           *IN60     DOWEQ'0'                                       S01328
     C*                                                                   S01328
     C                     READ DLIRSRL1                 60               S01328
     C*                                                                   S01328
     C**  IF *IN60 OFF (NOT END OF FILE), AND RECORD LIVE THEN            S01328
     C           *IN60     IFEQ '0'                                       S01328
     C           IRDLTF    ANDEQ*BLANK                                    S01328
     C*                                                                   S01328
     C**  SET UP NUMBER OF YEARS, MONTHS AND DAYS FOR SR ZCPD             S01328
     C                     MOVELIRPDYR    ZNYR                            S01328
     C                     MOVELIRPDMN    ZNMN                            S01328
     C                     MOVELIRPDDY    ZNDY                            S01328
     C*                                                                   S01328
     C**  IF CHANGE OF CURRENCY - SET UP CURRENCY AND SPOT FOR ZCPD       S01328
     C           IRCCY     IFNE @@PCCY                                    S01328
     C*                                                                   S01328
     C**  IF CURRENCY THE SAME AS THE LOCAL CURRENCY SPOT DATE IS TODAY   S01328
     C           IRCCY     IFEQ BJCYCD                                    S01328
     C                     Z-ADDBJRDNB    ZINDT                           S01328
     C                     ELSE                                           S01328
     C*                                                                   S01328
     C****ELSE*SPOT*DATE*IS*TWO*DAYS*FROM*TODAY******************* S01328 E26582
     C***********BJRDNB    ADD  2         ZINDT                    S01328 E26582
      *                                                                   E26582
     C**  ELSE SPOT DATE IS TWO WORKING DAYS FROM TODAY                   E26582
     C                     MOVE IRCCY     ZCCY                            E26582
     C                     MOVE *BLANKS   ZLOC                            E26582
     C                     Z-ADDBJRDNB    ZDAYNO                          E26582
     C                     Z-ADD2         ZNRDYS                          E26582
     C                     EXSR ZFWDT                                     E26582
     C                     Z-ADDZDYNBR    ZINDT                           E26582
     C                     END                                            S01328
     C**  STORE CURRENCY                                                  S01328
     C                     MOVE IRCCY     @@PCCY                          S01328
     C                     END                                            S01328
     C*                                                                   S01328
     C**  CALCULATE THE PERIOD DATE                                       S01328
     C                     EXSR ZCPD                                      S01328
     C*                                                                   S01328
     C**  UPDATE FRA RATES TABLE WITH PERIOD DATE                         S01328
     C                     MOVE ZPDNO     IRMMDN                          S01328
     C                     MOVE ZPDTE     IRMDMY                          S01328
     C*                                                                   S01328
     C                     EXCPTUPDPDI                                    S01328
     C*                                                                   S01328
     C                     END                                            S01328
     C*                                                                   S01328
     C                     END                                            S01328
     C*                                                                   S01328
     C           #BE9      ENDSR                                          S01328
     C*                                                                   S01328
     C*****************************************************************   S01328
     C/EJECT
     C*****************************************************************   CIR001
     C*                                                               *   CIR001
     C*  #BF - THIS SUBROUTINE DETERMINES THE PERIOD DATES FOR        *   CIR001
     C*        RECORDS ON FILE DLSWPRL1 - SWAP RATES TABLE -          *   CIR001
     C*        AND FILE DLIRDFL1 - DISCOUNT FACTORS TABLE             *   CIR001
     C*                                                               *   CIR001
     C*  CALLED BY:  #B                                               *   CIR001
     C*                                                               *   CIR001
     C*  CALLS:      ZCPD - CALCULATE A PERIOD DATE                   *   CIR001
     C*                                                               *   CIR001
     C*  USES:       @@PCCY    CURRENCY CODE ON PREVIOUS RECORD       *   CIR001
     C*                                                               *   CIR001
     C*              BJRDNB    RUN DAY NUMBER FROM SDBANKPD           *   CIR001
     C*              BJCYCD    LOCAL CURRENCY FROM SDBANKPD           *   CIR001
     C*                                                               *   CIR001
     C*              IRDLTF    INPUT FROM DLSWPRL1 - DELETE FLAG      *   CIR001
     C*              IRCCY     INPUT FROM DLSWPRL1 - CURRENCY         *   CIR001
     C*              IRPDYR    INPUT FROM DLSWPRL1 - NUMBER OF YEARS  *   CIR001
     C*              IRPDMN    INPUT FROM DLSWPRL1 - NUMBER OF MONTHS *   CIR001
     C*              IRPDDY    INPUT FROM DLSWPRL1 - NUMBER OF DAYS   *   CIR001
     C*              IRMMDN    OUTPUT TO DLSWPRL1 - VALUE DATE (5,0)  *   CIR001
     C*              IRMDMY    OUTPUT TO DLSWPRL1 - VALUE DATE (7A)   *   CIR001
     C*                                                               *   CIR001
     C*              ZINDT     INPUT TO ZCPD - SPOT DATE              *   CIR001
     C*              ZNYR      INPUT TO ZCPD - NUMBER OF YEARS        *   CIR001
     C*              ZNMN      INPUT TO ZCPD - NUMBER OF MAONTHS      *   CIR001
     C*              ZNDY      INPUT TO ZCPD - NUMBER OF DAYS         *   CIR001
     C*              ZPDNO     OUTPUT FROM ZCPD - PERIOD DATE (5,0)   *   CIR001
     C*              ZPDTE     OUTPUT FROM ZCPD - PERIOD DATE (7A)    *   CIR001
     C*                                                               *   CIR001
     C*              *IN60     END OF FILE INDICATOR FOR DLSWPRL1     *   CIR001
     C*                                                               *   CIR001
     C*****************************************************************   CIR001
     C*                                                                   CIR001
     C           #BF       BEGSR                                          CIR001
     C*                                                                   CIR001
     C**  SET LOWER LIMITS ON SWAP RATES                                  CIR001
     C*                                                                   CIR001
     C           *LOVAL    SETLLDLSWPRL1                                  CIR001
     C*                                                                   CIR001
     C**  READ SWAP RATES                                                 CIR001
     C*                                                                   CIR001
     C                     READ DLSWPRL1                 60               CIR001
     C*                                                                   CIR001
     C**  DO WHILE END OF FILE NOT REACHED                                CIR001
     C*                                                                   CIR001
     C           *IN60     DOWEQ'0'                                       CIR001
     C*                                                                   CIR001
     C**  IF RECORD LIVE                                                  CIR001
     C*                                                                   CIR001
     C           IRDLTF    IFEQ *BLANK                                    CIR001
     C*                                                                   CIR001
     C**  SET UP NUMBER OF YEARS, MONTHS AND DAYS FOR SR ZCPD             CIR001
     C*                                                                   CIR001
     C                     MOVELIRPDYR    ZNYR                            CIR001
     C                     MOVELIRPDMN    ZNMN                            CIR001
     C                     MOVELIRPDDY    ZNDY                            CIR001
     C*                                                                   CIR001
     C**  IF CHANGE OF CURRENCY - SET UP CURRENCY AND SPOT FOR ZCPD       CIR001
     C*                                                                   CIR001
     C           IRCCY     IFNE @@PCCY                                    CIR001
     C*                                                                   CIR001
     C**  IF CURRENCY THE SAME AS THE LOCAL CURRENCY SPOT DATE IS TODAY   CIR001
     C*                                                                   CIR001
     C           IRCCY     IFEQ BJCYCD                                    CIR001
     C                     Z-ADDBJRDNB    ZINDT                           CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  ELSE SPOT DATE IS TWO WORKING DAYS FROM TODAY                   CIR001
     C*                                                                   CIR001
     C                     MOVE IRCCY     ZCCY                            CIR001
     C                     MOVE *BLANKS   ZLOC                            CIR001
     C                     Z-ADDBJRDNB    ZDAYNO                          CIR001
     C                     Z-ADD2         ZNRDYS                          CIR001
     C                     EXSR ZFWDT                                     CIR001
     C                     Z-ADDZDYNBR    ZINDT                           CIR001
     C                     END                                            CIR001
     C**  STORE CURRENCY                                                  CIR001
     C                     MOVE IRCCY     @@PCCY                          CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  CALCULATE THE PERIOD DATE                                       CIR001
     C*                                                                   CIR001
     C                     EXSR ZCPD                                      CIR001
     C*                                                                   CIR001
     C** ACCESS DISCOUNT FACTOR                                           CIR001
     C*                                                                   CIR001
     C           DLIRDK    KLIST                                          CIR001
     C                     KFLD           IRCCY                           CIR001
     C                     KFLD           IRINCL                          CIR001
     C                     KFLD           IRFREQ                          CIR001
     C                     KFLD           IRMMDN                          CIR001
     C           DLIRDK    CHAINDLIRDFL1             60    *              CIR001
     C           *IN60     IFEQ '0'                                       CIR001
     C*                                                                   CIR001
     C**  UPDATE DISCOUNT FACTOR WITH PERIOD DATE                         CIR001
     C*                                                                   CIR001
     C                     MOVE ZPDNO     I2MMDN                          CIR001
     C                     EXCPTUPDSCF                                    CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  UPDATE SWAP RATE WITH PERIOD DATE                               CIR001
     C*                                                                   CIR001
     C                     MOVE ZPDNO     IRMMDN                          CIR001
     C                     MOVE ZPDTE     IRMDMY                          CIR001
     C*                                                                   CIR001
     C                     EXCPTUPSWPR                                    CIR001
     C*                                                                   CIR001
     C**  IF RECORD NOT LIVE                                              CIR001
     C*                                                                   CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  DELETE SWAP RATE                                                CIR001
     C*                                                                   CIR001
     C                     DELETDLSWPRD0                                  CIR001
     C*                                                                   CIR001
     C**  DELETE DISCOUNT FACTOR                                          CIR001
     C*                                                                   CIR001
     C           DLIRDK    CHAINDLIRDFL1             60    *              CIR001
     C           *IN60     IFEQ '0'                                       CIR001
     C                     DELETDLIRDFD0                                  CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  READ SWAP RATES                                                 CIR001
     C*                                                                   CIR001
     C                     READ DLSWPRL1                 60               CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           #BF9      ENDSR                                          CIR001
     C*                                                                   CIR001
     C*****************************************************************   CIR001
      */EJECT                                                                               BUG10705
      *****************************************************************                     BUG10705
      ** DELEXT - Delete extension record                                                   BUG10705
      *****************************************************************                     BUG10705
     C           DELEXT    BEGSR                                                            BUG10705
     C                     MOVELHKDN38    F1DLNO                                            BUG10705
     C           HKDSTS    IFEQ 'C'                                                         AR970738
     C           HKDDLT    ANDEQ'D'                                                         AR970738
     C********** F1DLNO    CHAINDLDLDBD0             30                            BUG10705 AR970738
     C           F1DLNO    CHAINDLDLDCD0             30                                     AR970738
     C           *IN30     IFEQ '0'                                                         BUG10705
     C**********           DELETDLDLDBD0                                           BUG10705 AR970738
     C                     DELETDLDLDCD0                                                    AR970738
     C                     ENDIF                                                            BUG10705
     C                     ENDIF                                                            AR970738
     C                     ENDSR                                                            BUG10705
      *                                                                                     BUG10705
     C/EJECT                                                              CIR001
     C********************************************************************
     C/COPY WNCPYSRC,MM0101CCP4                                           S01408
     C********************************************************************S01408
      *
      *                        Initial Processing
      *
      * 1. Calculate MM Spot Date (MMP0367) using process P/MM0101,01
      *
      * 2. Set lower limits on MM Deals File (MMDEALLL)
      *
      * 3. Set lower limits on MM Deams File (MMDEAMLL)
      *
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #A - INITIAL PROCESSING                                      *
     C*                                                                  *
     C*     CALLED BY  : CONTROL PROCESSING                              *
     C*                                                                  *
     C*     CALLS      : #AA                                             *
     C*                                                                  *
     C*     WORK FIELDS: @DEALN   DEAL NUMBER                   (6N)     *
     C*                  @DLKY    DEAL KEY LIST                 KLIST    *
     C*                  @TERM    TERMINATION CODE              (1A)     *
     C*                  @@KFI    KEY LIST FOR FRA AND IRS RATES TABLE   *S01328
     C*                  @@KCCY   KEY CURRENCY                           *S01328
     C*                  @@KBRC   KEY BASE RATE CODE                     *S01328
     C*                                                                  *
     C********************************************************************
     C*
     C           #A        BEGSR
     C/COPY WNCPYSRC,MM0101C019
     C*
     C                     MOVEACPY@      BIS@   80                       S01194
      *                                                                   S01280
      * Define local data area                                            S01280
     C           *NAMVAR   DEFN           LDA                             S01280
     C*
     C**  OPEN ALL FILES USED IN PROGRAM
     C                     OPEN MMDEAMLL
     C                     OPEN MMDEAULL
     C                     OPEN MMDAMULL
     C                     OPEN DEALS
     C                     OPEN DEAMS
     C*********************OPEN FDCCYTLL                                  S01194
     C                     OPEN FDCCYTLL                                  S01328
     C*********************OPEN FDICDRLL                                  S01194
     C                     OPEN FDINTRLL
     C                     OPEN DLMMDFL2                                  E26582
     C*********************OPEN FXTB40LL                                  S01194
     C*********************OPEN SDCURRL1                            E18541LN0662
     C                     OPEN SDCURRL0                                  LN0662
     C                     OPEN DLFRARL1                                  S01328
     C                     OPEN DLIRSRL1                                  S01328
     C                     OPEN DLSWPRL1                                  CIR001
     C                     OPEN DLIRDFL1                                  CIR001
     C/COPY WNCPYSRC,MM0101CCP5                                           S01408
     C                     OPEN SDBRTDL1                                  S01383
     C                     OPEN SDCBRTL1                                  S01383
     C                     OPEN DLDEALL5                                                    BUG10705
      *                                                                                       CDL013
      ***   Check if CAR CDL013 is installed                                                  CDL013
     C                     CALL 'AOSARDR0'                                                    CDL013
     C                     PARM *BLANKS   @RTCD   7                                           CDL013
     C                     PARM '*VERIFY' @OPTN   7                                           CDL013
     C                     PARM 'CDL013'  @SARD   6                                           CDL013
     C                     PARM           DSFDY                                               CDL013
      *                                                                                       CDL013
      ** CAR CDL013 is installed                                                              CDL013
     C           @RTCD     IFEQ *BLANKS                                                       CDL013
     C                     MOVE '1'       CDL013  1                                           CDL013
     C                     OPEN SDSTAAL1                                                      CDL013
      *                                                                                       CDL013
      ** Access WHT ICD record to determine WHT rate.                                         CDL013
     C                     MOVEL*BLANKS   ULSTAX 10                                           CDL013
     C                     MOVEL'RETAIL'  ULSTAX                                              CDL013
     C           ULSTAX    CHAINSDSTAAL1             61                                       CDL013
      *                                                                                       CDL013
     C           *IN61     IFEQ '1'                                                           CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C                     MOVEL'MM0101'  DBPGM                                               CDL013
     C                     MOVEL'SDSTAAL1'DBFILE                                              CDL013
     C                     Z-ADD010       DBASE                                               CDL013
     C                     MOVELULSTAX    DBKEY                                               CDL013
     C                     MOVE 'E'       @TERM                                               CDL013
     C                     OUT  LDA                                                           CDL013
     C                     DUMP                                                               CDL013
     C                     GOTO #A9                                                           CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      ** CAR CDL013 is not installed                                                          CDL013
     C                     ELSE                                                               CDL013
     C                     MOVE '0'       CDL013                                              CDL013
     C                     END                                                                CDL013
      *                                                                                       CDL013
     C*
     C**  RECEIVE PARAMETERS - DEAL NUMBER AND VALUE DATE
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C*                                                                   S01328
     C**  DEFINE KEY FOR FRA & IRS RATES TABLE - CURRENCY AND BASE RATE   S01328
     C           @@KFI     KLIST                                          S01328
     C                     KFLD           @@KCCY  3                       S01328
     C                     KFLD           @@KBRC  20                      S01328
     C/COPY WNCPYSRC,MMH00196
     C**  INTIALISE                                                       S01328
     C                     MOVE *BLANKS   @@KCCY                          S01328
     C                     Z-ADD*ZERO     @@KBRC                          S01328
     C*
     C***Obtain*Treasury*Management*module*flag****                 E26289S01319
     C*********************CALL 'AOMMODR0'                          E26289S01319
     C*********************PARM '*MSG   ' @RTCD   7                 E26289S01319
     C*********************PARM '*FIRST ' @OPTN   7                 E26289S01319
     C***********SDMMOD****PARM SDMMOD    DSFDY                     E26289S01319
     C***********@RTCD*****IFNE *BLANK                              E26289S01319
     C************LOCK*****IN   LDA                                 E26289S01319
     C*********************MOVEL'SDMMODPD'DBFILE                    E26289S01319
     C*********************MOVEL'MM0101'  DBPGM            *********E26289S01319
     C*********************Z-ADD008       DBASE            * DBERRORE26289S01319
     C*********************MOVEL@OPTN     DBKEY            *        E26289S01319
     C*********************MOVE @OPTN     DBOPTN  7        *        E26289S01319
     C*********************MOVE 'E'       @TERM            *********E26289S01319
     C*********************OUT  LDA                                 E26289S01319
     C*********************DUMP                            *1       E26289S01319
     C*********************GOTO #A9                        *1       E26289S01319
     C*********************END                             E1       E26289S01319
     C*                                                             E26289S01319
     C**                                                                  S01383
     C** ACCESS SAR DETAILS FILE TO DETERMINE IF BRT SAR IS INSTALLED     S01383
     C**                                                                  S01383
     C                     CALL 'AOSARDR0'                                S01383
     C                     PARM '       ' @RTCD                           S01383
     C                     PARM '*VERIFY' @OPTN                           S01383
     C                     PARM 'S01383'  @SARD   6                       S01383
     C           @RTCD     IFNE *BLANK                                    S01383
     C           @RTCD     ANDNE'*NRF   '                                 S01383
     C           *LOCK     IN   LDA                                       S01383
     C                     MOVEL'SCSARDPD'DBFILE                          S01383
     C                     MOVEL'MM0101'  DBPGM            ***************S01383
     C                     Z-ADD992       DBASE            * DBERROR 992 *S01383
     C                     MOVEL@RTCD     DBKEY            ***************S01383
     C                     MOVE 'E'       @TERM                           S01383
     C                     OUT  LDA                                       S01383
     C                     DUMP                                           S01383
     C                     GOTO #A9                                       S01383
     C                     END                                            S01383
     C           @RTCD     IFEQ *BLANK                                    S01383
     C                     MOVEL'Y'       S01383  1                       S01383
     C                     END                                            S01383
      *                                                                   CDL006
      ** Check if Dealing Fiduciary is switched ON                        CDL006
      *                                                                   CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   WRTCD   7                       CDL006
     C                     PARM '*VERIFY' WOPTN   7                       CDL006
     C                     PARM 'CDL006'  WSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSFDY                           CDL006
     C           WRTCD     IFEQ *BLANKS                                   CDL006
     C                     MOVE 'Y'       CDL006  1                       CDL006
     C                     ELSE                                           CDL006
     C           WRTCD     IFNE '*NRF   '                                 CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDL006
     C                     Z-ADD994       DBASE            * DBERR 994*   CDL006
     C                     MOVEL'CDL006'  DBKEY            ************   CDL006
     C                     OUT  LDA                                       CDL006
     C                     MOVE 'E'       @TERM                           CDL006
     C                     DUMP                                           CDL006
     C                     GOTO #A9                                       CDL006
     C                     ENDIF                                          CDL006
     C                     MOVE 'N'       CDL006                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CIR004
      ** Check if Dealing Calculation Method Change is switched ON        CIR004
      *                                                                   CIR004
     C                     MOVE 'N'       CIR004  1                       CIR004
     C                     CALL 'AOSARDR0'                                CIR004
     C                     PARM *BLANKS   WRTCD                           CIR004
     C                     PARM '*VERIFY' WOPTN                           CIR004
     C                     PARM 'CIR004'  WSARD                           CIR004
     C           SCSARD    PARM SCSARD    DSFDY                           CIR004
      *                                                                   CIR004
     C           WRTCD     IFEQ *BLANKS                                   CIR004
     C                     MOVE 'Y'       CIR004                          CIR004
     C                     ELSE                                           CIR004
     C           WRTCD     IFNE '*NRF   '                                 CIR004
     C           *LOCK     IN   LDA                                       CIR004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CIR004
     C                     Z-ADD995       DBASE            * DBERR 995*   CIR004
     C                     MOVEL'CIR004  'DBKEY            ************   CIR004
     C                     OUT  LDA                                       CIR004
     C                     MOVE 'E'       @TERM                           CIR004
     C                     DUMP                                           CIR004
     C                     GOTO #A9                                       CIR004
     C                     ENDIF                                          CIR004
     C                     ENDIF                                          CIR004
      *                                                                   CIR004
     C/COPY WNCPYSRC,MM0101C005
      *                                                                                       CDL033
      ** Determine if Floating Rate CD Issued feature is                                      CDL033
      ** switched on.                                                                         CDL033
      *                                                                                       CDL033
     C                     MOVE *BLANK    CDL033  1                                           CDL033
     C                     CALL 'AOSARDR0'                                                    CDL033
     C                     PARM *BLANKS   PRTCD   7                                           CDL033
     C                     PARM '*VERIFY' POPTN   7                                           CDL033
     C                     PARM 'CDL033'  PSARD   6                                           CDL033
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL033
      *                                                                                       CDL033
     C           PRTCD     IFEQ *BLANKS                                                       CDL033
     C                     MOVE 'Y'       CDL033                                              CDL033
     C                     OPEN DLFRSCL0                                                      CDL033
     C                     ELSE                                                               CDL033
     C           PRTCD     IFNE '*NRF   '                                                     CDL033
     C           *LOCK     IN   LDA                                                           CDL033
     C                     MOVE '011'     DBASE                                               CDL033
     C                     MOVEL'CDL033'  DBKEY                                               CDL033
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL033
     C                     OUT  LDA                                                           CDL033
     C                     MOVE 'E'       @TERM                                               CDL033
     C                     DUMP                                                               CDL033
     C                     GOTO #A9                                                           CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
     C*                                                                   S01383
     C** IF BRT SAR INSTALLED, ACCESS BRT INSTALLATION CONTROL DATA       S01383
     C*                                                                   S01383
     C           S01383    IFEQ 'Y'                                       S01383
     C                     MOVE 'D'       BRTKEY  1                       S01383
     C           BRTKEY    CHAINSDBRTDD0             61                   S01383
     C*                                                                   S01383
     C** if *in61 is on, then it is a data base error                     S01383
     C*                                                                   S01383
     C           *IN61     IFEQ '1'                                       S01383
     C           *LOCK     IN   LDA                                       S01383
     C                     MOVEL'SDBRTDPD'DBFILE                          S01383
     C                     MOVEL'MM0101'  DBPGM            ***************S01383
     C                     Z-ADD993       DBASE            * DBERROR 993 *S01383
     C                     MOVELBRTKEY    DBKEY            ***************S01383
     C                     MOVE 'E'       @TERM                           S01383
     C                     OUT  LDA                                       S01383
     C                     DUMP                                           S01383
     C                     GOTO #A9                                       S01383
     C                     END                                            S01383
     C                     END                                            S01383
      *                                                                                       CDL081
      ** Check if CDL081 is installed                                                         CDL081
      *                                                                                       CDL081
     C                     MOVE 'N'       CDL081  1                                           CDL081
     C                     CALL 'AOSARDR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD   7                                           CDL081
     C                     PARM '*VERIFY' POPTN   7                                           CDL081
     C                     PARM 'CDL081'  PSARD   6                                           CDL081
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           PRTCD     ANDNE'*NRF   '                                                     CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     Z-ADD075       DBASE                                               CDL081
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL081
     C                     MOVEL'MM0101'  DBPGM                                               CDL081
     C                     MOVEL'CDL081'  DBKEY                                               CDL081
     C                     MOVEL'E'       @TERM                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     DUMP                                                               CDL081
     C                     GOTO #A9                                                           CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C           PRTCD     IFEQ *BLANKS                                                       CDL081
     C                     MOVE 'Y'       CDL081                                              CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Access withholding tax round down system values if CDL081 is on                      CDL081
      *                                                                                       CDL081
     C           CDL081    IFEQ 'Y'                                                           CDL081
     C                     CALL 'AOSVALR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD                                               CDL081
     C                     PARM C#BASE    SVALK1 20                                           CDL081
     C                     PARM           SVAL1 200                                           CDL081
     C                     PARM C#NBAS    SVALK2 20                                           CDL081
     C                     PARM           SVAL2 200                                           CDL081
     C                     PARM *BLANK    SVALK3 20                                           CDL081
     C                     PARM           SVAL3 200                                           CDL081
     C                     PARM *BLANK    SVALK4 20                                           CDL081
     C                     PARM           SVAL4 200                                           CDL081
     C                     PARM *BLANK    SVALK5 20                                           CDL081
     C                     PARM           SVAL5 200                                           CDL081
     C                     PARM *BLANK    SVALK6 20                                           CDL081
     C                     PARM           SVAL6 200                                           CDL081
     C                     PARM *BLANK    SVALK7 20                                           CDL081
     C                     PARM           SVAL7 200                                           CDL081
     C                     PARM *BLANK    SVALK8 20                                           CDL081
     C                     PARM           SVAL8 200                                           CDL081
     C                     PARM *BLANK    SVALK9 20                                           CDL081
     C                     PARM           SVAL9 200                                           CDL081
     C                     PARM *BLANK    SVALK0 20                                           CDL081
     C                     PARM           SVAL10200                                           CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C           SVAL1     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK1    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C           SVAL2     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK2    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C                     Z-ADD076       DBASE                                               CDL081
     C                     MOVEL'SDSVALPD'DBFILE                                              CDL081
     C                     MOVEL'MM0101'  DBPGM                                               CDL081
     C                     MOVEL'E'       @TERM                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     DUMP                                                               CDL081
     C                     GOTO #A9                                                           CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Setup tax amount rounding down indicators                                            CDL081
      *                                                                                       CDL081
     C                     MOVELSVAL1     W#BSRD  1                                           CDL081
     C                     MOVELSVAL2     W#NBRD  1                                           CDL081
     C                     ENDIF                                                              CDL081
      *****************************************************************            MD035545 MD047993
      ***Call*access*program*for*General*Ledger*details.***************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
     C********** @RTCD     IFNE *BLANK                                             MD035545 MD047993
     C**********           MOVEL'SDGELRPD'DBFILE                                   MD035545 MD047993
     C**********           MOVEL'062'     DBASE                                    MD035545 MD047993
     C**********           MOVEL@OPTN     DBKEY                                    MD035545 MD047993
     C**********           EXSR *PSSR                                              MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD035545
     C/COPY WNCPYSRC,MM0101C004
     C**  CALCULATE MM SPOT DATE (MMP0367)
     C                     EXSR #AA
     C           @DLKY     KLIST
     C                     KFLD           @DEALN
     C                     Z-ADD0         @DEALN
     C*
     C**  SET LOWER LIMITS ON MM DEALS AND DEAMS FILES
     C           @DLKY     SETLLMMDEAULL
     C           @DLKY     SETLLMMDAMULL
     C*
     C           #A9       ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
      *
      *                             PROCESSES
      *
      *               P/MM0101,01 - Calculate MM Spot Date
      *
      * 1. Set up key for MIDAS Installation Control Data Record 1
      *    (PF/TABTB10)
      *
      * 2. Chain to record
      *
      * 3. If record not found:
      *
      *     3.1 Execute Data base error processing
      *
      *     3.2 Go to end of subroutine
      *
      * Else
      *
      *     3.3 Obtain MIDAS run date
      *
      * 4. Set lower limits on PF/TABTG10
      *
      * 5. Read a record on PF/TABTG10
      *
      * 6. If end of file go to end of subroutine
      *
      * 7. Do until number of days added = number of spot days
      *
      *     7.1 Add 1 to MIDAS day number
      *
     C******7.2*Execute*subroutine*ZA0710*to*convert*new*day*number*to****S01328
      *         YYYYMMDD format
      *
      ******7.3*Execute*subroutine*ZA0830 to check if date is a holiday   S01195
      *     7.3 Execute subroutine ZCHKH  to check if date is a holiday   S01195
      *
      *     7.4 If date is a holiday go to step 7.1
      *
      *     7.5 Add 1 to number of spot days added
      *
      * End do
      *
      * 8. Update MM Spot date on PF/TABTG10,01 as per R/MM0101,01
      *
      * 9. Store currency and spot date in relevent arrays for later
      *    access
      *
      *10. Go to step 5
      *
      *11. End of subroutine
      *
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*  #AA - THIS SUBROUTINE CALCULATES THE MM SPOT DATE            *
     C*        (P/MM0101,01)                                          *
     C*                                                               *
     C*  CALLED BY:  #B                                               *
     C*                                                               *
     C*  CALLS:      ZDATE9                                           *   S01328
     C***CALLS:******ZA0710********************************************   S01328
     C***************ZA0830***********                                *   S01195
     C*                                                               *
     C*  USES:       @@KEY     KEY TO ACCESS FDICDRLL                 *
     C*              @@RNDT    MIDAS RUN DATE                         *
     C*              @@SDAY    NUMBER OF SPOT DAYS                    *
     C*              @@A       ARRAY HOLDING CURRENCY CODES           *
     C*              @@B       ARRAY HOLDING SPOT DATES               *
     C*              @I        INDEX FOR ARRAYS @@A AND @@B           *
     C*                                                               *
     C***************@@MNO     MIDAS DAY NUMBER INPUT TO ZA0830       *   S01195
     C***************@@CCY     CURRENCY INPUT TO ZA0830               *   S01195
     C***************@@HIND    HOLIDAY INDICATOR OUTPUT FROM ZA0830   *   S01195
     C***************@@DAYN****MIDAS*DAY*NUMBER*INPUT*TO*ZA0710********   S01328
     C***************@@RTN0****PARAMETER*RETURNED*FROM*ZA0710**********   S01328
     C***************@@VDT0****DATE*IN*YYYYMMDD*FORMAT*OUTPUT*FROM*****   S01328
     C*************************ZA0710**********************************   S01328
     C*              @@DAYN    MIDAS DAY NUMBER INPUT TO ZDATE9       *   S01328
     C*              @@RTN     PARAMETER RETURNED FROM ZDATE9         *   S01328
     C*              @@VDT     DATE IN YYYYMMDD FORMAT OUTPUT FROM    *   S01328
     C*                        ZDATE9                                 *   S01328
     C*                                                               *
     C*              *IN70     DATA BASE ERROR ON FDICDRLL            *
     C*              *IN60     END OF FILE INDICATOR FOR FDCCYTLL     *
     C*                                                               *
     C*****************************************************************
     C*
     C           #AA       BEGSR
     C*
     C****SET UP KEY TO ACCESS FILE FDICDRLL                              S01194
     C*********************MOVEL'01'      @@KEY  12                       S01194
     C*********************MOVE '10'      @@KEY                           S01194
     C*********************                                               S01194
     C****CHAIN*TO*FILE*FDICDRLL                                          S01194
     C***********@@KEY*****CHAINFDICDRLL             70                   S01194
     C*********************                                               S01194
     C****IF*RECORD*NOT*FOUND,*THEN DATA BASE ERROR HAS OCCURRED          S01194
     C************IN70*****IFEQ '1'                        B1             S01194
     C*********************MOVEL'FDICDRLL'DBFILE           *1             S01194
     C*********************MOVEL@@KEY     DBKEY            *1             S01194
     C** Access Bank details via access program                           S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       S01280
     C                     MOVEL'SDBANKPD'DBFILE                          S01194
     C                     MOVEL'MM0101'  DBPGM            ***************
     C                     Z-ADD004       DBASE            * DBERROR 004 *
     C                     MOVEL@OPTN     DBKEY            *             *S01194
     C                     MOVE @OPTN     DBOPTN  7        *             *S01194
     C                     MOVE 'E'       @TERM            ***************
     C                     OUT  LDA                                       S01280
     C                     DUMP                            *1
     C                     GOTO #AA9                       *1
     C                     END                             E1
     C*                                                                   S01328
     C**  SET DATE FORMAT INDICATOR FOR LATER USE IN SR ZDATE2            S01328
     C           BJDFIN    IFEQ 'M'                                       S01328
     C                     MOVE '1'       *IN98                           S01328
     C                     END                                            S01328
     C*
     C**  INITIALISE ARRAYS AND ARRAY INDEX
     C                     MOVE *BLANKS   @@A
     C                     Z-ADD0         @@B
     C                     Z-ADD0         @I      30
     C*
     C**  INITIALISE INDICATOR
     C                     MOVE '0'       *IN60
     C*
     C****SET*UP*KEY*TO*ACCESS*FDCCYTLL                                   S01194
     C*********************MOVE *BLANKS   @@CKEY 12                       S01194
     C*********************                                               S01194
     C****SET*LOWER*LIMITS*ON FILE FDCCYTLL                               S01194
     C***********@@CKEY****SETLLFDCCYTLL                                  S01194
     C**********************                                              S01194
     C****READ*FILE*FDCCYTLL                                              S01194
     C****SET*UP*KEY*TO*ACCESS FDCCYTLL                             S01194S01328
     C*********************MOVE *BLANKS   @@CKEY  3                 S01194S01328
     C****SET*LOWER*LIMITS*ON FILE FDCCYTLL                         S01194S01328
     C***********@@CKEY    SETLLSDCURRL1                            S01194LN0662
     C***********@@CKEY    SETLLSDCURRL0                            LN0662S01328
     C**                                                                  S01194
     C****READ*FILE*FDCCYTLL                                              S01194
     C****READ*FILE*SDCURRL1**                                      S01194S01328
     C**                                                                  S01328
     C**  SET UP KEYS TO ACCESS FDCCYTLL AND SDCURRL0                     S01328
     C                     MOVE *BLANKS   @@KY3   3                       S01328
     C                     MOVE *BLANKS   @@KY12 12                       S01328
     C**                                                                  S01328
     C**  SET LOWER LIMITS ON FILE FDCCYTLL AND SDCURRL0                  S01328
     C           @@KY12    SETLLFDCCYTLL                                  S01328
     C           @@KY3     SETLLSDCURRL0                                  S01328
     C**                                                                  S01328
     C**  READ FILES FDCCYTLL AND SDCURRL0 UNTIL DEALING CURRENCY         S01328
     C           *IN60     DOWEQ'0'                        B1
     C*
     C*********************READ FDCCYTLL                 60*1             S01194
     C*********************READ SDCURRL1                 60*1       S01194LN0662
     C           A6DLCI    DOUEQ'Y'                                       S01328
     C           *IN60     OREQ '1'                                       S01328
     C                     READ SDCURRL0                 60*1             LN0662
     C                     END                                            S01328
     C*
     C**  IF *IN60 ON, THEN END OF FILE
     C           *IN60     CABEQ'1'       #AA9
     C*                                                             E18541S01194
     C** IF *IN60 NOT ON FROM READ OF SDCURRL0, READ FDCCYTLL FOR NEXT    S01328
     C** DEALING CURRENCY.  IF *IN60 THEN ON, OR NOT THE SAME             S01328
     C** CURRENCY READ, THEN DATABASE ERROR.                              S01328
     C                     READ FDCCYTLL                 60               S01328
     C*                                                                   S01328
     C           *IN60     IFEQ '1'                                       S01328
     C           A6CYCD    ORNE CCY                                       S01328
     C                     MOVEL'MM0101'  DBPGM                           S01328
     C                     MOVEL'FDCCYTLL'DBFILE                          S01328
     C                     MOVE A6CYCD    DBKEY            *************  S01328
     C                     MOVEL'006'     DBASE            * DBERR 006 *  S01328
     C                     MOVE 'E'       @TERM            *************  S01328
     C                     DUMP                                           S01328
     C                     GOTO #AA9                                      S01328
     C                     END                                            S01328
     C****CHAIN*TO*THE*SYNON*CURRENCY*LOGICAL                       E18541S01194
     C***********CCY*******CHAINSDCURRL1             66             E18541S01194
     C*******************                                           E18541S01194
     C****IF*RECORD*NOT*FOUND*DATABASE ERROR                        E18541S01194
     C************IN66     IFEQ '1'                        B*2      E18541S01194
     C*********************MOVEL'SDCURRL1'DBFILE           **2      E18541S01194
     C*********************MOVE CCY       DBKEY            *********E18541S01194
     C*********************MOVEL'006'     DBASE            *  DBERROE18541S01194
     C*********************MOVE 'E'       @TERM            *********E18541S01194
     C*********************DUMP                            **2      E18541S01194
     C*********************GOTO #AA9                       **2      E18541S01194
     C*********************END                             E*2      E18541S01194
     C*
     C**  INITIALISE HOLIDAY INDICATOR
     C*********************MOVE ' '       @@HIND  1        *1             S01194
     C                     MOVE ' '       ZIND    1        *1             S01194
     C*
     C**  STORE MIDAS RUN DATE
     C*********************Z-ADDRUND      @@RNDT  50       *1             S01194
     C                     Z-ADDBJRDNB    @@RNDT  50       *1             S01194
     C*
     C**  STORE NUMBER OF SPOT DAYS
     C*********************Z-ADDSPDY      @@SDAY  30       *1             S01194
     C                     Z-ADDA6SPDY    @@SDAY  30       *1             S01194
     C*
     C*If Spot Days (SPDY) is zero then Money Market Spot Date            E15079
     C*should be Run Date (RUND). To save changing existing code          E15079
     C*this can be achieved by subtracting 1 from the Run Date work       E15079
     C*field and moving 1 to the Spot Days work field to check that       E15079
     C*Run Date is not a holiday for the currency.                        E15079
     C           @@SDAY    IFEQ 0                          B*2            E15079
     C                     Z-ADD1         @@SDAY           **2            E15079
     C                     SUB  1         @@RNDT           **2            E15079
     C                     END                             E*2            E15079
     C*                                                                   E15079
     C**  DO UNTIL THE REQUIRED NUMBER OF SPOT DAYS HAVE BEEN ADDED
     C**  TO THE MIDAS RUN DATE, GIVING THE SPOT DATE
     C                     DO   @@SDAY                     B*2
     C*
     C**  DO UNTIL DAY IS A WORKING DAY
     C***********@@HIND    DOUEQ'W'                        B**3           S01195
     C           ZIND      DOUEQ'W'                        B**3           S01195
     C                     ADD  1         @@RNDT           ***3
     C*
     C****SET*UP*INPUT*PARAMETERS TO ZA0830                               S01195
     C*********************Z-ADD@@RNDT    @@MNO   50       ***3           S01195
     C*********************MOVE CCY       @@CCY   3        ***3           S01195
     C*********************                                               S01195
     C****EXECUTE*SUBROUTINE ZA0830 TO DETERMINE WHETHER DAY IS           S01195
     C****WORKING*DAY*OR*HOLIDAY                                          S01195
     C*********************EXSR ZA0830                     ***3           S01195
     C*                                                                   S01195
     C**  SET UP INPUT PARAMETERS TO ZCHKH                                S01195
     C                     MOVE *BLANKS   ZLOC             ***3           S01195
     C                     MOVE A6CYCD    ZCCY             ***3           S01195
     C                     Z-ADD@@RNDT    ZDAYNO           ***3           S01195
     C*                                                                   S01195
     C**  EXECUTE SUBROUTINE ZCHKH  TO DETERMINE WHETHER DAY IS           S01195
     C**  WORKING DAY OR HOLIDAY                                          S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C*
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C****SET*UP*INPUT*PARAMETER*TO*ZA0710********************************S01328
     C**  SET UP INPUT PARAMETER TO ZDATE9                                S01328
     C                     Z-ADD@@RNDT    @@DAYN  50       *1
     C*
     C****EXECUTE*SUBROUTINE*ZA0710*TO*CONVERT*SPOT*DATE*FROM*************S01328
     C**  EXECUTE SUBROUTINE ZDATE9 TO CONVERT SPOT DATE FROM             S01328
     C**  MIDAS DAY NUMBER FORMAT TO YYYYMMDD FORMAT
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C*
     C****IF*PARAMETER*@@RTN*RETURNED*FROM*ZA0710*HAS*VALUE*'1'***********S01328
     C****THEN*MIDAS*DAY*NUMBER*INPUT*TO*ZA0710*IS*LESS*THAN*1************S01328
     C**  IF PARAMETER @@RTN RETURNED FROM ZDATE9 HAS VALUE '1'           S01328
     C**  THEN MIDAS DAY NUMBER INPUT TO ZDATE9 IS LESS THAN 1            S01328
     C**  AND DATA BASE ERROR HAS OCCURRED
     C***********@@RTN*****IFEQ 1                          B*2            S01328
     C           @@RTN     IFEQ '1'                                       S01328
     C           *LOCK     IN   LDA                                       S01280
     C                     MOVEL*BLANKS   DBFILE           **2
     C                     MOVEL*BLANKS   DBKEY            **2
     C                     MOVEL'MM0101'  DBPGM            ***************
     C                     Z-ADD005       DBASE            * DBERROR 005 *
     C                     MOVE 'E'       @TERM            ***************
     C                     OUT  LDA                                       S01280
     C                     DUMP                            **2
     C                     GOTO #AA9                       **2
     C                     END                             E*2
     C*
     C****UPDATE*FILE*FDCCYTLL*WITH SPOT DATE                             S01194
     C*********************MOVE @@VDT     MSPD             *1             S01194
     C*********************                                               S01194
     **********************EXCPTUPDSPD                     *1             S01194
     C*                                                                   E18541
     C****SET*UP*SPOT*DATE*FIELD*AND UPDATE LF/SDCURRL1             E18541S01328
     C*********************Z-ADDMSPD      A6DLNB           *1       E18541S01194
     C**  SET UP SPOT DATE FIELD AND UPDATE LF/SDCURRL0                   S01328
     C                     Z-ADD@@VDT     A6MMSD           *1       E18541S01194
     C*                                                                   E18541
     C                     UPDAT@A6REA4                    *1             E18541
     C*
     C**  SET UP SPOT DATE FIELD AND UPDATE LF/FDCCYTLL                   S01328
     C                     MOVE @@VDT     MSPD                            S01328
     C                     EXCPTUPDSPD                                    S01328
     C*
     C**  UPDATE ARRAY INDEX
     C                     ADD  1         @I               *1
     C*
     C**  STORE CURRENCY AND SPOT DATE IN ARRAYS FOR LATER ACCESS
     C*********************MOVE CCY       @@A,@I           *1             S01194
     C                     MOVE A6CYCD    @@A,@I           *1             S01194
     C                     MOVE @@VDT     @@B,@I           *1
     C*
     C                     END                             E1
     C*
     C           #AA9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
      *
      *                      TERMINATION PROCESSING
      *
      * 1. Set on *INLR
      *
      * 2. If data base error:
      *
      *     2.1 Set on indicators *INU7 & *INU8
      *
      *     2.2 Change termination code to 'T'
      *
      * 3. Close all open files
      *
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #C - TERMINATION PROCESSING                                  *
     C*                                                                  *
     C*     CALLED BY  : CONTROL PROCESSING                              *
     C*                                                                  *
     C*     CALLS      :                                                 *
     C*                                                                  *
     C*     WORK FIELDS:                                                 *
     C*                                                                  *
     C********************************************************************
     C*
     C           #C        BEGSR
     C*
     C**  SET UP PROGRAM NAME
     C                     MOVEL'MM0101'  DBPGM
     C*
     C**  SET ON LAST RECORD INDICATOR TO CLOSE FILES
     C                     MOVE '1'       *INLR
     C*
     C**  IF A DB ERROR HAS OCCURRED SET ON EXTERNAL SWITCHES U7 & U8
     C           @TERM     IFEQ 'E'                        B1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     END                             E1
     C*
     C           #C9       ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*      EXCEPTION ERROR SUBROUTINE                                  *
     C*                                                                  *
     C*      SUBROUTINE CALLED: EXECUTES WHENEVER EITHER FILE OR         *
     C*                         PROGRAM ERROR OCCURS                     *
     C*                                                                  *
     C*      CALLS            :                                          *
     C*                                                                  *
     C********************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C**  SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR1     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR1   1        *1
     C*
     C**  SET UP FIELDS IN LOCAL DATA AREA
     C           *LOCK     IN   LDA                                       S01280
     C*********************MOVE 'MM0101'  DBPGM            *1             S01328
     C                     MOVEL'MM0101'  DBPGM            *1             S01328
     C                     Z-ADD991       DBASE            *1
     C                     MOVE 'E'       @TERM            *1
     C                     OUT  LDA                                       S01280
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C                     MOVE '1'       *INLR
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*   MM1010 - CALCULATION OF INTEREST AT MATURITY                *
     C*                                                               *
     C*  FILES EXPECTED  -  FXTB40LL                                  *
     C*                  -  MMDEAMLL  DEAL AMENDMENTS FILE            *
     C*                  -  SDCBRTL1  BRT CUSTOMER DETAILS FILE       *   S01383
     C*                                                               *
     C*  CALLED BY    -                                               *
     C*                                                               *
     C***CALLS********-* MM1007, CALCULATE INTEREST.                  *   S01392
     C*  CALLS        -  MM1030, CALCULATE INTEREST.                  *   S01392
     C*               -  MM1004, DETERMINE DATE OF NEXT PAYMENT.      *
     C*  CALLS        -  ZDAT10 - CONVERT YYYYMMDD TO MIDAS DAY NUMBER*   S01328
     C*                                                               *
     C*  FIELDS INPUT @@TINT - TOTAL INTEREST                         *
     C*               @@INTD - INTEREST TO DATE                       *
     C*               @@INFQ - INTEREST PAYMENT FREQUENCY             *
     C*               @@NXIP - NEXT INTEREST PAYMENT DATE             *
     C*               @@VDAT - VALUE DATE                             *
     C*               @@INCM - INTEREST CALCULATION METHOD            *
     C*               @@DLAM - DEAL AMOUNT                            *
     C*               @@EIRT - EFFECTIVE INTEREST RATE                *
     C*               @@MTXI - TAXABLE INDICATOR                      *
     C*               @@DEAL - DEAL NUMBER   6N                       *
     C*               @@BRMD - MATURITY DATE FOR BRT CALCULATION      *   S01383
     C*               @BRTRT - BRT TAX RATE FROM LF/SDBRTDL1          *   S01383
     C*               @BTAXR - @BRTRT MULT. BY 1 OR 0.5               *   S01383
     C*                                                               *
     C*  FIELD OUTPUT @@INMT - INTEREST AT MATURITY                   *
     C*                                                               *
     C*  WORKFIELDS   @O     - ARRAY FIELD HOLDING FORMATTED AMOUNT   *
     C*               @@A    - INDEX FIELD FOR REFERENCING @O         *
     C*                                                               *
     C*****************************************************************
     C           MM1010    BEGSR
     C*
     C*   INITIALISE FIELDS
     C*********************MOVEL'01'      @@KEY  12                       S01194
     C*********************MOVE '40'      @@KEY                           S01194
     C                     Z-ADD*ZEROS    @@NPDT  50
     C                     Z-ADD@@DEAL    @@DEAL  60
     C*
     C*   TEST IF RECORD HAS ALREADY BEEN READ - IF NOT READ IT
     C*
     C***********KEY*******IFNE @@KEY                      *** B 1        S01194
     C***********@@KEY*****CHAINFXTB40LL             90                   S01194
     C*********************END                             *** E 1        S01194
     C           *IN50     IFNE '1'                        *** B 1        S01194
     C** Access Deal details via access program                           S01194
     C**********           CALL 'AODEALR0'                                S01194              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01194              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       S01280
     C                     MOVEL'SDDEALPD'DBFILE                          S01194
     C                     MOVEL'MM0101'  DBPGM            ***************S01194
     C                     Z-ADD007       DBASE            * DBERROR 007 *S01194
     C                     MOVEL@OPTN     DBKEY            *             *S01194
     C                     MOVE @OPTN     DBOPTN  7        *             *S01194
     C                     MOVE 'E'       @TERM            ***************S01194
     C                     OUT  LDA                                       S01280
     C                     DUMP                            *1             S01194
     C                     GOTO M11010                     *1             S01194
     C                     END                             E1             S01194
     C                     MOVE '1'       *IN50                           S01194
     C                     END                             *** E 1        S01194
     C*
     C*   CALCULATE TAX AMOUNT
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0101CCP6                                           S01408
      *                                                                                       CDL013
      *** if CAR CDL013 is installed.                                                         CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
      *** if Tax indicator is ZERO set WHT rate to ZERO.                                      CDL013
     C           TAXI      IFEQ '0'                                                           CDL013
     C                     Z-ADD0         ULWHTR  52                                          CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** Set WHT rate.                                                                       CDL013
     C                     SELEC                                                              CDL013
     C           TAXI      WHEQ '1'                                                           CDL013
     C                     Z-ADDETXR1     ULWHTR                                              CDL013
     C           TAXI      WHEQ '2'                                                           CDL013
     C                     Z-ADDETXR2     ULWHTR                                              CDL013
     C           TAXI      WHEQ '3'                                                           CDL013
     C                     Z-ADDETXR3     ULWHTR                                              CDL013
     C           TAXI      WHEQ '4'                                                           CDL013
     C                     Z-ADDETXR4     ULWHTR                                              CDL013
     C           TAXI      WHEQ '5'                                                           CDL013
     C                     Z-ADDETXR5     ULWHTR                                              CDL013
     C           TAXI      WHEQ '6'                                                           CDL013
     C                     Z-ADDETXR6     ULWHTR                                              CDL013
     C           TAXI      WHEQ '7'                                                           CDL013
     C                     Z-ADDETXR7     ULWHTR                                              CDL013
     C           TAXI      WHEQ '8'                                                           CDL013
     C                     Z-ADDETXR8     ULWHTR                                              CDL013
     C           TAXI      WHEQ '9'                                                           CDL013
     C                     Z-ADDETXR9     ULWHTR                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** If WHT rate is ZERO set tax amount to ZERO.                                         CDL013
     C           ULWHTR    IFEQ *ZERO                                                         CDL013
     C                     Z-ADD0         @@TXAM                                              CDL013
      *                                                                                       CDL013
      *** otherwise calculate tax amount.                                                     CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** if Deal Ccy is equal to Base Ccy round down Interest Amount.                        CDL013
      ** and CDL081 is off                                                                    CDL081
      *                                                                                       CDL081
     C           ZCCY      IFEQ BJCYCD                                                        CDL013
     C           CDL081    ANDEQ'N'                                                           CDL081
      *                                                                                       CDL013
      *** set work adjustment field according to decimal places.                              CDL013
     C                     SELEC                                                              CDL013
     C           A6NBDP    WHEQ 1                                                             CDL013
     C                     Z-ADD10        ULWKAD  40                                          CDL013
     C           A6NBDP    WHEQ 2                                                             CDL013
     C                     Z-ADD100       ULWKAD                                              CDL013
     C           A6NBDP    WHEQ 3                                                             CDL013
     C                     Z-ADD1000      ULWKAD                                              CDL013
     C           A6NBDP    WHEQ 0                                                             CDL013
     C                     Z-ADD1         ULWKAD                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
      *** round down Interest Amount.                                                         CDL013
     C           @@TINT    DIV  ULWKAD    ULTINT 150                                          CDL013
     C                     MULT ULWKAD    ULTINT                                              CDL013
      *                                                                                       CDL013
      *** calculate and then round down Tax Amount.                                           CDL013
     C           ULTINT    MULT ULWHTR    @@TXAM                                              CDL013
     C                     DIV  100       @@TXAM                                              CDL013
     C           @@TXAM    DIV  ULWKAD    ULTXAM 150                                          CDL013
     C           ULTXAM    MULT ULWKAD    @@TXAM                                              CDL013
      *                                                                                       CDL013
      *** otherwise (Deal Ccy NOT = Base Ccy) calculate Tax amount                            CDL013
      *** without rounding down.                                                              CDL013
     C                     ELSE                                                               CDL013
     C           @@TINT    MULT ULWHTR    @@TXAM                                              CDL013
      *                                                                                       CDL081
      ** Check if tax amount is to be rounded down                                            CDL081
      *                                                                                       CDL081
     C           ZCCY      IFEQ BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C           ZCCY      ORNE BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#NBRD    ANDEQ'Y'                                                           CDL081
     C                     DIV  100       @@TXAM                                              CDL081
     C                     ELSE                                                               CDL081
     C                     DIV  100       @@TXAM    H                                         CDL013
     C                     ENDIF                                                              CDL081
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** otherwise perform Original Tax calculations.                                        CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C*   (ZERO IF TAX INDICATOR IS NOT 'Y')                              S01383
     C*                                                                   S01383
     C           @@MTXI    IFEQ *BLANKS                    *** B 1
     C           @@MTXI    OREQ 'X'                                       S01383
     C           @@MTXI    OREQ 'N'                                       S01383
     C                     Z-ADD*ZEROS    @@TXAM 155
     C                     ELSE                            *** X
      *                    ****
     C                     Z-ADD*ZEROS    @@TXAM                          S01383
     C/COPY WNCPYSRC,MM0101C012
     C*                                                                   S01383
     C** IF BRT SAR INSTALLED                                             S01383
     C*                                                                   S01383
     C           S01383    IFEQ 'Y'                        *** B 2        S01383
     C*                                                                   S01383
     C           @@BRMD    IFGT 0                          *** B 3        S01383
     C*                                                                   S01383
     C           @@BRMD    IFGE DEFF                       *** B 4        S01383
     C                     Z-ADDBRTR      @BRTRT  75                      S01383
     C                     ELSE                                           S01383
     C                     Z-ADDPBRTR     @BRTRT                          S01383
     C                     END                             *** E 4        S01383
     C*                                                                   S01383
     C** ACCESS SDCBRTL1 FOR DEAL CUSTOMER'S BRT TAX INDICATOR (TAXIND)   S01383
     C** if *in70 is on, then it is a data base error                     S01383
     C*                                                                   S01383
     C           @CNUM     CHAINSDCBRTL1             70                   S01383
     C*                                                                   S01383
     C           *IN70     IFEQ '1'                        *** B 4        S01383
     C           XRECI     ORNE 'D'                        ***************S01383
     C                     MOVEL'SDCBRTPD'DBFILE           * DBERROR 008 *S01383
     C                     MOVEL'MM0101'  DBPGM            ***************S01383
     C                     Z-ADD008       DBASE                           S01383
     C                     MOVEL@CNUM     DBKEY                           S01383
     C                     MOVE 'E'       @TERM                           S01383
     C                     DUMP                                           S01383
     C                     GOTO M11010                                    S01383
     C                     END                             *** E 4        S01383
     C*                                                                   S01383
     C           TAXIND    IFEQ 'L'                        *** B 4        S01383
     C           TAXIND    OREQ 'P'                                       S01383
     C*                                                                   S01383
     C** TAX RATE FOR PART-LIABLE CUSTOMERS IS HALF THE BASIC RATE.       S01383
     C*                                                                   S01383
     C           TAXIND    IFEQ 'L'                        *** B 5        S01383
     C                     Z-ADD@BRTRT    @BTAXR  86                      S01383
     C                     ELSE                                X 5        S01383
     C           0.5       MULT @BRTRT    @BTAXR                          S01383
     C                     END                             *** E 5        S01383
     C*                                                                   S01383
     C/COPY WNCPYSRC,MM0101C013
     C           @@TINT    MULT @BTAXR    @@TXAM                          S01383
     C/COPY WNCPYSRC,MM0101C014
     C           @@TXAM    DIV  100       @@TXAM                          S01383
     C                     END                             *** E 4        S01383
     C*                                                                   S01383
     C                     END                             *** E 3        S01383
     C*                                                                   S01383
     C** ELSE BRT SAR NOT INSTALLED                                       S01383
     C*                                                                   S01383
     C                     ELSE                            *** X 2        S01383
     C***********@@TINT****MULT TAXR      @@TXAM                          S01194
     C/COPY WNCPYSRC,MM0101C015
     C           @@TINT    MULT BNHKTR    @@TXAM                          S01194
     C/COPY WNCPYSRC,MM0101C016
     C           @@TXAM    DIV  100       @@TXAM
     C                     END                             *** E 2        S01383
     C/COPY WNCPYSRC,MMH00197
     C                     END                             *** E 1
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0101CCP7                                           S01408
     C*                                                                   S01408
     C*
     C*  FIND INTEREST AT MATURITY - NO INTERIM PAYMENTS
     C*
     C           @@NXIP    IFEQ *ZEROS                     *** B 1
     C           FXKEY     KLIST
     C                     KFLD           @@DEAL
      *  CHECK THERE ARE NO DEAL AMENDMENTS
     C           @@DEAL    CHAINMMDEAMLL             90
     C           *IN90     IFEQ '1'
     C           @@TINT    SUB  @@INTD    @@INMT 150        *** B 2
     C                     SUB  @@TXAM    @@INMT
     C                     GOTO M11010                      ---------->
     C                     END                              *** E 2
      *
     C                     END                              *** E 1
      *
      *  CHECK THERE ARE NO DEAL AMENDMENTS
     C           @@DEAL    CHAINMMDEAMLL             90
      *  IF THERE ARE GET THE LATEST
     C           *IN90     IFEQ '0'                         *** B 1
     C           @@EOF     DOUEQ'Y'                         *** B 2
     C           @@DEAL    READEMMDEAMLL                 90
     C   90                MOVE 'Y'       @@EOF   1
     C                     END                              *** E 2
      *REFORMAT DATE FROM YYYMMDD TO MIDAS FORM
     C*********************Z-ADDHNDATE    @@DTIN                          S01328
     C*********************EXSR ZA0680                                    S01328
     C                     Z-ADDHNDATE    ZZDTIN                          S01328
     C                     EXSR ZDAT10                                    S01328
      *   STORE DATE
     C*********************Z-ADD@@MDNO    @@ENDD  50                      S01328
     C                     Z-ADDZZMDNO    @@ENDD  50                      S01328
     C                     ELSE                            *** X
      *  IF NO AMENDMENTS  ****
      *  DETERMINE END DATE
      *
     C           @@NXIP    IFNE *ZEROS                     *** B 2
     C           @@INFQ    IFEQ *BLANKS                    *** B 3
     C*   LOAD FIELD
     C                     Z-ADD@@NXIP    @@ENDD
     C                     ELSE                            *** X
     C*                    ****
     C                     Z-ADD@@NXIP    @@DAYN
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
      *  LOAD INPUT PARAMETER
     C                     Z-ADD@@VDT     @@STRT  80
     C                     MOVE @@INFQ    @@FREQ  1
     C*  CALL COMMON ROUTINE
     C                     EXSR MM1004
     C*  LOAD RETURNED PARAMETER - AND REFORMAT
     C*********************Z-ADD@@NDAT    @@DTIN                          S01328
     C*********************EXSR ZA0680                                    S01328
     C*********************Z-ADD@@MDNO    @@ENDD                          S01328
     C                     Z-ADD@@NDAT    ZZDTIN                          S01328
     C                     EXSR ZDAT10                                    S01328
     C                     Z-ADDZZMDNO    @@ENDD                          S01328
      *
     C                     END                             *** E 3
     C                     END                             *** E 2
     C                     END                             *** E 1
      *
      *   CALCULATE INTEREST THAT WILL BE PAID PRIOR TO MATURITY
      *
      *   LOAD PARAMETERS
      *   ===============
      *
     C***********          Z-ADD@@VDAT    @@BEG                           056095
     C***********          Z-ADD@@ENDD    @@END                           056095
     C***********          MOVE @@INCM    @@CALC                          056095
     C                     Z-ADD@@VDAT    ZZBEG                           056095
     C                     Z-ADD@@ENDD    ZZEND                           056095
     C                     MOVE @@INCM    ZZCALC                          056095
     C                     Z-ADD@@DLAM    @@AMT  150
     C                     Z-ADD@@EIRT    @@RATE 117
     C                     MOVELJRDFC     @@RDFC  1                       S01392
     C*
     C*   CALL COMMON ROUTINE
     C*********************EXSR MM1007                                    S01392
     C                     EXSR MM1030                                    S01392
     C*
     C*   CALCULATE INTEREST AT MATURITY
     C*
     C           @@TINT    SUB  @@INTR    @@INMT
     C           @@INMT    SUB  @@TXAM    @@INMT
      *
      *  DEFINE INPUT FIELDS WHICH HAVE NOT BEEN DEFINED ALREADY
     C                     GOTO M11010
     C                     Z-ADD0         @@TINT 150
     C                     Z-ADD0         @@INTD 130
     C                     MOVE *BLANK    @@INFQ  1
     C                     Z-ADD0         @@NXIP  50
     C                     Z-ADD0         @@VDAT  50
     C                     MOVE *BLANK    @@INCM  1
     C                     Z-ADD0         @@DLAM 150
     C                     Z-ADD0         @@EIRT 117
     C                     MOVE *BLANK    @@MTXI  1
      *
     C           M11010    ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************   S01392
     C****MM1007*- CALCULATE INTEREST                                 *   S01392
     C***********                                                     *   S01392
     C***CALLED*BY    -                                               *   S01392
     C***********                                                     *   S01392
     C***CALLS***     -   MM1009 CALCULATE NO. OF INTEREST DAYS       *   S01392
     C***********                                                     *   S01392
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                   *   S01392
     C***********     @@END  - END DATE OF PERIOD                     *   S01392
     C***********     @@CALC - INTEREST CALCULATION METHOD            *   S01392
     C***********     @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C***********     @@RATE - INTEREST RATE 11,7                     *   S01392
     C***********                                                     *   S01392
     C***FIELDS*OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C***********                                                     *   S01392
     C***WORK*FIELDS   @@W155 - 15,5                                      S01392
     C***********                                                     *   S01392
     C*****************************************************************   S01392
     C***********MM1007    BEGSR                                          S01392
     C***********                                                         S01392
     C****CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C***********          EXSR MM1009                                    S01392
     C***********                                                         S01392
     C***********@@CALC    IFEQ '2'                        *** B 1        S01392
     C***********@@CALC    OREQ '3'                                       S01392
     C***********@@CALC    OREQ '5'                                       S01392
     C***********@@AMT     DIV  36000     @@W155 155                      S01392
     C***********          END                             *** E 1        S01392
     C***********                                                         S01392
     C***********@@CALC    IFEQ '1'                        *** B 1        S01392
     C***********@@CALC    OREQ '4'                                       S01392
     C***********@@AMT     DIV  36500     @@W155                          S01392
     C***********          END                              *** E 1       S01392
     C***********                                                         S01392
     C***********@@CALC    IFEQ '6'                         *** B 1       S01392
     C***********@@AMT     DIV  36600     @@W155                          S01392
     C***********          END                              *** E 1       S01392
     C***********                                                         S01392
     C***********          MULT @@RATE    @@W155                          S01392
     C***********@@W155    MULT @@INDY    @@INTR 150H                     S01392
     C***********                                                         S01392
     C***********          GOTO M10079                                    S01392
     C***********          Z-ADD0         @@AMT  150                      S01392
     C***********          Z-ADD0         @@RATE                          S01392
     C***********                                                         S01392
     C***********M10079    ENDSR                                          S01392
     C*****************************************************************   S01392
     C*                                                               *   S01392
     C*   MM1030 - CALCULATE INTEREST                                 *   S01392
     C*                                                               *   S01392
      *  (c) Finastra International Limited 2001                      *
     C*  CALLED BY    -                                               *   S01392
     C*                                                               *   S01392
     C***CALLS********-***MM1009*CALCULATE*NO.*OF*INTEREST*DAYS*****S01392056095
     C*  CALLS        -   ZINTDY CALCULATE NO. OF INTEREST DAYS       *   056095
     C*                                                               *   S01392
     C***FIELDS*INPUT*@@BEG**-*START*DATE*OF*PERIOD*****************S01392056095
     C****************@@END**-*END*DATE*OF*PERIOD*******************S01392056095
     C****************@@CALC*-*INTEREST*CALCULATION*METHOD**********S01392056095
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   056095
     C*               ZZEND  - END DATE OF PERIOD                     *   056095
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   056095
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C*               @@RATE - INTEREST RATE 11,7                     *   S01392
     C*               @@RDFC - ROUND DOWN FACILITY IND 1              *   S01392
     C*                                                               *   S01392
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C*                                                               *   S01392
     C*  WORK FIELDS   @@W157 - 15,5                                  *   S01392
     C*****************@@W150*-*15,0*******************************S01392 056121
     C*                @@W210 - 21,0                                  *   056121
     C*                @@YEAR - (NUMBER OF DAYS IN YEAR) x 100        *   S01392
     C*                                                               *   S01392
     C*****************************************************************   S01392
     C           MM1030    BEGSR                                          S01392
     C*                                                                   S01392
     C*   CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C*                                                                   S01392
     C/COPY WNCPYSRC,MM0101C001
     C***********          EXSR MM1009                              S01392056095
     C                     Z-ADDZZBEG     ZZBEG9  50                                          CDL093
     C                     Z-ADDZZEND     ZZEND9  50                                          CDL093
      *                                                                                       CDL093
      ** check if 29th Feb is included                                                        CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
      *                                                                                       CDL093
      ** Convert start date to YYYYMMDD format                                                CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZBEG9    @@DAYN  50                                          CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATA  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY1   40                                          CDL093
      *                                                                                       CDL093
      ** Convert end date to YYYYMMDD format                                                  CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZEND9    @@DAYN                                              CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATB  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY2   40                                          CDL093
      *                                                                                       CDL093
     C                     EXSR #FEB29                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           HKNIPD    ANDNE*ZERO                                                         CDL093
     C           HKNIPD    ANDLTZZEND                                                         CDL093
      *                                                                                       CDL093
     C                     Z-ADDHKIPDM    @@IPDM  20                                          CDL093
     C                     CALL 'MM001031'                                                    CDL093
     C                     PARM           ZZBEG                                               CDL093
     C                     PARM           ZZEND                                               CDL093
     C                     PARM           HKNIPD                                              CDL093
     C                     PARM '9'       ZZCALC                                              CDL093
     C                     PARM           HKIPFQ                                              CDL093
     C                     PARM           @@AMT                                               CDL093
     C                     PARM           @@RATE                                              CDL093
     C                     PARM 'N'       RNDDWN  1                                           CDL093
     C                     PARM 'N'       FRSLST  1                                           CDL093
     C                     PARM           @@IPDM                                              CDL093
     C                     PARM           WINTR                                               CDL093
      *                                                                                       CDL093
     C                     Z-ADDWINTR     @@INTR                                              CDL093
     C           *LIKE     DEFN @@INTR    WINTR                                               CDL093
      *                                                                                       CDL093
     C                     GOTO INTCLC                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C                     EXSR ZINTDY                                    056095
     C*                                                                   S01392
     C***********@@CALC    IFEQ '2'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '3'                                 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C           ZZCALC    IFEQ '2'                        *** B 1        056095
     C           ZZCALC    OREQ '3'                                       056095
     C           ZZCALC    OREQ '5'                                       056095
     C           ZZCALC    OREQ '7'                                       CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C           ZZCALC    OREQ '0'                                                          CER016A
     C                     Z-ADD36000     @@YEAR  50                      S01392
     C                     END                             *** E 1        S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '1'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '4'                                 S01392056095
     C           ZZCALC    IFEQ '1'                        *** B 1        056095
     C           ZZCALC    OREQ '4'                                       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDNE'Y'                                                           CDL093
     C                     Z-ADD36500     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '6'                         *** B 1 S01392056095
     C           ZZCALC    IFEQ '6'                         *** B 1       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C                     Z-ADD36600     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C           ZZCALC    IFEQ '6'                                       163136
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           INT6DY    MULT @@RATE    @@W157                          163136
     C                     ELSE                                           163136
      *                                                                   163136
     C***********@@INDY    MULT @@RATE    @@W157 157                S01392056095
     C           ZZINDY    MULT @@RATE    @@W157 157                      056095
      *                                                                   163136
     C                     END                                            163136
      *                                                                   163136
     C***********@@W157    MULT @@AMT     @@W150 150H              S01392 056121
     C           @@W157    MULT @@AMT     @@W210 210H                     056121
     C*                                                                   S01392
     C**  ROUND DOWN IF ROUND DOWN INDICATOR IS 'Y'                       S01392
     C*                                                                   S01392
     C           @@RDFC    IFEQ 'Y'                                       S01392
     C***********@@W150    DIV  @@YEAR    @@INTR                   S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR                          056121
     C                     ELSE                                           S01392
     C***********@@W150    DIV  @@YEAR    @@INTR 150H              S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR 150H                     056121
     C                     END                                            S01392
     C*                                                                   S01392
     C/COPY WNCPYSRC,MM0101C002
      * Interest has been calculated                                                          CDL093
     C           INTCLC    TAG                                                                CDL093
     C           M10309    ENDSR                                          S01392
     C*****************************************************************
     C/EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZINTDYZ2                                               056095
     C*****************************************************************
     C****MM1009*- CALCULATE THE NUMBER OF INTEREST DAYS              *   056095
     C***********                                                     *   056095
     C***CALLED*BY    -                                               *   056095
     C***********                                                     *   056095
     C***CALLS********-***ZA0710*CONVERT*MIDAS*DAY*NUMBER*TO*YMD*DATS01328056095
     C***CALLS***     -   ZDATE9 CONVERT MIDAS DAY NUMBER TO YMD DATS01328056095
     C***********                                                     *   056095
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                   *   056095
     C***********     @@END  - END DATE OF PERIOD                     *   056095
     C***********     @@CALC - INTEREST CALCULATION METHOD            *   056095
     C***********                                                     *   056095
     C***FIELDS*OUTPUT @@INDY - NO. OF INTEREST DAYS                  *   056095
     C***********                                                     *   056095
     C***WORKFIELDS   @@WN5   - WORK FIELD 5N                         *   056095
     C***********     @@WN5A  - WORK FIELD 5N                         *   056095
     C***********     @@WDAT  - WORK FIELD 5N                         *   056095
     C***********     @@DAYN  - WORK FIELD 5N                         *   056095
     C***********     @@P1    - WORK FIELD 5N                         *   056095
     C***********     @@P2    - WORK FIELD 5N                         *   056095
     C***********     @@P3    - WORK FIELD 5N                         *   056095
     C***********     @@LPNM  - WORKFIELD USED IN SETTING UP @@TG10   *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********MM1009    BEGSR                                          056095
     C***********                                                         056095
     C***********          MOVE @@BEG     @@BEG   50                      056095
     C***********          MOVE @@END     @@END   50                      056095
     C***********          MOVE @@CALC    @@CALC  1                       056095
     C***********          Z-ADD*ZEROS    @@INDY                          056095
     C***********          Z-ADD*ZEROS    @@LPNM                          056095
     C***********                                                         056095
     C***FIND*NUMBER OF DAYS DIFFERENCE BETWEEN DATES                     056095
     C***********                                                         056095
     C***********@@END     SUB  @@BEG     @@WDAT  50                      056095
     C***********                                                         056095
     C*****FOR*CALCULATION METHODS 3,4 OR 5.                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***********@@CALC    OREQ '4'                                       056095
     C***********@@CALC    OREQ '5'                                       056095
     C***********                                                         056095
     C***********          Z-ADD@@BEG     @@DAYN  50                      056095
     C*********************EXSR ZA0710                              S01328056095
     C***********          EXSR ZDATE9                              S01328056095
     C***********          Z-ADD@@VDT     @@DATA                          056095
     C***********                                                         056095
     C***********          Z-ADD@@END     @@DAYN                          056095
     C*********************EXSR ZA0710                              S01328056095
     C***********          EXSR ZDATE9                              S01328056095
     C***********          Z-ADD@@VDT     @@DATB                          056095
     C***IF*IN*SAME MONTH                                                 056095
     C***********@@YY1     IFEQ @@YY2                      **** B 2       056095
     C***********@@MM1     IFEQ @@MM2                      **** B 3       056095
     C***********@@DD2     SUB  @@DD1     @@INDY                          056095
     C***********          GOTO M10099                     --------->     056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C**IF*NOT*3,4 OR 5    ****                                           056095
     C**EXIT*PROCESSING                                                   056095
     C***********          Z-ADD@@WDAT    @@INDY  50       - LOAD OUTPT   056095
     C***********          GOTO M10099                     ----------->   056095
     C***********          END                             **** E 1       056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***CALC*NO. DAYS IN FIRST MONTH                                     056095
     C***********@@MM1     IFNE 2                          **** B 2       056095
     C***********30        SUB  @@DD1     @@P1    50   80                 056095
     C***IF*<*0,*INITIALISE TO 0                                          056095
     C***80******          Z-ADD*ZEROS    @@P1                            056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C***TEST*IF*LEAP      ****                                           056095
     C***YEAR****                                                         056095
     C***********@@YY1     DIV  4         @@WN5                           056095
     C***********          MVR            @@WN5          80               056095
     C***********                                                         056095
     C************IN80     IFEQ '1'                        **** B 3       056095
     C***********29        SUB  @@DD1     @@P1    50                      056095
     C***********          ELSE                                           056095
     C***IF*NOT*LEAP       ++++                                           056095
     C***********28        SUB  @@DD1     @@P1    50                      056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***CALC.*NO. DAYS IN LAST MONTH                                     056095
     C***********@@DD2     IFLE 30                         **** B 2       056095
     C***********          Z-ADD@@DD2     @@P2    50                      056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********          Z-ADD30        @@P2                            056095
     C***********          END                             **** E 2       056095
     C***CALC*NO. DAYS IN INTERVENING MONTHS                              056095
     C***********@@YY2     IFEQ @@YY1                      **** B 2       056095
     C***********@@MM2     SUB  @@MM1     @@P3    50                      056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 30        @@P3                            056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********@@YY2     SUB  @@YY1     @@P3                            056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 360       @@P3                            056095
     C***********                                                         056095
     C**FIND*NO.*OF MONTHS FOR THE TWO PARTIAL YEARS                      056095
     C***********12        SUB  @@MM1     @@WN5A  50                      056095
     C***********          MULT 30        @@WN5A                          056095
     C***********                                                         056095
     C***********@@MM2     SUB  1         @@WN5                           056095
     C***********@@WN5     MULT 30        @@WN5                           056095
     C***ACCUMULATE                                                       056095
     C***********@@WN5A    ADD  @@WN5     @@WN5A                          056095
     C***********@@P3      ADD  @@WN5A    @@P3                            056095
     C***********          END                             **** E 2       056095
     C***FINAL*SUM                                                        056095
     C***********                                                         056095
     C***********@@P1      ADD  @@P2      @@INDY                          056095
     C***********          ADD  @@P3      @@INDY                          056095
     C***********          END                             **** E 1       056095
     C***FOR*METHODS 4 AND 5                                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '4'                        **** B 1       056095
     C***********@@CALC    OREQ '5'                                       056095
     C****CALCULATE NUMBER OF LEAP YEARS BETWEEN START AND END DATES      056095
     C***********@@MM1     IFLE 2                          **** B 2       056095
     C***********@@YY1     DIV  4         @@WN5   50                   YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM  50                      056095
     C***********          END                             **** E 3       056095
     C***BYPASS*IF YEARS ARE THE SAME                                     056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          GOTO M10099                     ---------->    056095
     C***********          END                             **** E 2       056095
     C***LOOP*TO*CALCULATE NO. LEAP YEARS                                 056095
     C***********@@YY1     DOWNE@@YY2                      **** B 2       056095
     C***INCREMENT START YEAR                                             056095
     C***********          ADD  1         @@YY1                           056095
     C***********                                                         056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@MM2     IFGT 2                          **** B 4       056095
     C***********@@YY2     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***INCREMENT IF LEAP YEAR                                           056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 4      056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          END                              **** E 3      056095
     C***********@@YY1     IFNE @@YY2                       **** B 3      056095
     C***********@@YY1     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 3      056095
     C***********          END                              **** E 2      056095
     C***********          END                              **** E 1      056095
     C***********                                                         056095
     C***********M10099    ENDSR                           ***M10099***   056095
     C*******************************************************************
     C/EJECT
      /COPY ZSRSRC,ZDATE9Z3                                               S01328
     C/COPY ZSRSRC,ZFEB29                                                                     CDL093
     C/EJECT
      /COPY ZSRSRC,ZDAT10Z2                                               S01328
     C****************************************************************    S01328
     C****************************************************************    S01328
     C**ZA0680*-*THIS*SUBROUTINE*CONVERTS*YYYYMMDD*FORMAT*DATE*TO*****    S01328
     C***********MIDAS*DAY*NUMBER*FORMAT*(NO.*DAYS*FROM*31/12/71)*****    S01328
     C****************************************************************    S01328
     C**CALLED*BY*:***************************************************    S01328
     C****************************************************************    S01328
     C**CALLS*:*******************************************************    S01328
     C****************************************************************    S01328
     C**INPUT**:*@@DTIN*DATE*(YYYYMMDD)*-*IN*DATA*STRUCTURE*(SIZE*:*8N)   S01328
     C****************************************************************    S01328
     C**OUTPUT*:*@@MDNO*MIDAS*DAY*NUMBER**(SIZE*:*5N)*****************    S01328
     C****************************************************************    S01328
     C**USES*:***@@CC***NUMBER*OF*CENTURIES*IN*DATE*******************    S01328
     C***********@@DAY**DAY*NUMBER************************************    S01328
     C***********@@REM**REMAINDER*FROM*DIVIDE*************************    S01328
     C***********@@MTH**MONTH*NUMBER**********************************    S01328
     C***********@MD****COMPILATION*TIME*ARRAY*FOR*CUMULATIVE*DAYS*IN*    S01328
     C******************MONTH*****************************************    S01328
     C***********@@WK2**WORK*FIELD*(2,0)******************************    S01328
     C***********@@WK5**WORK*FIELD*(5,0)******************************    S01328
     C***********@@YYYY*YEAR*(4*CHARACTER)****************************    S01328
     C***********@@YY***YEAR*(2*CHARACTER)****************************    S01328
     C***********@YD****COMPILATION*TIME*ARRAY*FOR*CUMULATIVE*DAYS*IN*    S01328
     C******************A*FOUR*YEAR*PERIOD****************************    S01328
     C****************************************************************    S01328
     C******LAST*AMEND*NO.*ME1257**************DATE*02/04/87**********    S01328
     C******When*date*input*is*zero*set*output*date*to*zeroes*********    S01328
     C****************************************************************    S01328
     C****************************************************************    S01328
     C****************************************************************    S01328
     C***********ZA0680****BEGSR**************************************    S01328
     C****************************************************************    S01328
     C****CLEAR*OUT*ANY*'OLD'*DATA*IN*FIELD***************************    S01328
     C*********************Z-ADD0*********@@MDNO**50******************    S01328
     C****************************************************************    S01328
     C***********@@DTIN****CABEQ0*********ZA0689********************ME1257S01328
     C****************************************************************    S01328
     C*****IF*DATE*GREATER*THAN*31/12/2071*NEED*EXTRA*PROCESSING******    S01328
     C*****WORK*OUT*THE*NUMBER*OF*CENTURIES*PASSED*SINCE*1971,********    S01328
     C*****BY*SUBTRACTING*1972*FROM*THE*YEAR*FIELD.*******************    S01328
     C***********@@YYYY****IFGE*2072***********************B1*********    S01328
     C***********@@YYYY****SUB**1972******@@YYYY************1*********    S01328
     C****************************************************************    S01328
     C*****MULTIPLY*BY*NUMBER*OF*DAYS*IN*CENTURY*(SINCE*1971)*********    S01328
     C*****THEN*RESTORE*THE*YEAR*WHICH*WAS*INPUT*BACK*TO*THE**********    S01328
     C*****ORIGINAL*VALUE*BEFORE*CONTINUING*WITH*NORMAL*CALCULATIONS.*    S01328
     C****************************************************************    S01328
     C***********@@CC******MULT*36524*****@@MDNO************1*********    S01328
     C***********@@YYYY****ADD**1972******@@YYYY************1*********    S01328
     C*********************END*****************************E1*********    S01328
     C****************************************************************    S01328
     C***********@@YYYY****ADD**28********@@WK2***20******************    S01328
     C****************************************************************    S01328
     C***********@@WK2*****DIV**4*********@@WK2***********************    S01328
     C*********************MVR************@@REM***10******************    S01328
     C****************************************************************    S01328
     C******MULTIPLY*BY*NUMBER*OF*DAYS*IN*FOUR*YEAR*PERIOD************    S01328
     C***********@@WK2*****MULT*1461******@@WK5***50******************    S01328
     C*********************ADD**@@WK5*****@@MDNO**********************    S01328
     C****************************************************************    S01328
     C****CHECK*REMAINDER*AND*MONTH*NUMBER****************************    S01328
     C***********@@REM*****IFEQ*0**************************B1*********    S01328
     C***********@@MTH*****ANDGT2**************************B1*********    S01328
     C*********************ADD**1*********@@MDNO************1*********    S01328
     C*********************END*****************************E1*********    S01328
     C****************************************************************    S01328
     C****YEAR*NOT*LEAP*YEAR,**ADD*CUMULATIVE*DAYS*FOR*YEAR***********    S01328
     C***********@@REM*****IFNE*0**************************B1*********    S01328
     C*********************ADD**@YD,@@REM*@@MDNO************1*********    S01328
     C*********************END*****************************E1*********    S01328
     C****************************************************************    S01328
     C****ADD*MONTHS*THIS*YEAR****************************************    S01328
     C*********************ADD**@MD,@@MTH*@@MDNO**********************    S01328
     C****************************************************************    S01328
     C****ADD*DAYS*THIS*MONTH*****************************************    S01328
     C*********************ADD**@@DAY*****@@MDNO**********************    S01328
     C****************************************************************    S01328
     C***********ZA0689****ENDSR*****************************ZA0689*TAG** S01328
     C*****************************************************************   S01328
     C****************************************************************    S01328
     C*EJECT**********************************************************    S01328
     C*****************************************************************   S01328
     C*****************************************************************   S01328
     C********TITLE:CALCULATE*MIDAS*DAY*NO.*TO*DRS*(YYYYMMDD)*FORMAT.**   S01328
     C*****************************************************************   S01328
     C********SUBROUTINE*ZA0710*EXPECTS*FIELD*'@@DAYN'*TO*BE***********   S01328
     C********PASSED*TO*IT*IN*5,0*FORMAT.IF*THE*ABOVE*FIELD*IS*LESS****   S01328
     C********THAN*1*IT*RETURNS*1*IN*FIELD*'@@RTN'.THE*MAIN*PROGRAM****   S01328
     C********SHOULD*CHECK*FOR*THIS*CONDITION*AND*DO*THE*NECESSARY.****   S01328
     C********IF*'@@RTN'*IS*NOT*EQUAL*TO*1*IT*RETURNS*THE*FIELD********   S01328
     C********'@@VDT'**IN*'YYYYMMDD'*FORMAT.***************************   S01328
     C*****************************************************************   S01328
     C**NOTE:*FIELD*TO*BE*DEFINED*BY*EXTERNAL*ROUTINE*IS**************    S01328
     C*****************************************************************   S01328
     C********1)*@@DAYN***LENGTH*5,0.**********************************   S01328
     C*****************************************************************   S01328
     C********FIELDS*USED*AND*ALREADY*DEFINED*IN*THE*ROUTINE*ARE:******   S01328
     C*****************************************************************   S01328
     C********1)*@@VDT****LENGTH*8,0*DEFINED*BY*A*DS.******************   S01328
     C********2)*@@RTN****LENGTH*1,0.**********************************   S01328
     C********3)*@@I******LENGTH*2,0*USED*TO*ACCESS*ARRAY*@YD**********   S01328
     C********4)*@@J******LENGTH*2,0*USED*TO*ACCESS*ARRAY*@MD**********   S01328
     C********5)*@@Z71Y***LENGTH*4,0*DEFINED*BY*A*DS.******************   S01328
     C********6)*@@RDAY***LENGTH*5,0.**********************************   S01328
     C********7)*@@LEAP***LENGTH*1,0.*********************************    S01328
     C*****************************************************************   S01328
     C********INDICATORS*USED*ARE:*************************************   S01328
     C*****************************************************************   S01328
     C********1)*80*******CHECK*FOR*LOW*AND*EQUAL*ON*ARRAY*@YD*********   S01328
     C********2)*81*******CHECK*FOR*LOW*ON*ARRAY*@MD.******************   S01328
     C*****************************************************************   S01328
     C**INPUT*FIELD:*******@@DAYN**************************************   S01328
     C*****************************************************************   S01328
     C**OUTPUT*FIELD:******@@VDT***************************************   S01328
     C*****************************************************************   S01328
     C**WORK*FIELDS:*******@@RTN***************************************   S01328
     C*********************@@Z71Y**************************************   S01328
     C*********************@@RDAY**************************************   S01328
     C*********************@@LEAP**************************************   S01328
     C*********************@@I*****************************************   S01328
     C*********************@@J*****************************************   S01328
     C*****************************************************************   S01328
     C**ARRAYS*USED:*******@YD*COMPILE*TIME*ARRAY.********************    S01328
     C*********************@MD*COMPILE*TIME*ARRAY.********************    S01328
     C****************************************************************    S01328
     C******LAST*AMEND*NO.*ME1257**************DATE*02/04/87**********    S01328
     C******When*date*input*is*zero*set*output*date*to*zeroes*********    S01328
     C****************************************************************    S01328
     C*****************************************************************   S01328
     C****************************************************************    S01328
     C***********ZA0710****BEGSR**************************************    S01328
     C****************************************************************    S01328
     C*********************SETOF*********************8081*************    S01328
     C*********************Z-ADD0*********@@RTN***10******************    S01328
     C*********************Z-ADD0*********@@VDT***********************    S01328
     C*********************Z-ADD1*********@@I*****20******************    S01328
     C*********************Z-ADD1*********@@J*****20******************    S01328
     C*********************Z-ADD1*********@@LEAP**10******************    S01328
     C****************************************************************    S01328
     C***********@@DAYN****CABEQ0*********ZA0719********************ME1257S01328
     C****************************************************************    S01328
     C***********@@DAYN****IFLT*1*************************************    S01328
     C*********************Z-ADD1*********@@RTN***********************    S01328
     C*********************GOTO*ZA0719********************************    S01328
     C*********************END****************************************    S01328
     C****************************************************************    S01328
     C**DIVISION*TO*DETERMINE*WETHER*LEAP*YEAR.***********************    S01328
     C****************************************************************    S01328
     C***********@@DAYN****DIV**1461******@@Z71Y**********************    S01328
     C*********************MVR************@@RDAY**50******************    S01328
     C****************************************************************    S01328
     C**CALCULATING*YEAR.*********************************************    S01328
     C****************************************************************    S01328
     C***********@@Z71Y****MULT*4*********@@Z71Y**********************    S01328
     C*********************ADD**1972******@@Z71Y**********************    S01328
     C****************************************************************    S01328
     C**CHECKING*IF*YEAR*IS*GREATER*THAN*OR*EQUAL*TO*2100*************    S01328
     C****************************************************************    S01328
     C***********@@Z71Y****IFGE*2100**********************************    S01328
     C*********************ADD**@@SSY2****@@RDAY**********************    S01328
     C*********************END****************************************    S01328
     C****************************************************************    S01328
     C**LOKUP*ARRAY*@YD*TO*SEE*HOW*MANY*YEARS*OF*A*FOUR*YEAR*CYCLE****    S01328
     C**HAVE*PASSED.**************************************************    S01328
     C****************************************************************    S01328
     C***********@@RDAY****LOKUP@YD,@@I****************8080***********    S01328
     C****************************************************************    S01328
     C**IF*YEAR*IS*A*LEAP*YEAR*SSLEAP*IS*SET*TO*ZERO.*****************    S01328
     C****************************************************************    S01328
     C************IN80*****IFEQ*'0'***********************************    S01328
     C*********************Z-ADD0*********@@LEAP**********************    S01328
     C*********************END****************************************    S01328
     C****************************************************************    S01328
     C**ADD*INDEX*TO*YEAR*TO*GIVE*CORRECT*YEAR*AND*ADJUST*'@@RDAY'.***    S01328
     C****************************************************************    S01328
     C***********@@LEAP****IFEQ*1*************************************    S01328
     C***********@@RDAY****SUB**@YD,@@I***@@RDAY**********************    S01328
     C*********************ADD**@@I*******@@Z71Y**********************    S01328
     C*********************END****************************************    S01328
     C****************************************************************    S01328
     C**PROCESSING*FOR*A*LEAP*YEAR.***********************************    S01328
     C****************************************************************    S01328
     C***********@@LEAP****IFEQ*0*************************************    S01328
     C****************************************************************    S01328
     C**IF*'@@RDAY'*=*60*DATE*MUST*BE*29TH*OF*FEBRUARY.***************    S01328
     C****************************************************************    S01328
     C***********@@RDAY****IFEQ*60************************************    S01328
     C*********************Z-ADD29********@@Z71D**********************    S01328
     C*********************Z-ADD2*********@@Z71M**********************    S01328
     C*********************GOTO*ZA0711********************************    S01328
     C*********************END****************************************    S01328
     C****************************************************************    S01328
     C**IF*'@@RDAY'*>*60*DATE*IS*AFTER*29TH*OF*FEBRUARY,CONVERSION*CAN    S01328
     C**PROCEED*AS*USUAL*AFTER*SUBTRACTING*THE*EXTRA*DAY*FOR*THE*LEAP*    S01328
     C**YEAR.*NOTE*:*'@@RDAY'*<*60*CONVERSION*PROCEEDS*AS*USUAL.******    S01328
     C****************************************************************    S01328
     C***********@@RDAY****IFGT*60************************************    S01328
     C***********@@RDAY****SUB**1*********@@RDAY**********************    S01328
     C*********************END****************************************    S01328
     C****************************************************************    S01328
     C*********************END****************************************    S01328
     C****************************************************************    S01328
     C**IF*DAY*'@@DAYN'*IS*EXACTLY*DIVISIBLE*BY*1461*(NUMBER*OF*DAYS**    S01328
     C**IN*4*YEARS)*THEN*DATE*MUST*BE*LAST*DAY*OF*PREVIOUS*FOUR*YEAR**    S01328
     C**GROUP.********************************************************    S01328
     C****************************************************************    S01328
     C***********@@RDAY****IFEQ*0*************************************    S01328
     C*********************Z-ADD31********@@Z71D**********************    S01328
     C*********************Z-ADD12********@@Z71M**********************    S01328
     C*********************SUB**1*********@@Z71Y**********************    S01328
     C*********************GOTO*ZA0711********************************    S01328
     C*********************END****************************************    S01328
     C****************************************************************    S01328
     C**LOOK*UP*ARRAY*ARRAY*@MD*TO*DETERMINE*WHICH*MONTH*'@@RDAY'*****    S01328
     C**OCCURS*IN*****************************************************    S01328
     C****************************************************************    S01328
     C***********@@RDAY****LOKUP@MD,@@J****************81*************    S01328
     C*********************Z-ADD@@J*******@@Z71M**********************    S01328
     C***********@@RDAY****SUB**@MD,@@J***@@Z71D**********************    S01328
     C****************************************************************    S01328
     C**DS*@@VDT**IS*RETURNED*IN*YYYYMMDD*FORMAT**********************    S01328
     C****************************************************************    S01328
     C***********ZA0711****TAG****************************************    S01328
     C****************************************************************    S01328
     C*********************MOVE*@@Z71Y****@@YR************************    S01328
     C****************************************************************    S01328
     C***********ZA0719****ENDSR**************************************    S01328
     C*****************************************************************   S01328
     C/EJECT
     C***********************************************************************
     C*                                                                     *
     C* MM1004 - CALCULATE THE NEXT INTEREST PAYMENT DATE                   *
     C*
     C* CALLED BY :                                                         *
     C*                                                                     *
     C**CALLS :**ZA0830,*A*COMMON ROUTINE TO DETERMINE WHETHER A DATE     S01194
     C* CALLS :  ZCHKH , A COMMON ROUTINE TO DETERMINE WHETHER A DATE     S01194
     C*          IS A WORKING DAY OR A HOLIDAY.                             *
     C********:**ZA0680,*A*COMMON*ROUTINE*TO*CONVERT*DATE*IN*YYYYMMDD*****S01328
     C*       :  ZDAT10, A COMMON ROUTINE TO CONVERT DATE IN YYYYMMDD     S01328
     C*          FORMAT TO MIDAS DAY NUMBER.                                *
     C********:**ZA0710,*A*COMMON*ROUTINE*TO*CONVERT*MIDAS*DAY*NUMBER**   S01328
     C*       :  ZDATE9, A COMMON ROUTINE TO CONVERT MIDAS DAY NUMBER     S01328
     C*          TO DATE FORMAT OF YYYYMMDD.                                *
     C*                                                                     *
     C* INPUT  : @@STRT START DATE                           (8N)           *
     C*          @@FREQ PAYMENT FREQUENCY                    (1A)           *
     C*          @@CCY  CURRENCY CODE                        (3A)           *
     C*          @@MDAY INTEREST PAYMENT DAY IN THE MONTH    (2N)           *
     C*          @@MDAT MATURITY DATE                        (8N)
     C*                                                                     *
     C* OUTPUT : @@NDAT NEXT PAYMENT DATE (MIDAS DAY NUMBER) (8N)           *
     C*
     C**USES*:***@@DTIN*DATE*PASSED*TO***********SR*ZA0680***(8N)*********S01328
     C***********@@MDNO*MIDAS*DAY*NUMBER*FROM****SR*ZA0680***(5N)*********S01328
     C***********@@MNO  DAY NUMBER PASSED TO     SR ZA0830   (5N)         S01194
     C***********@@HIND HOLIDAY/WORKING DAY IND. SR ZA0830   (1A)         S01194
     C***********@@DAYN*DAY*NUMBER*PASSED*TO*****SR*ZA0710***(5N)*********S01328
     C***********@@VDT**DATE*IN*FORMAT*YYYYMMDD**SR*ZA0710***(8N)*********S01328
     C* USES :   ZZDTIN DATE PASSED TO           SR ZDAT10   (8N)         S01328
     C*          ZZMDNO MIDAS DAY NUMBER FROM    SR ZDAT10   (5N)         S01328
     C*          @@DAYN DAY NUMBER PASSED TO     SR ZDATE9   (5N)         S01328
     C*          @@VDT  DATE IN FORMAT YYYYMMDD  SR ZDATE9   (8N)         S01328
     C*          @@DNO  WORK FIELD - DAY NUMBER              (5N)           *
     C*          @@CCY  CURRENCY CODE                        (3A)           *
     C*          @@WF16 WORK FIELD - # DAYS IN THE MONTH     (2N)           *
     C*          @@HWIN WORK FIELD - HOLIDAY/WORK INDICATOR  (1A)           *
     C*          @@WKDT WORK FIELDS DS TO MANIPULATE DATE    (8N)           *
     C*          @@WKYY WORK FIELDS DS  - YEAR FIELD YYYY    (4N)           *
     C*          @@WKY  WORK FIELDS DS  - YEAR FIELD   YY    (2N)           *
     C*          @@WKM  WORK FIELDS DS  - MONTH FIELD        (2N)           *
     C*          @@WKD  WORK FIELDS DS  - DAY FIELD          (2N)           *
     C*          @@WKD2 WORK FIELDS - MAXIMUM DAYS IN MONTH  (2N)           *
     C*          @@REM2 LEAP YEAR CALCS - REMAINDER FIELD    (3N)           *
     C*                                                                     *
     C***********************************************************************
     C           MM1004    BEGSR
     C*
     C** Re-set the indicators used within this subroutine.
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN82
     C*
     C** Move the start date input into a working fields DS.
     C                     MOVE @@STRT    @@WKDS
     C*
     C** IF     the interest payment day in month is blank
     C**        THEN     substitue day from start date into that field.
     C** END
     C*
     C           @@MDAY    IFEQ 0                          B1
     C                     Z-ADD@@WKD     @@MDAY  20       *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is blank                            ME1002
     C**        THEN next interest date is set to maturity date           ME1002
     C** END                                                              ME1002
     C*                                                                   ME1002
     C           @@FREQ    IFEQ *BLANK                     B1             ME1002
     C                     Z-ADD@@MDAT    @@NDAT           *1             ME1002
     C                     GOTO M10049                     *1             ME1002
     C                     END                             E1             ME1002
     C*                                                                   ME1002
     C** IF     the payment frequency is monthly
     C**        THEN     increment the month by 1.
     C** END
     C           @@FREQ    IFEQ 'M'                        B1
     C                     ADD  1         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is quarterly.
     C**        THEN     increment the month by 3.
     C** END
     C           @@FREQ    IFEQ 'Q'                        B1
     C                     ADD  3         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is six-monthly
     C**        THEN     increment the month by 6.
     C** END
     C           @@FREQ    IFEQ 'X'                        B1
     C                     ADD  6         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is yearly
     C**        THEN     increment the year by 1.
     C** END
     C           @@FREQ    IFEQ 'Y'                        B1
     C                     ADD  1         @@WKYY           *1
     C                     END                             E1
     C*
     C** Substitute day in month into the day field.
     C*
     C                     Z-ADD@@MDAY    @@WKD
     C*
     C** IF     the new month now exceeds 12
     C**        THEN     subtract 12 from the month
     C**                 increment the year by 1
     C** END
     C*
     C           @@WKM     IFGT 12                         B1
     C           @@WKM     SUB  12        @@WKM            *1
     C                     ADD  1         @@WKYY           *1
     C                     END                             E1
     C*
     C** IF     the days now exceed the number of days for that month
     C**        THEN     substitue the maximum # of days to that field
     C**              IF     leap year and month is February
     C**                     THEN     add an extra day to the day field
     C**              END
     C** END
     C*
     C                     MOVE @M,@@WKM  @@WKD2  20     80
     C           @@WKD     IFGT @@WKD2                     E1
     C                     Z-ADD@@WKD2    @@WKD            *1
     C*
     C** Test for leap year, and turn of century leap year.
     C** NB: only every 400 years is a leap year.
     C           @@WKY     IFEQ 0                          B*2
     C           @@WKYY    DIV  400       @@WF16  30       **2
     C                     MVR            @@REM2  30     82**2
     C                     ELSE                            X*2
     C           @@WKYY    DIV  4         @@WF16           **2
     C                     MVR            @@REM2         82**2
     C                     END                             E*2
     C*
     C           *IN82     IFEQ '1'                        B*2
     C           @@WKM     IFEQ 2                          B**3
     C                     ADD  1         @@WKD            ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** Convert payment date to midas format.
     C*
     C*********************Z-ADD@@WKDT    @@DTIN                          S01328
     C*********************EXSR ZA0680                                    S01328
     C*********************Z-ADD@@MDNO    @@DNO   50                      S01328
     C                     Z-ADD@@WKDT    ZZDTIN                          S01328
     C                     EXSR ZDAT10                                    S01328
     C                     Z-ADDZZMDNO    @@DNO   50                      S01328
     C*
     C** DOWHILE     payment date is NOT a valid woking day
     C**             increment the day number
     C** WEND
     C*
     C           @@HWIN    DOUEQ'W'                        B1
     C*********************Z-ADD@@DNO     @@MNO   50       *1             S01195
     C*********************EXSR ZA0830                     *1             S01195
     C*********************MOVE @@HIND    @@HWIN  1        *1             S01195
     C                     Z-ADD@@DNO     ZDAYNO           *1             S01195
     C                     EXSR ZCHKH                      *1             S01195
     C                     MOVE ZIND      @@HWIN  1        *1             S01195
     C           @@HWIN    IFNE 'W'                        B*2
     C                     ADD  1         @@DNO            **2
     C                     END                             E**2
     C                     END                             E1
     C*
     C** Convert payment day number back to YYYYMMDD format.
     C*
     C                     Z-ADD@@DNO     @@DAYN  50
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@VDT     @@NDAT  80
     C                     GOTO M10049
     C*
     C**  Unexecuted code to define fields
     C                     MOVEL@@FREQ    @@FREQ  1
     C                     MOVEL@@STRT    @@STRT  80
     C                     MOVEL@@MDAT    @@MDAT  80
     C*********************MOVEL@@CCY     @@CCY   3                       S01195
     C                     MOVELZCCY      ZCCY    3                       S01195
     C*
     C           M10049    ENDSR
     C*******************************************************************
     C/EJECT
     C***********************************************************************
     C****                                                                S01195
     C**ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY       S01195
     C****       IS A HOLIDAY IN A PARTICULAR CURRENCY                    S01195
     C****                                                                S01195
     C**CALLED BY :                                                       S01195
     C****                                                                S01195
     C**CALLS :                                                           S01195
     C**                                                                  S01195
     C**INPUT  : @@MNO  MIDAS DAY NUMBER 5N                               S01195
     C****       @@CCY  CURRENCY CODE 3A                                  S01195
     C****                                                                S01195
     C**OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A                  S01195
     C*****                                                               S01195
     C**USES :   @@MNO  MIDAS DAY NUMBER                                  S01195
     C****       @@CCY  CURRENCY CODE                                     S01195
     C****       @@ONCE FIRST TIME THROUGH INDICATOR                      S01195
     C****       @@CY1  FIRST HALF OF CURRENCY ARRAY                      S01195
     C****       @@CY2  SECOND HALF OF CURRENCY ARRAY                     S01195
     C****       @@MNO6 MIDAS NUMBER WITH TRAILING BLANK                  S01195
     C****       @@HIND HOLIDAY/WORKING DAY INDICATOR                     S01195
     C****       @@INEX INCLUDE/EXCLUDE INDICATOR                         S01195
     C****                                                                S01195
     C****       INDICATORS                                               S01195
     C****       80 RECORD NOT FOUND                                      S01195
     C****       81 CURRENCY NOT FOUND ON RECORD                          S01195
     C****                                                                S01195
     C********************************************************************S01195
     C****       ZA0830    BEGSR                                          S01195
     C****                                                                S01195
     C*****   CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH                 S01195
     C****       @@ONCE    IFNE 'Y'                        B1             S01195
     C****                  *   FDTABJLL                   *1             S01195
     C****                 MOVE 'Y'       @@ONCE  1        *1             S01195
     C****                 END                             E1             S01195
     C****                                                                S01195
     C***BLANK OUT ARRAY                                                  S01195
     C****                 MOVE *BLANKS   @@CY1                           S01195
     C****                 MOVE *BLANKS   @@CY2                           S01195
     C****                                                                S01195
     C***ACCESS TABLE ON FIRST KEY                                        S01195
     C****                 MOVEL@@MNO     @@MNO6  6                       S01195
     C****                 MOVE @@MNO6    SS0830 12                       S01195
     C****                 MOVEL'22    '  SS0830                          S01195
     C****                 MOVE '1'       SS0830                          S01195
     C****       SS0830    CHAINTABLETJF             80                   S01195
     C****                                                                S01195
     C***IF RECORD NOT FOUND OR DELETED                                   S01195
     C****       *IN80     IFEQ '1'                        B1             S01195
     C****       RECI      OREQ '*'                        *1             S01195
     C****                 MOVE 'W'       @@HIND           *1             S01195
     C****                 GOTO ZA0839                     *1             S01195
     C****                 END                             E1             S01195
     C****                                                                S01195
     C***MOVE FIRST 25 CURRENCIES TO ARRAY                                S01195
     C****                 MOVE HCCY      @@CY1                           S01195
     C****                                                                S01195
     C***ACCESS TABLE ON SECOND KEY                                       S01195
     C****                 MOVE '2'       SS0830                          S01195
     C****       SS0830    CHAINTABLETJF             80                   S01195
     C****                                                                S01195
     C***IF SECOND RECORD FOUND AND NOT DELETED                           S01195
     C****       *IN80     IFEQ '0'                        B1             S01195
     C****       RECI      ANDNE'*'                        *1             S01195
     C****                 MOVE HCCY      @@CY2            *1             S01195
     C****                 END                             E1             S01195
     C****                                                                S01195
     C***SEARCH ARRAY FOR INPUT CURRENCY                                  S01195
     C****       @@CCY     LOKUP@CY                      81               S01195
     C****                                                                S01195
     C***IF INPUT CURRENCY IS IN ARRAY                                    S01195
     C****       *IN81     IFEQ '1'                        B1             S01195
     C****                                                                S01195
     C***IF INCLUDE/EXCLUDE INDICATOR EQ 'E'                              S01195
     C****       INEX      IFEQ 'E'                        B*2            S01195
     C****                 MOVE 'W'       @@HIND  1        **2            S01195
     C****                 ELSE                            X*2            S01195
     C****                 MOVE 'H'       @@HIND           **2            S01195
     C****                 END                             E*2            S01195
     C****                 END                             E1             S01195
     C****                                                                S01195
     C***IF INPUT CURRENCY IS NOT IN ARRAY                                S01195
     C****       *IN81     IFEQ '0'                        B1             S01195
     C****                                                                S01195
     C***IF INCLUDE/EXCLUDE INDICATOR EQ 'I'                              S01195
     C****       INEX      IFEQ 'I'                        B*2            S01195
     C****                 MOVE 'W'       @@HIND           **2            S01195
     C****                 ELSE                            X*2            S01195
     C****                 MOVE 'H'       @@HIND           **2            S01195
     C****                 END                             E*2            S01195
     C****                 END                             E1             S01195
     C****       ZA0839    ENDSR                                          S01195
     C*                                                                     *
     C***********************************************************************
     C/EJECT
     C*****************************************************************
     C*   MM1003 - CALCULATE A PERIOD DATE                            *
     C*                                                               *
     C*   PERIOD DATES ARE CALCULATED FOR THE FOLLOWING PERIODS       *
     C*      PERIOD TYPE       PERIOD NUMBER     PERIOD SHORTNAME     *
     C*           D                 -1             OVERNIGHT          *
     C*           D                  0             TOMORROW / NEXT    *
     C*           D                  1             SPOT / NEXT        *
     C*           W                  1             1 WEEK             *
     C*           W                  2             2 WEEK             *
     C*           W                  3             3 WEEK             *
     C*           M                  1             1 MONTH            *
     C*           M                  2             2 MONTH            *
     C*           M                  3             3 MONTH            *
     C*           M                  6             6 MONTH            *
     C*           M                  9             9 MONTH            *
     C*           Y                  1             1 YEAR             *
     C*           Y                  2             2 YEAR             *   S01328
     C*           Y                  3             3 YEAR             *   S01328
     C*           Y                  4             4 YEAR             *   S01328
     C*           Y                  5             5 YEAR             *   S01328
     C*           Y                  6             6 YEAR             *   S01328
     C*           Y                  7             7 YEAR             *   S01328
     C*           Y                  8             8 YEAR             *   S01328
     C*           Y                  9             9 YEAR             *   S01328
     C*           Y                 10            10 YEAR             *   S01328
     C*                                                               *
     C*  CALLED BY    -                                               *
     C*                                                               *
     C*  CALLS        -                                               *
     C*                                                               *
     C*  ZA0770       - CONVERT DATE YYYYMMDD TO DDMMYY               *
     C***ZA0830*******- CHECK IF DAY IS A WORKING DAY                 *   S01195
     C*  ZA0730       - FIND NEXT WORKING DAY                         *
     C***ZA0710*******-*CONVERT*MIDAS*DAY*NO*TO*YYYYMMDD******************S01328
     C*  ZDATE9       - CONVERT MIDAS DAY NO TO YYYYMMDD              *   S01328
     C***ZA0680*******-*CONVERT*DATE*TO*MIDAS*DAY*NUMBER***************   S01328
     C*  ZDAT10       - CONVERT DATE TO MIDAS DAY NUMBER              *   S01328
     C*                                                               *
     C*  CALLS PROGRAM ZA0270 CONVERT DATE TO MIDAS DAY NUMBER WITH   *
     C*                VALIDATION CHECK                               *
     C*                                                               *
     C*  FIELDS INPUT -                                               *
     C*                                                               *
     C*  @@CCY   3    - CURRENCY                                      *
     C*  @@SPOT  80   - MONEY MARKET SPOT DATE                        *
     C***@@PNUM**1,0**-*PERIOD*NUMBER**********************************   S01328
     C*  @@PNUM  2,0  - PERIOD NUMBER                                 *   S01328
     C*  @@PTYP  1    - PERIOD TYPE                                   *
     C*                                                               *
     C*  FIELDS OUTPUT                                                *
     C*                                                               *
     C*  @@PDAT  8,0  - PERIOD DATE                                   *
     C*  @@PRDN  5,0  - PERIOD DAY NUMBER                             *   S01328
     C*                                                               *
     C*  WORK FIELDS                                                  *
     C*                                                               *
     C*  @@DTIN  8,0  - DATE INPUT TO ZA0770 IN YYYYMMDD FORMAT       *
     C*  ZZDTIN  8,0  - DATE INPUT TO ZDAT10 IN YYYYMMDD FORMAT       *   056095
     C***@@DFMT**1****-*DATE*FORMAT************************************   S01328
     C*  @@DATF  1    - DATE FORMAT (M OR D)                          *   S01328
     C*  @@RTNC  1    - RETURN INDICATOR FROM ZA0270                  *
     C*  @@DAYN  5,0  - MIDAS DAY NUMBER                              *
     C*  @@MNO   5,0  - MIDAS DAY NUMBER                              *
     C*  @@HIND  1    - HOLIDAY INDICATOR H OR W                      *
     C*  @@ADD   3,0  - CALCULATION WORK FIELD                        *
     C***@@VDT***8,0**-*DATE*OUTPUT*FROM*ZA0710************************   S01328
     C*  @@VDT   8,0  - DATE OUTPUT FROM ZDATE9                       *   S01328
     C*  @@RUND  8    - RUN DATE IN YYYYMMDD FORMAT                   *
     C*                                                               *
     C*****************************************************************
     C*
     C           MM1003    BEGSR
     C*
     C                     Z-ADD*ZERO     @@STRT
     C                     Z-ADD*ZERO     @@DTIN
     C                     Z-ADD*ZERO     ZZDTIN                          056095
     C                     Z-ADD*ZERO     @@SPDD
     C                     Z-ADD*ZERO     @@DATE
     C                     Z-ADD*ZERO     @@DTOU
     C                     Z-ADD*ZERO     @@Z71Y
     C                     Z-ADD*ZERO     @@VDT
     C*
     C                     ADD  @@SPOT    @@SPDD
     C**  SET UP STARTING POINT DATE AS SPOT DATE
     C                     Z-ADD@@SPDD    @@STRT
     C*
     C**  ADD PERIOD NUMBERS TO DATE
     C           @@PTYP    IFEQ 'M'                        B1
     C                     ADD  @@PNUM    @@STMT           *1
     C           @@STMT    IFGT 12                         B*2
     C                     SUB  12        @@STMT           **2
     C                     ADD  1         @@STYR           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           @@PTYP    IFEQ 'Y'                        B1
     C*********************ADD  1         @@STYR           *1             S01328
     C                     ADD  @@PNUM    @@STYR           *1             S01328
     C                     END                             E1
     C*
     C**  CONVERT DATE FORMAT FROM YYYYMMDD TO DDMMYY
     C                     MOVEL'D'       @@DATF  1                       S01328
     C                     Z-ADD@@STRT    @@DTIN
     C                     EXSR ZA0770
     C                     Z-ADD@@DTOU    @@DATE
     C*
     C*
     C*********************MOVEL'D'       @@DFMT  1                       S01328
     C                     MOVE @@DATE    @@DATC  60
     C*
     C**  CONVERT STARTING DATE TO MIDAS DAY NUMBER FORMAT
     C           @@RTNC    DOUEQ'0'                        B1
     C                     CALL 'ZA0270'                   *1
     C                     PARM           @@DATC           *1
     C*********************PARM           DATF             *1             S01194
     C*********************PARM           BJDFIN           *1       S01194S01328
     C                     PARM           @@DATF           *1             S01328
     C           @@RTNC    PARM           @@RTNC  1        *1
     C           @@DAYN    PARM           @@DAYN  50       *1
     C*
     C                     SUB  1         @@DAY2           *1
     C                     MOVE @@DATE    @@DATC           *1
     C*
     C                     END                             E1
     C*
     C*********************Z-ADD@@DAYN    @@MNO                           S01195
     C                     Z-ADD@@DAYN    ZDAYNO                          S01195
     C                     MOVEL@@RTNC    @@RTN
     C*
     C**  RESET STARTING POINT
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@VDT     @@STRT                    ME1161
     C** SAVE THE MIDAS DAY NO. EQUIVALENT FOR POSSIBLE OUTPUT            S01328
     C                     Z-ADD@@DAYN    @@STDN  50                      S01328
     C*
     C**  PROCESS PERIOD TYPE 'D'
     C           @@PTYP    IFEQ 'D'                        B1
     C*
     C**  IF PERIOD NUMBER = 1 FIND NEXT WORKING DAY
     C           @@PNUM    IFEQ 1                          B*2
     C***********@@HIND    DOUEQ'W'                        B**3           S01195
     C*********************ADD  1         @@MNO            ***3           S01195
     C*********************EXSR ZA0830                     ***3           S01195
     C           ZIND      DOUEQ'W'                        B**3           S01195
     C                     ADD  1         ZDAYNO           ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  IF PERIOD NUMBER NE 1 FIND TOMORROW/NEXT DAY (AND OVERNIGHT)
     C**  IE FIND NEXT WORKING DAY BEYOND RUND
     C           @@PNUM    IFLT 1                          B*2
     C*********************Z-ADDRUND      @@MNO            **2            S01195
     C***********@@HIND    DOUEQ'W'                        B**3           S01195
     C*********************ADD  1         @@MNO            ***3           S01195
     C*********************EXSR ZA0830                     ***3           S01195
     C                     Z-ADDBJRDNB    ZDAYNO           **2            S01195
     C           ZIND      DOUEQ'W'                        B**3           S01195
     C                     ADD  1         ZDAYNO           ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  IF PERIOD NUMBER IS -1 FIND NEXT WORKING DAY TOMM/NEXT.
     C**  IE FIND NEXT WORKING DAY BEYOND RUND
     C           @@PNUM    IFEQ 0                          B*2
     C***********@@HIND    DOUEQ'W'                        B**3           S01195
     C*********************ADD  1         @@MNO            ***3           S01195
     C*********************EXSR ZA0830                     ***3           S01195
     C           ZIND      DOUEQ'W'                        B**3           S01195
     C                     ADD  1         ZDAYNO           ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  PROCESS PERIOD TYPE 'W'
     C           @@PTYP    IFEQ 'W'                        B1
     C*
     C**  INCREMENT DAY NUMBER
     C           @@PNUM    MULT 7         @@ADD   30       *1
     C*********************ADD  @@ADD     @@MNO            *1             S01195
     C**********************                                              S01195
     C****FIND*NEXT*WORKING DAY                                           S01195
     C*********************EXSR ZA0830                     *1             S01195
     C***********@@HIND    DOWEQ'H'                        B*2            S01195
     C*********************ADD  1         @@MNO            **2            S01195
     C*********************EXSR ZA0830                     **2            S01195
     C                     ADD  @@ADD     ZDAYNO           *1             S01195
     C*                                                                   S01195
     C**  FIND NEXT WORKING DAY                                           S01195
     C                     EXSR ZCHKH                      *1             S01195
     C           ZIND      DOWEQ'H'                        B*2            S01195
     C                     ADD  1         ZDAYNO           **2            S01195
     C                     EXSR ZCHKH                      **2            S01195
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  PROCESS PERIOD TYPE 'M' OR 'Y'
     C           @@PTYP    IFEQ 'M'                        B1
     C           @@PTYP    OREQ 'Y'                        *1
     C*
     C**  IS SPOT LAST WORKING DAY IN MONTH
     C***********          Z-ADD@@SPDD    @@DTIN           *1             056095
     C                     Z-ADD@@SPDD    ZZDTIN           *1             056095
     C                     EXSR ZA0730                     *1
     C           @@SPMT    IFNE @@Z71M                     B*2
     C                     Z-ADD1         @@STDY           **2
     C           @@STMT    IFEQ 12                         B**3
     C                     Z-ADD1         @@STMT           ***3
     C                     ADD  1         @@STYR           ***3
     C                     ELSE                            X**3
     C                     ADD  1         @@STMT           ***3
     C                     END                             E**3
     C*
     C**  CONVERT STARTING DATE TO MIDAS DAY NUMBER FORMAT
     C*********************Z-ADD@@STRT    @@DTIN           **2
     C*********************EXSR ZA0680                                    S01328
     C                     Z-ADD@@STRT    ZZDTIN
     C                     EXSR ZDAT10                                    S01328
     C*********************Z-ADD@@MDNO    @@MNO            **2            S01195
     C***********@@HIND    DOUEQ'W'                        B**3           S01195
     C*********************SUB  1         @@MNO            ***3           S01195
     C*********************EXSR ZA0830                     ***3           S01195
     C*********************Z-ADD@@MDNO    ZDAYNO           **2      S01195S01328
     C                     Z-ADDZZMDNO    ZDAYNO                          S01328
     C           ZIND      DOUEQ'W'                        B**3           S01195
     C                     SUB  1         ZDAYNO           ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C                     END                             E**3
     C                     GOTO M10038                     **2
     C                     END                             E*2
     C*
     C**  IF THE STARTING POINT DAY IS A NON WORKING DAY AND THE NEXT
     C**  WORKING DAY FALLS IN THE NEXT MONTH  FIND LAST WORKING DAY
     C**  IN STARTING MONTH.
     C*********************Z-ADD@@STRT    @@DTIN           *1       ME1161S01328
     C*********************EXSR ZA0680                              ME1161S01328
     C                     Z-ADD@@STRT    ZZDTIN                          S01328
     C                     EXSR ZDAT10                                    S01328
     C*********************Z-ADD@@MDNO    @@MNO            *1       ME1161S01195
     C*********************EXSR ZA0830                     *1             S01195
     C***********@@HIND****IFEQ 'H'                        B*2            S01195
     C*********************Z-ADD@@MDNO    ZDAYNO           *1       S01195S01328
     C                     Z-ADDZZMDNO    ZDAYNO                          S01328
     C                     EXSR ZCHKH                      *1             S01195
     C           ZIND      IFEQ 'H'                        B*2            S01195
     C***********          Z-ADD@@STRT    @@DTIN           **2            056095
     C                     Z-ADD@@STRT    ZZDTIN           **2            056095
     C                     EXSR ZA0730                     **2
     C*
     C           @@STMT    IFNE @@Z71M                     B**3
     C***********@@HIND    DOUEQ'W'                        B***4          S01195
     C*********************SUB  1         @@MNO            ****4          S01195
     C*********************EXSR ZA0830                     ****4          S01195
     C           ZIND      DOUEQ'W'                        B***4          S01195
     C                     SUB  1         ZDAYNO           ****4          S01195
     C                     EXSR ZCHKH                      ****4          S01195
     C                     END                             E***4
     C*******              GOTO M10038                     ***3     ME1161
     C                     END                             E**3
     C                     GOTO M10038                     ***3     ME1161
     C                     END                             E*2
     C*
     C**  IF STARTING DATE IS A WORKING DAY IN CURRENCY & SPOT DATE
     C**  IS NOT LAST WORKING DAY IN MONTH PERIOD DATE IS STARTING DAY
     C                     Z-ADD@@STRT    @@PDAT           *1
     C                     Z-ADD@@STDN    @@PRDN           *1             S01328
     C                     GOTO M10039                     *1
     C*
     C                     END                             E1
     C*
     C           M10038    TAG
     C*
     C**  CONVERT DATE TO YYYYMMDD FORMAT
     C*********************Z-ADD@@MNO     @@DAYN                          S01195
     C                     Z-ADDZDAYNO    @@DAYN                          S01195
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C*                                                                   S01328
     C** OUTPUT DATE IN YYYYMMDD FORMAT AND MIDAS DAY NO. FORMAT          S01328
     C                     Z-ADD@@VDT     @@PDAT  80
     C                     Z-ADD@@DAYN    @@PRDN  50                      S01328
     C*
     C                     GOTO M10039
     C                     ADD  0         @@SPOT  80
     C*********************MOVE *BLANKS   @@CCY   3                       S01195
     C                     MOVE *BLANKS   ZCCY    3                       S01195
     C*********************ADD  0         @@PNUM  10                      S01328
     C                     ADD  0         @@PNUM  20                      S01328
     C                     MOVE *BLANKS   @@PTYP  1
     C*
     C           M10039    ENDSR
     C***********************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*       TITLE:DETERMINE NEXT WORKING DAY.                       *
     C*                                                               *
     C********SUBROUTINE*ZA0730*EXPECTS*FIELD*'@@DTIN'*TO*BE***********   056095
     C*       SUBROUTINE ZA0730 EXPECTS FIELD 'ZZDTIN' TO BE          *   056095
     C*       PASSED TO IT IN 'YYYYMMDD' FORMAT.IT THEN DETERMINES    *
     C*       THE NEXT WORKING DAY AND RETURNS.                       *
     C*                                                               *   S01328
     C* CALLS : ZDATE9 - CONVERTS MIDAS DAY NUMBER TO YYYYMMDD        *   S01328
     C*         ZDAT10 - CONVERTS YYYYMMDD TO MIDAS DAY NUMBER        *   S01328
     C*                                                               *
     C**INPUT**:@@DTIN*DATE*(YYYYMMDD)*-*IN*DATA*STRUCTURE*(SIZE*:*8N)*   056095
     C* INPUT  :ZZDTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)*   056095
     C*         @@CCY  CURRENCY CODE   - IN FORMAT(3A)                *
     C*                                                               *
     C* OUTPUT :@@VDT  DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)*
     C*                                                               *
     C**USES*:***@@MDNO*MIDAS*DAY*NO*USED*BY*SR*ZA0680*****************   S01328
     C* USES :   ZZMDNO MIDAS DAY NO USED BY SR ZDAT10                *   S01328
     C*          ZZDTIN (YYYYMMDD)   USED BY SR ZDAT10                *   S01328
     C*          @@DAYN MIDAS DAY NO USED BY SR ZDATE9                *   S01328
     C***********@@DAYN*MIDAS*DAY*NO*USED*BY*SR*ZA0710*****************   S01328
     C***********@@MNO**MIDAS*DAY NO USED BY SR ZA0830                *   S01195
     C***********@@HIND*HOLIDAY*IND.RETURNED BY ZA0830                *   S01195
     C*                                                               *
     C*****************************************************************
     C           ZA0730    BEGSR
     C*
     C* CONVERT YYYYMMDD FORMAT TO MIDAS DAY NO.
     C*
     C*********************EXSR ZA0680                                    S01328
     C***********          Z-ADD@@DTIN    ZZDTIN                    S01328056095
     C                     EXSR ZDAT10                                    S01328
     C*
     C           ZA0731    TAG
     C*
     C*********************ADD  1         @@MDNO  50                      S01328
     C                     ADD  1         ZZMDNO  50                      S01328
     C*
     C* CHECK IF DAY NO. IS A HOLIDAY          .
     C*
     C******               Z-ADD@@MDN0    @@MNO   50                   ME0143
     C*********************Z-ADD@@MDNO    @@MNO   50                ME0143S01195
     C*********************Z-ADD@@MDNO    ZDAYNO                          S01195
     C                     Z-ADDZZMDNO    ZDAYNO                    S01195S01328
     C*
     C******************** EXSR ZA0830                                    S01195
     C********************                                                S01195
     C***********@@HIND    IFEQ 'H'                                       S01195
     C                     EXSR ZCHKH                                     S01195
     C*                                                                   S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     GOTO ZA0731
     C                     END
     C*
     C* CONVERT MIDAS DAY NO. TO YYYYMMDD FORMAT.
     C*
     C*********************Z-ADD@@MDNO    @@DAYN  50                      S01328
     C                     Z-ADDZZMDNO    @@DAYN  50                      S01328
     C*
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C*
     C           ZA0739    ENDSR                                       **
     C***********************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  SUBROUTINE ZA0770 - THIS SUBROUTINE RECEIVES A 8/0 INPUT     *
     C*                      DATE - FORMAT YYYYMMDD AND OUTPUTS A     *
     C*                      6/0 DATE. IF INPUT FIELD @@DATF = 'M'    *   S01328
     C*                      OUTPUT FORMAT MMDDYY. IF INPUT FIELD     *   S01328
     C*                      @@DATF = 'D' OUTPUT FORMAT DDMMYY.       *   S01328
     C***********************6/0*DATE.*IF*FIELD*DATF*ON*TABTB10*=******   S01328
     C***********************'M'*OUTPUT*FORMAT*MMDDYY.*IF*FIELD********   S01328
     C***********************DATF*=*'D'*OUTPUT*FORMAT*DDMMYY.**********   S01328
     C*                                                               *
     C*  CALLED BY   :                                                *
     C*                                                               *
     C*  INPUT       : @@DTIN  - DATE INPUT (8,0)                     *
     C*              : @@DATF  - DATE FORMAT INDICATOR (M OR D)       *   S01328
     C*  OUTPUT      : @@DTOU  - DATE OUTPUT (6,0)                    *
     C*                                                               *
     C*  WORK FIELDS : @@YYY   - YEAR IN (2,0)                        *
     C*              : @@MM    - MONTH IN (2,0)                       *
     C*              : @@DD    - DAY IN (2,0)                         *
     C*                                                               *
     C*              : @@DAT1  - IF DATE DD/MM/YY DAY ELSE MONTH (2,0)*
     C*              : @@DAT2  - IF DATE DD/MM/YY MONTH ELSE DAY (2,0)*
     C*                                                               *
     C*****************************************************************
     C           ZA0770    BEGSR
     C*
     C                     Z-ADD@@YY      @@YYY
     C*
     C**  DATF = 'D' CONVERT TO MMDDYY FORMAT
     C***********DATF******IFEQ 'D'                        B1             S01194
     C***********BJDFIN****IFEQ 'D'                        B1       S01194S01328
     C           @@DATF    IFEQ 'D'                        B1             S01328
     C                     Z-ADD@@DD      @@DAT1           *1
     C                     Z-ADD@@MM      @@DAT2           *1
     C                     END                             E1
     C*
     C*
     C**  DATF = 'M' CONVERT TO DDMMYY FORMAT
     C***********DATF******IFEQ 'M'                        B1             S01194
     C***********BJDFIN****IFEQ 'M'                        B1       S01194S01328
     C           @@DATF    IFEQ 'M'                        B1             S01328
     C                     Z-ADD@@DD      @@DAT2           *1
     C                     Z-ADD@@MM      @@DAT1           *1
     C                     END                             E1
     C*
     C**  MOVE YEAR PART OF DATA STRUCTURE
     C                     MOVE @@YYY     @@YY
     C*
     C           ZA0779    ENDSR                           ***ZA0779***
     C***********************************************************************
      /EJECT                                                                                  CDL033
      *****************************************************************                       CDL033
      * CKDEAL - Check if Deal Type is included in validations        *                       CDL033
      *****************************************************************                       CDL033
     C           CKDEAL    BEGSR                                                              CDL033
      *                                                                                       CDL033
     C           DTYP      IFNE 'CF'                                                          CDL033
     C                     MOVE *OFF      @FXT    1                                           CDL033
     C                     MOVE *IN49     TVAR    1                                           CDL033
     C           DTYP      LOKUPFXT                      49                                   CDL033
     C           *IN49     IFEQ *ON                                                           CDL033
     C                     MOVE *ON       @FXT                                                CDL033
     C                     ENDIF                                                              CDL033
     C                     MOVE TVAR      *IN49                                               CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C                     ENDSR                                                              CDL033
      *****************************************************************                       CDL033
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      /EJECT                                                              S01328
     C/COPY ZSRSRC,ZACCH                                                  S01195
     O/EJECT
     C/COPY ZSRSRC,ZFWDT                                                  E26582
     O/EJECT                                                              E26582
     C/COPY ZSRSRC,ZDATE2Z2                                               S01328
      /EJECT                                                              S01328
     C/COPY ZSRSRC,ZCPDZ2                                                 S01328
     O/EJECT
     O***********************************************************************
     O*
     OFDINTRP0E                UPDPDD
     O* INTEREST RATES DATES
     O*
     O                         HWPRDD
     O                         HWPRDN                                     S01328
     O*                                                                   E26582
     ODLMMDFP0E                UPDPDE                                     E26582
     O* DISCOUNT FACTORS PERIOD DATES                                     E26582
     O*                                                                   E26582
     O                         DFPRDN                                     E26582
     O*                                                                   S01328
     ODLFRARP0E                UPDPDF                                     S01328
     O* FRA RATES DATES                                                   S01328
     O*                                                                   S01328
     O                         FRVMDN                                     S01328
     O                         FRVDMY                                     S01328
     O*                                                                   S01328
     ODLIRSRP0E                UPDPDI                                     S01328
     O* IRS RATES DATES                                                   S01328
     O*                                                                   S01328
     O                         IRMMDN                                     S01328
     O                         IRMDMY                                     S01328
     O*                                                                   CIR001
     ODLSWPRD0E                UPSWPR                                     CIR001
     O* SWAP RATES DATES                                                  CIR001
     O*                                                                   CIR001
     O                         IRMMDN                                     CIR001
     O                         IRMDMY                                     CIR001
     O*                                                                   CIR001
     ODLIRDFD0E                UPDSCF                                     CIR001
     O* DISCOUNT FACTOR DATE                                              CIR001
     O*                                                                   CIR001
     O                         I2MMDN                                     CIR001
     O/COPY WNCPYSRC,MM0101OOP1                                           S01408
     O*
     O*TABTG10FE****************UPDSPD                                    S01194
     O**CURRENCIES*FILE*-*SPOT*DATE**                                     S01194
     O*
     O*************************MSPD                                       S01194
     OTABTG10FE                UPDSPD                                     S01328
     O** CURRENCIES FILE - SPOT DATE                                      S01328
     O*                                                                   S01328
     O                         MSPD                                       S01328
     O*
     OMMDELDP0E                DELD
     O* MM DEAL LOANS/DEPOSITS
     O*
     O                         HKSLID                                                      MD024467A
     O                         HKSLDD
     O                         HKSLMM
     O                         HKSLYY
     O                         HKNIPD                                                      MD024467A
     O                         HKNIDD
     O                         HKNIMM
     O                         HKNIYY
     O                         HKDSTS
     O                         HKIADD
     O                         HKIAMM
     O                         HKIAYY
     O                         HKINTR
     O                         HKIIRT
     O                         HKSPRD
     O                         HKBSRC                                                      MD024467A
     O                         HKDBSR                                                      MD024467A
     O                         HKNGVI                                                         CDL033
     O                         HKMTTI                                                         260340
     O                         HKAMNP
     O                         HKIMAT
     O                         HKIPFQ
     O                         HKIPDM
     O                         HKPRIN                                     CDL007
     O                         HKMATD                                     BUG4092
     O                         HKMDDD                                     BUG4092
     O                         HKMDMM                                     BUG4092
     O                         HKMDYY                                     BUG4092
     O                         HKCAND                                     BUG4092
     O                         HKPNPR                                     BUG4092
     O                         HKPENA                                                      MD024467A
     O                         HKNIPD                                                         262922
     O                         HKRCDT                                                       AR755195
     O                         HKSTRT                                                      AR755195A
     O                         HKINFD                                                       AR755195
     O*
     OMMDENBP0E                DENB
     O* MM DEAL NA'S BOUGHT
     O*
     O                         HLLIDD
     O                         HLLIMM
     O                         HLLIYY
     O                         HLNIDD
     O                         HLNIMM
     O                         HLNIYY
     O                         HLDSTS
     O                         HLIADD
     O                         HLIAMM
     O                         HLIAYY
     O                         HLIPFQ
     O                         HLIPDM
     O*                        HLNANV
     O********                                           S01150 ***
     O                         HLNANV
     O                         HLAMNP                                     S01378
     O                         HLMTTI                                                         222986
     O                         HLFVAL                                     S01378
     O                         HLDCAM                                     S01378
     O                         HLPSZE                                     S01378
     O                         HLNSLD                                     S01378
     O                         HLNIPD                                                         262922
     O*
     OMMDENSP0E                DENS
     O* MM DEAL NA'S SOLD
     O*
     O                         HMLIDD
     O                         HMLIMM
     O                         HMLIYY
     O                         HMNIDD
     O                         HMNIMM
     O                         HMNIYY
     O                         HMDSTS
     O                         HMIPFQ
     O                         HMIPDM
      ** Added 'CF' to array @DT and '+' to array @SN                                         CDL033
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** @M  USED BY SR. MM1004 - DAYS IN A MONTH
312831303130313130313031
** @DT USED BY SR. MM1004 - DEAL TYPES FOR LOANS/DEPOSITS                 S01354
ITIPTDTICDCLCILNDLILIDDTLTFTFLDPLPCF
** @SN USED BY SR. MM1004 - SIGNS FOR DEAL TYPES IN @DL                   S01354
+-+-+-+---++++---+
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
** FXT                                                                                        CDL033
ITIPTDTICI                                                                                    CDL033
