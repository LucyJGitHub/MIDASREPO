     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Re-organisation/deals file update')           *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MM Dealer Module
     F*                                                               *
     F*  MM0102 - START OF DAY DRS DEALS FILE UPDATE                  *
     F*                                                               *
     F*  This program is run only if TM module is set on.             *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD054957           Date 11Dec19               *
      *  Prev Amend No. 261960             Date 26Apr13               *
      *                 MD053295           Date 13Apr19               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD038562           Date 29Jun16               *
      *                 AR1055654          Date 07Jul15               *
      *                 CGL165             Date 23Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 01Sep14               *
      *                 MD024467           Date 07May14               *
      *                 CDL093             Date 08Apr14               *
      *                 AR755195A          Date 13Dec13               *
      *                 AR755195           Date 13Dec13               *
      *                 AR937172           Date 11Jan13               *
      *                 AR970738           Date 04Dec12               *
      *                 AR996895           Date 25Nov12               *
      *                 CRE073             Date 06Dec10               *
      *                 AR588416           Date 19Aug10               *
      *                 252554A            Date 11Feb09               *
      *                 263666             Date 01Feb10               *
      *                 262922             Date 15Sep10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CDL081             Date 14Dec09               *
      *                 260340             Date 23May09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL013             Date 08Jun06               *
      *                 222986             Date 26May06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 237063             Date 20Nov05               *
      *                 BUG8605            Date 22Sep05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL038             Date 10May05               *
      *                 CDL033             Date 10Feb05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 BUG4092            Date 01Oct04               *
      *                 BUG3838            Date 21Jul04               *
      *                 CGL014             Date 20Oct03               *
      *                 CDL022             Date 03Feb04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 204923             Date 29Apr02               *
      *                 CAS001             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 04Oct01               *
      *                 CIR007             Date 11May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 180229             Date 24Feb01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CGL011             Date 20Sep99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 163136             Date 07Jul99               *
      *                 115246             Date 24Feb98               *
     F*                 113605             DATE 24Feb98               *
     F*                 126017             DATE 18Nov97               *
     F*                 097885             DATE 03FEB97               *
     F*                 S01408             DATE 24APR96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 061426             DATE 30SEP93               *
     F*                 056121             DATE 04NOV93               *
     F*                 056095             DATE 07JUN93               *
     F*                 E46391             DATE 25FEB93               *
     F*                 E48221             DATE  1FEB93               *
     F*                 S01392             DATE 20JUL92               *
     F*                 043213             DATE 27JUL92               *
     F*                                                               *
     F*****************************************************************
      *                                                               *
      *  MD054957 - RBRU SP21 Compatibility Patch (Recompile)         *
      *  261960 - Remove update of input interest rate (HKIIRT) in    *
      *           MMDELDPP so that it always contains the original    *
      *           input interest rate.                                *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD038562 - Incorrect Interest at Maturity. Make sure @@MDAY  *
      *             is initialized with the correct value.            *
      *  AR1055654 - Rate changes reflected incorrectly in enquiries. *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  MD024467 - Fields updated in DEALSDC are not updated in      *
      *             MMDELDPP. Synchronize fields from DEALSDC and     *
      *             MMDELDPP.                                         *
      *  CDL093 - MM Interest calculation type 9.                     *
      *  MD024110 - Wrong update of actual interest rate in DEAM      *
      *             for CDL020                                        *
      *           - Applied fix AR755195A                             *
      *           - Applied fix AR755195                              *
      *  AR755195A - Reopen. Update HKINTR and HKSTRT                 *
      *            - Applied for MD024110                             *
      *  AR755195 - Update CDL033 fields and total interest.          *
      *             (Child: AR755196)                                 *
      *           - Applied for MD024110                              *
      *  AR937172 - TOTI is always positive and is moved to HKMTTI.   *
      *             HKMTTI should be negative in deal types other     *
      *             than loans. Synced HKNGVI value assignment with   *
      *             MMLDNIVAL processing. (Child: AR937173)           *
      *  AR970738 - Drop credit lines extension records only for      *
      *             non-authorized deleted deals. Apply fix 263291A.  *
      *             Remove extension records when MMDELDPP records    *
      *             are also deleted. Patterned after BUG10705R.      *
      *             Apply fix 263291. (Child: AR970741)               *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  AR588416 - Parameter type mismatch on calling MMDELUDF.      *
      *  252554A - Delete the corresponding record in the UDF files   *
      *            during COB.                                        *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  262922 - Update the Next Interest Payment Date in MMDELDPP   *
      *           and MMDENBPP.                                       *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus                                       *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CDL081 - Tiered withholding tax rounding upgrade             *
      *  260340 - Updates HKMTTI with the value of TOTI.              *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL013 - Tiered Withholding Tax                              *
      *  222986 - Update the total interest amount for parcelled      *
      *           interest bearing negotiable assets. Apply fix       *
      *           207707.                                             *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  BUG8605 - SCC0411 failure on FDINTDLL/MM0053. I/C initiation *
      *            ended abnormally.  MM0053 should be executed       *
      *            depending on BGDRMM (DRS Money Market) and not on  *
      *            BGFIIN (FRA/IRS). Applied fix 233731.              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL033 - Floating Rate CDs Issued                            *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  BUG4092- CDL017 fields not being updated on MMDELDPP.        *
      *  BUG3838 - 'Complete' rollover deals generated in COB must not*
      *            be deleted.                                        *
      *  CGL014 - Collaterals Processing (Recompile)                  *
      *  CDL022 - Deal Amendment Changes (Recompile)                  *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
     F*  CDL010 - Prevent last user that actioned the trade from      *
     F*           authorising it.Recompile due to changes in MMDEAMPP *
     F*           , MMDELDPP, MMDENBPP AND MMDENSPP.                 *
      *  204923 - Rate Fix Days Adjustment (OIS)                      *
      *           (Recompiled over changed SDCURRPD)                  *
      *  CAS001 - Net Present Value (NPV) Accounting (Recompile)      *
      *  CPK014 - Release 4 packaging.  Rename of field which is too  *
      *           long for OPM program.                               *
      *  CIR007 - Overnight Index Swaps                               *
      *           (Recompiled over changed SDCURRPD)                  *
      *  CSD006 - Recompiled over changed SDCURRPD.                   *
      *  180229 - Period dates shown on FD0560 is wrong.  Update      *
      *           FDINTRPP even if Treasury Management and FRA/IRS    *
      *           are both set off.  Apply fix 152762.                *
      *  CDL008 - Continuous Linked Settlement (recompile SDCURRPD)   *
      *  CIR004 - Dealing Calculation Method Change                   *
      *  CGL011 - Collateral Processing for Midas                     *
      *           Recompiled due to changes in MMDELDPP               *
      *  CDL006 - Dealing Fiduciary.                                  *
     F*  163136 - Interest Calculation Method '6'  showing incorrect -*
     F*           ZERO - amount . Addition to Core #126017 which dealt*
     F*           with the issue. It introduced an additional  INT6DY *
     F*           field in s-routine ZINTDY in  /COPY ZSRSRC/ZINTDYZ2 *
     F*           which in turn is usually called from GLINTC s-routine
     F*           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
     F*           least a dozen other pgms that use ZINTDY but do     *
     F*           GLINTC-processing within the pgms calculation specs *
     F*  115246 - NA purchase does not exist for NA sold.             *
     F*  113605 - Incorrectly displaying FACE VALUE of Negotiable     *
     F*           Assets Purchased. Apply fix 099898.                 *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC - recompile program.           *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  S01408 - Addition of core hook MM0102CCP3                    *
     F*           Addition of core hook MM0102CCP2                    *
     F*           Addition of core hook MM0102CCP1                    *
     F*           Addition of core hook MM0102FFP1                    *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  061426 - Recompile after ZDATE9 correction                   *
     F*  056121 - Increase size of work field to enable correct       *
     F*           calculation of interest on very large amounts.      *
     F*           (Similar to fix 049499 of MM0089 in MRSLIB1005)     *
     F*  056095 - Interest not calculated consistently in MM.         *
     F*           SR. MM1009 was externally defined as ZINTDY,        *
     F*           while SR. ZA0710 and ZA0680 were replaced by        *
     F*           the externally defined standard SR. ZDATE9 and      *
     F*           ZDAT10, respectively.  (MM0102 is already using     *
     F*           ZDATE9 and ZDAT10.)  Seventeen MM programs were     *
     F*           amended.                                            *
     F*  E46391 - Amend header box to say this program run only       *
     F*           if TM not on - MM0101 run if TM installed.          *
     F*  E48221 - MM0053 CALLED WITH DRS OR FRA/IRS NOT PRESENT       *
     F*           FALLS OVER WITH A DB ERROR ON FDINTRPP. THIS        *
     F*           FILE IS NOT MAINTAINED UNLESS THESE MODULES ARE     *
     F*           PRESENT. CALL TO MM0053 NOW CONDITIONED ON THESE    *
     F*           MODULES BEING PRESENT                               *
     F*  S01392 - JAP.SUB-MODULE INCORPORATION (CORE)                 *
     F*  043213 - DRS FILES WERE ONLY UPDATED IF TREASURY MANAGEMENT  *
     F*           WAS SWITCHED ON. THIS IS WRONG.                     *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F**  Indicator Function Summary                                  *
     F*                                                               *
     F* ID F  C  H  L     FUNCTION OF INDICATORS                      *
     F* ----------------------------------------                      *
     F*                                                               *
     F*       50          AODEALR0 CALLED ONCE                        *
     F*       60          END OF FILE INDICATOR                       *
     F*       61          CHAIN FAIL                                  *
      *       62          Work indicator                              *                       CDL033
     F*       66          CHAIN FAIL ON SDCURRL0                      *
     F*       70          CHAIN FAIL - DATA BASE ERROR                *
     F*       U7 & U8     DATA BASE ERROR                             *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F/COPY WNCPYSRC,MM0102F001
     FMMDEAULLUF  E           K        DISK         KINFSR *PSSR      UC
     F                                              KINFDS @DLSTS
     FMMDAMULLUF  E           K        DISK         KINFSR *PSSR      UC
     FMMDEAMLLIF  E           K        DISK         KINFSR *PSSR      UC
     F            MMDEAMP0                          KRENAMEMMDMAMP0
     FDEALS   IF  E           K        DISK         KINFSR *PSSR      UC
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     FDEAMS   IF  E           K        DISK         KINFSR *PSSR      UC
     F            DEAMSDHF                          KIGNORE
     F            DEAMSDJF                          KIGNORE
     F*
     FDEALSH  IF  E           K        DISK         KINFSR *PSSR          115246
     F            DEALSDBF                          KIGNORE               115246
     F            DEALSDCF                          KIGNORE               115246
     F            DEALSDDF                          KIGNORE               115246
     F            DEALSDEF                          KIGNORE               115246
     F            DEALSDGF                          KIGNORE               115246
     F            DLBHISD0                          KIGNORE               115246
     F            DLCHISD0                          KIGNORE               115246
     F            DLEHISD0                          KIGNORE               115246
     F            DLGHISD0                          KIGNORE               115246
     FSDCBRTL1IF  E           K        DISK         KINFSR *PSSR      UC
     FSDBRTDL1IF  E           K        DISK         KINFSR *PSSR      UC
     FFDCCYTLLUF  E           K        DISK         KINFSR *PSSR      UC
     FFDINTRLLUF  E           K        DISK         KINFSR *PSSR      UC
     FSDCURRL0UF  E           K        DISK         KINFSR *PSSR      UC
      *                                                                                       CDL033
     FDLFRSCL0UF  E           K        DISK                           UC                      CDL033
      *  Midas DL FRCD Issued Date Schedule update file                                       CDL033
     F*
      *                                                                                       CDL013
     FSDSTAAL1IF  E           K        DISK                           UC                      CDL013
      *                                                                                       CDL013
     FDLDEALL5UF  E           K        DISK         KINFSR *PSSR      UC                    AR970738
     F*                                                                   S01408
     F/COPY WNCPYSRC,MM0102FFP1                                           S01408
     F*                                                                   S01408
     E/EJECT
     E                    CPY@    1   1 80
     E* ARRAY FOR COPYRIGHT STATEMENT
     E/COPY ZSRSRC,ZDATE9Z1
     E*
     E**  ARRAY FOR SR. ZA0850 - DAYS IN A MONTH (COMPILE TIME ARRAY)
     E                    @M     12  12  2 0
     E*
     E*
     E**  ARRAY HOLDING CURRENCY CODES
     E                    @@A       150  3
     E*
     E**  ARRAY HOLDING SPOT DATES
     E                    @@B       150  8 0
     E*
     E**  USED BY SR. XXXXXX - DEAL TYPES FOR LOAN/DEPOSITS
     E/COPY WNCPYSRC,MM0102E001
     E***********         @DT    11  11  2                                CDL006
     E**********          @DT    17  17  2                                             CDL006 CDL033
     E                    @DT    18  18  2                                                    CDL033
     E/COPY WNCPYSRC,MM0102E002
     E*
     E**  USED BY SR. XXXXXX - SIGNS FOR DEAL TYPES FOR LOAN/DEPOSITS
     E/COPY WNCPYSRC,MM0102E003
     E***********         @SN    11  11  1                                CDL006
     E**********          @SN    17  17  1                                             CDL006 CDL033
     E                    @SN    18  18  1                                                    CDL033
     E/COPY WNCPYSRC,MM0102E004
     E*
     E/COPY ZSRSRC,ZDATE2Z1
     E*
     E/COPY ZSRSRC,ZFREQBZ1
     E*
     E/COPY ZSRSRC,ZHOLE
     E*
     E                    FXT     5   5  2                                                    CDL033
     E********************************************************************
     I/EJECT
     I********************************************************************
      *                                                                                       CPK014
     IFDINTRP0                                                                                CPK014
     I              HWTMESTMP                       HWTMST                                    CPK014
     I*
     IDEALSDDF
     I*
     I*
     IDEALSDEF
     I*
     I**  Rename fields to differentiate DEALSDC from SDBRTDL1 fields.
     I*
     ISDBRTDD0
     I              LCD                             BRTLCD
     I              LCT                             BRTLCT
     I              CHTP                            BRCHTP
     I*
     IDSFDY     E DSDSFDY
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE
     I*
     I/COPY ZSRSRC,ZHOLDS
     I*
     I/COPY ZSRSRC,ZCPDZ1
     I*
      **
     ISDBANK    E DSSDBANKPD
     I** External DS for BANK Details
     I*
     ISDDEAL    E DSSDDEALPD
     I** EXTERNAL DS FOR DEALING DETAILS
     I*                                                                   E48221
     ISDMMOD    E DSSDMMODPD                                              E48221
     I** External DS for Module Details                                   E48221
     I*
     ISCSARD    E DSSCSARDPD                                              CDL006
      ** External DS for SAR details                                      CDL006
      *                                                                   CDL006
     I@STDLD    E DSMMSTDLPP
     I**  EXTERNAL DATA DATA STRUCTURE FOR STANDARD LOANS/DEPOSITS
     I*
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
     I**GENERAL*LEDGER*DETAILS*ACCESSED*VIA*ACCESS*PROGRAM*************            MD035545 MD047993
     I**********    QQACCD                          ACCDQQ                         MD035545 MD047993
     I@STDNB    E DSMMSTDBPP
     I**  EXTERNAL DATA DATA STRUCTURE FOR STANDARD NAS BOUGHT
     I              QQDORI                          QQDOR1                                    CGL029
     I              QQMORI                          QQMOR1                                    CGL029
     I              QQDOPI                          QQDOP1                                    CGL029
     I              QQMOPI                          QQMOP1                                    CGL029
     I              QQBORI                          QQBOR1                                    CGL029
     I              QQBOPI                          QQBOP1                                    CGL029
     I              QQRONS                          QQRON1                                    CGL029
     I              QQPONS                          QQPON1                                    CGL029
     I*
     I@STDNS    E DSMMSTDSPP
     I**  EXTERNAL DATA DATA STRUCTURE FOR STANDARD NAS SOLD
     I              QQDORI                          QQDOR2                                    CGL029
     I              QQMORI                          QQMOR2                                    CGL029
     I              QQBORI                          QQBOR2                                    CGL029
     I              QQBOPI                          QQBOP2                                    CGL029
     I              QQRORI                          QQROR2                                    CGL029
     I              QQROPI                          QQROP2                                    CGL029
     I              QQRONS                          QQRON2                                    CGL029
     I              QQPONS                          QQPON2                                    CGL029
     I*
     I@STDDM    E DSMMSTDAPP
     I**  EXTERNAL DATA DATA STRUCTURE FOR STANDARD DEAL AMENDMENTS
     I              QQDORI                          QQDOR3                                    CGL029
     I              QQMORI                          QQMOR3                                    CGL029
     I              QQDOPI                          QQDOP3                                    CGL029
     I              QQMOPI                          QQMOP3                                    CGL029
     I              QQBORI                          QQBOR3                                    CGL029
     I              QQBOPI                          QQBOP3                                    CGL029
     I              QQRORI                          QQROR3                                    CGL029
     I              QQROPI                          QQROP3                                    CGL029
     I              QQRONS                          QQRON3                                    CGL029
     I              QQPONS                          QQPON3                                    CGL029
     I*
     I* DATA STRUCTURE CONTAINING DATABASE ERROR INFORMATION
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I**  MMDEAULL FILE INFORMATION DATA STRUCTURE
     I@DLSTS      DS
     I                                       38  45 @DLPF
      *
     I/COPY ZSRSRC,ZDATE9Z2
      *
     I**  DATA STRUCTURE FOR SR. M1010 - DATE FIELD YYMMDD
     I            DS
     I                                        1   80HNDATE
     I                                        1   40HNVDYY
     I                                        5   60HNVDMM
     I                                        7   80HNVDDD
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATA                056095
     I***********                             1   40@@YY1                 056095
     I***********                             5   60@@MM1                 056095
     I***********                             7   80@@DD1                 056095
     I*
     I**  DATASTRUCTURE TO CHANGE FORMAT TO MMDDYY / DDMMYY
     I            DS                              6
     I                                        1   60@@DTOU
     I                                        1   20@@DAT1
     I                                        3   40@@DAT2
     I                                        5   60@@YYY
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATB                056095
     I***********                             1   40@@YY2                 056095
     I***********                             5   60@@MM2                 056095
     I***********                             7   80@@DD2                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZINTDYZ1                                               056095
     I**  Data Structure for SR. ZINTDY                                   056095
     I*                                                                   056095
     I            DS
     I**  DATA STRUCTURE FOR DATE INPUT TO VARIOUS SUBROUTINES
     I                                        1   80@@DTIN
     I***********                             1   40@@YYYY                056095
     I                                        3   40@@YY
     I                                        5   60@@MM
     I                                        7   80@@DD
      *
     I/COPY ZSRSRC,ZDAT10Z1
     I*
     I**  DATA STRUCTURE FOR SR. MM1004 - MANIPULATE DATE INPUT
     I@@WKDS      DS
     I                                        1   80@@WKDT
     I                                        1   40@@WKYY
     I                                        3   40@@WKY
     I                                        5   60@@WKM
     I                                        7   80@@WKD
     I*
     I/COPY ZSRSRC,ZHOLI
     I*
     I**  DATA STRUCTURE HOLDING STARTING POINT DATE
     I            DS
     I                                        1   80@@STRT
     I                                        1   40@@STYR
     I                                        5   60@@STMT
     I                                        7   80@@STDY
     I*
     I**  DATA STRUCTURE HOLDING SPOT DATE
     I            DS
     I                                        1   80@@SPDD
     I                                        1   40@@SPYR
     I                                        5   60@@SPMT
     I                                        7   80@@SPDY
     I*
     I**  DATA STRUCTURE DAYS FOR DATE FORMAT DDMMYY
     I            DS
     I                                        1   60@@DATE
     I                                        1   20@@DAY2
     I*
     I*
     I**  DATA STRUCTURE TO STORE DETAILS FOR MATURITY INTEREST CALCS
     I**  - NEW DETAILS
     I@NEWDT      DS
     I                                        1   40HKSLYY
     I                                        5   60HKSLMM
     I                                        7   80HKSLDD
     I                                        9  120HKNIYY
     I                                       13  140HKNIMM
     I                                       15  160HKNIDD
     I                                       17  17 @KDSTS
     I                                       18  210HKIAYY
     I                                       22  230HKIAMM
     I                                       24  250HKIADD
     I                                    P  26  317HKINTR
     I                                    P  32  377HKIIRT
     I                                    P  38  437HKSPRD
     I                                    P  44  510HKAMNP
     I                                       52  52 HKIPFQ
     I                                       53  540HKIPDM
     I                                       55  55 HKNGVI                                    CDL033
     I*
     I**  DATA STRUCTURE TO STORE DETAILS FOR MATURITY INTEREST CALCS
     I**  - OLD DETAILS
     I@OLDDT      DS
     I                                        1   40@SLYY
     I                                        5   60@SLMM
     I                                        7   80@SLDD
     I                                        9  120@NIYY
     I                                       13  140@NIMM
     I                                       15  160@NIDD
     I                                       17  17 @DSTS
     I                                       18  210@IAYY
     I                                       22  230@IAMM
     I                                       24  250@IADD
     I                                    P  26  317@INTR
     I                                    P  32  377@IIRT
     I                                    P  38  437@SPRD
     I                                    P  44  510@AMNP
     I                                       52  52 @IPFQ
     I                                       53  540@IPDM
     I                                       55  55 @NGVI                                     CDL033
     I**  DATA STRUCTURE TO DEFINE DEAL NO. - @DN38
     I            DS
     I                                        1   60@DN38
     I                                        1   60HKDN38
     I                                        1   60HLDN38
     I                                        1   60HMDN38
     I*
     I**  DATA STRUCTURE TO DEFINE DEAL DELETED INDICATOR - @DDLT
     I            DS
     I                                        1   1 @DDLT
     I                                        1   1 HKDDLT
     I                                        1   1 HLDDLT
     I                                        1   1 HMDDLT
     I*
     I**  DATA STRUCTURE TO DEFINE LOGICAL DELETE FLAG - @DLTF
     I            DS
     I                                        1   1 @DLTF
     I                                        1   1 HKDLTF
     I                                        1   1 HLDLTF
     I                                        1   1 HMDLTF
     I*
     I**  DATA STRUCTURE TO DEFINE DEAL STATUS - @HDSTS
     I            DS
     I                                        1   1 @HDSTS
     I                                        1   1 HKDSTS
     I                                        1   1 HLDSTS
     I                                        1   1 HMDSTS
     I*
     I**  RELATED DEAL ROLLOVER MATURITY DATE
     I            DS
     I                                        1   80@IKRMT
     I                                        9  140@IKDDN
     I                                        1   40HKMDYY
     I                                        5   60HKMDMM
     I                                        7   80HKMDDD
     I                                        9  14 HKDADN
      *                                                                                       CDL081
      ** Named constants                                                                      CDL081
      *                                                                                       CDL081
     I              'BasCcyTaxRoundDown'  C         C#BASE                                    CDL081
     I              'NBasCcyTaxRoundDown' C         C#NBAS                                    CDL081
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I/EJECT
     I/COPY WNCPYSRC,MM0102I001
     C********************************************************************
      *
      *                          PROGRAM SUMMARY
      *
      *                           INTRODUCTION
      *
      *This program runs during the Start-of-day processing after the new
      *run date has been entered.
      *
      *This program controls the rebuilding of a number of files in
      *readiness for the next days processing as well as updating for the
      *Deals/Deams files so they are inline with the MIDAS Deals/Deams
      *files.
      *
      *
      * THIS PROGRAM IS A COPY OF MM0101 AND IS RUN WHEN TM IS NOT ON.
      * WHEN TM IS ON MM0101 IS RUN.
      *                       ********************
      *                          PROCESS SUMMARY
      *
      *MMP0367 - Mainline & DEALS Update
      *
      *MMP0368 - DEAMS Update
      *
      *MMP0356 - Interest rates Period Dates Update.
      *
      *MMP0236 - Calls Revalue Profit/Loss.
      *
      *DATA AREAS :        None
      *
      *SCREENS    :        None
      *
      *REPORTS    :        None
      *
      *DATA IN    :        None
      *
      *DATA OUT   :        None
      *
      *                       ********************
      *                           PROCESS FLOW
      *
      *Overall Process:
      *
      * A. Perform initial processing.
      *
      * B. Perform main processing.
      *
      * C. Perform termination processing.
      *
      *Parameters:  Termination code (' ',T,E)
      *
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     INDEX TO SUBROUTINES                                         *
     C*                                                                  *
     C*  1. *PSSR  - DUMP                                                *
     C*  2. #A     - INITIAL PROCESSING                                  *
     C*  3. #AA    - CALCULATE MM SPOT DATE                              *
     C*  4. #B     - MAIN PROCESSING                                     *
     C*  5. #BA    - MM DEAL PROCESSING                                  *
     C*  7. #BAA   - PREPARE AND UPDATE MMDELDPP - LOANS/DEPOSITS        *
     C*  8. #BAB   - PREPARE AND UPDATE MMDENBPP - NA'S BOUGHT           *
     C*  9. #BAC   - PREPARE AND UPDATE MMDENSPP - NA'S SOLD             *
     C* 13. #BAG   - DELETE RELEVENT MM DEALS RECORD                     *
     C* 14. #BB    - MM DEAM PROCESSING                                  *
     C* 17. #BC    - PERIOD DATES UPDATE FOR FDINTRPP                    *
     C* 18. #C     - TERMINATION PROCESSING                              *
     C* 20. MM1003 - CALCULATE A PERIOD DATE                             *
     C* 21. MM1004 - CALCULATES THE NEXT INTEREST DATE                   *
     C**22**MM1007*-*CALCULATES INTEREST                                 *S01392
     C* 22. MM1030 - CALCULATES INTEREST                                 *S01392
     C**23.*MM1009*-*CALCULATES*THE*NEXT*INTEREST*DATE*****************  *056095
     C* 23. ZINTDY - CALCULATES THE NEXT INTEREST DATE                   *056095
     C* 24. MM1010 - CALCULATES THE NUMBER OF INTEREST DAYS              *
     C* 25. ZDAT10 - CONVERTS YYYYMMDD DATE TO MIDAS DAY NO.             *
     C* 26. ZDATE9 - Convert day no. to YYYYMMDD format.                 *
     C* 27. ZA0730 - DETERMINE NEXT WORKING DAY                          *
     C* 28. ZA0770 - CONVERTS A YYYYMMDD DATE TO DDMMYY OR MMDDYY DATE   *
     C* 29. ZDATE2 - Convert day no. to DDMMMYY format.                  *
     C* 30. ZCPD   - Calculate a Period Date                             *
     C*                                                                  *
     C*     INDEX TO PROGRAMS CALLED                                     *
     C*                                                                  *
     C*  1. MM0053 - REVALUE PROFIT AND LOSS                             *
     C*  2. MM0173 - NEAR DATE SUMMARY                                   *
     C*  3. MM0174 - CUSTOMER EXPOSURE UPDATE                            *
     C*  4. MM0175 - FORWARD BOOK UPDATE                                 *
     C*  6. MM0194 - LIQUIDITY EXPOSURE                                  *
     C*  7. MM0098 - NEAR DATES SUMMARY                                  *
     C*                                                                  *
     C********************************************************************
     C*
     C/COPY WNCPYSRC,MM0102C022
     C                     EXSR #A
     C*
     C           @TERM     CASEQ' '       #B
     C                     END
     C*
     C                     EXSR #C
     C*
     C                     RETRN
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
      *
      *                         DETAIL PROCESSING
      *
      * 1. Read a record from MM Deals file (MMDEALLL)
      *
      * 2. If end of file goto step 6.
      *
      * 3. Use deal number to chain to MIDAS Deals File (DEALS)
      *
      * 4. If record exists:
      *
      *     4.1 Prepare fields required for MM deal.
      *
      *     4.2 Update standard MM deal from details on DEALS as per
      *         R/MM0101,02/03/04 (depending upon deal type)
      *
      *     4.3 If deal deleted flag is not = 'D':
      *
      *          4.3.1 If logical delete flag is not = '*':
      *
      *                 4.3.1.1 If deal status is not = 'E' or 'M':
      *
      *                          4.3.1.1.1 Prepare standard deal from LF/
      *                                    DEALS and include Action code =
      *                                    = 'I'and Last action code = 'I'
      *                                    as per R/MM0101,05/06/07
      *
      *                          4.3.1.1.2 If deal is a negotiable asset
      *                                    sold:
      *                              4.3.1.2.2.1 Access N.A. bought
      *                                          with related deal
      *                                          number
      *                              4.3.1.2.2.2 Prepare related fields
      *                                          on N.A. sold (for a
      *                                          standard deal) with
      *                                          their equivalents from
      *                                          the N.A. bought as per
      *                                          R/MM0101,08
      *
      *
      *                          4.3.1.1.3 Call MM0173 - Near Date
      *                                    Summary Update
      *
      *
      *                          4.3.1.1.4 Call MM0174 - Customer
      *                                    Exposure Update
      *
      *                          4.3.1.1.5 Call MM0175 - Forward Book
      *                                    Update
      *
      *                          4.3.1.1.6 Call MM0194 - Liquidity
      *                                    Exposure Update
      *  Else:
      *
      *     4.4 Delete MM Deal as per R/MM0101,09
      *
      * 5. Go to step 1.
      *
      * 6. Read a record from MM Deams file (MMDEAMLL)
      *
      * 7. If end of file goto step 12.
      *
      * 8. If deam type = 'SI':
      *
      *     8.1 If deal number is same as previous deal:
      *
      *          8.1.1 Goto step 6
      *
      * Else:
      *
      *          8.1.2 Save deal number
      *
      * 9. Use deal number to chain to MIDAS deams file (DEAMS)
      *
      *10. If record found:
      *
      *    10.1 If deal deleted flag is not = 'D'
      *
      *         10.1.1 If logical delete flag is not = '*'
      *
      *                10.1.1.1 If deal status is not = 'E' or 'M':
      *
      *                  10.1.1.1.1 Prepare standard deam where action
      *                             code = 'I' and last action code =
      *                             'I' as per R/MM0101,11
      *
      *                  10.1.1.1.2 Call MM0112 - File Rebuild Control
      *
      * Else:
      *
      *    10.4 Delete MMDEAM as per R/MM0101,12
      *
      *11. Go to step 6.
      *
      *17. Comit data base changes
      *
      *18. End.
      *
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #B - MAIN PROCESSING                                         *
     C*                                                                  *
     C*     CALLED BY  : CONTROL PROCESSING                              *
     C*                                                                  *
     C*     CALLS      : #BA                                             *
     C*                  #BB                                             *
     C*                  #BC - CALCULATE MM INTEREST RATES PERIOD DATE   *
     C*                                                                  *
     C*     WORK FIELDS: @TERM    TERMINATION FLAG              (1A)     *
     C*                                                                  *
     C********************************************************************
     C*
     C           #B        BEGSR
     C*
     C**  PROCESS MM DEALS - THESE ARE UPDATED FROM DETAILS ON LF/DEALS
     C                     EXSR #BA
     C*
     C**  PROCESS MM DEAMS - THESE ARE UPDATED FROM DETAILS ON LF/DEAMS
     C           @TERM     IFEQ ' '                        B1
     C                     EXSR #BB                        *1
     C                     END                             E1
     C*
     C**  CALL FILE REBUILD CONTROL PROGRAM
     C*
     C           @TERM     IFEQ ' '                        B1
     C                     CALL 'MM0112'                   *1
     C                     PARM           @TERM            *1
     C                     END                             E1
     C**  SETUP INTEREST RATES PERIOD DATES
     C           @TERM     IFEQ ' '                        B1
      *                                                                                       180229
      ** Ignore this condition to mantain FDINTRPP.                                           180229
      *                                                                                       180229
     C********** BGTRMG    IFEQ 'Y'                                                    E48221 180229
     C********** BGFIIN    OREQ 'Y'                                                    E48221 180229
     C/COPY WNCPYSRC,MM0102C019
     C                     EXSR #BC                        *1
     C**********           END                                                         E48221 180229
     C                     END                             E1
     C*
     C**  CALL NECESSARY UPDATE PROGRAMS
     C           @TERM     IFEQ ' '                        B1
     C*
     C**  MM0053 - REVALUE PROFIT AND LOSS
     C           BGTRMG    IFEQ 'Y'                                       E48221
     C***********BGFIIN    OREQ 'Y'                                       E48221             BUG8605
     C           BGDRMM    OREQ 'Y'                                                          BUG8605
     C                     CALL 'MM0053'                   *1
     C                     PARM           @TERM            *1
     C                     END                                            E48221
     C                     END                             E1
     C*
     C           #B9       ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BA - MM DEAL PROCESSING                                     *
     C*                                                                  *
     C*     CALLED BY  : #B                                              *
     C*                                                                  *
     C*     CALLS      : #BAA -  PREPARE & UPDATE MMDELDPP - LD'S        *
     C*                  #BAB -  PREPARE & UPDATE MMDENBPP - NA'S BOUGHT *
     C*                  #BAC -  PREPARE & UPDATE MMDENSPP - NA'S SOLD   *
     C*                  #BAD -  PREPARE STD DEAL FOR ENQS - LD'S        *
     C*                  #BAE -  PREPARE STD DEAL FOR ENQS - NA'S SOLD   *
     C*                  #BAF -  PREPARE STD DEAL FOR ENQS - NA'S BOUGHT *
     C*                  #BAG -  DELETE RELEVENT MM DEALS RECORD         *
     C*                  #ZA  -  UPDATE RELEVENT ENQUIRIES               *
     C*                                                                  *
     C*     WORK FIELDS: @DN38    DEAL NUMBER                   (6N)     *
     C*                  @DLKY    DEAL NUMBER KEY LIST          KLIST    *
     C*                  @DEALN   DEAL NUMBER                   (6N)     *
     C*                  @DDLT    DEAL DELETED INDICATOR        (1A)     *
     C*                  @DLTF    LOGICAL DELETE FLAG           (1A)     *
     C*                  @HDSTS   DEAL STATUS INDICATOR         (1A)     *
     C*                  @DLPF    MM DEALS PHYSICAL FILE NAME   (8A)     *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BA       BEGSR
     C*
     C**  READ SEQUENTIALLY THROUGH MM DEALS FILE
     C           *IN60     DOUEQ'1'                        B1
     C                     READ MMDEAULL                 60
     C           *IN60     IFEQ '0'                        B2
     C*
     C**  ACCESS MIDAS DEALS FILE TO UPDATE RELEVENT FIELDS ON MMDEALLL.
     C**  IF A DEALS RECORD IS NOT FOUND DELETE MMDEALLL RECORD.
     C                     Z-ADD@DN38     @DEALN
     C           @DLKY     CHAINDEALS                61
     C           *IN61     IFEQ '0'                        B3
     C*
     C/COPY WNCPYSRC,MM0102C009
     C**  IF A DEALS RECORD IS FOUND PREPARE MM DEAL FIELDS (DEPENDING
     C**  UPON DEAL TYPE) AND UPDATE MMDEAULL
     C           @DLPF     CASEQ'MMDELDP0'#BAA             *3 LOANS/DEP
     C           @DLPF     CASEQ'MMDENBP0'#BAB             *3 N.A.S BOUGHT
     C           @DLPF     CASEQ'MMDENSP0'#BAC             *3 N.A.S SOLD
     C                     END                             *3
     C           @TERM     CABNE' '       #BA9             *3 ----------->
     C*
     C*
     C/COPY WNCPYSRC,MM0102C004
     C                     ELSE                            X3
     C*
     C**  IF DEALS RECORD NOT FOUND DELETE RELEVENT MM DEAL RECORD
     C/COPY WNCPYSRC,MM0102C005
     C                     EXSR #BAG                       *3
     C/COPY WNCPYSRC,MM0102C006
     C*
     C                     END                             E3
     C*
     C                     END                             E2
     C*
     C                     END                             E1
     C*
     C           #BA9      ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BAA - PREPARE AND UPDATE MMDELDPP - LOANS/DEPOSITS          *
     C*                                                                  *
     C*     CALLED BY  : #BA,                                            *
     C*                                                                  *
     C*     CALLS      : MM1010   INTEREST AT MATURITY CALCULATIONS      *
     C*                  ZDATE9   CONVERT MIDAS DAY NO. TO YYYYMMDD      *
     C*                                                                  *
     C*     WORK FIELDS: @KDSTS   DEAL STATUS                   (1A)     *
     C*                  @OLDDT   OLD DETAILS } USED FOR MATUR-(54A)     *
     C*                  @NEWDT   NEW DETAILS } ITY INT. CALCS.(54A)     *
     C*                  @SLYY    START/LAST INTEREST DATE YEAR (4N)     *
     C*                  @SLMM       "          "      "   MTH  (2N)     *
     C*                  @SLDD       "          "      "   DAY  (2N)     *
     C*                  @NIYY    NEXT INTEREST PAYMENT YEAR    (4N)     *
     C*                  @NIMM      "     "       "     MTH     (2N)     *
     C*                  @NIDD      "     "       "     DAY     (2N)     *
     C*                  @DSTS    DEAL STATUS                   (1A)     *
     C*                  @IAYY    ACCRUAL CONTROL DATE YEAR     (4N)     *
     C*                  @IAMM      "        "     "   MTH      (2N)     *
     C*                  @IADD      "        "     "   DAY      (2N)     *
     C*                  @INTR    DEAL INTEREST RATE            (11,7N)  *
     C*                  @IIRT    INPUT   "      "              (11,7N)  *
     C*                  @SPRD    SPREAD RATE                   (11,7N)  *
     C*                  @AMNP    AMOUNT                        (15N)    *
     C*                  @IPFQ    INTEREST PAYMENT FREQUENCY    (1A)     *
     C*                  @IPDM       "     FREQUENCY DAY IN MTH (2N)     *
     C*                  @@BRMD   Maturity date for BRT calculation      *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BAA      BEGSR
     C*
     C**  ONLY THE FOLLOWING FIELDS ARE UPDATED FROM THE MIDAS DEALS FILE
     C*
     C*
     C**  SAVE DETAILS USED FOR MATURITY INTEREST CALCULATIONS
     C                     Z-ADDHKSLYY    @SLYY
     C                     Z-ADDHKSLMM    @SLMM
     C                     Z-ADDHKSLDD    @SLDD
     C                     Z-ADDHKNIYY    @NIYY
     C                     Z-ADDHKNIMM    @NIMM
     C                     Z-ADDHKNIDD    @NIDD
     C                     MOVE HKDSTS    @DSTS
     C                     Z-ADDHKIAYY    @IAYY
     C                     Z-ADDHKIAMM    @IAMM
     C                     Z-ADDHKIADD    @IADD
     C                     Z-ADDHKINTR    @INTR
     C                     Z-ADDHKIIRT    @IIRT
     C                     Z-ADDHKSPRD    @SPRD
     C                     MOVE HKNGVI    @NGVI                                               CDL033
     C                     Z-ADDHKAMNP    @AMNP
     C                     MOVE HKIPFQ    @IPFQ
     C                     Z-ADDHKIPDM    @IPDM
     C                     Z-ADDHKIPDM    @@MDAY                                            MD038562
     C**********           Z-ADDHKCNUM    @CNUM   60                                          CSD027
     C                     MOVE HKCNUM    @CNUM   6                                           CSD027
     C*
     C**  CONVERT DATES FROM MIDAS DAY NO. TO RELEVENT FORMAT
     C                     Z-ADDSLID      @@DAYN
     C                     Z-ADDSLID      HKSLID                                            MD024467
     C                     EXSR ZDATE9
     C                     Z-ADD@@Z71D    HKSLDD
     C                     Z-ADD@@Z71M    HKSLMM
     C                     Z-ADD@@YR      HKSLYY
     C*
     C                     Z-ADDNIDT      @@DAYN
     C                     Z-ADDNIDT      HKNIPD                                            MD024467
     C                     EXSR ZDATE9
     C                     Z-ADD@@Z71D    HKNIDD
     C                     Z-ADD@@Z71M    HKNIMM
     C                     Z-ADD@@YR      HKNIYY
     C                     Z-ADDNIDT      HKNIPD                                              262922
     C*
     C**  IF MIDAS RECORD HAS A RECORD ID OF 'M' UPDATE DRS DEAL STATUS
     C**  WITH 'M'
     C           RECI      IFEQ 'M'                        B1
     C                     MOVE 'M'       HKDSTS           *1
     C                     END                             E1
     C                     Z-ADDXKRCDT    HKRCDT                                           AR755195A
     C                     Z-ADDXKINFD    HKINFD                                           AR755195A
     C                     Z-ADDINTR      HKINTR                                           AR755195A
     C                     Z-ADDINTR      HKSTRT                                           AR755195A
     C*
     C                     Z-ADDIACD      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@Z71D    HKIADD
     C                     Z-ADD@@Z71M    HKIAMM
     C                     Z-ADD@@YR      HKIAYY
     C*
     C                     MOVE IPFR      HKIPFQ
     C                     Z-ADDINTF      HKIPDM
     C*
     C**  IF MIDAS BASE RATE TYPE IS ZERO:
     C           BRTT      IFEQ 0                          B1
     C*                    Z-ADDRTSP      HKINTR           *1
     C*                    Z-ADDRTSP      HKIIRT           *1
     C**********           Z-ADDINTR      HKINTR           *1                              AR755195A
     C**********           Z-ADDINTR      HKIIRT           *1                                 261960
     C                     Z-ADD0         HKSPRD           *1
     C*
     C**  REVERSE SIGNS OF INTEREST IF -VE INTEREST SIGN IS 'Y'
     C*          HKNGVI    IFEQ 'Y'                        B*2
     C*                    Z-SUBHKINTR    HKINTR           **2
     C*                    Z-SUBHKIIRT    HKIIRT           **2
     C*                    END                             E*2
     C*
     C                     ELSE                            X1
     C**********           Z-ADDINTR      HKINTR           *1                              AR755195A
     C                     MOVE BRTT      HKBSRC                                            MD024467
     C                     MOVE BRTT      HKDBSR                                            MD024467
     C                     MOVELCCY       HKDBSR                                            MD024467
     C                     Z-ADDRTSP      HKSPRD           *1
     C**********           Z-ADDRTSP      HKIIRT           *1                                 261960
     C                     END                             E1
     C/COPY WNCPYSRC,MM0102C017
      *                                                                                       CDL033
      ** If the effective interest is Negative, update HKNGVI with 'Y'                        CDL033
      ** As field DSTI (bit 1) might not be accurate                                          CDL033
      *                                                                                       CDL033
     C           HKINTR    IFLT *ZERO                                                         CDL033
     C                     MOVE 'Y'       HKNGVI                                              CDL033
     C                     ELSE                                                               CDL033
     C**********           MOVE 'N'       HKNGVI                                     CDL033 AR937172
     C                     MOVE ' '       HKNGVI                                            AR937172
     C                     ENDIF                                                              CDL033
     C*
     C**  OBTAIN SIGN OF PRINCIPAL ACCORDING TO DEAL TYPE (MMT0014)
     C                     Z-ADD1         @X      20
     C           DTYP      LOKUP@DT,@X                   64
     C           *IN64     IFEQ '0'                        B1
     C           CDL006    OREQ 'N'                                       CDL006
     C           @X        ANDGE12                                        CDL006
     C           @X        ANDLE17                                        CDL006
     C           *LOCK     IN   LDA
     C                     Z-ADD001       DBASE            ***************
     C                     MOVEL'DEALSDC 'DBFILE           * DB ERROR 01 *
     C                     MOVELDTYP      DBKEY            ***************
     C                     MOVEL'MM0102'  DBPGM
     C                     MOVE 'E'       @TERM            *1
     C                     DUMP                            *1
     C                     OUT  LDA
     C                     GOTO #BAA9                      *1
     C                     END                             E1
     C*
     C**  SET PRINCIPAL SIGN ACCORDING TO DEAL TYPE
     C                     Z-ADDPCPL      HKAMNP
     C           @SN,@X    IFEQ '-'                        B1
     C                     Z-SUBHKAMNP    HKAMNP
     C                     END                             E1
     C/COPY WNCPYSRC,MM0102C018
     C*
     C**  CALCULATE INTEREST AT MATURITY ONLY IF INTEREST DETAILS
     C**  HAVE CHANGED (HKDSTS HAD TO RENAMED IN DATA STRUCTURE TO PREVENT
     C**  CLASHING). ONLY UPDATE MMDELDPP IF DETAILS HAVE CHANGED.
     C                     MOVE HKDSTS    @KDSTS
     C           @OLDDT    IFNE @NEWDT                     B1
     C*                                                                   S01392
     C**  Front Up Interest deal has zero interest at maturity.           S01392
     C*                                                                   S01392
     C           FUID      IFEQ 'Y'                        B*2            S01392
     C                     Z-ADD0         HKIMAT           **2            S01392
     C                     ELSE                            X*2            S01392
     C                     Z-ADDTOTI      @@TINT           *1
     C                     Z-ADDIPRD      @@INTD           *1
     C                     MOVE HKIPFQ    @@INFQ           *1
     C                     Z-ADDNIDT      @@NXIP           *1
     C                     Z-ADDVDAT      @@VDAT           *1
     C                     MOVE HKICMT    @@INCM           *1
     C                     Z-ADDHKAMNP    @@DLAM           *1
     C*
     C**  IF MIDAS BASE RATE TYPE IS NOT 0, ADD INTEREST AND SPREAD RATES
     C                     Z-ADDRTSP      @@EIRT           *1
     C           BRTT      IFNE 0                          B*2
     C                     ADD  INTR      @@EIRT           **2
     C                     END                             E*2
     C                     MOVE ' '       @@MTXI           *1
     C                     Z-ADDHKDN38    @@DEAL           *1
     C*
     C** IF BRT SAR INSTALLED
     C*
     C           S01383    IFEQ 'Y'
     C/COPY WNCPYSRC,MMH00198
     C                     MOVE TAXI      @@MTXI           *1
     C                     END
     C*
     C** Calculate maturity date for BRT tax calculations
     C*
     C           DTYP      IFEQ 'CD'                       B*2
     C           DTYP      OREQ 'CL'                       **2
     C           DTYP      OREQ 'DL'                       **2
     C           NOTD      IFEQ 0                          B**3
     C           VDAT      ADD  1         @@BRMD  50       ***3
     C                     ELSE                            X**3
     C           NOTD      IFNE -999                       B***4
     C           VDAT      ADD  NOTD      @@BRMD           ****4
     C                     ELSE                            X***4
     C                     Z-ADDMDAT      @@BRMD           ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     Z-ADDMDAT      @@BRMD           **2
     C                     END                             E*2
     C                     EXSR MM1010                     *1
     C*
     C** ERROR HANDLING
     C*
     C           @TERM     IFEQ 'E'
     C                     GOTO #BAA9
     C                     END
     C*
     C**  REVERSE SIGN OF INTEREST CALCULATED
     C                     Z-SUB@@INMT    HKIMAT           *1
     C                     END                             E*2            S01392
      *                                                                   BUG4092
      **  Update fields which may have been amended due to                BUG4092
      **  an early maturity deal amendment event.                         BUG4092
     C           FSCAND    IFNE *ZERO                                     BUG4092
      *                                                                   BUG4092
      **  Convert new maturity date                                       BUG4092
     C                     Z-ADDMDAT      HKMATD                          BUG4092
     C                     Z-ADDMDAT      @@DAYN                          BUG4092
     C                     EXSR ZDATE9                                    BUG4092
     C                     Z-ADD@@Z71D    HKMDDD                          BUG4092
     C                     Z-ADD@@Z71M    HKMDMM                          BUG4092
     C                     Z-ADD@@YR      HKMDYY                          BUG4092
      *                                                                   BUG4092
      **  Cancellation date and penalty pay/receive indicator             BUG4092
     C                     MOVE FSCAND    HKCAND                          BUG4092
     C                     MOVE FSPNPR    HKPNPR                          BUG4092
     C                     Z-ADDPENA      HKPENA                                            MD024467
      *                                                                   BUG4092
     C                     ENDIF                                          BUG4092
      ** Update Total Interest field of MMDELDPP                                              260340
      *                                                                                     AR937172
     C           HKMTTI    IFGE 0                                                           AR937172
     C                     Z-ADDTOTI      HKMTTI                                              260340
     C                     ELSE                                                             AR937172
     C                     Z-SUBTOTI      HKMTTI                                            AR937172
     C                     ENDIF                                                            AR937172
     C*
     C**  UPDATE PF/MMDELDPP
     C**********           EXCPTDELD                       *1                               AR755195
     C                     END                             E1
     C                     EXCPTDELD                                                        AR755195
     C*
     C           #BAA9     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BAB - PREPARE AND UPDATE MMDENBPP - NA'S BOUGHT             *
     C*                                                                  *
     C*     CALLED BY  : #BA,                                            *
     C*                                                                  *
     C*     CALLS      : ZDATE9   CONVERT MIDAS DAY NO. TO YYYYMMDD      *
     C*                                                                  *
     C*     WORK FIELDS:                                                 *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BAB      BEGSR
     C*
     C**  ONLY THE FOLLOWING FIELDS ARE UPDATED FROM THE MIDAS DEALS FILE
     C*
     C*
     C**  CONVERT DATES FROM MIDAS DAY NO. TO RELEVENT FORMAT
     C                     Z-ADDSLID      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@Z71D    HLLIDD
     C                     Z-ADD@@Z71M    HLLIMM
     C                     Z-ADD@@YR      HLLIYY
     C*
     C                     Z-ADDNIDT      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@Z71D    HLNIDD
     C                     Z-ADD@@Z71M    HLNIMM
     C                     Z-ADD@@YR      HLNIYY
     C                     Z-ADDNIDT      HLNIPD                                              262922
     C*
     C**  IF MIDAS RECORD HAS A RECORD ID OF 'M' UPDATE DRS DEAL STATUS
     C**  WITH 'M'
     C           RECI      IFEQ 'M'                        B1
     C                     MOVE 'M'       HLDSTS           *1
     C                     END                             E1
     C*
     C                     Z-ADDIACD      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@Z71D    HLIADD
     C                     Z-ADD@@Z71M    HLIAMM
     C                     Z-ADD@@YR      HLIAYY
     C*
     C                     MOVE IPFR      HLIPFQ
     C                     Z-ADDINTF      HLIPDM
      *                                                                                    AR1055654
     C           CDL088    IFEQ 'Y'                                                        AR1055654
      * Yield Rate                                                                         AR1055654
     C           DTYP      IFEQ 'C1'                                                       AR1055654
     C           DTYP      OREQ 'C2'                                                       AR1055654
     C           DTYP      OREQ 'BP'                                                       AR1055654
     C           DTYP      OREQ 'BD'                                                       AR1055654
     C                     Z-ADDYRAT      HLINTR                                           AR1055654
     C                     ELSE                                                            AR1055654
     C                     Z-ADDYRAT      HLDCRT                                           AR1055654
     C                     ENDIF                                                           AR1055654
      * RATE/SPREAD                                                                        AR1055654
     C                     Z-ADDINTR      HLFRAT                                           AR1055654
     C                     ENDIF                                                           AR1055654
     C*
     C**  CALCULATE NA NET VALUE.
     C**  IF NA IS INTEREST BEARING CALCULATE NET VALUE AS:
     C**  NET VALUE = FACE VALUE + UNPAID INTEREST
     C           DTYP      IFEQ 'C1'                       B1
     C           DTYP      OREQ 'C2'                       *1
     C           DTYP      OREQ 'BP'                       *1
     C           DTYP      OREQ 'BD'                       *1
     C                     Z-ADDFVAL      HLNANV           *1
     C                     ADD  AITC      HLNANV           *1
     C                     ADD  AIAN      HLNANV           *1
     C                     SUB  AIPD      HLNANV           *1
     C                     SUB  AIAP      HLNANV           *1
     C*
     C**  ...... NET VALUE = FACE VALUE + DISCOUNT AMOUNT
     C                     ELSE                            X1
     C                     Z-ADDFVAL      HLNANV           *1
     C                     ADD  DPTD      HLNANV           *1
     C                     SUB  DISA      HLNANV           *1
     C                     END                             E1
      *                                                                   113605
      ** Parceled NA's purchased also have following fields updated       113605
      ** (reduced) by DL280 to reflect any NA's sold entered as           113605
      ** they reach the value date.                                       113605
      *                                                                   113605
     C                     Z-ADDPSZE      HLPSZE                          113605
     C                     Z-ADDNSLD      HLNSLD                          113605
     C                     Z-SUBPUPR      HLAMNP                          113605
     C                     Z-ADDTOTI      HLMTTI                                              222986
     C                     Z-ADDFVAL      HLFVAL                          113605
     C                     Z-ADDDISA      HLDCAM                          113605
     C*
     C**  UPDATE PF/MMDENBPP
     C                     EXCPTDENB
     C*
     C           #BAB9     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BAC - PREPARE AND UPDATE MMDENSPP - NA'S SOLD               *
     C*                                                                  *
     C*     CALLED BY  : #BA,                                            *
     C*                                                                  *
     C*     CALLS      : ZDATE9   CONVERT MIDAS DAY NO. TO YYYYMMDD      *
     C*                                                                  *
     C*     WORK FIELDS:                                                 *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BAC      BEGSR
     C*
     C**  ONLY THE FOLLOWING FIELDS ARE UPDATED FROM THE MIDAS DEALS FILE
     C*
     C*
     C**  CONVERT DATES FROM MIDAS DAY NO. TO RELEVENT FORMAT
     C                     Z-ADDSLID      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@Z71D    HMLIDD
     C                     Z-ADD@@Z71M    HMLIMM
     C                     Z-ADD@@YR      HMLIYY
     C*
     C** NEXT INTEREST PAY DATE NOT RELEVANT TO N/A'S SOLD
     C                     Z-ADD0         HMNIDD
     C                     Z-ADD0         HMNIMM
     C                     Z-ADD0         HMNIYY
     C*
     C**  IF MIDAS RECORD HAS A RECORD ID OF 'M' UPDATE DRS DEAL STATUS
     C**  WITH 'M'
     C           RECI      IFEQ 'M'                        B1
     C                     MOVE 'M'       HMDSTS           *1
     C                     END                             E1
     C*
     C**  FOR NA'S SOLD ACCESS THE RELATED NA BOUGHT TO UPDATE RELATED
     C**  FIELDS ON PF/MMDENSPP - DB ERROR IF NOT FOUND
     C                     MOVE HMDADN    @DEALN  60
     C           @DLKY     CHAINDEALS                61
     C           *IN61     IFEQ '1'                        B1
     C*
     C           @DLKY     CHAINDEALSH               62                   115246
     C           *IN62     IFEQ '1'                                       115246
     C           *LOCK     IN   LDA
     C                     Z-ADD002       DBASE            ***************
     C                     MOVEL'DEALS'   DBFILE           * DB ERROR 02 *
     C                     MOVEL@DEALN    DBKEY            ***************
     C                     MOVEL'MM0102'  DBPGM
     C                     MOVE 'E'       @TERM            *1
     C                     DUMP                            *1
     C                     OUT  LDA
     C                     GOTO #BAC9                      *1
     C                     END                             E1
      * Get details from Historic file.                                   115246
     C                     MOVE IPFR      HMIPFQ                          115246
     C                     Z-ADDINTF      HMIPDM                          115246
     C                     ELSE                                           115246
      * Indicator 60 is off @DLKY found in DEALS file.                    115246
     C                     MOVE HLIPFQ    HMIPFQ
     C                     Z-ADDHLIPDM    HMIPDM
     C                     ENDIF                                          115246
     C*
     C*
     C**  UPDATE PF/MMDENSPP
     C                     EXCPTDENS
     C*
     C           #BAC9     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BAG - DELETE RELEVENT MM DEALS RECORD                       *
     C*                                                                  *
     C*     CALLED BY  : #BA,                                            *
     C*                                                                  *
     C*     CALLS      :                                                 *
     C*                                                                  *
     C*     WORK FIELDS: @DLPF    MM DEAL FORMAT NAME           (8A)     *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BAG      BEGSR
     C*
     C**  DELETE RELEVENT FORMAT
     C*
     C           @DLPF     IFEQ 'MMDELDP0'                 B1 LOANS/DEP
     C           HKDSTS    IFNE 'C'                                                          BUG3838
     C           HKDDLT    OREQ 'D'                                                          BUG3838
     C                     DELETMMDELDP0                   *1
      *                                                                                      252554A
      ** Delete the corresponding record in the UDF files.                                   252554A
      *                                                                                      252554A
     C                     Z-ADDHKDN38    PDDLNO  60                                        AR588416
     C                     CALL 'MMDELUDF'                                                   252554A
     C**********           PARM           HKDN38                                    252554A AR588416
     C                     PARM           PDDLNO                                            AR588416
     C                     PARM 'LDNI'    #API    4                                          252554A
      *                                                                                      252554A
     C                     EXSR DELEXT                                                      AR970738
     C                     ENDIF                                                             BUG3838
     C/COPY WNCPYSRC,MM0102C007
      *                                                                                       CDL033
      ** Remove records of deleted CF deal in files DLFRSCPD                                  CDL033
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C                     EXSR CKDEAL                                                        CDL033
     C           @FXT      IFEQ *ON                                                           CDL033
     C           HKMTYP    OREQ 'CF'                                                          CDL033
      *                                                                                       CDL033
     C           HKDN38    SETLLDLFRSCL0                                                      CDL033
     C           HKDN38    READEDLFRSCL0                 62                                   CDL033
     C           *IN62     DOWEQ*OFF                                                          CDL033
     C                     DELETDLFRSCL0                                                      CDL033
     C           HKDN38    READEDLFRSCL0                 62                                   CDL033
     C                     ENDDO                                                              CDL033
      *                                                                                       CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C                     END                             E1
     C           @DLPF     IFEQ 'MMDENBP0'                 B1 N.A.S BOUGHT
     C                     DELETMMDENBP0                   *1
      *                                                                                      252554A
      ** Delete the corresponding record in the UDF files.                                   252554A
      *                                                                                      252554A
     C                     Z-ADDHLDN38    PDDLNO                                            AR588416
     C                     CALL 'MMDELUDF'                                                   252554A
     C**********           PARM           HLDN38                                    252554A AR588416
     C                     PARM           PDDLNO                                            AR588416
     C                     PARM 'NASP'    #API    4                                          252554A
      *                                                                                      252554A
     C/COPY WNCPYSRC,MM0102C010
     C                     END                             E1
     C           @DLPF     IFEQ 'MMDENSP0'                 B1 N.A.S SOLD
     C                     DELETMMDENSP0                   *1
      *                                                                                      252554A
      ** Delete the corresponding record in the UDF files.                                   252554A
      *                                                                                      252554A
     C                     Z-ADDHMDN38    PDDLNO                                            AR588416
     C                     CALL 'MMDELUDF'                                                   252554A
     C**********           PARM           HMDN38                                    252554A AR588416
     C                     PARM           PDDLNO                                            AR588416
     C                     PARM 'NASS'    #API    4                                          252554A
      *                                                                                      252554A
     C                     END                             E1
     C*
     C           #BAG9     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #BB - MM DEAM PROCESSING                                     *
     C*                                                                  *
     C*     CALLED BY  : #B                                              *
     C*                                                                  *
     C*     CALLS      : ZDAT10 - CONVERTS YYYYMMDD TO MIDAS DAY NUMBER  *
     C*                                                                  *
     C*     WORK FIELDS: @DNSAV   SAVED DEAL NUMBER             (6N)     *
     C*                  @DLNO    DEAL NUMBER                   (6N)     *
     C*                  @VDAT    VALUE DATE                    (6N)     *
     C*                  @DASN    DEAL AMEND SEQ. NO.           (6N)     *
     C*                  @DMKY    DEAM KEY LIST                 KLIST    *
     C*                                                                  *
     C********************************************************************
     C*
     C           #BB       BEGSR
     C*
     C**  READ SEQUENTIALLY THROUGH MM DEAMS FILE
     C           *IN60     DOUEQ'1'                        B1
     C                     READ MMDAMULL                 60*1
     C           *IN60     IFEQ '0'                        B*2
     C*
     C**  ACCESS MIDAS DEAMS FILE TO SETUP STANDARD DEAMS FIELDS.
     C**  IF A DEAMS RECORD IS NOT FOUND DELETE MMDAMULL RECORD.
     C*
     C***********          Z-ADDHNVDYY    @@YYYY                          056095
     C***********          Z-ADDHNVDMM    @@MM                            056095
     C***********          Z-ADDHNVDDD    @@DD                            056095
     C***********          Z-ADD@@DTIN    ZZDTIN                          056095
     C                     Z-ADDHNVDYY    ZWYYYY                          056095
     C                     Z-ADDHNVDMM    ZWMTH                           056095
     C                     Z-ADDHNVDDD    ZWDAY                           056095
     C                     EXSR ZDAT10
     C*
     C           @DMKY     KLIST
     C                     KFLD           @DLNO   60
     C                     KFLD           @VDAT   50
     C                     KFLD           @DASN   30
     C*
     C                     Z-ADDHNDA38    @DLNO
     C                     Z-ADDZZMDNO    @VDAT
     C                     Z-ADDHNDS38    @DASN
     C           @DMKY     CHAINDEAMS                61
     C           *IN61     IFEQ '1'                        B**3
     C                     DELETMMDEAMP0                   ***3
     C/COPY WNCPYSRC,MM0102C008
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #BB9      ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
      *
      *                             PROCESSES
      *
      * P/MM0101,02 - Interest Rates Period Dates Update (MMP0356)
      *
      * 1. Set lower limits on file LF/FDINTRLL
      *
      * 2. Read file LF/FDINTRLL
      *
      * 3. If change of currency:
      *
      * 4. Set lower limits on file LF/FDINTRLL
      *
      *     4.1 Access spot date for relevent currency held in arrays that
      *         were set up in P/MM0101,01
      *
      * 5. Set up details for MM1003 (Period date determine)
      *
      * 6. Execute MM1003
      *
      * 7. If data base error:
      *
      *     7.1 Set up data base error details
      *
      *     7.2 Go to end of subroutine
      *
      * Else
      *
      *     7.3 Update FDINTRILL as per R/MM0101,
      *
      * 8. Go to step 2
      *
      * 9. End of subroutine
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*  #BC - THIS SUBROUTINE DETERMINES THE PERIOD DATES FOR        *
     C*        RECORDS ON FILE FDINTRLL AND (P/MM0101)                *
     C*                                                               *
     C*  CALLED BY:  #B                                               *
     C*                                                               *
     C*  CALLS:      MM1003                                           *
     C*                                                               *
     C*  USES:       @@PCCY    CURRENCY CODE ON PREVIOUS RECORD       *
     C*              @@A       ARRAY HOLDING CURRENCY CODES           *
     C*              @@B       ARRAY HOLDING SPOT DATES               *
     C*              @I        INDEX FOR ARRAYS @@A AND @@B           *
     C*                                                               *
     C*              @@SPOT    SPOT DATE INPUT PARAMETER TO MM1003    *
     C*              @@CCY     CURRENCY INPUT PARAMETER TO MM1003     *
     C*              @@PTYP    PERIOD TYPE INPUT PARAMETER TO MM1003  *
     C*              @@PNUM    PERIOD NUMBER INPUT PARAMETER TO MM1003*
     C*              @@PDAT    PERIOD DATE PARAMETER RETURNED FROM    *
     C*                        MM1003                                 *
     C*                                                               *
     C*              *IN70     DATA BASE ERROR ON FDCCYTLL            *
     C*              *IN60     END OF FILE IND FOR FDINTRLL           *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BC       BEGSR
     C*
     C**  SET UP KEY TO ACCESS FDINTRLL
     C                     MOVE *BLANKS   @@SKEY  3
     C*
     C**  SET LOWER LIMITS ON FILE FDINTRLL
     C           @@SKEY    SETLLFDINTRLL
     C*
     C**  INITIALISE CURRENCY WORK FIELD AND INDEX FOR ARRAYS
     C                     MOVE *BLANKS   @@PCCY  3
     C                     Z-ADD1         @I      30
     C*
     C**  INITIALISE INDICATOR
     C                     MOVE '0'       *IN60
     C*
     C**  READ FILE FDINTRLL
     C           *IN60     DOWEQ'0'                        B1
     C*
     C                     READ FDINTRLL                 60*1
     C*
     C**  IF *IN60 ON, THEN END OF FILE
     C           *IN60     IFEQ '0'                        B*2
     C*** AND ONLY PROCESS IF A LIVE RECORD
     C           HWDLTF    ANDEQ*BLANK                     **2
     C*
     C**  IF CHANGE OF CURRENCY, ACCESS SPOT DATE FOR RELEVANT
     C**  CURRENCY
     C           HWCCY     IFNE @@PCCY                     B**3
     C           HWCCY     LOKUP@@A,@I                   70***3
     C*
     C**  IF CURRENCY NOT FOUND, THEN DATA BASE ERROR HAS OCCURRED
     C           *IN70     IFEQ '0'                        B***4
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRL1'DBFILE           ****4
     C                     MOVELHWCCY     DBKEY            ****4
     C                     MOVEL'MM0102'  DBPGM            ***************
     C                     Z-ADD003       DBASE            * DBERROR 003 *
     C                     MOVE 'E'       @TERM            **************
     C                     OUT  LDA
     C                     DUMP                            ****4
     C                     GOTO #BC9                       ****4
     C                     END                             E***4
     C*
     C**  SET UP CURRENCY AND SPOT DATE INPUT PARAMETERS FOR
     C**  SUBROUTINE MM1003
     C                     MOVE @@B,@I    @@SPOT           ***3
     C                     MOVE HWCCY     ZCCY    3        ***3
     C*
     C**  RESET *IN70
     C                     MOVE '0'       *IN70            ***3
     C*
     C**  STORE CURRENCY CODE
     C                     MOVE HWCCY     @@PCCY           ***3
     C*
     C                     END                             E**3
     C*
     C**  SET UP PERIOD TYPE INPUT PARAMETER FOR SUBROUTINE MM1003
     C                     MOVE HWTPRD    @@PTYP  1        **2
     C*
     C**  SET UP PERIOD NUMBER INPUT PARAMETER FOR SUBROUTINE
     C**  MM1003
     C                     Z-ADDHWPRD     @@PNUM           **2
     C*
     C**  IF PERIOD TYPE IS 'D', SUBTRACT 2 FROM PERIOD NUMBER
     C           HWTPRD    IFEQ 'D'                        B**3
     C                     SUB  2         @@PNUM           ***3
     C                     END                             E**3
     C*
     C**  EXECUTE SUBROUTINE MM1003
     C                     EXSR MM1003                     **2
     C*
     C**  UPDATE FILE FDINTRLL
     C                     MOVE @@PDAT    HWPRDD           **2
     C                     MOVE @@PRDN    HWPRDN           **2
     C*
     C                     EXCPTUPDPDD                     **2
     C*
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #BC9      ENDSR
     C*
     C********************************************************************
      */EJECT                                                                               AR970738
      *****************************************************************                     AR970738
      *  DELEXT - Delete extension record                             *                     AR970738
      *****************************************************************                     AR970738
     C           DELEXT    BEGSR                                                            AR970738
     C                     MOVELHKDN38    F1DLNO                                            AR970738
     C           HKDSTS    IFEQ 'C'                                                         AR970738
     C           HKDDLT    ANDEQ'D'                                                         AR970738
     C           F1DLNO    CHAINDLDLDCD0             30                                     AR970738
     C           *IN30     IFEQ '0'                                                         AR970738
     C                     DELETDLDLDCD0                                                    AR970738
     C                     ENDIF                                                            AR970738
     C                     ENDIF                                                            AR970738
     C                     ENDSR                                                            AR970738
      *****************************************************************                     AR970738
     C/EJECT
     C********************************************************************
      *
      *                        Initial Processing
      *
      * 1. Calculate MM Spot Date (MMP0367) using process P/MM0101,01
      *
      * 2. Set lower limits on MM Deals File (MMDEALLL)
      *
      * 3. Set lower limits on MM Deams File (MMDEAMLL)
      *
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #A - INITIAL PROCESSING                                      *
     C*                                                                  *
     C*     CALLED BY  : CONTROL PROCESSING                              *
     C*                                                                  *
     C*     CALLS      : #AA                                             *
     C*                                                                  *
     C*     WORK FIELDS: @DEALN   DEAL NUMBER                   (6N)     *
     C*                  @DLKY    DEAL KEY LIST                 KLIST    *
     C*                  @TERM    TERMINATION CODE              (1A)     *
     C*                  @@KFI    KEY LIST FOR FRA AND IRS RATES TABLE   *
     C*                  @@KCCY   KEY CURRENCY                           *
     C*                  @@KBRC   KEY BASE RATE CODE                     *
     C*                                                                  *
     C********************************************************************
     C*
     C/COPY WNCPYSRC,MM0102C021
     C           #A        BEGSR
     C*
     C                     MOVEACPY@      BIS@   80
      *
      * Define local data area
     C           *NAMVAR   DEFN           LDA
     C*
     C**  OPEN ALL FILES USED IN PROGRAM
     C                     OPEN MMDEAMLL
     C                     OPEN MMDEAULL
     C                     OPEN MMDAMULL
     C                     OPEN DEALS
     C                     OPEN DEAMS
     C                     OPEN FDCCYTLL
     C                     OPEN FDINTRLL
     C                     OPEN SDCURRL0
     C                     OPEN SDBRTDL1
     C                     OPEN SDCBRTL1
     C                     OPEN DLDEALL5                                                    AR970738
     C*
     C**  RECEIVE PARAMETERS - DEAL NUMBER AND VALUE DATE
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C*
     C**  DEFINE KEY FOR FRA & IRS RATES TABLE - CURRENCY AND BASE RATE
     C           @@KFI     KLIST
     C                     KFLD           @@KCCY  3
     C                     KFLD           @@KBRC  20
     C/COPY WNCPYSRC,MMH00199
     C**  INTIALISE
     C                     MOVE *BLANKS   @@KCCY
     C                     Z-ADD*ZERO     @@KBRC
     C*                                                                   E48221
     C** OBTAIN TREASURY MANAGEMENT AND FRA/IRS MODULE FLAGS              E48221
     C*                                                                   E48221
     C                     CALL 'AOMMODR0'                                E48221
     C                     PARM '*MSG   ' @RTCD   7                       E48221
     C                     PARM '*FIRST ' @OPTN   7                       E48221
     C           SDMMOD    PARM SDMMOD    DSFDY                           E48221
     C           @RTCD     IFNE *BLANK                                    E48221
     C           *LOCK     IN   LDA                                       E48221
     C                     MOVEL'SDMMODPD'DBFILE                          E48221
     C                     MOVEL'MM0102'  DBPGM            ************** E48221
     C                     Z-ADD994       DBASE            * DBERROR 994  E48221
     C                     MOVEL@OPTN     DBKEY            ************** E48221
     C                     MOVE @OPTN     DBOPTN  7                       E48221
     C                     MOVE 'E'       @TERM                           E48221
     C                     OUT  LDA                                       E48221
     C                     DUMP                                           E48221
     C                     GOTO #A9                                       E48221
     C                     END                                            E48221
     C/COPY WNCPYSRC,MM0102C020
      *                                                                   CDL006
      ** Check if Dealing Fiduciary is switched ON                        CDL006
      *                                                                   CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   WRTCD   7                       CDL006
     C                     PARM '*VERIFY' WOPTN   7                       CDL006
     C                     PARM 'CDL006'  WSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSFDY                           CDL006
     C           WRTCD     IFEQ *BLANKS                                   CDL006
     C                     MOVE 'Y'       CDL006  1                       CDL006
     C                     ELSE                                           CDL006
     C           WRTCD     IFNE '*NRF   '                                 CDL006
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDL006
     C                     Z-ADD9         DBASE            * DBERR  9 *   CDL006
     C                     MOVEL'CDL006'  DBKEY            ************   CDL006
     C                     SETON                     U7U8                 CDL006
     C                     EXSR *PSSR                                     CDL006
     C                     ENDIF                                          CDL006
     C                     MOVE 'N'       CDL006                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CIR004
      ** Check if Dealing Calculation Method Change is switched ON        CIR004
      *                                                                   CIR004
     C                     MOVE 'N'       CIR004  1                       CIR004
     C                     CALL 'AOSARDR0'                                CIR004
     C                     PARM *BLANKS   WRTCD                           CIR004
     C                     PARM '*VERIFY' WOPTN                           CIR004
     C                     PARM 'CIR004'  WSARD                           CIR004
     C           SCSARD    PARM SCSARD    DSFDY                           CIR004
      *                                                                   CIR004
     C           WRTCD     IFNE *BLANKS                                   CIR004
     C           WRTCD     ANDNE'*NRF   '                                 CIR004
     C           *LOCK     IN   LDA                                       CIR004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CIR004
     C                     Z-ADD10        DBASE            * DBERR 10 *   CIR004
     C                     MOVEL'CIR004  'DBKEY            ************   CIR004
     C                     OUT  LDA                                       CIR004
     C                     MOVE *ON       *INU7                           CIR004
     C                     MOVE *ON       *INU8                           CIR004
     C                     EXSR *PSSR                                     CIR004
     C                     ENDIF                                          CIR004
      *                                                                   CIR004
     C           WRTCD     IFEQ *BLANKS                                   CIR004
     C                     MOVE 'Y'       CIR004                          CIR004
     C                     ENDIF                                          CIR004
     C*
     C**
     C** ACCESS SAR DETAILS FILE TO DETERMINE IF BRT SAR IS INSTALLED
     C**
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01383'  @SARD   6
     C           @RTCD     IFNE *BLANK
     C           @RTCD     ANDNE'*NRF   '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE
     C                     MOVEL'MM0102'  DBPGM            **************
     C                     Z-ADD992       DBASE            * DBERROR 992
     C                     MOVEL@RTCD     DBKEY            **************
     C                     MOVE 'E'       @TERM
     C                     OUT  LDA
     C                     DUMP
     C                     GOTO #A9
     C                     END
     C           @RTCD     IFEQ *BLANK
     C                     MOVEL'Y'       S01383  1
     C                     END
     C/COPY WNCPYSRC,MM0102C003
      *                                                                                       CDL033
      ** Determine if Floating Rate CD Issued feature is                                      CDL033
      ** switched on.                                                                         CDL033
      *                                                                                       CDL033
     C                     MOVE *BLANK    CDL033  1                                           CDL033
     C                     CALL 'AOSARDR0'                                                    CDL033
     C                     PARM *BLANKS   PRTCD   7                                           CDL033
     C                     PARM '*VERIFY' POPTN   7                                           CDL033
     C                     PARM 'CDL033'  PSARD   6                                           CDL033
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL033
      *                                                                                       CDL033
     C           PRTCD     IFEQ *BLANKS                                                       CDL033
     C                     MOVE 'Y'       CDL033                                              CDL033
     C                     OPEN DLFRSCL0                                                      CDL033
     C                     ELSE                                                               CDL033
     C           PRTCD     IFNE '*NRF   '                                                     CDL033
     C           *LOCK     IN   LDA                                                           CDL033
     C                     MOVE '011'     DBASE                                               CDL033
     C                     MOVEL'CDL033'  DBKEY                                               CDL033
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL033
     C                     OUT  LDA                                                           CDL033
     C                     MOVE 'E'       @TERM                                               CDL033
     C                     DUMP                                                               CDL033
     C                     GOTO #A9                                                           CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
     C/COPY WNCPYSRC,MMH00200
     C*
     C** IF BRT SAR INSTALLED, ACCESS BRT INSTALLATION CONTROL DATA
     C*
     C           S01383    IFEQ 'Y'
     C                     MOVE 'D'       BRTKEY  1
     C           BRTKEY    CHAINSDBRTDD0             61
     C*
     C** if *in61 is on, then it is a data base error
     C*
     C           *IN61     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRTDPD'DBFILE
     C                     MOVEL'MM0102'  DBPGM            **************
     C                     Z-ADD993       DBASE            * DBERROR 993
     C                     MOVELBRTKEY    DBKEY            **************
     C                     MOVE 'E'       @TERM
     C                     OUT  LDA
     C                     DUMP
     C                     GOTO #A9
     C                     END
     C                     END
      *                                                                                       CDL081
      ** Check if CDL081 is installed                                                         CDL081
      *                                                                                       CDL081
     C                     MOVE 'N'       CDL081  1                                           CDL081
     C                     CALL 'AOSARDR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD   7                                           CDL081
     C                     PARM '*VERIFY' POPTN   7                                           CDL081
     C                     PARM 'CDL081'  PSARD   6                                           CDL081
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           PRTCD     ANDNE'*NRF   '                                                     CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     Z-ADD075       DBASE                                               CDL081
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL081
     C                     MOVEL'MM0101'  DBPGM                                               CDL081
     C                     MOVEL'CDL081'  DBKEY                                               CDL081
     C                     MOVEL'E'       @TERM                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     DUMP                                                               CDL081
     C                     GOTO #A9                                                           CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C           PRTCD     IFEQ *BLANKS                                                       CDL081
     C                     MOVE 'Y'       CDL081                                              CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Access withholding tax round down system values if CDL081 is on                      CDL081
      *                                                                                       CDL081
     C           CDL081    IFEQ 'Y'                                                           CDL081
     C                     CALL 'AOSVALR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD                                               CDL081
     C                     PARM C#BASE    SVALK1 20                                           CDL081
     C                     PARM           SVAL1 200                                           CDL081
     C                     PARM C#NBAS    SVALK2 20                                           CDL081
     C                     PARM           SVAL2 200                                           CDL081
     C                     PARM *BLANK    SVALK3 20                                           CDL081
     C                     PARM           SVAL3 200                                           CDL081
     C                     PARM *BLANK    SVALK4 20                                           CDL081
     C                     PARM           SVAL4 200                                           CDL081
     C                     PARM *BLANK    SVALK5 20                                           CDL081
     C                     PARM           SVAL5 200                                           CDL081
     C                     PARM *BLANK    SVALK6 20                                           CDL081
     C                     PARM           SVAL6 200                                           CDL081
     C                     PARM *BLANK    SVALK7 20                                           CDL081
     C                     PARM           SVAL7 200                                           CDL081
     C                     PARM *BLANK    SVALK8 20                                           CDL081
     C                     PARM           SVAL8 200                                           CDL081
     C                     PARM *BLANK    SVALK9 20                                           CDL081
     C                     PARM           SVAL9 200                                           CDL081
     C                     PARM *BLANK    SVALK0 20                                           CDL081
     C                     PARM           SVAL10200                                           CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C           SVAL1     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK1    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C           SVAL2     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK2    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C                     Z-ADD076       DBASE                                               CDL081
     C                     MOVEL'SDSVALPD'DBFILE                                              CDL081
     C                     MOVEL'MM0101'  DBPGM                                               CDL081
     C                     MOVEL'E'       @TERM                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     DUMP                                                               CDL081
     C                     GOTO #A9                                                           CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Setup tax amount rounding down indicators                                            CDL081
      *                                                                                       CDL081
     C                     MOVELSVAL1     W#BSRD  1                                           CDL081
     C                     MOVELSVAL2     W#NBRD  1                                           CDL081
     C                     ENDIF                                                              CDL081
     C**  CALCULATE MM SPOT DATE (MMP0367)
     C/COPY WNCPYSRC,MM0102C011
     C                     EXSR #AA
     C           @DLKY     KLIST
     C                     KFLD           @DEALN
     C                     Z-ADD0         @DEALN
     C*
     C**  SET LOWER LIMITS ON MM DEALS AND DEAMS FILES
     C           @DLKY     SETLLMMDEAULL
     C           @DLKY     SETLLMMDAMULL
     C*
      *                                                                                       CDL013
      ***   Check if CAR CDL013 is installed                                                  CDL013
     C                     CALL 'AOSARDR0'                                                    CDL013
     C                     PARM *BLANKS   @RTCD   7                                           CDL013
     C                     PARM '*VERIFY' @OPTN   7                                           CDL013
     C                     PARM 'CDL013'  @SARD   6                                           CDL013
     C                     PARM           DSFDY                                               CDL013
      *                                                                                       CDL013
      ***   CAR CDL013 is installed                                                           CDL013
     C           @RTCD     IFEQ *BLANKS                                                       CDL013
     C                     MOVE '1'       CDL013  1                                           CDL013
     C                     OPEN SDSTAAL1                                                      CDL013
      *                                                                                       CDL013
      *** otherwise Access WHT ICD record to determine WHT rate.                              CDL013
     C                     MOVEL*BLANKS   ULSTAX 10                                           CDL013
     C                     MOVEL'RETAIL'  ULSTAX                                              CDL013
     C           ULSTAX    CHAINSDSTAAL1             61                                       CDL013
      *                                                                                       CDL013
     C           *IN61     IFEQ '1'                                                           CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C                     MOVEL'MM0101'  DBPGM                                               CDL013
     C                     MOVEL'SDSTAAL1'DBFILE                                              CDL013
     C                     Z-ADD012       DBASE                                               CDL013
     C                     MOVELULSTAX    DBKEY                                               CDL013
     C                     MOVE 'E'       @TERM                                               CDL013
     C                     OUT  LDA                                                           CDL013
     C                     DUMP                                                               CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      ***   CAR CDL013 is not installed                                                       CDL013
     C                     ELSE                                                               CDL013
     C                     MOVE '0'       CDL013                                              CDL013
     C                     ENDIF                                                              CDL013
      *****************************************************************            MD035545 MD047993
      ***Call*access*program*for*General*Ledger*details.***************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
     C********** @RTCD     IFNE *BLANK                                             MD035545 MD047993
     C**********           MOVEL'SDGELRPD'DBFILE                                   MD035545 MD047993
     C**********           MOVEL'062'     DBASE                                    MD035545 MD047993
     C**********           MOVEL@OPTN     DBKEY                                    MD035545 MD047993
     C**********           EXSR *PSSR                                              MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
      *                                                                                       CDL013
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
     C                     MOVE 'N'       CDL088  1                                        AR1055654
     C                     CALL 'AOSARDR0'                                                 AR1055654
     C                     PARM *BLANKS   WRTCD                                            AR1055654
     C                     PARM '*VERIFY' WOPTN                                            AR1055654
     C                     PARM 'CDL088'  WSARD                                            AR1055654
     C           SCSARD    PARM SCSARD    DSFDY                                            AR1055654
      *                                                                                    AR1055654
     C           WRTCD     IFEQ *BLANKS                                                    AR1055654
     C                     MOVE 'Y'       CDL088                                           AR1055654
     C                     ENDIF                                                           AR1055654
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0102CCP1                                           S01408
     C*                                                                   S01408
     C           #A9       ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
      *
      *                             PROCESSES
      *
      *               P/MM0101,01 - Calculate MM Spot Date
      *
      * 1. Set up key for MIDAS Installation Control Data Record 1
      *    (PF/TABTB10)
      *
      * 2. Chain to record
      *
      * 3. If record not found:
      *
      *     3.1 Execute Data base error processing
      *
      *     3.2 Go to end of subroutine
      *
      * Else
      *
      *     3.3 Obtain MIDAS run date
      *
      * 4. Set lower limits on PF/TABTG10
      *
      * 5. Read a record on PF/TABTG10
      *
      * 6. If end of file go to end of subroutine
      *
      * 7. Do until number of days added = number of spot days
      *
      *     7.1 Add 1 to MIDAS day number
      *
      *         YYYYMMDD format
      *
      *     7.3 Execute subroutine ZCHKH  to check if date is a holiday
      *
      *     7.4 If date is a holiday go to step 7.1
      *
      *     7.5 Add 1 to number of spot days added
      *
      * End do
      *
      * 8. Update MM Spot date on PF/TABTG10,01 as per R/MM0101,01
      *
      * 9. Store currency and spot date in relevent arrays for later
      *    access
      *
      *10. Go to step 5
      *
      *11. End of subroutine
      *
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*  #AA - THIS SUBROUTINE CALCULATES THE MM SPOT DATE            *
     C*        (P/MM0101,01)                                          *
     C*                                                               *
     C*  CALLED BY:  #B                                               *
     C*                                                               *
     C*  CALLS:      ZDATE9                                           *
     C*                                                               *
     C*  USES:       @@KEY     KEY TO ACCESS FDICDRLL                 *
     C*              @@RNDT    MIDAS RUN DATE                         *
     C*              @@SDAY    NUMBER OF SPOT DAYS                    *
     C*              @@A       ARRAY HOLDING CURRENCY CODES           *
     C*              @@B       ARRAY HOLDING SPOT DATES               *
     C*              @I        INDEX FOR ARRAYS @@A AND @@B           *
     C*                                                               *
     C*              @@DAYN    MIDAS DAY NUMBER INPUT TO ZDATE9       *
     C*              @@RTN     PARAMETER RETURNED FROM ZDATE9         *
     C*              @@VDT     DATE IN YYYYMMDD FORMAT OUTPUT FROM    *
     C*                        ZDATE9                                 *
     C*                                                               *
     C*              *IN70     DATA BASE ERROR ON FDICDRLL            *
     C*              *IN60     END OF FILE INDICATOR FOR FDCCYTLL     *
     C*                                                               *
     C*****************************************************************
     C*
     C           #AA       BEGSR
     C*
     C** Access Bank details via access program
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE
     C                     MOVEL'MM0102'  DBPGM            ***************
     C                     Z-ADD004       DBASE            * DBERROR 004 *
     C                     MOVEL@OPTN     DBKEY            *             *
     C                     MOVE @OPTN     DBOPTN  7        *             *
     C                     MOVE 'E'       @TERM            ***************
     C                     OUT  LDA
     C                     DUMP                            *1
     C                     GOTO #AA9                       *1
     C                     END                             E1
     C*
     C**  SET DATE FORMAT INDICATOR FOR LATER USE IN SR ZDATE2
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C*
     C**  INITIALISE ARRAYS AND ARRAY INDEX
     C                     MOVE *BLANKS   @@A
     C                     Z-ADD0         @@B
     C                     Z-ADD0         @I      30
     C*
     C**  INITIALISE INDICATOR
     C                     MOVE '0'       *IN60
     C*
     C**  SET UP KEYS TO ACCESS FDCCYTLL AND SDCURRL0
     C                     MOVE *BLANKS   @@KY3   3
     C                     MOVE *BLANKS   @@KY12 12
     C**
     C**  SET LOWER LIMITS ON FILE FDCCYTLL AND SDCURRL0
     C           @@KY12    SETLLFDCCYTLL
     C           @@KY3     SETLLSDCURRL0
     C**
     C**  READ FILES FDCCYTLL AND SDCURRL0 UNTIL DEALING CURRENCY
     C           *IN60     DOWEQ'0'                        B1
     C*
     C           A6DLCI    DOUEQ'Y'
     C           *IN60     OREQ '1'
     C                     READ SDCURRL0                 60*1
     C                     END
     C*
     C**  IF *IN60 ON, THEN END OF FILE
     C           *IN60     CABEQ'1'       #AA9
     C*
     C** IF *IN60 NOT ON FROM READ OF SDCURRL0, READ FDCCYTLL FOR NEXT
     C** DEALING CURRENCY.  IF *IN60 THEN ON, OR NOT THE SAME
     C** CURRENCY READ, THEN DATABASE ERROR.
     C                     READ FDCCYTLL                 60
     C*
     C           *IN60     IFEQ '1'
     C           A6CYCD    ORNE CCY
     C                     MOVEL'MM0102'  DBPGM
     C                     MOVEL'FDCCYTLL'DBFILE
     C                     MOVE A6CYCD    DBKEY            *************
     C                     MOVEL'006'     DBASE            * DBERR 006 *
     C                     MOVE 'E'       @TERM            *************
     C                     DUMP
     C                     GOTO #AA9
     C                     END
     C*
     C**  INITIALISE HOLIDAY INDICATOR
     C                     MOVE ' '       ZIND    1        *1
     C*
     C**  STORE MIDAS RUN DATE
     C                     Z-ADDBJRDNB    @@RNDT  50       *1
     C*
     C**  STORE NUMBER OF SPOT DAYS
     C                     Z-ADDA6SPDY    @@SDAY  30       *1
     C*
     C*If Spot Days (SPDY) is zero then Money Market Spot Date
     C*should be Run Date (RUND). To save changing existing code
     C*this can be achieved by subtracting 1 from the Run Date work
     C*field and moving 1 to the Spot Days work field to check that
     C*Run Date is not a holiday for the currency.
     C           @@SDAY    IFEQ 0                          B*2
     C                     Z-ADD1         @@SDAY           **2
     C                     SUB  1         @@RNDT           **2
     C                     END                             E*2
     C*
     C**  DO UNTIL THE REQUIRED NUMBER OF SPOT DAYS HAVE BEEN ADDED
     C**  TO THE MIDAS RUN DATE, GIVING THE SPOT DATE
     C                     DO   @@SDAY                     B*2
     C*
     C**  DO UNTIL DAY IS A WORKING DAY
     C           ZIND      DOUEQ'W'                        B**3
     C                     ADD  1         @@RNDT           ***3
     C*
     C**  SET UP INPUT PARAMETERS TO ZCHKH
     C                     MOVE *BLANKS   ZLOC             ***3
     C                     MOVE A6CYCD    ZCCY             ***3
     C                     Z-ADD@@RNDT    ZDAYNO           ***3
     C*
     C**  EXECUTE SUBROUTINE ZCHKH  TO DETERMINE WHETHER DAY IS
     C**  WORKING DAY OR HOLIDAY
     C                     EXSR ZCHKH                      ***3
     C*
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  SET UP INPUT PARAMETER TO ZDATE9
     C                     Z-ADD@@RNDT    @@DAYN  50       *1
     C*
     C**  EXECUTE SUBROUTINE ZDATE9 TO CONVERT SPOT DATE FROM
     C**  MIDAS DAY NUMBER FORMAT TO YYYYMMDD FORMAT
     C                     EXSR ZDATE9
     C*
     C**  IF PARAMETER @@RTN RETURNED FROM ZDATE9 HAS VALUE '1'
     C**  THEN MIDAS DAY NUMBER INPUT TO ZDATE9 IS LESS THAN 1
     C**  AND DATA BASE ERROR HAS OCCURRED
     C           @@RTN     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL*BLANKS   DBFILE           **2
     C                     MOVEL*BLANKS   DBKEY            **2
     C                     MOVEL'MM0102'  DBPGM            ***************
     C                     Z-ADD005       DBASE            * DBERROR 005 *
     C                     MOVE 'E'       @TERM            ***************
     C                     OUT  LDA
     C                     DUMP                            **2
     C                     GOTO #AA9                       **2
     C                     END                             E*2
     C*
     C**  SET UP SPOT DATE FIELD AND UPDATE LF/SDCURRL0
     C                     Z-ADD@@VDT     A6MMSD           *1
     C*
     C                     UPDAT@A6REA4                    *1
     C*
     C**  SET UP SPOT DATE FIELD AND UPDATE LF/FDCCYTLL
     C                     MOVE @@VDT     MSPD
     C                     EXCPTUPDSPD
     C*
     C**  UPDATE ARRAY INDEX
     C                     ADD  1         @I               *1
     C*
     C**  STORE CURRENCY AND SPOT DATE IN ARRAYS FOR LATER ACCESS
     C                     MOVE A6CYCD    @@A,@I           *1
     C                     MOVE @@VDT     @@B,@I           *1
     C*
     C                     END                             E1
     C*
     C           #AA9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
      *
      *                      TERMINATION PROCESSING
      *
      * 1. Set on *INLR
      *
      * 2. If data base error:
      *
      *     2.1 Set on indicators *INU7 & *INU8
      *
      *     2.2 Change termination code to 'T'
      *
      * 3. Close all open files
      *
      *
      *                       ********************
      *
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*     #C - TERMINATION PROCESSING                                  *
     C*                                                                  *
     C*     CALLED BY  : CONTROL PROCESSING                              *
     C*                                                                  *
     C*     CALLS      :                                                 *
     C*                                                                  *
     C*     WORK FIELDS:                                                 *
     C*                                                                  *
     C********************************************************************
     C*
     C           #C        BEGSR
     C*
     C**  SET UP PROGRAM NAME
     C                     MOVEL'MM0102'  DBPGM
     C*
     C**  SET ON LAST RECORD INDICATOR TO CLOSE FILES
     C                     MOVE '1'       *INLR
     C*
     C**  IF A DB ERROR HAS OCCURRED SET ON EXTERNAL SWITCHES U7 & U8
     C           @TERM     IFEQ 'E'                        B1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     END                             E1
     C*
     C           #C9       ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*      EXCEPTION ERROR SUBROUTINE                                  *
     C*                                                                  *
     C*      SUBROUTINE CALLED: EXECUTES WHENEVER EITHER FILE OR         *
     C*                         PROGRAM ERROR OCCURS                     *
     C*                                                                  *
     C*      CALLS            :                                          *
     C*                                                                  *
     C********************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C**  SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR1     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR1   1        *1
     C*
     C**  SET UP FIELDS IN LOCAL DATA AREA
     C           *LOCK     IN   LDA
     C                     MOVEL'MM0102'  DBPGM            *1
     C                     Z-ADD991       DBASE            *1
     C                     MOVE 'E'       @TERM            *1
     C                     OUT  LDA
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C                     MOVE '1'       *INLR
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*   MM1010 - CALCULATION OF INTEREST AT MATURITY                *
     C*                                                               *
     C*  FILES EXPECTED  -  FXTB40LL                                  *
     C*                  -  MMDEAMLL  DEAL AMENDMENTS FILE            *
     C*                  -  SDCBRTL1  BRT CUSTOMER DETAILS FILE       *
     C*                                                               *
     C*  CALLED BY    -                                               *
     C*                                                               *
     C***CALLS********-* MM1007, CALCULATE INTEREST.                  *   S01392
     C*  CALLS        -  MM1030, CALCULATE INTEREST.                  *   S01392
     C*               -  MM1004, DETERMINE DATE OF NEXT PAYMENT.      *
     C*  CALLS        -  ZDAT10 - CONVERT YYYYMMDD TO MIDAS DAY NUMBER*
     C*                                                               *
     C*  FIELDS INPUT @@TINT - TOTAL INTEREST                         *
     C*               @@INTD - INTEREST TO DATE                       *
     C*               @@INFQ - INTEREST PAYMENT FREQUENCY             *
     C*               @@NXIP - NEXT INTEREST PAYMENT DATE             *
     C*               @@VDAT - VALUE DATE                             *
     C*               @@INCM - INTEREST CALCULATION METHOD            *
     C*               @@DLAM - DEAL AMOUNT                            *
     C*               @@EIRT - EFFECTIVE INTEREST RATE                *
     C*               @@MTXI - TAXABLE INDICATOR                      *
     C*               @@DEAL - DEAL NUMBER   6N                       *
     C*               @@BRMD - MATURITY DATE FOR BRT CALCULATION      *
     C*               @BRTRT - BRT TAX RATE FROM LF/SDBRTDL1          *
     C*               @BTAXR - @BRTRT MULT. BY 1 OR 0.5               *
     C*                                                               *
     C*  FIELD OUTPUT @@INMT - INTEREST AT MATURITY                   *
     C*                                                               *
     C*  WORKFIELDS   @O     - ARRAY FIELD HOLDING FORMATTED AMOUNT   *
     C*               @@A    - INDEX FIELD FOR REFERENCING @O         *
     C*                                                               *
     C*****************************************************************
     C           MM1010    BEGSR
     C*
     C*   INITIALISE FIELDS
     C                     Z-ADD*ZEROS    @@NPDT  50
     C                     Z-ADD@@DEAL    @@DEAL  60
     C*
     C*   TEST IF RECORD HAS ALREADY BEEN READ - IF NOT READ IT
     C*
     C           *IN50     IFNE '1'                        *** B 1
     C** Access Deal details via access program
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C********** SDDEAL    PARM SDDEAL    DSFDY                                               CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDDEALPD'DBFILE
     C                     MOVEL'MM0102'  DBPGM            **************
     C                     Z-ADD007       DBASE            * DBERROR 007
     C                     MOVEL@OPTN     DBKEY            *
     C                     MOVE @OPTN     DBOPTN  7        *
     C                     MOVE 'E'       @TERM            **************
     C                     OUT  LDA
     C                     DUMP                            *1
     C                     GOTO M11010                     *1
     C                     END                             E1
     C                     MOVE '1'       *IN50
     C                     END                             *** E 1
     C*
     C*   CALCULATE TAX AMOUNT
      *                                                                                       CDL013
      *** if CAR CDL013 is installed.                                                         CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
      *** if Tax indicator is ZERO set WHT rate to ZERO.                                      CDL013
     C           TAXI      IFEQ '0'                                                           CDL013
     C                     Z-ADD0         ULWHTR  52                                          CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** Set WHT rate.                                                                       CDL013
     C                     SELEC                                                              CDL013
     C           TAXI      WHEQ '1'                                                           CDL013
     C                     Z-ADDETXR1     ULWHTR                                              CDL013
     C           TAXI      WHEQ '2'                                                           CDL013
     C                     Z-ADDETXR2     ULWHTR                                              CDL013
     C           TAXI      WHEQ '3'                                                           CDL013
     C                     Z-ADDETXR3     ULWHTR                                              CDL013
     C           TAXI      WHEQ '4'                                                           CDL013
     C                     Z-ADDETXR4     ULWHTR                                              CDL013
     C           TAXI      WHEQ '5'                                                           CDL013
     C                     Z-ADDETXR5     ULWHTR                                              CDL013
     C           TAXI      WHEQ '6'                                                           CDL013
     C                     Z-ADDETXR6     ULWHTR                                              CDL013
     C           TAXI      WHEQ '7'                                                           CDL013
     C                     Z-ADDETXR7     ULWHTR                                              CDL013
     C           TAXI      WHEQ '8'                                                           CDL013
     C                     Z-ADDETXR8     ULWHTR                                              CDL013
     C           TAXI      WHEQ '9'                                                           CDL013
     C                     Z-ADDETXR9     ULWHTR                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** If WHT rate is ZERO set tax amount to ZERO.                                         CDL013
     C           ULWHTR    IFEQ *ZERO                                                         CDL013
     C                     Z-ADD0         @@TXAM                                              CDL013
      *                                                                                       CDL013
      *** otherwise calculate tax amount.                                                     CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** if Deal Ccy is equal to Base Ccy round down Interest Amount.                        CDL013
      *** and CDL081 is off                                                                   CDL081
      *                                                                                       CDL081
     C           ZCCY      IFEQ BJCYCD                                                        CDL013
     C           CDL081    ANDEQ'N'                                                           CDL081
      *                                                                                       CDL013
      *** set work adjustment field according to decimal places.                              CDL013
     C                     SELEC                                                              CDL013
     C           A6NBDP    WHEQ 1                                                             CDL013
     C                     Z-ADD10        ULWKAD  40                                          CDL013
     C           A6NBDP    WHEQ 2                                                             CDL013
     C                     Z-ADD100       ULWKAD                                              CDL013
     C           A6NBDP    WHEQ 3                                                             CDL013
     C                     Z-ADD1000      ULWKAD                                              CDL013
     C           A6NBDP    WHEQ 0                                                             CDL013
     C                     Z-ADD1         ULWKAD                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
      *** round down Interest Amount.                                                         CDL013
     C           @@TINT    DIV  ULWKAD    ULTINT 150                                          CDL013
     C                     MULT ULWKAD    ULTINT                                              CDL013
      *                                                                                       CDL013
      *** calculate and then round down Tax Amount.                                           CDL013
     C           ULTINT    MULT ULWHTR    @@TXAM                                              CDL013
     C                     DIV  100       @@TXAM                                              CDL013
     C           @@TXAM    DIV  ULWKAD    ULTXAM 150                                          CDL013
     C           ULTXAM    MULT ULWKAD    @@TXAM                                              CDL013
      *                                                                                       CDL013
      *** otherwise (Deal Ccy NOT = Base Ccy) calculate Tax amount                            CDL013
      *** without rounding down.                                                              CDL013
     C                     ELSE                                                               CDL013
     C           @@TINT    MULT ULWHTR    @@TXAM                                              CDL013
      *                                                                                       CDL081
      ** Check if tax amount is to be rounded down                                            CDL081
      *                                                                                       CDL081
     C           ZCCY      IFEQ BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C           ZCCY      ORNE BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#NBRD    ANDEQ'Y'                                                           CDL081
     C                     DIV  100       @@TXAM                                              CDL081
     C                     ELSE                                                               CDL081
     C                     DIV  100       @@TXAM    H                                         CDL013
     C                     ENDIF                                                              CDL081
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** otherwise perform Original Tax calculations.                                        CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0102CCP2                                           S01408
     C*                                                                   S01408
     C*   (ZERO IF TAX INDICATOR IS NOT 'Y')
     C*
     C           @@MTXI    IFEQ *BLANKS                    *** B 1
     C           @@MTXI    OREQ 'X'
     C           @@MTXI    OREQ 'N'
     C                     Z-ADD*ZEROS    @@TXAM 155
     C                     ELSE                            *** X
      *                    ****
     C                     Z-ADD*ZEROS    @@TXAM
     C/COPY WNCPYSRC,MM0102C012
     C*
     C** IF BRT SAR INSTALLED
     C*
     C           S01383    IFEQ 'Y'                        *** B 2
     C*
     C           @@BRMD    IFGT 0                          *** B 3
     C*
     C           @@BRMD    IFGE DEFF                       *** B 4
     C                     Z-ADDBRTR      @BRTRT  75
     C                     ELSE
     C                     Z-ADDPBRTR     @BRTRT
     C                     END                             *** E 4
     C*
     C** ACCESS SDCBRTL1 FOR DEAL CUSTOMER'S BRT TAX INDICATOR (TAXIND)
     C** if *in70 is on, then it is a data base error
     C*
     C           @CNUM     CHAINSDCBRTL1             70
     C*
     C           *IN70     IFEQ '1'                        *** B 4
     C           XRECI     ORNE 'D'                        **************
     C                     MOVEL'SDCBRTPD'DBFILE           * DBERROR 008
     C                     MOVEL'MM0102'  DBPGM            **************
     C                     Z-ADD008       DBASE
     C                     MOVEL@CNUM     DBKEY
     C                     MOVE 'E'       @TERM
     C                     DUMP
     C                     GOTO M11010
     C                     END                             *** E 4
     C*
     C           TAXIND    IFEQ 'L'                        *** B 4
     C           TAXIND    OREQ 'P'
     C*
     C** TAX RATE FOR PART-LIABLE CUSTOMERS IS HALF THE BASIC RATE.
     C*
     C           TAXIND    IFEQ 'L'                        *** B 5
     C                     Z-ADD@BRTRT    @BTAXR  86
     C                     ELSE                                X 5
     C           0.5       MULT @BRTRT    @BTAXR
     C                     END                             *** E 5
     C*
     C/COPY WNCPYSRC,MM0102C013
     C           @@TINT    MULT @BTAXR    @@TXAM
     C/COPY WNCPYSRC,MM0102C014
     C           @@TXAM    DIV  100       @@TXAM
     C                     END                             *** E 4
     C*
     C                     END                             *** E 3
     C*
     C** ELSE BRT SAR NOT INSTALLED
     C*
     C                     ELSE                            *** X 2
     C/COPY WNCPYSRC,MM0102C015
     C           @@TINT    MULT BNHKTR    @@TXAM
     C/COPY WNCPYSRC,MM0102C016
     C           @@TXAM    DIV  100       @@TXAM
     C                     END                             *** E 2
     C/COPY WNCPYSRC,MMH00201
     C                     END                             *** E 1
     C*
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0102CCP3                                           S01408
     C*                                                                   S01408
     C*  FIND INTEREST AT MATURITY - NO INTERIM PAYMENTS
     C*
     C           @@NXIP    IFEQ *ZEROS                     *** B 1
     C           FXKEY     KLIST
     C                     KFLD           @@DEAL
      *  CHECK THERE ARE NO DEAL AMENDMENTS
     C           @@DEAL    CHAINMMDEAMLL             90
     C           *IN90     IFEQ '1'
     C           @@TINT    SUB  @@INTD    @@INMT 150        *** B 2
     C                     SUB  @@TXAM    @@INMT
     C                     GOTO M11010                      ---------->
     C                     END                              *** E 2
      *
     C                     END                              *** E 1
      *
      *  CHECK THERE ARE NO DEAL AMENDMENTS
     C           @@DEAL    CHAINMMDEAMLL             90
      *  IF THERE ARE GET THE LATEST
     C           *IN90     IFEQ '0'                         *** B 1
     C           @@EOF     DOUEQ'Y'                         *** B 2
     C           @@DEAL    READEMMDEAMLL                 90
     C   90                MOVE 'Y'       @@EOF   1
     C                     END                              *** E 2
     C                     Z-ADDHNDATE    ZZDTIN
     C                     EXSR ZDAT10
      *   STORE DATE
     C                     Z-ADDZZMDNO    @@ENDD  50
     C                     ELSE                            *** X
      *  IF NO AMENDMENTS  ****
      *  DETERMINE END DATE
      *
     C           @@NXIP    IFNE *ZEROS                     *** B 2
     C           @@INFQ    IFEQ *BLANKS                    *** B 3
     C*   LOAD FIELD
     C                     Z-ADD@@NXIP    @@ENDD
     C                     ELSE                            *** X
     C*                    ****
     C                     Z-ADD@@NXIP    @@DAYN
     C                     EXSR ZDATE9
      *  LOAD INPUT PARAMETER
     C                     Z-ADD@@VDT     @@STRT  80
     C                     MOVE @@INFQ    @@FREQ  1
     C*  CALL COMMON ROUTINE
     C                     EXSR MM1004
     C*  LOAD RETURNED PARAMETER - AND REFORMAT
     C                     Z-ADD@@NDAT    ZZDTIN
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    @@ENDD
      *
     C                     END                             *** E 3
     C                     END                             *** E 2
     C                     END                             *** E 1
      *
      *   CALCULATE INTEREST THAT WILL BE PAID PRIOR TO MATURITY
      *
      *   LOAD PARAMETERS
      *   ===============
      *
     C***********          Z-ADD@@VDAT    @@BEG                           056095
     C***********          Z-ADD@@ENDD    @@END                           056095
     C***********          MOVE @@INCM    @@CALC                          056095
     C                     Z-ADD@@VDAT    ZZBEG                           056095
     C                     Z-ADD@@ENDD    ZZEND                           056095
     C                     MOVE @@INCM    ZZCALC                          056095
     C                     Z-ADD@@DLAM    @@AMT  150
     C                     Z-ADD@@EIRT    @@RATE 117
     C                     MOVELJRDFC     @@RDFC  1                       S01392
     C*
     C*   CALL COMMON ROUTINE
     C*********************EXSR MM1007                                    S01392
     C                     EXSR MM1030                                    S01392
     C*
     C*   CALCULATE INTEREST AT MATURITY
     C*
     C           @@TINT    SUB  @@INTR    @@INMT
     C           @@INMT    SUB  @@TXAM    @@INMT
      *
      *  DEFINE INPUT FIELDS WHICH HAVE NOT BEEN DEFINED ALREADY
     C                     GOTO M11010
     C                     Z-ADD0         @@TINT 150
     C                     Z-ADD0         @@INTD 130
     C                     MOVE *BLANK    @@INFQ  1
     C                     Z-ADD0         @@NXIP  50
     C                     Z-ADD0         @@VDAT  50
     C                     MOVE *BLANK    @@INCM  1
     C                     Z-ADD0         @@DLAM 150
     C                     Z-ADD0         @@EIRT 117
     C                     MOVE *BLANK    @@MTXI  1
      *
     C           M11010    ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************   S01392
     C****MM1007*- CALCULATE INTEREST                                 *   S01392
     C***********                                                     *   S01392
     C***CALLED*BY    -                                               *   S01392
     C***********                                                     *   S01392
     C***CALLS***     -   MM1009 CALCULATE NO. OF INTEREST DAYS       *   S01392
     C***********                                                     *   S01392
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                   *   S01392
     C***********     @@END  - END DATE OF PERIOD                     *   S01392
     C***********     @@CALC - INTEREST CALCULATION METHOD            *   S01392
     C***********     @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C***********     @@RATE - INTEREST RATE 11,7                     *   S01392
     C***********                                                     *   S01392
     C***FIELDS*OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C***********                                                     *   S01392
     C***WORK*FIELDS   @@W155 - 15,5                                      S01392
     C***********                                                     *   S01392
     C*****************************************************************   S01392
     C***********MM1007    BEGSR                                          S01392
     C***********                                                         S01392
     C****CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C***********          EXSR MM1009                                    S01392
     C***********                                                         S01392
     C***********@@CALC    IFEQ '2'                        *** B 1        S01392
     C***********@@CALC    OREQ '3'                                       S01392
     C***********@@CALC    OREQ '5'                                       S01392
     C***********@@AMT     DIV  36000     @@W155 155                      S01392
     C***********          END                             *** E 1        S01392
     C***********                                                         S01392
     C***********@@CALC    IFEQ '1'                        *** B 1        S01392
     C***********@@CALC    OREQ '4'                                       S01392
     C***********@@AMT     DIV  36500     @@W155                          S01392
     C***********          END                              *** E 1       S01392
     C***********                                                         S01392
     C***********@@CALC    IFEQ '6'                         *** B 1       S01392
     C***********@@AMT     DIV  36600     @@W155                          S01392
     C***********          END                              *** E 1       S01392
     C***********                                                         S01392
     C***********          MULT @@RATE    @@W155                          S01392
     C***********@@W155    MULT @@INDY    @@INTR 150H                     S01392
     C***********                                                         S01392
     C***********          GOTO M10079                                    S01392
     C***********          Z-ADD0         @@AMT  150                      S01392
     C***********          Z-ADD0         @@RATE                          S01392
     C***********                                                         S01392
     C***********M10079    ENDSR                                          S01392
     C*****************************************************************   S01392
     C*                                                               *   S01392
     C*   MM1030 - CALCULATE INTEREST                                 *   S01392
     C*                                                               *   S01392
      *  (c) Finastra International Limited 2001                      *
     C*  CALLED BY    -                                               *   S01392
     C*                                                               *   S01392
     C***CALLS********-***MM1009*CALCULATE*NO.*OF*INTEREST*DAYS*****S01392056095
     C*  CALLS        -   ZINTDY CALCULATE NO. OF INTEREST DAYS       *   056095
     C*                                                               *   S01392
     C***FIELDS*INPUT*@@BEG**-*START*DATE*OF*PERIOD*****************S01392056095
     C****************@@END**-*END*DATE*OF*PERIOD*******************S01392056095
     C****************@@CALC*-*INTEREST*CALCULATION*METHOD**********S01392056095
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   056095
     C*               ZZEND  - END DATE OF PERIOD                     *   056095
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   056095
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C*               @@RATE - INTEREST RATE 11,7                     *   S01392
     C*               @@RDFC - ROUND DOWN FACILITY IND 1              *   S01392
     C*                                                               *   S01392
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C*                                                               *   S01392
     C*  WORK FIELDS   @@W157 - 15,5                                  *   S01392
     C*****************@@W150*-*15,0*******************************S01392 056121
     C*                @@W210 - 21,0                                  *   056121
     C*                @@YEAR - (NUMBER OF DAYS IN YEAR) x 100        *   S01392
     C*                                                               *   S01392
     C*****************************************************************   S01392
     C           MM1030    BEGSR                                          S01392
     C*                                                                   S01392
     C*   CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C/COPY WNCPYSRC,MM0102C001
     C*                                                                   S01392
     C***********          EXSR MM1009                              S01392056095
     C                     Z-ADDZZBEG     ZZBEG9  50                                          CDL093
     C                     Z-ADDZZEND     ZZEND9  50                                          CDL093
      *                                                                                       CDL093
      ** Check if 29th Feb is included                                                        CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
      *                                                                                       CDL093
      ** Convert start date to YYYYMMDD format                                                CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZBEG9    @@DAYN  50                                          CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATA  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY1   40                                          CDL093
      *                                                                                       CDL093
      ** Convert end date to YYYYMMDD format                                                  CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZEND9    @@DAYN                                              CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATB  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY2   40                                          CDL093
      *                                                                                       CDL093
     C                     EXSR #FEB29                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           IKNIPD    ANDNE*ZERO                                                         CDL093
     C           IKNIPD    ANDLTZZEND                                                         CDL093
      *                                                                                       CDL093
     C                     Z-ADDIKIPDM    @@IPDM  20                                          CDL093
     C                     CALL 'MM001031'                                                    CDL093
     C                     PARM           ZZBEG                                               CDL093
     C                     PARM           ZZEND                                               CDL093
     C                     PARM           IKNIPD                                              CDL093
     C                     PARM '9'       ZZCALC                                              CDL093
     C                     PARM           IKIPFQ                                              CDL093
     C                     PARM           @@AMT                                               CDL093
     C                     PARM           @@RATE                                              CDL093
     C                     PARM 'N'       RNDDWN  1                                           CDL093
     C                     PARM 'N'       FRSLST  1                                           CDL093
     C                     PARM           @@IPDM                                              CDL093
     C                     PARM           WINTR                                               CDL093
      *                                                                                       CDL093
     C                     Z-ADDWINTR     @@INTR                                              CDL093
     C           *LIKE     DEFN @@INTR    WINTR                                               CDL093
      *                                                                                       CDL093
     C                     GOTO INTCLC                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C                     EXSR ZINTDY                                    056095
     C*                                                                   S01392
     C***********@@CALC    IFEQ '2'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '3'                                 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C           ZZCALC    IFEQ '2'                        *** B 1        056095
     C           ZZCALC    OREQ '3'                                       056095
     C           ZZCALC    OREQ '5'                                       056095
     C           ZZCALC    OREQ '7'                                       CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C           ZZCALC    OREQ '0'                                                          CER016A
     C                     Z-ADD36000     @@YEAR  50                      S01392
     C                     END                             *** E 1        S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '1'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '4'                                 S01392056095
     C           ZZCALC    IFEQ '1'                        *** B 1        056095
     C           ZZCALC    OREQ '4'                                       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDNE'Y'                                                           CDL093
     C                     Z-ADD36500     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '6'                         *** B 1 S01392056095
     C           ZZCALC    IFEQ '6'                         *** B 1       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C                     Z-ADD36600     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C           ZZCALC    IFEQ '6'                                       163136
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           INT6DY    MULT @@RATE    @@W157                          163136
     C                     ELSE                                           163136
      *                                                                   163136
     C***********@@INDY    MULT @@RATE    @@W157 157                S01392056095
     C           ZZINDY    MULT @@RATE    @@W157 157                      056095
      *                                                                   163136
     C                     END                                            163136
      *                                                                   163136
     C***********@@W157    MULT @@AMT     @@W150 150H              S01392 056121
     C           @@W157    MULT @@AMT     @@W210 210H                     056121
     C*                                                                   S01392
     C**  ROUND DOWN IF ROUND DOWN INDICATOR IS 'Y'                       S01392
     C*                                                                   S01392
     C           @@RDFC    IFEQ 'Y'                                       S01392
     C***********@@W150    DIV  @@YEAR    @@INTR                   S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR                          056121
     C                     ELSE                                           S01392
     C***********@@W150    DIV  @@YEAR    @@INTR 150H              S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR 150H                     056121
     C                     END                                            S01392
     C/COPY WNCPYSRC,MM0102C002
      * Interest has been calculated                                                          CDL093
     C           INTCLC    TAG                                                                CDL093
     C*                                                                   S01392
     C           M10309    ENDSR                                          S01392
     C*****************************************************************   S01392
     C/EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZINTDYZ2                                               056095
     C*****************************************************************
     C****MM1009*- CALCULATE THE NUMBER OF INTEREST DAYS              *   056095
     C***********                                                     *   056095
     C***CALLED*BY    -                                               *   056095
     C***********                                                     *   056095
     C***CALLS***     -   ZDATE9 CONVERT MIDAS DAY NUMBER TO YMD DATE *   056095
     C***********                                                     *   056095
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                   *   056095
     C***********     @@END  - END DATE OF PERIOD                     *   056095
     C***********     @@CALC - INTEREST CALCULATION METHOD            *   056095
     C***********                                                     *   056095
     C***FIELDS*OUTPUT @@INDY - NO. OF INTEREST DAYS                  *   056095
     C***********                                                     *   056095
     C***WORKFIELDS   @@WN5   - WORK FIELD 5N                         *   056095
     C***********     @@WN5A  - WORK FIELD 5N                         *   056095
     C***********     @@WDAT  - WORK FIELD 5N                         *   056095
     C***********     @@DAYN  - WORK FIELD 5N                         *   056095
     C***********     @@P1    - WORK FIELD 5N                         *   056095
     C***********     @@P2    - WORK FIELD 5N                         *   056095
     C***********     @@P3    - WORK FIELD 5N                         *   056095
     C***********     @@LPNM  - WORKFIELD USED IN SETTING UP @@TG10   *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********MM1009    BEGSR                                          056095
     C***********                                                         056095
     C***********          MOVE @@BEG     @@BEG   50                      056095
     C***********          MOVE @@END     @@END   50                      056095
     C***********          MOVE @@CALC    @@CALC  1                       056095
     C***********          Z-ADD*ZEROS    @@INDY                          056095
     C***********          Z-ADD*ZEROS    @@LPNM                          056095
     C***********                                                         056095
     C***FIND*NUMBER OF DAYS DIFFERENCE BETWEEN DATES                     056095
     C***********                                                         056095
     C***********@@END     SUB  @@BEG     @@WDAT  50                      056095
     C***********                                                         056095
     C*****FOR*CALCULATION METHODS 3,4 OR 5.                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***********@@CALC    OREQ '4'                                       056095
     C***********@@CALC    OREQ '5'                                       056095
     C***********                                                         056095
     C***********          Z-ADD@@BEG     @@DAYN  50                      056095
     C***********          EXSR ZDATE9                                    056095
     C***********          Z-ADD@@VDT     @@DATA                          056095
     C***********                                                         056095
     C***********          Z-ADD@@END     @@DAYN                          056095
     C***********          EXSR ZDATE9                                    056095
     C***********          Z-ADD@@VDT     @@DATB                          056095
     C***IF*IN*SAME MONTH                                                 056095
     C***********@@YY1     IFEQ @@YY2                      **** B 2       056095
     C***********@@MM1     IFEQ @@MM2                      **** B 3       056095
     C***********@@DD2     SUB  @@DD1     @@INDY                          056095
     C***********          GOTO M10099                     --------->     056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C**IF*NOT*3,4 OR 5    ****                                           056095
     C**EXIT*PROCESSING                                                   056095
     C***********          Z-ADD@@WDAT    @@INDY  50       - LOAD OUTPT   056095
     C***********          GOTO M10099                     ----------->   056095
     C***********          END                             **** E 1       056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***CALC*NO. DAYS IN FIRST MONTH                                     056095
     C***********@@MM1     IFNE 2                          **** B 2       056095
     C***********30        SUB  @@DD1     @@P1    50   80                 056095
     C***IF*<*0,*INITIALISE TO 0                                          056095
     C***80******          Z-ADD*ZEROS    @@P1                            056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C***TEST*IF*LEAP      ****                                           056095
     C***YEAR****                                                         056095
     C***********@@YY1     DIV  4         @@WN5                           056095
     C***********          MVR            @@WN5          80               056095
     C***********                                                         056095
     C************IN80     IFEQ '1'                        **** B 3       056095
     C***********29        SUB  @@DD1     @@P1    50                      056095
     C***********          ELSE                                           056095
     C***IF*NOT*LEAP       ++++                                           056095
     C***********28        SUB  @@DD1     @@P1    50                      056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***CALC.*NO. DAYS IN LAST MONTH                                     056095
     C***********@@DD2     IFLE 30                         **** B 2       056095
     C***********          Z-ADD@@DD2     @@P2    50                      056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********          Z-ADD30        @@P2                            056095
     C***********          END                             **** E 2       056095
     C***CALC*NO. DAYS IN INTERVENING MONTHS                              056095
     C***********@@YY2     IFEQ @@YY1                      **** B 2       056095
     C***********@@MM2     SUB  @@MM1     @@P3    50                      056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 30        @@P3                            056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********@@YY2     SUB  @@YY1     @@P3                            056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 360       @@P3                            056095
     C***********                                                         056095
     C**FIND*NO.*OF MONTHS FOR THE TWO PARTIAL YEARS                      056095
     C***********12        SUB  @@MM1     @@WN5A  50                      056095
     C***********          MULT 30        @@WN5A                          056095
     C***********                                                         056095
     C***********@@MM2     SUB  1         @@WN5                           056095
     C***********@@WN5     MULT 30        @@WN5                           056095
     C***ACCUMULATE                                                       056095
     C***********@@WN5A    ADD  @@WN5     @@WN5A                          056095
     C***********@@P3      ADD  @@WN5A    @@P3                            056095
     C***********          END                             **** E 2       056095
     C***FINAL*SUM                                                        056095
     C***********                                                         056095
     C***********@@P1      ADD  @@P2      @@INDY                          056095
     C***********          ADD  @@P3      @@INDY                          056095
     C***********          END                             **** E 1       056095
     C***FOR*METHODS 4 AND 5                                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '4'                        **** B 1       056095
     C***********@@CALC    OREQ '5'                                       056095
     C****CALCULATE NUMBER OF LEAP YEARS BETWEEN START AND END DATES      056095
     C***********@@MM1     IFLE 2                          **** B 2       056095
     C***********@@YY1     DIV  4         @@WN5   50                   YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM  50                      056095
     C***********          END                             **** E 3       056095
     C***BYPASS*IF YEARS ARE THE SAME                                     056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          GOTO M10099                     ---------->    056095
     C***********          END                             **** E 2       056095
     C***LOOP*TO*CALCULATE NO. LEAP YEARS                                 056095
     C***********@@YY1     DOWNE@@YY2                      **** B 2       056095
     C***INCREMENT START YEAR                                             056095
     C***********          ADD  1         @@YY1                           056095
     C***********                                                         056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@MM2     IFGT 2                          **** B 4       056095
     C***********@@YY2     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***INCREMENT IF LEAP YEAR                                           056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 4      056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          END                              **** E 3      056095
     C***********@@YY1     IFNE @@YY2                       **** B 3      056095
     C***********@@YY1     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 3      056095
     C***********          END                              **** E 2      056095
     C***********          END                              **** E 1      056095
     C***********                                                         056095
     C***********M10099    ENDSR                           ***M10099***   056095
     C*******************************************************************
     C/EJECT
      /COPY ZSRSRC,ZDATE9Z3
     C/COPY ZSRSRC,ZFEB29                                                                     CDL093
     C/EJECT
      /COPY ZSRSRC,ZDAT10Z2
     C****************************************************************
     C*                                                                     *
     C* MM1004 - CALCULATE THE NEXT INTEREST PAYMENT DATE                   *
     C*
     C* CALLED BY :                                                         *
     C*                                                                     *
     C* CALLS :  ZCHKH , A COMMON ROUTINE TO DETERMINE WHETHER A DATE
     C*          IS A WORKING DAY OR A HOLIDAY.                             *
     C*       :  ZDAT10, A COMMON ROUTINE TO CONVERT DATE IN YYYYMMDD
     C*          FORMAT TO MIDAS DAY NUMBER.                                *
     C*       :  ZDATE9, A COMMON ROUTINE TO CONVERT MIDAS DAY NUMBER
     C*          TO DATE FORMAT OF YYYYMMDD.                                *
     C*                                                                     *
     C* INPUT  : @@STRT START DATE                           (8N)           *
     C*          @@FREQ PAYMENT FREQUENCY                    (1A)           *
     C*          @@CCY  CURRENCY CODE                        (3A)           *
     C*          @@MDAY INTEREST PAYMENT DAY IN THE MONTH    (2N)           *
     C*          @@MDAT MATURITY DATE                        (8N)
     C*                                                                     *
     C* OUTPUT : @@NDAT NEXT PAYMENT DATE (MIDAS DAY NUMBER) (8N)           *
     C*
     C* USES :   ZZDTIN DATE PASSED TO           SR ZDAT10   (8N)
     C*          ZZMDNO MIDAS DAY NUMBER FROM    SR ZDAT10   (5N)
     C*          @@DAYN DAY NUMBER PASSED TO     SR ZDATE9   (5N)
     C*          @@VDT  DATE IN FORMAT YYYYMMDD  SR ZDATE9   (8N)
     C*          @@DNO  WORK FIELD - DAY NUMBER              (5N)           *
     C*          @@CCY  CURRENCY CODE                        (3A)           *
     C*          @@WF16 WORK FIELD - # DAYS IN THE MONTH     (2N)           *
     C*          @@HWIN WORK FIELD - HOLIDAY/WORK INDICATOR  (1A)           *
     C*          @@WKDT WORK FIELDS DS TO MANIPULATE DATE    (8N)           *
     C*          @@WKYY WORK FIELDS DS  - YEAR FIELD YYYY    (4N)           *
     C*          @@WKY  WORK FIELDS DS  - YEAR FIELD   YY    (2N)           *
     C*          @@WKM  WORK FIELDS DS  - MONTH FIELD        (2N)           *
     C*          @@WKD  WORK FIELDS DS  - DAY FIELD          (2N)           *
     C*          @@WKD2 WORK FIELDS - MAXIMUM DAYS IN MONTH  (2N)           *
     C*          @@REM2 LEAP YEAR CALCS - REMAINDER FIELD    (3N)           *
     C*                                                                     *
     C***********************************************************************
     C           MM1004    BEGSR
     C*
     C** Re-set the indicators used within this subroutine.
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN82
     C*
     C** Move the start date input into a working fields DS.
     C                     MOVE @@STRT    @@WKDS
     C*
     C** IF     the interest payment day in month is blank
     C**        THEN     substitue day from start date into that field.
     C** END
     C*
     C           @@MDAY    IFEQ 0                          B1
     C                     Z-ADD@@WKD     @@MDAY  20       *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is blank
     C**        THEN next interest date is set to maturity date
     C** END
     C*
     C           @@FREQ    IFEQ *BLANK                     B1
     C                     Z-ADD@@MDAT    @@NDAT           *1
     C                     GOTO M10049                     *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is monthly
     C**        THEN     increment the month by 1.
     C** END
     C           @@FREQ    IFEQ 'M'                        B1
     C                     ADD  1         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is quarterly.
     C**        THEN     increment the month by 3.
     C** END
     C           @@FREQ    IFEQ 'Q'                        B1
     C                     ADD  3         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is six-monthly
     C**        THEN     increment the month by 6.
     C** END
     C           @@FREQ    IFEQ 'X'                        B1
     C                     ADD  6         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is yearly
     C**        THEN     increment the year by 1.
     C** END
     C           @@FREQ    IFEQ 'Y'                        B1
     C                     ADD  1         @@WKYY           *1
     C                     END                             E1
     C*
     C** Substitute day in month into the day field.
     C*
     C                     Z-ADD@@MDAY    @@WKD
     C*
     C** IF     the new month now exceeds 12
     C**        THEN     subtract 12 from the month
     C**                 increment the year by 1
     C** END
     C*
     C           @@WKM     IFGT 12                         B1
     C           @@WKM     SUB  12        @@WKM            *1
     C                     ADD  1         @@WKYY           *1
     C                     END                             E1
     C*
     C** IF     the days now exceed the number of days for that month
     C**        THEN     substitue the maximum # of days to that field
     C**              IF     leap year and month is February
     C**                     THEN     add an extra day to the day field
     C**              END
     C** END
     C*
     C                     MOVE @M,@@WKM  @@WKD2  20     80
     C           @@WKD     IFGT @@WKD2                     E1
     C                     Z-ADD@@WKD2    @@WKD            *1
     C*
     C** Test for leap year, and turn of century leap year.
     C** NB: only every 400 years is a leap year.
     C           @@WKY     IFEQ 0                          B*2
     C           @@WKYY    DIV  400       @@WF16  30       **2
     C                     MVR            @@REM2  30     82**2
     C                     ELSE                            X*2
     C           @@WKYY    DIV  4         @@WF16           **2
     C                     MVR            @@REM2         82**2
     C                     END                             E*2
     C*
     C           *IN82     IFEQ '1'                        B*2
     C           @@WKM     IFEQ 2                          B**3
     C                     ADD  1         @@WKD            ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** Convert payment date to midas format.
     C*
     C                     Z-ADD@@WKDT    ZZDTIN
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    @@DNO   50
     C*
     C** DOWHILE     payment date is NOT a valid woking day
     C**             increment the day number
     C** WEND
     C*
     C           @@HWIN    DOUEQ'W'                        B1
     C                     Z-ADD@@DNO     ZDAYNO           *1
     C                     EXSR ZCHKH                      *1
     C                     MOVE ZIND      @@HWIN  1        *1
     C           @@HWIN    IFNE 'W'                        B*2
     C                     ADD  1         @@DNO            **2
     C                     END                             E**2
     C                     END                             E1
     C*
     C** Convert payment day number back to YYYYMMDD format.
     C*
     C                     Z-ADD@@DNO     @@DAYN  50
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     @@NDAT  80
     C                     GOTO M10049
     C*
     C**  Unexecuted code to define fields
     C                     MOVEL@@FREQ    @@FREQ  1
     C                     MOVEL@@STRT    @@STRT  80
     C                     MOVEL@@MDAT    @@MDAT  80
     C                     MOVELZCCY      ZCCY    3
     C*
     C           M10049    ENDSR
     C*******************************************************************
     C/EJECT
     C***********************************************************************
     C/EJECT
     C*****************************************************************
     C*   MM1003 - CALCULATE A PERIOD DATE                            *
     C*                                                               *
     C*   PERIOD DATES ARE CALCULATED FOR THE FOLLOWING PERIODS       *
     C*      PERIOD TYPE       PERIOD NUMBER     PERIOD SHORTNAME     *
     C*           D                 -1             OVERNIGHT          *
     C*           D                  0             TOMORROW / NEXT    *
     C*           D                  1             SPOT / NEXT        *
     C*           W                  1             1 WEEK             *
     C*           W                  2             2 WEEK             *
     C*           W                  3             3 WEEK             *
     C*           M                  1             1 MONTH            *
     C*           M                  2             2 MONTH            *
     C*           M                  3             3 MONTH            *
     C*           M                  6             6 MONTH            *
     C*           M                  9             9 MONTH            *
     C*           Y                  1             1 YEAR             *
     C*           Y                  2             2 YEAR             *
     C*           Y                  3             3 YEAR             *
     C*           Y                  4             4 YEAR             *
     C*           Y                  5             5 YEAR             *
     C*           Y                  6             6 YEAR             *
     C*           Y                  7             7 YEAR             *
     C*           Y                  8             8 YEAR             *
     C*           Y                  9             9 YEAR             *
     C*           Y                 10            10 YEAR             *
     C*                                                               *
     C*  CALLED BY    -                                               *
     C*                                                               *
     C*  CALLS        -                                               *
     C*                                                               *
     C*  ZA0770       - CONVERT DATE YYYYMMDD TO DDMMYY               *
     C*  ZA0730       - FIND NEXT WORKING DAY                         *
     C*  ZDATE9       - CONVERT MIDAS DAY NO TO YYYYMMDD              *
     C*  ZDAT10       - CONVERT DATE TO MIDAS DAY NUMBER              *
     C*                                                               *
     C*  CALLS PROGRAM ZA0270 CONVERT DATE TO MIDAS DAY NUMBER WITH   *
     C*                VALIDATION CHECK                               *
     C*                                                               *
     C*  FIELDS INPUT -                                               *
     C*                                                               *
     C*  @@CCY   3    - CURRENCY                                      *
     C*  @@SPOT  80   - MONEY MARKET SPOT DATE                        *
     C*  @@PNUM  2,0  - PERIOD NUMBER                                 *
     C*  @@PTYP  1    - PERIOD TYPE                                   *
     C*                                                               *
     C*  FIELDS OUTPUT                                                *
     C*                                                               *
     C*  @@PDAT  8,0  - PERIOD DATE                                   *
     C*  @@PRDN  5,0  - PERIOD DAY NUMBER                             *
     C*                                                               *
     C*  WORK FIELDS                                                  *
     C*                                                               *
     C*  @@DTIN  8,0  - DATE INPUT TO ZA0770 IN YYYYMMDD FORMAT       *
     C*  ZZDTIN  8,0  - DATE INPUT TO ZDAT10 IN YYYYMMDD FORMAT       *   056095
     C*  @@DATF  1    - DATE FORMAT (M OR D)                          *
     C*  @@RTNC  1    - RETURN INDICATOR FROM ZA0270                  *
     C*  @@DAYN  5,0  - MIDAS DAY NUMBER                              *
     C*  @@MNO   5,0  - MIDAS DAY NUMBER                              *
     C*  @@HIND  1    - HOLIDAY INDICATOR H OR W                      *
     C*  @@ADD   3,0  - CALCULATION WORK FIELD                        *
     C*  @@VDT   8,0  - DATE OUTPUT FROM ZDATE9                       *
     C*  @@RUND  8    - RUN DATE IN YYYYMMDD FORMAT                   *
     C*                                                               *
     C*****************************************************************
     C*
     C           MM1003    BEGSR
     C*
     C                     Z-ADD*ZERO     @@STRT
     C                     Z-ADD*ZERO     @@DTIN
     C                     Z-ADD*ZERO     ZZDTIN                          056095
     C                     Z-ADD*ZERO     @@SPDD
     C                     Z-ADD*ZERO     @@DATE
     C                     Z-ADD*ZERO     @@DTOU
     C                     Z-ADD*ZERO     @@Z71Y
     C                     Z-ADD*ZERO     @@VDT
     C*
     C                     ADD  @@SPOT    @@SPDD
     C**  SET UP STARTING POINT DATE AS SPOT DATE
     C                     Z-ADD@@SPDD    @@STRT
     C*
     C**  ADD PERIOD NUMBERS TO DATE
     C           @@PTYP    IFEQ 'M'                        B1
     C                     ADD  @@PNUM    @@STMT           *1
     C           @@STMT    IFGT 12                         B*2
     C                     SUB  12        @@STMT           **2
     C                     ADD  1         @@STYR           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           @@PTYP    IFEQ 'Y'                        B1
     C                     ADD  @@PNUM    @@STYR           *1
     C                     END                             E1
     C*
     C**  CONVERT DATE FORMAT FROM YYYYMMDD TO DDMMYY
     C                     MOVEL'D'       @@DATF  1
     C                     Z-ADD@@STRT    @@DTIN
     C                     EXSR ZA0770
     C                     Z-ADD@@DTOU    @@DATE
     C*
     C*
     C                     MOVE @@DATE    @@DATC  60
     C*
     C**  CONVERT STARTING DATE TO MIDAS DAY NUMBER FORMAT
     C           @@RTNC    DOUEQ'0'                        B1
     C                     CALL 'ZA0270'                   *1
     C                     PARM           @@DATC           *1
     C                     PARM           @@DATF           *1
     C           @@RTNC    PARM           @@RTNC  1        *1
     C           @@DAYN    PARM           @@DAYN  50       *1
     C*
     C                     SUB  1         @@DAY2           *1
     C                     MOVE @@DATE    @@DATC           *1
     C*
     C                     END                             E1
     C*
     C                     Z-ADD@@DAYN    ZDAYNO
     C                     MOVEL@@RTNC    @@RTN
     C*
     C**  RESET STARTING POINT
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     @@STRT
     C** SAVE THE MIDAS DAY NO. EQUIVALENT FOR POSSIBLE OUTPUT
     C                     Z-ADD@@DAYN    @@STDN  50
     C*
     C**  PROCESS PERIOD TYPE 'D'
     C           @@PTYP    IFEQ 'D'                        B1
     C*
     C**  IF PERIOD NUMBER = 1 FIND NEXT WORKING DAY
     C           @@PNUM    IFEQ 1                          B*2
     C           ZIND      DOUEQ'W'                        B**3
     C                     ADD  1         ZDAYNO           ***3
     C                     EXSR ZCHKH                      ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  IF PERIOD NUMBER NE 1 FIND TOMORROW/NEXT DAY (AND OVERNIGHT)
     C**  IE FIND NEXT WORKING DAY BEYOND RUND
     C           @@PNUM    IFLT 1                          B*2
     C                     Z-ADDBJRDNB    ZDAYNO           **2
     C           ZIND      DOUEQ'W'                        B**3
     C                     ADD  1         ZDAYNO           ***3
     C                     EXSR ZCHKH                      ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  IF PERIOD NUMBER IS -1 FIND NEXT WORKING DAY TOMM/NEXT.
     C**  IE FIND NEXT WORKING DAY BEYOND RUND
     C           @@PNUM    IFEQ 0                          B*2
     C           ZIND      DOUEQ'W'                        B**3
     C                     ADD  1         ZDAYNO           ***3
     C                     EXSR ZCHKH                      ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  PROCESS PERIOD TYPE 'W'
     C           @@PTYP    IFEQ 'W'                        B1
     C*
     C**  INCREMENT DAY NUMBER
     C           @@PNUM    MULT 7         @@ADD   30       *1
     C                     ADD  @@ADD     ZDAYNO           *1
     C*
     C**  FIND NEXT WORKING DAY
     C                     EXSR ZCHKH                      *1
     C           ZIND      DOWEQ'H'                        B*2
     C                     ADD  1         ZDAYNO           **2
     C                     EXSR ZCHKH                      **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  PROCESS PERIOD TYPE 'M' OR 'Y'
     C           @@PTYP    IFEQ 'M'                        B1
     C           @@PTYP    OREQ 'Y'                        *1
     C*
     C**  IS SPOT LAST WORKING DAY IN MONTH
     C***********          Z-ADD@@SPDD    @@DTIN           *1             056095
     C                     Z-ADD@@SPDD    ZZDTIN           *1             056095
     C                     EXSR ZA0730                     *1
     C           @@SPMT    IFNE @@Z71M                     B*2
     C                     Z-ADD1         @@STDY           **2
     C           @@STMT    IFEQ 12                         B**3
     C                     Z-ADD1         @@STMT           ***3
     C                     ADD  1         @@STYR           ***3
     C                     ELSE                            X**3
     C                     ADD  1         @@STMT           ***3
     C                     END                             E**3
     C*
     C**  CONVERT STARTING DATE TO MIDAS DAY NUMBER FORMAT
     C                     Z-ADD@@STRT    ZZDTIN
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ZDAYNO
     C           ZIND      DOUEQ'W'                        B**3
     C                     SUB  1         ZDAYNO           ***3
     C                     EXSR ZCHKH                      ***3
     C                     END                             E**3
     C                     GOTO M10038                     **2
     C                     END                             E*2
     C*
     C**  IF THE STARTING POINT DAY IS A NON WORKING DAY AND THE NEXT
     C**  WORKING DAY FALLS IN THE NEXT MONTH  FIND LAST WORKING DAY
     C**  IN STARTING MONTH.
     C                     Z-ADD@@STRT    ZZDTIN
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ZDAYNO
     C                     EXSR ZCHKH                      *1
     C           ZIND      IFEQ 'H'                        B*2
     C***********          Z-ADD@@STRT    @@DTIN           **2            056095
     C                     Z-ADD@@STRT    ZZDTIN           **2            056095
     C                     EXSR ZA0730                     **2
     C*
     C           @@STMT    IFNE @@Z71M                     B**3
     C           ZIND      DOUEQ'W'                        B***4
     C                     SUB  1         ZDAYNO           ****4
     C                     EXSR ZCHKH                      ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     GOTO M10038                     ***3
     C                     END                             E*2
     C*
     C**  IF STARTING DATE IS A WORKING DAY IN CURRENCY & SPOT DATE
     C**  IS NOT LAST WORKING DAY IN MONTH PERIOD DATE IS STARTING DAY
     C                     Z-ADD@@STRT    @@PDAT           *1
     C                     Z-ADD@@STDN    @@PRDN           *1
     C                     GOTO M10039                     *1
     C*
     C                     END                             E1
     C*
     C           M10038    TAG
     C*
     C**  CONVERT DATE TO YYYYMMDD FORMAT
     C                     Z-ADDZDAYNO    @@DAYN
     C                     EXSR ZDATE9
     C*
     C** OUTPUT DATE IN YYYYMMDD FORMAT AND MIDAS DAY NO. FORMAT
     C                     Z-ADD@@VDT     @@PDAT  80
     C                     Z-ADD@@DAYN    @@PRDN  50
     C*
     C                     GOTO M10039
     C                     ADD  0         @@SPOT  80
     C                     MOVE *BLANKS   ZCCY    3
     C                     ADD  0         @@PNUM  20
     C                     MOVE *BLANKS   @@PTYP  1
     C*
     C           M10039    ENDSR
     C***********************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*       TITLE:DETERMINE NEXT WORKING DAY.                       *
     C*                                                               *
     C********SUBROUTINE*ZA0730*EXPECTS*FIELD*'@@DTIN'*TO*BE***********   056095
     C*       SUBROUTINE ZA0730 EXPECTS FIELD 'ZZDTIN' TO BE          *   056095
     C*       PASSED TO IT IN 'YYYYMMDD' FORMAT.IT THEN DETERMINES    *
     C*       THE NEXT WORKING DAY AND RETURNS.                       *
     C*                                                               *
     C* CALLS : ZDATE9 - CONVERTS MIDAS DAY NUMBER TO YYYYMMDD        *
     C*         ZDAT10 - CONVERTS YYYYMMDD TO MIDAS DAY NUMBER        *
     C*                                                               *
     C**INPUT**:@@DTIN*DATE*(YYYYMMDD)*-*IN*DATA*STRUCTURE*(SIZE*:*8N)*   056095
     C* INPUT  :ZZDTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)*   056095
     C*         @@CCY  CURRENCY CODE   - IN FORMAT(3A)                *
     C*                                                               *
     C* OUTPUT :@@VDT  DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)*
     C*                                                               *
     C* USES :   ZZMDNO MIDAS DAY NO USED BY SR ZDAT10                *
     C*          ZZDTIN (YYYYMMDD)   USED BY SR ZDAT10                *
     C*          @@DAYN MIDAS DAY NO USED BY SR ZDATE9                *
     C*                                                               *
     C*****************************************************************
     C           ZA0730    BEGSR
     C*
     C* CONVERT YYYYMMDD FORMAT TO MIDAS DAY NO.
     C*
     C***********          Z-ADD@@DTIN    ZZDTIN                          056095
     C                     EXSR ZDAT10
     C*
     C           ZA0731    TAG
     C*
     C                     ADD  1         ZZMDNO  50
     C*
     C* CHECK IF DAY NO. IS A HOLIDAY          .
     C*
     C                     Z-ADDZZMDNO    ZDAYNO
     C*
     C                     EXSR ZCHKH
     C*
     C           ZIND      IFEQ 'H'
     C                     GOTO ZA0731
     C                     END
     C*
     C* CONVERT MIDAS DAY NO. TO YYYYMMDD FORMAT.
     C*
     C                     Z-ADDZZMDNO    @@DAYN  50
     C*
     C                     EXSR ZDATE9
     C*
     C           ZA0739    ENDSR                                       **
     C***********************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  SUBROUTINE ZA0770 - THIS SUBROUTINE RECEIVES A 8/0 INPUT     *
     C*                      DATE - FORMAT YYYYMMDD AND OUTPUTS A     *
     C*                      6/0 DATE. IF INPUT FIELD @@DATF = 'M'    *
     C*                      OUTPUT FORMAT MMDDYY. IF INPUT FIELD     *
     C*                      @@DATF = 'D' OUTPUT FORMAT DDMMYY.       *
     C*  CALLED BY   :                                                *
     C*                                                               *
     C*  INPUT       : @@DTIN  - DATE INPUT (8,0)                     *
     C*              : @@DATF  - DATE FORMAT INDICATOR (M OR D)       *
     C*  OUTPUT      : @@DTOU  - DATE OUTPUT (6,0)                    *
     C*                                                               *
     C*  WORK FIELDS : @@YYY   - YEAR IN (2,0)                        *
     C*              : @@MM    - MONTH IN (2,0)                       *
     C*              : @@DD    - DAY IN (2,0)                         *
     C*                                                               *
     C*              : @@DAT1  - IF DATE DD/MM/YY DAY ELSE MONTH (2,0)*
     C*              : @@DAT2  - IF DATE DD/MM/YY MONTH ELSE DAY (2,0)*
     C*                                                               *
     C*****************************************************************
     C           ZA0770    BEGSR
     C*
     C                     Z-ADD@@YY      @@YYY
     C*
     C**  DATF = 'D' CONVERT TO MMDDYY FORMAT
     C           @@DATF    IFEQ 'D'                        B1
     C                     Z-ADD@@DD      @@DAT1           *1
     C                     Z-ADD@@MM      @@DAT2           *1
     C                     END                             E1
     C*
     C*
     C**  DATF = 'M' CONVERT TO DDMMYY FORMAT
     C           @@DATF    IFEQ 'M'                        B1
     C                     Z-ADD@@DD      @@DAT2           *1
     C                     Z-ADD@@MM      @@DAT1           *1
     C                     END                             E1
     C*
     C**  MOVE YEAR PART OF DATA STRUCTURE
     C                     MOVE @@YYY     @@YY
     C*
     C           ZA0779    ENDSR                           ***ZA0779***
     C***********************************************************************
      /EJECT
      *****************************************************************                       CDL033
      * CKDEAL - Check if Deal Type is included in validations        *                       CDL033
      *****************************************************************                       CDL033
     C           CKDEAL    BEGSR                                                              CDL033
      *                                                                                       CDL033
     C           DTYP      IFNE 'CF'                                                          CDL033
     C                     MOVE *OFF      @FXT    1                                           CDL033
     C                     MOVE *IN49     TVAR    1                                           CDL033
     C           DTYP      LOKUPFXT                      49                                   CDL033
     C           *IN49     IFEQ *ON                                                           CDL033
     C                     MOVE *ON       @FXT                                                CDL033
     C                     ENDIF                                                              CDL033
     C                     MOVE TVAR      *IN49                                               CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C                     ENDSR                                                              CDL033
      *****************************************************************                       CDL033
      /EJECT                                                                                  CDL033
     C/COPY ZSRSRC,ZCHKH
      /EJECT
     C/COPY ZSRSRC,ZACCH
     O/EJECT
     C/COPY ZSRSRC,ZFWDT
     O/EJECT
     C/COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C/COPY ZSRSRC,ZCPDZ2
     O/EJECT
     O***********************************************************************
     O*
     OFDINTRP0E                UPDPDD
     O* INTEREST RATES DATES
     O*
     O                         HWPRDD
     O                         HWPRDN
     O*
     OTABTG10FE                UPDSPD
     O** CURRENCIES FILE - SPOT DATE
     O*
     O                         MSPD
     O*
     OMMDELDP0E                DELD
     O* MM DEAL LOANS/DEPOSITS
     O*
     O                         HKSLID                                                       MD024467
     O                         HKSLDD
     O                         HKSLMM
     O                         HKSLYY
     O                         HKNIPD                                                       MD024467
     O                         HKNIDD
     O                         HKNIMM
     O                         HKNIYY
     O                         HKDSTS
     O                         HKIADD
     O                         HKIAMM
     O                         HKIAYY
     O                         HKINTR
     O                         HKIIRT
     O                         HKSPRD
     O                         HKBSRC                                                       MD024467
     O                         HKDBSR                                                       MD024467
     O                         HKNGVI                                                         CDL033
     O                         HKMTTI                                                         260340
     O                         HKAMNP
     O                         HKIMAT
     O                         HKIPFQ
     O                         HKIPDM
     O                         HKMATD                                     BUG4092
     O                         HKMDDD                                     BUG4092
     O                         HKMDMM                                     BUG4092
     O                         HKMDYY                                     BUG4092
     O                         HKCAND                                     BUG4092
     O                         HKPNPR                                     BUG4092
     O                         HKPENA                                                       MD024467
     O                         HKNIPD                                                         262922
     O                         HKRCDT                                                       AR755195
     O                         HKSTRT                                                      AR755195A
     O                         HKINFD                                                       AR755195
     O*
     OMMDENBP0E                DENB
     O* MM DEAL NA'S BOUGHT
     O*
     O                         HLLIDD
     O                         HLLIMM
     O                         HLLIYY
     O                         HLNIDD
     O                         HLNIMM
     O                         HLNIYY
     O                         HLDSTS
     O                         HLIADD
     O                         HLIAMM
     O                         HLIAYY
     O                         HLIPFQ
     O                         HLIPDM
     O                         HLINTR                                                      AR1055654
     O                         HLFRAT                                                      AR1055654
     O                         HLDCRT                                                      AR1055654
      *                                                                                    AR1055654
     O                         HLNANV
     O                         HLAMNP                                     113605
     O                         HLMTTI                                                         222986
     O                         HLFVAL                                     113605
     O                         HLDCAM                                     113605
     O                         HLPSZE                                     113605
     O                         HLNSLD                                     113605
     O                         HLNIPD                                                         262922
     O*
     OMMDENSP0E                DENS
     O* MM DEAL NA'S SOLD
     O*
     O                         HMLIDD
     O                         HMLIMM
     O                         HMLIYY
     O                         HMNIDD
     O                         HMNIMM
     O                         HMNIYY
     O                         HMDSTS
     O                         HMIPFQ
     O                         HMIPDM
      ** Added 'CF' to array @DT and '+' to array @SN                                         CDL033
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** @M  USED BY SR. MM1004 - DAYS IN A MONTH
312831303130313130313031
** @DT USED BY SR. MM1004 - DEAL TYPES FOR LOANS/DEPOSITS
ITIPTDTICDCLCILNDLILIDDTLTFTFLDPLPCF                                                          CDL033
** @SN USED BY SR. MM1004 - SIGNS FOR DEAL TYPES IN @DL
+-+-+-+---++++---+                                                                            CDL033
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
** FXT                                                                                        CDL033
ITIPTDTICI                                                                                    CDL033
