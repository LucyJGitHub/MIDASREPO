     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Start of day rebuild - forward book')         *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MM Dealer Module
     F*                                                               *
     F*  MM0175    - START OF DAY REBUILD OF FORWARD BOOK DETAILS     *
     F*                                                               *
     F*  Function:   This program rebuilds the Money Market forward   *
     F*  (I/C INIT)  book file (MMFWDDPP) during I/C initiation.      *
     F*                                                               *
     F*  Called by: MM0101  - Start of day reorganisation.            *
     F*           via: MM0112  - File setup control.                  *
     F*                                                               *
     F*  Calls    : none                                              *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD053295           Date 13Apr19               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CDL093             Date 08Apr14               *
      *                 AR996895           Date 25Nov12               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL038             Date 10May05               *
      *                 CDL033             Date 10Feb05               *
      *                 CDL022             Date 03Feb04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 222727             Date 05Nov03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 163136             Date 07Jul99               *
      *                 126017             Date 18Nov97               *
     F*                 097885             Date 03Feb97               *
     F*                 092454             Date 27Jun96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 061426             DATE 30SEP93               *
     F*                 056121             DATE 04NOV93               *
     F*                 056095             DATE 07JUN93               *
     F*                 S01378             DATE 23APR92               *
     F*                 S01392             DATE 26AUG92               *
     F*                 E36024             DATE 21FEB92               *
     F*                 E29176             DATE 04OCT91               *
     F*                 E28344             DATE 25SEP91               *
     F*                 S01279             DATE 08APR91               *
     F*                 E20634             DATE 17APR90               *
     F*                 E20631             DATE 11APR90               *
     F*                 E20632             DATE 11APR90               *
     F*                 E20774             DATE 09APR90               *
     F*                 LN0162             DATE 11MAY90               *
     F*                 S01194             DATE 15JAN90               *
     F*                 S01218             DATE 11/08/89              *
     F*                 E17654             DATE 03/04/89              *
     F*                 E14042             DATE 20/07/88              *
     F*                 E13322             DATE 14/05/88              *
     F*                 S01149             DATE 27/06/88              *   S01149
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CDL093 - MM Interest calculation type 9.                     *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus                                       *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL033 - Floating Rate CDs Issued.                           *
      *  CDL022 - Deal Amendment Changes (Recompile)                  *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
     F*  CDL010 - Prevent last user that actioned the trade from      *
     F*           authorising it.Recompile due to changes in MMDEAMPP *
     F*           , MMDELDPP, MMDENBPP AND MMDENSPP .                 *
      *  CIR004 - Dealing Calculation Method Change                   *
      *  CDL006 - Fiduciary Dealing.                                  *
     F*  163136 - Interest Calculation Method '6'  showing incorrect -*
     F*           ZERO - amount . Addition to Core #126017 which dealt*
     F*           with the issue. It introduced an additional  INT6DY *
     F*           field in s-routine ZINTDY in  /COPY ZSRSRC/ZINTDYZ2 *
     F*           which in turn is usually called from GLINTC s-routine
     F*           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
     F*           least a dozen other pgms that use ZINTDY but do     *
     F*           GLINTC-processing within the pgms calculation specs *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC - recompile program.           *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  092454 - MM net amount in MM Cost to Close Enquiry is        *
     F*           incorrect - fix is to first add the movements in    *
     F*           to the total and then subtract the movements out,   *
     F*           to give a true net figure.                          *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  061426 - Recompile after ZDATE9 correction                   *
     F*  056121 - Increase size of work field to enablw correct       *
     F*           calculation of interest on very large amounts.      *
     F*           (Similar to fix 049499 of MM0089 in MRSLIB1005)     *
     F*  056095 - Interest not calculated consistently in MM.         *
     F*           SR. MM1009 was externally defined as ZINTDY,        *
     F*           while SR. ZA0710 and ZA0680 were replaced by        *
     F*           the externally defined standard SR. ZDATE9 and      *
     F*           ZDAT10, respectively.  Seventeen MM programs        *
     F*           were amended.                                       *
     F*  S01378 - Facilitates the partial sale of a parcel            *
     F*           of negotiable instruments which have been           *
     F*           previously input to the system as a single          *
     F*           transaction (was MOF53). Include processing         *
     F*           for NAS for partial selling of NAB.                 *
     F*  S01392 - JAP.SUB-MODULE INCORPORATION (CORE)                 *
     F*           a) Front-Up Interest - interest added/deducted      *
     F*              at value date rather than maturity.              *
     F*           b) Interest rounded down (new subroutine MM1030)    *
     F*           c) First & Last day interest - int due for every    *
     F*              day that deal is live.                           *
     F*  E36024 - Interest Payments missing from Forward Book         *
     F*  E29176 - PREVENT DIVIDE BY ZERO ERROR                        *
     F*  E28344 - RPG cycle logic needs a fix to cope with uncalle    *
     F*           call/notice (i.e. mdat = 0) with related deam.      *
     F*  S01279 - Replace CTC with Average rate on TM Daily           *
     F*           Summary enquiry.                                    *
     F*            - Discounted Bills were being processed as         *
     F*              interest bearing NAs                             *
     F*  E20634 - Correction on the caluclation of MM Net Movement    *
     F*           (HVNCML) for L/D and (HVNCMN) for N/A.              *
     F*           Replace MM1007 by MM1030.                           *
     F*  E20631 - Correction on the calculation error on Net Value    *
     F*           (HVNSNV) and Face Value (HVNSFV).                   *
     F*  E20632 - Calculation of Funds in Nostro has been missed      *
     F*           out. Therefore Funds in Nostro are zerioised at     *
     F*           start of day.                                       *
     F*  E20774 - REPLACE QCAEXEC WITH QCMDEXC                        *
     F*  LN0162 - CHANGED TO USE BJMRDT FROM SDBANK AND NOT           *   LN0162
     F*           RUNDAT                                              *   LN0162
     F*  S01194 - REL. 10  NEW COPYRIGHT STATEMENTS                   *
     F*           AND NEW STANDING DATA FILES-ADD ACCESS OBJECTS      *
     F*  S01218 - Recompiled to include new file layouts for          *
     F*           capital markets dealing interface                   *
     F*  E14042 - MULTISTREAMING START OF DAY PERFORMANCE             *
     F*           MODIFICATION.                                       *
     F*  E13322 - Program changed so that no WRITEs are               *
     F*           performed if no records in input files.             *
     F*  S01149 - Allow N/A update of Forward Book files              *   S01149
     F*                                                               *   S01149
     F*****************************************************************   S01149
     F*                                                               *
     F**  Indicator Function Summary                                  *
     F*                                                               *
     F* ID F  C  H  L    FUNCTION OF INDICATORS                       *
     F* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*
     F**01***************Record*identifying*indicator*for*MMDELDP0*****   S01149
     F**02***************Record*identifying*indicator*for*MMDENBP0*****   S01149
     F**03***************Record*identifying*indicator*for*MMSDFMP0*****   S01149
     F**04***************Record*identifying*indicator*for*MMSDFIP0*****   S01149
     F**05***************Record*identifying*indicator*for*MMSDFAP0*****   S01149
     F**06***************Record*identifying*indicator*for*MMSDFSP0*****   S01149
     F* 01               MMDELDP0 - LD Value date                     *   S01149
     F* 02               MMDENBP0 - NA Value date                     *   S01149
     F* 03               MMSDFMP0 - LD Maturity date                  *   S01149
     F* 04               MMSDFIP0 - LD Interest date                  *   S01149
     F* 05               MMSDFAP0 - LD SI deam - maturity date        *   S01149
     F* 06               MMSDFSP0 - LD SI deam - interest date        *   S01149
     F* 07               MMDEAMP0 - Live deams                        *   S01149
     F* 08               MMSDFIP1 - NA Interest date                  *   S01149
     F* 09               MMSDFMP1 - NA Maturity date                  *   S01149
     F* 10               MMDENSP0 - NA Value date (of sale)           *   S01149
     F* 11               MMSDFZP0 - NA SI deam - maturity date        *   S01149
     F* 12               MMSDFYP0 - NA SI deam - interest date        *   S01149
     F*                                                               *   S01149
     F*       60         General purpose indicator                    *
     F********80*********Chain*fail*on*FDICDRLL                       *   S01194
     F*                                                               *
     F*          U6      Program error                                *
     F*          U7      Set on with U8 if a database error occurs.   *
     F*          U8      File out of balance if on on its own.        *
     F*                                                               *
     F*             L1   Level break indicator on value date, maturity*
     F*                  date, next interest date                     *
     F*             L2   Level break indicator on currency            *
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F*FDICDRLLIF**E******    K        DISK         KINFSR INFSR  ****UC  S01194
     F*********** TABTB11F                          KIGNORE               S01194
     F*********** TABTB20F                          KIGNORE               S01194
     FFDMNTHLLIF  E                    DISK         KINFSR INFSR      UC
     FMMFWUDLLO   E           K        DISK         KINFSR INFSR      UC
     FMMFWUHLLO   E           K        DISK         KINFSR INFSR      UC
     FMMFWUTLLO   E           K        DISK         KINFSR INFSR      UC
     FMMDEALLLIF  E           K        DISK         KINFSR INFSR      UC  S01149
     F            MMDENSP0                          KRENAMEMMDEALP0       S01149
     F            MMDENBP0                          KIGNORE               S01149
     F            MMDELDP0                          KIGNORE               S01149
     FMMSDFDLLIF  E           K        DISK         KINFSR INFSR      UC
     F            MMDEAMP0                          KRENAMEMMSDFDP0
     F*                                                                   S01149
     F**               .... LOGIC CYCLE FILES ....                        S01149
     FMMSDFVLLIP  E           K        DISK         KINFSR INFSR
     F************MMDENSP0                          KIGNORE               S01149
     FMMSDFMLLIS  E           K        DISK         KINFSR INFSR
     F            MMDELDP0                          KRENAMEMMSDFMP0
     F            MMDENBP0                          KRENAMEMMSDFMP1       S01149
     FMMSDFILLIS  E           K        DISK         KINFSR INFSR
     F            MMDELDP0                          KRENAMEMMSDFIP0
     F            MMDENBP0                          KRENAMEMMSDFIP1       S01149
     FMMSDFALLIS  E           K        DISK         KINFSR INFSR
     F            MMSISIP0                          KRENAMEMMSDFAP0
     FMMSDFSLLIS  E           K        DISK         KINFSR INFSR
     F            MMSIVDP0                          KRENAMEMMSDFSP0
     FMMSDFZLLIS  E           K        DISK         KINFSR INFSR          S01149
     F            MMSISZP0                          KRENAMEMMSDFZP0       S01149
     FMMSDFYLLIS  E           K        DISK         KINFSR INFSR          S01149
     F            MMSIVYP0                          KRENAMEMMSDFYP0       S01149
     F/COPY WNCPYSRC,MM0175F001
     E/EJECT
      *
     E                    CPY@    1   1 80                                S01194
     E*
     E****ARRAY*FOR*DEAL*TYPE*-*LOANS                                     S01149
     E********************@NA     5   5  2                                S01149
     E**  ARRAY FOR DEAL TYPE - LOANS & NA'S                              S01149
     E***********         @NA    12  12  2                         S01149 CDL006
     E                    @NA    15  15  2               Add Fidu. dtyp   CDL006
     E**  ARRAY FOR DEAL TYPE - ALL N/A DEAL TYPES                        S01149
     E                    @ANYNA  7   7  2                                S01149
     E**  ARRAY FOR INTEREST BEARING N/A DEAL TYPES                       S01149
     E**********          @INA    4   4  2                         S01149 S01279
     E                    @INA    3   3  2                                S01279
     E*
     E****ARRAY*FOR*SR.*ZA0710*-*CUMULATIVE*DAYS*IN*YEAR*FOR*4*YEAR*PERIOD056095
     E***********         @YD     4   4  5 0A                             056095
     E*
     E****ARRAY*FOR*SR.*ZA0710*-*CUMULATIVE*DAYS*IN*YEAR*PER*MONTH*****   056095
     E***********         @MD    13  13  5 0A                             056095
     E*                                                                   056095
     E/COPY ZSRSRC,ZDATE9Z1                                               056095
     E**  Array for SR. ZDATE9                                            056095
     E*
     E**  ARRAY MONTH SHORT NAME
     E                    @MN        12  3
      *                                                           E14042
      **  Command for sending error messages, etc.                E14042
     E                    @CM     1   1 80                        E14042
     I*                                                           E14042
     I*
     I**  Rename fields to avoid confusion
     IMMSDFDP0
     I              HNDA38                          FDDA38
     I              HNVDYY                          FDVDYY
     I              HNVDMM                          FDVDMM
     I              HNVDDD                          FDVDDD
     I              HNDS38                          FDDS38
     I              HNDLTF                          FDDLTF
     I              HNDDLT                          FDDDLT
     I*
     I**  Rename common fields
     IMMDELDP0    01
     I              HKCCY                           CCCCY L2M4
     I              HKVDYY                          CCVDYYL1M3
     I              HKVDMM                          CCVDMML1M2
     I              HKVDDD                          CCVDDDL1M1
     I              HKTYPE                          CCTYPE
     I              HKAMNP                          CCAMNP                S01149
     I              HKICMT                          CCICMT                S01149
     I              HKINTR                          CCINTR                S01149
     I              HKRBSI                          CCRBSI                E20632
     I              HKDORM                          CCDORM                E20632
     I              HKDOPM                          CCDOPM                E20632
     I              HKRDFC                          CCRDFC                S01392
     I              HKFLID                          CCFLID                S01392
     I              HKFUID                          CCFUID                S01392
     I*
     I**  Rename common fields
     IMMDENBP0    02
     I              HLCCY                           CCCCY L2M4
     I              HLVDYY                          CCVDYYL1M3
     I              HLVDMM                          CCVDMML1M2
     I              HLVDDD                          CCVDDDL1M1
     I              HLTYPE                          CCTYPE
     I              HLAMNP                          CCAMNP                S01149
     I              HLRBSI                          CCRBSI                E20632
     I              HLDORM                          CCDORM                E20632
     I              HLDOPM                          CCDOPM                E20632
     I*                                                                   S01149
     I**  Rename common fields                                            S01149
     IMMDENSP0    10                                                      S01149
     I              HMCCY                           CCCCY L2M4            S01149
     I              HMVDYY                          CCVDYYL1M3            S01149
     I              HMVDMM                          CCVDMML1M2            S01149
     I              HMVDDD                          CCVDDDL1M1            S01149
     I              HMAMNP                          CCAMNP                S01149
     I              HMRBSI                          CCRBSI                E20632
     I              HMTYPE                          CCTYPE                E20632
     I              HMDORM                          CCDORM                E20632
     I*
     I**  Rename common fields
     IMMDEAMP0    07
     I              HNCCY                           CCCCY L2M4
     I              HNVDYY                          CCVDYYL1M3
     I              HNVDMM                          CCVDMML1M2
     I              HNVDDD                          CCVDDDL1M1
     I              HNTYPE                          CCTYPE
     I              HNAMNP                          CCAMNP                E20632
     I              HNDORM                          CCDORM                E20632
     I              HNDOPM                          CCDOPM                E20632
     I              HNOGDT                          CCOGDT                E20632
     I*
     I**  Rename common fields
     IMMSDFMP0    03
     I              HKCCY                           CCCCY L2M4
     I**********************************************HKMDYYL1M3            S01149
     I**********************************************HKMDMML1M2            S01149
     I**********************************************HKMDDDL1M1            S01149
     I              HKMDYY                          CCMDYYL1M3            S01149
     I              HKMDMM                          CCMDMML1M2            S01149
     I              HKMDDD                          CCMDDDL1M1            S01149
     I              HKNIYY                          CCNIYY                S01149
     I              HKNIMM                          CCNIMM                S01149
     I              HKNIDD                          CCNIDD                S01149
     I              HKTYPE                          CCTYPE
     I              HKVDYY                          CCVDYY
     I              HKVDMM                          CCVDMM
     I              HKVDDD                          CCVDDD
     I              HKAMNP                          CCAMNP                S01149
     I              HKICMT                          CCICMT                S01149
     I              HKINTR                          CCINTR                S01149
     I              HKRBSI                          CCRBSI                E20632
     I              HKDORM                          CCDORM                E20632
     I              HKDOPM                          CCDOPM                E20632
     I              HKRDFC                          CCRDFC                S01392
     I              HKFLID                          CCFLID                S01392
     I              HKFUID                          CCFUID                S01392
     I*                                                                   S01149
     I**  Rename common fields                                            S01149
     IMMSDFMP1    09                                                      S01149
     I              HLCCY                           CCCCY L2M4            S01149
     I              HLMDYY                          CCMDYYL1M3            S01149
     I              HLMDMM                          CCMDMML1M2            S01149
     I              HLMDDD                          CCMDDDL1M1            S01149
     I              HLTYPE                          CCTYPE                S01149
     I              HLLIYY                          CCSLYY                S01149
     I              HLLIMM                          CCSLMM                S01149
     I              HLLIDD                          CCSLDD                S01149
     I              HLNIYY                          CCNIYY                S01149
     I              HLNIMM                          CCNIMM                S01149
     I              HLNIDD                          CCNIDD                S01149
     I              HLFVAL                          CCAMNP                S01149
     I              HLICMT                          CCICMT                S01149
     I              HLFRAT                          CCINTR                S01149
     I              HLRBSI                          CCRBSI                E20632
     I              HLDORM                          CCDORM                E20632
     I              HLDOPM                          CCDOPM                E20632
     I              HLDCRT                          CCDCRT                S01279
     I*
     I**  Rename common fields
     IMMSDFIP0    04
     I              HKCCY                           CCCCY L2M4
     I**********************************************HKNIYYL1M3            S01149
     I**********************************************HKNIMML1M2            S01149
     I**********************************************HKNIDDL1M1            S01149
     I              HKNIYY                          CCNIYYL1M3            S01149
     I              HKNIMM                          CCNIMML1M2            S01149
     I              HKNIDD                          CCNIDDL1M1            S01149
     I              HKTYPE                          CCTYPE
     I              HKVDYY                          CCVDYY
     I              HKVDMM                          CCVDMM
     I              HKVDDD                          CCVDDD
     I              HKAMNP                          CCAMNP                S01149
     I              HKICMT                          CCICMT                S01149
     I              HKINTR                          CCINTR                S01149
     I              HKSLYY                          CCSLYY                S01149
     I              HKSLMM                          CCSLMM                S01149
     I              HKSLDD                          CCSLDD                S01149
     I              HKMDYY                          CCMDYY                E36024
     I              HKMDMM                          CCMDMM                E36024
     I              HKMDDD                          CCMDDD                E36024
     I              HKRBSI                          CCRBSI                E20632
     I              HKDORM                          CCDORM                E20632
     I              HKDOPM                          CCDOPM                E20632
     I*                                                                   S01149
     I**  Rename common fields                                            S01149
     IMMSDFIP1    08                                                      S01149
     I              HLCCY                           CCCCY L2M4            S01149
     I              HLNIYY                          CCNIYYL1M3            S01149
     I              HLNIMM                          CCNIMML1M2            S01149
     I              HLNIDD                          CCNIDDL1M1            S01149
     I              HLTYPE                          CCTYPE                S01149
     I              HLVDYY                          CCVDYY                S01149
     I              HLVDMM                          CCVDMM                S01149
     I              HLVDDD                          CCVDDD                S01149
     I              HLFVAL                          CCAMNP                S01149
     I              HLICMT                          CCICMT                S01149
     I              HLFRAT                          CCINTR                S01149
     I              HLLIYY                          CCSLYY                S01149
     I              HLLIMM                          CCSLMM                S01149
     I              HLLIDD                          CCSLDD                S01149
     I              HLRBSI                          CCRBSI                E20632
     I              HLDORM                          CCDORM                E20632
     I              HLDOPM                          CCDOPM                E20632
     I*
     I**  Rename common fields
     IMMSDFAP0    05
     I              HNCCY                           CCCCY L2M4
     I**********************************************HKMDYYL1M3            S01149
     I**********************************************HKMDMML1M2            S01149
     I**********************************************HKMDDDL1M1            S01149
     I              HKMDYY                          CCMDYYL1M3            S01149
     I              HKMDMM                          CCMDMML1M2            S01149
     I              HKMDDD                          CCMDDDL1M1            S01149
     I              HNTYPE                          CCTYPE
     I              HNVDYY                          CCVDYY
     I              HNVDMM                          CCVDMM
     I              HNVDDD                          CCVDDD
     I              HKSLYY                          CCSLYY                S01149
     I              HKSLMM                          CCSLMM                S01149
     I              HKSLDD                          CCSLDD                S01149
     I*
     I**  Rename common fields
     IMMSDFSP0    06
     I              HNCCY                           CCCCY L2M4
     I              HNVDYY                          CCVDYYL1M3
     I              HNVDMM                          CCVDMML1M2
     I              HNVDDD                          CCVDDDL1M1
     I              HNTYPE                          CCTYPE
     I              HKSLYY                          CCSLYY                S01149
     I              HKSLMM                          CCSLMM                S01149
     I              HKSLDD                          CCSLDD                S01149
     I*                                                                   S01149
     I**  Rename common fields                                            S01149
     IMMSDFZP0    11                                                      S01149
     I              HNCCY                           CCCCY L2M4            S01149
     I              HLMDYY                          CCMDYYL1M3            S01149
     I              HLMDMM                          CCMDMML1M2            S01149
     I              HLMDDD                          CCMDDDL1M1            S01149
     I              HNTYPE                          CCTYPE                S01149
     I              HNVDYY                          CCVDYY                S01149
     I              HNVDMM                          CCVDMM                S01149
     I              HNVDDD                          CCVDDD                S01149
     I              HLLIYY                          CCSLYY                S01149
     I              HLLIMM                          CCSLMM                S01149
     I              HLLIDD                          CCSLDD                S01149
     I              HLFVAL                          CCAMNP                S01149
     I              HLICMT                          CCICMT                S01149
     I              HLFRAT                          CCINTR                S01149
     I*                                                                   S01149
     I**  Rename common fields                                            S01149
     IMMSDFYP0    12                                                      S01149
     I              HNCCY                           CCCCY L2M4            S01149
     I              HNVDYY                          CCVDYYL1M3            S01149
     I              HNVDMM                          CCVDMML1M2            S01149
     I              HNVDDD                          CCVDDDL1M1            S01149
     I              HNTYPE                          CCTYPE                S01149
     I              HLLIYY                          CCSLYY                S01149
     I              HLLIMM                          CCSLMM                S01149
     I              HLLIDD                          CCSLDD                S01149
     I              HLFVAL                          CCAMNP                S01149
     I              HLICMT                          CCICMT                S01149
     I              HLFRAT                          CCINTR                S01149
     I*
     I** Set month shortnames up as an array
     IFDMNTHP0
     I              MNNM1                           @MN,1
     I              MNNM2                           @MN,2
     I              MNNM3                           @MN,3
     I              MNNM4                           @MN,4
     I              MNNM5                           @MN,5
     I              MNNM6                           @MN,6
     I              MNNM7                           @MN,7
     I              MNNM8                           @MN,8
     I              MNNM9                           @MN,9
     I              MNNM10                          @MN,10
     I              MNNM11                          @MN,11
     I              MNNM12                          @MN,12
     I/EJECT
     IPSDS       SDS
     I/COPY WNCPYSRC,MM0175I002
     I                                      201 208 @FILE
     I                                      244 253 @JOB
     I                                      254 263 @USER
     I*
     I********** UDS                                                                          CDL033
     ILDA         DS                            256                                           CDL033
     I**  Local data area for data base errors.
     I**  Field containing name of database file in error.
     I                                      134 141 DBFILE
     I**  Field containing key value causing database error.
     I                                      142 170 DBKEY
     I**  Field containing name of program causing database error.
     I                                      171 180 DBPGM
     I**  Field containing number of database error.
     I                                      181 183 DBASE
     I*
     I@UPDT       DS                              7
     I*
     I** Data structure to hold the time of update from MIDAS run date.
     I                                        1   20HSDLUP
     I                                        1   20HTDLUP
     I                                        1   20HVDLUP
     I                                        3   5 HSMLUP
     I                                        3   5 HTMLUP
     I                                        3   5 HVMLUP
     I                                        6   70HSYLUP
     I                                        6   70HTYLUP
     I                                        6   70HVYLUP
     I*
     I** Data structure to hold Maturity date
     I            DS
     I                                        1   80@MDTD
     I****************************************1   40HKMDYY                S01149
     I****************************************5   60HKMDMM                S01149
     I****************************************7   80HKMDDD                S01149
     I                                        1   40CCMDYY                S01149
     I                                        5   60CCMDMM                S01149
     I                                        7   80CCMDDD                S01149
     I*
     I** Data structure to hold Value date
     I            DS
     I                                        1   80@VDTD
     I                                        1   40CCVDYY
     I                                        5   60CCVDMM
     I                                        7   80CCVDDD
     I*
     I** Data structure to hold Next Interest payment date
     I            DS
     I                                        1   80@NIPD
     I****************************************1   40HKNIYY                S01149
     I****************************************5   60HKNIMM                S01149
     I****************************************7   80HKNIDD                S01149
     I                                        1   40CCNIYY                S01149
     I                                        5   60CCNIMM                S01149
     I                                        7   80CCNIDD                S01149
     I****DATA*STRUCTURE*FOR*SR.*ZA0680*-*DATE*INPUT*TO*SUBROUTINE*****   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DTIN                056095
     I***********                             1   40@@YYYY                056095
     I***********                             3   40@@YY                  056095
     I***********                             1   20@@CC                  056095
     I***********                             5   60@@MTH                 056095
     I***********                             7   80@@DAY                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDAT10Z1                                               056095
     I**  Data structure for SR. ZDAT10                                   056095
     I*                                                                   056095
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATA                056095
     I***********                             1   40@@YY1                 056095
     I***********                             5   60@@MM1                 056095
     I***********                             7   80@@DD1                 056095
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATB                056095
     I***********                             1   40@@YY2                 056095
     I***********                             5   60@@MM2                 056095
     I***********                             7   80@@DD2                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZINTDYZ1                                               056095
     I**  Data Structure for SR. ZINTDY                                   056095
     I*                                                                   056095
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@Z71Y**************   056095
     I*********** DS                                                      056095
     I***********                             1   40@@Z71Y                056095
     I***********                             1   10@@SSY1                056095
     I***********                             2   20@@SSY2                056095
     I***********                             3   30@@SSY3                056095
     I***********                             4   40@@SSY4                056095
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@VDT***************   056095
     I*********** DS                                                      056095
     I***********                             1   80@@VDT                 056095
     I***********                             1   40@@YR                  056095
     I***********                             5   60@@Z71M                056095
     I***********                             7   80@@Z71D                056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDATE9Z2                                               056095
     I**  Data structure for SR. ZDATE9                                   056095
     I*                                                                   056095
     I**  DATA STRUCTURE FOR RUNDATE
     I            DS
     I                                        1   7 RUNA
     I                                        1   20@RDD
     I                                        3   5 @RMM
     I                                        6   70@RYY
     I*
     I**  DATA STRUCTURE FOR SETTING UP DATES USED ON FILE UPDATES
     I            DS
     I                                        1   80@HNDAT
     I                                        1   40@VDYY
     I                                        5   60@VDMM
     I                                        7   80@VDDD
     I*
     I**  DATA STRUCTURE TO HOLD DEAL TRANSACTION DATE
     I            DS
     I                                        1   80HLDDAT
     I                                        1   40HLDTYY
     I                                        5   60HLDTMM
     I                                        7   80HLDTDD
     I*
     I**  DATA STRUCTURE TO HOLD START/LAST INTEREST DATE
     I            DS
     I                                        1   80@OSDAT
     I****************************************1   40HKSLYY                S01149
     I****************************************5   60HKSLMM                S01149
     I****************************************7   80HKSLDD                S01149
     I                                        1   40CCSLYY                S01149
     I                                        5   60CCSLMM                S01149
     I                                        7   80CCSLDD                S01149
     I*                                                                   S01149
     I** Data structure to hold Value date of sale                        S01149
     I            DS                                                      S01149
     I                                        1   80@SLDDT                S01149
     I                                        1   40HMVDYY                S01149
     I                                        5   60HMVDMM                S01149
     I                                        7   80HMVDDD                S01149
      *                                                                   E14042
     I** Data structure to hold Maturity date (Jap Sub-module processing) S01392
     I            DS                                                      S01392
     I                                        1   80@MATD                 S01392
     I                                        1   40HKMDYY                S01392
     I                                        5   60HKMDMM                S01392
     I                                        7   80HKMDDD                S01392
      *                                                                   E14042
      **  DATA STRUCTURE FOR SDSTAT                                       E14042
     I@STATS      DS                            256                       E14042
     I                                      102 102 @SUBMN                E14042
     I                                      103 103 @STRM2                E14042
     I*                                                                   S01194
     I/COPY WNCPYSRC,MM0175I001
     ISDBANK    E DSSDBANKPD                                              S01194
     I** DATA STRUCTURE FOR BANK DETAILS                                  S01194
     I*                                                                   S01194
     ISCSARD    E DSSCSARDPD                                              CDL006
      **  Data structure for Switchable Features file                     CDL006
      *                                                                   CDL006
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
     I**GENERAL*LEDGER*DETAILS*ACCESSED*VIA*ACCESS*PROGRAM*************            MD035545 MD047993
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                                   MD035545
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                                  MD035545
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* MAIN     - Main controlling routine.                          *
     C*                                                               *
     C* CALLS    #A       - Initial processing                        *
     C*          #B       - Determine which files to be updated       *
     C*          #C       - Termination processing                    *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C*
     C**  Initial processing.
     C**  Perform Initial process if RUNA is blank
     C/COPY WNCPYSRC,MM0175C019
     C           RUNA      IFEQ *BLANK                     B1
     C                     EXSR #A                         *1
     C                     END                             E1
     C*
     C**  Main processing
     C           *INU7     IFEQ '0'                        B1
     C           @TERM     ANDNE'T'                        *1
     C                     EXSR #B                         *1
     C                     END                             E1
     C*
     C**  Change of date processing                                       S01149
     CL1         RUNA      IFNE *BLANK                     B1             S01149
     CL1         @IGREC    ANDEQ'N'                        *1             S01149
     CL1                   EXSR #ZAA                       *1             S01149
     CL1                   END                             E1             S01149
     C*
     C**  Change of currency processing
     CL2         RUNA      IFNE *BLANK                     B1             S01149
     CL2         @IGREC    ANDEQ'N'                        *1             S01149
     CL2                   EXSR #BBIA                      *1
     CL2                   END                             *1             S01149
     C*
     C**  Termination processing
     CLR                   EXSR #C
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C* SUBROUTINES USED                                              *
     C*                                                               *
     C***01**#ZA******-*Set*up*running*totals*for*amounts**************   S01149
     C***02**#ZB******-*Set*up*running*totals*for*amounts**************   S01149
     C***03**#BBI*****-*Set*up*running*totals*for*amounts**************   S01149
     C*  01  #ZA      - Set up running totals - daily fwd book        *   S01149
     C*  02  #ZB      - Set up running totals - half monthly fwd book *   S01149
     C*  03  #BBI     - Set up running totals - total fwd book        *   S01149
     C*  04  #ZAA     - Write record to LF/MMFWUDLL                   *
     C*  05  #ZBA     - Write record to LF/MMFWUHLL                   *
     C*  06  #BBIA    - Write record to LF/MMFWUTLL                   *
     C*  07  #B       - Determine which files to be updated           *
     C*      #BA      - Calculate MM Fund in Nostro                   *   E20632
     C*  08  #BB      - Routine controlling updating sequence         *
     C*  09  #BBA     - Route program through update sequence         *
     C*  10  #BBAA    - Update forward book for value date details    *
     C***11**#BBAB****-*Update*fwd*book*for*next*intersest*date********   S01149
     C*  11  #BBAB    - Update fwd book for next interest date        *   S01149
     C*  12  #BBAC    - Update fwd book for maturity date             *
     C*  13  #BBC     - Update fwd book for SI deam                   *
     C*  14  #BBD     - Update LF/MMFWDTLL total funds lent info      *
     C*  15  #BBE     - Update LF/MMFWDTLL NA net value details       *   ME1350
     C***16**MM1007***-*Calc interest due at next interest date       *   E20634
     C*  16  MM1030   - Calc interest due at next interest date       *   E20634
     C***17**MM1009***-*Calculate*number*of*interest*days**************   056095
     C***18**ZA0710***-*Convert*a*day*number*to*a*date*****************   056095
     C*  17  ZINTDY   - Calculate number of interest days             *   056095
     C*  18  ZDATE9   - Convert a day number to a date                *   056095
     C*  19  #A       - Initial processing                            *
     C*  20  #C       - Termination processing                        *
     C***21**ZA0150***-*Access*LF/FDICDRLL*****************************   S01194
     C***22**ZA0680***-*Convert*a*date*to*day*number*form**************   056095
     C*  22  ZDAT10   - Convert a date to day number form             *   056095
     C*  23  *PSSR    - Error routine performed on program error      *
     C*  24  INFSR    - Error routine performed on file error         *
     C*                                                               *
     C* EXTERNAL ROUTINE                                              *
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZA      - Set up running totals for amounts                  *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BBAA  - Update forward book for value date details*
     C*            #BBAB  - Update fwd book for next interest date    *   S01149
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBC   - Update fwd book for SI deam               *
     C*                                                               *
     C* FLDS USED  @DCIN  - Daily cash in                             *
     C*            @DCOT  - Daily cash out                            *
     C*            @DNIM  - Daily net interest movement               *
     C*            @LDNA  - L/D N/A indicator                         *   S01149
     C*                                                               *
     C*  The calculation for obtaining a weighted average is:             S01279
     C*  New average rate, cash in =                                      S01279
     C*                                                                   S01279
     C*  (Current average * Current cash) + (Effective   * cash      )    S01279
     C*   rate, cash in     in at mdate      rate,cash in  in at mdate    S01279
     C*  -------------------------------------------------------------    S01279
     C*   (Current cash in at mdat + cash in at mdate, @MAIN)             S01279
     C*                                                                   S01279
     C*    ie. =  @WRK1 + @WRK2      in this coding.                      S01279
     C*           -------------                                           S01279
     C*               @WRK3                                               S01279
     C*                                                                   S01279
     C* note that Effective rate, @EFRT, is set to deal interest rate for S01279
     C* loans, deposits, cd's issued and primary cd's bought, to yield    S01279
     C* for other NA's bought and for NA's sold is set to yield/interest  S01279
     C* on the purchased NA.                                              S01279
     C*                                                                   S01279
     C** calculation for average rate cash out is similiar.               S01279
     C*                                                                   S01279
     C*****************************************************************
     C           #ZA       BEGSR
     C*
     C** Set up Cash in, Cash out, Net movement and Net int movement
     C** in Forward Book Daily Details record if L/D or in N/A store      S01149
     C** if deal is an N/A                                                S01149
     C           @LDNA     IFEQ 'LD'                       B1             S01149
     C                     Z-ADD*ZERO     HSFIXM           *1             S01149
     C                     ADD  @DCIN     HSDCIN           *1             S01149
     C                     ADD  @DCOT     HSDCOT           *1             S01149
     C           HSDCIN    SUB  HSDCOT    HSDNMT           *1             S01149
     C                     ADD  @DNIM     HSDNIM           *1             S01149
     C*                                                                   S01279
     C** Must accumulate average rate as a rate weighted by the principal S01279
     C*                                                                   S01279
     C           @MAIN     IFNE *ZERO                      B*2            S01279
     C*                                                                   S01279
     C** Could get divide by zero with deletes so check for it            S01279
     C           HSMAIN    ADD  @MAIN     @WRK3            **2            S01279
     C           @WRK3     IFNE *ZERO                      B**3           S01279
     C*                                                                   S01279
     C           @EFRT     MULT @MAIN     @WRK1            ***3           S01279
     C           HSAVIN    MULT HSMAIN    @WRK2            ***3           S01279
     C           @WRK1     ADD  @WRK2     @WRK1            ***3           S01279
     C           @WRK1     DIV  @WRK3     HSAVIN    H      ***3           S01279
     C                     ELSE                            X**3           S01279
     C                     Z-ADD*ZERO     HSAVIN           ***3           S01279
     C                     END                             E**3           S01279
     C*                                                                   S01279
     C                     ADD  @MAIN     HSMAIN           **2            S01279
     C                     END                             E*2            S01279
     C*                                                                   S01279
     C** and also for cash out                                            S01279
     C           @MAOT     IFNE *ZERO                      B*2            S01279
     C*                                                                   S01279
     C** Could get divide by zero with deletes so check for it            S01279
     C           HSMAOT    ADD  @MAOT     @WRK3            **2            S01279
     C           @WRK3     IFNE *ZERO                      B**3           S01279
     C*                                                                   S01279
     C           @EFRT     MULT @MAOT     @WRK1            ***3           S01279
     C           HSAVOT    MULT HSMAOT    @WRK2            ***3           S01279
     C           @WRK1     ADD  @WRK2     @WRK1            ***3           S01279
     C           @WRK1     DIV  @WRK3     HSAVOT    H      ***3           S01279
     C                     ELSE                            X**3           S01279
     C                     Z-ADD*ZERO     HSAVOT           ***3           S01279
     C                     END                             E**3           S01279
     C                     ADD  @MAOT     HSMAOT           **2            S01279
     C*                                                                   S01279
     C                     END                             E*2            S01279
      *                                                                   S01279
     C**  Set update file flag to 'Y' (FOR L/D)                           S01149
     C                     MOVE 'Y'       @LUPDD           *1             S01149
     C*                                                                   S01149
     C                     ELSE                            X1             S01149
     C                     ADD  @DCIN     @NDCIN           *1             S01149
     C                     ADD  @DCOT     @NDCOT           *1             S01149
     C           @NDCIN    SUB  @NDCOT    @NDNMT           *1             S01149
     C                     ADD  @DNIM     @NDNIM           *1             S01149
     C*                                                                   S01279
     C** Must accumulate average rate as a rate weighted by the principal S01279
     C*                                                                   S01279
     C           @MAIN     IFNE *ZERO                      B*2            S01279
     C*                                                                   S01279
     C** Could get divide by zero with deletes so check for it            S01279
     C           @NMAIN    ADD  @MAIN     @WRK3            **2            S01279
     C           @WRK3     IFNE *ZERO                      B**3           S01279
     C*                                                                   S01279
     C           @EFRT     MULT @MAIN     @WRK1            ***3           S01279
     C           @NAVIN    MULT @NMAIN    @WRK2            ***3           S01279
     C           @WRK1     ADD  @WRK2     @WRK1            ***3           S01279
     C           @WRK1     DIV  @WRK3     @NAVIN    H      ***3           S01279
     C                     ELSE                            X**3           S01279
     C                     Z-ADD*ZERO     @NAVIN           ***3           S01279
     C                     END                             E**3           S01279
     C*                                                                   S01279
     C                     ADD  @MAIN     @NMAIN           **2            S01279
     C                     END                             E*2            S01279
     C*                                                                   S01279
     C** and also for cash out                                            S01279
     C           @MAOT     IFNE *ZERO                      B*2            S01279
     C*                                                                   S01279
     C** Could get divide by zero with deletes so check for it            S01279
     C           @NMAOT    ADD  @MAOT     @WRK3            **2            S01279
     C           @WRK3     IFNE *ZERO                      B**3           S01279
     C*                                                                   S01279
     C           @EFRT     MULT @MAOT     @WRK1            ***3           S01279
     C           @NAVOT    MULT @NMAOT    @WRK2            ***3           S01279
     C           @WRK1     ADD  @WRK2     @WRK1            ***3           S01279
     C           @WRK1     DIV  @WRK3     @NAVOT    H      ***3           S01279
     C                     ELSE                            X**3           S01279
     C                     Z-ADD*ZERO     @NAVOT           ***3           S01279
     C                     END                             E**3           S01279
     C                     ADD  @MAOT     @NMAOT           **2            S01179
     C*                                                                   S01279
     C                     END                             E*2            S01279
     C*                                                                   S01279
     C**  Set update file flag to 'Y' (FOR N/A)            *1             S01149
     C                     MOVE 'Y'       @NUPDD           *1             S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C** Zeroise amount fields
     C                     Z-ADD0         @DCIN  150
     C                     Z-ADD0         @DCOT  150
     C                     Z-ADD0         @DNIM  150
     C                     Z-ADD0         @MAIN  150                      S01279
     C                     Z-ADD0         @MAOT  150                      S01279
     C                     Z-ADD0         @EFRT                           S01279
     C                     Z-ADD*ZERO     @WRK1  308                      S01279
     C                     Z-ADD*ZERO     @WRK2  308                      S01279
     C                     Z-ADD*ZERO     @WRK3  200                      S01279
     C*                                                                   S01149
     C****Set*update*file*flag*to*'Y'                                     S01149
     C*********************MOVE 'Y'       @UPDFD                          S01149
     C*
     C           #ZA9      ENDSR                           **#ZA9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZAA     - Write records on LF/MMFWUDLL                       *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  Main processing                                    *
     C*                                                               *
     C* FLDS USED  @USER  - Job user                                  *
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @DCIN  - Daily cash in                             *
     C*            @DCOT  - Daily cash out                            *
     C*            @DNIM  - Daily net interest movement               *
     C*                                                               *
     C*****************************************************************
     C           #ZAA      BEGSR
     C*
     C** If update file flag equal to 'Y', update forward book
     C***********@UPDFD    IFEQ 'Y'                        B1             S01149
     C           @LUPDD    IFEQ 'Y'                        B1             S01149
     C           @NUPDD    OREQ 'Y'                        *1             S01149
     C*
     C** Set up standard data
     C                     MOVE 'HS'      HSRCID           *1
     C                     TIME           HSTLUP           *1
     C                     MOVE 'I'       HSCHTP           *1
     C*********************Z-ADDRUND      HSLCD            *1             S01194
     C                     Z-ADDBJRDNB    HSLCD            *1             S01194
     C                     MOVEL@USER     HSLUID           *1
     C                     MOVE CCCCY     HSCCY            *1
     C                     MOVE @KDTYY    HSFBYY           *1
     C                     MOVE @KDTMM    HSFBMM           *1
     C                     MOVE @KDTDD    HSFBDD           *1
     C*                                                                   S01149
     C** If there is L/D data write record for L/D                        S01149
     C           @LUPDD    IFEQ 'Y'                        B*2            S01149
     C                     MOVE 'LD'      HSLDNA           **2            S01149
     C                     WRITEMMFWDDP0                   **2            S01149
     C                     MOVE 'N'       @LUPDD  1        **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** If there is N/A data write record for N/A                        S01149
     C           @NUPDD    IFEQ 'Y'                        B*2            S01149
     C                     Z-ADD0         HSFIXM           **2            S01149
     C                     Z-ADD@NDCIN    HSDCIN           **2            S01149
     C                     Z-ADD@NDCOT    HSDCOT           **2            S01149
     C                     Z-ADD@NDNMT    HSDNMT           **2            S01149
     C                     Z-ADD@NDNIM    HSDNIM           **2            S01149
     C                     Z-ADD@NMAIN    HSMAIN           **2            S01279
     C                     Z-ADD@NMAOT    HSMAOT           **2            S01279
     C                     Z-ADD@NAVIN    HSAVIN           **2            S01279
     C                     Z-ADD@NAVOT    HSAVOT           **2            S01279
      *                                                                   S01279
     C                     MOVE 'NA'      HSLDNA           **2            S01149
     C                     WRITEMMFWDDP0                   **2            S01149
     C                     MOVE 'N'       @NUPDD  1        **2            S01149
     C                     END                             E*2            S01149
     C*
     C** Zeroise amount fields
     C                     Z-ADD0         HSDCIN           *1
     C                     Z-ADD0         HSDCOT           *1
     C                     Z-ADD0         HSDNIM           *1             S01149
     C                     Z-ADD0         HSMAIN           *1             S01279
     C                     Z-ADD0         HSMAOT           *1             S01279
     C                     Z-ADD0         HSAVIN           *1             S01279
     C                     Z-ADD0         HSAVOT           *1             S01279
     C                     Z-ADD0         @NDCIN           *1             S01149
     C                     Z-ADD0         @NDCOT           *1             S01149
     C                     Z-ADD0         @NDNIM           *1             S01149
     C                     Z-ADD0         @NMAIN           *1             S01279
     C                     Z-ADD0         @NMAOT           *1             S01279
     C                     Z-ADD0         @NAVIN           *1             S01279
     C                     Z-ADD0         @NAVOT           *1             S01279
     C*                                                                   S01149
     C**  Reset update file flag to 'N'
     C*********************MOVE 'N'       @UPDFD  1        *1             S01149
     C*
     C**  Store previous year, month and half-month and currency
     C                     MOVE CCCCY     @PCCY            *1
     C                     Z-ADD@KDTYY    @PYY             *1
     C                     Z-ADD@KDTMM    @PMM             *1
     C*
     C** Set deal half month indicator to 01 if date is before the 15th
     C** of the month otherwise set to 02
     C           @KDTDD    IFLE 15                         B*2
     C                     Z-ADD1         @PHM    20       **2
     C                     ELSE                            X*2
     C                     Z-ADD2         @PHM             **2
     C                     END                             E*2
     C                     END                             E1             S01149
     C*
     C           #ZAA9     ENDSR                           **#ZAA9*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZB      - Set up running totals for amounts                  *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BBAA  - Update forward book for value date details*
     C*            #BBAB  - Update fwd book for next intersest date   *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBC   - Update fwd book for SI deam               *
     C*                                                               *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @VDHM  - Half month part of key on LF/MMFWUHLL     *
     C*            @HMCI  - Half month cash in                        *
     C*            @HMCO  - Half month cash out                       *
     C*            @HNIM  - Half month net interest movement          *
     C*            @PHM   - Previous half-month                       *
     C*            @LDNA  - L/D N/A indicator                         *   S01149
     C*                                                               *
     C*****************************************************************
     C           #ZB       BEGSR
     C*
     C** Set up Cash in, Cash out, Net movement and Net int movement
     C           @LDNA     IFEQ 'LD'                                      S01149
     C                     Z-ADD*ZERO     HTFIXM                          S01149
     C                     ADD  @HMCI     HTHMCI                          S01149
     C                     ADD  @HMCO     HTHMCO                          S01149
     C           HTHMCI    SUB  HTHMCO    HTHMNM                          S01149
     C                     ADD  @HNIM     HTHNIM                          S01149
     C**  Set update file flag to 'Y' (FOR L/D)                           S01149
     C                     MOVE 'Y'       @LUPDH                          S01149
     C                     ELSE                                           S01149
     C                     ADD  @HMCI     @NHMCI                          S01149
     C                     ADD  @HMCO     @NHMCO                          S01149
     C           @NHMCI    SUB  @NHMCO    @NHMNM                          S01149
     C                     ADD  @HNIM     @NHMIM                          S01149
     C**  Set update file flag to 'Y' (FOR N/A)                           S01149
     C                     MOVE 'Y'       @NUPDH                          S01149
     C                     END                                            S01149
     C*
     C** Zeroise amount fields
     C                     Z-ADD0         @HMCI  150
     C                     Z-ADD0         @HMCO  150
     C                     Z-ADD0         @HNIM  150
     C*                                                                   S01149
     C****Set*update*File*flag*to*'Y'                                     S01149
     C*********************MOVE 'Y'       @UPDFH                          S01149
     C*
     C           #ZB9      ENDSR                           **#ZB9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZBA     - Write records on LF/MMFWUHLL                       *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  Main processing                                    *
     C*                                                               *
     C* FLDS USED  @VDDD  - Date used in accessing forward book files *
     C*            @VDHM  - Half month part of key on LF/MMFWUHLL     *
     C*            @USER  - Job user                                  *
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @HMCI  - Half month cash in                        *
     C*            @HMCO  - Half month cash out                       *
     C*            @HNIM  - Half month net interest movement          *
     C*                                                               *
     C*****************************************************************
     C           #ZBA      BEGSR
     C*
     C** Set deal half month indicator to 01 if date is before the 15th
     C** of the month otherwise set to 02
     C           @KDTDD    IFLE 15                         B1             S01149
     C                     Z-ADD1         @KDTHM  20       *1             S01149
     C                     ELSE                            X1
     C                     Z-ADD2         @KDTHM           *1             S01149
     C                     END                             E1
     C*
     C** If update file flag equal to 'Y', update forward book
     C***********@UPDFH    IFEQ 'Y'                        B1             S01149
     C           @LUPDH    IFEQ 'Y'                        B1             S01149
     C           @NUPDH    OREQ 'Y'                        *1             S01149
     C*
     C**  Write record if year, month or half-month have changed
     C           @KDTYY    IFNE @PYY                       B*2
     C           @KDTMM    ORNE @PMM                       **2
     C           @KDTHM    ORNE @PHM                       **2
     C           CCCCY     ORNE @PCCY                      **2
     C           *INLR     OREQ '1'                        **2
     C*
     C                     MOVE 'HT'      HTRCID           **2
     C                     TIME           HTTLUP           **2
     C                     MOVE 'I'       HTCHTP           **2
     C*********************Z-ADDRUND      HTLCD            **2            SO1194
     C                     Z-ADDBJRDNB    HTLCD            **2            S01194
     C                     MOVEL@USER     HTLUID           **2
     C                     MOVE @PCCY     HTCCY            **2
     C                     Z-ADD@PYY      HTFBYY           **2
     C                     Z-ADD@PMM      HTFBMM           **2
     C                     Z-ADD@PHM      HTFBHM           **2
     C*                                                                   S01149
     C** If there is L/D data write record for L/D                        S01149
     C           @LUPDH    IFEQ 'Y'                        B**3           S01149
     C                     MOVE 'LD'      HTLDNA           ***3           S01149
     C                     WRITEMMFWDHP0                   ***3           S01149
     C                     MOVE 'N'       @LUPDH  1        ***3           S01149
     C                     END                             E**3           S01149
     C*                                                                   S01149
     C** If there is N/A data write record for N/A                        S01149
     C           @NUPDH    IFEQ 'Y'                        B**3           S01149
     C                     Z-ADD0         HTFIXM           ***3           S01149
     C                     Z-ADD@NHMCI    HTHMCI           ***3           S01149
     C                     Z-ADD@NHMCO    HTHMCO           ***3           S01149
     C                     Z-ADD@NHMNM    HTHMNM           ***3           S01149
     C                     Z-ADD@NHMIM    HTHNIM           ***3           S01149
     C                     MOVE 'NA'      HTLDNA           ***3           S01149
     C                     WRITEMMFWDHP0                   ***3           S01149
     C                     MOVE 'N'       @NUPDH  1        ***3           S01149
     C                     END                             E**3           S01149
     C*
     C** Zeroise amount fields
     C                     Z-ADD0         HTHMCI           **2
     C                     Z-ADD0         HTHMCO           **2
     C                     Z-ADD0         HTHNIM           **2
     C                     Z-ADD0         @NHMCI           **2            S01149
     C                     Z-ADD0         @NHMCO           **2            S01149
     C                     Z-ADD0         @NHMIM           **2            S01149
     C*
     C****Reset*update*file*flag*to*'N'                                   S01149
     C*********************MOVE 'N'       @UPDFH  1        **2            S01149
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #ZBA9     ENDSR                           **#ZB9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBI     - Set up running totals for amounts                  *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BB    - Routine controlling updating sequence     *
     C*                                                               *
     C* FLDS USED  @TFDL  - Total funds lent                          *
     C*            @TCIN  - Total cash in                             *
     C*            @TCOT  - Total cash out                            *
     C*            @NIMT  - Net interest movement                     *
     C*            @MMFN  - MM funds in nostro                        *
     C*            @LDNA  - L/D N/A indicator                         *   S01149
     C*                                                               *
     C*****************************************************************
     C           #BBI      BEGSR
     C*
     C** Set up Cash in, Cash out, Net movement and Net int movement
     C** in Forward Book Daily Details record if L/D or in N/A store      S01149
     C** if deal is an N/A                                                S01149
     C           @LDNA     IFEQ 'LD'                       B1             S01149
     C**  E20631 - Net Value(HVNSV) should only be updated for            E20631
     C**           NA deals.                                              E20631
     C**********           ADD  @NSNV     HVNSNV           *1      ME1350 E20631
     C                     ADD  @TFDL     HVTFDL           *1             S01149
     C                     ADD  @TCIN     HVTCIN           *1             S01149
     C                     ADD  @TCOT     HVTCOT           *1             S01149
     C**  E20634 - HVTCIN and HVTCOT is the total cash IN and OUT         E20634
     C**           for Both N/A and L/D                                   E20634
     C***********@TCIN     SUB  @TCOT     HVNCML           *1      E20634 092454
     C                     ADD  @TCIN     HVNCML           *1             092454
     C                     SUB  @TCOT     HVNCML           *1             092454
     C********** HVTCIN    SUB  HVTCOT    HVNCML           *1      S01149 E20634
     C                     ADD  @NIMT     HVNIML           *1             S01149
     C**  E20632 - BOTH L/D AND N/A DEALS CAN AFFECT THE FUND IN          E20632
     C**           NOSTRO.                                                E20632
     C**********           ADD  @MMFN     HVMMFN           *1      S01149 E20632
     C*                                                                   S01149
     C                     ELSE                            X1             S01149
      * Else is N/A purchase or sale                                      S01378
     C**  E20631 - @NSNV is the Net Value not Face Value                  E20631
     C**********           ADD  @NSNV     HVNSFV           *1      ME1350 E20631
     C                     ADD  @NSNV     HVNSNV           *1             E20631
     C                     ADD  @NSFV     HVNSFV           *1             E20631
     C**  E20634 - HVTCIN and HVTCOT is the total cash IN and OUT         E20634
     C**           for Both N/A and L/D                                   E20634
     C**********           ADD  @TCIN     @NTCIN           *1      S01149 E20634
     C**********           ADD  @TCOT     @NTCOT           *1      S01149 E20634
     C********** @NTCIN    SUB  @NTCOT    HVNCMN           *1      S01149 E20634
     C                     ADD  @TCIN     HVTCIN           *1             E20634
     C                     ADD  @TCOT     HVTCOT           *1             E20634
     C***********@TCIN     SUB  @TCOT     HVNCMN           *1      E20634 092454
     C                     ADD  @TCIN     HVNCMN           *1             092454
     C                     SUB  @TCOT     HVNCMN           *1             092454
     C                     ADD  @NIMT     HVNIMN           *1             S01149
     C                     END                             E1             S01149
     C*                                                                   E20632
     C                     ADD  @MMFN     HVMMFN                          E20632
     C*
     C** Zeroise amount fields
     C                     Z-ADD0         @NSFV  150                      E20631
     C                     Z-ADD0         @NSNV  150                      ME1350
     C                     Z-ADD0         @TFDL  150
     C                     Z-ADD0         @TCIN  150
     C                     Z-ADD0         @TCOT  150
     C                     Z-ADD0         @NIMT  150
     C                     Z-ADD0         @MMFN  150
     C*
     C           #BBI9     ENDSR                           **#BBI9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBIA    - Write records on LF/MMFWUTLL                       *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  Main processing                                    *
     C*                                                               *
     C* FLDS USED  @USER  - Job user                                  *
     C*            @TFDL  - Total funds lent                          *
     C*            @TCIN  - Total cash in                             *
     C*            @TCOT  - Total cash out                            *
     C*            @NIMT  - Net interest movement                     *
     C*            @MMFN  - MM funds in nostro                        *
     C*                                                               *
     C*****************************************************************
     C           #BBIA     BEGSR
     C*
     C                     MOVE 'HV'      HVRCID
     C                     TIME           HVTLUP
     C                     MOVE 'I'       HVCHTP
     C*********************Z-ADDRUND      HVLCD                           S01194
     C                     Z-ADDBJRDNB    HVLCD                           S01194
     C                     MOVEL@USER     HVLUID
     C                     MOVE CCCCY     HVCCY
     C*                                                                   S01149
     C                     WRITEMMFWDTP0
     C*
     C** Zeroise amount fields
     C                     Z-ADD0         HVNSNV                          ME1350
     C                     Z-ADD0         HVTFDL
     C                     Z-ADD0         HVTCIN
     C                     Z-ADD0         HVTCOT
     C*********************Z-ADD0         HVNIMT                          S01149
     C                     Z-ADD0         HVNIML                          S01149
     C                     Z-ADD0         HVMMFN
     C*********************Z-ADD0         HVCCPL                   ME2228 S01149
     C                     Z-ADD0         HVCPLL                   ME2228 S01149
     C                     Z-ADD0         HVCPLN                          ME2228
     C                     Z-ADD0         HVNSFV                          ME1350
     C**  E20634 - Zeroise Total Net Movement for L/D (HVNCML)            E20634
     C**           @NTCIN and @NTCOT are not being used.                  E20634
     C                     Z-ADD0         HVNCML                          E20634
     C                     Z-ADD0         HVNCMN                          S01149
     C**********           Z-ADD0         @NTCIN                   S01149 E20634
     C**********           Z-ADD0         @NTCOT                   S01149 E20634
     C                     Z-ADD0         HVNIMN                          S01149
     C*
     C           #BBIA9    ENDSR                           **#BBI9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #B       - Determine which files to be updated                *
     C*                                                               *
     C* CALLS    #BB      - Routine controlling updating sequence     *
     C*                                                               *
     C* CALLED BY  MAIN   - Main controlling routine.                 *
     C*                                                               *
     C* FLDS USED  @FMTY  - LF/MMSTDDLL format indicator              *
     C*            @LDNA  - L/D N/A indicator                         *   S01149
     C*                                                               *
     C*****************************************************************
     C           #B        BEGSR
     C*                                                                   S01149
     C** If the deal is for a N/A interest or N/A SI deam for start/      S01149
     C** last interest date and the sold indicator is set chain to the    S01149
     C** N/A sold record.                                                 S01149
      *                                                                   S01378
      ** If the N/A is not parcelled only need to check for a             S01378
      ** single related N/A sold trade.                                   S01378
     C                     MOVE 'N'       @IGREC  1                       S01149
     C*                                                                   S01149
     C           *IN08     IFEQ '1'                        B1             S01149
     C           HLSOLD    ANDEQ'Y'                        *1             E17654
     C           HLPCLI    ANDEQ*BLANKS                    *1             S01378
     C           *IN12     OREQ '1'                        *1             S01149
     C           HLSOLD    ANDEQ'Y'                        *1             S01149
     C           HLPCLI    ANDEQ*BLANKS                    *1             S01378
     C                     MOVE HLDADN    @DADN   60                      S01149
     C           @DADN     CHAINMMDEALLL             60    *1             S01149
     C*                                                                   S01149
     C** Record not found database error                                  S01149
     C           *IN60     IFEQ '1'                        B*2            S01149
     C                     MOVE '002'     DBASE            ***************S01149
     C                     MOVE 'MMDEALLL'DBFILE           *             *S01149
     C                     MOVE @DADN     DBKEY            * DB ERROR 002*S01149
     C                     MOVE '1'       *INU7            *             *S01149
     C                     MOVE '1'       *INU8            ***************S01149
     C                     MOVE '1'       *INLR            **2            S01149
     C                     GOTO #B9                        **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** If the interest date is after the value date of the sale         S01149
     C** don't process the current record read in through the cycle.      S01149
      ** b'cos the N/A is sold prior to any interest receipts.            S01378
     C           *IN08     IFEQ '1'                        B*2            S01149
     C           @SLDDT    ANDLE@NIPD                      **2            S01149
     C           *IN60     ANDEQ'0'                        **2            S01149
     C                     MOVE 'Y'       @IGREC           **2            S01149
     C                     GOTO #B9                        **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C           *IN12     IFEQ '1'                        B*2            S01149
     C           @SLDDT    ANDLE@VDTD                      **2            S01149
     C           *IN60     ANDEQ'0'                        **2            S01149
     C                     MOVE 'Y'       @IGREC           **2            S01149
     C                     GOTO #B9                        **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
      *                                                                   S01378
      ** If the N/A is parcelled it may have been sold by more than       S01378
      ** one related N/A sold trade. The interest amount may consist      S01378
      ** of interest accrued by a varying number of parcels over the      S01378
      ** period upto next period (eg if some parcels are sold before      S01378
      ** next interest settlement date). This would involve lots of       S01378
      ** complex calculation and since only the next interest payment     S01378
      ** is shown it is not worth it. For parcelled NA's the interest     S01378
      ** is always calculated as interest accrued on unsold parcels       S01378
      ** as at now (ie ignores forward valued sales which may be          S01378
      ** prior to next interest settlement date).                         S01378
      ** Note that fully sold parcelled NA's are checked for here.        S01378
      ** (ie. number not sold is zero)                                    S01378
     C           *IN08     IFEQ '1'                        B1             S01378
     C           HLPCLI    ANDEQ'P'                        *1             S01378
     C           HLNSDD    ANDEQ*ZERO                      *1             S01378
     C           *IN12     OREQ '1'                        *1             S01378
     C           HLPCLI    ANDEQ'P'                        *1             S01378
     C           HLNSDD    ANDEQ*ZERO                      *1             S01378
      *                                                                   S01378
     C                     MOVE 'Y'       @IGREC           *1             S01378
     C                     GOTO #B9                        *1             S01378
     C                     END                             E1             S01378
     C*                                                                   E28344
     C** Deam processing.                                                 E28344
     C** If an uncalled call/notice (has mdat = 0) has a deam - will get  E28344
     C** situation when the secondary file records all have key values    E28344
     C** lower than primary file key values. This means the secondary fileE28344
     C** *inds will be seton and primary file *inds will be setof. So mustE28344
     C** code for this, do not want to process current record in cycle.   E28344
     C           *IN05     IFEQ '1'                        B1             E28344
     C           *IN01     ANDEQ'0'                        *1             E28344
     C           *IN06     OREQ '1'                        *1             E28344
     C           *IN01     ANDEQ'0'                        *1             E28344
     C           *IN07     OREQ '1'                        *1             E28344
     C           *IN01     ANDEQ'0'                        *1             E28344
     C           *IN11     OREQ '1'                        *1             E28344
     C           *IN01     ANDEQ'0'                        *1             E28344
     C           *IN12     OREQ '1'                        *1             E28344
     C           *IN01     ANDEQ'0'                        *1             E28344
     C                     GOTO #B9                        *1             E28344
     C                     END                             E1             E28344
     C*                                                                   S01149
     C** Determine whether deal/deam is (or is for) a N/A or a L/D        S01149
     C           *IN05     IFEQ '1'                        B1             S01149
     C           *IN06     OREQ '1'                        *1             S01149
     C           *IN07     OREQ '1'                        *1             S01149
     C           *IN11     OREQ '1'                        *1             S01149
     C           *IN12     OREQ '1'                        *1             S01149
     C           HNOGDT    LOKUP@ANYNA,1                 60*1             S01149
     C*                                                                   S01149
     C** Deal amendments                                                  S01149
     C           *IN60     IFEQ '1'                        B*2            S01149
     C                     MOVE 'NA'      @LDNA   2        **2            S01149
     C                     ELSE                            X*2            S01149
     C                     MOVE 'LD'      @LDNA            **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** Deals                                                            S01149
     C                     ELSE                            X1             S01149
     C           *IN02     IFEQ '1'                        B*2            S01149
     C           *IN08     OREQ '1'                        **2            S01149
     C           *IN09     OREQ '1'                        **2            S01149
     C           *IN10     OREQ '1'                        **2            S01149
     C           *IN11     OREQ '1'                        **2            S01149
     C           *IN12     OREQ '1'                        **2            S01149
     C                     MOVE 'NA'      @LDNA            **2            S01149
     C                     ELSE                            X*2            S01149
     C                     MOVE 'LD'      @LDNA            **2            S01149
     C                     END                             **2            S01149
     C                     END                             *1             S01149
     C/COPY WNCPYSRC,MM0175C004
     C*
     C**  Set up key dates according to format read
     C           *IN01     IFEQ '1'                        B1
     C           *IN02     OREQ '1'                        *1
     C           *IN10     OREQ '1'                        *1             S01149
     C           *IN06     OREQ '1'                        *1
     C           *IN07     OREQ '1'                        *1
     C           *IN12     OREQ '1'                        *1             S01149
     C                     Z-ADDCCVDYY    @KDTYY  40       *1
     C                     Z-ADDCCVDMM    @KDTMM  20       *1
     C                     Z-ADDCCVDDD    @KDTDD  20       *1
     C                     END                             E1
     C*
     C           *IN03     IFEQ '1'                        B1
     C           *IN05     OREQ '1'                        *1
     C           *IN09     OREQ '1'                        *1             S01149
     C           *IN11     OREQ '1'                        *1             S01149
     C*********************Z-ADDHKMDYY    @KDTYY           *1             S01149
     C*********************Z-ADDHKMDMM    @KDTMM           *1             S01149
     C*********************Z-ADDHKMDDD    @KDTDD           *1             S01149
     C                     Z-ADDCCMDYY    @KDTYY           *1             S01149
     C                     Z-ADDCCMDMM    @KDTMM           *1             S01149
     C                     Z-ADDCCMDDD    @KDTDD           *1             S01149
     C                     END                             E1
     C*
     C           *IN04     IFEQ '1'                        B1
     C           *IN08     OREQ '1'                        *1             S01149
     C*********************Z-ADDHKNIYY    @KDTYY           *1             S01149
     C*********************Z-ADDHKNIMM    @KDTMM           *1             S01149
     C*********************Z-ADDHKNIDD    @KDTDD           *1             S01149
     C                     Z-ADDCCNIYY    @KDTYY           *1             S01149
     C                     Z-ADDCCNIMM    @KDTMM           *1             S01149
     C                     Z-ADDCCNIDD    @KDTDD           *1             S01149
     C                     END                             E1
     C*
     C**  Change of date processing                        B1
     C           *INL1     IFEQ '1'                        *1
     C                     EXSR #ZBA                       E1
     C                     END
     C*
     C**  Set up format indicator from record type
     C**  Set format type to 'L' if record read from formats
     C**  MMDELDP0, MMSDFMP0, MMSDFIP0
     C           *IN01     IFEQ '1'                        B1
     C           *IN03     OREQ '1'                        *1
     C           *IN04     OREQ '1'                        *1
     C                     MOVE 'L'       @FMTY   1        *1
     C                     END                             E1
     C*
     C****Set*format*type*to*'B'*if*record*read*from*format               S01149
     C****MMDENBP0**********                                              S01149
     C**  Set format type to 'N' if record read from format               S01149
     C**  MMDENBP0 or MMDENSP0.                                           S01149
     C           *IN02     IFEQ '1'                        B1
     C           *IN08     OREQ '1'                        *1             S01149
     C           *IN09     OREQ '1'                        *1             S01149
     C           *IN10     OREQ '1'                        *1             S01149
     C*********************MOVE 'B'       @FMTY            *1             S01149
     C                     MOVE 'N'       @FMTY            *1             S01149
     C                     END                             E1
     C*
     C**  Set format type to 'A' if record read from formats
     C**  MMSDFAP0, MMSDFSP0
     C           *IN05     IFEQ '1'                        B1
     C           *IN06     OREQ '1'                        B1
     C           *IN07     OREQ '1'                        B1
     C           *IN11     OREQ '1'                        B1             S01149
     C           *IN12     OREQ '1'                        B1             S01149
     C                     MOVE 'A'       @FMTY            *1
     C                     END                             E1
     C*
     C***If*processing*in*input*cycle*update*MM*funds*in*nostro******     FA0005
     C******     MPHAS     IFNE 'F'                        B1             FA0005
     C******               EXSR #BA                        *1             FA0005
     C******               END                             E1             FA0005
     C*
     C**  E20632 - Update MM Funds in Nostro using record from primary    E20632
     C**           file only.                                             E20632
     C*                                                                   E20632
     C** Convert value date to MIDAS day number format                    E20632
     C***********          Z-ADD@VDTD     @@DTIN                    E20632056095
     C***********          EXSR ZA0680                              E20632056095
     C***********          Z-ADD@@MDNO    CCDVSD  50                E20632056095
     C                     Z-ADD@VDTD     ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    CCDVSD  50                      056095
     C                     Z-ADD0         @MMFN  150                      E20632
     C*                                                                   E20632
     C           *IN01     IFEQ '1'                        B1             E20632
     C           *IN02     OREQ '1'                        B1             E20632
     C           *IN07     OREQ '1'                        B1             E20632
     C           *IN10     OREQ '1'                        B1             E20632
     C                     EXSR #BA                        *1             E20632
     C                     END                             E1             E20632
     C** Update fields other than MM funds in nostro
     C                     EXSR #BB
     C*
     C           #B9       ENDSR                           **#B9**
     C*****************************************************************
     C/EJECT                                                              E20632
     C*****************************************************************   E20632
     C*                                                               *   E20632
     C* #BA      - Calculate MM funds in Nostro                       *   E20632
     C*                                                               *   E20632
     C* CALLS             -                                           *   E20632
     C*                                                               *   E20632
     C* CALLED BY  #B                                                 *   E20632
     C*                                                               *   E20632
     C* FLDS USED  @MMFN  - MM funds in nostro                        *   E20632
     C*            @FMTY  - Record format indicator                   *   E20632
     C*            @PYRCV - Contains pay/receive instructions         *   E20632
     C*            @RUND  - MIDAS run Date number                     *   E20632
     C*                                                               *   E20632
     C*****************************************************************   E20632
     C           #BA       BEGSR                                          E20632
     C** For deam need only set up details for deam types PI & PD         E20632
     C           @FMTY     IFEQ 'A'                        B1             E20632
     C           CCTYPE    IFNE 'PI'                       B*2            E20632
     C           CCTYPE    ANDNE'PD'                       **2            E20632
     C                     GOTO #BA9                       **2            E20632
     C                     END                             E*2            E20632
     C                     END                             E1             E20632
     C** Need to check pay / receive method to determine whether          E20632
     C** settlement type is across a nostro. Whether pay or receive       E20632
     C** method is to be checked depends upon the deal type and hence     E20632
     C** whether funds are paid or received at deal value date.           E20632
     C*                                                                   E20632
     C** For deam need to check original deal type to determine whether   E20632
     C** pay or receive instructions should be checked.                   E20632
     C           @FMTY     IFEQ 'A'                        B1             E20632
     C*                                                                   E20632
     C           CCTYPE    IFEQ 'PI'                       B*2            E20632
     C           CCOGDT    IFEQ 'CT'                       B**3           E20632
     C                     MOVE CCDORM    @PYRCV  5        ***3           E20632
     C                     ELSE                            X**3           E20632
     C                     MOVE CCDOPM    @PYRCV           ***3           E20632
     C                     END                             E**3           E20632
     C*                                                                   E20632
     C                     ELSE                            X*2            E20632
     C           CCOGDT    IFEQ 'CT'                       B**3           E20632
     C                     MOVE CCDOPM    @PYRCV           ***3           E20632
     C                     ELSE                            X**3           E20632
     C                     MOVE CCDORM    @PYRCV           ***3           E20632
     C                     END                             E**3           E20632
     C                     END                             E*2            E20632
     C                     END                             E1             E20632
     C*                                                                   E20632
     C** Set up settlement instructions to be tested for deals.           E20632
     C           @FMTY     IFEQ 'N'                        B1             E20632
     C*                                                                   E20632
     C           CCRBSI    IFEQ 'B'                        B*2            E20632
     C                     MOVE CCDOPM    @PYRCV           **2            E20632
     C                     ELSE                            X*2            E20632
     C           CCRBSI    IFEQ 'S'                        B**3           E20632
     C                     MOVE CCDORM    @PYRCV           ***3           E20632
     C                     END                             E**3           E20632
     C                     END                             E*2            E20632
     C                     ELSE                            X1             E20632
     C           CCTYPE    IFEQ 'IP'                       B*2            E20632
     C           CDL006    OREQ 'Y'                                       CDL006
     C           CCTYPE    ANDEQ'FL'                                      CDL006
     C           CCTYPE    OREQ 'TL'                       **2            E20632
     C           CCTYPE    OREQ 'CP'                       **2            E20632
     C           CCTYPE    OREQ 'CL'                       **2            E20632
     C           CDL006    OREQ 'Y'                                       CDL006
     C           CCTYPE    ANDEQ'DP'                                      CDL006
     C           CDL006    OREQ 'Y'                                       CDL006
     C           CCTYPE    ANDEQ'LP'                                      CDL006
     C                     MOVE CCDOPM    @PYRCV           **2            E20632
     C                     ELSE                            X*2            E20632
     C                     MOVE CCDORM    @PYRCV           **2            E20632
     C                     END                             E*2            E20632
     C                     END                             E1             E20632
     C*                                                                   E20632
     C** If value date settlement instructions are through a nostro       E20632
     C** add deal amount to MM fund in nostro.                            E20632
     C           @PYRCV    IFEQ 'TELX '                    B1             E20632
     C           @PYRCV    OREQ 'CHIPS'                    B1             E20632
     C           @PYRCV    OREQ 'SWIFT'                    B1             E20632
     C           @PYRCV    OREQ 'CSENT'                    B1             E20632
     C           @PYRCV    OREQ 'CCOLL'                    B1             E20632
     C*                                                                   E20632
     C           CCDVSD    IFGT 0                          B*2            E20632
     C           CCDVSD    ANDLTBJRDNB                     B*2            E20632
     C                     ADD  CCAMNP    @MMFN  150       **2            E20632
     C                     END                             E*2            E20632
     C                     END                             E1             E20632
     C*                                                                   E20632
     C           #BA9      ENDSR                                          E20632
     C*****************************************************************   E20632
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BB      - Routine controlling updating sequence              *
     C*
     C* CALLS    #BBC     - Update fwd book for SI deam               *
     C*          #BBD     - Update LF/MMFWDTLL total funds lent info  *
     C*          #BBA     - Route program through update sequence     *
     C*          #BBI     - Write / update records on LF/MMFWUTLL     *
     C*          #BBE     - Update LF/MMFWDTLL NA net value details   *
     C*                                                               *
     C* CALLED BY  #B     - Determine which files to be updated       *
     C*                                                               *
     C* FLDS USED  @FMTY  - LF/MMSTDDLL format indicator              *
     C*            @DLTYP - Deal type ind - P = placing T = taking    *
     C*            @NA    - Array contains deal type of all placings  *
     C*                     and all N/A's                             *   S01149
     C*                                                               *
     C*****************************************************************
     C           #BB       BEGSR
     C*                                                                   S01149
     C** N/A Updates of forward books -                                   S01149
     C**                                                                  S01149
     C** 02 Value      Principal : Purchase price (-)                     S01149
     C** 08 Interest   Interest  : Calculated using Face Value & Face     S01149
     C**                           Rate from Start/Last Interest to       S01149
     C**                           Next Interest Date (+)                 S01149
     C**                           For parcelled NA's this is unsold      S01378
     C**                           Face Value amount as at now.           S01378
     C** 09 Maturity   If interest bearing -                              S01149
     C**               Principal : Face Value (+)                         S01149
     C**               Interest  : Calculated using Face Value & Face     S01149
     C**                           Rate from Start/Last Interest to       S01149
     C**                           Maturity Date (+)                      S01149
     C**                           For parcelled NA's this is unsold      S01378
     C**                           Face Value amount at maturity.         S01378
     C**               If non-interest bearing -                          S01149
     C**               Principal : Purchase price (+)                     S01149
     C**               Interest  : Calculated as Face Value less          S01149
     C**                           Purchase Price (+)                     S01149
     C**                           For parcelled NA's this is unsold      S01378
     C**                           Face Value and Purchase Price          S01378
     C**                           amounts at maturity.                   S01378
     C**               Both types averaged at Interest rate for Primary   S01279
     C**               CD's purchased and Yield type for all other NA's.  S01279
     C** 10 Sale       Principal : Sale Price of N/A (+)                  S01149
     C** 11 SI DEAM    Interest  : Calculated using Face Value & Face     S01149
     C**    - Maturity             Rate from Start/Last Interest to       S01149
     C**                           Maturity Date (-). This is to back     S01149
     C**                           out the interest from 09 if there      S01149
     C**                           is an interim SI deam.                 S01149
     C**                           For parcelled NA's this is unsold      S01378
     C**                           Face Value amount at maturity.         S01378
     C** 12 SI DEAM    Interest  : Calculated using Face Value & Face     S01149
     C**    - Interest             Rate from Start/Last Interest to       S01149
     C**                           Value Date of DEAM (+)                 S01149
     C**                           For parcelled NA's this is unsold      S01378
     C**                           Face Value amount as at now.           S01378
     C*                                                                   S01149
     C** If current deal is one which uses Face Value as the Princaple    S01149
     C** then sign it as negative to keep in line with L/D processing     S01149
      *                                                                   S01378
      ** NAB processesing for *IN09 and *IN11 require unsold amount at    S01378
      ** maturity date. If N/A is parcelled this may be less than         S01378
      ** the amount stored on the NAB because of forward valued sales.    S01378
      ** (DL0280/MM0101 reduce the NAB amounts for each sale as they      S01378
      ** reach their value date). Within #BBAC, #BBD, #BBC the amounts    S01378
      ** are reduced to include forward sales and give maturity values.   S01378
      ** NAB processesing for *IN12 and *IN08 for interest always         S01378
      ** calculates interest using unsold portions as at now.             S01378
      *                                                                   S01378
     C           *IN09     IFEQ '1'                        B1             S01149
     C           *IN11     OREQ '1'                        *1             S01149
     C           *IN12     OREQ '1'                        *1             S01149
     C                     Z-SUBCCAMNP    CCAMNP           *1             S01149
     C                     END                                            S01149
     C*                                                                   S01149
     C** If N/A maturity date record has been read determine if it        S01149
     C** is interest bearing.                                             S01149
     C                     MOVE 'N'       @NINA                           S01149
     C           *IN09     IFEQ '1'                        B1             S01149
     C           CCTYPE    LOKUP@INA,1                   60*1             S01149
     C           *IN60     IFEQ '0'                        B*2            S01149
     C*                                                                   S01149
     c** N/A is non-interest bearing therefore the purchase               S01149
     C** price of the L/D should be used as the princaple rather than     S01149
     C** the face value -                                                 S01149
      ** CCAMNP is renamed HLFVAL (from NA bought) from format MMSDFMP1   S01378
     C                     Z-ADDCCAMNP    @FVAL            **2            S01149
     C                     Z-ADDHLAMNP    CCAMNP           **2            S01149
     C                     MOVE 'Y'       @NINA   1        **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C** E20632 - Date conversion is done in subroutine #B                E20632
     C** Convert value date to MIDAS day number format
     C**********           Z-ADD@VDTD     @@DTIN                          E20632
     C**********           EXSR ZA0680                                    E20632
     C**********           Z-ADD@@MDNO    CCDVSD  50                      E20632
     C*
     C** Check which record format is processed
     C** If record format is STANDARD DEAL AMENDMENT format or DEAM
     C** format
     C           *IN05     IFEQ '1'                        B1
     C           *IN06     OREQ '1'                        *1
     C           *IN07     OREQ '1'                        *1
     C           *IN11     OREQ '1'                        *1             S01149
     C           *IN12     OREQ '1'                        *1             S01149
     C*
     C** If Deam type is 'SI'
     C           CCTYPE    IFEQ 'SI'                       B*2
     C                     EXSR #BBC                       **2
     C                     END                             E*2
     C*
     C** If Deam type is 'PI' OR 'PD'
     C           CCTYPE    IFEQ 'PI'                       B*2
     C           CCTYPE    OREQ 'PD'                       **2
     C                     EXSR #BBD                       **2
     C                     END                             E*2
     C*
     C** Record format is STANDARD DEALS - NA Sold, NA Bought
     C** OR Loans/Deposit/CD Issued
     C*
     C                     ELSE                            X1
     C*
     C***If*DEAL*TYPE is 'IT' OR 'TD' OR 'CI'                             CDL006
      ** If deal type is 'IT' or 'TD' or 'CI' or 'FT'                     CDL006
      *                                                                   CDL006
     C                     MOVE *BLANK    @DLTYP           *1
     C           CCTYPE    IFEQ 'IT'                       B*2
     C           CCTYPE    OREQ 'TD'                       **2
     C           CDL006    OREQ 'Y'                                       CDL006
     C           CCTYPE    ANDEQ'FT'                                      CDL006
     C           CCTYPE    OREQ 'CI'                       **2            ME2162
     C           @FMTY     OREQ 'N'                        **2            S01149
     C           CCRBSI    ANDEQ'S'                        **2            E20634
     C/COPY WNCPYSRC,MM0175C018
     C           CCTYPE    OREQ 'CF'                                                          CDL033
     C           CDL033    ANDEQ'Y'                                                           CDL033
     C                     MOVE 'T'       @DLTYP  1        **2
     C                     END                             E*2
     C*
     C***If*DEAL*TYPE is 'IP','TL' OR 'CL'                                CDL006
      ** If deal type is 'IP','TL','CL','FL','DP',or 'LP'                 CDL006
      ** or NA bought                                                     S01378
     C           CCTYPE    IFEQ 'IP'                       B*2
     C           CDL006    OREQ 'Y'                                       CDL006
     C           CCTYPE    ANDEQ'FL'                                      CDL006
     C           CCTYPE    OREQ 'TL'                       **2
     C           CCTYPE    OREQ 'CL'                       **2
     C           CDL006    OREQ 'Y'                                       CDL006
     C           CCTYPE    ANDEQ'DP'                                      CDL006
     C           CDL006    OREQ 'Y'                                       CDL006
     C           CCTYPE    ANDEQ'LP'                                      CDL006
     C*******    CCTYPE    OREQ 'CI'                       **2            ME2162
     C           @FMTY     OREQ 'N'                        **2            S01149
     C           CCRBSI    ANDEQ'B'                        **2            E20634
     C                     MOVE 'P'       @DLTYP           **2
     C                     END                             E*2
     C*
     C***If*deal*type one of IT TD IP TL CI CL perform update routine     CDL006
      ** If deal type one of IT TD IP TL CI CL FT FL DP LP perform up     CDL006
      ** date routine                                                     CDL006
      ** or NA bought                                                     S01378
     C           @DLTYP    IFNE *BLANK                     B*2
     C                     EXSR #BBA                       **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C***If*DEAL*TYPE*is*'IP',*'TL',*'CP',*'CL',*'DL',*update             S01149
     C***total*funds*lent                                                 S01149
     C** If DEAL TYPE is a loan or a N/A then update total funds lent     S01149
     C           CCTYPE    LOKUP@NA,1                    60
     C           *IN60     IFEQ '1'                        B1
     C                     EXSR #BBD                       *1
     C                     END                             E1
     C*
     C***If*NA*Bought*update*total*funds*lent*and*NA*net*value            S01149
     C** If NA update total funds lent and NA net value                   S01149
     C***********@FMTY     IFEQ 'B'                        B1             S01149
     C           *IN02     IFEQ '1'                        B1             S01149
     C*********************EXSR #BBD                       *1             S01149
     C                     EXSR #BBE                       *1             ME1350
     C                     END                             E1
     C/COPY WNCPYSRC,MM0175C017
     C*
     C** Update totals file
     C                     EXSR #BBI
     C*
     C           #BB9      ENDSR                           **#BB9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBA     - Route program through update sequence              *
     C*                                                               *
     C* CALLS    #BBAA    - Update forward book for value date details*
     C*          #BBAB    - Update fwd book for next intersest date   *
     C*          #BBAC    - Update fwd book for maturity date         *
     C*                                                               *
     C* CALLED BY  #BB    - Routine controlling updating sequence     *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #BBA      BEGSR
     C*
     C** Update forward book for deal value date
     C           *IN01     IFEQ '1'                        B1
     C           *IN02     OREQ '1'                        *1             S01149
     C           *IN10     OREQ '1'                        *1             S01149
     C                     EXSR #BBAA                      *1
     C                     END                             E1
     C*
     C** Update forward book for next interest date
     C           *IN04     IFEQ '1'                        B1
     C           *IN08     OREQ '1'                        *1             S01149
     C                     EXSR #BBAB                      *1
     C                     END                             E1
     C*
     C** Update forward book for maturity date
     C           *IN03     IFEQ '1'                        B1
     C           *IN09     OREQ '1'                        *1             S01149
     C                     EXSR #BBAC                      *1
     C                     END                             E1
     C*
     C           #BBA9     ENDSR                           **#BBA9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBAA    - Update forward book for value date details         *
     C*                                                               *
     C* CALLS    #ZA      - Set up running totals for amounts         *
     C*          #ZB      - Set up running totals for amounts         *
     C*                                                               *
     C* CALLED BY  #BBA   - Route program through update sequence     *
     C*                                                               *
     C* FLDS USED  @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @DLTYP - Deal type ind - P = placing T = taking    *
     C*            @DCIN  - Daily cash in                             *
     C*            @HMCI  - Half month cash in                        *
     C*            @TCIN  - Total cash in                             *
     C*            @DCOT  - Daily cash out                            *
     C*            @HMCO  - Half month cash out                       *
     C*            @TCOT  - Total cash out                            *
     C*                                                               *
     C*****************************************************************
     C           #BBAA     BEGSR
     C*
     C** Set up key to Forward books MMFWUDLL, MMFWUHLL & MMFWUTLL
     C                     Z-ADDCCVDYY    @VDYY
     C                     Z-ADDCCVDMM    @VDMM
     C                     Z-ADDCCVDDD    @VDDD
     C*
     C** If deal valued date greater than run date update forward
     C** book with start details
     C***********CCDVSD    IFGE RUND                       B1             S01194
     C           CCDVSD    IFGE BJRDNB                     B1             S01194
     C*
     C** Add values into book
     C*
     C** If deal type is deposit/taking update cash in ....
     C           @DLTYP    IFEQ 'T'                        B*2
     C*********************Z-ADDHKAMNP    @DCIN            **2            S01149
     C*********************Z-ADDHKAMNP    @HMCI            **2            S01149
     C*********************ADD  HKAMNP    @TCIN            **2            S01149
     C                     Z-ADDCCAMNP    @DCIN            **2            S01149
     C                     Z-ADDCCAMNP    @HMCI            **2            S01149
     C                     ADD  CCAMNP    @TCIN            **2            S01149
     C*
     C** ...otherwise if loan/placin update cash out.
     C                     ELSE                            X*2
     C*********************Z-SUBHKAMNP    @DCOT            **2            S01149
     C*********************Z-SUBHKAMNP    @HMCO            **2            S01149
     C*********************SUB  HKAMNP    @TCOT            **2            S01149
     C                     Z-SUBCCAMNP    @DCOT            **2            S01149
     C                     Z-SUBCCAMNP    @HMCO            **2            S01149
     C                     SUB  CCAMNP    @TCOT            **2            S01149
     C                     END                             E*2
     C*
     C** PROCESSING FOR JAPANESE SUB-MODULE (Front-up Interest)           S01392
     C*                                                                   S01392
     C** If Front up Interest indicator on interest is added/deducted     S01392
     C** at value date into book.                                         S01392
     C           CCFUID    IFEQ 'Y'                        B*2            S01392
     C***********          Z-ADDCCDVSD    @@BEG            **2      S01392056095
     C                     Z-ADDCCDVSD    ZZBEG            **2            056095
     C*                                                                   S01392
     C** Convert maturity date to MIDAS day number format                 S01392
     C***********          Z-ADD@MATD     @@DTIN           **2      S01392056095
     C***********          EXSR ZA0680                     **2      S01392056095
     C***********          Z-ADD@@MDNO    CCMATD           **2      S01392056095
     C                     Z-ADD@MATD     ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    CCMATD           **2            056095
     C*                                                                   S01392
     C***********          Z-ADDCCMATD    @@END            **2      S01392056095
     C***********          MOVE CCICMT    @@CALC           **2      S01392056095
     C                     Z-ADDCCMATD    ZZEND            **2            056095
     C                     MOVE CCICMT    ZZCALC           **2            056095
     C                     Z-ADDCCAMNP    @@AMT            **2            S01392
     C                     Z-ADDCCINTR    @@RATE           **2            S01392
     C*                                                                   S01392
     C** If First & Last Day Interest indicator on add an extra           S01392
     C** day's interest.                                                  S01392
     C           CCFLID    IFEQ 'Y'                        B**3           S01392
     C***********          ADD  1         @@END            ***3     S01392056095
     C                     ADD  1         ZZEND            ***3           056095
     C                     END                             E**3           S01392
     C*                                                                   S01392
     C                     MOVE CCRDFC    @@RDFC  1        **2            S01392
     C/COPY WNCPYSRC,MM0175C005
     C                     EXSR MM1030                     **2            S01392
     C/COPY WNCPYSRC,MM0175C006
     C                     MULT 10        @@INTR           **2            S01392
     C*                                                                   S01392
     C                     Z-SUB@@INTR    @DNIM            **2            S01392
     C                     DIV  10        @@INTR    H      **2            S01392
     C                     Z-SUB@@INTR    @HNIM            **2            S01392
     C                     SUB  @@INTR    @NIMT            **2            S01392
     C                     END                             E*2            S01392
     C*                                                                   S01392
     C** Perform file updating procedures.
     C                     EXSR #ZA                        *1
     C                     EXSR #ZB                        *1
     C                     END                             E1
     C*
     C           #BBAA9    ENDSR                           **#BBAA9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBAB    - Update fwd book for next interest date             *
     C*                                                               *
     C**CALLS****MM1007***- Calc interest due at next interest date   *   E20634
     C* CALLS    MM1030   - Calc interest due at next interest date   *   E20634
     C*          #ZA      - Write / update records on LF/MMFWUDLL     *
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *
     C***********ZA0680***-*Convert*a*date*to*day*number*form**********   056095
     C*          ZDAT10   - Convert a date to day number form         *   056095
     C*                                                               *
     C* CALLED BY  #BBA   - Route program through update sequence     *
     C*                                                               *
     C* FLDS USED  @NIPD  - DS contains next int payment date         *
     C*            @HNDAT - Data structure to format date as YYYYMMDD *
     C*            @RUNDT - Run date as YYYYMMDD format               *
     C*            @MDTD  - DS contains maturity date                 *
     C*************@@BEG**-*Beginning*of*interest*period***************   056095
     C*************@@END**-*End*of*interest*period*********************   056095
     C*************@@CALC*-*Interest*calculation*method****************   056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *
     C*            @@RATE - Deal interest rate                        *
     C*            @@INTR - Amount of interest due                    *
     C*            @DNIM  - Daily net interest movement               *
     C*            @HNIM  - Half month net interest movement          *
     C*            @NIMT  - Net interest movement                     *
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680****   056095
     C*************@@MDNO*-*MIDAS*day*number***************************   056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*            @@RDFC - Round down interest indicator             *   S01392
     C*                                                               *
     C*****************************************************************
     C           #BBAB     BEGSR
     C*
     C** If next interest payment date entered calculate interest at
     C** next interest payment date and update files.
     C                     Z-ADD@NIPD     @HNDAT
     C*
     C** Convert next interest payment date to MIDAS day number format
     C***********          Z-ADD@NIPD     @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********          Z-ADD@@MDNO    CCNIPD  50                      056095
     C                     Z-ADD@NIPD     ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    CCNIPD  50                      056095
     C*
     C** Convert start/last interest date to MIDAS day number format
     C***********          Z-ADD@OSDAT    @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********          Z-ADD@@MDNO    CCSLID  50                      056095
     C                     Z-ADD@OSDAT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    CCSLID  50                      056095
     C*
     C** Calculate interest at next interest date.
     C           @NIPD     IFGE @RUNDT                     B1
     C           @NIPD     ANDLT@MDTD                      *1
     C***********          Z-ADDCCSLID    @@BEG            *1             056095
     C***********          Z-ADDCCNIPD    @@END            *1             056095
     C*********************MOVE HKICMT    @@CALC           *1             S01149
     C*********************Z-ADDHKAMNP    @@AMT  150       *1             S01149
     C*********************Z-ADDHKINTR    @@RATE 117       *1             S01149
     C***********          MOVE CCICMT    @@CALC           *1       S01149056095
     C                     Z-ADDCCSLID    ZZBEG            *1             056095
     C                     Z-ADDCCNIPD    ZZEND            *1             056095
     C                     MOVE CCICMT    ZZCALC           *1             056095
     C                     Z-ADDCCAMNP    @@AMT  150       *1             S01149
     C                     Z-ADDCCINTR    @@RATE 117       *1             S01149
     C**********           EXSR MM1007                     *1             E20634
     C/COPY WNCPYSRC,MM0175C007
     C                     EXSR MM1030                     *1             E20634
     C/COPY WNCPYSRC,MM0175C008
     C                     MULT 10        @@INTR           *1             E20634
     C*
     C** Add interest into book.
     C                     Z-SUB@@INTR    @DNIM            *1
     C                     DIV  10        @@INTR    H      ME2111
     C                     Z-SUB@@INTR    @HNIM            *1
     C                     SUB  @@INTR    @NIMT            *1
     C*
     C** Update forward book details.
     C                     EXSR #ZA                        *1
     C                     EXSR #ZB                        *1
     C                     END                             E1
     C*
     C           #BBAB9    ENDSR                           **#BBAB9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBAC    - Update fwd book for maturity date                  *
     C*                                                               *
     C* CALLS    #ZA      - Write / update records on LF/MMFWUDLL     *
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *
     C***********MM1007***-*Calc interest due at next interest date   *   E20634
     C*          MM1030   - Calc interest due at next interest date   *   E20634
     C***********ZA0680***-*Convert*a*date*to*day*number*form**********   056095
     C*          ZDAT10   - Convert a date to day number form         *   056095
     C*                                                               *
     C* CALLED BY  #BBA   - Route program through update sequence     *
     C*                                                               *
     C* FLDS USED  @MDTD  - DS contains maturity date                 *
     C*            @RUNDT - Run date as YYYYMMDD format               *
     C*            @DLTYP - Deal type ind - P = placing T = taking    *
     C*            @DCOT  - Daily cash out                            *
     C*            @HMCO  - Half month cash out                       *
     C*            @TCOT  - Total cash out                            *
     C*            @DCIN  - Daily cash in                             *
     C*            @HMCI  - Half month cash in                        *
     C*            @TCIN  - Total cash in                             *
     C*            @HNDAT - Data structure to format date as YYYYMMDD *
     C*            @NIPD  - DS contains next int payment date         *
     C*************@@BEG**-*Beginning*of*interest*period***************   056095
     C*************@@END**-*End*of*interest*period*********************   056095
     C*************@@CALC*-*Interest*calculation*method****************   056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *
     C*            @@RATE - Deal interest rate                        *
     C*            @@INTR - Amount of interest due                    *
     C*            @DNIM  - Daily net interest movement               *
     C*            @HNIM  - Half month net interest movement          *
     C*            @NIMT  - Net interest movement                     *
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680****   056095
     C*************@@MDNO*-*MIDAS*day*number***************************   056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @DMDVS - Deam value date as MIDAS day number       *
     C*            @@RDFC - Round down interest indicator             *   S01392
     C*                                                               *
     C*****************************************************************
     C           #BBAC     BEGSR
      *                                                                   S01378
      ** For Maturity date processing of NA's bought (*IN09) where        S01378
      ** the N/A is parcelled need amounts relating to the unsold         S01378
      ** portion remaining at mdat. DL0280/MM0101 reduce face value,      S01378
      ** parcel size, HLNSLD etc. on NAB as each sale reaches its         S01378
      ** value date but we must consider all forward valued sales         S01378
      ** for this maturity date processing (if there are any).            S01378
      ** These fields are used by *IN09 processing in #BBAC, #BBD.        S01378
     C           HLPCLI    IFEQ 'P'                        B1             S01378
     C           *IN09     ANDEQ'1'                        B1             S01378
     C           HLNSLD    ANDNE*ZERO                      B1             S01378
      *                                                                   S01378
     C           CCAMNP    DIV  HLPSZE    @WRK      H      *1             S01378
     C           @WRK      MULT HLNSLD    @WRK             *1             S01378
     C           CCAMNP    SUB  @WRK      CCAMNP           *1             S01378
      *                                                                   S01378
     C           @FVAL     DIV  HLPSZE    @WRK      H      *1             S01378
     C           @WRK      MULT HLNSLD    @WRK             *1             S01378
     C           @FVAL     SUB  @WRK      @FVAL            *1             S01378
     C                     END                             E1             S01378
     C*
     C** First update amounts at maturity.
     C           @MDTD     IFGE @RUNDT                     B1
     C*
     C** Add values into book
     C*
     C** If deal type is deposit/taking update cash in ....
     C           @DLTYP    IFEQ 'T'                        B*2
     C*********************Z-ADDHKAMNP    @DCOT            **2            S01149
     C*********************Z-ADDHKAMNP    @HMCO            **2            S01149
     C*********************ADD  HKAMNP    @TCOT            **2            S01149
     C**********           Z-ADDCCAMNP    @DCOT            **2     S01149 S01279
     C                     Z-ADDCCAMNP    @MAOT            **2            S01279
     C                     Z-ADDCCAMNP    @HMCO            **2            S01149
     C                     ADD  CCAMNP    @TCOT            **2            S01149
     C*
     C** ...otherwise if loan/placing update cash out.
     C                     ELSE                            X*2
     C*********************Z-SUBHKAMNP    @DCIN            **2            S01149
     C*********************Z-SUBHKAMNP    @HMCI            **2            S01149
     C*********************SUB  HKAMNP    @TCIN            **2            S01149
     C**********           Z-SUBCCAMNP    @DCIN            **2     S01149 S01279
     C                     Z-SUBCCAMNP    @MAIN            **2            S01279
     C                     Z-SUBCCAMNP    @HMCI            **2            S01149
     C                     SUB  CCAMNP    @TCIN            **2            S01149
     C                     END                             E*2
     C*
     C** Set up effective rate, used for average rate calc.               S01279
     C           @FMTY     IFEQ 'N'                        B*2            S01279
     C** For primary CD's use interest rate, else use yield               S01279
     C** (BO = BP, BI = BD)                                               S01279
     C           CCTYPE    IFEQ 'C1'                       B**3           S01279
     C           CCTYPE    OREQ 'C2'                       B**3           S01279
     C           CCTYPE    OREQ 'BO'                       B**3           S01279
     C           CCTYPE    OREQ 'BI'                       B**3           S01279
     C                     Z-ADDHLINTR    @EFRT            ***3           S01279
     C                     ELSE                            X**3           S01279
     C                     Z-ADDCCDCRT    @EFRT            ***3           S01279
     C                     END                             E**3           S01279
     C*                                                                   S01279
     C** Else a loan/deposit                                              S01279
     C                     ELSE                            X*2            S01279
     C                     Z-ADDCCINTR    @EFRT            **2            S01279
     C                     END                             E*2            S01279
     C*                                                                   S01279
     C** Perform file updating procedures.
     C                     Z-ADD@MDTD     @HNDAT           *1
     C                     EXSR #ZA                        *1
     C                     EXSR #ZB                        *1
     C                     END                             E1
     C*
     C** Convert maturity date to MIDAS day number format
     C***********          Z-ADD@MDTD     @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********          Z-ADD@@MDNO    CCMATD  50                      056095
     C                     Z-ADD@MDTD     ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    CCMATD  50                      056095
     C*
     C***If*next*interest*payment*date*is*greater*than*zero*update        S01149
     C***maturity*date*details*with*next*interest*amount                  S01149
     C** If next interest payment date is greater than zero and deal      S01149
     C** is not a non-interest bearing N/A or an N/A sold then update     S01149
     C** maturity date details with next interest amount                  S01149
     C           @NIPD     IFGE @RUNDT                     B1
     C           @NIPD     ANDGE@MDTD                      *1
     C           @NINA     ANDEQ'N'                        *1             S01149
     C                     Z-ADD@MDTD     @HNDAT           *1
     C*
     C** Calc interest amount to be added into book at maturity date
     C***********          Z-ADDCCSLID    @@BEG            *1             056095
     C***********          Z-ADDCCMATD    @@END            *1             056095
     C*********************MOVE HKICMT    @@CALC           *1             S01149
     C*********************Z-ADDHKAMNP    @@AMT            *1             S01149
     C*********************Z-ADDHKINTR    @@RATE           *1             S01149
     C***********          MOVE CCICMT    @@CALC           *1       S01149056095
     C                     Z-ADDCCSLID    ZZBEG            *1             056095
     C                     Z-ADDCCMATD    ZZEND            *1             056095
     C                     MOVE CCICMT    ZZCALC           *1             056095
     C                     Z-ADDCCAMNP    @@AMT            *1             S01149
     C                     Z-ADDCCINTR    @@RATE           *1             S01149
     C**********           EXSR MM1007                     *1             E20634
     C/COPY WNCPYSRC,MM0175C009
     C                     EXSR MM1030                     *1             E20634
     C/COPY WNCPYSRC,MM0175C010
     C                     MULT 10        @@INTR           *1             E20634
     C*
     C** For insert/amend add interest into book otherwise ...
     C                     Z-SUB@@INTR    @DNIM            *1
     C                     DIV  10        @@INTR    H      ME2111
     C                     Z-SUB@@INTR    @HNIM            *1
     C                     SUB  @@INTR    @NIMT            *1
     C*
     C** Update forward book details.
     C                     EXSR #ZA                        *1
     C                     EXSR #ZB                        *1
     C                     END                             E1
     C*
     C***If*next*interest*date*not*entered*add*interest*at                S01149
     C***maturity*into*book.                                              S01149
     C** If next interest date not entered and deal is not an N/A         S01149
     C** sold add interest at maturity into book.                         S01149
     C           @NIPD     IFEQ 0                          B1
     C*                                                                   S01149
     C** If Front up Interest indicator on interest was added/deducted    S01392
     C** at value date into book, so skip maturity date processing.       S01392
     C           CCFUID    ANDNE'Y'                        B1             S01392
     C*                                                                   S01392
     C***Calculate*interest*at*maturity.                                  S01149
     C** Calculate interest at maturity if not a non-interest             S01149
     C** bearing N/A ...                                                  S01149
     C           @NINA     IFEQ 'N'                        B*2            S01149
     C           @FMTY     IFEQ 'N'                        B**3           S01149
     C*
     C** Convert start/last interest date to MIDAS day number format      S01149
     C***********          Z-ADD@OSDAT    @@DTIN                    S01149056095
     C***********          EXSR ZA0680                              S01149056095
     C***********          Z-ADD@@MDNO    @@BEG                     S01149056095
     C                     Z-ADD@OSDAT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    ZZBEG                           056095
     C                     ELSE                            X**3           S01149
     C***********          Z-ADDCCDVSD    @@BEG            ***3     S01149056095
     C                     Z-ADDCCDVSD    ZZBEG            ***3           056095
     C                     END                             E**3           S01149
     C***********          Z-ADDCCMATD    @@END            **2      S01149056095
     C*********************MOVE HKICMT    @@CALC           *1             S01149
     C*********************Z-ADDHKAMNP    @@AMT            *1             S01149
     C*********************Z-ADDHKINTR    @@RATE           *1             S01149
     C***********          MOVE CCICMT    @@CALC           **2      S01149056095
     C                     Z-ADDCCMATD    ZZEND            **2            056095
     C                     MOVE CCICMT    ZZCALC           **2            056095
     C                     Z-ADDCCAMNP    @@AMT            **2            S01149
     C                     Z-ADDCCINTR    @@RATE           **2            S01149
     C*                                                                   S01392
     C** If First & Last Day Interest indicator on add an extra           S01392
     C** day's interest.                                                  S01392
     C           CCFLID    IFEQ 'Y'                        B**3           S01392
     C***********          ADD  1         @@END            ***3     S01392056095
     C                     ADD  1         ZZEND            ***3           056095
     C                     END                             E**3           S01392
     C*                                                                   S01392
     C                     MOVE CCRDFC    @@RDFC  1        **2            S01392
     C**********           EXSR MM1007                     **2            E20634
     C/COPY WNCPYSRC,MM0175C011
     C                     EXSR MM1030                     **2            E20634
     C/COPY WNCPYSRC,MM0175C012
     C                     MULT 10        @@INTR           **2            E20634
     C                     ELSE                            X*2
     C*
     C** ... otherwise, use the difference between purchase price         S01149
     C** and face value (ie. non-interest bearing N/A)                    S01149
     C           @FVAL     SUB  CCAMNP    @@INTR           **2            S01149
     C                     MULT 10        @@INTR           **2            S01149
     C                     END                             E*2            S01149
     C*
     C** Add interest at maturity into book on insertion
     C           @MDTD     IFGE @RUNDT                     B*2
     C                     Z-SUB@@INTR    @DNIM            **2
     C                     DIV  10        @@INTR    H      ME2111
     C                     Z-SUB@@INTR    @HNIM            **2
     C                     SUB  @@INTR    @NIMT            **2
     C*
     C** If last action insertion or deletion update details on
     C** books otherwise........
     C                     Z-ADD@MDTD     @HNDAT           **2
     C                     EXSR #ZA                        **2
     C                     EXSR #ZB                        **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #BBAC9    ENDSR                           **#BBAC9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBC     - Update fwd book for SI deam                        *
     C*                                                               *
     C**CALLS****ZA0680***-*Convert*a*date*to*day*number*form**********   056095
     C***********MM1007***-*Calc interest due at next interest date   *   E20634
     C* CALLS    ZDAT10   - Convert a date to day number form         *   056095
     C*          MM1030   - Calc interest due at next interest date   *   E20634
     C*          #ZA      - Write / update records on LF/MMFWUDLL     *
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *
     C*                                                               *
     C* CALLED BY  #BB    - Routine controlling updating sequence     *
     C*                                                               *
     C* FLDS USED  @OSDAT - Deam related deal start date              *
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680****   056095
     C*************@@MDNO*-*MIDAS*day*number***************************   056095
     C*************@@BEG**-*Beginning*of*interest*period***************   056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @HNDAT - Data structure to format date as YYYYMMDD *
     C*************@@END**-*End*of*interest*period*********************   056095
     C*************@@CALC*-*Interest*calculation*method****************   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *
     C*            @@RATE - Deal interest rate                        *
     C*            @@INTR - Amount of interest due                    *
     C*            @DNIM  - Daily net interest movement               *
     C*            @HNIM  - Half month net interest movement          *
     C*            @NIMT  - Net interest movement                     *
     C*            @MDTD  - Deam related deal maturity date           *
     C*                                                               *
     C*****************************************************************
     C           #BBC      BEGSR
     C*
     C** If earlier deam exists on deal no need to process entered
     C** details as none of relevant details may have changed.
     C                     Z-ADDCCVDYY    @VDYY
     C                     Z-ADDCCVDMM    @VDMM
     C                     Z-ADDCCVDDD    @VDDD
     C*
     C           @MDKEY    SETLLMMSDFDLL
     C                     READPMMSDFDLL                 60
     C*
     C           *IN60     IFEQ '0'                        B1
     C           FDDA38    ANDEQHNDA38                     *1
     C                     GOTO #BBC9                      *1
     C                     END                             E1
      *                                                                   S01378
      ** For SI mdate processing of NA's bought (*IN11) where             S01378
      ** the N/A is parcelled need amounts relating to the unsold         S01378
      ** portion remaining at mdat. DL0280/MM0101 reduce face value,      S01378
      ** parcel size, HLNSLD etc. on NAB as each sale reaches its         S01378
      ** value date but we must consider all forward valued sales         S01378
      ** for this maturity date processing (if there are any).            S01378
     C           HLPCLI    IFEQ 'P'                        B1             S01378
     C           *IN11     ANDEQ'1'                        B1             S01378
     C           HLNSLD    ANDNE*ZERO                      B1             S01378
     C           CCAMNP    DIV  HLPSZE    @WRK      H      *1             S01378
     C           @WRK      MULT HLNSLD    @WRK             *1             S01378
     C           CCAMNP    SUB  @WRK      CCAMNP           *1             S01378
     C                     END                             E1             S01378
     C*
     C***If*record*read*from*format*MMSDFAP0                              S01149
     C** If record read from format MMSDFAP0 or MMSDFZP0                  S01149
      ** *IN05 is SI DEAM on a loan/depo, *IN11 is SI DEAM on N/A purchaseS01378
     C           *IN05     IFEQ '1'                        B1
     C           *IN11     OREQ '1'                        *1             S01149
     C*
     C** For deam without later associated later deam perform following
     C** processing to calculate DEAL interest at maturity.
     C***********          Z-ADD@OSDAT    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @@BEG            *1             056095
     C                     Z-ADD@OSDAT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZBEG            *1             056095
     C*
     C***********          Z-ADD@MDTD     @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @@END            *1             056095
     C                     Z-ADD@MDTD     ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZEND            *1             056095
     C*
     C*********************Z-ADDHKAMNP    @@AMT            *1             S01149
     C*********************MOVE HKICMT    @@CALC           *1             S01149
     C*********************Z-ADDHKINTR    @@RATE           *1             S01149
     C                     Z-ADDCCAMNP    @@AMT            *1             S01149
     C***********          MOVE CCICMT    @@CALC           *1       S01149056095
     C                     MOVE CCICMT    ZZCALC           *1             056095
     C                     Z-ADDCCINTR    @@RATE           *1             S01149
     C**********           EXSR MM1007                     *1             E20634
     C/COPY WNCPYSRC,MM0175C013
     C                     EXSR MM1030                     *1             E20634
     C/COPY WNCPYSRC,MM0175C014
     C                     MULT 10        @@INTR           *1             E20634
     C*
     C** Alter forward book for interest at maturity details
     C** For deam insertion back out interest at maturity for deal.
     C** For deam deletion reinsert deal interest at maturity
     C                     Z-ADD@@INTR    @DNIM            *1
     C                     DIV  10        @@INTR    H      ME2111
     C                     Z-ADD@@INTR    @HNIM            *1
     C                     ADD  @@INTR    @NIMT            *1
     C*
     C** Update forward book for deal interest at maturity details.
     C*********************Z-ADDHKMDYY    @VDYY            *1             S01149
     C*********************Z-ADDHKMDMM    @VDMM            *1             S01149
     C*********************Z-ADDHKMDDD    @VDDD            *1             S01149
     C                     Z-ADDCCMDYY    @VDYY            *1             S01149
     C                     Z-ADDCCMDMM    @VDMM            *1             S01149
     C                     Z-ADDCCMDDD    @VDDD            *1             S01149
     C*
     C                     EXSR #ZA                        *1
     C                     EXSR #ZB                        *1
     C*
     C                     END                             E1
     C*
     C***If*record*read*from*format*MMSDFSP0                              S01149
     C** If record read from format MMSDFSP0 or MMSDFYP0                  S01149
      ** *IN06 is SI DEAM on a loan/depo, *IN12 is SI DEAM on N/A purchaseS01378
     C           *IN06     IFEQ '1'                        B1
     C           *IN12     OREQ '1'                        *1             S01149
     C*
     C** Add / subtract deam amount into book
     C                     Z-ADDCCVDYY    @VDYY            *1
     C                     Z-ADDCCVDMM    @VDMM            *1
     C                     Z-ADDCCVDDD    @VDDD            *1
     C*
     C** Calculate related deal start date
     C***********          Z-ADD@OSDAT    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @@BEG            *1             056095
     C                     Z-ADD@OSDAT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZBEG            *1             056095
     C*
     C***********HKDBSR    IFNE *BLANKS                    B*2            S01149
     C           *IN06     IFEQ '1'                        B*2            S01149
     C           HKDBSR    ANDNE*BLANKS                    **2            S01149
     C                     Z-ADDHKSPRD    CCORAT 117       **2
     C                     ELSE                            X*2
     C*********************Z-ADDHKINTR    CCORAT           **2            S01149
     C                     Z-ADDCCINTR    CCORAT           **2            S01149
     C                     END                             E*2
     C*
     C** Calculate deam amount
     C***********          Z-ADDCCDVSD    @@END            *1             056095
     C                     Z-ADDCCDVSD    ZZEND            *1             056095
     C*********************Z-ADDHKAMNP    @@AMT            *1             S01149
     C*********************MOVE HKICMT    @@CALC           *1             S01149
     C                     Z-ADDCCAMNP    @@AMT            *1             S01149
     C***********          MOVE CCICMT    @@CALC           *1       S01149056095
     C                     MOVE CCICMT    ZZCALC           *1             056095
     C                     Z-ADDCCORAT    @@RATE           *1
     C**********           EXSR MM1007                     *1             E20634
     C/COPY WNCPYSRC,MM0175C015
     C                     EXSR MM1030                     *1             E20634
     C/COPY WNCPYSRC,MM0175C016
     C                     MULT 10        @@INTR           *1             E20634
     C*
     C** On insert add in new deal amount; on deletion back amount out
     C                     Z-SUB@@INTR    @DNIM            *1
     C                     DIV  10        @@INTR    H      ME2111
     C                     Z-SUB@@INTR    @HNIM            *1
     C                     SUB  @@INTR    @NIMT            *1
     C*
     C*
     C** Add interest into book
     C                     EXSR #ZA                        *1
     C                     EXSR #ZB                        *1
     C*
     C                     END                             E1
     C******               END                             E1             FA0005
     C*
     C           #BBC9     ENDSR                           ** #BBC9 **
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBD     - Update LF/MMFWDTLL total funds lent info           *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BB    - Routine controlling updating sequence     *
     C*                                                               *
     C* FLDS USED  @FMTY  - LF/MMSTDDLL format indicator              *
     C*            @NA    - Array contains deal type of all placings  *
     C*                     and all N/A's                             *   S01149
     C*            @TFDL  - Total funds lent                          *
     C*                                                               *
     C*****************************************************************
     C           #BBD      BEGSR
     C*
     C** Perform deam processing first.
     C           @FMTY     IFEQ 'A'                        B1
     C*
     C***Check*if*Original*Deal*type*is*a*Loan                            S01149
     C** Check if Original Deal type is a Loan or a N/A                   S01149
     C           HNOGDT    LOKUP@NA,1                    60*1
     C*
     C** If original deal was a loan update total funds lent
     C           *IN60     IFEQ '1'                        B*2
     C*
     C** If amount is negative, make it positive
     C           HNAMNP    IFLT 0                          B**3
     C                     Z-SUBHNAMNP    HNAMNP           ***3
     C                     END                             E**3
     C*
     C** Perform processing for insertion of a deam
     C           CCTYPE    IFEQ 'PI'                       B**3
     C                     SUB  HNAMNP    @TFDL  150       ***3
     C                     ELSE                            X**3
     C                     ADD  HNAMNP    @TFDL            ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Update total funds lent for loans / deposits
     C           @FMTY     IFEQ 'L'                        B1
     C           *IN01     ANDEQ'1'                        *1
     C*********************SUB  HKAMNP    @TFDL  150       *1             S01149
     C                     SUB  CCAMNP    @TFDL  150       *1             S01149
     C                     END                             E1
     C*
     C** Update total funds lent for negotiable assets bought
     C** unless sold
     C***********@FMTY     IFEQ 'B'                        B1             S01149
     C           @FMTY     IFEQ 'N'                        B1             S01149
      *                                                                   S01378
      ** If N/A purchased is not parcelled, the associated deal number    S01378
      ** will be blank for unsold N/A's bought trades                     S01378
     C           HLPCLI    IFEQ *BLANK                     B*2            S01378
     C           HLDADN    ANDEQ*BLANK                     *1
     C                     SUB  HLAMNP    @TFDL  150       *1
     C                     END                             E*2            S01378
      *                                                                   S01378
      ** If the N/A is parcelled it may have been sold by more than       S01378
      ** one related N/A sold trade hence related deal no. is blank.      S01378
      ** If N/A is parcelled we need amounts relating to the unsold       S01378
      ** portion remaining at mdat. DL0280/MM0101 reduce face value,      S01378
      ** parcel size, HLNSLD etc. on NAB as each sale reaches its         S01378
      ** value date but we must consider all forward valued sales         S01378
      ** for this maturity date processing (if there are any).            S01378
     C           HLPCLI    IFEQ 'P'                        B*2            S01378
     C                     SUB  HLAMNP    @TFDL            **2            S01378
      *                                                                   S01378
      ** Include forward valued sales:                                    S01378
     C           HLNSLD    IFNE *ZERO                      B**3           S01378
     C           HLAMNP    DIV  HLPSZE    @WRK      H      ***3           S01378
     C           @WRK      MULT HLNSLD    @WRK             ***3           S01378
     C                     SUB  @WRK      @TFDL            ***3           S01378
     C                     END                             E**3           S01378
     C                     END                             E*2            S01378
      *                                                                   S01378
      ** END for N/A section                                              S01378
     C                     END                             E1
     C*
     C           #BBD9     ENDSR                           **#BBD9**
     C*****************************************************************   ME1350
     C/EJECT                                                              ME1350
     C*****************************************************************   ME1350
     C*                                                               *   ME1350
     C* #BBE     - Update LF/MMFWDTLL NA net value details            *   ME1350
     C*                                                               *   ME1350
     C* CALLS             -                                           *   ME1350
     C*                                                               *   ME1350
     C* CALLED BY  #BB    - Routine controlling updating sequence     *   ME1350
     C*                                                               *   ME1350
     C* FLDS USED  @FMTY  - LF/MMSTDDLL format indicator              *   ME1350
     C*            @NSNV  - NA net value workfield                    *   ME1350
     C*                                                               *   ME1350
     C*****************************************************************   ME1350
     C           #BBE      BEGSR                                          ME1350
     C**  E20631 - If it is a NA Bought Deal and it has not been          E20631
     C**           Sold, update Face Value and Net Value Total.           E20631
     C**           HLNANV (Net Value for the Deal) should already         E20631
     C**           be calculate in MM0101 before this program is          E20631
     C**           called.                                                E20631
      *                                                                   S01378
      ** If N/A purchased is not parcelled, the associated deal number    S01378
      ** will be blank for unsold N/A's bought trades                     S01378
     C***********HLDADN    IFEQ *BLANKS                    B1       E20631S01378
     C           HLPCLI    IFEQ *BLANK                     B1             S01378
     C           HLDADN    ANDEQ*BLANK                     B1             S01378
     C                     Z-ADDHLFVAL    @NSFV            *1             E20631
     C                     Z-ADDHLNANV    @NSNV            *1             E20631
     C                     END                             E1             E20631
      *                                                                   S01378
      ** If N/A is parcelled need to update with the remaining unsold     S01378
      ** portion. This consists of portion sold and passed the sale       S01378
      ** value date (and so DL0280/MM0101 has adjusted face value         S01378
      ** etc to reflect this) and the forward valued sales.               S01378
     C           HLPCLI    IFEQ 'P'                        B1             S01378
      *                                                                   S01378
      ** Include sales passed their value date:                           S01378
     C                     Z-ADDHLFVAL    @NSFV            *1             S01378
     C                     Z-ADDHLNANV    @NSNV            *1             S01378
      *                                                                   S01378
      ** Include forward valued sales:                                    S01378
     C           HLNSLD    IFNE *ZERO                      B*2            S01378
     C           HLFVAL    DIV  HLPSZE    @WRK      H      **2            S01378
     C           @WRK      MULT HLNSLD    @WRK             **2            S01378
     C           @NSFV     SUB  @WRK      @NSFV            **2            S01378
      *                                                                   S01378
     C           HLNANV    DIV  HLPSZE    @WRK      H      **2            S01378
     C           @WRK      MULT HLNSLD    @WRK             **2            S01378
     C           @NSNV     SUB  @WRK      @NSNV            **2            S01378
     C                     END                             E*2            S01378
     C                     END                             E1             S01378
     C**  E20631 - With the reason given above, the old coding for        E20631
     C**           this routine is no longer necessary.                   E20631
     C*                                                                   ME1350
     C** Following processing performed if deal transaction date is the   ME1350
     C** same as the run date Ie deal first entered to system today       ME1350
     C********** HLDDAT    IFEQ @RUNDT                     B1      ME1350 E20631
     C*                                                                   ME1350
     C** If deal is a NA purchase perform following ....                  ME1350
     C********** HLDADN    IFEQ *BLANK                     B*2     ME1350 E20631
     C**********           Z-SUBHLAMNP    @NSNV            **2     ME1350 E20631
     C**********           END                             E*2            E20631
     C*
     C**********           END                             E1      ME1350 E20631
     C*                                                                   ME1350
     C** Following code will be performed in two circumstances            ME1350
     C**   1/  When files are rebuilt as part of next day set up          ME1350
     C**   2/  When a NAB or a NAS is amended during input cycle and      ME1350
     C**  an end of day has been run since NAB / NAS first input          ME1350
     C*****      MPHAS     IFEQ 'F'                        B1      FA0005 E20631
     C*****      CCDDAT    ORNE @RUNDT                     *1      FA0005 E20631
     C********** HLDDAT    IFNE @RUNDT                     B1      FA0005 E20631
     C*                                                                   ME1350
     C********** HLDADN    IFEQ *BLANK                     B*2     ME1350 E20631
     C**********           Z-ADDHLFVAL    @NSNV            **2     ME1350 E20631
     C**********           ADD  HLNANV    @NSNV            **2     ME1350 E20631
     C**********           END                             E*2     ME1350 E20631
     C*                                                                   ME1350
     C**********           END                             E1      ME1350 E20631
     C*                                                                   ME1350
     C           #BBE9     ENDSR                           **#BBE9**      ME1350
     C*****************************************************************
     C/EJECT
     C*****************************************************************   E20634
     C*** MM1007 - CALCULATE INTEREST                                 *   E20634
     C***                                                             *   E20634
     C***CALLED BY    -                                               *   E20634
     C***                                                             *   E20634
     C***CALLS        -   MM1009 CALCULATE NO. OF INTEREST DAYS       *   E20634
     C***                                                             *   E20634
     C***FIELDS INPUT @@BEG  - START DATE OF PERIOD                   *   E20634
     C***             @@END  - END DATE OF PERIOD                     *   E20634
     C***             @@CALC - INTEREST CALCULATION METHOD            *   E20634
     C***             @@AMT  - PRINCIPAL AMOUMT  15N                  *   E20634
     C***             @@RATE - INTEREST RATE 11,7                     *   E20634
     C***                                                             *   E20634
     C***FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   E20634
     C***                                                             *   E20634
     C***WORK FIELDS   @@W155 - 15,5                                      E20634
     C***                                                             *   E20634
     C*****************************************************************   E20634
     C********** MM1007    BEGSR                                          E20634
     C**********                                                          E20634
     C*** CALCULATE NUMBER OF INTEREST DAYS                               E20634
     C**********           EXSR MM1009                                    E20634
     C**********                                                          E20634
     C********** @@CALC    IFEQ '2'                        *** B 1        E20634
     C********** @@CALC    OREQ '3'                                       E20634
     C********** @@CALC    OREQ '5'                                       E20634
     C********** @@AMT     DIV  36000     @@W155 155                      E20634
     C**********           END                             *** E 1        E20634
     C**********                                                          E20634
     C********** @@CALC    IFEQ '1'                        *** B 1        E20634
     C********** @@CALC    OREQ '4'                                       E20634
     C********** @@AMT     DIV  36500     @@W155                          E20634
     C**********           END                              *** E 1       E20634
     C**********                                                          E20634
     C********** @@CALC    IFEQ '6'                         *** B 1       E20634
     C********** @@AMT     DIV  36600     @@W155                          E20634
     C**********           END                              *** E 1       E20634
     C**********                                                          E20634
     C**********           MULT @@RATE    @@W155                          E20634
     C********** @@W155    MULT @@INDY    @@INTR 150H      ME2111         E20634
     C********** @@W155    MULT @@INDY    @@W151 151H      ME2111         E20634
     C********** @@W151    MULT 10        @@INTR 150H      ME2111         E20634
     C**********                                                          E20634
     C********** M10079    ENDSR                                          E20634
     C*****************************************************************
     C/EJECT                                                              E20634
     C******
     C************************************************************ E20634 S01392
     C****MM1030 - CALCULATE INTEREST                              E20634 S01392
     C******       (MM1030 INCLUDES ADJUSTMENT FOR ERROR IN DIVISIOE20634 S01392
     C******                                                       E20634 S01392
     C***CALLED BY    -                                            E20634 S01392
     C******                                                       E20634 S01392
     C***CALLS        -   MM1009 CALCULATE NO. OF INTEREST DAYS    E20634 S01392
     C******                                                       E20634 S01392
     C***FIELDS INPUT @@BEG  - START DATE OF PERIOD                E20634 S01392
     C******          @@END  - END DATE OF PERIOD                  E20634 S01392
     C******          @@CALC - INTEREST CALCULATION METHOD         E20634 S01392
     C******          @@AMT  - PRINCIPAL AMOUNT  15N               E20634 S01392
     C******          @@RATE - INTEREST RATE 11,7                  E20634 S01392
     C******                                                       E20634 S01392
     C***FIELDS OUTPUT @@INTR - INTEREST 15,0                      E20634 S01392
     C******                                                       E20634 S01392
     C***WORK FIELDS   @@W155 - 15,5                               E20634 S01392
     C******           @@YEAR - (NUMBER OF DAYS IN YEAR) x 100     E20634 S01392
     C******           @@WDIV - 15,5  HOLDS RESULT OF DIVISION     E20634 S01392
     C******           @@ERR  - 15,9  ROUNDING ERROR               E20634 S01392
     C******           @@AMTR - 15,1  AMOUNT FROM ROUNDING ERROR CAE20634 S01392
     C******                    CAN BE 15,1 SINCE IT IS NOT POSSIBLE20634 S01392
     C******                    TO INPUT 15 BYTE FIELDS IN DRS.    E20634 S01392
     C******                                                       E20634 S01392
     C*************************************************************E20634 S01392
     C******     MM1030    BEGSR                                   E20634 S01392
     C******                                                       E20634 S01392
     C****CALCULATE NUMBER OF INTEREST DAYS                        E20634 S01392
     C******               EXSR MM1009                             E20634 S01392
     C******                                                       E20634 S01392
     C******     @@CALC    IFEQ '2'                        B1      E20634 S01392
     C******     @@CALC    OREQ '3'                        B1      E20634 S01392
     C******     @@CALC    OREQ '5'                        B1      E20634 S01392
     C******     @@AMT     DIV  36000     @@WDIV 155       *1      E20634 S01392
     C******               Z-ADD36000     @@YEAR  50       *1      E20634 S01392
     C******               END                             E1      E20634 S01392
     C******                                                       E20634 S01392
     C******     @@CALC    IFEQ '1'                        B1      E20634 S01392
     C******     @@CALC    OREQ '4'                        B1      E20634 S01392
     C******     @@AMT     DIV  36500     @@WDIV           *1      E20634 S01392
     C******               Z-ADD36500     @@YEAR           *1      E20634 S01392
     C******               END                             E1      E20634 S01392
     C******                                                       E20634 S01392
     C******     @@CALC    IFEQ '6'                        B1      E20634 S01392
     C******     @@AMT     DIV  36600     @@WDIV           *1      E20634 S01392
     C******               Z-ADD36600     @@YEAR           *1      E20634 S01392
     C******               END                             E1      E20634 S01392
     C******                                                       E20634 S01392
     C******     @@WDIV    MULT @@RATE    @@W155 155               E20634 S01392
     C******                                                       E20634 S01392
     C****MULTIPLY @@WDIV BY @@YEAR TO GET ORIGINAL AMOUNT. THE RESE20634 S01392
     C****COULD DIFFER FROM THE ORIGINAL DUE TO ROUNDING ERROR ON  E20634 S01392
     C****DIVISION.                                                E20634 S01392
     C******     @@WDIV    MULT @@YEAR    @@AMTR 151               E20634 S01392
     C******                                                       E20634 S01392
     C****CALCULATE THE ERROR AND DO SAME ARITHMETICAL OPERATIONS AE20634 S01392
     C****@@AMT ABOVE.                                             E20634 S01392
     C******     @@AMT     SUB  @@AMTR    @@ERR  159               E20634 S01392
     C******     @@ERR     IFNE 0                                  E29176 S01392
     C******               MULT @@RATE    @@ERR                    E20634 S01392
     C******               DIV  @@YEAR    @@ERR                    E20634 S01392
     C******                                                       E20634 S01392
     C****ADD RESULT FROM ERROR CALCULATIONS BACK TO THE RESULT FROE20634 S01392
     C****CALCULATIONS ON PRINCIPAL AMOUNT.                        E20634 S01392
     C******               ADD  @@ERR     @@W155                   E20634 S01392
     C******               END                                     E29176 S01392
     C******                                                       E20634 S01392
     C****MULTIPLY BY THE PERIOD TO OBTAIN THE INTEREST.           E20634 S01392
     C******     @@W155    MULT @@INDY    @@INTR 150H              E20634 S01392
     C******                                                       E20634 S01392
     C******     M10309    ENDSR                                   E20634 S01392
     C*****************************************************************   S01392
     C*                                                               *   S01392
     C*   MM1030 - CALCULATE INTEREST                                 *   S01392
     C*                                                               *   S01392
     C*  CALLED BY    -                                               *   S01392
     C*                                                               *   S01392
     C***CALLS********-***MM1009*CALCULATE*NO.*OF*INTEREST*DAYS*****S01392056095
     C*  CALLS        -   ZINTDY CALCULATE NO. OF INTEREST DAYS       *   056095
     C*                                                               *   S01392
     C***FIELDS*INPUT*@@BEG**-*START*DATE*OF*PERIOD*****************S01392056095
     C****************@@END**-*END*DATE*OF*PERIOD*******************S01392056095
     C****************@@CALC*-*INTEREST*CALCULATION*METHOD**********S01392056095
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   056095
     C*               ZZEND  - END DATE OF PERIOD                     *   056095
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   056095
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C*               @@RATE - INTEREST RATE 11,7                     *   S01392
     C*               @@RDFC - ROUND DOWN FACILITY IND 1              *   S01392
     C*                                                               *   S01392
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C*                                                               *   S01392
     C*  WORK FIELDS   @@W157 - 15,5                                  *   S01392
     C*****************@@W150*-*15,0*******************************S01392 056121
     C*                @@W210 - 21,0                                  *   056121
     C*                @@YEAR - (NUMBER OF DAYS IN YEAR) x 100        *   S01392
     C*                                                               *   S01392
     C*****************************************************************   S01392
     C           MM1030    BEGSR                                          S01392
     C*                                                                   S01392
     C*   CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C/COPY WNCPYSRC,MM0175C001
     C*                                                                   S01392
     C***********          EXSR MM1009                              S01392056095
     C                     Z-ADDZZBEG     ZZBEG9  50                                          CDL093
     C                     Z-ADDZZEND     ZZEND9  50                                          CDL093
      *                                                                                       CDL093
      ** Check if 29th Feb is included                                                        CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
      *                                                                                       CDL093
      ** Convert start date to YYYYMMDD format                                                CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZBEG9    @@DAYN  50                                          CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATA  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY1   40                                          CDL093
      *                                                                                       CDL093
      ** Convert end date to YYYYMMDD format                                                  CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZEND9    @@DAYN                                              CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATB  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY2   40                                          CDL093
      *                                                                                       CDL093
     C                     EXSR #FEB29                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           HKNIPD    ANDNE*ZERO                                                         CDL093
     C           HKNIPD    ANDLTZZEND                                                         CDL093
      *                                                                                       CDL093
     C                     Z-ADDHKIPDM    @@IPDM  20                                          CDL093
     C                     CALL 'MM001031'                                                    CDL093
     C                     PARM           ZZBEG                                               CDL093
     C                     PARM           ZZEND                                               CDL093
     C                     PARM           HKNIPD                                              CDL093
     C                     PARM '9'       ZZCALC                                              CDL093
     C                     PARM           HKIPFQ                                              CDL093
     C                     PARM           @@AMT                                               CDL093
     C                     PARM           @@RATE                                              CDL093
     C                     PARM 'N'       RNDDWN  1                                           CDL093
     C                     PARM 'N'       FRSLST  1                                           CDL093
     C                     PARM           @@IPDM                                              CDL093
     C                     PARM           WINTR                                               CDL093
      *                                                                                       CDL093
     C                     Z-ADDWINTR     @@INTR                                              CDL093
     C           *LIKE     DEFN @@INTR    WINTR                                               CDL093
      *                                                                                       CDL093
     C                     GOTO INTCLC                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C                     EXSR ZINTDY                                    056095
     C*                                                                   S01392
     C***********@@CALC    IFEQ '2'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '3'                                 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C           ZZCALC    IFEQ '2'                        *** B 1        056095
     C           ZZCALC    OREQ '3'                                       056095
     C           ZZCALC    OREQ '5'                                       056095
     C           ZZCALC    OREQ '7'                                       CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C           ZZCALC    OREQ '0'                                                          CER016A
     C                     Z-ADD36000     @@YEAR  50                      S01392
     C                     END                             *** E 1        S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '1'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '4'                                 S01392056095
     C           ZZCALC    IFEQ '1'                        *** B 1        056095
     C           ZZCALC    OREQ '4'                                       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDNE'Y'                                                           CDL093
     C                     Z-ADD36500     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '6'                         *** B 1 S01392056095
     C           ZZCALC    IFEQ '6'                         *** B 1       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C                     Z-ADD36600     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C           ZZCALC    IFEQ '6'                                       163136
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           INT6DY    MULT @@RATE    @@W157                          163136
     C                     ELSE                                           163136
      *                                                                   163136
     C***********@@INDY    MULT @@RATE    @@W157 157                S01392056095
     C           ZZINDY    MULT @@RATE    @@W157 157                      056095
      *                                                                   163136
     C                     END                                            163136
      *                                                                   163136
     C***********@@W157    MULT @@AMT     @@W150 150H              S01392 056121
     C           @@W157    MULT @@AMT     @@W210 210H                     056121
     C*                                                                   S01392
     C**  ROUND DOWN IF ROUND DOWN INDICATOR IS 'Y'                       S01392
     C*                                                                   S01392
     C           @@RDFC    IFEQ 'Y'                                       S01392
     C***********@@W150    DIV  @@YEAR    @@INTR                   S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR                          056121
     C                     ELSE                                           S01392
     C***********@@W150    DIV  @@YEAR    @@INTR 150H              S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR 150H                     056121
     C                     END                                            S01392
     C*                                                                   S01392
      * Interest has been calculated                                                          CDL093
     C           INTCLC    TAG                                                                CDL093
     C                     MOVE *BLANK    @@RDFC                          S01392
     C/COPY WNCPYSRC,MM0175C002
     C*                                                                   S01392
     C           M10309    ENDSR                                          S01392
     C*****************************************************************   E20634
     C/EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZINTDYZ2                                               056095
     C*****************************************************************
     C****MM1009*- CALCULATE THE NUMBER OF INTEREST DAYS              *   056095
     C***********                                                     *   056095
     C***CALLED*BY    -                                               *   056095
     C***********                                                     *   056095
     C***CALLS***     -   ZA0710 CONVERT MIDAS DAY NUMBER TO YMD DATE *   056095
     C***********                                                     *   056095
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                   *   056095
     C***********     @@END  - END DATE OF PERIOD                     *   056095
     C***********     @@CALC - INTEREST CALCULATION METHOD            *   056095
     C***********                                                     *   056095
     C***FIELDS*OUTPUT @@INDY - NO. OF INTEREST DAYS                  *   056095
     C***********                                                     *   056095
     C***WORKFIELDS   @@WN5   - WORK FIELD 5N                         *   056095
     C***********     @@WN5A  - WORK FIELD 5N                         *   056095
     C***********     @@WDAT  - WORK FIELD 5N                         *   056095
     C***********     @@DAYN  - WORK FIELD 5N                         *   056095
     C***********     @@P1    - WORK FIELD 5N                         *   056095
     C***********     @@P2    - WORK FIELD 5N                         *   056095
     C***********     @@P3    - WORK FIELD 5N                         *   056095
     C***********     @@LPNM  - WORKFIELD USED IN SETTING UP @@TG10   *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********MM1009    BEGSR                                          056095
     C***********                                                         056095
     C***********          MOVE @@BEG     @@BEG   50                      056095
     C***********          MOVE @@END     @@END   50                      056095
     C***********          MOVE @@CALC    @@CALC  1                       056095
     C***********          Z-ADD*ZEROS    @@INDY                          056095
     C***********          Z-ADD*ZEROS    @@LPNM                          056095
     C***********                                                         056095
     C***FIND*NUMBER OF DAYS DIFFERENCE BETWEEN DATES                     056095
     C***********                                                         056095
     C***********@@END     SUB  @@BEG     @@WDAT  50                      056095
     C***********                                                         056095
     C*****FOR*CALCULATION METHODS 3,4 OR 5.                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***********@@CALC    OREQ '4'                                       056095
     C***********@@CALC    OREQ '5'                                       056095
     C***********                                                         056095
     C***********          Z-ADD@@BEG     @@DAYN  50                      056095
     C***********          EXSR ZA0710                                    056095
     C***********          Z-ADD@@VDT     @@DATA                          056095
     C***********                                                         056095
     C***********          Z-ADD@@END     @@DAYN                          056095
     C***********          EXSR ZA0710                                    056095
     C***********          Z-ADD@@VDT     @@DATB                          056095
     C***IF*IN*SAME MONTH                                                 056095
     C***********@@YY1     IFEQ @@YY2                      **** B 2       056095
     C***********@@MM1     IFEQ @@MM2                      **** B 3       056095
     C***********@@DD2     SUB  @@DD1     @@INDY                          056095
     C***********          GOTO M10099                     --------->     056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C**IF*NOT*3,4 OR 5    ****                                           056095
     C**EXIT*PROCESSING                                                   056095
     C***********          Z-ADD@@WDAT    @@INDY  50       - LOAD OUTPT   056095
     C***********          GOTO M10099                     ----------->   056095
     C***********          END                             **** E 1       056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***CALC*NO. DAYS IN FIRST MONTH                                     056095
     C***********@@MM1     IFNE 2                          **** B 2       056095
     C***********30        SUB  @@DD1     @@P1    50   80                 056095
     C***IF*<*0,*INITIALISE TO 0                                          056095
     C***80******          Z-ADD*ZEROS    @@P1                            056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C***TEST*IF*LEAP      ****                                           056095
     C***YEAR****                                                         056095
     C***********@@YY1     DIV  4         @@WN5                           056095
     C***********          MVR            @@WN5          80               056095
     C***********                                                         056095
     C************IN80     IFEQ '1'                        **** B 3       056095
     C***********29        SUB  @@DD1     @@P1    50                      056095
     C***********          ELSE                                           056095
     C***IF*NOT*LEAP       ++++                                           056095
     C***********28        SUB  @@DD1     @@P1    50                      056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***CALC.*NO. DAYS IN LAST MONTH                                     056095
     C***********@@DD2     IFLE 30                         **** B 2       056095
     C***********          Z-ADD@@DD2     @@P2    50                      056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********          Z-ADD30        @@P2                            056095
     C***********          END                             **** E 2       056095
     C***CALC*NO. DAYS IN INTERVENING MONTHS                              056095
     C***********@@YY2     IFEQ @@YY1                      **** B 2       056095
     C***********@@MM2     SUB  @@MM1     @@P3    50                      056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 30        @@P3                            056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********@@YY2     SUB  @@YY1     @@P3                            056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 360       @@P3                            056095
     C***********                                                         056095
     C**FIND*NO.*OF MONTHS FOR THE TWO PARTIAL YEARS                      056095
     C***********12        SUB  @@MM1     @@WN5A  50                      056095
     C***********          MULT 30        @@WN5A                          056095
     C***********                                                         056095
     C***********@@MM2     SUB  1         @@WN5                           056095
     C***********@@WN5     MULT 30        @@WN5                           056095
     C***ACCUMULATE                                                       056095
     C***********@@WN5A    ADD  @@WN5     @@WN5A                          056095
     C***********@@P3      ADD  @@WN5A    @@P3                            056095
     C***********          END                             **** E 2       056095
     C***FINAL*SUM                                                        056095
     C***********                                                         056095
     C***********@@P1      ADD  @@P2      @@INDY                          056095
     C***********          ADD  @@P3      @@INDY                          056095
     C***********          END                             **** E 1       056095
     C***FOR*METHODS 4 AND 5                                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '4'                        **** B 1       056095
     C***********@@CALC    OREQ '5'                                       056095
     C****CALCULATE NUMBER OF LEAP YEARS BETWEEN START AND END DATES      056095
     C***********@@MM1     IFLE 2                          **** B 2       056095
     C***********@@YY1     DIV  4         @@WN5   50                   YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM  50                      056095
     C***********          END                             **** E 3       056095
     C***BYPASS*IF YEARS ARE THE SAME                                     056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          GOTO M10099                     ---------->    056095
     C***********          END                             **** E 2       056095
     C***LOOP*TO*CALCULATE NO. LEAP YEARS                                 056095
     C***********@@YY1     DOWNE@@YY2                      **** B 2       056095
     C***INCREMENT START YEAR                                             056095
     C***********          ADD  1         @@YY1                           056095
     C***********                                                         056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@MM2     IFGT 2                          **** B 4       056095
     C***********@@YY2     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***INCREMENT IF LEAP YEAR                                           056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 4      056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          END                              **** E 3      056095
     C***********@@YY1     IFNE @@YY2                       **** B 3      056095
     C***********@@YY1     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 3      056095
     C***********          END                              **** E 2      056095
     C***********          END                              **** E 1      056095
     C***********                                                         056095
     C***********M10099    ENDSR                           ***M10099***   056095
     C*****************************************************************
     C/EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZDATE9Z3                                               056095
     C/COPY ZSRSRC,ZFEB29                                                                     CDL093
      *****************************************************************
     C***********                                                     *   056095
     C********TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *   056095
     C***********                                                     *   056095
     C********SUBROUTINE ZA0710 EXPECTS FIELD '@@DAYN' TO BE          *   056095
     C********PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *   056095
     C********THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *   056095
     C********SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *   056095
     C********IF*'@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   056095
     C********'@@VDT'  IN 'YYYYMMDD' FORMAT.                          *   056095
     C***********                                                     *   056095
     C**NOTE:*FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS                  056095
     C***********                                                     *   056095
     C********1)*@@DAYN   LENGTH 5,0.                                 *   056095
     C***********                                                     *   056095
     C********FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *   056095
     C***********                                                     *   056095
     C********1)*@@VDT    LENGTH 8,0 DEFINED BY A DS.                 *   056095
     C********2)*@@RTN    LENGTH 1,0.                                 *   056095
     C********3)*@@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *   056095
     C********4)*@@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *   056095
     C********5)*@@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *   056095
     C********6)*@@RDAY   LENGTH 5,0.                                 *   056095
     C********7)*@@LEAP   LENGTH 1,0.                                     056095
     C***********                                                     *   056095
     C********INDICATORS USED ARE:                                    *   056095
     C***********                                                     *   056095
     C********1)*80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *   056095
     C********2)*81       CHECK FOR LOW ON ARRAY @MD.                 *   056095
     C***********                                                     *   056095
     C**INPUT*FIELD:       @@DAYN                                     *   056095
     C***********                                                     *   056095
     C**OUTPUT*FIELD:      @@VDT                                      *   056095
     C***********                                                     *   056095
     C**WORK*FIELDS:       @@RTN                                      *   056095
     C***********          @@Z71Y                                     *   056095
     C***********          @@RDAY                                     *   056095
     C***********          @@LEAP                                     *   056095
     C***********          @@I                                        *   056095
     C***********          @@J                                        *   056095
     C***********                                                     *   056095
     C**ARRAYS*USED:       @YD COMPILE TIME ARRAY.                        056095
     C***********          @MD COMPILE TIME ARRAY.                        056095
     C***********                                                         056095
     C******LAST*AMEND NO. ME1257              DATE 02/04/87          *   056095
     C******When*date input is zero set output date to zeroes         *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********                                                         056095
     C***********ZA0710    BEGSR                                          056095
     C***********                                                         056095
     C***********          SETOF                     8081                 056095
     C***********          Z-ADD0         @@RTN   10                      056095
     C***********          Z-ADD0         @@VDT                           056095
     C***********          Z-ADD1         @@I     20                      056095
     C***********          Z-ADD1         @@J     20                      056095
     C***********          Z-ADD1         @@LEAP  10                      056095
     C***********                                                         056095
     C***********@@DAYN    CABEQ0         ZA0719                    ME1257056095
     C***********                                                         056095
     C***********@@DAYN    IFLT 1                                         056095
     C***********          Z-ADD1         @@RTN                           056095
     C***********          GOTO ZA0719                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**DIVISION*TO DETERMINE WETHER LEAP YEAR.                           056095
     C***********                                                         056095
     C***********@@DAYN    DIV  1461      @@Z71Y                          056095
     C***********          MVR            @@RDAY  50                      056095
     C***********                                                         056095
     C**CALCULATING YEAR.                                                 056095
     C***********                                                         056095
     C***********@@Z71Y    MULT 4         @@Z71Y                          056095
     C***********          ADD  1972      @@Z71Y                          056095
     C***********                                                         056095
     C**CHECKING*IF YEAR IS GREATER THAN OR EQUAL TO 2100                 056095
     C***********                                                         056095
     C***********@@Z71Y    IFGE 2100                                      056095
     C***********          ADD  @@SSY2    @@RDAY                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**LOKUP*ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE        056095
     C**HAVE*PASSED.                                                      056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@YD,@@I                8080               056095
     C***********                                                         056095
     C**IF*YEAR*IS A LEAP YEAR SSLEAP IS SET TO ZERO.                     056095
     C***********                                                         056095
     C************IN80     IFEQ '0'                                       056095
     C***********          Z-ADD0         @@LEAP                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**ADD*INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 1                                         056095
     C***********@@RDAY    SUB  @YD,@@I   @@RDAY                          056095
     C***********          ADD  @@I       @@Z71Y                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**PROCESSING FOR A LEAP YEAR.                                       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 0                                         056095
     C***********                                                         056095
     C**IF*'@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.                   056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 60                                        056095
     C***********          Z-ADD29        @@Z71D                          056095
     C***********          Z-ADD2         @@Z71M                          056095
     C***********          GOTO ZA0711                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**IF*'@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN    056095
     C**PROCEED*AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP     056095
     C**YEAR.*NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.          056095
     C***********                                                         056095
     C***********@@RDAY    IFGT 60                                        056095
     C***********@@RDAY    SUB  1         @@RDAY                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C***********          END                                            056095
     C***********                                                         056095
     C**IF*DAY*'@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS      056095
     C**IN*4*YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR      056095
     C**GROUP.***                                                         056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 0                                         056095
     C***********          Z-ADD31        @@Z71D                          056095
     C***********          Z-ADD12        @@Z71M                          056095
     C***********          SUB  1         @@Z71Y                          056095
     C***********          GOTO ZA0711                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**LOOK*UP*ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'         056095
     C**OCCURS*IN                                                         056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@MD,@@J                81                 056095
     C***********          Z-ADD@@J       @@Z71M                          056095
     C***********@@RDAY    SUB  @MD,@@J   @@Z71D                          056095
     C***********                                                         056095
     C**DS*@@VDT* IS RETURNED IN YYYYMMDD FORMAT                          056095
     C***********                                                         056095
     C***********ZA0711    TAG                                            056095
     C***********                                                         056095
     C***********          MOVE @@Z71Y    @@YR                            056095
     C***********                                                         056095
     C***********ZA0719    ENDSR                                          056095
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #A       - Initial processing                                 *
     C*                                                               *
     C**CALLS****ZA0150***-*Acces*LF/FDICDRll**************************   S01194
     C*                                                               *
     C* CALLED BY  MAIN   - Main controlling routine.                 *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter                     *
     C*            @FMTY  - LF/MMSTDDLL format indicator              *
     C*            @STDL  - Standard deal details from PF/MMSTDLPP    *
     C*            @STDB  - Standard deal details from PF/MMSTDBPP    *
     C*            @STDS  - Standard deal details from PF/MMSTDSPP    *
     C*            @STDA  - Standard deal details from PF/MMSTDAPP    *
     C*            @DKEY  - Key to file LF/MMFWUDLL                   *
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @HKEY  - Key to LF/MMFWUHLL                        *
     C*            @VDHM  - Half month part of key on LF/MMFWUHLL     *
     C*            @UPDT  - DS holds control details for file updating*
     C*            @A     - Index to array of month shortnames        *
     C*            @MN    - Array of month shortnames                 *
     C*            @RUNDT - Run date as YYYYMMDD format               *
     C*            @WRK   - Date work field                           *
     C*            @TSTDT - Date determines LF/MMFWUHLL to be updated *
     C*            @HNDAT - Data structure to format date as YYYYMMDD *
     C*            @@AMT  - Deal amount                               *
     C*            @AMT   -                                           *
     C*            @@RATE - Deal interest rate                        *
     C*                                                               *
     C*****************************************************************
     C           #A        BEGSR
     C*
     C                     MOVEACPY@      BIS@   80                       S01194
     C*
      * Define local data area                                                                CDL033
     C           *NAMVAR   DEFN           LDA                                                 CDL033
      *                                                                                       CDL033
     C** Open files used in program.
     C*********************OPEN FDICDRLL                                  S01194
     C                     OPEN FDMNTHLL
     C                     OPEN MMSDFDLL
     C                     OPEN MMFWUDLL
     C                     OPEN MMFWUHLL
     C                     OPEN MMFWUTLL
     C                     OPEN MMDEALLL                                  S01149
     C*                                                                   S01149
     C** Define fields for accumulating N/A data                          S01149
     C           *LIKE     DEFN HSDCIN    @NDCIN                          S01149
     C           *LIKE     DEFN HSDCOT    @NDCOT                          S01149
     C           *LIKE     DEFN HSDNMT    @NDNMT                          S01149
     C           *LIKE     DEFN HSDNIM    @NDNIM                          S01149
     C           *LIKE     DEFN HSMAIN    @NMAIN                          S01279
     C           *LIKE     DEFN HSMAOT    @NMAOT                          S01279
     C           *LIKE     DEFN HSAVIN    @NAVIN                          S01279
     C           *LIKE     DEFN HSAVOT    @NAVOT                          S01279
     C*                                                                   S01279
     C           *LIKE     DEFN HLINTR    @EFRT                           S01279
     C*
     C           *LIKE     DEFN HTHMCI    @NHMCI                          S01149
     C           *LIKE     DEFN HTHMCO    @NHMCO                          S01149
     C           *LIKE     DEFN HTHMNM    @NHMNM                          S01149
     C           *LIKE     DEFN HTHNIM    @NHMIM                          S01149
     C*
     C           *LIKE     DEFN HVNSNV    @NNSNV                          ME1350
     C           *LIKE     DEFN HVTFDL    @NTFDL                          S01149
     C**  E20634 - @NTCIN and @NTCOT are not being used                   E20634
     C********** *LIKE     DEFN HVTCIN    @NTCIN                   S01149 E20634
     C********** *LIKE     DEFN HVTCOT    @NTCOT                   S01149 E20634
     C           *LIKE     DEFN HVNIML    @NNIMT                          S01149
     C           *LIKE     DEFN HVMMFN    @NMMFN                          S01149
     C*
     C           *LIKE     DEFN CCAMNP    @FVAL                           S01149
     C*
     C** Receive parameter from MM0078
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C*
     C**  Build key for MMSDFDLL file
     C           @MDKEY    KLIST
     C                     KFLD           HNDA38
     C                     KFLD           @VDYY
     C                     KFLD           @VDMM
     C                     KFLD           @VDDD
     C                     KFLD           HNDS38
     C*
     C**  Move program name into *LDA field.
     C                     MOVEL'MM0175'  DBPGM
      *                                                        E14042
     C           *NAMVAR   DEFN SDSTAT    @STATS               E14042
     C*
     C****Call*subroutine*to*access*ICD*file*for*MIDAS*run*date.****      S01194
     C*********************EXSR ZA0150                                    S01194
     C*                                                                   S01194
     C****Check*for*data*base*error.                                      S01194
     C********** *IN80     IFEQ '1'                        B1             S01194
     C**********           MOVE '1'       *INU7            *1             S01194
     C**********           MOVE '1'       *INU8            *1             S01194
     C**********           MOVE '1'       *INLR            *1             S01194
     C*                                                                   S01194
     C** ACCESS BANK DETAILS VIA ACCESS PROGRAM TO GET RUN DATES          S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVE '1'       *INU7            ***************S01194
     C                     MOVE '1'       *INU8            * DB ERROR 003*S01194
     C                     MOVEL'003'     DBASE            ***************S01194
     C                     MOVEL'SDBANKPD'DBFILE                          S01194
     C                     MOVEL@OPTN     DBKEY                           S01194
     C                     EXSR *PSSR                                     S01194
     C*                                                                   S01194
     C                     GOTO #A9                        *1
     C                     END                             E1
      *                                                                                       CDL033
      ** Access Switchable Features file and check if CDL033                                  CDL033
      ** is switched on or not.                                                               CDL033
      *                                                                                       CDL033
     C                     CALL 'AOSARDR0'                                                    CDL033
     C                     PARM *BLANKS   PRTCD   7                                           CDL033
     C                     PARM '*VERIFY' POTPN   7                                           CDL033
     C                     PARM 'CDL033'  PSARD   6                                           CDL033
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL033
      *                                                                                       CDL033
     C           PRTCD     IFEQ *BLANKS                                                       CDL033
     C                     MOVE 'Y'       CDL033  1                                           CDL033
     C                     ELSE                                                               CDL033
     C                     MOVE 'N'       CDL033                                              CDL033
      *                                                                                       CDL033
      ** Database Error, if Return Code is not blanks or *NRF                                 CDL033
      *                                                                                       CDL033
     C           PRTCD     IFNE '*NRF   '                                                     CDL033
     C           *LOCK     IN   LDA                                                           CDL033
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL033
     C                     MOVEL'009'     DBASE                                               CDL033
     C                     MOVEL'CDL033  'DBKEY                                               CDL033
     C                     OUT  LDA                                                           CDL033
     C                     EXSR *PSSR                                                         CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C                     ENDIF                                                              CDL033
      *                                                                   CDL006
      ** Access Switchable Features file to check if Dealing Fiducia      CDL006
      ** ry is installed.                                                 CDL006
      *                                                                   CDL006
     C                     MOVE 'N'       CDL006  1                       CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   WRTCD   7                       CDL006
     C                     PARM '*VERIFY' WOPTN   7                       CDL006
     C                     PARM 'CDL006'  WSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSFDY                           CDL006
      *                                                                   CDL006
     C           WRTCD     IFNE *BLANKS                                   CDL006
     C           WRTCD     ANDNE'*NRF   '                                 CDL006
     C                     MOVEL'004'     DBASE             ************* CDL006
     C                     MOVEL'SCSARDPD'DBFILE            * DBERR 004 * CDL006
     C                     MOVELWRTCD     DBKEY             ************* CDL006
     C                     MOVE *ON       *INU7                           CDL006
     C                     MOVE *ON       *INU8                           CDL006
     C                     MOVE *ON       *INLR                           CDL006
     C                     EXSR *PSSR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C           WRTCD     IFEQ *BLANK                                    CDL006
     C                     MOVEL'Y'       CDL006                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CIR004
      ** Check if Dealing Calculation Method Change is switched ON        CIR004
      *                                                                   CIR004
     C                     MOVE 'N'       CIR004  1                       CIR004
     C                     CALL 'AOSARDR0'                                CIR004
     C                     PARM *BLANKS   WRTCD                           CIR004
     C                     PARM '*VERIFY' WOPTN                           CIR004
     C                     PARM 'CIR004'  WSARD                           CIR004
     C           SCSARD    PARM SCSARD    DSFDY                           CIR004
      *                                                                   CIR004
     C           WRTCD     IFNE *BLANKS                                   CIR004
     C           WRTCD     ANDNE'*NRF   '                                 CIR004
     C                     MOVEL'005'     DBASE             ************* CIR004
     C                     MOVEL'SCSARDPD'DBFILE            * DBERR 005 * CIR004
     C                     MOVEL'CIR004  'DBKEY             ************* CIR004
     C                     MOVE *ON       *INU7                           CIR004
     C                     MOVE *ON       *INU8                           CIR004
     C                     EXSR *PSSR                                     CIR004
     C                     ENDIF                                          CIR004
      *                                                                   CIR004
     C           WRTCD     IFEQ *BLANK                                    CIR004
     C                     MOVEL'Y'       CIR004                          CIR004
     C                     ENDIF                                          CIR004
      *                                                                   CIR004
      ***Call*access*program*for*General*Ledger*details.***************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
     C********** @RTCD     IFNE *BLANK                                             MD035545 MD047993
     C**********           MOVEL'SDGELRPD'DBFILE                                   MD035545 MD047993
     C**********           MOVEL'062'     DBASE                                    MD035545 MD047993
     C**********           MOVEL@OPTN     DBKEY                                    MD035545 MD047993
     C**********           EXSR *PSSR                                              MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD035545
     C/COPY WNCPYSRC,MM0175C003
     C*
     C** Access file containing month shortnames
     C           1         CHAINFDMNTHLL             60
     C*
     C* Record not found database error
     C           *IN60     IFEQ '1'                        B1
     C           MNRCID    ORNE 'MN'                       *********************
     C                     MOVE '001'     DBASE            *                   *
     C                     MOVE 'FDMNTHLL'DBFILE           * DB ERROR 001      *
     C                     MOVE *BLANKS   DBKEY            *                   *
     C                     MOVE '1'       *INU7            *********************
     C                     MOVE '1'       *INU8            *1
     C                     MOVE '1'       *INLR            *1
     C                     GOTO #A9                        *1
     C                     END                             E1
     C*
     C***Move*RUNA*to*Data Structure                                      LN0162
     C*************        MOVE RUNA      @UPDT                           LN0162
     C** Move BJMRDT To Data Structure                                    LN0162
     C                     MOVE BJMRDT    @UPDT                           LN0162
     C                     MOVE BJMRDT    RUNA                            LN0162
     C*
     C** LOCK MPHAS DATA AREA
     C******     *NAMVAR   DEFN           MPHAS                           FA0005
     C******               IN   MPHAS                                     FA0005
     C*
     C** Initialise previous year, month and half-month to zero
     C** and previous currency to blank
     C                     Z-ADD*ZERO     @PYY    40
     C                     Z-ADD*ZERO     @PMM    20
     C                     Z-ADD*ZERO     @PHM    20
     C                     MOVE *BLANK    @PCCY   3
     C*
     C** Convert run date into 8,0 field so that comparison can be made
     C** with dates on file.
     C                     Z-ADD1         @A      30
     C           HVMLUP    LOKUP@MN,@A                   60
     C           @A        MULT 100       @RUNDT  80
     C           @RUNDT    ADD  HVDLUP    @RUNDT
     C*
     C** Check whether century 19 or 20
     C***********RUND      IFGE 10228                      B1             S01194
     C           BJRDNB    IFGE 10228                      B1             S01194
     C           HVYLUP    MULT 10000     @WRK    80       *1
     C                     ADD  20000000  @WRK             *1
     C                     ELSE                            X1
     C           HVYLUP    MULT 10000     @WRK    80       *1
     C                     ADD  19000000  @WRK             *1
     C                     END                             E1
     C           @RUNDT    ADD  @WRK      @RUNDT
     C*
     C           #A9       ENDSR                           **#A9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #C                - Termination processing                    *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  MAIN   - Main controlling routine.                 *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C           #C        BEGSR
     C*
     C** If database error has not occurred, execute final change
     C** of date processing, otherwise set termination parameter
     C** to 'E'
     C           *INU7     IFNE '1'                        B1
     C                     EXSR #ZBA                       *1
     C                     END                             X1
     C           *LOCK     IN   @STATS                              E14042
     C                     MOVE @SUBMN    @SUBM1  10                E14042
     C                     SUB  1         @SUBM1                    E14042
     C                     MOVE @SUBM1    @SUBMN                    E14042
     C           *INU7     IFEQ '1'                        B1       E14042
     C                     MOVE 'E'       @TERM            *1
      *  Flag Stream in error, send Message                         E14042
     C                     MOVE 'X'       @STRM2           *1       E14042
     C*********************CALL 'QCAEXEC'                  *1       E14042E20774
     C                     CALL 'QCMDEXC'                  *1             E20774
     C                     PARM           @CM,1            *1       E14042
     C                     PARM 80        @QCALN 155       *1       E14042
     C                     END                             E1       E14042
     C                     OUT  @STATS                              E14042
     C           *INU7     IFEQ '1'                        B1       E14042
     C                     DUMP                            *1       E14042
     C                     END                             E1       E14042
     C*
     C           #C9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C********                                                        *   S01194
     C********SUBROUTINE ZA0150 - THIS SUBROUTINE CHAINS TO FILE LF/  *   S01194
     C********FDICDRLL TO GET THE INSTALLATION CONTROL DETAILS RECORD *   S01194
     C********1 (HELD ON PF/TABTB10)                                  *   S01194
     C********INDICATOR 80 IS SET ON IF THE CHAIN FAILS OR THE RECORD *   S01194
     C********IS FLAGGED FOR DELETION.                                *   S01194
     C********IF INDICATOR 80 IS SET ON DETAILS OF THE ATTEMPTED      *   S01194
     C********ACCESS ARE PLACED IN THE LDA.                           *   S01194
     C********                                                        *   S01194
     C********FIELDS USED : SS0150 - KEY USED TO ACCESS FDICDRLL      *   S01194
     C********                                                        *   S01194
     C*****************************************************************   S01194
     C********                                                            S01194
     C********   ZA0150    BEGSR                                          S01194
     C********                                                            S01194
     C***SET*UP*KEY*TO*OBTAIN*FORMAT*TABTB10F '01        10'              S01194
     C********             MOVEL'01'      SS0150 12                       S01194
     C********             MOVE '10'      SS0150                          S01194
     C********                                                            S01194
     C***CHAIN*TO*FILE*FDICDRLL*********                                  S01194
     C********   SS0150    CHAINFDICDRLL             80                   S01194
     C********   RECI      IFNE 'D'                        B1             S01194
     C********             MOVE '1'       *IN80            *1             S01194
     C********             END                             E1             S01194
     C********                                                            S01194
     C***DEAL*WITH*DATA*BASE*ERROR******                                  S01194
     C********   *IN80     IFEQ '1'                        ***************S01194
     C********             MOVEL'FDICDRLL'DBFILE           *             *S01194
     C********             MOVEL'900'     DBASE            * DBERROR 900 *S01194
     C********             MOVELSS0150    DBKEY            *             *S01194
     C********             END                             ***************S01194
     C********                                                            S01194
     C********   ZA0159    ENDSR                                          S01194
     C*****************************************************************   S01194
     C/EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZDAT10Z2                                               056095
     C*******************************************************************
     C***********                                                         056095
     C**ZA0680*-*THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO         056095
     C***********MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)         056095
     C***********                                                         056095
     C**CALLED*BY :                                                       056095
     C***********                                                         056095
     C**CALLS*:**                                                         056095
     C***********                                                         056095
     C**INPUT**:*@@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   056095
     C***********                                                         056095
     C**OUTPUT*:*@@MDNO MIDAS DAY NUMBER  (SIZE : 5N)                     056095
     C***********                                                         056095
     C**USES*:***@@CC   NUMBER OF CENTURIES IN DATE                       056095
     C***********@@DAY  DAY NUMBER                                        056095
     C***********@@REM  REMAINDER FROM DIVIDE                             056095
     C***********@@MTH  MONTH NUMBER                                      056095
     C***********@MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       MONTH                                             056095
     C***********@@WK2  WORK FIELD (2,0)                                  056095
     C***********@@WK5  WORK FIELD (5,0)                                  056095
     C***********@@YYYY YEAR (4 CHARACTER)                                056095
     C***********@@YY   YEAR (2 CHARACTER)                                056095
     C***********@YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       A FOUR YEAR PERIOD                                056095
     C***********                                                         056095
     C******LAST*AMEND NO. ME1257              DATE 02/04/87            * 056095
     C******When*date input is zero set output date to zeroes           * 056095
     C***********                                                         056095
     C******************************************************************* 056095
     C***********                                                         056095
     C***********ZA0680    BEGSR                                          056095
     C***********                                                         056095
     C****CLEAR*OUT ANY 'OLD' DATA IN FIELD                               056095
     C***********          Z-ADD0         @@MDNO  50                      056095
     C***********                                                         056095
     C***********@@DTIN    CABEQ0         ZA0689                    ME1257056095
     C***********                                                         056095
     C*****IF*DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING          056095
     C*****WORK*OUT THE NUMBER OF CENTURIES PASSED SINCE 1971,            056095
     C*****BY*SUBTRACTING 1972 FROM THE YEAR FIELD.                       056095
     C***********@@YYYY    IFGE 2072                       B1             056095
     C***********@@YYYY    SUB  1972      @@YYYY           *1             056095
     C***********                                                         056095
     C*****MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)             056095
     C*****THEN*RESTORE THE YEAR WHICH WAS INPUT BACK TO THE              056095
     C*****ORHNINAL VALUE BEFORE CONTINUING WITH NORMAL CALCULATIONS.     056095
     C***********                                                         056095
     C***********@@CC      MULT 36524     @@MDNO           *1             056095
     C***********@@YYYY    ADD  1972      @@YYYY           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C***********@@YYYY    ADD  28        @@WK2   20                      056095
     C***********                                                         056095
     C***********@@WK2     DIV  4         @@WK2                           056095
     C***********          MVR            @@REM   10                      056095
     C***********                                                         056095
     C******MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD                056095
     C***********@@WK2     MULT 1461      @@WK5   50                      056095
     C***********          ADD  @@WK5     @@MDNO                          056095
     C***********                                                         056095
     C****CHECK*REMAINDER AND MONTH NUMBER                                056095
     C***********@@REM     IFEQ 0                          B1             056095
     C***********@@MTH     ANDGT2                          B1             056095
     C***********          ADD  1         @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****YEAR*NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR               056095
     C***********@@REM     IFNE 0                          B1             056095
     C***********          ADD  @YD,@@REM @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****ADD*MONTHS THIS YEAR                                            056095
     C***********          ADD  @MD,@@MTH @@MDNO                          056095
     C***********                                                         056095
     C****ADD*DAYS THIS MONTH                                             056095
     C***********          ADD  @@DAY     @@MDNO                          056095
     C***********                                                         056095
     C***********ZA0689    ENDSR                           **ZA0689 TAG** 056095
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR    - Error routine performed on program error           *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @ERR1  - Error field 1                             *
     C*            @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C** SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR1     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR1   1        *1
     C                     MOVE '1'       *INU6            *1
     C*
     C** SET UP FIELDS IN LOCAL DATA AREA
     C                     MOVEL'MM0175'  DBPGM            *1
     C                     MOVEL'991'     DBASE            *1
      *                                                             E14042
      *  Reduce no of submitted jobs, flag error.                   E14042
     C           *LOCK     IN   @STATS                     *1       E14042
     C                     MOVE @SUBMN    @SUBM1  10       *1       E14042
     C                     SUB  1         @SUBM1           *1       E14042
     C                     MOVE @SUBM1    @SUBMN           *1       E14042
      *  Flag Stream in error, send Message                         E14042
     C                     MOVE 'X'       @STRM2           *1       E14042
     C*********************CALL 'QCAEXEC'                  *1       E14042E20774
     C                     CALL 'QCMDEXC'                  *1             E20774
     C                     PARM           @CM,1            *1       E14042
     C                     PARM 80        @QCALN 155       *1       E14042
     C                     OUT  @STATS                     *1       E14042
     C*
     C                     DUMP                            *1
     C                     MOVE 'E'       @TERM                     E14042
     C                     END                             E1
     C*
     C** TERMINATE THE PROGRAM
     C*******************  MOVE 'E' ****  @TERM  *******************E14042
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* INFSR    - Error routine performed on file error              *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @ERR2  - Error field 2                             *
     C*            @FILE  - File in which file error occurred         *
     C*            @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C           INFSR     BEGSR
     C*
     C** SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR2     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR2   1        *1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C*
     C** SET UP FIELDS IN LOCAL DATA AREA
     C                     MOVE @FILE     DBFILE           *1
     C                     MOVEL'MM0175'  DBPGM            *1
     C                     MOVE '992'     DBASE            *1
      *  Reduce no of submitted jobs, flag error.                   E14042
     C           *LOCK     IN   @STATS                     *1       E14042
     C                     MOVE @SUBMN    @SUBM1  10       *1       E14042
     C                     SUB  1         @SUBM1           *1       E14042
     C                     MOVE @SUBM1    @SUBMN           *1       E14042
     C                     MOVE 'X'       @STRM2           *1       E14042
     C                     OUT  @STATS                     *1       E14042
      *  Send Error Message                                         E14042
     C*********************CALL 'QCAEXEC'                  *1       E14042E20774
     C                     CALL 'QCMDEXC'                  *1             E20774
     C                     PARM           @CM,1            *1       E14042
     C                     PARM 80        @QCALN 155       *1       E14042
     C*
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C** TERMINATE THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     MOVE 'E'       @TERM
     C                     RETRN
     C*
     C                     ENDSR
     O/EJECT
     O** DEAL*TYPES*ARRAY*@NA*-*Loans                                     S01149
     O* IPTLCPCLDL                                                        S01149
      *************                                                       S01279
      * TM2038 - REMOVED DISCOUNTED BILLS, DEAL TYPE BI, FROM ARRAY       S01279
      *          @INA SO IT IS PROCESSED AS A DISCOUNTED NA               S01279
      *************                                                       S01279
      *****************************************************************
      *   The array @YD and @MD are now being used by SR. ZDATE9      *   056095
      *   before they are being used by SR. ZA0710.  The actual       *   056095
      *   changes were only made on the text, ZA0710 was changed      *   056095
      *   to ZDATE9.                                                  *   056095
      *****************************************************************   056095
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
** DEAL TYPES ARRAY @NA - Loans & NA's                                    S01149
IPTLCPCLDLC1C2BOBITBBATAFLDPLP                                     S01149 CDL006
** @ANYNA DEAL TYPE ARRAY  - all N/A deal types                           S01149
C1C2BOBITBBATA                                                            S01149
** @INA DEAL TYPE ARRAY  - interest bearing N/A deal types                S01149
C1C2BO                                                             S01149 S01279
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**       @CM      Messages when error
SNDMSG  ('MM0175 has ended abnormally in batch.') TOMSGQ(MOPERQ)
