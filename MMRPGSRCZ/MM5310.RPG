     H**********                                                                    190336
     H        1   Y                                                                 190336
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Rollover deals maintenance subfile')          *
      *****************************************************************
      *                                                               *
      *  Midas - ROLLOVER DEAL                                        * *
      *                                                               *
      *    MM5310  - ROLLOVER DEALS MAINTENANCE                       *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CDL096             Date 22Sep14               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      *                 CDL093             Date 08Apr14               *
      *                 CSD095             Date 08Apr14               *
      *                 AR996895           Date 25Nov12               *
      *                 CRE073             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CDL081             Date 14Dec09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 243842             Date 29Nov06               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL013             Date 08Jun06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 237063             Date 20Nov05               *
      *                 CDL038             Date 10May05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 CSD025             Date 11Jan05               *
      *                 CDL031             Date 05Dec04               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 188500             Date 26Apr02               *
      *                 197434             Date 09Oct01               *
      *                 179480             Date 11Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAS001             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 04Oct01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 190336             Date 17Feb01               *
      *                 124141             Date 20Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 173661             Date 17Aug00               *
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CGL011             Date 20Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 163136             Date 07Jul99               *
      *                 138751             Date 28Apr99               *
      *                 145001              Date 19Oct98              *
      *                   144833              Date 14Oct98            *
      *                   144199              Date 05Oct98            *
      *                   144033              Date 02Oct98            *
      *                   143525              Date 24Sep98            *
      *                   CEU015              Date 19Jun98            *
      *                   125410              Date 16Jun98            *
      *                   CAP002              Date 01May98            *
      *                   S01408              DATE 25Nov97            *
      *                   126017              DATE 18NOV97            *
      *                   097885              DATE 03FEB97            *
      *                   S01408              DATE 08AUG96            *
      *                   CAC001              DATE 01FEB96            *
      *                   S01408              DATE 24APR96            *
      *                   S01408              DATE 19APR96            *
      *                   093842              DATE 02OCT95            *
      *                   095244              DATE 01NOV95            *
      *                   095238              DATE 31OCT95            *
      *                   089846              DATE 20OCT95            *
      *                   087656              DATE 20OCT95            *
      *                   088132              DATE 07JUN95            *
      *                   083686              DATE 21JUN95            *
      *                   085348              DATE 06JUN95            *
      *                   084206              DATE 20APR95            *
      *                   077895              DATE 20APR95            *
      *                   080603              DATE 16MAR95            *
      *                   084171              DATE 15MAR95            *
      *                   S01408              DATE 22FEB95            *
      *                   079570              DATE 21DEC94            *
      *                   079156              DATE 19DEC94            *
      *                   077556              DATE 19DEC94            *
      *                   076469              DATE 04NOV94            *
      *                   066160              DATE 07FEB94            *
      *                   066162              DATE 07FEB94            *
      *                   066154              DATE 07FEB94            *
      *                   066161              DATE 02FEB94            *
      *                   066153              DATE 02FEB94            *
      *                   066157              DATE 02FEB94            *
      *                   S01434              DATE 01SEP93            *
      *                   049421              DATE 19JAN93            *
      *                   ROLLOV              DATE 19JAN93            *
      *                   039187 ADI          DATE 04SEP92            *
      *                   B10068 PT           DATE 09OCT91            *
      *                   B9893_TL            DATE 18SEP91            *
      *                   B9684_TL            DATE 11SEP91            *
      *                   B4924_TL            DATE 23AUG91            *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CDL093 - MM Interest calculation type 9.                     *
      *         - Add call to ZFEB29                                  *
      *  CSD095 - Allow Deal Sub-Type and Branch for MM and FX SSIs   *
      *           (Recompile)                                         *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus                                      *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CDL081 - Tiered withholding tax rounding upgrade             *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  243842 - Prevent looping when daily accrual and rollover     *
      *           frequency is 'A'.                                   *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL013 - Tiered Withholding Tax                              *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  CSD025 - Customer De-Activation                              *
      *  CDL031 - Effective Date on Extended SSI (Recompile)          *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines                                        *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.                                     *
      *  188500 - Program should consider American date format.       *
      *  197434 - Array index error on SF0021. Increase maximum       *
      *           number of branches from 100 to 900.                 *
      *  179480 - Access SDRETLPD only if retail module is on.        *
      *  CAS001 - Net Present Value (NPV) Accounting                  *
      *  CPK014 - Release 4 packaging.  Rename of field which is too  *
      *           long for OPM program.                               *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  190336 - Wrong fields shown in reverse image when problem    *
      *           with DEAL NBR generation                            *
      *  124141 - Default the Total Interest for Deals using Base     *
      *           Rate + Spread.                                      *
      *         - Allow update of Base Rate Code + Spread.            *
      *           CEU015 has added this processing for rollover of    *
      *           deals to Euro; this processing has been extended    *
      *           to all rollovers.                                   *
      *           Note - this fix was originally applied to the pre   *
      *                  CEU015 version of this pgm and has been      *
      *                  upgraded to Int Rel 9.                       *
      *  173661 - Deals were allowed to be rolledover twice due to    *
      *           ROLBK command clearing the lock status of the       *
      *           record.                                             *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to ZINTDY changes                    *
      *  CGL011 - Collateral Processing for Midas                     *
     F*  163136 - Interest Calculation Method '6'  showing incorrect -*
     F*           ZERO - amount . Addition to Core #126017 which dealt*
     F*           with the issue. It introduced an additional  INT6DY *
     F*           field in s-routine ZINTDY in  /COPY ZSRSRC/ZINTDYZ2 *
     F*           which in turn is usually called from GLINTC s-routine
     F*           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
     F*           least a dozen other pgms that use ZINTDY but do     *
     F*           GLINTC-processing within the pgms calculation specs *
     F*  138751 - Validation of HKROBY & HKRBSI fields which indicate *
     F*           that the Deal has already been rolled-over and the  *
     F*           subsequent issue of an error msg is done ONLY if    *
     F*           @MBIN='Y' i.e. if it is Multibranching enviroment.  *
     F*           In Single-Branch envirom. the Deal is allowed to be *
     F*           rolled-over more than once. This validation should  *
     F*           be performed in both cases .                        *
      *    145001 - CEU015 fix: Store the original currency           *
      *             equivalent of the new deals principal amount      *
      *             to a new field (HKORDA). This new field will      *
      *             be used in MM0089/MM0081 to update the RBDA       *
      *             of the rolled over deal.                          *
      *             This is to avoid converting back procedures in    *
      *             COB and cost 0.01 of a unit.                      *
      *             Also when deal is matured, do not output          *
      *             MMM2705 but output MMM0687 instead (a correction  *
      *             to 144033)                                        *
      *    144833 - When rolling over from an 'in' currency to        *
      *             Euros (Action code 'C'), default Interest         *
      *             Settlement Currency to blank. Also if call to     *
      *             MM0089 ends in error, let the user know.          *
      *    144199 - 1) Include currency as hidden field on subfile    *
      *                record and use this to validate action         *
      *                code when input comes from selected subfile    *
      *                record.                                        *
      *             2) Call EU0200 when action code is 'C' and        *
      *                currency is a valid 'in' ccy. This is to avoid *
      *                error when the usual rollover is made.         *
      *    144033 - Put a more descriptive error message to           *
      *             refuse input of a deal already rollovered.        *
      *    143525 - CEU015 fix: Default base currency rate to         *
      *             Euro currency spot rate when rolling over         *
      *             from an 'in' currency deal to a Euro deal.        *
      *    CEU015 - EMU Enhanced MM Deal Rollover                     *
      *    125410 - Do not allow the roll over of Internal Funding .  *
      *    CAP002 - Recompiled as part of conversion of Midas inputs  *
      *             to modular API structure.                         *
      *    S01408 - Addition of missing core hook MM5310C004          *
      *    126017 - Correction to interest calculation for calculation*
      *             basis 6 in SR/GLINTC - recompile program.         *
      *    097885 - Recompiled for wrong calculation of number of day *
      *             interest (ZINTDYZ2).                              *
      *    S01408 - Addition of core hook MM5310CP11                  *
      *             Addition of core hook MM5310CP10                  *
      *             Addition of core hook MM5310CCP9                  *
      *             Addition of core hook MM5310CCP8                  *
      *             Addition of core hook MM5310CCP7                  *
      *             Addition of core hook MM5310CCP6                  *
      *    CAC001 - Profit Centre Accounting Development:             *
      *             Recompiled only.                                  *
      *    S01408 - Addition of core hook MM5310FFP1                  *
      *             Addition of core hook MM5310CCP5                  *
      *             Addition of core hook MM5310CCP4                  *
      *    S01408 - Addition of core hook MM5310CCP2                  *
      *             Addition of core hook MM5310CCP3                  *
      *    093842 - Program cannot recognise the deal whether rolled  *
      *             over or not when checking HKROBY.  As the deals   *
      *             from S/36 contains all zeros, the pgm should      *
      *             check for both blank or zero, instead of just     *
      *             zero when sending err msg MM0687.                 *
      *  095244 - Recompiled for Calculation method 3                 *
      *  095238 - Recompiled for Calculation method 3                 *
      *    089846 - Session or Device error occured in this program.  *
      *             *IN41 is not properly initialised.                *
      *    087656 - Error on maturity date shown on next screen       *
      *    088132 - Program loops in *PSSR, unable to access LDA.     *
      *    083686 - Allow a non-automatic rollover deal to be rolled  *
      *             over                                              *
      *    085348 - SPF Validation Error:  User not allowed for       *
      *             particular branch still can display deals to be   *
      *             rolled over for that branch.                      *
      *    084206 - The allocated deal number is not reactivated if   *
      *             F3 is pressed at LDNI input if this program has   *
      *             allocated the deal number automatically.  The     *
      *             file update for deal number ranges is not rolled  *
      *             back.                                             *
      *    077895 - Apply fix E17279 and E23032 to allow 'M' for      *
      *             million and 'T' for thousand                      *
      *    080603 - Subtract Interest Tax from Rollover Principal     *
      *    084171 - 'Total Midas int.' rather than 'Int. at maturity' *
      *             used in new principal calcs when int. is negative *
      *    S01408 - Addition of core hook MM5310CIRE                  *
      *             Addition of core hook MM5310CIR1                  *
      *             Addition of core hook MM5310CISH                  *
      *             Addition of core hook MM5310CCPG                  *
      *             Addition of core hook MM5310CCP1                  *
      *             Addition of core hook MM5310CIR2                  *
      *             Addition of core hook MM5310CPCK                  *
      *             Addition of core hook MM5310CPC1                  *
      *             Addition of core hook MM5310IIPG                  *
      *    079570 - Stop Deal number increasing automatically for     *
      *             each re-display of the Rollover input screen.     *
      *             Fix display attributes on Interest rate field.    *
      *             Allow Branch subfile selection to process.        *
      *             Validate Deal number input.                       *
      *    079156 - IF A BACK VALUED DEAL IS ENTERED TODAY THEN ALLOW *
      *             IT TO BE ROLLED OVER                              *
      *    076469 - Device error on empty subfile                     *
      *    066160 - SETTING UP INTEREST RATE USING MATURITY DATE OF   *
      *             NEW DEAL AND INTERPOLATING IF NECESSARY           *
      *    066162 - ROLLUP AND DOWN CORRECTLY                         *
      *    066154 - SUBFILE SHOULD BE BY BRANCH                       *
      *    066161 - COMMAND 12 SHOULD RESET SUBFILE BACK TO START     *
      *    066153 - IGNORE CALL LOANS AND DEPOSITS                    *
      *    066157 - RECOMPILED OVER MMDELDL1 -                        *
      *           - IGNORE NON AUTOROLL DEALS                         *
      *    S01434 - ROLLOVER ENHANCEMENT                              *
      *    049421 - HEADER BOX STANDARDISATION                        *
      *    ROLLOV - WRITTEN FOR ROLLOVER DEALS                        *
      *    B10068 - REMOVE OF B9893                                   *
      *    B9893 - WRONG SET UP FOR ROLLOVER INDICATOR                *
      *    B4924 - FIELD FOR ROLLED OVER BY IS NOT SET UP.            *
      *    B9684 - NEW DEAL NUMBER RANGE NOT CHECKED                  *
      *****************************************************************
     FMM5310DFCF  E                    WORKSTN
     F                                        RRN   KSFILE MM5310S0
     F*SDDLNOPDIF  E                    DISK                               B9684
     F*                                DEAL NUMBER RANGES
     FFDDLNMLLIF  E                    DISK         KINFSR *PSSR           B9684
     F*                                DEAL NUMBER RANGES                  B9684
     F***MMSSTSLLIF**E***********K        DISK                            S01434
      *
     F***RECORD*ID*OF*FILE*SDBANKPD = 'BJ'                                S01434
     F***SDBANKL1IF**E***********K        DISK                            S01434
     F***************************                   KINFSR *PSSR          S01434
     F***MMUSERLLIF**E***********K        DISK                            S01434
     F***************************                   KINFSR *PSSR          S01434
     F***TABTB11*IF**E***********K        DISK                            S01434
      *
     F***TABLETJ*IF**E***********K        DISK                            S01434
      *
     F***MMDELDY0IF**E***********K        DISK      KINFSR *PSSR          S01434
     F***MMDELDL1UF**E***********K        DISK      KINFSR *PSSR A        S01434
     FMMDELDL1IF  E           K        DISK         KINFSR *PSSR          S01434
     F            MMDELDP0                          KRENAMEMMDELDPY
     F**********  MMDENSP0                          KIGNORE
     F**********  MMDENBP0                          KIGNORE
     F                                              KCOMIT
     FCADENQLLIF  E           K        DISK
     F                                              KINFSR *PSSR
     F            MMDELDP0                          KRENAMEMMDELDPX
     F            MMDENBP0                          KRENAMEMMDENBPX
     F            MMDENSP0                          KRENAMEMMDENSPX
     FDEALS   IF  E           K        DISK                               39187
     F            DEALSDAF                          KIGNORE               39187
     F            DEALSDFF                          KIGNORE               39187
     FDEALSH  IF  E           K        DISK                               39187
     F            DEALSDBF                          KRENAMEDEALSHBF       39187
     F            DEALSDCF                          KRENAMEDEALSHCF       39187
     F            DEALSDDF                          KRENAMEDEALSHDF       39187
     F            DEALSDEF                          KRENAMEDEALSHEF       39187
     F            DEALSDGF                          KRENAMEDEALSHGF       39187
     FCADLFALLUF  E                    DISK         KINFSR *PSSR          S01434
     F*                                             KCOMIT                S01434
     F                                              KCOMIT                084206
     FDLINTRL2IF  E           K        DISK                               S01434
     FDLINTRL1IF  E           K        DISK                               066160
     F            FDINTRP0                          KRENAMEFDINTRP1       066160
     FMMDEALLLUF  E           K        DISK         KINFSR *PSSR A        S01434
     F*                                             KCOMIT                S01434
     F                                              KCOMIT                077556
     FSDCBRTL1IF  E           K        DISK         KINFSR *PSSR          080603
     FSDBRTDL1IF  E           K        DISK         KINFSR *PSSR          080603
     F*                                                                   CEU015
     FSDEXSTL1IF  E           K        DISK         KINFSR *PSSR          CEU015
      *                                                                                       CDL013
     FSDSTAAL1IF  E           K        DISK         KINFSR *PSSR      UC                      CDL013
      ** Withholding Tax ICD extension file                                                   CDL013
     F*                                                                   S01408
     F/COPY WNCPYSRC,MM5310FFP1                                           S01408
     F*                                                                   S01408
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       07         START  SCREEN
     F*       08         REVIEW SCREEN
     F*       09         UPDATE SCREEN
     F*
     F*       10         MULTIBRANCHING ON                                066154
     F*       15         INDICATOR USED ON WRITE/UPDATE OPS TO CONDITION
     F*                                    CALL OF *PSSR
     F*       30         S/MM5310F1  PROTECT/NON-DISPLAY KEY FIELDS
     F*       31         S/MM5310F1  ERROR-DDACTN
     F*       32         S/MM5310F1  ERROR-DDDCCO
     F*       33         S/MM5310F1  ERROR-DDBRCA                         066154
     F*       35-->39    S/MM5310F0  PROTECT DETAIL FIELDS
     F*       40         LOKUP FOUND AN ORIGINATING BRANCH                066154
     F*       41         WARNING ERROR MSG FOR MSGD MMM0679               S01434
     F*       42         Branch selected via Branch selection prompt      079570
     F*       43         S/MM5310F4  DISPLAY FIELDS IF CEU015 AND         CEU015
     F*                              ACTION CODE C                        CEU015
     F*       44         S/MM5310F4  INVALID INTEREST CALC METHOD         CEU015
     F*       46         S/MM5310F4  INVALID BASE RATE CODE               CEU015
     F*       47         S/MM5310F4  INVALID SPREAD                       CEU015
     F*       50         S/MM5310C0  SFLDSP
     F*       51         S/MM5310C0  SFLDSPCTL
     F*       52         S/MM5310C0  SFLEND
     F*       53         S/MM5310C0  ROLLDOWN NOT ALLOWED
     F*
     F*
     F*       45         VLDCMDKY INDICATOR FOR DISPLAY FILE
     F*
     F*       60         SWITCH ON DISPLAY FIELD : DDINTR                 S01434
     F*       61         SWITCH ON DISPLAY FIELDS: DDSPRD/DDBSRC          S01434
     F*       62         ERROR IND. FOR ALPHA/NUM TRANSLATION             S01434
     F*       64         CHAIN ON DLINTRL2                                S01434
     F*       65         READ PREV ON DLINTRL2                            S01434
     F*                                                                   S01434
     F*       70         MMDEALLL CHAIN FILE OPERATION                    S01434
     F*       71         LOKUP OPERATION
     F*       72         FILE OPERATION
     F*       73         FILE OPERATION
     F*       74         FILE OPERATION
     F*       75         ERROR ON SCREEN
     F*       76         FILE OPERATION                                   080603
     F*
     F*       80         TESTN OPERATION
     F*       87         CHAIN ON EXTENSION FILE
     F*       88         DLNO IN VALID RANGE
     F*       89         READ SDDLNOPD
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F*
     F*       03         CA3
     F*       10         CA10
     F*       12         CA12
     F*       25         ROLLUP
     F*       26         ROLLDOWN
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   ..   04   05   06   ..   ..   ..   .. *
     F**      * 11   ..   13   14   ..   16   17   18   19   20 *
     F**      * 21   22   23   24   ..   ..   27   28   29   .. *
     F**      * ..   ..   ..   34   ..   ..   ..   ..   ..   .. *
     F**      * ..   ..   43   44   ..   46   47   48   49   .. *
     F**      * ..   ..   ..   54   55   56   57   58   59   .. *
     F**      * ..   ..   ..   ..   ..   66   67   68   69   .. *
     F**      * ..   ..   ..   ..   ..   ..   77   78   79   .. *
     F**      * 81   82   83   84   85   86   ..   ..   ..   .. *
     F**      * ..   ..   ..   ..   ..   96   97   ..   ..      *
     F**      ***************************************************
     F*********************************************************************
     E*                                                                   S01434
     E                    DSP         3  1               DSP GROUP INPUT
     E                    M      12  12  3               MONTH IN 3 CHAR.
     E                    @YD     4   4  5 0A            ZA0710 ARRAY
     E                    @MD    13  13  5 0A            ZA0710 ARRAY
     E                    @F         16  1               ZA0840 ARRAY
     E                    @G         16  1               ZA0840 ARRAY
     E                    @H      1  15 15 0             ZA0840 ARRAY
     E                    ZHC        50  3               ZDATE5 ARRAY
     E**********          ZOB       100  3               ORIG BRCH ARRAY               066154 197434
     E                    ZOB       900  3               ORIG BRCH ARRAY                      197434
     E/COPY WNCPYSRC,MM5310E001
     E*                                                                   S01434
     E***********         ZS1        15  1 0             ZSEDIT ARRAY     S01434
     E***********         ZS2        21  1               ZSEDIT ARRAY     S01434
     E/COPY ZSRSRC,ZHOLE                                                  S01434
     E*                                                                   S01434
     E/COPY ZSRSRC,ZSEDITZ1                                               S01434
     E*                                                                   S01434
     E                    ZFMD   12  12  2               ZFREQ SR. ARRAY
     E***********         ZYDY    4   4  4 0             ZDATE1 YEAR      S01434
     E***********         ZMDY   13  13  3 0             ZDATE1 MONTH     S01434
     E***********         ZMNM   12  12  3               ZDATE2 SR. ARRAY S01434
     E/COPY ZSRSRC,ZDATE2Z1                                               S01434
     E*                                                                   S01434
     E                    CPY@    1   1 80
     E*
     E/COPY ZSRSRC,ZEDITZ1                                                S01434
     E*                                                                   S01434
      /EJECT
      *                                                                                       CPK014
     IFDINTRP0                                                                                CPK014
     I              HWTMESTMP                       HWTMST                                    CPK014
     IFDINTRP1                                                                                CPK014
     I              HWTMESTMP                       HXTMST                                    CPK014
     I*                                                                   080603
     I**  Rename fields to differentiate DEALSDC from SDBRTDL1 fields.    080603
     I*                                                                   080603
     ISDBRTDD0                                                            080603
     I              LCD                             BRTLCD                080603
     I              LCT                             BRTLCT                080603
     I              CHTP                            BRCHTP                080603
     I** KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
     I*
     ISCRCTL      DS
     I                                        1   1 WWREVW
     I                                        2   2 DDACTN
     I*                                       3   8 DDDLNO
     I                                        9  11 DDBRCA                066154
     I***********                             9  14 DDPKEY                S01434
     I***********                            15  20 WWPAG1                S01434
     I***********                            21  26 WWPAG2                S01434
     I*
     I*    MIDAS 'Next Available Transaction No.' Data Area  MNATN .
     IDNATN       DS                              5
     I                                        1   50FNATN
     I*
     I**  DATA STRUCTURE FOR SR. ZA0680 - DATE INPUT TO SUBROUTINE
     I            DS
     I                                        1   80@@DTIN
     I                                        1   40@@YYYY
     I                                        3   40@@YY
     I                                        1   20@@CC
     I                                        5   60@@MTH
     I                                        7   80@@DAY
     I            DS
     I**  Data structure for SR. ZA0710 - field is @@Z71Y
     I                                        1   40@@Z71Y
     I                                        1   10@@SSY1
     I                                        2   20@@SSY2
     I                                        3   30@@SSY3
     I                                        4   40@@SSY4
     I*
     I            DS
     I**  Data structure for SR. ZA0710 - field is @@VDT
     I                                        1   80@@VDT
     I                                        1   40@@YR
     I                                        5   60@@Z71M
     I                                        7   80@@Z71D
     I*
     I*    NUMERIC ARRAY DS DEFINITION
     I            DS
     I                                        1   2 WWWORK
     I                                        1   1 WWORK1
     I                                        2   2 WWORK2
     I*
     I            DS
     I                                        1   6 DDDLNO
     I                                        1   60DDDLNN
     I*
     I            DS
     I                                        1   6 DDDLN2
     I                                        1   60DDDL2N
     I*
     I            DS
     I                                        1   20WWDMAT
     I                                        3   40WWMMAT
     I                                        5   60WWYMAT
     I                                        1   6 DDNMAT
     I                                        1   60DDNMAN
     I*
     I            DS
     I                                        1   2 DSDMAT
     I                                        3   5 DSMMAT
     I                                        6   7 DSYMAT
     I                                        1   7 DSDATE
     I*
     I            DS
     I                                        1   20HKMDDD
     I                                        3   40HKMDMM
     I                                        5   6 HKMDY2
     I                                        1   60WWNMAT
     I*
     IWWDATE      DS                                                      S01434
     I                                        1   20WWDLUP
     I                                        3   5 WWMLUP
     I                                        6   70WWYLUP
     I***********                             1   7 BJMRDT                S01434
     I*
     I*  DATA STRUCTURE TO REDEFINE OLD MATURITY DATE
     I            DS
     I                                        1   8 DSMDAT
     I                                        1   4 DSMDYY
     I                                        5   6 DSMDMM
     I                                        7   8 DSMDDD
     I*
     I*  DATA STRUCTURE TO REDEFINE NEW MATURITY DATE
     I            DS
     I                                        1   8 WWNMA8
     I                                        1   4 WWMDYY
     I                                        5   6 WWMDMM
     I                                        7   8 WWMDDD
     I*
     I*
     I*  DATA STRUCTURE TO REDEFINE OLD MATURITY DATE FOR TESTING
     I            DS
     I                                        1   40HHMDYY
     I                                        5   60HHMDMM
     I                                        7   80HHMDDD
     I                                        1   80MDAT8
     I*                                                                   079156
     I** DATA STRUCTURE TO REDEFINE OLD TRANSACTION DATE FOR TESTING      079156
     I*                                                                   079156
     I            DS                                                      079156
     I                                        1   40HHDTYY                079156
     I                                        5   60HHDTMM                079156
     I                                        7   80HHDTDD                079156
     I                                        1   80ORED8                 079156
     I*
     I*  DATA STRUCTURE TO DISPLAY NEW MATURITY DATE
     I            DS
     I                                        1   6 WWODAT
     I                                        1   2 WWODD
     I                                        3   4 WWOMM
     I                                        5   6 WWOYY
     I*
     I****DATA*STRUCTURE*FOR*SR/ZSEDIT************************************S01434
     I*********** DS                                                      S01434
     I***********                             1  150WORK15                S01434
     I***********                             1  150ZS1                   S01434
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     I***LDA********UDS                            256                    S01434
     ILDA         DS                            256                       S01434
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I*
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     IPSDS       SDS
     I/COPY WNCPYSRC,MM5310I001
     I                                      244 253 WSID
     I                                      254 263 USID
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                   066154
     I** DATA STRUCTURE FOR RUN DATE                                      066154
     I*                                                                   066154
     IRUNDAT      DS                                                      066154
     I                                       13  13 @MBIN                 066154
     I*                                                                   066154
     I** DATA STRUCTURE ABOUT USER                                        066154
     I*                                                                   066154
     IZMUSER      DS                             17                       066154
     I                                        1  10 ZUSER                                     CDL010
     I                                       11  13 BRC                   066154
     I*                                                                   066154
     I** DATA STRUCTURE ABOUT USER ORIGINATING BRANCHES                   066154
     I*                                                                   066154
     IZOBU        DS                                                      066154
     I                                        2   4 ZINO                  066154
     I                                        5 154 ZOB1                  066154
     I                                      155 304 ZOB2                  066154
      *                                                                                       197434
     IZOBU1       DS                                                                          197434
      *                                                                                       197434
      ** Originating Branches 1                                                               197434
      *                                                                                       197434
     I                                        1 255 ZOB11                                     197434
     I                                      256 510 ZOB12                                     197434
     I                                      511 765 ZOB13                                     197434
     I                                      7661020 ZOB14                                     197434
     I                                     10211275 ZOB15                                     197434
     I                                     12761530 ZOB16                                     197434
     I                                     15311785 ZOB17                                     197434
     I                                     17861998 ZOB18                                     197434
      *                                                                                       197434
     IZOBU2       DS                                                                          197434
      *                                                                                       197434
      ** Originating Branches 2                                                               197434
      *                                                                                       197434
     I                                        1 255 ZOB21                                     197434
     I                                      256 402 ZOB22                                     197434
     I*                                                                   S01434
     I/COPY ZSRSRC,ZHOLI                                                  S01434
     I*                                                                   S01434
     I/COPY ZSRSRC,ZHOLDS                                                 S01434
     I*                                                                   S01434
     I/COPY ZSRSRC,ZSEDITZ2                                               S01434
     I*                                                                   S01434
     I/COPY ZSRSRC,ZDAT10Z1                                               S01434
     I*                                                                   S01434
     ISDBANK    E DSSDBANKPD                                              S01434
     I** DATA STRUCTURE FOR BANK DETAILS SWITCH ON FILE                   S01434
     I*                                                                   S01434
     ISDGELR    E DSSDGELRPD                                              S01434
     I** DATA STRUCTURE FOR GENERAL LEDGER DETAILS                        S01434
     I*                                                                   S01434
     ISDDEAL    E DSSDDEALPD                                              S01434
     I** Data Structure for Dealing details                               S01434
     I              QQACCD                          QQACD1                                    CGL029
     I*                                                                   S01434
     ISDBRCH    E DSSDBRCHPD                                              066154
     I** Data Structure for Branch details                                066154
     I*                                                                   066154
     ISDNOST    E DSSDNOSTPD                                              CEU015
     I** EXTERNAL DS FOR NOSTRO DETAILS                                   CEU015
     I              QQACCD                          QQACD2                                    CGL029
     I*                                                                   CEU015
     ISDCUST    E DSSDCUSTPD                                              CEU015
     I** EXTERNAL DS FOR CUSTOMER DETAILS                                 CEU015
     I              QQDFAC                          QQDFA3                                    CGL029
     I*                                                                   CEU015
     ISDACNT    E DSACCNTAB                                               CEU015
     I** EXTERNAL DS FOR ACCOUNT DETAILS                                  CEU015
     I*                                                                   CEU015
     ISDCURR    E DSSDCURRPD                                              CEU015
     I** EXTERNAL DS FOR CURRENCY DETAILS                                 CEU015
     I*                                                                   CEU015
     ISDRETL    E DSSDRETLPD                                              CEU015
     I* RETAIL DETAILS ACCESSED VIA ACCESS PROGRAM                        CEU015
     I              QQACCD                          QQACD4                                    CGL029
     I*                                                                   CEU015
     ISDBSRT    E DSSDBSRTPD                                              CEU015
     I** External DS for BASE RATE Details                                CEU015
     I*                                                                   CEU015
     ISDMMOD    E DSSDMMODPD                                                                  179480
     I** External DS for Module Details.                                                      179480
     I*                                                                                       179480
     IDSFDY     E DSDSFDY                                                 S01434
     I** DATA STRUCTURE FOR ACCESS PROGRAMS                               S01434
     I**                                                                  S01434
     I/COPY ZSRSRC,ZINTDYZ1                                               S01434
     I**  Data Structure for SR. ZINTDY                                   S01434
     I*
     I*                                                                   S01408
     I/COPY WNCPYSRC,MM5310IIPG                                           S01408
      *                                                                                       CDL081
      ** Named constants                                                                      CDL081
      *                                                                                       CDL081
     I              'BasCcyTaxRoundDown'  C         C#BASE                                    CDL081
     I              'NBasCcyTaxRoundDown' C         C#NBAS                                    CDL081
     I*                                                                   S01408
      /EJECT
     C*
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
     C**  SET UP DLINTRL2 KLIST                                           S01434
     C*                                                                   S01434
     C           KINTR     KLIST                                          S01434
     C                     KFLD           KCCY    3                       S01434
     C                     KFLD           KPRDN   50                      S01434
     C*                                                                   S01434
     C           DATKEY    KLIST                                          S01434
     C                     KFLD           KYMDYY  40                      S01434
     C                     KFLD           KYMDMM  20                      S01434
     C                     KFLD           KYMDDD  20                      S01434
     C                     KFLD           KYBRCA  3                       066154
     C                     KFLD           KYDLNO  60                      S01434
      *                                                                   CEU015
      **  Set up SDEXSTL1 KLIST                                           CEU015
      *                                                                   CEU015
     C           KEXST     KLIST                                          CEU015
     C                     KFLD           KCYCD            CCY CODE       CEU015
     C                     KFLD           KCUST            CUSTOMER       CEU015
     C                     KFLD           KTRTY            TRANS TYPE     CEU015
      *                                                                   CEU015
      **  For SDEXSTL1 KLIST                                              CEU015
      *                                                                   CEU015
     C           *LIKE     DEFN BYCYCD    KCYCD                           CEU015
     C           *LIKE     DEFN BYCUST    KCUST                           CEU015
     C           *LIKE     DEFN BYTRTY    KTRTY                           CEU015
      *                                                                   CEU015
      ** For saving original MMDELDPP fields - see S/R SRSETL             CEU015
      ** Receipt and payment extended instructions                        CEU015
      *  (Receive side)                                                   CEU015
     C           *LIKE     DEFN HKRSTM    @KRSTM                          CEU015
     C           *LIKE     DEFN HKRONS    @KRONS                          CEU015
     C           *LIKE     DEFN HKRIBN    @KRIBN                          CEU015
     C           *LIKE     DEFN HKRIBA    @KRIBA                          CEU015
     C           *LIKE     DEFN HKROBN    @KROBN                          CEU015
     C           *LIKE     DEFN HKROCN    @KROCN                          CEU015
     C           *LIKE     DEFN HKROBR    @KROBR                          CEU015
      *                                                                   CEU015
      ** For saving original MMDELDPP fields - see S/R SRSETL             CEU015
      ** Receipt and payment extended instructions                        CEU015
      *  (Payment side)                                                   CEU015
     C           *LIKE     DEFN HKPSTM    @KPSTM                          CEU015
     C           *LIKE     DEFN HKPONS    @KPONS                          CEU015
     C           *LIKE     DEFN HKPIBN    @KPIBN                          CEU015
     C           *LIKE     DEFN HKPIBA    @KPIBA                          CEU015
     C           *LIKE     DEFN HKPOBN    @KPOBN                          CEU015
     C           *LIKE     DEFN HKPOCN    @KPOCN                          CEU015
     C           *LIKE     DEFN HKRCRN    @KRCRN                          CEU015
     C           *LIKE     DEFN HKRCRA    @KRCRA                          CEU015
     C           *LIKE     DEFN HKRVNO    @KRVNO                          CEU015
     C           *LIKE     DEFN HKAWBN    @KAWBN                          CEU015
     C           *LIKE     DEFN HKAWBA    @KAWBA                          CEU015
     C           *LIKE     DEFN HKBENN    @KBENN                          CEU015
     C           *LIKE     DEFN HKBENA    @KBENA                          CEU015
     C           *LIKE     DEFN HKDTP1    @KDTP1                          CEU015
     C           *LIKE     DEFN HKDTP2    @KDTP2                          CEU015
     C           *LIKE     DEFN HKDTP3    @KDTP3                          CEU015
     C           *LIKE     DEFN HKDTP4    @KDTP4                          CEU015
     C           *LIKE     DEFN HKDCHG    @KDCHG                          CEU015
     C           *LIKE     DEFN HKBTB1    @KBTB1                          CEU015
     C           *LIKE     DEFN HKBTB2    @KBTB2                          CEU015
     C           *LIKE     DEFN HKBTB3    @KBTB3                          CEU015
     C           *LIKE     DEFN HKBTB4    @KBTB4                          CEU015
     C           *LIKE     DEFN HKBTB5    @KBTB5                          CEU015
     C           *LIKE     DEFN HKBTB6    @KBTB6                          CEU015
     C           *LIKE     DEFN HKPOBR    @KPOBR                          CEU015
     C           *LIKE     DEFN HKCVMR    @KCVMR                          CEU015
      *                                                                   CEU015
      ** For saving original MMDELDPP fields - see S/R SRSETL             CEU015
      ** Receipt and payment limited instructions                         CEU015
      *  (Receive side)                                                   CEU015
     C           *LIKE     DEFN HKDORM    @KDORM                          CEU015
     C           *LIKE     DEFN HKORCM    @KORCM                          CEU015
     C           *LIKE     DEFN HKDORI    @KDORI                          CEU015
     C           *LIKE     DEFN HKMORI    @KMORI                          CEU015
     C           *LIKE     DEFN HKDCPI    @KDCPI                          CEU015
     C           *LIKE     DEFN HKMCPI    @KMCPI                          CEU015
      *                                                                   CEU015
      ** For saving original MMDELDPP fields - see S/R SRSETL             CEU015
      ** Receipt and payment limited instructions                         CEU015
      *  (Payment side)                                                   CEU015
     C           *LIKE     DEFN HKDOPM    @KDOPM                          CEU015
     C           *LIKE     DEFN HKMOPM    @KMOPM                          CEU015
     C           *LIKE     DEFN HKDOPI    @KDOPI                          CEU015
     C           *LIKE     DEFN HKMOPI    @KMOPI                          CEU015
     C           *LIKE     DEFN HKDCRI    @KDCRI                          CEU015
     C           *LIKE     DEFN HKMCRI    @KMCRI                          CEU015
     C           *LIKE     DEFN HKDFAC    @KDFAC                          CEU015
     C           *LIKE     DEFN HKMFAO    @KMFAO                          CEU015
     C           *LIKE     DEFN HKSPEC    @KSPEC                          CEU015
      *                                                                   CEU015
     C*                                                                   S01434
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C/COPY WNCPYSRC,MM5310C017
     C                     EXSR #A
     C*
     C** D O    U N T I L   C K 3   O R   E R R O R
     C*
     C           AID       DOUEQ'03'
     C*
     C           *IN07     CASEQ'1'       #BA
     C*
     C           *IN08     CASEQ'1'       #BB
     C*
     C           *IN09     CASEQ'1'       #C
     C*
     C                     END
     C                     END
     C*
     C** TERMINATE PROGRAM
     C*
     C                     SETON                         LR
     C*================================================================
     C*  P R O G R A M     E N D
     C*================================================================
      /EJECT
     C*================================================================
      ** INDEX OF SUBROUTINES
      **
      ** #A                INITIALISATION OF STANDARD FIELDS,
      **                   ACCESS OF STANDING DATA
      **
      ** #BA               OUTPUT AND PROCESS KEY FIELDS SCREEN
      **
      ** #BB               PROCESS SUBFILE SELECTION SCREEN
      **
      ** #C                PROCESS DETAIL SCREEN AND UPDATE FILE
      **
      ** #CA               UPDATE FILE RECORDS
      **
      ** #CB               FORMAT RECORD FIELDS FOR SCREEN
      **
      ** #CC               VALIDATE DETAIL SCREEN
      **
      ** #ZBAA             VALIDATE KEY FIELDS
      **
      ** #ZBAB             VALIDATE COMMAND KEYS
      **
      ** ZTNLU1            ACCESS DATAAREA FOR NEXT TRANSACTION NO.
      **
      ** *PSSR             FILE ERROR HANDLING S/R
      **
      ** ZASNMS            SEND MESSAGE
      ** ZALIGN            TO RIGHT ALIGN NUMERIC FIELDS
      ** ZEDIT             TO OUTPUT NUMERIC FIELDS IN ALPHA
      **
      *******************************************************************
      ** EXTERNAL SUBROUTINES
      ** --------------------
      ** Y2CLMSC           Clear program message queue
      *******************************************************************
      ** Y2SNMGC           Send message to program message queue
      *******************************************************************
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** #A   S/R - TO INITIALISE STATIC FIELDS AND ACCESS STANDING DATA
      ** CALLED ONCE AT START OF PROGRAM FROM MAIN LINE
      ** CALLS NO OTHER ROUTINES
      **
     C*================================================================
     C*
     C           #A        BEGSR                           ** #A    BSR **
     C*
     C                     MOVEL'*'       DDPGMQ
     C*
     C**   Select the program MSGQ for error msg.
     C                     MOVEL'*'       TOPQ   10
     C                     MOVEL'*PRV'    TOPRQ   5
     C*
     C**   Fill in fields for subroutine ZASNMS
     C                     MOVEL*BLANK    ZAPGM  10        Message queue
     C***********          MOVEL'LZUSRMSG'ZAMSGF 10        Message file   S01434
     C                     MOVEL'DRSMM'   ZAMSGF 10        Message file   S01434
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.
     C                     MOVEL*BLANK    ZAMSDA132        Message data.
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.
     C*
     C** PREPARE LDA
     C*
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'MM5310'  DBPGM
     C*
     C** PREPARE COMIT TEXT
     C*
     C                     MOVEL'MM'      MDID
     C                     MOVEL'MM5310'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C*
     C**  SET UP PARAMETER TO RETRIEVE MESSAGE FROM MESSAGE FILE
     C           PLLANG    PLIST
     C                     PARM           MSMBR4  7
     C                     PARM           MSGER  10
     C                     PARM           MSGTXT 80
     C***********          MOVEL'LZUSRMSG'MSGER                           S01434
     C                     MOVEL'DRSMM'   MSGER                           S01434
     C*                                                                   S01434
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1***************************S01434
     C*                                                                   S01434
     C************         READ SDBANKL1                 74               S01434
     C************IN74     IFEQ '1'                        ***************S01434
     C************         Z-ADD1         DBASE            **DB ERROR 01**S01434
     C************         MOVE 'SDBANKL1'DBFILE           ***************S01434
     C************         MOVE *BLANKS   DBKEY                           S01434
     C************         EXSR *PSSR                                     S01434
     C************         END                                            S01434
     C************                                                        S01434
     C************         READ TABTB11                  74               S01434
     C************IN74     IFEQ '1'                        ***************S01434
     C************         Z-ADD2         DBASE            **DB ERROR 01**S01434
     C************         MOVE 'TABTB11 'DBFILE           ***************S01434
     C************         MOVE *BLANKS   DBKEY                           S01434
     C************         EXSR *PSSR                                     S01434
     C************         END                                            S01434
     C************                                                        S01434
     C************         READ MMSSTSLL                 74               S01434
     C************IN74     IFEQ '1'                        ***************S01434
     C************         Z-ADD3         DBASE            **DB ERROR 01**S01434
     C************         MOVE 'MMSSTSL 'DBFILE           ***************S01434
     C************         MOVE *BLANKS   DBKEY                           S01434
     C************         EXSR *PSSR                                     S01434
     C************         END                                            S01434
     C*                                                                   S01434
     C* Read AOBANKR0 to retrieve bank information                        S01434
     C*                                                                   S01434
     C                     CALL 'AOBANKR0'                                S01434
     C                     PARM '*DBERR ' @RTCD   7                       S01434
     C                     PARM '*FIRST ' @OPTN   7                       S01434
     C           SDBANK    PARM SDBANK    DSFDY                           S01434
     C*                                                                   S01434
      ** Consider American date format                                                        188500
     C                     MOVE '0'       *IN98                                               188500
     C           BJDFIN    IFEQ 'M'                                                           188500
     C                     MOVE '1'       *IN98                                               188500
     C                     ENDIF                                                              188500
      *                                                                                       188500
     C* Read AODEALR0 to retrieve dealing details via access program      S01434
     C*                                                                   S01434
     C**********           CALL 'AODEALR0'                                S01434              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01434
     C                     PARM '*FIRST ' @OPTN   7                       S01434
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01434              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C*                                                                   S01434
     C* Read AOGELRR0 to retrieve general ledger details                  S01434
     C*                                                                   S01434
     C**********           CALL 'AOGELRR0'                                             S01434 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01434
     C                     PARM '*FIRST ' @OPTN   7                       S01434
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01434 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01434
     C**  Read the first and only record on FDDLNMLL.                      B9684
     C           1         CHAINFDDLNMLL             74                    B9684
     C*                                                                    B9684
     C**  If no valid record found then it is a data base error.           B9684
     C           *IN74     IFEQ '1'                        B1              B9684
     C           NODLTF    OREQ '*'                        X1              B9684
     C                     Z-ADD4         DBASE            *************** B9684
     C                     MOVEL'FDDLNMLL'DBFILE           * DBERROR 049 * B9684
     C                     MOVEL*BLANKS   DBKEY            *************** B9684
     C                     EXSR *PSSR                                      B9684
     C                     END                                             B9684
     C*                                                                   080603
     C** Access SAR Details file to determine if BRT SAR is installed     080603
     C*                                                                   080603
     C                     CALL 'AOSARDR0'                                080603
     C                     PARM '       ' @RTCD                           080603
     C                     PARM '*VERIFY' @OPTN                           080603
     C                     PARM 'S01383'  @SARD   6                       080603
     C           @RTCD     IFNE *BLANK                                    080603
     C           @RTCD     ANDNE'*NRF   '                                 080603
     C           *LOCK     IN   LDA                        ***************080603
     C                     MOVEL'SCSARDPD'DBFILE           * DBERROR 005 *080603
     C                     MOVEL'005'     DBASE            ***************080603
     C                     MOVEL@RTCD     DBKEY                           080603
     C                     OUT  LDA                                       080603
     C                     EXSR *PSSR                                     080603
     C                     END                                            080603
     C           @RTCD     IFEQ *BLANK                                    080603
     C                     MOVEL'Y'       S01383  1                       080603
     C                     END                                            080603
     C/COPY WNCPYSRC,MM5310C005
     C*                                                                   080603
     C** If BRT SAR installed, Access BRT Installation Control Data       080603
     C*                                                                   080603
     C           S01383    IFEQ 'Y'                                       080603
     C                     MOVE 'D'       BRTKEY  1                       080603
     C           BRTKEY    CHAINSDBRTDD0             76                   080603
     C*                                                                   080603
     C** if *in76 is on, then it is a data base error                     080603
     C*                                                                   080603
     C           *IN76     IFEQ '1'                                       080603
     C           *LOCK     IN   LDA                        ***************080603
     C                     MOVEL'SDBRTDPD'DBFILE           * DBERROR 006 *080603
     C                     MOVEL'006'     DBASE            ***************080603
     C                     MOVELBRTKEY    DBKEY                           080603
     C                     OUT  LDA                                       080603
     C                     EXSR *PSSR                                     080603
     C                     END                                            080603
     C                     END                                            080603
      *                                                                   CEU015
      ** Access AOSARDR0 to check if CEU015 is installed                  CEU015
      *                                                                   CEU015
     C                     CALL 'AOSARDR0'                                CEU015
     C                     PARM *BLANKS   @RTCD   7                       CEU015
     C                     PARM '*VERIFY' @OPTN   7                       CEU015
     C                     PARM 'CEU015'  @SARD   6                       CEU015
      *                                                                   CEU015
     C           @RTCD     IFNE *BLANKS                                   CEU015
     C           @RTCD     ANDNE'*NRF   '                                 CEU015
     C           *LOCK     IN   LDA                        **********     CEU015
     C                     MOVEL'SCSARDPD'DBFILE           *  008   *     CEU015
     C                     MOVEL'008'     DBASE            **********     CEU015
     C                     MOVEL'CEU015'  DBKEY                           CEU015
     C                     OUT  LDA                                       CEU015
     C                     EXSR *PSSR                                     CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANKS                                   CEU015
     C                     MOVE 'Y'       CEU015  1                       CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CGL011
      ** Access Switchable Features file to check if CGL011               CGL011
      ** is installed.                                                    CGL011
      *                                                                   CGL011
     C                     MOVE 'N'       CGL011  1                       CGL011
      *                                                                   CGL011
     C                     CALL 'AOSARDR0'                                CGL011
     C                     PARM *BLANKS   @RTCD                           CGL011
     C                     PARM '*VERIFY' @OPTN                           CGL011
     C                     PARM 'CGL011'  @SARD                           CGL011
      *                                                                   CGL011
     C           @RTCD     IFNE *BLANKS                                   CGL011
     C           @RTCD     ANDNE'*NRF   '                                 CGL011
     C           *LOCK     IN   LDA                                       CGL011
     C                     MOVEL'016'     DBASE                           CGL011
     C                     MOVEL'SCSARDPD'DBFILE                          CGL011
     C                     MOVEL'CGL011'  DBKEY                           CGL011
     C                     OUT  LDA                                       CGL011
     C                     EXSR *PSSR                                     CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
     C           @RTCD     IFEQ *BLANKS                                   CGL011
     C                     MOVE 'Y'       CGL011                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CDL010
      ** Access SAR details to check if CDL010 is installed               CDL010
      *                                                                   CDL010
     C                     CALL 'AOSARDR0'                                CDL010
     C                     PARM *BLANKS   @RTCD                           CDL010
     C                     PARM '*VERIFY' @OPTN                           CDL010
     C                     PARM 'CDL010'  @SARD                           CDL010
      *                                                                   CDL010
     C           @RTCD     IFNE *BLANKS                                   CDL010
     C           @RTCD     ANDNE'*NRF   '                                 CDL010
     C           *LOCK     IN   LDA                                       CDL010
     C                     MOVEL'SCSARDPD'DBFILE           * DB ERROR 63* CDL010
     C                     MOVEL'063'     DBASE            ************** CDL010
     C                     MOVEL'CDL010  'DBKEY                           CDL010
     C                     OUT  LDA                                       CDL010
     C                     EXSR *PSSR                                     CDL010
     C                     ENDIF                                          CDL010
      *                                                                   CDL010
     C           @RTCD     IFEQ *BLANKS                                   CDL010
     C                     MOVE 'Y'       CDL010  1                       CDL010
     C                     ELSE                                           CDL010
     C                     MOVE 'N'       CDL010                          CDL010
     C                     ENDIF                                          CDL010
      *                                                                                       179480
      ** Access Module details                                                                179480
      *                                                                                       179480
     C                     CALL 'AOMMODR0'                                                    179480
     C                     PARM '*DBERR ' @RTCD   7                                           179480
     C                     PARM '*FIRST'  @OPTN   7                                           179480
     C           SDMMOD    PARM SDMMOD    DSFDY                                               179480
     C*                                                                                       179480
     C           @RTCD     IFNE *BLANK                                                        179480
     C           *LOCK     IN   LDA                                                           179480
     C                     MOVEL'SDMMODPD'DBFILE                                              179480
     C                     MOVEL'017'     DBASE                                               179480
     C                     MOVEL@OPTN     DBOPTN  7                                           179480
     C                     OUT  LDA                                                           179480
     C                     SETON                     U7U8                                     179480
     C                     EXSR *PSSR                                                         179480
     C                     ENDIF                                                              179480
      *                                                                                       179480
      ** Check first for retail module is present                                             179480
      *                                                                                       179480
     C           BGRTBN    IFEQ 'Y'                                                           179480
     C           BGNXST    OREQ 'Y'                                                           179480
      *                                                                   CEU015
      ** READ RETAIL DETAILS VIA ACCESS PROGRAM                           CEU015
      *                                                                   CEU015
     C                     CALL 'AORETLR0'                                CEU015
     C                     PARM '*MSG   ' @RTCD   7                       CEU015
     C                     PARM '*FIRST ' @OPTN   7                       CEU015
     C           SDRETL    PARM SDRETL    DSFDY                           CEU015
      *                                                                   CEU015
     C           @RTCD     IFNE *BLANK                                    CEU015
     C           *LOCK     IN   LDA                        **********     CEU015
     C                     MOVEL'SDRETLPD'DBFILE           *  015   *     CEU015
     C                     MOVEL'015'     DBASE            **********     CEU015
     C                     MOVEL'*FIRST ' DBKEY                           CEU015
     C                     OUT  LDA                                       CEU015
     C                     EXSR *PSSR                                     CEU015
     C                     ENDIF                                          CEU015
      *                                                                                       179480
     C                     ENDIF                                                              179480
     C*                                                                   066154
     C** DEFINE DATA AREAS TO PROGRAM                                     066154
     C*                                                                   066154
     C           *NAMVAR   DEFN           RUNDAT                          066154
     C           *NAMVAR   DEFN           LDA                             066154
     C                     IN   RUNDAT                                    066154
     C           @MBIN     IFEQ 'Y'                                       066154
     C                     SETON                     10                   066154
     C                     END                                            066154
     C*                                                                   066154
     C           *NAMVAR   DEFN           ZMUSER                          066154
     C                     IN   ZMUSER                                    066154
     C*                                                                   066154
     C           *NAMVAR   DEFN           ZOBU                            066154
     C                     IN   ZOBU                                      066154
     C           @MBIN     IFEQ 'Y'                                       066154
     C           BKOBRU    ANDEQ'Y'                                       066154
     C           BKOBUV    ANDEQ'Y'                                       066154
     C                     MOVEL'Y'       ORIG    1                       066154
     C                     MOVEAZOB2      ZOB                             066154
     C                     MOVE ZINO      ZINN    30                      066154
     C           ZINN      IFLE 50                                        066154
     C                     MOVEAZOB1      ZOB,51                          066154
     C                     END                                            066154
      *                                                                                       197434
      ** Set up the array ZOB by branches in data areas ZOBU1 and ZOBU2                       197434
      *                                                                                       197434
     C           *NAMVAR   DEFN           ZOBU1                                               197434
     C                     IN   ZOBU1                                                         197434
     C                     Z-ADD101       W       30                                          197434
     C                     MOVEAZOB11     ZOB,W                                               197434
     C                     Z-ADD186       W                                                   197434
     C                     MOVEAZOB12     ZOB,W                                               197434
     C                     Z-ADD271       W                                                   197434
     C                     MOVEAZOB13     ZOB,W                                               197434
     C                     Z-ADD356       W                                                   197434
     C                     MOVEAZOB14     ZOB,W                                               197434
     C                     Z-ADD441       W                                                   197434
     C                     MOVEAZOB15     ZOB,W                                               197434
     C                     Z-ADD526       W                                                   197434
     C                     MOVEAZOB16     ZOB,W                                               197434
     C                     Z-ADD611       W                                                   197434
     C                     MOVEAZOB17     ZOB,W                                               197434
     C                     Z-ADD696       W                                                   197434
     C                     MOVEAZOB18     ZOB,W                                               197434
     C           *NAMVAR   DEFN           ZOBU2                                               197434
     C                     IN   ZOBU2                                                         197434
     C                     Z-ADD767       W                                                   197434
     C                     MOVEAZOB21     ZOB,W                                               197434
     C                     Z-ADD852       W                                                   197434
     C                     MOVEAZOB22     ZOB,W                                               197434
     C                     END                                            066154
      *                                                                                       CDL013
      ** Check if CDL013 is installed                                                         CDL013
     C                     CALL 'AOSARDR0'                                                    CDL013
     C                     PARM *BLANKS   @RTCD   7                                           CDL013
     C                     PARM '*VERIFY' @OPTN   7                                           CDL013
     C                     PARM 'CDL013'  @SARD   6                                           CDL013
     C                     PARM           DSFDY                                               CDL013
      *                                                                                       CDL013
      ** If CDL013 NOT installed, set CAR indicator to '0'                                    CDL013
     C           @RTCD     IFNE *BLANKS                                                       CDL013
     C                     MOVE '0'       CDL013  1                                           CDL013
      *                                                                                       CDL013
      ** If CDL013 installed                                                                  CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      ** Set CAR indicator to '1', set Tax Indicator ON and                                   CDL013
      ** declare work field to access WHT ICD extension file.                                 CDL013
     C                     MOVE '1'       CDL013                                              CDL013
     C                     MOVE *ON       *IN19                                               CDL013
     C                     MOVEL'RETAIL'  WTYPE  10 P                                         CDL013
      *                                                                                       CDL013
      ** Open & access WHT ICD extension file to retrieve WHT rate                            CDL013
     C                     OPEN SDSTAAL1                                                      CDL013
     C           WTYPE     CHAINSDSTAAL1             70                                       CDL013
      *                                                                                       CDL013
      ** If CHAIN failed                                                                      CDL013
     C           *IN70     IFEQ '1'                                                           CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C                     MOVEL'SDSTAAL1'DBFILE           ************                       CDL013
     C                     MOVELWTYPE     DBKEY            * DBERR 50 *                       CDL013
     C                     Z-ADD50        DBASE            ************                       CDL013
     C                     OUT  LDA                                                           CDL013
     C                     EXSR *PSSR                                                         CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL081
      ** Check if CDL081 is installed                                                         CDL081
      *                                                                                       CDL081
     C                     MOVE 'N'       CDL081  1                                           CDL081
     C                     CALL 'AOSARDR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD   7                                           CDL081
     C                     PARM '*VERIFY' POPTN   7                                           CDL081
     C                     PARM 'CDL081'  PSARD   6                                           CDL081
     C                     PARM           DSFDY                                               CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           PRTCD     ANDNE'*NRF   '                                                     CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     Z-ADD075       DBASE                                               CDL081
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL081
     C                     MOVEL'CDL081'  DBKEY                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR *PSSR                                                         CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C           PRTCD     IFEQ *BLANKS                                                       CDL081
     C                     MOVE 'Y'       CDL081                                              CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Access withholding tax round down system values if CDL081 is on                      CDL081
      *                                                                                       CDL081
     C           CDL081    IFEQ 'Y'                                                           CDL081
     C                     CALL 'AOSVALR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD                                               CDL081
     C                     PARM C#BASE    SVALK1 20                                           CDL081
     C                     PARM           SVAL1 200                                           CDL081
     C                     PARM C#NBAS    SVALK2 20                                           CDL081
     C                     PARM           SVAL2 200                                           CDL081
     C                     PARM *BLANK    SVALK3 20                                           CDL081
     C                     PARM           SVAL3 200                                           CDL081
     C                     PARM *BLANK    SVALK4 20                                           CDL081
     C                     PARM           SVAL4 200                                           CDL081
     C                     PARM *BLANK    SVALK5 20                                           CDL081
     C                     PARM           SVAL5 200                                           CDL081
     C                     PARM *BLANK    SVALK6 20                                           CDL081
     C                     PARM           SVAL6 200                                           CDL081
     C                     PARM *BLANK    SVALK7 20                                           CDL081
     C                     PARM           SVAL7 200                                           CDL081
     C                     PARM *BLANK    SVALK8 20                                           CDL081
     C                     PARM           SVAL8 200                                           CDL081
     C                     PARM *BLANK    SVALK9 20                                           CDL081
     C                     PARM           SVAL9 200                                           CDL081
     C                     PARM *BLANK    SVALK0 20                                           CDL081
     C                     PARM           SVAL10200                                           CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C           SVAL1     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK1    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C           SVAL2     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK2    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C                     Z-ADD076       DBASE                                               CDL081
     C                     MOVEL'SDSVALPD'DBFILE                                              CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR *PSSR                                                         CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Setup tax amount rounding down indicators                                            CDL081
      *                                                                                       CDL081
     C                     MOVELSVAL1     W#BSRD  1                                           CDL081
     C                     MOVELSVAL2     W#NBRD  1                                           CDL081
     C                     ENDIF                                                              CDL081
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CCP1                                           S01408
     C*                                                                   S01408
     C*
     C** PROCEED TO START SCREEN
     C*
     C***********          MOVELBJMRDT    DDRUNA
     C                     MOVE '1'       *IN07
     C           *LIKE     DEFN HKRDFC    @@RDFC                          S01434
     C           *LIKE     DEFN HKINTR    WWINTR                          S01434
     C           *LIKE     DEFN HKINTR    NEWRAT                          066160
     C           *LIKE     DEFN HWPRDN    NEWDAT                          066160
     C           *LIKE     DEFN HKINTR    @SPRD                           124141
     C           *LIKE     DEFN HKINTR    @RATE                           124141
     C*
     C                     ENDSR                           ** #A  ENDSR **
     C*===================================================================
      /EJECT
     C*===================================================================
      **
      ** #BA   S/R TO OUTPUT AND PROCESS KEY FIELDS SCREEN
      ** CALLED FROM MAIN PROCESSING
      ** CALLS: #ZBAA  TO VALIDATE KEY FIELDS IF ENTERED
      **        - Y2CLMSC - Clear program message queue
     C*===================================================================
     C*
     C           #BA       BEGSR                           ** #BA   BSR **
     C*
     C** INITIALISE SCREEN DATA
     C*
     C                     MOVE '0'       *IN07
     C                     SETOF                     303132
     C                     SETOF                     33                   066154
     C                     SETOF                     823637
     C                     SETOF                     3839
      *                                                                   079570
      ** If the user has selected the branch via the prompt screen        079570
      ** then do not clear the input fields in SCRCTL.                    079570
     C           *IN42     IFEQ '0'                                       079570
     C                     MOVEL*BLANK    SCRCTL
     C                     END                                            079570
     C***********          MOVEL'MM89001' MSMBR4                          S01434
     C***********          CALL 'SDRTVTXT'PLLANG                          S01434
     C***********          MOVELMSGTXT    DDINFO                          S01434
     C*
     C** CLEAR WHOLE SCREEN
     C*
     C                     WRITEMM5310F3
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           *IN07     DOWEQ'0'
     C           *IN08     ANDEQ'0'
     C           *IN09     ANDEQ'0'
     C*
     C** S T A R T   S C R E E N     O U T P U T
     C**
     C** INITIALIZE SCREEN FIELDS
     C**
     C           *IN75     IFEQ '0'
     C                     MOVE *BLANK    DDACTN
     C                     MOVE *BLANKS   DDDLNO
      *                                                                   079570
      ** If the user has selected the branch via the prompt screen        079570
      ** then do not clear the input fields in SCRCTL.                    079570
     C           *IN42     IFEQ '0'                                       079570
     C                     MOVE *BLANKS   DDBRCA                          066154
     C                     END                                            079570
     C                     END
     C***********          MOVE *BLANKS   DDPKEY                          S01434
     C                     WRITEMM5310F2
     C                     WRITEMM5310F5                                  S01434
     C                     EXFMTMM5310F1
     C                     MOVE '0'       *IN75
      ** Initialize the Interest rate error attributes.                   079570
      ** Reset *IN42 (User selected the branch with the Branch prompt).   079570
     C                     SETOF                     6263                 079570
     C           *IN42     IFEQ '1'                                       079570
     C                     SETOF                     42                   079570
     C                     END                                            079570
      *                                                                   079570
     C                     CALL 'Y2CLMSC'
     C                     PARM           TOPQ
     C                     PARM           TOPRQ
     C*
     C                     EXSR #ZBAB
     C*
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '03'
     C                     MOVE '1'       *IN07
     C                     END
     C*
     C** ENTER TAKEN VALIDATE KEY INPUT
     C*
     C           AID       IFEQ 'RA'
     C*                                                                   066154
     C           DDACTN    IFEQ *BLANKS                                   066154
     C                     MOVE 'E'       ACTN    1                       066154
     C                     ELSE                                           066154
     C                     MOVE DDACTN    ACTN                            066154
     C                     END                                            066154
     C*                                                                   066154
     C                     MOVE 'Y'       #BASB   1                       066154
     C                     EXSR #ZBAA
     C                     MOVE 'N'       #BASB                           066154
     C*
     C** IF NO ERRORS, DETERMINE NEXT SCREEN
     C*
     C           *IN75     IFEQ '0'
     C*
     C** IF ACTION CODE IS BLANK, NEXT SCREEN IS REVIEW SCREEN,
     C** OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
      ** When *in42 is '0' the Branch prompt screen has not been used.    079570
      ** When *IN42 is '1', the program needs to return to the header     079570
      ** input screen, along with the Branch code selected from the       079570
      ** Branch select prompt.                                            079570
      *                                                                   079570
     C           *IN42     IFEQ '0'                                       079570
     C           DDACTN    IFEQ *BLANK
     C                     MOVE '1'       *IN08
     C                     ELSE
     C                     MOVE '1'       *IN09
     C                     END
     C                     END                                            079570
     C                     END
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           ** #BA  ENDSR**
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** #BB    S/R TO PROCESS SUBFILE SELECTION SCREEN
      ** CALLED FROM MAIN PROCESSING
      ** CALLS: #ZBAA  TO VALIDATE KEY FIELDS IF SUBFILE RECORD SELECTED
      **        - Y2CLMSC - Clear program message queue
     C*================================================================
     C*
     C           #BB       BEGSR                           ** #BB    BSR**
     C*
     C                     MOVE '0'       *IN08
     C                     MOVE '1'       *IN82
     C*
     C** SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C                     MOVEL'RA'      AID     2
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           *IN07     DOUEQ'1'                        - B1
     C           *IN08     OREQ '1'
     C           *IN09     OREQ '1'
     C*
     C** R E B U I L D   S U B F I L E
     C*
     C           AID       IFEQ 'UP'                       - B2
     C           AID       OREQ 'DN'
     C           AID       OREQ 'RA'
     C*
     C** WRITE CONTROL RECORD
     C*
     C                     SETOF                     505152
     C***********          Z-ADD*ZERO     RRN                             S01434
     C                     WRITEMM5310C0
     C                     WRITEMM5310F5                                  S01434
     C***********          MOVE '1'       *IN53                           S01434
     C                     MOVE *ON       *IN51                           S01434
     C*
     C** SET FILE POINTER
     C*
     C** SET FILE POINTER - PAGE BACK
     C*
     C           AID       IFEQ 'DN'                       - B3
     C*                                                                   S01434
     C***********          MOVEL*BLANK    DDDLNO                          S01434
     C***********          Z-ADD0         DDDLNN                          S01434
     C***********          MOVEL*BLANK    WWPAG2                          S01434
     C***********DDDLNN    SETLLMMDELDL1                                  S01434
     C*                                                                   S01434
     C** Read back to the top of the current page                         S01434
     C*                                                                   S01434
     C*                                                                   S01434
     C                     Z-ADD1         RNUM    30                      S01434
     C*                                                                   S01434
     C           RNUM      DOUGTRRN                                       S01434
     C*                                                                   S01434
     C                     READPMMDELDL1                 53               S01434
     C*                                                                   S01434
     C           HKMTYP    IFNE 'IL'                                      S01434
     C           HKMTYP    ANDNE'ID'                                      S01434
     C           HKMTYP    ANDNE'CD'                                      066153
     C           HKMTYP    ANDNE'CL'                                      066153
     C           HKBRCA    ANDEQDDBRCA                                    066154
     C*                                                                   066154
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIRE                                           S01408
     C*                                                                   S01408
     C           ORIG      IFEQ 'Y'                                       066154
     C**********           Z-ADD1         X       10                                   066154 197434
     C                     Z-ADD1         X       30                                          197434
     C           HKORBR    LOKUPZOB,X                    40               066154
     C                     END                                            066154
     C           *IN40     IFEQ '1'                                       066154
     C           ORIG      ANDEQ'Y'                                       066154
     C           ORIG      ORNE 'Y'                                       066154
     C                     ADD  1         RNUM                            S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIR1                                           S01408
     C*                                                                   S01408
     C                     END                                            066154
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C  N53                ENDDO                                          S01434
     C*                                                                   S01434
     C** Read back to the top of the previous page                        S01434
     C*                                                                   S01434
     C           *IN52     IFEQ '0'                                       S01434
     C*                                                                   S01434
     C*                                                                   S01434
     C                     Z-ADD1         RNUM    30                      S01434
     C*                                                                   S01434
     C           RNUM      DOUGT13                                        S01434
     C*                                                                   S01434
     C                     READPMMDELDL1                 53               S01434
     C*                                                                   S01434
     C           HKMTYP    IFNE 'IL'                                      S01434
     C           HKMTYP    ANDNE'ID'                                      S01434
     C           HKMTYP    ANDNE'CD'                                      066153
     C           HKMTYP    ANDNE'CL'                                      066153
     C           HKBRCA    ANDEQDDBRCA                                    066154
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIRE                                           S01408
     C*                                                                   S01408
     C*                                                                   066154
     C           ORIG      IFEQ 'Y'                                       066154
     C**********           Z-ADD1         X       10                                   066154 197434
     C                     Z-ADD1         X                                                   197434
     C           HKORBR    LOKUPZOB,X                    40               066154
     C                     END                                            066154
     C           *IN40     IFEQ '1'                                       066154
     C           ORIG      ANDEQ'Y'                                       066154
     C           ORIG      ORNE 'Y'                                       066154
     C                     ADD  1         RNUM                            S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIR1                                           S01408
     C*                                                                   S01408
     C                     END                                            066154
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C  N53                ENDDO                                          S01434
     C*                                                                   S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C*                                                                   S01434
     C                     Z-ADD12        RNUM    30                      S01434
     C*                                                                   S01434
     C                     DO   RNUM                                      S01434
     C*                                                                   S01434
     C                     READPMMDELDL1                 53               S01434
     C*                                                                   S01434
     C***********HKMTYP    IFEQ 'IL'                                S01434066162
     C***********HKMTYP    OREQ 'ID'                                S01434066162
     C           HKMTYP    IFNE 'IL'                                      066162
     C           HKMTYP    ANDNE'ID'                                      066162
     C           HKMTYP    ANDNE'CD'                                      066153
     C           HKMTYP    ANDNE'CL'                                      066153
     C           HKBRCA    ANDEQDDBRCA                                    066154
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIRE                                           S01408
     C*                                                                   S01408
     C*                                                                   066154
     C           ORIG      IFEQ 'Y'                                       066154
     C**********           Z-ADD1         X       10                                   066154 197434
     C                     Z-ADD1         X                                                   197434
     C           HKORBR    LOKUPZOB,X                    40               066154
     C                     END                                            066154
     C           *IN40     IFEQ '1'                                       066154
     C           ORIG      ANDEQ'Y'                                       066154
     C           ORIG      ORNE 'Y'                                       066154
     C                     ADD  1         RNUM                            S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIR1                                           S01408
     C*                                                                   S01408
     C                     END                                            066154
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C  N53                ENDDO                                          S01434
     C*                                                                   S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C*                                                                   S01434
     C**                  - PAGE FORWARD
     C*
     C                     ELSE                            - X3
     C*
     C************IN75     IFEQ '0'                        - B4           S01434
     C***********          MOVELDDPKEY    DDDLNO                          S01434
     C***********          MOVELDDPKEY    WWPAG2                          S01434
     C***********          ELSE                            - X4           S01434
     C***********          MOVELWWPAG2    DDDLNO                          S01434
     C***********          END                             - E4           S01434
     C*
     C           DDDLNO    IFEQ *BLANKS                    - B4
     C                     Z-ADD0         DDDLNN
     C                     END                             - E4
     C*                                                                   S01434
     C                     MOVELDDBRCA    KYBRCA                          066154
     C           AID       IFNE 'RA'                                      066162
     C                     Z-ADDHKMDYY    KYMDYY                          S01434
     C                     Z-ADDHKMDMM    KYMDMM                          S01434
     C                     Z-ADDHKMDDD    KYMDDD                          S01434
     C                     MOVELDDDLNN    KYDLNO                          S01434
     C                     ELSE                                           066162
     C                     Z-ADD0         KYDLNO                          066162
     C                     Z-ADD0         KYMDYY                          066162
     C                     Z-ADD0         KYMDMM                          066162
     C                     Z-ADD0         KYMDDD                          066162
     C                     END                                            066162
     C*                                                                   S01434
     C***********DATKEY    SETLLMMDELDL1                            S01434066162
     C           DATKEY    SETGTMMDELDL1                                  066162
     C*                                                                   S01434
     C***********AID       IFEQ 'UP'                                S01434066162
     C***********          MOVE *OFF      *IN53                     S01434066162
     C***********          ELSE                                     S01434066162
     C***********          READPMMDELDL1                 53         S01434066162
     C***********          END                                      S01434066162
     C*                                                                   S01434
     C                     END                             - E3
     C*                                                                   S01434
     C** If beginning of file, re-position cursor for roll-up             S01434
     C*                                                                   S01434
     C           *IN53     IFEQ '1'                                       S01434
     C           *LOVAL    SETLLMMDELDL1                                  S01434
     C                     MOVE *OFF      *IN53                           S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C*
     C** READ IN DETAILS-FILL UP SUBFILE
     C*
     C                     Z-ADD*ZERO     RRN                             S01434
     C*
     C           RRN       DOUEQ12                         - B3
     C************IN03     OREQ '1'                                       S01434
     C           *IN52     OREQ '1'                                       S01434
     C*
     C                     MOVE '0'       *IN34            *FIX
     C                     MOVEL*BLANK    DDACTN           *FIX
     C*
     C** READ DETAILS UNTIL SUBFILE PAGE IS FULL
     C*
     C***********          READ MMDELDL1                 03               S01434
     C************IN03     IFEQ '0'                        - B4           S01434
     C***********                                                         S01434
     C                     READ MMDELDL1                 52               S01434
     C           *IN52     IFEQ '0'                        - B4           S01434
     C*                                                                   S01434
     C           HKMTYP    IFNE 'IL'                                      S01434
     C           HKMTYP    ANDNE'ID'                                      S01434
     C           HKMTYP    ANDNE'CD'                                      066153
     C           HKMTYP    ANDNE'CL'                                      066153
     C           HKBRCA    ANDEQDDBRCA                                    066154
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIRE                                           S01408
     C*                                                                   S01408
     C*                                                                   066154
     C           ORIG      IFEQ 'Y'                                       066154
     C**********           Z-ADD1         X       10                                   066154 197434
     C                     Z-ADD1         X                                                   197434
     C           HKORBR    LOKUPZOB,X                    40               066154
     C                     END                                            066154
     C           *IN40     IFEQ '1'                                       066154
     C           ORIG      ANDEQ'Y'                                       066154
     C           ORIG      ORNE 'Y'                                       066154
     C*                                                                   S01434
     C                     MOVE HKDN38    DDDLNO
     C                     MOVELHKMDDD    DSDMAT
     C                     MOVE HKMDYY    DSYMAT
     C           HKMDMM    IFNE 0                          - B5
     C                     MOVEAM,HKMDMM  DSMMAT
     C                     ELSE                            - X5
     C                     MOVE *BLANKS   DSDATE
     C                     END                             - E5
     C                     MOVE HKCNUM    DSCUNU
     C                     MOVE HKCSNM    DSCUNA
     C                     MOVE HKCCY     DSCCY                           144199
     C***********          ADD  1         RRN     50     53               S01434
     C                     ADD  1         RRN     50                      S01434
     C*
     C           RRN       IFEQ WWSAVE                     - B5
     C                     MOVELWWACTN    DDACTN
     C                     MOVE '1'       *IN34
     C                     END                             - E5
     C*
     C                     WRITEMM5310S0
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIR1                                           S01408
     C*                                                                   S01408
     C*                                                                   S01434
     C                     END                                            066154
     C                     ENDIF                                          S01434
     C*
     C** RECORD NOW WRITTEN TO SUBFILE
     C*
     C                     END                             - E4
     C*
     C** PAGE NOW FULL (OR EOF)
     C*
     C                     END                             - E3
     C*
     C** READ ONE MORE RECORD FOR NEXT SCREEN
     C*
     C************IN03     IFEQ '0'                        - B3           S01434
     C***********          READ MMDELDL1                 03               S01434
     C************IN52     IFEQ '0'                        - B3     S01434066162
     C***********          READ MMDELDL1                 52         S01434066162
     C***********          ELSE                                     S01434066162
     C           *IN52     IFEQ '1'                        - B3           066162
     C           *HIVAL    SETGTMMDELDL1                                  S01434
     C                     END                             - E3
     C*
     C** IF NOT EOF SET NEXT 'REVIEW FROM' KEY ELSE SET IT TO BLANK
     C*
     C************IN03     IFEQ '0'                        - B3           S01434
     C***********          MOVELHKDN38    DDPKEY                          S01434
     C***********          MOVE '0'       *IN52                           S01434
     C***********          ELSE                            - X3           S01434
     C***********          MOVEL*BLANK    DDPKEY                          S01434
     C***********          MOVE '1'       *IN52                           S01434
     C***********          END                             - E3           S01434
     C*
     C** OUTPUT '+' SIGN AT BOTTOM OF SCREEN
     C*
     C** FOR SUBFILE CONTROL
     C*
     C************IN53     IFEQ '0'                        - B3           S01434
     C***********          SETON                     5051                 S01434
     C***********          ELSE                            - X3           S01434
     C***********          SETON                     51                   S01434
     C***********          SETOF                     50                   S01434
     C***********          END                             - E3           S01434
     C           RRN       IFGT 0                                         S01434
     C                     MOVE *ON       *IN50                           S01434
     C                     ELSE                                           S01434
     C                     MOVE *OFF      *IN50                           S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C                     END                             - E2
     C*
     C** R E V I E W   S C R E E N     O U T P U T
     C*
     C***********          MOVEL'MM89002' MSMBR4                          S01434
     C***********          CALL 'SDRTVTXT'PLLANG                          S01434
     C***********          MOVELMSGTXT    DDINFO                          S01434
     C*
     C                     WRITEMM5310F2
     C*                                                                   085348
     C**  Should not display the subfile if SPF validation of             085348
     C**  BRANCH/USER/ACTION CODE failed in error.                        085348
     C*                                                                   085348
     C           *IN75     IFEQ '1'                                       085348
     C           @ERR      ANDNE0                                         085348
     C*                                                                   085348
     C**  Clear subfile                                                   085348
     C*                                                                   085348
     C                     SETOF                     5051                 085348
     C                     WRITEMM5310C0                                  085348
     C                     SETON                     51                   085348
     C*                                                                   085348
     C                     END                                            085348
     C                     WRITEMM5310F5                                  S01434
     C                     EXFMTMM5310C0
     C                     MOVE '0'       *IN75
     C                     Z-ADD0         WWSAVE  40       *FIX
     C                     CALL 'Y2CLMSC'
     C                     PARM           TOPQ
     C                     PARM           TOPRQ
     C*
     C                     EXSR #ZBAB
     C*
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '03'                       - B2
     C                     MOVE '1'       *IN08
     C                     END                             - E2
     C*
     C** CK12- INITIAL SCREEN
     C*
     C           AID       IFEQ '12'                       - B2
     C                     MOVE '1'       *IN07
     C                     END                             - E2
     C*
     C** ENTER PRESSED, PROCESS RECORD SELECTION
     C*
     C           AID       IFEQ 'RA'                       - B2
     C                     MOVE '1'       *IN72
     C           *IN,53    IFEQ '0'                        - B3
     C           RRN       ANDNE0                                         076469
     C                     READCMM5310S0                 72
     C                     END                             - E3
     C*
     C** R E C O R D   S E L E C T   V A L I D A T I O N
     C*
     C           *IN72     IFEQ '0'                        - B3
     C*
     C                     MOVE DDACTN    ACTN                            066154
     C*                                                                   066154
     C                     MOVE 'Y'       #BBS1   1                       066154
     C                     EXSR #ZBAA
     C                     MOVE 'N'       #BBS1                           066154
     C*
     C** NO ERRORS, UPDATE SCREEN CAN BE PROCESSED NEXT
     C*
     C           *IN75     IFEQ '0'                        - B4
     C                     MOVE '1'       *IN09
     C                     MOVEL'Y'       WWREVW
     C***********          MOVE DDPKEY    WWPAG1                          S01434
     C***********          MOVE *BLANKS   DDPKEY                          S01434
     C                     ELSE                            - X4
     C                     MOVELDDACTN    WWACTN  1
     C                     Z-ADDRRN       WWSAVE
     C                     END                             - E4
     C*                                                                   066154
     C                     ELSE                                           066154
     C                     MOVE 'E'       ACTN                            066154
     C                     MOVE 'Y'       #BBS2   1                       066154
     C                     EXSR #ZBAA                                     066154
     C                     MOVE 'N'       #BBS2                           066154
     C                     END                             - E3
     C                     END                             - E2
     C**
     C                     END                             - E1
     C*
     C                     ENDSR                           **        ESR**
     C*
     C*===================================================================
      /EJECT
     C*===================================================================
      **
      ** #C     S/R TO PROCESS DETAIL SCREEN AND UPDATE FILE
      ** CALLED FROM MAIN PROCESSING
      ** CALLS: #CC   , #CA   , #CA   , #CB  ,
      **
     C*===================================================================
     C*
     C           #C        BEGSR                           ** #C     BSR**
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C** POSITION CURSOR
     C*
     C                     SETOF                     3132
     C                     SETOF                     33                   066154
     C                     MOVE '1'       *IN30
     C                     MOVE '0'       *IN09
     C                     MOVE *OFF      *IN44                           CEU015
     C                     MOVE *OFF      *IN46                           CEU015
     C                     MOVE *OFF      *IN47                           CEU015
     C                     Z-ADD0         WNBDP   10                      CEU015
     C                     Z-ADD0         WSPRT  138                      143525
     C*
     C**  If the related deal status code maturity date is less than run date
     C**  this is an error.
     C***********DDDLNN    CHAINMMDEALLL             70            S01434 173661
     C           DDDLNN    CHAINMMDEALLL             7069                 173661
      *                                                                   173661
     C           *IN69     IFEQ '1'                                       173661
     C                     MOVE '1'       *IN75                           173661
     C                     MOVE DDDLNN    RDLNO                           173661
     C                     WRITEMM5310F5                                  173661
     C                     ENDIF                                          173661
     C*                                                                   S01434
     C** Change format of run date.
     C                     Z-ADDBJRDNB    @@DAYN  50
     C                     EXSR ZA0710
     C                     Z-ADD@@VDT     RNDAT8  80
     C*
     C                     Z-ADDHKMDYY    HHMDYY
     C                     Z-ADDHKMDMM    HHMDMM
     C                     Z-ADDHKMDDD    HHMDDD
     C*                                                                   079156
     C                     Z-ADDHKDTYY    HHDTYY                          079156
     C                     Z-ADDHKDTMM    HHDTMM                          079156
     C                     Z-ADDHKDTDD    HHDTDD                          079156
     C*
     C           MDAT8     IFLT RNDAT8                     - B2
     C           ORED8     ANDLTRNDAT8                                    079156
     C                     MOVE '1'       *IN34
     C                     MOVE '1'       *IN75
     C***********          MOVEL'MM89011' ZAMSID                          S01434
     C                     MOVEL'MMM0670' ZAMSID                          S01434
     C                     EXSR ZASNMS
     C                     END                             - E2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIR2                                           S01408
     C*                                                                   S01408
     C*
     C           *IN75     IFEQ '1'
     C                     MOVE '1'       *IN08
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C***********DDACTN    IFEQ 'X'                                       S01434
     C           DDACTN    IFEQ 'R'                                       S01434
     C           DDACTN    OREQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C                     EXSR #CB
     C                     END
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           *IN07     DOWEQ'0'
     C           *IN08     ANDEQ'0'
     C           *IN09     ANDEQ'0'
     C*
     C** D E T A I L   S C R E E N     O U T P U T
     C*
     C                     WRITEMM5310F2
     C                     WRITEMM5310F5                                  S01434
     C                     WRITEMM5310F1
      *                                                                   CEU015
     C                     MOVE *OFF      *IN43                           CEU015
     C                     MOVE *OFF      *IN48                           CEU015
      *                                                                   CEU015
     C           DDACTN    IFEQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C                     MOVE *ON       *IN43                           CEU015
     C                     ENDIF                                          CEU015
     C*
     C                     EXFMTMM5310F4
     C                     MOVE '0'       *IN75
     C                     CALL 'Y2CLMSC'
     C                     PARM           TOPQ
     C                     PARM           TOPRQ
     C*
     C                     EXSR #ZBAB
     C*
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '03'
     C                     MOVE '1'       *IN09
     C/COPY WNCPYSRC,MM5310C011
     C                     END
     C*
     C** CK12- INITIAL SCREEN
     C*
     C           AID       IFEQ '12'
     C                     MOVE '1'       *IN07
     C                     MOVE '0'       *IN08
     C/COPY WNCPYSRC,MM5310C012
     C           *LOVAL    SETLLMMDELDL1                                  066161
     C                     END
     C*
     C** V A L I D A T E   D E T A I L   S C R E E N   I N P U T
     C*
     C           AID       IFNE '03'
     C           AID       ANDNE'12'
     C                     EXSR #CC
     C*                                                                   S01434
     C           *IN41     IFEQ *ON                                       S01434
     C           *IN75     ANDEQ*OFF                                      S01434
     C                     MOVEL'MMM1039' ZAMSID                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS                                    S01434
     C                     WRITEMM5310F2                                  S01434
     C                     WRITEMM5310F5                                  S01434
     C                     EXFMTMM5310C0                                  S01434
     C                     EXSR #ZBAB                                     S01434
     C                     END                                            S01434
     C*
     C** N O    D E T A I L   S C R E E N    E R R O R S
     C*
     C           DDACTN    IFEQ 'C'                                       CEU015
     C           *IN75     ANDEQ'0'                                       CEU015
     C           AID       ANDEQ'RA'                                      CEU015
     C                     MOVE '1'       *IN35                           CEU015
     C                     MOVE '1'       *IN48                           CEU015
     C                     MOVEL'MMM1030' ZAMSID                          CEU015
     C                     MOVEL'DRSMM'   ZAMSGF                          CEU015
     C                     EXSR ZASNMS                                    CEU015
     C                     WRITEMM5310F2                                  CEU015
     C                     WRITEMM5310F5                                  CEU015
     C                     EXFMTMM5310F4                                  CEU015
      *                                                                   CEU015
     C                     EXSR #ZBAB                                     CEU015
      *                                                                   CEU015
     C                     CALL 'Y2CLMSC'                                 CEU015
     C                     PARM           TOPQ                            CEU015
     C                     PARM           TOPRQ                           CEU015
      *                                                                   CEU015
      ** CK3 - Terminate                                                  CEU015
      *                                                                   CEU015
     C           AID       IFEQ '03'                                      CEU015
     C                     MOVE '1'       *IN09                           CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
      ** C12 - Re-Amend                                                   CEU015
      *                                                                   CEU015
     C           AID       IFEQ '12'                                      CEU015
     C                     MOVE '0'       *IN35                           CEU015
     C                     MOVE '0'       *IN48                           CEU015
     C                     ITER                                           CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C           *IN75     IFEQ '0'
     C           AID       ANDEQ'RA'
     C*
     C** DETERMINE WHAT SCREEN TO RETURN TO
     C*
     C           WWREVW    IFEQ 'Y'
     C***********          MOVELWWPAG2    DDPKEY                          S01434
     C                     MOVE '1'       *IN08
     C                     ELSE
     C                     MOVE '1'       *IN07
     C                     MOVE '0'       *IN08
     C                     END
     C*
     C**     U  P  D  A  T  E      F  I  L  E  S
     C*
     C***********DDACTN    IFEQ 'X'                                       S01434
     C           DDACTN    IFEQ 'R'                                       S01434
     C           DDACTN    OREQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C                     EXSR #CA
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** RESET PROTECT/NON-DISPLAY INDS
     C*
     C                     MOVE '0'       *IN30
     C                     MOVE '0'       *IN35
     C                     Z-ADD0         W#PRNC 150                      CGL011
     C*
     C                     END
      *                                                                   173661
     C                     UNLCKMMDEALLL                                  173661
     C*
     C           XTUPDT    ENDSR                           ** XTUPDA ESR**
     C*================================================================
      /EJECT
     C*================================================================
     C           #CA       BEGSR                           ** #CA    BSR**
     C*
     C           DDDLNN    CHAINMMDEALLL             70                   S01434
     C*                                                                   S01434
     C                     Z-ADDDDDL2N    HKDN38
     C                     MOVE DDDLNO    HKDADN
     C*
     C** Set up the deal status according to the system value
     C***********H1BOAR    IFEQ 'Y'                                       S01434
     C           BNMMAU    IFEQ 'Y'                                       S01434
     C                     MOVE 'C'       HKDSTS
     C                     ELSE
     C                     MOVE 'A'       HKDSTS
     C                     END
     C*
     C                     Z-ADDHKMDYY    HKVDYY
     C                     Z-ADDHKMDMM    HKVDMM
     C                     Z-ADDHKMDDD    HKVDDD
     C                     MOVE 'I'       HKCHTP
     C                     TIME           HKTLUP
     C*
     C** Change format of run date.
     C                     Z-ADDBJRDNB    @@DAYN  50
     C                     EXSR ZA0710
     C*
     C** Deal Transaction date.
     C                     Z-ADD@@YR      HKDTYY
     C                     Z-ADD@@Z71M    HKDTMM
     C                     Z-ADD@@Z71D    HKDTDD
     C*
     C** Deal Done date.
     C                     Z-ADD@@YR      HKDDYY
     C                     Z-ADD@@Z71M    HKDDMM
     C                     Z-ADD@@Z71D    HKDDDD
     C*
     C** Deal Last Update date.
     C                     MOVE BJMRDT    WWDATE                          S01434
     C                     Z-ADDWWDLUP    HKDLUP
     C                     MOVE WWMLUP    HKMLUP
     C                     Z-ADDWWYLUP    HKYLUP
     C                     MOVE 'I'       HKLACT                          S01434
     C*
     C** Maturity date
     C                     MOVE WWMDYY    HKMDYY
     C                     MOVE WWMDMM    HKMDMM
     C                     MOVE WWMDDD    HKMDDD
     C*
     C** Principal amount
     C           DDACTN    IFEQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C                     Z-ADDP@OUTA    HKAMNP                          CEU015
     C                     MOVE SICMT     HKICMT                          CEU015
     C                     MOVE HKCCY     HKRTFC                          CEU015
     C                     MOVE BKEURO    HKCCY                           CEU015
     C                     MOVE WNBDP     HKCYDP                          CEU015
     C                     Z-ADDWSPRT     HKBRAT                          143525
      ** Interest Settlement Currency                                     144833
     C                     MOVE *BLANKS   HKISCY                          144833
      ***Base*currency*rate****************************************CEU015 124141
     C**********           MOVE DDBSRC    HKBSRC                   CEU015 124141
      ***Base*rate*code********************************************CEU015 124141
     C**********           MOVE DDBSRC    HKBSRC                   CEU015 124141
      ***Spread****************************************************CEU015 124141
     C********** DDSPRD    IFEQ *BLANKS                            CEU015 124141
     C**********           Z-ADD0         HKSPRD                   CEU015 124141
     C**********           ELSE                                    CEU015 124141
     C**********           MOVE @@AMT     HKSPRD                   CEU015 124141
     C**********           ENDIF                                   CEU015 124141
      ** Rollover by deal amount in Original Currency                     145001
     C                     Z-ADDWWPRIN    HKORDA                          145001
      *                                                                   145001
     C                     ELSE                                           CEU015
     C                     Z-ADDWWPRIN    HKAMNP
     C                     MOVEL*BLANKS   HKRTFC                          CEU015
     C                     Z-ADD*ZERO     HKORDA                          145001
     C                     ENDIF                                          CEU015
      *                                                                   124141
      ** Base rate code                                                   124141
      *                                                                   124141
     C                     MOVE DDBSRC    HKBSRC                          124141
      *                                                                   124141
      ** Spread                                                           124141
      *                                                                   124141
     C           DDSPRD    IFEQ *BLANKS                                   124141
     C                     Z-ADD0         HKSPRD                          124141
     C                     ELSE                                           124141
     C                     MOVE @@AMT     HKSPRD                          124141
     C                     ENDIF                                          124141
     C*
     C** Interest Rate                                                    S01434
     C                     MOVELWWINTR    HKINTR                          S01434
     C                     MOVELWWINTR    HKIIRT                          S01434
     C*                                                                   S01434
     C** CHG MATURITY DATE TO MIDAS FORMAT                                S01434
     C*                                                                   S01434
     C                     MOVE WWNMA8    ZZDTIN                          S01434
     C*                                                                   S01434
     C                     EXSR ZDAT10                                    S01434
     C*                                                                   S01434
     C           HKFLID    IFEQ 'Y'                                       S01434
     C           ZZMDNO    ADD  1         ZZEND                           S01434
     C                     ELSE                                           S01434
     C                     MOVE ZZMDNO    ZZEND                           S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C                     Z-ADDHKAMNP    @@AMT                           S01434
     C                     Z-ADDHKINTR    @@RATE 117                      S01434
     C                     MOVE HKICMT    ZZCALC                          S01434
     C*                                                                   S01434
     C                     MOVE HKRDFC    @@RDFC                          S01434
     C*                                                                   S01434
     C** CHANGE VALUE DATE INTO MIDAS FORMAT                              S01434
     C*                                                                   S01434
     C                     Z-ADDHKVDYY    @@YYYY                          S01434
     C                     Z-ADDHKVDMM    @@MTH                           S01434
     C                     Z-ADDHKVDDD    @@DAY                           S01434
     C                     Z-ADD@@DTIN    ZZDTIN                          S01434
     C                     EXSR ZDAT10                                    S01434
     C                     Z-ADDZZMDNO    ZZBEG                           S01434
     C                     EXSR MM1030                                    S01434
     C                     Z-ADD@@INTR    HKMTTI                          S01434
     C** FORMAT START/LAST INTEREST DATE                                  S01434
     C*                                                                   S01434
     C                     Z-ADDHKVDYY    HKSLYY                          S01434
     C                     Z-ADDHKVDDD    HKSLDD                          S01434
     C                     Z-ADDHKVDMM    HKSLMM                          S01434
     C*                                                                   S01434
     C** FORMAT INTEREST ACCRUAL CONTROL DATE                             S01434
     C*                                                                   S01434
     C                     Z-ADDHKVDYY    HKIAYY                          S01434
     C                     Z-ADDHKVDDD    HKIADD                          S01434
     C                     Z-ADDHKVDMM    HKIAMM                          S01434
     C*                                                                   S01434
     C*********************MOVE 'O'       HKRBSI                          B10068
     C/COPY WNCPYSRC,MM5310C006
      *                                                                   CEU015
      ** Set up the settlement fields                                     CEU015
      *                                                                   CEU015
     C           DDACTN    IFEQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C                     EXSR SRSETL                                    CEU015
     C                     ENDIF                                          CEU015
     C*
     C** Write a new record on MMDEALLL                                   S01434
     C*                                                                   S01434
     C           DDDL2N    CHAINMMDEALLL             70                   S01434
     C*                                                                   S01434
     C           *IN70     IFEQ '1'                                       S01434
      *                                                                                       CDL010
      ** User Authorisation details when CDL010 is ON                                         CDL010
      **  Update User Details                                                                 CDL010
     C           CDL010    IFEQ 'Y'                                                           CDL010
     C                     MOVE ZUSER     HKUSER                                              CDL010
     C                     ENDIF                                                              CDL010
      *                                                                                       CDL010
     C                     Z-ADD0         HKBCAM                                              CLE025
      *                                                                                       CLE025
     C                     WRITEMMDELDP0               15                 S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CCP6                                           S01408
     C*                                                                   S01408
     C                     END                                            S01434
     C*                                                                   S01434
     C** Update the old record on MMDEALLL                                S01434
     C*                                                                   S01434
     C           DDDLNN    CHAINMMDEALLL             70                   S01434
     C*                                                                    B4924
     C** If already rolled over keep old number for test in MM5320.        B4924
     C           HKROBY    IFEQ *BLANKS                                    B4924
     C           HKROBY    OREQ '000000'                                   B4924
     C                     MOVE DDDLN2    HKROBY
     C                     END                                             B4924
     C*
     C*********************MOVE 'O'       HKRBSI              B4924 B9893 B10068
     C                     MOVE 'O'       HKRBSI                          B10068
     C*                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           DDACTN    ANDEQ'C'                                       CEU015
     C                     MOVE BKEURO    HKRTFC                          CEU015
     C                     ELSE                                           CEU015
     C                     MOVE *BLANKS   HKRTFC                          CEU015
     C                     ENDIF                                          CEU015
     C*                                                                   S01434
     C************IN72     IFEQ '0'                                       S01434
     C***********          UPDATMMDELDPY               15                 S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C           *IN70     IFEQ '0'                                       S01434
      *                                                                                       CDL010
      ** User Authorisation details when CDL010 is ON                                         CDL010
      **  Update User Details                                                                 CDL010
     C           CDL010    IFEQ 'Y'                                                           CDL010
     C                     MOVE ZUSER     HKUSER                                              CDL010
     C                     ENDIF                                                              CDL010
      *                                                                                       CDL010
     C                     UPDATMMDELDP0               15                 S01434
     C                     END                                            S01434
     C/COPY WNCPYSRC,MM5310C010
     C*                                                                   S01434
     C********************************************************************S01434
     C**Pass*parameters*to*MM5320*:*new*and*old*deal*number*+*'R'*********S01434
     C********************************************************************S01434
     C****C*A*L*L******M*M*5*3*2*0****************************************S01434
     C********************************************************************S01434
     C***********          Z-ADDDDDL2N    PAR1                            S01434
     C***********          Z-ADDDDDLNN    PAR2                            S01434
     C***********          MOVE 'R'       PAR3                            S01434
     C***********                                                         S01434
     C***********          CALL 'MM5320'                                  S01434
     C***********          PARM           PAR1    60       NEW DEAL NUMBERS01434
     C***********          PARM           PAR2    60       OLD DEAL NUMBERS01434
     C***********          PARM           PAR3    1                       S01434
     C***********          PARM *BLANK    RTRN    1                       S01434
     C***********                                                         S01434
     C**Pass parameters to MM0089 : new and old deal number + 'R'         S01434
     C*                                                                   S01434
     C**  C A L L      M M 0 0 8 9                                        S01434
     C*                                                                   S01434
     C                     MOVE DDDL2N    PAR1                            S01434
     C                     MOVE DDDLNN    PAR2                            S01434
     C                     MOVE 'R'       TERM                            S01434
     C*                                                                   S01434
     C                     CALL 'MM0089'                                  S01434
     C                     PARM           TERM    1                       S01434
     C                     PARM *ZEROS    RDLN    60                      S01434
     C                     PARM *BLANKS   ERR     1                       S01434
     C                     PARM           PAR1    6                       S01434
     C                     PARM           PAR2    6                       S01434
     C                     PARM *BLANKS   RTRN    1                       S01434
     C/COPY WNCPYSRC,MM5310C022
     C*                                                                   S01434
     C           RTRN      IFNE 'N'
     C                     COMIT
     C                     MOVE 'Y'       RECOK   1                       S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CCP2                                           S01408
     C*                                                                   S01408
     C                     ELSE
     C                     ROLBK
     C*                                                                   144833
     C** If call to MM0089 ended in error, inform user.                   144833
     C*                                                                   144833
     C           TERM      IFEQ 'E'                                       144833
     C                     EXSR *PSSR                                     144833
     C                     ENDIF                                          144833
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CCP7                                           S01408
     C*                                                                   S01408
     C                     END
     C*
     C                     ENDSR
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** #CB   S/R TO FORMAT RECORD FIELDS FOR SCREEN
      ** CALLED FROM UPDATE
      ** CALLS NO OTHER S/R'S
      **
     C*================================================================
     C*
     C           #CB       BEGSR                           ** #CB   BSR **
     C*                                                                   CEU015
     C**  Initialise these fields to avoid spurious results when          CEU015
     C**  entering rollovers continually without exiting the screen       CEU015
     C*                                                                   CEU015
     C                     MOVE *BLANKS   DDBSRC                          CEU015
     C                     MOVE *BLANKS   DDSPRD                          CEU015
     C                     MOVE *BLANKS   DDINTR                          CEU015
     C                     Z-ADD0         WWINTR                          CEU015
     C                     Z-ADD0         NEWMAT                          CEU015
     C*                                                                   CEU015
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C                     MOVE HKCSNM    DDCUNA
     C                     MOVE *BLANKS   DDDLN2
      *
      * Transform maturity date from old deal to value date for new deal in
      * midas format to perform compare of date
      *
     C                     MOVE HKMDYY    DSMDYY
     C                     MOVE HKMDMM    DSMDMM
     C                     MOVE HKMDDD    DSMDDD
     C                     MOVE DSMDAT    @@DTIN
     C                     EXSR ZA0680
     C                     Z-ADD@@MDNO    WWMDAT  50
      *                                                                   S01434
      ***Access*MMDELDY0*using*rollover*deal*number*to*retrieve*old*deal*details
      *                                                                   S01434
     C***********HKDN38    CHAINMMDELDY0             87                   S01434
      *                                                                   S01434
     C************IN87     IFEQ '0'                                       S01434
     C************         MOVE MMAURO    FFAURO  1                       S01434
     C************         MOVE MMFREQ    FFFREQ  1                       S01434
     C************         Z-ADDMMDNUM    FFDNUM  20                      S01434
     C************         ELSE                                           S01434
     C************         MOVE *BLANK    FFAURO                          S01434
     C************         MOVE *BLANK    FFFREQ                          S01434
     C************         Z-ADD*ZERO     FFDNUM                          S01434
     C************         END                                            S01434
      *
     C                     MOVE *BLANK    ZECODE
      *
      * Set up new principal amount
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CISH                                           S01408
     C*                                                                   S01408
     C                     EXSR SRPRA2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIR1                                           S01408
     C*                                                                   S01408
      *
      * Set up new maturity date
     C                     EXSR SRMAT2
     C                     MOVE '0'       *IN38
     C*
      * Set up new interest rate                                          S01434
     C                     EXSR SRINT2                                    S01434
     C/COPY WNCPYSRC,MM5310C007
      *                                                                   S01434
     C                     ENDSR
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** #CC    S/R - TO VALIDATE DETAIL SCREEN
      ** CALLED FROM #C     S/R
      ** CALLS  - ZASNMS - Send message to program message queue
      **
     C*================================================================
     C*
     C           #CC       BEGSR                           ** #CC    BSR**
     C*
     C** RESET SCREEN ERROR INDICATORS
     C*
     C                     MOVEA'0000'    *IN,36
     C                     MOVE *OFF      *IN44                           CEU015
     C                     MOVE *OFF      *IN46                           CEU015
     C                     MOVE *OFF      *IN47                           CEU015
      ** Initialise Interest rate display attributes.                     079570
     C                     SETOF                     626335               079570
     C                     SETOF                     75                   079570
     C*
     C** ENTER KEY PRESSED
     C*
     C           AID       IFEQ 'RA'                       - B1
     C*
     C** ACTION = X
     C*
     C***********DDACTN    IFEQ 'X'                        - B2           S01434
     C           DDACTN    IFEQ 'R'                                       S01434
     C           DDACTN    OREQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C*                                                                   S01434
     C** VALIDATION OF FIELDS FOR AMEND
     C*
      * Validate new deal number
     C*********************EXSR SRDLNO                                    079570
     C*
      * Validate new principal amount
     C************IN75     IFEQ '0'                                S01434 079570
     C           DDPRIN    IFNE *BLANKS
     C                     EXSR SRPRA1
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CISH                                           S01408
     C*                                                                   S01408
     C                     EXSR SRPRA2
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CIR1                                           S01408
     C*                                                                   S01408
     C                     END
      *
      * Validate new maturity date
     C           DDMDAT    IFNE *BLANKS
     C                     EXSR SRMAT1
     C                     ELSE
     C                     EXSR SRMAT2
     C                     END
     C*                                                                   S01434
      * Validate new interest rate                                        S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CCP8                                           S01408
     C*                                                                   S01408
     C           DDINTR    IFNE *BLANKS                                   S01434
     C/COPY WNCPYSRC,MM5310C021
     C********** DDBSRC    ORNE *BLANKS                            CEU015 124141
     C           *IN61     OREQ '1'                                       124141
     C                     EXSR SRINT1                                    S01434
     C                     ELSE                                           S01434
     C                     EXSR SRINT2                                    S01434
     C                     END                                            S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CCP9                                           S01408
     C*                                                                   S01408
     C*                                                                   S01434
     C*********************END                                     S01434 079570
      *                                                                   CEU015
      ** Validate interest calculation method (range 1-6)                 CEU015
      *                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           DDACTN    ANDEQ'C'                                       CEU015
      *                                                                   CEU015
     C                     SELEC                                          CEU015
     C           SICMT     WHEQ '1'                                       CEU015
     C           SICMT     WHEQ '2'                                       CEU015
     C           SICMT     WHEQ '3'                                       CEU015
     C           SICMT     WHEQ '4'                                       CEU015
     C           SICMT     WHEQ '5'                                       CEU015
     C           SICMT     WHEQ '6'                                       CEU015
     C                     OTHER                           ERROR          CEU015
     C                     MOVE *ON       *IN75                           CEU015
     C                     MOVE *ON       *IN44                           CEU015
     C                     MOVEL'MMM2703' ZAMSID                          CEU015
     C                     MOVEL'DRSMM'   ZAMSGF                          CEU015
     C                     EXSR ZASNMS                                    CEU015
     C                     ENDSL                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C*                                                                   079570
      ** *IN75 = No Detail input errors.                                  079570
      * Validate new deal number if no validation errors.                 079570
     C           *IN75     IFEQ '0'                                       079570
     C                     EXSR SRDLNO                                    079570
     C                     END                                            079570
     C*
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     ENDSR
     C*================================================================
      /EJECT                                                              S01434
     C*****************************************************************   S01434
     C*                                                               *   S01434
     C*   MM1030 - CALCULATE INTEREST                                 *   S01434
     C*                                                               *   S01434
     C*  CALLED BY    -                                               *   S01434
     C*                                                               *   S01434
     C*  CALLS        -   ZINTDY CALCULATE NO. OF INTEREST DAYS       *   S01434
     C*                                                               *   S01434
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   S01434
     C*               ZZEND  - END DATE OF PERIOD                     *   S01434
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   S01434
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01434
     C*               @@RATE - INTEREST RATE 11,7                     *   S01434
     C*               @@RDFC - ROUND DOWN FACILITY IND 1              *   S01434
     C*                                                               *   S01434
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   S01434
     C*                                                               *   S01434
     C*  WORK FIELDS   @@W157 - 15,5                                  *   S01434
     C*                @@W210 - 21,0                                  *   S01434
     C*                @@YEAR - (NUMBER OF DAYS IN YEAR) x 100        *   S01434
     C*                                                               *   S01434
     C*****************************************************************   S01434
     C           MM1030    BEGSR                                          S01434
     C*                                                                   S01434
     C*   CALCULATE NUMBER OF INTEREST DAYS                               S01434
     C/COPY WNCPYSRC,MM5310C001
     C*                                                                   S01434
     C                     Z-ADDZZBEG     ZZBEG9  50                                          CDL093
     C                     Z-ADDZZEND     ZZEND9  50                                          CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
      *                                                                                       CDL093
      ** Convert start date to YYYYMMDD format                                                CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZBEG9    @@DAYN  50                                          CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATA  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY1   40                                          CDL093
      *                                                                                       CDL093
      ** Convert end date to YYYYMMDD format                                                  CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZEND9    @@DAYN                                              CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATB  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY2   40                                          CDL093
      *                                                                                       CDL093
     C                     EXSR #FEB29                                                        CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           HKNIPD    ANDNE*ZERO                                                         CDL093
     C           HKNIPD    ANDLTZZEND                                                         CDL093
      *                                                                                       CDL093
     C                     Z-ADDHKIPDM    @@IPDM  20                                          CDL093
     C                     CALL 'MM001031'                                                    CDL093
     C                     PARM           ZZBEG                                               CDL093
     C                     PARM           ZZEND                                               CDL093
     C                     PARM           HKNIPD                                              CDL093
     C                     PARM '9'       ZZCALC                                              CDL093
     C                     PARM           HKIPFQ                                              CDL093
     C                     PARM           @@AMT                                               CDL093
     C                     PARM           @@RATE                                              CDL093
     C                     PARM 'N'       RNDDWN  1                                           CDL093
     C                     PARM 'N'       FRSLST  1                                           CDL093
     C                     PARM           @@IPDM                                              CDL093
     C                     PARM           WINTR                                               CDL093
      *                                                                                       CDL093
     C                     Z-ADDWINTR     @@INTR                                              CDL093
     C           *LIKE     DEFN @@INTR    WINTR                                               CDL093
      *                                                                                       CDL093
     C                     GOTO INTCLC                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C                     EXSR ZINTDY                                    S01434
     C*                                                                   S01434
     C           ZZCALC    IFEQ '2'                        *** B 1        S01434
     C           ZZCALC    OREQ '3'                                       S01434
     C           ZZCALC    OREQ '5'                                       S01434
     C           ZZCALC    OREQ '0'                                                          CER016A
     C                     Z-ADD36000     @@YEAR  50                      S01434
     C                     END                             *** E 1        S01434
     C*                                                                   S01434
     C           ZZCALC    IFEQ '1'                        *** B 1        S01434
     C           ZZCALC    OREQ '4'                                       S01434
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDNE'Y'                                                           CDL093
     C                     Z-ADD36500     @@YEAR                          S01434
     C                     END                              *** E 1       S01434
     C*                                                                   S01434
     C           ZZCALC    IFEQ '6'                         *** B 1       S01434
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C                     Z-ADD36600     @@YEAR                          S01434
     C                     END                              *** E 1       S01434
     C*                                                                   S01434
     C           ZZCALC    IFEQ '6'                                       163136
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           INT6DY    MULT @@RATE    @@W157                          163136
     C                     ELSE                                           163136
      *                                                                   163136
     C           ZZINDY    MULT @@RATE    @@W157 157                      S01434
      *                                                                   163136
     C                     END                                            163136
      *                                                                   163136
     C           @@W157    MULT @@AMT     @@W210 210H                     S01434
     C*                                                                   S01434
     C**  ROUND DOWN IF ROUND DOWN INDICATOR IS 'Y'                       S01434
     C*                                                                   S01434
     C           @@RDFC    IFEQ 'Y'                                       S01434
     C           @@W210    DIV  @@YEAR    @@INTR                          S01434
     C                     ELSE                                           S01434
     C           @@W210    DIV  @@YEAR    @@INTR 150H                     S01434
     C                     END                                            S01434
     C/COPY WNCPYSRC,MM5310C002
      * Interest has been calculated                                                          CDL093
     C           INTCLC    TAG                                                                CDL093
     C*                                                                   S01434
     C           M10309    ENDSR                                          S01434
     C*                                                                   S01434
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* SRDLNO   - To validate new deal number                        *
     C*                                                               *
     C*****************************************************************
     C           SRDLNO    BEGSR
     C*
     C** CHECK THAT NEW DEAL NUMBER IS VALID
     C*
     C***********DDDLN2    IFEQ *BLANK                     - B1           S01434
     C***********DDDLN2    OREQ *ZEROS                                    S01434
     C***********          MOVE '1'       *IN36                           S01434
     C***********          MOVEL'MM89006' ZAMSID                          S01434
     C***********          EXSR ZASNMS                                    S01434
     C***********          MOVE '1'       *IN75                           S01434
     C***********          END                             - E1           S01434
     C/COPY WNCPYSRC,MM5310C003
     C*                                                                   S01434
     C**  Check for a live record on CADLFALL.                            S01434
     C           DDDLN2    IFEQ *BLANKS                                   S01434
     C           *IN65     DOUEQ'0'                                       S01434
     C           1         SETLLCADLFALL                                  S01434
     C                     READ CADLFALL                 65               S01434
     C*                                                                   S01434
     C**  If a live record is found, delete it.                           S01434
     C           *IN65     IFEQ '0'                                       S01434
     C                     MOVE FKDN38    DDDLN2                          S01434
     C                     DELETCADLFAP0                                  S01434
     C*                                                                   S01434
     C**  Otherwise, call the regeneration program.                       S01434
     C                     ELSE                                           S01434
     C                     CALL 'CA0040'                                  S01434
     C                     PARM           @TERM   1                       S01434
     C*                                                                   S01434
     C**  If an error occurs in the called program, perform a rollback,   S01434
     C**  and by-pass all further processing.                             S01434
     C           @TERM     IFEQ 'E'                                       S01434
     C***********          ROLBK                                   S01434 173661
     C**********           MOVE '1'       *IN32                    S01434 190336
     C                     MOVE '1'       *IN36                           190336
     C                     MOVE '1'       *IN75                           S01434
     C                     MOVE ' '       @TERM                           S01434
     C                     MOVEL'MMM0145' ZAMSID                          S01434
     C                     EXSR ZASNMS                                    S01434
     C                     MOVE '0'       *IN65                           S01434
     C/COPY WNCPYSRC,MM5310C013
     C                     GOTO PGMERR                                    S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     MOVE 'Y'       AUTO    1                       S01434
     C                     END                                            S01434
      *                                                                   S01434
     C                     MOVE DDDLN2    TEST6   60
     C                     MOVELTEST6     ALPH6   6
     C*
     C           DDDLN2    IFNE ALPH6                      - B1
     C                     MOVE '1'       *IN36
     C***********          MOVEL'MM89005' ZAMSID                          S01434
     C                     MOVEL'MMM0672' ZAMSID                          S01434
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN75
     C                     END                             - E1
     C*
     C           *IN36     IFEQ '0'                        - B1
     C           *IN75     ANDEQ'0'
     C           DDDL2N    CHAINCADENQLL             72
     C*                                                                   S01434
     C*                                                                   39187
     C* TEST IN DEALS FILE AND HISTORIC DEALS FILE                        39187
     C*                                                                   39187
     C           *IN72     IFEQ '1'                                       39187
     C           DDDL2N    CHAINDEALS                72                   39187
     C           *IN72     IFEQ '1'                                       39187
     C           DDDL2N    CHAINDEALSH               72                   39187
     C                     END                                            39187
     C                     END                                            39187
     C*
     C           *IN72     IFEQ '0'                        - B2
     C                     MOVE '1'       *IN36
     C***********          MOVEL'MM89009' ZAMSID                          S01434
     C                     MOVEL'MMM0673' ZAMSID                          S01434
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN75
     C                     END                             - E2
     C                     END                             - E1
     C*
     C*Read table range
     C***********1         SETLLSDDLNOPD                                   B9684
     C*********************READ SDDLNOPD                 89                B9684
     C*********************MOVE '0'       *IN88                            B9684
     C*
     C* Check the deal number if included in range
     C*
     C************IN89     DOWEQ'0'                        - B1            B9684
     C***********DDDL2N    IFGE ARFDIR                     - B2            B9684
     C***********DDDL2N    ANDLEARLDIR                                     B9684
     C*
     C*********************MOVE '1'       *IN88                            B9684
     C*********************END                             - E2            B9684
     C*********************READ SDDLNOPD                 89                B9684
     C*********************END                             - E1            B9684
     C*
     C**  Check that the deal number is in the allowed range.              B9684
     C           AUTO      IFNE 'Y'                                       S01434
     C                     MOVE '0'       *IN88                            B9684
     C           DDDL2N    IFLT NORDLN                     - B1            B9684
     C           DDDL2N    OREQ 999999                                     B9684
     C                     MOVE '1'       *IN88                            B9684
     C                     END                                             B9684
     C*                                                                    B9684
     C           *IN88     IFEQ '1'                        - B1            B9684
     C                     MOVE '1'       *IN36
     C***********          MOVEL'MM89010' ZAMSID                          S01434
     C                     MOVEL'MMM0674' ZAMSID                          S01434
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN75
     C                     END                             - E1
     C                     END                                            S01434
     C                     MOVE 'N'       AUTO                            S01434
     C/COPY WNCPYSRC,MM5310C004                                           S01408
     C*
     C***********          ENDSR                                          S01434
     C           PGMERR    ENDSR                                          S01434
     C*================================================================
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* SRPRA1   - To validate principal entered                      *
     C*                                                               *
     C*****************************************************************
      *
     C           SRPRA1    BEGSR
      *
     C                     MOVE 'N'       WWNEGI  1
      *
     C           HKAMNP    IFLT *ZERO
     C                     MOVE 'Y'       WWNEGI
     C                     END
      *
     C                     MOVE *BLANK    @@ALPH
     C                     MOVE DDPRIN    @@ALPH
     C           15        SUB  HKCYDP    @@IINT
     C                     Z-ADDHKCYDP    @@IDP
     C                     MOVE *BLANK    @@ERCD
     C                     MOVE 'Y'       @@MTID  1                       077895
     C                     EXSR ZA0840
      *
      **   If the return code is equal to  1 or 2 the amount is
      **   invalid
     C           @@ERCD    IFEQ 1                          *B2
     C           @@ERCD    OREQ 2
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN37
     C***********          MOVEL'CBW0032' ZAMSID                          S01434
     C                     MOVEL'MMM0675' ZAMSID                          S01434
     C***********          MOVEL'LZUSRMSG'ZAMSGF                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS
     C                     END
      *
      **   If the amount returned by the subroutine is negative
      **   or nil sending a mesage
     C           *IN37     IFEQ '0'                        *B1
     C           @@AMT     ANDLE*ZEROS
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN37
     C***********          MOVEL'CBW0033' ZAMSID                          S01434
     C                     MOVEL'MMM0676' ZAMSID                          S01434
     C***********          MOVEL'LZUSRMSG'ZAMSGF                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS
     C                     END                             *E1
      **   If the amount returned by the subroutine is valid
      **   moving the amount in a work field
     C           *IN37     IFEQ '0'
     C                     MOVE @@ALPH    DDPRIN
     C                     MOVE @@AMT     WWPRIN 150
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C           HKCOLF    ANDEQ'Y'                                       CGL011
      *                                                                   CGL011
     C           WWPRIN    IFLT HKAMNP                                    CGL011
     C           WWPRIN    ANDNEW#PRNC                                    CGL011
     C                     MOVE *ON       *IN37                           CGL011
     C                     MOVE *ON       *IN75                           CGL011
     C                     Z-ADDWWPRIN    W#PRNC                          CGL011
     C                     MOVEL'MMM0694' ZAMSID                          CGL011
     C                     EXSR ZASNMS                                    CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CEU015
      ** Convert principal amount to Euro equivalent                      CEU015
      *                                                                   CEU015
     C           @EUROL    IFEQ 'Y'                                       144199
     C*                                                                   144199
     C                     CALL 'EU0200'                                  CEU015
     C                     PARM *BLANKS   P@RTCD  7        RETURN CODE    CEU015
     C                     PARM WWPRIN    P@FRAM 183       TRANS AMT      CEU015
     C                     PARM HKCCY     P@FRCY  3        TRANS CCY      CEU015
     C                     PARM BKEURO    P@TOCY  3        SETTL CCY      CEU015
     C                     PARM           P@OUTA 150       SETTL AMT      CEU015
     C                     PARM           P@INTA 183       INT SET AMT    CEU015
     C                     PARM           P@EXRT 159       EXCH RATE      CEU015
     C                     PARM           P@MDIN  1        M/D IND        CEU015
      *                                                                   CEU015
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU015
     C           *LOCK     IN   LDA                                       CEU015
     C                     MOVEL'EU0200'  DBFILE                          CEU015
     C                     MOVE '009'     DBASE            **********     CEU015
     C                     MOVELHKCCY     DBKEY            *  009   *     CEU015
     C                     OUT  LDA                        **********     CEU015
     C                     EXSR *PSSR                                     CEU015
     C                     ELSE                                           CEU015
      *                                                                   CEU015
      **   Use the SR/ZEDIT to format the screen field                    CEU015
      *                                                                   CEU015
     C                     Z-ADD*ZEROS    ZFLD15                          CEU015
     C                     MOVE P@OUTA    ZFLD15                          CEU015
      *                                                                   CEU015
      **   Access AOCURRR0 to get decimal places for Euros                CEU015
      *   (database error handling done in access program)                CEU015
     C                     CALL 'AOCURRR0'                                CEU015
     C                     PARM '*DBERR ' @RTCD   7                       CEU015
     C                     PARM '*KEY   ' @OPTN   7                       CEU015
     C                     PARM BKEURO    @AJCD   3                       CEU015
     C           SDCURR    PARM SDCURR    DSSDY                           CEU015
      *                                                                   CEU015
     C                     Z-ADDA6NBDP    ZDECS                           CEU015
     C                     EXSR ZSEDIT                                    CEU015
     C                     MOVE ZOUT21    SEAMT                           CEU015
      *                                                                   CEU015
      **   Save number of decimal places for later output to MMDELDPP     CEU015
     C**   and currency spot rate as well to give new base ccy rate       143525
      *                                                                   CEU015
     C                     Z-ADDA6NBDP    WNBDP                           CEU015
     C                     Z-ADDA6SPRT    WSPRT                           143525
     C                     ENDIF                                          CEU015
     C*                                                                   144199
     C                     ENDIF                                          144199
     C*                                                                   144199
     C                     ELSE                                           CEU015
     C                     MOVE *BLANKS   SEAMT                           CEU015
     C                     END                             *E1
      *
     C                     ENDSR
      *
      /EJECT
     C*================================================================
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* SRPRA2   - To set up new principal amount                     *
     C*                                                               *
     C*****************************************************************
      *
     C           SRPRA2    BEGSR
      *
     C                     MOVE 'N'       WWNEGI  1
      *
     C           HKAMNP    IFLT *ZERO
     C                     Z-SUBHKAMNP    HKAMNP
     C                     MOVE 'Y'       WWNEGI
     C                     END
      *
     C           HKMTTI    IFLT *ZERO
     C*********************Z-SUBHKIMAT    HKMTTI                          084171
     C                     Z-SUBHKMTTI    HKMTTI                          084171
     C                     END
     C/COPY WNCPYSRC,MM5310C008
     C*                                                                   080603
     C/COPY WNCPYSRC,MM5310C009
     C** Calculate Interest Tax, for Interest Paid Separately             080603
     C** Taxed Deals                                                      080603
     C*                                                                   080603
     C                     Z-ADD*ZERO     WWTAXA 130                      080603
     C*                                                                   080603
      *                                                                                       CDL013
      *** if CAR CDL013 is installed.                                                         CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
     C           HKIPDS    ANDEQ'N'                                                           CDL013
      *                                                                                       CDL013
      *** if Tax indicator is ZERO set WHT rate to ZERO.                                      CDL013
     C           HKMTAX    IFEQ '0'                                                           CDL013
     C                     Z-ADD0         ULWHTR  52                                          CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** Set WHT rate.                                                                       CDL013
     C                     SELEC                                                              CDL013
     C           HKMTAX    WHEQ '1'                                                           CDL013
     C                     Z-ADDETXR1     ULWHTR                                              CDL013
     C           HKMTAX    WHEQ '2'                                                           CDL013
     C                     Z-ADDETXR2     ULWHTR                                              CDL013
     C           HKMTAX    WHEQ '3'                                                           CDL013
     C                     Z-ADDETXR3     ULWHTR                                              CDL013
     C           HKMTAX    WHEQ '4'                                                           CDL013
     C                     Z-ADDETXR4     ULWHTR                                              CDL013
     C           HKMTAX    WHEQ '5'                                                           CDL013
     C                     Z-ADDETXR5     ULWHTR                                              CDL013
     C           HKMTAX    WHEQ '6'                                                           CDL013
     C                     Z-ADDETXR6     ULWHTR                                              CDL013
     C           HKMTAX    WHEQ '7'                                                           CDL013
     C                     Z-ADDETXR7     ULWHTR                                              CDL013
     C           HKMTAX    WHEQ '8'                                                           CDL013
     C                     Z-ADDETXR8     ULWHTR                                              CDL013
     C           HKMTAX    WHEQ '9'                                                           CDL013
     C                     Z-ADDETXR9     ULWHTR                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** If WHT rate is ZERO set tax amount to ZERO.                                         CDL013
     C           ULWHTR    IFEQ *ZERO                                                         CDL013
     C                     Z-ADD0         WWTAXA                                              CDL013
      *                                                                                       CDL013
      *** otherwise calculate tax amount.                                                     CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** if Deal Ccy is equal to Base Ccy round down Interest Amount.                        CDL013
      *** and CDL081 is off                                                                   CDL081
      *                                                                                       CDL081
     C           HKCCY     IFEQ BJCYCD                                                        CDL013
     C           CDL081    ANDEQ'N'                                                           CDL081
      *                                                                                       CDL013
      *** set work adjustment field according to decimal places.                              CDL013
     C                     SELEC                                                              CDL013
     C           HKCYDP    WHEQ 1                                                             CDL013
     C                     Z-ADD10        ULWKAD  40                                          CDL013
     C           HKCYDP    WHEQ 2                                                             CDL013
     C                     Z-ADD100       ULWKAD                                              CDL013
     C           HKCYDP    WHEQ 3                                                             CDL013
     C                     Z-ADD1000      ULWKAD                                              CDL013
     C           HKCYDP    WHEQ 0                                                             CDL013
     C                     Z-ADD1         ULWKAD                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
      *** round down Interest Amount.                                                         CDL013
     C           HKMTTI    DIV  ULWKAD    ULTINT 150                                          CDL013
     C                     MULT ULWKAD    ULTINT                                              CDL013
      *                                                                                       CDL013
      *** calculate and then round down Tax Amount.                                           CDL013
     C           ULTINT    MULT ULWHTR    WWTAXA                                              CDL013
     C                     DIV  100       WWTAXA                                              CDL013
     C           WWTAXA    DIV  ULWKAD    ULTXAM 150                                          CDL013
     C           ULTXAM    MULT ULWKAD    WWTAXA                                              CDL013
      *                                                                                       CDL013
      *** otherwise (Deal Ccy NOT = Base Ccy) calculate Tax amount                            CDL013
      *** without rounding down.                                                              CDL013
     C                     ELSE                                                               CDL013
     C           HKMTTI    MULT ULWHTR    WWTAXA                                              CDL013
      *                                                                                       CDL081
      ** Check if tax amount is to be rounded down                                            CDL081
      *                                                                                       CDL081
     C           HKCCY     IFEQ BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C           HKCCY     ORNE BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#NBRD    ANDEQ'Y'                                                           CDL081
     C                     DIV  100       WWTAXA                                              CDL081
     C                     ELSE                                                               CDL081
     C                     DIV  100       WWTAXA    H                                         CDL013
     C                     ENDIF                                                              CDL081
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** otherwise perform Original Tax calculations.                                        CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CCP4                                           S01408
     C*                                                                   S01408
     C           HKIPDS    IFEQ 'N'                                       080603
     C           HKMTAX    ANDEQ'Y'                                       080603
     C*                                                                   080603
     C** If BRT SAR is Installed                                          080603
     C*                                                                   080603
     C           S01383    IFEQ 'Y'                                       080603
     C*                                                                   080603
     C** Access Customer Tax indicator                                    080603
     C*                                                                   080603
     C           HKCNUM    CHAINSDCBRTL1             76                   080603
     C           *IN76     IFEQ '1'                                       080603
     C           *LOCK     IN   LDA                                       080603
     C                     Z-ADD7         DBASE            ***************080603
     C                     MOVEL'SDCBRTL1'DBFILE           * DBERROR 049 *080603
     C                     MOVELHKCNUM    DBKEY            ***************080603
     C                     OUT  LDA                                       080603
     C                     EXSR *PSSR                                     080603
     C                     END                                            080603
     C*                                                                   080603
     C** Calculate Tax for Liable and Part Liable Customers               080603
     C*                                                                   080603
     C           TAXIND    IFEQ 'L'                                       080603
     C           TAXIND    OREQ 'P'                                       080603
     C*                                                                   080603
     C** If the Maturity Date is Less than the effective date use the     080603
     C** previous rate                                                    080603
     C*                                                                   080603
     C           WWMDAT    IFLT DEFF                                      080603
     C           HKMTTI    MULT PBRTR     WWTAXA                          080603
     C                     ELSE                                           080603
     C           HKMTTI    MULT BRTR      WWTAXA                          080603
     C                     END                                            080603
     C*                                                                   080603
     C** If Partially Liable, half Tax payable                            080603
     C*                                                                   080603
     C           TAXIND    IFEQ 'P'                                       080603
     C                     DIV  2         WWTAXA                          080603
     C                     END                                            080603
     C                     END                                            080603
     C*                                                                   080603
     C** ELSE BRT SAR is NOT Installed                                    080603
     C*                                                                   080603
     C                     ELSE                                           080603
     C*                                                                   080603
     C** Calculate Hong Kong/Withholding Tax                              080603
     C/COPY WNCPYSRC,MM5310C014
     C*                                                                   080603
     C           HKMTTI    MULT BNHKTR    WWTAXA                          080603
     C                     END                                            080603
     C*                                                                   080603
     C** Round down or Half Adjust                                        080603
     C*                                                                   080603
     C           HKRDFC    IFEQ 'Y'                                       080603
     C                     DIV  100       WWTAXA                          080603
     C                     ELSE                                           080603
     C                     DIV  100       WWTAXA    H                     080603
     C                     END                                            080603
     C                     END                                            080603
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CCP5                                           S01408
     C*                                                                   S01408
     C*                                                                   080603
      *
     C***********MMINPS    IFEQ 'N'                                       S01434
     C           HKIPDS    IFEQ 'N'                                       S01434
     C           HKFUID    ANDNE'Y'                                       080603
     C           HKAMNP    ADD  HKMTTI    WWPRIN
     C                     SUB  WWTAXA    WWPRIN                          080603
     C                     ELSE
     C                     Z-ADDHKAMNP    WWPRIN
     C                     END
      *
      **   Use the SR/ZEDIT to format the file amount
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE WWPRIN    ZFLD15
     C                     Z-ADDHKCYDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDPRIN
     C                     MOVE '1'       *IN75
      *                                                                   CEU015
      ** Convert principal amount to Euro equivalent                      CEU015
      *                                                                   CEU015
     C           @EUROL    IFEQ 'Y'                                       144199
     C*                                                                   144199
     C                     CALL 'EU0200'                                  CEU015
     C                     PARM *BLANKS   P@RTCD  7        RETURN CODE    CEU015
     C                     PARM WWPRIN    P@FRAM 183       TRANS AMT      CEU015
     C                     PARM HKCCY     P@FRCY  3        TRANS CCY      CEU015
     C                     PARM BKEURO    P@TOCY  3        SETTL CCY      CEU015
     C                     PARM           P@OUTA 150       SETTL AMT      CEU015
     C                     PARM           P@INTA 183       INT SET AMT    CEU015
     C                     PARM           P@EXRT 159       EXCH RATE      CEU015
     C                     PARM           P@MDIN  1        M/D IND        CEU015
      *                                                                   CEU015
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU015
     C           *LOCK     IN   LDA                                       CEU015
     C                     MOVEL'EU0200'  DBFILE                          CEU015
     C                     MOVE '009'     DBASE            **********     CEU015
     C                     MOVELHKCCY     DBKEY            *  009   *     CEU015
     C                     OUT  LDA                        **********     CEU015
     C                     DUMP                                           145001
     C                     EXSR *PSSR                                     CEU015
     C                     ELSE                                           CEU015
      *                                                                   CEU015
      **   Use the SR/ZEDIT to format the screen field                    CEU015
      *                                                                   CEU015
     C                     Z-ADD*ZEROS    ZFLD15                          CEU015
     C                     MOVE P@OUTA    ZFLD15                          CEU015
      *                                                                   CEU015
      **   Access AOCURRR0 to get decimal places for Euros                CEU015
      *   (database error handling done in access program)                CEU015
     C                     CALL 'AOCURRR0'                                CEU015
     C                     PARM '*DBERR ' @RTCD   7                       CEU015
     C                     PARM '*KEY   ' @OPTN   7                       CEU015
     C                     PARM BKEURO    @AJCD   3                       CEU015
     C           SDCURR    PARM SDCURR    DSSDY                           CEU015
      *                                                                   CEU015
     C                     Z-ADDA6NBDP    ZDECS                           CEU015
     C                     EXSR ZSEDIT                                    CEU015
     C                     MOVE ZOUT21    SEAMT                           CEU015
      *                                                                   CEU015
      **   Save number of decimal places for later output to MMDELDPP     CEU015
     C**   and currency spot rate as well to give new base ccy rate       143525
      *                                                                   CEU015
     C                     Z-ADDA6NBDP    WNBDP                           CEU015
     C                     Z-ADDA6SPRT    WSPRT                           143525
     C                     ENDIF                                          CEU015
     C                     ENDIF                                          144199
      *
     C                     ENDSR
      *
     C*================================================================
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CCPG                                           S01408
     C*                                                                   S01408
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* SRMAT1   - To validate new maturity date                      *
     C*                                                               *
     C*****************************************************************
      *
     C           SRMAT1    BEGSR
      *
     C                     SETOF                     41                   089846
     C                     MOVELDDMDAT    WWNMAT  60
     C                     MOVELWWNMAT    WANMAT  6
      *
     C           DDMDAT    IFNE WANMAT
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN75
     C***********          MOVEL'CBW0034' ZAMSID                          S01434
     C                     MOVEL'MMM0677' ZAMSID                          S01434
     C***********          MOVEL'LZUSRMSG'ZAMSGF                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS
     C                     END
      *
     C           *IN38     IFEQ '0'
     C                     MOVE DDMDAT    ZDATE
     C*********            MOVE '0'       *IN98                                               188500
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN41                           S01434
     C***********          MOVE '1'       *IN75                           S01434
     C***********          MOVEL'CBW0035' ZAMSID                          S01434
     C***********          MOVEL'LZUSRMSG'ZAMSGF                          S01434
     C                     MOVE '1'       *IN75                           087656
     C                     MOVEL'MMM0678' ZAMSID                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADDZDAYNO    WWMAT5  50
     C                     END
     C                     END
      *
     C           *IN38     IFEQ '0'
     C                     Z-ADDWWMAT5    ZDAYNO
     C           DDACTN    IFEQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C                     MOVE BKEURO    ZCCY                            CEU015
     C                     ELSE                                           CEU015
     C                     MOVE HKCCY     ZCCY
     C                     ENDIF                                          CEU015
     C***********          MOVE *BLANK    ZOPT                            S01434
     C***********          EXSR ZDATE5                                    S01434
     C                     EXSR ZCHKH                                     S01434
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN75
     C***********          MOVEL'CBW0036' ZAMSID                          S01434
     C***********          MOVEL'LZUSRMSG'ZAMSGF                          S01434
     C                     MOVEL'MMM0679' ZAMSID                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     MOVEL'Enter'   ZAMSDA                          S01434
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
     C           *IN38     IFEQ '0'
     C           WWMAT5    ANDLEWWMDAT
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN75
     C***********          MOVEL'CBW0037' ZAMSID                          S01434
     C                     MOVEL'MMM0680' ZAMSID                          S01434
     C***********          MOVEL'LZUSRMSG'ZAMSGF                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS
     C                     END
      *
     C           *IN38     IFEQ '0'
     C                     Z-ADDWWMAT5    @@DAYN  50
     C                     Z-ADDWWMAT5    NEWMAT  50                      066160
     C                     EXSR ZA0710
     C                     MOVE @@VDT     WWNMA8  8
     C                     END
      *
     C                     ENDSR
      *
     C*================================================================
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* SRMAT2   - To set up new maturity date                        *
     C*                                                               *
     C*****************************************************************
      *
     C           SRMAT2    BEGSR
      *
     C***********FFAURO    IFNE 'Y'                                       S01434
     C           HKAURO    IFNE 'Y'                                       S01434
     C                     MOVE *BLANKS   DDMDAT
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN75
     C***********          MOVEL'CBW0042' ZAMSID                          S01434
     C***********          MOVEL'LZUSRMSG'ZAMSGF                          S01434
     C                     MOVEL'MMM0681' ZAMSID                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS
     C                     ELSE
     C***********          MOVE FFFREQ    ZFREQ                           S01434
      *                                                                                       243842
      ** HKROFQ=A means Monthly on Accrual Profit Date.                                       243842
      ** If system is not Monthly accrual, force HKROFQ to be = M Monthly                     243842
      *                                                                                       243842
     C           HKROFQ    IFEQ 'A'                                                           243842
     C           BKAPFQ    ANDEQ'D'                        Daily                              243842
     C           HKROFQ    OREQ 'A'                                                           243842
     C           BKAPFQ    ANDEQ'F'                        Fortnightly                        243842
     C           HKROFQ    OREQ 'A'                                                           243842
     C           BKAPFQ    ANDEQ'W'                        Weekly                             243842
     C                     MOVE 'M'       ZFREQ                                               243842
     C                     ELSE                                                               243842
     C                     MOVE HKROFQ    ZFREQ                           S01434
     C                     ENDIF                                                              243842
      *                                                                                       243842
     C                     MOVE WWMDAT    ZDAYNO
     C***********          MOVE FFDNUM    ZMDAY                           S01434
     C                     MOVE HKRLDN    ZMDAY                           S01434
     C           DDACTN    IFEQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C                     MOVE BKEURO    ZCCY                            CEU015
     C                     MOVE BKEURO    CCY                             CEU015
     C                     ELSE                                           CEU015
     C                     MOVE HKCCY     ZCCY
     C                     MOVE HKCCY     CCY                             S01434
     C                     ENDIF                                          CEU015
     C                     EXSR ZFRQA
     C**********           MOVE '0'       *IN98                                               188500
     C                     Z-ADDZDAYNO    NEWMAT  50                      066160
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDMDAT
     C                     Z-ADDZDATE     @@DAYN  50
     C                     EXSR ZA0710
     C                     MOVE @@VDT     WWNMA8  8
     C                     MOVE '1'       *IN75
     C                     END
      *
     C                     ENDSR
      *
     C*================================================================   S01434
      /EJECT                                                              S01434
     C*================================================================   S01434
     C*                                                               *   S01434
     C*****************************************************************   S01434
     C* SRINT1   -   To Validate Interest Rate/Spread                 *   S01434
     C*****************************************************************   S01434
      *                                                                   S01434
     C           SRINT1    BEGSR                                          S01434
     C*                                                                   S01434
     C**  If Interest-Rate suppressed and                                 S01434
     C**     Spread/Rate, Base-Rate-Code displayed.                       S01434
      *                                                                   S01434
     C           *IN61     IFEQ *ON                                       S01434
     C/COPY WNCPYSRC,MM5310C020
      *                                                                   S01434
     C**  If the spread/rate is blank, this is an error.                  S01434
     C**  Unless base rate code is entered                                S01434
      *                                                                   S01434
     C           DDSPRD    IFEQ *BLANKS                                   S01434
     C                     Z-ADD0         @@AMT                           124141
     C           DDBSRC    IFEQ *BLANKS                                   S01434
     C***********          MOVE '1'       *IN62                    S01434 077895
     C                     MOVE '1'       *IN63                           077895
     C                     MOVEL'MMM0419' ZAMSID                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS                                    S01434
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C**  Check it is a valid figure with 7 decimal places max.           S01434
     C*                                                                   S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C                     Z-ADD7         @@IDP                           S01434
     C                     Z-ADD4         @@IINT                          S01434
     C                     MOVE *BLANK    @@ALPH                          S01434
     C                     MOVE DDSPRD    @@ALPH                          S01434
     C                     MOVE *BLANK    @@ERCD                          S01434
     C                     MOVE 'N'       @@MTID  1                       077895
     C                     EXSR ZA0840                                    S01434
     C*                                                                   S01434
     C           @@ERCD    IFNE 0                                         S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CP10                                           S01408
     C*                                                                   S01408
     C***********          MOVE '1'       *IN62                    S01434 077895
     C***********          MOVE '1'       *IN63                    077895 CEU015
     C                     MOVE '1'       *IN47                           CEU015
     C                     MOVE '1'       *IN75                           CEU015
     C                     MOVEL'MMM0422' ZAMSID                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS                                    S01434
     C*                                                                   S01434
     C                     END                                            S01434
     C                     END                                            S01434
      *                                                                   CEU015
      ** Check if valid base rate code                                    CEU015
      *                                                                   CEU015
      ** If Dealing Rollover Enhancement switched on, and user has        124141
      **  taken option to roll deal over to Euros, check that the         124141
      **  input base rate is a valid Euro base rate.                      124141
      *                                                                   124141
     C           DDACTN    IFEQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C                     CALL 'AOBSRTR0'                                CEU015
     C                     PARM '       ' @RTCD   7                       CEU015
     C                     PARM '*KEY   ' @OPTN   7                       CEU015
     C                     PARM BKEURO    @AJCD   3                       CEU015
     C                     PARM DDBSRC    @DWNB   2                       CEU015
     C********** SDBSRT    PARM SDBSRT    DSFDY                     CEU015CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   CEU015
     C           @RTCD     IFNE *BLANK                                    CEU015
     C                     MOVE 'MMM2704' ZAMSID                          CEU015
     C                     EXSR ZASNMS                                    CEU015
     C                     MOVE *ON       *IN46                           CEU015
     C                     MOVE *ON       *IN75                           CEU015
     C                     MOVE *ON       *IN63                           124141
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
      **  .. else validate base rate in deal currency.                    124141
      *                                                                   124141
X2   C                     ELSE                                           124141
      *                                                                   124141
IF3  C           *IN63     IFEQ '0'                                       124141
     C                     CALL 'AOBSRTR0'                                124141
     C                     PARM *BLANKS   @RTCD                           124141
     C                     PARM '*KEY   ' @OPTN                           124141
     C                     PARM HKCCY     @AJCD   3                       124141
     C                     PARM DDBSRC    @DWND   2                       124141
     C********** SDBSRT    PARM SDBSRT    DSFDY                     124141CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
      *                                                                   124141
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
END3 C                     END                                            124141
     C*                                                                   S01434
      **  If a valid record has been found, find the base rate to use.    124141
      *                                                                   124141
IF2  C           @RTCD     IFEQ *BLANK                                    124141
     C                     MOVELBABSRC    DDBSRC                          124141
      *                                                                   124141
      **  If the deal value date is less than value date of new rate      124141
      **  change, use the previous base rate.                             124141
      *                                                                   124141
     C                     Z-ADDHKMDYY    @@YYYY                          124141
     C                     Z-ADDHKMDMM    @@MTH                           124141
     C                     Z-ADDHKMDDD    @@DAY                           124141
     C                     Z-ADD@@DTIN    ZZDTIN                          124141
     C                     EXSR ZDAT10                                    124141
IF3  C           ZZMDNO    IFLT BAVDNR                                    124141
     C                     Z-ADDBACBSR    @RATE                           124141
      *                                                                   124141
      **  If the deal value date is greater than value date of new rate   124141
      **  change, use the next base rate.                                 124141
      *                                                                   124141
 X3  C                     ELSE                                           124141
     C                     Z-ADDBANBRT    @RATE                           124141
END3 C                     END                                            124141
      *                                                                   124141
     C                     MOVE @@AMT     @SPRD                           124141
     C/COPY WNCPYSRC,MM5310C018
     C           @RATE     ADD  @SPRD     WWINTR                          124141
     C/COPY WNCPYSRC,MM5310C019
 X2  C                     ELSE                                           124141
     C                     MOVE '1'       *IN46                           124141
     C                     MOVE '1'       *IN63                           124141
     C                     MOVEL'MMM0417' ZAMSID                          124141
     C                     MOVEL'DRSMM'   ZAMSGF                          124141
     C                     EXSR ZASNMS                                    124141
END2 C                     END                                            124141
      *                                                                   124141
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C           *IN60     IFEQ *ON                                       S01434
     C*                                                                   S01434
     C********** DDSPRD    IFEQ *BLANKS                            S01434 124141
     C                     MOVE *BLANK    @@ALPH                          S01434
     C                     MOVE DDINTR    @@ALPH                          S01434
     C                     Z-ADD7         @@IDP                           S01434
     C                     Z-ADD4         @@IINT                          S01434
     C                     MOVE *BLANK    @@ERCD                          S01434
     C                     MOVE 'N'       @@MTID  1                       077895
     C*                                                                   S01434
     C                     EXSR ZA0840                                    S01434
     C*                                                                   S01434
     C           @@ERCD    IFNE 0                                         S01434
     C           @@ERCD    OREQ 0                                         CEU015
     C           @@AMT     ANDEQ0                                         CEU015
     C***********          MOVE '1'       *IN62                    S01434 077895
     C                     MOVE '1'       *IN63                           S01434
     C                     MOVEL'MMM0422' ZAMSID                          S01434
     C                     MOVEL'DRSMM'   ZAMSGF                          S01434
     C                     EXSR ZASNMS                                    S01434
     C*                                                                   S01434
     C                     ENDIF                                          S01434
     C** Interest Rate                                                    S01434
     C                     MOVE @@AMT     WWINTR                          S01434
     C*                                                                   S01434
     C**********           ENDIF                                   S01434 124141
     C                     ENDIF                                          S01434
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C**  If Interest Rate in error, set on Screen Error ind              S01434
     C*                                                                   S01434
     C************IN62     IFEQ '1'                                S01434 077895
     C           *IN63     IFEQ '1'                                       077895
     C                     MOVE *ON       *IN75                           S01434
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C**  If the spread/rate is valid, determine the effective rate and   S01434
     C**  place it in the Standard Deal format.                           S01434
     C*                                                                   S01434
     C************IN62     IFEQ '0'                                S01434 077895
     C           *IN63     IFEQ '0'                                       077895
     C                     MOVE WWINTR    HKINTR                          S01434
     C                     MOVE WWINTR    ZFIELD                          S01434
     C                     MOVE 7         ZADEC                           S01434
     C                     EXSR ZEDIT                                     S01434
     C                     MOVE ZFIELD    DDINTR                          S01434
     C                     END                                            S01434
      *                                                                   S01434
     C                     ENDSR                                          S01434
      /EJECT                                                              S01434
     C*                                                               *   S01434
     C*****************************************************************   S01434
     C* SRINT2   - To set up new Interest Rate                        *   S01434
     C*****************************************************************   S01434
      *                                                                   S01434
     C           SRINT2    BEGSR                                          S01434
      *                                                                   S01434
      * Check to see whether 'Interest Rate' or 'Spread' and              S01434
      *    'Base Rate Code' should be displayed on screen.                S01434
      *                                                                   S01434
     C           HKBSRC    IFEQ *BLANKS                                   S01434
     C*                                                                   S01434
     C***********          Z-ADDHKMDYY    @@YYYY                    S01434066160
     C***********          Z-ADDHKMDMM    @@MTH                     S01434066160
     C***********          Z-ADDHKMDDD    @@DAY                     S01434066160
     C***********          Z-ADD@@DTIN    ZZDTIN                    S01434066160
     C***********          EXSR ZDAT10                              S01434066160
     C***********          Z-ADDZZMDNO    ZZBEG                     S01434066160
     C                     Z-ADDNEWMAT    ZZBEG                     S01434066160
     C*                                                                   S01434
     C           DDACTN    IFEQ 'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
     C                     MOVE BKEURO    @CCY    3                       CEU015
     C                     ELSE                                           CEU015
     C                     MOVE HKCCY     @CCY                            CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C***********          MOVE HKCCY     KCCY                     S01434 CEU015
     C                     MOVE @CCY      KCCY                            CEU015
     C***********          MOVE ZZMDNO    KPRDN                     S01434066160
     C                     MOVE NEWMAT    KPRDN                           066160
     C*                                                                   S01434
     C           KINTR     CHAINDLINTRL2             64                   S01434
     C*                                                                   S01434
     C           *IN64     IFEQ '1'                                       S01434
     C           KINTR     SETLLDLINTRL2                                  S01434
     C                     READPDLINTRL2                 65               S01434
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C***********HWCCY     IFNE HKCCY                              S01434 CEU015
     C           HWCCY     IFNE @CCY                                      CEU015
     C           DDACTN    IFNE 'C'                                       CEU015
     C                     MOVE HKINTR    ZFIELD                          S01434
     C                     ELSE                                           CEU015
     C                     MOVE *BLANKS   ZFIELD                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C** IF PERIOD IS YEARLY CHANGE LOGICAL                               066160
     C*                                                                   066160
     C           HWTPRD    IFEQ 'Y'                                       066160
     C                     MOVE 'Y'       YEARLY  1                       066160
     C           KINTR     CHAINDLINTRL1             64                   066160
     C*                                                                   066160
     C** IF NO EXACT RECORD USE PRECEDING ONE                             066160
     C*                                                                   066160
     C           *IN64     IFEQ '1'                                       066160
     C           KINTR     SETLLDLINTRL1                                  066160
     C                     READPDLINTRL1                 65               066160
     C                     END                                            066160
     C                     ELSE                                           066160
     C                     MOVE 'N'       YEARLY                          066160
     C                     END                                            066160
     C*                                                                   066160
     C           HKMTYP    IFEQ 'CI'                                      S01434
     C           HKMTYP    OREQ 'TI'                                      S01434
     C           HKMTYP    OREQ 'IP'                                      S01434
     C/COPY WNCPYSRC,MM5310C015
     C***********          MOVE HWLDRT    ZFIELD                    S01434066160
     C                     Z-ADDHWLDRT    ZINRAT                          066160
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C           HKMTYP    IFEQ 'TD'                                      S01434
     C           HKMTYP    OREQ 'IT'                                      S01434
     C***********          MOVE HWBRRT    ZFIELD                    S01434066160
     C                     Z-ADDHWBRRT    ZINRAT                          066160
     C                     ENDIF                                          S01434
     C*                                                                   066160
     C                     Z-ADDHWPRDN    ZINDAT                          066160
     C                     Z-ADDNEWMAT    ZIBDAT                          066160
     C*                                                                   066160
     C** GET NEXT RECORD FROM APPROPRIATE FILE                            066160
     C*                                                                   066160
     C           YEARLY    IFEQ 'Y'                                       066160
     C                     READ DLINTRL1                 65               066160
     C                     ELSE                                           066160
     C                     READ DLINTRL2                 65               066160
     C                     END                                            066160
     C*                                                                   066160
     C** FIND INTERPOLATED RATE IF NECESSARY                              066160
     C*                                                                   066160
     C***********HWCCY     IFEQ HKCCY                              066160 CEU015
     C           HWCCY     IFEQ @CCY                                      CEU015
     C           HWTPRD    ANDNE'D'                                       066160
     C*                                                                   066160
     C           HKMTYP    IFEQ 'CI'                                      066160
     C           HKMTYP    OREQ 'TI'                                      066160
     C           HKMTYP    OREQ 'IP'                                      066160
     C/COPY WNCPYSRC,MM5310C016
     C                     Z-ADDHWLDRT    ZIFRAT                          066160
     C                     ENDIF                                          066160
     C*                                                                   066160
     C           HKMTYP    IFEQ 'TD'                                      066160
     C           HKMTYP    OREQ 'IT'                                      066160
     C                     Z-ADDHWBRRT    ZIFRAT                          066160
     C                     ENDIF                                          066160
     C*                                                                   066160
     C                     Z-ADDHWPRDN    ZIFDAT                          066160
     C**********           EXSR ZINTPL                                                 066160 CAS001
     C                     Z-ADD0         ZIBRAT                                              CAS001
     C                     CALL 'ZAINTPL'                                                     CAS001
     C                     PARM           ZINDAT  50                                          CAS001
     C                     PARM           ZIBDAT  50                                          CAS001
     C                     PARM           ZIFDAT  50                                          CAS001
     C                     PARM           ZINRAT 139                                          CAS001
     C                     PARM           ZIFRAT 139                                          CAS001
     C                     PARM           ZIBRAT 139                                          CAS001
     C                     Z-ADDZIBRAT    NEWRAT                          066160
     C*                                                                   066160
     C** ELSE USE RATE FROM FIRST RECORD                                  066160
     C*                                                                   066160
     C                     ELSE                                           066160
     C                     Z-ADDZINRAT    NEWRAT                          066160
     C                     END                                            066160
     C                     MOVE NEWRAT    ZFIELD                          066160
     C           DDACTN    IFEQ 'C'                                       CEU015
     C                     MOVE NEWRAT    WWINTR                          CEU015
     C                     ENDIF                                          CEU015
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C           ZFIELD    IFNE *BLANK                                    CEU015
     C                     MOVE 7         ZADEC                           S01434
     C                     EXSR ZEDIT                                     S01434
     C*                                                                   S01434
     C                     MOVE ZFIELD    DDINTR                          S01434
     C                     ENDIF                                          CEU015
     C*                                                                   S01434
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CP11                                           S01408
     C*                                                                   S01408
     C                     MOVE *ON       *IN60                           S01434
     C                     MOVE *OFF      *IN61                           S01434
     C*                                                                   S01434
     C                     ELSE                                           S01434
     C*                                                                   S01434
     C                     MOVE HKSPRD    ZFIELD                          S01434
     C*                                                                   S01434
     C                     MOVE 7         ZADEC                           S01434
     C                     EXSR ZEDIT                                     S01434
     C*                                                                   S01434
     C                     MOVE ZFIELD    DDSPRD                          S01434
     C                     MOVE HKBSRC    DDBSRC                          S01434
     C*                                                                   S01434
     C                     MOVE *OFF      *IN60                           S01434
     C                     MOVE *ON       *IN61                           S01434
     C                     ENDIF                                          S01434
      *                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           DDACTN    ANDEQ'C'                                       CEU015
      *                                                                   CEU015
      ** Default Interest calculation method                              CEU015
      *                                                                   CEU015
     C                     MOVE HKICMT    SICMT                           CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   S01434
     C                     ENDSR                                          S01434
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* ZASNMS   - Send message to program message queue              *
     C*                                                               *
     C* CALLS    - Y2SNMGC                                            *
     C*                                                               *
     C* CALLED BY- #ZBAA - Validate key fields                        *
     C*          - #CC   - Validate detail screen                     *
     C*          - #CAA  - Process update by another workstation      *
     C*                                                               *
     C*****************************************************************
     C           ZASNMS    BEGSR
     C*
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM            Program queue
     C                     PARM           ZAPGRL           Rel queue
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTP           Message type.
     C*
     C** Clear all fields for default mechanism next time.
     C                     MOVEL*BLANK    ZAPGM            Message queue
     C                     MOVEL*BLANK    ZAPGRL           Rel queue
     C                     MOVEL*BLANK    ZAMSDA           Message data.
     C                     MOVEL*BLANK    ZAMSTP           Message type.
     C*
     C           ZASNM9    ENDSR                           ZASNM9 TAG
     C*
      /EJECT
     C*================================================================
      ** #ZBAA  S/R TO VALIDATE KEY FIELDS
      **
      ** CALLED FROM S/R #BA  , #BB
      **
      ** CALLS  - ZASNMS - Send message to program message queue
      **
     C*================================================================
     C*
     C           #ZBAA     BEGSR                           ** #ZBAA  BSR**
     C*
     C** RESET ERROR INDICATORS
     C*
     C                     MOVE '0'       *IN75
     C                     SETOF                     313233               066154
     C**
     C*  CHECK THAT USER IS A DEALER
     C**
     C****Get*the*user*id*from*PSDS*and*use*this*to*chain*to*the**********S01434
     C****user*details.***************************************************S01434
     C***********          MOVELUSID      KUSID   3                       S01434
     C***********KUSID     CHAINMMUSERLL             60                   S01434
     C************IN60     IFEQ '1'                        - B1           S01434
     C***********IQUMMD    ORNE 'Y'                                       S01434
     C***********          MOVEL'MMM0008' ZAMSID                          S01434
     C***********          MOVE '1'       *IN75                           S01434
     C***********          EXSR ZASNMS                                    S01434
     C***********          END                             - E1           S01434
     C*                                                                   144199
     C                     MOVE ' '       @EUROL  1                       144199
     C*
     C           *IN75     IFEQ '0'                        - B1
     C           #BBS2     IFNE 'Y'                                       066154
     C*
     C** ACTION CODE MUST BE BLANK,X
     C*
     C           CEU015    IFNE 'Y'                                       CEU015
     C           DDACTN    IFNE *BLANK                     - B2
     C***********DDACTN    ANDNE'X'                        - B2           S01434
     C***********          MOVEL'MM12100' ZAMSID                          S01434
     C           DDACTN    ANDNE'R'                                       S01434
     C                     MOVEL'MMM0683' ZAMSID                          S01434
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN75
     C                     END                             - E2
      *                                                                   CEU015
     C                     ELSE                                           CEU015
     C           DDACTN    IFNE *BLANK                                    CEU015
     C           DDACTN    ANDNE'R'                                       CEU015
     C           DDACTN    ANDNE'C'                                       CEU015
     C                     MOVEL'MMM2701' ZAMSID                          CEU015
     C                     EXSR ZASNMS                                    CEU015
     C                     MOVE '1'       *IN31                           CEU015
     C                     MOVE '1'       *IN75                           CEU015
     C                     ENDIF                                          CEU015
      *                                                                   144199
     C           DDACTN    IFEQ 'C'                                       144199
     C           #BBS1     ANDEQ'Y'                                       144199
      *                                                                   144199
      ** Check if deal currency is an 'in' currency                       144199
      *  (database error handling done in access program)                 144199
     C                     CALL 'AOCURRR0'                                144199
     C                     PARM '*DBERR ' @RTCD   7                       144199
     C                     PARM '*KEY   ' @OPTN   7                       144199
     C                     PARM DSCCY     @AJCD   3                       144199
     C           SDCURR    PARM SDCURR    DSSDY                           144199
      *                                                                   144199
     C           A6INCY    IFNE 'Y'                                       144199
     C           A6TPSD    ORGT BJRDNB                                    144199
     C                     MOVE 'MMM2702' ZAMSID                          144199
     C                     EXSR ZASNMS                                    144199
     C                     MOVE *ON       *IN31                           144199
     C                     MOVE *ON       *IN75                           144199
     C                     ELSE                                           144199
     C                     MOVE 'Y'       @EUROL                          144199
     C                     ENDIF                                          144199
      *                                                                   144199
     C                     ENDIF                                          144199
      *                                                                   144199
     C                     ENDIF                                          CEU015
     C*
     C** C H E C K   K E Y  F I E L D S
     C*
     C*
     C** ACTION CODE BLANK BUT KEY INPUT
     C*
     C           DDACTN    IFEQ *BLANK                     - B2
     C           DDDLNO    ANDNE*BLANK
     C***********          MOVEL'MM12101' ZAMSID                          S01434
     C                     MOVEL'MMM0684' ZAMSID                          S01434
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN75
     C                     END                             - E2
     C*
     C** KEY CANNOT CONTAIN BLANKS EXCEPT IF REVIEW FROM REQUESTED
     C**  (ACTION CODE MUST BE BLANK)
     C*
     C                     MOVEADDDLNO    DSP,1
     C           ' '       LOKUPDSP                      71
     C           *IN71     IFEQ '1'                        - B2
     C           DDACTN    ANDNE' '
     C***********          MOVEL'MM12106' ZAMSID                          S01434
     C                     MOVEL'MMM0685' ZAMSID                          S01434
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN32
     C                     MOVE '1'       *IN75
     C                     END                             - E2
     C                     END                                            066154
     C*                                                                   066154
     C** Validate branch                                                  066154
     C*                                                                   066154
     C           DDBRCA    IFNE *BLANKS                                   066154
     C           DDACTN    ANDNE*BLANKS                                   066154
     C           #BBS1     ANDNE'Y'                                       066154
     C           #BBS2     ANDNE'Y'                                       066154
     C           DDBRCA    ORNE *BLANKS                                   066154
     C           DDDLNO    ANDNE*BLANKS                                   066154
     C           #BBS1     ANDNE'Y'                                       066154
     C           #BBS2     ANDNE'Y'                                       066154
     C                     MOVEL'MMM0686' ZAMSID                          066154
     C                     EXSR ZASNMS                                    066154
     C                     SETON                     313233               066154
     C                     SETON                     75                   066154
     C                     ELSE                                           066154
     C*                                                                   066154
     C           DDBRCA    IFEQ *BLANKS                                   066154
     C                     MOVELBRC       DDBRCA                          066154
     C                     ELSE                                           066154
     C*                                                                   066154
     C**********           CALL 'AOBRCHR0'                                             066154 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           066154
     C                     PARM '*KEY   ' @OPTN                           066154
     C                     PARM DDBRCA    @BR     3                       066154
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        066154 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   066154
     C           @RTCD     IFNE *BLANKS                                   066154
     C                     MOVEL'MMM0115' ZAMSID                          066154
     C                     EXSR ZASNMS                                    066154
     C                     SETON                     3375                 066154
      ** Load the selected Branch code. If the Branch code was selected   079570
      ** via the Branch selection prompt then, set on *IN42 to indicate   079570
      ** that this process has occurred and set on *IN07 in order to      079570
      ** return to the Header input display.                              079570
     C                     MOVE *BLANKS   SDBRCH                          079570
      ** Load retrieved branch to screen field.                           079570
     C                     ELSE                                           079570
     C           DDBRCA    IFEQ '?'                                       079570
     C                     MOVELA8BRCD    DDBRCA                          079570
     C                     SETON                     0742                 079570
     C                     END                                            079570
      *                                                                   079570
     C                     END                                            066154
     C                     END                                            066154
     C                     END                                            066154
     C*                                                            066154 138751
     C***Validate*Action*Code*for user                             066154 138751
     C***For*single*Branch*systems                                 066154 138751
     C*                                                            066154 138751
     C***********@MBIN     IFEQ 'N'                                066154 138751
     C***********          CALL 'ZVACTU'                           066154 138751
     C***********          PARM ACTN      @ZACTN                   066154 138751
     C***********          PARM           @ERR                     066154 138751
     C***********@ERR      IFNE 0                                  066154 138751
     C***********          MOVE 'FXM0292' ZAMSID                   066154 138751
     C***********          EXSR ZASNMS                             066154 138751
     C***********          SETON                     3175          066154 138751
     C***********          END                                     066154 138751
     C***********          END                                     066154 138751
     C*                                                            066154 138751
     C** For Multibranch systems                                   066154 138751
     C*                                                            066154 138751
     C***********@MBIN     IFEQ 'Y'                                066154 138751
     C*                                                            066154 138751
     C** If called from #BA with a valid action code, access the deal     066154
      ** The entered deal must be a valid deal number and be eligible     079570
      ** for Rollover. If not, then send error messages.                  079570
     C*                                                                   066154
     C           #BASB     IFEQ 'Y'                                       066154
     C           DDDLNO    ANDNE*BLANKS                                   066154
     C           DDDLNN    CHAINMMDEALLL             70                   066154
     C************IN70*****IFEQ '1'                         066154 066154 079570
     C*********************MOVELBRC       DDBRCA                          079570
     C*********************ELSE                                   066154  079570
     C           *IN70     IFEQ '0'                                       CEU015
     C           DDACTN    ANDEQ'C'                                       CEU015
     C           CEU015    ANDEQ'Y'                                       CEU015
      *                                                                   CEU015
      ** Check if deal currency is an 'in' currency                       CEU015
      *  (database error handling done in access program)                 CEU015
     C                     CALL 'AOCURRR0'                                CEU015
     C                     PARM '*DBERR ' @RTCD   7                       CEU015
     C                     PARM '*KEY   ' @OPTN   7                       CEU015
     C                     PARM HKCCY     @AJCD   3                       CEU015
     C           SDCURR    PARM SDCURR    DSSDY                           CEU015
      *                                                                   CEU015
     C           A6INCY    IFNE 'Y'                                       CEU015
     C           A6TPSD    ORGT BJRDNB                                    CEU015
     C                     MOVE 'MMM2702' ZAMSID                          CEU015
     C                     EXSR ZASNMS                                    CEU015
     C                     MOVE *ON       *IN75                           CEU015
     C                     ELSE                                           144199
     C                     MOVE 'Y'       @EUROL                          144199
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C           *IN70     IFEQ '0'                                       079570
     C           HKMDYY    IFNE 0                                         079570
     C           HKMDMM    ANDNE0                                         079570
     C           HKMDDD    ANDNE0                                         079570
     C           HKDDLT    ANDNE'D'                                       079570
     C           HKROBY    ANDEQ*BLANK                                    079570
     C***********HKAURO    ANDNE'N'                                079570 083686
     C           HKDSTS    ANDEQ'A'                                       079570
     C           HKMTYP    ANDNE'IL'                                      125410
     C           HKMTYP    ANDNE'ID'                                      125410
     C**                                                                  093842
     C** Check for all zeros in Rolled-Over by deal number.  As the       093842
     C** deals migrated from S/36 contains all zero here.                 093842
     C**                                                                  093842
     C           HKMDYY    ORNE 0                                         093842
     C           HKMDMM    ANDNE0                                         093842
     C           HKMDDD    ANDNE0                                         093842
     C           HKDDLT    ANDNE'D'                                       093842
     C           HKROBY    ANDEQ'000000'                                  093842
     C           HKDSTS    ANDEQ'A'                                       093842
     C           HKMTYP    ANDNE'IL'                                      125410
     C           HKMTYP    ANDNE'ID'                                      125410
     C**                                                                  093842
     C           HKDSTS    OREQ 'R'                                       079570
     C           HKMTYP    ANDNE'IL'                                      125410
     C           HKMTYP    ANDNE'ID'                                      125410
     C                     MOVELHKBRCA    DDBRCA                          066154
     C                     ELSE                                           079570
     C           HKROBY    IFNE *BLANKS                                   144033
     C***********HKROBY    ORNE '000000'                           144033 145001
     C           HKROBY    ANDNE*BLANKS                                   145001
     C           HKDSTS    ANDNE'R'                                       145001
     C           HKDSTS    ANDNE'A'                                       145001
     C                     MOVEL'MMM2705' ZAMSID                          144033
     C                     MOVELHKROBY    ZAMSDA                          144033
     C                     ELSE                                           144033
     C                     MOVE 'MMM0687' ZAMSID                          079570
     C                     ENDIF                                          144033
     C                     EXSR ZASNMS                                    079570
     C                     SETON                     3275                 079570
     C                     MOVEL*BLANK    DDBRCA                          079570
     C                     END                                            079570
      *                                                                   079570
     C                     ELSE                                           079570
     C                     MOVE 'MMM0167' ZAMSID                          079570
     C                     EXSR ZASNMS                                    079570
     C                     SETON                     3275                 079570
     C                     MOVEL*BLANK    DDBRCA                          079570
     C                     END                                            066154
     C                     END                                            066154
      *                                                                   138751
      ** Validate Action Code for user                                    138751
      ** only if there are No screen errors                               138751
     C           *IN75     IFEQ '0'                                       138751
      *                                                                   138751
      ** First do it for Multibranch systems                              138751
      *                                                                   138751
     C           @MBIN     IFEQ 'Y'                                       138751
     C*                                                                   066154
     C** If a deal has been read in then use that branch else use         066154
     C** the default branch                                               066154
     C*                                                                   066154
     C                     MOVE DDBRCA    @ZBR                            066154
     C*                                                                   066154
     C                     CALL 'ZVACTBU'                                 066154
     C                     PARM ACTN      @ZACTN  1                       066154
     C                     PARM           @ZBR    3                       066154
     C                     PARM           @ERR    10                      066154
     C*                                                                   066154
     C           @ERR      IFEQ 1                                         066154
     C                     MOVE 'FXM0290' ZAMSID                          066154
     C                     EXSR ZASNMS                                    066154
     C                     SETON                     3175                 066154
     C                     END                                            066154
     C*                                                                   066154
     C           @ERR      IFEQ 2                                         066154
     C                     MOVE 'FXM0291' ZAMSID                          066154
     C                     EXSR ZASNMS                                    066154
     C                     SETON                     3175                 066154
     C                     END                                            066154
      *                                                                   138751
     C                     ELSE                                           138751
      *                                                                   138751
      ** Validate Action Code for user                                    138751
      ** for Single-Branch systems                                        138751
      *                                                                   138751
     C           @MBIN     IFEQ 'N'                                       138751
     C                     CALL 'ZVACTU'                                  138751
     C                     PARM ACTN      @ZACTN                          138751
     C                     PARM           @ERR                            138751
     C           @ERR      IFNE 0                                         138751
     C                     MOVE 'FXM0292' ZAMSID                          138751
     C                     EXSR ZASNMS                                    138751
     C                     SETON                     3175                 138751
     C                     END                                            138751
     C                     END                                            138751
     C                     END                                            138751
      *                                                                   138751
     C                     END                                            066154
     C*
     C                     END                             - E1
     C                     ENDSR
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,
      ** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.
      ** CALLED FROM UPDATE
      **
     C*================================================================
     C*
     C           #ZBAB     BEGSR
     C*
     C* If ENTER pressed, the VLDCMDKEY indicator will be off
     C*
     C           *IN45     IFEQ '0'
     C                     MOVE 'RA'      AID
     C                     END
     C*
     C* If F3
     C*
     C           *INKC     IFEQ '1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CPCK                                           S01408
     C*                                                                   S01408
     C                     MOVE '03'      AID
     C                     MOVE '0'       *INKC
     C                     END
     C*
     C* If F10
     C*
     C           *INKJ     IFEQ '1'
     C                     MOVE '10'      AID
     C                     MOVE '0'       *INKJ
     C                     END
     C*
     C* If F12
     C*
     C           *INKL     IFEQ '1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM5310CPC1                                           S01408
     C*                                                                   S01408
     C                     MOVE '12'      AID
     C                     MOVE '0'       *INKL
     C                     END
     C*
     C* If ROLLUP pressed
     C*
     C           *IN25     IFEQ '1'
     C                     MOVE 'UP'      AID
     C                     MOVE '0'       *IN25
     C                     END
     C*
     C* If ROLLDOWN pressed
     C*
     C           *IN26     IFEQ '1'
     C                     MOVE 'DN'      AID
     C                     MOVE '0'       *IN26
     C                     END
     C*
     C                     ENDSR
     C*================================================================
     C**
      /EJECT
     C*================================================================
     C*
     C**   FILE EXEPTION/ERROR HANDLING SUBROUTINE
     C*
     C           *PSSR     BEGSR
     C*
     C                     SETON                     U7U8LR
     C*
     C                     DUMP
     C************         OUT  LDA                                    088132
     C                     RETRN
     C*
     C                     ENDSR
      /EJECT
     C*******************************************************************
     C*
     C           ZA0680    BEGSR
     C*
     C**  CLEAR OUT ANY 'OLD' DATA IN FIELD
     C                     Z-ADD0         @@MDNO  50
     C*
     C**   IF DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING
     C           @@YYYY    IFGE 2072                       B1
     C*
     C**    MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)
     C           @@CC      SUB  19        @@WK2   20       *1
     C           @@WK2     MULT 36524     @@MDNO           *1
     C*
     C**  YEAR 2000 IS A LEAP YEAR MUST ALLOW EXTRA DAY
     C                     ADD  1         @@MDNO           *1
     C                     END                             E1
     C*
     C           @@YYYY    ADD  28        @@WK2
     C*
     C           @@WK2     DIV  4         @@WK2
     C                     MVR            @@REM   10
     C*
     C**    MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD
     C           @@WK2     MULT 1461      @@WK5   50
     C                     ADD  @@WK5     @@MDNO
     C*
     C**  CHECK REMAINDER AND MONTH NUMBER
     C           @@REM     IFEQ 0                          B1
     C           @@MTH     ANDGT2                          B1
     C                     ADD  1         @@MDNO           *1
     C                     END                             E1
     C*
     C**  YEAR NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR
     C           @@REM     IFNE 0                          B1
     C                     ADD  @YD,@@REM @@MDNO           *1
     C                     END                             E1
     C*
     C**  ADD MONTHS THIS YEAR
     C                     ADD  @MD,@@MTH @@MDNO
     C*
     C**  ADD DAYS THIS MONTH
     C                     ADD  @@DAY     @@MDNO
     C*
     C           ZA0689    ENDSR                           **ZA0689 TAG**
     C*================================================================
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*       TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *
     C*                                                               *
     C*       SUBROUTINE
     C*       PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *
     C********THAN*1*IT*RETURNS*1*IN*FIELD*'@@RTN'.THE*MAIN*PROGRAM*******S01434
     C*       THAN 1 IT RETURNS 1 IN FIELD '@#RTN'.THE MAIN PROGRAM   *   S01434
     C*       SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *
     C********IF*'@@RTN'*IS*NOT*EQUAL*TO*1*IT*RETURNS*THE*FIELD***********S01434
     C*       IF '@#RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   S01434
     C*       '@@VDT'  IN 'YYYYMMDD' FORMAT.                          *
     C*                                                               *
     C* NOTE: FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS
     C*                                                               *
     C*       1) @@DAYN   LENGTH 5,0.                                 *
     C*                                                               *
     C*       FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *
     C*                                                               *
     C*       1) @@VDT    LENGTH 8,0 DEFINED BY A DS.                 *
     C********2)*@@RTN****LENGTH*1,0.*************************************S01434
     C*       2) @#RTN    LENGTH 1,0.                                 *   S01434
     C*       3) @@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *
     C*       4) @@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *
     C*       5) @@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *
     C*       6) @@RDAY   LENGTH 5,0.                                 *
     C*       7) @@LEAP   LENGTH 1,0.
     C*                                                               *
     C*       INDICATORS USED ARE:                                    *
     C*                                                               *
     C*       1) 80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *
     C*       2) 81       CHECK FOR LOW ON ARRAY @MD.                 *
     C*                                                               *
     C* INPUT FIELD:       @@DAYN                                     *
     C*                                                               *
     C* OUTPUT FIELD:      @@VDT                                      *
     C*                                                               *
     C**WORK*FIELDS:*******@@RTN******************************************S01434
     C* WORK FIELDS:       @#RTN                                      *   S01434
     C*                    @@Z71Y                                     *
     C*                    @@RDAY                                     *
     C*                    @@LEAP                                     *
     C*                    @@I                                        *
     C*                    @@J                                        *
     C*                                                               *
     C* ARRAYS USED:       @YD COMPILE TIME ARRAY.
     C*                    @MD COMPILE TIME ARRAY.
     C*
     C*****************************************************************
     C*
     C           ZA0710    BEGSR
     C*
     C                     SETOF                     8081
     C***********          Z-ADD0         @@RTN   10                      S01434
     C                     Z-ADD0         @#RTN   10                      S01434
     C                     Z-ADD0         @@VDT
     C                     Z-ADD1         @@I     20
     C                     Z-ADD1         @@J     20
     C                     Z-ADD1         @@LEAP  10
     C*
     C           @@DAYN    CABEQ0         ZA0719
     C*
     C           @@DAYN    IFLT 1
     C***********          Z-ADD1         @@RTN                           S01434
     C                     Z-ADD1         @#RTN                           S01434
     C                     GOTO ZA0719
     C                     END
     C*
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.
     C*
     C           @@DAYN    DIV  1461      @@Z71Y
     C                     MVR            @@RDAY  50
     C*
     C* CALCULATING YEAR.
     C*
     C           @@Z71Y    MULT 4         @@Z71Y
     C                     ADD  1972      @@Z71Y
     C*
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100
     C*
     C           @@Z71Y    IFGE 2100
     C                     ADD  @@SSY2    @@RDAY
     C                     END
     C*
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE
     C* HAVE PASSED.
     C*
     C           @@RDAY    LOKUP@YD,@@I                8080
     C*
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.
     C*
     C           *IN80     IFEQ '0'
     C                     Z-ADD0         @@LEAP
     C                     END
     C*
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.
     C*
     C           @@LEAP    IFEQ 1
     C           @@RDAY    SUB  @YD,@@I   @@RDAY
     C                     ADD  @@I       @@Z71Y
     C                     END
     C*
     C* PROCESSING FOR A LEAP YEAR.
     C*
     C           @@LEAP    IFEQ 0
     C*
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.
     C*
     C           @@RDAY    IFEQ 60
     C                     Z-ADD29        @@Z71D
     C                     Z-ADD2         @@Z71M
     C***********          GOTO ZA0711                                    S01434
     C                     GOTO ZZ0711                                    S01434
     C                     END
     C*
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.
     C*
     C           @@RDAY    IFGT 60
     C           @@RDAY    SUB  1         @@RDAY
     C                     END
     C*
     C                     END
     C*
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR
     C* GROUP.
     C*
     C           @@RDAY    IFEQ 0
     C                     Z-ADD31        @@Z71D
     C                     Z-ADD12        @@Z71M
     C                     SUB  1         @@Z71Y
     C***********          GOTO ZA0711                                    S01434
     C                     GOTO ZZ0711                                    S01434
     C                     END
     C*
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'
     C* OCCURS IN
     C*
     C           @@RDAY    LOKUP@MD,@@J                81
     C                     Z-ADD@@J       @@Z71M
     C           @@RDAY    SUB  @MD,@@J   @@Z71D
     C*
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT
     C*
     C***********ZA0711    TAG                                            S01434
     C           ZZ0711    TAG                                            S01434
     C*
     C                     MOVE @@Z71Y    @@YR
     C*
     C           ZA0719    ENDSR
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*                                                               *
     F*           This subroutine will take as input a 16A field      *
     F*           a 1N number of integers and a 1N number of decimal  *
     F*           places. Ignoring the leading and trailing blanks    *
     F*           it will ensure that the field contains only numeric *
     F*           characters and a decimal point, and that it has no  *
     F*           embedded blanks, or more than one decimal point.    *
     F*           It will also check that the number of figures before*
     F*           and after the decimal point do not exceed the input *
     F*           parameters. The subroutine will output the number as*
     F*           a 16A field and a 15N field, along with an error    *
     F*           code. The alpha field will be right aligned with    *
     F*           the leading zeros blanked, and trailing blanks zero *
     F*           filled. The number returned will be 15 long with 0  *
     F*           decimal places. The error code will contain 0 if    *
     F*           there was no error, 1 if there was a non-numeric    *
     F*           character found, and 2 if the number of decimal     *
     F*           places are wrong.                                   *
     F*                                                               *
     F*  Input  : @@ALPH - 16A field containing the field to validate *
     F*           @@IDP  - number of decimal places                   *
     F*           @@IINT - number of integers                         *
     F*           @@MTID - Millions/Thousands id (Y = function on)    *   077895
     F*                                                               *
     F*  Output : @@ALPH - 16A field for display                      *
     F*           @@AMT  - 15N field for calculation                  *
     F*           @@ERCD - 1N error code                              *
     F*                                                               *
     F*  Uses   : @F     - array of 16 elements 1 character long      *
     F*           @G     - array of 16 elements 1 character long      *
     F*           @@CADP - calculated number of decimal places        *
     F*           @@CINT - calculated number of integers              *
     F*           @@PIDP - position of dp in input array              *
     F*           @@PODP - position of dp in output array             *
     F*           @@C    - index for array @F                         *
     F*           @@D    - index for array @G                         *
     F*           @@WK7  - workfield used for converting array element*
     F*                    to a 1N number.                            *
     F*           @H     - array containing powers of 10              *
     F*           @@E    - index to array @H                          *
     F*           @@WK5  - work field                                 *
     F*           @@ALP1 - feild used to right align 0 decimal places *
     F*           @@MIEA - maximum input elements allowed             *
     F*           @@FEL  - first integer element of array @F          *
     F*           @@MTF  - millions or thousands (M or T) flag        *
     F*           @@S    - counter                                    *
     F*           @@S1   - number of decimals after the decimal place *
     F*           @@S2   - counter                                    *
     F*           @@MRTS - tests decimal elements for M or T          *
     F*                                                              *
      *****************************************************************
      *
     C           ZA0840    BEGSR
      *
      **   initialize the fields and the arrays
     C                     MOVE '0'       *IN81
     C                     MOVE '0'       *IN82
     C                     MOVE 'N'       @@MTF   1                       077895
     C                     MOVE 'N'       @@MRT   1                       077895
     C                     MOVE ' '       @@MRTS  1                       077895
     C                     Z-ADD0         @@ERCD  10
     C                     Z-ADD0         @@AMT  150
     C                     MOVEA*BLANKS   @G
     C                     MOVEA@@ALPH    @F
     C                     MOVE *BLANKS   @@ALPH 16
     C                     Z-ADD0         @@WK7   10
     C                     Z-ADD0         @@CADP  30
     C                     Z-ADD0         @@CINT  30
     C                     Z-ADD0         @@PIDP  30
     C                     Z-ADD0         @@PODP  30
     C                     Z-ADD0         @@C     20
     C                     Z-ADD0         @@D     20
     C                     Z-ADD0         @@E     20
     C                     Z-ADD0         @@K     20                      077895
      *
      **   define the input fields
     C           *LIKE     DEFN @@CADP    @@IDP
     C           *LIKE     DEFN @@CINT    @@IINT
      *
      ** first check that the number input will not produce a number
      ** output with more than 15 figures.
     C           @@IDP     ADD  @@IINT    @@WK2   20
     C           @@WK2     IFGT 15                         B1
     C                     Z-ADD2         @@ERCD           *1
     C                     GOTO ZA0849                     *1
     C                     END                             E1
      *
      ** work through input array, ignoring leading zeros and blanks,
      ** also blanking the leading zeros in the input array.
     C                     MOVE '0'       *IN83
     C                     ADD  1         @@C
     C           @@C       DOWLE16                         B1
     C           *IN83     ANDEQ'0'                        *1
     C           @F,@@C    IFNE ' '                        B*2
     C           @F,@@C    ANDNE'0'                        **2
     C                     MOVE '1'       *IN83            **2
     C                     SUB  1         @@C              **2
     C                     END                             E*2
     C                     ADD  1         @@C              **2
     C                     END                             E1
      * Following code removed. As the code above ignores 0 then @@C      077895
      * currently contains the first non-zero element.                    077895
      * If first integer is a zero subtract 1 from @@C to provide         077895
      * correct first integer element of the array.                       077895
     C           @@C       IFNE 1                                         077895
     C                     SUB  1         @@C                             077895
     C           @F,@@C    IFNE '0'                                       077895
     C                     ADD  1         @@C                             077895
     C                     END                                            077895
     C                     END                                            077895
     C                     Z-ADD@@C       @@FEL   20                      077895
      *
      ** check the integer part of the number for valid characters.
     C           @@C       DOWLE16                         B1
     C           @F,@@C    ANDNE'.'                        *1
     C           @F,@@C    ANDNE' '                        *1
      *
      ** check for non numeric characters
      ** If @@MTID = Y ,allow M or T - for millions and thousands         077895
      ** processing.                                                      077895
     C           @F,@@C    IFGT '9'                        B*2
     C           @F,@@C    ORLT '0'                        **2
     C           @F,@@C    IFEQ 'M'                        **2            077895
     C           @@MTID    ANDNE'Y'                                       077895
     C           @F,@@C    OREQ 'T'                        **2            077895
     C           @@MTID    ANDNE'Y'                                       077895
     C           @F,@@C    ORNE 'M'                        **2            077895
     C           @F,@@C    ANDNE'T'                                       077895
     C                     Z-ADD0         @@AMT            **2
     C                     Z-ADD1         @@ERCD           **2
     C                     GOTO ZA0849                     **2
     C                     END                                            077895
      *
     C                     ELSE                            X*2
      *
     C           @F,@@C    IFNE 'M'                                       077895
     C           @F,@@C    ANDNE'T'                                       077895
     C                     ADD  1         @@CINT           **2
     C                     END                                            077895
      *
      ** check number of integers is not greater than that required
     C           @@CINT    IFGT @@IINT                     B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD2         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
      *
      ** multiply the output amount by 10 then add the number in
      ** the input array element being processed.
     C           @F,@@C    IFNE 'M'                                       077895
     C           @F,@@C    ANDNE'T'                                       077895
     C           @@AMT     MULT 10        @@AMT            **2
     C                     MOVE @F,@@C    @@WK7            **2
     C           @@AMT     ADD  @@WK7     @@AMT            **2
     C                     END                                            077895
     C                     END                             E*2
      *                                                                   077895
      ** MT or TM etc not allowed.                                        077895
      *                                                                   077895
     C           @@MTF     IFEQ 'Y'                                       077895
     C           @F,@@C    IFEQ 'M'                                       077895
     C           @F,@@C    OREQ 'T'                                       077895
     C                     Z-ADD0         @@AMT                           077895
     C                     Z-ADD1         @@ERCD                          077895
     C                     GOTO ZA0849                                    077895
     C                     END                                            077895
     C                     END                                            077895
      *                                                                   077895
     C           @F,@@C    IFEQ 'M'                                       077895
     C                     MOVE 'Y'       @@MTF                           077895
     C           @@C       SUB  1         @@K                             077895
      * If M entered alone add 1 @@amt.                                   077895
     C           @@AMT     IFEQ 0                                         077895
     C           @F,@@K    ANDNE'0'                                       077895
     C                     Z-ADD1         @@AMT                           077895
     C                     END                                            077895
     C           @@AMT     MULT 1000000   @@AMT                           077895
     C                     Z-ADD6         @@MIEA  20                      077895
     C                     END                                            077895
      *                                                                   077895
     C           @F,@@C    IFEQ 'T'                                       077895
     C                     MOVE 'Y'       @@MTF                           077895
     C           @@C       SUB  1         @@K                             077895
      * If T entered alone add 1 @@amt.                                   077895
     C           @@AMT     IFEQ 0                                         077895
     C           @F,@@K    ANDNE'0'                                       077895
     C                     Z-ADD1         @@AMT                           077895
     C                     END                                            077895
     C           @@AMT     MULT 1000      @@AMT                           077895
     C                     Z-ADD3         @@MIEA                          077895
     C                     END                                            077895
      *
      ** increase array index
     C                     ADD  1         @@C              *1
     C                     END                             E1
      *
      ** set up position of decimal point in input array
     C                     Z-ADD@@C       @@PIDP
      *
      ** if the character pointed to is a decimal point add 1 to the
      ** index
     C           @@C       IFLE 16                         B1
     C           @F,@@C    ANDEQ'.'                        *1
     C                     ADD  1         @@C              *1
     C                     MOVE '1'       *IN82            *1
     C                     END                             E1
      * Set Maximum input elements allowed to the correct figure.         077895
     C           @@MTF     IFEQ 'Y'                                       077895
     C           @@C       SUB  @@FEL     @@FEL                           077895
     C           @@FEL     ADD  @@MIEA    @@MIEA                          077895
     C                     ELSE                                           077895
     C           @@C       SUB  @@FEL     @@MIEA                          077895
     C                     END                                            077895
      *                                                                   077895
      ** Read through array checking to see if there is an M or T.        077895
     C                     Z-ADD@@C       @@S     20                      077895
     C                     Z-ADD@@C       @@S1    20                      077895
     C           @@S       DOWLE16                                        077895
     C           @F,@@S    IFEQ 'M'                                       077895
     C           @F,@@S    OREQ 'T'                                       077895
     C                     MOVEA@F,@@S    @@MRTS                          077895
     C                     MOVE 'Y'       @@MRT                           077895
     C                     Z-ADD@@S       @@S2    20                      077895
     C                     END                                            077895
     C                     ADD  1         @@S                             077895
     C                     END                                            077895
      * Calculate the number of decimals after the decimal point.         077895
     C           @@S2      SUB  @@S1      @@S1                            077895
      * In thousands - only 3 decimal places allowed.                     077895
     C           @@MRTS    IFEQ 'T'                                       077895
     C           @@S1      IFGT 3                                         077895
     C                     Z-ADD0         @@AMT                           077895
     C                     Z-ADD1         @@ERCD                          077895
     C                     GOTO ZA0849                     ***3           077895
     C                     END                             E**3           077895
     C                     END                             E**3           077895
      * In millions  - only 6 decimal places allowed.                     077895
     C           @@MRTS    IFEQ 'M'                                       077895
     C           @@S1      IFGT 6                                         077895
     C                     Z-ADD0         @@AMT            ***3           077895
     C                     Z-ADD1         @@ERCD                          077895
     C                     GOTO ZA0849                     ***3           077895
     C                     END                             E**3           077895
     C                     END                             E**3           077895
      *
      ** now validate the decimal part of the number
     C           @@C       DOWLE16                         B1
      *
      ** if a blank is found set on the blank input indicator
     C           @F,@@C    IFEQ ' '                        B*2
     C                     MOVE '1'       *IN81            **2
     C                     END                             E*2
      *
      ** if the figure is numeric, check that the number of decimal
      ** places does not exceed that specified, and that no blanks
      ** have been entered.
     C           @F,@@C    IFGE '0'                        B*2
     C           @F,@@C    ANDLE'9'                        **2
     C           @F,@@C    OREQ 'T'                        **2            077895
     C           @@MTID    ANDEQ'Y'                                       077895
     C           @F,@@C    OREQ 'M'                        **2            077895
     C           @@MTID    ANDEQ'Y'                                       077895
      *                                                                   077895
     C           @@MRT     IFNE 'Y'                                       077895
     C                     ADD  1         @@CADP           **2
     C                     END                                            077895
      *
     C           @@CADP    IFGT @@IDP                      B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD2         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
      *
     C           *IN81     IFEQ '1'                        B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD1         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
      *
      ** update output amount
     C           @F,@@C    IFNE 'M'                                       077895
     C           @F,@@C    ANDNE'T'                                       077895
     C           @@AMT     MULT 10        @@AMT            **2
     C                     MOVE @F,@@C    @@WK7            **2
     C                     ADD  @@WK7     @@AMT            **2
     C                     END                                            077895
      * MT or TM etc not allowed.                                         077895
     C           @@MTF     IFEQ 'Y'                                       077895
     C           @F,@@C    IFEQ 'M'                                       077895
     C           @F,@@C    OREQ 'T'                                       077895
     C                     Z-ADD0         @@AMT            ***3           077895
     C                     Z-ADD1         @@ERCD                          077895
     C                     GOTO ZA0849                                    077895
     C                     END                                            077895
     C                     END                                            077895
      *                                                                   077895
     C           @F,@@C    IFEQ 'M'                                       077895
     C                     MOVE 'Y'       @@MTF                           077895
      * Multiply @@amt by the correct factor and add the number           077895
      * digits to @@MIEA.                                                 077895
     C           @@S1      IFEQ 1                                         077895
     C           @@AMT     MULT 1000000   @@AMT                           077895
     C                     ADD  6         @@MIEA                          077895
     C                     END                                            077895
     C           @@S1      IFEQ 2                                         077895
     C           @@AMT     MULT 100000    @@AMT                           077895
     C                     ADD  5         @@MIEA                          077895
     C                     END                                            077895
     C           @@S1      IFEQ 3                                         077895
     C           @@AMT     MULT 10000     @@AMT                           077895
     C                     ADD  4         @@MIEA                          077895
     C                     END                                            077895
     C           @@S1      IFEQ 4                                         077895
     C           @@AMT     MULT 1000      @@AMT                           077895
     C                     ADD  3         @@MIEA                          077895
     C                     END                                            077895
     C           @@S1      IFEQ 5                                         077895
     C           @@AMT     MULT 100       @@AMT                           077895
     C                     ADD  2         @@MIEA                          077895
     C                     END                                            077895
     C           @@S1      IFEQ 6                                         077895
     C           @@AMT     MULT 10        @@AMT                           077895
     C                     ADD  1         @@MIEA                          077895
     C                     END                                            077895
      *                                                                   077895
     C                     END                                            077895
      *                                                                   077895
     C           @F,@@C    IFEQ 'T'                                       077895
     C                     MOVE 'Y'       @@MTF                           077895
      * Multiply @@amt by the correct factor and add the number           077895
      * digits to @@MIEA.                                                 077895
     C           @@S1      IFEQ 1                                         077895
     C           @@AMT     MULT 1000      @@AMT                           077895
     C                     ADD  3         @@MIEA                          077895
     C                     END                                            077895
     C           @@S1      IFEQ 2                                         077895
     C           @@AMT     MULT 100       @@AMT                           077895
     C                     ADD  2         @@MIEA                          077895
     C                     END                                            077895
     C           @@S1      IFEQ 3                                         077895
     C           @@AMT     MULT 10        @@AMT                           077895
     C                     ADD  1         @@MIEA                          077895
     C                     END                                            077895
      *                                                                   077895
     C                     END                                            077895
      *
     C                     ELSE                            X*2
      *
      ** if the character is not numeric and not a blank then it is
      ** invalid
     C           @F,@@C    IFNE ' '                        B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD1         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
      *
     C                     END                             E*2
      *
      ** increase index
     C                     ADD  1         @@C              *1
      *
     C                     END                             E1
      * Check that the number of elements input does not exceed allowed   077895
     C           @@MIEA    ADD  @@IDP     @@MIEA                          077895
     C           @@MIEA    IFGT 14                         B1             077895
     C                     Z-ADD2         @@ERCD           *1             077895
     C                     GOTO ZA0849                     *1             077895
     C                     END                             E1             077895
      *
      ** correct the output number for any decimal places not input
      ** in the alpha field.
     C           @@IDP     SUB  @@CADP    @@E
      *
      ** increase the index by one to get correct array entry
      ** If @@IDP = 0 add 1 to @@E to prevent array index error.          077895
     C           @@MRT     IFEQ 'N'                                       077895
     C           @@IDP     OREQ 0                                         077895
     C                     ADD  1         @@E
     C                     END                                            077895
     C           @@AMT     MULT @H,@@E    @@AMT
      *                                                                   077895
     C           @@MRT     IFEQ 'Y'                                       077895
     C           @@IDP     ANDEQ0                                         077895
     C           @@AMT     DIV  10        @@AMT                           077895
     C                     END                                            077895
      *
      ** now format the output alpha field, first calculate where
      ** the decimal point goes
     C           16        SUB  @@IDP     @@PODP
     C           @@PODP    SUB  1         @@PIDP
      *
      ** if there are no decimal points set the position to 17
     C           @@IDP     IFEQ 0                          B1
     C                     Z-ADD17        @@PODP           *1
     C                     END                             E1
      *
      ** move the output number into the input array
     C                     MOVEA*BLANKS   @F
     C                     MOVE @@AMT     @@AMTA 15
     C                     MOVEA@@AMTA    @F
      *
      ** set up indexes
     C                     Z-ADD1         @@C
     C                     Z-ADD1         @@D
     C                     MOVE '0'       *IN80
      *
      ** now fill up the output array
     C           @@D       DOWLE16                         B1
      *
      ** insert decimal point if the position is found
     C           @@D       IFEQ @@PODP                     B*2
     C                     MOVE '.'       @G,@@D           **2
     C                     ADD  1         @@D              **2
     C                     END                             E*2
      *
      ** insert the zero before the decimal point
     C           *IN80     IFEQ '0'                        B*2
     C           @@D       ANDEQ@@PIDP                     **2
     C           @F,@@C    ANDEQ'0'                        **2
     C                     MOVE '1'       *IN80            **2
     C                     MOVE '0'       @G,@@D           **2
     C                     END                             E*2
      *
      ** blank leading zeros
     C           *IN80     IFEQ '0'                        B*2
     C           @F,@@C    ANDEQ'0'                        **2
     C                     MOVE ' '       @G,@@D           **2
     C                     END                             E*2
      *
      ** move a normal character
     C           @F,@@C    IFGE '1'                        B*2
     C           @F,@@C    ANDLE'9'                        **2
     C                     MOVE @F,@@C    @G,@@D           **2
     C                     MOVE '1'       *IN80            **2
     C                     END                             E*2
      *
      ** non blanked zero
     C           @F,@@C    IFEQ '0'                        B*2
     C           *IN80     ANDEQ'1'                        **2
     C                     MOVE '0'       @G,@@D           **2
     C                     END                             E*2
      *
     C                     ADD  1         @@C              *1
     C                     ADD  1         @@D              *1
     C                     END                             E1
      *
      *
      ** put output array into output amount
     C                     MOVEA@G        @@ALPH
      *
      ** align figure with zero decimal places.
     C           @@IDP     IFEQ 0                          B1
     C                     MOVE *BLANKS   @@ALP1 17        *1
     C                     MOVE @@ALPH    @@ALP1           *1
     C                     MOVEL@@ALP1    @@ALPH           *1
     C                     END                             E1
      *
     C           ZA0849    ENDSR                           ZA0849 TAG
      *
      /EJECT
     C********************************************************************S01434
     C***********                                                        *S01434
     C***ZSEDIT*subroutine*to*insert*a*decimal*point*and*sign*into*a******S01434
     C***numeric*field*and*to*blank*out*leading*zeros*(optionaly**********S01434
     C***inserting*commas).***********************************************S01434
     C*******Input*fields:***ZFLD15*15/0**********************************S01434
     C***********************ZDECS**1/0***********************************S01434
     C***********************ZECODE*1/**('J',*'L'*or*blank)***************S01434
     C***********                                                        *S01434
     C*******Arrays:*********ZS1****15/1/0********************************S01434
     C***********************ZS2****21/1/*********************************S01434
     C***********                                                        *S01434
     C*******Output*fields:**ZOUT21*21************************************S01434
     C***********                                                        *S01434
     C***SR******ZSEDIT    BEGSR                           **  ZSEDIT   * S01434
     C***********                                                         S01434
     C**Define/Clear*fields***********************************************S01434
     C***********                                                         S01434
     C***********          Z-ADDZFLD15    ZFLD15 150                      S01434
     C***********          Z-ADDZDECS     ZDECS   10                      S01434
     C***********          MOVE ZECODE    ZECODE  1                       S01434
     C***********          MOVE *BLANKS   ZOUT21 21                       S01434
     C***********                                                         S01434
     C********SET*UP*WORK*FIELDS******************************************S01434
     C***********                                                         S01434
     C***********          Z-ADD0         ZS1                             S01434
     C***********          MOVE ' '       ZS2                             S01434
     C***********                                                         S01434
     C***********          Z-ADD15        Z1      20                      S01434
     C***********          Z-ADD20        Z2      20                      S01434
     C***********                                                         S01434
     C***********15        SUB  ZDECS     ZINTS   20                      S01434
     C***********                                                         S01434
     C**Check*if*numeric*field*is*negative********************************S01434
     C***********                                                         S01434
     C***********ZFLD15    IFLT *ZEROS                                    S01434
     C***********          MOVE '-'       ZS2,21                          S01434
     C***********          Z-SUBZFLD15    ZFLD15                          S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********          Z-ADDZFLD15    WORK15                          S01434
     C***********                                                         S01434
     C********CHECK*TO*SEE*IF*THERE*ARE*ANY*DECIMAL*PLACES****************S01434
     C***********                                                         S01434
     C***********ZDECS     CABEQ0         ZS10                            S01434
     C***********                                                         S01434
     C********SET*UP*DECIMALS*********************************************S01434
     C***********                                                         S01434
     C***********          Z-ADD*ZEROS    ZCNT    10                      S01434
     C***********ZCNT      DOUEQZDECS                                     S01434
     C***********          MOVE ZS1,Z1    ZS2,Z2                          S01434
     C***********          SUB  1         Z2                              S01434
     C***********          ADD  1         ZCNT                            S01434
     C***********          SUB  1         Z1                              S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C********PUT*IN*DECIMAL*PLACE****************************************S01434
     C***********                                                         S01434
     C***********          MOVE '.'       ZS2,Z2                          S01434
     C***********          SUB  1         Z2                              S01434
     C***********                                                         S01434
     C***********ZS10      TAG                             ** ZS10 TAG ** S01434
     C***********                                                         S01434
     C********SET*UP*INTEGERS*********************************************S01434
     C***********                                                         S01434
     C***********          Z-ADD*ZEROS    CNT3    10                      S01434
     C***********Z1        DOUEQ*ZEROS                                    S01434
     C***********          MOVE ZS1,Z1    ZS2,Z2                          S01434
     C***********          SUB  1         Z1                              S01434
     C***********          SUB  1         Z2                              S01434
     C***********                                                         S01434
     C**If*edit*code*is*'J',*insert*a*','*before*each*group*of*three******S01434
     C**digits*-*not*if*beginning*of*array*reached.***********************S01434
     C***********                                                         S01434
     C***********Z2        IFGT *ZEROS                                    S01434
     C***********ZECODE    ANDEQ'J'                                       S01434
     C***********          ADD  1         CNT3                            S01434
     C***********CNT3      IFEQ 3                                         S01434
     C***********          MOVE ','       ZS2,Z2                          S01434
     C***********          SUB  1         Z2                              S01434
     C***********          Z-ADD*ZEROS    CNT3                            S01434
     C***********          END                                            S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C********PUT*IN*LEADING*BLANKS***************************************S01434
     C***********                                                         S01434
     C***********          Z-ADD1         Z2                              S01434
     C***********ZS2,Z2    DOWEQ'0'                                       S01434
     C***********ZS2,Z2    OREQ ' '                                       S01434
     C***********ZS2,Z2    OREQ ','                                       S01434
     C***********          MOVE ' '       ZS2,Z2                          S01434
     C***********          ADD  1         Z2                              S01434
     C***********Z2        CABEQ22        ZS20                            S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C********IF*NO*INTEGERS*PUT*IN*LEADING*ZERO**************************S01434
     C***********                                                         S01434
     C***********ZS20      TAG                             ** ZS20 TAG ** S01434
     C***********                                                         S01434
     C***********Z2        IFEQ 22                                        S01434
     C***********          SUB  2         Z2                              S01434
     C***********          MOVE '0'       ZS2,Z2                          S01434
     C***********          ELSE                                           S01434
     C***********                                                         S01434
     C***********ZS2,Z2    IFEQ '.'                                       S01434
     C***********          SUB  1         Z2                              S01434
     C***********          MOVE '0'       ZS2,Z2                          S01434
     C***********          END                                            S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C********SET*UP*OUTPUT*FIELD*****************************************S01434
     C***********                                                         S01434
     C***********          MOVEAZS2       ZOUT21                          S01434
     C***********                                                         S01434
     C***SR******          ENDSR                                          S01434
     C********************************************************************S01434
     C***********                                                         S01434
     C*****ZDATE1*SR.*TO*VALIDATE*DATES*SUBMITTED*AND*********************S01434
     C****************CONVERT*TO*A*NUMBER*OF*DAYS.************************S01434
     C***********                                                         S01434
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********S01434
     C***********                                                         S01434
     C***********ZDATE1    BEGSR                           *** ZDATE1 *** S01434
     C***********                                                         S01434
     C*****CLEAR*DAY*NUMBER.*RESET*ERROR*INDICATOR************************S01434
     C***********          Z-ADD0         ZDAYNO  50                      S01434
     C***********          SETOF                     99                   S01434
     C***********                                                         S01434
     C*****CALCULATION*TO*DEFINE*INPUT*DATE*FIELD.************************S01434
     C***********          Z-ADDZDATE     ZDATE   60                      S01434
     C***********                                                         S01434
     C*****GET*INDIVIDUAL*DAY,*MONTH*AND*YEAR*FIELDS.*********************S01434
     C***********          MOVE ZDATE     ZYEAR   20                      S01434
     C**N98******          MOVELZDATE     ZDAY    20                      S01434
     C***98******          MOVELZDATE     ZMTH    20                      S01434
     C***********          MOVE ZDATE     ZWRK4   40                      S01434
     C**N98******          MOVELZWRK4     ZMTH                            S01434
     C***98******          MOVELZWRK4     ZDAY                            S01434
     C***********                                                         S01434
     C*****ENSURE*MONTH*IS*VALID.*BYPASS*IF*ERROR*************************S01434
     C***********ZMTH      IFLE 0                                         S01434
     C***********ZMTH      ORGT 12                                        S01434
     C***********          SETON                     99                   S01434
     C***********          GOTO ZDEND1                                    S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****ENSURE*DAY*IS*VALID.*BYPASS*IF*ERROR***************************S01434
     C***********ZDAY      IFLE 0                                         S01434
     C***********          SETON                     99                   S01434
     C***********          GOTO ZDEND1                                    S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****CHECK*FOR*30*DAY*MONTHS.*BYPASS*IF*ERROR***********************S01434
     C***********ZMTH      IFEQ 4                                         S01434
     C***********ZMTH      OREQ 6                                         S01434
     C***********ZMTH      OREQ 9                                         S01434
     C***********ZMTH      OREQ 11                                        S01434
     C***********                                                         S01434
     C***********ZDAY      IFGT 30                                        S01434
     C***********          SETON                     99                   S01434
     C***********          GOTO ZDEND1                                    S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********          ELSE                                           S01434
     C***********                                                         S01434
     C*****CHECK*FOR*31*DAY*MONTHS*(ALL*OTHERS*BUT*FEB).*BYPASS*IF*ERROR**S01434
     C***********ZDAY      IFGT 31                                        S01434
     C***********ZMTH      ANDNE2                                         S01434
     C***********          SETON                     99                   S01434
     C***********          GOTO ZDEND1                                    S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****CHECK*FOR*LEAP*YEAR:*REMAINDER*WILL*BE*ZERO*IF*IT*IS*A*LEAP*YR*S01434
     C***********ZYEAR     ADD  28        ZYEAR                           S01434
     C***********ZYEAR     DIV  4         ZLYR    20                      S01434
     C***********          MVR            ZLY     10                      S01434
     C***********                                                         S01434
     C*****IF*FEBUARY*FURTHER*VALIDATE*DAY.*******************************S01434
     C***********ZMTH      IFEQ 2                                         S01434
     C***********                                                         S01434
     C*****INVALID*IF*GREATER*THAN*28*AND*NOT*A*LEAP*YEAR*****************S01434
     C***********ZLY       IFGT 0                                         S01434
     C***********ZDAY      ANDGT28                                        S01434
     C***********          SETON                     99                   S01434
     C***********          GOTO ZDEND1                     BYPASS IF ERRORS01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****INVALID*IF*GREATER*THAN*29*AND*A*LEAP*YEAR*-*BYPASS*IF*ERROR***S01434
     C***********ZLY       IFEQ 0                                         S01434
     C***********ZDAY      ANDGT29                                        S01434
     C***********          SETON                     99                   S01434
     C***********          GOTO ZDEND1                                    S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****DETERMINE*NUMBER*OF*DAYS*FROM*31/12/1971.**********************S01434
     C***********                                                         S01434
     C*****MULTIPLY*NO.*OF*FOUR-YEAR*SPANS,*BY*NO.*OF*DAYS*IN*SPAN********S01434
     C***********ZLYR      MULT 1461      ZDAYNO                          S01434
     C***********                                                         S01434
     C*****IF*NOT*A*LEAP*YEAR,*ADD*APPROPRIATE*NO.*OF*DAYS*FOR*EXTRA******S01434
     C*****YEARS*USING*REMAINDER*FIELD*(IE.*1,*2*OR*3*X*356)**************S01434
     C***********ZLY       IFGT 0                                         S01434
     C***********ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO                          S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****IF*IT*IS*A*LEAP*YEAR,*AND*LATER*THAN*FEBRUARY,*ADD*ONE*FOR*****S01434
     C*****29TH*OF*FEB****************************************************S01434
     C***********ZLY       IFEQ 0                                         S01434
     C***********ZMTH      ANDGT2                                         S01434
     C***********ZDAYNO    ADD  1         ZDAYNO                          S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****ADD*APPROPRIATE*NUMBER*OF*DAYS*FOR*THE*MONTH*NUMBER************S01434
     C***********ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO                          S01434
     C***********                                                         S01434
     C*****ADD*NUMBER*OF*DAYS*IN*MONTH************************************S01434
     C***********ZDAYNO    ADD  ZDAY      ZDAYNO                          S01434
     C***********                                                         S01434
     C***********ZDEND1    ENDSR                           * ZDEND1 ENDSR*S01434
     C***********                                                         S01434
     C***/EJECT*****                                                      S01434
     C********************************************************************S01434
     C***********                                                         S01434
     C*****ZDATE2*SR.*TO*CONVERT*A*DAY*NUMBER*TO*DATE*FORMATS.************S01434
     C***********                                                         S01434
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********S01434
     C***********                                                         S01434
     C***********ZDATE2    BEGSR                           *** ZDATE2 *** S01434
     C***********                                                         S01434
     C*****CLEAR*LEAP*YEAR*WORK*FIELD.************************************S01434
     C***********          MOVE 'N'       ZLEAP   1                       S01434
     C***********                                                         S01434
     C*****CLEAR*DATE*FIELDS.*********************************************S01434
     C***********          Z-ADD0         ZDATE   60                      S01434
     C***********          MOVEL'       ' ZADATE  7                       S01434
     C***********                                                         S01434
     C*****CALCULATION*TO*DEFINE*INPUT*DAY*NUMBER.************************S01434
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01434
     C***********                                                         S01434
     C*****DETERMINE*YEAR*NUMBER.*****************************************S01434
     C***********                                                         S01434
     C*****ADJUST*DAY*NUMBER*IN*CASE*LAST*DAY*OF*YEAR.********************S01434
     C***********ZDAYNO    SUB  1         ZDAYN1  50                      S01434
     C***********ZDAYN1    IFLT 0                                         S01434
     C***********          GOTO ZDEND2                                    S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****CALCULATE*NUMBER*OF*4*YEAR*SPANS*SINCE*31/12/1971.*************S01434
     C***********ZDAYN1    DIV  1461      ZLYR    20                      S01434
     C***********          MVR            ZDAYN1           SAVE REMAINING S01434
     C*****************************************************DAYS***********S01434
     C*****CALCULATE*NUMBER*OF*REMAINING*YEARS.***************************S01434
     C***********          Z-ADD1         ZWRK2   20                      S01434
     C***********ZDTAG1    TAG                             ** ZDTAG1 TAG *S01434
     C***********ZDAYN1    IFGE ZYDY,ZWRK2                                S01434
     C***********ZWRK2     ADD  1         ZWRK2                           S01434
     C***********          GOTO ZDTAG1                                    S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********ZWRK2     SUB  1         ZWRK2                           S01434
     C***********                                                         S01434
     C*****DECREMENT*DAY*NO.*BY*DAYS*IN*REMAINING*YEARS.******************S01434
     C***********ZWRK2     IFNE 0                                         S01434
     C***********ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                          S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****CALCULATE*ACTUAL*YEAR*NUMBER.**********************************S01434
     C***********ZLYR      MULT 4         ZWRK3   30                      S01434
     C***********ZWRK3     ADD  72        ZWRK3            BASE IS 1972   S01434
     C***********          Z-ADDZWRK3     ZYEAR   20                      S01434
     C***********ZYEAR     ADD  ZWRK2     ZYEAR            YEAR           S01434
     C***********                                                         S01434
     C*****DETERMINE*MONTH*NUMBER.****************************************S01434
     C***********                                                         S01434
     C*****ADJUST*DAY*NO.*IN*CASE*LAST*DAY*OF*LEAP*YEAR*FEBRUARY.*********S01434
     C***********ZWRK2     IFEQ 0                                         S01434
     C***********ZDAYN1    IFEQ 59                                        S01434
     C***********          MOVE 'Y'       ZLEAP                           S01434
     C***********          END                                            S01434
     C***********ZDAYN1    IFGE 59                                        S01434
     C***********ZDAYN1    SUB  1         ZDAYN1                          S01434
     C***********          END                                            S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****CALCULATE*MONTH*NUMBER.****************************************S01434
     C***********          Z-ADD2         ZWRK2                           S01434
     C***********ZDTAG2    TAG                             ** ZDTAG2 TAG *S01434
     C***********ZDAYN1    IFGE ZMDY,ZWRK2                                S01434
     C***********ZWRK2     ADD  1         ZWRK2                           S01434
     C***********          GOTO ZDTAG2                                    S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********ZWRK2     SUB  1         ZWRK2                           S01434
     C***********                                                         S01434
     C***********          Z-ADDZWRK2     ZMTH    20       MONTH          S01434
     C***********                                                         S01434
     C*****DETERMINE*DAY*OF*MONTH.****************************************S01434
     C***********                                                         S01434
     C*****ADD*BACK*LAST*DAY*OF*YEAR*ADJUSTMENT.**************************S01434
     C***********ZDAYN1    ADD  1         ZDAYN1                          S01434
     C*****CALCULATE*DAY*OF*MONTH.****************************************S01434
     C***********ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY            S01434
     C***********                                                         S01434
     C*****ADD*BACK*LEAP*YEAR*29TH*FEBUARY*ADJUSTMENT,*IF*REQUIRED.*******S01434
     C***********ZLEAP     IFEQ 'Y'                                       S01434
     C***********ZDAY      ADD  1         ZDAY                            S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****FORMAT*DATE,*DDMMYY*OR*MMDDYY.*********************************S01434
     C**N98******          MOVELZDAY      ZWRK4   40                      S01434
     C***98******          MOVE ZDAY      ZWRK4                           S01434
     C**N98******          MOVE ZMTH      ZWRK4                           S01434
     C***98******          MOVELZMTH      ZWRK4                           S01434
     C***********          MOVELZWRK4     ZDATE                           S01434
     C***********          MOVE ZYEAR     ZDATE                           S01434
     C***********                                                         S01434
     C*****FORMAT*ALPHA*DATE,*DDMMMYY.************************************S01434
     C***********          MOVELZDAY      ZWRK5   5                       S01434
     C***********ZDAY      IFLT 10                                        S01434
     C***********          MOVEL' '       ZWRK5                           S01434
     C***********          END                                            S01434
     C***********          MOVE ZMNM,ZMTH ZWRK5                           S01434
     C***********          MOVELZWRK5     ZADATE                          S01434
     C***********          MOVE ZYEAR     ZADATE                          S01434
     C***********                                                         S01434
     C***********ZDEND2    ENDSR                           * ZDEND2 ENDSR*S01434
     C***********                                                         S01434
     C***/EJECT*****                                                      S01434
     C****************************************************************    S01434
     C***********                                                    *    S01434
     C****SR:ZDATE5***-*DETERMINES*IF*A*MIDAS*DAY*NUMBER*DATE*IS*A********S01434
     C******************HOLIDAY*IN*A*GIVEN*CURRENCY,*AND*IF*IT*IS*********S01434
     C******************DETERMINES*NEXT*WORKING*DAY*IF*REQUIRED.**********S01434
     C***********                                                    *    S01434
     C****INPUTS******-*ZDAYNO*(5,0P)*DAY*NO******************************S01434
     C******************ZCCY***(3**A)*CURRENCY****************************S01434
     C******************ZOPT***(1**A)*Y*OR*N******************************S01434
     C****OUTPUTS*****-*ZDYNBR*(5,0P)*NEXT*WORKING*DAY*NO*****************S01434
     C***********                                                    *    S01434
     C****************************************************************    S01434
     C***********                                                         S01434
     C***********ZDATE5    BEGSR                           ** ZDATE5 SR **S01434
     C***********                                                         S01434
     C*****Define*Input*fields.*******************************************S01434
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01434
     C***********          MOVE ZCCY      ZCCY    3                       S01434
     C***********          MOVE ZOPT      ZOPT    1                       S01434
     C***********                                                         S01434
     C*****Define/Reset*Outputs.******************************************S01434
     C***********          SETOF                     99                   S01434
     C***********          Z-ADDZDAYNO    ZDYNBR  50                      S01434
     C***********                                                         S01434
     C*****DETERMINE*IF*HOLIDAY*******************************************S01434
     C***********ZDHOL     TAG                             ** ZDHOL TAG **S01434
     C***********                                                         S01434
     C*****CALCULATIONS*TO*DEFINE/CLEAR*WORKFIELDS.***********************S01434
     C***********          SETOF                     90                   S01434
     C***********          MOVE *BLANKS   ZHC                             S01434
     C***********                                                         S01434
     C*****SET*KEY*TO*CHAIN*TO*THE*FIRST*HOLIDAY*RECORD.******************S01434
     C***********ZDYNBR    CHAINTABLETJF             90                   S01434
     C***********                                                         S01434
     C*****STORE*CURRENCIES*IF*RECORD*FOUND.******************************S01434
     C************IN90     IFEQ '0'                                       S01434
     C***********RECI      ANDEQ'D'                                       S01434
     C***********          MOVEAHCCY      ZHC,1                           S01434
     C***********          MOVE INEX      ZINEX   1                       S01434
     C***********                                                         S01434
     C*****SET*KEY*TO*CHAIN*TO*THE*FIRST*HOLIDAY*RECORD.******************S01434
     C***********          READ TABLETJF                 90               S01434
     C************IN90     IFEQ '0'                                       S01434
     C***********RECI      ANDEQ'D'                                       S01434
     C***********HOL       ANDEQZDYNBR                                    S01434
     C***********          MOVEAHCCY      ZHC,26                          S01434
     C***********          ELSE                                           S01434
     C***********          MOVE ZINEX     INEX                            S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****CHECK*IF*CURRENCY*ON*HOLIDAY.**********************************S01434
     C***********ZCCY      LOKUPZHC                      94               S01434
     C************IN94     IFEQ '1'                                       S01434
     C***********INEX      ANDEQ'I'                                       S01434
     C************IN94     OREQ '0'                                       S01434
     C***********INEX      ANDEQ'E'                                       S01434
     C***********          SETON                         99               S01434
     C***********                                                         S01434
     C*****CHECK*IF*NEXT*WORKING*DAY*REQUIRED.****************************S01434
     C***********ZOPT      IFEQ 'Y'                                       S01434
     C***********ZDYNBR    ADD  1         ZDYNBR                          S01434
     C***********          GOTO ZDHOL                                     S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C***********          ENDSR                                          S01434
      /EJECT
     C********************************************************************
     C**
     C**   ZFRQA-SR. TO INCREMENT A DAY NUMBER DATE BY A
     C**             PERIOD VALUE DETERMINED BY A CODE.
     C**
     C           ZFRQA     BEGSR                           *** ZFRQA ****
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ZFREQ     ZFREQ   1
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C                     Z-ADDZMDAY     ZMDAY   20
     C                     MOVE ZCCY      ZCCY    3
     C**
     C                     MOVE '   '     ZHC
     C**
     C**   CONVERT DAY NUMBER TO DATE.
     C                     EXSR ZDATE2
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE D-DAILY-WORKING DAY.
     C           ZFREQ     IFEQ 'D'
     C           ZDAYNO    ADD  1         ZDAYNO
     C                     GOTO ZFHCHK
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE W-WEEKLY.
     C           ZFREQ     IFEQ 'W'
     C           ZDAYNO    ADD  7         ZDAYNO
     C                     GOTO ZFEND
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE F-FORTNIGHTLY.
     C           ZFREQ     IFEQ 'F'
     C           ZDAYNO    ADD  14        ZDAYNO
     C                     GOTO ZFEND
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE S-SEMI-MONTHLY.
     C           ZFREQ     IFEQ 'S'
     C           ZDAY      IFLE 15
     C                     Z-ADD31        ZDAY
     C                     ELSE
     C                     Z-ADD15        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     END
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE M-MONTHLY.
     C           ZFREQ     IFEQ 'M'
     C                     Z-ADDZMDAY     ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE R-SIX DAYS BEFORE END OF MONTH
     C           ZFREQ     IFEQ 'R'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE T-BIMONTHLY.
     C           ZFREQ     IFEQ 'T'
     C                     Z-ADDZMDAY     ZDAY
     C           ZMTH      ADD  2         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE Q-QUARTERLY.
     C           ZFREQ     IFEQ 'Q'
     C                     Z-ADDZMDAY     ZDAY
     C           ZMTH      ADD  3         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE X-SIX MONTHLY.
     C           ZFREQ     IFEQ 'X'
     C                     Z-ADDZMDAY     ZDAY
     C           ZMTH      ADD  6         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE Y-YEARLY.
     C           ZFREQ     IFEQ 'Y'
     C                     Z-ADDZMDAY     ZDAY
     C           ZYEAR     ADD  1         ZYEAR
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE L-LAST CALENDAR DAY OF MONTH.
     C           ZFREQ     IFEQ 'L'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE B-LAST WORKING DAY OF MONTH.
     C           ZFREQ     IFEQ 'B'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE P-PENULT. WORK/DAY OF MONTH
     C           ZFREQ     IFEQ 'P'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE K-PENULT. WORK/DAY OF QUARTER
     C           ZFREQ     IFEQ 'K'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  3         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE H-PENULT. WORK/DAY OF HLF YR.
     C           ZFREQ     IFEQ 'H'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  6         ZMTH
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE G-PENULT. WORK/DAY OF YEAR
     C           ZFREQ     IFEQ 'G'
     C                     Z-ADD31        ZDAY
     C           ZYEAR     ADD  1         ZYEAR
     C                     END
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE A-MONTHLY ACCRUAL/PROFIT DATE.
     C           ZFREQ     IFEQ 'A'
     C***********          Z-ADDAPDA      ZDAYNO                          S01434
     C                     Z-ADDBKAPDT    ZDAYNO                          S01434
     C                     GOTO ZFEND
     C                     END
     C**
     C**   REFORMAT DATE AND ENSURE VALID.
     C**
     C**   VALIDATE MONTH.
     C           ZMTH      IFGT 12
     C           ZMTH      SUB  12        ZMTH
     C           ZYEAR     ADD  1         ZYEAR
     C                     END
     C**
     C**   CHECK FOR LEAP YEAR.
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10
     C**
     C**   VALIDATE DAY NUMBER.
     C                     MOVE ZFMD,ZMTH ZWRK2   20
     C           ZMTH      IFEQ 2
     C           ZLY       ANDEQ0
     C                     Z-ADD29        ZWRK2
     C                     END
     C**
     C           ZDAY      IFGT ZWRK2
     C                     Z-ADDZWRK2     ZDAY
     C                     END
     C**
     C**   CHECK IF CODE R, TO SUBTRACT 6 DAYS.
     C           ZFREQ     IFEQ 'R'
     C           ZDAY      SUB  6         ZDAY
     C                     END
     C**
     C**   REFORMAT DATE, DDMMYY OR MMDDYY, AND CONVERT TO DAY NUMBER.
     C                     MOVELZDAY      ZWRK4   40
     C                     MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C   98                MOVE ZDAY      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C                     EXSR ZDATE1
     C**   RESET IND. 90 - USED TO ENSURE SUBTRACTION FOR CODES P,K,H,G,
     C**   IS ONLY DONE ONCE.
     C                     SETOF                     90
     C**
     C**   CHECK IF CODE B,TO BE CHECKED FOR HOLIDAY.
     C           ZFREQ     COMP 'B'                      91
     C**   CODES P,K,H,G, ALSO TO BE CHECKED FOR HOLIDAY
     C  N91      ZFREQ     COMP 'P'                      91
     C  N91      ZFREQ     COMP 'K'                      91
     C  N91      ZFREQ     COMP 'H'                      91
     C  N91      ZFREQ     COMP 'G'                      91
     C   91N99             GOTO ZFHCHK
     C**
     C                     GOTO ZFEND
     C**
     C**   CHECK IF DAY NUMBER IS A HOLIDAY.
     C           ZFHCHK    TAG                             ** ZFHCHK TAG *
     C                     SETOF                     94
     C**
     C**   DETERMINE CODE.
     C           ZFREQ     COMP 'D'                      91
     C           ZFREQ     COMP 'B'                      92
     C  N92      ZFREQ     COMP 'P'                      92
     C  N92      ZFREQ     COMP 'K'                      92
     C  N92      ZFREQ     COMP 'H'                      92
     C  N92      ZFREQ     COMP 'G'                      92
     C                     MOVE '   '     ZHC
     C***********ZDAYNO    CHAINTABLETJF             93                   S01434
     C************IN93     IFEQ '0'                                       S01434
     C***********RECI      ANDEQ'D'                                       S01434
     C***********                                                         S01434
     C*****STORE*CURRENCIES*IF*RECORD*FOUND.******************************S01434
     C***********          MOVEAHCCY      ZHC,1                           S01434
     C***********                                                         S01434
     C*****DETERMINE*HOLIDAY*RECORD*TYPE.*********************************S01434
     C***********INEX      COMP 'E'                      95               S01434
     C***********INEX      COMP 'I'                      96               S01434
     C***********                                                         S01434
     C*****EXIT*IF*NO*RECORD*FOUND****************************************S01434
     C***********          ELSE                                           S01434
     C***********          GOTO ZPNCHK                                    S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C*****GET*SECOND*RECORD,*IF*NOT*ALREADY*DONE.************************S01434
     C***********          READ TABLETJF                 93               S01434
     C************IN93     IFEQ '0'                                       S01434
     C***********RECI      ANDEQ'D'                                       S01434
     C***********HOL       ANDEQZDAYNO                                    S01434
     C***********          MOVEAHCCY      ZHC,26                          S01434
     C***********          END                                            S01434
     C***********                                                         S01434
     C**                                                                  S01434
     C                     MOVE CCY       ZCCY                            S01434
     C                     MOVE *BLANKS   ZLOC                            S01434
     C                     EXSR ZCHKH                                     S01434
     C**                                                                  S01434
     C           ZIND      IFEQ 'W'                                       S01434
     C                     GOTO ZPNCHK                                    S01434
     C                     ELSE                                           S01434
     C**
     C*****CHECK*IF*CURRENCY*ON*HOLIDAY.**********************************S01434
     C***********ZCCY      LOKUPZHC                      97               S01434
     C***********                                                         S01434
     C*****BYPASS*IF*NOT*HOLIDAY*FOR*CURRENCY.****************************S01434
     C***95*97***                                          EXCLUDE FOUND  S01434
     C*R*96N97***          GOTO ZPNCHK                     INCL. NOT FOUNDS01434
     C***********                                                         S01434
     C**   INCREMENT OR DECREMENT DAY NUMBER AS REQUIRED.
     C***91*95N97                                          EXCL. NOT FOUNDS01434
     C*R*91*96*97ZDAYNO    ADD  1         ZDAYNO           INCLUDE FOUND  S01434
     C**                                                                  S01434
     C           *IN91     IFEQ *ON                                       S01434
     C                     ADD  1         ZDAYNO                          S01434
     C                     ENDIF                                          S01434
     C**
     C***92*95N97                                          EXCL. NOT FOUNDS01434
     C*R*92*96*97ZDAYNO    SUB  1         ZDAYNO           INCLUDE FOUND  S01434
     C*                                                                   S01434
     C           *IN92     IFEQ *ON                                       S01434
     C                     SUB  1         ZDAYNO                          S01434
     C                     ENDIF                                          S01434
     C                     ENDIF                                          S01434
     C*                                                                   S01434
     C                     GOTO ZFHCHK
     C**
     C           ZPNCHK    TAG                             ** ZPNCHK TAG*
     C**   FOR CODES REQUIRING PENULTIMATE WORKING DAY (P,K,H,G) SUBTRACT
     C**   ONE AND CHECK THIS FOR HOLIDAY.
     C   90                GOTO ZFEND                      ALREADY DONE
     C**
     C           ZFREQ     COMP 'P'                      92
     C  N92      ZFREQ     COMP 'K'                      92
     C  N92      ZFREQ     COMP 'H'                      92
     C  N92      ZFREQ     COMP 'G'                      92
     C  N92                GOTO ZFEND
     C           ZDAYNO    SUB  1         ZDAYNO
     C                     SETON                     90
     C                     GOTO ZFHCHK
     C           ZFEND     ENDSR
      *                                                                   CEU015
     C*****************************************************************   CEU015
     C*                                                               *   CEU015
     C* SRSETL   - Set up settlement field for new deal               *   CEU015
     C*                                                               *   CEU015
     C*****************************************************************   CEU015
      *                                                                   CEU015
     C           SRSETL    BEGSR                                          CEU015
      *                                                                   CEU015
      ** Save receipt and payment extended instructions to work fields    CEU015
      *  (Receive side) from rolled over deal                             CEU015
     C                     Z-ADDHKRSTM    @KRSTM                          CEU015
     C                     MOVE HKRONS    @KRONS                          CEU015
     C                     MOVE HKRIBN    @KRIBN                          CEU015
     C                     MOVE HKRIBA    @KRIBA                          CEU015
     C**********           Z-ADDHKROBN    @KROBN                                       CEU015 CSD027
     C**********           Z-ADDHKROCN    @KROCN                                       CEU015 CSD027
     C                     MOVE HKROBN    @KROBN                                              CSD027
     C                     MOVE HKROCN    @KROCN                                              CSD027
     C                     MOVE HKROBR    @KROBR                          CEU015
      *                                                                   CEU015
      ** Save receipt and payment extended instructions to work fields    CEU015
      *  (Payment side) from rolled over deal                             CEU015
     C                     Z-ADDHKPSTM    @KPSTM                          CEU015
     C                     MOVE HKPONS    @KPONS                          CEU015
     C                     MOVE HKPIBN    @KPIBN                          CEU015
     C                     MOVE HKPIBA    @KPIBA                          CEU015
     C**********           Z-ADDHKPOBN    @KPOBN                                       CEU015 CSD027
     C**********           Z-ADDHKPOCN    @KPOCN                                       CEU015 CSD027
     C                     MOVE HKPOBN    @KPOBN                                              CSD027
     C                     MOVE HKPOCN    @KPOCN                                              CSD027
     C                     MOVE HKRCRN    @KRCRN                          CEU015
     C                     MOVE HKRCRA    @KRCRA                          CEU015
     C                     MOVE HKRVNO    @KRVNO                          CEU015
     C                     MOVE HKAWBN    @KAWBN                          CEU015
     C                     MOVE HKAWBA    @KAWBA                          CEU015
     C                     MOVE HKBENN    @KBENN                          CEU015
     C                     MOVE HKBENA    @KBENA                          CEU015
     C                     MOVE HKDTP1    @KDTP1                          CEU015
     C                     MOVE HKDTP2    @KDTP2                          CEU015
     C                     MOVE HKDTP3    @KDTP3                          CEU015
     C                     MOVE HKDTP4    @KDTP4                          CEU015
     C                     MOVE HKDCHG    @KDCHG                          CEU015
     C                     MOVE HKBTB1    @KBTB1                          CEU015
     C                     MOVE HKBTB2    @KBTB2                          CEU015
     C                     MOVE HKBTB3    @KBTB3                          CEU015
     C                     MOVE HKBTB4    @KBTB4                          CEU015
     C                     MOVE HKBTB5    @KBTB5                          CEU015
     C                     MOVE HKBTB6    @KBTB6                          CEU015
     C                     MOVE HKPOBR    @KPOBR                          CEU015
     C                     MOVE HKCVMR    @KCVMR                          CEU015
      *                                                                   CEU015
      ** Save receipt and payment limited instructions to work fields     CEU015
      *  (Receive side) from rolled over deal                             CEU015
     C                     MOVELHKDORM    @KDORM                          CEU015
     C                     Z-ADDHKORCM    @KORCM                          CEU015
     C                     MOVE HKDORI    @KDORI                          CEU015
     C                     MOVE HKMORI    @KMORI                          CEU015
     C                     MOVE HKDCPI    @KDCPI                          CEU015
     C                     MOVE HKMCPI    @KMCPI                          CEU015
      *                                                                   CEU015
      ** Save receipt and payment limited instructions to work fields     CEU015
      *  (Payment side) from rolled over deal                             CEU015
     C                     MOVELHKDOPM    @KDOPM                          CEU015
     C                     MOVE HKDOPI    @KDOPI                          CEU015
     C                     MOVE HKMOPI    @KMOPI                          CEU015
     C                     MOVE HKDCRI    @KDCRI                          CEU015
     C                     MOVE HKMCRI    @KMCRI                          CEU015
     C                     MOVE HKDFAC    @KDFAC                          CEU015
     C                     MOVE HKMFAO    @KMFAO                          CEU015
     C                     MOVE HKSPEC    @KSPEC                          CEU015
      *                                                                   CEU015
      ** Access SDEXSTL1 record using transaction type MM                 CEU015
      *                                                                   CEU015
     C                     MOVE HKCCY     KCYCD                           CEU015
     C                     MOVE HKCNUM    KCUST                           CEU015
     C                     MOVE 'MM'      KTRTY                           CEU015
      *                                                                   CEU015
     C           KEXST     CHAINSDEXSTL1             87                   CEU015
      *                                                                   CEU015
      ** If no transaction type MM try AT                                 CEU015
      *                                                                   CEU015
     C           *IN87     IFEQ *ON                                       CEU015
     C                     MOVE 'AT'      KTRTY                           CEU015
     C           KEXST     CHAINSDEXSTL1             87                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C           *IN87     IFEQ *OFF                       Record found   CEU015
      *                                                                   CEU015
      ** Default receipt and payment extended instructions                CEU015
      *  (Receive side)                                                   CEU015
     C                     MOVE BYRSTY    HKRSTM                          CEU015
     C                     MOVE BYRONO    HKRONS                          CEU015
     C                     MOVE BYRIBN    HKRIBN                          CEU015
     C                     MOVE BYRIBL    HKRIBA                          CEU015
     C                     MOVE BYROBN    HKROBN                          CEU015
     C                     MOVE BYROCS    HKROCN                          CEU015
     C                     MOVE BYORBR    HKROBR                          CEU015
      *                                                                   CEU015
      ** Default receipt and payment extended instructions                CEU015
      *  (Payment side)                                                   CEU015
     C                     MOVE BYPSTY    HKPSTM                          CEU015
     C                     MOVE BYPONO    HKPONS                          CEU015
     C                     MOVE BYPIBN    HKPIBN                          CEU015
     C                     MOVE BYPIBA    HKPIBA                          CEU015
     C                     MOVE BYPOBN    HKPOBN                          CEU015
     C                     MOVE BYPOCS    HKPOCN                          CEU015
     C                     MOVE BYRCNO    HKRCRN                          CEU015
     C                     MOVE BYRCAL    HKRCRA                          CEU015
     C                     MOVE BYRCNB    HKRVNO                          CEU015
     C                     MOVE BYACBN    HKAWBN                          CEU015
     C                     MOVE BYACBL    HKAWBA                          CEU015
     C                     MOVE BYBYNB    HKBENN                          CEU015
     C                     MOVE BYBACL    HKBENA                          CEU015
     C                     MOVE BYDPY1    HKDTP1                          CEU015
     C                     MOVE BYDPY2    HKDTP2                          CEU015
     C                     MOVE BYDPY3    HKDTP3                          CEU015
     C                     MOVE BYDPY4    HKDTP4                          CEU015
     C                     MOVE BYDECG    HKDCHG                          CEU015
     C                     MOVE BYBBI1    HKBTB1                          CEU015
     C                     MOVE BYBBI2    HKBTB2                          CEU015
     C                     MOVE BYBBI3    HKBTB3                          CEU015
     C                     MOVE BYBBI4    HKBTB4                          CEU015
     C                     MOVE BYBBI5    HKBTB5                          CEU015
     C                     MOVE BYBBI6    HKBTB6                          CEU015
     C                     MOVE BYOPBR    HKPOBR                          CEU015
     C                     MOVE BYCVMR    HKCVMR                          CEU015
      *                                                                   CEU015
      ** Default receipt and payment limited instructions                 CEU015
      *  (Receive side)                                                   CEU015
     C                     SELEC                                          CEU015
     C           HKRSTM    WHEQ 0                                         CEU015
     C                     MOVEL*BLANKS   HKDORM                          CEU015
     C           HKRSTM    WHEQ 1                                         CEU015
     C                     MOVEL'TELX'    HKDORM                          CEU015
     C           HKRSTM    WHEQ 2                                         CEU015
     C                     MOVEL'CSENT'   HKDORM                          CEU015
     C           HKRSTM    WHEQ 3                                         CEU015
     C                     MOVEL'COMP'    HKDORM                          CEU015
     C           HKRSTM    WHEQ 4                                         CEU015
     C                     MOVEL'PCURR'   HKDORM                          CEU015
     C           HKRSTM    WHEQ 5                                         CEU015
     C                     MOVEL'MACC'    HKDORM                          CEU015
     C           HKRSTM    WHEQ 6                                         CEU015
     C                     MOVEL'SUSP'    HKDORM                          CEU015
     C           HKRSTM    WHEQ 7                                         CEU015
     C                     MOVEL'CHIPS'   HKDORM                          CEU015
     C           HKRSTM    WHEQ 8                                         CEU015
     C                     MOVEL'SWIFT'   HKDORM                          CEU015
     C           HKRSTM    WHEQ 12                                        CEU015
     C                     MOVEL'CCOLL'   HKDORM                          CEU015
     C           HKRSTM    WHEQ 14                                        CEU015
     C                     MOVEL'CURR'    HKDORM                          CEU015
     C                     ENDSL                                          CEU015
      *                                                                   CEU015
     C                     Z-ADDHKRSTM    HKORCM                          CEU015
      *                                                                   CEU015
     C                     SELEC                                          CEU015
     C           HKRSTM    WHEQ 1                                         CEU015
     C           HKRSTM    OREQ 2                                         CEU015
     C           HKRSTM    OREQ 7                                         CEU015
     C           HKRSTM    OREQ 8                                         CEU015
     C           HKRSTM    OREQ 12                                        CEU015
      * Access SDNOSTPD to get nostro shortname                           CEU015
     C                     CALL 'AONOSTR0'                                CEU015
     C                     PARM '*DBERR ' @RTCD   7                       CEU015
     C                     PARM '*KEY   ' @OPTN   7                       CEU015
     C                     PARM *BLANKS   @KEYA   6                       CEU015
     C                     PARM HKCCY     @KEYB   3                       CEU015
     C**********           PARM *BLANKS   @KEYC   4                                    CEU015 CGL029
     C                     PARM *BLANKS   @KEYC  10                                           CGL029
     C                     PARM *BLANKS   @KEYD   2                       CEU015
     C                     PARM HKRONS    @KEYE   2                       CEU015
     C                     PARM *BLANKS   @KEYF   3                       CEU015
     C                     PARM *BLANKS   @KEYG  10                       CEU015
     C                     PARM *BLANKS   @KEYH   1                       CEU015
     C           SDNOST    PARM SDNOST    DSFDY                           CEU015
      *                                                                   CEU015
     C                     MOVE A7NOSN    HKDORI                          CEU015
     C                     OTHER                                          CEU015
     C                     MOVE *BLANKS   HKDORI                          CEU015
     C                     ENDSL                                          CEU015
      *                                                                   CEU015
     C                     MOVE HKRONS    HKMORI                          CEU015
      ** Retrieve true shortname for customer.                            CEU015
     C                     CALL 'AOCUSTR0'                                CEU015
     C                     PARM '       ' @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM HKRIBN    @KEY1  10                       CEU015
     C                     PARM '       ' @KYST   7                       CEU015
     C           SDCUST    PARM SDCUST    DSSDY                           CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANK                                    CEU015
     C                     MOVE BBCSSN    HKDCPI                          CEU015
     C                     ELSE                                           CEU015
     C                     MOVE *BLANKS   HKDCPI                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     MOVE HKRIBN    HKMCPI                          CEU015
      *                                                                   CEU015
      ** Default receipt and payment limited instructions                 CEU015
      *  (Payment side)                                                   CEU015
     C                     SELEC                                          CEU015
     C           HKPSTM    WHEQ 0                                         CEU015
     C                     MOVEL*BLANKS   HKDOPM                          CEU015
     C           HKPSTM    WHEQ 1                                         CEU015
     C                     MOVEL'TELX'    HKDOPM                          CEU015
     C           HKPSTM    WHEQ 2                                         CEU015
     C                     MOVEL'CSENT'   HKDOPM                          CEU015
     C           HKPSTM    WHEQ 3                                         CEU015
     C                     MOVEL'COMP'    HKDOPM                          CEU015
     C           HKPSTM    WHEQ 4                                         CEU015
     C                     MOVEL'PCURR'   HKDOPM                          CEU015
     C           HKPSTM    WHEQ 5                                         CEU015
     C                     MOVEL'MACC'    HKDOPM                          CEU015
     C           HKPSTM    WHEQ 6                                         CEU015
     C                     MOVEL'SUSP'    HKDOPM                          CEU015
     C           HKPSTM    WHEQ 7                                         CEU015
     C                     MOVEL'CHIPS'   HKDOPM                          CEU015
     C           HKPSTM    WHEQ 8                                         CEU015
     C                     MOVEL'SWIFT'   HKDOPM                          CEU015
     C           HKPSTM    WHEQ 12                                        CEU015
     C                     MOVEL'CCOLL'   HKDOPM                          CEU015
     C           HKPSTM    WHEQ 14                                        CEU015
     C                     MOVEL'CURR'    HKDOPM                          CEU015
     C                     ENDSL                                          CEU015
      *                                                                   CEU015
     C                     Z-ADDHKPSTM    HKMOPM                          CEU015
      *                                                                   CEU015
     C                     SELEC                                          CEU015
     C           HKPSTM    WHEQ 1                                         CEU015
     C           HKPSTM    OREQ 2                                         CEU015
     C           HKPSTM    OREQ 7                                         CEU015
     C           HKPSTM    OREQ 8                                         CEU015
     C           HKPSTM    OREQ 12                                        CEU015
      * Access SDNOSTPD to get nostro shortname                           CEU015
     C                     CALL 'AONOSTR0'                                CEU015
     C                     PARM '*DBERR ' @RTCD   7                       CEU015
     C                     PARM '*KEY   ' @OPTN   7                       CEU015
     C                     PARM *BLANKS   @KEYA   6                       CEU015
     C                     PARM HKCCY     @KEYB   3                       CEU015
     C**********           PARM *BLANKS   @KEYC   4                                    CEU015 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2                       CEU015
     C                     PARM HKPONS    @KEYE   2                       CEU015
     C                     PARM *BLANKS   @KEYF   3                       CEU015
     C                     PARM *BLANKS   @KEYG  10                       CEU015
     C                     PARM *BLANKS   @KEYH   1                       CEU015
     C           SDNOST    PARM SDNOST    DSFDY                           CEU015
      *                                                                   CEU015
     C                     MOVE A7NOSN    HKDOPI                          CEU015
     C                     OTHER                                          CEU015
     C                     MOVE *BLANKS   HKDOPI                          CEU015
     C                     ENDSL                                          CEU015
      *                                                                   CEU015
     C                     MOVE HKPONS    HKMOPI                          CEU015
      * Retrieve true shortname for customer.                             CEU015
     C                     CALL 'AOCUSTR0'                                CEU015
     C                     PARM '       ' @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM HKAWBN    @KEY1                           CEU015
     C                     PARM '       ' @KYST                           CEU015
     C           SDCUST    PARM SDCUST    DSSDY                           CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANK                                    CEU015
     C                     MOVE BBCSSN    HKDCRI                          CEU015
     C                     ELSE                                           CEU015
     C                     MOVE *BLANKS   HKDCRI                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     MOVE HKAWBN    HKMCRI                          CEU015
      * Retrieve true shortname for customer.                             CEU015
     C                     CALL 'AOCUSTR0'                                CEU015
     C                     PARM '       ' @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM HKBENN    @KEY1                           CEU015
     C                     PARM '       ' @KYST                           CEU015
     C           SDCUST    PARM SDCUST    DSSDY                           CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANK                                    CEU015
     C                     MOVE BBCSSN    HKDFAC                          CEU015
     C                     ELSE                                           CEU015
     C                     MOVE *BLANKS   HKDFAC                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     MOVE HKBENN    HKMFAO                          CEU015
     C                     MOVE HKBTB1    HKSPEC                          CEU015
     C                     ELSE                            No record      CEU015
      *                                                                   CEU015
      ** Clear receipt and payment extended instructions                  CEU015
      *  (Receive side)                                                   CEU015
     C                     Z-ADD0         HKRSTM                          CEU015
     C                     MOVE *BLANKS   HKRONS                          CEU015
     C                     MOVE *BLANKS   HKRIBN                          CEU015
     C                     MOVE *BLANKS   HKRIBA                          CEU015
     C**********           Z-ADD0         HKROBN                                       CEU015 CSD027
     C**********           Z-ADD0         HKROCN                                       CEU015 CSD027
     C                     MOVE *BLANKS   HKROBN                                              CSD027
     C                     MOVE *BLANKS   HKROCN                                              CSD027
     C                     MOVE *BLANKS   HKROBR                          CEU015
      *                                                                   CEU015
      ** Clear receipt and payment extended instructions                  CEU015
      *  (Payment side)                                                   CEU015
     C                     Z-ADD0         HKPSTM                          CEU015
     C                     MOVE *BLANKS   HKPONS                          CEU015
     C                     MOVE *BLANKS   HKPIBN                          CEU015
     C                     MOVE *BLANKS   HKPIBA                          CEU015
     C**********           Z-ADD0         HKPOBN                                       CEU015 CSD027
     C**********           Z-ADD0         HKPOCN                                       CEU015 CSD027
     C                     MOVE *BLANKS   HKPOBN                                              CSD027
     C                     MOVE *BLANKS   HKPOCN                                              CSD027
     C                     MOVE *BLANKS   HKRCRN                          CEU015
     C                     MOVE *BLANKS   HKRCRA                          CEU015
     C                     MOVE *BLANKS   HKRVNO                          CEU015
     C                     MOVE *BLANKS   HKAWBN                          CEU015
     C                     MOVE *BLANKS   HKAWBA                          CEU015
     C                     MOVE *BLANKS   HKBENN                          CEU015
     C                     MOVE *BLANKS   HKBENA                          CEU015
     C                     MOVE *BLANKS   HKDTP1                          CEU015
     C                     MOVE *BLANKS   HKDTP2                          CEU015
     C                     MOVE *BLANKS   HKDTP3                          CEU015
     C                     MOVE *BLANKS   HKDTP4                          CEU015
     C                     MOVE *BLANKS   HKDCHG                          CEU015
     C                     MOVE *BLANKS   HKBTB1                          CEU015
     C                     MOVE *BLANKS   HKBTB2                          CEU015
     C                     MOVE *BLANKS   HKBTB3                          CEU015
     C                     MOVE *BLANKS   HKBTB4                          CEU015
     C                     MOVE *BLANKS   HKBTB5                          CEU015
     C                     MOVE *BLANKS   HKBTB6                          CEU015
     C                     MOVE *BLANKS   HKPOBR                          CEU015
     C                     MOVE *BLANKS   HKCVMR                          CEU015
      *                                                                   CEU015
      ** Clear receipt and payment limited instructions                   CEU015
      *  (Receive side)                                                   CEU015
     C                     MOVEL*BLANKS   HKDORM                          CEU015
     C                     Z-ADD0         HKORCM                          CEU015
     C                     MOVE *BLANKS   HKDORI                          CEU015
     C                     MOVE *BLANKS   HKMORI                          CEU015
     C                     MOVE *BLANKS   HKDCPI                          CEU015
     C                     MOVE *BLANKS   HKMCPI                          CEU015
      *                                                                   CEU015
      ** Clear receipt and payment limited instructions                   CEU015
      *  (Payment side)                                                   CEU015
     C                     MOVEL*BLANKS   HKDOPM                          CEU015
     C                     Z-ADD0         HKMOPM                          CEU015
     C                     MOVE *BLANKS   HKDOPI                          CEU015
     C                     MOVE *BLANKS   HKMOPI                          CEU015
     C                     MOVE *BLANKS   HKDCRI                          CEU015
     C                     MOVE *BLANKS   HKMCRI                          CEU015
     C                     MOVE *BLANKS   HKDFAC                          CEU015
     C                     MOVE *BLANKS   HKMFAO                          CEU015
     C                     MOVE *BLANKS   HKSPEC                          CEU015
      *                                                                   CEU015
      ** If original payment settlement method is '04'                    CEU015
      ** Check if retail account exists in Euros                          CEU015
      *                                                                   CEU015
     C           @KPSTM    IFEQ 4                                         CEU015
      *                                                                   CEU015
     C                     MOVE HKCNUM    @@CNUM           6/0->6         CEU015
      *                                                                   CEU015
     C                     CALL 'AOACCTR0'                                CEU015
     C                     PARM *BLANKS   @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM *BLANKS   @RETL  10                       CEU015
     C                     PARM @@CNUM    @CNUM   6                       CEU015
     C                     PARM BKEURO    @CYCD   3                       CEU015
     C**********           PARM BMACCD    @ACCD   4                                    CEU015 CGL029
     C                     PARM BMACCD    @ACCD  10                                           CGL029
     C                     PARM '01'      @ACSN   2                       CEU015
     C                     PARM HKBRCA    @DSNB   3                       CEU015
     C           SDACNT    PARM SDACNT    DSSDY                           CEU015
      *                                                                   CEU015
      ** If record found default payment settlement fields from           CEU015
      ** rolled over deal                                                 CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANKS                                   CEU015
      *                                                                   CEU015
      ** Default receipt and payment extended instructions from rolled    CEU015
      ** over deal.                                                       CEU015
      *  (Payment side)                                                   CEU015
     C                     Z-ADD@KPSTM    HKPSTM                          CEU015
     C                     MOVE @KPONS    HKPONS                          CEU015
     C                     MOVE @KPIBN    HKPIBN                          CEU015
     C                     MOVE @KPIBA    HKPIBA                          CEU015
     C**********           Z-ADD@KPOBN    HKPOBN                                       CEU015 CSD027
     C**********           Z-ADD@KPOCN    HKPOCN                                       CEU015 CSD027
     C                     MOVE @KPOBN    HKPOBN                                              CSD027
     C                     MOVE @KPOCN    HKPOCN                                              CSD027
     C                     MOVE @KRCRN    HKRCRN                          CEU015
     C                     MOVE @KRCRA    HKRCRA                          CEU015
     C                     MOVE @KRVNO    HKRVNO                          CEU015
     C                     MOVE @KAWBN    HKAWBN                          CEU015
     C                     MOVE @KAWBA    HKAWBA                          CEU015
     C                     MOVE @KBENN    HKBENN                          CEU015
     C                     MOVE @KBENA    HKBENA                          CEU015
     C                     MOVE @KDTP1    HKDTP1                          CEU015
     C                     MOVE @KDTP2    HKDTP2                          CEU015
     C                     MOVE @KDTP3    HKDTP3                          CEU015
     C                     MOVE @KDTP4    HKDTP4                          CEU015
     C                     MOVE @KDCHG    HKDCHG                          CEU015
     C                     MOVE @KBTB1    HKBTB1                          CEU015
     C                     MOVE @KBTB2    HKBTB2                          CEU015
     C                     MOVE @KBTB3    HKBTB3                          CEU015
     C                     MOVE @KBTB4    HKBTB4                          CEU015
     C                     MOVE @KBTB5    HKBTB5                          CEU015
     C                     MOVE @KBTB6    HKBTB6                          CEU015
     C                     MOVE @KPOBR    HKPOBR                          CEU015
     C                     MOVE @KCVMR    HKCVMR                          CEU015
      *                                                                   CEU015
      ** Default receipt and payment limited instructions from rolled     CEU015
      ** over deal.                                                       CEU015
      *  (Payment side)                                                   CEU015
     C                     MOVEL@KDOPM    HKDOPM                          CEU015
     C                     MOVE @KDOPI    HKDOPI                          CEU015
     C                     MOVE @KMOPI    HKMOPI                          CEU015
     C                     MOVE @KDCRI    HKDCRI                          CEU015
     C                     MOVE @KMCRI    HKMCRI                          CEU015
     C                     MOVE @KDFAC    HKDFAC                          CEU015
     C                     MOVE @KMFAO    HKMFAO                          CEU015
     C                     MOVE @KSPEC    HKSPEC                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
      ** If original payment settlement method is '05'                    CEU015
      ** Check if account exists in Euros                                 CEU015
      *                                                                   CEU015
     C           @KPSTM    IFEQ 5                                         CEU015
      *                                                                   CEU015
     C           6         SUBST@KPONS:1  @PONS1  6                       CEU015
     C           4         SUBST@KPONS:7  @PONS2  4                       CEU015
     C           2         SUBST@KPONS:11 @PONS3  2                       CEU015
      *                                                                   CEU015
     C                     CALL 'AOACCTR0'                                CEU015
     C                     PARM *BLANKS   @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM *BLANKS   @RETL  10                       CEU015
     C                     PARM @PONS1    @CNUM   6                       CEU015
     C                     PARM BKEURO    @CYCD   3                       CEU015
     C**********           PARM @PONS2    @ACCD   4                                    CEU015 CGL029
     C                     PARM @PONS2    @ACCD                                               CGL029
     C                     PARM @PONS3    @ACSN   2                       CEU015
     C                     PARM HKBRCA    @DSNB                           CEU015
     C           SDACNT    PARM SDACNT    DSSDY                           CEU015
      *                                                                   CEU015
      ** If record found default payment settlement fields from           CEU015
      ** rolled over deal                                                 CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANKS                                   CEU015
      *                                                                   CEU015
      ** Default receipt and payment extended instructions from rolled    CEU015
      ** over deal.                                                       CEU015
      *  (Payment side)                                                   CEU015
     C                     Z-ADD@KPSTM    HKPSTM                          CEU015
     C                     MOVE @KPONS    HKPONS                          CEU015
     C                     MOVE @KPIBN    HKPIBN                          CEU015
     C                     MOVE @KPIBA    HKPIBA                          CEU015
     C**********           Z-ADD@KPOBN    HKPOBN                                       CEU015 CSD027
     C**********           Z-ADD@KPOCN    HKPOCN                                       CEU015 CSD027
     C                     MOVE @KPOBN    HKPOBN                                              CSD027
     C                     MOVE @KPOCN    HKPOCN                                              CSD027
     C                     MOVE @KRCRN    HKRCRN                          CEU015
     C                     MOVE @KRCRA    HKRCRA                          CEU015
     C                     MOVE @KRVNO    HKRVNO                          CEU015
     C                     MOVE @KAWBN    HKAWBN                          CEU015
     C                     MOVE @KAWBA    HKAWBA                          CEU015
     C                     MOVE @KBENN    HKBENN                          CEU015
     C                     MOVE @KBENA    HKBENA                          CEU015
     C                     MOVE @KDTP1    HKDTP1                          CEU015
     C                     MOVE @KDTP2    HKDTP2                          CEU015
     C                     MOVE @KDTP3    HKDTP3                          CEU015
     C                     MOVE @KDTP4    HKDTP4                          CEU015
     C                     MOVE @KDCHG    HKDCHG                          CEU015
     C                     MOVE @KBTB1    HKBTB1                          CEU015
     C                     MOVE @KBTB2    HKBTB2                          CEU015
     C                     MOVE @KBTB3    HKBTB3                          CEU015
     C                     MOVE @KBTB4    HKBTB4                          CEU015
     C                     MOVE @KBTB5    HKBTB5                          CEU015
     C                     MOVE @KBTB6    HKBTB6                          CEU015
     C                     MOVE @KPOBR    HKPOBR                          CEU015
     C                     MOVE @KCVMR    HKCVMR                          CEU015
      *                                                                   CEU015
      ** Default receipt and payment limited instructions from rolled     CEU015
      ** over deal.                                                       CEU015
      *  (Payment side)                                                   CEU015
     C                     MOVEL@KDOPM    HKDOPM                          CEU015
     C                     MOVE @KDOPI    HKDOPI                          CEU015
     C                     MOVE @KMOPI    HKMOPI                          CEU015
     C                     MOVE @KDCRI    HKDCRI                          CEU015
     C                     MOVE @KMCRI    HKMCRI                          CEU015
     C                     MOVE @KDFAC    HKDFAC                          CEU015
     C                     MOVE @KMFAO    HKMFAO                          CEU015
     C                     MOVE @KSPEC    HKSPEC                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
      ** If original payment settlement method is '14'                    CEU015
      ** Check if retail account on HKPONS has an equivalent Euro         CEU015
      ** account.                                                         CEU015
      *                                                                   CEU015
     C           @KPSTM    IFEQ 14                                        CEU015
      *                                                                   CEU015
     C           10        SUBST@KPONS:1  @PONS4 10                       CEU015
      *                                                                   CEU015
     C                     CALL 'AOACCTR0'                                CEU015
     C                     PARM *BLANKS   @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM @PONS4    @RETL                           CEU015
     C                     PARM *BLANKS   @CNUM                           CEU015
     C                     PARM *BLANKS   @CYCD                           CEU015
     C                     PARM *BLANKS   @ACCD                           CEU015
     C                     PARM *BLANKS   @ACSN                           CEU015
     C                     PARM *BLANKS   @DSNB                           CEU015
     C           SDACNT    PARM SDACNT    DSSDY                           CEU015
      *                                                                   CEU015
     C           @RTCD     IFNE *BLANKS                                   CEU015
      *                                                                   CEU015
     C           *LOCK     IN   LDA                        **********     CEU015
     C                     MOVEL'ACCNTAB' DBFILE           *  013   *     CEU015
     C                     MOVEL'013'     DBASE            **********     CEU015
     C                     MOVEL@PONS4    DBKEY                           CEU015
     C                     OUT  LDA                                       CEU015
     C                     EXSR *PSSR                                     CEU015
      *                                                                   CEU015
      ** If record found check if an equivalent Euro account exists       CEU015
      *                                                                   CEU015
     C                     ELSE                                           CEU015
      *                                                                   CEU015
     C                     MOVE CNUM      @@CNUM  6        6/0->6         CEU015
     C**********           MOVE ACOD      @@ACOD  4        4/0->4                      CEU015 CGL029
     C                     MOVE ACOD      @@ACOD 10                                           CGL029
     C                     MOVE ACSQ      @@ACSQ  2        2/0->2         CEU015
      *                                                                   CEU015
     C                     CALL 'AOACCTR0'                                CEU015
     C                     PARM *BLANKS   @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM *BLANKS   @RETL                           CEU015
     C                     PARM @@CNUM    @CNUM                           CEU015
     C                     PARM BKEURO    @CYCD                           CEU015
     C                     PARM @@ACOD    @ACCD                           CEU015
     C                     PARM @@ACSQ    @ACSN                           CEU015
     C                     PARM BRCA      @DSNB                           CEU015
     C           SDACNT    PARM SDACNT    DSSDY                           CEU015
      *                                                                   CEU015
      ** If record found default payment settlement fields from           CEU015
      ** rolled over deal                                                 CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANKS                                   CEU015
     C           ATYP      ANDEQ'R'                                       CEU015
      *                                                                   CEU015
      ** Default receipt and payment extended instructions from rolled    CEU015
      ** over deal.                                                       CEU015
      *  (Payment side)                                                   CEU015
     C                     Z-ADD@KPSTM    HKPSTM                          CEU015
     C                     MOVE @KPONS    HKPONS                          CEU015
      *                                                                   CEU015
     C                     MOVELACNO      HKPONS                          CEU015
      *                                                                   CEU015
     C                     MOVE @KPIBN    HKPIBN                          CEU015
     C                     MOVE @KPIBA    HKPIBA                          CEU015
     C**********           Z-ADD@KPOBN    HKPOBN                                       CEU015 CSD027
     C**********           Z-ADD@KPOCN    HKPOCN                                       CEU015 CSD027
     C                     MOVE @KPOBN    HKPOBN                                              CSD027
     C                     MOVE @KPOCN    HKPOCN                                              CSD027
     C                     MOVE @KRCRN    HKRCRN                          CEU015
     C                     MOVE @KRCRA    HKRCRA                          CEU015
     C                     MOVE @KRVNO    HKRVNO                          CEU015
     C                     MOVE @KAWBN    HKAWBN                          CEU015
     C                     MOVE @KAWBA    HKAWBA                          CEU015
     C                     MOVE @KBENN    HKBENN                          CEU015
     C                     MOVE @KBENA    HKBENA                          CEU015
     C                     MOVE @KDTP1    HKDTP1                          CEU015
     C                     MOVE @KDTP2    HKDTP2                          CEU015
     C                     MOVE @KDTP3    HKDTP3                          CEU015
     C                     MOVE @KDTP4    HKDTP4                          CEU015
     C                     MOVE @KDCHG    HKDCHG                          CEU015
     C                     MOVE @KBTB1    HKBTB1                          CEU015
     C                     MOVE @KBTB2    HKBTB2                          CEU015
     C                     MOVE @KBTB3    HKBTB3                          CEU015
     C                     MOVE @KBTB4    HKBTB4                          CEU015
     C                     MOVE @KBTB5    HKBTB5                          CEU015
     C                     MOVE @KBTB6    HKBTB6                          CEU015
     C                     MOVE @KPOBR    HKPOBR                          CEU015
     C                     MOVE @KCVMR    HKCVMR                          CEU015
      *                                                                   CEU015
      ** Default receipt and payment limited instructions from rolled     CEU015
      ** over deal.                                                       CEU015
      *  (Payment side)                                                   CEU015
     C                     MOVEL@KDOPM    HKDOPM                          CEU015
     C                     MOVE @KDOPI    HKDOPI                          CEU015
     C                     MOVE @KMOPI    HKMOPI                          CEU015
     C                     MOVE @KDCRI    HKDCRI                          CEU015
     C                     MOVE @KMCRI    HKMCRI                          CEU015
     C                     MOVE @KDFAC    HKDFAC                          CEU015
     C                     MOVE @KMFAO    HKMFAO                          CEU015
     C                     MOVE @KSPEC    HKSPEC                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
      ** If original receipt settlement method is '04'                    CEU015
      ** Check if retail account exists in Euros                          CEU015
      *                                                                   CEU015
     C           @KRSTM    IFEQ 4                                         CEU015
      *                                                                   CEU015
     C                     MOVE HKCNUM    @@CNUM           6/0->6         CEU015
      *                                                                   CEU015
     C                     CALL 'AOACCTR0'                                CEU015
     C                     PARM *BLANKS   @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM *BLANKS   @RETL  10                       CEU015
     C                     PARM @@CNUM    @CNUM   6                       CEU015
     C                     PARM BKEURO    @CYCD   3                       CEU015
     C**********           PARM BMACCD    @ACCD   4                                    CEU015 CGL029
     C                     PARM BMACCD    @ACCD                                               CGL029
     C                     PARM '01'      @ACSN   2                       CEU015
     C                     PARM HKBRCA    @DSNB                           CEU015
     C           SDACNT    PARM SDACNT    DSSDY                           CEU015
      *                                                                   CEU015
      ** If record found default receipt settlement fields from           CEU015
      ** rolled over deal                                                 CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANKS                                   CEU015
      *                                                                   CEU015
      ** Default receipt and payment extended instructions from rolled    CEU015
      ** over deal.                                                       CEU015
      *  (Receipt side)                                                   CEU015
     C                     Z-ADD@KRSTM    HKRSTM                          CEU015
     C                     MOVE @KRONS    HKRONS                          CEU015
     C                     MOVE @KRIBN    HKRIBN                          CEU015
     C                     MOVE @KRIBA    HKRIBA                          CEU015
     C**********           Z-ADD@KROBN    HKROBN                                       CEU015 CSD027
     C**********           Z-ADD@KROCN    HKROCN                                       CEU015 CSD027
     C                     MOVE @KROBN    HKROBN                                              CSD027
     C                     MOVE @KROCN    HKROCN                                              CSD027
     C                     MOVE @KROBR    HKROBR                          CEU015
      *                                                                   CEU015
      ** Default receipt and payment limited instructions from rolled     CEU015
      ** over deal.                                                       CEU015
      *  (Receipt side)                                                   CEU015
     C                     MOVEL@KDORM    HKDORM                          CEU015
     C                     Z-ADD@KORCM    HKORCM                          CEU015
     C                     MOVE @KDORI    HKDORI                          CEU015
     C                     MOVE @KMORI    HKMORI                          CEU015
     C                     MOVE @KDCPI    HKDCPI                          CEU015
     C                     MOVE @KMCPI    HKMCPI                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
      ** If original receipt settlement method is '05'                    CEU015
      ** Check if account exists in Euros                                 CEU015
      *                                                                   CEU015
     C           @KRSTM    IFEQ 5                                         CEU015
      *                                                                   CEU015
     C           6         SUBST@KRONS:1  @RONS1  6                       CEU015
     C           4         SUBST@KRONS:7  @RONS2  4                       CEU015
     C           2         SUBST@KRONS:11 @RONS3  2                       CEU015
      *                                                                   CEU015
     C                     CALL 'AOACCTR0'                                CEU015
     C                     PARM *BLANKS   @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM *BLANKS   @RETL  10                       CEU015
     C                     PARM @RONS1    @CNUM   6                       CEU015
     C                     PARM BKEURO    @CYCD   3                       CEU015
     C**********           PARM @RONS2    @ACCD   4                                    CEU015 CGL029
     C                     PARM @RONS2    @ACCD                                               CGL029
     C                     PARM @RONS3    @ACSN   2                       CEU015
     C                     PARM HKBRCA    @DSNB                           CEU015
     C           SDACNT    PARM SDACNT    DSSDY                           CEU015
      *                                                                   CEU015
      ** If record found default receipt settlement fields from           CEU015
      ** rolled over deal                                                 CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANKS                                   CEU015
      *                                                                   CEU015
      ** Default receipt and payment extended instructions from rolled    CEU015
      ** over deal.                                                       CEU015
      *  (Receipt side)                                                   CEU015
     C                     Z-ADD@KRSTM    HKRSTM                          CEU015
     C                     MOVE @KRONS    HKRONS                          CEU015
     C                     MOVE @KRIBN    HKRIBN                          CEU015
     C                     MOVE @KRIBA    HKRIBA                          CEU015
     C**********           Z-ADD@KROBN    HKROBN                                       CEU015 CSD027
     C**********           Z-ADD@KROCN    HKROCN                                       CEU015 CSD027
     C                     MOVE @KROBN    HKROBN                                              CSD027
     C                     MOVE @KROCN    HKROCN                                              CSD027
     C                     MOVE @KROBR    HKROBR                          CEU015
      *                                                                   CEU015
      ** Default receipt and payment limited instructions from rolled     CEU015
      ** over deal.                                                       CEU015
      *  (Receipt side)                                                   CEU015
     C                     MOVEL@KDORM    HKDORM                          CEU015
     C                     Z-ADD@KORCM    HKORCM                          CEU015
     C                     MOVE @KDORI    HKDORI                          CEU015
     C                     MOVE @KMORI    HKMORI                          CEU015
     C                     MOVE @KDCPI    HKDCPI                          CEU015
     C                     MOVE @KMCPI    HKMCPI                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
      ** If original receipt settlement method is '14'                    CEU015
      ** Check if retail account on HKRONS has an equivalent Euro         CEU015
      ** account.                                                         CEU015
      *                                                                   CEU015
     C           @KRSTM    IFEQ 14                                        CEU015
      *                                                                   CEU015
     C           10        SUBST@KRONS:1  @RONS4 10                       CEU015
      *                                                                   CEU015
     C                     CALL 'AOACCTR0'                                CEU015
     C                     PARM *BLANKS   @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM @RONS4    @RETL                           CEU015
     C                     PARM *BLANKS   @CNUM                           CEU015
     C                     PARM *BLANKS   @CYCD                           CEU015
     C                     PARM *BLANKS   @ACCD                           CEU015
     C                     PARM *BLANKS   @ACSN                           CEU015
     C                     PARM *BLANKS   @DSNB                           CEU015
     C           SDACNT    PARM SDACNT    DSSDY                           CEU015
      *                                                                   CEU015
     C           @RTCD     IFNE *BLANKS                                   CEU015
      *                                                                   CEU015
     C           *LOCK     IN   LDA                        **********     CEU015
     C                     MOVEL'ACCNTAB' DBFILE           *  014   *     CEU015
     C                     MOVEL'014'     DBASE            **********     CEU015
     C                     MOVEL@RONS4    DBKEY                           CEU015
     C                     OUT  LDA                                       CEU015
     C                     EXSR *PSSR                                     CEU015
      *                                                                   CEU015
      ** If record found check if an equivalent Euro account exists       CEU015
      *                                                                   CEU015
     C                     ELSE                                           CEU015
      *                                                                   CEU015
     C                     MOVE CNUM      @@CNUM           6/0->6         CEU015
     C                     MOVE ACOD      @@ACOD           4/0->4         CEU015
     C                     MOVE ACSQ      @@ACSQ           2/0->2         CEU015
      *                                                                   CEU015
     C                     CALL 'AOACCTR0'                                CEU015
     C                     PARM *BLANKS   @RTCD                           CEU015
     C                     PARM '*KEY   ' @OPTN                           CEU015
     C                     PARM *BLANKS   @RETL                           CEU015
     C                     PARM @@CNUM    @CNUM                           CEU015
     C                     PARM BKEURO    @CYCD                           CEU015
     C                     PARM @@ACOD    @ACCD                           CEU015
     C                     PARM @@ACSQ    @ACSN                           CEU015
     C                     PARM BRCA      @DSNB                           CEU015
     C           SDACNT    PARM SDACNT    DSSDY                           CEU015
      *                                                                   CEU015
      ** If record found default payment settlement fields from           CEU015
      ** rolled over deal                                                 CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANKS                                   CEU015
     C           ATYP      ANDEQ'R'                                       CEU015
      *                                                                   CEU015
      ** Default receipt and payment extended instructions from rolled    CEU015
      ** over deal.                                                       CEU015
      *  (Receipt side)                                                   CEU015
     C                     Z-ADD@KRSTM    HKRSTM                          CEU015
     C                     MOVE @KRONS    HKRONS                          CEU015
      *                                                                   CEU015
     C                     MOVELACNO      HKRONS                          CEU015
      *                                                                   CEU015
     C                     MOVE @KRIBN    HKRIBN                          CEU015
     C                     MOVE @KRIBA    HKRIBA                          CEU015
     C**********           Z-ADD@KROBN    HKROBN                                       CEU015 CSD027
     C**********           Z-ADD@KROCN    HKROCN                                       CEU015 CSD027
     C                     MOVE @KROBN    HKROBN                                              CSD027
     C                     MOVE @KROCN    HKROCN                                              CSD027
     C                     MOVE @KROBR    HKROBR                          CEU015
      *                                                                   CEU015
      ** Default receipt and payment limited instructions from rolled     CEU015
      ** over deal.                                                       CEU015
      *  (Receipt side)                                                   CEU015
     C                     MOVEL@KDORM    HKDORM                          CEU015
     C                     Z-ADD@KORCM    HKORCM                          CEU015
     C                     MOVE @KDORI    HKDORI                          CEU015
     C                     MOVE @KMORI    HKMORI                          CEU015
     C                     MOVE @KDCPI    HKDCPI                          CEU015
     C                     MOVE @KMCPI    HKMCPI                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     ENDSR                                          CEU015
      *                                                                   CEU015
      /EJECT                                                              S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZACCH                                                  S01434
     C*                                                                   S01434
      /EJECT                                                              S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZCHKH                                                  S01434
     C*                                                                   S01434
      /EJECT                                                              S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZSEDITZ3                                               S01434
     C*                                                                   S01434
      /EJECT                                                              S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZDATE1Z2                                               S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZDATE2Z2                                               S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZDAT10Z2                                               S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZDATE9Z3                                               S01434
     C/COPY ZSRSRC,ZFEB29                                                                     CDL093
     C*                                                                   S01434
     C/COPY ZSRSRC,ZSAVEZ1                                                S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZRSTORZ1                                               S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZINTDYZ2                                               S01434
     C*                                                                   S01434
     C/COPY ZSRSRC,ZEDITZ2                                                S01434
     C*                                                                   S01434
     C**/C*PY*ZSRSRC,ZINTPLZ1******************************************                066160 CAS001
     C*                                                                   066160
      ** CHANGED BECAUSE MARCH/APRIL INVERTED                             S01434
      ***********JANFEBAPRMARMAYJUNJULAUGSEPOCTNOVDEC                     S01434
     C*                                                                   S01434
     C/COPY WNCPYSRC,MM5310CCP3                                           S01408
     C*                                                                   S01408
      /EJECT                                                              S01434
     C*****************************************************************
** M
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZA0710 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZA0710 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** array of powers of 10 from 0 to 8
000000000000001
000000000000010
000000000000100
000000000001000
000000000010000
000000000100000
000000001000000
000000010000000
000000100000000
000001000000000
000010000000000
000100000000000
001000000000000
010000000000000
100000000000000
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
