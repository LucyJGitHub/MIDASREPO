     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Deposit deals automatically rolled')          *
      *****************************************************************
      *                                                               *
      *  Midas - Money Market Module                                  *
      *                                                               *
      *  MM5350 - Deposit Deals Automatically Rolled Over             *
      *                                                               *
      *  Function:  This program will run automatically as part of    *
      *             Input Cycle Termination after the database save   *
      *             has been taken and journalling has ended. It will *
      *             produce a list of all Money Market Deposit Deals  *
      *             which are held for collateral purposes where the  *
      *             deal has reached maturity but has not been rolled *
      *             over manually by the user. The deal will be rolled*
      *             over automatically by the system with the new deal*
      *             number assigned from the range of automatic       *
      *             deal numbers.  The full principal amount will be  *
      *             rolled over.  The new maturity date will be based *
      *             on the rollover frequency, which in turn reflects *
      *             the period of the original deal.  The new rate    *
      *             will be determined from the forward rates in the  *
      *             system.                                           *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CER050             Date 16Jun19               *
      *  Prev Amend No. MD053295           Date 13Apr19               *
      *                 MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 CGL165             Date 17Feb15               *
      *                 MD026788           Date 18Nov14               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CDL093             Date 08Apr14               *
      *                 AR996895           Date 06Jul12               *
      *                 CLE148             Date 23Jul12               *
      *                 CRE073             Date 06Dec10               *
      *                 AR787620           Date 10Jun11               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26839           Date 05Jan10               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23711A          Date 09May09               *
      *                 BUG23711           Date 24Apr09               *
      *                 BUG23550A          Date 17Apr09               *
      *                 BUG22911           Date 17Feb09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 243842             Date 29Nov06               *
      *                 164847             Date 30Nov06               *
      *                 243068             Date 26Oct06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 240369             Date 14May06               *
      *                 238590             Date 14May06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD027A            Date 10May06               *
      *                 CSD027             Date 09Dec05               *
      *                 234407             Date 24Jun05               *
      *                 233283             Date 28Apr05               *
      *                 CGL035             Date 01Mar05               *
      *                 CGL031             Date 05Jul04               *
      *                 BUG8360            Date 12Sep05               *
      *                 BUG8340            Date 08Sep05               *
      *                 BUG8231            Date 31Aug05               *
      *                 BUG8232            Date 26Aug05               *
      *                 CIR013             Date 25Apr05               *
      *                 CAS009             Date 16May05               *
      *                 CDL038             Date 10May05               *
      *                 CDL033             Date 10Feb05               *
      *                 CDL028             Date 07Feb05               *
      *                 CAS008             Date 16Jun04               *
      *                 CLE040             Date 05Jul04               *
      *                 BUG4065            Date 24Aug04               *
      *                 BUG3738            Date 20Jul04               *
      *                 CGL014             Date 20Oct03               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 217684             Date 12May03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CDL010             Date 02Aug02               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      *                 CAS001             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 04Oct01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR005             Date 21Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CGL011  *CREATE    Date 20Sep99               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  MD026788 - Always use the Deal Customer for European Tax     *
      *             checking when system value UseDealCustforEuTax    *
      *             is 'Y'.                                           *
      *           - Applied for MD031062.                             *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CDL093 - MM Interest calculation type 9.                     *
      *           Add call to ZFEB29                                  *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CRE073 - Interest Rate Rounding                              *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,MMH00017                                 *
      *             WNCPYSRC,MMH00013                                 *
      *             WNCPYSRC,MMH00018                                 *
      *             WNCPYSRC,MMH00014                                 *
      *             WNCPYSRC,MMH00015                                 *
      *             WNCPYSRC,MMH00019                                 *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26839 - JA1_Threshold limit of the main joint customer was*
      *             utilized by the member                            *
      *  CER054 - German Features - Church Tax                        *
      *  BUG23711A - Incorrect interest reversal on rollover          *
      *  BUG23711 - Incorrect interest reversal on rollover           *
      *  BUG23550A - Rollover amount is incorrect if threshold        *
      *              utilised                                         *
      *  BUG22911 - Changes for Correct Tax Calculation               *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus                                      *
      *  CER048 - German Features - Taxes                             *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  243842 - Prevent looping when daily accrual and rollover     *
      *           frequency is 'A'.                                   *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  243068 - Applied same changes done on DL5350 about           *
      *           difference in value of records.                     *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  240369 - No Rollback done for file DLDLDCQD                  *
      *  238590 - Populate next maturity correctly.                   *
      *           Annotaed as BUG8232                                 *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  234407 - Consider the effectivity date for calculation of    *
      *           EU Tax amount                                       *
      *  233283 - Calculation of taxable amount prorata temporis      *
      *  CGL035 - EUSD Upgrade to MidasPlus                           *
      *  CGL031 - Taxation of Savings Income                          *
      *  BUG8360 - Deal is rolled over twice.                         *
      *  BUG8340 - 'Rolled over by deal' is not shown in Deals Enquiry*
      *  BUG8231 - Trailer processing does not consider overflow      *
      *            (carry over) that causes FOOB in COB.              *
      *  BUG8232 - Auto rollover deals has blank value date.          *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL033 - Floating Rate CDs Issued (Recompile)                *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CAS008 - IAS 39 Enhancements (Recompile)                     *
      *  CLE040 - Collateralised Lending Phase 2 (Recompile)          *
      *  BUG4065 - Divide by zero error                               *
      *  BUG3738 - Write to Deal Extension file for rolled over deals.*
      *  CGL014 - Collaterals Processing                              *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in MMDELDPP *
      *           , MMDENBPP AND MMDENSPP .                           *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  CAS001 - Net Present Value (NPV) Accounting                  *
      *  CPK014 - Release 4 packaging.  Rename of field which is too  *
      *           long for OPM program.                               *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  CIR005 - FRA/IRS Business Day Conventions to DEALSDG         *
      *           (recompile)                                         *
      *  CGL011 - Collateral Processing for Midas                     *
      *                                                               *
      *****************************************************************
     FMMDELDL1IF  E           K        DISK         KINFSR *PSSR
     F            MMDELDP0                          KRENAMEMMDELD1
      ** Rollover Deal Selection
      *
     FDLDEALL5IF  E           K        DISK         KINFSR *PSSR                             BUG3738
     F            DLDLDBD0                          KIGNORE                                  BUG3738
     F            DLDLDCD0                          KRENAMEDLDLDCEX                          BUG3738
     F            DLDLDGD0                          KIGNORE                                  BUG3738
      *                                                                                      BUG3738
     FDLDLDCL2O   E           K        DISK         KINFSR *PSSR A                           BUG3738
     F                                              KCOMIT                                   240369
      *                                                                                      BUG3738
     FDLINTRL1IF  E           K        DISK         KINFSR *PSSR
     F            FDINTRP0                          KRENAMEFDINTRP1
      ** Money Market Interest Rates - Year Periods
      *
     FDLINTRL2IF  E           K        DISK         KINFSR *PSSR
     F            FDINTRP0                          KRENAMEFDINTRP2
      ** Money Market Interest Rates - 1 Year and less
      *
     FSDCBRTL1IF  E           K        DISK
      ** Customer's Tax Indicator
      *
     FSDBRTDL1IF  E           K        DISK
      ** BRT Control Data
      *
     FCADLFALLUF  E                    DISK         KINFSR *PSSR
     F                                              KCOMIT
      ** Deal Numbers for Allocation
      *
     FSDFDDRL0UF  E           K        DISK         KINFSR *PSSR                             BUG8340
     F                                              KCOMIT                                   BUG8340
      ** Fixed Loan/Deposit Deal Number Range file                                           BUG8340
      *                                                                                      BUG8340
     FMMDEALLLUF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      ** Money Market Deals File
     F            MMDENSP0                          KIGNORE
     F            MMDENBP0                          KIGNORE
      *
     FDEALS   UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      ** Deals File
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F            DEALSDDF                          KIGNORE
     F            DEALSDEF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     F            DEALSDGF                          KIGNORE
      *
     FMMTTOTPPUF  E           K        DISK         KCOMIT
      ** Money Market Deals Control Totals File
      *
     FDEALSDF UF  E           K        DISK         KCOMIT
      ** Deals File Trailer
      *
     FGLCOLLL1UF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
      ** Collateral Details by Collateral Reference File
      *
     FSDTIX   UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      ** Sorted Deal Transaction Index
      *
     FMM5350AUO   E                    PRINTER
     F                                              KINFDS SPOOLU
     FMM5350P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL1
     FSDJACCLBIF  E           K        DISK                                                   CGL031
      **********                                                                 BUG23550A BUG23711A
      ***Midas*SD Customer Income by Deal/Trade Number                           BUG23550A BUG23711A
      **********                                                                 BUG23550A BUG23711A
     F***SDCSINLDIF  E           K        DISK                                   BUG23550A BUG23711A
     F/COPY WNCPYSRC,MMH00017
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *   37  - Multi-branch Indicator                                *
      *   50  - Lokup Indicator                                       *
      *   60  - Read Indicator for MMDELDL1                           *
      *   61  - Chain Indicator                                       *
      *   62  - Read Indicator                                        *
      *   65  - Chain Indicator for FDINTRPP                          *
      *   66  - Chain Indicator for FDINTRPP                          *
      *   67  - Chain Indicator for MMDEALLL                          *
      *   68  - Chain Indicator for DEALS                             *
      *   70  - Read Indicator for GLCOLLL1                           *
      *   71  - Read Indicator for MMTTOTPP                           *
      *   72  - Read Indicator for DEALSDF                            *
      *   98  - Date Format: DDMMYY (off); MMDDYY (on)                *
      * 90-99 - Used by Standard Subroutines                          *
      * U7+U8 - Database Error                                        *
      *                                                               *
      *****************************************************************
      /SPACE 3
     E                    CPY@    1   1 80
      ** Array containing Copyright statement
      *
     E                    ZFMD   12  12  2
      ** Array containing ZFREQ
      *
      /COPY ZSRSRC,ZDATE2Z1
      ** Array containing Conversion table for date
      *
      /COPY ZSRSRC,ZDATE9Z1
      ** Array containing Conversion table for date
      *
     E                    DEAL      999  6
      ** Array containing Deals
      *
     E                    ZHC        50  3
      ** Array ZDATE5
      *
      /COPY ZSRSRC,ZFRPEDZ1
      ** Array containing Conversion table for amount
      *
      /COPY ZSRSRC,ZHOLE
      ** Array containing Holiday table
      *
      /COPY ZSRSRC,ZF2CE
      ** Array containing Number of Working Days
      *
      /EJECT
      *                                                                                       CPK014
     IFDINTRP1                                                                                CPK014
     I              HWTMESTMP                       HWTMST                                    CPK014
     IFDINTRP2                                                                                CPK014
     I              HWTMESTMP                       HXTMST                                    CPK014
     IMMDELD1
      ** Rename fields of MMDELDP0
      *
     I              HKRCID                          PKRCID
     I              HKDLTF                          PKPLTF
     I              HKDLUP                          PKDLUP
     I              HKMLUP                          PKMLUP
     I              HKYLUP                          PKYLUP
     I              HKTLUP                          PKTLUP
     I              HKCHTP                          PKCHTP
     I              HKLCD                           PKLCD
     I              HKLUID                          PKLUID
     I              HKPCDN                          PKPCDN
     I              HKDN38                          PKDN38
     I              HKDADN                          PKDADN
     I              HKBKCD                          PKBKCD
     I              HKCCY                           PKCCY
     I              HKCYDP                          PKCYDP
     I              HKVDYY                          PKVDYY
     I              HKVDMM                          PKVDMM
     I              HKVDDD                          PKVDDD
     I              HKDTYY                          PKDTYY
     I              HKDTMM                          PKDTMM
     I              HKDTDD                          PKDTDD
     I              HKDDLT                          PKDDLT
     I              HKDSTS                          PKDSTS
     I              HKMTYP                          PKMTYP
     I              HKRBSI                          PKRBSI
     I              HKTYPE                          PKTYPE
     I              HKSTYP                          PKSTYP
     I              HKCSNM                          PKCSNM
     I              HKCNUM                          PKCNUM
     I              HKAMNP                          PKAMNP
     I              HKINTR                          PKINTR
     I              HKBRCA                          PKBRCA
     I              HKDBRC                          PKDBRC
     I              HKDDYY                          PKDDYY
     I              HKDDMM                          PKDDMM
     I              HKDDDD                          PKDDDD
     I              HKBRKG                          PKBRKG
     I              HKBKCY                          PKBKCY
     I              HKBCDP                          PKBCDP
     I              HKFEDF                          PKFEDF
     I              HKCDRF                          PKCDRF
     I              HKPCTN                          PKPCTN
     I              HKCDRP                          PKCDRP
     I              HKLACT                          PKLACT
     I              HKTIME                          PKTIME
     I              HKDUSC                          PKDUSC
     I              HKAOFR                          PKAOFR
     I              HKLDAT                          PKLDAT
     I              HKSLYY                          PKSLYY
     I              HKSLMM                          PKSLMM
     I              HKSLDD                          PKSLDD
     I              HKROBY                          PKROBY
     I              HKSPRD                          PKSPRD
     I              HKIIRT                          PKIIRT
     I              HKNIYY                          PKNIYY
     I              HKNIMM                          PKNIMM
     I              HKNIDD                          PKNIDD
     I              HKIPFQ                          PKIPFQ
     I              HKICMT                          PKICMT
     I              HKIPDM                          PKIPDM
     I              HKCPTI                          PKCPTI
     I              HKCNTI                          PKCNTI
     I              HKACSQ                          PKACSQ
     I              HKNGVI                          PKNGVI
     I              HKMTTI                          PKMTTI
     I              HKMTAX                          PKMTAX
     I              HKMCDH                          PKMCDH
     I              HKIAYY                          PKIAYY
     I              HKIAMM                          PKIAMM
     I              HKIADD                          PKIADD
     I              HKBSRC                          PKBSRC
     I              HKDBSR                          PKDBSR
     I              HKMDYY                          PKMDYY
     I              HKMDMM                          PKMDMM
     I              HKMDDD                          PKMDDD
     I              HKNTCE                          PKNTCE
     I              HKFCLY                          PKFCLY
     I              HKIMAT                          PKIMAT
     I              HKBRAT                          PKBRAT
     I              HKMMDI                          PKMMDI
     I              HKDORM                          PKDORM
     I              HKORCM                          PKORCM
     I              HKDORI                          PKDORI
     I              HKMORI                          PKMORI
     I              HKDCPI                          PKDCPI
     I              HKMCPI                          PKMCPI
     I              HKDOPM                          PKDOPM
     I              HKMOPM                          PKMOPM
     I              HKDOPI                          PKDOPI
     I              HKMOPI                          PKMOPI
     I              HKDCRI                          PKDCRI
     I              HKMCRI                          PKMCRI
     I              HKDFAC                          PKDFAC
     I              HKMFAO                          PKMFAO
     I              HKSPEC                          PKSPEC
     I              HKBOKC                          PKBOKC
     I              HKLNKN                          PKLKLN
     I              HKRSTM                          PKRSTM
     I              HKRONS                          PKRONS
     I              HKRIBN                          PKRIBN
     I              HKRIBA                          PKRIBA
     I              HKROBN                          PKROBN
     I              HKROCN                          PKROCN
     I              HKPSTM                          PKPSTM
     I              HKPONS                          PKPONS
     I              HKPIBN                          PKPIBN
     I              HKPIBA                          PKPIBA
     I              HKPOBN                          PKPOBN
     I              HKPOCN                          PKPOCN
     I              HKRCRN                          PKRCRN
     I              HKRCRA                          PKRCRA
     I              HKRVNO                          PKRVNO
     I              HKAWBN                          PKAWBN
     I              HKAWBA                          PKAWBA
     I              HKBENN                          PKBENN
     I              HKBENA                          PKBENA
     I              HKDTP1                          PKDTP1
     I              HKDTP2                          PKDTP2
     I              HKDTP3                          PKDTP3
     I              HKDTP4                          PKDTP4
     I              HKDCHG                          PKDCHG
     I              HKBTB1                          PKBTB1
     I              HKBTB2                          PKBTB2
     I              HKBTB3                          PKBTB3
     I              HKBTB4                          PKBTB4
     I              HKBTB5                          PKBTB5
     I              HKBTB6                          PKBTB6
     I              HKORBR                          PKORBR
     I              HKPRFC                          PKPRFC
     I              HKPOBR                          PKPOBR
     I              HKROBR                          PKROBR
     I              HKDRID                          PKDRID
     I              HKDDMR                          PKDDMR
     I              HKCVMR                          PKCVMR
     I              HKRDFC                          PKRDFC
     I              HKFLID                          PKFLID
     I              HKFUID                          PKFUID
     I              HKAURO                          PKAURO
     I              HKIPDS                          PKIPDS
     I              HKROFQ                          PKROFQ
     I              HKRLDN                          PKRLDN
     I              HKCNNA                          PKCNNA
     I              HKIMET                          PKIMET
     I              HKINSA                          PKINSA
     I              HKINOS                          PKINOS
     I              HKWRPI                          PKWRPI
     I              HKPTFR                          PKPTFR
     I              HKFSRP                          PKFSRP
     I              HKFSGN                          PKFSGN
     I              HKFPRC                          PKFPRC
     I              HKSTCY                          PKSTCY
     I              HKIC72                          PKIC72
     I              HKISCY                          PKISCY
     I              HKII72                          PKII72
     I              HKDVSD                          PKDVSD
     I              HKDDND                          PKDDND
     I              HKNIPD                          PKNIPD
     I              HKSLID                          PKSLID
     I              HKMATD                          PKMATD
     I              HKRBAT                          PKRBAT
     I              HKRACD                          PKRACD
     I              HKFRNT                          PKFRNT
     I              HKAFRT                          PKAFRT
     I              HKREPA                          PKREPA
     I              HKRTFC                          PKRTFC
     I              HKORDA                          PKORDA
     I              HKCOLF                          PKCOLF
     I              HKCOLA                          PKCOLA
      *
     IDTRIXHF
      ** Rename fields of DTRIXHF
      *
     I              RECI                            DXRECI
     I              RCDT                            DXRCDT
     I              DLNO                            DXDLNO
     I              RRLC                            DXRRLC
     I              RRLX                            DXRRLX
     I              RRXP                            DXRRXP
     I              NDLR                            DXNDLR
     I              NDAR                            DXNDAR
     I              STPI                            DXSTPI
     I              TNLU                            DXTNLU
      *
     IDTRIXDF
      ** Rename fields of DTRIXDF
      *
     I              RECI                            DXRECI
     I              RCDT                            DXRCDT
     I              DLNO                            DXDLNO
     I              VDAT                            DXVDAT
     I              DASN                            DXDASN
     I              CHTP                            DXCHTP
     I              CNRQ                            DXCNRQ
     I              CNPR                            DXCNPR
     I              REPR                            DXREPR
     I              TIM                             DXTIME
     I              DADI                            DXDADI
     I              PRI1                            DXPRI1
     I              PRI2                            DXPRI2
     I              PRI3                            DXPRI3
     I              ICIN                            DXICIN
     I              BRCA                            DXBRCA
     I              TNLU                            DXTNLU
      *
     ISDBRTDD0
      ** Rename fields to differentiate DEALSDC from SDBRTDL1 fields
      *
     I              LCD                             BRTLCD
     I              LCT                             BRTLCT
     I              CHTP                            BRCHTP
      *
     ILDA       E DSLDA                         256
      ** Local data area for database error details
      *
     IRUNDAT    E DSRUNDAT
      ** Data Area giving Rundate
      *
     IPFMDS     ESDSY2PGDSP
      ** Program Status Data Structure
     I/COPY WNCPYSRC,MM5350I002
      *
     IINFDS$    E DSY2I$DSP
      ** Printer file information data structure.
      *
     ISPOOL1      DS
      ** File Information Data Structure for SD0731P1.
      *
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I                                    B 188 1890OFLLN1
     I                                    B 367 3680PRTLN1
      *
     ISPOOLU      DS
      ** File Information Data Structure for SD0731AU.
      *
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
      ** Data Structure to format Date
      *
     I            DS
     I                                        1   80FDAT1
     I                                        1   40PKMDYY
     I                                        5   60PKMDMM
     I                                        7   80PKMDDD
      *
     IMULT        DS                        999
      ** Data Structure to format Date
      *
     I                                        1  180TAMNP
     I                                       19  240TDEAL
      *
      ** Data structure for SR. ZA0710 - field is @@Z71Y
      *
     I            DS
     I                                        1   40@@Z71Y
     I                                        1   10@@SSY1
     I                                        2   20@@SSY2
     I                                        3   30@@SSY3
     I                                        4   40@@SSY4
      *
      ** Data structure for SR. ZA0710 - field is @@VDT
      *
     I            DS
     I                                        1   80@@VDT
     I                                        1   40@@YR
     I                                        5   60@@Z71M
     I                                        7   80@@Z71D
      *
      ** Data structure for Amount
      *
     I            DS
     I                                        1  180W#TOTL
     I                                        1  150W#TOTN
     I                                       16  180W#TOTD
      *                                                                                       CGL031
      ** Data structure for call to ZAGETSETAC parameters                                     CGL031
      *                                                                                       CGL031
     I            DS                                                                          CGL031
     I                                        1  100PACODE                                    CGL035
     I                                       11  120PACSEQ                                    CGL035
     I**********                             13  180PCNUM                             CGL035 CSD027A
     I                                       13  18 PCNUM                                    CSD027A
     I                                       19  200PSTYP                                     CGL035
      *                                                                                       CGL035
     I**********                              1   40PACODE                             CGL031 CGL035
     I**********                              5   60PACSEQ                             CGL031 CGL035
     I**********                              7  120PCNUM                              CGL031 CGL035
     I**********                             13  140PSTYP                              CGL031 CGL035
     I            DS                                                                          CER054
     I                                        1   1 CER054                                    CER054
     I                                        1  150WTTAX                                     CER054
     I/COPY WNCPYSRC,MM5350I001
      *
     ISDBANK    E DSSDBANKPD
      ** External data structures for Bank Details
      *
     ISDDEAL    E DSSDDEALPD
      ** External data structures for Dealing ICD Details
      *
     ISDCURR    E DSSDCURRPD
      ** External data structures for Currency Details
      *
     ISDNOST    E DSSDNOSTPD
      ** External data structures for Nostro Details
     I              QQACCD                          QQACD1                                    CGL029
      *
     ISDGELR    E DSSDGELRPD
      ** External data structures for General Ledger Details
     I              QQACCD                          QQACD2                                    CGL029
      *                                                                                       233283
     ISDBRCH    E DSSDBRCHPD                                                                  233283
      ** External DS For branch details                                                       233283
      *                                                                                       233283
     ISDCUST    E DSSDCUSTPD                                                                  233283
     I              QQDFAC                          QQDFA1                                    233283
      ** External DS For Customer Details                                                     233283
      *                                                                                       233283
     ISDLOCN    E DSSDLOCNPD                                                                  233283
      ** External DS for Location Code                                                        233283
      *                                                                                       233283
     ISDCTTX    E DSSDCTTXPD                                                                  233283
      ** External DS for Country of Tax Code                                                  233283
      *                                                                                       233283
     ISCSARD    E DSSCSARDPD                                                                  233283
      ** External DS for SAR Details                                                          233283
      *
     IDSFDY     E DSDSFDY
      ** Short data structure for access objects
      *
     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
      ** Data structure for Tax Parameter File                                              BUG22911
      *                                                                                     BUG22911
     I              'ZAGETSETAC'          C         WGTSAC                                    CGL031
     I              'UseDealCustforEuTax' C         WUSEDL                                  MD026788
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
      ** Program name to retrieve Settlement Account                                          CGL031
      *                                                                                       CGL031
      /COPY ZSRSRC,ZDAT10Z1
      /COPY ZSRSRC,ZFRPEDZ2
      /COPY ZSRSRC,ZHOLI
      /COPY ZSRSRC,ZF2CI
      /COPY ZSRSRC,ZHOLDS
      /COPY ZSRSRC,ZINTDYZ1
      /EJECT
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  SRINIT - Program Initialisation                              *
      *  SRPROC - Main Processing Routine                             *
      *  SRROLL - Deal Automatic Rollover Processing                  *
      *  SRPRIN - Print a Detail Line to Report Processing            *
      *  SRDLNO - Assign Rollover Deal Number Processing              *
      *  SRPCPL - Set Up Principal Amount                             *
      *  SRMDAT - Set Up New Maturity Date Processing                 *
      *  SRINT  - Set Up New Interest Rate Processing                 *
      *  SRMMUP - MM Deals Update Processing                          *
      *  SRDLUP - Deals Update Processing                             *
      *  SRPYRC - Determine Pay/Receive Indicators                    *
      *  SRTLXD - Determine Telex Due Date                            *
      *  SRNOST - Determine Nostro Location                           *
      *  SRWRTD - Write a DTRIX Record                                *
      *  SRUPDD - Update the DTRIX Header Record                      *
      *  SRL1DY - Calculate 1 Day Interest for Front Up Interest      *
      *  SRDYFN - Calculate 1 Day Funding for Front Up Interest       *
      *  SRCOLL - Collateral Details Update Processing                *
      *  SRTRAI - Trailers Update Processing                          *
      *  MM1030 - Calculate Interest                                  *
      *  ZFRQA  - Increment a Day Number Date by a Period Value       *
      *  ZA0710 - Calculate Midas Day Number to DRS (YYYYMMDD)        *
      *  SR1END - Write End of Report                                 *
      *  SRAUDT - Output Audit Report and End Program                 *
      *  *PSSR  - Standard DB Error Processing                        *
      *  SRCFP1 - Register MM5350P1 via RCF                           *
      *  SRCFAU - Register MM5350AU via RCF                           *
      *                                                               *
      *****************************************************************
      /EJECT
      *
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ** Perform Initialisation
      *
     C                     EXSR SRINIT
      *
      ** Perform Detail Processing
      *
     C                     EXSR SRPROC
      *
      ** Output Audit Report and End Program
      *
     C                     EXSR SRAUDT
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *================================================================
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRINIT  -  Program Initialisation                            *
      *  Called By: Main Processing                                   *
      *  Calls    : AOGELRR0 - Access General Ledger Details          *
      *             AOBANKR0 - Access Bank Details                    *
      *             AODEALR0 - Access Dealing ICD Details             *
      *             AOSARDR0 - Access SAR Details                     *
      *             SRCFAU, SRCFP1                                    *
      *                                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
     C/COPY WNCPYSRC,MM5350C001
      *
      ** Initialise LDA field
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVEL'MM5350'  DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD0         DBASE
     C                     OUT  LDA
      *
      ** Call Access Program for General Ledger Details
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDGELR    PARM SDGELR    DSSDY
      *
      ** Handle Database Error
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'*FIRST  'DBKEY
     C                     MOVE 'SDGELRPD'DBFILE           ***************
     C                     Z-ADD001       DBASE            *DB ERROR 001 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Call Access Program for Bank Details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSSDY
      *
      ** Handle Database Error
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'*FIRST  'DBKEY
     C                     MOVE 'SDBANKPD'DBFILE           ***************
     C                     Z-ADD002       DBASE            *DB ERROR 002 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Check System Date Format, DDMMYY (*IN98 off)
      **                           MMDDYY (*IN98 on)
      *
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     ENDIF
      *
      ** Access RUNDAT for multibranching indicator
      *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
      *
     C           AGMBIN    IFEQ 'M'
     C                     MOVE '1'       *IN37
     C                     ENDIF
      *
      ** RCF Processing for Audit File
      *
     C                     EXSR SRCFAU
      *
      ** Report Work fields
      *
     C                     Z-ADD0         RQDLN1  30
     C                     Z-ADD0         DIFLN1  30
     C                     Z-ADD0         STRTLN  30
     C                     MOVE *BLANKS   WFIRST  1
      *
      ** Register MM5350P1 to RCF
      *
     C                     CLOSEMM5350P1
     C                     OPEN MM5350P1
     C                     EXSR SRCFP1
      *
      ** Initialise Array Index
      *
     C                     Z-ADD1         X       30
      *
      ** Call Access Program for Dealing ICD Details
      *
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*FIRST ' WOPTN
     C********** SDDEAL    PARM SDDEAL    DSFDY                                               CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
      *
     C           WRTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'*FIRST  'DBKEY
     C                     MOVE 'SDDEALPD'DBFILE           ***************
     C                     Z-ADD003       DBASE            *DB ERROR 003 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Access SAR Details file to determine if BRT SAR is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*VERIFY' WOPTN
     C                     PARM 'S01383'  WSARD   6
      *
      ** Handle Database Error
      *
     C           WRTCD     IFNE *BLANKS
     C           WRTCD     ANDNE'*NRF   '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ***************
     C                     Z-ADD004       DBASE            *DB ERROR 004 *
     C                     MOVEL'S01383  'DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           WRTCD     IFEQ *BLANKS
     C                     MOVEL'Y'       S01383  1
     C                     ENDIF
      *
      ** If BRT SAR installed, Access BRT Installation Control Data
      *
     C           S01383    IFEQ 'Y'
     C                     MOVE 'D'       BRTKEY  1
     C           BRTKEY    CHAINSDBRTDD0             61
      *
     C           *IN61     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRTDPD'DBFILE           ***************
     C                     Z-ADD005       DBASE            *DB ERROR 005 *
     C                     MOVELBRTKEY    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,MMH00202
      *                                                                                       CGL031
      ** Determine if CGL031 is installed.                                                    CGL031
      *                                                                                       CGL031
     C                     MOVE 'N'       CGL031  1                                           CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD   7                                           CGL031
     C                     PARM '*VERIFY' POPTN   7                                           CGL031
     C                     PARM 'CGL031'  PSARD   6                                           CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CGL031                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Database Error                                                                       CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           PRTCD     ANDNE'*NRF   '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVE 'CGL031'  DBKEY                                               CGL031
     C                     MOVE 'SCSARDPD'DBFILE                                              CGL031
     C                     MOVE 106       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                     MD026788
      ** Access System Values                                                               MD026788
      *                                                                                     MD026788
     C           CGL031    IFEQ 'Y'                                                         MD026788
     C                     CALL 'AOSVALR0'                                                  MD026788
     C                     PARM *BLANKS   P@RTCD  7                                         MD026788
     C                     PARM WUSEDL    P@OP01 20                                         MD026788
     C                     PARM           P@VL01200                                         MD026788
     C                     PARM *BLANK    P@OP02 20                                         MD026788
     C                     PARM           P@VL02200                                         MD026788
     C                     PARM *BLANK    P@OP03 20                                         MD026788
     C                     PARM           P@VL03200                                         MD026788
     C                     PARM *BLANK    P@OP04 20                                         MD026788
     C                     PARM           P@VL04200                                         MD026788
     C                     PARM *BLANK    P@OP05 20                                         MD026788
     C                     PARM           P@VL05200                                         MD026788
     C                     PARM *BLANK    P@OP06 20                                         MD026788
     C                     PARM           P@VL06200                                         MD026788
     C                     PARM *BLANK    P@OP07 20                                         MD026788
     C                     PARM           P@VL07200                                         MD026788
     C                     PARM *BLANK    P@OP08 20                                         MD026788
     C                     PARM           P@VL08200                                         MD026788
     C                     PARM *BLANK    P@OP09 20                                         MD026788
     C                     PARM           P@VL09200                                         MD026788
     C                     PARM *BLANK    P@OP10 20                                         MD026788
     C                     PARM           P@VL10200                                         MD026788
      *                                                                                     MD026788
     C           P@RTCD    IFNE *BLANKS                                                     MD026788
     C           *LOCK     IN   LDA                                                         MD026788
     C                     MOVEL'SDSVALPD'DBFILE           ****************                 MD026788
     C                     MOVEL'*CALL'   DBKEY            * DB ERROR 115 *                 MD026788
     C                     Z-ADD115       DBASE            ****************                 MD026788
     C                     OUT  LDA                                                         MD026788
     C                     EXSR *PSSR                                                       MD026788
     C                     ENDIF                                                            MD026788
      *                                                                                     MD026788
     C                     MOVELP@VL01    WDLCUS  1                                         MD026788
     C                     ENDIF                                                            MD026788
      *                                                                                       CGL031
      ** Determine if CDL006 is installed.                                                    CGL031
      *                                                                                       CGL031
     C                     MOVE 'N'       CDL006  1                                           CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*VERIFY' POPTN                                               CGL031
     C                     PARM 'CDL006'  PSARD                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CDL006                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Database Error                                                                       CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           PRTCD     ANDNE'*NRF   '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVE 'CDL006'  DBKEY                                               CGL031
     C                     MOVE 'SCSARDPD'DBFILE                                              CGL031
     C                     MOVE 107       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CER048
      ** Determine if CER048 is installed.                                                    CER048
      *                                                                                       CER048
     C                     MOVE 'N'       CER048  1                                           CER048
      *                                                                                       CER048
     C                     CALL 'AOSARDR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*VERIFY' POPTN                                               CER048
     C                     PARM 'CER048'  PSARD                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFEQ *BLANKS                                                       CER048
     C                     MOVE 'Y'       CER048                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** Database Error                                                                       CER048
      *                                                                                       CER048
     C           PRTCD     IFNE *BLANKS                                                       CER048
     C           PRTCD     ANDNE'*NRF   '                                                     CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     MOVE 'CER048'  DBKEY                                               CER048
     C                     MOVE 'SCSARDPD'DBFILE                                              CER048
     C                     MOVE 112       DBASE                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR *PSSR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER054
      ** Determine if CER054 is installed.                                                    CER054
      *                                                                                       CER054
     C                     MOVE 'N'       CER054                                              CER054
      *                                                                                       CER054
     C                     CALL 'AOSARDR0'                                                    CER054
     C                     PARM *BLANKS   PRTCD                                               CER054
     C                     PARM '*VERIFY' POPTN                                               CER054
     C                     PARM 'CER054'  PSARD                                               CER054
      *                                                                                       CER054
     C           PRTCD     IFEQ *BLANKS                                                       CER054
     C                     MOVE 'Y'       CER054                                              CER054
     C                     ELSE                                                               CER054
     C                     MOVE 'N'       CER054                                              CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
      ** Database Error                                                                       CER054
      *                                                                                       CER054
     C           PRTCD     IFNE *BLANKS                                                       CER054
     C           PRTCD     ANDNE'*NRF   '                                                     CER054
     C           *LOCK     IN   LDA                                                           CER054
     C                     MOVE 'CER054'  DBKEY                                               CER054
     C                     MOVE 'SCSARDPD'DBFILE                                              CER054
     C                     MOVE 113       DBASE                                               CER054
     C                     OUT  LDA                                                           CER054
     C                     EXSR *PSSR                                                         CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CRE073
      ** Determine if CRE073 is installed.                                                    CRE073
      *                                                                                       CRE073
     C                     MOVE 'N'       CRE073  1                                           CRE073
      *                                                                                       CRE073
     C                     CALL 'AOSARDR0'                                                    CRE073
     C                     PARM *BLANKS   PRTCD                                               CRE073
     C                     PARM '*VERIFY' POPTN                                               CRE073
     C                     PARM 'CRE073'  PSARD                                               CRE073
      *                                                                                       CRE073
     C           PRTCD     IFEQ *BLANKS                                                       CRE073
     C                     MOVE 'Y'       CRE073                                              CRE073
     C                     ENDIF                                                              CRE073
      *                                                                                       CRE073
      ** Database Error                                                                       CRE073
      *                                                                                       CRE073
     C           PRTCD     IFNE *BLANKS                                                       CRE073
     C           PRTCD     ANDNE'*NRF   '                                                     CRE073
     C           *LOCK     IN   LDA                                                           CRE073
     C                     MOVE 'CRE073'  DBKEY                                               CRE073
     C                     MOVE 'SCSARDPD'DBFILE                                              CRE073
     C                     Z-ADD114       DBASE                                               CRE073
     C                     OUT  LDA                                                           CRE073
     C                     EXSR *PSSR                                                         CRE073
     C                     ENDIF                                                              CRE073
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD035545
     C/COPY WNCPYSRC,MMH00013
      *
      ** Key List to access Money Market Interest Rates File
      *
     C           K#KEY1    KLIST
     C                     KFLD           KCCY    3
     C                     KFLD           KDAT    50
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRPROC  -  Main Processing Routine                           *
      *  Called By: Main Processing                                   *
      *  Calls    : ZDAT10, SRROLL, SRCOLL, SRTRAI, SR1END            *
      *                                                               *
      *****************************************************************
      *
     C           SRPROC    BEGSR
      *
     C                     Z-ADDSTRTLN    PRTLN1
      *
      ** Establish starting position
      *
     C           *LOVAL    SETLLMMDELDL1
      *
      ** Read Rollover Deal Selection
      *
     C                     READ MMDELDL1                 60
      *
     C           *IN60     DOUEQ'1'
      *
      ** Convert Maturity Date
      *
     C                     Z-ADD0         ZZDTIN
     C                     Z-ADD0         W#MDAY  50
     C                     Z-ADDFDAT1     ZZDTIN
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    W#MDAY
      *
      ** Determine if Deal is already matured and ready for rollover
      *
     C********** W#MDAY    IFLE BJDNWD                                                       BUG8360
     C           W#MDAY    IFLT BJDNWD                                                       BUG8360
     C           PKCOLF    ANDEQ'Y'
     C                     EXSR SRROLL
     C                     ENDIF
      *
      ** Read next record
      *
     C                     READ MMDELDL1                 60
      *
     C                     ENDDO
      *
      ** Update Collateral Details File
      *
     C           W#UPDT    IFEQ 'Y'
     C                     EXSR SRCOLL
      *
      ** Update Control File
      *
     C                     EXSR SRTRAI
      *
      ** Write final records and totals to report
      *
     C                     EXSR SR1END
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRROLL  -  Deal Automatic Rollover Processing                *
      *  Called By: SRPROC                                            *
      *  Calls    : SRDLNO, SRPCPL, SRMDAT, SRINT, SRMMUP, SRDLUP,    *
      *             SRPRIN,                                           *
      *                                                               *
      *****************************************************************
      *
     C           SRROLL    BEGSR
      *
      ** Allocate the Rollover Deal Number
      *
     C                     EXSR SRDLNO
      *
      ** Compute for New Principal Amount, Total Interest, and Tax Amounts
      *
     C                     EXSR SRPCPL
      *
      ** Save Details in Array
      *
     C           X         IFLE 999
     C                     MOVE PKDN38    DEAL,X
      *
     C           X         OCUR MULT
     C                     Z-ADDPKAMNP    TAMNP
     C                     MOVE W#DLNO    TDEAL
      *
     C                     ADD  1         X
      *
     C                     ELSE
     C           *LOCK     IN   LDA
     C                     MOVELX         DBKEY
     C                     MOVE 'ARRAY   'DBFILE           ***************
     C                     Z-ADD006       DBASE            *DB ERROR 006 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Set up New Maturity Date
      *
     C                     MOVE PKMDYY    W#VDYY  40
     C                     MOVE PKMDMM    W#VDMM  20
     C                     MOVE PKMDDD    W#VDDD  20
     C                     MOVE W#MDAY    W#VDAY  50
     C                     EXSR SRMDAT
      *
      ** Set up New Interest Rate Details
      *
     C           PKBSRC    IFEQ *BLANKS
     C                     EXSR SRINT
     C                     ELSE
     C                     MOVE PKBSRC    W#BSRC  2
     C                     MOVE PKSPRD    W#SPRD 117
     C                     ENDIF
      *
      ** Update Rollover Deal Number on the existing MM deal record
      ** and create the new rollover MM deal record
      *
     C                     EXSR SRMMUP
      *
      ** Update Rollover Deal Number on the existing DL record
      ** and create the new rollover DL record
      *
     C                     EXSR SRDLUP
      *
      ** Print Detail Line on the Report
      *
     C                     EXSR SRPRIN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRPRIN  -  Print a Detail Line to Report Processing          *
      *  Called By: SRROLL                                            *
      *  Calls    : ZDATE2, ZFRPED                                    *
      *                                                               *
      *****************************************************************
      *
     C           SRPRIN    BEGSR
      *
      ** Check that sufficient lines remain for the Format. If not,
      ** write out the Main Headings on a new page.
      *
     C                     Z-ADD1         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     ENDIF
      *
      ** Deal Number, Branch Code, Customer Number, Deal Type,
      ** Deal Sub-type, Base Rate and Currency
      *
     C                     MOVE PKDN38    RDN38
     C                     MOVE PKBRCA    RBRCA
     C                     MOVE PKCNUM    RCNUM
     C                     MOVE PKTYPE    RTYPE
     C                     MOVE PKSTYP    RSTYP
     C                     MOVE PKBSRC    RBSRC
     C                     MOVE PKCCY     RCCY
      *
      ** Rollover Deal Number
      *
     C                     MOVE W#DLNO    RDEAL
      *
      ** Base Rate
      *
     C                     MOVE W#BSRC    RBASE
      *
      ** Value Date
      *
     C                     MOVE W#VDAY    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     RVDAT
      *
      ** Maturity Date
      *
     C                     MOVE W#MDAY    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     RMDAT
      *
      ** Principal Amount
      *
     C                     MOVE PKCYDP    ZDECS
     C                     Z-ADDPKAMNP    ZFLD15
     C                     EXSR ZFRPED
     C                     MOVELZOUT25    RAMNP
      *
      ** Original Rate/Spread
      *
     C                     Z-ADD7         ZDECS
     C                     MOVE PKSPRD    ZFLD15
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSPRD
      *
      ** New Rate/Spread
      *
     C                     MOVE W#SPRD    ZFLD15
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RRATE
      *
      ** Write out Detail Record
      *
     C                     WRITEDETAIL
      *
      ** At least one transaction has been rolled over
      *
     C                     MOVE 'Y'       W#UPDT  1
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRDLNO  -  Assign Rollover Deal Number Processing            *
      *  Called By: SRROLL                                            *
      *  Calls    : CA0040 - Control Deal Number Generation           *
      *                                                               *
      *****************************************************************
      *
     C           SRDLNO    BEGSR
      *                                                                                      BUG8340
     C                     Z-ADD0         W#DLNO                                             BUG8340
      *                                                                                      BUG8340
      ** For Fixed Loan/Deposit get next deal number from the                                BUG8340
      ** fixed loan/deposit deal number range if set up.                                     BUG8340
      *                                                                                      BUG8340
     C           KFDDR     KLIST                                                             BUG8340
     C                     KFLD           PKBRCA           Branch Code                       BUG8340
     C                     KFLD           PKMTYP           Deal Type                         BUG8340
      *                                                                                      BUG8340
     C           KFDDR     CHAINSDFDDRL0             74                                      BUG8340
      *                                                                                      BUG8340
     C           *IN74     IFEQ '0'                                                          BUG8340
     C                     MOVE MMCU      W#DLNO                                             BUG8340
     C                     SETOF                     73                                      BUG8340
      *                                                                                      BUG8340
     C           *IN73     DOUEQ'1'                                                          BUG8340
     C           W#DLNO    CHAINMMDEALLL             73                                      BUG8340
      *                                                                                      BUG8340
     C           *IN73     IFEQ '0'                                                          BUG8340
     C                     ADD  1         W#DLNO                                             BUG8340
     C                     ELSE                                                              BUG8340
     C           W#DLNO    IFGT MMLS                                                         BUG8340
     C                     Z-ADDMMIN      W#DLNO                                             BUG8340
     C                     SETOF                     73                                      BUG8340
     C                     ELSE                                                              BUG8340
     C                     Z-ADDW#DLNO    MMCU                                               BUG8340
     C                     UPDATSDFDDRD0                                                     BUG8340
     C                     ENDIF                                                             BUG8340
     C                     ENDIF                                                             BUG8340
      *                                                                                      BUG8340
     C                     ENDDO                                                             BUG8340
     C                     ENDIF                                                             BUG8340
      *                                                                                      BUG8340
B01  C           W#DLNO    IFEQ 0                                                            BUG8340
      *
     C           *IN62     DOUEQ'0'
     C           1         SETLLCADLFALL
     C                     READ CADLFALL                 62
      *
      **  If a live record is found, delete it
      *
     C           *IN62     IFEQ '0'
     C                     MOVE FKDN38    W#DLNO  60
     C                     MOVE PKDN38    W@DADN  60
     C                     DELETCADLFAP0
      *
      **  Otherwise, call the regeneration program
      *
     C                     ELSE
     C                     CALL 'CA0040'
     C                     PARM *BLANKS   PTERM   1
      *
      **  If an error occurs in the called program, perform a rollback,
      **  and by-pass all further processing.
      *
     C           PTERM     IFEQ 'E'
     C           *LOCK     IN   LDA
     C                     MOVELPTERM     DBKEY
     C                     MOVE 'CA0040  'DBFILE           ***************
     C                     Z-ADD007       DBASE            *DB ERROR 007 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDDO
      *                                                                                      BUG8340
E01  C                     ENDIF                                                             BUG8340
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRPCPL  -  Set up Principal Amount                           *
      *  Called By: SRROLL                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRPCPL    BEGSR
      *
     C           PKAMNP    IFLT 0
     C                     Z-SUBPKAMNP    W#PCPL 150
     C                     ELSE
     C                     Z-ADDPKAMNP    W#PCPL
     C                     ENDIF
     C/COPY WNCPYSRC,MMH00018
      *
     C           PKMTTI    IFLT 0
     C                     Z-SUBPKMTTI    W#MTTI 150
     C                     ELSE
     C                     Z-ADDPKMTTI    W#MTTI
     C                     ENDIF
      *
      ** Computer for Tax Amount
      *
     C                     Z-ADD0         W#OTAM 150
     C/COPY WNCPYSRC,MMH00014
      *
     C           PKIPDS    IFEQ 'N'
     C/COPY WNCPYSRC,MMH00015
     C           PKFUID    ANDNE'Y'
     C           PKMTAX    ANDEQ'Y'
     C/COPY WNCPYSRC,MMH00203
      *
     C           S01383    IFEQ 'Y'
     C           PKCNUM    CHAINSDCBRTL1             61
     C           *IN61     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCBRTL1'DBFILE           ***************
     C                     Z-ADD008       DBASE            *DB ERROR 008 *
     C                     MOVELPKCNUM    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           TAXIND    IFEQ 'L'
     C           TAXIND    OREQ 'P'
     C           W#MDAY    IFLT DEFF
     C           W#MTTI    MULT PBRTR     W#OTAM
     C                     ELSE
     C           W#MTTI    MULT BRTR      W#OTAM
     C                     ENDIF
      *
     C           TAXIND    IFEQ 'P'
     C                     DIV  2         W#OTAM
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
     C           W#MTTI    MULT BNHKTR    W#OTAM
     C                     ENDIF
     C/COPY WNCPYSRC,MMH00204
      *                                                                                       CGL031
      ** Round down or Half Adjust                                                            CGL031
      *                                                                                       CGL031
     C           PKRDFC    IFEQ 'Y'                                                           CGL031
     C                     DIV  100       W#OTAM                                              CGL031
     C                     ELSE                                                               CGL031
     C                     DIV  100       W#OTAM    H                                         CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF
     C/COPY WNCPYSRC,MMH00019
      *                                                                                       CGL031
      ** Apply EU Withholding tax if applicable                                               CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     EXSR SREUTX                                                        CGL031
     C                     ENDIF                                                              CGL031
      *
     C           PKIPDS    IFEQ 'N'
     C           PKFUID    ANDNE'Y'
     C                     ADD  W#MTTI    W#PCPL
     C                     SUB  W#OTAM    W#PCPL
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     SUB  WEUTAX    W#PCPL                                              CGL031
      *                                                                                       CER048
      ** Substract Secondary Tax from Principal Amount                                        CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     SUB  WSTAX     W#PCPL                                              CER048
      *                                                                                       CER054
      ** Substract the Third Tax from Principal Amount                                        CER054
      *                                                                                       CER054
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     SUB  WTTAX     W#PCPL                                              CER054
     C                     ENDIF                                                              CER054
      *                                                                                    BUG23711A
     C           WFLAG     IFEQ 'Y'                                                        BUG23711A
      *                                                                                    BUG23711A
     C                     SUB  W#MTTI    W#PCPL                                           BUG23711A
     C                     ADD  WTOTIN    W#PCPL                                           BUG23711A
      *                                                                                    BUG23711A
     C                     ENDIF                                                           BUG23711A
      *                                                                                    BUG23711A
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C********** TSEDAT    IFEQ MDAT                                              BUG23711 BUG23711A
     C********** WCSIN     ANDEQ'Y'                                               BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C**********           SUB  W#MTTI    W#PCPL                                  BUG23711 BUG23711A
     C**********           SUB  PTOTIN    W#PCPL                                  BUG23711 BUG23711A
     C**********           SUB  WSGINT    W#PCPL                                  BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C**********           ENDIF                                                  BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C                     ELSE
     C                     ADD  W#MTTI    W#PCPL
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      * SREUTX - Calculate EU Withholding Tax                                                 CGL031
      *****************************************************************                       CGL031
     C           SREUTX    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C           PKIPDS    IFEQ 'N'                                                           CGL031
     C           PKFUID    ANDNE'Y'                                                           CGL031
      *                                                                                       CGL031
     C           PKTYPE    IFEQ 'TD'                                                          CGL031
     C           PKTYPE    OREQ 'CD'                                                          CGL031
      *                                                                                       CGL031
     C           PKTYPE    OREQ 'DT'                                                          CGL031
     C           CDL006    ANDEQ'Y'                                                           CGL031
     C           PKTYPE    OREQ 'LT'                                                          CGL031
     C           CDL006    ANDEQ'Y'                                                           CGL031
     C           PKTYPE    OREQ 'FT'                                                          CGL031
     C           CDL006    ANDEQ'Y'                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE PKBRCA    PBRCA   3                                           CGL031
     C**********           Z-ADDPKCNUM    PCNUM                                       CGL031 CSD027A
     C                     MOVELPKCNUM    PCNUM                                              CSD027A
     C                     MOVE PKCCY     PCCY    3                                           CGL031
     C                     Z-ADDPKPSTM    PSTYP                                               CGL031
     C**********           MOVE *BLANKS   PSACC  12                                    CGL031 CGL035
     C                     MOVE *BLANKS   PSACC  18                                           CGL035
     C                     MOVE PKPONS    PSACC                                               CGL031
      *                                                                                       CGL031
      ** Retrieve Interest Settlement Customer                                                CGL031
      *                                                                                       CGL031
     C           WDLCUS    IFEQ 'Y'                                                         MD026788
     C                     EXSR SRGSAC                                                        CGL031
     C                     ENDIF                                                            MD026788
      *                                                                                       CGL031
     C                     MOVE *BLANKS   WCNUM   6                                           CGL031
     C                     MOVE PCNUM     WCNUM                                               CGL031
     C                     MOVE *BLANKS   WDLNO   6                                           CGL031
     C                     MOVE PKDN38    WDLNO                                               CGL031
      *                                                                                       CGL031
      ** Calculate Taxable Amount                                                             233283
      *                                                                                       233283
     C                     EXSR SRTAXA                                                        233283
      *                                                                                       233283
      ** Calculate Withholding Tax                                                            CGL031
      *                                                                                       CGL031
     C                     Z-ADD0         WEUTAX                                              CGL031
     C                     Z-ADD0         WSTAX  150                                          CER048
     C                     Z-ADD0         WTTAX                                               CER054
      *                                                                                       CER048
      ** Set Parameter Threshold Indicator for Private Individual or                          CER048
      ** Joint Account                                                                        CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     MOVE 'T'       PINTH                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CGL031
     C                     MOVE HKSLYY    WYY     4                                        BUG23711A
     C                     MOVELHKSLMM    WMMDD   4                                        BUG23711A
     C                     MOVE HKSLDD    WMMDD                                            BUG23711A
     C                     MOVELWYY       WDINT   8                                        BUG23711A
     C                     MOVE WMMDD     WDINT                                            BUG23711A
      *                                                                                    BUG23711A
     C                     MOVE WDINT     ZZDTIN                                           BUG23711A
      *                                                                                    BUG23711A
     C                     EXSR ZDAT10                                                     BUG23711A
      *                                                                                    BUG23711A
     C                     Z-ADDZZMDNO    WKSLID  50                                       BUG23711A
      *                                                                                    BUG23711A
     C                     MOVE *BLANKS   WFLAG   1                                        BUG23711A
      *                                                                                    BUG23711A
     C           CER048    IFEQ 'Y'                                                        BUG23711A
      *                                                                                    BUG23711A
     C           HKDVSD    IFNE WKSLID                                                     BUG23711A
      *                                                                                    BUG23711A
     C                     MOVE 'Y'       WFLAG   1                                        BUG23711A
      *                                                                                    BUG23711A
     C                     MOVE EWTRT1    ZICALC                                           BUG23711A
      *                                                                                    BUG23711A
     C                     CALL 'GLINTC'                                                   BUG23711A
      *                                                                                    BUG23711A
      ** Input parameters                                                                  BUG23711A
      *                                                                                    BUG23711A
     C                     PARM WKSLID    ZIBEG   50                                       BUG23711A
     C                     PARM HKMATD    ZIEND   50                                       BUG23711A
     C                     PARM           ZICALC  10                                       BUG23711A
     C                     PARM HKAMNP    ZIAMT  150                                       BUG23711A
     C                     PARM HKINTR    ZIRATE 117                                       BUG23711A
      ** Output                                                                            BUG23711A
     C                     PARM *ZEROS    ZINTR  309                                       BUG23711A
      *                                                                                    BUG23711A
     C                     Z-ADDZINTR     PTOTIN                                           BUG23711A
     C                     Z-ADDPTOTIN    WTOTIN 150                                       BUG23711A
      *                                                                                    BUG23711A
     C                     ENDIF                                                           BUG23711A
      *                                                                                    BUG23711A
     C                     ENDIF                                                           BUG23711A
      *                                                                                    BUG23711A
     C                     EXSR SRCLPI                                                        CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
     C           PRTRN     WHEQ 'ERROR'                                                       CGL031
     C                     MOVE 103       DBASE                                               CGL031
     C                     MOVE PDBFIL    DBFILE                                              CGL031
     C                     MOVE PDBKEY    DBKEY                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
      *                                                                                       CGL031
     C           PRTRN     WHNE 'JOINT'                                                       CGL031
     C                     Z-ADDPTXAMT    WEUTAX 150                                          CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     Z-ADDPSTXA     WSTAX                                               CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     Z-ADDPTTXA     WTTAX                                               CER054
     C                     ENDIF                                                              CER054
     C                     ENDIF                                                              CER048
      *                                                                                       CGL031
     C           PRTRN     WHEQ 'JOINT'                                                       CGL031
     C                     EXSR SRJOIN                                                        CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRJOIN - Process for Account Holders                         *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRJOIN    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C           WCNUM     SETLLSDJACCLB                                                      CGL031
     C           WCNUM     READESDJACCLB                 21                                   CGL031
      *                                                                                       CGL031
     C           *IN21     DOWEQ'0'                                                           CGL031
      *                                                                                       CGL031
     C                     EXSR SRCLJA                                                        CGL031
      *                                                                                       CGL031
     C           PRTRN     IFEQ 'ERROR'                                                       CGL031
     C                     MOVE 104       DBASE                                               CGL031
     C                     MOVE PDBFIL    DBFILE                                              CGL031
     C                     MOVE PDBKEY    DBKEY                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           PCSTAT    IFEQ 'TAXAB'                                                       CGL031
     C                     ADD  PTXAMT    WEUTAX                                              CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     ADD  PSTXA     WSTAX                                               CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     ADD  PTTXA     WTTAX                                               CER054
     C                     ENDIF                                                              CER054
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           PRTRN     IFEQ 'NOTAX'                                                       CGL031
     C           PRTRN     OREQ 'TAXAB'                                                       CGL031
     C           WCNUM     READESDJACCLB                 21                                   CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           PRTRN     IFEQ 'LAST'                                                        CGL031
     C                     MOVE *ON       *IN21                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      * SRGSAC - Retrieve Settlement Account                                                  CGL031
      *****************************************************************                       CGL031
     C           SRGSAC    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     CALL WGTSAC                                                        CGL031
      *                                                                                       CGL031
      ** Outputs                                                                              CGL031
     C                     PARM           PRTRN   7                                           CGL031
     C                     PARM           PACODE                                              CGL031
     C                     PARM           PACSEQ                                              CGL031
     C                     PARM           PMEMOI  1                                           CGL031
     C                     PARM           PPRONI  1                                           CGL031
      *                                                                                       CGL031
      ** Input/Output                                                                         CGL031
     C                     PARM           PBRCA   3                                           CGL031
     C                     PARM           PCNUM                                               CGL031
     C                     PARM           PCCY    3                                           CGL031
      *                                                                                       CGL031
      ** Inputs                                                                               CGL031
     C                     PARM           PSTYP                                               CGL031
     C**********           PARM           PSACC  12                                    CGL031 CGL035
     C                     PARM           PSACC  18                                           CGL035
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       233283
      /EJECT                                                                                  233283
      *****************************************************************                       233283
      * SRTAXA - Retrieve Taxable Amount                              *                       233283
      *****************************************************************                       233283
     C           SRTAXA    BEGSR                                                              233283
      *                                                                                       233283
      ** Branch details                                                                       233283
      *                                                                                       233283
     C                     CALL 'AOBRCHR0'                                                    233283
     C                     PARM *BLANKS   PRTCD                                               233283
     C                     PARM '*KEY   ' POPTN                                               233283
     C                     PARM           PKBRCA                                              233283
     C           SDBRCH    PARM SDBRCH    DSSDY                                               233283
      *                                                                                       233283
      **  Database Error                                                                      233283
      *                                                                                       233283
     C           PRTCD     IFNE *BLANKS                                                       233283
     C                     MOVEL'*KEY   ' DBKEY                                               233283
     C                     MOVEL'SDBRCHPD'DBFILE                                              233283
     C                     Z-ADD108       DBASE                                               233283
     C                     EXSR *PSSR                                                         233283
     C                     ENDIF                                                              233283
      *                                                                                       233283
      ** Country code details                                                                 233283
      *                                                                                       233283
     C                     CALL 'AOLOCNR0'                                                    233283
     C                     PARM *BLANKS   PRTCD                                               233283
     C                     PARM '*KEY   ' POPTN                                               233283
     C                     PARM           A8LCCD                                              233283
     C           SDLOCN    PARM SDLOCN    DSFDY                                               233283
      *                                                                                       233283
      **  Database Error                                                                      233283
      *                                                                                       233283
     C           PRTCD     IFNE *BLANKS                                                       233283
     C                     MOVEL'*KEY   ' DBKEY                                               233283
     C                     MOVEL'SDLOCNPD'DBFILE                                              233283
     C                     Z-ADD109       DBASE                                               233283
     C                     EXSR *PSSR                                                         233283
     C                     ENDIF                                                              233283
      *                                                                                       233283
      ** Customer details                                                                     233283
      *                                                                                       233283
     C                     MOVEL*BLANKS   @PKEY1 10                                           233283
     C                     MOVELPKCNUM    @PKEY1                                              233283
      *                                                                                       233283
     C                     CALL 'AOCUSTR0'                                                    233283
     C                     PARM *BLANK    PRTCD                                               233283
     C                     PARM '*KEY   ' POPTN                                               233283
     C                     PARM           @PKEY1                                              233283
     C                     PARM           @PKYST  7                                           233283
     C           SDCUST    PARM SDCUST    DSSDY                                               233283
      *                                                                                       233283
      ** Database Error                                                                       233283
      *                                                                                       233283
     C           PRTCD     IFNE *BLANKS                                                       233283
     C                     MOVEL@PKYST    DBKEY                                               233283
     C                     MOVEL'SDCUSTPD'DBFILE                                              233283
     C                     Z-ADD110       DBASE                                               233283
     C                     EXSR *PSSR                                                         233283
     C                     ENDIF                                                              233283
      *                                                                                       233283
      ** Country of Tax                                                                       233283
      *                                                                                       233283
     C                     MOVE DVCNCD    WCNCD   2                                           233283
     C                     MOVE BBCOLC    WCOLC   2                                           233283
      *                                                                                       233283
     C                     CALL 'AOCTTXR0'                                                    233283
     C                     PARM *BLANKS   PRTCD                                               233283
     C                     PARM '*KEY   ' POPTN                                               233283
     C                     PARM           WCNCD                                               233283
     C                     PARM           WCOLC                                               233283
     C           SDCTTX    PARM SDCTTX    DSFDY                                               233283
      *                                                                                       233283
     C           PRTCD     IFEQ '*NRF   '                                                     233283
     C                     MOVE *BLANKS   WCOLC                                               233283
     C                     CALL 'AOCTTXR0'                                                    233283
     C                     PARM *BLANKS   PRTCD                                               233283
     C                     PARM '*KEY   ' POPTN                                               233283
     C                     PARM           WCNCD                                               233283
     C                     PARM           WCOLC                                               233283
     C           SDCTTX    PARM SDCTTX    DSFDY                                               233283
      *                                                                                       233283
      ** Database Error                                                                       233283
      *                                                                                       233283
     C           PRTCD     IFNE *BLANKS                                                       233283
     C                     MOVELWCNCD     DBKEY                                               233283
     C                     MOVELWCOLC     DBKEY                                               233283
     C                     MOVEL'SDCTTXPD'DBFILE                                              233283
     C                     Z-ADD111       DBASE                                               233283
     C                     EXSR *PSSR                                                         233283
     C                     ENDIF                                                              233283
     C                     ENDIF                                                              233283
      *                                                                                       233283
     C           PKSLID    IFGT *ZERO                                                         233283
     C                     MOVE PKSLID    PICSTR                                              233283
     C                     ELSE                                                               233283
     C                     MOVE PKDVSD    PICSTR                                              233283
     C                     ENDIF                                                              233283
      *                                                                                       233283
      ** Set up end date                                                                      233283
      *                                                                                       233283
     C                     MOVE PKMATD    PICEND                                              233283
      **********                                                                 BUG23550A BUG23711A
     C**********           RESETWSGINT                                           BUG23550A BUG23711A
     C**********           RESETWSTXSR                                           BUG23550A BUG23711A
     C**********           RESETWSSTDO                                           BUG23550A BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C**********           MOVE 'N'       WCSIN   1                               BUG23711 BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C********** CER048    IFEQ 'Y'                                              BUG23550A BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C********** HKDN38    SETLLSDCSINLD                                         BUG23550A BUG23711A
     C********** HKDN38    READESDCSINLD                 88                      BUG23550A BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C********** *IN88     DOWEQ*OFF                                             BUG23550A BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C**********           MOVE 'Y'       WCSIN                                   BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C********** TSEDAT    IFNE VDAT                                              BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C**********           ADD  TSGINT    WSGINT 150                             BUG23550A BUG23711A
     C**********           ADD  TSTXSR    WSTXSR 150                             BUG23550A BUG23711A
     C**********           ADD  TSSTDO    WSSTDO 150                             BUG23550A BUG23711A
     C**********           Z-ADDTSEDAT    PICSTR                                 BUG23550A BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C**********           ENDIF                                                  BUG23711 BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C********** HKDN38    READESDCSINLD                 88               88     BUG23550A BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C**********           ENDDO                                                 BUG23550A BUG23711A
     C**********           ENDIF                                                 BUG23550A BUG23711A
      *                                                                                       233283
      ** Calculate taxable interest amount                                                    233283
      *                                                                                       233283
     C           WFLAG     IFNE 'Y'                                                        BUG23711A
      *                                                                                    BUG23711A
     C           EWTRT1    IFEQ '1'                                                           233283
     C           PICSTR    ANDLTEWEDT1                                                        234407
     C           PICEND    SUB  PICSTR    WDY1    50                                          233283
     C           PICEND    SUB  EWEDT1    WDY2    50                                          233283
     C********** PKMTTI    MULT WDY2      PTOTIN    H                                  233283 234407
     C           W#MTTI    MULT WDY2      PTOTIN    H                                         234407
     C           PTOTIN    DIV  WDY1      PTOTIN    H                                         233283
     C                     ELSE                                                               233283
     C**********           Z-ADDPKMTTI    PTOTIN                                       233283 234407
     C                     Z-ADDW#MTTI    PTOTIN                                              234407
     C                     ENDIF                                                              233283
      *                                                                                    BUG23711A
     C                     ENDIF                                                           BUG23711A
      *                                                                                       233283
     C                     ENDSR                                                              233283
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      * SRCLPI - Calculate EU Withholding Tax for Private Individual                          CGL031
      *****************************************************************                       CGL031
     C           SRCLPI    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C**********           SUB  WSGINT    PTOTIN                                 BUG23550A BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C                     CALL 'ZATXCLPI'                                                    CGL031
      *                                                                                       CGL031
      ** Input parameters                                                                     CGL031
     C                     PARM 'D'       PMODID  1                                           CGL031
     C**********           PARM WDLNO     PTRREF 18                                    CGL031 CGL035
     C                     PARM WDLNO     PTRREF 24                                           CGL035
     C                     PARM PKBRCA    PBRCA                                               CGL031
     C                     PARM WCNUM     PWCNUM  6                                           CGL031
     C**********           PARM PKDVSD    PICSTR  50                                   CGL031 233283
     C**********           PARM PKMATD    PICEND  50                                   CGL031 233283
     C**********           PARM W#MTTI    PTOTIN 150                                   CGL031 233283
     C                     PARM           PICSTR  50                                          233283
     C                     PARM           PICEND  50                                          233283
     C                     PARM           PTOTIN 150                                          233283
     C                     PARM *ZERO     PTXRAB  64                                          CGL031
     C                     PARM PKCCY     POCCY   3                                           CGL031
     C                     PARM           PINTH   1                                           CER048
      *                                                                                       CGL031
      ** Output parameters                                                                    CGL031
     C                     PARM           PIEDAT 150                                          CGL031
     C                     PARM           PTXAMT 150                                          CGL031
     C                     PARM           PINTA  150                                          CGL031
     C                     PARM           PTXCCY  3                                           CGL031
     C                     PARM           PCTTX   2                                           CGL031
     C                     PARM           PTXBKT  2                                           CGL031
     C**********           PARM           PEUTXC  40                                   CGL031 CGL035
     C                     PARM           PEUTXC 100                                          CGL035
     C                     PARM           PCLOC   2                                           CGL031
     C                     PARM           PCSTAT  5                                           CGL031
     C                     PARM           PTTEND  1                                           CGL031
     C                     PARM           PTXRPD  64                                          CGL031
     C**********           PARM           PSTXB   20                                 CER048 BUG22911
     C**********           PARM           PSTAC  100                                 CER048 BUG22911
     C**********           PARM           PSTTR   64                                 CER048 BUG22911
     C**********           PARM           PSTTP   1                                  CER048 BUG22911
     C**********           PARM           PSTXA  150                                 CER048 BUG22911
     C                     PARM           PDBKEY 10                                           CGL031
     C                     PARM           PDBFIL 10                                           CGL031
     C                     PARM           PRTRN                                               CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C**********           ADD  WSGINT    PTOTIN                                 BUG23550A BUG23711A
     C**********           ADD  WSTXSR    PTXAMT                                 BUG23550A BUG23711A
     C**********           ADD  WSSTDO    PSTXA                                  BUG23550A BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C********** TSEDAT    IFLE MDAT                                              BUG23711 BUG23711A
     C********** WCSIN     ANDEQ'Y'                                               BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C**********           SUB  WSTXSR    PTXAMT                                  BUG23711 BUG23711A
     C**********           SUB  WSSTDO    PSTXA                                   BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C**********           ENDIF                                                  BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      * SRCLJA - Calculate EU Withhlding Tax for Joint Account                                CGL031
      *****************************************************************                       CGL031
     C           SRCLJA    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C**********           SUB  WSGINT    PTOTIN                                 BUG23550A BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C                     CALL 'ZATXCLJA'                                                    CGL031
      *                                                                                       CGL031
      ** Input parameters                                                                     CGL031
     C                     PARM 'D'       PMODID                                              CGL031
     C                     PARM WDLNO     PTRREF                                              CGL031
     C                     PARM PKBRCA    PBRCA                                               CGL031
     C                     PARM WCNUM     PJACNO  6                                           CGL031
     C                     PARM JCCUST    PWCNUM  6                                           CGL031
     C                     PARM JCNAHO    PNHREF 10                                           CGL031
     C                     PARM JCINVP    PINVP  10                                           CGL031
     C                     PARM JCPAHT    PPAHT   1                                         BUG26839
     C**********           PARM PKDVSD    PICSTR                                       CGL031 233283
     C**********           PARM PKMATD    PICEND                                       CGL031 233283
     C**********           PARM W#MTTI    PTOTIN                                       CGL031 233283
     C                     PARM           PICSTR                                              233283
     C                     PARM           PICEND                                              233283
     C                     PARM           PTOTIN                                              233283
     C                     PARM *ZERO     PTXRAB                                              CGL031
     C                     PARM PKCCY     POCCY                                               CGL031
     C                     PARM           PINTH                                               CER048
      *                                                                                       CGL031
      ** Output parameters                                                                    CGL031
     C                     PARM           PIEDAT                                              CGL031
     C                     PARM           PTXAMT                                              CGL031
     C                     PARM           PINTA                                               CGL031
     C                     PARM           PTXCCY                                              CGL031
     C                     PARM           PCTTX                                               CGL031
     C                     PARM           PTXBKT                                              CGL031
     C                     PARM           PEUTXC                                              CGL031
     C                     PARM           PCLOC                                               CGL031
     C                     PARM           PCSTAT                                              CGL031
     C                     PARM           PTTEND                                              CGL031
     C                     PARM           PTXRPD                                              CGL031
     C                     PARM           PJAMG   1                                           CGL031
     C**********           PARM           PSTXB                                      CER048 BUG22911
     C**********           PARM           PSTAC                                      CER048 BUG22911
     C**********           PARM           PSTTR                                      CER048 BUG22911
     C**********           PARM           PSTTP                                      CER048 BUG22911
     C**********           PARM           PSTXA                                      CER048 BUG22911
     C                     PARM           PDBKEY                                              CGL031
     C                     PARM           PDBFIL                                              CGL031
     C                     PARM           PRTRN                                               CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C**********           ADD  WSGINT    PTOTIN                                 BUG23550A BUG23711A
     C**********           ADD  WSTXSR    PTXAMT                                 BUG23550A BUG23711A
     C**********           ADD  WSSTDO    PSTXA                                  BUG23550A BUG23711A
      **********                                                                 BUG23550A BUG23711A
     C********** TSEDAT    IFLE MDAT                                              BUG23711 BUG23711A
     C********** WCSIN     ANDEQ'Y'                                               BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C**********           SUB  WSTXSR    PTXAMT                                  BUG23711 BUG23711A
     C**********           SUB  WSSTDO    PSTXA                                   BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C**********           ENDIF                                                  BUG23711 BUG23711A
      **********                                                                  BUG23711 BUG23711A
     C                     ENDSR                                                              CGL031
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRMDAT  -  Set Up New Maturity Date Processing               *
      *  Called By: SRROLL                                            *
      *  Calls    : ZFRQA, ZA0710                                     *
      *                                                               *
      *****************************************************************
      *
     C           SRMDAT    BEGSR
      *
     C           PKAURO    IFNE 'Y'
     C           PKAURO    ANDNE'A'                                                          BUG8232
     C                     Z-ADD0         W#MDAY  50
     C                     Z-ADD0         W#MDYY  40
     C                     Z-ADD0         W#MDMM  20
     C                     Z-ADD0         W#MDDD  20
     C                     ELSE
      *                                                                                       243842
      ** HKROFQ=A means Monthly on Accrual Profit Date.                                       243842
      ** If system is not Monthly accrual, force HKROFQ to be = M Monthly                     243842
      *                                                                                       243842
     C           PKROFQ    IFEQ 'A'                                                           243842
     C           BKAPFQ    ANDEQ'D'                        Daily                              243842
     C           PKROFQ    OREQ 'A'                                                           243842
     C           BKAPFQ    ANDEQ'F'                        Fortnightly                        243842
     C           PKROFQ    OREQ 'A'                                                           243842
     C           BKAPFQ    ANDEQ'W'                        Weekly                             243842
     C                     MOVE 'M'       ZFREQ                                               243842
     C                     ELSE                                                               243842
     C                     MOVE PKROFQ    ZFREQ
     C                     ENDIF                                                              243842
      *                                                                                       243842
     C                     MOVE W#MDAY    ZDAYNO
     C                     MOVE PKRLDN    ZMDAY
     C                     MOVE PKCCY     ZCCY
     C                     EXSR ZFRQA
     C                     MOVE ZDAYNO    W#MDAY
     C**********           MOVE ZDAYNO    @@DAYN                                             BUG8360
     C           W#MDAY    IFLT BJDNWD                                                       BUG8360
     C                     Z-ADDBJDNWD    W#MDAY                                             BUG8360
     C                     ENDIF                                                             BUG8360
     C                     EXSR CHKHOL                                                       BUG8360
     C                     MOVE W#MDAY    @@DAYN                                             BUG8360
     C                     EXSR ZA0710
     C                     MOVEL@@VDT     W#MDYY
     C                     MOVE @@VDT     W#TDAT  40
     C                     MOVE W#TDAT    W#MDDD
     C                     MOVELW#TDAT    W#MDMM
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRINT   -  Set Up New Interest Rate Processing               *
      *  Called By: SRROLL                                            *
      ***Calls****:*ZINTPL*********************************************                       CAS001
      *  Calls    : ZAINTPL                                           *                       CAS001
      *                                                               *
      *****************************************************************
      *
     C           SRINT     BEGSR
      *
     C                     MOVE PKBSRC    W#BSRC
     C                     MOVE PKSPRD    W#SPRD
      *
     C           W#BSRC    IFEQ *BLANKS
      *
     C                     MOVE PKCCY     KCCY
     C                     MOVE W#MDAY    KDAT
     C           K#KEY1    CHAINFDINTRP2             65
      *
     C           *IN65     IFEQ '1'
     C           K#KEY1    SETLLFDINTRP2
     C**********           READPFDINTRP2                 66                                  BUG4065
     C           KCCY      REDPEFDINTRP2                 66                                  BUG4065
     C                     ELSE                                                              BUG4065
      *                                                                                      BUG4065
      ** Exact record found (period date = maturity), set the rate & leave SR                BUG4065
      *                                                                                      BUG4065
     C                     MOVE HWBRRT    W#SPRD                                             BUG4065
     C                     GOTO INTEND                                                       BUG4065
     C                     ENDIF
      *
     C           *IN66     IFEQ '1'
     C                     MOVE 'Y'       W#YRAT  1
     C           K#KEY1    CHAINFDINTRP1             65
     C           *IN65     IFEQ '1'
     C           K#KEY1    SETLLFDINTRP1
     C**********           READPFDINTRP1                 66                                  BUG4065
     C           KCCY      REDPEFDINTRP1                 66                                  BUG6045
      *                                                                                      BUG4065
      ** All int rate records has a period date > maturity, leave SR                         BUG4065
      ** as interpolation cannot be done. New rate = old rate.                               BUG4065
      *                                                                                      BUG4065
     C           *IN66     IFEQ '1'                                                          BUG6045
     C                     GOTO INTEND                                                       BUG4065
     C                     ENDIF                                                             BUG6045
      *                                                                                      BUG4065
     C                     ELSE                                                              BUG4065
      *                                                                                      BUG4065
      ** Exact record found (period date = maturity), set the rate & leave SR                BUG4065
      *                                                                                      BUG4065
     C                     MOVE HWBRRT    W#SPRD                                             BUG4065
     C                     GOTO INTEND                                                       BUG4065
     C                     ENDIF
     C                     MOVE HWPRDN    ZINDAT
     C                     MOVE HWBRRT    W#SPRD
      *
     C                     ELSE
      *
     C                     MOVE *BLANKS   W#YRAT
     C                     MOVE HWPRDN    ZINDAT
     C                     MOVE HWBRRT    W#SPRD
     C                     ENDIF
      *
     C                     MOVE W#MDAY    ZIBDAT
      *
     C           W#YRAT    IFEQ 'Y'
     C**********           READ FDINTRP1                 65                                  BUG4065
     C           KCCY      READEFDINTRP1                 65                                  BUG6045
      *                                                                                      BUG4065
      ** All int rate records has a period date < maturity, leave SR                         BUG4065
      ** as interpolation cannot be done. New rate = old rate.                               BUG4065
      *                                                                                      BUG4065
     C           *IN65     IFEQ '1'                                                          BUG6045
     C                     GOTO INTEND                                                       BUG4065
     C                     ENDIF                                                             BUG6045
      *                                                                                      BUG4065
     C                     MOVE HWPRDN    ZIFDAT
     C                     MOVE HWBRRT    ZIFRAT
     C                     ELSE
     C**********           READ FDINTRP2                 65                                  BUG4065
     C           KCCY      READEFDINTRP2                 65                                  BUG6045
      *                                                                                      BUG4065
      ** All int rate records has a period date < maturity, leave SR                         BUG4065
      ** as interpolation cannot be done. New rate = old rate.                               BUG4065
      *                                                                                      BUG4065
     C           *IN65     IFEQ '1'                                                          BUG6045
     C                     GOTO INTEND                                                       BUG4065
     C                     ENDIF                                                             BUG6045
      *                                                                                      BUG4065
     C                     MOVE HWPRDN    ZIFDAT
     C                     MOVE HWBRRT    ZIFRAT
     C                     ENDIF
      *
      ** If maturity date is between two defined period dates,                               BUG4065
      ** rate can be retrieved by interpolation method. Ensure                               BUG4065
      ** that dates are not equal to avoid 'divide by zero' error.                           BUG4065
      *                                                                                      BUG4065
     C           ZINDAT    IFNE ZIFDAT                                                       BUG4065
     C                     MOVE W#SPRD    ZINRAT
     C**********           EXSR ZINTPL                                                        CAS001
     C                     Z-ADD0         ZIBRAT                                              CAS001
     C                     CALL 'ZAINTPL'                                                     CAS001
     C                     PARM           ZINDAT  50                                          CAS001
     C                     PARM           ZIBDAT  50                                          CAS001
     C                     PARM           ZIFDAT  50                                          CAS001
     C                     PARM           ZINRAT 139                                          CAS001
     C                     PARM           ZIFRAT 139                                          CAS001
     C                     PARM           ZIBRAT 139                                          CAS001
     C                     MOVE ZIBRAT    W#SPRD
     C                     ELSE                                                              BUG4065
     C                     MOVE PKSPRD    W#SPRD                                             BUG4065
     C                     ENDIF                                                             BUG4065
     C                     ENDIF
      *
     C**********           ENDSR                                                             BUG4065
     C           INTEND    ENDSR                                                             BUG4065
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRMMUP  -  MM Deals Update Processing                        *
      *  Called By: SRROLL                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRMMUP    BEGSR
      *
     C           PKDN38    CHAINMMDEALLL             67
      *
     C           *IN67     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVELPKDN38    DBKEY
     C                     MOVE 'MMDEALLL'DBFILE           ***************
     C                     Z-ADD009       DBASE            *DB ERROR 009 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Update existing Deal
      *
     C                     MOVE W#DLNO    HKROBY
     C                     MOVE *BLANKS   HKCOLF
     C                     MOVE 'O'       HKRBSI                                             BUG8340
     C                     MOVE HKCOLA    W#COLA 150
     C                     Z-ADD0         HKCOLA
     C                     UPDATMMDELDP0
      *
     C           W#DLNO    CHAINMMDEALLL             67
      *
     C           *IN67     IFEQ '0'
     C           *LOCK     IN   LDA
     C                     MOVELW#DLNO    DBKEY
     C                     MOVE 'MMDEALLL'DBFILE           ***************
     C                     Z-ADD010       DBASE            *DB ERROR 010 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE *BLANKS   HKROBY
     C                     MOVE 'Y'       HKCOLF
     C                     MOVE 'N'       HKRBSI                                             BUG8340
     C                     Z-ADDW#COLA    HKCOLA
     C                     MOVE W#DLNO    HKDN38
     C                     MOVE W@DADN    HKDADN                                             BUG8340
     C                     MOVE W#VDYY    HKVDYY
     C                     MOVE W#VDMM    HKVDMM
     C                     MOVE W#VDDD    HKVDDD
     C                     MOVE W#MDYY    HKMDYY
     C                     MOVE W#MDMM    HKMDMM
     C                     MOVE W#MDDD    HKMDDD
     C                     MOVE W#BSRC    HKBSRC
     C                     Z-ADDW#SPRD    HKSPRD
     C                     Z-ADDW#MTTI    HKMTTI
     C                     Z-ADDW#MTTI    HKIMAT
     C                     MOVELBJMRDT    HKDLUP
     C                     MOVE BJMRDT    HKYLUP
     C                     MOVE BJMRDT    W#FDAT  5
     C                     MOVELW#FDAT    HKMLUP
     C                     TIME           HKTLUP
     C                     MOVE 'I'       HKCHTP
     C                     MOVE BJRDNB    HKLCD
     C                     Z-ADD0         HKBCAM                                              CGL014
      *                                                                                       CRE073
      ** New interest rate rounding fields should reflect on the new deal                     CRE073
      ** if CRE073 is switched ON, othewise, the fields will not be populated                 CRE073
      *                                                                                       CRE073
     C           CRE073    IFNE 'Y'                                                           CRE073
     C                     Z-ADD0         HKCNSP                                              CRE073
     C                     MOVE *BLANK    HKRDMT                                              CRE073
     C                     MOVE *BLANK    HKRDFD                                              CRE073
     C                     ENDIF                                                              CRE073
      *
      ** Write new MMDELDPP record
      *
     C                     WRITEMMDELDP0
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRDLUP  -  Deals Update Processing                           *
      *  Called By: SRROLL                                            *
      *  Calls    : SRL1DY, SRDYFN, SRPYRC, SRWRTD, SRUPDD            *
      *                                                               *
      *****************************************************************
      *
     C           SRDLUP    BEGSR
      *
     C           PKDN38    CHAINDEALS                68
      *
     C           *IN68     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVELPKDN38    DBKEY
     C                     MOVE 'DEALS   'DBFILE           ***************
     C                     Z-ADD011       DBASE            *DB ERROR 011 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE W#DLNO    RBDN
     C                     MOVE W#PCPL    RBDA
     C                     MOVE *BLANKS   COLF
     C                     MOVE COLA      W#COLA
     C                     Z-ADD0         COLA
     C                     MOVE BJRDNB    LCD
     C                     MOVE 'A'       CHTP
     C                     MOVE 'Y'       WRPI
     C                     MOVE BCXR      W#BCXR 138
     C                     UPDATDEALSDCF
      *
     C           W#DLNO    CHAINDEALS                68
      *
     C           *IN68     IFEQ '0'
     C           *LOCK     IN   LDA
     C                     MOVELPKDN38    DBKEY
     C                     MOVE 'DEALS   'DBFILE           ***************
     C                     Z-ADD012       DBASE            *DB ERROR 012 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE *BLANKS   RBDN
     C                     MOVE 'Y'       COLF
     C                     MOVE W#COLA    COLA
     C                     MOVE W#DLNO    DLNO
     C                     MOVE W#VDAY    VDAT
     C                     MOVE W#MDAY    MDAT
     C                     MOVE W#BSRC    BRTT
     C                     MOVE W#SPRD    RTSP
     C                     MOVE W#MTTI    TOTI
     C                     MOVE W#BCXR    BCXR
     C                     MOVE W#VDAY    SLID
     C                     MOVE W#VDAY    IACD
     C                     MOVE PKDN38    RODN
     C                     MOVE W#PCPL    RODA
     C                     Z-ADD0         RBDA
     C                     Z-ADD0         AIPD
     C                     Z-ADD0         DLRC
     C                     Z-ADD0         AITC
     C                     Z-ADD0         AIAN
     C                     Z-ADD0         AIAP
     C                     Z-ADD0         IPRD
     C                     Z-ADD0         IPRM
     C                     Z-ADD0         ICTD
     C                     Z-ADD0         DAVD
     C                     Z-ADD0         DASN
     C                     Z-ADD0         TAXD
     C                     Z-ADD0         TAXM
     C                     Z-ADD0         LSWC
     C                     Z-ADD0         LSWS
     C                     Z-ADD0         FXRD
     C                     Z-ADD0         TCOF
     C                     Z-ADD0         ACPD
     C                     Z-ADD0         ACDA
     C                     Z-ADD0         ACAP
     C                     Z-ADD0         ACAN
     C                     Z-ADD0         COFD
     C                     Z-ADD0         COFM
     C                     Z-ADD0         CFCD
      *
      ** Initialise Bits for non-static indicators
      *
     C                     BITOF'01234567'CNFI
     C                     BITOF'01234567'ACEI
     C                     BITOF'01234567'TLXI
     C                     BITOF'01234567'DNSI
      *
      ** Non-static Bit = Total Interest Override
      *
     C           BRTT      IFEQ 0
     C           DTYP      OREQ 'CD'
     C           DTYP      OREQ 'ID'
     C           JFLID     OREQ 'Y'
     C                     BITON'2'       DNSI
     C                     ENDIF
      *
      ** Non-static Bit = Loan
      *
     C           DTYP      IFNE 'IT'
     C           DTYP      ORNE 'TD'
     C           DTYP      ORNE 'CD'
     C           DTYP      ORNE 'CI'
     C           DTYP      ORNE 'ID'
     C                     BITON'0'       DNSI
     C                     ENDIF
      *
     C           JFLID     IFEQ 'Y'
     C                     EXSR SRL1DY
     C                     EXSR SRDYFN
     C                     ENDIF
      *
     C                     MOVE BJRDNB    ORED
     C                     MOVE BJRDNB    LCD
     C                     MOVE 'I'       CHTP
     C                     MOVE 5350      TNLU
      *                                                                                       CRE073
      ** New interest rate rounding fields should reflect on the new deal                     CRE073
      ** if CRE073 is switched ON, othewise, the fields will not be populated                 CRE073
      *                                                                                       CRE073
     C           CRE073    IFNE 'Y'                                                           CRE073
     C                     Z-ADD0         CNSP                                                CRE073
     C                     MOVE *BLANK    RDMT                                                CRE073
     C                     MOVE *BLANK    RDFD                                                CRE073
     C                     ENDIF                                                              CRE073
      *
     C                     WRITEDEALSDCF
      *                                                                                      BUG3738
      ** Set values for extension file                                                       BUG3738
      *                                                                                      BUG3738
     C                     MOVE PKDN38    DLNODC  6                                          BUG3738
     C           DLNODC    CHAINDLDLDCEX             20                                      BUG3738
      *                                                                                      BUG3738
     C           *IN20     IFEQ '1'                                                          BUG3738
     C           *LOCK     IN   LDA                                                          BUG3738
     C                     MOVE DLNODC    DBKEY                                              BUG3738
     C                     MOVE 'DLDLDLEX'DBPGM                                              BUG3738
     C                     Z-ADD16        DBASE                                              BUG3738
     C                     OUT  LDA                                                          BUG3738
     C                     EXSR *PSSR                                                        BUG3738
     C                     ENDIF                                                             BUG3738
      *                                                                                      BUG3738
     C                     MOVE W#DLNO    F1DLNO                                             BUG3738
     C                     Z-ADD0         F1TEXO                                             BUG3738
     C                     Z-ADD0         F1TEOF                                             BUG3738
     C                     Z-ADD0         F1TEOC                                             BUG3738
      *                                                                                      BUG3738
     C                     WRITEDLDLDCD0                                                     BUG3738
      *                                                                                      BUG3738
      *
      ** Set Pay/Receive Indicator to be written to DTRIX
      *
     C                     EXSR SRPYRC
      *
      ** Write a Dtrix Record
      *
     C                     EXSR SRWRTD
      *
      ** Update Dtrix Header
      *
     C                     EXSR SRUPDD
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRPYRC  -  Determine Pay/Receive Indicators                  *
      *  Called By: SRDLUP                                            *
      *  Calls    : SRTLXD                                            *
      *                                                               *
      *****************************************************************
      *
     C           SRPYRC    BEGSR
      *
      ** Initialise fields
      *
     C                     Z-ADD0         W#PRI1  10
     C                     Z-ADD0         W#PRI2  10
     C                     Z-ADD0         W#PRI3  10
     C                     MOVE *BLANKS   W#LOLC  1
     C                     MOVE *BLANKS   W#NOST  2
      *
      ** Pay/Receive Indicator 1 = Value Date
      *
      ** Determine if local or deal currency to be used in holiday checking
      *
     C                     MOVE 'L'       W#LOLC
     C                     MOVE *BLANKS   W#NOST
      *
     C           DTYP      IFEQ 'IT'
     C           DTYP      OREQ 'TD'
     C           DTYP      OREQ 'CD'
      *
     C           RSTM      IFEQ 01
     C           RSTM      OREQ 07
     C           RSTM      OREQ 08
     C                     MOVE 'D'       W#LOLC
     C                     MOVELRONS      W#NOST
     C                     ENDIF
      *
     C                     ELSE
      *
     C           PSTM      IFEQ 01
     C           PSTM      OREQ 07
     C           PSTM      OREQ 08
     C                     MOVE 'D'       W#LOLC
     C                     MOVELPONS      W#NOST
     C                     ENDIF
     C                     ENDIF
      *
     C                     EXSR SRTLXD
      *
      ** Set PRI1 if value date is within telex notice period
      *
     C           VDAT      IFGE BJRDNB
     C           VDAT      ANDLEW#TLXD
     C                     Z-ADD1         W#PRI1
     C                     ENDIF
      *
      ** Pay/Receive Indicator 2 = Interest Pay Date
      *
      ** Determine if local or deal currency to be used in holiday checking
      *
     C                     MOVE 'L'       W#LOLC
     C                     MOVE *BLANKS   W#NOST
      *
     C           DTYP      IFEQ 'IT'
     C           DTYP      OREQ 'TD'
     C           DTYP      OREQ 'CD'
      *
     C           PSTM      IFEQ 01
     C           PSTM      OREQ 07
     C           PSTM      OREQ 08
     C                     MOVE 'D'       W#LOLC
     C                     MOVELPONS      W#NOST
     C                     ENDIF
      *
     C                     ELSE
      *
     C           RSTM      IFEQ 01
     C           RSTM      OREQ 07
     C           RSTM      OREQ 08
     C                     MOVE 'D'       W#LOLC
     C                     MOVELRONS      W#NOST
     C                     ENDIF
     C                     ENDIF
      *
     C                     EXSR SRTLXD
      *
      ** Set PRI2 if interest pay date is within telex notice period
      *
     C           NIDT      IFNE 0
     C           NIDT      ANDGEBJRDNB
     C           NIDT      ANDLEW#TLXD
     C                     Z-ADD1         W#PRI2
     C                     ENDIF
      *
      ** Pay/Receive Indicator 3 = Maturity Date
      *
      ** Determine if local or deal currency to be used in holiday checking
      *
     C                     MOVE 'L'       W#LOLC
     C                     MOVE *BLANKS   W#NOST
      *
     C           DTYP      IFEQ 'IT'
     C           DTYP      OREQ 'TD'
     C           DTYP      OREQ 'CD'
      *
     C           PSTM      IFEQ 01
     C           PSTM      OREQ 07
     C           PSTM      OREQ 08
     C                     MOVE 'D'       W#LOLC
     C                     MOVELPONS      W#NOST
     C                     ENDIF
      *
     C                     ELSE
      *
     C           RSTM      IFEQ 01
     C           RSTM      OREQ 07
     C           RSTM      OREQ 08
     C                     MOVE 'D'       W#LOLC
     C                     MOVELRONS      W#NOST
     C                     ENDIF
     C                     ENDIF
      *
     C                     EXSR SRTLXD
      *
      ** Set PRI3 if maturity date is within telex notice period
      *
     C           MDAT      IFGE BJRDNB
     C           MDAT      ANDLEW#TLXD
     C           DTYP      ANDNE'IL'
     C           DTYP      ANDNE'ID'
      *
     C           AURO      IFNE 'Y'
     C           AURO      OREQ 'Y'
     C           RBDN      ANDNE0
     C                     Z-ADD1         W#PRI3
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRTLXD  -  Determine Telex Due Date                          *
      *  Called By: SRPYRC                                            *
      *  Calls    : AOCURRR0 - Access Currency Details                *
      *             SRNOST, ZF2C                                      *
      *                                                               *
      *****************************************************************
      *
     C           SRTLXD    BEGSR
      *
      ** Initialise fields
      *
     C                     Z-ADD0         W#TLXD  50
     C                     MOVE *BLANKS   W#CCY   3
      *
     C           STCY      IFNE *BLANKS
     C                     MOVELSTCY      W#CCY
     C                     ELSE
     C                     MOVELCCY       W#CCY
     C                     ENDIF
      *
      ** Access currency details using deal currency to get telex
      ** notice days for deal currency
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY    'WOPTN
     C                     PARM W#CCY     WCCY    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     Z-ADD0         W#TNOD
     C                     ELSE
     C                     Z-ADDA6TXND    W#TNOD  20
     C                     ENDIF
      *
      ** Access currency details using local currency to get telex
      ** notice days for local currency
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY    'WOPTN
     C                     PARM BJLCCY    WCCY
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     Z-ADD0         W#TNOL
     C                     ELSE
     C                     Z-ADDA6TXND    W#TNOL  20
     C                     ENDIF
      *
      ** Deal Currency applies
      *
     C           W#LOLC    IFEQ 'D'
     C           BJDNWD    SUB  1         ZDAYNO
     C                     MOVE W#CCY     ZCCY1
     C                     EXSR SRNOST
     C                     Z-ADDW#TNOD    ZNRDYS
      *
      ** Local Currency applies
      *
     C                     ELSE
     C           BJDNWD    SUB  1         ZDAYNO
     C                     MOVE BJLCCY    ZCCY1
     C                     MOVE BJSLCD    ZLOC1
     C                     Z-ADDW#TNOL    ZNRDYS
     C                     ENDIF
      *
      ** Execute common routine to calculate telex due date
      *
     C                     MOVE BJLCCY    ZCCY2
     C                     MOVE BJSLCD    ZLOC2
     C                     Z-ADDZDAYNO    ZDYNBR
     C                     EXSR ZF2C
     C                     Z-ADDZDYNBR    W#TLXD
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRNOST  -  Determine Nostro Location                         *
      *  Called By: SRTLXD                                            *
      *  Calls    : AONOSTR0 - Access Nostro Details                  *
      *                                                               *
      *****************************************************************
      *
     C           SRNOST    BEGSR
      *
     C                     CALL 'AONOSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY    'WOPTN
     C                     PARM *BLANKS   WCUST   6
     C                     PARM ZCCY1     WCCY
     C**********           PARM *BLANKS   WACCD   4                                           CGL029
     C                     PARM *BLANKS   WACCD  10                                           CGL029
     C                     PARM *BLANKS   WACSN   2
     C                     PARM W#NOST    WNONB   2
     C                     PARM *BLANKS   WBRCD   3
     C                     PARM *BLANKS   WCSSN  10
     C                     PARM *BLANKS   WPNOI   1
     C           SDNOST    PARM SDNOST    DSFDY
      *
      ** If No Record found, ZLOC1 is blank
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVE *BLANKS   ZLOC1
     C                     ELSE
      *
      ** Else, move Location (Last 3 characters of Shortname) into ZLOC1
      *
     C                     MOVE A7NOSN    ZLOC1
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRWRTD  -  Write a DTRIX Record                              *
      *  Called By: SRDLUP                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRWRTD    BEGSR
      *
      ** Set fields on record to be written to DTRIXDD
      *
     C                     MOVE 'D'       DXRECI
     C                     MOVE 'D'       DXRCDT
     C                     Z-ADDDLNO      DXDLNO
     C                     Z-ADD0         DXVDAT
     C                     Z-ADD0         DXDASN
     C                     MOVE CHTP      DXCHTP
     C                     MOVE 'N'       DXCNRQ
     C                     MOVE 'N'       DXCNPR
     C                     MOVE *BLANKS   DXREPR
     C                     TIME           WXTIME  60
     C                     MOVELWXTIME    DXTIME
     C                     MOVE W#PRI1    DXPRI1
     C                     MOVE W#PRI2    DXPRI2
     C                     MOVE W#PRI3    DXPRI3
     C                     Z-ADD0         DXICIN
     C                     MOVELBRCA      DXBRCA
     C                     Z-ADD0         DXTNLU
      *
     C                     WRITEDTRIXDF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRUPDD  -  Update the DTRIX Header Record                    *
      *  Called By: SRDLUP                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRUPDD    BEGSR
      *
      ** Access the header record
      *
     C                     Z-ADD0         DXDLNO
     C           DXDLNO    CHAINDTRIXHF              61
      *
      ** Database Error
      *
     C           *IN61     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVELDXDLNO    DBKEY
     C                     MOVE 'DTRIXHF 'DBFILE           ***************
     C                     Z-ADD013       DBASE            *DB ERROR 013 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Add 1 to number of deal records
      *
     C                     ADD  1         DXNDLR
      *
     C                     UPDATDTRIXHF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRL1DY  -  Calculate 1 Day Interest for Front Up Interest    *
      *  Called By: SRDLUP                                            *
      *  Calls    : MM1030                                            *
      *                                                               *
      *****************************************************************
      *
     C           SRL1DY    BEGSR
      *
      ** Set Value Date as Start Date and Maturity Date as End Date
      *
     C                     Z-ADDVDAT      ZZBEG
     C                     Z-ADDMDAT      ZZEND
      *
      ** Principal, Rate, Calculation Method, Round Down Interest
      *
     C           PCPL      IFLT 0
     C                     Z-SUBPCPL      @@AMT
     C                     ELSE
     C                     Z-ADDPCPL      @@AMT  150
     C                     ENDIF
      *
     C                     Z-ADDINTR      @@RATE 117
     C                     MOVELICBS      ZZCALC  1
     C                     MOVELJRDFC     @@RDFC  1
      *
     C                     EXSR MM1030
      *
      ** Calculate Interest from Value Date to Maturity Date
      *
     C                     Z-SUB@@INTR    AIAN
      *
      ** Calculate Interest from Value Date to Maturity Date + 1
      *
     C                     ADD  1         ZZEND
      *
     C                     EXSR MM1030
      *
     C                     ADD  @@INTR    AIAN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRDYFN  -  Calculate 1 Day Funding for Front Up Interest     *
      *  Called By: SRDLUP                                            *
      *  Calls    : MM1030                                            *
      *                                                               *
      *****************************************************************
      *
     C           SRDYFN    BEGSR
      *
      ** Set Value Date as Start Date and Maturity Date as End Date
      *
     C                     Z-ADDVDAT      ZZBEG
     C                     Z-ADDMDAT      ZZEND
      *
      ** Principal, Rate, Calculation Method, Round Down Interest
      *
     C           PCPL      IFLT 0
     C                     Z-SUBPCPL      @@AMT
     C                     ELSE
     C                     Z-ADDPCPL      @@AMT  150
     C                     ENDIF
      *
     C                     SELEC
     C           FSGN      WHEQ *BLANKS
     C                     Z-ADDFSRP      @@RATE
     C           FSGN      WHEQ '+'
     C           INTR      ADD  FSRP      @@RATE
     C           FSGN      WHEQ '-'
     C           INTR      SUB  FSRP      @@RATE
     C                     ENDSL
      *
     C                     MOVELICBS      ZZCALC
     C                     MOVELJRDFC     @@RDFC
      *
     C                     EXSR MM1030
      *
      ** Calculate Interest from Value Date to Maturity Date
      *
     C                     Z-SUB@@INTR    ACAN
      *
      ** Calculate Interest from Value Date to Maturity Date + 1
      *
     C                     ADD  1         ZZEND
      *
     C                     EXSR MM1030
      *
     C                     ADD  @@INTR    ACAN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCOLL  -  Collateral Details Update Processing              *
      *  Called By: SRPROC                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRCOLL    BEGSR
      *
     C           *LOVAL    SETLLGLCOLLL1
     C                     READ GLCOLLL1                 70
      *
     C           *IN70     DOWEQ'0'
      *
     C           CDCOPT    IFEQ 'D'
     C                     Z-ADD1         X
     C                     MOVE CDDEAL    W#DEAL  6
     C           W#DEAL    LOKUPDEAL,X                   50
      *
     C           *IN50     IFEQ '1'
     C           X         OCUR MULT
     C                     MOVE TDEAL     CDDEAL
     C                     UPDATGLCOLLD0
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     READ GLCOLLL1                 70
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRTRAI  -  Trailers Update Processing                        *
      *  Called By: SRPROC                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRTRAI    BEGSR
      *
     C                     Z-ADD1         X
     C                     Z-ADD1         Y       30
     C                     Z-ADD0         W#TOTL
      *
     C           *BLANKS   LOKUPDEAL,X                   50
      *
      ** Sum all elements of the array holding the Principal Amounts
      *
     C           Y         DOWLEX
     C           Y         OCUR MULT
     C                     ADD  TAMNP     W#TOTL
     C                     ADD  1         Y
     C                     ENDDO
      *
     C                     READ MMTTOTPP                 71
      *
     C           *IN71     IFEQ '0'
     C                     Z-ADDINNORE    RNORE
     C                     ADD  X         INNORE
     C                     SUB  1         INNORE
     C                     Z-ADDINNORE    RNTOT
     C                     ADD  X         INNINS
     C                     SUB  1         INNINS
     C                     Z-ADDX         RNINS
     C                     SUB  1         RNINS
     C                     UPDATMMTTOTP0
     C                     ELSE
     C           *LOCK     IN   LDA
     C                     MOVEL'*FIRST  'DBKEY
     C                     MOVE 'MMTTOTPP'DBFILE           ***************
     C                     Z-ADD014       DBASE            *DB ERROR 014 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     READ DEALSDF                  72
      *
     C           *IN72     IFEQ '0'
     C                     Z-ADDNORE      RNORED
     C                     Z-ADDVLAF      RVLBF
     C                     Z-ADDVLAL      RVLBL
     C                     Z-ADDX         RNINSD
     C                     SUB  1         RNINSD
     C                     Z-ADDW#TOTN    RVRIF
     C                     Z-ADDW#TOTD    RVRIL
     C                     ADD  X         NORE
     C                     SUB  1         NORE
     C                     Z-ADDNORE      RNLRA
     C                     ADD  X         NINS
     C                     SUB  1         NINS
     C                     ADD  X         NLRA
     C                     SUB  1         NLRA
     C                     ADD  W#TOTN    VRIF
     C**********           ADD  W#TOTD    VRIL                                                243068
      *                                                                                      BUG8231
      ** CHECK FOR CARRY OVER (OVERFLOW).                                                    BUG8231
      *                                                                                      BUG8231
     C                     Z-ADD0         @TOTDO                                             BUG8231
     C           W#TOTD    ADD  VRIL      @TOTDO  40                                         BUG8231
     C                     ADD  W#TOTD    VRIL                                                243068
      *                                                                                       243068
     C           @TOTDO    IFGT 999                                                          BUG8231
     C                     ADD  1         VRIF                                               BUG8231
     C                     ENDIF                                                             BUG8231
      *                                                                                      BUG8231
     C                     ADD  W#TOTN    VLAF
     C**********           ADD  W#TOTD    VLAL                                                243068
      *                                                                                      BUG8231
      ** CHECK FOR CARRY OVER (OVERFLOW).                                                    BUG8231
      *                                                                                      BUG8231
     C                     Z-ADD0         @TOTDO                                             BUG8231
     C           W#TOTD    ADD  VLAL      @TOTDO  40                                         BUG8231
     C                     ADD  W#TOTD    VLAL                                                243068
      *                                                                                       243068
     C           @TOTDO    IFGT 999                                                          BUG8231
     C                     ADD  1         VLAF                                               BUG8231
     C                     ENDIF                                                             BUG8231
      *                                                                                      BUG8231
     C                     Z-ADDVLAF      RVLAF
     C                     Z-ADDVLAL      RVLAL
     C                     UPDATDEALSDFF
     C                     ELSE
     C           *LOCK     IN   LDA
     C                     MOVEL'*FIRST  'DBKEY
     C                     MOVE 'DEALSDF 'DBFILE           ***************
     C                     Z-ADD015       DBASE            *DB ERROR 015 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  MM1030  -  Calculate Interest                                *
      *  Called By: SRL1DY, SRDYFN                                    *
      *  Calls    : ZINTDY                                            *
      *                                                               *
      *****************************************************************
      *
     C           MM1030    BEGSR
      *
     C                     Z-ADDZZBEG     ZZBEG9  50                                          CDL093
     C                     Z-ADDZZEND     ZZEND9  50                                          CDL093
      ** Calculate Number of Interest Days
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
      *                                                                                       CDL093
      ** Convert start date to YYYYMMDD format                                                CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZBEG9    @@DAYN  50                                          CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATA  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY1   40                                          CDL093
      *                                                                                       CDL093
      ** Convert end date to YYYYMMDD format                                                  CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZEND9    @@DAYN                                              CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATB  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY2   40                                          CDL093
      *                                                                                       CDL093
     C                     EXSR #FEB29                                                        CDL093
     C                     ENDIF                                                              CDL093
      *
     C           ZZCALC    IFEQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           PKNIPD    ANDNE*ZERO                                                         CDL093
     C           PKNIPD    ANDLTZZEND                                                         CDL093
      *                                                                                       CDL093
     C                     Z-ADDPKIPDM    @@IPDM  20                                          CDL093
     C                     CALL 'MM001031'                                                    CDL093
     C                     PARM           ZZBEG                                               CDL093
     C                     PARM           ZZEND                                               CDL093
     C                     PARM           PKNIPD                                              CDL093
     C                     PARM '9'       ZZCALC                                              CDL093
     C                     PARM           PKIPFQ                                              CDL093
     C                     PARM           @@AMT                                               CDL093
     C                     PARM           @@RATE                                              CDL093
     C                     PARM 'N'       RNDDWN  1                                           CDL093
     C                     PARM 'N'       FRSLST  1                                           CDL093
     C                     PARM           @@IPDM                                              CDL093
     C                     PARM           WINTR                                               CDL093
      *                                                                                       CDL093
     C                     Z-ADDWINTR     @@INTR                                              CDL093
     C           *LIKE     DEFN @@INTR    WINTR                                               CDL093
      *                                                                                       CDL093
     C                     GOTO INTCLC                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C                     EXSR ZINTDY
      *
     C           ZZCALC    IFEQ '2'
     C           ZZCALC    OREQ '3'
     C           ZZCALC    OREQ '5'
     C           ZZCALC    OREQ '0'                                                          CER016A
     C                     Z-ADD36000     @@YEAR  50
     C                     ENDIF
      *
     C           ZZCALC    IFEQ '1'
     C           ZZCALC    OREQ '4'
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDNE'Y'                                                           CDL093
     C                     Z-ADD36500     @@YEAR
     C                     ENDIF
      *
     C           ZZCALC    IFEQ '6'
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C                     Z-ADD36600     @@YEAR
     C                     ENDIF
      *
     C           ZZCALC    IFEQ '6'
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           INT6DY    MULT @@RATE    @@W157
     C                     ELSE
      *
     C           ZZINDY    MULT @@RATE    @@W157 157
      *
     C                     ENDIF
      *
     C           @@W157    MULT @@AMT     @@W210 210H
      *
      ** Round Down if Round Down Indicator is 'Y'
      *
     C           @@RDFC    IFEQ 'Y'
     C           @@W210    DIV  @@YEAR    @@INTR
     C                     ELSE
     C           @@W210    DIV  @@YEAR    @@INTR 150H
     C                     ENDIF
      *                                                                                       CDL093
      * Interest has been calculated                                                          CDL093
     C           INTCLC    TAG                                                                CDL093
      *
     C           M10309    ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  ZFRQA   -  Increment a Day Number Date by a Period Value     *
      *  Called By: SRMDAT                                            *
      *  Calls    : ZDATE1, ZDATE2, ZCHKH                             *
      *                                                               *
      *****************************************************************
      *
     C           ZFRQA     BEGSR
      *
      ** Calculations to Define/Clear Fields
      *
     C                     MOVE ZFREQ     ZFREQ   1
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C                     Z-ADDZMDAY     ZMDAY   20
     C                     MOVE ZCCY      ZCCY    3
      *
     C                     MOVE '   '     ZHC
     C                     EXSR ZDATE2
      *
      ** Check for and Increment for Code D-DAILY-WORKING DAY
      *
     C           ZFREQ     IFEQ 'D'
     C           ZDAYNO    ADD  1         ZDAYNO
     C                     GOTO ZFHCHK
     C                     ENDIF
      *
      ** Check for and Increment for Code W-WEEKLY
      *
     C           ZFREQ     IFEQ 'W'
     C           ZDAYNO    ADD  7         ZDAYNO
     C                     GOTO ZFEND
     C                     ENDIF
      *
      ** Check for and Increment for Code F-FORTNIGHTLY
      *
     C           ZFREQ     IFEQ 'F'
     C           ZDAYNO    ADD  14        ZDAYNO
     C                     GOTO ZFEND
     C                     ENDIF
      *
      ** Check for and Increment for Code S-SEMI-MONTHLY
      *
     C           ZFREQ     IFEQ 'S'
     C           ZDAY      IFLE 15
     C                     Z-ADD31        ZDAY
     C                     ELSE
     C                     Z-ADD15        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     ENDIF
     C                     ENDIF
      *
      ** Check for and Increment for Code M-MONTHLY
      *
     C           ZFREQ     IFEQ 'M'
     C                     Z-ADDZMDAY     ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code R-SIX Days before end of month
      *
     C           ZFREQ     IFEQ 'R'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code T-BIMONTHLY
      *
     C           ZFREQ     IFEQ 'T'
     C                     Z-ADDZMDAY     ZDAY
     C           ZMTH      ADD  2         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code Q-QUARTERLY
      *
     C           ZFREQ     IFEQ 'Q'
     C                     Z-ADDZMDAY     ZDAY
     C           ZMTH      ADD  3         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code X-SIX MONTHLY
      *
     C           ZFREQ     IFEQ 'X'
     C                     Z-ADDZMDAY     ZDAY
     C           ZMTH      ADD  6         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code Y-YEARLY
      *
     C           ZFREQ     IFEQ 'Y'
     C                     Z-ADDZMDAY     ZDAY
     C           ZYEAR     ADD  1         ZYEAR
     C                     ENDIF
      *
      ** Check for and Increment for Code L-LAST CALENDAR DAY OF MONTH
      *
     C           ZFREQ     IFEQ 'L'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code B-LAST WORKING DAY OF MONTH
      *
     C           ZFREQ     IFEQ 'B'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code P-PENULT. WORK/DAY OF MONTH
      *
     C           ZFREQ     IFEQ 'P'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  1         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code K-PENULT. WORK/DAY OF QUARTER
      *
     C           ZFREQ     IFEQ 'K'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  3         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code H-PENULT. WORK/DAY OF HLF YR
      *
     C           ZFREQ     IFEQ 'H'
     C                     Z-ADD31        ZDAY
     C           ZMTH      ADD  6         ZMTH
     C                     ENDIF
      *
      ** Check for and Increment for Code G-PENULT. WORK/DAY OF YEAR
      *
     C           ZFREQ     IFEQ 'G'
     C                     Z-ADD31        ZDAY
     C           ZYEAR     ADD  1         ZYEAR
     C                     ENDIF
      *
      ** Check for and Increment for Code A-MONTHLY ACCRUAL/PROFIT DATE
      *
     C           ZFREQ     IFEQ 'A'
     C                     Z-ADDBKAPDT    ZDAYNO
     C                     GOTO ZFEND
     C                     ENDIF
      *
      ** Reformat Date and ensure if valid
      *
      ** Validate Month
      *
     C           ZMTH      IFGT 12
     C           ZMTH      SUB  12        ZMTH
     C           ZYEAR     ADD  1         ZYEAR
     C                     ENDIF
      *
      ** Check for Leap Year
      *
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10
      *
      ** Validate Day Number
      *
     C                     MOVE ZFMD,ZMTH ZWRK2   20
     C           ZMTH      IFEQ 2
     C           ZLY       ANDEQ0
     C                     Z-ADD29        ZWRK2
     C                     ENDIF
      *
     C           ZDAY      IFGT ZWRK2
     C                     Z-ADDZWRK2     ZDAY
     C                     ENDIF
      *
      ** Check if Code R, to subtract 6 Days
      *
     C           ZFREQ     IFEQ 'R'
     C           ZDAY      SUB  6         ZDAY
     C                     ENDIF
      *
      ** Reformat Date, DDMMYY OR MMDDYY, and convert to Day Number
      *
     C                     MOVELZDAY      ZWRK4   40
     C                     MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C   98                MOVE ZDAY      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C                     EXSR ZDATE1
      *
      ** Reset Ind. 90 - Used to ensure subtraction for codes P,K,H,G,
      ** is only done once
      *
     C                     MOVE '0'       *IN90
      *
      ** Check if Code B, to be checked for Holiday
      *
     C           ZFREQ     COMP 'B'                      91
      *
      ** Codes P,K,H,G, also to be checked for holiday
      *
     C  N91      ZFREQ     COMP 'P'                      91
     C  N91      ZFREQ     COMP 'K'                      91
     C  N91      ZFREQ     COMP 'H'                      91
     C  N91      ZFREQ     COMP 'G'                      91
     C   91N99             GOTO ZFHCHK
      *
     C                     GOTO ZFEND
      *
      ** Check if Day Number is a Holiday
      *
     C           ZFHCHK    TAG
     C                     MOVE '0'       *IN94
      *
      ** Determine Code
      *
     C           ZFREQ     COMP 'D'                      91
     C           ZFREQ     COMP 'B'                      92
     C  N92      ZFREQ     COMP 'P'                      92
     C  N92      ZFREQ     COMP 'K'                      92
     C  N92      ZFREQ     COMP 'H'                      92
     C  N92      ZFREQ     COMP 'G'                      92
     C                     MOVE '   '     ZHC
      *
     C                     MOVE CCY       ZCCY
     C                     MOVE *BLANKS   ZLOC
     C                     EXSR ZCHKH
      *
     C           ZIND      IFEQ 'W'
     C                     GOTO ZPNCHK
     C                     ELSE
      *
     C           *IN91     IFEQ '1'
     C                     ADD  1         ZDAYNO
     C                     ENDIF
      *
     C           *IN92     IFEQ '1'
     C                     SUB  1         ZDAYNO
     C                     ENDIF
     C                     ENDIF
      *
     C                     GOTO ZFHCHK
      *
     C           ZPNCHK    TAG
      *
      ** For Codes requiring Penultimate Working Day (P,K,H,G) subtract
      ** one and check this for Holiday
      *
     C   90                GOTO ZFEND
      *
     C           ZFREQ     COMP 'P'                      92
     C  N92      ZFREQ     COMP 'K'                      92
     C  N92      ZFREQ     COMP 'H'                      92
     C  N92      ZFREQ     COMP 'G'                      92
     C  N92                GOTO ZFEND
     C           ZDAYNO    SUB  1         ZDAYNO
     C                     MOVE '1'       *IN90
     C                     GOTO ZFHCHK
      *
     C           ZFEND     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  ZA0710  -  Calculate Midas Day Number to DRS (YYYYMMDD)      *
      *  Called By: SRMDAT                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           ZA0710    BEGSR
      *
     C                     SETOF                     8081
     C                     Z-ADD0         @#RTN   10
     C                     Z-ADD0         @@VDT
     C                     Z-ADD1         @@I     20
     C                     Z-ADD1         @@J     20
     C                     Z-ADD1         @@LEAP  10
      *
     C           @@DAYN    CABEQ0         ZA0719
      *
     C           @@DAYN    IFLT 1
     C                     Z-ADD1         @#RTN
     C                     GOTO ZA0719
     C                     ENDIF
      *
      ** Division to Determine whether Leap Year
      *
     C           @@DAYN    DIV  1461      @@Z71Y
     C                     MVR            @@RDAY  50
      *
      ** Calculating Year
      *
     C           @@Z71Y    MULT 4         @@Z71Y
     C                     ADD  1972      @@Z71Y
      *
      ** Checking if Year is greater than or equal to 2100
      *
     C           @@Z71Y    IFGE 2100
     C                     ADD  @@SSY2    @@RDAY
     C                     ENDIF
      *
      ** Lokup Array @YD to see how many years of a Four Year Cycle
      ** have passed
      *
     C           @@RDAY    LOKUP@YD,@@I                8080
      *
      ** If year is a Leap Year, @@LEAP is set to zero
      *
     C           *IN80     IFEQ '0'
     C                     Z-ADD0         @@LEAP
     C                     ENDIF
      *
      ** Add Index to year to give correct year and adjust @@RDAY
      *
     C           @@LEAP    IFEQ 1
     C           @@RDAY    SUB  @YD,@@I   @@RDAY
     C                     ADD  @@I       @@Z71Y
     C                     ENDIF
      *
      ** Processing for a Leap Year
      *
     C           @@LEAP    IFEQ 0
      *
      ** IF @@RDAY = 60 Date must be 29TH OF February
      *
     C           @@RDAY    IFEQ 60
     C                     Z-ADD29        @@Z71D
     C                     Z-ADD2         @@Z71M
     C                     GOTO ZZ0711
     C                     ENDIF
      *
      ** If @@RDAY > 60 Date is after 29TH of February, conversion can
      ** proceed as usual after subtracting the extra day for the Leap
      ** Year. NOTE : @@RDAY < 60 conversion proceeds as usual
      *
     C           @@RDAY    IFGT 60
     C           @@RDAY    SUB  1         @@RDAY
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** If Day @@DAYN is exactly divisible by 1461 (Number of Days
      ** in 4 Years) then Date must be last day of previous four year
      ** group
      *
     C           @@RDAY    IFEQ 0
     C                     Z-ADD31        @@Z71D
     C                     Z-ADD12        @@Z71M
     C                     SUB  1         @@Z71Y
     C                     GOTO ZZ0711
     C                     ENDIF
      *
      ** Look up Array @MD to determine which month @@RDAY occurs
      *
     C           @@RDAY    LOKUP@MD,@@J                81
     C                     Z-ADD@@J       @@Z71M
     C           @@RDAY    SUB  @MD,@@J   @@Z71D
      *
      ** DS @@VDT is returned in YYYYMMDD Format
      *
     C           ZZ0711    TAG
      *
     C                     MOVE @@Z71Y    @@YR
      *
     C           ZA0719    ENDSR
      *
      /EJECT
      *****************************************************************                      BUG8360
     C           CHKHOL    BEGSR                           ** CHKHOL **                      BUG8360
      *                                                                                      BUG8360
      *  FIND FD CCY WORKING DATE                                                            BUG8360
     C                     MOVE PKCCY     ZCCY                                               BUG8360
     C                     MOVE W#MDAY    ZDAYNO                                             BUG8360
     C                     MOVE *BLANKS   ZLOC                                               BUG8360
     C                     Z-ADD0         ZNRDYS                                             BUG8360
     C                     EXSR ZFWDT                                                        BUG8360
     C                     MOVE ZDYNBR    FDWRKD  50       FD CCY WORK DAY                   BUG8360
      *                                                                                      BUG8360
      *  FIND LOCAL CCY WORKING DATE                                                         BUG8360
     C                     MOVE BJLCCY    ZCCY                                               BUG8360
     C                     MOVE W#MDAY    ZDAYNO                                             BUG8360
     C                     MOVE *BLANKS   ZLOC                                               BUG8360
     C                     Z-ADD0         ZNRDYS                                             BUG8360
     C                     EXSR ZFWDT                                                        BUG8360
     C                     MOVE ZDYNBR    LOWRKD  50       LOCY WORK DAY                     BUG8360
      **                                                                                     BUG8360
     C           LOWRKD    DOWNEFDWRKD                                                       BUG8360
      **                                                                                     BUG8360
     C           LOWRKD    IFGT FDWRKD                                                       BUG8360
     C                     MOVE PKCCY     ZCCY                                               BUG8360
     C           FDWRKD    ADD  1         ZDAYNO                                             BUG8360
     C                     MOVE *BLANKS   ZLOC                                               BUG8360
     C                     Z-ADD0         ZNRDYS                                             BUG8360
     C                     EXSR ZFWDT                                                        BUG8360
     C                     MOVE ZDYNBR    FDWRKD           FD CCY WORK DAY                   BUG8360
     C                     ELSE                                                              BUG8360
      **                                                                                     BUG8360
     C                     MOVE BJLCCY    ZCCY                                               BUG8360
     C           LOWRKD    ADD  1         ZDAYNO                                             BUG8360
     C                     MOVE *BLANKS   ZLOC                                               BUG8360
     C                     Z-ADD0         ZNRDYS                                             BUG8360
     C                     EXSR ZFWDT                                                        BUG8360
     C                     MOVE ZDYNBR    LOWRKD           LOCY WORK DAY                     BUG8360
     C                     END                                                               BUG8360
     C                     END                                                               BUG8360
     C                     MOVE LOWRKD    W#MDAY                                             BUG8360
     C                     ENDSR                                                             BUG8360
      /EJECT                                                                                 BUG8360
      *****************************************************************
      *                                                               *
      *  SR1END  -  Write End of Report                               *
      *  Called By: SRPROC                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SR1END    BEGSR
      *
      ** Check that sufficient lines remain for the Format. If not,
      ** write out the Main Headings on a new page.
      *
     C                     Z-ADD4         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     ENDIF
      *
      ** Write out Total Format
      *
     C                     WRITETRAILP1
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRAUDT  -  Output Audit Report and End Program               *
      *  Called By: Main Processing, *PSSR                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRAUDT    BEGSR
      *
      ** Output Report Header and File Controls.
      *
     C                     WRITEHEADAU
      *
      ** If there is a DB Error, Output the DB Error Information
      *
     C           *INU7     IFEQ '1'
     C                     WRITEDBERROR
     C                     ELSE
      *
      ** If no records read, Output "No Details" message
      *
     C           W#UPDT    IFNE 'Y'
     C                     WRITENODTLS
     C                     ELSE
     C                     WRITECONTROL
     C                     ENDIF
     C                     ENDIF
      *
      ** End Program and Return
      *
     C                     MOVE '1'       *INLR
     C                     RETRN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  *PSSR   -  Standard DB Error processing                      *
      *  Called By: SRINIT, SRREPT                                    *
      *  Calls    : SRAUDT                                            *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      ** Check to see that *PSSR has not already been called
      *
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
     C                     SETON                     U7U8
     C                     DUMP
     C                     EXSR SRAUDT
     C                     ROLBK                                                              240369
     C                     ENDIF
      *
      ** If *PSSR already run, then just end the program here
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCFP1  -  Register MM5350P1 via RCF                         *
      *  Called By: SRINIT                                            *
      *  Calls    : ZSFILE                                            *
      *                                                               *
      *****************************************************************
      *
     C           SRCFP1    BEGSR
      *
      ** Ensure Report Spool File recorded by RCF
      *
     C                     Z-ADDSFNUM1    ZSNUM   60
      *
     C                     CALL 'ZSFILE'
     C                     PARM *BLANKS   SEQ     5
     C                     PARM           SENTY   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
      ** If Error occurs during ZSFILE processing, then return to the
      ** Calling Program
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C           WFIRST    IFNE 'Y'
     C                     Z-ADDPRTLN1    STRTLN
     C                     MOVE 'Y'       WFIRST
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCFAU  -  Register MM5350AU via RCF                         *
      *  Called By: SRINIT                                            *
      *  Calls    : ZSFILE                                            *
      *                                                               *
      *****************************************************************
      *
     C           SRCFAU    BEGSR
      *
      ** Ensure Audit Spool File recorded by RCF
      *
     C                     Z-ADDSFNUMU    ZSNUMU  60
      *
     C                     CALL 'ZSFILE'
     C                     PARM *BLANKS   SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM *BLANK    ZSERR
      *
      ** If Error occurs during ZSFILE processing, then return to the
      ** Calling Program
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      /TITLE SR/ZDATE1
     C/COPY ZSRSRC,ZDATE1Z2
      /TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
      /TITLE SR/ZDATE9
     C/COPY ZSRSRC,ZDATE9Z3
     C/COPY ZSRSRC,ZFEB29                                                                     CDL093
      /TITLE SR/ZDAT10
     C/COPY ZSRSRC,ZDAT10Z2
      /TITLE SR/ZFRPED
     C/COPY ZSRSRC,ZFRPEDZ3
      **/TITLE*SR/ZINTPL*******************************************************               CAS001
     C**/C*PY*ZSRSRC,ZINTPLZ1**************************************************               CAS001
      /TITLE SR/ZACCH
     C/COPY ZSRSRC,ZACCH
      /TITLE SR/ZCHKH
     C/COPY ZSRSRC,ZCHKH
      /TITLE SR/ZF2C
     C/COPY ZSRSRC,ZF2C
      /TITLE SR/ZINTDY
     C/COPY ZSRSRC,ZINTDYZ2
     C/COPY ZSRSRC,ZFWDT                                                                     BUG8360
**  CPY@
(c) Finastra International Limited 2001
**   ZFMD - Number of Days in the Month
312831303130313130313031
**   ZYDY - Years in Days Cumulative, Four Year Span
0366073110961461
**   ZMDY - Months in Days Cumulative Through Year
000031059090120151181212243273304334365
**   ZMNM - Months Short Names
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDAT10 - Years, In Days, Cumulative in 4 Year Span
00366007310109601461
** @MD  USED BY SR. ZDAT10 - Months In Days, Cumulative Through Year
00000000310005900090001200015100181002120024300273003040033400365
