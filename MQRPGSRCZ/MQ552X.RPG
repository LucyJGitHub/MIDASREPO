     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MQ Subset RTALM extract program')                *
/*OVRF*: OVRDBF FILE(CLOANX) TOFILE(CLOAN) SHARE(*NO)               : *
/*OVRF*: OVRDBF FILE(DEALSX) TOFILE(DEALS) SHARE(*NO)               : *
/*OVRF*: OVRDBF FILE(TRANS4) MBR(*ALL)                              : *
/*OVRF*: OVRDBF FILE(POSTN4) MBR(*ALL)                              : *
     F*****************************************************************
     F*                                                               *
      *  Midas - Midas/Q Module                                       *
      *                                                               *
      *  MQ552X - Asset and Liability Subset File Extract             *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CDL096             Date 22Sep14               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183          Date 20Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CLE064             Date 06Dec10               *
      *                 AR746662           Date 03May11               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247517             Date 09May07               *
      *                 CPK027             Date 17Apr07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 241147A            Date 07Nov06               *
      *                 241147             Date 26Oct06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 29Sep06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CGL035             Date 01Mar05               *
      *                 237063             Date 20Nov05               *
      *                 CDL038             Date 10May05               *
      *                 CSE071             Date 19Jul05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 229857             Date 07Oct04               *
      *                 229544             Date 15Sep04               *
      *                 226570             Date 27Jun04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 215528             Date 21Mar03               *
      *                 207543             Date 17Jul02               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun02               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 23May01               *
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 180198             Date 14Jun00               *
      *                 140272             Date 25Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CPL002             Date 08Mar99               *
     F*                 CSD005             Date 02Mar99               *
     F*                 130862             Date 18Oct98               *
     F*                 CFF004             Date 18Sep96               *
     F*                 092961             Date 04Oct95               *
     F*                 066309             DATE 27APR94               *
     F*                 055310             DATE 26APR94               *
     F*                 055237             DATE 26APR94               *
     F*                 S01453             DATE 12OCT93               *
     F*                 S01411             Date 18JUN93               *
     F*                 039495             Date 17JUN93               *
     F*                                                               *
      *****************************************************************
      *                                                               *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  AR746662 - Discrepancy in premium amount in Currency OTC     *
      *             screen and Projected Available Balance Enquiry    *
      *             Applied fix 249171. (Recompile)                   *
      *             (Child: Artf746663)                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CPK027 - Errors in compiling MP1_3_TTTS - recompile over     *
      *           changed FFTVCLZ2.                                   *
      *  241147A - Recompile.                                         *
      *  241147 - Recompile.                                          *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CGL035 - EUSD Upgrade to Midasplus                           *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  215528 - System is associating a wrong premium amount.       *
      *           Recompiled only.                                    *
      *           - Rename new field CRSK on TRADS.                   *
      *           - Rename new field CRSK on HSTTRD.                  *
      *  207543 - CEU018 NOT WORKING ON A PRICE BASIS, MISSING A PART *
      *           OF AUS047. CHECK FOR CEU017, RECOMPILE OVER ZYLDZ2. *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changes in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed FFYTOPZ1 and ZYLDZ2.         *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
     F*  180198 - Include matured and historic loans and deals. Also, *
     F*           Original Borrower only extracted for Parts Sold.    *
     F*           Extract Original Borrower for Parts Purchased also. *
     F*  140272 - Recompiled over changed ZYLDZ2                      *
     F*  CPL002 - Midas-Plato Interface.                              *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  CFF004 - Increase in size of Price Fields                    *
     F*  092961 - Recompile over ZDAYSZ2 for 086491                   *
     F*           Wrong number of days calculated for day basis 1     *
     F*           when start or end day is last day of February.      *
     F*  066309 - Include Deal Types 'ID' and 'IL.'                   *
     F*                                                               *
     F*  055310 - All arrays defined as number 150 extended to        *
     F*           999 to cater for larger no. of records in files     *
     F*                                                               *
     F*  055237 - *DBERR causes COB failure, results in access        *
     F*           object calling DBERRCTL which should just be        *
     F*           for input cycle.                                    *
     F*                                                               *
     F*  S01453 - Margin/Fwd Points .V. DL Base on FX Input.          *
     F*           New fields added to PF/DEALSDB to be included       *
     F*           in RTALM subset. Class 1 enhancement.               *
     F*  S01411 - RECOMPILED BECAUSE 'ORIGINAL ENTRY DATE' HAS BEEN   *
     F*           ADDED TO TRANSD.                                    *
     F*  039495 - New /COPY subroutine ZCALCD added (called from      *
     F*           sr. ZYLD)                                           *
     F*         - /COPY subroutine ZACCZZ1 added (called from         *
     F*           sr. ZYLD and ZCALCD)                                *
     F*         - /COPY subroutines ZACCRZ1 and ZRATEZ1 added (called *
     F*           from sr. ZACCZ)                                     *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FACCNR   IF  E           K        DISK         KINFSR *PSSR      UC
     FBKPHD   IF  E           K        DISK         KINFSR *PSSR      UC
     FBKPOS   IF  E           K        DISK         KINFSR *PSSR      UC
     FCLOANCL IF  E                    DISK         KINFSR *PSSR      UC
     FCLOANX  IF  E           K        DISK         KINFSR *PSSR      UC
     F            CLOANCLF                          KRENAMECLOANCXF
     F            CLOANHHF                          KIGNORE
     F            CLOANCKF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
     FCPOSS   IF  E           K        DISK         KINFSR *PSSR      UC
     FDEALSDB IF  E                    DISK         KINFSR *PSSR      UC
     F/COPY WNCPYSRC,MQ552XF002
     FDEALSDC IF  E                    DISK         KINFSR *PSSR      UC
     FDEALSDD IF  E                    DISK         KINFSR *PSSR      UC
     FDEALSDE IF  E                    DISK         KINFSR *PSSR      UC
     FDEALSDG IF  E                    DISK         KINFSR *PSSR      UC
     FDEALSX  IF  E           K        DISK         KINFSR *PSSR      UC
     F            DEALSDBF                          KRENAMEDEALSBXF
     F            DEALSDAF                          KIGNORE
     F            DEALSDCF                          KIGNORE
     F            DEALSDDF                          KIGNORE
     F            DEALSDEF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     F            DEALSDGF                          KIGNORE
     FDLBHISPDIF  E                    DISK         KINFSR *PSSR      UC  180198
     FDLCHISPDIF  E                    DISK         KINFSR *PSSR      UC  180198
     FDLDHISPDIF  E                    DISK         KINFSR *PSSR      UC  180198
     FDLEHISPDIF  E                    DISK         KINFSR *PSSR      UC  180198
     FDLGHISPDIF  E                    DISK         KINFSR *PSSR      UC  180198
     FMCLONCL IF  E                    DISK         KINFSR *PSSR      UC  180198
     F            CLOANCLF                          KRENAMEMCLONCLF       180198
     FFCLTY   IF  E           K        DISK         KINFSR *PSSR      UC
     F            FCLTYHHF                          KIGNORE
     F            FCLTYZZF                          KIGNORE
     FFOPCC   IF  E           K        DISK         KINFSR *PSSR      UC
     FFOPCK   IF  E           K        DISK         KINFSR *PSSR      UC
     FGTEESGT IF  E                    DISK         KINFSR *PSSR      UC
     FINTYP   IF  E           K        DISK         KINFSR *PSSR      UC
     FINVTP   IF  E           K        DISK         KINFSR *PSSR      UC
     FMARKT   IF  E           K        DISK         KINFSR *PSSR      UC
     FPOSTN4  IF  E           K        DISK         KINFSR *PSSR      UC
     FPRICS1  IF  E           K        DISK         KINFSR *PSSR      UC
     FPRISP1  IF  E           K        DISK         KINFSR *PSSR      UC
     FREACR   IF  E           K        DISK         KINFSR *PSSR      UC
     F            REACRAF                           KIGNORE
     F            REACRZF                           KIGNORE
     FSDCURRPDIF  E                    DISK         KINFSR *PSSR      UC
     FSDFACTPDIF  E                    DISK         KINFSR *PSSR      UC
     FSDLOANPDIF  E                    DISK         KINFSR *PSSR      UC
     FSECEO   IF  E           K        DISK         KINFSR *PSSR      UC  039495
     F            SEDEVDF                           KRENAMESEDEVDO        039495
     F            SNDEVDF                           KRENAMESNDEVDO        039495
     FSECTY   IF  E           K        DISK         KINFSR *PSSR      UC
     FSEDEL   IF  E           K        DISK         KINFSR *PSSR      UC
     FSEPCBD  IF  E           K        DISK         KINFSR *PSSR      UC
     FSEPCCD  IF  E           K        DISK         KINFSR *PSSR      UC
     F*TRADSR*IF**E           K        DISK         KINFSR *PSSR      UC  180198
     FTRADSH  IF  E           K        DISK         KINFSR *PSSR      UC  180198
     FTRANS4  IF  E           K        DISK         KINFSR *PSSR      UC
     FMQALM   O   E                    DISK
     F/COPY WNCPYSRC,MQ552XF001
      /EJECT
     F********************************************************************
     F*                                                                  *
     F* SUBROUTINES                                                      *
     F*                                                                  *
     F*    CCYARR - SET UP CURRENCY ARRAYS                               *
     F*    CCYDEP - ACCESS CURRENCY DETAILS                              *
     F*    FACARR - SET UP FACILITY TYPES ARRAYS                         *
     F*    FACILY - PROCESS FACILITIES                                   *
     F*    FACNAM - ACCESS FACILITY NAME                                 *
     F*    FFBCPN - PROCESS FF BOOK AND CUSTOMER POSITIONS               *
     F*    FFTRAN - PROCESS FUTURES AND OPTIONS TRANSACTIONS             *
     F*    FRAIRS - PROCESS FRA/IRS                                      *
     F*    FRRSRX - PROCESS FRAS AND IRSS                                *
     F*    FXDEAL - PROCESS FX DEALS AND INTERNAL CONTRACTS              *
     F*    GUTEES - PROCESS GUARANTEES                                   *
     F*    INIT   - INITIAL PROCESSING                                   *
     F*    KEYLST - SET UP KEY LISTS                                     *
     F*    LELOAN - PROCESS CUSTOMER LOANS                               *
     F*    LNTARR - SET UP LOAN TYPES ARRAYS                             *
     F*    LOANDS - ACCESS LOAN TYPE DESCRIPTION                         *
     F*    NAPURC - PROCESS NEGOTIABLE ASSETS PURCHASED                  *
     F*    NASOLD - PROCESS NEGOTIABLE ASSETS SOLD                       *
     F*    MAIN   - MAIN PROCESSING                                      *
     F*    MMLOAN - PROCESS MM LOANS                                     *
     F*    PROCAC - PROCESS RE AND GL ACCOUNTS                           *
     F*    PROCFF - PROCESS FF TRANSACTIONS AND POSITIONS                *
     F*    PROCLE - PROCESS LE TRANSACTIONS                              *
     F*    PROCSE - PROCESS SE TRADES AND POSITIONS                      *
     F*    RPRRRF - PROCESS CAPS, COLLARS AND FLOORS                     *
     F*    SEBKPN - PROCESS SE BOOK POSITIONS                            *
     F*    SECDPN - PROCESS SE CUSTOMER AND DEPOT POSITIONS              *
     F*    SETRAD - PROCESS SE TRADES                                    *
     F*    UPDSEL - UPDATE DTAARA/MQSEL                                  *
     F*    USRDEF - SET ALL USER DEFINABLE FIELDS TO ZERO/BLANK          *
     F*    ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK                  *
     F*    *PSSR  - ERROR PROCESSING                                     *
     F*                                                                  *
     F*    FFDATE - DETERMINE CORRECT WORKING DAY FOR A FORMULA          *
     F*             SPECIFIED                                            *
     F*    FFPLCL - CALCULATE PROFIT OR LOSS FOR A GIVEN NUMBER OF       *
     F*             CONTRACTS DUE TO A DIFFERENCE BETWEEN ONE PRICE      *
     F*             AND ANOTHER                                          *
     F*    FFPMCL - CALCULATE PREMIUM PAYABLE ON A GIVEN NUMBER OF       *
     F*             CONTRACTS AT A GIVEN CONTRACT PRICE                  *
     F*    ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER       *
     F*    ZDATE2 - CONVERT DAY NUMBER TO DDMMMYY FORMAT                 *
     F*    ZFREQB - INCREMENT A DAY NUMBER BY A PERIOD VALUE DETERMINED  *
     F*             BY A CODE                                            *
     F*    ZNCD   - DETERMINE NEXT COUPON DATE                           *
     F*    ZSEDIT - EDIT NUMERIC FIELDS                                  *
     F*                                                                  *
     F********************************************************************
     F*                                                                  *
     F* INDICATORS                                                       *
     F*                                                                  *
     F* ID F  C  H  L    FUNCTION OF INDICATORS                          *
     F*       10         RECORD READ FROM CPOSND                         *
     F*       11         RECORD READ FROM DPOSND                         *
     F*       12         RECORD READ FROM POSTNKD                        *
     F*       13         RECORD READ FROM POSTNCD                        *
     F*       30         ENHANCEMENT S01453 SWITCHED ON                  *S01453
     F*       50         END OF FILE                                     *
     F*       60         CHAIN FAIL                                      *
     F*       61         END OF FILE/LOKUP                               *
     F*                                                                  *
     F********************************************************************
      /EJECT
     E********************XCYA      150  3               CURRENCY CODES   055310
     E********************XDPA      150  1 0             CURRENCY DP      055310
     E********************XSPA      150 13 8             SPOT RATES       055310
     E********************XMDA      150  1               M/D INDICATORS   055310
     E********************XLTA      150  4           LOAN TYPES/SUB-TYPES 055310
     E********************XLNA      150 30         LOAN TYPE DESCRIPTIONS 055310
     E********************XFCA      150  3               FACILITY TYPES   055310
     E********************XFNA      150 30               FACILITY NAMES   055310
     E                    XCYA      999  3               CURRENCY CODES   055310
     E                    XDPA      999  1 0             CURRENCY DP      055310
     E                    XSPA      999 13 8             SPOT RATES       055310
     E                    XMDA      999  1               M/D INDICATORS   055310
     E********************XLTA      999  4               LOAN TYP/STYP                 055310 CLE042
     E                    XLTA      999  8               LOAN TYP/STYP                        CLE042
     E                    XLNA      999 30               LOAN TYPE DESC   055310
     E                    XFCA      999  3               FACILITY TYPES   055310
     E                    XFNA      999 30               FACILITY NAMES   055310
     E                    NMA        30  1               NAME ARRAY
     E/COPY WNCPYSRC,MQ552XE001
      /COPY ZSRSRC,ZSEDITZ1
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,FFDATEZ1
      /COPY ZSRSRC,ZHOLE
      /COPY ZSRSRC,ZNCDZ1
      /COPY ZSRSRC,ZDAYSZ1
      /COPY ZSRSRC,ZFREQBZ1
      /COPY ZSRSRC,ZACCRZ0                                                039495
     E*
      /COPY ZSRSRC,ZPOWERZ1
      /COPY ZSRSRC,ZPOWER8Z1
     E                    POWER9  1   9 10 0
     E***********         TXT     1  24 30                                066309
     E                    TXT     1  26 30                                066309
     E                    CPY@    1   1 80
     E*
     E/COPY WNCPYSRC,MQ552XE002
     IREACRDF
     I* RE ACCRUED INTEREST DETAILS
     I              LCD                             LCDX
     I              CHTP                            CHTPX
     I/COPY WNCPYSRC,MQ552XI002
     I*
     IDEALSBXF
     I* FX DEALS AND INTERNAL CONTRACTS
     I              DLNO                            DLNOFX
     I              BRCA                            BRCAFX
     I              PRFC                            PRFCFX
     I              CNUM                            CNUMFX
     I              BOKC                            BOKCFX
     I              ORBR                            ORBRFX
     I              BRKC                            BRKCFX
     I              DDAT                            DDATFX
     I              VDAT                            VDATFX
     I              EXRT                            EXRTFX
     I              SPPD                            SPPDFX
     I              SPLA                            SPLAFX
     I              SPLC                            SPLCFX
     I              LCD                             LCDFX
     I              CHTP                            CHTPFX
     I*
     IPOSTNKDF    12
     I* FF BOOK POSITIONS
     I*
     IPOSTNCDF    13
     I* FF CUSTOMER POSITIONS
     I*
     IINTYPDF
     I* FF INSTRUMENT TYPES
     I              LCD                             LCDIT
     I              CHTP                            CHTPIT
     I*
     IPRICSDF
     I* FF MARKET PRICES
     I              LCD                             LCDPS
     I              CHTP                            CHTPPS
     I*
     IPRISPDF
     I* FF SPOT PRICES
     I              LCD                             LCDPP
     I              CHTP                            CHTPPP
     I*
     IFOPCCDF
     I* FF PROFIT CENTRE CUSTOMER/BROKER POSITION
     I              LCD                             LCDCC
     I              CHTP                            CHTPCC
     I*
     IFOPCKDF
     I* FF PROFIT CENTRE BOOK POSITION
     I              LCD                             LCDCK
     I              CHTP                            CHTPCK
     I*
     IMARKTDF
     I* FF MARKET CENTRES
     I              LCD                             LCDMK
     I              CHTP                            CHTPMK
     I*
     ICLOANCXF
     I* CUSTOMER LOANS
     I              BRCA                            BRCALE
     I              PRFC                            PRFCLE
     I              CNUM                            CNUMLE
     I              ORBR                            ORBRLE
     I              DDAT                            DDATLE
     I              VDAT                            VDATLE
     I              MDAT                            MDATLE
     I              INTR                            INTRLE
     I              MARG                            MARGLE
     I              BRTT                            BRTTLE
     I              BRTE                            BRTELE
     I              AIPD                            AIPDLE
     I              AITC                            AITCLE
     I              IACD                            IACDLE
     I              IPRD                            IPRDLE
     I              AIAP                            AIAPLE
     I              ICTD                            ICTDLE
     I              ICBS                            ICBSLE
     I              LCD                             LCDLE
     I              CHTP                            CHTPLE
     I*
     IFCLTYFNF
     I* FACILITY TYPE 'B' RECORDS
     I              LCD                             LCDF
     I              CHTP                            CHTPF
     I*
     ICPOSNDF     10
     I* SE CUSTOMER POSITIONS
     I              CSBA                            BRCA
     I              CSSC                            SESN
     I              CSCN                            CNUM
     I              CSDA                            PDAT
     I              CSEX                            ECNP
     I              CSNT                            PSNT
     I              CSNV                            PSNV
     I*
     IDPOSNDF     11
     I* SE DEPOT POSITIONS
     I              DSBA                            BRCA
     I              DSSC                            SESN
     I              DDPT                            CNUM
     I              DDTE                            PDAT
     I              DEXN                            ECNP
     I              DSNT                            PSNT
     I              DSNV                            PSNV
     I*
     ITRADSDF
     I* SE TRADES
     I              PRIC                            SEPRIC
     I              LCD                             LCDTR
     I              CHTP                            CHTPTR
     I              CRSK                            TDCRSK                                    215528
     I*
     IHSTTRDF                                                             180198
     I* SE TRADES                                                         180198
     I              PRIC                            SEPRIC                180198
     I              LCD                             LCDTR                 180198
     I              CHTP                            CHTPTR                180198
     I              CRSK                            HTCRSK                                    215528
     I*                                                                   180198
     ISECTYDF
     I* SECURITIES
     I              LCD                             LCDSE
     I              CHTP                            CHTPSE
     I*
     IINVTPDF
     I* INVESTMENT TYPES
     I              LCD                             LCDIN
     I              CHTP                            CHTPIN
     I** Rename PLDPCD to avoid confusion with PLDPCD on PF/FDDTSTPD      CPL002
     I              PLDPCD                          INDPCD                CPL002
     I*                                                                   CPL002
     I*
     ISEPCBDF
     I* BOOK POSITION PROFIT CENTRES
     I              LCD                             LCDBK
     I              CHTP                            CHTPBK
     I*
     ISEPCCDF
     I* CUSTOMER POSITION PROFIT CENTRES
     I              LCD                             LCDCS
     I              CHTP                            CHTPCS
     I*
     ISEDEVDF
     I* SECURITY DIARY EVENTS
     I              LCD                             LCDEV
     I              CHTP                            CHTPEV
     IGTEESGTF                                                                                CGL035
     I              COLC                            COLC2                                     CGL035
     I*                                                                                       CLE148
     IDEALSDBF                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     IDEALSDCF                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     IDEALSDDF                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     IDEALSDEF                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     IDEALSDGF                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     IDLBHISD0                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     IDLCHISD0                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     IDLDHISD0                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     IDLEHISD0                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     IDLGHISD0                                                                                CLE148
     I              DLNO                            DLNONM                                    CLE148
     I*
     IMQSEL     E DSMQSEL
     I* MIDAS Q SELECTION DATA AREA
     I*
     ILDA        UDS                            256
     I* LOCAL DATA AREA
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     ISEBKDS      DS
     I* SE BOOK POSITION
     I                                        1   3 SBBPBA
     I                                        4  13 SBBPSC
     I                                       14  15 SBBPBK
     I                                       16  16 SBBPMK
     I                                       17  17 SBBPTV
     ISECDDS      DS
     I* SE CUSTOMER AND DEPOT POSITIONS
     I                                        1   3 SCBRCA
     I                                        4  13 SCSESN
     I                                       14  19 SCCNUM
     IFFBKDS      DS
     I* FF BOOK POSITIONS
     I                                        1   3 FBBRCA
     I                                        4   5 FBBOKC
     I                                       10  14 FBISTT
     I                                       15  16 FBYRNO
     I                                       17  18 FBMTHN
     I                                       19  19 FBPCAL
     I***********                         P  20  257FBSTRP                CFF004
     I                                    P  20  278FBSTRP                CFF004
     IFFCSDS      DS
     I* FF CUSTOMER POSITIONS
     I                                        1   3 FCBRCA
     I                                        4   9 FCCBCD
     I                                       10  14 FCISTT
     I                                       15  16 FCYRNO
     I                                       17  18 FCMTHN
     I                                       19  19 FCPCAL
     I***********                         P  20  257FCSTRP                CFF004
     I                                    P  20  278FCSTRP                CFF004
     I*
     IACCNUM      DS
     I* ACCOUNT NUMBER
     I                                        1   3 DSBRCA
     I                                        4   9 DSCNUM
     I                                       10  12 DSCCY
     I                                       13  22 DSACOD                                    CGL029
     I                                       23  24 DSACSQ                                    CGL029
     I**********                             13  16 DSACOD                                    CGL029
     I**********                             17  18 DSACSQ                                    CGL029
     I*
     IDPRICS      DS
     I* KEY TO PRICS1
     I                                        1   5 KISTT
     I                                        6   70KYRNO
     I                                        8   90KMTHN
     I                                       10  10 KPCAL
     I***********                            11  217KSTRP                 CFF004
     I                                       11  258KSTRP                 CFF004
     I*
     IDBKPOS      DS
     I* KEY TO BKPOS
     I                                        1  10 KBHSC
     I                                       11  13 KBHBA
     I                                       14  15 KBHBK
     I                                       16  16 KBHMK
     I                                       17  17 KBHTV
     I                                       18  220KLPSD
     I*
     IDCLOAN      DS
     I* KEY TO CLOANX
     I**********                              1   60KLNRF                                     CLE148
     I                                        1   6 KLNRF                                     CLE148
     I                                        7   7 KRCTP
     I*
     IDINVTP      DS
     I* KEY TO INVTP
     I                                        1   3 KNMCY
     I                                        4   6 KSITP
     I*
     ISDBANK    E DSSDBANKPD
     I* BANK DETAILS
     I*
     ISDGELR    E DSSDGELRPD
     I* GENERAL LEDGER DETAILS
     I*
     ISDCUST    E DSSDCUSTPD
     I* CUSTOMER DETAILS
     I*
     ISDACOD    E DSSDACODPD
     I* ACCOUNT CODES
     I              QQACCD                          QQACC1                                    CGL029
     I*
     ISDBSRT    E DSSDBSRTPD
     I* BASE RATES
     I*
     IDSFDY     E DSDSFDY
     I*
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE
     I*
     IDSSDY     E DSDSSDY
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE
     I*
     I/COPY WNCPYSRC,MQ552XI003
     I*
      /COPY ZSRSRC,ZSEDITZ2
      /COPY ZSRSRC,FFDATEZ2
      /COPY ZSRSRC,ZHOLI
      /COPY ZSRSRC,ZNCDZ2
      /COPY ZSRSRC,FFSRDSZ1
      /COPY ZSRSRC,ZYLDZ1
     I/COPY WNCPYSRC,MQ552XI001
      /EJECT
     C*
     C**  EXECUTE INITIAL PROCESSING
     C                     EXSR INIT
     C*
     C**  EXECUTE MAIN PROCESSING
     C                     EXSR MAIN
     C*
     C**  EXECUTE PROCESSING TO UPDATE DTAARA/MQSEL
     C                     EXSR UPDSEL
     C*
     C**  TERMINATE PROGRAM
     C                     SETON                     LR
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. MAIN - MAIN PROCESSING                                    *
     C*                                                                  *
     C*    CALLED BY:                                                    *
     C*    CALLS:     PROCAC - PROCESS RE AND GL ACCOUNTS                *
     C*               FXDEAL - PROCESS FX DEALS AND INTERNAL CONTRACTS   *
     C*               MMLOAN - PROCESS MM LOANS                          *
     C*               NAPURC - PROCESS NEGOTIABLE ASSETS PURCHASED       *
     C*               NASOLD - PROCESS NEGOTIABLE ASSETS SOLD            *
     C*               FRAIRS - PROCESS FRA/IRS                           *
     C*               PROCFF - PROCESS FF TRANSACTIONS AND POSITIONS     *
     C*               PROCLE - PROCESS LE TRANSACTIONS                   *
     C*               PROCSE - PROCESS SE TRADES AND POSITIONS           *
     C*                                                                  *
     C********************************************************************
     C*
     C           MAIN      BEGSR
     C*
     C**  EXECUTE SUBROUTINE ACCORDING TO MODULES SELECTED
     C*
     C**  GENERAL LEDGER/RETAIL
     C           SLGL      IFEQ 'Y'
     C           SLRE      OREQ 'Y'
     C                     EXSR PROCAC
     C                     END
     C*
     C**  FOREIGN EXCHANGE
     C           SLFX      IFEQ 'Y'
     C                     EXSR FXDEAL
     C/COPY WNCPYSRC,MQ552XC035
     C                     END
     C*
     C**  MONEY MARKET
     C           SLMM      IFEQ 'Y'
     C                     EXSR MMLOAN
     C/COPY WNCPYSRC,MQ552XC033
     C                     EXSR NAPURC
     C/COPY WNCPYSRC,MQ552XC036
     C                     EXSR NASOLD
     C/COPY WNCPYSRC,MQ552XC037
     C                     END
     C*
     C**  FRA/IRS
     C           SLFI      IFEQ 'Y'
     C                     EXSR FRAIRS
     C/COPY WNCPYSRC,MQ552XC038
     C                     END
     C*
     C**  FUTURES AND OPTIONS
     C           SLFF      IFEQ 'Y'
     C                     EXSR PROCFF
     C                     END
     C*
     C**  CUSTOMER LENDING
     C           SLLE      IFEQ 'Y'
     C                     EXSR PROCLE
     C                     END
     C*
     C**  SECURITIES TRADING
     C           SLSE      IFEQ 'Y'
     C                     EXSR PROCSE
     C                     END
     C/COPY WNCPYSRC,MQ552XC002
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. ZERO - INITIALISE ALL FIELDS TO ZERO/BLANK                *
     C*                                                                  *
     C*    CALLED BY: LELOAN - PROCESS CUSTOMER LOANS                    *
     C*               FXDEAL - PROCESS FX DEALS AND INTERNAL CONTRACTS   *
     C*               MMLOAN - PROCESS MM LOANS                          *
     C*               NAPURC - PROCESS NEGOTIABLE ASSETS PURCHASED       *
     C*               NASOLD - PROCESS NEGOTIABLE ASSETS SOLD            *
     C*               FRAIRS - PROCESS FRA/IRS                           *
     C*               FACILY - PROCESS FACILITIES                        *
     C*               GUTEES - PROCESS GUARANTEES                        *
     C*               FFTRAN - PROCESS FUTURES AND OPTIONS TRANSACTIONS  *
     C*               FFBCPN - PROCESS FF BOOK AND CUSTOMER POSITIONS    *
     C*               SETRAD - PROCESS SE TRADES                         *
     C*               SEBKPN - PROCESS SE BOOK POSITIONS                 *
     C*               SECDPN - PROCESS SE CUSTOMER AND DEPOT POSITIONS   *
     C*               PROCAC - PROCESS RE AND GL ACCOUNTS                *
     C*    CALLS:                                                        *
     C*                                                                  *
     C********************************************************************
     C*
     C           ZERO      BEGSR
     C*
     C**  MODULE ID
     C                     MOVE *BLANKS   MDID
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE *BLANKS   IMID
     C*
     C**  DEAL NUMBER
     C**********           Z-ADD*ZERO     DLNO                                                CLE148
     C                     MOVEL*BLANKS   DLNO                                                CLE148
     C*
     C**  POSITION/BALANCE NUMBER
     C                     MOVE *BLANKS   PBNO
     C*
     C**  NAME
     C                     MOVE *BLANKS   NAME
     C*
     C**  BRANCH CODE
     C                     MOVE *BLANKS   BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE *BLANKS   PRFC
     C*
     C**  TRANSACTION TYPE
     C                     MOVE *BLANKS   TTYP
     C*
     C**  PROCESSING/FACILITY TYPE
     C                     Z-ADD*ZERO     PFTP
     C*
     C**  SUB-TYPE
     C                     MOVE *BLANKS   SUBT
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADD*ZERO     CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C*
     C**  OTHER CUSTOMER NUMBER
     C**********           Z-ADD*ZERO     OCUS                                                CSD027
     C                     MOVE *BLANKS   OCUS                                                CSD027
     C*
     C**  LINKED DEAL NUMBER
     C                     Z-ADD*ZERO     LNKD
     C*
     C**  BOOK CODE
     C                     MOVE *BLANKS   BOKC
     C*
     C**  DEALER ID
     C                     MOVE *BLANKS   DLID
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE *BLANKS   ORBR
     C*
     C**  BROKER CODE
     C                     MOVE *BLANKS   BRKC
     C*
     C**  ASSOCIATED DEAL NUMBER
     C**********           Z-ADD*ZERO     ADLN                                                CLE148
     C                     MOVE *BLANKS   ADLN                                                CLE148
     C*
     C**  DEAL DATE
     C                     Z-ADD*ZERO     DDAT
     C*
     C**  VALUE DATE
     C                     Z-ADD*ZERO     VDAT
     C*
     C**  MATURITY DATE
     C                     Z-ADD*ZERO     MDAT
     C*
     C**  CURRENCY 1
     C                     MOVE *BLANKS   CCY1
     C*
     C**  NUMBER 1
     C                     Z-ADD*ZERO     NUM1
     C*
     C**  AMOUNT 1
     C                     Z-ADD*ZERO     AMT1
     C*
     C**  BASE CURRENCY AMOUNT 1
     C                     Z-ADD*ZERO     BCA1
     C*
     C**  RUN DAY AMOUNT 1
     C                     Z-ADD*ZERO     RDA1
     C*
     C**  CURRENCY 2
     C                     MOVE *BLANKS   CCY2
     C*
     C**  NUMBER 2
     C                     Z-ADD*ZERO     NUM2
     C*
     C**  AMOUNT 2
     C                     Z-ADD*ZERO     AMT2
     C*
     C**  BASE CURRENCY AMOUNT 2
     C                     Z-ADD*ZERO     BCA2
     C*
     C**  RUN DAY AMOUNT 2
     C                     Z-ADD*ZERO     RDA2
     C*
     C**  NUMBER 3
     C                     Z-ADD*ZERO     NUM3
     C*
     C**  AMOUNT 3
     C                     Z-ADD*ZERO     AMT3
     C*
     C**  RUN DAY AMOUNT 3
     C                     Z-ADD*ZERO     RDA3
     C*
     C**  EXCHANGE RATE
     C                     Z-ADD*ZERO     EXRT
     C*
     C**  PRICE
     C                     Z-ADD*ZERO     PRIC
     C*
     C**  MARKET PRICE
     C                     Z-ADD*ZERO     MPRC
     C*
     C**  PUT/CALL
     C                     MOVE *BLANK    PCAL
     C*
     C**  YIELD RATE
     C                     Z-ADD*ZERO     YRAT
     C*
     C**  SWAP P/L POSTED TO DATE
     C                     Z-ADD*ZERO     SPPD
     C*
     C**  SWAP P/L AMOUNT
     C                     Z-ADD*ZERO     SPLA
     C*
     C**  SWAP P/L CURRENCY
     C                     MOVE *BLANKS   SPLC
     C*
     C**  INTEREST RATE
     C                     Z-ADD*ZERO     INTR
     C*
     C**  MARGIN
     C                     Z-ADD*ZERO     MARG
     C*
     C**  SPREAD
     C                     Z-ADD*ZERO     SPRD
     C*
     C**  BASE RATE CODE
     C                     Z-ADD*ZERO     BRTT
     C*
     C**  CURRENT BASE RATE
     C                     Z-ADD*ZERO     BRTE
     C*
     C**  NEXT INTEREST PAYMENT DATE
     C                     Z-ADD*ZERO     NIPD
     C*
     C**  LAST INTEREST PAYMENT DATE
     C                     Z-ADD*ZERO     LIPD
     C*
     C**  NEXT RATE CHANGE DATE
     C                     Z-ADD*ZERO     NRCD
     C*
     C**  ACCRUED INTEREST POSTED TO DATE
     C                     Z-ADD*ZERO     AIPD
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE
     C                     Z-ADD*ZERO     AITC
     C*
     C**  INTEREST ACCRUAL CONTROL DATE
     C                     Z-ADD*ZERO     IACD
     C*
     C**  INTEREST PAID/RECEIVED TO DATE
     C                     Z-ADD*ZERO     IPRD
     C*
     C**  INTEREST PAID/RECEIVED THIS MONTH
     C                     Z-ADD*ZERO     ITMT
     C*
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED
     C                     Z-ADD*ZERO     AIAN
     C*
     C**  ACCRUED INTEREST ADJUSTMENT POSTED
     C                     Z-ADD*ZERO     AIAP
     C*
     C**  INTEREST CAPITALIZED TO DATE
     C                     Z-ADD*ZERO     ICTD
     C*
     C**  INTEREST CALCULATION BASIS
     C                     Z-ADD*ZERO     ICBS
     C*
     C**  INTEREST RATE 2
     C                     Z-ADD*ZERO     INT2
     C*
     C**  MARGIN 2
     C                     Z-ADD*ZERO     MAR2
     C*
     C**  SPREAD 2
     C                     Z-ADD*ZERO     SPR2
     C*
     C**  BASE RATE CODE 2
     C                     Z-ADD*ZERO     BRT2
     C*
     C**  BASE RATE 2
     C                     Z-ADD*ZERO     BRA2
     C*
     C**  NEXT INTEREST PAYMENT DATE 2
     C                     Z-ADD*ZERO     NIP2
     C*
     C**  LAST INTEREST PAYMENT DATE 2
     C                     Z-ADD*ZERO     LIP2
     C*
     C**  NEXT RATE CHANGE DATE 2
     C                     Z-ADD*ZERO     NRC2
     C*
     C**  ACCRUED INTEREST POSTED TO DATE 2
     C                     Z-ADD*ZERO     AIP2
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE 2
     C                     Z-ADD*ZERO     AIT2
     C*
     C**  INTEREST ACCRUAL CONTROL DATE 2
     C                     Z-ADD*ZERO     IAC2
     C*
     C**  INTEREST PAID/RECEIVED TO DATE 2
     C                     Z-ADD*ZERO     IPR2
     C*
     C**  INTEREST PAID/RECEIVED THIS MONTH 2
     C                     Z-ADD*ZERO     ITM2
     C*
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED 2
     C                     Z-ADD*ZERO     AIN2
     C*
     C**  ACCRUED INTEREST ADJUSTMENT POSTED 2
     C                     Z-ADD*ZERO     AIA2
     C*
     C**  INTEREST CAPITALIZED TO DATE 2
     C                     Z-ADD*ZERO     ICT2
     C*
     C**  INTEREST CALCULATION BASIS 2
     C                     Z-ADD*ZERO     ICB2
     C*
     C**  CAP RATE
     C                     Z-ADD*ZERO     CPRT
     C*
     C**  FLOOR RATE
     C                     Z-ADD*ZERO     FLRT
     C*                                                                   S01453
     C*   IF ENHANCEMENT S01453 IS SWITCHED ON                            S01453
     C           *IN30     IFEQ '1'                                       S01453
     C*                                                                   S01453
     C*   MARGIN POINTS                                                   S01453
     C                     Z-ADD*ZEROS    MGPT                            S01453
     C*                                                                   S01453
     C*   MARGIN AMOUNT                                                   S01453
     C                     Z-ADD*ZEROS    MGAM                            S01453
     C*                                                                   S01453
     C*   MARGIN CURRENCY                                                 S01453
     C                     MOVE *BLANKS   MGCY                            S01453
     C*                                                                   S01453
     C*   MARGIN BUY/SELL IND                                             S01453
     C                     MOVE *BLANKS   MGBS                            S01453
     C*                                                                   S01453
     C*   ORIGINAL SPOT RATE                                              S01453
     C                     Z-ADD*ZEROS    OSRT                            S01453
     C*                                                                   S01453
     C*   FORWARD POINTS                                                  S01453
     C                     Z-ADD*ZEROS    FWPT                            S01453
     C*                                                                   S01453
     C*   BUY FORWARD POINTS AMOUNT                                       S01453
     C                     Z-ADD*ZEROS    BFPA                            S01453
     C*                                                                   S01453
     C*   SELL FORWARD POINTS AMOUNT                                      S01453
     C                     Z-ADD*ZEROS    SFPA                            S01453
     C*                                                                   S01453
     C*   INPUT DL BASE SPOT RATE                                         S01453
     C                     Z-ADD*ZEROS    BDBS                            S01453
     C*                                                                   S01453
     C**  OTHER DL BASE SPOT RATE                                         S01453
     C                     Z-ADD*ZEROS    SDBS                            S01453
     C*                                                                   S01453
     C**  OTHER DL BASE SPOT EQUIV                                        S01453
     C                     Z-ADD*ZEROS    SDBE                            S01453
     C*                                                                   S01453
     C**  BUY DL BASE FWD POINTS                                          S01453
     C                     Z-ADD*ZEROS    BDBF                            S01453
     C*                                                                   S01453
     C**  SELL DL BASE FWD POINTS                                         S01453
     C                     Z-ADD*ZEROS    SDBF                            S01453
     C*                                                                   S01453
     C**  BUY DL BASE FWD AMOUNT                                          S01453
     C                     Z-ADD*ZEROS    BDFA                            S01453
     C*                                                                   S01453
     C**  SELL DL BASE FWD AMOUNT                                         S01453
     C                     Z-ADD*ZEROS    SDFA                            S01453
     C*                                                                   S01453
     C                     END                                            S01453
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADD*ZERO     LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE *BLANK    CHTP
     C/COPY WNCPYSRC,MQ552XC003
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. PROCAC - PROCESS RE AND GL ACCOUNTS                       *
     C*                                                                  *
     C*    CALLED BY: MAIN   - MAIN PROCESSING                           *
     C*    CALLS:     ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           PROCAC    BEGSR
     C*
     C**  INITIALISE ACCOUNT CODE WORK FIELD TO ZERO
     C**********           Z-ADD*ZERO     WACOD   40                                          CGL029
     C                     Z-ADD*ZERO     WACOD  100                                          CGL029
     C*
     C**  OPEN ACCOUNTS AND RETAIL ACCRUED INTEREST DETAILS FILES
     C                     OPEN ACCNR
     C                     OPEN REACR
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  READ ACCOUNTS FILE
     C                     READ ACCNR                    50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C**  IF A LIVE RECORD HAS BEEN READ
     C           RECI      IFEQ 'D'
     C/COPY WNCPYSRC,MQ552XC004
     C*
     C**  CHECK THAT APPROPRIATE MODULE HAS BEEN SELECTED FOR THE TYPE
     C**  OF ACCOUNT
     C           ATYP      IFEQ 'R'
     C           SLRE      ANDEQ'Y'
     C           ATYP      ORNE 'R'
     C           SLGL      ANDEQ'Y'
     C*
     C**  ON CHANGE OF ACCOUNT CODE, ACCESS ACCOUNT CODES FILE
     C           ACOD      IFNE WACOD
     C                     MOVE ACOD      ACOKEY
     C                     CALL 'AOACODR0'
     C***********          PARM '*DBERR ' @RTCD                           055237
     C                     PARM '       ' @RTCD                           055237
     C                     PARM '*KEY   ' @OPTN
     C**********           PARM           ACOKEY  4                                           CGL029
     C                     PARM           ACOKEY 10                                           CGL029
     C           SDACOD    PARM SDACOD    DSFDY
     C/COPY WNCPYSRC,MQ552XC005
     C*                                                                   055237
     C           @RTCD     IFNE *BLANKS                                   055237
     C                     MOVEL'SDACODPD'DBFILE                          055237
     C                     MOVELACOKEY    DBKEY                           055237
     C                     Z-ADD19        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C**  STORE VALUE OF ACCOUNT CODE IN WORK FIELD
     C                     Z-ADDACOD      WACOD
     C                     END
     C/COPY WNCPYSRC,MQ552XC006
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  GENERAL LEDGER
     C*
     C**  MODULE ID
     C           ATYP      IFNE 'R'
     C                     MOVE 'GL '     MDID
     C/COPY WNCPYSRC,MQ552XC007
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'GL'      IMID
     C*
     C**  RETAIL DEBIT ACCOUNT
     C*
     C**  MODULE ID
     C                     ELSE
     C           CLBL      IFGE *ZERO
     C                     MOVE 'RED'     MDID
     C*
     C**  RETAIL CREDIT BALANCE
     C                     ELSE
     C                     MOVE 'REC'     MDID
     C                     END
     C/COPY WNCPYSRC,MQ552XC008
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'RE'      IMID
     C                     END
     C*
     C*
     C**  POSITION/BALANCE NUMBER
     C                     MOVE BRCA      DSBRCA
     C                     MOVE CNUM      DSCNUM
     C                     MOVE CCY       DSCCY
     C                     MOVE ACOD      DSACOD
     C                     MOVE ACSQ      DSACSQ
     C*
     C                     MOVELACCNUM    PBNO
     C*
     C**  NAME = ACCOUNT NAME FROM ACCOUNT CODES FILE
     C                     MOVELA5ACCN    NAME
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDCNUM      CNUM                                                CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*
     C**  CURRENCY 1
     C                     MOVE CCY       CCY1
     C*
     C**  AMOUNT 1 = LEDGER BALANCE
     C                     Z-ADDLDBL      AMT1
     C*
     C**  RUN DAY AMOUNT 1 = LEDGER BALANCE CONVERTED TO BASE CURRENCY
     C**                     AT SPOT RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS
     C                     MOVE CCY       XCCY
     C                     EXSR CCYDEP
     C*
     C**  CONVERT LEDGER BALANCE TO BASE CURRENCY USING SPOT RATE
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE CCY       ZCCYI
     C                     Z-ADDLDBL      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2
     C                     MOVE CCY       CCY2
     C*
     C**  AMOUNT 2 = CLEARED BALANCE
     C                     Z-ADDCLBL      AMT2
     C*
     C**  RUN DAY AMOUNT 2 = CLEARED BALANCE CONVERTED TO BASE CURRENCY
     C**                     AT SPOT RATE
     C                     Z-ADDCLBL      ZAMTCI
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA2
     C*
     C**  INTEREST RATE 1 AND 2, BASE RATE 1 AND 2
     C*
     C**  INTEREST RATE = SPREAD IF INTEREST BASE TYPE IS ZERO;
     C**                  SPREAD + CURRENT BASE RATE, OTHERWISE
     C*
     C**  BASE RATE = CURRENT BASE RATE IF BASE RATE TYPE IS NON-ZERO
     C           ATYP      IFEQ 'R'
     C           DRIB      IFEQ *ZERO
     C           CLBL      IFGE *ZERO
     C                     Z-ADDDRIS      INTR
     C                     ELSE
     C                     Z-ADDDRIS      INT2
     C                     END
     C                     END
     C*
     C           CRIB      IFEQ *ZERO
     C           CLBL      IFGE *ZERO
     C                     Z-ADDCRIS      INT2
     C                     ELSE
     C                     Z-ADDCRIS      INTR
     C                     END
     C                     END
     C*
     C           DRIB      IFNE *ZERO
     C                     MOVE CCY       @AJCD
     C                     MOVELDRIB      @DWNB
     C                     CALL 'AOBSRTR0'PLIST2
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDBSRTPD'DBFILE                          055237
     C                     MOVEL@AJCD     W@5KEY  5                       055237
     C                     MOVE @DWNB     W@5KEY                          055237
     C                     MOVELW@5KEY    DBKEY                           055237
     C                     Z-ADD21        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C           CLBL      IFGE *ZERO
     C           BACBSR    ADD  DRIS      INTR
     C                     Z-ADDBACBSR    BRTE
     C                     ELSE
     C           BACBSR    ADD  DRIS      INT2
     C                     Z-ADDBACBSR    BRA2
     C                     END
     C                     END
     C*
     C           CRIB      IFNE *ZERO
     C                     MOVE CCY       @AJCD
     C                     MOVELCRIB      @DWNB
     C                     CALL 'AOBSRTR0'PLIST2
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDBSRTPD'DBFILE                          055237
     C                     MOVEL@AJCD     W@5KEY                          055237
     C                     MOVE @DWNB     W@5KEY                          055237
     C                     MOVELW@5KEY    DBKEY                           055237
     C                     Z-ADD22        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C           CLBL      IFGE *ZERO
     C           BACBSR    ADD  CRIS      INT2
     C                     Z-ADDBACBSR    BRA2
     C                     ELSE
     C           BACBSR    ADD  CRIS      INTR
     C                     Z-ADDBACBSR    BRTE
     C                     END
     C                     END
     C                     END
     C*
     C**  SPREAD 1 AND 2 = SPREAD IF BASE TYPE IS NON-ZERO
     C           ATYP      IFEQ 'R'
     C           DRIB      IFNE *ZERO
     C           CLBL      IFGE *ZERO
     C                     Z-ADDDRIS      SPRD
     C                     ELSE
     C                     Z-ADDDRIS      SPR2
     C                     END
     C                     END
     C*
     C           CRIB      IFNE *ZERO
     C           CLBL      IFGE *ZERO
     C                     Z-ADDCRIS      SPR2
     C                     ELSE
     C                     Z-ADDCRIS      SPRD
     C                     END
     C                     END
     C                     END
     C*
     C**  BASE RATE CODE 1 AND 2
     C           ATYP      IFEQ 'R'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDDRIB      BRTT
     C                     Z-ADDCRIB      BRT2
     C                     ELSE
     C                     Z-ADDCRIB      BRTT
     C                     Z-ADDDRIB      BRT2
     C                     END
     C                     END
     C*
     C**  NEXT INTEREST PAYMENT DATE 1 AND 2
     C           ATYP      IFEQ 'R'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDNDID      NIPD
     C                     Z-ADDNCID      NIP2
     C                     ELSE
     C                     Z-ADDNCID      NIPD
     C                     Z-ADDNDID      NIP2
     C                     END
     C                     END
     C*
     C**  LAST INTEREST PAYMENT DATE 1 AND 2
     C           ATYP      IFEQ 'R'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDLDID      LIPD
     C                     Z-ADDLCID      LIP2
     C                     ELSE
     C                     Z-ADDLCID      LIPD
     C                     Z-ADDLDID      LIP2
     C                     END
     C                     END
     C*
     C**  NEXT RATE CHANGE DATE 1 AND 2
     C           ATYP      IFEQ 'R'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDDRCD      NRCD
     C                     Z-ADDCRCD      NRC2
     C                     ELSE
     C                     Z-ADDCRCD      NRCD
     C                     Z-ADDDRCD      NRC2
     C                     END
     C                     END
     C*
     C**  ACCRUED INTEREST POSTED TO DATE 1 AND 2
     C           ATYP      IFEQ 'R'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDDIIE      AIPD
     C                     Z-ADDCIIE      AIP2
     C                     ELSE
     C                     Z-ADDCIIE      AIPD
     C                     Z-ADDDIIE      AIP2
     C                     END
     C                     END
     C*
     C**  IF PROCESSING A RETAIL ACCOUNT, ACCESS THE RETAIL ACCRUED
     C**  INTEREST DETAILS FILE
     C           ATYP      IFEQ 'R'
     C**********           Z-ADDCNUM      KCNUM                                               CSD027
     C                     MOVE CNUM      KCNUM                                               CSD027
     C                     MOVE CCY       KCCY
     C                     Z-ADDACOD      KACOD
     C                     Z-ADDACSQ      KACSQ
     C                     MOVE BRCA      KBRCA
     C           REACRK    CHAINREACR                60
     C                     END
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE 1 AND 2
     C           ATYP      IFEQ 'R'
     C           *IN60     ANDEQ'0'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDDAIC1     AITC
     C                     Z-ADDCAIC1     AIT2
     C                     ELSE
     C                     Z-ADDCAIC1     AITC
     C                     Z-ADDDAIC1     AIT2
     C                     END
     C                     END
     C*
     C**  INTEREST ACCRUAL CONTROL DATE 1 AND 2
     C           ATYP      IFEQ 'R'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDDDIA      IACD
     C                     Z-ADDDCIA      IAC2
     C                     ELSE
     C                     Z-ADDDCIA      IACD
     C                     Z-ADDDDIA      IAC2
     C                     END
     C                     END
     C*
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED 1 AND 2
     C           ATYP      IFEQ 'R'
     C           *IN60     ANDEQ'0'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDMADI      AIAN
     C                     Z-ADDMACI      AIN2
     C                     ELSE
     C                     Z-ADDMACI      AIAN
     C                     Z-ADDMADI      AIN2
     C                     END
     C                     END
     C*
     C**  ACCRUED INTEREST ADJUSTMENT POSTED 1 AND 2
     C           ATYP      IFEQ 'R'
     C           *IN60     ANDEQ'0'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDGADI      AIAP
     C                     Z-ADDGACI      AIA2
     C                     ELSE
     C                     Z-ADDGACI      AIAP
     C                     Z-ADDGADI      AIA2
     C                     END
     C                     END
     C*
     C**  INTEREST CAPITALIZED TO DATE 1 AND 2
     C           ATYP      IFEQ 'R'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDLDIA      ICTD
     C                     Z-ADDLCIA      ICT2
     C                     ELSE
     C                     Z-ADDLCIA      ICTD
     C                     Z-ADDLDIA      ICT2
     C                     END
     C                     END
     C*
     C**  INTEREST CALCULATION BASIS 1 AND 2
     C           ATYP      IFEQ 'R'
     C           CLBL      IFGE *ZERO
     C                     Z-ADDDRIC      ICBS
     C                     Z-ADDCRIC      ICB2
     C                     ELSE
     C                     Z-ADDCRIC      ICBS
     C                     Z-ADDDRIC      ICB2
     C                     END
     C                     END
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C                     END
     C*
     C**  READ NEXT ACCOUNT
     C                     READ ACCNR                    50
     C*
     C                     END
     C*
     C*
     C**  CLOSE RE FILES
     C                     CLOSEACCNR
     C                     CLOSEREACR
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. FXDEAL - PROCESS FX DEALS AND INTERNAL CONTRACTS          *
     C*                                                                  *
     C*    CALLED BY: MAIN   - MAIN PROCESSING                           *
     C*    CALLS:     ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           FXDEAL    BEGSR
     C*
     C**  OPEN FX DEALS FILES
     C                     OPEN DEALSDB
     C                     OPEN DEALSX
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  READ FX DEALS FILE
     C                     READ DEALSDB                  50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C****IF*A*LIVE RECORD HAS BEEN READ                                  180198
     C***********RECI      IFEQ 'D'                                       180198
     C           RECI      IFNE 'R'                                       180198
     C/COPY WNCPYSRC,MQ552XC009
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID = 'INT' FOR INTERNAL CONTRACTS; 'FX', OTHERWISE
     C           DTYP      IFEQ 'PS'
     C                     MOVE 'INT'     MDID
     C                     ELSE
     C                     MOVE 'FX '     MDID
     C                     END
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'DL'      IMID
     C*
     C**  DEAL NUMBER
     C**********           Z-ADDDLNO      DLNO                                                CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*
     C**  NAME
     C*
     C**  FOREIGN EXCHANGE OUTRIGHT
     C           DTYP      IFEQ 'FP'
     C           DTYP      OREQ 'FS'
     C           DTYP      OREQ 'CX'
     C           DTYP      OREQ 'PI'
     C           DTYP      OREQ 'SI'
     C                     MOVELTXT,1     NAME
     C                     END
     C*
     C**  OPTION FORWARD
     C           DTYP      IFEQ 'OP'
     C                     MOVELTXT,2     NAME
     C                     END
     C*
     C**  OPTION TAKEDOWN
     C           DTYP      IFEQ 'OT'
     C                     MOVELTXT,3     NAME
     C                     END
     C*
     C**  FOREIGN EXCHANGE SWAP
     C           DTYP      IFEQ 'SW'
     C                     MOVELTXT,4     NAME
     C                     END
     C*
     C**  INTERNAL CONTRACT
     C           DTYP      IFEQ 'PS'
     C                     MOVELTXT,5     NAME
     C                     END
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  TRANSACTION TYPE
     C                     MOVELDTYP      TTYP
     C*
     C**  SUB-TYPE
     C                     MOVELDLST      SUBT
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDCNUM      CNUM                                                CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*
     C**  LINKED DEAL NUMBER
     C                     Z-ADDLNKDN     LNKD
     C*
     C**  BOOK CODE
     C                     MOVE BOKC      BOKC
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE ORBR      ORBR
     C*
     C**  BROKER CODE
     C                     MOVE BRKC      BRKC
     C*
     C**  ASSOCIATED DEAL NUMBER = SWAP OPTION DEAL NUMBER FOR INTERNAL
     C**                           CONTRACTS, FX SWAPS AND OPTION
     C**                           TAKEDOWNS
     C           DTYP      IFEQ 'PS'
     C           DTYP      OREQ 'SW'
     C           DTYP      OREQ 'OT'
     C**********           Z-ADDSODN      ADLN                                                CLE148
     C                     MOVE SODN      ADLN                                                CLE148
     C                     END
     C*
     C**  DEAL DATE
     C                     Z-ADDDDAT      DDAT
     C*
     C**  VALUE DATE
     C                     Z-ADDVDAT      VDAT
     C*
     C**  MATURITY DATE = OPTION TO DATE
     C                     Z-ADDOTDT      MDAT
     C*
     C**  CURRENCY 1 = PURCHASE CURRENCY
     C                     MOVE PUCY      CCY1
     C*
     C**  AMOUNT 1 = PURCHASE AMOUNT
     C                     Z-ADDPUAM      AMT1
     C*
     C**  BASE CURRENCY AMOUNT 1 = ORIGINAL BASE CURRENCY EQUIVALENT
     C**                           FOR OPTION FORWARD;
     C**                           BASE CURRENCY EQUIVALENT, OTHERWISE
     C           DTYP      IFEQ 'OP'
     C                     Z-ADDOBCE      BCA1
     C                     ELSE
     C                     Z-ADDBCEQ      BCA1
     C                     END
     C*
     C**  RUN DAY AMOUNT 1 = PURCHASE AMOUNT CONVERTED TO BASE CURRENCY
     C**                     AT SPOT RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP PURCHASE CURRENCY DETAILS
     C                     MOVE PUCY      XCCY
     C                     EXSR CCYDEP
     C*
     C**  CONVERT PURCHASE AMOUNT FROM PURCHASE CURRENCY TO BASE
     C**  CURRENCY
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE PUCY      ZCCYI
     C                     Z-ADDPUAM      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2 = SELL CURRENCY
     C                     MOVE SLCY      CCY2
     C*
     C**  AMOUNT 2 = SELL AMOUNT
     C                     Z-ADDSLAM      AMT2
     C*
     C**  BASE CURRENCY AMOUNT 2 = ORIGINAL BASE CURRENCY EQUIVALENT
     C**                           FOR OPTION FORWARD;
     C**                           BASE CURRENCY EQUIVALENT, OTHERWISE
     C           DTYP      IFEQ 'OP'
     C                     Z-ADDOBCE      BCA2
     C                     ELSE
     C                     Z-ADDBCEQ      BCA2
     C                     END
     C*
     C**  RUN DAY AMOUNT 2 = SELL AMOUNT CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP SELL CURRENCY DETAILS
     C                     MOVE SLCY      XCCY
     C                     EXSR CCYDEP
     C*
     C**  CONVERT SELL AMOUNT FROM SELL CURRENCY TO BASE CURRENCY
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE SLCY      ZCCYI
     C                     Z-ADDSLAM      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA2
     C*
     C**  EXCHANGE RATE
     C                     Z-ADDEXRT      EXRT
     C*
     C**  PUT/CALL = 1ST/2ND LEG SWAP INDICATOR FOR INTERNAL CONTRACTS
     C**             AND FX SWAPS
     C           DTYP      IFEQ 'PS'
     C           DTYP      OREQ 'SW'
     C                     MOVE FSLI      PCAL
     C                     END
     C*
     C**  SWAP P/L POSTED TO DATE
     C                     Z-ADDSPPD      SPPD
     C*
     C**  SWAP P/L AMOUNT
     C                     Z-ADDSPLA      SPLA
     C*
     C**  SWAP P/L CURRENCY
     C                     MOVE SPLC      SPLC
     C*                                                                   S01453
     C*   IF ENHANCEMENT S01453 IS SWITCHED ON                            S01453
     C           *IN30     IFEQ '1'                                       S01453
     C*                                                                   S01453
     C*   MARGIN POINTS                                                   S01453
     C                     Z-ADDMGPT      MGPT                            S01453
     C*                                                                   S01453
     C*   MARGIN AMOUNT                                                   S01453
     C                     Z-ADDMGAM      MGAM                            S01453
     C*                                                                   S01453
     C*   MARGIN CURRENCY                                                 S01453
     C                     MOVE MGCY      MGCY                            S01453
     C*                                                                   S01453
     C*   MARGIN BUY/SELL IND                                             S01453
     C                     MOVE MGBS      MGBS                            S01453
     C*                                                                   S01453
     C*   ORIGINAL SPOT RATE                                              S01453
     C                     Z-ADDOSRT      OSRT                            S01453
     C*                                                                   S01453
     C*   FORWARD POINTS                                                  S01453
     C                     Z-ADDFWPT      FWPT                            S01453
     C*                                                                   S01453
     C*   BUY FORWARD POINTS AMOUNT                                       S01453
     C                     Z-ADDBFPA      BFPA                            S01453
     C*                                                                   S01453
     C*   SELL FORWARD POINTS AMOUNT                                      S01453
     C                     Z-ADDSFPA      SFPA                            S01453
     C*                                                                   S01453
     C*   INPUT DL BASE SPOT RATE                                         S01453
     C                     Z-ADDBDBS      BDBS                            S01453
     C*                                                                   S01453
     C**  OTHER DL BASE SPOT RATE                                         S01453
     C                     Z-ADDSDBS      SDBS                            S01453
     C*                                                                   S01453
     C**  OTHER DL BASE SPOT EQUIV                                        S01453
     C                     Z-ADDSDBE      SDBE                            S01453
     C*                                                                   S01453
     C**  BUY DL BASE FWD POINTS                                          S01453
     C                     Z-ADDBDBF      BDBF                            S01453
     C*                                                                   S01453
     C**  SELL DL BASE FWD POINTS                                         S01453
     C                     Z-ADDSDBF      SDBF                            S01453
     C*                                                                   S01453
     C**  BUY DL BASE FWD AMOUNT                                          S01453
     C                     Z-ADDBDFA      BDFA                            S01453
     C*                                                                   S01453
     C**  SELL DL BASE FWD AMOUNT                                         S01453
     C                     Z-ADDSDFA      SDFA                            S01453
     C*                                                                   S01453
     C                     END                                            S01453
     C*                                                                   S01453
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  IF PROCESSING 1ST LEG OF INTERNAL CONTRACT, ACCESS 2ND LEG
     C**  DEAL FOR LOAN INTEREST INFORMATION
     C           DTYP      IFEQ 'PS'
     C           PCAL      ANDEQ'1'
     C*
     C           SODN      CHAINDEALSX               60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'DEALSX  'DBFILE
     C                     MOVELSODN      DBKEY
     C                     Z-ADD1         DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  INTEREST RATE = INTERNAL LOAN INTEREST RATE
     C                     Z-ADDILIR      INTR
     C*
     C**  ACCRUED INTEREST POSTED TO DATE = INTERNAL LOAN INTEREST
     C**                                    AMOUNT
     C                     Z-ADDILIA      AIPD
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE = LOAN INTEREST ACCRUED TO
     C**                                     DATE
     C                     Z-ADDLITD      AITC
     C*
     C**  INTEREST PAID/RECEIVED TO DATE = LOAN INTEREST TO ACCRUE
     C                     Z-ADDLILA      IPRD
     C*
     C**  INTEREST CALCULATION BASIS = INTERNAL LOAN INTEREST
     C**                               CALCULATION METHOD
     C                     Z-ADDILCM      ICBS
     C                     END
     C*
     C**  SET UP 2ND LEG FIELDS FOR INTERNAL CONTRACTS
     C           DTYP      IFEQ 'PS'
     C           PCAL      ANDEQ'2'
     C*
     C**  INTEREST RATE 2 = INTERNAL DEPOSIT INTEREST RATE
     C                     Z-ADDIDIR      INT2
     C*
     C**  ACCRUED INTEREST POSTED TO DATE 2 = INTERNAL DEPOSIT INTEREST
     C**                                      AMOUNT
     C                     Z-ADDIDIA      AIP2
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE 2 = DEPOSIT INTEREST ACCRUED
     C**                                       TO DATE
     C                     Z-ADDDITD      AIT2
     C*
     C**  INTEREST PAID/RECEIVED TO DATE 2 = DEPOSIT INTEREST TO ACCRUE
     C                     Z-ADDDILA      IPR2
     C*
     C**  INTEREST CALCULATION BASIS 2 = INTERNAL DEPOSIT INTEREST
     C**                                 CALCULATION METHOD
     C                     Z-ADDIDCM      ICB2
     C                     END
     C/COPY WNCPYSRC,MQ552XC010
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT FX DEAL
     C                     READ DEALSDB                  50
     C*
     C                     END
     C*
     C**  CLOSE FX DEALS
     C                     CLOSEDEALSDB
     C                     CLOSEDEALSX
     C*                                                                   180198
     C**  OPEN FX DEALS FILES                                             180198
     C                     OPEN DLBHISPD                                  180198
     C                     OPEN DEALSX                                    180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C*                                                                   180198
     C**  READ FX DEALS FILE                                              180198
     C                     READ DLBHISPD                 50               180198
     C*                                                                   180198
     C**  DO WHILE NOT END OF FILE                                        180198
     C           *IN50     DOWEQ'0'                                       180198
     C*                                                                   180198
     C           RECI      IFNE 'R'                                       180198
     C*                                                                   180198
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE           180198
     C*                                                                   180198
     C**  MODULE ID = 'INT' FOR INTERNAL CONTRACTS; 'FX', OTHERWISE       180198
     C           DTYP      IFEQ 'PS'                                      180198
     C                     MOVE 'INT'     MDID                            180198
     C                     ELSE                                           180198
     C                     MOVE 'FX '     MDID                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  INTERNAL MODULE ID                                              180198
     C                     MOVE 'DL'      IMID                            180198
     C*                                                                   180198
     C**  DEAL NUMBER                                                     180198
     C**********           Z-ADDDLNO      DLNO                                         180198 CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*                                                                   180198
     C**  NAME                                                            180198
     C*                                                                   180198
     C**  FOREIGN EXCHANGE OUTRIGHT                                       180198
     C           DTYP      IFEQ 'FP'                                      180198
     C           DTYP      OREQ 'FS'                                      180198
     C           DTYP      OREQ 'CX'                                      180198
     C           DTYP      OREQ 'PI'                                      180198
     C           DTYP      OREQ 'SI'                                      180198
     C                     MOVELTXT,1     NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  OPTION FORWARD                                                  180198
     C           DTYP      IFEQ 'OP'                                      180198
     C                     MOVELTXT,2     NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  OPTION TAKEDOWN                                                 180198
     C           DTYP      IFEQ 'OT'                                      180198
     C                     MOVELTXT,3     NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  FOREIGN EXCHANGE SWAP                                           180198
     C           DTYP      IFEQ 'SW'                                      180198
     C                     MOVELTXT,4     NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  INTERNAL CONTRACT                                               180198
     C           DTYP      IFEQ 'PS'                                      180198
     C                     MOVELTXT,5     NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  BRANCH CODE                                                     180198
     C                     MOVE BRCA      BRCA                            180198
     C*                                                                   180198
     C**  PROFIT CENTRE                                                   180198
     C                     MOVE PRFC      PRFC                            180198
     C*                                                                   180198
     C**  TRANSACTION TYPE                                                180198
     C                     MOVELDTYP      TTYP                            180198
     C*                                                                   180198
     C**  SUB-TYPE                                                        180198
     C                     MOVELDLST      SUBT                            180198
     C*                                                                   180198
     C**  CUSTOMER NUMBER                                                 180198
     C**********           Z-ADDCNUM      CNUM                                         180198 CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*                                                                   180198
     C**  LINKED DEAL NUMBER                                              180198
     C                     Z-ADDLNKDN     LNKD                            180198
     C*                                                                   180198
     C**  BOOK CODE                                                       180198
     C                     MOVE BOKC      BOKC                            180198
     C*                                                                   180198
     C**  ORIGINATING BRANCH                                              180198
     C                     MOVE ORBR      ORBR                            180198
     C*                                                                   180198
     C**  BROKER CODE                                                     180198
     C                     MOVE BRKC      BRKC                            180198
     C*                                                                   180198
     C**  ASSOCIATED DEAL NUMBER = SWAP OPTION DEAL NUMBER FOR INTERNAL   180198
     C**                           CONTRACTS, FX SWAPS AND OPTION         180198
     C**                           TAKEDOWNS                              180198
     C           DTYP      IFEQ 'PS'                                      180198
     C           DTYP      OREQ 'SW'                                      180198
     C           DTYP      OREQ 'OT'                                      180198
     C**********           Z-ADDSODN      ADLN                                         180198 CLE148
     C                     MOVE SODN      ADLN                                                CLE148
     C                     END                                            180198
     C*                                                                   180198
     C**  DEAL DATE                                                       180198
     C                     Z-ADDDDAT      DDAT                            180198
     C*                                                                   180198
     C**  VALUE DATE                                                      180198
     C                     Z-ADDVDAT      VDAT                            180198
     C*                                                                   180198
     C**  MATURITY DATE = OPTION TO DATE                                  180198
     C                     Z-ADDOTDT      MDAT                            180198
     C*                                                                   180198
     C**  CURRENCY 1 = PURCHASE CURRENCY                                  180198
     C                     MOVE PUCY      CCY1                            180198
     C*                                                                   180198
     C**  AMOUNT 1 = PURCHASE AMOUNT                                      180198
     C                     Z-ADDPUAM      AMT1                            180198
     C*                                                                   180198
     C**  BASE CURRENCY AMOUNT 1 = ORIGINAL BASE CURRENCY EQUIVALENT      180198
     C**                           FOR OPTION FORWARD;                    180198
     C**                           BASE CURRENCY EQUIVALENT, OTHERWISE    180198
     C           DTYP      IFEQ 'OP'                                      180198
     C                     Z-ADDOBCE      BCA1                            180198
     C                     ELSE                                           180198
     C                     Z-ADDBCEQ      BCA1                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  RUN DAY AMOUNT 1 = PURCHASE AMOUNT CONVERTED TO BASE CURRENCY   180198
     C**                     AT SPOT RATE                                 180198
     C*                                                                   180198
     C**  ACCESS CURRENCY ARRAYS TO PICK UP PURCHASE CURRENCY DETAILS     180198
     C                     MOVE PUCY      XCCY                            180198
     C                     EXSR CCYDEP                                    180198
     C*                                                                   180198
     C**  CONVERT PURCHASE AMOUNT FROM PURCHASE CURRENCY TO BASE          180198
     C**  CURRENCY                                                        180198
     C                     Z-ADDXDECP     ZCDPI                           180198
     C                     MOVE PUCY      ZCCYI                           180198
     C                     Z-ADDPUAM      ZAMTCI                          180198
     C                     MOVE XMDIN     ZMD                             180198
     C                     Z-ADDXSPOT     ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    RDA1                            180198
     C*                                                                   180198
     C**  CURRENCY 2 = SELL CURRENCY                                      180198
     C                     MOVE SLCY      CCY2                            180198
     C*                                                                   180198
     C**  AMOUNT 2 = SELL AMOUNT                                          180198
     C                     Z-ADDSLAM      AMT2                            180198
     C*                                                                   180198
     C**  BASE CURRENCY AMOUNT 2 = ORIGINAL BASE CURRENCY EQUIVALENT      180198
     C**                           FOR OPTION FORWARD;                    180198
     C**                           BASE CURRENCY EQUIVALENT, OTHERWISE    180198
     C           DTYP      IFEQ 'OP'                                      180198
     C                     Z-ADDOBCE      BCA2                            180198
     C                     ELSE                                           180198
     C                     Z-ADDBCEQ      BCA2                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  RUN DAY AMOUNT 2 = SELL AMOUNT CONVERTED TO BASE CURRENCY AT    180198
     C**                     SPOT RATE                                    180198
     C*                                                                   180198
     C**  ACCESS CURRENCY ARRAYS TO PICK UP SELL CURRENCY DETAILS         180198
     C                     MOVE SLCY      XCCY                            180198
     C                     EXSR CCYDEP                                    180198
     C*                                                                   180198
     C**  CONVERT SELL AMOUNT FROM SELL CURRENCY TO BASE CURRENCY         180198
     C                     Z-ADDXDECP     ZCDPI                           180198
     C                     MOVE SLCY      ZCCYI                           180198
     C                     Z-ADDSLAM      ZAMTCI                          180198
     C                     MOVE XMDIN     ZMD                             180198
     C                     Z-ADDXSPOT     ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    RDA2                            180198
     C*                                                                   180198
     C**  EXCHANGE RATE                                                   180198
     C                     Z-ADDEXRT      EXRT                            180198
     C*                                                                   180198
     C**  PUT/CALL = 1ST/2ND LEG SWAP INDICATOR FOR INTERNAL CONTRACTS    180198
     C**             AND FX SWAPS                                         180198
     C           DTYP      IFEQ 'PS'                                      180198
     C           DTYP      OREQ 'SW'                                      180198
     C                     MOVE FSLI      PCAL                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  SWAP P/L POSTED TO DATE                                         180198
     C                     Z-ADDSPPD      SPPD                            180198
     C*                                                                   180198
     C**  SWAP P/L AMOUNT                                                 180198
     C                     Z-ADDSPLA      SPLA                            180198
     C*                                                                   180198
     C**  SWAP P/L CURRENCY                                               180198
     C                     MOVE SPLC      SPLC                            180198
     C*                                                                   180198
     C*   IF ENHANCEMENT S01453 IS SWITCHED ON                            180198
     C           *IN30     IFEQ '1'                                       180198
     C*                                                                   180198
     C*   MARGIN POINTS                                                   180198
     C                     Z-ADDMGPT      MGPT                            180198
     C*                                                                   180198
     C*   MARGIN AMOUNT                                                   180198
     C                     Z-ADDMGAM      MGAM                            180198
     C*                                                                   180198
     C*   MARGIN CURRENCY                                                 180198
     C                     MOVE MGCY      MGCY                            180198
     C*                                                                   180198
     C*   MARGIN BUY/SELL IND                                             180198
     C                     MOVE MGBS      MGBS                            180198
     C*                                                                   180198
     C*   ORIGINAL SPOT RATE                                              180198
     C                     Z-ADDOSRT      OSRT                            180198
     C*                                                                   180198
     C*   FORWARD POINTS                                                  180198
     C                     Z-ADDFWPT      FWPT                            180198
     C*                                                                   180198
     C*   BUY FORWARD POINTS AMOUNT                                       180198
     C                     Z-ADDBFPA      BFPA                            180198
     C*                                                                   180198
     C*   SELL FORWARD POINTS AMOUNT                                      180198
     C                     Z-ADDSFPA      SFPA                            180198
     C*                                                                   180198
     C*   INPUT DL BASE SPOT RATE                                         180198
     C                     Z-ADDBDBS      BDBS                            180198
     C*                                                                   180198
     C**  OTHER DL BASE SPOT RATE                                         180198
     C                     Z-ADDSDBS      SDBS                            180198
     C*                                                                   180198
     C**  OTHER DL BASE SPOT EQUIV                                        180198
     C                     Z-ADDSDBE      SDBE                            180198
     C*                                                                   180198
     C**  BUY DL BASE FWD POINTS                                          180198
     C                     Z-ADDBDBF      BDBF                            180198
     C*                                                                   180198
     C**  SELL DL BASE FWD POINTS                                         180198
     C                     Z-ADDSDBF      SDBF                            180198
     C*                                                                   180198
     C**  BUY DL BASE FWD AMOUNT                                          180198
     C                     Z-ADDBDFA      BDFA                            180198
     C*                                                                   180198
     C**  SELL DL BASE FWD AMOUNT                                         180198
     C                     Z-ADDSDFA      SDFA                            180198
     C*                                                                   180198
     C                     END                                            180198
     C*                                                                   180198
     C**  LAST CHANGE DATE                                                180198
     C                     Z-ADDLCD       LCD                             180198
     C**  LAST CHANGE TYPE                                                180198
     C                     MOVE CHTP      CHTP                            180198
     C*                                                                   180198
     C**  IF PROCESSING 1ST LEG OF INTERNAL CONTRACT, ACCESS 2ND LEG      180198
     C**  DEAL FOR LOAN INTEREST INFORMATION                              180198
     C           DTYP      IFEQ 'PS'                                      180198
     C           PCAL      ANDEQ'1'                                       180198
     C*                                                                   180198
     C           SODN      CHAINDEALSX               60                   180198
     C*                                                                   180198
     C**  IF RECORD NOT FOUND NO DATABASE ERROR                           180198
     C*                                                                   180198
     C**  INTEREST RATE = INTERNAL LOAN INTEREST RATE                     180198
     C                     Z-ADDILIR      INTR                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST POSTED TO DATE = INTERNAL LOAN INTEREST        180198
     C**                                    AMOUNT                        180198
     C                     Z-ADDILIA      AIPD                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST TO CONTROL DATE = LOAN INTEREST ACCRUED TO     180198
     C**                                     DATE                         180198
     C                     Z-ADDLITD      AITC                            180198
     C*                                                                   180198
     C**  INTEREST PAID/RECEIVED TO DATE = LOAN INTEREST TO ACCRUE        180198
     C                     Z-ADDLILA      IPRD                            180198
     C*                                                                   180198
     C**  INTEREST CALCULATION BASIS = INTERNAL LOAN INTEREST             180198
     C**                               CALCULATION METHOD                 180198
     C                     Z-ADDILCM      ICBS                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  SET UP 2ND LEG FIELDS FOR INTERNAL CONTRACTS                    180198
     C           DTYP      IFEQ 'PS'                                      180198
     C           PCAL      ANDEQ'2'                                       180198
     C*                                                                   180198
     C**  INTEREST RATE 2 = INTERNAL DEPOSIT INTEREST RATE                180198
     C                     Z-ADDIDIR      INT2                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST POSTED TO DATE 2 = INTERNAL DEPOSIT INTEREST   180198
     C**                                      AMOUNT                      180198
     C                     Z-ADDIDIA      AIP2                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST TO CONTROL DATE 2 = DEPOSIT INTEREST ACCRUED   180198
     C**                                       TO DATE                    180198
     C                     Z-ADDDITD      AIT2                            180198
     C*                                                                   180198
     C**  INTEREST PAID/RECEIVED TO DATE 2 = DEPOSIT INTEREST TO ACCRUE   180198
     C                     Z-ADDDILA      IPR2                            180198
     C*                                                                   180198
     C**  INTEREST CALCULATION BASIS 2 = INTERNAL DEPOSIT INTEREST        180198
     C**                                 CALCULATION METHOD               180198
     C                     Z-ADDIDCM      ICB2                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  WRITE RECORD TO MQALM                                           180198
     C                     WRITEMQALMF                                    180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C                     END                                            180198
     C*                                                                   180198
     C**  READ NEXT FX DEAL                                               180198
     C                     READ DLBHISPD                 50               180198
     C*                                                                   180198
     C                     END                                            180198
     C*                                                                   180198
     C**  CLOSE FX DEALS                                                  180198
     C                     CLOSEDLBHISPD                                  180198
     C                     CLOSEDEALSX                                    180198
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. MMLOAN - PROCESS MM LOANS                                 *
     C*                                                                  *
     C*    CALLED BY: MAIN   - MAIN PROCESSING                           *
     C*    CALLS:     ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           MMLOAN    BEGSR
     C*
     C**  OPEN MM LOANS FILE
     C                     OPEN DEALSDC
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  READ MM LOANS FILE
     C                     READ DEALSDC                  50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C****IF*A*LIVE RECORD HAS BEEN READ                                  180198
     C***********RECI      IFEQ 'D'                                       180198
     C           RECI      IFNE 'R'                                       180198
     C/COPY WNCPYSRC,MQ552XC011
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID = 'LON' FOR LOANS; 'DEP' FOR DEPOSITS
     C           DTYP      IFEQ 'IP'
     C           DTYP      OREQ 'CL'
     C           DTYP      OREQ 'TI'
     C           DTYP      OREQ 'DL'
     C           DTYP      OREQ 'LN'
     C           DTYP      OREQ 'IL'                                      066309
     C                     MOVE 'LON'     MDID
     C                     END
     C*
     C           DTYP      IFEQ 'IT'
     C           DTYP      OREQ 'CD'
     C           DTYP      OREQ 'TD'
     C           DTYP      OREQ 'CI'
     C           DTYP      OREQ 'ID'                                      066309
     C                     MOVE 'DEP'     MDID
     C                     END
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'DL'      IMID
     C*
     C**  DEAL NUMBER
     C***********          Z-ADDDLNO      DLNO                                                CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*
     C**  NAME
     C*
     C**  INTERBANK DEPOSIT PLACED
     C           DTYP      IFEQ 'IP'
     C                     MOVELTXT,6     NAME
     C                     END
     C*
     C**  CALL/NOTICE LOAN
     C           DTYP      IFEQ 'CL'
     C                     MOVELTXT,7     NAME
     C                     END
     C*
     C**  TIME LOAN
     C           DTYP      IFEQ 'TI'
     C                     MOVELTXT,8     NAME
     C                     END
     C*
     C**  DEMAND LOAN
     C           DTYP      IFEQ 'DL'
     C                     MOVELTXT,9     NAME
     C                     END
     C*
     C**  COMMERCIAL LOAN
     C           DTYP      IFEQ 'LN'
     C                     MOVELTXT,10    NAME
     C                     END
     C*
     C**  INTERBANK DEPOSIT ACCEPTED
     C           DTYP      IFEQ 'IT'
     C                     MOVELTXT,11    NAME
     C                     END
     C*
     C**  CALL/NOTICE DEMAND DEPOSIT
     C           DTYP      IFEQ 'CD'
     C                     MOVELTXT,12    NAME
     C                     END
     C*
     C**  TIME DEPOSIT
     C           DTYP      IFEQ 'TD'
     C                     MOVELTXT,13    NAME
     C                     END
     C*
     C**  CERTIFICATE OF DEPOSIT ISSUED
     C           DTYP      IFEQ 'CI'
     C                     MOVELTXT,14    NAME
     C                     END
     C*                                                                   066309
     C**  INTERNAL DEPOSIT                                                066309
     C           DTYP      IFEQ 'ID'                                      066309
     C                     MOVELTXT,25    NAME                            066309
     C                     END                                            066309
     C*                                                                   066309
     C**  INTERNAL LOAN                                                   066309
     C           DTYP      IFEQ 'IL'                                      066309
     C                     MOVELTXT,26    NAME                            066309
     C                     END                                            066309
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  TRANSACTION TYPE
     C                     MOVELDTYP      TTYP
     C*
     C**  SUB-TYPE
     C                     MOVELDLST      SUBT
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDCNUM      CNUM                                                CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*
     C**  LINKED DEAL NUMBER
     C                     Z-ADDLNKDN     LNKD
     C*
     C**  BOOK CODE
     C                     MOVE BOKC      BOKC
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE ORBR      ORBR
     C*
     C**  BROKER CODE
     C                     MOVE BRKC      BRKC
     C*
     C**  DEAL DATE
     C                     Z-ADDDDAT      DDAT
     C*
     C**  VALUE DATE
     C                     Z-ADDVDAT      VDAT
     C*
     C**  MATURITY DATE
     C                     Z-ADDMDAT      MDAT
     C/COPY WNCPYSRC,MQ552XC039
     C*
     C**  CURRENCY 1
     C                     MOVE CCY       CCY1
     C*
     C**  AMOUNT 1 = PRINCIPAL
     C                     Z-ADDPCPL      AMT1
     C*
     C**  BASE CURRENCY AMOUNT 1 = PRINCIPAL CONVERTED TO BASE CURRENCY
     C**                           AT BASE CURRENCY EXCHANGE RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS
     C                     MOVE CCY       XCCY
     C                     EXSR CCYDEP
     C*
     C**  CONVERT PRINCIPAL TO BASE CURRENCY USING BASE CURRENCY
     C**  EXCHANGE RATE ON FILE
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE CCY       ZCCYI
     C                     Z-ADDPCPL      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDBCXR      ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA1
     C*
     C**  RUN DAY AMOUNT 1 = PRINCIPAL CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C                     Z-ADDPCPL      ZAMTCI
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C/COPY WNCPYSRC,MQ552XC040
     C*
     C**  INTEREST RATE
     C                     Z-ADDINTR      INTR
     C*
     C**  SPREAD = RATE/SPREAD
     C                     Z-ADDRTSP      SPRD
     C*
     C**  BASE RATE CODE
     C                     Z-ADDBRTT      BRTT
     C*
     C**  CURRENT BASE RATE
     C                     Z-ADDBRTE      BRTE
     C*
     C**  NEXT INTEREST PAYMENT DATE
     C                     Z-ADDNIDT      NIPD
     C*
     C**  LAST INTEREST PAYMENT DATE
     C                     Z-ADDSLID      LIPD
     C*
     C**  ACCRUED INTEREST POSTED TO DATE
     C                     Z-ADDAIPD      AIPD
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE
     C                     Z-ADDAITC      AITC
     C*
     C**  INTEREST ACCRUAL CONTROL DATE
     C                     Z-ADDIACD      IACD
     C*
     C**  INTEREST PAID/RECEIVED TO DATE
     C                     Z-ADDIPRD      IPRD
     C*
     C**  INTEREST PAID/RECEIVED THIS MONTH
     C                     Z-ADDIPRM      ITMT
     C*
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED
     C                     Z-ADDAIAN      AIAN
     C*
     C**  ACCRUED INTEREST ADJUSTMENT POSTED
     C                     Z-ADDAIAP      AIAP
     C*
     C**  INTEREST CAPITALIZED TO DATE
     C                     Z-ADDICTD      ICTD
     C*
     C**  INTEREST CALCULATION BASIS
     C                     Z-ADDICBS      ICBS
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT MM LOAN
     C                     READ DEALSDC                  50
     C*
     C                     END
     C*
     C**  CLOSE MM LOANS
     C                     CLOSEDEALSDC
     C*                                                                   180198
     C**  OPEN MM LOANS HISTORY FILE                                      180198
     C                     OPEN DLCHISPD                                  180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C*                                                                   180198
     C**  READ MM LOANS HISTORY FILE                                      180198
     C                     READ DLCHISPD                 50               180198
     C*                                                                   180198
     C**  DO WHILE NOT END OF FILE                                        180198
     C           *IN50     DOWEQ'0'                                       180198
     C*                                                                   180198
     C           RECI      IFNE 'R'                                       180198
     C*                                                                   180198
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE           180198
     C*                                                                   180198
     C**  Extract Notice Days into user definable field U6N1.             180198
     C*                                                                   180198
     C                     Z-ADDNOTD      U6N1                            180198
     C*                                                                   180198
     C**  MODULE ID = 'LON' FOR LOANS; 'DEP' FOR DEPOSITS                 180198
     C           DTYP      IFEQ 'IP'                                      180198
     C           DTYP      OREQ 'CL'                                      180198
     C           DTYP      OREQ 'TI'                                      180198
     C           DTYP      OREQ 'DL'                                      180198
     C           DTYP      OREQ 'LN'                                      180198
     C           DTYP      OREQ 'IL'                                      180198
     C                     MOVE 'LON'     MDID                            180198
     C                     END                                            180198
     C*                                                                   180198
     C           DTYP      IFEQ 'IT'                                      180198
     C           DTYP      OREQ 'CD'                                      180198
     C           DTYP      OREQ 'TD'                                      180198
     C           DTYP      OREQ 'CI'                                      180198
     C           DTYP      OREQ 'ID'                                      180198
     C                     MOVE 'DEP'     MDID                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  INTERNAL MODULE ID                                              180198
     C                     MOVE 'DL'      IMID                            180198
     C*                                                                   180198
     C**  DEAL NUMBER                                                     180198
     C**********           Z-ADDDLNO      DLNO                                         180198 CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*                                                                   180198
     C**  NAME                                                            180198
     C*                                                                   180198
     C**  INTERBANK DEPOSIT PLACED                                        180198
     C           DTYP      IFEQ 'IP'                                      180198
     C                     MOVELTXT,6     NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  CALL/NOTICE LOAN                                                180198
     C           DTYP      IFEQ 'CL'                                      180198
     C                     MOVELTXT,7     NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  TIME LOAN                                                       180198
     C           DTYP      IFEQ 'TI'                                      180198
     C                     MOVELTXT,8     NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  DEMAND LOAN                                                     180198
     C           DTYP      IFEQ 'DL'                                      180198
     C                     MOVELTXT,9     NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  COMMERCIAL LOAN                                                 180198
     C           DTYP      IFEQ 'LN'                                      180198
     C                     MOVELTXT,10    NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  INTERBANK DEPOSIT ACCEPTED                                      180198
     C           DTYP      IFEQ 'IT'                                      180198
     C                     MOVELTXT,11    NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  CALL/NOTICE DEMAND DEPOSIT                                      180198
     C           DTYP      IFEQ 'CD'                                      180198
     C                     MOVELTXT,12    NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  TIME DEPOSIT                                                    180198
     C           DTYP      IFEQ 'TD'                                      180198
     C                     MOVELTXT,13    NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  CERTIFICATE OF DEPOSIT ISSUED                                   180198
     C           DTYP      IFEQ 'CI'                                      180198
     C                     MOVELTXT,14    NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  INTERNAL DEPOSIT                                                180198
     C           DTYP      IFEQ 'ID'                                      180198
     C                     MOVELTXT,25    NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  INTERNAL LOAN                                                   180198
     C           DTYP      IFEQ 'IL'                                      180198
     C                     MOVELTXT,26    NAME                            180198
     C                     END                                            180198
     C*                                                                   180198
     C**  BRANCH CODE                                                     180198
     C                     MOVE BRCA      BRCA                            180198
     C*                                                                   180198
     C**  PROFIT CENTRE                                                   180198
     C                     MOVE PRFC      PRFC                            180198
     C*                                                                   180198
     C**  TRANSACTION TYPE                                                180198
     C                     MOVELDTYP      TTYP                            180198
     C*                                                                   180198
     C**  SUB-TYPE                                                        180198
     C                     MOVELDLST      SUBT                            180198
     C*                                                                   180198
     C**  CUSTOMER NUMBER                                                 180198
     C**********           Z-ADDCNUM      CNUM                                         180198 CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*                                                                   180198
     C**  LINKED DEAL NUMBER                                              180198
     C                     Z-ADDLNKDN     LNKD                            180198
     C*                                                                   180198
     C**  BOOK CODE                                                       180198
     C                     MOVE BOKC      BOKC                            180198
     C*                                                                   180198
     C**  ORIGINATING BRANCH                                              180198
     C                     MOVE ORBR      ORBR                            180198
     C*                                                                   180198
     C**  BROKER CODE                                                     180198
     C                     MOVE BRKC      BRKC                            180198
     C*                                                                   180198
     C**  DEAL DATE                                                       180198
     C                     Z-ADDDDAT      DDAT                            180198
     C*                                                                   180198
     C**  VALUE DATE                                                      180198
     C                     Z-ADDVDAT      VDAT                            180198
     C*                                                                   180198
     C**  MATURITY DATE                                                   180198
     C                     Z-ADDMDAT      MDAT                            180198
     C*                                                                   180198
     C**  CURRENCY 1                                                      180198
     C                     MOVE CCY       CCY1                            180198
     C*                                                                   180198
     C**  AMOUNT 1 = PRINCIPAL                                            180198
     C                     Z-ADDPCPL      AMT1                            180198
     C*                                                                   180198
     C**  BASE CURRENCY AMOUNT 1 = PRINCIPAL CONVERTED TO BASE CURRENCY   180198
     C**                           AT BASE CURRENCY EXCHANGE RATE         180198
     C*                                                                   180198
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS              180198
     C                     MOVE CCY       XCCY                            180198
     C                     EXSR CCYDEP                                    180198
     C*                                                                   180198
     C**  CONVERT PRINCIPAL TO BASE CURRENCY USING BASE CURRENCY          180198
     C**  EXCHANGE RATE ON FILE                                           180198
     C                     Z-ADDXDECP     ZCDPI                           180198
     C                     MOVE CCY       ZCCYI                           180198
     C                     Z-ADDPCPL      ZAMTCI                          180198
     C                     MOVE XMDIN     ZMD                             180198
     C                     Z-ADDBCXR      ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    BCA1                            180198
     C*                                                                   180198
     C**  RUN DAY AMOUNT 1 = PRINCIPAL CONVERTED TO BASE CURRENCY AT      180198
     C**                     SPOT RATE                                    180198
     C                     Z-ADDPCPL      ZAMTCI                          180198
     C                     Z-ADDXSPOT     ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    RDA1                            180198
     C*                                                                   180198
     C**  INTEREST RATE                                                   180198
     C                     Z-ADDINTR      INTR                            180198
     C*                                                                   180198
     C**  SPREAD = RATE/SPREAD                                            180198
     C                     Z-ADDRTSP      SPRD                            180198
     C*                                                                   180198
     C**  BASE RATE CODE                                                  180198
     C                     Z-ADDBRTT      BRTT                            180198
     C*                                                                   180198
     C**  CURRENT BASE RATE                                               180198
     C                     Z-ADDBRTE      BRTE                            180198
     C*                                                                   180198
     C**  NEXT INTEREST PAYMENT DATE                                      180198
     C                     Z-ADDNIDT      NIPD                            180198
     C*                                                                   180198
     C**  LAST INTEREST PAYMENT DATE                                      180198
     C                     Z-ADDSLID      LIPD                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST POSTED TO DATE                                 180198
     C                     Z-ADDAIPD      AIPD                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST TO CONTROL DATE                                180198
     C                     Z-ADDAITC      AITC                            180198
     C*                                                                   180198
     C**  INTEREST ACCRUAL CONTROL DATE                                   180198
     C                     Z-ADDIACD      IACD                            180198
     C*                                                                   180198
     C**  INTEREST PAID/RECEIVED TO DATE                                  180198
     C                     Z-ADDIPRD      IPRD                            180198
     C*                                                                   180198
     C**  INTEREST PAID/RECEIVED THIS MONTH                               180198
     C                     Z-ADDIPRM      ITMT                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED                          180198
     C                     Z-ADDAIAN      AIAN                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST ADJUSTMENT POSTED                              180198
     C                     Z-ADDAIAP      AIAP                            180198
     C*                                                                   180198
     C**  INTEREST CAPITALIZED TO DATE                                    180198
     C                     Z-ADDICTD      ICTD                            180198
     C*                                                                   180198
     C**  INTEREST CALCULATION BASIS                                      180198
     C                     Z-ADDICBS      ICBS                            180198
     C*                                                                   180198
     C**  LAST CHANGE DATE                                                180198
     C                     Z-ADDLCD       LCD                             180198
     C*                                                                   180198
     C**  LAST CHANGE TYPE                                                180198
     C                     MOVE CHTP      CHTP                            180198
     C*                                                                   180198
     C**  WRITE RECORD TO MQALM                                           180198
     C                     WRITEMQALMF                                    180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C                     END                                            180198
     C*                                                                   180198
     C**  READ NEXT MM LOAN                                               180198
     C                     READ DLCHISPD                 50               180198
     C*                                                                   180198
     C                     END                                            180198
     C*                                                                   180198
     C**  CLOSE MM LOANS                                                  180198
     C                     CLOSEDLCHISPD                                  180198
     C*
     C                     ENDSR
     C*
     C/COPY WNCPYSRC,MQ552XC034
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. NAPURC - PROCESS NEGOTIABLE ASSETS PURCHASED              *
     C*                                                                  *
     C*    CALLED BY: MAIN   - MAIN PROCESSING                           *
     C*    CALLS:     ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               ZSEDIT - EDIT NUMERIC FIELDS                       *
     C*               ZDATE2 - CONVERT DAY NUMBER TO DDMMMYY FORMAT      *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           NAPURC    BEGSR
     C*
     C**  OPEN NAS PURCHASED FILE
     C                     OPEN DEALSDD
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  READ NAS PURCHASED FILE
     C                     READ DEALSDD                  50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C****IF*A*LIVE RECORD HAS BEEN READ                                  180198
     C/COPY WNCPYSRC,MQ552XC041
     C***********RECI      IFEQ 'D'                                       180198
     C           RECI      IFNE 'R'                                       180198
     C/COPY WNCPYSRC,MQ552XC012
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID
     C                     MOVE 'NAP'     MDID
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'DL'      IMID
     C*
     C**  DEAL NUMBER
     C**********           Z-ADDDLNO      DLNO                                                CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*
     C**  NAME
     C*
     C**  SET NAME ARRAY TO BLANKS
     C                     Z-ADD1         X       20
     C                     MOVEA*BLANKS   NMA,X
     C*
     C**  ACCESS CUSTOMER DETAILS FOR CUSTOMER REPORT NAME
     C                     MOVELISCN      CKEY
     C                     CALL 'AOCUSTR0'PLIST1
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDCUSTPD'DBFILE                          055237
     C                     MOVELCKEY      DBKEY                           055237
     C                     Z-ADD23        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C**  MOVE CUSTOMER REPORT NAME INTO NAME ARRAY
     C                     MOVEABBCRNM    NMA,X
     C                     ADD  17        X
     C*
     C**  IF DEAL TYPE IS 'C1', 'C2', 'BP' OR 'BD', SET UP INTEREST
     C**  RATE FOR NAME ARRAY
     C           DTYP      IFEQ 'C1'
     C           DTYP      OREQ 'C2'
     C           DTYP      OREQ 'BP'
     C           DTYP      OREQ 'BD'
     C*
     C**  EDIT INTEREST RATE
     C           INTR      IFNE *ZERO
     C                     Z-ADDINTR      WINTR   63H
     C                     MOVE WINTR     ZFLD15
     C                     Z-ADD3         ZDECS
     C                     EXSR ZSEDIT
     C*
     C**  MOVE INTEREST RATE TO NAME ARRAY
     C                     MOVE ZOUT21    WAINTR  8
     C                     MOVEAWAINTR    NMA,X
     C                     END
     C                     END
     C                     ADD  8         X
     C*
     C**  CONVERT MATURITY DATE TO DDMMMYY FORMAT
     C           MDAT      IFNE *ZERO
     C                     Z-ADDMDAT      ZDAYNO
     C                     EXSR ZDATE2
     C*
     C**  MOVE MONTH NAME AND YEAR OF MATURITY DATE TO NAME ARRAY
     C                     MOVE ZADATE    WMDAT   5
     C                     MOVEAWMDAT     NMA,X
     C                     END
     C*
     C**  MOVE NAME ARRAY TO NAME FIELD ON FILE
     C                     MOVEANMA       NAME
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  TRANSACTION TYPE
     C                     MOVELDTYP      TTYP
     C*
     C**  SUB-TYPE
     C                     MOVELDLST      SUBT
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDCNUM      CNUM                                                CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*
     C**  OTHER CUSTOMER NUMBER = ISSUED BY CUSTOMER NUMBER
     C**********           Z-ADDISCN      OCUS                                                CSD027
     C                     MOVE ISCN      OCUS                                                CSD027
     C*
     C**  LINKED DEAL NUMBER
     C                     Z-ADDLNKDN     LNKD
     C*
     C**  BOOK CODE
     C                     MOVE BOKC      BOKC
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE ORBR      ORBR
     C*
     C**  BROKER CODE
     C                     MOVE BRKC      BRKC
     C*
     C**  DEAL DATE
     C                     Z-ADDDDAT      DDAT
     C*
     C**  VALUE DATE
     C                     Z-ADDVDAT      VDAT
     C*
     C**  MATURITY DATE
     C                     Z-ADDMDAT      MDAT
     C*
     C**  CURRENCY 1
     C                     MOVE CCY       CCY1
     C*
     C**  AMOUNT 1 = FACE VALUE
     C                     Z-ADDFVAL      AMT1
     C*
     C**  BASE CURRENCY AMOUNT 1 = FACE VALUE CONVERTED TO BASE
     C**                           CURRENCY AT BASE CURRENCY EXCHANGE
     C**                           RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS
     C                     MOVE CCY       XCCY
     C                     EXSR CCYDEP
     C*
     C**  CONVERT FACE VALUE TO BASE CURRENCY USING BASE CURRENCY
     C**  EXCHANGE RATE ON FILE
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE CCY       ZCCYI
     C                     Z-ADDFVAL      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDBCXR      ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA1
     C*
     C**  RUN DAY AMOUNT 1 = FACE VALUE CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C                     Z-ADDFVAL      ZAMTCI
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2
     C                     MOVE CCY       CCY2
     C*
     C**  AMOUNT 2 = PURCHASE PRICE
     C                     Z-ADDPUPR      AMT2
     C*
     C**  BASE CURRENCY AMOUNT 2 = PURCHASE PRICE CONVERTED TO BASE
     C**                           CURRENCY AT BASE CURRENCY EXCHANGE
     C**                           RATE
     C                     Z-ADDPUPR      ZAMTCI
     C                     Z-ADDBCXR      ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA2
     C*
     C**  RUN DAY AMOUNT 2 = PURCHASE PRICE CONVERTED TO BASE CURRENCY
     C**                     AT SPOT RATE
     C                     Z-ADDPUPR      ZAMTCI
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA2
     C*
     C**  YIELD RATE
     C                     Z-ADDYRAT      YRAT
     C*
     C**  INTEREST RATE
     C                     Z-ADDINTR      INTR
     C*
     C**  NEXT INTEREST PAYMENT DATE
     C                     Z-ADDNIDT      NIPD
     C*
     C**  LAST INTEREST PAYMENT DATE
     C                     Z-ADDSLID      LIPD
     C*
     C**  ACCRUED INTEREST POSTED TO DATE
     C                     Z-ADDAIPD      AIPD
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE
     C                     Z-ADDAITC      AITC
     C*
     C**  INTEREST ACCRUAL CONTROL DATE
     C                     Z-ADDIACD      IACD
     C*
     C**  INTEREST PAID/RECEIVED TO DATE
     C                     Z-ADDIPRD      IPRD
     C*
     C**  INTEREST PAID/RECEIVED THIS MONTH
     C                     Z-ADDIPRM      ITMT
     C*
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED
     C                     Z-ADDAIAN      AIAN
     C*
     C**  ACCRUED INTEREST ADJUSTMENT POSTED
     C                     Z-ADDAIAP      AIAP
     C*
     C**  INTEREST CALCULATION BASIS
     C                     Z-ADDICBS      ICBS
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT NA PURCHASED
     C                     READ DEALSDD                  50
     C*
     C                     END
     C*
     C**  CLOSE NAS PURCHASED
     C                     CLOSEDEALSDD
     C*                                                                   180198
     C**  OPEN NAS PURCHASED FILE                                         180198
     C                     OPEN DLDHISPD                                  180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C*                                                                   180198
     C**  READ NAS PURCHASED FILE                                         180198
     C                     READ DLDHISPD                 50               180198
     C*                                                                   180198
     C**  DO WHILE NOT END OF FILE                                        180198
     C           *IN50     DOWEQ'0'                                       180198
     C*                                                                   180198
     C           RECI      IFNE 'R'                                       180198
     C*                                                                   180198
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE           180198
     C*                                                                   180198
     C**  MODULE ID                                                       180198
     C                     MOVE 'NAP'     MDID                            180198
     C*                                                                   180198
     C**  INTERNAL MODULE ID                                              180198
     C                     MOVE 'DL'      IMID                            180198
     C*                                                                   180198
     C**  DEAL NUMBER                                                     180198
     C**********           Z-ADDDLNO      DLNO                                         180198 CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*                                                                   180198
     C**  NAME                                                            180198
     C*                                                                   180198
     C**  SET NAME ARRAY TO BLANKS                                        180198
     C                     Z-ADD1         X       20                      180198
     C                     MOVEA*BLANKS   NMA,X                           180198
     C*                                                                   180198
     C**  ACCESS CUSTOMER DETAILS FOR CUSTOMER REPORT NAME                180198
     C                     MOVELISCN      CKEY                            180198
     C                     CALL 'AOCUSTR0'PLIST1                          180198
     C*                                                                   180198
     C           @RTCD     IFNE *BLANK                                    180198
     C                     MOVEL'SDCUSTPD'DBFILE                          180198
     C                     MOVELCKEY      DBKEY                           180198
     C                     Z-ADD23        DBASE                           180198
     C                     EXSR *PSSR                                     180198
     C                     END                                            180198
     C*                                                                   180198
     C**  MOVE CUSTOMER REPORT NAME INTO NAME ARRAY                       180198
     C                     MOVEABBCRNM    NMA,X                           180198
     C                     ADD  17        X                               180198
     C*                                                                   180198
     C**  IF DEAL TYPE IS 'C1', 'C2', 'BP' OR 'BD', SET UP INTEREST       180198
     C**  RATE FOR NAME ARRAY                                             180198
     C           DTYP      IFEQ 'C1'                                      180198
     C           DTYP      OREQ 'C2'                                      180198
     C           DTYP      OREQ 'BP'                                      180198
     C           DTYP      OREQ 'BD'                                      180198
     C*                                                                   180198
     C**  EDIT INTEREST RATE                                              180198
     C           INTR      IFNE *ZERO                                     180198
     C                     Z-ADDINTR      WINTR   63H                     180198
     C                     MOVE WINTR     ZFLD15                          180198
     C                     Z-ADD3         ZDECS                           180198
     C                     EXSR ZSEDIT                                    180198
     C*                                                                   180198
     C**  MOVE INTEREST RATE TO NAME ARRAY                                180198
     C                     MOVE ZOUT21    WAINTR  8                       180198
     C                     MOVEAWAINTR    NMA,X                           180198
     C                     END                                            180198
     C                     END                                            180198
     C                     ADD  8         X                               180198
     C*                                                                   180198
     C**  CONVERT MATURITY DATE TO DDMMMYY FORMAT                         180198
     C           MDAT      IFNE *ZERO                                     180198
     C                     Z-ADDMDAT      ZDAYNO                          180198
     C                     EXSR ZDATE2                                    180198
     C*                                                                   180198
     C**  MOVE MONTH NAME AND YEAR OF MATURITY DATE TO NAME ARRAY         180198
     C                     MOVE ZADATE    WMDAT   5                       180198
     C                     MOVEAWMDAT     NMA,X                           180198
     C                     END                                            180198
     C*                                                                   180198
     C**  MOVE NAME ARRAY TO NAME FIELD ON FILE                           180198
     C                     MOVEANMA       NAME                            180198
     C*                                                                   180198
     C**  BRANCH CODE                                                     180198
     C                     MOVE BRCA      BRCA                            180198
     C*                                                                   180198
     C**  PROFIT CENTRE                                                   180198
     C                     MOVE PRFC      PRFC                            180198
     C*                                                                   180198
     C**  TRANSACTION TYPE                                                180198
     C                     MOVELDTYP      TTYP                            180198
     C*                                                                   180198
     C**  SUB-TYPE                                                        180198
     C                     MOVELDLST      SUBT                            180198
     C*                                                                   180198
     C**  CUSTOMER NUMBER                                                 180198
     C**********           Z-ADDCNUM      CNUM                                         180198 CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*                                                                   180198
     C**  OTHER CUSTOMER NUMBER = ISSUED BY CUSTOMER NUMBER               180198
     C**********           Z-ADDISCN      OCUS                                         180198 CSD027
     C                     MOVE ISCN      OCUS                                                CSD027
     C*                                                                   180198
     C**  LINKED DEAL NUMBER                                              180198
     C                     Z-ADDLNKDN     LNKD                            180198
     C*                                                                   180198
     C**  BOOK CODE                                                       180198
     C                     MOVE BOKC      BOKC                            180198
     C*                                                                   180198
     C**  ORIGINATING BRANCH                                              180198
     C                     MOVE ORBR      ORBR                            180198
     C*                                                                   180198
     C**  BROKER CODE                                                     180198
     C                     MOVE BRKC      BRKC                            180198
     C*                                                                   180198
     C**  DEAL DATE                                                       180198
     C                     Z-ADDDDAT      DDAT                            180198
     C*                                                                   180198
     C**  VALUE DATE                                                      180198
     C                     Z-ADDVDAT      VDAT                            180198
     C*                                                                   180198
     C**  MATURITY DATE                                                   180198
     C                     Z-ADDMDAT      MDAT                            180198
     C*                                                                   180198
     C**  CURRENCY 1                                                      180198
     C                     MOVE CCY       CCY1                            180198
     C*                                                                   180198
     C**  AMOUNT 1 = FACE VALUE                                           180198
     C                     Z-ADDFVAL      AMT1                            180198
     C*                                                                   180198
     C**  BASE CURRENCY AMOUNT 1 = FACE VALUE CONVERTED TO BASE           180198
     C**                           CURRENCY AT BASE CURRENCY EXCHANGE     180198
     C**                           RATE                                   180198
     C*                                                                   180198
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS              180198
     C                     MOVE CCY       XCCY                            180198
     C                     EXSR CCYDEP                                    180198
     C*                                                                   180198
     C**  CONVERT FACE VALUE TO BASE CURRENCY USING BASE CURRENCY         180198
     C**  EXCHANGE RATE ON FILE                                           180198
     C                     Z-ADDXDECP     ZCDPI                           180198
     C                     MOVE CCY       ZCCYI                           180198
     C                     Z-ADDFVAL      ZAMTCI                          180198
     C                     MOVE XMDIN     ZMD                             180198
     C                     Z-ADDBCXR      ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    BCA1                            180198
     C*                                                                   180198
     C**  RUN DAY AMOUNT 1 = FACE VALUE CONVERTED TO BASE CURRENCY AT     180198
     C**                     SPOT RATE                                    180198
     C                     Z-ADDFVAL      ZAMTCI                          180198
     C                     Z-ADDXSPOT     ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    RDA1                            180198
     C*                                                                   180198
     C**  CURRENCY 2                                                      180198
     C                     MOVE CCY       CCY2                            180198
     C*                                                                   180198
     C**  AMOUNT 2 = PURCHASE PRICE                                       180198
     C                     Z-ADDPUPR      AMT2                            180198
     C*                                                                   180198
     C**  BASE CURRENCY AMOUNT 2 = PURCHASE PRICE CONVERTED TO BASE       180198
     C**                           CURRENCY AT BASE CURRENCY EXCHANGE     180198
     C**                           RATE                                   180198
     C                     Z-ADDPUPR      ZAMTCI                          180198
     C                     Z-ADDBCXR      ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    BCA2                            180198
     C*                                                                   180198
     C**  RUN DAY AMOUNT 2 = PURCHASE PRICE CONVERTED TO BASE CURRENCY    180198
     C**                     AT SPOT RATE                                 180198
     C                     Z-ADDPUPR      ZAMTCI                          180198
     C                     Z-ADDXSPOT     ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    RDA2                            180198
     C*                                                                   180198
     C**  YIELD RATE                                                      180198
     C                     Z-ADDYRAT      YRAT                            180198
     C*                                                                   180198
     C**  INTEREST RATE                                                   180198
     C                     Z-ADDINTR      INTR                            180198
     C*                                                                   180198
     C**  NEXT INTEREST PAYMENT DATE                                      180198
     C                     Z-ADDNIDT      NIPD                            180198
     C*                                                                   180198
     C**  LAST INTEREST PAYMENT DATE                                      180198
     C                     Z-ADDSLID      LIPD                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST POSTED TO DATE                                 180198
     C                     Z-ADDAIPD      AIPD                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST TO CONTROL DATE                                180198
     C                     Z-ADDAITC      AITC                            180198
     C*                                                                   180198
     C**  INTEREST ACCRUAL CONTROL DATE                                   180198
     C                     Z-ADDIACD      IACD                            180198
     C*                                                                   180198
     C**  INTEREST PAID/RECEIVED TO DATE                                  180198
     C                     Z-ADDIPRD      IPRD                            180198
     C*                                                                   180198
     C**  INTEREST PAID/RECEIVED THIS MONTH                               180198
     C                     Z-ADDIPRM      ITMT                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED                          180198
     C                     Z-ADDAIAN      AIAN                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST ADJUSTMENT POSTED                              180198
     C                     Z-ADDAIAP      AIAP                            180198
     C*                                                                   180198
     C**  INTEREST CALCULATION BASIS                                      180198
     C                     Z-ADDICBS      ICBS                            180198
     C*                                                                   180198
     C**  LAST CHANGE DATE                                                180198
     C                     Z-ADDLCD       LCD                             180198
     C*                                                                   180198
     C**  LAST CHANGE TYPE                                                180198
     C                     MOVE CHTP      CHTP                            180198
     C*                                                                   180198
     C**  WRITE RECORD TO MQALM                                           180198
     C                     WRITEMQALMF                                    180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C                     END                                            180198
     C*                                                                   180198
     C**  READ NEXT NA PURCHASED                                          180198
     C                     READ DLDHISPD                 50               180198
     C*                                                                   180198
     C                     END                                            180198
     C*                                                                   180198
     C**  CLOSE NAS PURCHASED                                             180198
     C                     CLOSEDLDHISPD                                  180198
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. NASOLD - PROCESS NEGOTIABLE ASSETS SOLD                   *
     C*                                                                  *
     C*    CALLED BY: MAIN   - MAIN PROCESSING                           *
     C*    CALLS:     ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               ZSEDIT - EDIT NUMERIC FIELDS                       *
     C*               ZDATE2 - CONVERT DAY NUMBER TO DDMMMYY FORMAT      *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           NASOLD    BEGSR
     C*
     C**  OPEN NAS SOLD FILE
     C                     OPEN DEALSDE
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  READ NAS SOLD FILE
     C                     READ DEALSDE                  50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C****IF*A*LIVE RECORD HAS BEEN READ                                  180198
     C***********RECI      IFEQ 'D'                                       180198
     C           RECI      IFNE 'R'                                       180198
     C/COPY WNCPYSRC,MQ552XC013
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID
     C                     MOVE 'NAS'     MDID
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'DL'      IMID
     C*
     C**  DEAL NUMBER
     C**********           Z-ADDDLNO      DLNO                                                CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*
     C**  NAME
     C*
     C**  SET NAME ARRAY TO BLANKS
     C                     Z-ADD1         X
     C                     MOVEA*BLANKS   NMA,X
     C*
     C**  ACCESS CUSTOMER DETAILS FOR CUSTOMER REPORT NAME
     C                     MOVELISCN      CKEY
     C                     CALL 'AOCUSTR0'PLIST1
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDCUSTPD'DBFILE                          055237
     C                     MOVELCKEY      DBKEY                           055237
     C                     Z-ADD24        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C**  MOVE CUSTOMER REPORT NAME INTO NAME ARRAY
     C                     MOVEABBCRNM    NMA,X
     C                     ADD  17        X
     C*
     C**  IF DEAL TYPE IS 'BS', 'BR' OR 'CS', SET UP INTEREST RATE FOR
     C**  NAME ARRAY
     C           DTYP      IFEQ 'BS'
     C           DTYP      OREQ 'BR'
     C           DTYP      OREQ 'CS'
     C*
     C**  EDIT INTEREST RATE
     C           INTR      IFNE *ZERO
     C                     Z-ADDINTR      WINTR     H
     C                     MOVE WINTR     ZFLD15
     C                     Z-ADD3         ZDECS
     C                     EXSR ZSEDIT
     C*
     C**  MOVE INTEREST RATE TO NAME ARRAY
     C                     MOVE ZOUT21    WAINTR
     C                     MOVEAWAINTR    NMA,X
     C                     END
     C                     END
     C                     ADD  8         X
     C*
     C**  CONVERT MATURITY DATE TO DDMMMYY FORMAT
     C           PMDT      IFNE *ZERO
     C                     Z-ADDPMDT      ZDAYNO
     C                     EXSR ZDATE2
     C*
     C**  MOVE MONTH NAME AND YEAR OF MATURITY DATE TO NAME ARRAY
     C                     MOVE ZADATE    WMDAT
     C                     MOVEAWMDAT     NMA,X
     C                     END
     C*
     C**  MOVE NAME ARRAY TO NAME FIELD ON FILE
     C                     MOVEANMA       NAME
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  TRANSACTION TYPE
     C                     MOVELDTYP      TTYP
     C*
     C**  SUB-TYPE
     C                     MOVELDLST      SUBT
     C*
     C**  CUSTOMER NUMBER = SOLD TO CUSTOMER NUMBER
     C**********           Z-ADDSCUS      CNUM                                                CSD027
     C                     MOVE SCUS      CNUM                                                CSD027
     C*
     C**  OTHER CUSTOMER NUMBER = ISSUED BY CUSTOMER NUMBER
     C**********           Z-ADDISCN      OCUS                                                CSD027
     C                     MOVE ISCN      OCUS                                                CSD027
     C*
     C**  LINKED DEAL NUMBER
     C                     Z-ADDLNKDN     LNKD
     C*
     C**  BOOK CODE
     C                     MOVE BOKC      BOKC
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE ORBR      ORBR
     C*
     C**  BROKER CODE
     C                     MOVE BRKC      BRKC
     C*
     C**  ASSOCIATED DEAL NUMBER = RELATED PURCHASE DEAL NUMBER
     C**********           Z-ADDRPDN      ADLN                                                CLE148
     C                     MOVE RPDN      ADLN                                                CLE148
     C*
     C**  DEAL DATE
     C                     Z-ADDDDAT      DDAT
     C*
     C**  VALUE DATE
     C                     Z-ADDVDAT      VDAT
     C*
     C**  MATURITY DATE = RELATED PURCHASE DEAL MATURITY DATE
     C                     Z-ADDPMDT      MDAT
     C*
     C**  CURRENCY 1
     C                     MOVE CCY       CCY1
     C*
     C**  AMOUNT 1 = FACE VALUE
     C                     Z-ADDFVAL      AMT1
     C*
     C**  BASE CURRENCY AMOUNT 1 = FACE VALUE CONVERTED TO BASE
     C**                           CURRENCY AT BASE CURRENCY EXCHANGE
     C**                           RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS
     C                     MOVE CCY       XCCY
     C                     EXSR CCYDEP
     C*
     C**  CONVERT FACE VALUE TO BASE CURRENCY USING BASE CURRENCY
     C**  EXCHANGE RATE ON FILE
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE CCY       ZCCYI
     C                     Z-ADDFVAL      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDBCXR      ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA1
     C*
     C**  RUN DAY AMOUNT 1 = FACE VALUE CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C                     Z-ADDFVAL      ZAMTCI
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2
     C                     MOVE CCY       CCY2
     C*
     C**  AMOUNT 2 = SALE PRICE
     C                     Z-ADDSAPR      AMT2
     C*
     C**  BASE CURRENCY AMOUNT 2 = SALE PRICE CONVERTED TO BASE
     C**                           CURRENCY AT BASE CURRENCY EXCHANGE
     C**                           RATE
     C                     Z-ADDSAPR      ZAMTCI
     C                     Z-ADDBCXR      ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA2
     C*
     C**  RUN DAY AMOUNT 2 = SALE PRICE CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C                     Z-ADDSAPR      ZAMTCI
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA2
     C*
     C**  YIELD RATE
     C                     Z-ADDYRAT      YRAT
     C*
     C**  INTEREST RATE
     C                     Z-ADDINTR      INTR
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT NA SOLD
     C                     READ DEALSDE                  50
     C*
     C                     END
     C*
     C**  CLOSE NAS SOLD
     C                     CLOSEDEALSDE
     C*                                                                   180198
     C**  OPEN NAS SOLD FILE                                              180198
     C                     OPEN DLEHISPD                                  180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C*                                                                   180198
     C**  READ NAS SOLD FILE                                              180198
     C                     READ DLEHISPD                 50               180198
     C*                                                                   180198
     C**  DO WHILE NOT END OF FILE                                        180198
     C           *IN50     DOWEQ'0'                                       180198
     C*                                                                   180198
     C           RECI      IFNE 'R'                                       180198
     C*                                                                   180198
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE           180198
     C*                                                                   180198
     C**  MODULE ID                                                       180198
     C                     MOVE 'NAS'     MDID                            180198
     C*                                                                   180198
     C**  INTERNAL MODULE ID                                              180198
     C                     MOVE 'DL'      IMID                            180198
     C*                                                                   180198
     C**  DEAL NUMBER                                                     180198
     C**********           Z-ADDDLNO      DLNO                                         180198 CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*                                                                   180198
     C**  NAME                                                            180198
     C*                                                                   180198
     C**  SET NAME ARRAY TO BLANKS                                        180198
     C                     Z-ADD1         X                               180198
     C                     MOVEA*BLANKS   NMA,X                           180198
     C*                                                                   180198
     C**  ACCESS CUSTOMER DETAILS FOR CUSTOMER REPORT NAME                180198
     C                     MOVELISCN      CKEY                            180198
     C                     CALL 'AOCUSTR0'PLIST1                          180198
     C*                                                                   180198
     C           @RTCD     IFNE *BLANK                                    180198
     C                     MOVEL'SDCUSTPD'DBFILE                          180198
     C                     MOVELCKEY      DBKEY                           180198
     C                     Z-ADD24        DBASE                           180198
     C                     EXSR *PSSR                                     180198
     C                     END                                            180198
     C*                                                                   180198
     C**  MOVE CUSTOMER REPORT NAME INTO NAME ARRAY                       180198
     C                     MOVEABBCRNM    NMA,X                           180198
     C                     ADD  17        X                               180198
     C*                                                                   180198
     C**  IF DEAL TYPE IS 'BS', 'BR' OR 'CS', SET UP INTEREST RATE FOR    180198
     C**  NAME ARRAY                                                      180198
     C           DTYP      IFEQ 'BS'                                      180198
     C           DTYP      OREQ 'BR'                                      180198
     C           DTYP      OREQ 'CS'                                      180198
     C*                                                                   180198
     C**  EDIT INTEREST RATE                                              180198
     C           INTR      IFNE *ZERO                                     180198
     C                     Z-ADDINTR      WINTR     H                     180198
     C                     MOVE WINTR     ZFLD15                          180198
     C                     Z-ADD3         ZDECS                           180198
     C                     EXSR ZSEDIT                                    180198
     C*                                                                   180198
     C**  MOVE INTEREST RATE TO NAME ARRAY                                180198
     C                     MOVE ZOUT21    WAINTR                          180198
     C                     MOVEAWAINTR    NMA,X                           180198
     C                     END                                            180198
     C                     END                                            180198
     C                     ADD  8         X                               180198
     C*                                                                   180198
     C**  CONVERT MATURITY DATE TO DDMMMYY FORMAT                         180198
     C           PMDT      IFNE *ZERO                                     180198
     C                     Z-ADDPMDT      ZDAYNO                          180198
     C                     EXSR ZDATE2                                    180198
     C*                                                                   180198
     C**  MOVE MONTH NAME AND YEAR OF MATURITY DATE TO NAME ARRAY         180198
     C                     MOVE ZADATE    WMDAT                           180198
     C                     MOVEAWMDAT     NMA,X                           180198
     C                     END                                            180198
     C*                                                                   180198
     C**  MOVE NAME ARRAY TO NAME FIELD ON FILE                           180198
     C                     MOVEANMA       NAME                            180198
     C*                                                                   180198
     C**  BRANCH CODE                                                     180198
     C                     MOVE BRCA      BRCA                            180198
     C*                                                                   180198
     C**  PROFIT CENTRE                                                   180198
     C                     MOVE PRFC      PRFC                            180198
     C*                                                                   180198
     C**  TRANSACTION TYPE                                                180198
     C                     MOVELDTYP      TTYP                            180198
     C*                                                                   180198
     C**  SUB-TYPE                                                        180198
     C                     MOVELDLST      SUBT                            180198
     C*                                                                   180198
     C**  CUSTOMER NUMBER = SOLD TO CUSTOMER NUMBER                       180198
     C**********           Z-ADDSCUS      CNUM                                         180198 CSD027
     C                     MOVE SCUS      CNUM                                                CSD027
     C*                                                                   180198
     C**  OTHER CUSTOMER NUMBER = ISSUED BY CUSTOMER NUMBER               180198
     C**********           Z-ADDISCN      OCUS                                         180198 CSD027
     C                     MOVE ISCN      OCUS                                                CSD027
     C*                                                                   180198
     C**  LINKED DEAL NUMBER                                              180198
     C                     Z-ADDLNKDN     LNKD                            180198
     C*                                                                   180198
     C**  BOOK CODE                                                       180198
     C                     MOVE BOKC      BOKC                            180198
     C*                                                                   180198
     C**  ORIGINATING BRANCH                                              180198
     C                     MOVE ORBR      ORBR                            180198
     C*                                                                   180198
     C**  BROKER CODE                                                     180198
     C                     MOVE BRKC      BRKC                            180198
     C*                                                                   180198
     C**  ASSOCIATED DEAL NUMBER = RELATED PURCHASE DEAL NUMBER           180198
     C**********           Z-ADDRPDN      ADLN                                         180198 CLE148
     C                     MOVE RPDN      ADLN                                                CLE148
     C*                                                                   180198
     C**  DEAL DATE                                                       180198
     C                     Z-ADDDDAT      DDAT                            180198
     C*                                                                   180198
     C**  VALUE DATE                                                      180198
     C                     Z-ADDVDAT      VDAT                            180198
     C*                                                                   180198
     C**  MATURITY DATE = RELATED PURCHASE DEAL MATURITY DATE             180198
     C                     Z-ADDPMDT      MDAT                            180198
     C*                                                                   180198
     C**  CURRENCY 1                                                      180198
     C                     MOVE CCY       CCY1                            180198
     C*                                                                   180198
     C**  AMOUNT 1 = FACE VALUE                                           180198
     C                     Z-ADDFVAL      AMT1                            180198
     C*                                                                   180198
     C**  BASE CURRENCY AMOUNT 1 = FACE VALUE CONVERTED TO BASE           180198
     C**                           CURRENCY AT BASE CURRENCY EXCHANGE     180198
     C**                           RATE                                   180198
     C*                                                                   180198
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS              180198
     C                     MOVE CCY       XCCY                            180198
     C                     EXSR CCYDEP                                    180198
     C*                                                                   180198
     C**  CONVERT FACE VALUE TO BASE CURRENCY USING BASE CURRENCY         180198
     C**  EXCHANGE RATE ON FILE                                           180198
     C                     Z-ADDXDECP     ZCDPI                           180198
     C                     MOVE CCY       ZCCYI                           180198
     C                     Z-ADDFVAL      ZAMTCI                          180198
     C                     MOVE XMDIN     ZMD                             180198
     C                     Z-ADDBCXR      ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    BCA1                            180198
     C*                                                                   180198
     C**  RUN DAY AMOUNT 1 = FACE VALUE CONVERTED TO BASE CURRENCY AT     180198
     C**                     SPOT RATE                                    180198
     C                     Z-ADDFVAL      ZAMTCI                          180198
     C                     Z-ADDXSPOT     ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    RDA1                            180198
     C*                                                                   180198
     C**  CURRENCY 2                                                      180198
     C                     MOVE CCY       CCY2                            180198
     C*                                                                   180198
     C**  AMOUNT 2 = SALE PRICE                                           180198
     C                     Z-ADDSAPR      AMT2                            180198
     C*                                                                   180198
     C**  BASE CURRENCY AMOUNT 2 = SALE PRICE CONVERTED TO BASE           180198
     C**                           CURRENCY AT BASE CURRENCY EXCHANGE     180198
     C**                           RATE                                   180198
     C                     Z-ADDSAPR      ZAMTCI                          180198
     C                     Z-ADDBCXR      ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    BCA2                            180198
     C*                                                                   180198
     C**  RUN DAY AMOUNT 2 = SALE PRICE CONVERTED TO BASE CURRENCY AT     180198
     C**                     SPOT RATE                                    180198
     C                     Z-ADDSAPR      ZAMTCI                          180198
     C                     Z-ADDXSPOT     ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    RDA2                            180198
     C*                                                                   180198
     C**  YIELD RATE                                                      180198
     C                     Z-ADDYRAT      YRAT                            180198
     C*                                                                   180198
     C**  INTEREST RATE                                                   180198
     C                     Z-ADDINTR      INTR                            180198
     C*                                                                   180198
     C**  LAST CHANGE DATE                                                180198
     C                     Z-ADDLCD       LCD                             180198
     C*                                                                   180198
     C**  LAST CHANGE TYPE                                                180198
     C                     MOVE CHTP      CHTP                            180198
     C*                                                                   180198
     C**  WRITE RECORD TO MQALM                                           180198
     C                     WRITEMQALMF                                    180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C                     END                                            180198
     C*                                                                   180198
     C**  READ NEXT NA SOLD                                               180198
     C                     READ DLEHISPD                 50               180198
     C*                                                                   180198
     C                     END                                            180198
     C*                                                                   180198
     C**  CLOSE NAS SOLD                                                  180198
     C                     CLOSEDLEHISPD                                  180198
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. FRAIRS - PROCESS FRA/IRS                                  *
     C*                                                                  *
     C*    CALLED BY: MAIN   - MAIN PROCESSING                           *
     C*    CALLS:     ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               FRRSRX - PROCESS FRAS AND IRSS                     *
     C*               RPRRRF - PROCESS CAPS, COLLARS AND FLOORS          *
     C*                                                                  *
     C********************************************************************
     C*
     C           FRAIRS    BEGSR
     C*
     C**  OPEN FRA/IRS FILE
     C                     OPEN DEALSDG
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  READ FRA/IRS FILE
     C                     READ DEALSDG                  50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C****IF*A*LIVE RECORD HAS BEEN READ                                  180198
     C***********RECI      IFEQ 'D'                                       180198
     C           RECI      IFNE 'R'                                       180198
     C/COPY WNCPYSRC,MQ552XC014
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  SET UP FIELDS COMMON TO ALL DEAL TYPES
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'DL'      IMID
     C*
     C**  DEAL NUMBER
     C**********           Z-ADDDLNO      DLNO                                                CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  TRANSACTION TYPE
     C                     MOVELDTYP      TTYP
     C*
     C**  SUB-TYPE
     C                     MOVELDLST      SUBT
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDCNUM      CNUM                                                CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*
     C**  LINKED DEAL NUMBER
     C                     Z-ADDLNKDN     LNKD
     C*
     C**  BOOK CODE
     C                     MOVE BOKC      BOKC
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE ORBR      ORBR
     C*
     C**  BROKER CODE
     C                     MOVE BRKC      BRKC
     C*
     C**  DEAL DATE
     C                     Z-ADDDDAT      DDAT
     C*
     C**  VALUE DATE
     C                     Z-ADDVDAT      VDAT
     C*
     C**  MATURITY DATE
     C                     Z-ADDMDAT      MDAT
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  EXECUTE SUBROUTINE ACCORDING TO DEAL TYPE
     C           DTYP      IFEQ 'FR'
     C           DTYP      OREQ 'RS'
     C           DTYP      OREQ 'RX'
     C                     EXSR FRRSRX
     C                     END
     C*
     C           DTYP      IFEQ 'RP'
     C           DTYP      OREQ 'RR'
     C           DTYP      OREQ 'RF'
     C                     EXSR RPRRRF
     C                     END
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT FRA/IRS
     C                     READ DEALSDG                  50
     C*
     C                     END
     C*
     C**  CLOSE FRA/IRS FILE
     C                     CLOSEDEALSDG
     C*                                                                   180198
     C**  OPEN FRA/IRS FILE                                               180198
     C                     OPEN DLGHISPD                                  180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C*                                                                   180198
     C**  READ FRA/IRS FILE                                               180198
     C                     READ DLGHISPD                 50               180198
     C*                                                                   180198
     C**  DO WHILE NOT END OF FILE                                        180198
     C           *IN50     DOWEQ'0'                                       180198
     C*                                                                   180198
     C           RECI      IFNE 'R'                                       180198
     C*                                                                   180198
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE           180198
     C*                                                                   180198
     C**  SET UP FIELDS COMMON TO ALL DEAL TYPES                          180198
     C*                                                                   180198
     C**  INTERNAL MODULE ID                                              180198
     C                     MOVE 'DL'      IMID                            180198
     C*                                                                   180198
     C**  DEAL NUMBER                                                     180198
     C**********           Z-ADDDLNO      DLNO                                         180198 CLE148
     C                     MOVELDLNONM    DLNO                                                CLE148
     C*                                                                   180198
     C**  BRANCH CODE                                                     180198
     C                     MOVE BRCA      BRCA                            180198
     C*                                                                   180198
     C**  PROFIT CENTRE                                                   180198
     C                     MOVE PRFC      PRFC                            180198
     C*                                                                   180198
     C**  TRANSACTION TYPE                                                180198
     C                     MOVELDTYP      TTYP                            180198
     C*                                                                   180198
     C**  SUB-TYPE                                                        180198
     C                     MOVELDLST      SUBT                            180198
     C*                                                                   180198
     C**  CUSTOMER NUMBER                                                 180198
     C**********           Z-ADDCNUM      CNUM                                         180198 CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*                                                                   180198
     C**  LINKED DEAL NUMBER                                              180198
     C                     Z-ADDLNKDN     LNKD                            180198
     C*                                                                   180198
     C**  BOOK CODE                                                       180198
     C                     MOVE BOKC      BOKC                            180198
     C*                                                                   180198
     C**  ORIGINATING BRANCH                                              180198
     C                     MOVE ORBR      ORBR                            180198
     C*                                                                   180198
     C**  BROKER CODE                                                     180198
     C                     MOVE BRKC      BRKC                            180198
     C*                                                                   180198
     C**  DEAL DATE                                                       180198
     C                     Z-ADDDDAT      DDAT                            180198
     C*                                                                   180198
     C**  VALUE DATE                                                      180198
     C                     Z-ADDVDAT      VDAT                            180198
     C*                                                                   180198
     C**  MATURITY DATE                                                   180198
     C                     Z-ADDMDAT      MDAT                            180198
     C*                                                                   180198
     C**  LAST CHANGE DATE                                                180198
     C                     Z-ADDLCD       LCD                             180198
     C*                                                                   180198
     C**  LAST CHANGE TYPE                                                180198
     C                     MOVE CHTP      CHTP                            180198
     C*                                                                   180198
     C**  EXECUTE SUBROUTINE ACCORDING TO DEAL TYPE                       180198
     C           DTYP      IFEQ 'FR'                                      180198
     C           DTYP      OREQ 'RS'                                      180198
     C           DTYP      OREQ 'RX'                                      180198
     C                     EXSR FRRSRX                                    180198
     C                     END                                            180198
     C*                                                                   180198
     C           DTYP      IFEQ 'RP'                                      180198
     C           DTYP      OREQ 'RR'                                      180198
     C           DTYP      OREQ 'RF'                                      180198
     C                     EXSR RPRRRF                                    180198
     C                     END                                            180198
     C*                                                                   180198
     C**  WRITE RECORD TO MQALM                                           180198
     C                     WRITEMQALMF                                    180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C                     END                                            180198
     C*                                                                   180198
     C**  READ NEXT FRA/IRS                                               180198
     C                     READ DLGHISPD                 50               180198
     C*                                                                   180198
     C                     END                                            180198
     C*                                                                   180198
     C**  CLOSE FRA/IRS FILE                                              180198
     C                     CLOSEDLGHISPD                                  180198
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. FRRSRX - PROCESS FRAS AND IRSS                            *
     C*                                                                  *
     C*    CALLED BY: FRAIRS - PROCESS FRA/IRS                           *
     C*    CALLS:                                                        *
     C*                                                                  *
     C********************************************************************
     C*
     C           FRRSRX    BEGSR
     C*
     C**  MODULE ID
     C*
     C**  FORWARD RATE AGREEMENTS
     C           DTYP      IFEQ 'FR'
     C           BYSL      IFEQ 'B'
     C                     MOVE 'FRB'     MDID
     C                     ELSE
     C                     MOVE 'FRS'     MDID
     C                     END
     C                     END
     C*
     C**  INTEREST RATE SWAP
     C           DTYP      IFEQ 'RS'
     C           DTYP      OREQ 'RX'
     C                     MOVE 'IRS'     MDID
     C                     END
     C*
     C**  NAME
     C*
     C**  FORWARD RATE AGREEMENT
     C           DTYP      IFEQ 'FR'
     C                     MOVELTXT,15    NAME
     C                     END
     C*
     C**  INTEREST RATE SWAP
     C           DTYP      IFEQ 'RS'
     C           DTYP      OREQ 'RX'
     C                     MOVELTXT,16    NAME
     C                     END
     C*
     C**  CURRENCY 1 = OUR CURRENCY
     C                     MOVE UCUCY     CCY1
     C*
     C**  AMOUNT 1 = OUR PRINCIPAL AMOUNT
     C                     Z-ADDUPAMT     AMT1
     C*
     C**  BASE CURRENCY AMOUNT 1 = AMOUNT 1 CONVERTED TO BASE CURRENCY
     C**                           AT OUR BASE CURRENCY EXCHANGE RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS
     C                     MOVE CCY1      XCCY
     C                     EXSR CCYDEP
     C*
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE CCY1      ZCCYI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDAMT1      ZAMTCI
     C                     Z-ADDUBCXR     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA1
     C*
     C**  RUN DAY AMOUNT 1 = AMOUNT 1 CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C                     Z-ADDAMT1      ZAMTCI
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2 = THEIR CURRENCY FOR INTEREST RATE SWAPS
     C           MDID      IFEQ 'IRS'
     C                     MOVE TCUCY     CCY2
     C                     END
     C*
     C**  AMOUNT 2 = THEIR PRINCIPAL AMOUNT FOR CROSS CURRENCY INTEREST
     C**             RATE SWAPS
     C           DTYP      IFEQ 'RX'
     C                     Z-ADDTPAMT     AMT2
     C                     END
     C*
     C**  BASE CURRENCY AMOUNT 2 = THEIR PRINCIPAL AMOUNT CONVERTED TO
     C**                           BASE CURRENCY AT THEIR BASE CURRENCY
     C**                           EXCHANGE RATE FOR CROSS CURRENCY
     C**                           INTEREST RATE SWAPS
     C           DTYP      IFEQ 'RX'
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS
     C                     MOVE CCY2      XCCY
     C                     EXSR CCYDEP
     C*
     C**  CONVERT THIER PRINCIPAL AMOUNT TO BASE CURRENCY USING THEIR
     C**  BASE CURRENCY EXCHANGE RATE ON FILE
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE CCY2      ZCCYI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDAMT2      ZAMTCI
     C                     Z-ADDTBCXR     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA2
     C                     END
     C*
     C**  RUN DAY AMOUNT 2 = THEIR PRINCIPAL AMOUNT CONVERTED TO BASE
     C**                     CURRENCY AT SPOT RATE FOR CROSS CURRENCY
     C**                     INTEREST RATE SWAPS
     C           DTYP      IFEQ 'RX'
     C                     Z-ADDAMT2      ZAMTCI
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA2
     C                     END
     C*
     C**  INTEREST RATE = OUR EFFECTIVE INTEREST RATE
     C                     Z-ADDUEINR     INTR
     C*
     C**  SPREAD = OUR SPREAD RATE FOR IRS
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDURTSP     SPRD
     C                     END
     C*
     C**  BASE RATE CODE = OUR BASE RATE TYPE
     C                     Z-ADDUBRTT     BRTT
     C*
     C**  CURRENT BASE RATE = OUR BASE RATE
     C                     Z-ADDUBRTE     BRTE
     C*
     C**  NEXT INTEREST PAYMENT DATE
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDUNIPD     NIPD
     C                     END
     C*
     C**  LAST INTEREST PAYMENT DATE
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDUSLIP     LIPD
     C                     END
     C*
     C**  NEXT RATE CHANGE DATE
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDUNICD     NRCD
     C                     END
     C*
     C**  ACCRUED INTEREST POSTED TO DATE
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDUAIPD     AIPD
     C                     END
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDUAITC     AITC
     C                     END
     C*
     C**  INTEREST ACCRUAL CONTROL DATE
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDUIACD     IACD
     C                     END
     C*
     C**  INTEREST PAID/RECEIVED TO DATE = OUR INTEREST PAID/RECEIVED
     C**                                   TO DATE
     C                     Z-ADDUIPRD     IPRD
     C*
     C**  INTEREST PAID/RECEIVED THIS MONTH = OUR INTEREST PAID/
     C**                                      RECEIVED THIS MONTH
     C                     Z-ADDUIPRM     ITMT
     C*
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED
     C                     Z-ADDUAIAN     AIAN
     C*
     C**  ACCRUED INTEREST ADJUSTMENT POSTED
     C                     Z-ADDUAIAP     AIAP
     C*
     C**  INTEREST CALCULATION BASIS = OUR INTEREST CALCULATION BASIS
     C                     Z-ADDUICBS     ICBS
     C*
     C**  INTEREST RATE 2 = THEIR EFFECTIVE INTEREST RATE
     C                     Z-ADDTEINR     INT2
     C*
     C**  SPREAD 2 = THEIR SPREAD RATE FOR IRS
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDTRTSP     SPR2
     C                     END
     C*
     C**  BASE RATE CODE 2 = THEIR BASE RATE TYPE
     C                     Z-ADDTBRTT     BRT2
     C*
     C**  BASE RATE 2 = THEIR BASE RATE
     C                     Z-ADDTBRTE     BRA2
     C*
     C**  NEXT INTEREST PAYMENT DATE 2 = THEIR NEXT INTEREST PAYMENT
     C**                                 DATE FOR IRS
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDTNIPD     NIP2
     C                     END
     C*
     C**  LAST INTEREST PAYMENT DATE 2 = THEIR START/LAST INTEREST
     C**                                 PAYMENT DATE FOR IRS
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDTSLIP     LIP2
     C                     END
     C*
     C**  NEXT RATE CHANGE DATE 2 = THEIR NEXT RATE CHANGE DATE FOR
     C**                            IRS
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDTNICD     NRC2
     C                     END
     C*
     C**  ACCRUED INTEREST POSTED TO DATE 2 = THEIR ACCRUED INTEREST
     C**                                      POSTED FOR IRS
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDTAIPD     AIP2
     C                     END
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE 2 = THEIR ACCRUED INTEREST
     C**                                       TO CONTROL DATE FOR IRS
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDTAITC     AIT2
     C                     END
     C*
     C**  INTEREST ACCRUAL CONTROL DATE 2 = THEIR INTEREST ACCRUAL
     C**                                    CONTROL DATE FOR IRS
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDTIACD     IAC2
     C                     END
     C*
     C**  INTEREST PAID/RECEIVED TO DATE 2 = THEIR INTEREST PAID/
     C**                                     RECEIVED TO DATE
     C                     Z-ADDTIPRD     IPR2
     C*
     C**  INTEREST PAID/RECEIVED THIS MONTH 2 = THEIR INTEREST PAID/
     C**                                        RECEIVED THIS MONTH
     C                     Z-ADDTIPRM     ITM2
     C*
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED 2
     C**        = THEIR ACCRUED INTEREST ADJUSTMENT NOT POSTED
     C                     Z-ADDTAIAN     AIN2
     C*
     C**  ACCRUED INTEREST ADJUSTMENT POSTED 2 = THEIR ACCRUED INTEREST
     C**                                         ADJUSTMENT POSTED
     C                     Z-ADDTAIAP     AIA2
     C*
     C**  INTEREST CALCULATION BASIS 2 = THEIR INTEREST CALCULATION
     C**                                 BASIS FOR IRS
     C           MDID      IFEQ 'IRS'
     C                     Z-ADDTICBS     ICB2
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. RPRRRF - PROCESS CAPS, COLLARS AND FLOORS                 *
     C*                                                                  *
     C*    CALLED BY: FRAIRS - PROCESS FRA/IRS                           *
     C*    CALLS:                                                        *
     C*                                                                  *
     C********************************************************************
     C*
     C           RPRRRF    BEGSR
     C*
     C**  MODULE ID
     C*
     C**  INTEREST RATE CAP
     C           DTYP      IFEQ 'RP'
     C           BYSL      IFEQ 'B'
     C                     MOVE 'CPB'     MDID
     C                     ELSE
     C                     MOVE 'CPS'     MDID
     C                     END
     C                     END
     C*
     C**  INTEREST RATE FLOOR
     C           DTYP      IFEQ 'RF'
     C           BYSL      IFEQ 'B'
     C                     MOVE 'FLB'     MDID
     C                     ELSE
     C                     MOVE 'FLS'     MDID
     C                     END
     C                     END
     C*
     C**  INTEREST RATE COLLAR
     C           DTYP      IFEQ 'RR'
     C           BYSL      IFEQ 'B'
     C                     MOVE 'CLB'     MDID
     C                     ELSE
     C                     MOVE 'CLS'     MDID
     C                     END
     C                     END
     C*
     C**  NAME
     C*
     C**  INTEREST RATE CAP
     C           DTYP      IFEQ 'RP'
     C                     MOVELTXT,17    NAME
     C                     END
     C*
     C**  INTEREST RATE FLOOR
     C           DTYP      IFEQ 'RF'
     C                     MOVELTXT,18    NAME
     C                     END
     C*
     C**  INTEREST RATE COLLAR
     C           DTYP      IFEQ 'RR'
     C                     MOVELTXT,19    NAME
     C                     END
     C*
     C**  CURRENCY 1 = OUR CURRENCY
     C                     MOVE UCUCY     CCY1
     C*
     C**  AMOUNT 1 = OUR PRINCIPAL AMOUNT
     C                     Z-ADDUPAMT     AMT1
     C*
     C**  BASE CURRENCY AMOUNT 1 = AMOUNT 1 CONVERTED TO BASE CURRENCY
     C**                           AT OUR BASE CURRENCY EXCHANGE RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS
     C                     MOVE CCY1      XCCY
     C                     EXSR CCYDEP
     C*
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE CCY1      ZCCYI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDAMT1      ZAMTCI
     C                     Z-ADDUBCXR     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA1
     C*
     C**  RUN DAY AMOUNT 1 = AMOUNT 1 CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C                     Z-ADDAMT1      ZAMTCI
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  INTEREST RATE = OUR OR THEIR EFFECTIVE INTEREST RATE,
     C**                   WHICHEVER IS NON-ZERO
     C           UEINR     IFNE *ZERO
     C                     Z-ADDUEINR     INTR
     C                     ELSE
     C                     Z-ADDTEINR     INTR
     C                     END
     C*
     C**  SPREAD = OUR OR THEIR SPREAD RATE, WHICHEVER IS NON-ZERO
     C           URTSP     IFNE *ZERO
     C                     Z-ADDURTSP     SPRD
     C                     ELSE
     C                     Z-ADDTRTSP     SPRD
     C                     END
     C*
     C**  BASE RATE CODE = OUR OR THEIR BASE RATE TYPE, WHICHEVER IS
     C**                   NON-ZERO
     C           UBRTT     IFNE *ZERO
     C                     Z-ADDUBRTT     BRTT
     C                     ELSE
     C                     Z-ADDTBRTT     BRTT
     C                     END
     C*
     C**  CURRENT BASE RATE = OUR OR THEIR BASE RATE, WHICHEVER IS
     C**                      NON-ZERO
     C           UBRTE     IFNE *ZERO
     C                     Z-ADDUBRTE     BRTE
     C                     ELSE
     C                     Z-ADDTBRTE     BRTE
     C                     END
     C*
     C**  NEXT INTEREST PAYMENT DATE = OUR OR THEIR NEXT INTEREST
     C**                               PAYMENT DATE, WHICHEVER IS
     C**                               NON-ZERO
     C           UNIPD     IFNE *ZERO
     C                     Z-ADDUNIPD     NIPD
     C                     ELSE
     C                     Z-ADDTNIPD     NIPD
     C                     END
     C*
     C**  LAST INTEREST PAYMENT DATE = OUR OR THEIR START/LAST INTEREST
     C**                               PAYMENT DATE, WHICHEVER IS
     C**                               NON-ZERO
     C           USLIP     IFNE *ZERO
     C                     Z-ADDUSLIP     LIPD
     C                     ELSE
     C                     Z-ADDTSLIP     LIPD
     C                     END
     C*
     C**  NEXT RATE CHANGE DATE = OUR OR THEIR NEXT RATE CHANGE DATE,
     C**                          WHICHEVER IS NON-ZERO
     C           UNICD     IFNE *ZERO
     C                     Z-ADDUNICD     NRCD
     C                     ELSE
     C                     Z-ADDTNICD     NRCD
     C                     END
     C*
     C**  ACCRUED INTEREST POSTED TO DATE = OUR OR THEIR ACCRUED
     C**                                    INTEREST POSTED, WHICHEVER
     C**                                    IS NON-ZERO
     C           UAIPD     IFNE *ZERO
     C                     Z-ADDUAIPD     AIPD
     C                     ELSE
     C                     Z-ADDTAIPD     AIPD
     C                     END
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE = OUR OR THEIR ACCRUED
     C**                                     INTEREST TO CONTROL DATE,
     C**                                     WHICHEVER IS NON-ZERO
     C           UAITC     IFNE *ZERO
     C                     Z-ADDUAITC     AITC
     C                     ELSE
     C                     Z-ADDTAITC     AITC
     C                     END
     C*
     C**  INTEREST ACCRUAL CONTROL DATE = OUR OR THEIR INTEREST ACCRUAL
     C**                                  CONTROL DATE, WHICHEVER IS
     C**                                  NON-ZERO
     C           UIACD     IFNE *ZERO
     C                     Z-ADDUIACD     IACD
     C                     ELSE
     C                     Z-ADDTIACD     IACD
     C                     END
     C*
     C**  INTEREST PAID/RECEIVED TO DATE = OUR OR THEIR INTEREST
     C**                                   PAID/RECEIVED TO DATE,
     C**                                   WHICHEVER IS NON-ZERO
     C           UIPRD     IFNE *ZERO
     C                     Z-ADDUIPRD     IPRD
     C                     ELSE
     C                     Z-ADDTIPRD     IPRD
     C                     END
     C*
     C**  INTEREST PAID/RECEIVED THIS MONTH = OUR OR THEIR INTEREST
     C**                                      PAID/RECEIVED THIS MONTH,
     C**                                      WHICHEVER IS NON-ZERO
     C           UIPRM     IFNE *ZERO
     C                     Z-ADDUIPRM     ITMT
     C                     ELSE
     C                     Z-ADDTIPRM     ITMT
     C                     END
     C*
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED = OUR OR THEIR ACCRUED
     C**         = OUR OR THEIR ACCRUED INTEREST ADJUSTMENT NOT POSTED,
     C**           WHICHEVER IS NON-ZERO
     C           UAIAN     IFNE *ZERO
     C                     Z-ADDUAIAN     AIAN
     C                     ELSE
     C                     Z-ADDTAIAN     AIAN
     C                     END
     C*
     C**  ACCRUED INTEREST ADJUSTMENT POSTED
     C**             = OUR OR THEIR ACCRUED INTEREST ADJUSTMENT POSTED,
     C**               WHICHEVER IS NON-ZERO
     C           UAIAP     IFNE *ZERO
     C                     Z-ADDUAIAP     AIAP
     C                     ELSE
     C                     Z-ADDTAIAP     AIAP
     C                     END
     C*
     C**  INTEREST CALCULATION BASIS = OUR OR THEIR INTEREST
     C**                               CALCULATION BASIS, WHICHEVER IS
     C**                               NON-ZERO
     C           UICBS     IFNE *ZERO
     C                     Z-ADDUICBS     ICBS
     C                     ELSE
     C                     Z-ADDTICBS     ICBS
     C                     END
     C*
     C**  CAP RATE = CEILING RATE FOR CAPS AND COLLARS
     C           DTYP      IFEQ 'RP'
     C           DTYP      OREQ 'RR'
     C                     Z-ADDCLRAT     CPRT
     C                     END
     C*
     C**  FLOOR RATE = FLOOR RATE FOR FLOORS AND COLLARS
     C           DTYP      IFEQ 'RF'
     C           DTYP      OREQ 'RR'
     C                     Z-ADDFLRAT     FLRT
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. PROCFF - PROCESS FF TRANSACTIONS AND POSITIONS            *
     C*                                                                  *
     C*    CALLED BY: MAIN   - MAIN PROCESSING                           *
     C*    CALLS:     FFTRAN - PROCESS FUTURES AND OPTIONS TRANSACTIONS  *
     C*               FFBCPN - PROCESS FF BOOK AND CUSTOMER POSITIONS    *
     C*                                                                  *
     C********************************************************************
     C*
     C           PROCFF    BEGSR
     C*
     C**  OPEN FUTURES AND OPTIONS FILES
     C                     OPEN INTYP
     C                     OPEN MARKT
     C                     OPEN TRANS4
     C                     OPEN POSTN4
     C                     OPEN FOPCC
     C                     OPEN FOPCK
     C                     OPEN PRICS1
     C                     OPEN PRISP1
     C*
     C**  PROCESS FF TRANSACTIONS
     C                     EXSR FFTRAN
     C*
     C**  PROCESS FF BOOK AND CUSTOMER POSITIONS
     C                     EXSR FFBCPN
     C*
     C**  CLOSE FF FILES
     C                     CLOSEINTYP
     C                     CLOSEMARKT
     C                     CLOSETRANS4
     C                     CLOSEPOSTN4
     C                     CLOSEFOPCC
     C                     CLOSEFOPCK
     C                     CLOSEPRICS1
     C                     CLOSEPRISP1
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. FFTRAN - PROCESS FUTURES AND OPTIONS TRANSACTIONS         *
     C*                                                                  *
     C*    CALLED BY: PROCFF - PROCESS FF TRANSACTIONS AND POSITIONS     *
     C*    CALLS:     *PSSR  - ERROR PROCESSING                          *
     C*               ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               ZSEDIT - EDIT NUMERIC FIELDS                       *
     C*               FFDATE - DETERMINE CORRECT WORKING DAY FOR A       *
     C*                        FORMULA SPECIFIED                         *
     C*               FFPMCL - CALCULATE PREMIUM PAYABLE ON A GIVEN      *
     C*                        NUMBER OF CONTRACTS                       *
     C*               FFPLCL - CALCULATE PROFIT OR LOSS FOR A GIVEN      *
     C*                        NUMBER OF CONTRACTS                       *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           FFTRAN    BEGSR
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  INITIALISE INSTRUMENT TYPE AND MARKET WORK FIELDS TO BLANKS
     C                     MOVE *BLANKS   WISTT   5
     C                     MOVE *BLANKS   WMRKT   2
     C*
     C**  READ FF TRANSACTIONS FILE
     C                     READ TRANS4                   50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C**  IF A LIVE RECORD HAS BEEN READ
     C           RECI      IFEQ 'D'
     C*
     C**  ON CHANGE OF INSTRUMENT TYPE, ACCESS INSTRUMENT TYPES FILE
     C           ISTT      IFNE WISTT
     C           ISTT      CHAININTYP                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'INTYP   'DBFILE
     C                     MOVELISTT      DBKEY
     C                     Z-ADD2         DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  ON CHANGE OF MARKET, ACCESS MARKET CENTRES FILE
     C           ISTI      IFNE 'Y'
     C                     MOVELISTT      MARK    2
     C           MARK      IFNE WMRKT
     C           MARK      CHAINMARKT                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'MARKT   'DBFILE
     C                     MOVELMARK      DBKEY
     C                     Z-ADD3         DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  STORE VALUE OF MARKET IN WORK FIELD
     C                     MOVELISTT      WMRKT
     C                     END
     C                     END
     C*
     C**  STORE VALUE OF INSTRUMENT TYPE IN WORK FIELD
     C                     MOVE ISTT      WISTT
     C                     END
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID
     C*
     C**  FUTURE PURCHASE AND SALE
     C           ISPT      IFLE 3
     C           TRTY      IFEQ 'P'
     C                     MOVE 'FUP'     MDID
     C                     ELSE
     C                     MOVE 'FUS'     MDID
     C                     END
     C                     END
     C*
     C**  OPTION PURCHASE, SALE AND EXERCISE
     C           ISPT      IFGE 4
     C           TRTY      IFEQ 'P'
     C                     MOVE 'OPP'     MDID
     C                     END
     C           TRTY      IFEQ 'S'
     C                     MOVE 'OPS'     MDID
     C                     END
     C           TRTY      IFEQ 'E'
     C                     MOVE 'OPE'     MDID
     C                     END
     C                     END
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'FF'      IMID
     C*
     C**  DEAL NUMBER = TRANSACTION NUMBER
     C**********           Z-ADDTNBR      DLNO                                                CLE148
     C                     MOVELTNBR      DLNO                                                CLE148
     C*
     C**  NAME
     C*
     C**  FOR FUTURES, INSTRUMENT NAME AND MONTH NUMBER/YEAR NUMBER;
     C**  FOR OPTIONS, INSTRUMENT NAME, MONTH NUMBER/YEAR NUMBER,
     C**  PUT/CALL AND STRIKE PRICE
     C                     MOVEA*BLANKS   NMA,1
     C*
     C                     MOVEAISTN      NMA,1
     C*
     C           ISTI      IFNE 'Y'
     C                     Z-ADDMTHN      Y       20
     C                     MOVEAZMNM,Y    NMA,18
     C                     MOVEA*BLANKS   NMA,21
     C                     MOVE YRNO      WYRNO   2
     C                     MOVEAWYRNO     NMA,21
     C                     END
     C*
     C           ISPT      IFGE 4
     C                     MOVEAPCAL      NMA,24
     C*
     C           STRP      IFNE *ZERO
     C                     Z-ADDSTRP      WSTRP   52H
     C                     MOVE WSTRP     ZFLD15
     C                     Z-ADD2         ZDECS
     C                     EXSR ZSEDIT
     C*
     C                     MOVE ZOUT21    WASTRP  7
     C                     MOVEAWASTRP    NMA,25
     C                     END
     C                     END
     C*
     C                     MOVEANMA       NAME
     C/COPY WNCPYSRC,MQ552XC015
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  TRANSACTION TYPE = INSTRUMENT TYPE
     C                     MOVELISTT      TTYP
     C*
     C**  PROCESSING/FACILITY TYPE = INSTRUMENT PROCESSING TYPE
     C                     Z-ADDISPT      PFTP
     C*
     C**  CUSTOMER NUMBER = CUSTOMER OR BROKER, WHICHEVER IS NON-ZERO
     C********** CUSC      IFNE *ZERO                                                         CSD027
     C**********           Z-ADDCUSC      CNUM                                                CSD027
     C           CUSC      IFNE *BLANKS                                                       CSD027
     C                     MOVE CUSC      CNUM                                                CSD027
     C                     ELSE
     C**********           Z-ADDBOCO      CNUM                                                CSD027
     C                     MOVE BOCO      CNUM                                                CSD027
     C                     END
     C*
     C**  LINKED DEAL NUMBER = LINKED REFERENCE
     C                     Z-ADDLNKR      LNKD
     C*
     C**  BOOK CODE
     C                     MOVE BOKC      BOKC
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE ORBR      ORBR
     C*
     C**  DEAL DATE = TRANSACTION DATE
     C                     Z-ADDTRSD      DDAT
     C*
     C**  VALUE DATE = TRANSACTION DATE
     C                     Z-ADDTRSD      VDAT
     C*
     C**  MATURITY DATE = SETTLEMENT DATE
     C*
     C**  FOR OTC INSTRUMENTS, USE SETTLEMENT DATE FROM INTYP
     C           ISTI      IFEQ 'Y'
     C/COPY WNCPYSRC,MQ552XC016
     C                     Z-ADDSETD      MDAT
     C/COPY WNCPYSRC,MQ552XC017
     C*
     C**  FOR MARKET INSTRUMENTS, USE SETTLEMENT DATE FORMULA FROM
     C**  INTYP
     C                     ELSE
     C                     MOVE SEDF      FFDATC
     C                     Z-ADDMTHN      FFMTH
     C                     Z-ADDYRNO      FFYR
     C                     MOVE MKLC      FFCCY1
     C                     MOVE MLOC      FFLOC
     C                     MOVE ISCY      FFCCY2
     C                     MOVE OTHC      FFCCY3
     C                     EXSR FFDATE
     C/COPY WNCPYSRC,MQ552XC018
     C                     Z-ADDFFDAY     MDAT
     C/COPY WNCPYSRC,MQ552XC019
     C                     END
     C*
     C**  CURRENCY 1 = INSTRUMENT CURRENCY
     C                     MOVE ISCY      CCY1
     C*
     C**  NUMBER 1 = NUMBER OF OPEN CONTRACTS: CUSTOMER
     C                     Z-ADDNOCO      NUM1
     C*
     C**  AMOUNT 1
     C*
     C                     Z-ADD0         AMT1
     C*
     C**  FOR FUTURES, NUMBER OF OPEN CONTRACTS X CONTINGENT AMOUNT
     C           ISPT      IFLE 3
     C           NOCO      MULT CTAM      AMT1
     C                     END
     C*
     C**  FOR OPTION TRADES, NUMBER OF OPEN CONTRACTS X CONTRACT PRICE
     C**  VIA STANDARD SR. FFPMCL
     C           ISPT      IFGE 4
     C           ISPT      ANDLE6
     C           TRTY      IFNE 'E'
     C                     Z-ADDNOCO      FFNOC
     C                     Z-ADDCOPR      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     Z-ADDTKVL      FFTKVL
     C                     EXSR FFPMCL
     C                     Z-ADDFFPREM    AMT1
     C*
     C**  FOR OPTION EXERCISES, NUMBER OF CONTRACTS X DIFFERENCE
     C**  BETWEEN STRIKE PRICE AND CONTRACT PRICE VIA STANDARD
     C**  SR. FFPLCL
     C                     ELSE
     C                     Z-ADDNUCO      FFNOC
     C***********          Z-ADDSTRP      FFPRCX 117                      CFF004
     C***********          Z-ADDCOPR      FFPRCY 117                      CFF004
     C           *LIKE     DEFN STRP      FFPRCX                          CFF004
     C           *LIKE     DEFN COPR      FFPRCY                          CFF004
     C                     Z-ADDSTRP      FFPRCX                          CFF004
     C                     Z-ADDCOPR      FFPRCY                          CFF004
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     Z-ADDTKVL      FFTKVL
     C*
     C** DEFINE OTHER FIELDS USED IN STANDARD SUBROUTINES
     C*
     C                     Z-ADD0         FFCTAM 130
     C                     MOVE *BLANK    FFCNTT  10
     C*
     C                     EXSR FFPLCL
     C                     Z-ADDFFPOL     AMT1
     C                     END
     C                     END
     C*
     C**  RUN DAY AMOUNT 1 = AMOUNT 1 CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP INSTRUMENT CURRENCY DETAILS
     C                     MOVE ISCY      XCCY
     C                     EXSR CCYDEP
     C*
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE ISCY      ZCCYI
     C                     Z-ADDAMT1      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2 = OTHER CURRENCY
     C                     MOVE OTHC      CCY2
     C*
     C**  EXCHANGE RATE
     C*
     C**  CONTRACT PRICE FOR FX FUTURES
     C           ISPT      IFEQ 2
     C           QOTC      IFLT *ZERO
     C                     Z-SUBQOTC      N       10
     C           COPR      DIV  POWER9,N  EXRT      H
     C                     END
     C*
     C           QOTC      IFGT *ZERO
     C                     Z-ADDQOTC      N
     C           COPR      MULT POWER9,N  EXRT
     C                     END
     C*
     C           QOTC      IFEQ *ZERO
     C                     Z-ADDCOPR      EXRT
     C                     END
     C*
     C**  STRIKE PRICE FOR FX OPTIONS
     C                     ELSE
     C           ISPT      IFEQ 5
     C                     Z-ADDSTRP      EXRT
     C                     END
     C                     END
     C*
     C**  PRICE = CONTRACT PRICE
     C                     Z-ADDCOPR      PRIC
     C*
     C**  MARKET PRICE = LAST END OF CENTRE PRICE FROM PRICS1 FOR ALL
     C**                 FUTURES TRANSACTIONS AND OPTIONS TRANSACTIONS
     C**                 EXCEPT EXERCISES;
     C**                 NEW SPOT PRICE FROM PRISP1 FOR OPTION EXERCISE
     C           TRTY      IFNE 'E'
     C*
     C                     MOVE ISTT      KISTT
     C                     Z-ADDYRNO      KYRNO
     C                     Z-ADDMTHN      KMTHN
     C                     MOVE PCAL      KPCAL
     C                     Z-ADDSTRP      KSTRP
     C*
     C           PRICSK    CHAINPRICS1               60
     C*
     C**  IF RECORD NOT FOUND, SET MARKET PRICE TO ZERO
     C           *IN60     IFEQ '1'
     C                     Z-ADD*ZERO     MPRC
     C                     ELSE
     C                     Z-ADDPLEC      MPRC
     C                     END
     C*
     C                     ELSE
     C           ISTT      CHAINPRISP1               60
     C*
     C**  IF RECORD NOT FOUND, SET MARKET PRICE TO ZERO
     C           *IN60     IFEQ '1'
     C                     Z-ADD*ZERO     MPRC
     C                     ELSE
     C                     Z-ADDNSPR      MPRC
     C                     END
     C                     END
     C*
     C**  PUT/CALL = PUT/CALL INDICATOR FOR OPTIONS
     C           ISPT      IFGE 4
     C                     MOVE PCAL      PCAL
     C                     END
     C*
     C**  INTEREST RATE
     C*
     C**  FOR INTEREST RATE FUTURES, (100 - CONTRACT PRICE)
     C           ISPT      IFEQ 1
     C           100       SUB  COPR      INTR
     C                     END
     C*
     C**  FOR INTEREST RATE OPTIONS, (100 - STRIKE PRICE)
     C           ISPT      IFEQ 4
     C           100       SUB  STRP      INTR
     C                     END
     C/COPY WNCPYSRC,MQ552XC020
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT RECORD FROM FF TRANSACTIONS
     C                     READ TRANS4                   50
     C*
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. FFBCPN - PROCESS FF BOOK AND CUSTOMER POSITIONS           *
     C*                                                                  *
     C*    CALLED BY: PROCFF - PROCESS FF TRANSACTIONS AND POSITIONS     *
     C*    CALLS:     *PSSR  - ERROR PROCESSING                          *
     C*               ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               ZSEDIT - EDIT NUMERIC FIELDS                       *
     C*               FFDATE - DETERMINE CORRECT WORKING DAY FOR A       *
     C*                        FORMULA SPECIFIED                         *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           FFBCPN    BEGSR
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  INITIALISE INSTRUMENT TYPE AND MARKET WORK FIELDS TO BLANKS
     C                     MOVE *BLANKS   WISTT
     C                     MOVE *BLANKS   WMRKT
     C*
     C                     SETOF                     1213
     C*
     C**  READ FF OPEN POSITIONS BY INSTRUMENT TYPE
     C                     READ POSTN4                   50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C**  IF A LIVE RECORD HAS BEEN READ
     C           RECI      IFEQ 'D'
     C*
     C**  ON CHANGE OF INSTRUMENT TYPE, ACCESS INSTRUMENT TYPES FILE
     C           ISTT      IFNE WISTT
     C           ISTT      CHAININTYP                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'INTYP   'DBFILE
     C                     MOVELISTT      DBKEY
     C                     Z-ADD4         DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  ON CHANGE OF MARKET, ACCESS MARKET CENTRES FILE
     C           ISTI      IFNE 'Y'
     C                     MOVELISTT      MARK
     C           MARK      IFNE WMRKT
     C           MARK      CHAINMARKT                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'MARKT   'DBFILE
     C                     MOVELMARK      DBKEY
     C                     Z-ADD5         DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  STORE VALUE OF MARKET IN WORK FIELD
     C                     MOVELISTT      WMRKT
     C                     END
     C                     END
     C*
     C**  STORE VALUE OF INSTRUMENT TYPE IN WORK FIELD
     C                     MOVE ISTT      WISTT
     C                     END
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID
     C*
     C**  FUTURE BOOK POSITION
     C           *IN12     IFEQ '1'
     C           ISPT      ANDLE3
     C                     MOVE 'FBP'     MDID
     C                     END
     C*
     C**  OPTION BOOK POSITION
     C           *IN12     IFEQ '1'
     C           ISPT      ANDGE4
     C                     MOVE 'OBP'     MDID
     C                     END
     C*
     C**  FUTURE CUSTOMER/BROKER POSITION
     C           *IN13     IFEQ '1'
     C           ISPT      ANDLE3
     C           BRKI      IFNE 'Y'
     C                     MOVE 'FCP'     MDID
     C                     ELSE
     C                     MOVE 'FRP'     MDID
     C                     END
     C                     END
     C*
     C**  OPTION CUSTOMER/BROKER POSITION
     C           *IN13     IFEQ '1'
     C           ISPT      ANDGE4
     C           BRKI      IFNE 'Y'
     C                     MOVE 'OCP'     MDID
     C                     ELSE
     C                     MOVE 'ORP'     MDID
     C                     END
     C                     END
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'FF'      IMID
     C*
     C**  POSITION/BALANCE NUMBER
     C                     MOVE *BLANKS   FFBKDS
     C                     MOVE *BLANKS   FFCSDS
     C*
     C**  BOOK POSITIONS
     C           *IN12     IFEQ '1'
     C                     MOVE BRCA      FBBRCA
     C                     MOVE BOKC      FBBOKC
     C                     MOVE ISTT      FBISTT
     C*
     C           ISTI      IFNE 'Y'
     C                     MOVE YRNO      FBYRNO
     C                     MOVE MTHN      FBMTHN
     C                     END
     C*
     C           ISPT      IFGE 4
     C                     MOVE PCAL      FBPCAL
     C                     Z-ADDSTRP      FBSTRP
     C                     END
     C*
     C                     MOVELFFBKDS    PBNO
     C                     END
     C*
     C**  CUSTOMER POSITIONS
     C           *IN13     IFEQ '1'
     C                     MOVE BRCA      FCBRCA
     C                     MOVE CBCD      FCCBCD
     C                     MOVE ISTT      FCISTT
     C*
     C           ISTI      IFNE 'Y'
     C                     MOVE YRNO      FCYRNO
     C                     MOVE MTHN      FCMTHN
     C                     END
     C*
     C           ISPT      IFGE 4
     C                     MOVE PCAL      FCPCAL
     C                     Z-ADDSTRP      FCSTRP
     C                     END
     C*
     C                     MOVELFFCSDS    PBNO
     C                     END
     C*
     C**  NAME
     C                     MOVEA*BLANKS   NMA,1
     C*
     C**  BOOK POSITIONS
     C           *IN12     IFEQ '1'
     C                     MOVEABRCA      NMA,1
     C                     MOVEA'Book '   NMA,4
     C                     MOVEABOKC      NMA,9
     C                     MOVEAISTT      NMA,13
     C*
     C           ISTI      IFNE 'Y'
     C                     Z-ADDMTHN      Y
     C                     MOVEAZMNM,Y    NMA,18
     C                     MOVEA*BLANKS   NMA,21
     C                     MOVE YRNO      WYRNO
     C                     MOVEAWYRNO     NMA,21
     C                     END
     C*
     C           ISPT      IFGE 4
     C                     MOVEAPCAL      NMA,24
     C*
     C           STRP      IFNE *ZERO
     C                     Z-ADDSTRP      WSTRP     H
     C                     MOVE WSTRP     ZFLD15
     C                     Z-ADD2         ZDECS
     C                     EXSR ZSEDIT
     C*
     C                     MOVE ZOUT21    WASTRP
     C                     MOVEAWASTRP    NMA,25
     C                     END
     C                     END
     C                     END
     C*
     C**  CUSTOMER POSITIONS
     C           *IN13     IFEQ '1'
     C                     MOVEABRCA      NMA,1
     C*
     C**  ACCESS CUSTOMER DETAILS FOR CUSTOMER SHORTNAME
     C                     MOVELCBCD      CKEY
     C                     CALL 'AOCUSTR0'PLIST1
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDCUSTPD'DBFILE                          055237
     C                     MOVELCKEY      DBKEY                           055237
     C                     Z-ADD25        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C**  MOVE CUSTOMER SHORTNAME INTO NAME ARRAY
     C                     MOVEABBCSSN    NMA,4
     C*
     C                     MOVEAISTT      NMA,13
     C*
     C           ISTI      IFNE 'Y'
     C                     Z-ADDMTHN      Y
     C                     MOVEAZMNM,Y    NMA,18
     C                     MOVEA*BLANKS   NMA,21
     C                     MOVE YRNO      WYRNO
     C                     MOVEAWYRNO     NMA,21
     C                     END
     C*
     C           ISPT      IFGE 4
     C                     MOVEAPCAL      NMA,24
     C*
     C           STRP      IFNE *ZERO
     C                     Z-ADDSTRP      WSTRP     H
     C                     MOVE WSTRP     ZFLD15
     C                     Z-ADD2         ZDECS
     C                     EXSR ZSEDIT
     C*
     C                     MOVE ZOUT21    WASTRP
     C                     MOVEAWASTRP    NMA,25
     C                     END
     C                     END
     C                     END
     C*
     C                     MOVEANMA       NAME
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C*   PROFIT CENTRE
     C*
     C*  ACCESS FF BOOK AND CUSTOMER POSITION PROFIT CENTRES FILES
     C*  USING INSTRUMENT TYPE, BRANCH AND CUSTOMER/BOOK
     C                     MOVE ISTT      KISTT
     C                     MOVE BRCA      KBRCA
     C*
     C           *IN12     IFEQ '1'
     C                     MOVE BOKC      KBOKC
     C           FOPCKK    CHAINFOPCK                60
     C           *IN60     IFEQ '0'
     C                     MOVE PCBK      PRFC
     C                     END
     C                     END
     C*
     C           *IN13     IFEQ '1'
     C**********           Z-ADDCBCD      KCBCD                                               CSD027
     C                     MOVE CBCD      KCBCD                                               CSD027
     C           FOPCCK    CHAINFOPCC                60
     C           *IN60     IFEQ '0'
     C                     MOVE PCCB      PRFC
     C                     END
     C                     END
     C*
     C**  TRANSACTION TYPE = INSTRUMENT TYPE
     C                     MOVELISTT      TTYP
     C*
     C**  CUSTOMER NUMBER = CUSTOMER/BROKER CODE FOR CUSTOMER
     C**                    POSITIONS
     C           *IN13     IFEQ '1'
     C**********           Z-ADDCBCD      CNUM                                                CSD027
     C                     MOVE CBCD      CNUM                                                CSD027
     C                     END
     C*
     C**  BOOK CODE = BOOK CODE FOR BOOK POSITIONS
     C           *IN12     IFEQ '1'
     C                     MOVE BOKC      BOKC
     C                     END
     C*
     C**  MATURITY DATE = SETTLEMENT DATE
     C*
     C**  FOR OTC INSTRUMENTS, USE SETTLEMENT DATE FROM INTYP
     C           ISTI      IFEQ 'Y'
     C                     Z-ADDSETD      MDAT
     C*
     C**  FOR MARKET INSTRUMENTS, USE SETTLEMENT DATE FORMULA FROM
     C**  INTYP
     C                     ELSE
     C                     MOVE SEDF      FFDATC
     C                     Z-ADDMTHN      FFMTH
     C                     Z-ADDYRNO      FFYR
     C                     MOVE MKLC      FFCCY1
     C                     MOVE MLOC      FFLOC
     C                     MOVE ISCY      FFCCY2
     C                     MOVE OTHC      FFCCY3
     C                     EXSR FFDATE
     C                     Z-ADDFFDAY     MDAT
     C                     END
     C*
     C**  CURRENCY 1 = INSTRUMENT CURRENCY
     C                     MOVE ISCY      CCY1
     C*
     C**  NUMBER 1 = SHORT OPEN POSITION
     C                     Z-ADDSOPC      NUM1
     C*
     C**  AMOUNT 1 = SHORT OPEN POSITION X CONTINGENT AMOUNT
     C           SOPC      MULT CTAM      AMT1
     C*
     C**  RUN DAY AMOUNT 1 = AMOUNT 1 CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP INSTRUMENT CURRENCY DETAILS
     C                     MOVE ISCY      XCCY
     C                     EXSR CCYDEP
     C*
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE ISCY      ZCCYI
     C                     Z-ADDAMT1      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2 = INSTRUMENT CURRENCY
     C                     MOVE ISCY      CCY2
     C*
     C**  NUMBER 2 = LONG OPEN POSITION
     C                     Z-ADDLOPC      NUM2
     C*
     C**  AMOUNT 2 = LONG OPEN POSITION X CONTINGENT AMOUNT
     C           LOPC      MULT CTAM      AMT2
     C*
     C**  RUN DAY AMOUNT 2 = AMOUNT 2 CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C                     Z-ADDAMT2      ZAMTCI
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA2
     C*
     C**  AMOUNT 3 = CURRENT TOTAL VALUE
     C                     Z-ADDCUTV      AMT3
     C*
     C**  RUN DAY AMOUNT 3 = AMOUNT 3 CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C                     Z-ADDAMT3      ZAMTCI
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA3
     C*
     C**  PRICE = STRIKE PRICE FOR OPTIONS
     C           ISPT      IFGE 4
     C                     Z-ADDSTRP      PRIC
     C                     END
     C*
     C**  MARKET PRICE = LAST END OF CENTRE PRICE FROM PRICS1
     C                     MOVE ISTT      KISTT
     C                     Z-ADDYRNO      KYRNO
     C                     Z-ADDMTHN      KMTHN
     C                     MOVE PCAL      KPCAL
     C                     Z-ADDSTRP      KSTRP
     C*
     C           PRICSK    CHAINPRICS1               60
     C*
     C**  IF RECORD NOT FOUND, SET MARKET PRICE TO ZERO
     C           *IN60     IFEQ '1'
     C                     Z-ADD*ZERO     MPRC
     C                     ELSE
     C                     Z-ADDPLEC      MPRC
     C                     END
     C*
     C**  PUT/CALL = PUT/CALL INDICATOR FOR OPTIONS
     C           ISPT      IFGE 4
     C                     MOVE PCAL      PCAL
     C                     END
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C                     SETOF                     1213
     C*
     C**  READ NEXT RECORD FROM FF BOOK/CUSTOMER POSITIONS
     C                     READ POSTN4                   50
     C*
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. PROCLE - PROCESS LE TRANSACTIONS                          *
     C*                                                                  *
     C*    CALLED BY: MAIN   - MAIN PROCESSING                           *
     C*    CALLS:     LELOAN - PROCESS CUSTOMER LOANS                    *
     C*               FACILY - PROCESS FACILITIES                        *
     C*               GUTEES - PROCESS GUARANTEES                        *
     C*                                                                  *
     C********************************************************************
     C*
     C           PROCLE    BEGSR
     C*
     C**  OPEN LE FILES
     C                     OPEN CLOANCL
     C                     OPEN MCLONCL                                   180198
     C                     OPEN CLOANX
     C                     OPEN FCLTY
     C                     OPEN GTEESGT
     C*
     C**  PROCESS CUSTOMER LOANS
     C                     EXSR LELOAN
     C/COPY WNCPYSRC,MQ552XC048
     C*
     C**  PROCESS FACILITIES
     C                     EXSR FACILY
     C*
     C**  PROCESS GUARANTEES
     C                     EXSR GUTEES
     C*
     C**  CLOSE LE FILES
     C                     CLOSECLOANCL
     C                     CLOSEMCLONCL                                   180198
     C                     CLOSECLOANX
     C                     CLOSEFCLTY
     C                     CLOSEGTEESGT
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. LELOAN - PROCESS CUSTOMER LOANS                           *
     C*                                                                  *
     C*    CALLED BY: PROCLE - PROCESS LE TRANSACTIONS                   *
     C*    CALLS:     ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               LOANDS - ACCESS LOAN TYPE DESCRIPTION              *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*               *PSSR  - ERROR PROCESSING                          *
     C*                                                                  *
     C********************************************************************
     C*
     C           LELOAN    BEGSR
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  READ CUSTOMER LOANS FILE
     C                     READ CLOANCL                  50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C****IF*A*LIVE RECORD HAS BEEN READ                                  180198
     C***********RECI      IFEQ 'D'                                       180198
     C           RECI      IFNE 'R'                                       180198
     C/COPY WNCPYSRC,MQ552XC021
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID
     C                     MOVE 'LOA'     MDID
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'LE'      IMID
     C*
     C**  DEAL NUMBER = LOAN NUMBER
     C**********           Z-ADDLNRF      DLNO                                                CLE148
     C                     MOVELLNRF      DLNO                                                CLE148
     C*
     C**  NAME = LOAN TYPE DESCRIPTION FROM LOAN TYPES/SUB-TYPES FILE
     C*
     C**  ACCESS LOAN TYPES/SUB-TYPES ARRAY
     C*********************MOVELLTYP      XLNTYP  4                                           CLE042
     C*********************MOVE SUTP      XLNTYP                                              CLE042
     C                     MOVELLTYP      XLNTYP  8                                           CLE042
     C                     MOVELSUTP      WKSTCL  6                                           CLE042
     C                     MOVE CLAS      WKSTCL                                              CLE042
     C                     MOVE WKSTCL    XLNTYP                                              CLE042
     C                     EXSR LOANDS
     C                     MOVELXLNDES    NAME
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  TRANSACTION TYPE
     C                     MOVELLTYP      TTYP
     C*
     C**  PROCESSING/FACILITY TYPE
     C                     Z-ADDPTYP      PFTP
     C*
     C**  SUB-TYPE
     C                     MOVELSUTP      SUBT
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDCNUM      CNUM                                                CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE ORBR      ORBR
     C*
     C**  ASSOCIATED DEAL NUMBER = ORIGINAL LOAN NUMBER FOR PART. SOLD
     C           PTYP      IFEQ 66
     C           PTYP      OREQ 67
     C**********           Z-ADDOLNO      ADLN                                                CSD027
     C                     MOVE OLNO      ADLN                                                CSD027
     C                     END
     C*
     C**  DEAL DATE
     C                     Z-ADDDDAT      DDAT
     C*
     C**  VALUE DATE
     C                     Z-ADDVDAT      VDAT
     C*
     C**  MATURITY DATE
     C                     Z-ADDMDAT      MDAT
     C*
     C**  CURRENCY 1
     C                     MOVE CCY       CCY1
     C*
     C**  NUMBER 1 = FACILITY TYPE AND NUMBER
     C                     MOVE *BLANKS   FCREF
     C                     MOVELFTYP      FCREF
     C                     MOVE FSEQ      FCREF
     C                     MOVE FCREF     NUM1
     C*
     C**  AMOUNT 1 = CURRENT PRINCIPAL AMOUNT
     C                     Z-ADDCPAM      AMT1
     C*
     C**  BASE CURRENCY AMOUNT 1 = CURRENT PRINCIPAL AMOUNT CONVERTED
     C**                           TO BASE CURRENCY AT BASE CURRENCY
     C**                           EXCHANGE RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS
     C                     MOVE CCY       XCCY
     C                     EXSR CCYDEP
     C*
     C**  CONVERT CURRENT PRINCIPAL AMOUNT TO BASE CURRENCY USING BASE
     C**  CURRENCY EXCHANGE RATE ON FILE
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE CCY       ZCCYI
     C                     Z-ADDCPAM      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDBCXR      ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA1
     C*
     C**  RUN DAY AMOUNT 1 = CURRENT PRINCIPAL AMOUNT CONVERTED TO BASE
     C**                     CURRENCY AT SPOT RATE
     C                     Z-ADDCPAM      ZAMTCI
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2
     C                     MOVE CCY       CCY2
     C*
     C**  AMOUNT 2 = PART SOLD AMOUNT
     C                     Z-ADDPSAM      AMT2
     C*
     C**  RUN DAY AMOUNT 2 = PART SOLD AMOUNT CONVERTED TO BASE
     C**                     CURRENCY AT SPOT RATE
     C                     Z-ADDPSAM      ZAMTCI
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA2
     C*
     C**  INTEREST RATE
     C                     Z-ADDINTR      INTR
     C*
     C**  MARGIN
     C                     Z-ADDMARG      MARG
     C*
     C**  SPREAD
     C                     Z-ADDRTSP      SPRD
     C*
     C**  BASE RATE CODE
     C                     Z-ADDBRTT      BRTT
     C*
     C**  CURRENT BASE RATE
     C                     Z-ADDBRTE      BRTE
     C*
     C**  NEXT INTEREST PAYMENT DATE
     C                     Z-ADDNIDT      NIPD
     C*
     C**  LAST INTEREST PAYMENT DATE
     C                     Z-ADDSLID      LIPD
     C*
     C**  NEXT RATE CHANGE DATE = ROLLOVER DATE
     C                     Z-ADDRLDT      NRCD
     C*
     C**  ACCRUED INTEREST POSTED TO DATE
     C                     Z-ADDAIPD      AIPD
     C*
     C**  ACCRUED INTEREST TO CONTROL DATE
     C                     Z-ADDAITC      AITC
     C*
     C**  INTEREST ACCRUAL CONTROL DATE
     C                     Z-ADDIACD      IACD
     C*
     C**  INTEREST PAID/RECEIVED TO DATE
     C                     Z-ADDIPRD      IPRD
     C*
     C**  INTEREST PAID/RECEIVED THIS MONTH
     C                     Z-ADDIPRM      ITMT
     C*
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED
     C                     Z-ADDAIMN      AIAN
     C*
     C**  ACCRUED INTEREST ADJUSTMENT POSTED
     C                     Z-ADDAIAP      AIAP
     C*
     C**  INTEREST CAPITALIZED TO DATE
     C                     Z-ADDICTD      ICTD
     C*
     C**  INTEREST CALCULATION BASIS
     C                     Z-ADDICBS      ICBS
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  OTHER CUSTOMER NUMBER = CUSTOMER NUMBER ON ORIGINAL LOAN FOR
     C**                          PARTICIPATION SOLD
     C           PTYP      IFEQ 66
     C           PTYP      OREQ 67
     C                     MOVE OLNO      KLNRF
     C/COPY WNCPYSRC,MQ552XC022
     C           CLOANK    CHAINCLOANX               60
     C/COPY WNCPYSRC,MQ552XC023
     C*
     C           *IN60     IFEQ '1'
     C                     MOVEL'CLOANX  'DBFILE
     C                     MOVELDCLOAN    DBKEY
     C                     Z-ADD6         DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**********           Z-ADDCNUMLE    OCUS                                                CSD027
     C                     MOVE CNUMLE    OCUS                                                CSD027
     C                     END
      *                                                                   180198
      ** For Participations Purchased extract original borrower, OLNO,    180198
      ** into other customer field.                                       180198
      *                                                                   180198
     C           PTYP      IFEQ 64                                        180198
     C           PTYP      OREQ 65                                        180198
     C**********           Z-ADDOLNO      OCUS                                         180198 CSD027
     C                     MOVE OLNO      OCUS                                                CSD027
     C                     ENDIF                                          180198
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT CUSTOMER LOAN
     C                     READ CLOANCL                  50
     C*
     C                     END
     C*                                                                   180198
     C**  READ CUSTOMER LOANS FILE                                        180198
     C                     READ MCLONCL                  50               180198
     C*                                                                   180198
     C**  DO WHILE NOT END OF FILE                                        180198
     C           *IN50     DOWEQ'0'                                       180198
     C*                                                                   180198
     C           RECI      IFNE 'R'                                       180198
     C*                                                                   180198
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE           180198
     C*                                                                   180198
     C**  MODULE ID                                                       180198
     C                     MOVE 'LOA'     MDID                            180198
     C*                                                                   180198
     C**  INTERNAL MODULE ID                                              180198
     C                     MOVE 'LE'      IMID                            180198
     C*                                                                   180198
     C**  DEAL NUMBER = LOAN NUMBER                                       180198
     C**********           Z-ADDLNRF      DLNO                                         180198 CLE148
     C                     MOVELLNRF      DLNO                                                CLE148
     C*                                                                   180198
     C**  NAME = LOAN TYPE DESCRIPTION FROM LOAN TYPES/SUB-TYPES FILE     180198
     C*                                                                   180198
     C**  ACCESS LOAN TYPES/SUB-TYPES ARRAY                               180198
     C*********************MOVELLTYP      XLNTYP  4                                    180198 CLE042
     C*********************MOVE SUTP      XLNTYP                                       180198 CLE042
     C                     MOVELLTYP      XLNTYP                                              CLE042
     C                     MOVELSUTP      WKSTCL                                              CLE042
     C                     MOVE CLAS      WKSTCL                                              CLE042
     C                     MOVE WKSTCL    XLNTYP                                              CLE042
     C                     EXSR LOANDS                                    180198
     C                     MOVELXLNDES    NAME                            180198
     C*                                                                   180198
     C**  BRANCH CODE                                                     180198
     C                     MOVE BRCA      BRCA                            180198
     C*                                                                   180198
     C**  PROFIT CENTRE                                                   180198
     C                     MOVE PRFC      PRFC                            180198
     C*                                                                   180198
     C**  TRANSACTION TYPE                                                180198
     C                     MOVELLTYP      TTYP                            180198
     C*                                                                   180198
     C**  PROCESSING/FACILITY TYPE                                        180198
     C                     Z-ADDPTYP      PFTP                            180198
     C*                                                                   180198
     C**  SUB-TYPE                                                        180198
     C                     MOVELSUTP      SUBT                            180198
     C*                                                                   180198
     C**  CUSTOMER NUMBER                                                 180198
     C**********           Z-ADDCNUM      CNUM                                         180198 CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*                                                                   180198
     C**  ORIGINATING BRANCH                                              180198
     C                     MOVE ORBR      ORBR                            180198
     C*                                                                   180198
     C**  ASSOCIATED DEAL NUMBER = ORIGINAL LOAN NUMBER FOR PART. SOLD    180198
     C           PTYP      IFEQ 66                                        180198
     C           PTYP      OREQ 67                                        180198
     C**********           Z-ADDOLNO      ADLN                                         180198 CSD027
     C                     MOVE OLNO      ADLN                                                CSD027
     C                     END                                            180198
     C*                                                                   180198
     C**  DEAL DATE                                                       180198
     C                     Z-ADDDDAT      DDAT                            180198
     C*                                                                   180198
     C**  VALUE DATE                                                      180198
     C                     Z-ADDVDAT      VDAT                            180198
     C*                                                                   180198
     C**  MATURITY DATE                                                   180198
     C                     Z-ADDMDAT      MDAT                            180198
     C*                                                                   180198
     C**  CURRENCY 1                                                      180198
     C                     MOVE CCY       CCY1                            180198
     C*                                                                   180198
     C**  NUMBER 1 = FACILITY TYPE AND NUMBER                             180198
     C                     MOVE *BLANKS   FCREF                           180198
     C                     MOVELFTYP      FCREF                           180198
     C                     MOVE FSEQ      FCREF                           180198
     C                     MOVE FCREF     NUM1                            180198
     C*                                                                   180198
     C**  AMOUNT 1 = CURRENT PRINCIPAL AMOUNT                             180198
     C                     Z-ADDCPAM      AMT1                            180198
     C*                                                                   180198
     C**  BASE CURRENCY AMOUNT 1 = CURRENT PRINCIPAL AMOUNT CONVERTED     180198
     C**                           TO BASE CURRENCY AT BASE CURRENCY      180198
     C**                           EXCHANGE RATE                          180198
     C*                                                                   180198
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS              180198
     C                     MOVE CCY       XCCY                            180198
     C                     EXSR CCYDEP                                    180198
     C*                                                                   180198
     C**  CONVERT CURRENT PRINCIPAL AMOUNT TO BASE CURRENCY USING BASE    180198
     C**  CURRENCY EXCHANGE RATE ON FILE                                  180198
     C                     Z-ADDXDECP     ZCDPI                           180198
     C                     MOVE CCY       ZCCYI                           180198
     C                     Z-ADDCPAM      ZAMTCI                          180198
     C                     MOVE XMDIN     ZMD                             180198
     C                     Z-ADDBCXR      ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    BCA1                            180198
     C*                                                                   180198
     C**  RUN DAY AMOUNT 1 = CURRENT PRINCIPAL AMOUNT CONVERTED TO BASE   180198
     C**                     CURRENCY AT SPOT RATE                        180198
     C                     Z-ADDCPAM      ZAMTCI                          180198
     C                     Z-ADDXSPOT     ZEXCH                           180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    RDA1                            180198
     C*                                                                   180198
     C**  CURRENCY 2                                                      180198
     C                     MOVE CCY       CCY2                            180198
     C*                                                                   180198
     C**  AMOUNT 2 = PART SOLD AMOUNT                                     180198
     C                     Z-ADDPSAM      AMT2                            180198
     C*                                                                   180198
     C**  RUN DAY AMOUNT 2 = PART SOLD AMOUNT CONVERTED TO BASE           180198
     C**                     CURRENCY AT SPOT RATE                        180198
     C                     Z-ADDPSAM      ZAMTCI                          180198
     C                     EXSR ZCONV                                     180198
     C                     Z-ADDZAMTCO    RDA2                            180198
     C*                                                                   180198
     C**  INTEREST RATE                                                   180198
     C                     Z-ADDINTR      INTR                            180198
     C*                                                                   180198
     C**  MARGIN                                                          180198
     C                     Z-ADDMARG      MARG                            180198
     C*                                                                   180198
     C**  SPREAD                                                          180198
     C                     Z-ADDRTSP      SPRD                            180198
     C*                                                                   180198
     C**  BASE RATE CODE                                                  180198
     C                     Z-ADDBRTT      BRTT                            180198
     C*                                                                   180198
     C**  CURRENT BASE RATE                                               180198
     C                     Z-ADDBRTE      BRTE                            180198
     C*                                                                   180198
     C**  NEXT INTEREST PAYMENT DATE                                      180198
     C                     Z-ADDNIDT      NIPD                            180198
     C*                                                                   180198
     C**  LAST INTEREST PAYMENT DATE                                      180198
     C                     Z-ADDSLID      LIPD                            180198
     C*                                                                   180198
     C**  NEXT RATE CHANGE DATE = ROLLOVER DATE                           180198
     C                     Z-ADDRLDT      NRCD                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST POSTED TO DATE                                 180198
     C                     Z-ADDAIPD      AIPD                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST TO CONTROL DATE                                180198
     C                     Z-ADDAITC      AITC                            180198
     C*                                                                   180198
     C**  INTEREST ACCRUAL CONTROL DATE                                   180198
     C                     Z-ADDIACD      IACD                            180198
     C*                                                                   180198
     C**  INTEREST PAID/RECEIVED TO DATE                                  180198
     C                     Z-ADDIPRD      IPRD                            180198
     C*                                                                   180198
     C**  INTEREST PAID/RECEIVED THIS MONTH                               180198
     C                     Z-ADDIPRM      ITMT                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST ADJUSTMENT NOT POSTED                          180198
     C                     Z-ADDAIMN      AIAN                            180198
     C*                                                                   180198
     C**  ACCRUED INTEREST ADJUSTMENT POSTED                              180198
     C                     Z-ADDAIAP      AIAP                            180198
     C*                                                                   180198
     C**  INTEREST CAPITALIZED TO DATE                                    180198
     C                     Z-ADDICTD      ICTD                            180198
     C*                                                                   180198
     C**  INTEREST CALCULATION BASIS                                      180198
     C                     Z-ADDICBS      ICBS                            180198
     C*                                                                   180198
     C**  LAST CHANGE DATE                                                180198
     C                     Z-ADDLCD       LCD                             180198
     C*                                                                   180198
     C**  LAST CHANGE TYPE                                                180198
     C                     MOVE CHTP      CHTP                            180198
     C*                                                                   180198
     C**  OTHER CUSTOMER NUMBER = CUSTOMER NUMBER ON ORIGINAL LOAN FOR    180198
     C**                          PARTICIPATION SOLD                      180198
     C           PTYP      IFEQ 66                                        180198
     C           PTYP      OREQ 67                                        180198
     C                     MOVE OLNO      KLNRF                           180198
     C/COPY WNCPYSRC,MQ552XC046
     C           CLOANK    CHAINCLOANX               60                   180198
     C/COPY WNCPYSRC,MQ552XC047
     C*                                                                   180198
     C** DO NOT PERFORM DATABASE ERROR PROCESSING.                        180198
     C*                                                                   180198
     C**********           Z-ADDCNUMLE    OCUS                                         180198 CSD027
     C                     MOVE CNUMLE    OCUS                                                CSD027
     C                     END                                            180198
      *                                                                   180198
      ** For Participations Purchased extract original borrower, OLNO,    180198
      ** into other customer field.                                       180198
      *                                                                   180198
     C           PTYP      IFEQ 64                                        180198
     C           PTYP      OREQ 65                                        180198
     C**********           Z-ADDOLNO      OCUS                                         180198 CSD027
     C                     MOVE OLNO      OCUS                                                CSD027
     C                     ENDIF                                          180198
     C*                                                                   180198
     C**  WRITE RECORD TO MQALM                                           180198
     C                     WRITEMQALMF                                    180198
     C*                                                                   180198
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK                             180198
     C                     EXSR ZERO                                      180198
     C                     END                                            180198
     C*                                                                   180198
     C**  READ NEXT CUSTOMER LOAN                                         180198
     C                     READ MCLONCL                  50               180198
     C*                                                                   180198
     C                     END                                            180198
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. FACILY - PROCESS FACILITIES                               *
     C*                                                                  *
     C*    CALLED BY: PROCLE - PROCESS LE TRANSACTIONS                   *
     C*    CALLS:     ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               *PSSR  - ERROR PROCESSING                          *
     C*               FACNAM - ACCESS FACILITY NAME                      *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           FACILY    BEGSR
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  READ FACILITIES FILE
     C                     READ FCLTY                    50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C**  IF A LIVE RECORD HAS BEEN READ
     C           RECI      IFEQ 'D'
     C/COPY WNCPYSRC,MQ552XC024
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  IF NOT A TYPE 'A' RECORD, DATABASE ERROR
     C           RCTP      IFNE 'A'
     C                     MOVEL'FCLTYFM 'DBFILE
     C                     MOVEL*BLANKS   DBKEY
     C                     Z-ADD7         DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  STORE CUSTOMER AND FACILITY FIELDS FOR USE IN CHECKING 'B'
     C**  RECORD
     C**********           Z-ADDCNUM      WCNUM   60                                          CSD027
     C                     MOVE CNUM      WCNUM   6                                           CSD027
     C                     Z-ADDFACT      WFACT   30
     C                     Z-ADDFCNO      WFCNO   20
     C*
     C**  SET UP FIELDS WHICH COME FROM TYPE 'A' RECORD FIRST
     C*
     C**  MODULE ID = 'FAC' FOR FACILITIES AND GUARANTEES; 'COM' FOR
     C**              COMMITMENTS
     C           FCTI      IFEQ 'F'
     C           FCTI      OREQ 'G'
     C                     MOVE 'FAC'     MDID
     C                     END
     C*
     C           FCTI      IFEQ 'C'
     C                     MOVE 'COM'     MDID
     C                     END
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'LE'      IMID
     C*
     C**  DEAL NUMBER = FACILITY TYPE AND FACILITY NUMBER
     C                     MOVE *BLANKS   FCREF   5
     C                     MOVELFACT      FCREF
     C                     MOVE FCNO      FCREF
     C                     MOVE FCREF     DLNO
     C*
     C**  NAME = FACILITY NAME FROM FACILITY TYPES FILE
     C*
     C**  ACCESS FACILITY TYPES ARRAY
     C                     MOVE FACT      XFACTP  3
     C                     EXSR FACNAM
     C                     MOVELXFACNM    NAME
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  TRANSACTION TYPE
     C                     MOVELFACT      TTYP
     C*
     C**  PROCESSING/FACILITY TYPE
     C                     Z-ADDFACT      PFTP
     C*
     C**  SUB-TYPE
     C                     MOVELFCTI      SUBT
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDCNUM      CNUM                                                CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE ORBR      ORBR
     C*
     C**  VALUE DATE = DATE APPROVED
     C                     Z-ADDDTAP      VDAT
     C*
     C**  MATURITY DATE = EXPIRY DATE
     C                     Z-ADDDTEX      MDAT
     C*
     C**  CURRENCY 1 = FACILITY CURRENCY
     C                     MOVE FCCY      CCY1
     C*
     C**  AMOUNT 1 = FACILITY AMOUNT
     C                     Z-ADDFAMT      AMT1
     C*
     C**  RUN DAY AMOUNT 1 = FACILITY AMOUNT CONVERTED TO BASE CURRENCY
     C**                     AT SPOT RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP FACILITY CURRENCY DETAILS
     C                     MOVE FCCY      XCCY
     C                     EXSR CCYDEP
     C*
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE FCCY      ZCCYI
     C                     Z-ADDFAMT      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2 = FACILITY CURRENCY
     C                     MOVE FCCY      CCY2
     C*
     C**  PUT/CALL = REVOLVING CREDIT INDICATOR
     C                     MOVE RVCR      PCAL
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  READ NEXT RECORD FROM FCLTY, WHICH SHOULD BE A TYPE 'B'
     C**  RECORD FOR THE SAME CUSTOMER/FACILITY ON THE 'A' RECORD
     C                     READ FCLTY                    50
     C*
     C           RCTP      IFNE 'B'
     C           WCNUM     ORNE CNUM
     C           WFACT     ORNE FACT
     C           WFCNO     ORNE FCNO
     C           RECI      ORNE 'D'
     C                     MOVEL'FCLTYFN 'DBFILE
     C                     MOVEL*BLANKS   DBKEY
     C                     Z-ADD8         DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  SET UP FIELDS WHICH COME FROM 'B' RECORD
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  AMOUNT 2 = DRAWN AMOUNT DAY 1
     C                     Z-ADDOAM1      AMT2
     C*
     C**  RUN DAY AMOUNT 2 = DRAWN AMOUNT DAY 1 CONVERTED TO BASE
     C**                     CURRENCY AT SPOT RATE
     C                     Z-ADDOAM1      ZAMTCI
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA2
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT FACILITY
     C                     READ FCLTY                    50
     C*
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. GUTEES - PROCESS GUARANTEES                               *
     C*                                                                  *
     C*    CALLED BY: PROCLE - PROCESS LE TRANSACTIONS                   *
     C*    CALLS:     ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           GUTEES    BEGSR
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  READ GUARANTEES FILE
     C                     READ GTEESGT                  50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C**  IF A LIVE RECORD HAS BEEN READ
     C           RECI      IFEQ 'D'
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID
     C*
     C**  GUARANTEE
     C           GSCI      IFEQ 'G'
     C                     MOVE 'GUA'     MDID
     C                     END
     C*
     C**  COLLATERAL
     C           GSCI      IFEQ 'C'
     C                     MOVE 'COL'     MDID
     C                     END
     C*
     C**  SECURITY
     C           GSCI      IFEQ 'S'
     C                     MOVE 'SCY'     MDID
     C                     END
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'LE'      IMID
     C*
     C**  DEAL NUMBER = FACILITY/LOAN REFERENCE
     C                     MOVELFCLN      FLREF   1
     C********** FLREF     IFEQ 'F'                                                           CLE148
     C           FLREF     IFEQ ' '                                                           CLE148
     C                     MOVE FCLN      FCREF
     C                     MOVE FCREF     DLNO
     C                     ELSE
     C                     MOVE FCLN      DLNO
     C                     END
     C*
     C**  NAME
     C*
     C                     MOVEA*BLANKS   NMA,1
     C*
     C**  GUARANTEE
     C           GSCI      IFEQ 'G'
     C                     MOVEATXT,20    NMA,1
     C*
     C                     MOVELGBCN      CKEY
     C                     CALL 'AOCUSTR0'PLIST1
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDCUSTPD'DBFILE                          055237
     C                     MOVELCKEY      DBKEY                           055237
     C                     Z-ADD26        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C                     MOVEABBCSSN    NMA,16
     C                     MOVEANMA       NAME
     C                     END
     C*
     C**  COLLATERAL
     C           GSCI      IFEQ 'C'
     C*
     C**  CHECK WHETHER COLLATERAL FOR LOAN OR FACILITY, IE. IF FIRST
     C****CHARACTER*OF*FACILITY/LOAN*REFERENCE*IS*'F',*COLLATERAL*IS***                       CLE148
      ** character of facility/loan reference is 'F', collateral is                           CLE148
     C**  FOR FACILITY
     C********** FLREF     IFEQ 'F'                                                           CLE148
     C           FLREF     IFEQ ' '                                                           CLE148
     C                     MOVEATXT,21    NMA,1
     C                     MOVE FCLN      FCREF
     C                     MOVELFCREF     FACLTY  6
     C                     MOVE FCREF     FAC     3
     C                     MOVEL'/'       FAC
     C                     MOVE FAC       FACLTY
     C                     MOVEAFACLTY    NMA,25
     C                     ELSE
     C                     MOVEATXT,22    NMA,1
     C                     MOVEAFCLN      NMA,21
     C                     END
     C*
     C                     MOVEANMA       NAME
     C                     END
     C*
     C**  SECURITY
     C           GSCI      IFEQ 'S'
     C*
     C**  CHECK WHETHER SECURITY FOR LOAN OR FACILITY, IE. IF FIRST
     C****CHARACTER*OF*FACILITY/LOAN REFERENCE*IS*'F',*SECURITY*IS*FOR*                       CLE148
      ** character of facility/loan reference is 'F', security is for                         CLE148
     C**  FACILITY
     C********** FLREF     IFEQ 'F'                                                           CLE148
     C           FLREF     IFEQ ' '                                                           CLE148
     C                     MOVEATXT,23    NMA,1
     C                     MOVE FCLN      FCREF
     C                     MOVELFCREF     FACLTY
     C                     MOVE FCREF     FAC
     C                     MOVEL'/'       FAC
     C                     MOVE FAC       FACLTY
     C                     MOVEAFACLTY    NMA,23
     C                     ELSE
     C                     MOVEATXT,24    NMA,1
     C                     MOVEAFCLN      NMA,19
     C                     END
     C*
     C                     MOVEANMA       NAME
     C                     END
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDCNUM      CNUM                                                CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*
     C**  OTHER CUSTOMER NUMBER = GUARANTOR CUSTOMER NUMBER
     C**********           Z-ADDGBCN      OCUS                                                CSD027
     C                     MOVE GBCN      OCUS                                                CSD027
     C*
     C**  VALUE DATE = START DATE
     C                     Z-ADDSTTD      VDAT
     C*
     C**  MATURITY DATE = END DATE
     C                     Z-ADDEDDT      MDAT
     C*
     C**  CURRENCY 1
     C                     MOVE CCY       CCY1
     C*
     C**  AMOUNT 1 = TOTAL AMOUNT
     C                     Z-ADDTAMT      AMT1
     C*
     C**  RUN DAY AMOUNT 1 = TOTAL AMOUNT CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP CURRENCY DETAILS
     C                     MOVE CCY       XCCY
     C                     EXSR CCYDEP
     C*
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE CCY       ZCCYI
     C                     Z-ADDTAMT      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCD       LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTP      CHTP
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT GUARANTEE
     C                     READ GTEESGT                  50
     C*
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. PROCSE - PROCESS SE TRADES AND POSITIONS                  *
     C*                                                                  *
     C*    CALLED BY: MAIN   - MAIN PROCESSING                           *
     C*    CALLS:     SETRAD - PROCESS SE TRADES                         *
     C*               SEBKPN - PROCESS SE BOOK POSITIONS                 *
     C*               SECDPN - PROCESS SE CUSTOMER AND DEPOT POSITIONS   *
     C*                                                                  *
     C********************************************************************
     C*
     C           PROCSE    BEGSR
     C*
     C**  OPEN SECURITIES TRADING FILES
     C***********          OPEN TRADSR                                    180198
     C                     OPEN TRADSH                                    180198
     C                     OPEN SECTY
     C                     OPEN INVTP
     C                     OPEN BKPHD
     C                     OPEN BKPOS
     C                     OPEN CPOSS
     C                     OPEN SEPCBD
     C                     OPEN SEPCCD
     C                     OPEN SEDEL
     C                     OPEN SECEO                                     039495
     C*
     C**  PROCESS SE TRADES
     C                     EXSR SETRAD
     C*
     C**  PROCESS SE BOOK POSITIONS
     C                     EXSR SEBKPN
     C*
     C**  PROCESS SE CUSTOMER AND DEPOT POSITIONS
     C                     EXSR SECDPN
     C*
     C**  CLOSE SE FILES
     C***********          CLOSETRADSR                                    180198
     C                     CLOSETRADSH                                    180198
     C                     CLOSESECTY
     C                     CLOSEINVTP
     C                     CLOSEBKPHD
     C                     CLOSEBKPOS
     C                     CLOSECPOSS
     C                     CLOSESEPCBD
     C                     CLOSESEPCCD
     C                     CLOSESEDEL
     C                     CLOSESECEO                                     039495
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. SETRAD - PROCESS SE TRADES                                *
     C*                                                                  *
     C*    CALLED BY: PROCSE - PROCESS SE TRADES AND POSITIONS           *
     C*    CALLS:     *PSSR  - ERROR PROCESSING                          *
     C*               ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               ZSEDIT - EDIT NUMERIC FIELDS                       *
     C*               ZDATE2 - CONVERT DAY NUMBER TO DDMMMYY FORMAT      *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*                                                                  *
     C********************************************************************
     C*
     C           SETRAD    BEGSR
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  INITIALISE SECURITY WORK FIELD TO BLANK
     C                     MOVE *BLANKS   WTDSS  10
     C*
     C**  READ SE TRADES
     C***********          READ TRADSR                   50               180198
     C                     READ TRADSH                   50               180198
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C**  IF A LIVE RECORD HAS BEEN READ
     C           RECI      IFEQ 'D'
     C           RECI      OREQ 'S'
     C/COPY WNCPYSRC,MQ552XC025
     C*
     C**  ON CHANGE OF SECURITY, ACCESS SECURITIES FILE FOR INVESTMENT
     C**  TYPE
     C           TDSS      IFNE WTDSS
     C           TDSS      CHAINSECTY                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'SECTY   'DBFILE
     C                     MOVELTDSS      DBKEY
     C                     Z-ADD9         DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  ACCESS INVESTMENT TYPES FILE USING NOMINAL CURRENCY AND
     C**  INVESTMENT TYPE FROM SECURITY
     C                     MOVELNMCY      KNMCY
     C                     MOVE SITP      KSITP
     C           INVTPK    CHAININVTP                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'INVTP   'DBFILE
     C                     MOVELDINVTP    DBKEY
     C                     Z-ADD10        DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  STORE SECURITY IN WORK FIELD
     C                     MOVE TDSS      WTDSS
     C                     END
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID
     C*
     C**  TRADE PURCHASE
     C           TDTP      IFEQ 'TP'
     C                     MOVE 'SEP'     MDID
     C*
     C**  TRADE SALE
     C                     ELSE
     C                     MOVE 'SES'     MDID
     C                     END
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'SE'      IMID
     C*
     C**  DEAL NUMBER = TRADE REFERENCE
     C                     MOVE TDRF      DLNO
     C*
     C**  NAME
     C*
     C**  SET NAME ARRAY TO BLANKS
     C                     Z-ADD1         X
     C                     MOVEA*BLANKS   NMA,X
     C*
     C**  ACCESS CUSTOMER DETAILS FOR ISSUER ON SECURITY
     C                     MOVELISSR      CKEY
     C                     CALL 'AOCUSTR0'PLIST1
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDCUSTPD'DBFILE                          055237
     C                     MOVELCKEY      DBKEY                           055237
     C                     Z-ADD27        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C**  MOVE CUSTOMER REPORT NAME INTO NAME ARRAY
     C                     MOVEABBCRNM    NMA,X
     C                     ADD  17        X
     C*
     C**  IF NOT DISCOUNT BASIS AND MATURITY DATE IS NOT ZERO
     C           STBS      IFNE 'D'
     C           MATY      ANDNE*ZERO
     C*
     C**  EDIT COUPON RATE
     C                     Z-ADDCPNR      WINTR     H
     C                     MOVE WINTR     ZFLD15
     C                     Z-ADD3         ZDECS
     C                     EXSR ZSEDIT
     C*
     C**  MOVE COUPON RATE TO NAME ARRAY
     C                     MOVE ZOUT21    WAINTR
     C                     MOVEAWAINTR    NMA,X
     C                     END
     C                     ADD  8         X
     C*
     C**  CONVERT MATURITY DATE TO DDMMMYY FORMAT
     C           MATY      IFNE *ZERO
     C                     Z-ADDMATY      ZDAYNO
     C                     EXSR ZDATE2
     C*
     C**  MOVE MONTH NAME AND YEAR OF MATURITY DATE TO NAME ARRAY
     C                     MOVE ZADATE    WMDAT
     C                     MOVEAWMDAT     NMA,X
     C                     END
     C*
     C**  MOVE NAME ARRAY TO NAME FIELD ON FILE
     C                     MOVEANMA       NAME
     C*
     C**  BRANCH CODE
     C                     MOVE TDBA      BRCA
     C*
     C**  PROFIT CENTRE
     C                     MOVE PRFC      PRFC
     C*
     C**  TRANSACTION TYPE
     C                     MOVELSITP      TTYP
     C*
     C**  PROCESSING/FACILITY TYPE
     C                     MOVE PROT      PFTP
     C*
     C**  SUB-TYPE = SECURITY SHORTNAME
     C                     MOVE TDSS      SUBT
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDTCNR      CNUM                                                CSD027
     C                     MOVE TCNR      CNUM                                                CSD027
     C*
     C**  LINKED DEAL NUMBER = LINK REFERENCE
     C                     MOVE LKRF      LNKD
     C*
     C**  BOOK CODE
     C                     MOVE TDBK      BOKC
     C*
     C**  DEALER ID = TRADER ID
     C                     MOVE TDID      DLID
     C*
     C**  ORIGINATING BRANCH
     C                     MOVE ORBR      ORBR
     C*
     C**  ASSOCIATED DEAL NUMBER = RELATED TRADE REFERENCE
     C                     MOVE RTRF      ADLN
     C*
     C**  DEAL DATE = TRADE DATE
     C                     Z-ADDTDDT      DDAT
     C*
     C**  VALUE DATE
     C                     Z-ADDTDVD      VDAT
     C*
     C**  CURRENCY 1 = NOMINAL CURRENCY
     C                     MOVE TNMC      CCY1
     C*
     C**  NUMBER 1 = NOMINAL AMOUNT
     C                     Z-ADDNOML      NUM1
     C*
     C**  AMOUNT 1 = CONSIDERATION
     C                     Z-ADDTCSR      AMT1
     C*
     C**  CURRENCY 2 = SETTLEMENT CURRENCY
     C                     MOVE SETC      CCY2
     C*
     C**  AMOUNT 2 = COUNTERVALUE IN SETTLEMENT CURRENCY
     C           TOSV      ADD  TVSN      AMT2
     C                     ADD  TVSP      AMT2
     C*
     C**  BASE CURRENCY AMOUNT 2 = AMOUNT 2 CONVERTED TO BASE CURRENCY
     C**                           AT BASE CURRENCY RATE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP SETTLEMENT CURRENCY DETAILS
     C                     MOVE SETC      XCCY
     C                     EXSR CCYDEP
     C*
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE SETC      ZCCYI
     C                     Z-ADDAMT2      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDTBCR      ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    BCA2
     C*
     C**  RUN DAY AMOUNT 2 = AMOUNT 2 CONVERTED TO BASE CURRENCY AT
     C**                     SPOT RATE
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA2
     C*
     C**  PRICE
     C                     Z-ADDSEPRIC    PRIC      H
     C*
     C**  MARKET PRICE
     C                     Z-ADDMKPR      MPRC      H
     C*
     C**  YIELD RATE = PRICE/DISCOUNT/YIELD
     C                     Z-ADDTPDY      YRAT      H
     C*
     C**  INTEREST RATE = COUPON RATE
     C                     Z-ADDTDCR      INTR
     C*
     C**  ACCRUED INTEREST POSTED TO DATE = PURCHASED INTEREST AMOUNT +
     C**                                    INTEREST ADJUSTMENT
     C           ITRA      ADD  TINA      AIPD
     C/COPY WNCPYSRC,MQ552XC026
     C*
     C**  LAST CHANGE DATE
     C                     Z-ADDLCDTR     LCD
     C*
     C**  LAST CHANGE TYPE
     C                     MOVE CHTPTR    CHTP
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT SE TRADE
     C***********          READ TRADSR                   50               180198
     C                     READ TRADSH                   50               180198
     C*
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. SEBKPN - PROCESS SE BOOK POSITIONS                        *
     C*                                                                  *
     C*    CALLED BY: PROCSE - PROCESS SE TRADES AND POSITIONS           *
     C*    CALLS:     *PSSR  - ERROR PROCESSING                          *
     C*               ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               ZSEDIT - EDIT NUMERIC FIELDS                       *
     C*               ZDATE2 - CONVERT DAY NUMBER TO DDMMMYY FORMAT      *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               ZCONV  - CONVERT AN AMOUNT FROM ONE CURRENCY TO    *
     C*                        ANOTHER                                   *
     C*               ZNCD   - DETERMINE NEXT COUPON DATE                *
     C*                                                                  *
     C********************************************************************
     C*
     C           SEBKPN    BEGSR
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  INITIALISE SECURITY WORK FIELD TO BLANK
     C                     MOVE *BLANKS   WTDSS
     C*
     C**  READ SE BOOK POSITION HEADER
     C                     READ BKPHD                    50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C**  IF A LIVE RECORD HAS BEEN READ
     C/COPY WNCPYSRC,MQ552XC042
     C           RECI      IFEQ 'D'
     C/COPY WNCPYSRC,MQ552XC027
     C*
     C**  ACCESS SE BOOK POSITIONS USING SECURITY, BRANCH, BOOK,
     C**  MARKET, TRADE/VALUE DATE BASIS AND LATEST POSITION DATE
     C**  FROM SE BOOK POSITIONS HEADER
     C                     MOVE BHSC      KBHSC
     C                     MOVE BHBA      KBHBA
     C                     MOVE BHBK      KBHBK
     C                     MOVE BHMK      KBHMK
     C                     MOVE BHTV      KBHTV
     C                     Z-ADDLPSD      KLPSD
     C*
     C           BKPOSK    CHAINBKPOS                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'BKPOS   'DBFILE
     C                     MOVELDBKPOS    DBKEY
     C                     Z-ADD11        DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  ON CHANGE OF SECURITY, ACCESS SECURITIES FILE
     C           BHSC      IFNE WTDSS
     C           BHSC      CHAINSECTY                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'SECTY   'DBFILE
     C                     MOVELBHSC      DBKEY
     C                     Z-ADD12        DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  ACCESS INVESTMENT TYPES FILE USING NOMINAL CURRENCY AND
     C**  INVESTMENT TYPE FROM SECURITY
     C                     MOVELNMCY      KNMCY
     C                     MOVE SITP      KSITP
     C           INVTPK    CHAININVTP                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'INVTP   'DBFILE
     C                     MOVELDINVTP    DBKEY
     C                     Z-ADD13        DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  STORE SECURITY IN WORK FIELD
     C                     MOVE BHSC      WTDSS
     C                     END
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID
     C                     MOVE 'SEB'     MDID
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'SE'      IMID
     C*
     C**  POSITION/BALANCE NUMBER
     C                     MOVE BPBA      SBBPBA
     C                     MOVE BPSC      SBBPSC
     C                     MOVE BPBK      SBBPBK
     C                     MOVE BPMK      SBBPMK
     C                     MOVE BPTV      SBBPTV
     C*
     C                     MOVELSEBKDS    PBNO
     C*
     C**  NAME
     C*
     C**  SET NAME ARRAY TO BLANKS
     C                     Z-ADD1         X
     C                     MOVEA*BLANKS   NMA,X
     C*
     C**  ACCESS CUSTOMER DETAILS FOR ISSUER ON SECURITY
     C                     MOVELISSR      CKEY
     C                     CALL 'AOCUSTR0'PLIST1
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDCUSTPD'DBFILE                          055237
     C                     MOVELCKEY      DBKEY                           055237
     C                     Z-ADD28        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C**  MOVE CUSTOMER REPORT NAME INTO NAME ARRAY
     C                     MOVEABBCRNM    NMA,X
     C                     ADD  17        X
     C*
     C**  IF NOT DISCOUNT BASIS AND MATURITY DATE IS NOT ZERO
     C           STBS      IFNE 'D'
     C           MATY      ANDNE*ZERO
     C*
     C**  EDIT COUPON RATE
     C                     Z-ADDCPNR      WINTR     H
     C                     MOVE WINTR     ZFLD15
     C                     Z-ADD3         ZDECS
     C                     EXSR ZSEDIT
     C*
     C**  MOVE COUPON RATE TO NAME ARRAY
     C                     MOVE ZOUT21    WAINTR
     C                     MOVEAWAINTR    NMA,X
     C                     END
     C                     ADD  8         X
     C*
     C**  CONVERT MATURITY DATE TO DDMMMYY FORMAT
     C           MATY      IFNE *ZERO
     C                     Z-ADDMATY      ZDAYNO
     C                     EXSR ZDATE2
     C*
     C**  MOVE MONTH NAME AND YEAR OF MATURITY DATE TO NAME ARRAY
     C                     MOVE ZADATE    WMDAT
     C                     MOVEAWMDAT     NMA,X
     C                     END
     C*
     C**  MOVE NAME ARRAY TO NAME FIELD ON FILE
     C                     MOVEANMA       NAME
     C*
     C**  BRANCH CODE
     C                     MOVE BPBA      BRCA
     C*
     C**  PROFIT CENTRE
     C*
     C*   ACCESS SE BOOK POSITION PROFIT CENTRES FILE USING BOOK,
     C*   BRANCH, SECURITY AND MARKET FROM BOOK POSITIONS FILE
     C                     MOVE BPBK      KBPBK
     C                     MOVE BPBA      KBPBA
     C                     MOVE BPSC      KBPSC
     C                     MOVE BPMK      KBPMK
     C*
     C           SEPCBK    CHAINSEPCBD               60
     C           *IN60     IFEQ '0'
     C                     MOVE PCBK      PRFC
     C                     END
     C*
     C**  TRANSACTION TYPE
     C                     MOVELINVT      TTYP
     C*
     C**  PROCESSING/FACILITY TYPE
     C                     MOVE PROT      PFTP
     C*
     C**  SUB-TYPE = SECURITY SHORTNAME
     C                     MOVE BPSC      SUBT
     C*
     C**  CUSTOMER NUMBER
     C**********           Z-ADDISSR      CNUM                                                CSD027
     C                     MOVE ISSR      CNUM                                                CSD027
     C*
     C**  BOOK CODE
     C                     MOVE BPBK      BOKC
     C*
     C**  DEAL DATE = POSITION DATE FOR TRADE DATE POSITIONS
     C           BPTV      IFEQ 'T'
     C                     Z-ADDBPPD      DDAT
     C                     END
     C*
     C**  VALUE DATE = POSITION DATE FOR VALUE DATE POSITIONS
     C           BPTV      IFEQ 'V'
     C                     Z-ADDBPPD      VDAT
     C                     END
     C*
     C**  CURRENCY 1 = NOMINAL CURRENCY
     C                     MOVE NMCY      CCY1
     C*
     C**  NUMBER 1 = NOMINAL POSITION
     C                     Z-ADDNPSN      NUM1
     C*
     C**  AMOUNT 1 = NOMINAL POSITION X LATEST AVERAGE PRICE
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP NOMINAL CURRENCY DETAILS
     C                     MOVE NMCY      XCCY
     C                     EXSR CCYDEP
     C                     Z-ADDLAVP      ZPRC
     C                     Z-ADDNPSN      ZNOML
     C                     Z-ADDXDECP     ZCDP
     C                     EXSR ZCNSD
     C                     Z-ADDZCONS     AMT1
     C*
     C**  RUN DAY AMOUNT 1 = AMOUNT 1 CONVERTED TO BASE CURRENCY AT
     C**                     AT SPOT RATE
     C*
     C                     Z-ADDXDECP     ZCDPI
     C                     MOVE NMCY      ZCCYI
     C                     Z-ADDAMT1      ZAMTCI
     C                     MOVE XMDIN     ZMD
     C                     Z-ADDXSPOT     ZEXCH
     C                     EXSR ZCONV
     C                     Z-ADDZAMTCO    RDA1
     C*
     C**  CURRENCY 2 = NOMINAL CURRENCY
     C                     MOVE NMCY      CCY2
     C*
     C**  NUMBER 2 = EX-COUPON NOMINAL POSITION
     C                     Z-ADDECNP      NUM2
     C*
     C**  AMOUNT 2 = PURCHASED INTEREST
     C/COPY WNCPYSRC,MQ552XC043
     C                     Z-ADDPILP      AMT2
     C*
     C**  PRICE = LATEST AVERAGE PRICE
     C                     Z-ADDLAVP      PRIC      H
     C*
     C**  MARKET PRICE
     C                     Z-ADDMKPR      MPRC      H
     C*
     C**  YIELD RATE = LATEST AVERAGE PRICE CONVERTED TO A YIELD IF NOT
     C**               DAY BASIS 4
     C           DYBS      IFNE '4'
     C           LAVP      IFNE *ZERO
     C                     Z-ADDLAVP      ZPRICE
     C                     Z-ADDBJRDNB    ZFDATE
     C                     EXSR ZPRCO
     C                     Z-ADDZPRCOT    YRAT      H
     C                     END
     C                     END
     C*
     C**  INTEREST RATE = COUPON RATE
     C                     Z-ADDCPNR      INTR
     C*
     C**  NEXT INTEREST PAYMENT DATE = NEXT COUPON DATE IF COUPON DATES
     C**                               DEFINED
     C           CD01      IFNE *ZERO
     C           LCPN      ADD  1         ECD     50
     C                     EXSR ZNCD
     C                     Z-ADDNCD       NIPD
     C                     END
     C*
     C**  LAST INTEREST PAYMENT DATE = LAST COUPON DATE
     C                     Z-ADDLCPN      LIPD
     C*
     C**  INTEREST CALCULATION BASIS = DAY BASIS
     C                     MOVELDYBS      ICBS
     C*
     C**  INTEREST CALCULATION BASIS 2 = DIVISOR BASIS
     C                     MOVELDVBS      ICB2
     C/COPY WNCPYSRC,MQ552XC028
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C                     END
     C*
     C**  READ NEXT SE BOOK POSITION HEADER
     C                     READ BKPHD                    50
     C*
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    SR. SECDPN - PROCESS SE CUSTOMER AND DEPOT POSITIONS          *
     C*                                                                  *
     C*    CALLED BY: PROCSE - PROCESS SE TRADES AND POSITIONS           *
     C*    CALLS:     *PSSR  - ERROR PROCESSING                          *
     C*               ZERO   - INITIALISE ALL FIELDS TO ZERO/BLANK       *
     C*               ZSEDIT - EDIT NUMERIC FIELDS                       *
     C*               ZDATE2 - CONVERT DAY NUMBER TO DDMMMYY FORMAT      *
     C*                                                                  *
     C********************************************************************
     C*
     C           SECDPN    BEGSR
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C**  INITIALISE SECURITY WORK FIELD TO BLANK
     C                     MOVE *BLANKS   WTDSS
     C*
     C                     SETOF                     1011
     C*
     C**  READ SE CUSTOMER AND DEPOT POSITIONS BY SECURITY
     C                     READ CPOSS                    50
     C*
     C**  DO WHILE NOT END OF FILE
     C           *IN50     DOWEQ'0'
     C*
     C**  ON CHANGE OF SECURITY, ACCESS SECURITIES FILE
     C           SESN      IFNE WTDSS
     C           SESN      CHAINSECTY                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'SECTY   'DBFILE
     C                     MOVELSESN      DBKEY
     C                     Z-ADD14        DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  ACCESS INVESTMENT TYPES FILE USING NOMINAL CURRENCY AND
     C**  INVESTMENT TYPE FROM SECURITY
     C                     MOVELNMCY      KNMCY
     C                     MOVE SITP      KSITP
     C           INVTPK    CHAININVTP                60
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN60     IFEQ '1'
     C                     MOVEL'INVTP   'DBFILE
     C                     MOVELDINVTP    DBKEY
     C                     Z-ADD15        DBASE
     C                     EXSR *PSSR
     C                     END
     C*
     C**  STORE SECURITY IN WORK FIELD
     C                     MOVE SESN      WTDSS
     C                     END
     C*
     C**  SET UP FIELDS FOR ASSET AND LIABILITY MANAGEMENT FILE
     C*
     C**  MODULE ID
     C*
     C**  CUSTOMER POSITIONS
     C           *IN10     IFEQ '1'
     C                     MOVE 'SEC'     MDID
     C                     END
     C*
     C**  DEPOT POSITIONS
     C           *IN11     IFEQ '1'
     C                     MOVE 'SED'     MDID
     C                     END
     C*
     C**  INTERNAL MODULE ID
     C                     MOVE 'SE'      IMID
     C*
     C**  POSITION/BALANCE NUMBER
     C                     MOVE BRCA      SCBRCA
     C                     MOVE SESN      SCSESN
     C                     MOVE CNUM      SCCNUM
     C*
     C                     MOVELSECDDS    PBNO
     C*
     C**  NAME
     C*
     C**  SET NAME ARRAY TO BLANKS
     C                     Z-ADD1         X
     C                     MOVEA*BLANKS   NMA,X
     C*
     C**  ACCESS CUSTOMER DETAILS FOR ISSUER ON SECURITY
     C                     MOVELISSR      CKEY
     C                     CALL 'AOCUSTR0'PLIST1
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDCUSTPD'DBFILE                          055237
     C                     MOVELCKEY      DBKEY                           055237
     C                     Z-ADD29        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C**  MOVE CUSTOMER REPORT NAME INTO NAME ARRAY
     C                     MOVEABBCRNM    NMA,X
     C                     ADD  17        X
     C*
     C**  IF NOT DISCOUNT BASIS AND MATURITY DATE IS NOT ZERO
     C           STBS      IFNE 'D'
     C           MATY      ANDNE*ZERO
     C*
     C**  EDIT COUPON RATE
     C                     Z-ADDCPNR      WINTR     H
     C                     MOVE WINTR     ZFLD15
     C                     Z-ADD3         ZDECS
     C                     EXSR ZSEDIT
     C*
     C**  MOVE COUPON RATE TO NAME ARRAY
     C                     MOVE ZOUT21    WAINTR
     C                     MOVEAWAINTR    NMA,X
     C                     END
     C                     ADD  8         X
     C*
     C**  CONVERT MATURITY DATE TO DDMMMYY FORMAT
     C           MATY      IFNE *ZERO
     C                     Z-ADDMATY      ZDAYNO
     C                     EXSR ZDATE2
     C*
     C**  MOVE MONTH NAME AND YEAR OF MATURITY DATE TO NAME ARRAY
     C                     MOVE ZADATE    WMDAT
     C                     MOVEAWMDAT     NMA,X
     C                     END
     C*
     C**  MOVE NAME ARRAY TO NAME FIELD ON FILE
     C                     MOVEANMA       NAME
     C*
     C**  BRANCH CODE
     C                     MOVE BRCA      BRCA
     C*
     C*   PROFIT CENTRE = PROFIT CENTRE FROM CUSTOMER POSITION PROFIT
     C*   CENTRES FILE FOR CUSTOMER POSITIONS;
     C*
     C*   ACCESS SE CUSTOMER POSITION PROFIT CENTRES FILE USING
     C*   CUSTOMER, BRANCH AND SECURITY FROM CUSTOMER POSITIONS FILE
     C           *IN10     IFEQ '1'
     C**********           Z-ADDCNUM      KCNUM                                               CSD027
     C                     MOVE CNUM      KCNUM                                               CSD027
     C                     MOVE BRCA      KBRCA
     C                     MOVE SESN      KSESN
     C           SEPCCK    CHAINSEPCCD               60
     C           *IN60     IFEQ '0'
     C                     MOVE PCCU      PRFC
     C                     END
     C                     END
     C*
     C**  TRANSACTION TYPE
     C                     MOVELSITP      TTYP
     C*
     C**  PROCESSING/FACILITY TYPE
     C                     MOVE PROT      PFTP
     C*
     C**  SUB-TYPE = SECURITY SHORTNAME
     C                     MOVE SESN      SUBT
     C*
     C**  CUSTOMER NUMBER = CUSTOMER/DEPOT
     C**********           Z-ADDCNUM      CNUM                                                CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C*
     C**  DEAL DATE
     C                     Z-ADDPDAT      DDAT
     C*
     C**  VALUE DATE
     C                     Z-ADDPDAT      VDAT
     C*
     C**  CURRENCY 1 = NOMINAL CURRENCY
     C                     MOVE NMCY      CCY1
     C*
     C**  NUMBER 1 = NOMINAL TRADE DATE BASIS
     C                     Z-ADDPSNT      NUM1
     C*
     C**  AMOUNT 1 = AP NUMERATOR TRADE DATE BASIS FOR CUSTOMER
     C**             POSITIONS
     C           *IN10     IFEQ '1'
     C                     Z-ADDCSPT      AMT1
     C                     END
     C*
     C**  CURRENCY 2 = NOMINAL CURRENCY
     C                     MOVE NMCY      CCY2
     C*
     C**  NUMBER 2 = NOMINAL VALUE DATE BASIS
     C                     Z-ADDPSNV      NUM2
     C*
     C**  AMOUNT 2 = AP NUMERATOR VALUE DATE BASIS FOR CUSTOMER
     C**             POSITIONS
     C           *IN10     IFEQ '1'
     C                     Z-ADDCSPV      AMT2
     C                     END
     C*
     C**  NUMBER 3 = EX-COUPON NOMINAL
     C                     Z-ADDECNP      NUM3
     C*
     C**  WRITE RECORD TO MQALM
     C                     WRITEMQALMF
     C*
     C**  INITIALISE ALL FIELDS TO ZERO/BLANK
     C                     EXSR ZERO
     C*
     C                     SETOF                     1011
     C*
     C**  READ NEXT SE CUSTOMER OR DEPOT POSITION
     C                     READ CPOSS                    50
     C*
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    CCYDEP - ACCESS CURRENCY DETAILS                              *
     C*                                                                  *
     C*    CALLED BY: LELOAN - PROCESS CUSTOMER LOANS                    *
     C*               FXDEAL - PROCESS FX DEALS AND INTERNAL CONTRACTS   *
     C*               MMLOAN - PROCESS MM LOANS                          *
     C*               NAPURC - PROCESS NEGOTIABLE ASSETS PURCHASED       *
     C*               NASOLD - PROCESS NEGOTIABLE ASSETS SOLD            *
     C*               FACILY - PROCESS FACILITIES                        *
     C*               GUTEES - PROCESS GUARANTEES                        *
     C*               FFTRAN - PROCESS FUTURES AND OPTIONS TRANSACTIONS  *
     C*               FFBCPN - PROCESS FF BOOK AND CUSTOMER POSITIONS    *
     C*               SETRAD - PROCESS SE TRADES                         *
     C*               SEBKPN - PROCESS SE BOOK POSITIONS                 *
     C*               PROCAC - PROCESS RE AND GL ACCOUNTS                *
     C*               INIT   - INITIAL PROCESSING                        *
     C*    CALLS:     *PSSR - ERROR PROCESSING                           *
     C*                                                                  *
     C********************************************************************
     C*
     C           CCYDEP    BEGSR
     C*
     C                     Z-ADD1         Z
     C           XCCY      LOKUPXCYA,Z                   61
     C*
     C**  ARRAY XCYA HAS BEEN FILLED WITH RECORDS FROM SDCURRPD IN
     C**  SR. CCYARR; THEREFORE, IF A CURRENCY IS NOT FOUND IN THE
     C**  ARRAY, IT IS A DATABASE ERROR ON SDCURRPD
     C*
     C           *IN61     IFEQ '0'
     C                     MOVEL'SDCURRPD'DBFILE
     C                     MOVELXCCY      DBKEY
     C                     Z-ADD16        DBASE
     C                     EXSR *PSSR
     C*
     C**  OTHERWISE, STORE DECIMAL PLACES, SPOT RATE AND M/D INDICATOR
     C                     ELSE
     C                     Z-ADDXDPA,Z    XDECP   10
     C                     Z-ADDXSPA,Z    XSPOT  138
     C                     MOVE XMDA,Z    XMDIN   1
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    LOANDS - ACCESS LOAN TYPE DESCRIPTION                         *
     C*                                                                  *
     C*    CALLED BY: LELOAN - PROCESS CUSTOMER LOANS                    *
     C*    CALLS:     *PSSR  - ERROR PROCESSING                          *
     C*                                                                  *
     C********************************************************************
     C*
     C           LOANDS    BEGSR
     C*
     C                     Z-ADD1         Z
     C           XLNTYP    LOKUPXLTA,Z                   61
     C*
     C**  ARRAY XLTA HAS BEEN FILLED WITH RECORDS FROM SDLOANPD IN
     C**  SR. LNTARR; THEREFORE, IF A LOAN TYPE/SUB-TYPE IS NOT FOUND
     C**  IN THE ARRAY, IT IS A DATABASE ERROR ON SDLOANPD
     C*
     C           *IN61     IFEQ '0'
     C                     MOVEL'SDLOANPD'DBFILE
     C                     MOVELXLNTYP    DBKEY
     C                     Z-ADD17        DBASE
     C                     EXSR *PSSR
     C*
     C**  OTHERWISE, STORE LOAN TYPE DESCRIPTION
     C                     ELSE
     C                     MOVELXLNA,Z    XLNDES 30
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    FACNAM - ACCESS FACILITY NAME                                 *
     C*                                                                  *
     C*    CALLED BY: FACILY - PROCESS FACILITIES                        *
     C*    CALLS:     *PSSR  - ERROR PROCESSING                          *
     C*                                                                  *
     C********************************************************************
     C*
     C           FACNAM    BEGSR
     C*
     C                     Z-ADD1         Z
     C           XFACTP    LOKUPXFCA,Z                   61
     C*
     C**  ARRAY XFCA HAS BEEN FILLED WITH RECORDS FROM SDFACTPD IN
     C**  SR. FACARR; THEREFORE, IF A FACILITY TYPE IS NOT FOUND IN
     C**  THE ARRAY, IT IS A DATABASE ERROR ON SDFACTPD
     C*
     C           *IN61     IFEQ '0'
     C                     MOVEL'SDFACTPD'DBFILE
     C                     MOVELXFACTP    DBKEY
     C                     Z-ADD18        DBASE
     C                     EXSR *PSSR
     C*
     C**  OTHERWISE, STORE FACILITY NAME
     C                     ELSE
     C                     MOVELXFNA,Z    XFACNM 30
     C                     END
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    INIT - INITIAL PROCESSING                                     *
     C*                                                                  *
     C*    CALLED BY:                                                    *
     C*    CALLS:     CCYARR - SET UP CURRENCY ARRAYS                    *
     C*               CCYDEP - ACCESS CURRENCY DETAILS                   *
     C*               LNTARR - SET UP LOAN TYPES ARRAYS                  *
     C*               FACARR - SET UP FACILITY TYPES ARRAYS              *
     C*               KEYLST - SET UP KEY LISTS                          *
     C*               USRDEF - SET ALL USER DEFINABLE FIELDS TO ZERO/    *
     C*                        BLANK                                     *
     C*                                                                  *
     C********************************************************************
     C*
     C           INIT      BEGSR
     C*
     C                     MOVEACPY@      ACT@   80
     C/COPY WNCPYSRC,MQ552XC001
      *                                                                                       CSE035
      *  Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     END                                                                CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     END                                                                207543
      *                                                                                       CSE035
     C*
     C**  ACCESS BANK DETAILS FOR BASE CURRENCY
     C                     CALL 'AOBANKR0'
     C***********          PARM '*DBERR ' @RTCD                           055237
     C                     PARM '       ' @RTCD                           055237
     C                     PARM '*FIRST ' @OPTN
     C           SDBANK    PARM SDBANK    DSFDY
     C*                                                                   055237
     C           @RTCD     IFNE *BLANK                                    055237
     C                     MOVEL'SDBANKPD'DBFILE                          055237
     C                     MOVEL'*FIRST  'DBKEY                           055237
     C                     Z-ADD20        DBASE                           055237
     C                     EXSR *PSSR                                     055237
     C                     END                                            055237
     C*
     C/COPY WNCPYSRC,MQ552XC049
     C**  ACCESS MQ DATA AREA
     C           *NAMVAR   DEFN           MQSEL
     C           *LOCK     IN   MQSEL
     C*
     C**  CHECK SYSTEM DATE FORMAT
     C           BJDFIN    COMP 'M'                      98
     C*
     C**  SET UP CURRENCY ARRAYS
     C                     EXSR CCYARR
     C*
     C**  ACCESS CURRENCY ARRAYS TO PICK UP BASE CURRENCY DETAILS
     C                     MOVE BJCYCD    XCCY    3
     C                     EXSR CCYDEP
     C*
     C**  SET UP 'TO' CURRENCY DETAILS FOR USE IN STANDARD SR. ZCONV
     C                     MOVE BJCYCD    ZCCYO
     C                     Z-ADDXDECP     ZCDPO
     C*
     C**  SET UP LOAN TYPE/SUB-TYPE ARRAYS
     C                     EXSR LNTARR
     C*
     C**  SET UP FACILITY TYPE ARRAYS
     C                     EXSR FACARR
     C*
     C**  SET UP KEY LISTS
     C                     EXSR KEYLST
     C*
     C**  SET ALL USER DEFINABLE FIELDS TO BLANK/ZERO
     C                     EXSR USRDEF
     C*
     C**  Check if SAR S01453 is installed                                S01453
     C*                                                                   S01453
     C                     CALL 'AOSARDR0'                                S01453
     C                     PARM *BLANKS   @RTCD   7                       S01453
     C                     PARM '*VERIFY' @OPTN   7                       S01453
     C                     PARM 'S01453'  @SARD   6                       S01453
     C                     PARM           DSFDY                           S01453
     C*                                                                   S01453
     C**    SAR S01453 is installed                                       S01453
     C*                                                                   S01453
     C           @RTCD     IFEQ *BLANK                     *B1            S01453
     C                     MOVE '1'       *IN30                           S01453
     C                     ELSE                            *X1            S01453
     C*                                                                   S01453
     C**    SAR S01453 is not installed                                   S01453
     C*                                                                   S01453
     C           @RTCD     IFEQ '*NRF'                     *B2            S01453
     C                     MOVE '0'       *IN30                           S01453
     C                     ELSE                            *X2            S01453
     C*                                                                   S01453
     C**    Database error processing                                     S01453
     C*                                                                   S01453
     C                     MOVEL'SCSARDPD'DBFILE                          S01453
     C                     MOVEL'S01453'  DBKEY                           S01453
     C                     Z-ADD19        DBASE                           S01453
     C                     EXSR *PSSR                                     S01453
     C                     END                             *E2            S01453
     C*                                                                   S01453
     C                     END                             *E1            S01453
     C*                                                                   S01453
     C/COPY WNCPYSRC,MQ552XC050
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    UPDSEL - UPDATE DTAARA/MQSEL                                  *
     C*                                                                  *
     C*    CALLED BY:                                                    *
     C*    CALLS:     ZFREQB - INCREMENT A DAY NUMBER BY A PERIOD VALUE  *
     C*                        DETERMINED BY A CODE                      *
     C*               ZDATE2 - CONVERT DAY NUMBER TO DDMMYY FORMAT       *
     C*                                                                  *
     C********************************************************************
     C*
     C           UPDSEL    BEGSR
     C*
     C**  IF PROGRAM HAS NOT BEEN RUN AS AN EXCEPTION RUN,
     C**  IE. TODAY WAS AN EXPECTED RUN DATE, DETERMINE NEXT RUN DATE
     C**  USING STANDARD SR. ZFREQB
     C                     MOVE NRUN      NNRUN   50
     C           NNRUN     IFLT BJDNWD
     C*
     C**  UPDATE LAST RUN DATE
     C                     MOVE NRUN      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    LRUN
     C/COPY WNCPYSRC,MQ552XC029
     C*
     C**  UPDATE NEXT RUN DATE
     C                     MOVE EXFQ      ZFREQ
     C                     MOVE BJLCCY    ZCCY
     C                     MOVE BSDY      ZMDAY
     C                     EXSR ZFREQB
     C                     MOVE ZDAYNO    NRUN
     C*
     C**  OTHERWISE, PROGRAM HAS BEEN RUN AS AN EXCEPTION RUN, UPDATE
     C**  RUN TODAY FLAG TO 'N' AND LAST RUN DATE TO TODAY
     C                     ELSE
     C                     MOVE 'N'       RNTD
     C/COPY WNCPYSRC,MQ552XC044
     C                     MOVE BJMRDT    LRUN
     C/COPY WNCPYSRC,MQ552XC045
     C                     END
     C*
     C                     OUT  MQSEL
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    CCYARR - SET UP CURRENCY ARRAYS                               *
     C*                                                                  *
     C*    CALLED BY: INIT - INITIAL PROCESSING                          *
     C*    CALLS:                                                        *
     C*                                                                  *
     C********************************************************************
     C*
     C           CCYARR    BEGSR
     C*
     C**  READ ALL RECORDS FROM CURRENCY DETAILS FILE AND SET UP
     C**  CURRENCY CODE, DECIMAL PLACES, SPOT RATE AND MULTIPLY/DIVIDE
     C**  INDICATOR ARRAYS
     C                     OPEN SDCURRPD
     C*
     C                     Z-ADD1         Z       30
     C                     READ SDCURRPD                 61
     C*
     C           *IN61     DOWEQ'0'
     C                     MOVE A6CYCD    XCYA,Z
     C                     MOVE A6NBDP    XDPA,Z
     C                     MOVE A6SPRT    XSPA,Z
     C                     MOVE A6MDIN    XMDA,Z
     C                     ADD  1         Z
     C                     READ SDCURRPD                 61
     C                     END
     C*
     C                     CLOSESDCURRPD
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    LNTARR - SET UP LOAN TYPES ARRAYS                             *
     C*                                                                  *
     C*    CALLED BY: INIT - INITIAL PROCESSING                          *
     C*    CALLS:                                                        *
     C*                                                                  *
     C********************************************************************
     C*
     C           LNTARR    BEGSR
     C*
     C**  READ ALL RECORDS FROM LOAN TYPES/SUB-TYPES FILE AND SET UP
     C**  LOAN TYPES/SUB-TYPES AND LOAN TYPE DESCRIPTION ARRAYS
     C                     OPEN SDLOANPD
     C*
     C                     Z-ADD1         Z
     C                     READ SDLOANPD                 61
     C*
     C           *IN61     DOWEQ'0'
     C*********************MOVELAYLNTY    XLTA,Z                                              CLE042
     C*********************MOVE AYLNST    XLTA,Z                                              CLE042
     C                     MOVELAYLNTY    XLTA,Z                                              CLE042
     C                     MOVELAYLNST    WKSTCL                                              CLE042
     C                     MOVE AYLNCL    WKSTCL                                              CLE042
     C                     MOVE WKSTCL    XLTA,Z                                              CLE042
     C                     MOVE AYLNTD    XLNA,Z
     C                     ADD  1         Z
     C                     READ SDLOANPD                 61
     C                     END
     C*
     C                     CLOSESDLOANPD
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    FACARR - SET UP FACILITY TYPES ARRAYS                         *
     C*                                                                  *
     C*    CALLED BY: INIT - INITIAL PROCESSING                          *
     C*    CALLS:                                                        *
     C*                                                                  *
     C********************************************************************
     C*
     C           FACARR    BEGSR
     C*
     C**  READ ALL RECORDS FROM FACILITY TYPES FILE AND SET UP FACILITY
     C**  TYPE AND FACILITY NAME ARRAYS
     C                     OPEN SDFACTPD
     C*
     C                     Z-ADD1         Z
     C                     READ SDFACTPD                 61
     C*
     C           *IN61     DOWEQ'0'
     C                     MOVE AMFCTY    XFCA,Z
     C                     MOVE AMFCNM    XFNA,Z
     C                     ADD  1         Z
     C                     READ SDFACTPD                 61
     C                     END
     C*
     C                     CLOSESDFACTPD
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    KEYLST - SET UP KEY LISTS                                     *
     C*                                                                  *
     C*    CALLED BY: INIT - INITIAL PROCESSING                          *
     C*    CALLS:                                                        *
     C*                                                                  *
     C********************************************************************
     C*
     C           KEYLST    BEGSR
     C*
     C/COPY WNCPYSRC,MQ552XC051
     C**  PARAMETER LIST FOR PROGRAM 'AOCUSTR0'
     C           PLIST1    PLIST
     C***********          PARM '*DBERR ' @RTCD   7                       055237
     C                     PARM '       ' @RTCD   7                       055237
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           CKEY   10
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
     C*
     C**  PARAMETER LIST FOR PROGRAM 'AOBSRTR0'
     C           PLIST2    PLIST
     C***********          PARM '*DBERR  '@RTCD                           055237
     C                     PARM '        '@RTCD                           055237
     C                     PARM '*KEY    '@OPTN
     C                     PARM           @AJCD   3
     C                     PARM           @DWNB   2
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
     C*
     C**  KEY LIST FOR SE BOOK POSITIONS, BKPOS
     C           BKPOSK    KLIST
     C                     KFLD           KBHSC  10
     C                     KFLD           KBHBA   3
     C                     KFLD           KBHBK   2
     C                     KFLD           KBHMK   1
     C                     KFLD           KBHTV   1
     C                     KFLD           KLPSD   50
     C*
     C*   KEY LIST FOR SE BOOK POSITION PROFIT CENTRE, SEPCBD
     C           SEPCBK    KLIST
     C                     KFLD           KBPBK   2
     C                     KFLD           KBPBA   3
     C                     KFLD           KBPSC  10
     C                     KFLD           KBPMK   1
     C*
     C*   KEY LIST FOR SE CUSTOMER POSITION PROFIT CENTRE, SEPCCD
     C           SEPCCK    KLIST
     C**********           KFLD           KCNUM   60                                          CSD027
     C                     KFLD           KCNUM   6                                           CSD027
     C                     KFLD           KBRCA   3
     C                     KFLD           KSESN  10
     C*
     C*   KEY LIST FOR FF BOOK POSITION PROFIT CENTRE FILE, FOPCK
     C           FOPCKK    KLIST
     C                     KFLD           KBRCA   3
     C                     KFLD           KBOKC   2
     C                     KFLD           KISTT   5
     C*
     C*   KEY LIST FOR FF CUSTOMER POSITION PROFIT CENTRE FILE, FOPCC
     C           FOPCCK    KLIST
     C                     KFLD           KBRCA
     C**********           KFLD           KCBCD   60                                          CSD027
     C                     KFLD           KCBCD   6                                           CSD027
     C                     KFLD           KISTT
     C*
     C**  KEY LIST FOR FF PRICES, PRICS1
     C           PRICSK    KLIST
     C                     KFLD           KISTT
     C                     KFLD           KYRNO   20
     C                     KFLD           KMTHN   20
     C                     KFLD           KPCAL   1
     C***********          KFLD           KSTRP  117                      CFF004
     C                     KFLD           KSTRP                           CFF004
     C*
     C**  KEY LIST FOR CUSTOMER LOANS, CLOANX
     C/COPY WNCPYSRC,MQ552XC030
     C           CLOANK    KLIST
     C**********           KFLD           KLNRF   60                                          CLE148
     C                     KFLD           KLNRF   6                                           CLE148
     C                     KFLD           KRCTP   1
     C                     MOVE 'A'       KRCTP
     C/COPY WNCPYSRC,MQ552XC031
     C*
     C**  KEY LIST FOR SE INVESTMENT TYPES, INVTP
     C           INVTPK    KLIST
     C                     KFLD           KNMCY   3
     C                     KFLD           KSITP   3
     C*
     C**  KEY LIST FOR RE ACCRUED INTEREST DETAILS, REACR
     C           REACRK    KLIST
     C                     KFLD           KCNUM
     C                     KFLD           KCCY    3
     C**********           KFLD           KACOD   40                                          CGL029
     C                     KFLD           KACOD  100                                          CGL029
     C                     KFLD           KACSQ   20
     C                     KFLD           KBRCA
     C*
     C/COPY WNCPYSRC,MQ552XC052
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    USRDEF - SET ALL USER DEFINABLE FIELDS TO BLANK/ZERO          *
     C*                                                                  *
     C*    CALLED BY: INIT - INITIAL PROCESSING                          *
     C*    CALLS:                                                        *
     C*                                                                  *
     C********************************************************************
     C*
     C           USRDEF    BEGSR
     C*
     C**  USER DATES
     C                     Z-ADD*ZERO     UDT1
     C                     Z-ADD*ZERO     UDT2
     C                     Z-ADD*ZERO     UDT3
     C*
     C**  USER 6 NUMERIC FIELDS
     C                     Z-ADD*ZERO     U6N1
     C                     Z-ADD*ZERO     U6N2
     C                     Z-ADD*ZERO     U6N3
     C*
     C**  USER AMOUNTS
     C                     Z-ADD*ZERO     UAM1
     C                     Z-ADD*ZERO     UAM2
     C                     Z-ADD*ZERO     UAM3
     C*
     C**  USER INDICATORS
     C                     MOVE *BLANK    UIN1
     C                     MOVE *BLANK    UIN2
     C                     MOVE *BLANK    UIN3
     C                     MOVE *BLANK    UIN4
     C*
     C**  USER ALPHA FIELDS
     C                     MOVE *BLANKS   U30A
     C                     MOVE *BLANKS   U10A
     C                     MOVE *BLANKS   U4A1
     C                     MOVE *BLANKS   U4A2
     C                     MOVE *BLANKS   U4A3
     C*
     C                     ENDSR
     C*
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*    *PSSR - ERROR PROCESSING                                      *
     C*                                                                  *
     C*    CALLED BY: LELOAN - PROCESS CUSTOMER LOANS                    *
     C*               FACILY - PROCESS FACILITIES                        *
     C*               FFTRAN - PROCESS FUTURES AND OPTIONS TRANSACTIONS  *
     C*               FFBCPN - PROCESS FF BOOK AND CUSTOMER POSITIONS    *
     C*               SETRAD - PROCESS SE TRADES                         *
     C*               SEBKPN - PROCESS SE BOOK POSITIONS                 *
     C*               SECDPN - PROCESS SE CUSTOMER AND DEPOT POSITIONS   *
     C*    CALLS:                                                        *
     C*                                                                  *
     C********************************************************************
     C*
     C/COPY WNCPYSRC,MQ552XC032
     C           *PSSR     BEGSR
     C*
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'MQ552X'  DBPGM
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     SETON                     U7U8LR
     C*
     C                     END
     C*
     C                     RETRN
     C*
     C                     ENDSR
     C*                                                                  *
     C/COPY WNCPYSRC,MQ552XC053
      /EJECT
      /COPY ZSRSRC,ZDATE1Z2
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZSEDITZ3
      /EJECT
      /COPY ZSRSRC,ZCONVZ1
      /EJECT
      /COPY ZSRSRC,FFDATEZ3
      /EJECT
      /COPY ZSRSRC,ZACCH
      /EJECT
      /COPY ZSRSRC,ZCHKH
      /EJECT
      /COPY ZSRSRC,ZFWDT
      /EJECT
      /COPY ZSRSRC,ZBKDT
      /EJECT
      /COPY ZSRSRC,ZNCDZ3
      /EJECT
      /COPY ZSRSRC,ZYLDZ2
      /EJECT
      /COPY ZSRSRC,ZYLDOZ1
      /EJECT
      /COPY ZSRSRC,ZPRCOZ1
      /EJECT
      /COPY ZSRSRC,ZCNSDZ1
      /EJECT
      /COPY ZSRSRC,ZDAYSZ2
      /EJECT
      /COPY ZSRSRC,ZDYYRZ3
      /EJECT
      /COPY ZSRSRC,ZLCDZ1
      /EJECT
      /COPY ZSRSRC,FFPLCLZ1
      /EJECT
      /COPY ZSRSRC,FFTVCLZ2
      /EJECT
      /COPY ZSRSRC,FFPMCLZ1
      /EJECT
      /COPY ZSRSRC,FFYTOPZ1
      /EJECT
      /COPY ZSRSRC,ZFREQBZ2
      /EJECT                                                              039495
      /COPY ZSRSRC,ZACCZZ1                                                039495
      /EJECT                                                              039495
      /COPY ZSRSRC,ZCALCD                                                 039495
      /EJECT                                                              039495
      /COPY ZSRSRC,ZACCRZ1                                                039495
      /EJECT                                                              039495
      /COPY ZSRSRC,ZRATEZ1                                                039495
      /EJECT
     C*
     C** 'Internal Deposit' and 'Internal Loan' entries were added        066309
     C** to the array TXT.                                                066309
     C*
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   TABDY/TABNO - SHORTNAMES & DAY NUMBERS
F0S1X2M3U4W5T6
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
** POWER9
0000000010
0000000100
0000001000
0000010000
0000100000
0001000000
0010000000
0100000000
1000000000
** TXT
Foreign Exchange Outright
Option Forward
Option Takedown
Foreign Exchange Swap
Internal Contract
Interbank Deposit Placed
Call/Notice Loan
Time Loan
Demand Loan
Commercial Loan
Interbank Deposit Accepted
Call/Notice Demand Deposit
Time Deposit
Certificate of Deposit Issued
Forward Rate Agreement
Interest Rate Swap
Interest Rate Cap
Interest Rate Floor
Interest Rate Collar
Guarantee from
Collateral for Facility
Collateral for Loan
Security for Facility
Security for Loan
Internal Deposit
Internal Loan
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
