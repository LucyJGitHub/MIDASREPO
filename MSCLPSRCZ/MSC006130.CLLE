/*********************************************************************/
/*STD    CLPBASEMOD                                                  */
/*EXI *  TEXT('Midas MS Midas/SWIFT Meridian communication')         */
/*********************************************************************/
/*                                                                   */
/*       Midas - Midas SWIFT                                         */
/*                                                                   */
/*       MSC006130 - Midas/SWIFT Meridian Communications             */
/*                                                                   */
/*       (c) Finastra International Limited 2002                     */
/*                                                                   */
/*       Last Amend No. MD046248           Date 27Oct17              */
/* Bank Fusion Midas 1.4 Base ---------------------------------------*/
/* Midas Plus 1.4 Base 04 -------------------------------------------*/
/* Midas Plus 1.4 Base ----------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base -----------------------------*/
/* Midas Release 4.01 -----------------------------------------------*/
/*       Prev Amend No. CSW025  *CREATE    Date 15Apr02              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       MD046248 - Finastra Rebranding                              */
/*       CSW025 - Midas Message Manager                              */
/*                - OPERATION may only be *EOD if CSW025 is on       */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&OPERATION &COMMSID &MODE &TYPE)
 
             DCL        VAR(&OPERATION) TYPE(*CHAR) LEN(9)
             DCL        VAR(&COMMSID) TYPE(*CHAR) LEN(26)
             DCL        VAR(&MODE) TYPE(*CHAR) LEN(7)
             DCL        VAR(&TYPE) TYPE(*CHAR) LEN(7)
 
             DCL        VAR(&RTN) TYPE(*CHAR) LEN(7) VALUE('       ')
             DCL        VAR(&OPN) TYPE(*CHAR) LEN(7)
             DCL        VAR(&SARD) TYPE(*CHAR) LEN(6)
             DCL        VAR(&CSW025) TYPE(*CHAR) LEN(1)
             DCL        VAR(&SFMT) TYPE(*CHAR) LEN(200)
 
             COPYRIGHT  TEXT('(c) Finastra International Limited +
                          2002')
 
/* Global monitor message */
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO +
                          CMDLBL(ABNOR))
 
/* A value of *EOD is only valid for the OPERATION parameter if */
/*  Switchable Feature CSW025 is on.                            */
             IF         COND(&OPERATION *EQ '*EOD') THEN(DO)
/* Access the Switchable Features file to see if CSW025 is on. */
                CHGVAR     VAR(&SARD) VALUE('CSW025')
                CHGVAR     VAR(&OPN) VALUE('*VERIFY')
                CALL       PGM(AOSARDR0) PARM(&RTN &OPN &SARD &SFMT)
                IF         COND(&RTN *EQ '       ') THEN(DO)
                     CHGVAR     VAR(&CSW025) VALUE('Y')
                ENDDO
/* If the Switchable Feature is off, report an error. */
                IF         COND(&CSW025 *NE 'Y') THEN(DO)
                   SNDPGMMSG  MSGID(CPD0006) MSGF(QCPFMSG) +
                                MSGDTA('0000OPERATION may only be +
                                ''*EOD'' if CSW025 is on.') MSGTYPE(*DIAG)
                   SNDPGMMSG  MSGID(CPF0002) MSGF(QCPFMSG) MSGTYPE(*ESCAPE)
                   GOTO       CMDLBL(END)
                ENDDO
             ENDDO
 
             CALLPRC    PRC(MS6130M) PARM(&OPERATION &COMMSID &MODE +
                          &TYPE)
 
             GOTO       CMDLBL(END)
 
ABNOR:
/* Send Message to cause the OS to pass earlier messages back. */
             SNDPGMMSG  MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Program +
                          MSC006130 ended abnormally - see job +
                          log') TOMSGQ(MOPERQ)
END:
             ENDPGM
