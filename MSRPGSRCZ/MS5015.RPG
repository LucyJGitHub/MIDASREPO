000100200529     H        1
000200200529      *****************************************************************
000300200529/*STD *  RPGBASE                                                      *
000400200529/*EXI *  TEXT('Midas MS Incoming Messages enquiry')                   *
000500200529      *****************************************************************
000600200529      *                                                               *
000700200529      *  Midas - SWIFT DIRECT LINK                               *
000800200529      *                                                               *
000900200529      *   MS5015 - INCOMING MESSAGES ENQUIRY                          *
001000200529      *                                                               *
001100200529      *  (c) Finastra International Limited 2001                      *
001200200529      *                                                               *
001300200604      *  Last Amend No. MD052122           Date 22May20               *
001400200529      *  Prev Amend No. MD046248           Date 27Oct17               *
001500200529      *                 AR567569           Date 27Jul12               *
001600200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
001700200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
001800200529      *                 CRE026             Date 24May06               *
001900200529      * Midas Plus 1.3 ----------- Base ------------------------------*
002000200529      *                 CSD027             Date 09Dec05               *
002100200529      *                 TDA035             Date 02Apr04               *
002200200529      * Midas Release 4 --------------- Base -------------------------*
002300200529      * Midas DBA 3.03 -----------------------------------------------*
002400200529      * Midas DBA 3.00 ---------------- Base -------------------------*
002500200529      *                 124673             Date 04Jun98               *
002600200529      *                 105223             Date 01Aug96               *
002700200529      *                  CSW095            DATE 10APR95               *
002800200529      *                  S01310            DATE 06DEC90               *
002900200529      *                                                               *
003000200529      *---------------------------------------------------------------*
003100200529      *                                                               *
003200200529      *   MD052122 - Include field tag 119 and SWIFT 2018 tags 111    *
003300200529      *              and 121 in block 3. Also recoded some parts of   *
003400200529      *              block 1-3 to handle correct position of details. *
003500200529      *  MD046248 - Finastra Rebranding                               *
003600200529      *  AR567569 - MT950 with multiple messages can cause array      *
003700200529      *             index error.  Fix is to report multiple and       *
003800200529      *             duplicate messages individually.                  *
003900200529      *  CRE026 - Consumer Banking                                    *
004000200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
004100200529      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
004200200529      *   124673 - Add Century field to key lists and use for         *
004300200529      *            selection purposes.                                *
004400200529      *   105223 - Array index error on line 140000. There are dup.   *
004500200529      *            messages which system unable to trap, treating all *
004600200529      *            these messages as single message (not enough for   *
004700200529      *            array IMSG to accomodate).                         *
004800200529      *   CSW095 - S.W.I.F.T 1995 Message Changes.                    *
004900200529      *            Increase arrays to handle a 10,000 character       *
005000200529      *            message.                                           *
005100200529      *   S01310 - SWIFT RATIONALISATION                              *
005200200529      *                                                               *
005300200529      *****************************************************************
005400200529      *                                                               *
005500200529      *  C R E A T I O N     P A R A M E T E R S                      *
005600200529      *****************************************************************
005700200529     FMS5015DFCF  E                    WORKSTN
005800200529     F                                        RRN   KSFILE MS5015F3
005900200529     F*ABTB10*IF**E********   K        DISK                               S01310
006000200529     FMUSER   IF  E           K        DISK                               S01310
006100200529     FSDBRCHL0IF  E           K        DISK                               S01310
006200200529     FMSMSI2L0IF  E           K        DISK                           UC
006300200529     F            MSMSI2D0                          KRENAMEMSMSI20F
006400200529     FMSMSI2L1IF  E           K        DISK                           UC
006500200529     F            MSMSI2D0                          KRENAMEMSMSI21F
006600200529     FMSMSI2L2IF  E           K        DISK                           UC
006700200529     F            MSMSI2D0                          KRENAMEMSMSI22F
006800200529     FMSMSI2L3IF  E           K        DISK                           UC
006900200529     F            MSMSI2D0                          KRENAMEMSMSI23F
007000200529     FMSMSI2LBIF  E           K        DISK                           UC  S01310
007100200529     F            MSMSI2D0                          KRENAMEMSMSI2BF       S01310
007200200529     FMSMSI2LCIF  E           K        DISK                           UC  S01310
007300200529     F            MSMSI2D0                          KRENAMEMSMSI2CF       S01310
007400200529     FMSMSI2LDIF  E           K        DISK                           UC  S01310
007500200529     F            MSMSI2D0                          KRENAMEMSMSI2DF       S01310
007600200529     FMSMSI2LEIF  E           K        DISK                           UC  S01310
007700200529     F            MSMSI2D0                          KRENAMEMSMSI2EF       S01310
007800200529      *
007900200529      * ID C  F  H  L    FUNCTION OF INDICATORS
008000200529      * 20               SFLDSP
008100200529      * 21               SFLDSPCTL
008200200529      * 22               SFLEND
008300200529      * 30               Error
008400200529      * 31               Message type error
008500200529      * 32               Message priority error
008600200529      * 33               Start message ouput date error
008700200529      * 34               Start message output time error
008800200529      * 35               End message output date error
008900200529      * 36               End message output time error
009000200529      * 37               Branch error                                     S01310
009100200529      * 40               HELP
009200200529      * 41               Multibranching on                                S01310
009300200529      * 50               MSMSI2L0 open
009400200529      * 51               MSMSI2L1 open
009500200529      * 52               MSMSI2L2 open
009600200529      * 53               MSMSI2L2 open
009700200529      * 54               MSMSI2LB open                                    S01310
009800200529      * 55               MSMSI2LC open                                    S01310
009900200529      * 56               MSMSI2LD open                                    S01310
010000200529      * 57               MSMSI2LE open                                    S01310
010100200529      * 88               EOF SDBRCHL0                                     S01310
010200200529      * 89               EOF MUSER                                        S01310
010300200529      **89***************EOF TABTB10                                      S01310
010400200529      * KC               F3
010500200529      * KH               F8
010600200529      * KI               F9
010700200529      * KL               F12
010800200529      * U7U8LR           DB error
010900200529      *
011000200529     E                    ERCD       19  4
011100200529     E***********         IMSG     3072  1                                CSW095
011200200529     E                    IMSG     9999  1                                CSW095
011300200529     E                    LINE      130  1
011400200529     E                    MSGA    1   3 78
011500200529     E**********          HDGA    1   9 78                              MD052122
011600200529     E                    HDGA    1  14 78                              MD052122
011700200529     E                    CPY@    1   1 80                                S01310
011800200529      *
011900200529     ILDA         DS                            256
012000200529     I                                      134 141 DBFILE
012100200529     I                                      142 170 DBKEY
012200200529     I                                      171 180 DBPGM
012300200529     I                                      181 1830DBASE
012400200529      **  Local data area
012500200529      *
012600200529     I           SDS
012700200529     I                                      244 253 WSID
012800200529     I                                      254 263 USRID                 S01310
012900200529      **  Workstation ID
013000200529      *
013100200529     IDSRUN       DS                             13                       S01310
013200200529     I                                        1   7 RUNA                  S01310
013300200529     I                                       13  13 MBIN                  S01310
013400200529      **  RUNDAT data area                                                S01310
013500200529      *
013600200529     I            DS
013700200529     I                                        1   6 SOSD
013800200529     I                                        7  10 SOST
013900200529      *
014000200529     I                                        1   2 SDYY
014100200529     I                                        3   4 SDMM
014200200529     I                                        5   6 SDDD
014300200529      *
014400200529     I                                        7   8 STHH
014500200529     I                                        9  10 STMM
014600200529      *
014700200529     I                                       11  16 SOED
014800200529     I                                       17  20 SOET
014900200529      *
015000200529     I                                       11  12 EDYY
015100200529     I                                       13  14 EDMM
015200200529     I                                       15  16 EDDD
015300200529      *
015400200529     I                                       17  18 ETHH
015500200529     I                                       19  20 ETMM
015600200529      **  Subdivide screen fields for validation
015700200529      *
015800200529     I            DS
015900200529     I                                        1 114 @HDR
016000200529     I                                        7  18 @RAD
016100200529     I                                       19  22 @SNN
016200200529     I                                       23  28 @SQN
016300200529     I**********                             34  36 @MTP                                    MD052122
016400200529     I**********                             37  40 @ITM                                    MD052122
016500200529     I**********                             41  68 @MIR                                    MD052122
016600200529     I**********                             69  74 @ODT                                    MD052122
016700200529     I**********                             75  78 @OTM                                    MD052122
016800200529     I**********                             79  79 @MPY                                    MD052122
016900200529     I**********                             81  83 @WK3                                    MD052122
017000200529      **  Subdivide message header
017100200529      *
017200200529     I            DS                                                                        MD052122
017300200529     I                                        1  85 HDR2                                    MD052122
017400200529     I                                        5   7 @MTP                                    MD052122
017500200529     I                                        8  11 @ITM                                    MD052122
017600200529     I                                       12  39 @MIR                                    MD052122
017700200529     I                                       40  45 @ODT                                    MD052122
017800200529     I                                       46  49 @OTM                                    MD052122
017900200529     I                                       50  50 @MPY                                    MD052122
018000200529     I                                       52  54 @WK3                                    MD052122
018100200529      **  Format for header block 2                                                         MD052122
018200200529      *                                                                                     MD052122
018300200529     I            DS
018400200529     I                                        1  78 RCD1
018500200529     I                                        1  12 ORAD
018600200529     I                                       14  17 OSNN
018700200529     I                                       26  31 OSQN
018800200529     I                                       72  74 BRCA                  S01310
018900200529      **  Format basic header data
019000200529      *
019100200529     I            DS
019200200529     I                                        1  78 RCD2
019300200529     I                                        1   3 OMTP
019400200529     I                                       11  14 OITM
019500200529     I                                       23  50 OMIR
019600200529     I                                       53  58 OODT
019700200529     I                                       66  69 OOTM
019800200529     I                                       72  78 OPTY
019900200529      **  Format application header data
020000200529      *
020100200529     I            DS
020200200529     I                                        1  78 RCD3
020300200529     I/COPY WNCPYSRC,MS5015I001
020400200529     I                                        1   4 OBPY
020500200529     I                                       24  39 OMUR
020600200529     I/COPY WNCPYSRC,MS5015I002
020700200529      **  Format user header data
020800200529      *
020900200529     C           KEY0      KLIST
021000200529     C                     KFLD           MTPY
021100200529     C                     KFLD           MPRY
021200200529     C                     KFLD           MODEC                           124673
021300200529     C                     KFLD           MODE
021400200529     C                     KFLD           MOTM
021500200529     C                     KFLD           MOR
021600200529      *
021700200529     C           KEY1      KLIST
021800200529     C                     KFLD           MTPY
021900200529     C                     KFLD           MODEC                           124673
022000200529     C                     KFLD           MODE
022100200529     C                     KFLD           MOTM
022200200529     C                     KFLD           MOR
022300200529      *
022400200529     C           KEY2      KLIST
022500200529     C                     KFLD           MPRY
022600200529     C                     KFLD           MODEC                           124673
022700200529     C                     KFLD           MODE
022800200529     C                     KFLD           MOTM
022900200529     C                     KFLD           MOR
023000200529      *
023100200529     C           KEY3      KLIST
023200200529     C                     KFLD           MODEC                           124673
023300200529     C                     KFLD           MODE
023400200529     C                     KFLD           MOTM
023500200529     C                     KFLD           MOR
023600200529      *
023700200529     C           KEYB      KLIST                                          S01310
023800200529     C                     KFLD           BRCA                            S01310
023900200529     C                     KFLD           MTPY                            S01310
024000200529     C                     KFLD           MPRY                            S01310
024100200529     C                     KFLD           MODEC                           124673
024200200529     C                     KFLD           MODE                            S01310
024300200529     C                     KFLD           MOTM                            S01310
024400200529     C                     KFLD           MOR                             S01310
024500200529      *                                                                   S01310
024600200529     C           KEYC      KLIST                                          S01310
024700200529     C                     KFLD           BRCA                            S01310
024800200529     C                     KFLD           MTPY                            S01310
024900200529     C                     KFLD           MODEC                           124673
025000200529     C                     KFLD           MODE                            S01310
025100200529     C                     KFLD           MOTM                            S01310
025200200529     C                     KFLD           MOR                             S01310
025300200529      *                                                                   S01310
025400200529     C           KEYD      KLIST                                          S01310
025500200529     C                     KFLD           BRCA                            S01310
025600200529     C                     KFLD           MPRY                            S01310
025700200529     C                     KFLD           MODEC                           124673
025800200529     C                     KFLD           MODE                            S01310
025900200529     C                     KFLD           MOTM                            S01310
026000200529     C                     KFLD           MOR                             S01310
026100200529      *                                                                   S01310
026200200529     C           KEYE      KLIST                                          S01310
026300200529     C                     KFLD           BRCA                            S01310
026400200529     C                     KFLD           MODEC                           124673
026500200529     C                     KFLD           MODE                            S01310
026600200529     C                     KFLD           MOTM                            S01310
026700200529     C                     KFLD           MOR                             S01310
026800200529      *
026900200529      *****************************************************************
027000200529      *                   Index to subroutines                        *
027100200529      *   main process                                                *
027200200529      *   INIT  - initial process                                     *
027300200529      *   VSEL  - validate selection                                  *
027400200529      *   ENQY0 - enquire by type,priority,date,time                  *
027500200529      *   ENQY1 - enquire by type,date,time                           *
027600200529      *   ENQY2 - enquire by priority,date,time                       *
027700200529      *   ENQY3 - enquire by date,time                                *
027800200529      *   ENQYB - enquire by branch,type,priority,date,time           *   S01310
027900200529      *   ENQYC - enquire by branch,type,date,time                    *   S01310
028000200529      *   ENQYD - enquire by branch,priority,date,time                *   S01310
028100200529      *   ENQYE - enquire by branch,date,time                         *   S01310
028200200529      *   SFLE  - format message for display                          *
028300200529      *   VRCD  - validate record                                     *
028400200529      *   *PSSR - error handling                                      *
028500200529      *****************************************************************
028600200529     C/EJECT
028700200529      *****************************************************************
028800200529      *   main process                                                *
028900200529      *   Calls - INIT initial process                                *
029000200529      ************MHELP*MIDAS help program                            *   S01310
029100200529      *           VSEL validate selection                             *
029200200529      *           ENQY0 enquire by type,priority,date,time            *
029300200529      *           ENQY1 enquire by type,date,time                     *
029400200529      *           ENQY2 enquire by priority,date,time                 *
029500200529      *           ENQY3 enquire by date,time                          *
029600200529      *           ENQYB enquire by branch,type,priority,date,time     *   S01310
029700200529      *           ENQYC enquire by branch,type,date,time              *   S01310
029800200529      *           ENQYD enquire by branch,priority,date,time          *   S01310
029900200529      *           ENQYE enquire by branch,date,time                   *   S01310
030000200529      *****************************************************************
030100200529      *
030200200529     C                     EXSR INIT
030300200529      *
030400200529      **  Display selection screen until F3 pressed
030500200529     C           *INKC     DOWEQ'0'
030600200529      *
030700200529      **  If no errors clear input fields
030800200529     C           *IN30     IFEQ '0'
030900200529     C                     MOVE *BLANKS   SBCH                            S01310
031000200529     C                     MOVE *BLANKS   STYP
031100200529     C                     MOVE *BLANKS   SPTY
031200200529     C                     MOVE *BLANKS   SOSD
031300200529     C                     MOVE *BLANKS   SOED
031400200529     C                     MOVE *BLANKS   SOST
031500200529     C                     MOVE *BLANKS   SOET
031600200529     C                     END
031700200529      *
031800200529     C                     WRITEMS5015F2
031900200529     C                     WRITEMS5015F1
032000200529      *
032100200529      ****Do*while*HELP*pressed                                           S01310
032200200529     C************IN40*****DOUEQ'0'                                       S01310
032300200529     C                     READ MS5015F2                 40
032400200529      *
032500200529     C************IN40*****IFEQ '1'                                       S01310
032600200529     C*********************MOVEAERCD      HERCD 160                       S01310
032700200529     C*********************MOVEL'MSSWII'  HBPGM   8                       S01310
032800200529     C*********************CALL 'MHELP'                                   S01310
032900200529     C*********************PARM           HBPGM                           S01310
033000200529     C*********************PARM           HERCD                           S01310
033100200529     C*********************END                                            S01310
033200200529     C*********************END                                            S01310
033300200529      *
033400200529     C                     MOVE *BLANKS   SFMG
033500200529     C                     SETOF                     303132
033600200529     C                     SETOF                     333435
033700200529     C*********************SETOF                     36                   S01310
033800200529     C                     SETOF                     3637                 S01310
033900200529      *
034000200529      **  If F3 not pressed validate selection
034100200529     C           *INKC     IFEQ '0'
034200200529     C                     EXSR VSEL
034300200529      *
034400200529      **  If selection valid
034500200529     C           *IN30     IFEQ '0'
034600200529      *
034700200529     C                     MOVE SBCH      BRCA                            S01310
034800200529     C                     MOVE STYP      MTPY
034900200529     C                     MOVE SPTY      MPRY
035000200529     C                     MOVE @OSDC     MODEC                           124673
035100200529     C                     MOVE SOSD      MODE
035200200529     C                     MOVE SOST      MOTM
035300200529     C                     MOVE SOSD      @OSD    60
035400200529     C                     MOVE SOST      @OST    40
035500200529     C                     MOVE SOED      @OED    60
035600200529     C                     MOVE SOET      @OET    40
035700200529      *
035800200529     C           MBIN      IFEQ 'Y'                                       S01310
035900200529     C           SBCH      ANDNE'ALL'                                     S01310
036000200529      **  If type & priority entered enquiry by type,priority,date,time   S01310
036100200529     C           MTPY      IFNE *BLANK                                    S01310
036200200529     C           MPRY      IFNE *BLANK                                    S01310
036300200529     C                     EXSR ENQYB                                     S01310
036400200529      **  If type entered enquiry by type,date,time                       S01310
036500200529     C                     ELSE                                           S01310
036600200529     C                     EXSR ENQYC                                     S01310
036700200529     C                     END                                            S01310
036800200529      **  If priority entered enquiry by priority,date,time               S01310
036900200529     C                     ELSE                                           S01310
037000200529     C           MPRY      IFNE *BLANK                                    S01310
037100200529     C                     EXSR ENQYD                                     S01310
037200200529      **  Enquiry by date,time                                            S01310
037300200529     C                     ELSE                                           S01310
037400200529     C                     EXSR ENQYE                                     S01310
037500200529     C                     END                                            S01310
037600200529     C                     END                                            S01310
037700200529      *                                                                   S01310
037800200529     C                     ELSE                                           S01310
037900200529      **  If type & priority entered report by type,priority,date,time
038000200529     C           MTPY      IFNE *BLANK
038100200529     C           MPRY      IFNE *BLANK
038200200529     C                     EXSR ENQY0
038300200529      **  If type entered report by type,date,time
038400200529     C                     ELSE
038500200529     C                     EXSR ENQY1
038600200529     C                     END
038700200529      **  If priority entered report by priority,date,time
038800200529     C                     ELSE
038900200529     C           MPRY      IFNE *BLANK
039000200529     C                     EXSR ENQY2
039100200529      **  Report by date,time
039200200529     C                     ELSE
039300200529     C                     EXSR ENQY3
039400200529     C                     END
039500200529     C                     END
039600200529      *
039700200529     C                     END                                            S01310
039800200529     C                     END
039900200529     C                     END
040000200529     C                     END
040100200529      *
040200200529     C                     SETON                     LR
040300200529     C/EJECT
040400200529      *****************************************************************
040500200529      *   INIT - inital process                                       *
040600200529      *   Calls - *PSSR error process                                 *
040700200529      *   Called by - main process                                    *
040800200529      *****************************************************************
040900200529      *
041000200529     C           INIT      BEGSR
041100200529      *
041200200529     C                     MOVEACPY@      BIS@   80                       S01310
041300200529      *
041400200529      **  Set up LDA
041500200529     C           *NAMVAR   DEFN           LDA
041600200529     C           *LOCK     IN   LDA
041700200529     C                     MOVE 'MS5015  'DBPGM
041800200529     C                     OUT  LDA
041900200529     C/COPY WNCPYSRC,MS5015C006
042000200529      *
042100200529      **  Initialise 'CR' and 'LF' fields
042200200529     C                     MOVE *LOVAL    CR      1
042300200529     C                     BITON'457'     CR
042400200529     C                     MOVE *LOVAL    LF      1
042500200529     C                     BITON'257'     LF
042600200529     C                     MOVELCR        CRLF    2
042700200529     C                     MOVE LF        CRLF
042800200529     C                     MOVE *LOVAL    ETX     1
042900200529     C                     BITON'67'      ETX
043000200529      *
043100200529      ****Access*TABTB10*to find run date                                 S01310
043200200529     C*********************READ TABTB10                  89               S01310
043300200529      *********************                                               S01310
043400200529     C************IN89*****IFEQ '1'                                       S01310
043500200529     C***********RECI******ORNE 'D'                                       S01310
043600200529     C************LOCK*****IN   LDA                                       S01310
043700200529     C*********************MOVE '01'      DBASE                           S01310
043800200529     C*********************MOVE 'FIRST'   DBKEY            * DB ERROR 01 *S01310
043900200529     C*********************MOVE 'TABTB10' DBFILE                          S01310
044000200529     C*********************OUT  LDA                                       S01310
044100200529     C*********************EXSR *PSSR                                     S01310
044200200529     C*********************END                                            S01310
044300200529      *                                                                   S01310
044400200529      **  Access RUNDAT to find run date & multibranching indicator       S01310
044500200529     C           *NAMVAR   DEFN RUNDAT    DSRUN                           S01310
044600200529     C                     IN   DSRUN                                     S01310
044700200529      *                                                                   S01310
044800200529      **  Access MUSER for user's authority                               S01310
044900200529     C           USRID     CHAINMUSER                89                   S01310
045000200529      *                                                                   S01310
045100200529     C           *IN89     IFEQ '1'                                       S01310
045200200529     C           RECI      ORNE 'D'                                       S01310
045300200529     C           *LOCK     IN   LDA                                       S01310
045400200529     C                     MOVE '01'      DBASE                           S01310
045500200529     C                     MOVE USRID     DBKEY            * DB ERROR 01 *S01310
045600200529     C                     MOVE 'MUSER'   DBFILE                          S01310
045700200529     C                     OUT  LDA                                       S01310
045800200529     C                     EXSR *PSSR                                     S01310
045900200529     C                     END                                            S01310
046000200529      *                                                                   S01310
046100200529      **  Seton multibranching indicator                                  S01310
046200200529     C           MBIN      IFEQ 'Y'                                       S01310
046300200529     C                     SETON                     41                   S01310
046400200529     C                     END                                            S01310
046500200529      *
046600200529      **  Seton SFLEND
046700200529     C                     SETON                     22
046800200529      *
046900200529     C                     ENDSR
047000200529     C/EJECT
047100200529      *****************************************************************
047200200529      *   VSEL - validate selection                                   *
047300200529      *   Called by - main process                                    *
047400200529      *****************************************************************
047500200529      *
047600200529     C           VSEL      BEGSR
047700200529      *
047800200529      **  Blank out error codes array
047900200529     C                     MOVE *BLANKS   ERCD
048000200529     C                     Z-ADD0         W       20
048100200529      *
048200200529      **  Message type must be blank or numeric
048300200529     C           STYP      IFNE *BLANK
048400200529     C                     TESTN          STYP       60
048500200529     C           *IN60     IFNE '1'
048600200529     C                     SETON                     3031
048700200529     C                     ADD  1         W
048800200529     C                     MOVE '001'     ERCD,W
048900200529     C                     END
049000200529     C                     END
049100200529      *
049200200529      **  Message priority must be blank,'N' or 'U'.
049300200529     C           SPTY      IFNE *BLANK
049400200529     C           SPTY      ANDNE'N'
049500200529     C           SPTY      ANDNE'U'
049600200529     C                     SETON                     3032
049700200529     C                     ADD  1         W
049800200529     C                     MOVE '009'     ERCD,W
049900200529     C                     END
050000200529      *
050100200529      ** Initialise Century indicator.                                    124673
050200200529     C                     MOVE *BLANKS   @OSDC   2                       124673
050300200529      *                                                                   124673
050400200529      ****Start*year*must*be*blank*or*01-99****************************** 124673
050500200529      **  Start year must be blank or 00-99                               124673
050600200529     C           SOSD      IFNE *BLANK
050700200529      *
050800200529     C***********SDYY      IFLT '01'                                      124673
050900200529     C           SDYY      IFLT '00'                                      124673
051000200529     C           SDYY      ORGT '99'
051100200529     C                     SETON                     3033
051200200529     C                     ADD  1         W
051300200529     C                     MOVE '003'     ERCD,W
051400200529     C                     ELSE                                           124673
051500200529      *                                                                   124673
051600200529      ** Allocate century to start date entered.                          124673
051700200529     C           SDYY      IFLT '72'                                      124673
051800200529     C                     MOVE '20'      @OSDC                           124673
051900200529     C                     ELSE                                           124673
052000200529     C                     MOVE '19'      @OSDC                           124673
052100200529     C                     ENDIF                                          124673
052200200529      *                                                                   124673
052300200529     C                     END
052400200529      *
052500200529      **  Start month must be blank or 01-12
052600200529     C           SDMM      IFLT '01'
052700200529     C           SDMM      ORGT '12'
052800200529     C                     SETON                     3033
052900200529     C                     ADD  1         W
053000200529     C                     MOVE '004'     ERCD,W
053100200529     C                     END
053200200529      *
053300200529      **  Start day must be blank or 01-31
053400200529     C           SDDD      IFLT '01'
053500200529     C           SDDD      ORGT '31'
053600200529     C                     SETON                     3033
053700200529     C                     ADD  1         W
053800200529     C                     MOVE '005'     ERCD,W
053900200529      *
054000200529     C                     END
054100200529      *
054200200529     C                     END
054300200529      *
054400200529      **  Start time must not be entered if day is not entered
054500200529     C           SOSD      IFEQ *BLANKS
054600200529     C           SOST      ANDNE*BLANKS
054700200529     C                     SETON                     3034
054800200529     C                     ADD  1         W
054900200529     C                     MOVE '006'     ERCD,W
055000200529     C                     END
055100200529      *
055200200529      **  Start hours must be blank or 00-23
055300200529     C           SOST      IFNE *BLANK
055400200529      *
055500200529     C           STHH      IFLT '00'
055600200529     C           STHH      ORGT '23'
055700200529     C                     SETON                     3034
055800200529     C                     ADD  1         W
055900200529     C                     MOVE '007'     ERCD,W
056000200529     C                     END
056100200529      *
056200200529      **  Start minutes must be blank or 00-59
056300200529     C           STMM      IFLT '00'
056400200529     C           STMM      ORGT '59'
056500200529     C                     SETON                     3034
056600200529     C                     ADD  1         W
056700200529     C                     MOVE '008'     ERCD,W
056800200529      *
056900200529     C                     END
057000200529      *
057100200529     C                     END
057200200529      *
057300200529      ** Initialise Century indicator.                                    124673
057400200529     C                     MOVE *BLANKS   @OEDC   2                       124673
057500200529      *                                                                   124673
057600200529      ****End*year*must*be*blank*or*01-99******************************** 124673
057700200529      **  End year must be blank or 00-99                                 124673
057800200529     C           SOED      IFNE *BLANK
057900200529      *
058000200529     C***********EDYY      IFLT '01'                                      124673
058100200529     C           EDYY      IFLT '00'                                      124673
058200200529     C           EDYY      ORGT '99'
058300200529     C                     SETON                     3035
058400200529     C                     ADD  1         W
058500200529     C                     MOVE '003'     ERCD,W
058600200529     C                     ELSE                                           124673
058700200529      *                                                                   124673
058800200529      ** Allocate century to end date entered.                            124673
058900200529     C           EDYY      IFLT '72'                                      124673
059000200529     C                     MOVE '20'      @OEDC                           124673
059100200529     C                     ELSE                                           124673
059200200529     C                     MOVE '19'      @OEDC                           124673
059300200529     C                     ENDIF                                          124673
059400200529      *                                                                   124673
059500200529     C                     END
059600200529      *
059700200529      **  End month must be blank or 01-12
059800200529     C           EDMM      IFLT '01'
059900200529     C           EDMM      ORGT '12'
060000200529     C                     SETON                     3035
060100200529     C                     ADD  1         W
060200200529     C                     MOVE '004'     ERCD,W
060300200529     C                     END
060400200529      *
060500200529      **  End day must be blank or 01-31
060600200529     C           EDDD      IFLT '01'
060700200529     C           EDDD      ORGT '31'
060800200529     C                     SETON                     3035
060900200529     C                     ADD  1         W
061000200529     C                     MOVE '005'     ERCD,W
061100200529      *
061200200529     C                     END
061300200529      *
061400200529     C                     END
061500200529      *
061600200529      **  Time must not be entered if day is not entered
061700200529     C           SOED      IFEQ *BLANKS
061800200529     C           SOET      ANDNE*BLANKS
061900200529     C                     SETON                     3036
062000200529     C                     ADD  1         W
062100200529     C                     MOVE '006'     ERCD,W
062200200529     C                     END
062300200529      *
062400200529      **  End hours must be blank or range 00-23
062500200529     C           SOET      IFNE *BLANK
062600200529      *
062700200529     C           ETHH      IFLT '00'
062800200529     C           ETHH      ORGT '23'
062900200529     C                     SETON                     3036
063000200529     C                     ADD  1         W
063100200529     C                     MOVE '007'     ERCD,W
063200200529     C                     END
063300200529      *
063400200529      **  End minutes must be blank or 00-59
063500200529     C           ETMM      IFLT '00'
063600200529     C           ETMM      ORGT '59'
063700200529     C                     SETON                     3036
063800200529     C                     ADD  1         W
063900200529     C                     MOVE '008'     ERCD,W
064000200529      *
064100200529     C                     END
064200200529     C                     END
064300200529      *
064400200529      **  If multibranching active                                        S01310
064500200529     C           MBIN      IFEQ 'Y'                                       S01310
064600200529      *                                                                   S01310
064700200529      **  If branch blank substitute user's default branch                S01310
064800200529     C           SBCH      IFEQ *BLANK                                    S01310
064900200529     C                     MOVE DBRN      SBCH                            S01310
065000200529     C                     END                                            S01310
065100200529      *                                                                   S01310
065200200529      **  Is branch code valid                                            S01310
065300200529     C           SBCH      IFNE 'ALL'                                     S01310
065400200529     C           SBCH      CHAINSDBRCHL0             88                   S01310
065500200529      *                                                                   S01310
065600200529     C           *IN88     IFEQ '1'                                       S01310
065700200529     C                     ADD  1         W                               S01310
065800200529     C                     MOVE '025'     ERCD,W                          S01310
065900200529     C                     SETON                     3037                 S01310
066000200529     C                     ELSE                                           S01310
066100200529      *                                                                   S01310
066200200529     C           BANK      IFNE 'Y'                                       S01310
066300200529     C           ROUF      ANDNE'Y'                                       S01310
066400200529     C                     MOVE SBCH      ZBR     3                       S01310
066500200529     C                     Z-ADD0         ZERR    10                      S01310
066600200529     C                     CALL 'ZVBBU'                                   S01310
066700200529     C                     PARM           ZBR                             S01310
066800200529     C                     PARM           ZERR                            S01310
066900200529      *                                                                   S01310
067000200529     C           ZERR      IFNE 0                                         S01310
067100200529     C                     ADD  1         W                               S01310
067200200529     C                     MOVE '026'     ERCD,W                          S01310
067300200529     C                     SETON                     3037                 S01310
067400200529     C                     END                                            S01310
067500200529     C                     END                                            S01310
067600200529     C                     END                                            S01310
067700200529     C                     END                                            S01310
067800200529      *                                                                   S01310
067900200529      **  If branch 'ALL' user must have bank level authority             S01310
068000200529      **  or be system routing officer                                    S01310
068100200529     C           SBCH      IFEQ 'ALL'                                     S01310
068200200529     C           BANK      IFNE 'Y'                                       S01310
068300200529     C           ROUF      ANDNE'Y'                                       S01310
068400200529     C                     ADD  1         W                               S01310
068500200529     C                     MOVE '027'     ERCD,W                          S01310
068600200529     C                     SETON                     3037                 S01310
068700200529     C                     END                                            S01310
068800200529     C                     END                                            S01310
068900200529     C                     END                                            S01310
069000200529      *
069100200529      **  move error codes to message line
069200200529     C                     MOVEAERCD      SFMG
069300200529      *
069400200529     C                     ENDSR
069500200529     C/EJECT
069600200529      *****************************************************************
069700200529      *   ENQY0 - enquire by type,priority,date,time                  *
069800200529      *   Calls - VRCD validate record                                *
069900200529      *           SFLE format message for display                     *
070000200529      *   Called by - main process                                    *
070100200529      *****************************************************************
070200200529      *
070300200529     C           ENQY0     BEGSR
070400200529      *
070500200529      **  Open file & read first record
070600200529     C           *IN50     IFEQ '0'
070700200529     C                     OPEN MSMSI2L0
070800200529     C                     SETON                     50
070900200529     C                     END
071000200529      *
071100200529     C           KEY0      SETLLMSMSI2L0
071200200529     C                     READ MSMSI2L0                 10
071300200529      *
071400200529     C                     EXSR VRCD
071500200529      *
071600200529      **  Write 'No records match selection criteria'
071700200529     C           *IN10     IFEQ '1'
071800200529     C                     MOVE MSGA,1    SFMG
071900200529     C                     SETON                     30
072000200529     C                     ELSE
072100200529     C                     Z-ADD0         WDUP    50                                        AR567569
072200200529      *
072300200529      **  Do until F3 or F12 pressed
072400200529     C           *INKC     DOWEQ'0'
072500200529     C           *INKL     ANDEQ'0'
072600200529      *
072700200529      **  If new message to process
072800200529     C           *IN10     IFEQ '0'
072900200529      *
073000200529      **  Clear subfile
073100200529     C                     SETOF                     2021
073200200529     C                     WRITEMS5015F4
073300200529     C                     SETON                     2021
073400200529     C                     Z-ADD1         RRN     50
073500200529      *
073600200529      **  Move all records which match key into array
073700200529     C***********          Z-ADD1         X       40                      CSW095
073800200529     C                     Z-ADD1         X       50                      CSW095
073900200529     C                     Z-ADD0         WPASS   10                                        AR567569
074000200529     C                     Z-ADD0         WEOF    10                                        AR567569
074100200529     C           *IN10     DOWEQ'0'
074200200529      *                                                                                     AR567569
074300200529      ** If "{1:" has been repeated, it's a multiple or duplicate                           AR567569
074400200529     C                     MOVELMDTA      WSTRT                                             AR567569
074500200529     C           WSTRT     IFEQ '{1:'                                                       AR567569
074600200529     C           X         ANDNE1                                                           AR567569
074700200529     C                     ADD  1         WDUP                                              AR567569
074800200529     C                     LEAVE                                                            AR567569
074900200529     C                     ELSE                                                             AR567569
075000200529      *                                                                                     AR567569
075100200529     C           WPASS     IFEQ 1                                                           AR567569
075200200529     C                     Z-ADD0         WDUP                                              AR567569
075300200529     C                     ENDIF                                                            AR567569
075400200529     C                     ENDIF                                                            AR567569
075500200529      *                                                                                     AR567569
075600200529     C                     MOVEAMDTA      IMSG,X
075700200529     C           KEY0      READEMSMSI2L0                 10
075800200529     C                     ADD  256       X
075900200529     C                     Z-ADD1         WPASS                                             AR567569
076000200529      *                                                                                     AR567569
076100200529     C           *IN10     IFEQ *ON                                                         AR567569
076200200529     C           WDUP      ANDNE0                                                           AR567569
076300200529     C                     ADD  1         WDUP                                              AR567569
076400200529     C                     Z-ADD1         WEOF                                              AR567569
076500200529     C                     ENDIF                                                            AR567569
076600200529     C                     END
076700200529     C                     SETOF                     10
076800200529     C                     EXSR SFLE
076900200529     C                     END
077000200529      *
077100200529      **  Write Subfile
077200200529     C                     WRITEMS5015F1
077300200529     C                     EXFMTMS5015F4
077400200529     C                     MOVEL*OFF      *IN10                                             AR567569
077500200529     C                     MOVE *BLANKS   SFMG
077600200529     C                     SETOF                     30
077700200529      *
077800200529      **  If Cmd 8 process next message
077900200529     C           *INKH     IFEQ '1'
078000200529     C           WDUP      IFEQ 0                                                           AR567569
078100200529     C           KEY0      SETGTMSMSI2L0
078200200529     C                     READ MSMSI2L0                 10
078300200529     C                     ELSE                                                             AR567569
078400200529     C           WEOF      IFEQ 1                                                           AR567569
078500200529     C                     MOVE *ON       *IN10                                             AR567569
078600200529     C                     ENDIF                                                            AR567569
078700200529     C                     ENDIF                                                            AR567569
078800200529      *
078900200529     C                     EXSR VRCD
079000200529      *
079100200529      **  Write 'EOF or next message does not match selection criteria'
079200200529     C           *IN10     IFEQ '1'
079300200529     C                     MOVE MSGA,2    SFMG
079400200529     C                     SETON                     30
079500200529     C                     END
079600200529      *
079700200529      **  If Cmd 9 process previous message
079800200529     C                     ELSE
079900200529     C           *INKI     IFEQ '1'
080000200529     C           KEY0      SETLLMSMSI2L0
080100200529      *                                                                                     AR567569
080200200529     C           WDUP      IFLE 1                                                           AR567569
080300200529     C                     READPMSMSI2L0                 10
080400200529     C                     Z-ADD0         WDUP                                              AR567569
080500200529      *                                                                                     AR567569
080600200529     C                     ELSE                                                             AR567569
080700200529     C                     SUB  1         WDUP                                              AR567569
080800200529     C                     Z-ADD0         WCTR    50                                        AR567569
080900200529      *                                                                                     AR567569
081000200529     C           WCTR      DOWNEWDUP                                                        AR567569
081100200529     C           KEY0      READEMSMSI2L0                 10                                 AR567569
081200200529     C                     ADD  1         WCTR                                              AR567569
081300200529     C                     ENDDO                                                            AR567569
081400200529      *                                                                                     AR567569
081500200529     C           WDUP      IFNE 0                                                           AR567569
081600200529     C                     SUB  1         WDUP                                              AR567569
081700200529     C                     ENDIF                                                            AR567569
081800200529     C                     ENDIF                                                            AR567569
081900200529      *
082000200529      **  Write 'TOF or previous message does not match selection criteria'
082100200529     C           *IN10     IFEQ '1'
082200200529     C                     MOVE MSGA,3    SFMG
082300200529     C                     SETON                     30
082400200529     C           WDUP      IFEQ 1                                                           AR567569
082500200529     C           KEY0      SETLLMSMSI2L0                                                    AR567569
082600200529     C           KEY0      READEMSMSI2L0                 10                                 AR567569
082700200529     C                     ENDIF                                                            AR567569
082800200529     C                     ELSE
082900200529      *
083000200529      **  Read first record of previous message
083100200529     C           WDUP      IFEQ 0                                                           AR567569
083200200529     C           KEY0      SETLLMSMSI2L0
083300200529     C                     READ MSMSI2L0                 10
083400200529     C                     ENDIF                                                            AR567569
083500200529      *
083600200529     C                     EXSR VRCD
083700200529      *
083800200529      **  Write 'TOF or previous message does not match selection criteria'
083900200529     C           *IN10     IFEQ '1'
084000200529     C                     MOVE MSGA,3    SFMG
084100200529     C                     SETON                     30
084200200529     C                     END
084300200529     C                     END
084400200529      *
084500200529      **  If ENTER redisplay subfile
084600200529     C                     ELSE
084700200529     C                     SETON                     10
084800200529     C                     END
084900200529     C                     END
085000200529      *
085100200529     C                     END
085200200529     C                     END
085300200529      *
085400200529     C                     ENDSR
085500200529     C/EJECT
085600200529      *****************************************************************
085700200529      *   ENQY1 - enquire by type,date,time                           *
085800200529      *   Calls - VRCD validate record                                *
085900200529      *           SFLE format message for display                     *
086000200529      *   Called by - main process                                    *
086100200529      *****************************************************************
086200200529      *
086300200529     C           ENQY1     BEGSR
086400200529      *
086500200529      **  Open file & read first record
086600200529     C           *IN51     IFEQ '0'
086700200529     C                     OPEN MSMSI2L1
086800200529     C                     SETON                     51
086900200529     C                     END
087000200529      *
087100200529     C           KEY1      SETLLMSMSI2L1
087200200529     C                     READ MSMSI2L1                 10
087300200529      *
087400200529     C                     EXSR VRCD
087500200529      *
087600200529      **  Write 'No records match selection criteria'
087700200529     C           *IN10     IFEQ '1'
087800200529     C                     MOVE MSGA,1    SFMG
087900200529     C                     SETON                     30
088000200529     C                     ELSE
088100200529     C                     Z-ADD0         WDUP                                              AR567569
088200200529      *
088300200529      **  Do until F3 or F12 pressed
088400200529     C           *INKC     DOWEQ'0'
088500200529     C           *INKL     ANDEQ'0'
088600200529      *
088700200529      **  If new message to process
088800200529     C           *IN10     IFEQ '0'
088900200529      *
089000200529      **  Clear subfile
089100200529     C                     SETOF                     2021
089200200529     C                     WRITEMS5015F4
089300200529     C                     SETON                     2021
089400200529     C                     Z-ADD1         RRN     50
089500200529      *
089600200529      **  Move all records which match key into array
089700200529     C***********          Z-ADD1         X       40                      CSW095
089800200529     C                     Z-ADD1         X                               CSW095
089900200529     C                     Z-ADD0         WPASS                                             AR567569
090000200529     C                     Z-ADD0         WEOF                                              AR567569
090100200529     C           *IN10     DOWEQ'0'
090200200529      *                                                                                     AR567569
090300200529      ** If "{1:" has been repeated, it's a multiple or duplicate                           AR567569
090400200529     C                     MOVELMDTA      WSTRT                                             AR567569
090500200529     C           WSTRT     IFEQ '{1:'                                                       AR567569
090600200529     C           X         ANDNE1                                                           AR567569
090700200529     C                     ADD  1         WDUP                                              AR567569
090800200529     C                     LEAVE                                                            AR567569
090900200529     C                     ELSE                                                             AR567569
091000200529      *                                                                                     AR567569
091100200529     C           WPASS     IFEQ 1                                                           AR567569
091200200529     C                     Z-ADD0         WDUP                                              AR567569
091300200529     C                     ENDIF                                                            AR567569
091400200529     C                     ENDIF                                                            AR567569
091500200529      *                                                                                     AR567569
091600200529     C                     MOVEAMDTA      IMSG,X
091700200529     C           KEY1      READEMSMSI2L1                 10
091800200529     C                     ADD  256       X
091900200529     C                     Z-ADD1         WPASS                                             AR567569
092000200529      *                                                                                     AR567569
092100200529     C           *IN10     IFEQ *ON                                                         AR567569
092200200529     C           WDUP      ANDNE0                                                           AR567569
092300200529     C                     ADD  1         WDUP                                              AR567569
092400200529     C                     Z-ADD1         WEOF                                              AR567569
092500200529     C                     ENDIF                                                            AR567569
092600200529     C                     END
092700200529     C                     SETOF                     10
092800200529     C                     EXSR SFLE
092900200529     C                     END
093000200529      *
093100200529      **  Write Subfile
093200200529     C                     WRITEMS5015F1
093300200529     C                     EXFMTMS5015F4
093400200529     C                     MOVEL*OFF      *IN10                                             AR567569
093500200529     C                     MOVE *BLANKS   SFMG
093600200529     C                     SETOF                     30
093700200529      *
093800200529      **  If Cmd 8 process next message
093900200529     C           *INKH     IFEQ '1'
094000200529     C           WDUP      IFEQ 0                                                           AR567569
094100200529     C           KEY1      SETGTMSMSI2L1
094200200529     C                     READ MSMSI2L1                 10
094300200529     C                     ELSE                                                             AR567569
094400200529     C           WEOF      IFEQ 1                                                           AR567569
094500200529     C                     MOVE *ON       *IN10                                             AR567569
094600200529     C                     ENDIF                                                            AR567569
094700200529     C                     ENDIF                                                            AR567569
094800200529      *
094900200529     C                     EXSR VRCD
095000200529      *
095100200529      **  Write 'EOF or next message does not match selection criteria'
095200200529     C           *IN10     IFEQ '1'
095300200529     C                     MOVE MSGA,2    SFMG
095400200529     C                     SETON                     30
095500200529     C                     END
095600200529      *
095700200529      **  If Cmd 9 process previous message
095800200529     C                     ELSE
095900200529     C           *INKI     IFEQ '1'
096000200529     C           KEY1      SETLLMSMSI2L1
096100200529      *                                                                                     AR567569
096200200529     C           WDUP      IFLE 1                                                           AR567569
096300200529     C                     READPMSMSI2L1                 10
096400200529     C                     Z-ADD0         WDUP                                              AR567569
096500200529      *                                                                                     AR567569
096600200529     C                     ELSE                                                             AR567569
096700200529     C                     SUB  1         WDUP                                              AR567569
096800200529     C                     Z-ADD0         WCTR                                              AR567569
096900200529      *                                                                                     AR567569
097000200529     C           WCTR      DOWNEWDUP                                                        AR567569
097100200529     C           KEY1      READEMSMSI2L1                 10                                 AR567569
097200200529     C                     ADD  1         WCTR                                              AR567569
097300200529     C                     ENDDO                                                            AR567569
097400200529      *                                                                                     AR567569
097500200529     C           WDUP      IFNE 0                                                           AR567569
097600200529     C                     SUB  1         WDUP                                              AR567569
097700200529     C                     ENDIF                                                            AR567569
097800200529     C                     ENDIF                                                            AR567569
097900200529      *
098000200529      **  Write 'TOF or previous message does not match selection criteria'
098100200529     C           *IN10     IFEQ '1'
098200200529     C                     MOVE MSGA,3    SFMG
098300200529     C                     SETON                     30
098400200529     C           WDUP      IFEQ 1                                                           AR567569
098500200529     C           KEY1      SETLLMSMSI2L1                                                    AR567569
098600200529     C           KEY1      READEMSMSI2L1                 10                                 AR567569
098700200529     C                     ENDIF                                                            AR567569
098800200529     C                     ELSE
098900200529      *
099000200529      **  Read first record of previous message
099100200529     C           WDUP      IFEQ 0                                                           AR567569
099200200529     C           KEY1      SETLLMSMSI2L1
099300200529     C                     READ MSMSI2L1                 10
099400200529     C                     ENDIF                                                            AR567569
099500200529      *
099600200529     C                     EXSR VRCD
099700200529      *
099800200529      **  Write 'TOF or previous message does not match selection criteria'
099900200529     C           *IN10     IFEQ '1'
100000200529     C                     MOVE MSGA,3    SFMG
100100200529     C                     SETON                     30
100200200529     C                     END
100300200529     C                     END
100400200529      *
100500200529      **  If ENTER redisplay subfile
100600200529     C                     ELSE
100700200529     C                     SETON                     10
100800200529     C                     END
100900200529     C                     END
101000200529      *
101100200529     C                     END
101200200529     C                     END
101300200529      *
101400200529     C                     ENDSR
101500200529     C/EJECT
101600200529      *****************************************************************
101700200529      *   ENQY2 - enquire by priority,date,time                       *
101800200529      *   Calls - VRCD validate record                                *
101900200529      *           SFLE format message for display                     *
102000200529      *   Called by - main process                                    *
102100200529      *****************************************************************
102200200529      *
102300200529     C           ENQY2     BEGSR
102400200529      *
102500200529      **  Open file & read first record
102600200529     C           *IN52     IFEQ '0'
102700200529     C                     OPEN MSMSI2L2
102800200529     C                     SETON                     52
102900200529     C                     END
103000200529      *
103100200529     C           KEY2      SETLLMSMSI2L2
103200200529     C                     READ MSMSI2L2                 10
103300200529      *
103400200529     C                     EXSR VRCD
103500200529      *
103600200529      **  Write 'No records match selection criteria'
103700200529     C           *IN10     IFEQ '1'
103800200529     C                     MOVE MSGA,1    SFMG
103900200529     C                     SETON                     30
104000200529     C                     ELSE
104100200529     C                     Z-ADD0         WDUP                                              AR567569
104200200529      *
104300200529      **  Do until F3 or F12 pressed
104400200529     C           *INKC     DOWEQ'0'
104500200529     C           *INKL     ANDEQ'0'
104600200529      *
104700200529      **  If new message to process
104800200529     C           *IN10     IFEQ '0'
104900200529      *
105000200529      **  Clear subfile
105100200529     C                     SETOF                     2021
105200200529     C                     WRITEMS5015F4
105300200529     C                     SETON                     2021
105400200529     C                     Z-ADD1         RRN     50
105500200529      *
105600200529      **  Move all records which match key into array
105700200529     C***********          Z-ADD1         X       40                      CSW095
105800200529     C                     Z-ADD1         X                               CSW095
105900200529     C                     Z-ADD0         WPASS                                             AR567569
106000200529     C                     Z-ADD0         WEOF                                              AR567569
106100200529     C           *IN10     DOWEQ'0'
106200200529      *                                                                                     AR567569
106300200529      ** If "{1:" has been repeated, it's a multiple or duplicate                           AR567569
106400200529     C                     MOVELMDTA      WSTRT                                             AR567569
106500200529     C           WSTRT     IFEQ '{1:'                                                       AR567569
106600200529     C           X         ANDNE1                                                           AR567569
106700200529     C                     ADD  1         WDUP                                              AR567569
106800200529     C                     LEAVE                                                            AR567569
106900200529     C                     ELSE                                                             AR567569
107000200529      *                                                                                     AR567569
107100200529     C           WPASS     IFEQ 1                                                           AR567569
107200200529     C                     Z-ADD0         WDUP                                              AR567569
107300200529     C                     ENDIF                                                            AR567569
107400200529     C                     ENDIF                                                            AR567569
107500200529      *                                                                                     AR567569
107600200529     C                     MOVEAMDTA      IMSG,X
107700200529     C           KEY2      READEMSMSI2L2                 10
107800200529     C                     ADD  256       X
107900200529     C                     Z-ADD1         WPASS                                             AR567569
108000200529      *                                                                                     AR567569
108100200529     C           *IN10     IFEQ *ON                                                         AR567569
108200200529     C           WDUP      ANDNE0                                                           AR567569
108300200529     C                     ADD  1         WDUP                                              AR567569
108400200529     C                     Z-ADD1         WEOF                                              AR567569
108500200529     C                     ENDIF                                                            AR567569
108600200529     C                     END
108700200529     C                     SETOF                     10
108800200529     C                     EXSR SFLE
108900200529     C                     END
109000200529      *
109100200529      **  Write Subfile
109200200529     C                     WRITEMS5015F1
109300200529     C                     EXFMTMS5015F4
109400200529     C                     MOVEL*OFF      *IN10                                             AR567569
109500200529     C                     MOVE *BLANKS   SFMG
109600200529     C                     SETOF                     30
109700200529      *
109800200529      **  If Cmd 8 process next message
109900200529     C           *INKH     IFEQ '1'
110000200529     C           WDUP      IFEQ 0                                                           AR567569
110100200529     C           KEY2      SETGTMSMSI2L2
110200200529     C                     READ MSMSI2L2                 10
110300200529     C                     ELSE                                                             AR567569
110400200529     C           WEOF      IFEQ 1                                                           AR567569
110500200529     C                     MOVE *ON       *IN10                                             AR567569
110600200529     C                     ENDIF                                                            AR567569
110700200529     C                     ENDIF                                                            AR567569
110800200529      *
110900200529     C                     EXSR VRCD
111000200529      *
111100200529      **  Write 'EOF or next message does not match selection criteria'
111200200529     C           *IN10     IFEQ '1'
111300200529     C                     MOVE MSGA,2    SFMG
111400200529     C                     SETON                     30
111500200529     C                     END
111600200529      *
111700200529      **  If Cmd 9 process previous message
111800200529     C                     ELSE
111900200529     C           *INKI     IFEQ '1'
112000200529     C           KEY2      SETLLMSMSI2L2
112100200529      *                                                                                     AR567569
112200200529     C           WDUP      IFLE 1                                                           AR567569
112300200529     C                     READPMSMSI2L2                 10
112400200529     C                     Z-ADD0         WDUP                                              AR567569
112500200529      *                                                                                     AR567569
112600200529     C                     ELSE                                                             AR567569
112700200529     C                     SUB  1         WDUP                                              AR567569
112800200529     C                     Z-ADD0         WCTR                                              AR567569
112900200529      *                                                                                     AR567569
113000200529     C           WCTR      DOWNEWDUP                                                        AR567569
113100200529     C           KEY2      READEMSMSI2L2                 10                                 AR567569
113200200529     C                     ADD  1         WCTR                                              AR567569
113300200529     C                     ENDDO                                                            AR567569
113400200529      *                                                                                     AR567569
113500200529     C           WDUP      IFNE 0                                                           AR567569
113600200529     C                     SUB  1         WDUP                                              AR567569
113700200529     C                     ENDIF                                                            AR567569
113800200529     C                     ENDIF                                                            AR567569
113900200529      *
114000200529      **  Write 'TOF or previous message does not match selection criteria'
114100200529     C           *IN10     IFEQ '1'
114200200529     C                     MOVE MSGA,3    SFMG
114300200529     C                     SETON                     30
114400200529     C           WDUP      IFEQ 1                                                           AR567569
114500200529     C           KEY2      SETLLMSMSI2L2                                                    AR567569
114600200529     C           KEY2      READEMSMSI2L2                 10                                 AR567569
114700200529     C                     ENDIF                                                            AR567569
114800200529     C                     ELSE
114900200529      *
115000200529      **  Read first record of previous message
115100200529     C           WDUP      IFEQ 0                                                           AR567569
115200200529     C           KEY2      SETLLMSMSI2L2
115300200529     C                     READ MSMSI2L2                 10
115400200529     C                     ENDIF                                                            AR567569
115500200529      *
115600200529     C                     EXSR VRCD
115700200529      *
115800200529      **  Write 'TOF or previous message does not match selection criteria'
115900200529     C           *IN10     IFEQ '1'
116000200529     C                     MOVE MSGA,3    SFMG
116100200529     C                     SETON                     30
116200200529     C                     END
116300200529     C                     END
116400200529      *
116500200529      **  If ENTER redisplay subfile
116600200529     C                     ELSE
116700200529     C                     SETON                     10
116800200529     C                     END
116900200529     C                     END
117000200529      *
117100200529     C                     END
117200200529     C                     END
117300200529      *
117400200529     C                     ENDSR
117500200529     C/EJECT
117600200529      *****************************************************************
117700200529      *   ENQY3 - enquire by date,time                                *
117800200529      *   Calls - VRCD validate record                                *
117900200529      *           SFLE format message for display                     *
118000200529      *   Called by - main process                                    *
118100200529      *****************************************************************
118200200529      *
118300200529     C           ENQY3     BEGSR
118400200529      *
118500200529      **  Open file & read first record
118600200529     C           *IN53     IFEQ '0'
118700200529     C                     OPEN MSMSI2L3
118800200529     C                     SETON                     53
118900200529     C                     END
119000200529      *
119100200529     C           KEY3      SETLLMSMSI2L3
119200200529     C                     READ MSMSI2L3                 10
119300200529      *
119400200529     C                     EXSR VRCD
119500200529      *
119600200529      **  Write 'No records match selection criteria'
119700200529     C           *IN10     IFEQ '1'
119800200529     C                     MOVE MSGA,1    SFMG
119900200529     C                     SETON                     30
120000200529     C                     ELSE
120100200529     C                     Z-ADD0         WDUP                                              AR567569
120200200529      *
120300200529      **  Do until F3 or F12 pressed
120400200529     C           *INKC     DOWEQ'0'
120500200529     C           *INKL     ANDEQ'0'
120600200529      *
120700200529      **  If new message to process
120800200529     C           *IN10     IFEQ '0'
120900200529      *
121000200529      **  Clear subfile
121100200529     C                     SETOF                     2021
121200200529     C                     WRITEMS5015F4
121300200529     C                     SETON                     2021
121400200529     C                     Z-ADD1         RRN     50
121500200529      *
121600200529      **  Move all records which match key into array
121700200529     C***********          Z-ADD1         X       40                      CSW095
121800200529     C                     Z-ADD1         X                               CSW095
121900200529     C                     Z-ADD0         WPASS                                             AR567569
122000200529     C                     Z-ADD0         WEOF                                              AR567569
122100200529     C           *IN10     DOWEQ'0'
122200200529      *                                                                                     AR567569
122300200529      ** If "{1:" has been repeated, it's a multiple or duplicate                           AR567569
122400200529     C                     MOVELMDTA      WSTRT                                             AR567569
122500200529     C           WSTRT     IFEQ '{1:'                                                       AR567569
122600200529     C           X         ANDNE1                                                           AR567569
122700200529     C                     ADD  1         WDUP                                              AR567569
122800200529     C                     LEAVE                                                            AR567569
122900200529     C                     ELSE                                                             AR567569
123000200529      *                                                                                     AR567569
123100200529     C           WPASS     IFEQ 1                                                           AR567569
123200200529     C                     Z-ADD0         WDUP                                              AR567569
123300200529     C                     ENDIF                                                            AR567569
123400200529     C                     ENDIF                                                            AR567569
123500200529      *                                                                                     AR567569
123600200529     C                     MOVEAMDTA      IMSG,X
123700200529     C           KEY3      READEMSMSI2L3                 10
123800200529     C                     ADD  256       X
123900200529     C                     Z-ADD1         WPASS                                             AR567569
124000200529      *                                                                                     AR567569
124100200529     C           *IN10     IFEQ *ON                                                         AR567569
124200200529     C           WDUP      ANDNE0                                                           AR567569
124300200529     C                     ADD  1         WDUP                                              AR567569
124400200529     C                     Z-ADD1         WEOF                                              AR567569
124500200529     C                     ENDIF                                                            AR567569
124600200529     C                     END
124700200529     C                     SETOF                     10
124800200529     C                     EXSR SFLE
124900200529     C                     END
125000200529      *
125100200529      **  Write Subfile
125200200529     C                     WRITEMS5015F1
125300200529     C                     EXFMTMS5015F4
125400200529     C                     MOVEL*OFF      *IN10                                             AR567569
125500200529     C                     MOVE *BLANKS   SFMG
125600200529     C                     SETOF                     30
125700200529      *
125800200529      **  If Cmd 8 process next message
125900200529     C           *INKH     IFEQ '1'
126000200529     C           WDUP      IFEQ 0                                                           AR567569
126100200529     C           KEY3      SETGTMSMSI2L3
126200200529     C                     READ MSMSI2L3                 10
126300200529     C                     ELSE                                                             AR567569
126400200529     C           WEOF      IFEQ 1                                                           AR567569
126500200529     C                     MOVE *ON       *IN10                                             AR567569
126600200529     C                     ENDIF                                                            AR567569
126700200529     C                     ENDIF                                                            AR567569
126800200529      *
126900200529     C                     EXSR VRCD
127000200529      *
127100200529      **  Write 'EOF or next message does not match selection criteria'
127200200529     C           *IN10     IFEQ '1'
127300200529     C                     MOVE MSGA,2    SFMG
127400200529     C                     SETON                     30
127500200529     C                     END
127600200529      *
127700200529      **  If Cmd 9 process previous message
127800200529     C                     ELSE
127900200529     C           *INKI     IFEQ '1'
128000200529     C           KEY3      SETLLMSMSI2L3
128100200529      *                                                                                     AR567569
128200200529     C           WDUP      IFLE 1                                                           AR567569
128300200529     C                     READPMSMSI2L3                 10
128400200529     C                     Z-ADD0         WDUP                                              AR567569
128500200529      *                                                                                     AR567569
128600200529     C                     ELSE                                                             AR567569
128700200529     C                     SUB  1         WDUP                                              AR567569
128800200529     C                     Z-ADD0         WCTR                                              AR567569
128900200529      *                                                                                     AR567569
129000200529     C           WCTR      DOWNEWDUP                                                        AR567569
129100200529     C           KEY3      READEMSMSI2L3                 10                                 AR567569
129200200529     C                     ADD  1         WCTR                                              AR567569
129300200529     C                     ENDDO                                                            AR567569
129400200529      *                                                                                     AR567569
129500200529     C           WDUP      IFNE 0                                                           AR567569
129600200529     C                     SUB  1         WDUP                                              AR567569
129700200529     C                     ENDIF                                                            AR567569
129800200529     C                     ENDIF                                                            AR567569
129900200529      *
130000200529      **  Write 'TOF or previous message does not match selection criteria'
130100200529     C           *IN10     IFEQ '1'
130200200529     C                     MOVE MSGA,3    SFMG
130300200529     C                     SETON                     30
130400200529     C           WDUP      IFEQ 1                                                           AR567569
130500200529     C           KEY3      SETLLMSMSI2L3                                                    AR567569
130600200529     C           KEY3      READEMSMSI2L3                 10                                 AR567569
130700200529     C                     ENDIF                                                            AR567569
130800200529     C                     ELSE
130900200529      *
131000200529      **  Read first record of previous message
131100200529     C           WDUP      IFEQ 0                                                           AR567569
131200200529     C           KEY3      SETLLMSMSI2L3
131300200529     C                     READ MSMSI2L3                 10
131400200529     C                     ENDIF                                                            AR567569
131500200529      *
131600200529     C                     EXSR VRCD
131700200529      *
131800200529      **  Write 'TOF or previous message does not match selection criteria'
131900200529     C           *IN10     IFEQ '1'
132000200529     C                     MOVE MSGA,3    SFMG
132100200529     C                     SETON                     30
132200200529     C                     END
132300200529     C                     END
132400200529      *
132500200529      **  If ENTER redisplay subfile
132600200529     C                     ELSE
132700200529     C                     SETON                     10
132800200529     C                     END
132900200529     C                     END
133000200529      *
133100200529     C                     END
133200200529     C                     END
133300200529      *
133400200529     C                     ENDSR
133500200529     C/EJECT                                                              S01310
133600200529      *****************************************************************   S01310
133700200529      *   ENQYB - enquire by branch,type,priority,date,time           *   S01310
133800200529      *   Calls - VRCD validate record                                *   S01310
133900200529      *           SFLE format message for display                     *   S01310
134000200529      *   Called by - main process                                    *   S01310
134100200529      *****************************************************************   S01310
134200200529      *                                                                   S01310
134300200529     C           ENQYB     BEGSR                                          S01310
134400200529      *                                                                   S01310
134500200529      **  Open file & read first record                                   S01310
134600200529     C           *IN54     IFEQ '0'                                       S01310
134700200529     C                     OPEN MSMSI2LB                                  S01310
134800200529     C                     SETON                     54                   S01310
134900200529     C                     END                                            S01310
135000200529      *                                                                   S01310
135100200529     C           KEYB      SETLLMSMSI2LB                                  S01310
135200200529     C                     READ MSMSI2LB                 10               S01310
135300200529      *                                                                   S01310
135400200529     C                     EXSR VRCD                                      S01310
135500200529      *                                                                   S01310
135600200529      **  Write 'No records match selection criteria'                     S01310
135700200529     C           *IN10     IFEQ '1'                                       S01310
135800200529     C                     MOVE MSGA,1    SFMG                            S01310
135900200529     C                     SETON                     30                   S01310
136000200529     C                     ELSE                                           S01310
136100200529     C                     Z-ADD0         WDUP                                              AR567569
136200200529      *                                                                   S01310
136300200529      **  Do until F3 or F12 pressed                                      S01310
136400200529     C           *INKC     DOWEQ'0'                                       S01310
136500200529     C           *INKL     ANDEQ'0'                                       S01310
136600200529      *                                                                   S01310
136700200529      **  If new message to process                                       S01310
136800200529     C           *IN10     IFEQ '0'                                       S01310
136900200529      *                                                                   S01310
137000200529      **  Clear subfile                                                   S01310
137100200529     C                     SETOF                     2021                 S01310
137200200529     C                     WRITEMS5015F4                                  S01310
137300200529     C                     SETON                     2021                 S01310
137400200529     C                     Z-ADD1         RRN     50                      S01310
137500200529      *                                                                   S01310
137600200529      **  Move all records which match key into array                     S01310
137700200529     C***********          Z-ADD1         X       40               S01310 CSW095
137800200529     C                     Z-ADD1         X                               CSW095
137900200529     C                     Z-ADD0         WPASS                                             AR567569
138000200529     C                     Z-ADD0         WEOF                                              AR567569
138100200529     C           *IN10     DOWEQ'0'                                       S01310
138200200529      *                                                                                     AR567569
138300200529      ** If "{1:" has been repeated, it's a multiple or duplicate                           AR567569
138400200529     C                     MOVELMDTA      WSTRT                                             AR567569
138500200529     C           WSTRT     IFEQ '{1:'                                                       AR567569
138600200529     C           X         ANDNE1                                                           AR567569
138700200529     C                     ADD  1         WDUP                                              AR567569
138800200529     C                     LEAVE                                                            AR567569
138900200529     C                     ELSE                                                             AR567569
139000200529      *                                                                                     AR567569
139100200529     C           WPASS     IFEQ 1                                                           AR567569
139200200529     C                     Z-ADD0         WDUP                                              AR567569
139300200529     C                     ENDIF                                                            AR567569
139400200529     C                     ENDIF                                                            AR567569
139500200529      *                                                                                     AR567569
139600200529     C                     MOVEAMDTA      IMSG,X                          S01310
139700200529     C           KEYB      READEMSMSI2LB                 10               S01310
139800200529     C                     ADD  256       X                               S01310
139900200529     C                     Z-ADD1         WPASS                                             AR567569
140000200529      *                                                                                     AR567569
140100200529     C           *IN10     IFEQ *ON                                                         AR567569
140200200529     C           WDUP      ANDNE0                                                           AR567569
140300200529     C                     ADD  1         WDUP                                              AR567569
140400200529     C                     Z-ADD1         WEOF                                              AR567569
140500200529     C                     ENDIF                                                            AR567569
140600200529     C                     END                                            S01310
140700200529     C                     SETOF                     10                   S01310
140800200529     C                     EXSR SFLE                                      S01310
140900200529     C                     END                                            S01310
141000200529      *                                                                   S01310
141100200529      **  Write Subfile                                                   S01310
141200200529     C                     WRITEMS5015F1                                  S01310
141300200529     C                     EXFMTMS5015F4                                  S01310
141400200529     C                     MOVEL*OFF      *IN10                                             AR567569
141500200529     C                     MOVE *BLANKS   SFMG                            S01310
141600200529     C                     SETOF                     30                   S01310
141700200529      *                                                                   S01310
141800200529      **  If Cmd 8 process next message                                   S01310
141900200529     C           *INKH     IFEQ '1'                                       S01310
142000200529     C           WDUP      IFEQ 0                                                           AR567569
142100200529     C           KEYB      SETGTMSMSI2LB                                  S01310
142200200529     C                     READ MSMSI2LB                 10               S01310
142300200529     C                     ELSE                                                             AR567569
142400200529     C           WEOF      IFEQ 1                                                           AR567569
142500200529     C                     MOVE *ON       *IN10                                             AR567569
142600200529     C                     ENDIF                                                            AR567569
142700200529     C                     ENDIF                                                            AR567569
142800200529      *                                                                   S01310
142900200529     C                     EXSR VRCD                                      S01310
143000200529      *                                                                   S01310
143100200529      **  Write 'EOF or next message does not match selection criteria'   S01310
143200200529     C           *IN10     IFEQ '1'                                       S01310
143300200529     C                     MOVE MSGA,2    SFMG                            S01310
143400200529     C                     SETON                     30                   S01310
143500200529     C                     END                                            S01310
143600200529      *                                                                   S01310
143700200529      **  If Cmd 9 process previous message                               S01310
143800200529     C                     ELSE                                           S01310
143900200529     C           *INKI     IFEQ '1'                                       S01310
144000200529     C           KEYB      SETLLMSMSI2LB                                  S01310
144100200529      *                                                                                     AR567569
144200200529     C           WDUP      IFLE 1                                                           AR567569
144300200529     C                     READPMSMSI2LB                 10               S01310
144400200529     C                     Z-ADD0         WDUP                                              AR567569
144500200529      *                                                                                     AR567569
144600200529     C                     ELSE                                                             AR567569
144700200529     C                     SUB  1         WDUP                                              AR567569
144800200529     C                     Z-ADD0         WCTR                                              AR567569
144900200529      *                                                                                     AR567569
145000200529     C           WCTR      DOWNEWDUP                                                        AR567569
145100200529     C           KEYB      READEMSMSI2LB                 10                                 AR567569
145200200529     C                     ADD  1         WCTR                                              AR567569
145300200529     C                     ENDDO                                                            AR567569
145400200529      *                                                                                     AR567569
145500200529     C           WDUP      IFNE 0                                                           AR567569
145600200529     C                     SUB  1         WDUP                                              AR567569
145700200529     C                     ENDIF                                                            AR567569
145800200529     C                     ENDIF                                                            AR567569
145900200529      *                                                                   S01310
146000200529      **  Write 'TOF or previous message does not match selection criteria'01310
146100200529     C           *IN10     IFEQ '1'                                       S01310
146200200529     C                     MOVE MSGA,3    SFMG                            S01310
146300200529     C                     SETON                     30                   S01310
146400200529     C           WDUP      IFEQ 1                                                           AR567569
146500200529     C           KEYB      SETLLMSMSI2LB                                                    AR567569
146600200529     C           KEYB      READEMSMSI2LB                 10                                 AR567569
146700200529     C                     ENDIF                                                            AR567569
146800200529     C                     ELSE                                           S01310
146900200529      *                                                                   S01310
147000200529      **  Read first record of previous message                           S01310
147100200529     C           WDUP      IFEQ 0                                                           AR567569
147200200529     C           KEYB      SETLLMSMSI2LB                                  S01310
147300200529     C                     READ MSMSI2LB                 10               S01310
147400200529     C                     ENDIF                                                            AR567569
147500200529      *                                                                   S01310
147600200529     C                     EXSR VRCD                                      S01310
147700200529      *                                                                   S01310
147800200529      **  Write 'TOF or previous message does not match selection criteria'01310
147900200529     C           *IN10     IFEQ '1'                                       S01310
148000200529     C                     MOVE MSGA,3    SFMG                            S01310
148100200529     C                     SETON                     30                   S01310
148200200529     C                     END                                            S01310
148300200529     C                     END                                            S01310
148400200529      *                                                                   S01310
148500200529      **  If ENTER redisplay subfile                                      S01310
148600200529     C                     ELSE                                           S01310
148700200529     C                     SETON                     10                   S01310
148800200529     C                     END                                            S01310
148900200529     C                     END                                            S01310
149000200529      *                                                                   S01310
149100200529     C                     END                                            S01310
149200200529     C                     END                                            S01310
149300200529      *                                                                   S01310
149400200529     C                     ENDSR                                          S01310
149500200529     C/EJECT                                                              S01310
149600200529      *****************************************************************   S01310
149700200529      *   ENQYC - enquire by branch,type,date,time                    *   S01310
149800200529      *   Calls - VRCD validate record                                *   S01310
149900200529      *           SFLE format message for display                     *   S01310
150000200529      *   Called by - main process                                    *   S01310
150100200529      *****************************************************************   S01310
150200200529      *                                                                   S01310
150300200529     C           ENQYC     BEGSR                                          S01310
150400200529      *                                                                   S01310
150500200529      **  Open file & read first record                                   S01310
150600200529     C           *IN55     IFEQ '0'                                       S01310
150700200529     C                     OPEN MSMSI2LC                                  S01310
150800200529     C                     SETON                     55                   S01310
150900200529     C                     END                                            S01310
151000200529      *                                                                   S01310
151100200529     C           KEYC      SETLLMSMSI2LC                                  S01310
151200200529     C                     READ MSMSI2LC                 10               S01310
151300200529      *                                                                   S01310
151400200529     C                     EXSR VRCD                                      S01310
151500200529      *                                                                   S01310
151600200529      **  Write 'No records match selection criteria'                     S01310
151700200529     C           *IN10     IFEQ '1'                                       S01310
151800200529     C                     MOVE MSGA,1    SFMG                            S01310
151900200529     C                     SETON                     30                   S01310
152000200529     C                     ELSE                                           S01310
152100200529     C                     Z-ADD0         WDUP                                              AR567569
152200200529      *                                                                   S01310
152300200529      **  Do until F3 or F12 pressed                                      S01310
152400200529     C           *INKC     DOWEQ'0'                                       S01310
152500200529     C           *INKL     ANDEQ'0'                                       S01310
152600200529      *                                                                   S01310
152700200529      **  If new message to process                                       S01310
152800200529     C           *IN10     IFEQ '0'                                       S01310
152900200529      *                                                                   S01310
153000200529      **  Clear subfile                                                   S01310
153100200529     C                     SETOF                     2021                 S01310
153200200529     C                     WRITEMS5015F4                                  S01310
153300200529     C                     SETON                     2021                 S01310
153400200529     C                     Z-ADD1         RRN     50                      S01310
153500200529      *                                                                   S01310
153600200529      **  Move all records which match key into array                     S01310
153700200529     C***********          Z-ADD1         X       40               S01310 CSW095
153800200529     C                     Z-ADD1         X                               CSW095
153900200529     C                     Z-ADD0         WPASS                                             AR567569
154000200529     C                     Z-ADD0         WEOF                                              AR567569
154100200529     C           *IN10     DOWEQ'0'                                       S01310
154200200529      *                                                                                     AR567569
154300200529      ** If "{1:" has been repeated, it's a multiple or duplicate                           AR567569
154400200529     C                     MOVELMDTA      WSTRT                                             AR567569
154500200529     C           WSTRT     IFEQ '{1:'                                                       AR567569
154600200529     C           X         ANDNE1                                                           AR567569
154700200529     C                     ADD  1         WDUP                                              AR567569
154800200529     C                     LEAVE                                                            AR567569
154900200529     C                     ELSE                                                             AR567569
155000200529      *                                                                                     AR567569
155100200529     C           WPASS     IFEQ 1                                                           AR567569
155200200529     C                     Z-ADD0         WDUP                                              AR567569
155300200529     C                     ENDIF                                                            AR567569
155400200529     C                     ENDIF                                                            AR567569
155500200529      *                                                                                     AR567569
155600200529     C                     MOVEAMDTA      IMSG,X                          S01310
155700200529     C           KEYC      READEMSMSI2LC                 10               S01310
155800200529     C                     ADD  256       X                               S01310
155900200529     C                     Z-ADD1         WPASS                                             AR567569
156000200529      *                                                                                     AR567569
156100200529     C           *IN10     IFEQ *ON                                                         AR567569
156200200529     C           WDUP      ANDNE0                                                           AR567569
156300200529     C                     ADD  1         WDUP                                              AR567569
156400200529     C                     Z-ADD1         WEOF                                              AR567569
156500200529     C                     ENDIF                                                            AR567569
156600200529     C                     END                                            S01310
156700200529     C                     SETOF                     10                   S01310
156800200529     C                     EXSR SFLE                                      S01310
156900200529     C                     END                                            S01310
157000200529      *                                                                   S01310
157100200529      **  Write Subfile                                                   S01310
157200200529     C                     WRITEMS5015F1                                  S01310
157300200529     C                     EXFMTMS5015F4                                  S01310
157400200529     C                     MOVEL*OFF      *IN10                                             AR567569
157500200529     C                     MOVE *BLANKS   SFMG                            S01310
157600200529     C                     SETOF                     30                   S01310
157700200529      *                                                                   S01310
157800200529      **  If Cmd 8 process next message                                   S01310
157900200529     C           *INKH     IFEQ '1'                                       S01310
158000200529     C           WDUP      IFEQ 0                                                           AR567569
158100200529     C           KEYC      SETGTMSMSI2LC                                  S01310
158200200529     C                     READ MSMSI2LC                 10               S01310
158300200529     C                     ELSE                                                             AR567569
158400200529     C           WEOF      IFEQ 1                                                           AR567569
158500200529     C                     MOVE *ON       *IN10                                             AR567569
158600200529     C                     ENDIF                                                            AR567569
158700200529     C                     ENDIF                                                            AR567569
158800200529      *                                                                   S01310
158900200529     C                     EXSR VRCD                                      S01310
159000200529      *                                                                   S01310
159100200529      **  Write 'EOF or next message does not match selection criteria'   S01310
159200200529     C           *IN10     IFEQ '1'                                       S01310
159300200529     C                     MOVE MSGA,2    SFMG                            S01310
159400200529     C                     SETON                     30                   S01310
159500200529     C                     END                                            S01310
159600200529      *                                                                   S01310
159700200529      **  If Cmd 9 process previous message                               S01310
159800200529     C                     ELSE                                           S01310
159900200529     C           *INKI     IFEQ '1'                                       S01310
160000200529     C           KEYC      SETLLMSMSI2LC                                  S01310
160100200529      *                                                                                     AR567569
160200200529     C           WDUP      IFLE 1                                                           AR567569
160300200529     C                     READPMSMSI2LC                 10               S01310
160400200529     C                     Z-ADD0         WDUP                                              AR567569
160500200529      *                                                                                     AR567569
160600200529     C                     ELSE                                                             AR567569
160700200529     C                     SUB  1         WDUP                                              AR567569
160800200529     C                     Z-ADD0         WCTR                                              AR567569
160900200529      *                                                                                     AR567569
161000200529     C           WCTR      DOWNEWDUP                                                        AR567569
161100200529     C           KEYC      READEMSMSI2LC                 10                                 AR567569
161200200529     C                     ADD  1         WCTR                                              AR567569
161300200529     C                     ENDDO                                                            AR567569
161400200529      *                                                                                     AR567569
161500200529     C           WDUP      IFNE 0                                                           AR567569
161600200529     C                     SUB  1         WDUP                                              AR567569
161700200529     C                     ENDIF                                                            AR567569
161800200529     C                     ENDIF                                                            AR567569
161900200529      *                                                                   S01310
162000200529      **  Write 'TOF or previous message does not match selection criteria'01310
162100200529     C           *IN10     IFEQ '1'                                       S01310
162200200529     C                     MOVE MSGA,3    SFMG                            S01310
162300200529     C                     SETON                     30                   S01310
162400200529     C           WDUP      IFEQ 1                                                           AR567569
162500200529     C           KEYC      SETLLMSMSI2LC                                                    AR567569
162600200529     C           KEYC      READEMSMSI2LC                 10                                 AR567569
162700200529     C                     ENDIF                                                            AR567569
162800200529     C                     ELSE                                           S01310
162900200529      *                                                                   S01310
163000200529      **  Read first record of previous message                           S01310
163100200529     C           WDUP      IFEQ 0                                                           AR567569
163200200529     C           KEYC      SETLLMSMSI2LC                                  S01310
163300200529     C                     READ MSMSI2LC                 10               S01310
163400200529     C                     ENDIF                                                            AR567569
163500200529      *                                                                   S01310
163600200529     C                     EXSR VRCD                                      S01310
163700200529      *                                                                   S01310
163800200529      **  Write 'TOF or previous message does not match selection criteria'01310
163900200529     C           *IN10     IFEQ '1'                                       S01310
164000200529     C                     MOVE MSGA,3    SFMG                            S01310
164100200529     C                     SETON                     30                   S01310
164200200529     C                     END                                            S01310
164300200529     C                     END                                            S01310
164400200529      *                                                                   S01310
164500200529      **  If ENTER redisplay subfile                                      S01310
164600200529     C                     ELSE                                           S01310
164700200529     C                     SETON                     10                   S01310
164800200529     C                     END                                            S01310
164900200529     C                     END                                            S01310
165000200529      *                                                                   S01310
165100200529     C                     END                                            S01310
165200200529     C                     END                                            S01310
165300200529      *                                                                   S01310
165400200529     C                     ENDSR                                          S01310
165500200529     C/EJECT                                                              S01310
165600200529      *****************************************************************   S01310
165700200529      *   ENQYD - enquire by branch,priority,date,time                *   S01310
165800200529      *   Calls - VRCD validate record                                *   S01310
165900200529      *           SFLE format message for display                     *   S01310
166000200529      *   Called by - main process                                    *   S01310
166100200529      *****************************************************************   S01310
166200200529      *                                                                   S01310
166300200529     C           ENQYD     BEGSR                                          S01310
166400200529      *                                                                   S01310
166500200529      **  Open file & read first record                                   S01310
166600200529     C           *IN56     IFEQ '0'                                       S01310
166700200529     C                     OPEN MSMSI2LD                                  S01310
166800200529     C                     SETON                     56                   S01310
166900200529     C                     END                                            S01310
167000200529      *                                                                   S01310
167100200529     C           KEYD      SETLLMSMSI2LD                                  S01310
167200200529     C                     READ MSMSI2LD                 10               S01310
167300200529      *                                                                   S01310
167400200529     C                     EXSR VRCD                                      S01310
167500200529      *                                                                   S01310
167600200529      **  Write 'No records match selection criteria'                     S01310
167700200529     C           *IN10     IFEQ '1'                                       S01310
167800200529     C                     MOVE MSGA,1    SFMG                            S01310
167900200529     C                     SETON                     30                   S01310
168000200529     C                     ELSE                                           S01310
168100200529     C                     Z-ADD0         WDUP                                              AR567569
168200200529      *                                                                   S01310
168300200529      **  Do until F3 or F12 pressed                                      S01310
168400200529     C           *INKC     DOWEQ'0'                                       S01310
168500200529     C           *INKL     ANDEQ'0'                                       S01310
168600200529      *                                                                   S01310
168700200529      **  If new message to process                                       S01310
168800200529     C           *IN10     IFEQ '0'                                       S01310
168900200529      *                                                                   S01310
169000200529      **  Clear subfile                                                   S01310
169100200529     C                     SETOF                     2021                 S01310
169200200529     C                     WRITEMS5015F4                                  S01310
169300200529     C                     SETON                     2021                 S01310
169400200529     C                     Z-ADD1         RRN     50                      S01310
169500200529      *                                                                   S01310
169600200529      **  Move all records which match key into array                     S01310
169700200529     C***********          Z-ADD1         X       40               S01310 CSW095
169800200529     C                     Z-ADD1         X                               CSW095
169900200529     C                     Z-ADD0         WPASS                                             AR567569
170000200529     C                     Z-ADD0         WEOF                                              AR567569
170100200529     C           *IN10     DOWEQ'0'                                       S01310
170200200529      *                                                                                     AR567569
170300200529      ** If "{1:" has been repeated, it's a multiple or duplicate                           AR567569
170400200529     C                     MOVELMDTA      WSTRT                                             AR567569
170500200529     C           WSTRT     IFEQ '{1:'                                                       AR567569
170600200529     C           X         ANDNE1                                                           AR567569
170700200529     C                     ADD  1         WDUP                                              AR567569
170800200529     C                     LEAVE                                                            AR567569
170900200529     C                     ELSE                                                             AR567569
171000200529      *                                                                                     AR567569
171100200529     C           WPASS     IFEQ 1                                                           AR567569
171200200529     C                     Z-ADD0         WDUP                                              AR567569
171300200529     C                     ENDIF                                                            AR567569
171400200529     C                     ENDIF                                                            AR567569
171500200529      *                                                                                     AR567569
171600200529     C                     MOVEAMDTA      IMSG,X                          S01310
171700200529     C           KEYD      READEMSMSI2LD                 10               S01310
171800200529     C                     ADD  256       X                               S01310
171900200529     C                     Z-ADD1         WPASS                                             AR567569
172000200529      *                                                                                     AR567569
172100200529     C           *IN10     IFEQ *ON                                                         AR567569
172200200529     C           WDUP      ANDNE0                                                           AR567569
172300200529     C                     ADD  1         WDUP                                              AR567569
172400200529     C                     Z-ADD1         WEOF                                              AR567569
172500200529     C                     ENDIF                                                            AR567569
172600200529     C                     END                                            S01310
172700200529     C                     SETOF                     10                   S01310
172800200529     C                     EXSR SFLE                                      S01310
172900200529     C                     END                                            S01310
173000200529      *                                                                   S01310
173100200529      **  Write Subfile                                                   S01310
173200200529     C                     WRITEMS5015F1                                  S01310
173300200529     C                     EXFMTMS5015F4                                  S01310
173400200529     C                     MOVEL*OFF      *IN10                                             AR567569
173500200529     C                     MOVE *BLANKS   SFMG                            S01310
173600200529     C                     SETOF                     30                   S01310
173700200529      *                                                                   S01310
173800200529      **  If Cmd 8 process next message                                   S01310
173900200529     C           *INKH     IFEQ '1'                                       S01310
174000200529     C           WDUP      IFEQ 0                                                           AR567569
174100200529     C           KEYD      SETGTMSMSI2LD                                  S01310
174200200529     C                     READ MSMSI2LD                 10               S01310
174300200529     C                     ELSE                                                             AR567569
174400200529     C           WEOF      IFEQ 1                                                           AR567569
174500200529     C                     MOVE *ON       *IN10                                             AR567569
174600200529     C                     ENDIF                                                            AR567569
174700200529     C                     ENDIF                                                            AR567569
174800200529      *                                                                   S01310
174900200529     C                     EXSR VRCD                                      S01310
175000200529      *                                                                   S01310
175100200529      **  Write 'EOF or next message does not match selection criteria'   S01310
175200200529     C           *IN10     IFEQ '1'                                       S01310
175300200529     C                     MOVE MSGA,2    SFMG                            S01310
175400200529     C                     SETON                     30                   S01310
175500200529     C                     END                                            S01310
175600200529      *                                                                   S01310
175700200529      **  If Cmd 9 process previous message                               S01310
175800200529     C                     ELSE                                           S01310
175900200529     C           *INKI     IFEQ '1'                                       S01310
176000200529     C           KEYD      SETLLMSMSI2LD                                  S01310
176100200529      *                                                                                     AR567569
176200200529     C           WDUP      IFLE 1                                                           AR567569
176300200529     C                     READPMSMSI2LD                 10               S01310
176400200529     C                     Z-ADD0         WDUP                                              AR567569
176500200529      *                                                                                     AR567569
176600200529     C                     ELSE                                                             AR567569
176700200529     C                     SUB  1         WDUP                                              AR567569
176800200529     C                     Z-ADD0         WCTR                                              AR567569
176900200529      *                                                                                     AR567569
177000200529     C           WCTR      DOWNEWDUP                                                        AR567569
177100200529     C           KEYD      READEMSMSI2LD                 10                                 AR567569
177200200529     C                     ADD  1         WCTR                                              AR567569
177300200529     C                     ENDDO                                                            AR567569
177400200529      *                                                                                     AR567569
177500200529     C           WDUP      IFNE 0                                                           AR567569
177600200529     C                     SUB  1         WDUP                                              AR567569
177700200529     C                     ENDIF                                                            AR567569
177800200529     C                     ENDIF                                                            AR567569
177900200529      *                                                                   S01310
178000200529      **  Write 'TOF or previous message does not match selection criteria'01310
178100200529     C           *IN10     IFEQ '1'                                       S01310
178200200529     C                     MOVE MSGA,3    SFMG                            S01310
178300200529     C                     SETON                     30                   S01310
178400200529     C           WDUP      IFEQ 1                                                           AR567569
178500200529     C           KEYD      SETLLMSMSI2LD                                                    AR567569
178600200529     C           KEYD      READEMSMSI2LD                 10                                 AR567569
178700200529     C                     ENDIF                                                            AR567569
178800200529     C                     ELSE                                           S01310
178900200529      *                                                                   S01310
179000200529      **  Read first record of previous message                           S01310
179100200529     C           WDUP      IFEQ 0                                                           AR567569
179200200529     C           KEYD      SETLLMSMSI2LD                                  S01310
179300200529     C                     READ MSMSI2LD                 10               S01310
179400200529     C                     ENDIF                                                            AR567569
179500200529      *                                                                   S01310
179600200529     C                     EXSR VRCD                                      S01310
179700200529      *                                                                   S01310
179800200529      **  Write 'TOF or previous message does not match selection criteria'01310
179900200529     C           *IN10     IFEQ '1'                                       S01310
180000200529     C                     MOVE MSGA,3    SFMG                            S01310
180100200529     C                     SETON                     30                   S01310
180200200529     C                     END                                            S01310
180300200529     C                     END                                            S01310
180400200529      *                                                                   S01310
180500200529      **  If ENTER redisplay subfile                                      S01310
180600200529     C                     ELSE                                           S01310
180700200529     C                     SETON                     10                   S01310
180800200529     C                     END                                            S01310
180900200529     C                     END                                            S01310
181000200529      *                                                                   S01310
181100200529     C                     END                                            S01310
181200200529     C                     END                                            S01310
181300200529      *                                                                   S01310
181400200529     C                     ENDSR                                          S01310
181500200529     C/EJECT                                                              S01310
181600200529      *****************************************************************   S01310
181700200529      *   ENQYE - branch,enquire by date,time                         *   S01310
181800200529      *   Calls - VRCD validate record                                *   S01310
181900200529      *           SFLE format message for display                     *   S01310
182000200529      *   Called by - main process                                    *   S01310
182100200529      *****************************************************************   S01310
182200200529      *                                                                   S01310
182300200529     C           ENQYE     BEGSR                                          S01310
182400200529      *                                                                   S01310
182500200529      **  Open file & read first record                                   S01310
182600200529     C           *IN57     IFEQ '0'                                       S01310
182700200529     C                     OPEN MSMSI2LE                                  S01310
182800200529     C                     SETON                     57                   S01310
182900200529     C                     END                                            S01310
183000200529      *                                                                   S01310
183100200529     C           KEYE      SETLLMSMSI2LE                                  S01310
183200200529     C                     READ MSMSI2LE                 10               S01310
183300200529      *                                                                   S01310
183400200529     C                     EXSR VRCD                                      S01310
183500200529      *                                                                   S01310
183600200529      **  Write 'No records match selection criteria'                     S01310
183700200529     C           *IN10     IFEQ '1'                                       S01310
183800200529     C                     MOVE MSGA,1    SFMG                            S01310
183900200529     C                     SETON                     30                   S01310
184000200529     C                     ELSE                                           S01310
184100200529     C                     Z-ADD0         WDUP                                              AR567569
184200200529      *                                                                   S01310
184300200529      **  Do until F3 or F12 pressed                                      S01310
184400200529     C           *INKC     DOWEQ'0'                                       S01310
184500200529     C           *INKL     ANDEQ'0'                                       S01310
184600200529      *                                                                   S01310
184700200529      **  If new message to process                                       S01310
184800200529     C           *IN10     IFEQ '0'                                       S01310
184900200529      *                                                                   S01310
185000200529      **  Clear subfile                                                   S01310
185100200529     C                     SETOF                     2021                 S01310
185200200529     C                     WRITEMS5015F4                                  S01310
185300200529     C                     SETON                     2021                 S01310
185400200529     C                     Z-ADD1         RRN     50                      S01310
185500200529      *                                                                   S01310
185600200529      **  Move all records which match key into array                     S01310
185700200529     C***********          Z-ADD1         X       40               S01310 CSW095
185800200529     C                     Z-ADD1         X                               CSW095
185900200529     C                     Z-ADD0         WPASS                                             AR567569
186000200529     C                     Z-ADD0         WEOF                                              AR567569
186100200529     C           *IN10     DOWEQ'0'                                       S01310
186200200529      *                                                                   105223
186300200529      **  If "{1:" has been repeated, it's a duplicate message            105223
186400200529     C                     MOVELMDTA      WSTRT   3                       105223
186500200529     C           WSTRT     IFEQ '{1:'                                     105223
186600200529     C           X         ANDNE1                                         105223
186700200529     C                     ADD  1         WDUP                                              AR567569
186800200529     C                     LEAVE                                          105223
186900200529     C                     ELSE                                                             AR567569
187000200529      *                                                                                     AR567569
187100200529     C           WPASS     IFEQ 1                                                           AR567569
187200200529     C                     Z-ADD0         WDUP                                              AR567569
187300200529     C                     ENDIF                                                            AR567569
187400200529     C                     ENDIF                                          105223
187500200529      *                                                                   105223
187600200529     C                     MOVEAMDTA      IMSG,X                          S01310
187700200529     C           KEYE      READEMSMSI2LE                 10               S01310
187800200529     C                     ADD  256       X                               S01310
187900200529     C                     Z-ADD1         WPASS                                             AR567569
188000200529      *                                                                                     AR567569
188100200529     C           *IN10     IFEQ *ON                                                         AR567569
188200200529     C           WDUP      ANDNE0                                                           AR567569
188300200529     C                     ADD  1         WDUP                                              AR567569
188400200529     C                     Z-ADD1         WEOF                                              AR567569
188500200529     C                     ENDIF                                                            AR567569
188600200529     C                     END                                            S01310
188700200529     C                     SETOF                     10                   S01310
188800200529     C                     EXSR SFLE                                      S01310
188900200529     C                     END                                            S01310
189000200529      *                                                                   S01310
189100200529      **  Write Subfile                                                   S01310
189200200529     C                     WRITEMS5015F1                                  S01310
189300200529     C                     EXFMTMS5015F4                                  S01310
189400200529     C                     MOVEL*OFF      *IN10                                             AR567569
189500200529     C                     MOVE *BLANKS   SFMG                            S01310
189600200529     C                     SETOF                     30                   S01310
189700200529      *                                                                   S01310
189800200529      **  If Cmd 8 process next message                                   S01310
189900200529     C           *INKH     IFEQ '1'                                       S01310
190000200529     C           WDUP      IFEQ 0                                                           AR567569
190100200529     C           KEYE      SETGTMSMSI2LE                                  S01310
190200200529     C                     READ MSMSI2LE                 10               S01310
190300200529     C                     ELSE                                                             AR567569
190400200529     C           WEOF      IFEQ 1                                                           AR567569
190500200529     C                     MOVE *ON       *IN10                                             AR567569
190600200529     C                     ENDIF                                                            AR567569
190700200529     C                     ENDIF                                                            AR567569
190800200529      *                                                                   S01310
190900200529     C                     EXSR VRCD                                      S01310
191000200529      *                                                                   S01310
191100200529      **  Write 'EOF or next message does not match selection criteria'   S01310
191200200529     C           *IN10     IFEQ '1'                                       S01310
191300200529     C                     MOVE MSGA,2    SFMG                            S01310
191400200529     C                     SETON                     30                   S01310
191500200529     C                     END                                            S01310
191600200529      *                                                                   S01310
191700200529      **  If Cmd 9 process previous message                               S01310
191800200529     C                     ELSE                                           S01310
191900200529     C           *INKI     IFEQ '1'                                       S01310
192000200529     C           KEYE      SETLLMSMSI2LE                                  S01310
192100200529      *                                                                                     AR567569
192200200529     C           WDUP      IFLE 1                                                           AR567569
192300200529     C                     READPMSMSI2LE                 10               S01310
192400200529     C                     Z-ADD0         WDUP                                              AR567569
192500200529      *                                                                                     AR567569
192600200529     C                     ELSE                                                             AR567569
192700200529     C                     SUB  1         WDUP                                              AR567569
192800200529     C                     Z-ADD0         WCTR                                              AR567569
192900200529      *                                                                                     AR567569
193000200529     C           WCTR      DOWNEWDUP                                                        AR567569
193100200529     C           KEYE      READEMSMSI2LE                 10                                 AR567569
193200200529     C                     ADD  1         WCTR                                              AR567569
193300200529     C                     ENDDO                                                            AR567569
193400200529      *                                                                                     AR567569
193500200529     C           WDUP      IFNE 0                                                           AR567569
193600200529     C                     SUB  1         WDUP                                              AR567569
193700200529     C                     ENDIF                                                            AR567569
193800200529     C                     ENDIF                                                            AR567569
193900200529      *                                                                   S01310
194000200529      **  Write 'TOF or previous message does not match selection criteria'01310
194100200529     C           *IN10     IFEQ '1'                                       S01310
194200200529     C                     MOVE MSGA,3    SFMG                            S01310
194300200529     C                     SETON                     30                   S01310
194400200529     C           WDUP      IFEQ 1                                                           AR567569
194500200529     C           KEYE      SETLLMSMSI2LE                                                    AR567569
194600200529     C           KEYE      READEMSMSI2LE                 10                                 AR567569
194700200529     C                     ENDIF                                                            AR567569
194800200529     C                     ELSE                                           S01310
194900200529      *                                                                   S01310
195000200529      **  Read first record of previous message                           S01310
195100200529     C           WDUP      IFEQ 0                                                           AR567569
195200200529     C           KEYE      SETLLMSMSI2LE                                  S01310
195300200529     C                     READ MSMSI2LE                 10               S01310
195400200529     C                     ENDIF                                                            AR567569
195500200529      *                                                                   S01310
195600200529     C                     EXSR VRCD                                      S01310
195700200529      *                                                                   S01310
195800200529      **  Write 'TOF or previous message does not match selection criteria'01310
195900200529     C           *IN10     IFEQ '1'                                       S01310
196000200529     C                     MOVE MSGA,3    SFMG                            S01310
196100200529     C                     SETON                     30                   S01310
196200200529     C                     END                                            S01310
196300200529     C                     END                                            S01310
196400200529      *                                                                   S01310
196500200529      **  If ENTER redisplay subfile                                      S01310
196600200529     C                     ELSE                                           S01310
196700200529     C                     SETON                     10                   S01310
196800200529     C                     END                                            S01310
196900200529     C                     END                                            S01310
197000200529      *                                                                   S01310
197100200529     C                     END                                            S01310
197200200529     C                     END                                            S01310
197300200529      *                                                                   S01310
197400200529     C                     ENDSR                                          S01310
197500200529     C/EJECT
197600200529      *****************************************************************
197700200529      *   VRCD - validate record                                      *
197800200529      *   Called by - ENQY0 enquire by type,priority,date,time        *
197900200529      *               ENQY1 enquire by type,date,time                 *
198000200529      *               ENQY2 enquire by priority,date,time             *
198100200529      *               ENQY3 enquire by date,time                      *
198200200529      *               ENQYB enquire by branch,type,priority,date,time *   S01310
198300200529      *               ENQYC enquire by branch,type,date,time          *   S01310
198400200529      *               ENQYD enquire by branch,priority,date,time      *   S01310
198500200529      *               ENQYE enquire by branch,date,time               *   S01310
198600200529      *****************************************************************
198700200529      *
198800200529     C           VRCD      BEGSR
198900200529      *
199000200529      **  If message type does not match parameter
199100200529     C           STYP      IFNE *BLANKS
199200200529     C           STYP      ANDNEMTPY
199300200529     C                     SETON                     10
199400200529     C                     END
199500200529      *
199600200529      **  If priority does not match parameter
199700200529     C           SPTY      IFNE *BLANKS
199800200529     C           SPTY      ANDNEMPRY
199900200529     C                     SETON                     10
200000200529     C                     END
200100200529      *
200200200529      **  If start date entered & greater than message output date
200300200529     C           SOSD      IFNE *BLANKS
200400200529      *                                                                   124673
200500200529     C           @OSDC     IFGT MODEC                                     124673
200600200529     C           @OSDC     OREQ MODEC                                     124673
200700200529     C           @OSD      ANDGTMODE
200800200529     C                     SETON                     10
200900200529     C                     ENDIF                                          124673
201000200529      *                                                                   124673
201100200529     C                     END
201200200529      *
201300200529      **  If start date equal to message output date,
201400200529      **  start time entered & greater than message output time
201500200529     C           @OSD      IFEQ MODE
201600200529     C           @OSDC     ANDEQMODEC                                     124673
201700200529     C           SOST      ANDNE*BLANKS
201800200529     C           @OST      ANDGTMOTM
201900200529     C                     SETON                     10
202000200529     C                     END
202100200529      *
202200200529      **  If end date entered & less than message output date
202300200529     C           SOED      IFNE *BLANKS
202400200529      *                                                                   124673
202500200529     C           @OEDC     IFLT MODEC                                     124673
202600200529     C           @OEDC     OREQ MODEC                                     124673
202700200529     C           @OED      ANDLTMODE
202800200529     C                     SETON                     10
202900200529     C                     ENDIF                                          124673
203000200529      *                                                                   124673
203100200529     C                     END
203200200529      *
203300200529      **  If end date equal to message output date,
203400200529      **  end time entered & less than message output time
203500200529     C           @OED      IFEQ MODE
203600200529     C           @OEDC     ANDEQMODEC                                     124673
203700200529     C           SOET      ANDNE*BLANKS
203800200529     C           @OET      ANDLTMOTM
203900200529     C                     SETON                     10
204000200529     C                     END
204100200529      *
204200200529     C           MBIN      IFEQ 'Y'                                       S01310
204300200529     C           SBCH      ANDNE'ALL'                                     S01310
204400200529     C           SBCH      ANDNEBRCA                                      S01310
204500200529     C                     SETON                     10                   S01310
204600200529     C                     END                                            S01310
204700200529      *                                                                   S01310
204800200529     C                     ENDSR
204900200529     C/EJECT
205000200529      *****************************************************************
205100200529      *   SFLE - format message for display                           *
205200200529      *   Called by - ENQY0 enquire by type,priority,date,time        *
205300200529      *               ENQY1 enquire by type,date,time                 *
205400200529      *               ENQY2 enquire by priority,date,time             *
205500200529      *               ENQY3 enquire by date,time                      *
205600200529      *               ENQYB enquire by branch,type,priority,date,time *   S01310
205700200529      *               ENQYC enquire by branch,type,date,time          *   S01310
205800200529      *               ENQYD enquire by branch,priority,date,time      *   S01310
205900200529      *               ENQYE enquire by branch,date,time               *   S01310
206000200529      *****************************************************************
206100200529      *
206200200529     C           SFLE      BEGSR
206300200529      *
206400200529      *                                                                                     MD052122
206500200529      ** Determine starting position of block 1                                             MD052122
206600200529     C                     Z-ADD1         X                                                 MD052122
206700200529     C                     Z-ADD1         WCTR    50                                        MD052122
206800200529     C           IMSG,X    IFEQ ' '                                                         MD052122
206900200529     C           IMSG,X    DOUEQ'{'                                                         MD052122
207000200529     C                     ADD  1         X                                                 MD052122
207100200529     C                     ENDDO                                                            MD052122
207200200529     C                     ENDIF                                                            MD052122
207300200529      **  Analyse message headers using data structure
207400200529     C**********           MOVEAIMSG,1    @HDR  114                                         MD052122
207500200529     C**********           Z-ADD86        X                                                 MD052122
207600200529     C                     MOVEAIMSG,X    @HDR  114                                         MD052122
207700200529      *
207800200529      **  Write basic header (block 1)
207900200529     C                     MOVE HDGA,1    RCD
208000200529     C                     WRITEMS5015F3
208100200529     C                     ADD  1         RRN
208200200529     C                     MOVE HDGA,2    RCD
208300200529     C                     WRITEMS5015F3
208400200529     C                     ADD  1         RRN
208500200529      *
208600200529     C                     MOVE @RAD      ORAD
208700200529     C                     MOVE @SNN      OSNN
208800200529     C                     MOVE @SQN      OSQN
208900200529     C                     MOVE RCD1      RCD
209000200529     C                     WRITEMS5015F3
209100200529     C                     ADD  2         RRN
209200200529      *                                                                                     MD052122
209300200529      ** Determine starting position of block 2                                             MD052122
209400200529     C           IMSG,X    DOUEQ'{'                                                         MD052122
209500200529     C                     ADD  1         X                                                 MD052122
209600200529     C                     ENDDO                                                            MD052122
209700200529     C                     MOVEAIMSG,X    HDR2   85                                         MD052122
209800200529      *
209900200529      **  Write application header (block 2)
210000200529     C                     MOVE HDGA,3    RCD
210100200529     C                     WRITEMS5015F3
210200200529     C                     ADD  1         RRN
210300200529     C                     MOVE HDGA,4    RCD
210400200529     C                     WRITEMS5015F3
210500200529     C                     ADD  1         RRN
210600200529      *
210700200529     C                     MOVE @MTP      OMTP
210800200529     C                     MOVE @ITM      OITM
210900200529     C                     MOVE @MIR      OMIR
211000200529     C                     MOVE @ODT      OODT
211100200529     C                     MOVE @OTM      OOTM
211200200529     C           @MPY      IFEQ 'N'
211300200529     C                     MOVEL'NORMAL'  OPTY
211400200529     C                     ELSE
211500200529     C                     MOVEL'URGENT'  OPTY
211600200529     C                     END
211700200529     C                     MOVE RCD2      RCD
211800200529     C                     WRITEMS5015F3
211900200529     C                     ADD  2         RRN
212000200529      *                                                                                     MD052122
212100200529      ** Determine starting position of block 3                                             MD052122
212200200529     C           IMSG,X    DOUEQ'{'                                                         MD052122
212300200529     C                     ADD  1         X                                                 MD052122
212400200529     C                     ENDDO                                                            MD052122
212500200529     C                     MOVEAIMSG,X    @WK3                                              MD052122
212600200529      *
212700200529      **  If user header present
212800200529     C/COPY WNCPYSRC,MS5015C001
212900200529     C           @WK3      IFEQ '{3:'
213000200529     C                     MOVE *BLANKS   OBPY
213100200529     C                     MOVE *BLANKS   OMUR
213200200529     C/COPY WNCPYSRC,MS5015C007
213300200529     C**********           Z-ADD84        X                                                 MD052122
213400200529     C                     ADD  3         X                                                 MD052122
213500200529      *
213600200529      **  Write user header (block 3)
213700200529     C                     MOVE HDGA,5    RCD
213800200529     C                     WRITEMS5015F3
213900200529     C                     ADD  1         RRN
214000200529     C**********           MOVE HDGA,6    RCD                                               MD052122
214100200529     C/COPY WNCPYSRC,MS5015C009
214200200529     C**********           WRITEMS5015F3                                                    MD052122
214300200529     C**********           ADD  1         RRN                                               MD052122
214400200529     C/COPY WNCPYSRC,MS5015C002
214500200529      *
214600200529      **  If banking priority present
214700200529     C                     MOVEAIMSG,X    @WK5    5
214800200529     C           @WK5      IFEQ '{113:'
214900200529     C                     MOVE HDGA,10   RCD                                               MD052122
215000200529     C                     WRITEMS5015F3                                                    MD052122
215100200529     C                     ADD  1         RRN                                               MD052122
215200200529     C                     ADD  5         X
215300200529     C                     Z-ADD1         Z       30
215400200529     C           IMSG,X    DOUEQ'}'
215500200529     C                     MOVE IMSG,X    LINE,Z
215600200529     C                     ADD  1         X
215700200529     C                     ADD  1         Z
215800200529     C                     END
215900200529     C**********           MOVEALINE      OBPY                                              MD052122
216000200529     C                     MOVEALINE      RCD                                               MD052122
216100200529     C                     WRITEMS5015F3                                                    MD052122
216200200529     C                     ADD  1         RRN                                               MD052122
216300200529     C                     MOVEA*BLANKS   LINE
216400200529     C                     ADD  1         X
216500200529     C                     END
216600200529      *
216700200529      **  If message user reference (MUR) present
216800200529     C           WCTR      DOUEQ6                                                           MD052122
216900200529     C                     MOVEAIMSG,X    @WK5
217000200529     C           @WK5      IFEQ '{108:'
217100200529     C                     MOVE HDGA,11   RCD                                               MD052122
217200200529     C                     WRITEMS5015F3                                                    MD052122
217300200529     C                     ADD  1         RRN                                               MD052122
217400200529     C                     ADD  5         X
217500200529     C                     Z-ADD1         Z
217600200529     C           IMSG,X    DOUEQ'}'
217700200529     C                     MOVE IMSG,X    LINE,Z
217800200529     C                     ADD  1         X
217900200529     C                     ADD  1         Z
218000200529     C                     END
218100200529     C**********           MOVEALINE      OMUR                                              MD052122
218200200529     C                     MOVEALINE      RCD                                               MD052122
218300200529     C                     WRITEMS5015F3                                                    MD052122
218400200529     C                     ADD  1         RRN                                               MD052122
218500200529     C                     MOVEA*BLANKS   LINE
218600200529     C                     ADD  1         X
218700200529     C                     END
218800200529     C/COPY WNCPYSRC,MS5015C008
218900200529      *
219000200529     C**********           MOVE RCD3      RCD                                               MD052122
219100200529     C/COPY WNCPYSRC,MS5015C010
219200200529     C**********           WRITEMS5015F3                                                    MD052122
219300200529     C**********           ADD  2         RRN                                               MD052122
219400200529      *                                                                                     MD052122
219500200529      **  SWIFT 2018                                                                        MD052122
219600200529      *                                                                                     MD052122
219700200529     C                     MOVEAIMSG,X    @WK5                                              MD052122
219800200529     C           @WK5      IFEQ '{119:'                                                     MD052122
219900200529     C                     MOVE HDGA,12   RCD                                               MD052122
220000200529     C                     WRITEMS5015F3                                                    MD052122
220100200529     C                     ADD  1         RRN                                               MD052122
220200200529     C                     ADD  5         X                                                 MD052122
220300200529     C                     Z-ADD1         Z                                                 MD052122
220400200529     C           IMSG,X    DOUEQ'}'                                                         MD052122
220500200529     C                     MOVE IMSG,X    LINE,Z                                            MD052122
220600200529     C                     ADD  1         X                                                 MD052122
220700200529     C                     ADD  1         Z                                                 MD052122
220800200529     C                     ENDDO                                                            MD052122
220900200529     C                     ADD  1         X                                                 MD052122
221000200529     C                     MOVEALINE      RCD                                               MD052122
221100200529     C                     WRITEMS5015F3                                                    MD052122
221200200529     C                     ADD  1         RRN                                               MD052122
221300200529     C                     MOVEA*BLANKS   LINE                                              MD052122
221400200529     C                     ENDIF                                                            MD052122
221500200529      *                                                                                     MD052122
221600200529     C                     MOVEAIMSG,X    @WK5                                              MD052122
221700200529     C           @WK5      IFEQ '{111:'                                                     MD052122
221800200529     C                     MOVE HDGA,13   RCD                                               MD052122
221900200529     C                     WRITEMS5015F3                                                    MD052122
222000200529     C                     ADD  1         RRN                                               MD052122
222100200529     C                     ADD  5         X                                                 MD052122
222200200529     C                     Z-ADD1         Z                                                 MD052122
222300200529     C           IMSG,X    DOUEQ'}'                                                         MD052122
222400200529     C                     MOVE IMSG,X    LINE,Z                                            MD052122
222500200529     C                     ADD  1         X                                                 MD052122
222600200529     C                     ADD  1         Z                                                 MD052122
222700200529     C                     ENDDO                                                            MD052122
222800200529     C                     ADD  1         X                                                 MD052122
222900200529     C                     MOVEALINE      RCD                                               MD052122
223000200529     C                     WRITEMS5015F3                                                    MD052122
223100200529     C                     ADD  1         RRN                                               MD052122
223200200529     C                     MOVEA*BLANKS   LINE                                              MD052122
223300200529     C                     ENDIF                                                            MD052122
223400200529      *                                                                                     MD052122
223500200529     C                     MOVEAIMSG,X    @WK5                                              MD052122
223600200529     C           @WK5      IFEQ '{121:'                                                     MD052122
223700200529     C                     MOVE HDGA,14   RCD                                               MD052122
223800200529     C                     WRITEMS5015F3                                                    MD052122
223900200529     C                     ADD  1         RRN                                               MD052122
224000200529     C                     ADD  5         X                                                 MD052122
224100200529     C                     Z-ADD1         Z                                                 MD052122
224200200529     C           IMSG,X    DOUEQ'}'                                                         MD052122
224300200529     C                     MOVE IMSG,X    LINE,Z                                            MD052122
224400200529     C                     ADD  1         X                                                 MD052122
224500200529     C                     ADD  1         Z                                                 MD052122
224600200529     C                     ENDDO                                                            MD052122
224700200529     C                     ADD  1         X                                                 MD052122
224800200529     C                     MOVEALINE      RCD                                               MD052122
224900200529     C                     WRITEMS5015F3                                                    MD052122
225000200529     C                     ADD  1         RRN                                               MD052122
225100200529     C                     MOVEA*BLANKS   LINE                                              MD052122
225200200529     C                     ENDIF                                                            MD052122
225300200529     C                     ADD  1         WCTR                                              MD052122
225400200529     C                     ENDDO                                                            MD052122
225500200529     C                     ADD  1         RRN                                               MD052122
225600200529      *                                                                                     MD052122
225700200529     C/COPY WNCPYSRC,MS5015C004
225800200529     C                     ADD  6         X
225900200529     C                     END
226000200529     C/COPY WNCPYSRC,MS5015C005
226100200529      *
226200200529      **  Write message text (block 4) headings
226300200529     C                     MOVE HDGA,7    RCD
226400200529     C                     WRITEMS5015F3
226500200529     C                     ADD  1         RRN
226600200529      *
226700200529      **  Do until end of message
226800200529     C           @WK2      DOUEQ'-}'
226900200529     C                     Z-ADD5         Z
227000200529      *
227100200529      **  If tag is present indent by 5 characters
227200200529     C           IMSG,X    IFEQ ':'
227300200529     C                     Z-ADD1         Z
227400200529     C                     END
227500200529      *
227600200529      **  Do until Carriage return/Line feed
227700200529     C           @WK2      DOUEQCRLF
227800200529     C                     MOVE IMSG,X    LINE,Z
227900200529     C                     ADD  1         X
228000200529     C                     ADD  1         Z
228100200529     C                     MOVEAIMSG,X    @WK2    2
228200200529     C                     END
228300200529      *
228400200529      **  Write out detail line
228500200529     C                     MOVEALINE      RCD
228600200529     C                     WRITEMS5015F3
228700200529     C                     ADD  1         RRN
228800200529     C                     MOVEA*BLANKS   LINE
228900200529      *
229000200529     C                     ADD  2         X
229100200529     C                     MOVEAIMSG,X    @WK2
229200200529     C                     END
229300200529      *
229400200529     C                     ADD  2         X
229500200529     C                     MOVEAIMSG,X    @WL3    3
229600200529      *
229700200529      **  If message trailer present
229800200529     C           @WL3      IFEQ '{5:'
229900200529     C                     ADD  4         X
230000200529      **  Write trailer (block 5)
230100200529     C                     ADD  1         RRN
230200200529     C                     MOVE HDGA,8    RCD
230300200529     C                     WRITEMS5015F3
230400200529     C                     ADD  1         RRN
230500200529      *
230600200529     C           @WK2      DOUEQ'}}'
230700200529     C                     Z-ADD1         Z
230800200529      *
230900200529     C           IMSG,X    DOUEQ'}'
231000200529     C                     MOVE IMSG,X    LINE,Z
231100200529     C                     ADD  1         Z
231200200529     C                     ADD  1         X
231300200529     C                     END
231400200529      *
231500200529      **  Write out detail line
231600200529     C                     MOVEALINE      RCD
231700200529     C                     WRITEMS5015F3
231800200529     C                     ADD  1         RRN
231900200529     C                     MOVEA*BLANKS   LINE
232000200529      *
232100200529     C                     MOVEAIMSG,X    @WK2
232200200529     C                     ADD  2         X
232300200529     C                     END
232400200529     C                     END
232500200529      *
232600200529     C                     MOVEAIMSG,X    @WL3
232700200529      *
232800200529      **  If STS trailer present
232900200529     C           @WL3      IFEQ '{S:'
233000200529     C                     ADD  4         X
233100200529      **  Write STS trailer (S block)
233200200529     C                     ADD  1         RRN
233300200529     C                     MOVE HDGA,9    RCD
233400200529     C                     WRITEMS5015F3
233500200529     C                     ADD  1         RRN
233600200529      *
233700200529     C           @WK2      DOUEQ'}}'
233800200529     C                     Z-ADD1         Z
233900200529      *
234000200529     C           IMSG,X    DOUEQ'}'
234100200529     C                     MOVE IMSG,X    LINE,Z
234200200529     C                     ADD  1         Z
234300200529     C                     ADD  1         X
234400200529     C                     END
234500200529      *
234600200529      **  Write out detail line
234700200529     C                     MOVEALINE      RCD
234800200529     C                     WRITEMS5015F3
234900200529     C                     ADD  1         RRN
235000200529     C                     MOVEA*BLANKS   LINE
235100200529      *
235200200529     C                     MOVEAIMSG,X    @WK2
235300200529     C                     ADD  2         X
235400200529     C                     END
235500200529     C                     END
235600200529      *
235700200529     C                     ENDSR
235800200529     C/EJECT
235900200529      *****************************************************************
236000200529      *   *PSSR - error handling                                      *
236100200529      *   Called by - INIT initial process                            *
236200200529      *****************************************************************
236300200529      *
236400200529     C           *PSSR     BEGSR
236500200529      *
236600200529     C                     SETON                     U7U8LR
236700200529     C                     DUMP
236800200529     C                     RETRN
236900200529      *
237000200529     C                     ENDSR
237100200529     C/COPY WNCPYSRC,MS5015C003
237200200529**  Messages
237300200529No records match selection criteria
237400200529EOF or next message does not match selection criteria
237500200529TOF or previous message does not match selection criteria
237600200529**  Headings
237700200529Basic header  (block 1)
237800200529Recipient    Session no  Sequence number                               Branch
237900200529Application header  (block 2)
238000200529Msg type  Input time  MIR                           Output date  Time  Pty
238100200529User header  (block 3)
238200200529Banking priority 113:  M.U.R. 108:
238300200529Text  (block 4)
238400200529Trailer  (block 5)
238500200529STS trailer  (block 6)
238600200529** CPY@   **      OBJECT COPYRIGHT
238700200529(c) Finastra International Limited 2001
238800200529     X/COPY WNCPYSRC,MS5015X001
