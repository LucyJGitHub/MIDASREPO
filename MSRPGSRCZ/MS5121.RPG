     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas - Process Leo Messages')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Midas SWIFT Module                               *
     F*                                                               *
     F*  MS5121 - Process Leo Messages                                *
     F*                                                               *
     F*  Function:  This program was created for the Leo Midas        *
     F*             Integration project. Leo messages are read        *
     F*             from the reference file, and from this, the       *
     F*             Message data is then transferred to the Leo       *
     F*             files.                                            *
     F*                                                               *
     F*  Phases - Leo Input Cycle / Midas Input Cycle                 *
     F*                                                               *
     F*  Called By: CSWU50 - Copy Incoming Leo Messages on the        *
     F*                      Leo files                                *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. S01487             Date 29JUL94               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
     F*  S01487 - Created for Leo Midas Integration                   *
     F*                                                               *
      *****************************************************************
     F*
     FMSIXI2LFIF  E           K        DISK
     FMSMSI2L9IF  E           K        DISK
      *****************************************************************
      *                                                               *
      * ID F  C  H  L    FUNCTION OF INDICATORS                       *
      *       10         EOF on MSIXI2LF                              *
      *       11         Chain fail to MSMSI2L9                       *
      *       U7U8       Database Error                               *
      *****************************************************************
     E                    CPY@    1   1 80               Copyright
     E                    ARR        40256
      /EJECT
      *****************************************************************
      *   MAIN - main process                                         *
      *   Called by -                                                 *
      *****************************************************************
      *
      ** Perform the Initial Processing
     C                     EXSR INIT
      *
      ** Chain the data record with the MIR
     C           MIR       CHAINMSMSI2L9             11
      *
      ** If no Record is found, this is an error, dump and end program
      ** NB LDA not included as this is called from a Leo program
     C           *IN11     IFEQ '1'
     C                     DUMP
     C                     MOVE '*ERROR'  @ERR
     C                     RETRN
     C                     END
      *
     C                     MOVE MIR       MIRX   28
      *
      ** Do while this is still the same record and not end of file
     C           *IN11     DOWEQ'0'
      *
     C                     MOVEAMDTA      ARR,X
      *
      ** Read the next record of the message
     C                     READ MSMSI2L9                 11
     C                     ADD  1         X
      *
      ** Check if this is the same message
     C           MIR       IFNE MIRX
     C                     MOVE '1'       *IN10
     C                     END
      *
     C                     END
      *
     C                     SETON                     LR
      *****************************************************************
      *   INIT - initial process                                      *
      *   Called by - main process                                    *
      *****************************************************************
     C           INIT      BEGSR
      *
     C           *ENTRY    PLIST
     C                     PARM           ARR
     C                     PARM           TYPE    3
     C                     PARM           MIRE   28
     C                     PARM           @ERR    6
      *
     C                     MOVEACPY@      BIS@   80
     C                     Z-ADD1         X       20
      *
      ** Read the first record on LF/MSIXI2LF.
     C           *LOVAL    SETLLMSIXI2LF
     C                     READ MSIXI2LF                 10
     C                     MOVE MTPY      TYPE
     C                     MOVE MIR       MIRE
      *
      ** If no records are found, EOF.
     C           *IN10     IFEQ '1'
     C                     MOVEL'*EOF'    @ERR
     C                     RETRN
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
** CPY@   Object Copyright
(c) Misys International Banking Systems Ltd. 2001
