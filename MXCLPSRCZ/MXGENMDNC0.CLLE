/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI *  TEXT('Midas MX Generate Meridian sub-message')              */
/*********************************************************************/
/*                                                                   */
/*       Midas - System Control Module                               */
/*                                                                   */
/*       MXGENMDNC0- Midas MX Generate Meridian sub-message          */
/*                                                                   */
/*       (c) Finastra International Limited 2004                     */
/*                                                                   */
/*       Last Amend No. MD061841           Date 04Oct23              */
/*       Prev Amend No. MD046248           Date 27Oct17              */
/* Bank Fusion Midas 1.4 Base ---------------------------------------*/
/* Midas Plus 1.4 Base 04 -------------------------------------------*/
/* Midas Plus 1.4 Base ----------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base -----------------------------*/
/*                     BUG2617  *CREATE    Date 20May04              */
/*                                         Date ddmmmyy              */
/*                                                                   */
/*-------------------------------------------------------------------*/
/*                                                                   */
/*       MD061841 - Export a Format to Meridian function is failing  */
/*       MD046248 - Finastra Rebranding                              */
/*       BUG2617- Conversion of MXGENMDN to comply with webfacing.   */
/*                                                                   */
/*********************************************************************/
             PGM
 
/* Declare PGM Variables */
 
             DCL        VAR(&CpyFld)     TYPE(*CHAR) LEN(64) VALUE('(c) +
                               Finastra International Limited +
                               2004')
             DCL        VAR(&USER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&CDATE) TYPE(*CHAR) LEN(6)
             DCL        VAR(&DATE) TYPE(*DEC) LEN(6 0)
             DCL        VAR(&FORMAT) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GENTYPE) TYPE(*CHAR) LEN(11)
/**********  DCL        VAR(&MODE) TYPE(*CHAR) LEN(7) VALUE(COMMAND) */                 /*MD061841*/
             DCL        VAR(&MODE) TYPE(*CHAR) LEN(10) VALUE(COMMAND)                   /*MD061841*/
             DCL        VAR(&TOSTRMFILE) TYPE(*CHAR) LEN(5000)
             DCL        VAR(&RETURNMSG) TYPE(*CHAR) LEN(75)
             DCLF       FILE(MXGENMDNDF)
 
/** Monitor for error messages not trapped in the rest of the **/
/** program.  If they occur, reclaim resources and exit.      **/
 
             MONMSG     MSGID(CPF0000 CPA0000 MCH0000 RPG0000) +
                          EXEC(GOTO CMDLBL(Error))
 
/** Reset job switches. **/
 
             CHGJOB     SWS(XXXXXX00)
 
             RTVJOBA    USER(&USER)
             RTVJOBA    JOB(&WSID) USER(&USER)
             RTVSYSVAL  SYSVAL(QDATE) RTNVAR(&CDATE)
             CHGVAR     VAR(&DATE) VALUE(&CDATE)
             CHGVAR     VAR(&MDNNAM) VALUE('*CALC')
             CHGVAR     VAR(&STRMFL) VALUE('*CALC')
             CHGVAR     VAR(&PREFLD) VALUE('*DFT')
             CHGVAR     VAR(&SUBMSG) VALUE('*SUBMESSAGE')
             CHGVAR     VAR(&TYPMTC) VALUE('Y')
 
 MAIN:
             SNDF       RCDFMT(MXGENMDNF0)
             SNDF       RCDFMT(MXGENMDNF2)
             SNDRCVF    RCDFMT(MXGENMDNF1)
 
             IF         COND(&IN03 *EQ '1') THEN(DO)
              GOTO      CMDLBL(END)
             ENDDO
 
             CHGVAR     VAR(&FORMAT) VALUE(&FMTNAM)
             CHGVAR     VAR(&TOSTRMFILE) VALUE(&STRMFL)
             CHGVAR     VAR(&IN91) VALUE('0')
             CHGVAR     VAR(&IN92) VALUE('0')
             CHGVAR     VAR(&RETURNMSG) VALUE(' ')
 
             CALL       PGM(MXGENMDN_V) PARM(&FORMAT &MDNNAM +
                            &TOSTRMFILE &PREFLD &SUBMSG &MODE +
                            &TYPMTC &RETURNMSG)
 
/**********  IF         COND(&RETURNMSG *NE *BLANK) THEN(DO)         */                 /*MD061841*/
             IF         COND(&RETURNMSG *NE ' ') THEN(DO)                               /*MD061841*/
               CHGVAR     VAR(&ERRMSG) VALUE(&RETURNMSG)
               CHGVAR     VAR(&IN91) VALUE('1')
               CHGVAR     VAR(&IN92) VALUE('1')
               GOTO       CMDLBL(MAIN)
             ENDDO
 
/**********    CALL  PGM(MXGENMDNC1) PARM(&FORMAT &MDNNAM +          */                 /*MD061841*/
/**********               &TOSTRMFILE &PREFLD &GENTYPE &MODE &TYPMTC)*/                 /*MD061841*/
               CALL  PGM(MXGENMDN) PARM(&FORMAT &MDNNAM +
                          &TOSTRMFILE &PREFLD &GENTYPE &MODE &TYPMTC +
                          &RETURNMSG)                                                   /*MD061841*/
/**********  IF         COND(&RETURNMSG *NE *BLANK) THEN(DO)         */                 /*MD061841*/
             IF         COND(&RETURNMSG *NE ' ') THEN(DO)                               /*MD061841*/
               CHGVAR     VAR(&ERRMSG) VALUE(&RETURNMSG)
               CHGVAR     VAR(&IN92) VALUE('1')
               GOTO       CMDLBL(MAIN)
             ENDDO
 
             GOTO      CMDLBL(END)
 
 ERROR:      RCLRSC
             RCLACTGRP  ACTGRP(*ELIGIBLE)
 
 END:
             CHGVAR     VAR(&CpyFld) VALUE('(c) +
                          Finastra International Limited')
             ENDPGM
