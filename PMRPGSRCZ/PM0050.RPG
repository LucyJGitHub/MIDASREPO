     H
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Instrument Groups Maintenance')
/*OVRF*: OVRDBF FILE(PMPGHIXX) TOFILE(PMPGHIPD) SHARE(*NO)          : *   S01486
/*OVRF*: OVRDBF FILE(PMPGDIXX) TOFILE(PMPGDIPD) SHARE(*NO)          : *   S01486
     F********************************************************************
     F*                                                                  *
     F*    Midas PORTFOLIO MANAGEMENT                                *
     F*                                                                  *
     F*    PM0050  - INSTRUMENT GROUPS MAINTENANCE                       *
     F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
     F*                                                                  *S01486
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD027             Date 09Dec05               *
      *                 CLE025             Date 20Oct03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 080199             Date 19Dec94               *
      *                 S01486             Date 26Jul94               *
     F*                 R00300             DATE 13AUG90                  *
     F*                                                                  *
     F********************************************************************
     F*                                                               *  *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE025 - Credit Lines (Recompile)                            *
     F*  080199 - Initialise return code of AO to blanks.             *
     F*    S01486  -  Portfolio Management Upgrade to R10             *  *S01486
     F*    R00300  -  Message file changes.                           *  *
     F*                                                               *  *
     F********************************************************************
     F*                                                               *  *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*/*OVRF*: OVRDBF FILE(PMPGHIXX) TOFILE(PMPGHIPP) SHARE(*NO)   : *   S01486
     F*/*OVRF*: OVRDBF FILE(PMPGDIXX) TOFILE(PMPGDIPP) SHARE(*NO)   : *   S01486
     F*                                                               *
     F*****************************************************************
     F**SDBANKPDIF  E           K        DISK                             S01486
     F***PREFIX*:*BJ*                                                     S01486
     F**                                            KINFSR *PSSR          S01486
     F**PMPGHIPPUF  E           K        DISK         KCOMIT       A      S01486
     FPMPGHIPDUF  E           K        DISK         KCOMIT       A        S01486
     F** PREFIX : PF
     F                                              KINFDS INFDS
     F                                              KINFSR *PSSR
     FPMPGHIXXIF  E           K        DISK
     F** PREFIX : PF
     F            PMPGHIP0                          KRENAMEPMPGHIPX
     F                                              KINFSR *PSSR
     F**PMPGHIZZUF  E                    DISK         KCOMIT              S01486
     FPMPGHIPAUF  E                    DISK         KCOMIT                S01486
     F** PREFIX : PF
     F                                              KINFSR *PSSR
     F**PMPGDIPPUF  E           K        DISK         KCOMIT       A      S01486
     FPMPGDIPDUF  E           K        DISK         KCOMIT       A        S01486
     F***PREFIX*:*PG                                                      S01486
     F** PREFIX : GB                                                      S01486
     F                                              KINFSR *PSSR
     FPMPGDIXXIF  E           K        DISK
     F***PREFIX*:*PG                                                      S01486
     F** PREFIX : GB                                                      S01486
     F            PMPGDIP0                          KRENAMEPMPGDIPX
     F                                              KINFSR *PSSR
     F**SDPLINPDIF**E           K        DISK                             S01486
     F****REFIX***PD                                                      S01486
     F**************                                KINFSR *PSSR          S01486
     F**PM0050DDCF  E                    WORKSTN                          S01486
     FPM0050DFCF  E                    WORKSTN                            S01486
     F** PREFIX : DD
     F                                        RRN   KSFILE PM0050S0
     F                                        RRN2  KSFILE PM0050S1
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       07         #P1002 START  SCREEN
     F*       08         #P1003 REVIEW SCREEN
     F*       09         #P1004 UPDATE SCREEN
     F*
     F*       15         INDICATOR USED ON WRITE/UPDATE OPS TO CONDITION
     F*                                    CALL OF INFSR
     F*
     F*       25         ROLLUP
     F*       26         ROLLDOWN
     F*
     F*       30         S/PM0050C1  POSITION CURSOR
     F*       31         S/PM0050C1  ERROR
     F*       32         S/PM0050C1  PROTECT DETAIL FIELDS
     F*       33         S/PM0050C1  SFLCLR
     F*       35         S/PM0050S1  SFLNXTCHG
     F*       36         S/PM0050S1  ERROR - DDINNR
     F*       37         S/PM0050S1  PROTECT FIELD - DDINNR
     F*       40         S/PM0050S0  ERROR - DDACTN
     F*       41         S/PM0050C0  SFLDSP
     F*       42         S/PM0050C0  SFLDSPCTL
     F*       43         S/PM0050C0  SFLEND
     F*       44         S/PM0050C0  ROLLDOWN NOT ALLOWED
     F*       45         S/PM0050F1  PROTECT/NON-DISPLAY KEY FIELDS
     F*       46         S/PM0050F1  ERROR - DDPKEY
     F*       47         S/PM0050F1  ERROR - DDACTN
     F*       48         S/PM0050F1  ERROR - DDINTG
     F*       49         VLDCMDKY    INDICATOR FOR DISPLAY FILE
     F*
     F*       60         ADD RECORD
     F*
     F*       69         FILE OPERATIONS INDICATOR
     F*       70         FILE OPERATIONS INDICATOR
     F*       72         FILE OPERATIONS INDICATOR
     F*       73         FILE OPERATIONS INDICATOR
     F*       74         FILE OPERATIONS INDICATOR
     F*       75         ERROR
     F*       76         USED TO CHECK IF AT LEAST 1 RECORD IS ENTERED
     F*       77         REVIEW FROM SCREEN SELECTED
     F*
     F*       98         DATE FORMAT = MMDDYY
     F*       99         WORK
     F*
     F*                Unused indicators
     F*                -----------------
     F*       01  02  03  04  05  06  ..  ..  ..  10
     F*       11  12  13  14  ..  16  17  18  19  20
     F*       21  22  23  24  ..  ..  27  28  29  ..
     F*       ..  ..  ..  34  ..  ..  ..  38  39  ..
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..  50
     F*       51  52  53  54  55  56  57  58  59  ..
     F*       61  62  63  64  65  66  67  68  ..  ..
     F*       71  ..  ..  ..  ..  ..  ..  78  79  80
     F*       81  82  83  84  85  86  87  88  89  90
     F*       91  92  93  94  95  96  97  ..  ..
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F*       'WWAID' VALUES USED
     F*
     F*       03         CA3
     F*       10         CA10
     F*       12         CA12
     F*       RA         ENTER PRESSED
     F*       UP         ROLLUP
     F*       DN         ROLLDOWN
     F*       HP         HELP PRESSED
     E*=========================================================================
     E                    CPY@    1   1 80
     I*
     I**GRPREC****E*DSPMPGHIPP                                            S01486
     IGRPREC    E DSPMPGHIPD                                              S01486
     I              PFINTG                          PFK1
     I**DETRE*****E*DSPMPGDIPP                                            S01486
     IDETREC    E DSPMPGDIPD                                              S01486
     I**************PGINTG                          PGK1                  S01486
     I**************PGINNR                          PGK2                  S01486
     I              GBINTG                          PGK1                  S01486
     I              GBINNR                          PGK2                  S01486
     I** DS TO INITIALIZE A RECORD
     I*
     I** KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
     I*
     ISCRCTL      DS
     I                                        1   1 WWREVW
     I                                        2   2 DDACTN
     I                                        3   4 DDINTG
     I                                        5   6 DDPKEY
     I                                        7   8 WWPAG1
     I                                        9  10 WWPAG2
     I*
     I** DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     IINFDS       DS
     I                                     *STATUS  STATUS
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     I**LDA*****   UDS                            256                     S01486
     I**********                            132 183 DBLOT                 S01486
     I**********                            132 141 DBFILE                S01486
     ILDA         DS                            256                       S01486
     I                                      134 183 DBLOT                 S01486
     I                                      134 141 DBFILE                S01486
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I** DATA STRUCTURE FOR ZTNLU1
     I*
     I*    MIDAS 'Next Available Transaction No.' Data Area  MNATN .
     IDNATN       DS                              5
     I                                        1   50FNATN
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I*
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     IPSDS       SDS
     I                                      244 253 WSID                  S01486
     I                                      254 263 USID                  S01486
     I**
     I** DATA STRUCTURE FOR LAST UPDATE
     I**
     I            DS
     I                                        1   20WWDLUP
     I                                        3   5 WWMLUP
     I                                        6   70WWYLUP
     I                                        1   7 WWHLUP
     I            DS                                                      S01486
     I                                        1   3 WWINTP                S01486
     I                                        1   1 WWINN1                S01486
     I                                        2   2 WWINN2                S01486
     I                                        3   3 WWINN3                S01486
     I**
     ISDBANK    E DSSDBANKPD                                              S01486
     I** EXTERNAL DS FOR BANK DETAILS                                     S01486
     ISDPLIN    E DSSDPLINPD                                              S01486
     I** EXTERNAL DS FOR INSTRUMENT DETAILS                               S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     IRUNDT       DS                                                      S01486
      **  DATA AREA RUNDAT                                                S01486
     I                                        1   7 RUNA                  S01486
     I                                    P   8  100RUND                  S01486
     I                                       11  11 SSF                   S01486
     I                                       12  12 DATF                  S01486
     I                                       13  13 MBIN                  S01486
     IZMUSER      DS                             17                       S01486
     I** DATA AREA OF MENU USER                                           S01486
     I                                       11  13 USRBCH                S01486
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I**
     C*================================================================
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO PMPGDIPP
     C*
     C           WWSUBK    KLIST
     C                     KFLD           DDINTG
     C                     KFLD           WWINNR
     C*
     C**  DEFINE WORK FIELDS
     C*
     C************LIKE     DEFN PGTNLU    WWTNLU                          S01486
     C************LIKE     DEFN PGINNR    WWINNR                          S01486
     C           *LIKE     DEFN GBTNLU    WWTNLU                          S01486
     C           *LIKE     DEFN GBINNR    WWINNR                          S01486
     C           *LIKE     DEFN SFLRRN    WWRRN
     C           *LIKE     DEFN SFLRRN    WWSAVR
     C           *LIKE     DEFN SFLRRN    WWZONE
     C           *LIKE     DEFN SFLRRN    RRN2
     C           *LIKE     DEFN SFLRRN    RRN
     C           *LIKE     DEFN SFLRRN    WWSAVE           *FIX
     C           *LIKE     DEFN DDACTN    WWACTN           *FIX
     C*================================================================
      /EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR #INIT                      INITIALIZE
     C*
     C** D O    U N T I L   C K 3   O R   E R R O R
     C*
     C           WWAID     DOUEQ'03'
     C*
     C           *IN07     CASEQ'1'       #P1002           START SCREEN
     C*
     C           *IN08     CASEQ'1'       #P1003           REVIEW SCREEN
     C*
     C           *IN09     CASEQ'1'       #P1004           UPDATE SCREEN
     C*
     C                     END
     C*
     C                     END
     C*
     C** TERMINATE PROGRAM
     C*
     C                     SETON                         LR
     C*================================================================
     C*  P R O G R A M     E N D
     C*================================================================
      /EJECT
     C*================================================================
      ** INDEX OF SUBROUTINES
      **
      ** #INIT    INITIALISATION OF STANDARD FIELDS,
      **          ACCESS OF STANDING DATA
      **
      ** #P1002   OUTPUT AND PROCESS KEY FIELDS SCREEN
      **
      ** #P1003   PROCESS SUBFILE SELECTION SCREEN
      **
      ** #P1004   PROCESS DETAIL SCREEN AND UPDATE FILE
      **
      ** #P1005   UPDATE FILE RECORDS
      **
      ** #P1006   PROCESS UPDATE OF DETAILS FILE
      **
      ** #DETV    VALIDATE DETAIL SCREEN
      **
      ** #INITF   INITIALISATION OF SUBFILE FIELDS
      **
      ** #READ    FILL THE SUBFILE WITH FILE DETAILS
      **
      ** #SUBI    INITIALIZE DETAILS SUBFILE
      **
      ** #UPWS    PROCESS UPDATE BY ANOTHER WORKSTATION
      **
      ** #VCMD    MOVE APPROPRIATE VALUES INTO WWAID
      **
      ** #VFLD    VALIDATE KEY FIELDS
      **
      ** ZTNLU1   ACCESS DATAAREA FOR NEXT TRANSACTION NO.
      **
      ** ZASNMS   SENDS MESSAGE TO PROGRAM MESSAGE QUEUE.
      **
      ** *PSSR    FILE ERROR HANDLING S/R
      **
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** #INIT SR - TO INITIALISE STATIC FIELDS AND ACCESS STANDING DATA
      ** CALLED ONCE AT START OF PROGRAM FROM MAIN LINE
      ** CALLS NO OTHER ROUTINES
      **
     C*================================================================
     C*
     C           #INIT     BEGSR                           ** #INIT BSR **
     C*
     C                     MOVEL'*'       DDPGMQ
     C*                                                                   R00300
     C**   Select the program MSGQ for error msg.                         R00300
     C                     MOVEL'*'       TOPQ                            R00300
     C                     MOVEL'*PRV'    TOPRQ                           R00300
     C*                                                                   R00300
     C**   Fill in fields for subroutine ZASNMS                           R00300
     C                     MOVEL*BLANK    ZAPGM  10        Message queue  R00300
     C                     MOVEL'PMUSRMSG'ZAMSGF 10        Message file   R00300
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue      R00300
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.    R00300
     C                     MOVEL*BLANK    ZAMSDA132        Message data.  R00300
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.  R00300
      ***  Copyright Statement.                                           S01486
     C                     MOVEACPY@      ACT@   80                       S01486
     C**                                                                  S01486
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01486
     C                     IN   RUNDT                                     S01486
     C           *NAMVAR   DEFN           ZMUSER                          S01486
     C                     IN   ZMUSER                                    S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C*
     C** PREPARE LDA
     C*
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM0050'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C** PREPARE COMIT TEXT
     C*
     C                     MOVEL'PM'      MDID
     C                     MOVEL'PM0050'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C**
     C**
     C**  SET UP PARAMETER TO RETRIEVE MESSAGE FROM MESSAGE FILE
     C           PLLANG    PLIST
     C                     PARM           MSMBR4  7
     C                     PARM           MSGER  10
     C                     PARM           MSGTXT 80
     C***********          MOVEL'MLGBMSGF'MSGER                           S01486
     C                     MOVEL'PMUSRMSG'MSGER                           S01486
     C*
     C** GET INSTALLATION CONTROL DATA RECORD 1
     C*
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE 'SDBANKPD'DBFILE           ***************S01486
     C                     Z-ADD1         DBASE            * DB ERROR 01 *S01486
     C                     MOVELWWOPTN    DBKEY            ***************S01486
     C                     MOVELWWOPTN    DBOPTN  7                       S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C************         READ SDBANKPD                 74               S01486
     C************                                                        S01486
     C************IN74     IFEQ '0'                                       S01486
     C*
     C** IF FOUND CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
     C*
     C           BJDFIN    IFEQ 'M'                        MMDDYY, 98 ON
     C                     MOVE '1'       *IN98
     C                     END                                            S01486
     C***********                                                         S01486
     C***OTHERWISE DB ERROR                                               S01486
     C***********                                                         S01486
     C***********          ELSE                            ***************S01486
     C***********          Z-ADD1         DBASE            **DB ERROR 01**S01486
     C***********          MOVEL'SDBANKPD'DBFILE           ***************S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          END                                            S01486
     C*
     C** PROCEED TO START SCREEN
     C*
     C***********          MOVELBJMRDT    DDRUNA                          S01486
     C                     MOVE '1'       *IN07
     C*
     C           E#INIT    ENDSR                           ** #INIT  ESR *
     C*===================================================================
      /EJECT
     C*===================================================================
      ** #P1002      :       S/R TO OUTPUT AND PROCESS KEY FIELDS SCREEN
      ** CALLED FROM :       MAIN PROCESSING #INIT
      ** CALLS       :       #VFLD   TO VALIDATE KEY FIELDS IF ENTERED
      **                     #SUBI   TO INITIALIZE THE SUBFILE
      **                     #READ   TO FILL IN THE SUBFILE
      **                     #VCMD   MOVES APPROPRIATE VALUES INTO WWAID
     C*===================================================================
     C*
     C           #P1002    BEGSR                           ** #P1002 SR **
     C*
     C** INITIALISE SCREEN DATA
     C*
     C                     MOVE '0'       *IN07
     C                     MOVE '0'       *IN47
     C                     MOVE '0'       *IN48
     C                     MOVE '0'       *IN46
     C                     MOVE '0'       *IN77
     C                     MOVEL*BLANK    SCRCTL
     C                     MOVEL'PM90001' MSMBR4
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    DDINFO
     C                     Z-ADD9999      WWSAVE
     C                     MOVE *BLANKS   DDDELT
     C*
     C** CLEAR WHOLE SCREEN
     C*
     C                     WRITEPM0050F3
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           WWAID     DOUEQ'03'
     C           *IN07     OREQ '1'
     C           *IN08     OREQ '1'
     C           *IN09     OREQ '1'
     C*
     C** S T A R T   S C R E E N     O U T P U T
     C*
     C                     MOVEL*BLANK    DDGNAR
     C                     WRITEPM0050F2
     C                     EXFMTPM0050F1
     C                     MOVE '0'       *IN75
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**   Initialise screen input MSGQ                                   R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ   10                       R00300
     C                     PARM           TOPRQ   5                       R00300
     C*
     C** Call S/R to move values into WWAID
     C*
     C                     EXSR #VCMD
     C*
     C** ENTER TAKEN VALIDATE KEY INPUT
     C*
     C           WWAID     IFEQ 'RA'
     C                     EXSR #VFLD
     C*
     C** IF NO ERRORS, DETERMINE NEXT SCREEN
     C*
     C           *IN75     IFEQ '0'
     C*
     C** IF ACTION CODE IS BLANK, NEXT SCREEN IS #P1003 SCREEN,
     C** OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
     C           DDACTN    IFEQ *BLANK
     C                     MOVE '1'       *IN08
     C                     ELSE
     C                     MOVE '1'       *IN09
     C                     MOVEL*BLANKS   WWINNR
     C                     EXSR #SUBI
     C           DDINTG    SETLLPMPGDIXX
     C                     EXSR #READ
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           ** #P1002 ESR *
     C*================================================================
      /EJECT
     C*================================================================
      ** #P1003 S/R TO PROCESS SUBFILE SELECTION SCREEN
      ** CALLED FROM MAIN PROCESSING
      ** CALLS: #VFLD  TO VALIDATE KEY FIELDS IF SUBFILE RECORD SELECTED
      **        #SUBI  TO INITIALIZE THE SUBFILE
      **        #READ  TO FILL IN THE SUBFILE
      **        #VCMD  MOVES APPROPRIATE VALUES INTO WWAID
     C*================================================================
     C*
     C           #P1003    BEGSR                           ** #P1003 BSR**
     C*
     C                     MOVE '0'       *IN08
     C                     MOVE '1'       *IN77
     C*
     C** SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C                     MOVEL'RA'      WWAID   2
     C                     MOVEL*BLANK    DDGNAR
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           WWAID     DOUEQ'03'
     C           *IN07     OREQ '1'
     C           *IN08     OREQ '1'
     C           *IN09     OREQ '1'
     C*
     C** R E B U I L D   S U B F I L E
     C*
     C           WWAID     IFEQ 'DN'
     C           WWAID     OREQ 'UP'
     C           WWAID     OREQ 'RA'
     C*
     C** WRITE CONTROL RECORD
     C*
     C                     MOVE '0'       *IN41
     C                     MOVE '0'       *IN42
     C                     MOVE '0'       *IN43
     C                     Z-ADD*ZERO     RRN
     C                     WRITEPM0050C0
     C                     MOVE '1'       *IN44
     C*
     C** SET FILE POINTER - PAGE BACK
     C*
     C           WWAID     IFEQ 'DN'
     C                     MOVEL*BLANK    DDINTG
     C                     MOVEL*BLANK    WWPAG2
     C           DDINTG    SETLLPMPGHIPX
     C*
     C** OTHERWISE        - PAGE FORWARD
     C*
     C                     ELSE
     C*
     C           *IN75     IFEQ '0'                        *FIX
     C                     MOVELDDPKEY    DDINTG
     C                     MOVELDDPKEY    WWPAG2
     C                     ELSE                            *FIX
     C                     MOVELWWPAG2    DDINTG           *FIX
     C                     END                             *FIX
     C*
     C           DDINTG    SETLLPMPGHIPX
     C                     END
     C*
     C** READ IN GROUPS - FILL UP SUBFILE
     C*
     C           RRN       DOUEQ11
     C           *IN43     OREQ '1'
     C                     MOVE '0'       *IN40            *FIX
     C                     MOVEL*BLANK    DDACTN           *FIX
     C*
     C** READ GROUPS UNTIL SUBFILE PAGE IS FULL
     C*
     C                     READ PMPGHIPX                 43
     C*
     C           *IN43     IFEQ '0'
     C*
     C** IF RECORD IS DELETED, FLAG IT AS SO ON SCREEN
     C*
     C           PFRECI    IFEQ '*'
     C                     MOVEL'D'       DDSTAT  1
     C                     ELSE
     C                     MOVEL*BLANK    DDSTAT
     C                     END
     C*
     C                     MOVE PFINTG    DDINTG
     C                     MOVE PFINGN    DDINGN
     C                     ADD  1         RRN            44
     C*
     C           RRN       IFEQ WWSAVE                     *FIX
     C                     MOVELWWACTN    DDACTN           *FIX
     C                     MOVE '1'       *IN40            *FIX
     C                     END                             *FIX
     C*
     C                     WRITEPM0050S0
     C*
     C** RECORD NOW WRITTEN TO SUBFILE
     C*
     C                     END
     C*
     C** PAGE NOW FULL (OR EOF)
     C*
     C                     END
     C*
     C** READ ONE MORE RECORD FOR NEXT SCREEN
     C*
     C           *IN43     IFEQ '0'
     C                     READ PMPGHIPX                 43
     C                     END
     C*
     C** IF NOT EOF SET NEXT 'REVIEW FROM' KEY ELSE SET IT TO BLANK
     C*
     C           *IN43     IFEQ '0'
     C                     MOVELPFINTG    DDPKEY
     C                     ELSE
     C                     MOVEL*BLANK    DDPKEY
     C                     END
     C*
     C** FOR SUBFILE CONTROL
     C*
     C           *IN44     IFEQ '1'
     C                     MOVE '0'       *IN41
     C                     MOVE '1'       *IN42
     C                     MOVE '0'       *IN43
     C                     ELSE
     C                     MOVE '1'       *IN41
     C                     MOVE '1'       *IN42
     C                     END
     C*
     C                     END
     C*
     C** R E V I E W   S C R E E N     O U T P U T
     C*
     C                     MOVEL'PM90002' MSMBR4
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    DDINFO
     C                     WRITEPM0050F2
     C                     WRITEPM0050F1
     C                     EXFMTPM0050C0
     C                     MOVE '0'       *IN75
     C                     Z-ADD0         WWSAVE           *FIX
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**  Clear program message queue.                                    R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ                            R00300
     C                     PARM           TOPRQ                           R00300
     C*
     C** Call S/R to move values into WWAID
     C*
     C                     EXSR #VCMD
     C*
     C** CK12- INITIAL SCREEN
     C*
     C           WWAID     IFEQ '12'
     C                     MOVE '1'       *IN07
     C                     END
     C*
     C** ENTER PRESSED, PROCESS RECORD SELECTION
     C*
     C           WWAID     IFEQ 'RA'
     C                     MOVE '1'       *IN73
     C*
     C           *IN44     IFEQ '0'
     C                     READCPM0050S0                 73
     C                     END
     C*
     C** R E C O R D   S E L E C T   V A L I D A T I O N
     C*
     C           *IN73     IFEQ '0'
     C                     EXSR #VFLD
     C*
     C** NO ERRORS, #P1004 SCREEN CAN BE PROCESSED NEXT
     C*
     C           *IN75     IFEQ '0'
     C                     MOVE '1'       *IN09
     C                     MOVEL'Y'       WWREVW
     C                     MOVE DDPKEY    WWPAG1
     C                     MOVE *BLANKS   DDPKEY
     C                     EXSR #SUBI
     C           DDINTG    SETLLPMPGDIXX
     C                     EXSR #READ
     C                     ELSE
     C                     MOVELDDACTN    WWACTN           *FIX
     C                     Z-ADDRRN       WWSAVE           *FIX
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           ** #P1003 ESR *
     C*===================================================================
      /EJECT
     C*===================================================================
      ** #P1004      :      S/R TO PROCESS DETAIL SCREEN AND UPDATE FILE
      ** CALLED FROM :      MAIN PROCESSING
      ** CALLS       :      #DETV  VALIDATE DETAILS
      **                    #P1005 UPDATE FILES
      **                    #READ  FILL THE SUBFILE (ROLLUP)
      **                    #VCMD  MOVE APPROPRIATE VALUES INTO WWAID
      **                    #INITF INITIALIZE SUBFILE FIELDS
     C*===================================================================
     C*
     C           #P1004    BEGSR                           ** #P1004 BSR**
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C** POSITION CURSOR
     C*
     C                     MOVE '1'       *IN45
     C                     MOVE '0'       *IN09
     C                     MOVE '1'       *IN30
     C                     MOVE '0'       *IN31
     C*
     C** ACCESS FILE RECORD FOR OLD TNLU TO CHECK AT UPDATE TIME
     C** IF NO RECORD PRESENTLY ON FILE, ZEROISE STORED TNLU
     C*
     C                     Z-ADD*ZERO     WWTNLU
     C           DDINTG    CHAINPMPGHIPX             74
     C*
     C           *IN74     IFEQ '0'
     C                     Z-ADDPFTNLU    WWTNLU
     C                     END
     C*
     C** IF INSERT (NEW OR OVER DELETED RECORD) INITIALIZE SUBFILE FIELDS
     C*
     C           DDACTN    IFEQ 'I'
     C                     EXSR #INITF
     C                     END
     C*
     C** IF DELETED RECORD-ENQUIRY ONLY (RECI IS SET TO BLANK FOR INSERTS)
     C*
     C           PFRECI    IFEQ '*'
     C                     MOVEL'DELETED' DDDELT
     C                     ELSE
     C                     MOVEL*BLANK    DDDELT
     C                     END
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C                     MOVELPFINGN    DDGNAR
     C*
     C** IF DELETE/ENQUIRY PROTECT FIELD INPUT ON S/PM0050C1
     C*
     C           DDACTN    IFEQ 'D'
     C           DDACTN    OREQ 'E'
     C                     MOVE '1'       *IN32
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           WWAID     DOUEQ'03'
     C           *IN07     OREQ '1'
     C           *IN08     OREQ '1'
     C           *IN09     OREQ '1'
     C*
     C** L O A D    U  P    I N F O M E S S A G E S
     C*
     C           DDACTN    IFNE 'D'
     C                     MOVEL'PM90003' MSMBR4
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    DDINFO
     C                     ELSE
     C                     MOVEL'PM90004' MSMBR4
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    DDINFO
     C                     END
     C*
     C** D E T A I L   S C R E E N     O U T P U T
     C*
     C                     WRITEPM0050F2
     C                     WRITEPM0050F1
     C*
     C** RESTORE SUBFILE CHANGES IF ERROR
     C*
     C           *IN75     IFEQ '1'
     C                     MOVE '0'       *IN70
     C                     END
     C**
     C                     EXFMTPM0050C1
     C                     MOVE '0'       *IN75
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**   Initialise screen input MSGQ                                   R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ                            R00300
     C                     PARM           TOPRQ                           R00300
     C*
     C** Call S/R to move values into WWAID
     C*
     C                     EXSR #VCMD
     C*
     C** CK12- INITIAL SCREEN
     C*
     C           WWAID     IFEQ '12'
     C                     MOVE '1'       *IN07
     C                     END
     C*
     C** ROLL UP
     C*
     C           WWAID     IFEQ 'UP'
     C                     EXSR #READ
     C                     END
     C*
     C** V A L I D A T E   D E T A I L   S C R E E N   I N P U T
     C*
     C           WWAID     IFNE '03'
     C           WWAID     ANDNE'12'
     C           WWAID     ANDNE'UP'
     C                     EXSR #DETV
     C*
     C** N O    D E T A I L   S C R E E N    E R R O R S
     C*
     C           *IN75     IFEQ '0'
     C           WWAID     ANDEQ'RA'
     C*
     C** DETERMINE WHAT SCREEN TO RETURN TO
     C*
     C           WWREVW    IFEQ 'Y'
     C                     MOVELWWPAG2    DDPKEY
     C                     MOVE '1'       *IN08
     C                     ELSE
     C                     MOVE '1'       *IN07
     C                     END
     C*
     C**     U  P  D  A  T  E      F  I  L  E  S
     C*
     C           DDACTN    IFEQ 'I'
     C           DDACTN    OREQ 'A'
     C           DDACTN    OREQ 'D'
     C                     EXSR #P1005
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** RESET PROTECT/NON-DISPLAY INDS
     C*
     C                     MOVE '0'       *IN45
     C                     MOVE '0'       *IN32
     C*
     C                     ENDSR                           ** #P1004 ESR *
     C*================================================================
      /EJECT
     C*================================================================
      ** #P1005      :        S/R TO UPDATE FILE RECORDS
      ** CALLED FROM :        #P1004
      ** CALLS       :        ZTNLU1 , *PSSR , #DETV , #UPWS , #P1006
      **
     C*=========================================================================
     C           #P1005    BEGSR                           ** #P1005 BSR**
     C*
     C**  U P D A T E   F I L E S
     C*
     C** RETRIEVE NEXT TRANSACTION NUMBER
     C*
     C                     EXSR ZTNLU1
     C*
     C**  I  N  S  E  R  T  S
     C*
     C           DDACTN    IFEQ 'I'
     C           DDINTG    CHAINPMPGHIP0             60
     C*
     C** RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C           *IN60     IFEQ '0'
     C           PFTNLU    ANDNEWWTNLU
     C                     EXSR #UPWS
     C                     GOTO E#P5
     C                     END
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     MOVEL'D'       PFRECI
     C                     MOVELDDINTG    PFINTG
     C                     MOVELDDGNAR    PFINGN
     C                     Z-ADDBJRDNB    PFLCD
     C                     MOVE BJMRDT    WWHLUP
     C                     Z-ADDWWDLUP    PFDLUP
     C                     MOVE WWMLUP    PFMLUP
     C                     Z-ADDWWYLUP    PFYLUP
     C                     TIME           PFTLUP
     C                     MOVEL'I'       PFCHTP
     C                     MOVELNATN      PFTNLU
     C*
     C           *IN60     IFEQ '1'
     C                     WRITEPMPGHIP0               15
     C                     END
     C*
     C** TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
     C*
     C           *IN15     IFEQ '1'
     C           STATUS    ANDEQ01021
     C           DDINTG    CHAINPMPGHIPX             15
     C*
     C           *IN15     IFEQ '0'
     C                     EXSR #UPWS
     C                     GOTO E#P5
     C                     END
     C*
     C                     END
     C*
     C           *IN15     IFEQ '1'
     C                     EXSR *PSSR
     C                     END
     C*
     C           *IN60     IFEQ '0'
     C                     UPDATPMPGHIP0
     C                     END
     C*
     C                     END
     C*
     C**   A  M  E  N  D  S
     C*
     C           DDACTN    IFEQ 'A'
     C           DDINTG    CHAINPMPGHIP0             60
     C*
     C** RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C           *IN60     IFEQ '0'
     C           PFTNLU    ANDNEWWTNLU
     C                     EXSR #UPWS
     C                     GOTO E#P5
     C                     END
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C** IF RECORD UPDATED THE SAME DAY THEN LET 'I' IN CHANGE TYPE
     C*
     C           BJRDNB    IFEQ PFLCD
     C                     MOVEL'I'       PFCHTP
     C                     ELSE
     C                     MOVEL'A'       PFCHTP
     C                     END
     C*
     C                     MOVELDDGNAR    PFINGN
     C                     Z-ADDBJRDNB    PFLCD
     C                     MOVE BJMRDT    WWHLUP
     C                     Z-ADDWWDLUP    PFDLUP
     C                     MOVE WWMLUP    PFMLUP
     C                     Z-ADDWWYLUP    PFYLUP
     C                     TIME           PFTLUP
     C                     MOVELNATN      PFTNLU
     C*
     C           *IN60     IFEQ '0'
     C                     UPDATPMPGHIP0
     C                     END
     C*
     C                     END
     C*
     C**  D  E  L  E  T  E  S
     C*
     C           DDACTN    IFEQ 'D'
     C           DDINTG    CHAINPMPGHIP0             60
     C*
     C** RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C           PFTNLU    IFNE WWTNLU
     C                     EXSR #UPWS
     C                     GOTO E#P5
     C                     END
     C*
     C                     MOVEL'*'       PFRECI
     C                     Z-ADDBJRDNB    PFLCD
     C                     MOVELBJMRDT    WWHLUP
     C                     Z-ADDWWDLUP    PFDLUP
     C                     MOVELWWMLUP    PFMLUP
     C                     Z-ADDWWYLUP    PFYLUP
     C                     TIME           PFTLUP
     C                     MOVEL'D'       PFCHTP
     C                     MOVELNATN      PFTNLU
     C*
     C           *IN60     IFEQ '0'
     C                     UPDATPMPGHIP0
     C                     END
     C*
     C                     END
     C*
     C** PROCESS DETAILS FILE
     C*
     C                     EXSR #P1006
     C*
     C** GET AUDIT RECORD
     C*
     C***********1         CHAINPMPGHIZZ             74                   S01486
     C           1         CHAINPMPGHIPA             74                   S01486
     C*
     C** UPDATE AUDIT RECORD IF FOUND
     C*
     C           *IN74     IFEQ '0'
     C*
     C** FOR INSERT, UPDATE NO. OF LIVE RECORDS
     C*
     C           DDACTN    IFEQ 'I'
     C                     ADD  1         PFNORE
     C                     END
     C*
     C** FOR DELETIONS, UPDATE NO. OF LIVE RECS
     C*
     C           DDACTN    IFEQ 'D'
     C                     SUB  1         PFNORE
     C                     END
     C*
     C** FORMAT COMIT TEXT
     C*
     C                     TIME           MTIME
     C                     MOVELDDACTN    ACTNX
     C*
     C** UPDATE AUDIT RECORD
     C*
     C                     UPDATPMPGHIZ0
     C*
     C** C  O  M  I  T
     C*
     C           CMTTXT    COMIT
     C*
     C** AUDIT RECORD NOT FOUND: DATABASE ERROR
     C*
     C                     ELSE
     C           *LOCK     IN   LDA                                       S01486
     C*
     C                     Z-ADD2         DBASE            ***************
     C************         MOVEL'PMPGH'   DBFILE           **DB ERROR 02**S01486
     C                     MOVEL'PMPGHIPA'DBFILE           **DB ERROR 02**S01486
     C                     MOVEL'AUDIT'   DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C           E#P5      ENDSR                           ** #P1005 ESR *
     C*=========================================================================
      /EJECT
     C*=========================================================================
     C** #P1006      :      S/R  TO SAVE DETAILS ENTERED
     C** CALLED FROM :      #P1005
     C** CALLS       :
     C**========================================================================
     C           #P1006    BEGSR                           ** #P1006 BSR **
     C*
     C           DDACTN    IFEQ 'I'
     C                     READCPM0050S1                 69
     C*
     C           *IN69     DOWEQ'0'
     C*
     C           DDINNR    IFNE ' '
     C*
     C** INITIALIZE DETAILS FILE FIELD
     C*
     C                     MOVELDDINNR    WWINNR
     C***********WWSUBK    CHAINPMPGDIPP             70                   S01486
     C           WWSUBK    CHAINPMPGDIPD             70                   S01486
     C*
     C** IF RECORD IS FOUND INITIALIZE IT TO OVERWRITE
     C*
     C           *IN70     IFEQ '0'
     C***********          MOVE *BLANKS   PGRECI                          S01486
     C***********          MOVE *BLANKS   PGINNR                          S01486
     C***********          MOVE *BLANKS   PGINTG                          S01486
     C***********          MOVE *BLANKS   PGMLUP                          S01486
     C***********          MOVE *BLANKS   PGCHTP                          S01486
     C                     MOVE *BLANKS   GBRECI                          S01486
     C                     MOVE *BLANKS   GBINNR                          S01486
     C                     MOVE *BLANKS   GBINTG                          S01486
     C                     MOVE *BLANKS   GBMLUP                          S01486
     C                     MOVE *BLANKS   GBCHTP                          S01486
     C                     END
     C*
     C************         MOVE 'D'       PGRECI                          S01486
     C************         MOVELDDINTG    PGINTG                          S01486
     C************         MOVELDDINNR    PGINNR                          S01486
     C************         Z-ADDBJRDNB    PGLCD                           S01486
     C                     MOVE 'D'       GBRECI                          S01486
     C                     MOVELDDINTG    GBINTG                          S01486
     C                     MOVELDDINNR    GBINNR                          S01486
     C                     Z-ADDBJRDNB    GBLCD                           S01486
     C                     MOVE BJMRDT    WWHLUP
     C************         Z-ADDWWDLUP    PGDLUP                          S01486
     C************         MOVE WWMLUP    PGMLUP                          S01486
     C************         Z-ADDWWYLUP    PGYLUP                          S01486
     C************         TIME           PGTLUP                          S01486
     C************         MOVEL'I'       PGCHTP                          S01486
     C************         Z-ADD1         PGTNLU                          S01486
     C                     Z-ADDWWDLUP    GBDLUP                          S01486
     C                     MOVE WWMLUP    GBMLUP                          S01486
     C                     Z-ADDWWYLUP    GBYLUP                          S01486
     C                     TIME           GBTLUP                          S01486
     C                     MOVEL'I'       GBCHTP                          S01486
     C                     Z-ADD1         GBTNLU                          S01486
     C*
     C           *IN70     IFEQ '0'
     C                     UPDATPMPGDIP0
     C                     ELSE
     C                     WRITEPMPGDIP0
     C                     END
     C*
     C                     END
     C*
     C                     READCPM0050S1                 69
     C                     END
     C*
     C                     END
     C*
     C** IF NEW KEY INSERTED WAS A DELETED ONE
     C** DELETE ALL DETAILS RECORDS WITH '*' RECORD-ID
     C*
     C                     MOVEL*BLANKS   WWINNR
     C                     MOVE '0'       *IN70
     C***********WWSUBK    SETLLPMPGDIPP                                  S01486
     C           WWSUBK    SETLLPMPGDIPD                                  S01486
     C*
     C           *IN70     DOWEQ'0'
     C***********DDINTG    READEPMPGDIPP                 70               S01486
     C           DDINTG    READEPMPGDIPD                 70               S01486
     C*
     C           *IN70     IFEQ '0'
     C*
     C***********PGRECI    IFEQ '*'                                       S01486
     C           GBRECI    IFEQ '*'                                       S01486
     C                     DELETPMPGDIP0
     C                     END
     C*
     C                     ELSE
     C                     MOVE '1'       *IN70
     C                     END
     C*
     C                     END
     C*
     C** AMEND
     C*
     C           DDACTN    IFEQ 'A'
     C***********          MOVE DDINTG    PGINTG                          S01486
     C                     MOVE DDINTG    GBINTG                          S01486
     C                     READCPM0050S1                 69
     C*
     C           *IN69     DOWEQ'0'
     C*
     C           DDDTTK    IFNE ' '
     C                     MOVELDDDTTK    WWINNR
     C                     ELSE
     C                     MOVE DDINNR    WWINNR
     C                     END
     C*
     C***********WWSUBK    CHAINPMPGDIPP             70                   S01486
     C           WWSUBK    CHAINPMPGDIPD             70                   S01486
     C*
     C           *IN70     IFEQ '0'
     C*
     C           DDINNR    IFEQ ' '
     C                     DELETPMPGDIP0
     C                     ELSE
     C*
     C***********BJRDNB    IFNE PGLCD                                     S01486
     C***********          MOVE 'A'       PGCHTP                          S01486
     C           BJRDNB    IFNE GBLCD                                     S01486
     C                     MOVE 'A'       GBCHTP                          S01486
     C                     END
     C*
     C***********          MOVE DDINNR    PGINNR                          S01486
     C***********          Z-ADDBJRDNB    PGLCD                           S01486
     C                     MOVE DDINNR    GBINNR                          S01486
     C                     Z-ADDBJRDNB    GBLCD                           S01486
     C                     MOVE BJMRDT    WWHLUP
     C***********          Z-ADDWWDLUP    PGDLUP                          S01486
     C***********          MOVE WWMLUP    PGMLUP                          S01486
     C***********          Z-ADDWWYLUP    PGYLUP                          S01486
     C***********          TIME           PGTLUP                          S01486
     C***********          MOVELNATN      PGTNLU                          S01486
     C                     Z-ADDWWDLUP    GBDLUP                          S01486
     C                     MOVE WWMLUP    GBMLUP                          S01486
     C                     Z-ADDWWYLUP    GBYLUP                          S01486
     C                     TIME           GBTLUP                          S01486
     C                     MOVELNATN      GBTNLU                          S01486
     C                     UPDATPMPGDIP0
     C                     END
     C*
     C                     ELSE
     C*
     C           DDINNR    IFNE ' '
     C************         MOVE 'D'       PGRECI                          S01486
     C************         MOVE 'I'       PGCHTP                          S01486
     C************         Z-ADDBJRDNB    PGLCD                           S01486
     C                     MOVE 'D'       GBRECI                          S01486
     C                     MOVE 'I'       GBCHTP                          S01486
     C                     Z-ADDBJRDNB    GBLCD                           S01486
     C                     MOVE BJMRDT    WWHLUP
     C************         Z-ADDWWDLUP    PGDLUP                          S01486
     C************         MOVE WWMLUP    PGMLUP                          S01486
     C************         Z-ADDWWYLUP    PGYLUP                          S01486
     C************         TIME           PGTLUP                          S01486
     C************         MOVELNATN      PGTNLU                          S01486
     C************         MOVE DDINNR    PGINNR                          S01486
     C                     Z-ADDWWDLUP    GBDLUP                          S01486
     C                     MOVE WWMLUP    GBMLUP                          S01486
     C                     Z-ADDWWYLUP    GBYLUP                          S01486
     C                     TIME           GBTLUP                          S01486
     C                     MOVELNATN      GBTNLU                          S01486
     C                     MOVE DDINNR    GBINNR                          S01486
     C                     WRITEPMPGDIP0
     C                     END
     C*
     C                     END
     C*
     C                     READCPM0050S1                 69
     C                     END
     C*
     C                     END
     C*
     C** DELETE DETAILS FILE
     C*
     C           DDACTN    IFEQ 'D'
     C***********          MOVEL*BLANKS   PGINTG                          S01486
     C***********          MOVEL*BLANKS   PGINNR                          S01486
     C                     MOVEL*BLANKS   GBINTG                          S01486
     C                     MOVEL*BLANKS   GBINNR                          S01486
     C                     MOVE '0'       *IN72
     C***********WWSUBK    SETLLPMPGDIPP                                  S01486
     C           WWSUBK    SETLLPMPGDIPD                                  S01486
     C*
     C           *IN72     DOWEQ'0'
     C***********DDINTG    READEPMPGDIPP                 72               S01486
     C           DDINTG    READEPMPGDIPD                 72               S01486
     C*
     C           *IN72     IFEQ '0'
     C************         MOVE '*'       PGRECI                          S01486
     C************         MOVE 'D'       PGCHTP                          S01486
     C************         Z-ADDBJRDNB    PGLCD                           S01486
     C                     MOVE '*'       GBRECI                          S01486
     C                     MOVE 'D'       GBCHTP                          S01486
     C                     Z-ADDBJRDNB    GBLCD                           S01486
     C                     MOVE BJMRDT    WWHLUP
     C************         Z-ADDWWDLUP    PGDLUP                          S01486
     C************         MOVE WWMLUP    PGMLUP                          S01486
     C************         Z-ADDWWYLUP    PGYLUP                          S01486
     C************         TIME           PGTLUP                          S01486
     C************         MOVELNATN      PGTNLU                          S01486
     C                     Z-ADDWWDLUP    GBDLUP                          S01486
     C                     MOVE WWMLUP    GBMLUP                          S01486
     C                     Z-ADDWWYLUP    GBYLUP                          S01486
     C                     TIME           GBTLUP                          S01486
     C                     MOVELNATN      GBTNLU                          S01486
     C                     UPDATPMPGDIP0
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                            ** #P1006 ESR**
     C*=========================================================================
      /EJECT
     C*=========================================================================
      ** #DETV       :       S/R - TO VALIDATE DETAIL SCREEN
      ** CALLED FROM :       #P1004
      ** CALLS       :   ZASNMS - Send message to program message queue
     C*================================================================
     C           #DETV     BEGSR                           ** #DETV  BSR**
     C*
     C** RESET SCREEN ERROR INDICATORS
     C*
     C                     MOVE '0'       *IN30
     C                     MOVE '0'       *IN31
     C                     MOVE '0'       *IN33
     C                     Z-ADD1         SFLRRN
     C                     Z-ADD0         WWCONT  50
     C                     MOVE 'N'       WWERRF  1
     C*
     C** ENTER KEY PRESSSED
     C*
     C           WWAID     IFEQ 'RA'
     C*
     C** IF ACTION = D WITH ENTER PRESSED THEN ERROR
     C*
     C           DDACTN    IFEQ 'D'
     C                     MOVE '1'       *IN75
     C*********************MOVEL'PM05300' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05300' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C** ACTION = I OR A
     C*
     C           DDACTN    IFEQ 'I'                        - B2
     C           DDACTN    OREQ 'A'
     C*
     C** VALIDATION OF FIELDS FOR INSERT/AMEND
     C*
     C** CHECK THAT DDGNAR IS VALID
     C*
     C           DDGNAR    IFEQ *BLANK                     - B3
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN30
     C                     MOVE '1'       *IN31
     C*********************MOVEL'PM05200' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05200' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END                             - E3
     C*
     C                     MOVE '0'       *IN76
     C                     MOVELDDGNAR    DDINGN
     C                     END                             - E2
     C*
     C** CHECK IF ENTRIES OF SUBFILE VALID
     C*
     C           *IN70     DOWEQ'0'                        - B2
     C           DDACTN    ANDNE'D'
     C           DDACTN    ANDNE'E'
     C                     MOVE '0'       *IN36
     C*
     C** SET SUBFILE ERROR INDICATOR
     C           *IN75     IFEQ '1'
     C           WWERRF    ANDEQ'N'
     C           DDGNAR    ANDNE*BLANKS
     C                     Z-ADDWWCONT    SFLRRN
     C                     MOVE 'Y'       WWERRF
     C                     END
     C*
     C                     ADD  1         WWCONT
     C*
     C                     READCPM0050S1                 70
     C*
     C           *IN70     IFEQ '0'                        - B3
     C*
     C** IN AMEND MODE CHECK IF NEW DETAILS ENTERED
     C** AND INCREMENT RECORD COUNTER
     C*
     C           DDACTN    IFEQ 'A'                        - B4
     C*
     C** COUNT RECORDS IN AMEND MODE
     C*
     C           DDDTTK    IFEQ ' '                        - B5
     C           DDINNR    ANDNE' '
     C                     ADD  1         WWZONE
     C                     END                             - E5
     C*
     C           DDDTTK    IFNE ' '
     C           DDINNR    ANDEQ' '
     C                     SUB  1         WWZONE
     C                     END
     C*
     C                     END                             - E4
     C*
     C**  ACCESS SDPLINPP TO VERIFY IF THE GROUP CODE EXISTS
     C*
     C           DDINNR    IFNE *BLANK                     - B4
     C                     MOVE '1'       *IN76
     C                     MOVELDDINNR    WWINTP                          S01486
     C                     CALL 'AOPLINR0'                                S01486
     C***********          PARM '*MSG    'WWRTCD  7                S01486 080199
     C                     PARM '       ' WWRTCD  7                       080199
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM DDINNR    WWKEY   3                       S01486
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01486
     C**                                                                  S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C***********DDINNR    CHAINSDPLINP0             74                   S01486
     C***********                                                         S01486
     C************IN74     IFEQ '1'                        - B5           S01486
     C           PDRECI    OREQ '*'
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN36
     C*********************MOVEL'PM05202' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05202' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C** IF REQUEST WAS SELECTION PROGRAM SEND BACK SUBFILE               S01486
     C*                                                                   S01486
     C           WWINN1    IFEQ '?'                                       S01486
     C           WWINN2    OREQ '?'                                       S01486
     C           WWINN3    OREQ '?'                                       S01486
     C                     MOVE '1'       *IN75                           S01486
     C                     END                                            S01486
     C                     MOVELPDINNR    DDINNR                          S01486
     C                     MOVELPDISTN    DDISTN                          S01486
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     MOVE '1'       *IN35
     C                     UPDATPM0050S1
     C                     ELSE                            - X3
     C*
     C** CHECK IF DETAILS ENTERED
     C** ONE RECORD MUST BE FILLED (*IN76 ON IF OK)
     C*
     C           *IN76     IFEQ '0'                        - B4
     C           *IN75     ANDEQ'0'
     C*
     C           DDACTN    IFEQ 'I'                        - B5
     C           DDACTN    OREQ 'A'
     C           WWZONE    ANDLE0
     C           1         CHAINPM0050S1             99
     C*
     C** IF ACTION = I WITHOUT SUBFILE CHANGE, THE GROUP MUST BE A DELETED ONE.
     C*
     C           DDINNR    IFNE *BLANK                     - B6
     C           DDACTN    ANDEQ'I'
     C                     MOVE '1'       *IN76
     C                     ELSE
     C                     MOVE '1'       *IN35
     C                     MOVE '1'       *IN36
     C                     MOVE *BLANKS   DDISTN
     C                     MOVE *BLANKS   DDDTTL
     C*
     C           WWZONE    IFEQ 0
     C                     ADD  1         WWZONE
     C                     END
     C*
     C                     UPDATPM0050S1
     C                     MOVE '1'       *IN75
     C*********************MOVEL'PM05201' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05201' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** ENTER KEY NOT PRESSSED
     C*
     C                     ELSE
     C*
     C** COMMAND 10 TAKEN CORRECTLY WHEN ACTION IS D-FORCE 'RECORD ADVANCE'
     C** OTHERWISE,COMMAND 10 TAKEN INCORRECTLY WHEN ACTION IS NOT D - ERROR
     C*
     C           WWAID     IFEQ '10'
     C*
     C           DDACTN    IFEQ 'D'
     C                     MOVEL'RA'      WWAID
     C                     ELSE
     C                     MOVE '1'       *IN75
     C*********************MOVEL'PM05301' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05301' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C*=========================================================================
      /EJECT
     C**========================================================================
     C** #INITF      :      S/R  TO INITIALIZE ALL FIELDS OF SUBFILE
     C** CALLED FROM :      #P1004
     C** CALLS       :
     C**========================================================================
     C           #INITF    BEGSR                           ** #INITFBSR**
     C*
     C                     MOVEL*BLANK    GRPREC
     C                     MOVEL*BLANK    DETREC
     C                     MOVE *BLANK    WWHLUP
     C*
     C                     Z-ADD*ZERO     PFTNLU
     C                     Z-ADD*ZERO     PFLCD
     C*
     C                     ENDSR                           ** #INITF ESR**
     C*=========================================================================
      /EJECT
     C*=========================================================================
      ** #READ       :      S/R TO FILL THE SUBFILE
      ** CALLED FROM :      #P1002,  #P1003, #P1004
      ** CALLS       :
     C*=========================================================================
     C           #READ     BEGSR                            ** #READ BSR**
     C*
     C           DDACTN    IFEQ 'E'
     C           DDACTN    OREQ 'D'
     C                     MOVE '1'       *IN37
     C                     ELSE
     C                     MOVE '0'       *IN37
     C                     END
     C*
     C** RESTORE RECORD NUMBER
     C*
     C                     Z-ADDWWSAVR    RRN2
     C*
     C** RESTORE ERROR INDICATORS
     C*
     C                     MOVE '0'       *IN36
     C                     MOVE '0'       *IN69
     C*
     C                     Z-ADD0         WWRRN
     C                     Z-ADDRRN2      SFLRRN
     C*
     C           WWRRN     DOUEQ11
     C           DDINTG    READEPMPGDIXX                 69
     C*
     C           *IN69     IFEQ '0'
     C***********PGRECI    ANDEQ'D'                                       S01486
     C           GBRECI    ANDEQ'D'                                       S01486
     C           *IN69     OREQ '0'
     C           DDACTN    ANDEQ'E'
     C*
     C**  ACCESS SDPLINPP TO GET THE GROUP NAME DETAIL
     C*
     C                     CALL 'AOPLINR0'                                S01486
     C                     PARM *BLANK    WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM GBINNR    WWKEY   3                       S01486
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01486
     C**                                                                  S01486
     C           WWRTCD    IFEQ *BLANKS                                   S01486
     C********** PGINNR    CHAINSDPLINP0             69                   S01486
     C*
     C************IN69     IFEQ '0'                                       S01486
     C************         MOVELPGINNR    DDINNR                          S01486
     C************         MOVELPGINNR    DDDTTK                          S01486
     C************         MOVELPDISTN    DDISTN                          S01486
     C************         MOVELPDISTN    DDDTTL                          S01486
     C                     MOVELGBINNR    DDINNR                          S01486
     C                     MOVELGBINNR    DDDTTK                          S01486
     C                     MOVELPDISTN    DDISTN                          S01486
     C                     MOVELPDISTN    DDDTTL                          S01486
     C                     ADD  1         WWRRN
     C                     WRITEPM0050S1
     C                     ADD  1         RRN2
     C                     ADD  1         WWZONE
     C                     END
     C*
     C                     ELSE
     C                     MOVE *BLANK    DDFLAG
     C                     MOVE *BLANKS   DDINNR
     C                     MOVE *BLANKS   DDDTTK
     C                     MOVE *BLANKS   DDISTN
     C                     MOVE *BLANKS   DDDTTL
     C                     ADD  1         WWRRN
     C                     WRITEPM0050S1
     C                     ADD  1         RRN2
     C                     END
     C*
     C                     END
     C*
     C** SAVE SUBFILE RECORD NUMBER
     C*
     C                     Z-ADDRRN2      WWSAVR
     C*
     C** READ EXTRA RECORD TO CHECK FOR EOF
     C           *IN69     IFEQ '0'
     C           DDINTG    READEPMPGDIXX                 69
     C*
     C** IF NOT EOF POSITION '+' AT END OF SUBFILE PAGE
     C*
     C           *IN69     IFEQ '0'
     C                     MOVE '0'       *IN34
     C***********          MOVE PGINNR    WWINNR                          S01486
     C                     MOVE GBINNR    WWINNR                          S01486
     C           WWSUBK    SETLLPMPGDIXX
     C                     ELSE
     C                     MOVE '1'       *IN34
     C                     END
     C*
     C                     ELSE
     C                     MOVE '1'       *IN34
     C                     END
     C*
     C** ON INSERT OR AMEND '+' SHOULD ALWAYS BE OUTPUT
     C           DDACTN    IFEQ 'I'
     C           DDACTN    OREQ 'A'
     C                     MOVE '0'       *IN34
     C                     END
     C*
     C                     ENDSR                            ** #READ ESR**
     C*================================================================
      /EJECT
     C*================================================================
     C** #SUBI       :    S/R TO INITIALIZE DETAILS SUBFILE
     C** CALLED FROM :    #P1002, #P1003
     C** CALLS       :
     C**========================================================================
     C           #SUBI     BEGSR                           ** #SUBI  BSR  **
     C*
     C** CLEAR SUBFILE
     C*
     C                     MOVE '1'       *IN33
     C                     WRITEPM0050C1
     C                     MOVE '0'       *IN33
     C*
     C** INITIALIZE SUBFILE RECORD NUMBER
     C*
     C                     MOVE '0'       *IN70
     C                     MOVE '0'       *IN75
     C                     MOVE '0'       *IN76
     C                     Z-ADD1         RRN2
     C                     Z-ADD1         WWSAVR
     C                     Z-ADD1         SFLRRN
     C                     Z-ADD0         WWZONE
     C*
     C                     ENDSR                           ** #SUBI  ESR  **
     C*=========================================================================
      /EJECT
     C*=========================================================================
      ** #UPWS       :       S/R TO PROCESS UPDATE BY ANOTHER WORKSTATION
      ** CALLED FROM :       #P1005
      ** CALLS       :  ZASNMS - Sends message to program message queue
     C*=========================================================================
     C           #UPWS     BEGSR                           ** #UPWS  BSR**
     C*
     C                     ROLBK
     C                     MOVE '1'       *IN07
     C                     MOVE '0'       *IN08
     C                     MOVE '0'       *IN09
     C                     MOVE '1'       *IN75
     C*********************MOVEL'PM05302' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05302' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C*
     C                     ENDSR                           ** #UPWS  ESR**
     C*=========================================================================
      /EJECT
     C**========================================================================
      ** #VCMD       :  S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD WWAID,
      **                DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.
      ** CALLED FROM :  #P1002, #P1003, #P1004
      ** CALLS       :
     C*================================================================
     C*
     C           #VCMD     BEGSR                           ** #VCMD  BSR **
     C*
     C** If ENTER pressed, the VLDCMDKEY indicator will be off
     C*
     C           *IN49     IFEQ '0'
     C                     MOVE 'RA'      WWAID
     C                     END
     C*
     C** If F3
     C*
     C           *INKC     IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     MOVE '0'       *INKC
     C                     END
     C*
     C** If F10
     C*
     C           *INKJ     IFEQ '1'
     C                     MOVE '10'      WWAID
     C                     MOVE '0'       *INKJ
     C                     END
     C*
     C** If F12
     C*
     C           *INKL     IFEQ '1'
     C                     MOVE '12'      WWAID
     C                     MOVE '0'       *INKL
     C                     END
     C*
     C** If ROLLUP pressed
     C*
     C           *IN25     IFEQ '1'
     C                     MOVE 'UP'      WWAID
     C                     MOVE '0'       *IN25
     C                     END
     C*
     C** If ROLLDOWN pressed
     C*
     C           *IN26     IFEQ '1'
     C                     MOVE 'DN'      WWAID
     C                     MOVE '0'       *IN26
     C                     END
     C*
     C                     ENDSR                           ** #VCMD  ESR *
     C*================================================================
      /EJECT
     C*================================================================
      ** #VFLD       :    S/R TO VALIDATE KEY FIELDS
      ** CALLED FROM :    #P1002,  #P1003
      ** CALLS       :  ZASNMS - Sends message to program message queue
     C*================================================================
     C*
     C           #VFLD     BEGSR                           ** #VFLD  BSR *
     C*
     C** RESET ERROR INDICATORS
     C** SET ERROR ARRAY COUNTER TO ZERO
     C*
     C                     MOVE '0'       *IN47
     C                     MOVE '0'       *IN48
     C                     MOVE '0'       *IN46
     C*
     C** A C T I O N    C O D E    I N P U T - MUST BE BLANK,I,A,E,D
     C*
     C           DDACTN    IFNE *BLANK
     C           DDACTN    ANDNE'I'
     C           DDACTN    ANDNE'A'
     C           DDACTN    ANDNE'E'
     C           DDACTN    ANDNE'D'
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN47
     C*********************MOVEL'PM05100' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05100' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C** USER SHOULD BE AUTHORISED TO ACTION CODE                         S01486
     C           DDACTN    IFNE *BLANK                                    S01486
     C*                                                                   S01486
     C** WHEN SINGLE BRANCH                                               S01486
     C           MBIN      IFNE 'Y'                                       S01486
     C*                                                                   S01486
     C                     CALL 'ZVACTU'                                  S01486
     C                     PARM DDACTN    @ZACTN  1                       S01486
     C                     PARM           @ERR    10                      S01486
     C           @ERR      IFNE *ZERO                                     S01486
     C                     MOVEL'PM02000' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN47                           S01486
     C                     MOVE '1'       *IN75                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C** WHEN MULTI-BRANCH                                                S01486
     C                     CALL 'ZVACTBU'                                 S01486
     C                     PARM DDACTN    @ZACTN  1                       S01486
     C                     PARM USRBCH    @ZBR    3                       S01486
     C                     PARM           @ERR    10                      S01486
     C           @ERR      IFNE *ZERO                                     S01486
     C                     MOVEL'PM02000' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN47                           S01486
     C                     MOVE '1'       *IN75                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C*
     C** C H E C K   K E Y  F I E L D S
     C*
     C** ACTION CODE BLANK BUT KEY INPUT
     C*
     C           DDACTN    IFEQ *BLANK
     C           DDINTG    ANDNE*BLANK
     C                     MOVE '1'       *IN75
     C*
     C           WWSAVE    IFEQ 9999
     C                     MOVE '1'       *IN47
     C*********************MOVEL'PM05101' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05101' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C                     END
     C*
     C** ACTION CODE INPUT BUT KEY BLANK OR NOT
     C*
     C           DDACTN    IFNE *BLANK
     C           DDINTG    ANDEQ*BLANK
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN48
     C*********************MOVEL'PM05106' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05106' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C** THE TWO CHARACTERS IF INSTRUMENT GROUP, IF ENTERED, MUST BE FILLED
     C*
     C           DDINTG    IFNE *BLANK
     C                     MOVE DDINTG    WWTES1  1
     C                     MOVELDDINTG    WWTES2  1
     C           WWTES1    IFEQ *BLANK
     C           WWTES2    OREQ *BLANK
     C*********************MOVEL'PM05108' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05108' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN48
     C                     END
     C                     END
     C*
     C** IF ACTION CODE D SYSTEM SETUP FLAG MUST BE OFF
     C*
     C           DDACTN    IFEQ 'D'
     C           BJSUC     ANDEQ'Y'
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN47
     C*********************MOVEL'PM05102' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05102' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C           *IN75     IFNE '1'
     C*
     C** A C T I O N    C O D E    I
     C*
     C           DDACTN    IFEQ 'I'
     C           DDINTG    CHAINPMPGHIPX             74
     C*
     C           *IN74     IFEQ '0'
     C           PFRECI    ANDEQ'*'
     C                     SETON                     74
     C                     END
     C*
     C           *IN74     IFEQ '0'
     C           DDINTG    OREQ *BLANK
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN48
     C*********************MOVEL'PM05103' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05103' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C                     END
     C*
     C** A C T I O N    C O D E    A , D
     C*
     C           DDACTN    IFEQ 'A'
     C           DDACTN    OREQ 'D'
     C           DDINTG    CHAINPMPGHIPX             74
     C*
     C           *IN74     IFEQ '0'
     C           PFRECI    ANDEQ'*'
     C                     SETON                     74
     C                     END
     C*
     C           *IN74     IFEQ '1'
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN48
     C*********************MOVEL'PM05104' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05104' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C                     END
     C*
     C** A C T I O N    C O D E    E
     C*
     C           DDACTN    IFEQ 'E'
     C           DDINTG    CHAINPMPGHIPX             74
     C*
     C           *IN74     IFEQ '1'
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN48
     C*********************MOVEL'PM05105' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05105' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** IF ACTION CODE OR INSTR. GROUP ENTERED REVIEW FROM MUST BE BLANK
     C*
     C           DDPKEY    IFNE *BLANK
     C           *IN77     ANDNE'1'
     C*
     C           DDACTN    IFNE *BLANK
     C           DDINTG    ORNE *BLANK
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN46
     C*********************MOVEL'PM05107' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM05107' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                            ** #VFLD ESR **
     C*=========================================================================
      /EJECT
     C**========================================================================
     C**  ZTNLU1     :       TO LOCK THE TRANSACTION NUMBER DATA AREA,
     C**                     ACCESS THE NEXT AVAILABLE TRANSACTION NUMBER,
     C**                     THEN UPDATE AND RELEASE THE DATA AREA.
      ** CALLED FROM :       #P1005
      ** CALLS       :
     C*=========================================================================
     C           ZTNLU1    BEGSR                            ** ZTNLU1 BSR**
     C*
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C*
     C                     ENDSR                            ** ZTNLU1 ESR**
     C*****************************************************************
      /EJECT
     C*****************************************************************   R00300
     C*                                                               *   R00300
     C* ZASNMS   - Send message to program message queue              *   R00300
     C*                                                               *   R00300
     C* CALLS    Y2SNMSGC                                             *   R00300
     C*                                                               *   R00300
     C* CALLED BY  #DETV  - Validate detail screen.                   *   R00300
     C*            #UPWS  - To process update by another workstation. *   R00300
     C*            #VFLD  - Validate key fields.                      *   R00300
     C*                                                               *   R00300
     C*****************************************************************   R00300
     C           ZASNMS    BEGSR                                          R00300
     C*                                                                   R00300
     C                     CALL 'Y2SNMGC'                                 R00300
     C                     PARM           ZAPGM            Program queue  R00300
     C                     PARM           ZAPGRL           Rel queue      R00300
     C                     PARM           ZAMSID           Message Id.    R00300
     C                     PARM           ZAMSGF           Message file.  R00300
     C                     PARM           ZAMSDA           Message data.  R00300
     C                     PARM           ZAMSTP           Message type.  R00300
     C*                                                                   R00300
     C** Clear all fields for default mechanism next time.                R00300
     C                     MOVEL*BLANK    ZAPGM            Message queue  R00300
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      R00300
     C                     MOVEL*BLANK    ZAMSDA           Message data.  R00300
     C                     MOVEL*BLANK    ZAMSTP           Message type.  R00300
     C*                                                                   R00300
     C           ZASNM9    ENDSR                           ZASNM9 TAG     R00300
     C*                                                                   R00300
     C*=========================================================================
      /EJECT
     C*=========================================================================
      ** *PSSR       :      FILE EXCEPTION ERROR HANDLING SUBROUTINE
      ** CALLED FROM :      #INIT,  #P1005
      ** CALLS       :
     C*=========================================================================
     C           *PSSR     BEGSR                            ** *PSRR BSR**
     C*
     C** ROLL BACK CHANGES , DUMP AND RETURN TO THE CALLING PROGRAM
     C*
     C                     SETON                     LRU7U8
     C                     DUMP
     C                     ROLBK
     C                     CALL 'DBERRCTL'                                S01486
     C                     RETRN
     C*
     C                     ENDSR                            ** *PSRR ESR**
     C*=========================================================================
**  CPY@
(c) Finastra International Limited 2001
