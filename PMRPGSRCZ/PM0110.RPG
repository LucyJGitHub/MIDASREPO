     H
      *****************************************************************
/*OVR *  OVRDBF FILE(PMPORTXX) TOFILE(PMPORTPD) SHARE(*NO)            *   S01486
/*OVR *  OVRDBF FILE(PMCHRGXX) TOFILE(PMCHRGPD) SHARE(*NO)            *   S01486
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Portfolio definition maintenance')            *
     F********************************************************************
     F*                                                                  *
     F*    Midas PORTFOLIO MANAGEMENT                                    *
     F*                                                                  *
     F*    PM0110  - PORTFOLIO DEFINITION MAINTENANCE                    *
     F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
     F*                                                                  *S01486
     F*                                                                  *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CLE148             Date 23Jul12               *
      *                 CLE064             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 01Jul02               *
      *                 177647             Date 29Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 07Jul99               *
      *                 163634             Date 07Jul99                  *
      *                 146302             Date 29Oct98                  *
      *                 141883             Date 18Sep98                  *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 120827             Date 06Jul97               *
     F*                 119507             Date 19JUN97                  *
     F*                 CAC003             Date 25Feb97                  *
     F*                 CPM005             Date 03Jul96                  *
     F*                 103080             Date 08Feb96                  *
     F*                 CPM003             Date 02May96               *
     F*                 S71062             DATE 24Nov95               *
     F*                 CPM004             DATE 08FEB96                  *S01486
     F*                 085799             DATE 08MAR95                  *S01486
     F*                 080674             DATE 03JAN95                  *S01486
     F*                 S01486             DATE 01AUG94                  *S01486
     F*                 051784      MF     DATE 08MAR93                  *S01486
     F*                 054002     GB      DATE 16APR93                  *S01486
     F*                 046909             DATE 10NOV92                  *
     F*                 046461             DATE 29OCT92                  *
     F*                 45330              DATE 05OCT92                  *
     F*                 SA9108     MLD     DATE 24AUG92                  *
     F*                 S01313             DATE 06MAY92                  *
     F*                 B9958              DATE 15NOV91                  *
     F*                 B08275             DATE 21OCT91                  *
     F*                 B08257             DATE 21OCT91                  *
     F*                 B8275              DATE 16OCT91                  *
     F*                 B08255             DATE 07OCT91                  *
     F*                 B08166             DATE 12AUG91                  *
     F*                 B07916             DATE 05JUN91                  *
     F*                 R05914             DATE 30APR91                  *
     F*                 B5862              DATE 22APR91                  *
     F*                 R5556              DATE 27FEB91                  *
     F*                 R5500              DATE 20FEB91                  *
     F*                 R0974      MDS     DATE 26NOV90                  *
     F*                 R00954             DATE 14NOV90                  *
     F*                 S01307             DATE 08OCT90                  *
     F*                 R10053             DATE 01OCT90                  *
     F*                 R00367             DATE 21AUG90                  *
     F*                 R00300             DATE 14AUG90                  *
     F*                                                                  *
     F********************************************************************
     F*                                                                  *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  177647 - Move DDCGCO to CG array even if DDCGCO is blank.    *
      *           This is to prevent wrong validation of the          *
      *           charge currency.                                    *
     F*  CPB001 -  'Private Banking' Module                           *
      *  163634 - Doesn't accept a reatil number. Due to wrong fix    *
      *           085799. Too much coding.                            *
     F*  146302 - ONLY VALIDATE BANK CHARGING CURRENCY ON INSERT      *
     F*  141883 - Error with setting up management fee on second      *
     F*           portfolio.                                          *
     F*  120827 - Profit Centre Accounting defaulting                 *
     F*  119507 - PROFIT CENTRE IS NOT DISPLAYED FOR CUSTOMER PORTFOLIO
     F*  CAC003 - Profit Centre Accounting Development Phase 3.       *
     F*  CPM005 - Private Banking Phase II                            *
     F*           Focus Group Changes Upgraded to DBA                 *
     F*           PBFG/1 - CHANGE PM CUSTOMER BASE CCY & PORTFOLIO CCY*
     F*           PBFG/3 - DISPLAY UNREALISED P&L ON FORWARD SE TRADES*
     F*           PBFG/5 - INSTRUMENT ASSET/LIABILITY SPLIT           *
     F*           PBFG/6 - ADDITIONAL CUSTOMER DETAILS                *
     F*  103080  -  '?' processing does not copy back selected customer  *
     F*             hence program crashes looking for customer '?'.      *
     F*  CPM003 - FF/PM Interface upgrade to Release 10                  *
     F*  S71062 - FF/PM Portfolio definition maintenance                 *
     F*           add new field 'FF' margin a/c sequence.                *
     F*  CPM004  -  Bank Portfolios                                      *S01486
     F*  085799  -  Branch code must appear on settlement account        *S01486
     F*  080674  -  Miscellanous errors on Charges checking.             *S01486
     F*  S01486  -  Portfolio management upgrade to R10                  *S01486
     F*             Including Fix 73957 & 64239                          *S01486
     F*  051784  -  WRONG MESSAGE USED WHEN CLOSURE                      *
     F*  054002  -  WRONG MSG WHEN VALUATION FREQUENCY NOT SPECIFIED     *
     F*  046909  -  ALLOW PERFORMANCE START DATE TO BE ADJUSTED TO START *
     F*             OF MONTH IN FUTURE                                   *
     F*  046461  -  SET UP CHARGE/SETTLEMENT CCY DP CORRECTLY            *
     F*  45330   -  DATE PORTFOLIO OPENED MAY NOT BE AMENDED             *
     F*  SA9108  -  POOL SECURITY TRANSACTION                            *
     F*  S01313  -  PORTFOLIO PERFORMANCE                                *
     F*  B9958   -  CHANGE MSGID PM90001 WITH PM90005 (ACTION CODE C     *
     F*             AND NOT D FOR DELETION)                              *
     F*  B08257  -  PORTFOLIO REFERENCE MAY NOT BE REUSED                *
     F*  B8275   -  Closure of Customers Portfolios.                     *
     F*  B08255  -  SPEED UP COB BY SPLITTING TOTALLING FILES            *
     F*  B08166  -  ON AMENDMENT DO NOT RESET SETTLEMENT DETAILS TO 0    *
     F*  B07916  -  WHEN CHARGE ADDED LAST ACCRUAL DATE SET TO RUN       *
     F*             DATE - 1 SO THAT ACCRUALS GENERATED FOR 1 DAY        *
     F*  R05914  -  WHEN A NEW CHARGE ENTERED LAST ACCRUAL DATE          *
     F*             SET TO RUN DATE                                      *
     F*  B5862   -  Remove message PM11403.                              *
     F*  R5556   -  A PORTFOLIO COULD BE OPENED FOR DELETED CUSTOMER     *
     F*  R5500   -  Remove the validation 402.                           *
     F*  R0974   -  FIX R00367 SHOULD NOT TEST BITS 01                   *
     F*  R00954  -  ACCOUNT VALIDATION INCORRECT                         *
     F*  S01307  -  CUSTODY FEES ENHANCEMENTS                            *
     F*  R10053  -  TERMINATE PROGRAM IF F3 TAKEN FROM NOTEPAD           *
     F*  R00367  -  PM SHOULD NOT BE ABLE TO BOOK AGAINST BLOCKED        *
     F*             RETAIL ACCOUMTS                                      *
     F*  R00300  -  Message file changes.                                *
     F*                                                                  *
     F********************************************************************
     F**
     F** DISPLAY FILE
     F**
     F**PM0110DDCF  E                    WORKSTN                          S01486
     FPM0110DFCF  E                    WORKSTN                            S01486
     F                                        RRN1  KSFILE PM0110S0
     F                                        RRN2  KSFILE PM0110S1
     F**
     F** INPUT FILES ********************************
     F**
     F**TABLETJ IF  E           K        DISK                             S01486
     F********                                      KINFSR *PSSR          S01486
     F***RECORD ID BJ                                                     S01486
     F**SDBANKL1IF  E           K        DISK                             S01486
     F********                                      KINFSR *PSSR          S01486
     F***RECORD ID BB AND QB                                              S01486
     F**SDPLCSL2IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F***RECORD ID BB AND QB                                              S01486
     F**SDPLCSL3IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F** RECORD ID QB                                                     B08255
     F**SDPLCSPDUF  E           K        DISK                      B08255 S01486
     FSDPLCSL1UF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08255
     F***RECORD ID A6                                                     S01486
     F**SDCURRL0IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F***RECORD ID BC                                                     S01313
     F*SDALTNL1IF**E           K        DISK                              S01313
     F****                                          KINFSR *PSSR          S01313
     F* FILE ID 'PE'
     F**PMPTFTPPIF  E           K        DISK                             S01486
     FPMPTFTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** RECORD ID PS
     F**PMBIPNPPIF  E           K        DISK                             S01486
     FPMBIPNPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     FACNUMA  IF  E           K        DISK
     F                                              KINFSR *PSSR
     F            ACCNTABF                          KRENAMEACNUMTBF
     FACCNT   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F** FILE ID 'P5'
     F**PMCGCDPPIF  E           K        DISK                             S01486
     FPMCGCDPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F* FILE ID 'P9'
     F**SDPORTL0IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F**FILE*ID*'BG'                                                      S01486
     F**SDMMODL0IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F* FILE ID 'PO'
     F**PMCHRGPPUF  E           K        DISK         KCOMIT       A      S01486
     FPMCHRGPDUF  E           K        DISK         KCOMIT       A        S01486
     F                                              KINFSR *PSSR
     FPMCHRGXXIF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMCHRGP0                          KRENAMEPMCHRGPX
     FPMCHRGL1IF  E           K        DISK                               B8275
     F                                              KINFSR *PSSR          B8275
     F            PMCHRGP0                          KRENAMEPMCHRGLF       B8275
     F* FILE ID 'PN'
     F**PMPORTPPUF  E           K        DISK         KCOMIT       A      S01486
     FPMPORTPDUF  E           K        DISK         KCOMIT       A        S01486
     F                                              KINFDS INFDS
     F                                              KINFSR *PSSR
     F* FILE ID 'SA'                                                      S01307
     F***SCICDPPDIF  E                    DISK                     S01307 S01486
     FSDSCFEPDIF  E                    DISK                               S01486
     F                                              KINFSR *PSSR          S01307
     F* FILE ID 'BF'                                                      S01307
     F**SDSECSL0IF  E           K        DISK                      S01307 S01486
     F**********                                    KINFSR *PSSR   S01307 S01486
     F* FILE ID 'SB'                                                      S01307
     F***SCCFGRPDIF**E           K        DISK                     S01307 S01486
     FSECFGRPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR          S01307
     F* FILE ID 'SD'                                                      S01307
     F*CSCFAPDIF  E           K        DISK                         S01307B8275
     F**SCSCFAL2IF  E           K        DISK                       B8275 S01486
     FSESCFAPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR          S01307
     F* FILE ID 'SE'                                                      S01307
     F*COCFSPDIF  E           K        DISK                         S01307B8275
     F***SCOCFSL3IF  E           K        DISK                      B8275 S01486
     FSEOCFSL3IF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR          S01307
     FPMPPTDPDIF  E           K        DISK                               SA9108
     F                                              KINFSR *PSSR          SA9108
     FPMPPTML1IF  E           K        DISK                               SA9108
     F                                              KINFSR *PSSR          SA9108
     F/COPY WNCPYSRC,PM0110F001
     FPMPSTMQ0IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     F** ************************************
     F** OVERRIDEN FILE PM DEFINITION DETAILS
     F** ************************************
     FPMPORTXXIF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMPORTP0                          KRENAMEPMPORTPX
     F**PMPORTZZUF  E                    DISK         KCOMIT              S01486
     FPMPORTPAUF  E                    DISK         KCOMIT                S01486
     F                                              KINFSR *PSSR
     FPMPOTTPDIF  E           K        DISK         KINFSR *PSSR      UC  CPM004
     F*                                                                   CPM004
     F*****************************************************************
     F**    F U N C T I O N   O F    I N D I C A T O R S
     F*****************************************************************
     F**
     F**  KA   -   ACCESS TO PORTFOLIO DEFINITION DETAILS
     F**       -   ACCESS TO PORTFOLIO CHARGES DETAILS
     F**  KC   -   EXIT PROGRAM
     F**  KL   -   EXIT PROCESS -  START SCREEN
     F**  KY   -   ACCES TO NOTEPAD
     F**  LR   -   END OF PROGRAM
     F**  U7   -   DATA BASE ERROR
     F**  U8   -   PROGRAM RUN ERROR
     F**
     F**  07   -   FIELD FF MARGIN A/C SEQ. IN ERROR                      S71062
     F**  08   -   Chain failure in PMPOTTPD                              CPM004
     F**  10   -   START SCREEN PROCEDURE
     F**  11   -   REVIEW SCREEN PROCEDURE
     F**  12   -   UPDATE PROCEDURE
     F**  13   -   CHAIN IN FILE PF/PMPPTDPD                              SA9108
     F**  14   -   CHAIN IN FILE PF/PMPPTMPD                              SA9108
     F**  15   -   INSTRUMENT SUMMARY SECTION IN ERROR                    CPM005
     F**  20   -   FF MODULE ON -> DISPLAY FIELD FF MARG. A/C SEQ.        S71062
     F**  21   -   ROLLUP
     F**  22   -   ROLLDOWN
     F**  24   -   PROTECT DATE PORTFOLIO OPENED IN AMEND MODE
     F**  25   -   PROTECT MODE PM0110F1
     F**  26-29-   ERROR INDICATORS PM0110F1
     F**  30   -   ERROR INDICATOR PM0110C0
     F**  31   -   PROTECT MODE PM0110F2
     F**  31   -   PROTECT MODE PM0110C1
     F**  56   -   PROTECT MODE PM0110F2
     F**  58   -   PROTECT MODE PM0110F2
     F**  32-55-   ERROR INDICATORS PM0110F2
     F**  32-45-   ERROR INDICATORS PM0110C1
     F**  56-59-   PROTECT MODE PM0110F2
     F**  60   -   ANY VALID COMMAND KEY
     F**  61   -   SUBFILE DISPLAY PM0110C0
     F**  62   -   SUBFILE DISPLAY PM0110C0
     F**  63   -   SUBFILE END PM0110C0
     F**  64   -   ROLLDOWN NOT ALLOWED
     F**  69   -   ERROR INDICATOR PM0110F2 - CUSTODY GROUP CODE          S01307
     F**  70   -   FEE GROUP ALLOWED ON PORTFOLIO                         S01307
     F**  71-73-   FILE PROCESSING
     F**  75-77-   FILE PROCESSING
     F**  78   -   CURRENCY SUMMARY SECTION IN ERROR                      CPM005
     F**  79   -   FILE PROCESSING
     F**  81-89-   WORK INDICATORS
     F**  90-99-   STANDARD SUBROUTINES INDICATORS
     F**
     F******************************************************************
     E**
     E** ARRAY FOR ZDATE SUBROUTINE
      /COPY ZSRSRC,ZDATE2Z1
     E** ARRAY FOR ZFRQA SUBROUTINE
      /COPY ZSRSRC,ZFRQAZ1
     E** ALPHANUMERIC ARRAY
     E                    NUMA   36  36  1
     E**
     E** WORK ARRAY
     E                    RFNC        4  1               PORTFOLIO REFERENCE
     E**
     E                    DDAD        5  1               ALTERNATE ADDRESS
     E                    AD          5  1               ALTERNATE ADDRESS
     E                    CG         10  2               CHARGE CODES
     E** ARRAY FOR ZEDIT
      /COPY ZSRSRC,ZEDITZ1
      /COPY ZSRSRC,ZHOLE                                                  S01486
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
     E                    CPY@    1   1 80                                S01486
     I*********************************************************************
     I**
     ISCRCTL      DS
     I                                        1   1 WWREVW
     I                                        2   2 DDACTN
     I                                        3   8 DDPNP8
     I                                        9  14 WWCUS1
     I                                       15  20 WWCUS2
     I                                       21  24 DDPORT
     I                                       25  28 DDPREF
     I                                       29  32 WWPAG1
     I                                       33  36 WWPAG2
     I                                       37  46 DDCSNM
     I                                       47  62 DDDELT
     I*
     I*
     I** DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     IINFDS       DS
     I                                     *STATUS  STATUS
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA         DS                            256
     I************                          132 141 WWFILE                S01486
     I************                          142 170 WWKEY                 S01486
     I************                          171 180 WWPGM                 S01486
     I************                          181 1830WWASE                 S01486
     I                                      134 141 DBFILE                S01486
     I                                      142 170 DBKEY                 S01486
     I                                      171 180 DBPGM                 S01486
     I                                      181 1830DBASE                 S01486
     I*
     I*    MIDAS 'Next Available Transaction No.' Data Area  MNATN .
     IDNATN       DS                              5
     I                                        1   50FNATN
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I*
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     IPSDS       SDS
     I                                      247 249 WSID
     I                                      244 253 WSIDN
     I                                      254 263 USID
     I**
     I** DATA STRUCTURE FOR LAST UPDATE
     I**
     I            DS
     I                                        1   20WWDLUP
     I                                        3   5 WWMLUP
     I                                        6   70WWYLUP
     I                                        1   7 WWHLUP
     I**
     I** DATA STRUCTURE FOR CUSTOMER NUMBER
     I**
     I            DS
     I                                        1  10 WWCNUM
     I                                        1   6 WWCNM1
     I                                        7  10 WWCNM2
     I**
     I** DATA STRUCTURE FOR CUSTOMER ACCOUNT
     I**
     I            DS
     I**********                              1  12 WWCUSA                                    CGL029
     I                                        1  18 WWCUSA                                    CGL029
     I**********                              1   60WWCLAS                                    CSD027
     I                                        1   6 WWCLAS                                    CSD027
     I**********                              7  100WWACOD                                    CGL029
     I**********                             11  120WWACSQ                                    CGL029
     I                                        7  160WWACOD                                    CGL029
     I                                       17  180WWACSQ                                    CGL029
     I                                        1  100WWCSA1
     I                                       11  12 WWCSA2
     I**
     I** DATA STRUCTURE FOR WORK FIELDS
     I**
     I            DS
     I                                        1  140WWCGSP
     I                                       15  280WWPCL1
     I                                       29  420WWPCL2
     I                                       43  560WWPCL3
     I                                       57  700WWPCL4
     I                                       71  840WWPCL5
     I                                       85  980WWPCL6
     I                                       99 1120WWPCL7
     I                                      113 1260WWPCL8
     I                                      127 1400WWPCL9
     I                                      141 1540WWPC10
     I                                      155 1680WWPC11
     I                                      169 1820WWPC12
     I                                      183 1960WWPC13
     I                                      197 2100WWPC14
     I                                      211 2240WWPC15
     I**                                                                  S01313
     I** DATA STRUCTURE FOR RETRIEVAL OF FIRST DAY IN NEXT MONTH          S01313
     I**                                                                  S01313
     I            DS                                                      S01313
     I                                        1   60W1PSDT                S01313
     I                                        1   20W1DAY                 S01313
     I                                        3   40W1MTH                 S01313
     I                                        5   60W1YEAR                S01313
     I*                                                                   CPM004
     I** Portfolio Data Structure                                         CPM004
     I*                                                                   CPM004
     IWWPORT      DS                                                      CPM004
     I**********                              1   60WWPNP8                             CPM004 CSD027
     I                                        1   6 WWPNP8                                    CSD027
     I                                        7  10 WWPREF                CPM004
     I**                                                                  S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I** EXTERNAL DS FOR BANK DETAILS                                     S01486
     ISDSECS    E DSSDSECSPD                                              S01486
     I** EXTERNAL DS FOR SECURITIES DETAILS                               S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I** EXTERNAL DS FOR CURRENCY DETAILS                                 S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I** EXTERNAL DS FOR PORTFOLIO DETAILS                                S01486
     ISDMMOD    E DSSDMMODPD                                              S01486
     I** EXTERNAL DS FOR MODULES                                          S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I*>>>> PROFIT CENTRE PROCESSING  ** I SPECS BEGIN                    S01486
     ISDACOF    E DSSDACOFPD                                              S01486
     I** EXTERNAL DS FOR ACCOUNT OFFICER DETAILS                          S01486
     ISDPRFC    E DSSDPRFCPD                                              S01486
     I** EXTERNAL DS FOR PROFIT CENTRE   DETAILS                          S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I** EXTERNAL DS FOR CUSTOMER DETAILS                                 S01486
     I*<<<< PROFIT CENTRE PROCESSING  ** I SPECS END                      S01486
     ISDGELR    E DSSDGELRPD                                              S01486
     I              QQACCD                          QQACD1                                    CGL029
     I** EXTERNAL DS FOR GENERAL LEDGER ICD                               S01486
     ISCSARD    E DSSCSARDPD                                              S01486
     I** EXTERNAL DS FOR SAR'S FILE                                       S01486
     I***/COPY ZSRSRC,ZAOZ1                                               S01486
     I***/COPY ZSRSRC,ZAOZ2                                               S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, LONG  DATA STRUCTURE                S01486
     IDSLDY     E DSDSLDY                                                 CPB001
     I* THIRD DS FOR ACCESS PROGRAMS, VERY LONG  DATA STRUCTURE           CPB001
     IRUNDT       DS                                                      S01486
      **  DATA AREA RUNDAT                                                S01486
     I                                        1   7 RUNA                  S01486
     I                                    P   8  100RUND                  S01486
     I                                       11  11 SSF                   S01486
     I                                       12  12 DATF                  S01486
     I                                       13  13 MBIN                  S01486
     IZMUSER      DS                             17                       S01486
     I** DATA AREA OF MENU USER                                           S01486
     I                                       11  13 USRBCH                S01486
      /COPY ZSRSRC,ZHOLI                                                  S01486
     I**
     I/COPY WNCPYSRC,PM0110I001
     I**
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * INDEX OF SUBROUTINES                                                   *
      * MAIN     - MAIN PROCESSING                                             *
      * #P1001   - TO INITIALIZE FIELDS AND ACCESS STANDING DATA               *
      * #CLOF    - TO PROCESS CLOSE OF FILES IN LOWER LEVEL PROGRAMS           *
      * #P1002   - START - TO OUTPUT AND PROCESS KEY FIELDS SCREEN             *
      * #P1003   - TO PROCESS SUBFILE SELECTION SCREEN                         *
      * #ZBAA    - TO MOVE THE APPROPRIATE VALUE IN WWAID                      *
      * #ZBAB    - TO VALIDATE KEY FIELDS FROM START SCREEN                    *
      * #ZBAC    - TO VALIDATE KEY FIELDS FROM REVIEW SCREEN                   *
      * #CUST    - TO VALIDATE CUSTOMER NUMBER/SHORTNAME                       *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      * #READ    - TO FILL SUBFILE - PORTFOLIO CHARGES                         *
      * #ZED     - TO COMPUTE DECIMAL NUMBER AND ACCESS ZEDIT SR               *
      * #TRANS   - TO ACCESS FILE AND FILL DISPLAY FIELDS                      *
      * #V1004   - TO VALIDATE PORTFOLIO DEFINITION DETAILS                    *
      * #V1005   - TO VALIDATE DATE PORTFOLIO CLOSED                           *
      * #P1005   - TO PROCESS PORTFOLIO CHARGE DETAILS                         *
      * #P1006   - TO PROCESS INVESTMENT POLICY INDICATORS(AMEND)              *
      * #P1007   - TO PROCESS INVESTMENT POLICY INDICATORS(ENQUIRY)            *
      * #P1008   - TO UPDATE PORTFOLIO DEFINITION FILE                         *
      * #P1009   - TO UPDATE PORTFOLIO CHARGES DETAILS FILE                    *
      * #P1010   - TO UPDATE PORTFOLIO DEFINITION AUDIT                        *
      * #Z1009   - TO TRANSFER SCREEN FIELDS TO FILE                           *
      * #V1006   - TO VALIDATE PORTFOLIO CHARGES DETAILS                       *
      * #CBB     - TO PROCESS UPDATE BY ANOTHER WORKSTATION                    *
      * *PSSR    - TO PROCESS ABNORMAL END OF PROGRAM                          *
      * ZDATE1   - TO COMPUTE DATE IN DAY NUMBER                               *
      * ZDATE2   - TO COMPUTE DAY NUMBER IN DATE                               *
      * ZEDIT    - TO OUTPUT NUMERIC FIELDS IN ALPHA                           *
      * ZALIGN   - SR/ TO RIGHT ALIGN NUMERIC FIELDS                           *
      * ZFRQA    - TO INCREMENT A DAY NUMBER DATE BY A VALUE                   *
      * ZTNLU1   - TO LOCK AND ACCESS DATA AREA AND GET TRANSAC. NBR           *
      * ZASNMS   - SENDS MESSAGE TO PROGRAM MESSAGE QUEUE.                     *
      *                                                                        *
      * EXTERNAL ROUTINES CALLED                                               *
      * PM0600   - NOTEPAD                                                     *
      * PM0170   - INSTRUMENT INVESTMENT POLICY                                *
      * PM0180   - CURRENCY INVESTMENT POLICY                                  *
      * PM0190   - COUNTRY OF RISK INVESTMENT POLICY                           *
      * PM0200   - INDUSTRY INVESTMENT POLICY                                  *
      *******ZA0250   - TO CLEAR MESSAGE                                  R00300
      *******ZA0240   - TO ACCESS MESSAGE FILE AND SEND MESSAGE           R00300
      * Y2CLMSC  - CLEAR MESSAGE QUEUE                                    R00300
      * Y2SNMGC  - WRITE ERROR MESSAGES (VIA ZASNMS)                      R00300
      *                                                                        *
      **************************************************************************
      *                                                                        *
      *  VALIDATION SUBROUTINES #V1004 AND #V1006 ARE QUITE LONG               *
      *  TO MAKE RESEARCH EASIER INTO THESE SUBROUTINES                        *
      *  PRECEED THE FIELD YOU ARE SEARCHING FOR BY 'VAL4' OR 'VAL6' FOR       *
      *  RESPECTIVELY #V1004 AND #V1006.                                       *
      *                                                                        *
      *  FOR EXAMPLE IF YOU WANT TO ENQUIRE THE VALIDATION OF THE DATE         *
      *  PORTFOLIO OPENED IN #V1004, TYPE VAL4DDDPOP AND PRESS CMD/16          *
      *                                                                        *
      *  OR TYPE VAL4 AND PRESS CMD/16 TO ENQUIRE SEQUENTIALLY                 *
      **************************************************************************
     C*================================================================
     C** PARAMETERS LIST
     C**
     C           LIST1     PLIST
     C                     PARM           WWRTRN  1
     C                     PARM           WWCCNM  6
     C                     PARM           WWPTFR  4
     C**
     C           LIST2     PLIST
     C                     PARM           WWACTO  1
     C                     PARM           WWRTRN
     C                     PARM           WWPOLI  1
     C                     PARM           WWCCNM
     C                     PARM           WWPTFR
     C                     PARM           WWNEWT
     C                     PARM           DDPTFN
     C** KEY LIST
     C**
     C***********SDALT     KLIST                                          S01486
     C***********          KFLD           WWCCNM                          S01486
     C***********          KFLD           WWALTN  1                       S01486
     C**
     C           PMPORK    KLIST
     C**********           KFLD           WWPNP8  60                                          CSD027
     C                     KFLD           WWPNP8  6                                           CSD027
     C                     KFLD           WWPREF  4
     C**
     C           PMCHRK    KLIST
     C                     KFLD           WWPNP8
     C                     KFLD           WWPREF
     C                     KFLD           WWCGSQ  20
     C**
     C           PMACCN    KLIST
     C                     KFLD           WWCLAS
     C                     KFLD           WWCUCY  3
     C                     KFLD           WWACOD
     C                     KFLD           WWACSQ
     C                     KFLD           WWBRCA  3                       085799
     C**
     C           PMCODE    KLIST
     C                     KFLD           DDBCGY
     C                     KFLD           DDCGCO
     C**                                                                  SA9108
     C           PM1KEY    KLIST                                          SA9108
     C                     KFLD           WWCUST                          SA9108
     C                     KFLD           WWPREF                          SA9108
     C           PMPRKB    KLIST                                          S01486
     C                     KFLD           WWBRCA  3                       S01486
     C**********           KFLD           WWPNP8  60                                   S01486 CSD027
     C                     KFLD           WWPNP8  6                                           CSD027
     C                     KFLD           WWPREF  4                       S01486
     C**                                                                  CPM005
     C           PERFOK    KLIST                                          CPM005
     C                     KFLD           PNCNUM                          CPM005
     C                     KFLD           PNPTFR                          CPM005
     C                     KFLD           KFMTH   2                       CPM005
     C**                                                                  CPM005
     C*****************************************************************
     C**    P R O G R A M   S T A R T
     C*****************************************************************
     C*
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR #P1001
     C*
     C** D O    U N T I L   C K 3   O R   E R R O R
     C*
     C           WWAID     DOUEQ'03'
     C*
     C           *IN10     CASEQ'1'       #P1002
     C*
     C           *IN11     CASEQ'1'       #P1003
     C*
     C           *IN12     CASEQ'1'       #P1004
     C*
     C                     END
     C*
     C                     END
     C**
     C** CLOSE ALL FILES IN LOWER LEVEL PROGRAM
     C**
     C                     EXSR #CLOF
     C*
     C** TERMINATE PROGRAM
     C*
     C                     MOVE '1'       *INLR
     C*================================================================
     C*  P R O G R A M     E N D
     C*================================================================
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1001   - TO INITIALIZE FIELDS AND ACCESS STANDING DATA               *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - TO PROCESS ABNORMAL END OF PROGRAM                          *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      **************************************************************************
     C           #P1001    BEGSR                           **#P1001 BSR **
     C*
      ***  Copyright Statement.                                           S01486
     C                     MOVEACPY@      CPY2@  80
     C**                                                                  S01486
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01486
     C                     IN   RUNDT                                     S01486
     C           *NAMVAR   DEFN           ZMUSER                          S01486
     C                     IN   ZMUSER                                    S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C**                                                                  S01486
     C                     MOVEL'*'       DDPGMQ
     C*                                                                   R00300
     C**   Select the program MSGQ for error msg.                         R00300
     C                     MOVEL'*'       TOPQ   10                       R00300
     C                     MOVEL'*PRV'    TOPRQ   5                       R00300
     C*                                                                   R00300
     C**   Fill in fields for subroutine ZASNMS                           R00300
     C                     MOVEL*BLANK    ZAPGM  10        Message queue  R00300
     C                     MOVEL'PMUSRMSG'ZAMSGF 10        Message file   R00300
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue      R00300
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.    R00300
     C                     MOVEL*BLANK    ZAMSDA132        Message data.  R00300
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.  R00300
     C*                                                                   R00300
     C** INITIALIZE WORK FIELDS
     C**
     C                     Z-ADD0         WW      30
     C                     Z-ADD0         XX      30
     C                     Z-ADD0         WWVLDM  20
     C                     Z-ADD0         WWPTCY  10
     C                     Z-ADD0         WWCSCY  10
     C                     Z-ADD0         X       30
     C                     Z-ADD0         WWSAVX  30
     C                     Z-ADD0         APDA    50
     C                     Z-ADD0         WWSAVE  50
     C                     Z-ADD0         WWTNLU  50
     C                     Z-ADD0         WWTNLB  50
     C                     Z-ADD0         WWDPOP  50
     C                     Z-ADD0         WWPDGS  50
     C                     Z-ADD0         WWPDGF  50
     C                     Z-ADD0         WWVLND  50
     C                     Z-ADD0         WWDPCL  50
     C                     Z-ADD0         RRN2    40
     C                     Z-ADD0         WWCOUN  50
     C                     Z-ADD0         ZDATE   60
     C                     Z-ADD0         WWDAT1  60
     C                     Z-ADD0         WWCSA  100
     C                     Z-ADD0         WWCGSP
     C                     MOVE *BLANKS   WWACTN  1
     C                     MOVE *BLANKS   WWWORK 10
     C                     MOVE *BLANKS   WWVVDM  2
     C                     MOVE *BLANKS   WWCGCO  2
     C                     MOVE *BLANKS   WWDAT2  6
     C                     MOVEL'PM0110'  DBPGM  10
     C*
     C** PREPARE COMIT TEXT
     C*
     C                     MOVEL'PM'      MDID
     C                     MOVEL'PM0110'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C**
     C**
     C**  SET UP PARAMETER TO RETRIEVE MESSAGE FROM MESSAGE FILE
     C           PLLANG    PLIST
     C                     PARM           MSMBR4  7
     C                     PARM           MSGER  10
     C                     PARM           MSGTXT 80
     C***********          MOVEL'MLGBMSGF'MSGER                           S01486
     C                     MOVEL'PMUSRMSG'MSGER                           S01486
     C*
     C** GET INSTALLATION CONTROL DATA RECORD 1
     C*
     C***********          READ SDBANKL1                 71               S01486
     C************IN71     IFEQ '1'                        ***************S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C***********          Z-ADD1         DBASE   30       **DB ERROR 01**S01486
     C***********          MOVEL'SDBANKL1'DBFILE 10        ***************S01486
     C***********          MOVE *BLANKS   DBKEY  29                       S01486
     C                     Z-ADD1         DBASE            **DB ERROR 01**S01486
     C                     MOVE 'SDBANKPD'DBFILE           ***************S01486
     C                     MOVE *BLANKS   DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*  PROFIT CENTRE PROCESSING                                         S01486
     C** GET DETAILS                                                      S01486
     C*                                                                   S01486
     C**********           CALL 'AOGELRR0'                                S01486              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C********** SDGELR    PARM SDGELR    DSFDY                           S01486              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C*                                                    ***************S01486
     C                     Z-ADD3         DBASE            **DB ERROR 03**S01486
     C                     MOVE 'SDGELRPD'DBFILE           ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** ACCESS SAR FILE TO CHECK SAFE CUSTODEE FEES                      S01486
     C*                                                                   S01486
     C                     MOVEL'S01464'  WWSARD  6                       S01486
     C                     CALL 'AOSARDR0'                                S01486
     C                     PARM *BLANKS   WWRTCD                          S01486
     C                     PARM '*VERIFY 'WWOPTN                          S01486
     C                     PARM           WWSARD                          S01486
     C           SCSARD    PARM SCSARD    DSFDY                           S01486
     C           WWRTCD    IFEQ *BLANKS                                   S01486
     C                     MOVEL'Y'       WWSFEE  1                       S01486
     C                     ELSE                                           S01486
     C                     MOVEL'N'       WWSFEE                          S01486
     C                     END                                            S01486
     C*                                                                   S01313
     C** CONVERT RUN DATE TO DAY NUMBER AND CALCULATE START OF MONTH      S01313
     C                     Z-ADDBJRDNB    ZDAYNO                          S01313
     C                     EXSR ZDATE2                                    S01313
     C*                                                                   CPM005
     C                     Z-ADDZYEAR     WYEAR   20                      CPM005
     C*                                                                   S01313
     C                     MOVELZDATE     WWORK4  4                       S01313
     C                     MOVELWWORK4    W1DAY                           S01313
     C                     MOVE WWORK4    W1MTH                           S01313
     C                     MOVE ZDATE     W1YEAR                          S01313
     C                     MOVELW1YEAR    W1MTHY  40                      S01313
     C                     MOVE W1MTH     W1MTHY                          S01313
     C*                                                                   S01313
     C** CALCULATE FIRST DAY OF CURRENT MONTH AND CONVERT INTO RUN DAY    S01313
     C** NUMBER FOR LATER USE                                             S01313
     C                     Z-ADD1         W1DAY                           S01313
     C                     MOVE W1PSDT    ZDATE                           S01313
     C                     EXSR ZDATE1                                    S01313
     C                     Z-ADDZDAYNO    WWSTRM  50                      S01313
     C*                                                                   S01313
     C** CALCULATE FIRST DAY OF NEXT MONTH AND CONVERT INTO RUN DAY       S01313
     C** NUMBER FOR LATER USE                                             S01313
     C           1         ADD  ZMTH      W1MTH                           S01313
     C           W1MTH     IFEQ 13                                        S01313
     C                     Z-ADD1         W1MTH                           S01313
     C**********           ADD  1         ZYEAR                     S01313CPM005
     C                     ADD  1         WYEAR                           CPM005
     C                     END                                            S01313
     C**********           Z-ADDZYEAR     W1YEAR                    S01313CPM005
     C                     Z-ADDWYEAR     W1YEAR                          CPM005
     C                     MOVE W1PSDT    ZDATE                           S01313
     C                     EXSR ZDATE1                                    S01313
     C                     Z-ADDZDAYNO    WZPSDT  50                      S01313
      *                                                                   CPM005
      **  CALCULATE LAST DAY OF CURRENT MONTH AND CONVERT INTO RUN DAY    CPM005
      **  NUMBER FOR LATER USE                                            CPM005
     C           ZDAYNO    SUB  1         WENDMT  50                      CPM005
     C*
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C*
     C** GET INSTALLATION CONTROL DATA RECORD FOR CUSTODY FEES            S01307
     C           WWSFEE    IFEQ 'Y'                                       S01486
     C***********          READ SCICDPPD                 71        S01307 S01486
     C                     READ SDSCFEPD                 71               S01486
     C*                                                                   S01307
     C           *IN71     IFEQ '1'                        ***************S01307
     C                     Z-ADD6         DBASE   30       **DB ERROR 06**S01307
     C************         MOVEL'SCICDPPD'DBFILE 10        ********S01307 S01486
     C                     MOVE 'SDSCFEPD'DBFILE           ***************S01486
     C                     MOVE *BLANKS   DBKEY  29                       S01307
     C                     EXSR *PSSR                                     S01307
     C                     END                                            S01307
     C*                                                                   S01307
     C** ALLOW INPUT OF FEE GROUP CODE ON SCREEN                          S01307
     C***********SAFGCP    IFEQ 'Y'                                S01307 S01486
     C           FBFGCP    IFEQ 'Y'                                       S01486
     C                     MOVE '1'       *IN70                           S01307
     C                     END                                            S01307
     C                     END                                            S01486
     C*                                                                   S01307
     C** GET PORTFOLIO MANAGEMENT INSTALLATION DETAILS
     C*
     C************         READ SDPORTL0                 71               S01486
     C************IN71     IFEQ '1'                        ***************S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C************         Z-ADD2         DBASE   30       **DB ERROR 02**S01486
     C************         MOVEL'SDPORTL0'DBFILE 10        ***************S01486
     C************         MOVE *BLANKS   DBKEY  29                       S01486
     C                     Z-ADD2         DBASE            **DB ERROR 02**S01486
     C                     MOVE 'SDPORTPD'DBFILE           ***************S01486
     C                     MOVE *BLANKS   DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     OPEN PMPOTTPD                                  CPM004
     C                     ENDIF                                          CPM004
     C*
     C** GET DETAILS OF MODULES INSTALLED ON SYSTEM
     C*
     C***********          READ SDMMODL0                 71               S01486
     C************IN71     IFEQ '1'                        ***************S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C***********          Z-ADD3         DBASE   30       **DB ERROR 03**S01486
     C***********          MOVEL'SDMMODL0'DBFILE 10        ***************S01486
     C***********          MOVE *BLANKS   DBKEY  29                       S01486
     C                     Z-ADD3         DBASE            **DB ERROR 03**S01486
     C                     MOVE 'SDMMODPD'DBFILE           ***************S01486
     C                     MOVE *BLANKS   DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CAC003
     C** Check if Analytical Accounting and Switchable Feature            CAC003
     C** CAC003 are switched on.                                          CAC003
     C                     MOVE '0'       *IN87                           CAC003
      *                                                                   CAC003
     C                     CALL 'AOSARDR0'                                CAC003
     C                     PARM           WWRTCD                          CAC003
     C                     PARM '*VERIFY' WWOPTN                          CAC003
     C                     PARM 'CAC003'  WWSARD                          CAC003
     C           SCSARD    PARM SCSARD    DSFDY                           CAC003
      *                                                                   CAC003
     C           WWRTCD    IFEQ *BLANK                                    CAC003
     C           BGN0ST    ANDEQ'Y'                                       CAC003
     C                     MOVE '1'       *IN87                           CAC003
     C                     ENDIF                                          CAC003
      *                                                                   CAC003
     C*
     C** SET ON PLEDGE PROTECT INDICATOR IF LOMBARD CREDITS PRESENT
     C*
     C           BGLMCR    IFEQ 'Y'
     C                     MOVE '1'       *IN23
     C                     END
     C*                                                                   S71062
     C** SET ON INDICATOR IF FUTURES & OPTIONS PRESENT (FF MARG. A/C SEQ) S71062
     C*                                                                   S71062
     C           BGFUOP    IFEQ 'Y'                                       S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C                     MOVE *ON       *IN20                           S71062
     C                     ENDIF                                          S71062
     C*
     C***********          MOVELBJMRDT    DDRUNA                          S01486
     C                     MOVE '1'       *IN10
     C/COPY WNCPYSRC,PM0110C001
     C*
     C                     ENDSR                           **#A   ENDSR**
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #CLOF    - TO PROCESS CLOSE OF FILES IN LOWER LEVEL PROGRAMS           *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * PM0600   - NOTEPAD                                                     *
      * PM0170   - INSTRUMENT INVESTMENT POLICY                                *
      * PM0180   - CURRENCY INVESTMENT POLICY                                  *
      * PM0190   - COUNTRY OF RISK INVESTMENT POLICY                           *
      * PM0200   - INDUSTRY INVESTMENT POLICY                                  *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      * *PSSR    - TO PROCESS ABNORMAL END OF PROGRAM                          *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #CLOF     BEGSR
     C*
     C** ENSURE WORKSTATION ID RESET TO BLANK IF LOCKED BY JOB
     C*
     C           WWLOCK    IFEQ 'Y'
     C**********           Z-ADDWWPNP8    WWCSSV  60                                          CSD027
     C                     MOVE WWPNP8    WWCSSV  6                                           CSD027
     C                     MOVE WWPREF    WWPRSV  4
     C***********PMPORK    CHAINPMPORTPP             71                   S01486
     C           PMPORK    CHAINPMPORTPD             71                   S01486
     C*
     C           *IN71     IFEQ '0'
     C                     MOVE *BLANKS   PNWSI1
     C                     UPDATPMPORTP0
     C                     COMIT
     C                     END
     C                     END
     C**
     C                     MOVEL'9'       WWRTRN
     C                     MOVEL*BLANK    WWACTO
     C                     MOVEL'0'       WWCCNM
     C                     MOVEL*BLANKS   WWPOLI
     C                     MOVEL*BLANKS   WWPTFR
     C**
     C** PROGRAM PM0600 ** NOTEPAD **
     C**
     C           WW0600    IFEQ 'Y'
     C                     CALL 'PMC0601' LIST1
     C                     END
     C*
     C**
     C** PROGRAM PM0170 ** INSTRUMENT POLICIES
     C**
     C           WW0170    IFEQ 'Y'
     C                     CALL 'PM0170'  LIST2
     C                     END
     C*
     C**
     C** PROGRAM PM0180  ** CURRENCY POLICIES
     C**
     C           WW0180    IFEQ 'Y'
     C                     CALL 'PM0180'  LIST2
     C                     END
     C*
     C**
     C** PROGRAM PM0190  ** COUNTRY OF RISK POLICIES
     C**
     C           WW0190    IFEQ 'Y'
     C                     CALL 'PM0190'  LIST2
     C                     END
     C*
     C**
     C** PROGRAM PM0200  ** INDUSTRY POLICIES
     C**
     C           WW0200    IFEQ 'Y'
     C                     CALL 'PM0200'  LIST2
     C                     END
     C**
     C** Close PF/PMPOTTPD                                                CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     CLOSEPMPOTTPD                                  CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1002   - START - TO OUTPUT AND PROCESS KEY FIELDS SCREEN             *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      ********ZA0250   - TO CLEAR MESSAGE                                 R00300
      * Y2CLMSC  - CLEAR MESSAGE QUEUE                                    R00300
      * #ZBAA    - TO MOVE THE APPROPRIATE VALUE IN WWAID                      *
      * #ZBAB    - TO VALIDATE KEY FIELDS FROM START SCREEN                    *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #P1002    BEGSR                           **#P1002 BSR **
     C*
     C** IF F12 TAKEN TO RETURN TO PREVIOUS SCREEN REMOVE ALL FILE CHANGES
     C*
     C           WWAID     IFEQ '12'
     C                     ROLBK
     C                     END
     C*
     C** ENSURE WORKSTATION ID RESET TO BLANK IF RECORD LOCKED BY JOB
     C*
     C           WWLOCK    IFEQ 'Y'
     C**********           Z-ADDWWPNP8    WWCSSV  60                                          CSD027
     C                     MOVE WWPNP8    WWCSSV  6                                           CSD027
     C                     MOVE WWPREF    WWPRSV  4
     C***********PMPORK    CHAINPMPORTPP             71                   S01486
     C           PMPORK    CHAINPMPORTPD             71                   S01486
     C*
     C           *IN71     IFEQ '0'
     C                     MOVE *BLANKS   PNWSI1
     C                     UPDATPMPORTP0
     C                     COMIT
     C                     END
     C                     END
     C*
     C** INITIALISE SCREEN DATA
     C*
     C                     MOVE '0'       *IN10
     C                     MOVE '0'       *IN25
     C                     MOVE '0'       *IN26
     C                     MOVE '0'       *IN27
     C                     MOVE '0'       *IN28
     C                     MOVE '0'       *IN29
     C                     MOVEL*BLANK    SCRCTL
     C***********          MOVEL'PM90001' MSMBR4                          B9958
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVEL'PBUSRMSG'MSGER                           CPB001
     C                     MOVEL'PB00074' MSMBR4                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVEL'PM90005' MSMBR4                          B9958
     C                     ENDIF                                          CPB001
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    DDINFO
     C                     MOVEL'PMUSRMSG'MSGER                           CPB001
     C*
     C** CLEAR WHOLE SCREEN
     C*
     C                     WRITEPM0110F4
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           WWAID     DOUEQ'03'
     C           *IN10     OREQ '1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C*
     C** S T A R T   S C R E E N     O U T P U T
     C*
     C                     WRITEPM0110F3
     C                     EXFMTPM0110F1
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN81
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**  Clear program message queue.                                    R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ   10                       R00300
     C                     PARM           TOPRQ   5                       R00300
     C*
     C** Call S/R to move values into WWAID
     C*
     C                     EXSR #ZBAA
     C*
     C** ENTER TAKEN VALIDATE KEY INPUT
     C*
     C           WWAID     IFEQ 'RA'
     C                     EXSR #ZBAB
     C*
     C** IF NO ERRORS, DETERMINE NEXT SCREEN
     C*
     C           *IN80     IFEQ '0'
     C*
     C** IF ACTION CODE IS BLANK, NEXT SCREEN IS REVIEW SCREEN,
     C** OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
     C           DDACTN    IFEQ *BLANK
     C                     MOVE '1'       *IN11
     C                     ELSE
     C                     MOVE '1'       *IN12
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           ** #BA   ENDSR**
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1003   - TO PROCESS SUBFILE SELECTION SCREEN                         *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *********ZA0250   - TO CLEAR MESSAGE                                R00300
      * Y2CLMSC  - CLEAR MESSAGE QUEUE                                    R00300
      * #ZBAA    - TO MOVE THE APPROPRIATE VALUE IN WWAID                      *
      * #ZBAC    - TO VALIDATE KEY FIELDS FROM REVIEW SCREEN                   *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #P1003    BEGSR                           **#P1003  BSR**
     C*
     C                     MOVE '0'       *IN11
     C                     MOVE '0'       *IN29
     C*
     C** SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C                     MOVEL'RA'      WWAID   2
     C**
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           WWAID     DOUEQ'03'
     C           *IN10     OREQ '1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C*
     C** R E B U I L D   S U B F I L E
     C*
     C           WWAID     IFEQ 'DN'
     C           WWAID     OREQ 'UP'
     C           WWAID     OREQ 'RA'
     C*
     C** WRITE CONTROL RECORD
     C*
     C                     MOVE '0'       *IN61
     C                     MOVE '0'       *IN62
     C                     MOVE '0'       *IN63
     C                     Z-ADD*ZERO     RRN1
     C                     WRITEPM0110C0
     C                     MOVE '1'       *IN64
     C*
     C** SET FILE POINTER - PAGE BACK
     C*
     C           WWAID     IFEQ 'DN'
     C**********           Z-ADD0         WWPNP8                                              CSD027
     C                     MOVE *BLANKS   WWPNP8                                              CSD027
     C                     MOVEL*BLANKS   WWPREF
     C                     MOVEL*BLANKS   WWCUS2
     C                     MOVEL*BLANKS   WWPAG2
     C           PMPORK    SETLLPMPORTXX
     C*
     C** OTHERWISE        - PAGE FORWARD
     C*
     C                     ELSE
     C**
     C           *IN80     IFEQ '0'
     C           DDACTN    ANDEQ*BLANK
     C                     MOVELDDPNP8    WWCUS2
     C                     MOVELDDPORT    WWPAG2
     C                     END
     C                     MOVE WWCUS2    WWPNP8
     C                     MOVELWWPAG2    WWPREF
     C**
     C           PMPORK    SETLLPMPORTXX
     C                     END
     C*
     C** READ IN DETAILS-FILL UP SUBFILE
     C*
     C*
     C           RRN1      DOUEQ12
     C           *IN71     OREQ '1'
     C**
     C                     MOVEL*BLANK    DDACTN
     C                     MOVE '0'       *IN30
     C*
     C** READ DETAILS UNTIL SUBFILE PAGE IS FULL
     C*
     C                     READ PMPORTXX                 71
     C*
     C           *IN71     IFEQ '0'
     C           PNRECI    IFEQ '*'
     C                     MOVEL'CL'      DDSTAT
     C                     ELSE
     C           PNDPCL    IFNE 0
     C                     MOVEL'CR'      DDSTAT
     C                     ELSE
     C                     MOVEL'  '      DDSTAT
     C                     END
     C                     END
     C*
     C** LOAD SUBFILE
     C*
     C********** PNCNUM    IFNE 0                                                             CSD027
     C           PNCNUM    IFNE *BLANKS                                                       CSD027
     C                     MOVE PNCNUM    DDCNUM
     C                     MOVE PNPTFR    DDPTFR
     C                     MOVE PNPTCY    DDPCCY
     C                     MOVE PNPTFN    DDPTFN
     C           PNDPCL    IFNE 0
     C                     Z-ADDPNDPCL    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DDDATE
     C                     ELSE
     C                     MOVEL*BLANKS   DDDATE
     C                     END
     C                     ADD  1         RRN1    40     64
     C*
     C** ERROR HAS BEEN DETECTED - RECOGNIZE ERROR RECORD TO POSITION
     C** CURSOR
     C*
     C           RRN1      IFEQ WWSAVE
     C                     MOVELWWACTN    DDACTN
     C                     MOVE '1'       *IN30
     C                     END
     C*
     C** WRITE RECORD TO SUBFILE
     C*
     C                     WRITEPM0110S0
     C**
     C                     END
     C**
     C                     END
     C*
     C** PAGE NOW FULL (OR EOF)
     C*
     C                     END
     C*
     C** READ ONE MORE RECORD FOR NEXT SCREEN
     C*
     C           *IN71     IFEQ '0'
     C                     READ PMPORTXX                 71
     C                     END
     C*
     C** IF NOT EOF SET NEXT 'REVIEW FROM' KEY ELSE SET IT TO BLANK
     C*
     C           *IN71     IFEQ '0'
     C                     MOVELPNCNUM    DDPNP8
     C                     MOVELPNPTFR    DDPORT
     C                     MOVE '0'       *IN63
     C                     ELSE
     C                     MOVE *BLANKS   DDPNP8
     C                     MOVE *BLANKS   DDPORT
     C                     MOVE '1'       *IN63
     C                     END
     C*
     C** FOR SUBFILE CONTROL
     C*
     C           *IN64     IFEQ '1'
     C                     MOVE '0'       *IN61
     C                     MOVE '1'       *IN62
     C                     ELSE
     C                     MOVE '1'       *IN61
     C                     MOVE '1'       *IN62
     C                     END
     C*
     C                     END
     C*
     C** R E V I E W   S C R E E N     O U T P U T
     C*
     C                     MOVEL'PM90007' MSMBR4
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    DDINFO
     C                     WRITEPM0110F3
     C                     WRITEPM0110F1
     C                     EXFMTPM0110C0
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN86                           B8275
     C                     Z-ADD0         WWSAVE
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**   Clear program message queue                                    R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ                            R00300
     C                     PARM           TOPRQ                           R00300
     C*
     C** Call S/R to move values into WWAID
     C*
     C                     EXSR #ZBAA
     C*
     C** CK12- INITIAL SCREEN
     C*
     C           WWAID     IFEQ '12'
     C                     MOVE '1'       *IN10
     C                     END
     C*
     C** ENTER PRESSED, PROCESS RECORD SELECTION
     C*
     C           WWAID     IFEQ 'RA'
     C                     MOVE '1'       *IN77
     C*
     C           *IN64     IFEQ '0'
     C                     READCPM0110S0                 77
     C                     END
     C*
     C** R E C O R D   S E L E C T   V A L I D A T I O N
     C*
     C           *IN77     IFEQ '0'
     C                     EXSR #ZBAC
     C*
     C** NO ERRORS, UPDATE SCREEN CAN BE PROCESSED NEXT
     C*
     C           *IN80     IFEQ '0'
     C                     MOVE '1'       *IN12
     C                     MOVEL'Y'       WWREVW
     C**
     C** ACCESS CUSTOMER FILE TO GET INFORMATIONS
     C**
     C***********DDCNUM    CHAINSDPLCSL2             75                   S01486
     C                     MOVELDDCNUM    WWCLIN 10                       S01486
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM WWCLIN    WWKY10 10                       S01486
     C           SDPLCS    PARM SDPLCS    DSSDY                           S01486
     C**
     C                     MOVELDDCNUM    DDCSNM
     C                     MOVELDDPTFR    DDPREF
     C                     ELSE
     C                     MOVELDDACTN    WWACTN
     C                     Z-ADDRRN1      WWSAVE
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C*
     C                     ENDSR                           **#BB    ENDSR**
     C*
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #ZBAA    - TO MOVE THE APPROPRIATE VALUE IN WWAID                      *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1002   - START - TO OUTPUT AND PROCESS KEY FIELDS SCREEN             *
      * #P1003   - TO PROCESS SUBFILE SELECTION SCREEN                         *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      * #P1005   - TO PROCESS PORTFOLIO CHARGE DETAILS                         *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #ZBAA     BEGSR
     C*
     C* If ENTER pressed, the VLDCMDKEY indicator will be off
     C*
     C           *IN60     IFEQ '0'
     C                     MOVE 'RA'      WWAID
     C                     END
     C*
     C* If F3
     C*
     C           *INKC     IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     MOVE '0'       *INKC
     C                     END
     C*
     C* If F12
     C*
     C           *INKL     IFEQ '1'
     C                     MOVE '12'      WWAID
     C                     MOVE '0'       *INKL
     C                     END
     C*
     C* If F1
     C*
     C           *INKA     IFEQ '1'
     C                     MOVE '01'      WWAID
     C                     MOVE '0'       *INKA
     C                     END
     C*
     C* If F24
     C*
     C           *INKY     IFEQ '1'
     C                     MOVE '24'      WWAID
     C                     MOVE '0'       *INKY
     C                     END
     C*
     C* If ROLLUP pressed
     C*
     C           *IN21     IFEQ '1'
     C                     MOVE 'UP'      WWAID
     C                     MOVE '0'       *IN21
     C                     END
     C*
     C* If ROLLDOWN pressed
     C*
     C           *IN22     IFEQ '1'
     C                     MOVE 'DN'      WWAID
     C                     MOVE '0'       *IN22
     C                     END
     C*
     C                     ENDSR                           **#ZBAA  ENDSR**
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #ZBAB    - TO VALIDATE KEY FIELDS FROM START SCREEN                    *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      ********ZA0240   - TO ACCESS MESSAGE FILE AND SEND MESSAGE          R00300
      * ZASNMS   - WRITE ERROR MESSAGES                                   R00300
      * #CUST    - TO VALIDATE CUSTOMER NUMBER/SHORTNAME                       *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1002   - START - TO OUTPUT AND PROCESS KEY FIELDS SCREEN             *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #ZBAB     BEGSR                           ** #ZBAB  BSR**
     C*
     C** RESET ERROR INDICATORS
     C*
     C                     MOVE '0'       *IN26
     C                     MOVE '0'       *IN27
     C                     MOVE '0'       *IN28
     C                     MOVE '0'       *IN29
     C                     MOVELDDPNP8    WWWORK 10
     C                     MOVE DDPORT    WWWORK
     C*
     C** A C T I O N    C O D E    I N P U T - MUST BE BLANK,A,E
     C*
     C           DDACTN    IFNE *BLANK
     C***
     C           WWWORK    IFNE *BLANKS
     C*********************MOVEL'PM11114' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11114' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN26
     C                     MOVE '1'       *IN27
     C                     MOVE '1'       *IN28
     C                     END
     C***
     C           DDACTN    IFNE 'I'
     C           DDACTN    ANDNE'A'
     C           DDACTN    ANDNE'E'
     C           DDACTN    ANDNE'C'
     C*********************MOVEL'PM11100' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11100' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN26
     C                     END
     C/COPY WNCPYSRC,PM0110C002
     C** USER SHOULD BE AUTHORISED TO ACTION CODE                         S01486
     C*                                                                   S01486
     C** WHEN SINGLE BRANCH                                               S01486
     C           MBIN      IFNE 'Y'                                       S01486
     C*                                                                   S01486
     C                     CALL 'ZVACTU'                                  S01486
     C                     PARM DDACTN    @ZACTN  1                       S01486
     C                     PARM           @ERR    10                      S01486
     C           @ERR      IFNE *ZERO                                     S01486
     C                     MOVEL'PM02000' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN26                           S01486
     C                     MOVE '1'       *IN80                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C** WHEN MULTI-BRANCH                                                S01486
     C                     CALL 'ZVACTBU'                                 S01486
     C                     PARM DDACTN    @ZACTN  1                       S01486
     C                     PARM USRBCH    @ZBR    3                       S01486
     C                     PARM           @ERR    10                      S01486
     C           @ERR      IFNE *ZERO                                     S01486
     C                     MOVEL'PM02000' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN26                           S01486
     C                     MOVE '1'       *IN80                           S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**
     C           DDCSNM    IFEQ *BLANKS
     C           DDPREF    ANDEQ*BLANKS
     C*********************MOVEL'PM11115' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11115' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN27
     C                     MOVE '1'       *IN28
     C                     END
     C**
     C           DDCSNM    IFNE *BLANKS
     C           DDPREF    ANDEQ*BLANKS
     C*********************MOVEL'PM11106' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11106' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN28
     C                     END
     C*
     C           DDCSNM    IFEQ *BLANKS
     C           DDPREF    ANDNE*BLANKS
     C*********************MOVEL'PM11102' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11102' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN27
     C                     END
     C**
     C*
     C** CHECK IF CUSTOMER NUMBER OR SHORT NAME IS VALID
     C*
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           *IN27     ANDEQ'0'                                       CPB001
     C*                                                                   CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM '*MSG    'WWRTCD                          CPB001
     C                     PARM '*KEY    'WWOPTN                          CPB001
     C                     PARM DDCSNM    WWKY10                          CPB001
     C                     PARM WWSORT    WWKE7                           CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   CPB001
     C                     MOVE BBCUST    WWPNP8                          CPB001
     C                     MOVELBBCUST    DDCSNM    P                     CPB001
     C                     MOVELBBCUST    WWCNUM    P                     CPB001
     C*                                                                   CPB001
     C** Input and change of a portfolio is only possible in Interface    CPB001
     C** If Private Banking Customer                                      CPB001
     C*                                                                   CPB001
     C           DDACTN    IFEQ 'I'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C           DDACTN    OREQ 'C'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVEL'PBUSRMSG'ZAMSGF                          CPB001
     C                     MOVEL'PB00073' ZAMSID                          CPB001
     C                     MOVELDDACTN    ZAMSDA    P                     CPB001
     C                     EXSR ZASNMS                                    CPB001
     C                     MOVEL'PMUSRMSG'ZAMSGF                          CPB001
     C                     MOVE '1'       *IN80                           CPB001
     C                     MOVE '1'       *IN26                           CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C** In Private Banking Module all portfolio must be                  CPB001
     C** in range from 0001 to 00099                                      CPB001
     C*                                                                   CPB001
     C           DDACTN    IFEQ 'I'                                       CPB001
     C           *IN28     ANDEQ'0'                                       CPB001
     C                     TESTN          DDPREF     83                   CPB001
     C** Must be numeric                                                  CPB001
     C           *IN83     IFEQ *OFF                                      CPB001
     C                     MOVEL'PBUSRMSG'ZAMSGF                          CPB001
     C                     MOVEL'PB00115' ZAMSID                          CPB001
     C                     EXSR ZASNMS                                    CPB001
     C                     MOVEL'PMUSRMSG'ZAMSGF                          CPB001
     C                     MOVE '1'       *IN80                           CPB001
     C                     MOVE '1'       *IN28                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE DDPREF    WNPREF  40                      CPB001
     C                     ENDIF                                          CPB001
     C** Must be in range 0001 -> 0099                                    CPB001
     C           *IN83     IFEQ *ON                                       CPB001
     C           WNPREF    ANDLT1                                         CPB001
     C           *IN83     OREQ *ON                                       CPB001
     C           WNPREF    ANDGT99                                        CPB001
     C                     MOVEL'PBUSRMSG'ZAMSGF                          CPB001
     C                     MOVEL'PB00115' ZAMSID                          CPB001
     C                     EXSR ZASNMS                                    CPB001
     C                     MOVEL'PMUSRMSG'ZAMSGF                          CPB001
     C                     MOVE '1'       *IN80                           CPB001
     C                     MOVE '1'       *IN28                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           *IN27     ANDEQ*OFF                                      CPB001
     C           BGPFMG    OREQ 'Y'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C           BBPRBA    ANDNE'Y'                                       CPB001
     C           *IN27     ANDEQ*OFF                                      CPB001
     C                     EXSR #CUST
     C                     ENDIF                                          CPB001
     C**
     C** CHECK IF PORTFOLIO REFERENCE CONTAINS ONLY LETTERS OR
     C** NUMBERS
     C**
     C                     MOVEADDPREF    RFNC
     C                     Z-ADD0         X
     C                     MOVE '0'       *IN89
     C           X         DOUEQ4
     C**
     C                     ADD  1         X
     C**
     C           RFNC,X    LOKUPNUMA                     88
     C**
     C           *IN88     IFEQ '0'
     C           *IN89     ANDEQ'0'
     C*********************MOVEL'PM11110' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11110' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN89
     C                     MOVE '1'       *IN28
     C                     END
     C**
     C                     END
     C**
     C** CHECK IF PORTFOLIO REFERENCE IS VALID
     C**
     C           DDPREF    IFEQ '9997'
     C           DDPREF    OREQ '9998'
     C           DDPREF    OREQ '9999'
     C***********DDPREF    OREQ P9R997                                    S01486
     C***********DDPREF    OREQ P9R998                                    S01486
     C***********DDPREF    OREQ P9R999                                    S01486
     C           DDPREF    OREQ FCR997                                    S01486
     C           DDPREF    OREQ FCR998                                    S01486
     C           DDPREF    OREQ FCR999                                    S01486
     C*********************MOVEL'PM11110' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11110' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN28
     C                     END
     C**
     C** IF NO ERRORS OCCURED CHAIN ON FILES TO CHECK IF ENTRIES EXIST
     C**
     C           *IN80     IFEQ '0'
     C**
     C                     MOVE QBCUST    WWPNP8
     C                     MOVE DDPREF    WWPREF
     C*
     C** A C T I O N    C O D E    I
     C*
     C           DDACTN    IFEQ 'I'
     C*
     C** IF INSERT- RECORD CANNOT EXIST
     C*
     C           PMPORK    CHAINPMPORTXX             71
     C           *IN71     IFEQ '0'
     C****       PNRECI    ANDEQ'D'                                       B08268
     C*********************MOVEL'PM11107' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11107' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN26
     C                     MOVE '1'       *IN27
     C                     MOVE '1'       *IN28
     C                     END
     C*
     C                     END
     C*
     C** A C T I O N    C O D E    A
     C*
     C           DDACTN    IFEQ 'A'
     C*
     C** IF AMEND - RECORD MUST BE LIVE
     C*
     C           PMPORK    CHAINPMPORTXX             71
     C           *IN71     IFEQ '1'
     C**
     C** PORTFOLIO NOT FOUND
     C**
     C*
     C*********************MOVEL'PM11108' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11108' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN32
     C                     MOVE '1'       *IN33
     C                     ELSE
     C           PNRECI    IFEQ 'D'
     C**
     C** PORTFOLIO FOUND BUT IN PROGRESS TO BE CLOSED
     C**
     C           PNDPCL    ANDNE0
     C*********************MOVEL'PM11116' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11116' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN32
     C                     MOVE '1'       *IN33
     C                     END
     C**
     C** PORTFOLIO CLOSED
     C**
     C           PNRECI    IFNE 'D'
     C*********************MOVEL'PM11117' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11117' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN32
     C                     MOVE '1'       *IN33
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** A C T I O N    C O D E    C
     C*
     C           DDACTN    IFEQ 'C'
     C*
     C** IF CLOSURE - DATE PORTFOLIO CLOSED MUST BE AFTER RUN DATE
     C*
     C           PMPORK    CHAINPMPORTXX             71
     C**
     C** PORTFOLIO NOT FOUND
     C**
     C           *IN71     IFEQ '1'
     C*
     C*********************MOVEL'PM11108' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11108' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN32
     C                     MOVE '1'       *IN33
     C                     ELSE
     C**
     C** PORTFOLIO FOUND BUT ALREADY CLOSED
     C**
     C           PNRECI    IFNE 'D'
     C*
     C*********************MOVEL'PM11117' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11117' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN32
     C                     MOVE '1'       *IN33
     C*********************END                                            SA9108
     C                     ELSE                                           SA9108
     C/COPY WNCPYSRC,PM0110C005
     C*                                                                   SA9108
     C* TEST IF PORTFOLIO IS A POOL PORTFOLIO                             SA9108
     C*                                                                   SA9108
     C***********          MOVE BBCUST    WWCUST  60               SA9108 S01486
     C**********           MOVE QBCUST    WWCUST  60               S01486 CPM005
     C**********           MOVE DDCNUM    WWCUST  60                                   CPM005 CSD027
     C                     MOVE DDCNUM    WWCUST  6                                           CSD027
     C*                                                                   SA9108
     C           PM1KEY    CHAINPMPPTDPD             13                   SA9108
     C*                                                                   SA9108
     C           *IN13     IFEQ '0'                                       SA9108
     C                     MOVEL'PM11119' ZAMSID                          SA9108
     C                     EXSR ZASNMS                                    SA9108
     C                     MOVE '1'       *IN80                           SA9108
     C                     MOVE '1'       *IN31                           SA9108
     C                     MOVE '1'       *IN32                           SA9108
     C                     MOVE '1'       *IN33                           SA9108
     C                     ELSE                                           SA9108
     C*                                                                   SA9108
     C* TEST IF PORTFOLIO IS ATTACHED TO A POOL PORTFOLIO                 SA9108
     C*                                                                   SA9108
     C           PM1KEY    CHAINPMPPTML1             14                   SA9108
     C*                                                                   SA9108
     C           *IN14     IFEQ '0'                                       SA9108
     C                     MOVEL'PM11120' ZAMSID                          SA9108
     C                     EXSR ZASNMS                                    SA9108
     C                     MOVE '1'       *IN80                           SA9108
     C                     MOVE '1'       *IN31                           SA9108
     C                     MOVE '1'       *IN32                           SA9108
     C                     MOVE '1'       *IN33                           SA9108
     C                     END                                            SA9108
     C*                                                                   SA9108
     C                     END                                            SA9108
     C*                                                                   SA9108
     C                     END                                            SA9108
     C*                                                                   SA9108
     C                     END
     C*
     C** If Bank Portfolio is supported, portfolio must not have          CPM004
     C** any transactions/positions againts it.                           CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           *IN80     ANDNE*ON                                       CPM004
     C*                                                                   CPM004
     C           PMPORK    CHAINPMPOTTP0             08                   CPM004
     C*                                                                   CPM004
     C           *IN08     IFEQ *OFF                                      CPM004
     C           QCPTPA    IFNE *ZERO                                     CPM004
     C           QCPTNA    ORNE *ZERO                                     CPM004
     C           QCPTMV    ORNE *ZERO                                     CPM004
     C           QCPVPA    ORNE *ZERO                                     CPM004
     C           QCPVNA    ORNE *ZERO                                     CPM004
     C           QCPTMV    ORNE *ZERO                                     CPM004
     C           QCPTAI    ORNE *ZERO                                     CPM004
     C           QCPTNI    ORNE *ZERO                                     CPM004
     C                     MOVEL'PMA0016' ZAMSID                          CPM004
     C                     EXSR ZASNMS                                    CPM004
     C                     MOVE *ON       *IN80                           CPM004
     C                     MOVEA'111'     *IN,31                          CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     END
     C*
     C** A C T I O N    C O D E    E
     C*
     C           DDACTN    IFEQ 'E'
     C           PMPORK    CHAINPMPORTXX             71
     C*
     C** IF ENQUIRY - RECORD MUST EXIST
     C*
     C           *IN71     IFEQ '1'
     C*********************MOVEL'PM11109' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11109' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN32
     C                     MOVE '1'       *IN33
     C                     END
     C**
     C                     END
     C*
     C                     END
     C**
     C                     ELSE
     C** CHECK IF ONLY REVIEW FROM FIELDS ARE FILLED
     C**
     C           WWWORK    IFNE *BLANKS
     C           DDCSNM    ANDNE*BLANKS
     C*********************MOVEL'PM11114' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11114' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN27
     C                     END
     C**
     C           WWWORK    IFNE *BLANKS
     C           DDPREF    ANDNE*BLANKS
     C*********************MOVEL'PM11114' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11114' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN28
     C                     END
     C**
     C           DDACTN    IFEQ *BLANK
     C           DDCSNM    ANDNE*BLANKS
     C           DDACTN    OREQ *BLANK
     C           DDPREF    ANDNE*BLANKS
     C*********************MOVEL'PM11101' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11101' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN26
     C                     END
     C**
     C           DDPORT    IFNE *BLANKS
     C           DDPNP8    ANDEQ*BLANKS
     C*********************MOVEL'PM11102' MSGID  10                       R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11102' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN29
     C                     END
     C**
     C                     END
     C*
     C** IF DETAILS FOUND AND ACTION CODE 'C' OR 'D' CHECK WHETHER
     C** PORTFOLIO DETAILS ARE ALREADY BEING UPDATED BY ANOTHER
     C** WORKSTATION
     C*
     C           DDACTN    IFEQ 'A'
     C           DDACTN    OREQ 'C'
     C           *IN80     IFEQ '0'
     C***********PMPORK    CHAINPMPORTPP             71                   S01486
     C           PMPORK    CHAINPMPORTPD             71                   S01486
     C*
     C**********           Z-ADDWWPNP8    WWCSSV  60                                          CSD027
     C                     MOVE WWPNP8    WWCSSV  6                                           CSD027
     C                     MOVE WWPREF    WWPRSV  4
     C*
     C           *IN71     IFEQ '0'
     C*
     C** IF RECORD IS NOT ALREADY BEING UPDATED FLAG IT FOR UPDATE
     C*
     C           PNWSI1    IFEQ *BLANKS
     C                     Z-ADDPNTNLU    WWTNLU
     C                     MOVE 'Y'       WWLOCK  1
     C                     MOVE WSIDN     PNWSI1
     C                     UPDATPMPORTP0
     C                     ELSE
     C*
     C** IF RECORD ALREADY BEING UPDATED FLAG SEND ERROR MESSAGE
     C*
     C                     MOVE 'N'       WWLOCK
     C*********************MOVEL'PM11118' MSGID  10                       R00300
     C*********************MOVELPNWSI1    WWDATA 45                       R00300
     C*********************CALL 'ZA0440'                                  R00300
     C*********************PARM           MSGID                           R00300
     C*********************PARM           WWDATA                          R00300
     C                     MOVEL'PM11118' ZAMSID                          R00300
     C                     MOVELPNWSI1    ZAMSDA                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     UPDATPMPORTP0
     C                     END
     C                     COMIT
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #ZBAC    - TO VALIDATE KEY FIELDS FROM REVIEW SCREEN                   *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      ********ZA0240   - TO ACCESS MESSAGE FILE AND SEND MESSAGE          R00300
      * ZASNMS   - WRITE ERROR MESSAGES                                   R00300
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1003   - TO PROCESS SUBFILE SELECTION SCREEN                         *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #ZBAC     BEGSR                           ** #ZBAC  BSR**
     C*
     C** RESET ERROR INDICATORS
     C*
     C                     MOVE '0'       *IN30
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVEL'PBUSRMSG'ZAMSGF                          CPB001
     C*                                                                   CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM '*MSG    'WWRTCD                          CPB001
     C                     PARM '*KEY    'WWOPTN                          CPB001
     C                     PARM DDCNUM    WWKY10                          CPB001
     C                     PARM WWSORT    WWKE7                           CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   CPB001
     C           DDACTN    IFEQ 'I'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C           DDACTN    OREQ 'C'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVEL'PB00073' ZAMSID                          CPB001
     C                     MOVELDDACTN    ZAMSDA    P                     CPB001
     C                     EXSR ZASNMS                                    CPB001
     C                     MOVE '1'       *IN80                           CPB001
     C                     Z-ADDRRN1      WWSAVE                          CPB001
     C                     ELSE                                           CPB001
     C           DDACTN    IFNE 'A'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C           DDACTN    ANDNE'E'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVEL'PB00055' ZAMSID                          CPB001
     C                     EXSR ZASNMS                                    CPB001
     C                     MOVE '1'       *IN80                           CPB001
     C                     Z-ADDRRN1      WWSAVE                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C                     MOVEL'PMUSRMSG'ZAMSGF                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C           *IN80     IFEQ '0'                                       CPB001
     C**
     C** ACTION CODE MUST BE A, E OR C
     C**
     C           DDACTN    IFNE 'A'
     C           DDACTN    ANDNE'E'
     C           DDACTN    ANDNE'C'
     C           DDACTN    ANDNE'I'
     C*********************MOVEL'PM11111' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11111' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     Z-ADDRRN1      WWSAVE
     C**
     C                     ELSE
     C/COPY WNCPYSRC,PM0110C003
     C** USER SHOULD BE AUTHORISED TO ACTION CODE                         S01486
     C*                                                                   S01486
     C** WHEN SINGLE BRANCH                                               S01486
     C           MBIN      IFNE 'Y'                                       S01486
     C*                                                                   S01486
     C                     CALL 'ZVACTU'                                  S01486
     C                     PARM DDACTN    @ZACTN  1                       S01486
     C                     PARM           @ERR    10                      S01486
     C           @ERR      IFNE *ZERO                                     S01486
     C                     MOVEL'PM02000' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN26                           S01486
     C                     MOVE '1'       *IN80                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C** WHEN MULTI-BRANCH                                                S01486
     C                     CALL 'ZVACTBU'                                 S01486
     C                     PARM DDACTN    @ZACTN  1                       S01486
     C                     PARM USRBCH    @ZBR    3                       S01486
     C                     PARM           @ERR    10                      S01486
     C           @ERR      IFNE *ZERO                                     S01486
     C                     MOVEL'PM02000' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN26                           S01486
     C                     MOVE '1'       *IN80                           S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**
     C                     MOVE DDCNUM    WWPNP8
     C                     MOVE DDPTFR    WWPREF
     C           PMPORK    CHAINPMPORTXX             72
     C**
     C           DDACTN    IFEQ 'I'
     C           PNRECI    ANDEQ'D'
     C*********************MOVEL'PM11107' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11107' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     Z-ADDRRN1      WWSAVE
     C                     END
     C**
     C           DDACTN    IFEQ 'A'
     C**
     C           *IN72     IFEQ '1'
     C*********************MOVEL'PM11112' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11112' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     Z-ADDRRN1      WWSAVE
     C                     ELSE
     C           PNRECI    IFEQ 'D'
     C**
     C** PORTFOLIO FOUND BUT CLOSED
     C**
     C           PNDPCL    ANDNE0
     C*********************MOVEL'PM11116' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11116' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     Z-ADDRRN1      WWSAVE
     C                     END
     C           PNRECI    IFNE 'D'
     C*********************MOVEL'PM11117' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11117' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     Z-ADDRRN1      WWSAVE
     C                     END
     C                     END
     C                     END
     C**
     C           DDACTN    IFEQ 'C'
     C**
     C           *IN72     IFEQ '1'
     C**
     C** PORTFOLIO NOT FOUND
     C**
     C*********************MOVEL'PM11112' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11112' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     Z-ADDRRN1      WWSAVE
     C                     ELSE
     C           PNRECI    IFNE 'D'
     C*********************MOVEL'PM11117' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11117' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     Z-ADDRRN1      WWSAVE
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C* TEST IF PORTFOLIO IS A POOL PORTFOLIO                             S01486
     C*                                                                   S01486
     C**********           MOVE BBCUST    WWCUST  60                                   S01486 CSD027
     C                     MOVE BBCUST    WWCUST  6                                           CSD027
     C*                                                                   S01486
     C           PM1KEY    CHAINPMPPTDPD             13                   S01486
     C*                                                                   S01486
     C           *IN13     IFEQ '0'                                       S01486
     C                     MOVEL'PM11119' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN80                           S01486
     C                     MOVE '1'       *IN31                           S01486
     C                     MOVE '1'       *IN32                           S01486
     C                     MOVE '1'       *IN33                           S01486
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C* TEST IF PORTFOLIO IS ATTACHED TO A POOL PORTFOLIO                 S01486
     C*                                                                   S01486
     C           PM1KEY    CHAINPMPPTML1             14                   S01486
     C*                                                                   S01486
     C           *IN14     IFEQ '0'                                       S01486
     C                     MOVEL'PM11120' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN80                           S01486
     C                     MOVE '1'       *IN31                           S01486
     C                     MOVE '1'       *IN32                           S01486
     C                     MOVE '1'       *IN33                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C                     END
     C/COPY WNCPYSRC,PM0110C006
     C                     END
     C                     END
     C**
     C           DDACTN    IFEQ 'E'
     C**
     C           *IN72     IFEQ '1'
     C*********************MOVEL'PM11113' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11113' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     Z-ADDRRN1      WWSAVE
     C                     END
     C                     END
     C**
     C                     END
     C*
     C** IF DETAILS FOUND AND ACTION CODE 'C' OR 'D' CHECK WHETHER
     C** PORTFOLIO DETAILS ARE ALREADY BEING UPDATED BY ANOTHER
     C** WORKSTATION
     C*
     C           DDACTN    IFEQ 'A'
     C           DDACTN    OREQ 'C'
     C           *IN80     IFEQ '0'
     C***********PMPORK    CHAINPMPORTPP             71                   S01486
     C           PMPORK    CHAINPMPORTPD             71                   S01486
     C*
     C**********           Z-ADDWWPNP8    WWCSSV                                              CSD027
     C                     MOVE WWPNP8    WWCSSV                                              CSD027
     C                     MOVE WWPREF    WWPRSV
     C*
     C           *IN71     IFEQ '0'
     C*
     C** IF RECORD IS NOT ALREADY BEING UPDATED FLAG IT FOR UPDATE
     C*
     C           PNWSI1    IFEQ *BLANKS
     C                     MOVE 'Y'       WWLOCK
     C                     Z-ADDPNTNLU    WWTNLU
     C                     MOVE WSIDN     PNWSI1
     C                     UPDATPMPORTP0
     C                     ELSE
     C*
     C** IF RECORD ALREADY BEING UPDATED FLAG SEND ERROR MESSAGE
     C*
     C                     MOVE 'N'       WWLOCK
     C*********************MOVEL'PM11118' MSGID  10                       R00300
     C*********************MOVELPNWSI1    WWDATA 45                       R00300
     C*********************CALL 'ZA0440'                                  R00300
     C*********************PARM           MSGID                           R00300
     C*********************PARM           WWDATA                          R00300
     C                     MOVEL'PM11118' ZAMSID                          R00300
     C                     MOVELPNWSI1    ZAMSDA                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     UPDATPMPORTP0
     C                     END
     C                     COMIT
     C                     END
     C                     END
     C                     END
     C                     ENDIF                                          CPB001
     C**
     C                     ENDSR
     C**
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #CUST    - TO VALIDATE CUSTOMER NUMBER/SHORTNAME                       *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *********ZA0240   - TO ACCESS MESSAGE FILE AND SEND MESSAGE              *
      * ZASNMS   - WRITE ERROR MESSAGES                                   R00300
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #ZBAB    - TO VALIDATE KEY FIELDS FROM START SCREEN                    *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #CUST     BEGSR
     C**
     C                     MOVELDDCSNM    WWCNUM
     C           WWCNUM    IFNE *BLANKS
     C**
     C** CHECK IF SHORT NAME OR CUSTOMER NUMBER ENTERED
     C**
     C***********          TESTN          WWCNM1     83                   S01486
     C***********WWCNM2    IFEQ *BLANKS                                   S01486
     C************IN83     ANDEQ'1'                                       S01486
     C***********                                                         S01486
     C***CUSTOMER NUMBER ENTERED                                          S01486
     C***********                                                         S01486
     C***********WWCNM1    CHAINSDPLCSL2             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM WWCNUM    WWKY10 10                       S01486
     C           SDPLCS    PARM SDPLCS    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C***********QBCHTP    OREQ 'D'                                 R5556 S01486
     C           QBTYLC    OREQ 'D'                                       S01486
     C*********************MOVEL'PM11104' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11104' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN81
     C                     MOVE '1'       *IN27
     C                     ELSE
     C                     MOVE QBCUST    WWPNP8
     C                     MOVELQBCUST    DDCSNM    P                     103080
     C                     MOVELQBCUST    WWCNUM    P                     103080
     C                     END
     C*
     C***********          ELSE
     C***********
     C***SHORT*NAME ENTERED
     C***********
     C***********WWCNUM    CHAINSDPLCSL3             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***********QBCHTP    OREQ 'D'                                 R5556 S01486
     C*********************MOVEL'PM11103' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C***********          MOVEL'PM11103' ZAMSID                    R00300S01486
     C***********          EXSR ZASNMS                              R00300S01486
     C***********          MOVE '1'       *IN80                           S01486
     C***********          MOVE '1'       *IN81                           S01486
     C***********          MOVE '1'       *IN27                           S01486
     C***********          ELSE                                           S01486
     C***********          MOVE QBCUST    WWPNP8                          S01486
     C***********          END                                            S01486
     C*
     C                     END
     C**
     C***********          END                                            S01486
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * #TRANS   - TO ACCESS FILE AND FILL DISPLAY FIELDS                      *
      * #READ    - TO FILL SUBFILE - PORTFOLIO CHARGES                         *
      **********ZA0250   - TO CLEAR MESSAGE                               R00300
      * Y2CLMSC  - CLEAR MESSAGE QUEUE                                    R00300
      * #ZBAA    - TO MOVE THE APPROPRIATE VALUE IN WWAID                      *
      * #V1004   - TO VALIDATE PORTFOLIO DEFINITION DETAILS                    *
      * #V1005   - TO VALIDATE DATE PORTFOLIO CLOSED                           *
      * #P1006   - TO PROCESS INVESTMENT POLICY INDICATORS(AMEND)              *
      * #P1007   - TO PROCESS INVESTMENT POLICY INDICATORS(ENQUIRY)            *
      * #P1005   - TO PROCESS PORTFOLIO CHARGE DETAILS                         *
      *********ZA0240   - TO ACCESS MESSAGE FILE AND SEND MESSAGE              *
      * ZASNMS   - WRITE ERROR MESSAGES                                   R00300
      * PM0600   - NOTEPAD                                                     *
      * #P1008   - TO UPDATE PORTFOLIO DEFINITION FILE                         *
      * #P1009   - TO UPDATE PORTFOLIO CHARGES DETAILS FILE                    *
      * #P1010   - TO UPDATE PORTFOLIO DEFINITION AUDIT                        *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #P1004    BEGSR                           **#P1004  BSR**
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C** POSITION CURSOR
     C*
     C                     MOVE *OFF      *IN07                           S71062
     C                     MOVE '0'       *IN12
     C                     MOVE '0'       *IN16                           S01313
     C                     MOVE '0'       *IN17                           S01313
     C                     MOVE '0'       *IN18                           S01313
     C                     MOVE '0'       *IN19                           S01313
     C                     MOVE '0'       *IN09                           S01313
     C                     MOVE '0'       *IN24
     C                     MOVE '1'       *IN25
     C                     MOVE '0'       *IN26
     C                     MOVE '0'       *IN27
     C                     MOVE '0'       *IN28
     C                     MOVE '0'       *IN29
     C                     MOVE '0'       *IN30
     C                     MOVE '0'       *IN31
     C                     MOVE '0'       *IN32
     C                     MOVE '0'       *IN33
     C                     MOVE '0'       *IN34
     C                     MOVE '0'       *IN35
     C                     MOVE '0'       *IN36
     C                     MOVE '0'       *IN37
     C                     MOVE '0'       *IN38
     C                     MOVE '0'       *IN39
     C                     MOVE '0'       *IN40
     C                     MOVE '0'       *IN41
     C                     MOVE '0'       *IN42
     C                     MOVE '0'       *IN43
     C                     MOVE '0'       *IN44
     C                     MOVE '0'       *IN45
     C                     MOVE '0'       *IN46
     C                     MOVE '0'       *IN47
     C                     MOVE '0'       *IN48
     C                     MOVE '0'       *IN49
     C                     MOVE '0'       *IN50
     C                     MOVE '0'       *IN51
     C                     MOVE '0'       *IN52
     C                     MOVE '0'       *IN53
     C                     MOVE '0'       *IN54
     C                     MOVE '0'       *IN55
     C                     MOVE '0'       *IN56
     C                     MOVE '0'       *IN57
     C                     MOVE '0'       *IN58
     C                     MOVE '0'       *IN74                           S01313
     C                     MOVE '0'       *IN15                           CPM005
     C                     MOVE '0'       *IN78                           CPM005
     C                     MOVE '0'       *IN84                           CPB001
     C                     MOVEL*BLANKS   DDDELT
     C                     Z-ADD0         WWTNLB
     C                     MOVE 'N'       WWCHGP  1                       B08166
     C*
     C** If Analytical Accounting is on, set off indicator.               CAC003
     C           *IN87     IFEQ '1'                                       CAC003
     C                     MOVE '0'       *IN05                           CAC003
     C                     MOVE '0'       *IN06                           CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C** PROTECT DATE PORTFOLIO OPENED IN AMEND MODE
     C           DDACTN    IFEQ 'A'
     C                     MOVE '1'       *IN24
     C                     END
     C*                                                                   CAC003
     C** If Analytical Accounting is on, protect the profit               CAC003
     C** centre input field if not in Insert Mode.                        CAC003
     C           *IN87     IFEQ '1'                                       CAC003
     C           DDACTN    ANDNE'I'                                       CAC003
     C                     MOVE '1'       *IN05                           CAC003
     C*                                                                   CAC003
     C** Amendment of Profit Centre is permitted only on day of input     CAC003
     C           BJRDNB    IFEQ PNLCD                                     CAC003
     C           DDACTN    ANDEQ'A'                                       CAC003
     C                     MOVE '0'       *IN05                           CAC003
     C                     ENDIF                                          CAC003
     C                     ENDIF                                          CAC003
     C**
     C** IF CLOSED  RECORD-ENQUIRY ONLY
     C** OR RECORD-CLOSE TOI MODIFY DATE PORTFOLIO CLOSED
     C**
     C           PNRECI    IFEQ '*'
     C**
     C** IF ACTION CODE 'I', NO MESSAGE
     C**
     C           DDACTN    IFNE 'I'
     C                     MOVE 'CLOSED'  DDDELT
     C                     END
     C**
     C                     ELSE
     C**
     C** IF DATE PORTFOLIO ENTERED THAN PORTFOLIO CLOSURE ASKED
     C**
     C           PNDPCL    IFNE 0
     C                     MOVEL'CLOSURE' DDDELT
     C                     MOVE 'REQUEST 'DDDELT
     C                     END
     C                     END
     C*
     C** IF ENQUIRY PROTECT FIELD INPUT ON S/PM0110C1
     C*
     C           DDACTN    IFEQ 'E'
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN56
     C                     MOVE '1'       *IN57
     C                     END
     C*
     C** IF CLOSE PROTECT FIELD INPUT ON S/PM0110C1
     C*
     C           DDACTN    IFEQ 'C'
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN57
     C                     END
     C*
     C** IF AMEND PROTECT FIELD INPUT ON S/PM0110C1
     C*
     C           DDACTN    IFEQ 'A'
     C                     MOVE '1'       *IN56
     C                     MOVE '1'       *IN57
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE '1'       *IN84                           CPB001
     C                     ENDIF                                          CPB001
     C                     END
     C*
     C** IF INSERT PROTECT FIELD INPUT ON S/PM0110C1
     C*
     C*
     C           DDACTN    IFEQ 'I'
     C                     MOVE '1'       *IN56
     C***********          MOVE '1'       *IN58                           S01486
     C                     END
     C**
     C** FILL DEFINITION SCREEN DETAILS
     C**
     C                     EXSR #TRANS
     C**                                                                  S01486
     C** PROFIT CENTRE PROCESSING                                         S01486
     C**                                                                  S01486
     C                     MOVEL*BLANKS   WWPRFC                          S01486
     C           BKPRCU    IFEQ 'Y'                                       S01486
     C                     EXSR #PFRC                                     S01486
     C                     ELSE                                           S01486
     C***********          MOVE '1'       *IN20                    S01486 119507
     C                     MOVE '1'       *IN03                           119507
     C                     END                                            S01486
     C**
     C** FILL SUBFILE
     C**
     C                     EXSR #READ
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           WWAID     DOUEQ'03'
     C           *IN10     OREQ '1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C**
     C** LOAD INFO MESSAGE
     C**
     C           DDACTN    IFEQ 'C'                                       B8275
     C*********************MOVEL'PM90073' MSMBR4                    B8275 051784
     C                     MOVEL'PM90015' MSMBR4                          051784
     C                     ELSE                                           B8275
     C                     MOVEL'PM90006' MSMBR4
     C                     END                                            B8275
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    DDINFO
     C**
     C** SEND FORMAT
     C**
     C                     WRITEPM0110F3
     C                     WRITEPM0110F1
     C                     EXFMTPM0110F2
     C                     MOVE '0'       *IN80
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**   Clear program message queue                                    R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ                            R00300
     C                     PARM           TOPRQ                           R00300
     C*
     C** Call S/R to move values into WWAID
     C*
     C                     EXSR #ZBAA
     C*
     C** CK12- INITIAL SCREEN
     C*
     C           WWAID     IFEQ '12'
     C                     MOVE '1'       *IN10
     C                     END
     C*
     C** V A L I D A T E   D E T A I L   S C R E E N   I N P U T
     C*
     C           WWAID     IFNE '03'
     C           WWAID     ANDNE'12'
     C**
     C** IF ACTION CODE = I OR A - VALIDATION
     C**
     C           DDACTN    IFEQ 'I'
     C           DDACTN    OREQ 'A'
     C                     EXSR #V1004
     C                     END
     C**
     C** IF ACTION CODE = C - VALIDATION PORTFOLIO CLOSED
     C**
     C           DDACTN    IFEQ 'C'
     C                     EXSR #V1005
     C                     END
     C*
     C** IF VALID DETAILS HAVE BEEN INPUT OBTAIN TNLU
     C*
     C           *IN80     IFEQ '0'
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      WWNEWT  50
     C                     END
     C**
     C** IF INPUT IS VALID PROCESS NEXT
     C**
     C**
     C** ENTER IS PRESSED
     C**
     C           WWAID     IFEQ 'RA'
     C/COPY WNCPYSRC,PM0110C004
     C** ACTION = A
     C           DDACTN    IFEQ 'A'
     C           *IN80     ANDEQ'0'
     C                     EXSR #P1006
     C                     ELSE
     C** ACTION = E
     C           DDACTN    IFEQ 'E'
     C                     EXSR #P1007
     C                     END
     C                     END
     C                     END
     C**
     C** CMD/1 HAS BEEN PRESSED
     C**
     C           WWAID     IFEQ '01'
     C           DDACTN    ANDNE'C'
     C*
     C** IF COMMAND 1 TAKEN CHECK FOR OUTSTANDING INVESTMENT POLICY CHANGES
     C           DDACTN    IFEQ 'A'
     C           *IN80     ANDEQ'0'
     C                     EXSR #P1006
     C                     END
     C           WWAID     IFEQ *BLANKS
     C           WWAID     OREQ '01'
     C           *IN80     IFEQ '0'
     C                     EXSR #P1005
     C                     ELSE
     C*********************MOVEL'PM11401' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11401' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C                     END
     C                     END
     C**
     C** CMD/24 HAS BEEN PRESSED
     C**
     C           WWAID     IFEQ '24'
     C**
     C** PREPARE PARAMETERS TO CALL PM0600
     C**
     C                     MOVEL'0'       WWRTRN
     C                     MOVELWWPNP8    WWCCNM
     C                     MOVELWWPREF    WWPTFR
     C**
     C                     MOVE 'Y'       WW0600  1
     C                     CALL 'PMC0601' LIST1
     C**
     C                     END
     C*
     C** RECEIVE PARAMETER RETURNED FROM INVESTMENT POLICY INPUT
     C** PROGRAM
     C*
     C           WWRTRN    IFEQ '1'                                       R10053
     C                     MOVE '03'      WWAID                           R10053
     C                     ROLBK                                          R10053
     C                     GOTO #P1049                                    R10053
     C                     END                                            R10053
     C**
     C** PROCESS UPDATE OF FILES
     C**
     C                     MOVE '0'       *IN89
     C**
     C           WWAID     IFEQ 'RA'
     C**
     C           DDACTN    IFEQ 'I'
     C           *IN80     ANDEQ'0'
     C           DDACTN    OREQ 'A'
     C           *IN80     ANDEQ'0'
     C           DDACTN    OREQ 'C'
     C           *IN80     ANDEQ'0'
     C           *IN82     ANDEQ'0'                                       B8275
     C           DDACTN    OREQ 'E'
     C           WWAID     ANDEQ'RA'
     C**
     C           DDACTN    IFEQ 'I'
     C           DDACTN    OREQ 'A'
     C           DDACTN    OREQ 'C'
     C**
     C                     EXSR #P1008
     C**
     C** UPDATE OK ?
     C           *IN89     IFEQ '0'
     C                     EXSR #P1009
     C                     ELSE
     C                     MOVE '1'       *IN10
     C                     END
     C**
     C** UPDATE OK ?
     C           *IN89     IFEQ '0'
     C**
     C** UPDATE AUDIT IF ACTION = I
     C**
     C           DDACTN    IFEQ 'I'
     C                     EXSR #P1010
     C                     END
     C**
     C                     END
     C**
     C** COMIT
     C**
     C           CMTTXT    COMIT
     C**
     C                     END
     C**
     C** UPDATE PROCESS CORRECT ?
     C**
     C           *IN89     IFEQ '0'
     C           *IN12     ANDEQ'0'
     C           *IN82     ANDEQ'0'                                       B8275
     C**
     C** DETERMINE WHICH SCREEN TO RETURN TO
     C**
     C           WWREVW    IFEQ 'Y'
     C                     MOVE '1'       *IN11
     C                     ELSE
     C                     MOVE '1'       *IN10
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C*******              ENDSR                                          R10053
     C           #P1049    ENDSR                                          R10053
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #READ    - TO FILL SUBFILE - PORTFOLIO CHARGES                         *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * #ZED     - TO COMPUTE DECIMAL NUMBER AND ACCESS ZEDIT SR               *
      * ZEDIT    - TO OUTPUT NUMERIC FIELDS IN ALPHA                           *
      * ZDATE2   - TO COMPUTE DAY NUMBER IN DATE                               *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      **************************************************************************
     C           #READ     BEGSR
     C**
     C** REINITIALIZE SUBFILE RECORD NUMBER
     C**
     C                     Z-ADD1         RRN2
     C**
     C** CLEAR SUBFILE
     C**
     C                     MOVE '1'       *IN65
     C                     WRITEPM0110C1
     C                     MOVE '0'       *IN65
     C**
     C** LOAD HEADING INFORMATION
     C**
     C           DDACTN    IFNE 'I'
     C                     MOVELPNBCGY    DDBCGY
     C                     MOVELPNCSCY    DDCSCY
     C                     MOVELPNCUSA    DDCUSA
     C                     MOVELPNCUSB    DDBRCA                          085799
     C                     ELSE
     C                     MOVEL*BLANKS   DDBCGY
     C                     MOVEL*BLANKS   DDCSCY
     C                     MOVEL*BLANKS   DDCUSA
     C                     MOVEL*BLANKS   DDBRCA                          085799
     C                     END
     C**
     C** IF ACTION CODE = 'I' - READ CHARGES FILE
     C** IF CHARGES FOUND, DELETE ALL CHARGES FOR THIS PORTFOLIO
     C**
     C           DDACTN    IFEQ 'I'
     C**
     C***********PMPORK    SETLLPMCHRGPP                                  S01486
     C           PMPORK    SETLLPMCHRGPD                                  S01486
     C**
     C           *IN73     DOUEQ'1'
     C**
     C***********PMPORK    READEPMCHRGPP                 73               S01486
     C           PMPORK    READEPMCHRGPD                 73               S01486
     C**
     C           *IN73     IFEQ '0'
     C**
     C                     DELETPMCHRGP0
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C** LOAD SUBFILE
     C**
     C                     MOVE 'N'       WWCHRG  1
     C           RRN2      DOUEQ11
     C**
     C                     Z-ADDRRN2      WWCGSQ
     C                     Z-ADDRRN2      X
     C**
     C           PMCHRK    CHAINPMCHRGXX             73
     C**
     C** INITIALIZE SUBFILE FIELDS
     C**
     C                     Z-ADD0         DDCGSH
     C                     Z-ADD0         DDCSNH
     C                     Z-ADD0         DDCGNH
     C                     MOVEL*BLANKS   DDCGCO
     C                     MOVEL*BLANKS   DDCGCH
     C                     MOVEL*BLANKS   DDCGSP
     C                     MOVEL*BLANKS   DDCGSI
     C                     MOVEL*BLANKS   DDCGEI
     C                     MOVEL*BLANKS   DDCGFQ
     C                     MOVEL*BLANKS   DDCGFH
     C                     MOVEL*BLANKS   DDCGDY
     C                     MOVEL*BLANKS   DDCGND
     C                     MOVEL*BLANKS   DDCGST
     C                     MOVEL*BLANKS   DDCGTH
     C                     MOVEL*BLANKS   DDCSFQ
     C                     MOVEL*BLANKS   DDCSFH
     C                     MOVEL*BLANKS   DDCSDY
     C                     MOVEL*BLANKS   DDCSND
     C                     MOVE 'N'       DDVALD
     C           BKPRCU    IFEQ 'Y'                                       S01486
     C                     MOVEL*BLANKS   DDPRFC                          S01486
     C                     MOVEL*BLANKS   DDPRFH                          S01486
     C                     END                                            S01486
     C**
     C** LOAD SUBFILE IF RECORD FOUND
     C**
     C           *IN73     IFEQ '0'
     C           PORECI    ANDEQ'D'
     C**
     C                     MOVE 'Y'       WWCHRG
     C                     MOVE 'Y'       DDVALD
     C**
     C* LOAD CHARGE CODE
     C                     MOVELPOCGCO    DDCGCO
     C                     MOVELPOCGCO    DDCGCH
     C                     MOVELPOCGCO    CG,X                            080674
     C* COMPUTE ADJUSTMENT AMOUNT, LOAD IT AND CONVERT IT
     C* WITH CURRENCY DECIMAL PLACES
     C           POCGSP    IFNE 0
     C                     Z-ADDPOCGSP    WWCGSP
     C                     MOVE 'Y'       WWREAD  1
     C                     EXSR #ZED
     C                     MOVE 'N'       WWREAD
     C                     MOVE WWCGSP    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDCGSP
     C                     Z-ADDPOCGSP    DDCGSH
     C                     END
     C* LOAD SIGN
     C                     MOVELPOCGSI    DDCGSI
     C* LOAD EFFECTIVE INDICATOR
     C                     MOVELPOCGEI    DDCGEI
     C                     MOVELPOCGEI    DDCGEH
     C                     MOVELPOCGLD    DDCGLH
     C* ACCRUAL DATE FREQUENCY
     C                     MOVELPOCGFQ    DDCGFQ
     C                     MOVELPOCGFQ    DDCGFH
     C* NEXT ACCRUAL DATE
     C           POCGND    IFNE 0
     C                     Z-ADDPOCGND    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DDCGND
     C                     Z-ADDPOCGND    DDCGNH
     C                     END
     C* ACCRUAL DAY
     C           POCGDY    IFNE 0
     C                     MOVELPOCGDY    DDCGDY
     C                     MOVELPOCGDY    DDCGDH
     C                     ELSE
     C                     MOVE *BLANKS   DDCGDH
     C                     END
     C* CHARGE STOPPED
     C                     MOVELPOCGST    DDCGST
     C                     MOVELPOCGST    DDCGTH
     C* CHARGE FREQUENCY
     C                     MOVELPOCSFQ    DDCSFQ
     C                     MOVELPOCSFQ    DDCSFH
     C* SETTLE DAY
     C           POCSDY    IFNE 0
     C                     MOVELPOCSDY    DDCSDY
     C                     MOVELPOCSDY    DDCSDH
     C                     END
     C* NEXT SETTLEMENT DATE
     C           POCSND    IFNE 0
     C                     Z-ADDPOCSND    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DDCSND
     C                     Z-ADDPOCSND    DDCSNH
     C                     END
     C* PROFIT CENTRE                                                     S01486
     C           BKPRCU    IFEQ 'Y'                                       S01486
     C           POPFRC    ANDNE*BLANKS                                   S01486
     C                     MOVELPOPFRC    DDPRFC                          S01486
     C                     MOVELPOPFRC    DDPRFH                          S01486
     C                     END                                            S01486
     C**
     C                     END
     C**
     C** WRITE IN SUBFILE
     C**
     C                     WRITEPM0110S1
     C                     ADD  1         RRN2
     C**
     C                     END
     C*
     C** IF CHARGES ALREADY SET UP PORTFOLIO CHARGE CURRENCY MAY NOT BE
     C** AMENDED
     C*
     C           WWCHRG    IFEQ 'Y'
     C                     MOVE '1'       *IN59
     C                     ELSE
     C                     MOVE '0'       *IN59
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #ZED     - TO COMPUTE DECIMAL NUMBER AND ACCESS ZEDIT SR               *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #READ    - TO FILL SUBFILE - PORTFOLIO CHARGES                         *
      * #V1006   - TO VALIDATE PORTFOLIO CHARGES DETAILS                       *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #ZED      BEGSR
     C*
     C***********PMCODE    CHAINPMCGCDPP             72                   S01486
     C           PMCODE    CHAINPMCGCDPD             72                   S01486
     C           *IN72     IFEQ '1'
     C           P5RECI    ORNE 'D'                        ***************
     C           *LOCK     IN   LDA                                       S01486
     C***********          Z-ADD4         DBASE   30       **DB ERROR 04**S01486
     C***********          MOVEL'PMCGCDPP'DBFILE 10        ***************S01486
     C                     Z-ADD4         DBASE            **DB ERROR 04**S01486
     C                     MOVE 'PMCGCDPD'DBFILE           ***************S01486
     C                     MOVELDDBCGY    WWFIVE  5
     C                     MOVE DDCGCO    WWFIVE
     C***********          MOVELWWFIVE    DBKEY  29                       S01486
     C                     MOVELWWFIVE    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     END
     C*
     C** CALCULATE NUMBER OF DECIMALS AND INTEGERS FOR FLAT RATE
     C*
     C           P5CGBS    IFEQ 'F'
     C*
     C** SET UP NUMBER OF DECIMAL PLACES ACCORDING TO WHETHER CALLED
     C** FROM SR/#READ OR SR/#V1006
     C*
     C           WWREAD    IFEQ 'Y'
     C                     Z-ADDPNBCGD    ZADEC
     C                     ELSE
     C                     Z-ADDWWBCGY    ZADEC
     C                     END
     C*
     C           13        SUB  ZADEC     ZADIG
     C                     END
     C**
     C*
     C** CALCULATE NUMBER OF DECIMALS AND INTEGERS FOR PERCENTAGE RATE
     C           P5CGBS    IFEQ 'P'
     C                     Z-ADD7         ZADEC
     C                     Z-ADD6         ZADIG
     C                     END
     C**
     C                     MOVE *BLANKS   ZFIELD
     C**
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #TRANS   - TO ACCESS FILE AND FILL DISPLAY FIELDS                      *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * ZDATE2   - TO COMPUTE DAY NUMBER IN DATE                               *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #TRANS    BEGSR                           ** #TRANS BSR**
     C**
     C           DDACTN    IFEQ 'I'
     C                     MOVEL*BLANKS   DDPTCY
     C                     MOVEL*BLANKS   DDPTFN
     C                     MOVEL*BLANKS   DDPTFT
     C                     MOVEL*BLANKS   DDCFGC                          S01307
     C                     MOVEL*BLANKS   DDMNGI
     C                     MOVEL*BLANKS   DDDPOP
     C                     Z-ADDBJRDNB    ZDAYNO                          S01313
     C                     EXSR ZDATE2                                    S01313
     C                     MOVE ZDATE     DDDPOP                          S01313
     C                     Z-ADDBJRDNB    WWDPOP  50                      S01313
     C                     MOVEL*BLANKS   DDDPCL
     C                     MOVEL*BLANKS   DDACSQ                          S71062
     C                     MOVEL*BLANKS   DDPDGS
     C                     MOVEL*BLANKS   DDPDGF
     C                     MOVEL*BLANKS   DDVLFQ
     C                     MOVEL*BLANKS   DDVLDM
     C                     MOVEL*BLANKS   DDVLND
     C****                 MOVEL*BLANKS   DDAAD1                          S01313
     C****                 MOVEL*BLANKS   DDAAD2                          S01313
     C****                 MOVEL*BLANKS   DDAAD3                          S01313
     C****                 MOVEL*BLANKS   DDAAD4                          S01313
     C****                 MOVEL*BLANKS   DDAAD5                          S01313
     C                     MOVEL*BLANKS   DDS1VR                          S01313
     C                     MOVEL*BLANKS   DDS2VR
     C                     MOVEL*BLANKS   DDS3VR
     C                     MOVEL*BLANKS   DDS4VR
     C                     MOVEL*BLANKS   DDS5VR
     C                     MOVEL*BLANKS   DDS6VR
     C                     MOVEL*BLANKS   DDS7VR                          S01313
     C                     MOVEL*BLANKS   DDS8VR                          S01313
     C                     MOVEL*BLANKS   DDS9VR                          CPM005
     C                     MOVEL*BLANKS   DDS0VR                          CPM005
     C                     MOVEL*BLANKS   DDRPYP                          S01313
     C                     MOVE *BLANKS   DDTYSM                          S01313
     C                     MOVEL*BLANKS   DDADPP                          S01313
     C                     MOVEL*BLANKS   DDPSDT                          S01313
     C                     MOVE *BLANKS   DDPMNG                          S01313
     C                     MOVEL*BLANKS   DDCASF
     C                     MOVEL*BLANKS   DDCASD
     C                     MOVEL*BLANKS   DDCASN
     C                     MOVEL*BLANKS   DDPOLC
     C                     MOVEL'N'       DDIPIN
     C                     MOVEL'N'       DDCYIN
     C                     MOVEL'N'       DDYPIN
     C                     MOVEL'N'       DDNPIN
     C*                                                                   CAC003
     C** If Analytical Accounting is switched on;                         CAC003
     C           *IN87     IFEQ '1'                                       CAC003
     C                     MOVE *BLANKS   DDPRF2                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C** DDACTN = A, E OR C
     C                     ELSE
     C*                                                                   CAC003
     C** If Analytical Accounting is switched on;                         CAC003
     C           *IN87     IFEQ '1'                                       CAC003
     C                     MOVE PNPRFC    DDPRF2                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     MOVELPNPTCY    DDPTCY
     C                     MOVELPNPTFN    DDPTFN
     C                     MOVELPNPTFT    DDPTFT
     C*                                                                   S01307
     C           *IN70     IFEQ '1'                                       S01307
     C                     MOVELPNCFGC    DDCFGC                          S01307
     C                     END                                            S01307
     C*                                                                   S01307
     C           *IN20     IFEQ *ON                                       S71062
     C           PNACSQ    IFNE *ZEROS                                    S71062
     C                     MOVE PNACSQ    DDACSQ                          S71062
     C                     ELSE                                           S71062
     C                     MOVE *BLANKS   DDACSQ                          S71062
     C                     ENDIF                                          S71062
     C                     ENDIF                                          S71062
     C*                                                                   S71062
     C                     MOVELPNMNGI    DDMNGI
     C**
     C** LOAD DAY NUMBER (DATE PORTFOLIO OPENED) AND CONVERT IT
     C**
     C           PNDPOP    IFNE 0
     C                     Z-ADDPNDPOP    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DDDPOP
     C                     Z-ADDPNDPOP    WWDPOP                          45330
     C                     ELSE
     C                     MOVEL*BLANKS   DDDPOP
     C                     END
     C**
     C** LOAD DAY NUMBER (DATE PORTFOLIO CLOSED) AND CONVERT IT
     C**
     C           PNDPCL    IFNE 0
     C                     Z-ADDPNDPCL    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DDDPCL
     C                     ELSE
      *                                                                   B8275
     C           DDACTN    IFEQ 'C'                                       B8275
     C                     Z-ADDBJRDNB    ZDAYNO  50                      B8275
     C                     EXSR ZDATE2                                    B8275
     C                     MOVELZDATE     DDDPCL                          B8275
     C                     ELSE                                           B8275
     C                     MOVEL*BLANKS   DDDPCL                          B8275
     C                     END                                            B8275
      *                                                                   B8275
     C                     END
     C**                                                                  S71062
     C           PNACSQ    IFNE 0                                         S71062
     C                     MOVE PNACSQ    DDACSQ                          S71062
     C                     ELSE                                           S71062
     C                     MOVE *BLANKS   DDACSQ                          S71062
     C                     ENDIF                                          S71062
     C**
     C** LOAD DAY NUMBER (PLEDGE START DATE) AND CONVERT IT
     C**
     C           PNPDGS    IFNE 0
     C                     Z-ADDPNPDGS    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DDPDGS
     C                     ELSE
     C                     MOVEL*BLANKS   DDPDGS
     C                     END
     C**
     C** LOAD DAY NUMBER (PLEDGE FINISH DATE) AND CONVERT IT
     C**
     C           PNPDGF    IFNE 0
     C           PNPDGF    ANDNE99999
     C                     Z-ADDPNPDGF    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DDPDGF
     C                     ELSE
     C                     MOVEL*BLANKS   DDPDGF
     C                     END
     C**
     C                     MOVELPNVLFQ    DDVLFQ
     C**
     C           PNVLDM    IFEQ 0
     C                     MOVEL*BLANKS   DDVLDM
     C                     ELSE
     C                     MOVELPNVLDM    DDVLDM
     C                     END
     C**
     C** LOAD DAY NUMBER (NEXT VAL.    DATE) AND CONVERT IT
     C**
     C           PNVLND    IFNE 0
     C                     Z-ADDPNVLND    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DDVLND
     C                     ELSE
     C                     MOVEL*BLANKS   DDVLND
     C                     END
     C**
     C** LOAD ADDRESSES CODES
     C**
     C****                 MOVELPNAAD1    DDAAD1                          S01313
     C****                 MOVELPNAAD2    DDAAD2                          S01313
     C****                 MOVELPNAAD3    DDAAD3                          S01313
     C****                 MOVELPNAAD4    DDAAD4                          S01313
     C****                 MOVELPNAAD5    DDAAD5                          S01313
     C**
     C                     MOVELPNS1VR    DDS1VR                          S01313
     C                     MOVELPNS2VR    DDS2VR
     C                     MOVELPNS3VR    DDS3VR
     C                     MOVELPNS4VR    DDS4VR
     C                     MOVELPNS5VR    DDS5VR
     C                     MOVELPNS6VR    DDS6VR
     C                     MOVELPNS7VR    DDS7VR                          S01313
     C                     MOVELPNS8VR    DDS8VR                          S01313
     C                     MOVELPNS9VR    DDS9VR                          CPM005
     C                     MOVELPNS0VR    DDS0VR                          CPM005
     C**                                                                  S01313
     C                     MOVELPNRPYP    DDRPYP                          S01313
     C           PNTYSM    IFNE 0                                         S01313
     C                     MOVELPNTYSM    DDTYSM                          S01313
     C                     ELSE                                           S01313
     C                     MOVE *BLANKS   DDTYSM                          S01313
     C                     END                                            S01313
     C                     MOVELPNADPP    DDADPP                          S01313
     C                     Z-ADDPNPSDT    WAPSDT  50                      S01313
     C           PNPSDT    IFNE 0                                         S01313
     C           PNPSDT    ANDNE99999                                     S01313
     C                     Z-ADDPNPSDT    ZDAYNO                          S01313
     C                     EXSR ZDATE2                                    S01313
     C                     MOVELZDATE     DDPSDT                          S01313
     C                     ELSE                                           S01313
     C                     MOVEL*BLANKS   DDPSDT                          S01313
     C                     END                                            S01313
     C                     MOVELPNPMNG    DDPMNG                          S01313
     C**
     C                     MOVELPNCASF    DDCASF
     C           PNCASD    IFNE 0
     C                     MOVE PNCASD    DDCASD
     C                     ELSE
     C                     MOVEL*BLANKS   DDCASD
     C                     END
     C**
     C           PNCASN    IFNE 0
     C                     Z-ADDPNCASN    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DDCASN
     C                     ELSE
     C                     MOVEL*BLANKS   DDCASN
     C                     END
     C**
     C                     MOVELPNPOLC    DDPOLC
     C                     MOVELPNIPIN    DDIPIN
     C                     MOVELPNCYIN    DDCYIN
     C                     MOVELPNYPIN    DDYPIN
     C                     MOVELPNNPIN    DDNPIN
     C                     MOVELPNIPIN    DDIPIH
     C                     MOVELPNCYIN    DDCYIH
     C                     MOVELPNYPIN    DDYPIH
     C                     MOVELPNNPIN    DDNPIH
     C**
     C                     END
     C**
     C                     ENDSR
      **
     C*
      **************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #V1004   - TO VALIDATE PORTFOLIO DEFINITION DETAILS                    *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      **********ZA0240   - TO ACCESS MESSAGE FILE AND SEND MESSAGE        R00300
      * ZASNMS   - WRITE ERROR MESSAGES                                   R00300
      * ZDATE2   - TO COMPUTE DAY NUMBER IN DATE                               *
      * ZDATE1   - TO COMPUTE DATE IN DAY NUMBER                               *
      * ZFRQA    - TO INCREMENT A DAY NUMBER DATE BY A VALUE                   *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      **************************************************************************
     C           #V1004    BEGSR                           ** #V1004 BSR**
     C**
     C                     MOVE *OFF      *IN07                           S71062
     C                     MOVE '0'       *IN16                           S01313
     C                     MOVE '0'       *IN17                           S01313
     C                     MOVE '0'       *IN18                           S01313
     C                     MOVE '0'       *IN19                           S01313
     C                     MOVE '0'       *IN09                           S01313
     C                     MOVE '0'       *IN32
     C                     MOVE '0'       *IN33
     C                     MOVE '0'       *IN34
     C                     MOVE '0'       *IN35
     C                     MOVE '0'       *IN36
     C                     MOVE '0'       *IN37
     C                     MOVE '0'       *IN38
     C                     MOVE '0'       *IN39
     C                     MOVE '0'       *IN40
     C                     MOVE '0'       *IN41
     C                     MOVE '0'       *IN42
     C                     MOVE '0'       *IN43
     C                     MOVE '0'       *IN44
     C                     MOVE '0'       *IN45
     C                     MOVE '0'       *IN46
     C                     MOVE '0'       *IN47
     C                     MOVE '0'       *IN48
     C                     MOVE '0'       *IN49
     C                     MOVE '0'       *IN50
     C                     MOVE '0'       *IN51
     C                     MOVE '0'       *IN52
     C                     MOVE '0'       *IN53
     C                     MOVE '0'       *IN54
     C                     MOVE '0'       *IN55
     C                     MOVE '0'       *IN66
     C                     MOVE '0'       *IN67
     C                     MOVE '0'       *IN68
     C                     MOVE '0'       *IN69                           S01307
     C                     MOVE '0'       *IN74
     C                     MOVE '0'       *IN75
     C                     MOVE '0'       *IN76
     C                     MOVE '0'       *IN15                           CPM005
     C                     MOVE '0'       *IN78                           CPM005
     C*                                                                   CAC003
     C** If Analytical Accounting is switched on;                         CAC003
     C           *IN87     IFEQ '1'                                       CAC003
     C                     MOVE '0'       *IN06                           CAC003
     C                     ENDIF                                          CAC003
     C*
     C** SET DATE DETAILS FROM PREVIOUS SCREEN TO ZERO
     C*
     C                     Z-ADD0         PNVLND
     C                     Z-ADD0         PNPDGS
     C                     Z-ADD0         PNPDGF
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDPTCY    PORTFOLIO CURRENCY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF NOT ENTERED DEFAULT TO BASE CURRENCY
     C**
     C           DDPTCY    IFEQ *BLANKS
     C                     MOVE QBCSBY    DDPTCY
     C                     END
     C**
     C** IF ENTERED MUST BE A VALID CURRENCY ON SDCURRL0
     C**
     C***********DDPTCY    CHAINSDCURRL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C*********************MOVEL'PM11201' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM DDPTCY    WWKEY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     MOVEL'PM11201' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN32
     C                     ELSE
     C                     Z-ADDA6NBDP    WWPTCY  10
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDPTFN   PORTFOLIO NARRATIVE
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C** MUST BE ENTERED
     C**
     C           DDPTFN    IFEQ *BLANKS
     C*********************MOVEL'PM11202' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11202' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN33
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDPTFT   PORTFOLIO TYPE
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C** MUST BE A VALID PORTFOLIO TYPE - IF ENTERED
     C**
     C           DDPTFT    IFNE *BLANKS
     C**
     C***********DDPTFT    CHAINPMPTFTPP             72                   S01486
     C           DDPTFT    CHAINPMPTFTPD             72                   S01486
     C           *IN72     IFEQ '1'
     C           PERECI    OREQ '*'
     C*********************MOVEL'PM11203' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11203' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN34
     C                     END
     C**
     C                     END
     C*                                                                   S01307
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++             S01307
     C** VAL4DDCFGC    CUSTODY GROUP CODE                                 S01307
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++             S01307
     C**                                                                  S01307
     C           *IN70     IFEQ '1'                                       S01307
     C           DDCFGC    ANDNE*BLANKS                                   S01307
     C                     MOVE WWPNP8    WWCUSK  6                       S01307
     C***********WWCUSK    CHAINSDSECSL0             72            S01307 S01486
     C                     CALL 'AOSECSR0'                                S01486
     C                     PARM '*MSG    'WWRTCD                          S01486
     C                     PARM '*KEY    'WWOPTN                          S01486
     C                     PARM WWCUSK    WWCFGC  6                       S01486
     C           SDSECS    PARM SDSECS    DSSDY                           S01486
     C** Customer is not subject to SC Fees                               S01307
     C***********BFSBJF    IFNE 'Y'                                S01307 S01486
     C           BFASIN    IFNE 'Y'                                S01307 S01486
     C                     MOVEL'PM11250' ZAMSID                          S01307
     C                     EXSR ZASNMS                                    S01307
     C                     MOVE '1'       *IN80                           S01307
     C                     MOVE '1'       *IN69                           S01307
     C                     ELSE                                           S01307
     C*                                                                   S01307
     C***********DDCFGC    CHAINSCCFGRPD             72            S01307 S01486
     C           DDCFGC    CHAINSECFGRPD             72                   S01486
     C*                                                                   S01307
     C** Custody Group Code entered is not valid                          S01307
     C           *IN72     IFEQ '1'                                       S01307
     C                     MOVEL'PM11251' ZAMSID                          S01307
     C                     EXSR ZASNMS                                    S01307
     C                     MOVE '1'       *IN80                           S01307
     C                     MOVE '1'       *IN69                           S01307
     C                     END                                            S01307
     C*                                                                   S01307
     C                     END                                            S01307
     C*                                                                   S01307
     C                     END                                            S01307
     C*                                                                   S01307
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDMNGI    MANAGED INDICATOR
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C** MUST BE ENTERED AND EQUAL TO 'M' , 'P' OR 'U'
     C**
     C           DDMNGI    IFNE 'M'
     C           DDMNGI    ANDNE'P'
     C           DDMNGI    ANDNE'U'
     C*********************MOVEL'PM11204' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11204' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN35
     C                     END
     C****+++++++++++++++++++++++++++++++++++++++++++++++++++             S01313
     C****AL4DDDPOP    DATE PORTFOLIO OPENED                              S01313
     C****+++++++++++++++++++++++++++++++++++++++++++++++++++             S01313
     C****                                                                S01313
     C****F NOT ENTERED DEFAULT TO RUN DATE                               S01313
     C****                                                                S01313
     C****       DDDPOP    IFEQ *BLANKS                                   S01313
     C****                 Z-ADDBJRDNB    ZDAYNO  50                      S01313
     C****                 EXSR ZDATE2                                    S01313
     C****                 MOVELZDATE     DDDPOP                          S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****F ENTERED WITH DEFAULT COMPUTE DATE IN DAY NUM                  S01313
     C****THERWISE CHECK IF DATE IS VALID AND COMPUTE IT                  S01313
     C****                                                                S01313
     C****                 Z-ADD0         WWDAT1                          S01313
     C****                 MOVE *BLANKS   WWDAT2                          S01313
     C****                 MOVE DDDPOP    WWDAT1                          S01313
     C****                 MOVE WWDAT1    WWDAT2                          S01313
     C****                                                                S01313
     C****                 MOVE DDDPOP    ZDATE                           S01313
     C****                 EXSR ZDATE1                                    S01313
     C****       *IN99     IFEQ '1'                                       S01313
     C****       WWDAT2    ORNE DDDPOP                                    S01313
     C*********************MOVEL'PM11205' MSGID                           S01313
     C*********************CALL 'ZA0240'                                  S01313
     C*********************PARM           MSGID                           S01313
     C****                 MOVEL'PM11205' ZAMSID                          S01313
     C****                 EXSR ZASNMS                                    S01313
     C****                 MOVE '1'       *IN80                           S01313
     C****                 MOVE '1'       *IN36                           S01313
     C****                 ELSE                                           S01313
     C****                 Z-ADDZDAYNO    WWDPOP                          S01313
     C****                 END                                            S01313
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++             S71062
     C** VAL4DDACSQ   FF MARGIN A/C SEQUENCE                              S71062
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++             S71062
     C                     MOVE *OFF      *IN07                           S71062
     C** Test if fututre & options module is on                           S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           BGFUOP    IFEQ 'Y'                        B1             S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C** TEST IF ENTERED                                                  S71062
     C           DDACSQ    IFEQ *BLANKS                    B2             S71062
     C                     MOVE '01'      DDACSQ                          S71062
     C                     ELSE                            X2             S71062
     C* Field entered -> must be numeric                                  S71062
     C                     TESTN          DDACSQ     83                   S71062
     C           *IN83     IFEQ *OFF                       B3             S71062
     C                     MOVEL'PM11273' ZAMSID                          S71062
     C                     EXSR ZASNMS                                    S71062
     C                     MOVE *ON       *IN80                           S71062
     C                     MOVE *ON       *IN07                           S71062
     C                     ENDIF                           E3             S71062
     C                     ENDIF                           E2             S71062
     C                     ENDIF                           E1             S71062
     C**                                                                  S71062
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDPDGS   PLEDGE START DATE IF LOMBARD CREDITS NOT ON SYSTEM
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           BGLMCR    IFEQ 'N'                        - B1
     C**
     C           DDPDGS    IFNE *BLANKS                    - B2
     C**
     C** IF ENTERED PLEDGE FINISH DATE MUST ALSO BEEN SPECIFIED
     C**
     C           DDPDGF    IFEQ *BLANKS                    - B3
     C*********************MOVEL'PM11206' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11206' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN39
     C                     END                             - E3
     C*
     C**
     C** IF ENTERED MUST BE A VALID DATE
     C**
     C                     Z-ADD0         WWDAT1
     C                     MOVE *BLANKS   WWDAT2
     C                     MOVE DDPDGS    WWDAT1
     C                     MOVE WWDAT1    WWDAT2
     C**
     C                     MOVELDDPDGS    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'                        - B3
     C           DDPDGS    ORNE WWDAT2
     C*********************MOVEL'PM11207' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11207' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN38
     C                     ELSE                            - X3
     C                     Z-ADDZDAYNO    WWPDGS
     C                     END                             - E3
     C*
     C**
     C** IF ENTERED CANNOT BE BEFORE DATE PORTFOLIO OPEN
     C**
     C           WWPDGS    IFLT WWDPOP                     - B3
     C*********************MOVEL'PM11208' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11208' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN38
     C                     END                             - E3
     C*
     C                     ELSE                            - X2
     C**
     C** IF DATE BLANKED OR NOT ENTERED
     C*
     C                     Z-ADD0         WWPDGS
     C*
     C                     END                             - E2
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDPDGF    PLEDGE FINISH DATE
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDPDGF    IFNE *BLANKS                    - B2
     C**
     C** IF ENTERED PLEDGE START DATE MUST ALSO BEEN SPECIFIED
     C**
     C           DDPDGS    IFEQ *BLANKS                    - B3
     C*********************MOVEL'PM11209' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11209' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN38
     C                     END                             - E3
     C*
     C**
     C** IF ENTERED MUST BE A VALID DATE
     C**
     C                     Z-ADD0         WWDAT1
     C                     MOVE *BLANKS   WWDAT2
     C                     MOVE DDPDGF    WWDAT1
     C                     MOVE WWDAT1    WWDAT2
     C                     MOVELDDPDGF    ZDATE
     C**
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'                        - B3
     C           DDPDGF    ORNE WWDAT2
     C*********************MOVEL'PM11210' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11210' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN39
     C                     ELSE                            - X3
     C                     Z-ADDZDAYNO    WWPDGF
     C                     END                             - E3
     C*
     C**
     C** IF ENTERED MUST BE AFTER PLEDGE START DATE
     C**
     C           WWPDGF    IFLE WWPDGS                     - B3
     C*********************MOVEL'PM11211' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11211' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN39
     C                     END                             - E3
     C*
     C                     ELSE                            - X2
     C**
     C** IF DATE BLANKED OR NOT ENTERED
     C*
     C                     Z-ADD0         WWPDGF
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C** DATE PORTFOLIO MAY NOT BE AFTER PLEDGE START DTAE
     C*
     C                     MOVE 'N'       WWDPER  1
     C           BGLMCR    IFEQ 'N'
     C           WWDPOP    IFGT WWPDGS
     C           WWPDGS    ANDNE0
     C                     MOVE 'Y'       WWDPER
     C                     END
     C                     ELSE
     C*
     C           WWDPOP    IFLT PNPDGS
     C           PNPDGS    ANDNE0
     C                     MOVE 'Y'       WWDPER
     C                     END
     C                     END
     C**
     C** IF EROR FLAG ON THEN SEND ERROR MESSAGE
     C**
     C           WWDPER    IFEQ 'Y'
     C*********************MOVEL'PM11233' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11233' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN36
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++             CAC003
     C** VAL4DDPRFC     Profit Centre                                     CAC003
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++             CAC003
     C**                                                                  CAC003
     C           *IN87     IFEQ '1'                                       CAC003
     C*                                                                   CAC003
     C           DDPRF2    IFNE *BLANKS                                   CAC003
     C                     CALL 'AOPRFCR0'                                CAC003
     C                     PARM *BLANKS   WWRTCD                          CAC003
     C                     PARM '*KEY   ' WWOPTN                          CAC003
     C                     PARM DDPRF2    WWKEY4  4                       CAC003
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC003
     C           WWRTCD    IFNE *BLANKS                                   CAC003
     C                     MOVEL'PM14206' ZAMSID                          CAC003
     C                     EXSR ZASNMS                                    CAC003
     C                     MOVE '1'       *IN06                           CAC003
     C                     MOVE '1'       *IN80                           CAC003
     C                     ELSE                                           CAC003
     C                     MOVE DSPCCD    DDPRF2                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C*  Else, if no profit centre entered;                               CAC003
     C                     ELSE                                           CAC003
     C           BKPCDU    IFEQ 'Y'                                       CAC003
     C                     EXSR #PFRC                                     CAC003
     C                     MOVE WWPRFC    DDPRF2                          CAC003
     C                     ELSE                                           CAC003
     C                     MOVEL'PM14207' ZAMSID                          CAC003
     C                     EXSR ZASNMS                                    CAC003
     C                     MOVE '1'       *IN06                           CAC003
     C                     MOVE '1'       *IN80                           CAC003
     C                     ENDIF                                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDVLFQ     VALUATION FREQUENCY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C                     MOVE 'Y'       WWVALD  1
     C           DDVLFQ    IFNE *BLANKS
     C*
     C**
     C** IF ENTERED MUST BE EQUAL TO 'M', 'Q', 'X' OR 'Y'
     C**
     C           DDVLFQ    IFNE 'M'
     C           DDVLFQ    ANDNE'Q'
     C           DDVLFQ    ANDNE'X'
     C           DDVLFQ    ANDNE'Y'
     C                     MOVE 'N'       WWVALD
     C*********************MOVEL'PM11213' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11213' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN40
     C                     END
     C**
     C** IF ENTERED VALUATION DAY IN MONTH MUST ALSO BE SPECIFIED
     C**
     C           DDVLDM    IFEQ *BLANKS
     C                     MOVE 'N'       WWVALD
     C*********************MOVEL'PM11212' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11212' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN41
     C                     END
     C*
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDVLDM      VALUATION DAY IN MONTH
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDVLDM    IFNE *BLANKS
     C**
     C** IF ENTERED VALUIATION FREQUENCY MUST ALSO BEEN ENTERED
     C**
     C           DDVLFQ    IFEQ *BLANKS
     C                     MOVE 'N'       WWVALD
     C*********************MOVEL'PM11214' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11214' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN40
     C                     END
     C*
     C**
     C** IF ENTERED MUST BE IN THE RANGE 1-31
     C**
     C                     MOVE DDVLDM    WWVLDM
     C                     MOVE WWVLDM    WWVVDM
     C           WWVVDM    IFNE DDVLDM
     C           WWVLDM    ORLT 1
     C           WWVLDM    ORGT 31
     C                     MOVE 'N'       WWVALD
     C*********************MOVEL'PM11215' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11215' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN41
     C                     END
     C*
     C                     END
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDVLND       NEXT VALUATION DATE
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C                     Z-ADD0         WWVLND
     C           DDVLND    IFNE *BLANKS
     C*
     C** IF ENTERED MUST BE A VALID DATE
     C**
     C                     Z-ADD0         WWDAT1
     C                     MOVE *BLANKS   WWDAT2
     C                     MOVE DDVLND    WWDAT1
     C                     MOVE WWDAT1    WWDAT2
     C**
     C                     MOVELDDVLND    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C           DDVLND    ORNE WWDAT2
     C*********************MOVEL'PM11216' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11216' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN42
     C                     ELSE
     C                     Z-ADDZDAYNO    WWVLND
     C                     END
     C*
     C** IF ENTERED MUST NOT BE BEFORE RUN DATE
     C**
     C           WWVLND    IFLT BJRDNB
     C*********************MOVEL'PM11217' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11217' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN42
     C                     END
     C*
     C                     ELSE
     C** IF NOT ENTERED AND
     C** IF VALUATION FREQUENCY AND DAY IN MONTH ENTERED
     C** CALCULATE IT
     C**
     C           DDVLFQ    IFNE *BLANK
     C           DDVLDM    ANDNE*BLANK
     C           WWVALD    ANDEQ'Y'
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     MOVELDDVLFQ    ZFREQ
     C                     MOVELDDVLDM    ZMDAY
     C                     MOVELBJLCCY    ZCCY
     C                     EXSR ZFRQA
     C                     Z-ADDZDAYNO    WWVLND
     C                     END
     C*
     C** IF VALUATION DAY IN MONTH SAME AS TODAYS DATE DEFAULT NEXT
     C** VALUATION DATE TO RUN DATE
     C*
     C                     MOVELBJMRDT    WWDAY   20
     C           WWVLDM    IFEQ WWDAY
     C                     Z-ADDBJRDNB    WWVLND
     C                     END
     C                     END
     C****+++++++++++++++++++++++++++++++++++++++++++++++++++             S01313
     C****AL4DDAAD       ALTERNATE ADDRESS CODES                          S01313
     C****+++++++++++++++++++++++++++++++++++++++++++++++++++             S01313
     C****                 MOVE '0'       *IN83                           S01313
     C****                 MOVE '0'       *IN84                           S01313
     C****                 MOVE DDAAD1    DDAD,1                          S01313
     C****                 MOVE DDAAD2    DDAD,2                          S01313
     C****                 MOVE DDAAD3    DDAD,3                          S01313
     C****                 MOVE DDAAD4    DDAD,4                          S01313
     C****                 MOVE DDAAD5    DDAD,5                          S01313
     C****                 MOVE 'N'       WWMSG   1                       S01313
     C****                 MOVE 'N'       WWMSG1  1                       S01313
     C****                 MOVE WWPNP8    WWCCNM                          S01313
     C****                 MOVEA*BLANKS   AD,1                            S01313
     C****                                                                S01313
     C****ALIDATE ALTERNATE NAME AND ADDRESS INFROMATION                  S01313
     C****                                                                S01313
     C****       1         DO   5         X                - B1           S01313
     C****       DDAD,X    IFNE *BLANKS                    - B2           S01313
     C****                                                                S01313
     C****HECK THAT ADDREES IS UNIQUE                                     S01313
     C****                                                                S01313
     C****       DDAD,X    LOKUPAD,1                     77               S01313
     C****                                                                S01313
     C****       *IN77     IFEQ '1'                        - B3           S01313
     C****       WWMSG     IFEQ 'N'                        - B4           S01313
     C*********************MOVEL'PM11229' MSGID                           S01313
     C*********************CALL 'ZA0240'                                  S01313
     C*********************PARM           MSGID                           S01313
     C****                 MOVEL'PM11229' ZAMSID                          S01313
     C****                 EXSR ZASNMS                                    S01313
     C****                 MOVE 'Y'       WWMSG                           S01313
     C****                 MOVE '1'       *IN80                           S01313
     C****                 END                             - E4           S01313
     C****                 Z-ADD42        WW                              S01313
     C****       WW        ADD  X         WW                              S01313
     C****                 MOVE '1'       *IN,WW                          S01313
     C****                 END                             - E3           S01313
     C****                                                                S01313
     C****TORE ADDRESS IN ARRAY OF ADDRESSES                              S01313
     C****                                                                S01313
     C****       *IN77     IFEQ '0'                        - B3           S01313
     C****                 MOVE DDAD,X    AD,X                            S01313
     C****                 END                             - E3           S01313
     C****                                                                S01313
     C****HECK THAT ALTERNATE ADDRESS EXISTS ON FILE                      S01313
     C****                                                                S01313
     C****                 MOVELDDAD,X    WWALTN                          S01313
     C****       SDALT     CHAINSDALTNL1             72                   S01313
     C****       *IN72     IFEQ '1'                        - B3           S01313
     C****                                                                S01313
     C****       WWMSG1    IFEQ 'N'                        - B4           S01313
     C*********************MOVEL'PM11230' MSGID                           S01313
     C*********************CALL 'ZA0240'                                  S01313
     C*********************PARM           MSGID                           S01313
     C****                 MOVEL'PM11230' ZAMSID                          S01313
     C****                 EXSR ZASNMS                                    S01313
     C****                 MOVE 'Y'       WWMSG                           S01313
     C****                 MOVE '1'       *IN80                           S01313
     C****                 END                             - E4           S01313
     C****                 Z-ADD42        WW                              S01313
     C****       WW        ADD  X         WW                              S01313
     C****                 MOVE '1'       *IN,WW                          S01313
     C****                 END                             - E3           S01313
     C****                 END                             - E2           S01313
     C****                 END                             - E1           S01313
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDS2VR  SECTIONS OF VALUATION STATEMENT REQUIRED
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C** IF ANY OF VALUATION STATEMENT FREQUENCY, DAY IN MONTH OR NEXT
     C** VALUATION DATE ARE ENTERED SECTIONS MUST BE ENTERED
     C           DDVLFQ    IFNE *BLANKS
     C           DDVLDM    ORNE *BLANKS
     C           DDVLND    ORNE *BLANKS
     C*                                                                   S01313
     C                     MOVE 'N'       WWMSG                           S01313
     C           DDS1VR    IFEQ *BLANKS                                   S01313
     C                     MOVE 'Y'       DDS1VR                          S01313
     C                     ELSE                                           S01313
     C           DDS1VR    IFNE 'Y'                                       S01313
     C           DDS1VR    ANDNE'N'                                       S01313
     C                     MOVEL'PM11219' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN43                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END                                            S01313
     C                     END                                            S01313
     C*
     C           DDS2VR    IFEQ *BLANKS
     C                     MOVE 'Y'       DDS2VR
     C                     ELSE
     C           DDS2VR    IFNE 'Y'
     C           DDS2VR    ANDNE'N'
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       R00300
     C                     MOVEL'PM11219' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            R00300
     C                     MOVE '1'       *IN80
     C*******              MOVE '1'       *IN48                           S01313
     C                     MOVE '1'       *IN44                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C                     END
     C**
     C           DDS3VR    IFEQ *BLANKS
     C*                                                                   S01313
     C** DEFAULT ACCORDING TO WHETHER PERFORMANCE PERIOD REQUIRED         S01313
     C           DDRPYP    IFEQ 'Y'                                       S01313
     C                     MOVE 'Y'       DDS3VR                          S01313
     C                     ELSE                                           S01313
     C                     MOVE 'N'       DDS3VR                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C                     ELSE
     C           DDS3VR    IFNE 'Y'
     C           DDS3VR    ANDNE'N'
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       R00300
     C                     MOVEL'PM11219' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            R00300
     C                     MOVE '1'       *IN80
     C****                 MOVE '1'       *IN74                           S01313
     C                     MOVE '1'       *IN45                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C                     END
     C*                                                                   S01313
     C** MAY ONLY BE SET TO 'Y' IF PERFORMANCE PERIOD REQUIRED            S01313
     C           DDS3VR    IFEQ 'Y'                                       S01313
     C           DDRPYP    ANDNE'Y'                                       S01313
     C                     MOVEL'PM11261' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN45                           S01313
     C                     END                                            S01313
     C**
     C           DDS4VR    IFEQ *BLANKS
     C*                                                                   S01313
     C** DEFAULT ACCORDING TO WHETHER PERFORMANCE PERIOD REQUIRED         S01313
     C           DDTYSM    IFNE *BLANKS                                   S01313
     C                     MOVE 'Y'       DDS4VR                          S01313
     C                     ELSE                                           S01313
     C                     MOVE 'N'       DDS4VR                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C                     ELSE
     C           DDS4VR    IFNE 'Y'
     C           DDS4VR    ANDNE'N'
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       R00300
     C                     MOVEL'PM11219' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            R00300
     C                     MOVE '1'       *IN80
     C****                 MOVE '1'       *IN75                           S01313
     C                     MOVE '1'       *IN46                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C                     END
     C*                                                                   S01313
     C** MAY ONLY BE SET TO 'Y' IF PERFORMANCE PERIOD REQUIRED            S01313
     C           DDS4VR    IFEQ 'Y'                                       S01313
     C           DDTYSM    ANDEQ'  '                                      S01313
     C                     MOVEL'PM11262' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN46                           S01313
     C                     END                                            S01313
     C**
     C           DDS5VR    IFEQ *BLANKS
     C*                                                                   S01313
     C** DEFAULT ACCORDING TO WHETHER PERFORMANCE PERIOD REQUIRED         S01313
     C           DDADPP    IFEQ 'Q'                                       S01313
     C           DDADPP    OREQ 'H'                                       S01313
     C                     MOVE 'Y'       DDS5VR                          S01313
     C                     ELSE                                           S01313
     C                     MOVE 'N'       DDS5VR                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C                     ELSE
     C           DDS5VR    IFNE 'Y'
     C           DDS5VR    ANDNE'N'
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       R00300
     C                     MOVEL'PM11219' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            R00300
     C                     MOVE '1'       *IN80
     C****                 MOVE '1'       *IN76                           S01313
     C                     MOVE '1'       *IN47                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C                     END
     C*                                                                   S01313
     C** MAY ONLY BE SET TO 'Y' IF PERFORMANCE PERIOD REQUIRED            S01313
     C           DDS5VR    IFEQ 'Y'                                       S01313
     C           DDADPP    ANDEQ' '                                       S01313
     C                     MOVEL'PM11263' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN47                           S01313
     C                     END                                            S01313
     C*
     C           DDS6VR    IFEQ *BLANKS
     C                     MOVE 'Y'       DDS6VR
     C                     ELSE
     C           DDS6VR    IFNE 'Y'
     C           DDS6VR    ANDNE'N'
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       R00300
     C                     MOVEL'PM11219' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            R00300
     C                     MOVE '1'       *IN80
     C*****                MOVE '1'       *IN49                           S01313
     C                     MOVE '1'       *IN48                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C                     END
     C*                                                                   S01313
     C           DDS7VR    IFEQ *BLANKS                                   S01313
     C                     MOVE 'Y'       DDS7VR                          S01313
     C                     ELSE                                           S01313
     C           DDS7VR    IFNE 'Y'                                       S01313
     C           DDS7VR    ANDNE'N'                                       S01313
     C           WWMSG     IFEQ 'N'                                       R00300
     C                     MOVEL'PM11219' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            R00300
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN49                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END                                            S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C           DDS8VR    IFEQ *BLANKS                                   S01313
     C                     MOVE 'Y'       DDS8VR                          S01313
     C                     ELSE                                           S01313
     C           DDS8VR    IFNE 'Y'                                       S01313
     C           DDS8VR    ANDNE'N'                                       S01313
     C           WWMSG     IFEQ 'N'                                       R00300
     C                     MOVEL'PM11219' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            R00300
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN74                           S01313
     C                     END                                            S01313
     C                     END                                            S01313
     C*                                                                   CPM005
     C           DDS9VR    IFEQ *BLANKS                                   CPM005
     C                     MOVE 'Y'       DDS9VR                          CPM005
     C                     ELSE                                           CPM005
     C           DDS9VR    IFNE 'Y'                                       CPM005
     C           DDS9VR    ANDNE'N'                                       CPM005
     C           WWMSG     IFEQ 'N'                                       CPM005
     C                     MOVEL'PM11219' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                                            CPM005
     C                     MOVE '1'       *IN80                           CPM005
     C                     MOVE '1'       *IN15                           CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C*                                                                   CPM005
     C           DDS0VR    IFEQ *BLANKS                                   CPM005
     C                     MOVE 'Y'       DDS0VR                          CPM005
     C                     ELSE                                           CPM005
     C           DDS0VR    IFNE 'Y'                                       CPM005
     C           DDS0VR    ANDNE'N'                                       CPM005
     C           WWMSG     IFEQ 'N'                                       CPM005
     C                     MOVEL'PM11219' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                                            CPM005
     C                     MOVE '1'       *IN80                           CPM005
     C                     MOVE '1'       *IN07                           CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C                     END                                            S01313
     C**                                                                  S01313
     C           DDRPYP    IFNE 'Y'                                       S01313
     C           DDRPYP    ANDNE'N'                                       S01313
     C                     MOVEL'PM11271' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN16                           S01313
     C                     END                                            S01313
     C**                                                                  S01313
     C           DDTYSM    IFNE *BLANKS                                   S01313
     C*                                                                   S01313
     C           DDTYSM    IFLT '01'                                      S01313
     C           DDTYSM    ORGT '12'                                      S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN17                           S01313
     C                     MOVEL'PM11254' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C** VALIDATE ADDITIONAL PERFORMANCE PERIOD                           S01313
     C** If entered must be 'Q' or 'H'                                    S01313
     C*                                                                   S01313
     C           DDADPP    IFNE *BLANKS                                   S01313
     C           DDADPP    ANDNE'Q'                                       S01313
     C           DDADPP    ANDNE'H'                                       S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN18                           S01313
     C                     MOVEL'PM11255' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C** IF ALL PERFORMANCE PERIODS ENTERED CORRECTLY, VALIDATE           S01313
     C** PERFORMANCE START DATE                                           S01313
     C           *IN16     IFEQ '0'                        B1             S01313
     C           *IN17     ANDEQ'0'                                       S01313
     C           *IN18     ANDEQ'0'                                       S01313
     C*                                                                   S01313
     C** IF ANY OF PERFORMANCE PERIODS ENTERED, START DATE MAY NOT BE     S01313
     C** BLANK                                                            S01313
     C           DDRPYP    IFEQ 'Y'                        B2             S01313
     C           DDTYSM    ORNE '  '                                      S01313
     C           DDADPP    OREQ 'Q'                                       S01313
     C           DDADPP    OREQ 'H'                                       S01313
     C*                                                                   S01313
     C           DDPSDT    IFEQ *BLANKS                    B3             S01313
     C                     MOVEL'PM11256' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN19                           S01313
     C                     END                             E3             S01313
     C                     END                             E2             S01313
     C*                                                                   S01313
     C** IF NO PERFORMANCE PERIOD DEFINED, START DATE MUST BE BLANK       S01313
     C           DDRPYP    IFEQ 'N'                        B2             S01313
     C           DDTYSM    ANDEQ'  '                                      S01313
     C           DDADPP    ANDEQ' '                                       S01313
     C*                                                                   S01313
     C           DDPSDT    IFNE *BLANKS                    B3             S01313
     C                     MOVEL'PM11272' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN19                           S01313
     C                     END                             E3             S01313
     C                     END                             E2             S01313
     C*                                                                   S01313
     C** DATE MUST BE A VALID DATE                                        S01313
     C                     Z-ADD0         WWPSDT  50                      S01313
     C           DDPSDT    IFNE *BLANKS                    B2             S01313
     C           *IN19     ANDEQ'0'                                       S01313
     C                     MOVE DDPSDT    ZDATE                           S01313
     C                     EXSR ZDATE1                                    S01313
     C           *IN99     IFEQ '1'                        B3             S01313
     C                     MOVEL'PM11257' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN19                           S01313
     C                     ELSE                            X3             S01313
     C                     Z-ADDZDAYNO    WWPSDT                          S01313
     C                     END                             E3             S01313
     C                     END                             E2             S01313
     C**                                                                  S01313
     C** IN INSERT MODE DATE PORTFOLIO OPENED MUST BE EQUAL TO DATE       S01313
     C** PORTFOLIO OPENED OR TO A START OF MONTH IN THE FUTURE            S01313
     C           DDACTN    IFEQ 'I'                        B2             S01313
     C           *IN19     ANDEQ'0'                                       S01313
     C*                                                                   S01313
     C** CONVERT PERFORMANCE START DATE TO DATE IN FORMAT DDMMYY          S01313
     C                     MOVE '0'       *IN98                           S01313
     C                     Z-ADDWWPSDT    ZDAYNO                          S01313
     C                     EXSR ZDATE2                                    S01313
     C*                                                                   S01313
     C                     MOVELZDATE     WWORK4                          S01313
     C                     MOVELWWORK4    WFDAY   20                      S01313
     C                     MOVE WWORK4    WFMTH   20                      S01313
     C                     MOVE ZDATE     WFYEAR  20                      S01313
     C                     MOVELWFYEAR    WFMTHY  40                      S01313
     C                     MOVE WFMTH     WFMTHY                          S01313
     C*                                                                   S01313
     C           BJDFIN    IFEQ 'M'                        B3             S01313
     C                     MOVE '1'       *IN98                           S01313
     C                     END                             E3             S01313
     C*                                                                   S01313
     C           DDPSDT    IFNE *BLANKS                    B3             S01313
     C           DDPSDT    IFNE DDDPOP                     B4             S01313
      *                                                                   CPM005
      ** MUST BE GREATER THAN RUN DATE                                    CPM005
     C           WWPSDT    IFLE BJRDNB                     B4             CPM005
     C********** WFDAY     IFNE 1                          B5       S01313CPM005
     C********** WFMTHY    ORLE W1MTHY                              S01313CPM005
     C                     MOVEL'PM11267' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN19                           S01313
     C**********           END                             E5       S01313CPM005
     C                     END                             E4             CPM005
     C                     END                             E4             S01313
     C                     END                             E3             S01313
     C                     END                             E2             S01313
     C**                                                                  S01313
     C** VALIDATION FOR AMEND MODE                                        S01313
     C           DDACTN    IFEQ 'A'                        B2             S01313
     C           *IN19     ANDEQ'0'                                       S01313
     C*                                                                   S01313
     C***IN AMEND MODE MAY ONLY BE CHANGED TO ANOTHER DATE IF THE   S01313046909
     C***PERFORMANCE START DATE HAS NOT YET BEEN REACHED            S01313046909
     C********** DDPSDT    IFNE *BLANKS                    B3       S01313046909
     C********** WWPSDT    ANDNEWAPSDT                              S01313046909
     C********** WAPSDT    ANDLEBJRDNB                              S01313046909
     C********** WAPSDT    ANDNE99999                               S01313046909
     C**********           MOVEL'PM11268' ZAMSID                    S01313046909
     C**********           EXSR ZASNMS                              S01313046909
     C**********           MOVE '1'       *IN80                     S01313046909
     C**********           MOVE '1'       *IN19                     S01313046909
     C**********           END                             E3       S01313046909
     C*                                                                   S01313
     C***IF*DATE*CHANGED*MUST*BE*START*OF*MONTH*IN*THE*FUTURE       S01313CPM005
     C** IF DATE CHANGED                                                  CPM005
     C           *IN19     IFEQ '0'                        B3             S01313
     C           WWPSDT    ANDNEWAPSDT                                    S01313
     C           DDPSDT    ANDNE*BLANKS                                   S01313
     C                     MOVE '0'       *IN98                           S01313
     C                     Z-ADDWWPSDT    ZDAYNO                          S01313
     C                     EXSR ZDATE2                                    S01313
     C*                                                                   S01313
     C                     MOVELZDATE     WWORK4                          S01313
     C                     MOVELWWORK4    WFDAY   20                      S01313
     C                     MOVE WWORK4    WFMTH   20                      S01313
     C                     MOVE ZDATE     WFYEAR  20                      S01313
     C                     MOVELWFYEAR    WFMTHY  40                      S01313
     C                     MOVE WFMTH     WFMTHY                          S01313
     C*                                                                   S01313
     C           BJDFIN    IFEQ 'M'                        B4             S01313
     C                     MOVE '1'       *IN98                           S01313
     C                     END                             E4             S01313
      *                                                                   CPM005
      ** PERFORMANCE START DATE MUST BE GREATER THAN RUN DATE             CPM005
     C           WWPSDT    IFLT BJRDNB                     B4             CPM005
     C                     MOVEL'PM11260' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     MOVE '1'       *IN80                           CPM005
     C                     MOVE '1'       *IN19                           CPM005
     C                     ELSE                            X4             CPM005
      *                                                                   CPM005
      ** PERFORMANCE START DATE CAN BE DURING CURRENT MONTH               CPM005
      ** IF PERFORMANCE NOT ALREADY ACTIVE DURING THIS MONTH              CPM005
     C           WWPSDT    IFGE BJRDNB                     B5             CPM005
     C           WWPSDT    ANDLEWENDMT                                    CPM005
     C                     MOVE WFMTH     KFMTH                           CPM005
     C           PERFOK    CHAINPMPSTMQ0             72                   CPM005
      *                                                                   CPM005
      ** IF RECORD FOUND ON PF/PMPSTMQ0                                   CPM005
     C           *IN72     IFEQ '0'                        B6             CPM005
     C                     MOVEL'PM11260' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     MOVE '1'       *IN80                           CPM005
     C                     MOVE '1'       *IN19                           CPM005
     C                     END                             E6             CPM005
     C                     END                             E5             CPM005
     C                     END                             E4             CPM005
     C*                                                                   S01313
     C********** WFDAY     IFNE 1                          B4       S01313CPM005
     C********** WFMTHY    ORLE W1MTHY                              S01313CPM005
     C**********           MOVEL'PM11260' ZAMSID                    S01313CPM005
     C**********           EXSR ZASNMS                              S01313CPM005
     C**********           MOVE '1'       *IN80                     S01313CPM005
     C**********           MOVE '1'       *IN19                     S01313CPM005
     C**********           END                             E4       S01313CPM005
     C                     END                             E3             S01313
     C                     END                             E2             S01313
     C                     END                             E1             S01313
     C**                                                                  S01313
     C** IF ENTERED FIELD PERFORMANCE 'NET/GROSS OF TAX' SHOULD BE SET    S01313
     C** TO 'N' OR 'G'                                                    S01313
     C           DDPMNG    IFNE *BLANKS                                   S01313
     C*                                                                   S01313
     C           DDPMNG    IFNE 'N'                                       S01313
     C           DDPMNG    ANDNE'G'                                       S01313
     C                     MOVEL'PM11258' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN09                           S01313
     C                     END                                            S01313
     C                     END                                            S01313
     C**                                                                  S01313
     C** IF ANY OF PERFORMANCE PERIODS ENTERED THE FIELD 'PERFORMANCE     S01313
     C** NET/GROSS OF TAX' SHOULD ALSO BE DEFINED                         S01313
     C           DDPMNG    IFEQ *BLANKS                                   S01313
     C*                                                                   S01313
     C           DDRPYP    IFEQ 'Y'                                       S01313
     C           DDTYSM    ORNE *BLANKS                                   S01313
     C           DDADPP    OREQ 'H'                                       S01313
     C           DDADPP    OREQ 'Q'                                       S01313
     C                     MOVEL'PM11269' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN09                           S01313
     C                     END                                            S01313
     C                     END                                            S01313
     C*
     C** IF ALL VALUATION STATEMENT DETAILS BLANK THEN VALUATION STATEMENT
     C** SECTION INDICATORS MUST ALSO BE BLANK
     C           DDVLFQ    IFEQ *BLANKS
     C           DDVLDM    ANDEQ*BLANKS
     C           DDVLND    ANDEQ*BLANKS
     C*                                                                   S01313
     C                     MOVE 'N'       WWMSG                           S01313
     C           DDS1VR    IFNE *BLANKS                                   S01313
     C                     MOVEL'PM11219' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN43                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END                                            S01313
     C*
     C           DDS2VR    IFNE *BLANKS
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       S01313
     C                     MOVEL'PM11219' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            S01313
     C                     MOVE '1'       *IN80
     C****                 MOVE '1'       *IN48                           S01313
     C                     MOVE '1'       *IN44                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C*
     C           DDS3VR    IFNE *BLANKS
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       S01313
     C*******************  MOVEL'PM11219' ZAMSID                   R00300 054002
     C                     MOVEL'PM11214' ZAMSID                          054002
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            S01313
     C                     MOVE '1'       *IN80
     C****                 MOVE '1'       *IN74                           S01313
     C                     MOVE '1'       *IN45                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C*
     C           DDS4VR    IFNE *BLANKS
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       S01313
     C******************** MOVEL'PM11219' ZAMSID                   R00300 054002
     C                     MOVEL'PM11214' ZAMSID                          054002
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            S01313
     C                     MOVE '1'       *IN80
     C****                 MOVE '1'       *IN75                           S01313
     C                     MOVE '1'       *IN46                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C*
     C           DDS5VR    IFNE *BLANKS
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       S01313
     C******************** MOVEL'PM11219' ZAMSID                   R00300 054002
     C                     MOVEL'PM11214' ZAMSID                          054002
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            S01313
     C                     MOVE '1'       *IN80
     C****                 MOVE '1'       *IN76                           S01313
     C                     MOVE '1'       *IN47                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C*
     C           DDS6VR    IFNE *BLANKS
     C*********************MOVEL'PM11219' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C           WWMSG     IFEQ 'N'                                       S01313
     C******************** MOVEL'PM11219' ZAMSID                   R00300 054002
     C                     MOVEL'PM11214' ZAMSID                          054002
     C                     EXSR ZASNMS                                    R00300
     C                     END                                            S01313
     C                     MOVE '1'       *IN80
     C****                 MOVE '1'       *IN49                           S01313
     C                     MOVE '1'       *IN48                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END
     C*                                                                   S01313
     C           DDS7VR    IFNE *BLANKS                                   S01313
     C           WWMSG     IFEQ 'N'                                       S01313
     C******************** MOVEL'PM11219' ZAMSID                   S01313 054002
     C                     MOVEL'PM11214' ZAMSID                          054002
     C                     EXSR ZASNMS                                    S01313
     C                     END                                            S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN49                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C           DDS8VR    IFNE *BLANKS                                   S01313
     C           WWMSG     IFEQ 'N'                                       S01313
     C******************** MOVEL'PM11219' ZAMSID                   S01313 054002
     C                     MOVEL'PM11214' ZAMSID                          054002
     C                     EXSR ZASNMS                                    S01313
     C                     END                                            S01313
     C                     MOVE '1'       *IN80                           S01313
     C                     MOVE '1'       *IN74                           S01313
     C                     MOVE 'Y'       WWMSG                           S01313
     C                     END                                            S01313
     C*                                                                   CPM005
     C           DDS9VR    IFNE *BLANKS                                   CPM005
     C           WWMSG     IFEQ 'N'                                       CPM005
     C                     MOVEL'PM11219' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                                            CPM005
     C                     MOVE '1'       *IN80                           CPM005
     C                     MOVE '1'       *IN15                           CPM005
     C                     MOVE 'Y'       WWMSG                           CPM005
     C                     END                                            CPM005
     C*                                                                   CPM005
     C           DDS0VR    IFNE *BLANKS                                   CPM005
     C           WWMSG     IFEQ 'N'                                       CPM005
     C                     MOVEL'PM11219' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                                            CPM005
     C                     MOVE '1'       *IN80                           CPM005
     C                     MOVE '1'       *IN07                           CPM005
     C                     MOVE 'Y'       WWMSG                           CPM005
     C                     END                                            CPM005
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDCASF - CASHFLOW REPORT FREQUENCY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C** IF ENTERED , REPORT DAY IN MONTH MUST BE SPECIFIED
     C**
     C           DDCASF    IFNE *BLANK
     C           DDCASF    IFNE 'W'
     C           DDCASD    ANDEQ*BLANKS
     C*********************MOVEL'PM11234' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11234' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN66
     C                     END
     C                     END
     C**
     C** IF ENTERED ,MUST BE 'W' 'M' 'Q' 'X' OR 'Y'
     C**
     C           DDCASF    IFNE *BLANK
     C           DDCASF    ANDNE'W'
     C           DDCASF    ANDNE'M'
     C           DDCASF    ANDNE'Q'
     C           DDCASF    ANDNE'X'
     C           DDCASF    ANDNE'Y'
     C*********************MOVEL'PM11235' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11235' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN66
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDCASD - CASHFLOW REPORT DAY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C** IF ENTERED , REPORT FREQUENCY MUST BE SPECIFIED
     C**
     C           DDCASD    IFNE *BLANK
     C           DDCASF    ANDEQ*BLANKS
     C*********************MOVEL'PM11236' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11236' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN67
     C                     END
     C**
     C** IF ENTERED ,MUST BE BETWEEN 1 AND 31
     C**
     C           DDCASD    IFNE *BLANK
     C                     MOVE DDCASD    WWVLDM
     C                     MOVE WWVLDM    WWVVDM
     C           DDCASD    IFNE WWVVDM
     C           WWVLDM    ORLT 1
     C           WWVLDM    ORGT 31
     C*********************MOVEL'PM11237' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11237' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN67
     C                     END
     C                     END
     C**
     C** IF FREQUENCY 'W' ENTERED, DAY MUST BE BLANK
     C**
     C           DDCASD    IFNE *BLANKS
     C           DDCASF    ANDEQ'W'
     C*********************MOVEL'PM11240' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11240' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN67
     C                     END
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDCASN - CASHFLOW NEXT REPORT DATE
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C** IF ENTERED MUST BE A VALID DATE
     C**
     C                     Z-ADD0         WWCASN
     C           DDCASN    IFNE *BLANKS
     C                     MOVE DDCASN    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C*********************MOVEL'PM11238' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11238' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN68
     C                     ELSE
     C                     Z-ADDZDAYNO    WWCASN  50
     C                     END
     C                     END
     C**
     C** IF ENTERED MUST NOT BE BEFORE RUN DATE
     C**
     C           DDCASN    IFNE *BLANKS
     C           *IN99     ANDEQ'0'
     C           WWCASN    ANDLTBJRDNB
     C*********************MOVEL'PM11239' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11239' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN68
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDPOLC    BANK INVESTMENT POLICY CODE
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDPOLC    IFNE *BLANKS
     C**
     C** IF ENTERED INDIVIDUAL INDICATORS MUST BE 'N'
     C**
     C           DDIPIN    IFNE 'N'
     C           DDCYIN    ORNE 'N'
     C           DDYPIN    ORNE 'N'
     C           DDNPIN    ORNE 'N'
     C*********************MOVEL'PM11220' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11220' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN51
     C           DDIPIN    IFNE 'N'
     C                     MOVE '1'       *IN52
     C                     END
     C           DDCYIN    IFNE 'N'
     C                     MOVE '1'       *IN53
     C                     END
     C           DDYPIN    IFNE 'N'
     C                     MOVE '1'       *IN54
     C                     END
     C           DDNPIN    IFNE 'N'
     C                     MOVE '1'       *IN55
     C                     END
     C                     END
     C**
     C** IF ENTERED MUST BE VALID
     C**
     C***********DDPOLC    CHAINPMBIPNPP             72                   S01486
     C           DDPOLC    CHAINPMBIPNPD             72                   S01486
     C           *IN72     IFEQ '1'
     C           PSRECI    ORNE 'D'
     C*********************MOVEL'PM11221' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11221' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN51
     C                     END
     C*
     C                     END
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDIPIN     INSTRUMENT INVESTMENT POLICY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDIPIN    IFEQ *BLANKS
     C**
     C** IF NOT ENTERED SET DEFAULT TO 'N'
     C**
     C                     MOVEL'N'       DDIPIN
     C                     ELSE
     C**
     C** IF ENTERED MUST BE 'Y', 'N' OR 'A'
     C**
     C           DDIPIN    IFNE 'Y'
     C           DDIPIN    ANDNE'N'
     C           DDIPIN    ANDNE'A'
     C*********************MOVEL'PM11222' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11222' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN51
     C                     END
     C*
     C                     END
     C*
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDCYIN        CURRENCY   INVESTMENT POLICY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDCYIN    IFEQ *BLANKS
     C**
     C** IF NOT ENTERED SET DEFAULT TO 'N'
     C**
     C                     MOVEL'N'       DDCYIN
     C                     ELSE
     C**
     C** IF ENTERED MUST BE 'Y', 'N' OR 'A'
     C**
     C           DDCYIN    IFNE 'Y'
     C           DDCYIN    ANDNE'N'
     C           DDCYIN    ANDNE'A'
     C*********************MOVEL'PM11223' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11223' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN52
     C                     END
     C*
     C                     END
     C*
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDYPIN     COUNTRY OF RISK INVESTMENT POLICY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDYPIN    IFEQ *BLANKS
     C**
     C** IF NOT ENTERED SET DEFAULT TO 'N'
     C**
     C                     MOVEL'N'       DDYPIN
     C                     ELSE
     C**
     C** IF ENTERED MUST BE 'Y', 'N' OR 'A'
     C**
     C           DDYPIN    IFNE 'Y'
     C           DDYPIN    ANDNE'N'
     C           DDYPIN    ANDNE'A'
     C*********************MOVEL'PM11224' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11224' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN53
     C                     END
     C*
     C                     END
     C*
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL4DDNPIN      INDUSTRY INVESTMENT POLICY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDNPIN    IFEQ *BLANKS
     C**
     C** IF NOT ENTERED SET DEFAULT TO 'N'
     C**
     C                     MOVEL'N'       DDNPIN
     C                     ELSE
     C**
     C** IF ENTERED MUST BE 'Y', 'N' OR 'A'
     C**
     C           DDNPIN    IFNE 'Y'
     C           DDNPIN    ANDNE'N'
     C           DDNPIN    ANDNE'A'
     C*********************MOVEL'PM11225' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11225' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN54
     C                     END
     C*
     C                     END
     C**
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #V1005   - TO VALIDATE DATE PORTFOLIO CLOSED                           *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * ZDATE1   - TO COMPUTE DATE IN DAY NUMBER                               *
      *********ZA0240   - TO ACCESS MESSAGE FILE AND SEND MESSAGE         R00300
      * ZASNMS   - WRITE ERROR MESSAGES                                   R00300
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #V1005    BEGSR                           ** #V1005 BSR**
     C**
     C                     MOVE '0'       *IN37
     C                     MOVE '0'       *IN82                           B8275
     C** VAL5DDDPCL
     C           DDDPCL    IFNE *BLANKS                    - B1
     C**
     C** IF ENTERED MUST BE VALID
     C**
     C                     Z-ADD0         WWDAT1
     C                     MOVE *BLANKS   WWDAT2
     C                     MOVE DDDPCL    WWDAT1
     C                     MOVE WWDAT1    WWDAT2
     C**
     C                     MOVELDDDPCL    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'                        - B2
     C           DDDPCL    ORNE WWDAT2
     C*********************MOVEL'PM11226' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11226' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN37
     C                     ELSE                            - X2
     C                     Z-ADDZDAYNO    WWDPCL
     C                     END                             -E2
     C*
     C**
     C** IF ENTERED MUST NOT BE BEFORE RUN DATE
     C**
     C****       WWDPCL    IFLT BJRDNB                     - B2           B08257
     C           WWDPCL    IFNE BJRDNB                     - B2           B08257
     C*********************MOVEL'PM11227' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11227' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN37
     C                     END                             - E2
     C*
     C** IF ENTERED MUST NOT BE BEFORE DATE PORTFOLIO OPENED
     C**
     C           WWDPCL    IFLE PNDPOP                     - B2
     C*********************MOVEL'PM11228' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11228' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN37
     C                     END                             - E2
     C*
     C** CHECK THAT DATE PORTFOLIO CLOSED IS NOT BEFOR PLEDGE FINISH DATE
     C*
     C           PNPDGF    IFNE 0                          - B2
     C           WWDPCL    ANDLTPNPDGF
     C           WWDPCL    ANDNE0
     C*********************MOVEL'PM11232' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11232' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN37
     C                     END                             - E2
     C*                                                                   S01307
     C***Portfolio*can*not*be*closed*if*Accruals*or*Outstanding*****S01307B8275
     C***Settlements*remain*on*it***********************************S01307B8275
     C**         PMPORK    CHAINSCSCFAPD             72             S01307B8275
     C**                                                            S01307B8275
     C**         *IN72     IFEQ '0'                        - B2     S01307B8275
     C**         SDRECI    ANDEQ'D'                                 S01307B8275
     C**                   MOVEL'PM11252' ZAMSID                    S01307B8275
     C**                   EXSR ZASNMS                              R01307B8275
     C**                   MOVE '1'       *IN80                     S01307B8275
     C**                   MOVE '1'       *IN37                     S01307B8275
     C**                   ELSE                            - X2     S01307B8275
     C**         PMPORK    CHAINSCOCFSPD             72             S01307B8275
     C**                                                            S01307B8275
     C**         *IN72     IFEQ '0'                        - B3     S01307B8275
     C**         SERECI    ANDEQ'D'                                 S01307B8275
     C**                   MOVEL'PM11252' ZAMSID                    S01307B8275
     C**                   EXSR ZASNMS                              S01307B8275
     C**                   MOVE '1'       *IN80                     S01307B8275
     C**                   MOVE '1'       *IN37                     S01307B8275
     C**                   END                             - E3     S01307B8275
     C**                                                            S01307B8275
     C**                   END                             - E2     S01307B8275
      *  Send a WARNING message if Accruals or Outstanding                B8275
      *  Settlements remain on it                                         B8275
     C  N86                DO                              - B2           B8275
     C***********PMPORK    CHAINSCSCFAP0             72             B8275 S01486
     C                     MOVE BBBRCD    WWBRCA                          S01486
     C           PMPRKB    CHAINSESCFAPD             72                   S01486
     C           *IN72     DOWEQ'0'                        - B3           B8275
     C           SDCFAC    IFNE 0                          - B4           B8275
     C           SDOSAJ    ORNE 0                                         B8275
     C                     MOVEL'PM11252' ZAMSID                          B8275
     C                     EXSR ZASNMS                                    B8275
     C                     MOVE '1'       *IN82                           B8275
     C                     MOVE '1'       *IN37                           B8275
     C                     MOVE '1'       *IN72                           B8275
     C                     END                             - E4           B8275
     C**N72******PMPORK    READESCSCFAP0                 72         B8275 S01486
     C  N72      PMPRKB    READESESCFAPD                 72               S01486
     C                     END                             - E3           B8275
      *                                                                   B8275
     C***********PMPORK    CHAINSCOCFSP0             72             B8275 S01486
     C           PMPORK    CHAINSEOCFSL3             72                   S01486
     C           *IN72     DOWEQ'0'                        - B3           B8275
     C           SECFAC    IFNE 0                          - B4           B8275
     C                     MOVEL'PM11252' ZAMSID                          B8275
     C                     EXSR ZASNMS                                    B8275
     C                     MOVE '1'       *IN82                           B8275
     C                     MOVE '1'       *IN37                           B8275
     C                     MOVE '1'       *IN72                           B8275
     C                     END                             - E4           B8275
     C**N72******PMPORK    READESCOCFSP0                 72         B8275 S01486
     C  N72      PMPORK    READESEOCFSL3                 72               S01486
     C                     END                             - E3           B8275
      *                                                                   B8275
     C           PMPORK    CHAINPMCHRGLF             72                   B8275
     C           *IN72     DOWEQ'0'                        - B3           B8275
     C           POCGAJ    IFNE 0                          - B4           B8275
     C           POCGAD    ORNE 0                                         B8275
     C                     MOVEL'PM11253' ZAMSID                          B8275
     C                     EXSR ZASNMS                                    B8275
     C                     MOVE '1'       *IN82                           B8275
     C                     MOVE '1'       *IN37                           B8275
     C                     MOVE '1'       *IN72                           B8275
     C                     END                             - E4           B8275
     C  N72      PMPORK    READEPMCHRGLF                 72               B8275
     C                     END                             - E3           B8275
     C                     END                             - E2           B8275
     C*                                                                   S01307
     C                     ELSE                            - X1
     C                     Z-ADD0         WWDPCL
     C                     END                             - E1
      *                                                                   B8275
     C                     SETOF                     86                   B8275
     C   82                SETON                     86                   B8275
     C**
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1005   - TO PROCESS PORTFOLIO CHARGE DETAILS                         *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      **********ZA0250   - TO CLEAR MESSAGE                               R00300
      * Y2CLMSC  - CLEAR MESSAGE QUEUE                                    R00300
      * #ZBAA    - TO MOVE THE APPROPRIATE VALUE IN WWAID                      *
      * PM0600   - NOTEPAD                                                     *
      * #V1006   - TO VALIDATE PORTFOLIO CHARGES DETAILS                       *
      * ZASNMS   - WRITE ERROR MESSAGES                                   R00300
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      **************************************************************************
     C           #P1005    BEGSR                           ** #P1005 BSR**
     C*
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C** POSITION CURSOR
     C*
     C                     MOVE '0'       *IN31
     C                     MOVE '0'       *IN32
     C                     MOVE '0'       *IN33
     C                     MOVE '0'       *IN34
     C                     MOVE '0'       *IN35
     C                     MOVE '0'       *IN36
     C                     MOVE '0'       *IN37
     C                     MOVE '0'       *IN38
     C                     MOVE '0'       *IN39
     C                     MOVE '0'       *IN40
     C                     MOVE '0'       *IN41
     C                     MOVE '0'       *IN42
     C                     MOVE '0'       *IN43
     C                     MOVE '0'       *IN44
     C                     MOVE '0'       *IN45
     C                     MOVE '0'       *IN85
     C**
     C*
     C** IF ENQUIRY PROTECT FIELD INPUT ON S/PM0110C1
     C*
     C           DDACTN    IFEQ 'E'
     C           DDACTN    OREQ 'C'
     C                     MOVE '1'       *IN31
     C                     END
     C*
     C                     MOVEL'PM90008' MSMBR4
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    DDINFO
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N
     C*
     C           WWAID     DOUEQ'03'
     C           *IN10     OREQ '1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C           *IN85     OREQ '1'
     C**
     C*
     C** D E T A I L   S C R E E N     O U T P U T
     C*
     C                     WRITEPM0110F3
     C**
     C                     WRITEPM0110F1
     C                     EXFMTPM0110C1
     C**
     C                     MOVE '0'       *IN80
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**   Clear program message queue                                    R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ                            R00300
     C                     PARM           TOPRQ                           R00300
     C*
     C** Call S/R to move values into WWAID
     C*
     C                     EXSR #ZBAA
     C*
     C** CK12- INITIAL SCREEN
     C*
     C           WWAID     IFEQ '12'
     C                     MOVE '1'       *IN10
     C                     END
     C*
     C**     CMD/24 TAKEN
     C*
     C           WWAID     IFEQ '24'
     C                     MOVEL'0'       WWRTRN
     C                     MOVELWWPNP8    WWCCNM
     C                     MOVELWWPREF    WWPTFR
     C                     MOVE 'Y'       WW0600
     C                     CALL 'PMC0601' LIST1
     C**
     C                     END
     C*
     C** RECEIVE PARAMETER RETURNED FROM INVESTMENT POLICY INPUT
     C** PROGRAM
     C*
     C           WWRTRN    IFEQ '1'                                       R10053
     C                     MOVE '03'      WWAID                           R10053
     C                     END                                            R10053
     C**
     C*
     C** V A L I D A T E   D E T A I L   S C R E E N   I N P U T
     C*
     C           WWAID     IFNE '03'
     C           WWAID     ANDNE'12'
     C           WWAID     ANDNE'24'
     C**
     C                     MOVE '0'       *IN79
     C**
     C** CHECK IF CHANGES OCCURED
     C**
     C           DDACTN    IFEQ 'I'
     C           DDACTN    OREQ 'A'
     C**
     C                     Z-ADD0         X                               S01486
     C           *IN79     DOWEQ'0'
     C                     READCPM0110S1                 79
     C* SAVE THEM INTO AN ARRAY
     C*
     C           *IN79     IFEQ '0'
     C                     Z-ADDRRN2      X
     C                     END
     C                     END
     C*
     C* VALIDATION
     C                     EXSR #V1006
     C                     MOVE 'Y'       WWCHGP                          B08166
     C                     END
     C*
     C** N O    D E T A I L   S C R E E N    E R R O R S
     C*
     C**
     C**     ENTER PRESSED
     C**
     C           WWAID     IFEQ 'RA'
     C           *IN80     ANDEQ'0'
     C                     MOVE '0'       *IN46
     C                     MOVE '1'       *IN85
     C                     END
     C*
     C**     CMD/1 TAKEN
     C*
     C           WWAID     IFEQ '01'
     C           *IN80     IFEQ '0'
     C                     MOVE '1'       *IN85
     C                     ELSE
     C*********************MOVEL'PM11401' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11401' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** IF F3 OR F12 TAKEN REMOVE FILE CHANGES FOR INVESTMENT POLICY
     C*
     C           WWAID     IFEQ '03'
     C           WWAID     OREQ '12'
     C                     ROLBK
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1006   - TO PROCESS INVESTMENT POLICY INDICATORS(AMEND)              *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * M0170    -                                                             *
      * PM0170   - INSTRUMENT INVESTMENT POLICY                                *
      * PM0180   - CURRENCY INVESTMENT POLICY                                  *
      * PM0190   - COUNTRY OF RISK INVESTMENT POLICY                           *
      * PM0200   - INDUSTRY INVESTMENT POLICY                                  *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      **************************************************************************
     C           #P1006    BEGSR                           ** #P1006 BSR**
     C*
     C** SET UP COMMON PARAMETERS TO BE PASSED TO CUSTOMER
     C** INVESTMENT POLICY DEFINITION PROGRAMS
     C*
     C                     MOVEL'0'       WWRTRN
     C                     MOVEL*BLANK    WWPOLI
     C                     MOVELWWPNP8    WWCCNM
     C                     MOVELWWPREF    WWPTFR
     C                     MOVE *BLANKS   WWACTO
     C**
     C** SET UP ACTION CODE TO BE PASSED TO PM0170
     C** IF POLICY REQUIRED INDICATOR CHANGED FROM 'Y' TO 'N' SET
     C** ACTION CODE TO 'D' TO INDICATE POLICY TO BE DELETED
     C*
     C           DDIPIN    IFEQ 'N'
     C           DDIPIH    ANDEQ'Y'
     C                     MOVEL'D'       WWACTO
     C                     END
     C*
     C** IF INSTRUMENT POLICY INDICATOR HAS CHNGED 'N' TO 'Y'
     C** OR SET TO 'A' PASS ACTION CODE OF 'A'
     C*
     C           DDIPIH    IFEQ 'N'
     C           DDIPIN    ANDEQ'Y'
     C           DDIPIN    OREQ 'A'
     C                     MOVE 'A'       WWACTO
     C                     END
     C*
     C** CALL PM0170 TO ALLOW INPUT OF INSTRUMENT INVESTMENT POLICY
     C*
     C           WWACTO    IFNE *BLANK
     C                     MOVE 'Y'       WW0170  1
     C                     CALL 'PM0170'  LIST2
     C*
     C** RECEIVE PARAMETER RETURNED FROM INVESTMENT POLICY INPUT
     C** PROGRAM
     C*
     C           WWRTRN    IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     ROLBK
     C                     GOTO #P1069
     C                     END
     C*
     C** F12 PRESSED IN CALLED PROGRAM
     C*
     C           WWRTRN    IFEQ '2'
     C                     MOVE '12'      WWAID
     C                     MOVE '1'       *IN10
     C                     GOTO #P1069
     C                     END
     C*
     C** ENTER PRESSED
     C*
     C                     MOVELWWPOLI    DDIPIN
     C                     MOVELWWPOLI    DDIPIH
     C                     MOVEL*BLANKS   WWAID
     C                     END
     C**
     C** SET UP ACTION CODE TO BE PASSED TO PM0180
     C*
     C                     MOVE *BLANKS   WWACTO
     C           DDCYIN    IFEQ 'N'
     C           DDCYIH    ANDEQ'Y'
     C                     MOVEL'D'       WWACTO
     C                     END
     C*
     C           DDCYIH    IFEQ 'N'
     C           DDCYIN    ANDEQ'Y'
     C           DDCYIN    OREQ 'A'
     C                     MOVE 'A'       WWACTO
     C                     END
     C*
     C** CALL PM0180 TO ALLOW INPUT OF INSTRUMENT INVESTMENT POLICY
     C*
     C           WWACTO    IFNE *BLANK
     C                     MOVE 'Y'       WW0180  1
     C                     CALL 'PM0180'  LIST2
     C*
     C** RECEIVE PARAMETER RETURNED FROM INVESTMENT POLICY INPUT
     C** PROGRAM
     C*
     C           WWRTRN    IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     ROLBK
     C                     GOTO #P1069
     C                     END
     C*
     C** F12 PRESSED IN CALLED PROGRAM
     C*
     C           WWRTRN    IFEQ '2'
     C                     MOVE '12'      WWAID
     C                     MOVE '1'       *IN10
     C                     GOTO #P1069
     C                     END
     C*
     C** ENTER PRESSED
     C*
     C                     MOVELWWPOLI    DDCYIN
     C                     MOVELWWPOLI    DDCYIH
     C                     MOVEL*BLANKS   WWAID
     C                     END
     C**
     C** SET UP ACTION CODE TO BE PASSED TO PM0190
     C*
     C                     MOVE *BLANKS   WWACTO
     C           DDYPIN    IFEQ 'N'
     C           DDYPIH    ANDEQ'Y'
     C                     MOVEL'D'       WWACTO
     C                     END
     C*
     C           DDYPIH    IFEQ 'N'
     C           DDYPIN    ANDEQ'Y'
     C           DDYPIN    OREQ 'A'
     C                     MOVE 'A'       WWACTO
     C                     END
     C*
     C** CALL PM0190 TO ALLOW INPUT OF INSTRUMENT INVESTMENT POLICY
     C*
     C           WWACTO    IFNE *BLANK
     C                     MOVE 'Y'       WW0190  1
     C                     CALL 'PM0190'  LIST2
     C*
     C** RECEIVE PARAMETER RETURNED FROM INVESTMENT POLICY INPUT
     C** PROGRAM
     C*
     C           WWRTRN    IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     ROLBK
     C                     GOTO #P1069
     C                     END
     C*
     C** F12 PRESSED IN CALLED PROGRAM
     C*
     C           WWRTRN    IFEQ '2'
     C                     MOVE '1'       *IN10
     C                     MOVE '12'      WWAID
     C                     GOTO #P1069
     C                     END
     C*
     C** ENTER PRESSED
     C*
     C                     MOVELWWPOLI    DDYPIN
     C                     MOVELWWPOLI    DDYPIH
     C                     MOVEL*BLANKS   WWAID
     C                     END
     C**
     C** SET UP ACTION CODE TO BE PASSED TO PM0200
     C*
     C                     MOVE *BLANKS   WWACTO
     C           DDNPIN    IFEQ 'N'
     C           DDNPIH    ANDEQ'Y'
     C                     MOVEL'D'       WWACTO
     C                     END
     C*
     C           DDNPIH    IFEQ 'N'
     C           DDNPIN    ANDEQ'Y'
     C           DDNPIN    OREQ 'A'
     C                     MOVE 'A'       WWACTO
     C                     END
     C*
     C** CALL PM0200 TO ALLOW INPUT OF INSTRUMENT INVESTMENT POLICY
     C*
     C           WWACTO    IFNE *BLANK
     C                     MOVE 'Y'       WW0200  1
     C                     CALL 'PM0200'  LIST2
     C*
     C** RECEIVE PARAMETER RETURNED FROM INVESTMENT POLICY INPUT
     C** PROGRAM
     C*
     C           WWRTRN    IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     ROLBK
     C                     GOTO #P1069
     C                     END
     C*
     C** F12 PRESSED IN CALLED PROGRAM
     C*
     C           WWRTRN    IFEQ '2'
     C                     MOVE '12'      WWAID
     C                     MOVE '1'       *IN10
     C                     GOTO #P1069
     C                     END
     C*
     C** ENTER PRESSED
     C*
     C                     MOVELWWPOLI    DDNPIN
     C                     MOVELWWPOLI    DDNPIH
     C                     MOVEL*BLANKS   WWAID
     C                     END
     C**
     C           #P1069    ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1007   - TO PROCESS INVESTMENT POLICY INDICATORS(ENQUIRY)            *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * PM0170   - INSTRUMENT INVESTMENT POLICY                                *
      * PM0180   - CURRENCY INVESTMENT POLICY                                  *
      * PM0190   - COUNTRY OF RISK INVESTMENT POLICY                           *
      * PM0200   - INDUSTRY INVESTMENT POLICY                                  *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      **************************************************************************
     C           #P1007    BEGSR                           ** #P1007 BSR**
     C*
     C** SET UP PARAMETERS PASSED TO INVESTMENT POLICY INPUT PROGRAMS
     C*
     C                     MOVEL'E'       WWACTO
     C                     MOVEL'0'       WWRTRN
     C                     MOVEL*BLANK    WWPOLI
     C                     MOVELWWPNP8    WWCCNM
     C                     MOVELWWPREF    WWPTFR
     C**
     C** IF INSTRUMENT POLICY INDICATOR IS 'Y' - CALL PM0170
     C**
     C           DDIPIN    IFEQ 'Y'
     C                     MOVE 'Y'       WW0170
     C                     CALL 'PM0170'  LIST2
     C**
     C** PROCESS PARAMETER RETURNED FORM PM0170
     C**
     C                     MOVE *BLANKS   WWAID
     C           WWRTRN    IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     GOTO #P1079
     C                     END
     C**
     C           WWRTRN    IFEQ '2'
     C                     MOVEL*BLANKS   WWAID
     C                     MOVE '1'       *IN10
     C                     GOTO #P1079
     C                     END
     C                     END
     C**
     C** IF CURRENCY POLICY INDICATOR IS 'Y' - CALL PM0180
     C**
     C           DDCYIN    IFEQ 'Y'
     C                     MOVE 'Y'       WW0180
     C                     CALL 'PM0180'  LIST2
     C**
     C** PROCESS PARAMETER RETURNED FORM PM0180
     C**
     C                     MOVE *BLANKS   WWAID
     C           WWRTRN    IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     GOTO #P1079
     C                     END
     C**
     C           WWRTRN    IFEQ '2'
     C                     MOVEL*BLANKS   WWAID
     C                     MOVE '1'       *IN10
     C                     GOTO #P1079
     C                     END
     C                     END
     C**
     C** IF COUNTRY POLICY INDICATOR IS 'Y' - CALL PM0190
     C**
     C           DDYPIN    IFEQ 'Y'
     C                     MOVE 'Y'       WW0190
     C                     CALL 'PM0190'  LIST2
     C**
     C** PROCESS PARAMETER RETURNED FORM PM0180
     C**
     C                     MOVE *BLANKS   WWAID
     C           WWRTRN    IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     GOTO #P1079
     C                     END
     C**
     C           WWRTRN    IFEQ '2'
     C                     MOVEL*BLANKS   WWAID
     C                     MOVE '1'       *IN10
     C                     GOTO #P1079
     C                     END
     C                     END
     C**
     C** IF INDUSTRY POLICY INDICATOR IS 'Y' - CALL PM0200
     C**
     C           DDNPIN    IFEQ 'Y'
     C                     MOVE 'Y'       WW0200
     C                     CALL 'PM0200'  LIST2
     C**
     C** PROCESS PARAMETER RETURNED FORM PM0200
     C**
     C                     MOVE *BLANKS   WWAID
     C           WWRTRN    IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     GOTO #P1079
     C                     END
     C**
     C           WWRTRN    IFEQ '2'
     C                     MOVEL*BLANKS   WWAID
     C                     MOVE '1'       *IN10
     C                     GOTO #P1079
     C                     END
     C                     END
     C**
     C           #P1079    ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1008   - TO UPDATE PORTFOLIO DEFINITION FILE                         *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * ZTNLU1   - TO LOCK AND ACCESS DATA AREA AND GET TRANSAC. NBR           *
      * #CBB     - TO PROCESS UPDATE BY ANOTHER WORKSTATION                    *
      * *PSSR    - TO PROCESS ABNORMAL END OF PROGRAM                          *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      **************************************************************************
     C           #P1008    BEGSR                           ** #P1008 BSR**
     C**
     C**  ACTION CODE I
     C**
     C           DDACTN    IFEQ 'I'                        B1
     C***********PMPORK    CHAINPMPORTPP             72                   S01486
     C           PMPORK    CHAINPMPORTPD             72                   S01486
     C**
     C           *IN72     IFEQ '0'                        B2
     C*
     C** RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C           PNRECI    ANDEQ'D'
     C                     EXSR #CBB
     C                     GOTO XTUPDF
     C                     END                             E2
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     MOVEL'D'       PNRECI
     C                     MOVE BJMRDT    WWHLUP
     C                     Z-ADDWWDLUP    PNDLUP
     C                     MOVE WWMLUP    PNMLUP
     C                     Z-ADDWWYLUP    PNYLUP
     C                     TIME           PNTLUP
     C                     MOVEL'I'       PNCHTP
     C                     Z-ADDBJRDNB    PNLCD
     C                     MOVELQBCUST    PNCNUM
     C                     MOVELDDPREF    PNPTFR
     C                     MOVELDDPTCY    PNPTCY
     C                     Z-ADDWWPTCY    PNPCDP
     C                     MOVELDDPTFN    PNPTFN
     C                     MOVELDDPTFT    PNPTFT
     C                     MOVELDDCFGC    PNCFGC                          S01307
     C                     MOVELDDMNGI    PNMNGI
     C                     Z-ADDWWDPOP    PNDPOP
     C                     Z-ADD0         PNDPCL
     C           BGFUOP    IFEQ 'Y'                        B2             S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C                     MOVE DDACSQ    PNACSQ                          S71062
     C                     ELSE                            X2             S71062
     C                     MOVE *ZEROS    PNACSQ                          S71062
     C                     END                             E2             S71062
     C           BGLMCR    IFEQ 'N'                        B2
     C                     Z-ADDWWPDGS    PNPDGS
     C                     Z-ADDWWPDGF    PNPDGF
     C                     END                             E2
     C                     MOVELDDVLFQ    PNVLFQ
     C                     MOVELDDVLDM    PNVLDM
     C                     Z-ADDWWVLND    PNVLND
     C****                 MOVELDDAAD1    PNAAD1                          S01313
     C****                 MOVELDDAAD2    PNAAD2                          S01313
     C****                 MOVELDDAAD3    PNAAD3                          S01313
     C****                 MOVELDDAAD4    PNAAD4                          S01313
     C****                 MOVELDDAAD5    PNAAD5                          S01313
     C                     MOVELDDS1VR    PNS1VR                          S01313
     C                     MOVELDDS2VR    PNS2VR
     C                     MOVELDDS3VR    PNS3VR
     C                     MOVELDDS4VR    PNS4VR
     C                     MOVELDDS5VR    PNS5VR
     C                     MOVELDDS6VR    PNS6VR
     C                     MOVELDDS7VR    PNS7VR                          S01313
     C                     MOVELDDS8VR    PNS8VR                          S01313
     C                     MOVELDDS9VR    PNS9VR                          CPM005
     C                     MOVELDDS0VR    PNS0VR                          CPM005
     C           DDTYSM    IFNE *BLANKS                                   S01313
     C                     MOVE DDTYSM    PNTYSM                          S01313
     C                     ELSE                                           S01313
     C                     Z-ADD0         PNTYSM                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C                     MOVE DDADPP    PNADPP                          S01313
     C                     MOVE DDRPYP    PNRPYP                          S01313
     C                     MOVE DDPMNG    PNPMNG                          S01313
     C                     MOVELDDCASF    PNCASF
     C                     MOVE DDCASD    PNCASD
     C**
     C** FOLLOWING VALIDATION TO DETERMINE NEXT REPORT DATE
     C** IF REPORT DAY AND REPORT FREQUENCY ENTERED
     C** IF REPORT DAY EQUAL TO DAY OF RUN DATE THEN DEFAULT TO
     C** RUN DATE
     C** OTHERWISE CALCULATE IT BY THE MEAN OF SUBROUTINE ZFRQA
     C**
     C           DDCASN    IFEQ *BLANKS                    B2
     C           DDCASD    ANDNE*BLANKS
     C           DDCASF    ANDNE*BLANKS
     C                     MOVELBJMRDT    WWDAYN  20
     C                     MOVE DDCASD    WWCASD  20
     C           WWCASD    IFEQ WWDAYN                     B3
     C                     Z-ADDBJRDNB    PNCASN
     C                     ELSE                            X3
     C                     MOVE DDCASF    ZFREQ
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     MOVE DDCASD    ZMDAY
     C                     MOVE BJLCCY    ZCCY
     C                     EXSR ZFRQA
     C                     Z-ADDZDAYNO    PNCASN
     C                     END                             E3
     C                     ELSE                            X2
     C                     Z-ADDWWCASN    PNCASN
     C                     END                             E2
     C                     MOVELDDPOLC    PNPOLC
     C                     MOVELDDIPIN    PNIPIN
     C                     MOVELDDCYIN    PNCYIN
     C                     MOVELDDYPIN    PNYPIN
     C                     MOVELDDNPIN    PNNPIN
     C                     Z-ADDWWNEWT    PNTNLU
     C***********          Z-ADD0         PNCUSB                          S01486
     C                     MOVE *BLANKS   PNCUSB                          S01486
     C****                 MOVE *BLANKS   PNVLNT                          S01313
     C****                 Z-ADD0         PNVLOR                          S01313
     C                     MOVE *BLANKS   PNWSI1
     C           DDPSDT    IFEQ *BLANKS                                   S01313
     C                     Z-ADD99999     PNPSDT                          S01313
     C                     ELSE                                           S01313
     C                     Z-ADDWWPSDT    PNPSDT                          S01313
     C                     END                                            S01313
     C*
     C           *IN72     IFEQ '1'                        B2
     C*                                                                   CAC003
     C** If Analytical Accounting is switched on;                         CAC003
     C           *IN87     IFEQ '1'                                       CAC003
     C                     MOVE DDPRF2    PNPRFC                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C**
     C                     MOVEASTAMP,1   PNTMST           Default Timestamp                  CPK015
     C                     WRITEPMPORTP0               79
     C*
     C** TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
     C*
     C           *IN79     IFEQ '1'                        B3
     C           STATUS    ANDEQ01021
     C           PMPORK    CHAINPMPORTXX             72
     C*
     C           *IN72     IFEQ '0'                        B4
     C                     EXSR #CBB
     C                     GOTO XTUPDF
     C                     END                             E4
     C*
     C                     END                             E3
     C*
     C           *IN79     IFEQ '1'                        B3
     C                     EXSR *PSSR
     C                     END                             E3
     C*
     C                     ELSE                            X2
     C**
     C                     UPDATPMPORTP0
     C*
     C                     END                             E2
     C*                                                                   B08255
     C** IF CURRENCY WRITTEN TO PF/PMPORTPP DIFFERENT TO CUSTOMER         S01313
     C***BASE*CURRENCY*UPDATE DIFFERENCE INDICATOR ON SDPLCSPD     B08255 S01486
     C** BASE CURRENCY UPDATE DIFFERENCE INDICATOR ON SDPLCSL1            S01486
     C                     MOVE PNCNUM    WSCNUM  6                S01313 S01486
     C***********WSCNUM    CHAINSDPLCSPD             72            S01313 S01486
     C           WSCNUM    CHAINSDPLCSL1             72                   S01486
     C           *IN72     IFEQ '1'                                       S01313
     C           *LOCK     IN   LDA                        ***************S01486
     C                     Z-ADD6         DBASE   30       **DB ERROR 06**S01313
     C***********          MOVEL'SDPLCSPD'DBFILE 10        ********S01313 S01486
     C                     MOVE 'SDPLCSPD'DBFILE           ***************S01486
     C                     MOVELPNCNUM    DBKEY  29                       S01313
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01313
     C                     END                             E2             S01313
     C           PNPTCY    IFNE QBCSBY                     B2             S01313
     C                     MOVE 'N'       QBAPBC                          B08255
     C                     END                             E2             S01313
     C***********          UPDATSDPLCSP0                           S01313 S01486
     C                     UPDAT@PLCSL1                                   S01486
     C                     END                             E1             S01313
     C**
     C** ACTION CODE A  OR C
     C**
     C           DDACTN    IFEQ 'A'
     C           DDACTN    OREQ 'C'
     C**
     C** ACCESS FILE
     C**
     C***********PMPORK    CHAINPMPORTPP             72                   S01486
     C           PMPORK    CHAINPMPORTPD             72                   S01486
     C**
     C           *IN72     IFEQ '0'
     C**
     C** RECORD UPDATED BY ANOTHER WORKSTATION
     C**
     C           PNTNLU    IFNE WWTNLU
     C                     EXSR #CBB
     C                     GOTO XTUPDF
     C                     END
     C**
     C                     MOVE BJMRDT    WWHLUP
     C                     Z-ADDWWDLUP    PNDLUP
     C                     MOVE WWMLUP    PNMLUP
     C                     Z-ADDWWYLUP    PNYLUP
     C                     TIME           PNTLUP
     C           DDACTN    IFEQ 'A'
     C           PNLCD     IFNE BJRDNB
     C                     MOVEL'A'       PNCHTP
     C                     END
     C                     MOVELDDPTFN    PNPTFN
     C                     MOVELDDPTFT    PNPTFT
     C                     MOVELDDCFGC    PNCFGC                          S01307
     C                     MOVELDDMNGI    PNMNGI
     C                     MOVE DDACSQ    PNACSQ                          S71062
     C****                 Z-ADDWWDPOP    PNDPOP                          45330
     C           BGLMCR    IFEQ 'N'
     C                     Z-ADDWWPDGS    PNPDGS
     C                     Z-ADDWWPDGF    PNPDGF
     C                     END
     C                     MOVELDDVLFQ    PNVLFQ
     C                     MOVELDDVLDM    PNVLDM
     C                     Z-ADDWWVLND    PNVLND
     C****                 MOVELDDAAD1    PNAAD1                          S01313
     C****                 MOVELDDAAD2    PNAAD2                          S01313
     C****                 MOVELDDAAD3    PNAAD3                          S01313
     C****                 MOVELDDAAD4    PNAAD4                          S01313
     C****                 MOVELDDAAD5    PNAAD5                          S01313
     C                     MOVELDDS1VR    PNS1VR                          S01313
     C                     MOVELDDS2VR    PNS2VR
     C                     MOVELDDS3VR    PNS3VR
     C                     MOVELDDS4VR    PNS4VR
     C                     MOVELDDS5VR    PNS5VR
     C                     MOVELDDS6VR    PNS6VR
     C                     MOVELDDS7VR    PNS7VR                          S01313
     C                     MOVELDDS8VR    PNS8VR                          S01313
     C                     MOVELDDS9VR    PNS9VR                          CPM005
     C                     MOVELDDS0VR    PNS0VR                          CPM005
     C           DDTYSM    IFNE *BLANKS                                   S01313
     C                     MOVE DDTYSM    PNTYSM                          S01313
     C                     ELSE                                           S01313
     C                     Z-ADD0         PNTYSM                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C                     MOVE DDADPP    PNADPP                          S01313
     C                     MOVE DDRPYP    PNRPYP                          S01313
     C           DDRPYP    IFEQ 'N'                                       S01313
     C           DDTYSM    ANDEQ'  '                                      S01313
     C           DDADPP    ANDEQ'  '                                      S01313
     C                     Z-ADD99999     PNPSDT                          S01313
     C                     ELSE                                           S01313
     C                     Z-ADDWWPSDT    PNPSDT                          S01313
     C                     END                                            S01313
     C                     MOVE DDPMNG    PNPMNG                          S01313
     C                     MOVELDDCASF    PNCASF
     C                     MOVE DDCASD    PNCASD
     C**
     C** FOLLOWING VALIDATION TO DETERMINE NEXT REPORT DATE
     C** IF REPORT DAY AND REPORT FREQUENCY ENTERED
     C** IF REPORT DAY EQUAL TO DAY OF RUN DATE THEN DEFAULT TO
     C** RUN DATE
     C** OTHERWISE CALCULATE IT BY THE MEAN OF SUBROUTINE ZFRQA
     C**
     C           DDCASN    IFEQ *BLANKS
     C           DDCASD    ANDNE*BLANKS
     C           DDCASF    ANDNE*BLANKS
     C                     MOVELBJMRDT    WWDAYN
     C                     MOVE DDCASD    WWCASD  20
     C           WWCASD    IFEQ WWDAYN
     C                     Z-ADDBJRDNB    PNCASN
     C                     ELSE
     C                     MOVE DDCASF    ZFREQ
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     MOVE DDCASD    ZMDAY
     C                     MOVE BJLCCY    ZCCY
     C                     EXSR ZFRQA
     C                     Z-ADDZDAYNO    PNCASN
     C                     END
     C                     ELSE
     C                     Z-ADDWWCASN    PNCASN
     C                     END
     C                     MOVELDDPOLC    PNPOLC
     C                     MOVELDDIPIN    PNIPIN
     C                     MOVELDDCYIN    PNCYIN
     C                     MOVELDDYPIN    PNYPIN
     C                     MOVELDDNPIN    PNNPIN
     C                     ELSE
     C           DDACTN    IFEQ 'C'
     C           WWDPCL    IFNE 0
     C                     MOVEL'C'       PNCHTP
     C                     ELSE
     C                     MOVEL'A'       PNCHTP
     C                     END
     C                     Z-ADDWWDPCL    PNDPCL
     C                     END
     C                     END
     C                     Z-ADDBJRDNB    PNLCD
     C                     Z-ADDWWNEWT    PNTNLU
     C                     END
     C*                                                                   CAC003
     C** If Analytical Accounting is switched on;                         CAC003
     C           *IN87     IFEQ '1'                                       CAC003
     C                     MOVE DDPRF2    PNPRFC                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C**
     C** RESET FIELD
     C**
     C                     MOVEL*BLANKS   PNWSI1
     C**
     C                     UPDATPMPORTP0
     C**
     C                     END
     C*
     C           XTUPDF    ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1009   - TO UPDATE PORTFOLIO CHARGES DETAILS FILE                    *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * #CBB     - TO PROCESS UPDATE BY ANOTHER WORKSTATION                    *
      * #Z1009   - TO TRANSFER SCREEN FIELDS TO FILE                           *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      **************************************************************************
     C           #P1009    BEGSR                           **#P1009  BSR**
     C*
     C*
     C                     MOVE 'N'       WWCHUP  1
     C                     MOVE '0'       *IN75
     C                     MOVE '0'       *IN76
     C                     MOVE '0'       *IN89
     C                     Z-ADD1         X
     C**
     C** READ THROUGH ALL CHARGE RECORDS ON SUBFILE
     C**
     C           X         DOUGT10
     C           *IN89     OREQ '1'
     C                     Z-ADDX         WWCGSQ
     C***********PMCHRK    CHAINPMCHRGPP             76                   S01486
     C           PMCHRK    CHAINPMCHRGPD             76                   S01486
     C           X         CHAINPM0110S1             75
     C**
     C** RECORD FOUND ON SUBFILE AND NOT BLANKED
     C**
     C           *IN75     IFEQ '0'
     C           DDCGCO    ANDNE*BLANKS
     C**
     C***RECORD*FOUND ON PMCHRGPP                                         S01486
     C** RECORD FOUND ON PMCHRGPD                                         S01486
     C**
     C**
     C* ACCESS LAST TRANSACTION NUMBER TO CHECK IF RECORD
     C* HAS BEEN UPDATED BY ANOTHER WORKSTATION
     C**
     C                     EXSR #Z1009
     C**
     C                     END
     C*
     C**                   END
     C*
     C                     ADD  1         X
     C*
     C                     END
     C**
     C** UPDATE CHARGE INFORMATION HELD ON PF/PMPORTPP
     C**
     C***********PMPORK    CHAINPMPORTPP             72                   S01486
     C           PMPORK    CHAINPMPORTPD             72                   S01486
     C**
     C           *IN72     IFEQ '0'
     C*
     C***IF*ANY*CHARGE*DETAILS INPUT TO PF/PMCHRGPP UPDATE CHARGE         S01486
     C***INFORMATION*ON PF/PMPORTPP                                       S01486
     C** IF ANY CHARGE DETAILS INPUT TO PF/PMCHRGPD UPDATE CHARGE         S01486
     C** INFORMATION ON PF/PMPORTPD                                       S01486
     C*
     C                     MOVELDDBCGY    PNBCGY
     C                     MOVELDDCSCY    PNCSCY
     C                     MOVELDDCUSA    PNCUSA
     C*
     C** DO NOT UPDATE WORKFIELDS FOR PORTFOLIO CLOSURE
     C           DDACTN    IFNE 'C'
     C           WWCHGP    ANDEQ'Y'                                       B08166
     C                     Z-ADDWWBCGY    PNBCGD
     C                     Z-ADDWWCSCY    PNCSDP
     C**********           Z-ADDWWCUSB    PNCUSB                          S01486
     C                     MOVE WWCUSB    PNCUSB                          S01486
     C                     END
     C*
     C                     UPDATPMPORTP0
     C*
     C** RESET CHARGE DETAILS
     C*
     C                     MOVE *BLANKS   PNBCGY
     C                     Z-ADD0         PNBCGD
     C                     MOVE *BLANKS   PNCSCY
     C                     Z-ADD0         PNCSDP
     C                     MOVE *BLANKS   PNCUSA
     C***********          Z-ADD0         WWCUSB                          085799
     C                     MOVE *BLANKS   WWCUSB                          085799
     C                     END
     C*
     C                     MOVE '0'       *IN76
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #P1010   - TO UPDATE PORTFOLIO DEFINITION AUDIT                        *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - TO PROCESS ABNORMAL END OF PROGRAM                          *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1004   - TO PROCESS DETAIL SCREEN AND UPDATE FILES                   *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #P1010    BEGSR                           **#P1010  BSR**
     C**
     C**
     C** ACCESS PORTFOLIO AUDIT RECORD
     C**
     C***********1         CHAINPMPORTZZ             72                   S01486
     C           1         CHAINPMPORTPA             72                   S01486
     C**
     C*** RECORD FOUND
     C**
     C           *IN72     IFEQ '0'
     C                     ADD  1         PNNORE
     C                     UPDATPMPORTZ0
     C                     ELSE
     C           *LOCK     IN   LDA                                       S01486
     C*                                                    ***************
     C                     Z-ADD5         DBASE            **DB ERROR 05**
     C************         MOVEL'PMPORTZZ'DBFILE           ***************S01486
     C                     MOVEL'PMPORTPA'DBFILE           ***************S01486
     C                     MOVE *BLANKS   DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C**
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #Z1009   - TO TRANSFER SCREEN FIELDS TO FILE                           *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1009   - TO UPDATE PORTFOLIO CHARGES DETAILS FILE                    *
      *                                                                        *
      **************************************************************************
     C           #Z1009    BEGSR                           **#Z1009  BSR**
     C*
     C                     MOVEL'D'       PORECI
     C                     MOVE BJMRDT    WWHLUP
     C                     Z-ADDWWDLUP    PODLUP
     C                     MOVE WWMLUP    POMLUP
     C                     Z-ADDWWYLUP    POYLUP
     C                     TIME           POTLUP
     C                     Z-ADDWWNEWT    POTNLU
     C                     Z-ADDBJRDNB    POLCD
     C                     Z-ADDRRN2      POCGSQ
     C**
     C                     MOVELDDCGCO    POCGCO
     C                     Z-ADDDDCGSH    POCGSP
     C                     MOVELDDCGSI    POCGSI
     C                     MOVELDDCGEI    POCGEI
     C                     MOVELDDCGFQ    POCGFQ
     C                     MOVELDDCGDY    POCGDY
     C                     Z-ADDDDCGNH    POCGND
     C                     MOVELDDCGST    POCGST
     C**
     C                     MOVELDDCSFQ    POCSFQ
     C                     MOVELDDCSDY    POCSDY
     C                     Z-ADDDDCSNH    POCSND
     C*                                                                   S01486
     C           BKPRCU    IFEQ 'Y'                                       S01486
     C                     MOVELDDPRFC    POPFRC                          S01486
     C                     END                                            S01486
     C**
     C** FIELDS FILLED WHEN INSERT OTHERWISE NOT UPDATED
     C**
     C           *IN76     IFEQ '1'
     C                     MOVEL'I'       POCHTP
     C                     MOVE WWPNP8    POCNUM
     C                     MOVELDDPREF    POPTFR
     C                     Z-ADD0         POCGAD
     C                     Z-ADD0         POCGLD
     C                     MOVEL*BLANK    POCSIS
     C                     MOVEL*BLANKS   POCCSP
     C                     Z-ADD0         POCSSP
     C                     MOVEL*BLANK    POCISP
     C                     Z-ADD0         POCGAJ
     C                     MOVEL*BLANK    POCGAS
     C                     MOVEL*BLANKS   POCGAP
     C                     MOVEL*BLANKS   POCSPR
     C                     Z-ADD0         POCGAT
     C                     Z-ADD0         POCSTT
     C*
     C** SET UP LAST ACCRUAL DATE. WHEN A NEW PORTFOLIO IS OPENED THE
     C** LAST ACCRUAL DATE SHOULD BE SET TO DATE PORTFOLIO OPENED
     C** IF CHARGES EFFECTIVE INDICATOR IS 'C'
     C** OTHERWISE SET TO 'NEXT ACCRUAL DATE
     C*
     C           PNCHTP    IFEQ 'I'
     C*
     C***********POCGEI    IFEQ 'C'
     C***********          Z-ADDPNDPOP    POCGLD                          R05914
     C*******              Z-ADDBJRDNB    POCGLD                    B07916R05914
     C           BJRDNB    SUB  1         POCGLD                          B07916
     C***********          ELSE
     C***********          Z-ADDPOCGND    POCGLD
     C***********          END
     C                     ELSE
     C*
     C** IF A PORTFOLIO DEFINITION IS BEING AMENDED TO INCLUDE AN
     C** EXTRA CHARGE CODE AND PORTFOLIO DEFINED ON A PREVIOUS DATE
     C** SET LAST ACCRUAL DATE TO TODAY
     C*
     C           DDACTN    IFEQ 'A'
     C*
     C***********POCGEI    IFEQ 'C'
     C*******              Z-ADDBJRDNB    POCGLD                    B07916R05914
     C           BJRDNB    SUB  1         POCGLD                          B07916
     C***********          ELSE
     C***********          Z-ADDPOCGND    POCGLD
     C***********          END
     C                     END
     C                     END
     C*
     C                     WRITEPMCHRGP0
     C                     ELSE
     C** RECORD DOES EXIST AND WILL BE AMENDED
     C**
     C                     MOVEL'A'       POCHTP
     C                     UPDATPMCHRGP0
     C                     END
     C**
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * #V1006   - TO VALIDATE PORTFOLIO CHARGES DETAILS                       *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      ********ZA0240   - TO ACCESS MESSAGE FILE AND SEND MESSAGE          R00300
      * ZASNMS   - WRITE ERROR MESSAGES                                   R00300
      * #ZED     - TO COMPUTE DECIMAL NUMBER AND ACCESS ZEDIT SR               *
      * ZALIGN   - SR/ TO RIGHT ALIGN NUMERIC FIELDS                           *
      * ZDATE1   - TO COMPUTE DATE IN DAY NUMBER                               *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1005   - TO PROCESS PORTFOLIO CHARGE DETAILS                         *
      *                                                                        *
      **************************************************************************
     C           #V1006    BEGSR                           ** #V1006 BSR**
     C**
     C** RESET ERROR INDICATORS
     C**
     C                     MOVE '0'       *IN32
     C                     MOVE '0'       *IN33
     C                     MOVE '0'       *IN34
     C                     MOVE '0'       *IN54                           S01486
     C*
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDBCGY    BANK CHARGING CURRENCY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C                     MOVE 'N'       DDBCDF  1
     C           DDBCGY    IFEQ *BLANKS
     C**
     C** IF NOT ENTERED SET DEFAULT TO BASE CURRENCY
     C**
     C                     MOVE 'Y'       DDBCDF
     C                     MOVE BJCYCD    DDBCGY
     C                     END
     C**
     C** IF  ENTERED MUST BE VALID ON SDCURRL0
     C** LOOK UP FOR NUMBER OF DECIMALS
     C**
     C***********DDBCGY    CHAINSDCURRL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C*********************MOVEL'PM11300' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM DDBCGY    WWKEY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     MOVEL'PM11300' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN32
     C                     ELSE
     C*********************Z-ADDA6DPBF    WWBCGY  10                      046461
     C                     Z-ADDA6NBDP    WWBCGY  10                      046461
     C                     END
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCSCY     CUSTOMER SETTLEMENT CURRENCY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C                     MOVE 'N'       DDCSDF  1
     C           DDCSCY    IFEQ *BLANKS
     C**
     C** IF NOT ENTERED SET DEFAULT TO BASE CURRENCY
     C**
     C                     MOVE 'Y'       DDCSDF
     C                     MOVE QBCSBY    DDCSCY
     C                     END
     C**
     C** IF ENTERED MUST BE VALID ON SDCURRL0
     C**
     C***********DDCSCY    CHAINSDCURRL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C*********************MOVEL'PM11301' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM DDCSCY    WWKEY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     MOVEL'PM11301' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN33
     C                     ELSE
     C******************** Z-ADDA6DPBF    WWCSCY                          046461
     C                     Z-ADDA6NBDP    WWCSCY                          046461
     C                     END
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCUSA     CUSTOMER SETTLEMENT ACCOUNT
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C                     MOVE 'N'       WWCUSV  1
     C           DDCUSA    IFEQ *BLANKS
     C**
     C** MUST BE ENTERED IF ANY CHARGE DETAILS HAVE BEEN ENTERED
     C**
     C                     Z-ADD1         X
     C           X         DOUEQ10
     C           X         CHAINPM0110S1             72
     C           *IN72     IFEQ '0'
     C           DDCGCO    ANDNE*BLANKS
     C*********************MOVEL'PM11302' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11302' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN34
     C                     END
     C                     ADD  1         X
     C                     END
     C**
     C                     ELSE
     C**
     C** IF RETAIL ACCOUNT ENTERED - MUST BE VALID
     C**
     C                     MOVELDDCUSA    WWCUSA
     C           WWCSA2    IFEQ *BLANKS
     C           WWCSA1    CHAINACNUMTBF             73
     C*                                                                   R00954
     C** IF VALID ACCOUNT FOUND TEST RETAIL INDICATORS                    R00954
     C           *IN73     IFEQ '0'                                       R00954
     C           RECI      ANDEQ'D'                                       R00954
     C                     EXSR TESTRI                                    R00954
     C                     END                                            R00954
     C*                                                                   R00954
     C           *IN73     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *IN66     OREQ '0'                                       R00954
     C*********************MOVEL'PM11303' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11303' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN34
     C***********          ELSE                                           163634
     C***********          MOVELDDCSCY    WWCUCY                   085799 163634
     C***********          MOVELDDBRCA    WWBRCA                   085799 163634
     C***********PMACCN    CHAINACCNTABF             73            085799 163634
     C***********                                                  085799 163634
     C************IN73     IFEQ '1'                                085799 163634
     C***********RECI      ORNE 'D'                                085799 163634
     C***********          MOVEL'PM11304' ZAMSID                   085799 163634
     C***********          EXSR ZASNMS                             085799 163634
     C***********          MOVE '1'       *IN80                    085799 163634
     C***********          MOVE '1'       *IN34                    085799 163634
     C***********          ELSE                                    085799 163634
     C************         MOVE BRCD      WWCUSB  30                      S01486
     C***********          MOVE BRCA      WWCUSB  30                S01486085799
     C***********          MOVE BRCA      WWCUSB  3                085799 163634
     C***********          MOVE 'Y'       WWCUSV                          163634
     C***********          END                                     085799 163634
     C                     END
     C**
     C                     ELSE
     C**
     C** IF 12 ALPHA ACCOUNT ENTERED - MUST BE VALID
     C** WHEN COMBINED WITH CURRENCY
     C**
     C                     MOVELDDCSCY    WWCUCY
     C                     MOVELDDBRCA    WWBRCA                          085799
     C           PMACCN    CHAINACCNTABF             73
     C*                                                                   R00954
     C** IF VALID ACCOUNT FOUND TEST RETAIL INDICATORS                    R00954
     C           *IN73     IFEQ '0'                                       R00954
     C           RECI      ANDEQ'D'                                       R00954
     C                     EXSR TESTRI                                    R00954
     C                     END                                            R00954
     C*                                                                   R00954
     C           *IN73     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *IN66     OREQ '0'                                       R00954
     C******                                                              R00954
     C** TEST RETAIL INDICATORS TO SEE IF ACCOUNT IS BLOCKED              R00954
     C******               EXSR TESTRI                                    R00954
     C******     *IN66     IFEQ '0'                                       R00954
     C*********************MOVEL'PM11304' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11304' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN34
     C                     ELSE
     C********             MOVE BRCD      WWCUSB  30                      S01486
     C***********          MOVE BRCA      WWCUSB  30                S01486085799
     C                     MOVE BRCA      WWCUSB  3                       085799
     C                     MOVE 'Y'       WWCUSV
     C********             END                                            R00954
     C                     END                                            R00367
     C*
     C                     END
     C**
     C** IF CUSTOMER ACCOUNT ENTERED, CUSTOMER SETTLEMENT CURRENCY
     C** MUST BE VALID
     C**
     C           CCY       IFNE DDCSCY
     C           WWCUSV    ANDEQ'Y'
     C*********************MOVEL'PM11338' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11338' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN33
     C                     MOVE '1'       *IN34
     C                     END
     C*                                                                   085799
     C** If BGMBIN = N, branch on ACNUM file must equal Single Branch     085799
     C** code on SDBANKPD                                                 085799
     C*                                                                   085799
     C           BGMBIN    IFEQ 'N'                                       085799
     C           BJSBRC    ANDNEDDBRCA                                    085799
     C           WWCUSV    ANDEQ'Y'                                       085799
     C                     MOVEL'PM11304' ZAMSID                          085799
     C                     EXSR ZASNMS                                    085799
     C                     MOVE '1'       *IN80                           085799
     C                     MOVE '1'       *IN34                           085799
     C                     END                                            085799
     C*
     C                     END
     C**
     C***********          MOVEA*BLANKS   CG,1                            S01486
     C           DDACTN    IFEQ 'I'                                       146302
     C                     MOVEA*BLANKS   CG,1                            141883
     C                     END                                            146302
     C***********          Z-ADD1         X                               S01486
     C***********X         DOUGT10                                        S01486
     C                     Z-ADD1         Z       40                      S01486
     C           Z         DOWLEX                                         S01486
     C*
     C** RESET SCREEN ERROR INDICATORS
     C*
     C                     MOVE '0'       *IN35
     C                     MOVE '0'       *IN36
     C                     MOVE '0'       *IN37
     C                     MOVE '0'       *IN38
     C                     MOVE '0'       *IN39
     C                     MOVE '0'       *IN40
     C                     MOVE '0'       *IN41
     C                     MOVE '0'       *IN42
     C                     MOVE '0'       *IN43
     C                     MOVE '0'       *IN44
     C                     MOVE '0'       *IN45
     C                     MOVE '0'       *IN54                           S01486
     C**
     C** RESET WORK FIELDS
     C**
     C                     Z-ADD0         WWCGSP
     C                     Z-ADD0         WWCGND
     C                     Z-ADD0         WWCSND
     C                     MOVE 'N'       WWMSG   1
     C                     MOVE 'Y'       WWVALD
     C**
     C***********X         CHAINPM0110S1             75                   S01486
     C           Z         CHAINPM0110S1             75                   S01486
     C**
     C           *IN75     IFEQ '0'
     C*
     C** ONCE CHARGE INFORMATION HAS BEEN OUTPUT TO CHARGE DETAILS
     C** FILE IT MAY NOT BE BLANKED OUT
     C           DDVALD    IFEQ 'Y'
     C           DDCGCO    IFEQ *BLANKS
     C           DDCGCH    ANDNE*BLANKS
     C                     MOVE '1'       *IN35
     C                     MOVE DDCGCH    DDCGCO
     C                     END
     C*
     C           DDCGEI    IFEQ *BLANKS
     C           DDCGEH    ANDNE*BLANKS
     C                     MOVE DDCGEH    DDCGEI
     C                     MOVE '1'       *IN38
     C                     END
     C*
     C           DDCGFQ    IFEQ *BLANKS
     C           DDCGFH    ANDNE*BLANKS
     C                     MOVE DDCGFH    DDCGFQ
     C                     MOVE '1'       *IN39
     C                     END
     C*
     C           DDCGDY    IFEQ *BLANKS
     C           DDCGDH    ANDNE*BLANKS
     C           DDCGFQ    ANDNE'W'                                       080674
     C           DDCGFQ    ANDNE'F'                                       080674
     C                     MOVE DDCGDH    DDCGDY
     C                     MOVE '1'       *IN40
     C                     END
     C*
     C           DDCGST    IFEQ *BLANKS
     C           DDCGTH    ANDNE*BLANKS
     C                     MOVE DDCGTH    DDCGST
     C                     MOVE '1'       *IN42
     C                     END
     C*
     C           DDCSFQ    IFEQ *BLANKS
     C           DDCSFH    ANDNE*BLANKS
     C                     MOVE DDCSFH    DDCSFQ
     C                     MOVE '1'       *IN43
     C                     END
     C*
     C           DDCSDY    IFEQ *BLANKS
     C           DDCSDH    ANDNE*BLANKS
     C                     MOVE DDCSDH    DDCSDY
     C                     MOVE '1'       *IN44
     C                     END
     C*
     C** IF ANY OF ERROR INDICATORS ARE ON SEND ERROR MESSAGE
     C*
     C           *IN35     IFEQ '1'
     C           *IN38     OREQ '1'
     C           *IN39     OREQ '1'
     C           *IN40     OREQ '1'
     C           *IN42     OREQ '1'
     C           *IN43     OREQ '1'
     C           *IN44     OREQ '1'
     C           *IN54     OREQ '1'                                       S01486
     C*********************MOVEL'PM11320' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11320' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     END
     C                     END
     C*
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCGCO       CHARGE CODE
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDCGCO    IFNE *BLANKS
     C**
     C** IF ENTERED MUST BE A VALID CHARGE CODE
     C**
     C***********PMCODE    CHAINPMCGCDPP             72                   S01486
     C           PMCODE    CHAINPMCGCDPD             72                   S01486
     C           *IN72     IFEQ '1'
     C           P5RECI    ORNE 'D'
     C                     MOVE 'N'       WWVALD
     C*********************MOVEL'PM11305' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11305' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN35
     C                     END
     C**
     C** CHARGE SEQUENCE MUST BE UNIQUE
     C*
     C           DDCGCO    IFNE DDCGCH                                    080674
     C           DDCGCO    LOKUPCG,1                     75
     C**
     C           *IN75     IFEQ '1'
     C           WWMSG     ANDEQ'N'
     C                     MOVE 'N'       WWVALD
     C*********************MOVEL'PM11306' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11306' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN35
     C                     MOVE 'Y'       WWMSG
     C                     ELSE
     C                     MOVE DDCGCO    CG,X
     C                     END
     C                     END                                            080674
     C**
     C                     ELSE
     C**
     C** MUST BE ENTERED IF ANY CHARGE DETAILS HAVE BEEN ENTERED
     C**
     C                     MOVE DDCGCO    CG,X                            177647
      *                                                                   177647
     C           DDCGSP    IFNE *BLANKS
     C           DDCGSI    ORNE *BLANKS
     C           DDCGEI    ORNE *BLANKS
     C           DDCGFQ    ORNE *BLANKS
     C           DDCGDY    ORNE *BLANKS
     C           DDCGND    ORNE *BLANKS
     C           DDCGST    ORNE *BLANKS
     C           DDCSFQ    ORNE *BLANKS
     C           DDCSDY    ORNE *BLANKS
     C           DDCSND    ORNE *BLANKS
     C*********************MOVEL'PM11308' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11308' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN35
     C                     END
     C                     END
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCGSP      CHARGE SPREAD
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDCGSP    IFNE *BLANKS
     C           WWVALD    ANDEQ'Y'
     C**
     C** MUST NOT BE ENTERED IF CHARGE CODE IS BLANK
     C**
     C           DDCGCO    IFEQ *BLANKS
     C*********************MOVEL'PM11309' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11309' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN36
     C                     END
     C**
     C** MUST BE A VALID AMOUNT
     C**
     C           DDCGCO    IFNE *BLANKS
     C                     EXSR #ZED
     C           P5CGBS    IFEQ 'F'
     C                     MOVE DDCGSP    ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C*********************MOVEL'PM11310' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11310' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN36
     C                     ELSE
     C                     MOVE ZFIELD    WWCGSP
     C                     Z-ADDWWCGSP    DDCGSH
     C*
     C**
     C** IF ENTERED AND CHARGE BASIS IS FLAT AND CHARGE SPREAD
     C** INDICATOR IS '-' MUST BE LESS OR EQUAL TO THE SMALLEST
     C** OF THE FLAT CHARGE LEVEL ON PMCGCDPP
     C**
     C**
     C           DDCGSI    IFEQ '-'
     C           P5FLC1    IFLT WWCGSP
     C           P5CRU1    ORNE 0
     C           P5FLC2    ANDLTWWCGSP
     C           P5CRU2    ORNE 0
     C           P5FLC3    ANDLTWWCGSP
     C           P5CRU3    ORNE 0
     C           P5FLC4    ANDLTWWCGSP
     C           P5CRU4    ORNE 0
     C           P5FLC5    ANDLTWWCGSP
     C           P5CRU5    ORNE 0
     C           P5FLC6    ANDLTWWCGSP
     C           P5CRU6    ORNE 0
     C           P5FLC7    ANDLTWWCGSP
     C           P5CRU7    ORNE 0
     C           P5FLC8    ANDLTWWCGSP
     C           P5CRU8    ORNE 0
     C           P5FLC9    ANDLTWWCGSP
     C           P5CRU9    ORNE 0
     C           P5FL10    ANDLTWWCGSP
     C           P5CR10    ORNE 0
     C           P5FL11    ANDLTWWCGSP
     C           P5CR11    ORNE 0
     C           P5FL12    ANDLTWWCGSP
     C           P5CR12    ORNE 0
     C           P5FL13    ANDLTWWCGSP
     C           P5CR13    ORNE 0
     C           P5FL14    ANDLTWWCGSP
     C           P5CR14    ORNE 0
     C           P5FL15    ANDLTWWCGSP
     C*********************MOVEL'PM11311' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11311' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN36
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C           P5CGBS    IFEQ 'P'
     C**
     C** MUST BE A VALID AMOUNT
     C**
     C                     MOVE DDCGSP    ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C*********************MOVEL'PM11312' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11312' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN36
     C                     ELSE
     C                     MOVE ZFIELD    WWCGSP
     C                     Z-ADDWWCGSP    DDCGSH
     C**
     C** IF ENTERED AND CHARGE BASIS IS PERCENTAGE AND CHARGE SPREAD
     C** INDICATOR IS '-' MUST BE LESS OR EQUAL TO THE SMALLEST
     C***OF*THE*PERCENTAGE LEVEL ON PMCGCDPP                              S01486
     C** OF THE PERCENTAGE LEVEL ON PMCGCDPD                              S01486
     C**
     C           DDCGSI    IFEQ '-'
     C*
     C** FIRST CONVERT PERCENTAGE LEVEL  FIELDS
     C**
     C           P5PCL1    MULT 10000000  WWPCL1
     C           P5PCL2    MULT 10000000  WWPCL2
     C           P5PCL3    MULT 10000000  WWPCL3
     C           P5PCL4    MULT 10000000  WWPCL4
     C           P5PCL5    MULT 10000000  WWPCL5
     C           P5PCL6    MULT 10000000  WWPCL6
     C           P5PCL7    MULT 10000000  WWPCL7
     C           P5PCL8    MULT 10000000  WWPCL8
     C           P5PCL9    MULT 10000000  WWPCL9
     C           P5PC10    MULT 10000000  WWPC10
     C           P5PC11    MULT 10000000  WWPC11
     C           P5PC12    MULT 10000000  WWPC12
     C           P5PC13    MULT 10000000  WWPC13
     C           P5PC14    MULT 10000000  WWPC14
     C           P5PC15    MULT 10000000  WWPC15
     C*
     C           WWPCL1    IFLT WWCGSP
     C           P5CRU1    ORNE 0
     C           WWPCL2    ANDLTWWCGSP
     C           P5CRU2    ORNE 0
     C           WWPCL3    ANDLTWWCGSP
     C           P5CRU3    ORNE 0
     C           WWPCL4    ANDLTWWCGSP
     C           P5CRU4    ORNE 0
     C           WWPCL5    ANDLTWWCGSP
     C           P5CRU5    ORNE 0
     C           WWPCL6    ANDLTWWCGSP
     C           P5CRU6    ORNE 0
     C           WWPCL7    ANDLTWWCGSP
     C           P5CRU7    ORNE 0
     C           WWPCL8    ANDLTWWCGSP
     C           P5CRU8    ORNE 0
     C           WWPCL9    ANDLTWWCGSP
     C           P5CRU9    ORNE 0
     C           WWPC10    ANDLTWWCGSP
     C           P5CR10    ORNE 0
     C           WWPC11    ANDLTWWCGSP
     C           P5CR11    ORNE 0
     C           WWPC12    ANDLTWWCGSP
     C           P5CR12    ORNE 0
     C           WWPC13    ANDLTWWCGSP
     C           P5CR13    ORNE 0
     C           WWPC14    ANDLTWWCGSP
     C           P5CR14    ORNE 0
     C           WWPC15    ANDLTWWCGSP
     C*********************MOVEL'PM11313' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11313' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN36
     C                     ELSE
     C                     Z-ADDWWCGSP    DDCGSH
     C                     END
     C**
     C                     END
     C**
     C                     END
     C                     END
     C**
     C                     END
     C**
     C                     ELSE
     C                     Z-ADD0         DDCGSH
     C                     END
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCGSI   CHARGE SPREAD INDICATOR
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C** CANNOT BE ENTERED IF CHARGE SPREAD NON ENTERED
     C**
     C           DDCGSI    IFNE *BLANKS
     C**
     C           DDCGSP    IFEQ *BLANKS
     C*********************MOVEL'PM11336' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11336' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN37
     C                     END
     C**
     C** IF ENTERED MUST BE '+' OR '-'
     C**
     C           DDCGSI    IFNE '+'
     C           DDCGSI    ANDNE'-'
     C*********************MOVEL'PM11315' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11315' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN37
     C                     END
     C**
     C                     ELSE
     C**
     C** MUST BE ENTERED IF CHARGE SPREAD SPECIFIED
     C**
     C           DDCGSP    IFNE *BLANKS
     C*********************MOVEL'PM11314' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11314' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN37
     C                     END
     C**
     C                     END
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCGEI     CHARGE EFFECTIVE INDICATOR
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           DDCGCO    IFNE *BLANKS
     C**
     C** MUST BE EQUAL TO 'C' OR 'N'
     C**
     C           DDCGEI    IFNE 'C'
     C           DDCGEI    ANDNE'N'
     C*********************MOVEL'PM11316' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11316' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN38
     C                     END
     C**
     C                     END
     C**
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCGFQ     CHARGE FREQUENCY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C                     MOVE 'Y'       WWCGFQ  1
     C           DDCGFQ    IFEQ *BLANKS
     C**
     C** MUST BE ENTERED IF CHARGE CODE SPECIFIED
     C**
     C           DDCGCO    IFNE *BLANKS
     C*********************MOVEL'PM11317' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11317' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN39
     C                     END
     C********
     C***ONCE PRESENT ON PF/PMCHRGXX FOR THIS CHARGE SEQUENCE,THIS FIELD
     C***CANNOT BE SET TO BLANK
     C********
     C********   DDCGFH    IFNE *BLANKS
     C********             MOVE 'N'       WWCGFQ
     C********             MOVEL'PM11320' MSGID
     C********             CALL 'ZA0240'
     C********             PARM           MSGID
     C********             MOVE '1'       *IN80
     C********             MOVE '1'       *IN39
     C********             MOVELDDCGFH    DDCGFQ
     C********             END
     C                     ELSE
     C**
     C** IF ENTERED MUST BE 'W', 'F', 'M', 'Q', 'X' OR 'Y'
     C**
     C           DDCGFQ    IFNE 'W'
     C           DDCGFQ    ANDNE'F'
     C           DDCGFQ    ANDNE'M'
     C           DDCGFQ    ANDNE'Q'
     C           DDCGFQ    ANDNE'X'
     C           DDCGFQ    ANDNE'Y'
     C                     MOVE 'N'       WWCGFQ
     C*********************MOVEL'PM11318' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11318' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN39
     C                     END
     C**
     C** IF ENTERED AS 'M', 'Q', 'X' OR 'Y' CHARGE DAY IN MONTH
     C** MUST ALSO BE SPECIFIED
     C**
     C           DDCGDY    IFEQ *BLANKS
     C           DDCGFQ    IFEQ 'M'
     C           DDCGFQ    OREQ 'Q'
     C           DDCGFQ    OREQ 'X'
     C           DDCGFQ    OREQ 'Y'
     C                     MOVE 'N'       WWCGFQ
     C*********************MOVEL'PM11319' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11319' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN40
     C                     END
     C                     END
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCGDY      CHARGE DAY IN MONTH
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C                     MOVE 'Y'       WWCGDV  1
     C           DDCGDY    IFNE *BLANKS
     C**
     C** IF ENTERED CHARGE FREQUENCY MUST BE 'M', 'Q', 'X' OR 'Y'
     C**
     C           DDCGFQ    IFNE 'M'
     C           DDCGFQ    ANDNE'Q'
     C           DDCGFQ    ANDNE'X'
     C           DDCGFQ    ANDNE'Y'
     C                     MOVE 'N'       WWCGDV
     C*********************MOVEL'PM11321' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11321' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN40
     C                     END
     C**
     C** IF ENTERED MUST BE A NUMBER IN THE RANGE 1-31
     C**
     C                     MOVE DDCGDY    WWCGDY  20
     C                     MOVE WWCGDY    WWCCDY  2
     C           WWCCDY    IFNE DDCGDY
     C           WWCGDY    ORLT 1
     C           WWCGDY    ORGT 31
     C                     MOVE 'N'       WWCGDV
     C*********************MOVEL'PM11322' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11322' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN40
     C                     END
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCGND       NEXT ACCRUAL DATE
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C** IF ENTERED MUST BE A VALID DATE
     C**
     C           DDCGND    IFNE *BLANKS                    - B1
     C**
     C                     Z-ADD0         WWDAT1
     C                     MOVE *BLANKS   WWDAT2
     C                     MOVE DDCGND    WWDAT1
     C                     MOVE WWDAT1    WWDAT2
     C**
     C                     MOVELDDCGND    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'                        - B2
     C           DDCGND    ORNE WWDAT2
     C*********************MOVEL'PM11323' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11323' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN41
     C                     ELSE                            - X2
     C                     Z-ADDZDAYNO    WWCGND  50
     C                     END                             - E2
     C*
     C**
     C** IF ENTERED CANNOT BE BEFORE DATE PORTFOLIO OPENED
     C**
     C           WWCGND    IFLT BJRDNB                     - B2
     C*********************MOVEL'PM11324' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11324' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN41
     C                     ELSE                            - X2
     C                     Z-ADDWWCGND    DDCGNH
     C                     END                             - E2
     C**
     C                     ELSE                            - X1
     C**
     C** IF NEXT ACCRUAL DATE NOT ENTERED GENERATE IT FROM DETAILS ENTERED
     C**
     C           WWCGDV    IFEQ 'Y'
     C           WWCGFQ    ANDEQ'Y'
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     MOVELDDCGFQ    ZFREQ
     C                     MOVELDDCGDY    ZMDAY
     C                     MOVELBJCYCD    ZCCY
     C                     EXSR ZFRQA
     C                     Z-ADDZDAYNO    WWCGND
     C                     Z-ADDZDAYNO    DDCGNH
     C                     END
     C*
     C** IF NEXT ACCRUAL DATE DAY IN MONTH SAME AS TODAYS DATE DEFAULT
     C** NEXT ACCRUAL DATE TO RUN DATE
     C*
     C                     MOVELBJMRDT    WWDAY   20
     C           WWCGDY    IFEQ WWDAY
     C           DDCGDY    OREQ *BLANKS
     C           DDCGFQ    ANDEQ'W'
     C                     Z-ADDBJRDNB    WWCGND
     C                     Z-ADDWWCGND    DDCGNH
     C                     END
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCGST        CHARGE STOPPED
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C*
     C** DEFAULT CHARGE STOPPED INDICATOR TO 'N'
     C*
     C           DDCGST    IFEQ *BLANK
     C                     MOVE 'N'       DDCGST
     C                     END
     C**
     C** IF ENTERED MUST BE 'Y' OR 'N'
     C**
     C           DDCGST    IFNE 'Y'
     C           DDCGST    ANDNE'N'
     C*********************MOVEL'PM11325' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11325' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN42
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCSFQ        CHARGE SETTLEMENT FREQUENCY
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C                     MOVE 'Y'       WWCSFQ  1
     C           DDCSFQ    IFEQ *BLANKS
     C**
     C** MUST BE ENTERED IF CHARGE FREQUENCY HAS BEEN SPECIFIED
     C**
     C           DDCGCO    IFNE *BLANKS
     C                     MOVE 'N'       WWCSFQ
     C*********************MOVEL'PM11328' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11328' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN43
     C                     END
     C*******
     C***ONCE PRESENT ON PF/PMCHRGXX FOR THIS CHARGE SEQUENCE,THIS FIELD
     C***CANNOT BE SET TO BLANK
     C*******
     C*******    DDCSFH    IFNE *BLANKS
     C*******              MOVE 'N'       WWCSFQ
     C*******              MOVEL'PM11329' MSGID
     C*******              CALL 'ZA0240'
     C*******              PARM           MSGID
     C*******              MOVE '1'       *IN80
     C*******              MOVE '1'       *IN43
     C*******              MOVELDDCSFH    DDCSFQ
     C*******              END
     C**
     C                     ELSE
     C**
     C** IF ENTERED MUST BE  'M', 'Q', 'X' OR 'Y'
     C**
     C           DDCSFQ    IFNE 'M'
     C           DDCSFQ    ANDNE'Q'
     C           DDCSFQ    ANDNE'X'
     C           DDCSFQ    ANDNE'Y'
     C                     MOVE 'N'       WWCSFQ
     C*********************MOVEL'PM11327' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11327' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN43
     C                     END
     C**
     C** IF ENTERED CHARGE SETTLEMENT DAY MUST ALSO BE SPECIFIED
     C**
     C           DDCSDY    IFEQ *BLANKS
     C                     MOVE 'N'       WWCSFQ
     C*********************MOVEL'PM11326' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11326' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN44
     C                     END
     C**
     C** ACCRUALS MUST OCCUR AS FREQUENTLY OR MORE FREQUENTLY
     C** THAN SETTLEMENTS
     C**
     C           DDCGFQ    IFEQ 'Q'
     C           DDCSFQ    ANDNE'Q'
     C           DDCSFQ    ANDNE'X'
     C           DDCSFQ    ANDNE'Y'
     C                     MOVE 'N'       WWCSFQ
     C*********************MOVEL'PM11330' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11330' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN43
     C                     END
     C**
     C           DDCSFQ    IFEQ 'X'
     C           DDCSFQ    ANDNE'X'
     C           DDCSFQ    ANDNE'Y'
     C                     MOVE 'N'       WWCSFQ
     C*********************MOVEL'PM11330' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11330' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN43
     C                     END
     C**
     C           DDCSFQ    IFEQ 'Y'
     C           DDCSFQ    ANDNE'Y'
     C                     MOVE 'N'       WWCSFQ
     C*********************MOVEL'PM11330' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11330' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN43
     C                     END
     C**
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCSDY     CHARGE SETTLEMENT DAY IN MONTH
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C                     MOVE 'Y'       WWCSDV  1
     C           DDCSDY    IFNE *BLANKS
     C**
     C** IF ENTERED CHARGE SETTLEMENT FREQUENCY MUST ALSO BE
     C** SPECIFIED
     C**
     C           DDCSFQ    IFEQ *BLANKS
     C                     MOVE 'N'       WWCSDV
     C*********************MOVEL'PM11331' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11331' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN43
     C                     END
     C**
     C** IF ENTERED MUST BE A NUMBER IN THE RANGE 1-31
     C**
     C                     MOVE DDCSDY    WWCSDY  20
     C                     MOVE WWCSDY    WWSSDY  2
     C           WWSSDY    IFNE DDCSDY
     C           WWCSDY    ORLT 1
     C           WWCSDY    ORGT 31
     C                     MOVE 'N'       WWCSDV
     C*********************MOVEL'PM11332' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11332' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN44
     C                     END
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** VAL6DDCSND      NEXT SETTLEMENT DATE
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C**
     C** IF ENTERED MUST BE A VALID DATE
     C**
     C           DDCSND    IFNE *BLANKS
     C**
     C                     Z-ADD0         WWDAT1
     C                     MOVE *BLANKS   WWDAT2
     C                     MOVE DDCSND    WWDAT1
     C                     MOVE WWDAT1    WWDAT2
     C**
     C                     MOVELDDCSND    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C           DDCSND    ORNE WWDAT2
     C*********************MOVEL'PM11333' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11333' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN45
     C                     ELSE
     C                     Z-ADDZDAYNO    WWCSND  50
     C                     END
     C*
     C**
     C** IF ENTERED CANNOT BE BEFORE DATE PORTFOLIO OPENED
     C**
     C           WWCSND    IFLT BJRDNB
     C*********************MOVEL'PM11334' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11334' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN45
     C                     ELSE
     C                     Z-ADDWWCSND    DDCSNH
     C                     END
     C**
     C                     ELSE
     C**
     C** IF NEXT SETTLEMENT DATE NOT ENTERED GENERATE IT FROM DETAILS ENTERED
     C**
     C           WWCSFQ    IFEQ 'Y'
     C           WWCSDV    ANDEQ'Y'
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     MOVELDDCSFQ    ZFREQ
     C                     MOVELDDCSDY    ZMDAY
     C                     MOVELBJCYCD    ZCCY
     C                     EXSR ZFRQA
     C                     Z-ADDZDAYNO    WWCSND
     C                     Z-ADDZDAYNO    DDCSNH
     C                     END
     C*
     C** IF NEXT SETLEMENT DAY IN MONTH SAME AS TODAYS DATE DEFAULT
     C** NEXT ACCRUAL DATE TO RUN DATE
     C*
     C                     MOVELBJMRDT    WWDAY   20
     C           WWCSDY    IFEQ WWDAY
     C                     Z-ADDBJRDNB    WWCSND
     C                     Z-ADDBJRDNB    DDCSNH
     C                     END
     C                     END
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++             S01486
     C** VAL6DDPRFC       PROFIT CENTRE                                   S01486
     C**+++++++++++++++++++++++++++++++++++++++++++++++++++++             S01486
     C**                                                                  S01486
     C           DDPRFC    IFNE *BLANKS                                   S01486
     C           BGN0ST    OREQ 'Y'                                       120827
     C**                                                                  S01486
     C** IF ENTERED MUST BE A VALID PROFIT CENTRE                         S01486
     C**                                                                  S01486
     C                     CALL 'AOPRFCR0'                                S01486
     C                     PARM *BLANKS   WWRTCD                          S01486
     C                     PARM '*KEY   ' WWOPTN                          S01486
     C                     PARM DDPRFC    WWKEY4  4                       S01486
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     MOVEL'PM14206' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN54                           S01486
     C                     MOVE '1'       *IN80                           S01486
     C                     ELSE                                           S01486
     C                     MOVELWWKEY4    DDPRFC                          S01486
     C                     END                                            S01486
     C                     ELSE                                           S01486
     C           EPRFC     IFEQ '2'                                       120827
     C                     MOVEL'PM14206' ZAMSID                          120827
     C                     EXSR ZASNMS                                    120827
     C                     MOVE '1'       *IN54                           120827
     C                     MOVE '1'       *IN80                           120827
     C                     ELSE                                           120827
     C** SET DEFAULT IF ANY OTHER DETAILS ENTERED                         S01486
     C           DDCGCO    IFNE *BLANKS                                   080674
     C           BKPRCU    ANDEQ'Y'                                       080674
     C*                                                                   CAC003
     C** Additional condition to enable profit centre defaulting          CAC003
     C** only when Analytical Accounting and CAC003 are not               CAC003
     C** available.                                                       CAC003
     C           *IN87     ANDEQ'0'                                       CAC003
     C                     MOVELWWPRFC    DDPRFC                          S01486
     C                     MOVEL'PM14205' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     MOVE '1'       *IN54                           S01486
     C                     MOVE '1'       *IN80                           S01486
     C                     END                                            080674
     C                     END                                            120827
     C                     END                                            S01486
     C*
     C** IF ALL DETAILS OTHER THAN CHARGE STOPPED ARE SET TO BLANK
     C** RESET CHARGE STOPPED TO BLANK
     C*
     C           DDCGCO    IFEQ *BLANKS
     C           DDCGSP    ANDEQ*BLANKS
     C           DDCGSI    ANDEQ*BLANKS
     C           DDCGEI    ANDEQ*BLANKS
     C           DDCGFQ    ANDEQ*BLANKS
     C           DDCGDY    ANDEQ*BLANKS
     C           DDCGND    ANDEQ*BLANKS
     C           DDCSFQ    ANDEQ*BLANKS
     C           DDCSDY    ANDEQ*BLANKS
     C           DDCSND    ANDEQ*BLANKS
     C           DDPRFC    ANDEQ*BLANKS                                   S01486
     C                     MOVE *BLANKS   DDCGST
     C                     END
     C**
     C** UPDATE RECORD OF SUBFILE
     C**
     C                     UPDATPM0110S1
     C**
     C                     END
     C**
     C***********          ADD  1         X                               S01486
     C                     ADD  1         Z                               S01486
     C*
     C                     END
     C*
     C**  BANK CHARGE CCY MAY NOT BE ENTERED IF NO CHARGE CODES DEFINED
     C*
     C                     MOVE 'N'       WWCGCF  1
     C           1         DO   10        Y       30
     C           CG,Y      IFNE *BLANKS
     C                     MOVE 'Y'       WWCGCF
     C                     END
     C                     END
     C**
     C           WWCGCF    IFEQ 'N'
     C           DDBCDF    IFEQ 'N'
     C*********************MOVEL'PM11339' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11339' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN32
     C                     ELSE
     C*
     C                     MOVE *BLANKS   DDBCGY
     C                     Z-ADD0         WWBCGY
     C                     END
     C                     END
     C*
     C**  CUSTOMER SETTLE CCY MAY NOT BE ENTERED IF NO CHARGE CODES DEFINED
     C*
     C**
     C           WWCGCF    IFEQ 'N'
     C           DDCSDF    IFEQ 'N'
     C*********************MOVEL'PM11402' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C*                    MOVEL'PM11402' ZAMSID                    R00300R5500
     C*                    EXSR ZASNMS                              R00300R5500
     C*                    MOVE '1'       *IN80                           R5500
     C*                    MOVE '1'       *IN33                           R5500
     C                     ELSE
     C*
     C                     MOVE *BLANKS   DDCSCY
     C                     Z-ADD0         WWCSCY
     C                     END
     C                     END
     C*
     C**  CUSTOMER SETTLE A/C MAY NOT BE ENTERED IF NO CHARGE CODES DEFINED
     C*
     C**         WWCGCF    IFEQ 'N'                                       B5862
     C**         DDCUSA    IFNE *BLANKS                                   B5862
     C*********************MOVEL'PM11403' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C**                   MOVEL'PM11403' ZAMSID                    R00300B5862
     C**                   EXSR ZASNMS                              R00300B5862
     C**                   MOVE '1'       *IN80                           B5862
     C**                   MOVE '1'       *IN34                           B5862
     C**                   Z-ADD0         WWCUSB                          B5862
     C**                   END                                            B5862
     C**                   END                                            B5862
     C*
     C                     ENDSR
     C**************************************************************************
      /EJECT                                                              R00367
      ******************************************************************* R00367
      *                                                                 * R00367
      * TESTRI   - TEST BIT SETTINGS FOR RETAIL INDICATORS FOR ACCOUNT  * R00367
      *            USED FOR CUSTOMER CHARGES                            * R00367
      *                                                                 * R00367
      ******************************************************************* R00367
      *                                                                   R00367
     C           TESTRI    BEGSR                                          R00367
     C*                                                                   R00367
     C                     MOVE '0'       *IN66                           R00367
     C******************** TESTB'0123'    RETB       66            R0974  R00367
     C                     TESTB'23'      RETB       66                   R0974
     C*                                                                   R00367
     C                     ENDSR                                          R00367
      ********************************************************************R00367
      /EJECT
      **************************************************************************
      *                                                                        *
      * #CBB     - TO PROCESS UPDATE BY ANOTHER WORKSTATION                    *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *********ZA0240   - TO ACCESS MESSAGE FILE AND SEND MESSAGE         R00300
      * ZASNMS   - WRITE ERROR MESSAGES                                   R00300
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1008   - TO UPDATE PORTFOLIO DEFINITION FILE                         *
      * #P1009   - TO UPDATE PORTFOLIO CHARGES DETAILS FILE                    *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           #CBB      BEGSR                           ** #CBB   BSR**
     C**
     C                     MOVE '0'       *IN11
     C                     MOVE '0'       *IN12
     C                     MOVE '1'       *IN10
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN89
     C*********************MOVEL'PM11400' MSGID                           R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           MSGID                           R00300
     C                     MOVEL'PM11400' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     ROLBK
     C**
     C                     ENDSR
     C**************************************************************************
      /EJECT
     C*****************************************************************   R00300
     C*                                                               *   R00300
     C* ZASNMS   - Send message to program message queue              *   R00300
     C*                                                               *   R00300
     C* CALLS    Y2SNMSGC                                             *   R00300
     C*                                                               *   R00300
     C* CALLED BY  #ZBAB  - Validate key fields from start screen.    *   R00300
     C*            #ZBAC  - Validate key fields from Review screen.   *   R00300
     C*            #CUST  - Validate customer number/shortname.       *   R00300
     C*            #P1004 - Process detail screen and update files.   *   R00300
     C*            #V1004 - Validate portfolio definition details.    *   R00300
     C*            #V1005 - Validate portfolio closed.                *   R00300
     C*            #P1005 - To process portfolio charge details.      *   R00300
     C*            #V1006 - To validate portfolio charge details.     *   R00300
     C*            #CBB   - To process update by another workstation. *   R00300
     C*                                                               *   R00300
     C*****************************************************************   R00300
     C           ZASNMS    BEGSR                                          R00300
     C*                                                                   R00300
     C                     CALL 'Y2SNMGC'                                 R00300
     C                     PARM           ZAPGM            Program queue  R00300
     C                     PARM           ZAPGRL           Rel queue      R00300
     C                     PARM           ZAMSID           Message Id.    R00300
     C                     PARM           ZAMSGF           Message file.  R00300
     C                     PARM           ZAMSDA           Message data.  R00300
     C                     PARM           ZAMSTP           Message type.  R00300
     C*                                                                   R00300
     C** Clear all fields for default mechanism next time.                R00300
     C                     MOVEL*BLANK    ZAPGM            Message queue  R00300
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      R00300
     C                     MOVEL*BLANK    ZAMSDA           Message data.  R00300
     C                     MOVEL*BLANK    ZAMSTP           Message type.  R00300
     C*                                                                   R00300
     C           ZASNM9    ENDSR                           ZASNM9 TAG     R00300
     C*                                                                   R00300
     C*****************************************************************   R00300
      /EJECT
      **************************************************************************
      *                                                                        *
      * *PSSR    - TO PROCESS ABNORMAL END OF PROGRAM                          *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * #CLOF    - TO PROCESS CLOSE OF FILES IN LOWER LEVEL PROGRAMS           *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1001   - TO INITIALIZE FIELDS AND ACCESS STANDING DATA               *
      * #P1008   - TO UPDATE PORTFOLIO DEFINITION FILE                         *
      * #P1010   - TO UPDATE PORTFOLIO DEFINITION AUDIT                        *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           *PSSR     BEGSR
     C*
     C** UPDATE LDA WITH ERROR INFORMATION
     C*
     C************NAMVAR   DEFN           LDA                             S01486
     C************LOCK     IN   LDA                                       S01486
     C***********          MOVELDBFILE    WWFILE                          S01486
     C***********          MOVELDBKEY     WWKEY                           S01486
     C***********          MOVELDBPGM     WWPGM                           S01486
     C***********          MOVELDBASE     WWASE                           S01486
     C***********          OUT  LDA                                       S01486
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C**
     C** ROLL BACK CHANGES, PRINT DUMP AND CANCEL PROGRAM
     C**
     C                     ROLBK
     C                     DUMP
     C                     CALL 'DBERRCTL'                                S01486
     C**
     C                     RETRN
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
      /COPY ZSRSRC,ZDATE1Z2
     C/EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZEDITZ2
      /EJECT
      /COPY ZSRSRC,ZALIGNZ2
      /EJECT
      /COPY ZSRSRC,ZFRQAZ2
      /EJECT
      /COPY ZSRSRC,ZCHKH                                                  S01486
      /EJECT                                                              S01486
      /COPY ZSRSRC,ZACCH                                                  S01486
      /EJECT                                                              S01486
      ********************************************************************S01486
      *            PROFIT CENTRE PROCESSING                               S01486
      * #PFRC    - TO RETRIEVE PROFIT CENTRE DEFAULTS                     S01486
      *                                                                   S01486
      * SUBROUTINE CALLS:                                                 S01486
      *                                                                   S01486
      * SUBROUTINE CALLED FROM:                                           S01486
      * #TRANS   - TO FILL SCREEN DETAILS                                 S01486
      *                                                                   S01486
      * ROUTINE USES VARIABLES:                                           S01486
      *                                                                   S01486
      ********************************************************************S01486
     C           #PFRC     BEGSR                                          S01486
     C*                                                                   S01486
     C**   PROFIT CENTRE PROCESSING :                                     S01486
     C**   IF DEFAULT MATRIX IS REQUIRED          BKPCDU=Y                S01486
     C** CHECK IF DEFAULT MATRIX USED                                     S01486
     C           BKPCDU    IFEQ 'Y'                                       S01486
     C**  LOOK UP FOR CUSTOMER AND ACCOUNT OFFICER DETAILS                S01486
     C**                                                                  S01486
     C                     EXSR #CSAC                                     S01486
     C**                                                                  S01486
     C                     MOVE BBCUST    WWKEY6  6                       S01486
     C**                                                                  S01486
     C                     CALL 'AOPRFMR0'                                S01486
     C                     PARM           WWRTC1  1                       S01486
     C                     PARM '  '      WWBOOK  2                       S01486
     C                     PARM 'PM   '   WWTRTP  5                       S01486
     C                     PARM 'PM'      WWSUBT  2                       S01486
     C                     PARM BBBRCD    WWBRCA  3                       S01486
     C                     PARM WWDEPT    WWDEPA  3                       S01486
     C                     PARM USID      WWUSER 10                       S01486
     C                     PARM WWACOF    WWAOFR  2                       S01486
     C                     PARM WWKEY6    WWCLIE  6                       S01486
     C                     PARM '    '    WWPROF  4                       S01486
     C**                                                                  S01486
     C           WWRTC1    IFEQ '0'                                       S01486
     C** STORE DEFAULT PROFIT CENTRE                                      S01486
     C                     MOVELWWPROF    WWPRFC  4                       S01486
     C                     END                                            S01486
     C**                                                                  S01486
     C           WWRTC1    IFEQ '2'                                       120827
     C                     MOVE 'Y'       EPRFC   1                       120827
     C                     END                                            120827
      *                                                                   120827
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ENDSR                                          S01486
      ********************************************************************S01486
      *            PROFIT CENTRE PROCESSING                               S01486
      * #CSAC    - TO RETRIEVE CUSTOMER AND ACCOUNT OFFICER DETAILS       S01486
      *                                                                   S01486
      * SUBROUTINE CALLS:                                                 S01486
      *                                                                   S01486
      * SUBROUTINE CALLED FROM:                                           S01486
      * #PFRC    - TO FILL SCREEN DETAILS                                 S01486
      *                                                                   S01486
      * ROUTINE USES VARIABLES:                                           S01486
      *                                                                   S01486
      ********************************************************************S01486
     C           #CSAC     BEGSR                                          S01486
     C*                                                                   S01486
     C** ACCESS CUSTOMER DETAILS                                          S01486
     C*                                                                   S01486
     C**                                                                  S01486
     C** CHECK IF SHORT NAME OR CUSTOMER NUMBER ENTERED                   S01486
     C**                                                                  S01486
     C                     MOVELDDCSNM    WWCNUM                          S01486
     C**********           TESTN          WWCNM1     83                                S01486 CSD027
     C           WWCNM2    IFEQ *BLANKS                    B2             S01486
     C********** *IN83     ANDEQ'1'                                                    S01486 CSD027
     C                     MOVEL'*CNUM  ' WWSORT  7                       S01486
     C                     ELSE                                           S01486
     C                     MOVEL'*CSHT  ' WWSORT                          S01486
     C                     END                                            S01486
     C                     MOVEL*BLANKS   WWCNUM                          S01486
     C**                                                                  S01486
     C                     MOVELDDCSNM    WWCSNM 10                       S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM WWCSNM    WWKY10 10                       S01486
     C                     PARM WWSORT    WWKE7   7                       S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD4         DBASE                           S01486
     C                     MOVE 'SDCUSTPD'DBFILE                          S01486
     C                     MOVELDDCSNM    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     MOVEL*BLANKS   WWACOF  2                       S01486
     C                     MOVEL*BLANKS   WWDEPT  3                       S01486
     C           BBACOC    IFNE *BLANKS                                   S01486
     C                     MOVELBBACOC    WWACOF                          S01486
     C*                                                                   S01486
     C** ACCESS ACCOUNT OFFICER DETAILS                                   S01486
     C*                                                                   S01486
     C                     CALL 'AOACOFR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM BBACOC    WWKEY2  2                       S01486
     C           SDACOF    PARM SDACOF    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD5         DBASE                           S01486
     C                     MOVE 'SDACOFPD'DBFILE                          S01486
     C                     MOVELBBACOC    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C                     MOVELAZDPCD    WWDEPT                          S01486
     C                     END                                            S01486
     C**                                                                  S01486
     C                     ENDSR                                          S01486
      **************************************************************************
      *                                                                        *
      * ZTNLU1   - TO LOCK AND ACCESS DATA AREA AND GET TRANSAC. NBR           *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * #P1008   - TO UPDATE PORTFOLIO DEFINITION FILE                         *
      *                                                                        *
      *                                                                        *
      **************************************************************************
     C           ZTNLU1    BEGSR
     C**
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C**
     C                     ENDSR
     C*================================================================
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
** NUMA
ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
**  CPY@
(c) Finastra International Limited 2001
