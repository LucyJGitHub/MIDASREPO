     H        1                                                           S71062
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Portfolio transfer maintenance')              *
/*OVRF*: OVRDBF FILE(PMTRSFXX) TOFILE(PMTRSFPD) SHARE(*NO)          : *   S01486
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM0150 - PORTFOLIO TRANSFER INPUT                            *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 CGL165             Date 15Feb17               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 11Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CSE071             Date 19Jul05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CPK016             Date 03Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE012             Date 16Aug99               *
      *                 CPB001             Date 06Jul99               *
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 090969             DATE 11AUG95               *
     F*                 CPM005             DATE 21AUG96               *
     F*                 CFF004             DATE 11SEP96               *
     F*                 CPM003             DATE 02MAY96               *
     F*                 S71062             DATE 25JAN96               *
     F*                 S01408             DATE 01APR96               *
     F*                 CPM004             DATE 08FEB96               *
     F*                 095249             DATE 06NOV95               *
     F*                 085862             DATE 16MAR95               *
     F*                 S01486             DATE 03AUG94               *
     F*                 59581              DATE 17AUG93               *
     F*                    58933              DATE 02AUG93               *S01486
     F*                    56555              DATE 05JUL93               *
     F*                    48219              DATE 05MAY92               *
     F*                    S01313             DATE 05MAY92               *
     F*                    B8108              DATE 25SEP91               *
     F*                    B08275             DATE 15NOV91               *
     F*                    R05896             DATE 25APR91               *
     F*                    R00428             DATE 24SEP90               *
     F*                    R10038             DATE 16SEP90               *
     F*                    R00300             DATE 14AUG90               *
     F*                                                                  *
     F********************************************************************
     F*                                                                  *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *             (Recompile)                                       *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CPK016 - Release 5 packaging.  Clash of field names.         *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
     F*  CPB001 -  'Private Banking' Module                           *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
     F*  090969 - REVIEW FIX 48219 TO DIPSLAY TRADES AND DEPOT MVMT   *
     F*           *GE BACKVALUE DATE OTHERWISE IF TRANSACTION DATE IS *
     F*           EQUAL TO BACKVALUE DATE THIS ONE IS NOT AVAILABLE   *
     F*           FOR TRANSFER                                        *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/5 - INSTRUMENT ASSET / LIABILITY SPLIT         *
     F*           PBFG/6 - ADDITIONAL CUSTOMER DETAILS                *
     F*           PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*  CFF004 - Increase in size of Price Fields                       *
     F*  CPM003 - FF/PM Interface upgrade to Release 10                  *
     F*    S71062 - FF/PM interface                                      *
     F*             Re-activate FF coding                                *
     F*    S01408 - Addition of core hook PM0150CCP3                     *
     F*           - Addition of core hook PM0150CCP2                     *
     F*           - Addition of core hook PM0150CCP1                     *
     F*           - Addition of core hook PM0150FFP1                     *
     F*           - Addition of core hook PM0150IIP1                     *
     F*    CPM004 - Bank Portfolios                                      *
     F*    095249 - Currency output on file was incorrect for RE         *
     F*    085862 - INCLUDE BRANCH IN ACCOUNT IDENTIFIER              *
     F*    S01486 - Portfolio Management Upgrade  to R10                 *S01486
     F*    59581  - YEAR & MONTH ARE ZEROES FOR OTC INSTRUMENTS -        *
     F*             ALTER STANDARD FF DEFINITION OUTPUT                  *
     F*    58933  - REMOVE FRA/IRS TRANSACTIONS FROM PROGRAM             *
     F*    56555  - TRANSFER OF POSITIONS                                *
     F*    48219  - ONLY DISPLAY TRADES AND DEPOT MOVEMENTS WITH TRADE / *
     F*             VALUE DATE *GT BACKVALUE DATE                        *
     F*    S01313 - PORTFOLIO PERFORMANCE                                *
     F*    B8108  - MATURED TRANSACTIONS SHOULD BE SHOWN ON THIS SCREEN  *
     F*    B08275 - TRANSACTION FILE KEYS ALTERED TO INCLUDE RECORD ID   *
     F*    R05896 - DETERMINE PM INSTRUMENT TYPE USING FIDUCIARY TYPE    *
     F*             AND SUB TYPE                                         *
     F*    R00428  -  Bad field name.                                    *
     F*    R10038 - OUTPUT TEXT FOR FX DEAL IN DIFFERENT FORMAT          *
     F*    R00300  -  Message file changes.                           *  *
     F*                                                               *  *
     F********************************************************************
     F**PM0150DDCF  E                    WORKSTN                          S01486
     FPM0150DFCF  E                    WORKSTN                            S01486
     F                                        RRN   KSFILE PM0150S0
     F*
     F**  PREFIX OF PMTRSFPP IS P8
     F**PMTRSFPPUF  E           K        DISK         KCOMIT       A      S01486
     FPMTRSFPDUF  E           K        DISK         KCOMIT       A        S01486
     F                                              KINFDS INFDS
     F                                              KINFSR *PSSR
     F**PMTRSFZZUF  E                    DISK         KCOMIT              S01486
     FPMTRSFPAUF  E                    DISK         KCOMIT                S01486
     F                                              KINFSR *PSSR
     F*MHPOSLLIF**E           K        DISK                           UC  S01313
     F****                                          KINFSR *PSSR          S01313
     FPMPOSDLLIF  E           K        DISK                           UC  56555
     F                                              KINFSR *PSSR          56555
     FSECTY   IF  E           K        DISK                           UC
     F                                              KINFSR *PSSR
     FTRADPT  IF  E           K        DISK                           UC
     F                                              KINFSR *PSSR
     F***DPTMPT**IF**E           K        DISK                           US01486
     FPMDPTML0IF  E           K        DISK                           UC  S01486
     F                                              KINFSR *PSSR
     F***TRANSPT*IF**E           K        DISK                           US01486
     F************                                  KINFSR *PSSR          S01486
     F***INTYP***IF  E           K        DISK                           US01486
     F************                                  KINFSR *PSSR          S01486
     FTRANSPT IF  E           K        DISK                           UC  S71062
     F                                              KINFSR *PSSR          S71062
     FINTYP   IF  E           K        DISK                           UC  S71062
     F                                              KINFSR *PSSR          S71062
     F***DEALSPT IF  E           K        DISK                           US01486
     FPMDEALL0IF  E           K        DISK                           UC  S01486
     F                                              KINFSR *PSSR
     F**SDDTSTPPIF  E           K        DISK                           UCS01486
     FFDDTSTL1IF  E           K        DISK                           UC  S01486
     F                                              KINFSR *PSSR          S01486
     F***CLOANPT*IF**E           K        DISK                           US01486
     FPMCLONL1IF  E           K        DISK                           UC  S01486
     F                                              KINFSR *PSSR
     F**SDLOANL1IF  E           K        DISK                           UCS01486
     F**********                                    KINFSR *PSSR          S01486
     F**FIDPLNPTIF  E           K        DISK                           UCS01486
     F**********                                    KINFSR *PSSR          S01486
     F*
     F*                                                                   S01408
     F/COPY WNCPYSRC,PM0150FFP1                                           S01408
     F*                                                                   S01408
     F***ACCNTPT*IF**E           K        DISK                           US01486
     FPMACCNL1IF  E           K        DISK                           UC  S01486
     F                                              KINFSR *PSSR
     F**SDBANKPDIF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F**SDMMODPDIF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     FPMTRSFXXIF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMTRSFP0                          KRENAMEPMTRSFPX
     F**SDCURRL0IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F**SDPLCSL3IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F**SDPLCSL2IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F**PMPORTPPIF  E           K        DISK                             S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     FPMCNSDLLIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     FPMPPTML1IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     F*
     F**  PREFIX OF SDPORTPD IS P9
     F**SDPORTPDIF  E                    DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F*                                                                   48219
     F**  PREFIX OF SDPORTPD IS BV                                        48219
     F**SDSTRDPDIF  E                    DISK                       48219 S01486
     F**********                                    KINFSR *PSSR    48219 S01486
     F*                                                                   CPM004
     FACCBR   IF  E           K        DISK         KINFSR *PSSR      UC  CPM004
     F            ACCNTABF                          KRENAMEACCNTABX       CPM004
     FCLOANB  IF  E           K        DISK         KINFSR *PSSR      UC  CPM004
     F            CLOANCLF                          KRENAMECLOANCLX       CPM004
     FCUSDB   IF  E           K        DISK         KINFSR *PSSR      UC  CPM004
     F            DEALSDBF                          KRENAMEDEALSDBX       CPM004
     F            DEALSDCF                          KRENAMEDEALSDCX       CPM004
     FSDBRCHL5IF  E           K        DISK         KINFSR *PSSR      UC  CPM004
     F*                                                                   CPM004
     E*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F********01         DEALSDBF RECORD                                  CPM004
     F********02         DEALSDCF RECORD                                  CPM004
     F********03         DEALSDGF RECORD                                  S01486
     F*
     F*       21         SFLEND  PM0150F2
     F*       22         SFLEND  PM0150C0
     F*       23         DISPLAY BOTTOM LINE ON SUBFILE
     F*       24         SFLDLT  PM0150C0
     F*      N25         SFLDSP PM0150C0
     F*       26         ERROR ON FIELD DDCNUM
     F*       27         ERROR ON FIELD DDFPTF
     F*       28         ERROR ON FIELD DDFALL
     F*       29         ERROR ON FIELD DDPTRS
     F*
     F*      N30         SFLDSPCTL PM0150C0
     F*
     F*       42         USED IN SR/ZA0840
     F*       43         USED IN SR/ZA0840
     F*       44         USED IN SR/ZA0840
     F*
     F*       50         SDBRCHL5 record not found                        CPM004
     F*
     F*       71         WORK INDICATOR
     F*       72         WORK INDICATOR
     F*       73         WORK INDICATOR
     F*      N75         EXSR P1005
     F*      N76         EXSR P1006
     F*      N77         EXSR P1007
     F*      N78         EXSR P1008
     F*      N79         EXSR P1009
     F*
     F*      N80         EXSR P1010
     F*      N81         EXSR P1011
     F*
     F*       89         DATABASE ERROR ON SDMMODPD
     F*
     F*       90         USED IN SR/ZEDIT  SR/ZDATE2
     F*       91         USED IN SR/ZEDIT
     F*       92         USED IN SR/ZDATE2
     F*       93         USED IN SR/ZDATE2
     F*       94         USED IN SR/ZDATE2
     F*       95         USED IN SR/ZDATE2
     F*       99         USED IN SR/ZDATE2
     F*
     F*       KC         CMD03 ON SCREEN
     F*       KD         CMD04 ON SCREEN
     F*       KL         CMD12 ON SCREEN
     E*****************************************************************
     E*
     E                    CPY@    1   1 80
     E****Array*of powers of ten ----------------- ZA0840                 S01486
     E************        ZH      1  15 15 0                              S01486
     E** S/R FOR ZDATE2
      /COPY ZSRSRC,ZDATE2Z1
     E****Input*array ---------------------------- ZA0840                 S01486
     E************        ZF         16  1                                S01486
     E****Output array --------------------------- ZA0840                 S01486
     E************        ZG         16  1                                S01486
     E** ARRAY FOR ZEDIT
      /COPY ZSRSRC,ZEDITZ1
     E** FORMAT SE DETAILS FOR OUTPUT  (SR/ZF..LN)
     E**********          ZLI        20  1                                                    CGL029
     E                    ZLI        24  1                                                    CGL029
     I*****************************************************************
     I***IDENTIFICATION*OF DEALSPT RECORDS                                S01486
     I*  IDENTIFICATION OF PMDEALL0 RECORDS                               S01486
     I*****************************************************************
     I***DEALSDBF    01                                                   CPM004
     I***********                                                         CPM004
     I***DEALSDCF    02                                                   CPM004
     I***********                                                         CPM004
     I*DEALSDGF****03                                                     58933
     I*****************************************************************   S01486
     I***IDENTIFICATION*OF FIDPLNPT RECORDS                               S01486
     I*****************************************************************   S01486
     I**FIDEPOD0    05                                                    S01486
     I**********                                                          S01486
     I**FILOAND0    06                                                    S01486
     I*****************************************************************
     I*                                                                   CPM004
     ITRADSDF                                                                                 CPK016
     I              CRSK                            TDCRSK                                    CPK016
     IWWDTST      DS                             12                       CPM004
     I** Deal Type/Sub Type for narrative use                             CPM004
     I                                        1   2 DTPE11                CPM004
     I                                        4   5 DLST11                CPM004
     I**********                              7  120CNUM                               CPM004 CSD027
     I                                        7  12 CNUM                                      CSD027
     I*                                                                   CPM004
     IWWLTST      DS                             12                       CPM004
     I** Loan Type/Sub Type for narrative use                             CPM004
     I                                        1   2 WLNTY                 CPM004
     I                                        4   5 WLNST                 CPM004
     I**********                              7  120WCNUM                              CPM004 CSD027
     I                                        7  12 WCNUM                                     CSD027
     I*                                                                   CPM004
     I*                                                                   S01408
     I/COPY WNCPYSRC,PM0150IIP1                                           S01408
     I*                                                                   S01408
     I**   MIDAS 'Next Available Transaction No.' Data Area  MNATN .
     IDNATN       DS                              5
     I                                        1   50FNATN
     I*
     I**
     I*
     I** DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     IINFDS       DS
     I                                     *STATUS  STATUS
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I**LDA        UDS                            256                     S01486
     I***********                           132 183 DBLOT                 S01486
     I***********                           132 141 DBFILE                S01486
     ILDA         DS                            256                       S01486
     I                                      134 183 DBLOT                 S01486
     I                                      134 141 DBFILE                S01486
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I*
     I** DATA STRUCTURE FOR NARRATIVE 2
     I            DS
     I                                        1  24 DDNAR2                                    CGL029
     I                                        7   9 NAR8                                      CGL029
     I                                       10  19 NAR12                                     CGL029
     I                                       20  21 NAR17                                     CGL029
     I                                       22  24 NAR16                                     CGL029
     I**********                              1  20 DDNAR2                                    CGL029
     I***********                             8  10 NAR8                  095249
     I***********                            12  15 NAR12                 095249
     I***********                            17  18 NAR17                 095249
     I**********                              7   9 NAR8                               095249 CGL029
     I**********                             10  13 NAR12                              095249 CGL029
     I**********                             14  15 NAR17                              095249 CGL029
     I**********                             16  18 NAR16                              095249 CGL029
     I*
     I** DATA STRUCTURE FOR LAST UPDATE
     I            DS
     I                                        1   20WWDLUP
     I                                        3   5 WWMLUP
     I                                        6   70WWYLUP
     I                                        1   7 WWHLUP
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/U1ER ID'S
     IPSDS       SDS
     I                                      244 253 WSID
     I                                      254 263 USIDXX
     I                                      244 253 WKSTN                 S01486
     I                                      254 263 USER                  S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I** EXTERNAL DS FOR BANK DETAILS                                     S01486
     ISDCUST    E DSSDCUSTPD                                              CPB001
     I** EXTERNAL DS FOR CUSTOMER DETAILS                                 CPB001
     ISDLOAN    E DSSDLOANPD                                              S01486
     I** EXTERNAL DS FOR LOAN TYPES SUB TYPES                             S01486
     ISDMMOD    E DSSDMMODPD                                              S01486
     I** EXTERNAL DS FOR MODULES                                          S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I** EXTERNAL DS FOR PORTFOLIO ICD                                    S01486
     ISDSTRD    E DSSDSTRDPD                                              S01486
     I** EXTERNAL DS FOR SECURITIES                                       S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I** EXTERNAL DS FOR PORTFOLIO CUSTOMER DETAILS                       S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I** EXTERNAL DS FOR CURRENCIES DETAILS                               S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, LONG  DATA STRUCTURE                S01486
     IDSLDY     E DSDSLDY                                                 CPB001
     I* THIRD DS FOR ACCESS PROGRAMS, VERY LONG  DATA STRUCTURE           CPB001
     IRUNDT       DS                                                      S01486
      **  DATA AREA RUNDAT                                                S01486
     I                                        1   7 RUNA                  S01486
     I                                    P   8  100RUND                  S01486
     I                                       11  11 SSF                   S01486
     I                                       12  12 DATF                  S01486
     I                                       13  13 MBIN                  S01486
     IZMUSER      DS                             17                       S01486
     I** DATA AREA OF MENU USER                                           S01486
     I                                       11  13 USRBCH                S01486
     C*****************************************************************
     C** KEY DEFINITION
     C*****************************************************************
     C**  DEFINE KEY LIST FOR CHAINING TO SEVERAL FILES
     C           KKPM      KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           WWFPTF
     C*
     C****DEFINE KEY LIST FOR CHAINING TO SDDTSTPP FILE                   S01486
     C**  DEFINE KEY LIST FOR CHAINING TO FDDTSTL1 FILE                   S01486
     C           KKPMDL    KLIST                                          S01486
     C                     KFLD           DTYP                            S01486
     C                     KFLD           DLST                            S01486
     C                     KFLD           CLAS                                                CLE042
     C*
     C****DEFINE*KEY LIST FOR CHAINING TO PMPORTPP FILE                   S01486
     C**  DEFINE KEY LIST FOR CHAINING TO PMPORTPD FILE                   S01486
     C           KKPMPO    KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           WWFALL
      *                                                                   CPM005
      **  Define key list for chaining to PMCNSDLL file                   CPM005
      *                                                                   CPM005
     C           KKPMP9    KLIST                                          CPM005
     C                     KFLD           WWCNUM                          CPM005
     C                     KFLD           WW9997  4                       CPM005
      *                                                                   CPM005
     C           KPOOL     KLIST                                          CPM005
     C**********           KFLD           WWPCNU  60                                   CPM005 CSD027
     C                     KFLD           WWPCNU  6                                           CSD027
     C                     KFLD           WWPPTF  4                       CPM005
     C*
     C****DEFINE*KEY LIST FOR CHAINING TO PMTRSFPP FILE                   S01486
     C**  DEFINE KEY LIST FOR CHAINING TO PMTRSFPD FILE                   S01486
     C**  AND PMTRSFXX FILE
     C           KKPMTR    KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           WWFPTF
     C                     KFLD           WWMODI
     C                     KFLD           WWTRNB
     C                     KFLD           WWCCY
     C                     KFLD           WWACOD
     C                     KFLD           WWACSQ
     C                     KFLD           WWBRCA                          095249
     C                     KFLD           WWSESN
     C                     KFLD           WWPOTI
     C*
     C           KKPMT     KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           WWFPTF
     C                     KFLD           WWMODI
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** PERFORM SETUP OF STANDARD FIELDS
     C*****************************************************************
     C*
     C                     EXSR INIT
     C*
     C** DO  UNTIL F3
     C           *INKC     DOWEQ'0'
     C                     EXSR P1002
     C**
     C           *INKC     DOWEQ'0'
     C                     EXSR P1003
     C*
     C           RRN       IFNE 0
     C                     EXSR P1004
     C                     ELSE
     C                     MOVE '1'       *INKC
     C                     MOVE '1'       *INKL
     C*********************MOVEL'PM15303' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15303' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C                     END
     C**
     C           *INKL     IFEQ '1'
     C                     MOVE '0'       *INKC
     C                     END
     C*
     C                     END
     C*
     C                     EXSR ZPEND
     C*
     C*****************************************************************
     C*  P R O G R A M     E N D
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** INDEX OF SUBROUTINES
     C**
     C** INIT              INITIALISATION OF STANDARD FIELDS,
     C**                   ACCESS OF STANDING DATA
     C**
     C** P1002 S/R TO OUTPUT AND PROCESS KEY FIELDS SCREEN
     C**
     C** P1003  S/R TO LOAD PORTFOLIO TRANSFER SUBFILE
     C**
     C** P1004  S/R TO PROCESS UPDATE SCREEN
     C**
     C** P1005  S/R TO LOAD SE POSITIONS TO SUBFILE
     C**
     C** P1006  S/R TO LOAD SE TRADES TO SUBFILE
     C**
     C** P1007  S/R TO LOAD SE DEPOT MOVEMENTS TO SUBFILE
     C**
     C** P1008  S/R TO LOAD FF TRANSACTIONS TO SUBFILE
     C**
     C** P1009  S/R TO LOAD DL DEALS TO SUBFILE
     C**
     C** P1010  S/R TO LOAD LE LOANS TO SUBFILE
     C**
     C** P1011  S/R TO LOAD RE ACCOUNTS TO SUBFILE
     C**
     C** P1012  S/R TO LOAD FX DEALS TO SUBFILE
     C**
     C** P1013  S/R TO LOAD MM DEALS TO SUBFILE
     C**
     C** P1014  S/R TO LOAD FRA/IRS DEALS TO SUBFILE
     C**
     C** P1015  S/R TO PROCESS 'TRANSFER ALL HOLDINGS' PROMPT
     C**
     C** P1016  S/R TO UPDATE PORTFOLIO TRANSFER DETAILS
     C**
     C** P1017  S/R TO UPDATE PORTFOLIO TRANSFER AUDIT
     C**
     C** V1002  S/R TO VALIDATE KEY FIELDS
     C**
     C** V1004  S/R TO VALIDATE PORTFOLIO TRANSFER SUBFILE
     C**
     C** V1015  S/R TO VALIDATE 'TRANSFER ALL HOLDINGS' PROMPT
     C**
     C** W1016  S/R TO WRITE TO PORTFOLIO TRANSFER DETAILS
     C**
     C** ZRAZ   S/R TO UPDATE SUBFILE FIELDS WITH BLANK
     C**
     C** ZWTR   S/R TO WRITE A LINE ON SUBFILE
     C**
     C** VCUST S/R TO VALIDATE CUST.NO. OR SHORTNAME
     C**
     C** ZKEY   S/R TO DETERMINE THE CONTENTS OF KEY FIELDS ON
     C**            PF/PMTRSFPP
     C**
     C** ZPEND- S/R TO END THE PROGRAM
     C**
     C** *PSSR - ERROR S/R
     C**
     C**  ZEDIT SUBROUTINE TO INSERT A DECIMAL POINT INTO A NUMERIC FIELD*
     C**  AND TO BLANK OUT LEADING ZEROES.                               *
     C**
     C**  ZTNLU1 SR. - TO LOCK THE TRANSACTION NUMBER DATA AREA,
     C**               ACCESS THE NEXT AVAILABLE TRANSACTION NUMBER,
     C**               THEN UPDATE AND RELEASE THE DATA AREA.
     C**
     C*  ZA0840 - Standard routine to transform
     C*       an alpha field into numeric field
     C**
     C** ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C** ZFSELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C**            FOR SE 2
     C**
     C*  ZFFFLN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR FUTURE & OPTIONS
     C**
     C*  ZFLELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR LENDING
     C**
     C*  ZFRELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRI  PTION
     C*                                 FOR RETAIL
     C**
     C*  ZFDLLN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**
     C** INIT S/R - TO INITIALISE STATIC FIELDS AND ACCESS STANDING DATA
     C** CALLED ONCE AT START OF PROGRAM FROM MAIN LINE
     C** CALLS :  *PSSR
     C**
     C*****************************************************************
     C*
     C           INIT      BEGSR                           ** INIT  BSR **
     C*
     C** SFLEND (MSG SUBFILE)
     C                     MOVE '1'       *IN21
      ***  Copyright Statement.                                           S01486
     C                     MOVEACPY@      CPY2@  80
     C**                                                                  S01486
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01486
     C                     IN   RUNDT                                     S01486
     C           *NAMVAR   DEFN           ZMUSER                          S01486
     C                     IN   ZMUSER                                    S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C*
     C** PREPARE LDA
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM0150'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C** PREPARE WORK FIELD
     C                     Z-ADD0         WWCNT   30
     C*
     C** PREPARE COMIT TEXT
     C                     MOVEL'PM'      MDID
     C                     MOVEL'PM0150'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSIDXX    USIDX
     C**
     C**
     C**  SET UP PARAMETER TO RETRIEVE MESSAGE FROM MESSAGE FILE
     C           PLLANG    PLIST
     C                     PARM           MSMBR4  7
     C                     PARM           MSGER  10
     C                     PARM           MSGTXT 80
     C***********          MOVEL'MLGBMSGF'MSGER                           S01486
     C                     MOVEL'PMUSRMSG'MSGER                           S01486
     C*
     C* ACCESS SDMMODPD FOR MODULE DETAILS
     C************         READ SDMMODPD                 89               S01486
     C************IN89     IFEQ '1'                        ***************S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            **DB ERROR 01**
     C************         MOVEL'SDMMOD'  DBFILE           ***************S01486
     C                     MOVE 'SDMMODPD'DBFILE           ***************S01486
     C                     MOVEL'NONE'    DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CPM004
     C                     CALL 'AOPORTR0'                                CPM004
     C                     PARM *BLANKS   WWRTCD  7                       CPM004
     C                     PARM '*FIRST ' WWOPTN  7                       CPM004
     C           SDPORT    PARM SDPORT    DSFDY                           CPM004
     C           WWRTCD    IFNE *BLANKS                                   CPM004
     C           *LOCK     IN   LDA                        ***************CPM004
     C                     Z-ADD11        DBASE            * DB ERROR 11 *CPM004
     C                     MOVE 'SDPORTPD'DBFILE           ***************CPM004
     C                     MOVEL'NONE'    DBKEY                           CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     OPEN SDBRCHL5                                  CPM004
     C                     ENDIF                                          CPM004
     C*
     C** IF "SE" MODULE IS PRESENT
     C** and Bank Portfolio is not supported...                           CPM004
     C           BGSECS    IFEQ 'Y'
     C           FCPORS    ANDNE'B'                                       CPM004
     C****                 OPEN PMHPOSLL                                  S01313
     C                     OPEN PMPOSDLL                                  56555
     C                     OPEN SECTY
     C                     OPEN TRADPT
     C***********          OPEN DPTMPT                                    S01486
     C                     OPEN PMDPTML0                                  S01486
     C                     END
     C***********                                                         S01486
     C***IF*"FF"*MODULE IS PRESENT                                        S01486
     C***********BGFUOP    IFEQ 'Y'                                       S01486
     C***********          OPEN TRANSPT                                   S01486
     C***********          OPEN INTYP                                     S01486
     C***********          END                                            S01486
     C*                                                                   S71062
     C** IF "FF" MODULE IS PRESENT                                        S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           BGFUOP    IFEQ 'Y'                                       S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C                     OPEN TRANSPT                                   S71062
     C                     OPEN INTYP                                     S71062
     C                     END                                            S71062
     C*
     C** IF "DL" MODULE IS PRESENT
     C           BGDLFX    IFEQ 'Y'
     C           BGDLMM    ANDEQ'Y'
     C                     MOVE 'Y'       WWFLG   1
     C***********          OPEN DEALSPT                                   S01486
     C*                                                                   CPM004
     C** If Bank Portfolio is supported, open deals file by branch        CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     OPEN CUSDB                                     CPM004
     C                     ELSE                                           CPM004
     C                     OPEN PMDEALL0                                  S01486
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C***********          OPEN SDDTSTPP                                  S01486
     C                     OPEN FDDTSTL1                                  S01486
     C                     END
     C*
     C** IF "LE" MODULE IS PRESENT
     C           BGCSLN    IFEQ 'Y'
     C***********          OPEN CLOANPT                                   S01486
     C*                                                                   CPM004
     C** If Bank Portfolio is supported, open loan  file by branch        CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     OPEN CLOANB                                    CPM004
     C                     ELSE                                           CPM004
     C                     OPEN PMCLONL1                                  S01486
     C                     ENDIF                                          CPM004
     C***********          OPEN SDLOANL1                                  S01486
     C                     END
     C*
     C** IF "RE" MODULE IS PRESENT
     C           BGRTBN    IFEQ 'Y'
     C***********          OPEN ACCNTPT                                   S01486
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     OPEN ACCBR                                     CPM004
     C                     ELSE                                           CPM004
     C                     OPEN PMACCNL1                                  S01486
     C                     ENDIF                                          CPM004
     C                     END
     C*
     C***IF*"FI"*MODULE IS PRESENT                                        S01486
     C***********BGFLND    IFEQ 'Y'                                       S01486
     C***********          OPEN FIDPLNPT                                  S01486
     C***IF*"DL**MODULE NOT PRESENT                                       S01486
     C***********WWFLG     IFNE 'Y'                                       S01486
     C***********          OPEN SDDTSTPP                                  S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,PM0150CCP1                                           S01408
     C*                                                                   S01408
     C** GET INSTALLATION CONTROL DATA RECORD 1
     C***********          READ SDBANKD0                 71               S01486
     C************IN71     IFEQ '1'                                       S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C** ERROR
     C                     Z-ADD2         DBASE            **DB ERROR 02**
     C***********          MOVEL'SDBANKD0'DBFILE           ***************S01486
     C                     MOVE 'SDBANKPD'DBFILE           ***************S01486
     C                     MOVEL'NONE'    DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C** TEST DATE FORMAT FOR SR/ZDATE2
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C*
     C***********          READ SDPORTPD                 71               S01486
     C************IN71     IFEQ '1'                                       S01486
     C*                                                                   CPM004
     C** Access to SDPORTPD is moved to before module-file opening        CPM004
     C** to allow Bank Portfolio check.....                               CPM004
     C***********          CALL 'AOPORTR0'                         S01486 CPM004
     C***********          PARM *BLANKS   WWRTCD  7                S01486 CPM004
     C***********          PARM '*FIRST ' WWOPTN  7                S01486 CPM004
     C***********SDPORT    PARM SDPORT    DSFDY                    S01486 CPM004
     C***********WWRTCD    IFNE *BLANKS                            S01486 CPM004
     C************LOCK     IN   LDA                                S01486 CPM004
     C***ERROR***                                                         CPM004
     C***********          Z-ADD11        DBASE            **DB ERROR 11**CPM004
     C***********          MOVE 'SDPORTPD'DBFILE           ***************CPM004
     C***********          MOVEL'NONE'    DBKEY                           CPM004
     C***********          OUT  LDA                                S01486 CPM004
     C***********          EXSR *PSSR                                     CPM004
     C***********          END                                            CPM004
     C*                                                            48219  S01486
     C***********          READ SDSTRDPD                 71        48219  S01486
     C************IN71     IFEQ '1'                        *******48219   S01486
     C                     CALL 'AOSTRDR0'                                S01486
     C                     PARM *BLANKS   WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C           SDSTRD    PARM SDSTRD    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD51        DBASE            **DB ERROR 11**48219
     C                     MOVE 'SDSTRDPD'DBFILE           ***************48219
     C                     MOVEL'NONE'    DBKEY                           48219
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     48219
     C                     END                                            48219
     C*                                                                   48219
     C** DETERMINE BACKVALUE DATE                                         48219
     C           BJRDNB    SUB  BVBVP     WWBKVD  50                      48219
     C*
     C** SELECT THE PROGRAM MSGQ FOR ERROR MSG.
     C                     MOVEL'*'       DDPGMQ
     C***********          MOVELBJMRDT    DDRUNA                          S01486
     C                     MOVEL'*'       TOPQ   10                       R00300
     C                     MOVEL'*PRV'    TOPRQ   5                       R00300
     C*                                                                   R00300
     C**   Fill in fields for subroutine ZASNMS                           R00300
     C                     MOVEL*BLANK    ZAPGM  10        Message queue  R00300
     C                     MOVEL'PMUSRMSG'ZAMSGF 10        Message file   R00300
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue      R00300
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.    R00300
     C                     MOVEL*BLANK    ZAMSDA132        Message data.  R00300
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.  R00300
     C*
     C           EINIT     ENDSR                           ** END INIT  **
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C** P1002 S/R TO OUTPUT AND PROCESS KEY FIELDS SCREEN
     C** CALLED FROM MAIN PROCESSING
     C** CALLS: ZRAZ
     C**        V1002
     C**
     C*****************************************************************===
     C*
     C           P1002     BEGSR                           ** P1002 BSR **
     C*
     C** INITIALISE SCREEN DATA
     C                     MOVEL'PM90011' MSMBR4
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    INFMSG
     C                     MOVE '0'       *IN22
     C                     MOVE '0'       *IN23
     C*
     C** INITIALISE WORK FIELDS
     C                     MOVEL*BLANK    SET5    2
     C                     MOVEL*BLANK    SET6    2
     C                     MOVEL*BLANK    SET7    2
     C                     MOVEL*BLANK    SET8    2
     C                     MOVEL*BLANK    SET9    2
     C                     MOVEL*BLANK    SET10   2
     C                     MOVEL*BLANK    SET11   2
     C                     Z-ADD0         RRN
     C                     Z-ADD0         NNR     50
     C                     Z-ADD0         WWW
     C*
     C** INITIALIZE DISPLAY FILE FIELDS
     C                     EXSR ZRAZ
     C*
     C** IF NEW CUSTOMER, BLANK OUT SCREEN FIELDS
     C                     MOVE *BLANKS   DDCNUM
     C                     MOVE *BLANKS   DDFPTF
     C*
     C** CLEAR SUBFILE
     C                     MOVE '1'       *IN24
     C                     MOVE '1'       *IN25
     C                     WRITEPM0150C0
     C                     MOVE '0'       *IN24
     C                     MOVE '0'       *IN25
     C*
     C** DO UNTIL *IN22 = '1'
     C           *IN22     DOWEQ'0'
     C** CLEAR WHOLE SCREEN
     C                     WRITEPM0150F3
     C*
     C** S T A R T   S C R E E N     O U T P U T
     C                     WRITEPM0150F2                   => ERROR MSG
     C                     WRITEPM0150FM                   => INF. MSG
     C                     EXFMTPM0150F1
     C*********************MOVEL*BLANK    ZMSGID 10                       R00300
     C                     MOVEL*BLANK    ZAMSID                          R00300
     C                     MOVE '0'       *IN26
     C                     MOVE '0'       *IN27
     C*
     C**  Initialise screen input MSGQ.
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**  Clear program message queue.                                    R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ   10                       R00300
     C                     PARM           TOPRQ   5                       R00300
     C*
     C           *INKC     IFEQ '1'
     C           *INKL     OREQ '1'
     C                     MOVE '1'       *IN22
     C                     MOVE '1'       *INKC
     C                     END
     C*
     C           *IN22     IFEQ '0'
     C                     EXSR V1002
     C                     END
     C*
     C** If no error, exit subroutine
     C***********ZMSGID    IFEQ *BLANK                                    R00300
     C           ZAMSID    IFEQ *BLANK                                    R00300
     C                     MOVE '1'       *IN22
     C                     END
     C*
     C                     END
     C*
     C           EP1002    ENDSR                           ** END P1002
     C*****************************************************************===
      /EJECT
     C*****************************************************************
     C** P1003  S/R TO LOAD PORTFOLIO TRANSFER SUBFILE
     C** CALLED FROM MAIN PROCESSING
     C** CALLS  S/R  =>  P1005
     C**             =>  P1006
     C**             =>  P1007
     C**             =>  P1008
     C**             =>  P1009
     C**             =>  P1010
     C**             =>  P1011
     C*****************************************************************
     C*
     C           P1003     BEGSR                           ** P1003 BSR **
     C*
     C**********           MOVELDDCNUM    WWCNUM  60                                          CSD027
     C                     MOVELDDCNUM    WWCNUM  6                                           CSD027
     C***********DDFPTF    IFEQ P9R997                                    S01486
     C           DDFPTF    IFEQ FCR997                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVEL'9997'    WWFPTF
     C                     ELSE
     C                     MOVE DDFPTF    WWFPTF  4
     C                     END
     C           SET5      IFEQ *BLANKS
     C**  FIRST TIME
     C                     MOVE '1'       *IN75
     C                     MOVE '1'       *IN76
     C                     MOVE '1'       *IN77
     C                     MOVE '1'       *IN78
     C                     MOVE '1'       *IN79
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN81
     C                     END
     C*
     C** IF "SE" MODULE IS PRESENT
     C** And Bank Portfolio is not supported...                           CPM004
     C           BGSECS    IFEQ 'Y'
     C           FCPORS    ANDNE'B'                                       CPM004
     C****                                                                S01313
     C****       SET5      IFEQ *BLANKS                                   S01313
     C****                 MOVEL'ON'      SET5                            S01313
     C****                 MOVE '0'       *IN75                           S01313
     C****       KKPM      SETLLPMHPOSLL                                  S01313
     C****                 END                                            S01313
     C****       *IN75     IFEQ '0'                                       S01313
     C****                 EXSR P1005                                     S01313
     C****                 END                                            S01313
     C*
     C* TRANSFER POSITION NEW CODING                                      56555
     C*                                                                   56555
     C           SET5      IFEQ *BLANKS                                   56555
     C                     MOVEL'ON'      SET5                            56555
     C                     MOVE '0'       *IN75                           56555
     C                     MOVE 'N'       FLAG    1                       56555
     C           KKPM      SETLLPMPOSDLL                                  56555
     C                     END                                            56555
     C           *IN75     IFEQ '0'                                       56555
     C                     EXSR P1005                                     56555
     C                     END                                            56555
     C*
     C           SET6      IFEQ *BLANKS
     C                     MOVE '0'       *IN76
     C                     MOVEL'ON'      SET6
     C           KKPM      SETLLTRADPT                                    S01313
     C                     END                                            S01313
     C           *IN76     IFEQ '0'                                       S01313
     C                     EXSR P1006                                     S01313
     C                     END                                            S01313
     C*
     C           SET7      IFEQ *BLANKS
     C                     MOVE '0'       *IN77
     C                     MOVEL'ON'      SET7
     C***********KKPM      SETLLDPTMPT                                    S01486
     C           KKPM      SETLLPMDPTML0                                  S01486
     C                     END
     C           *IN77     IFEQ '0'
     C                     EXSR P1007
     C                     END
     C                     END
     C*
     C***IF*"FF"*MODULE IS PRESENT                                        S01486
     C***********BGFUOP    IFEQ 'Y'                                       S01486
     C***********SET8      IFEQ *BLANKS                                   S01486
     C***********          MOVE '0'       *IN78                           S01486
     C***********          MOVEL'ON'      SET8                            S01486
     C***********KKPM      SETLLTRANSPT                                   S01486
     C***********          END                                            S01486
     C************IN78     IFEQ '0'                                       S01486
     C***********          EXSR P1008                                     S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C*                                                                   S71062
     C** IF "FF" MODULE IS PRESENT                                        S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           BGFUOP    IFEQ 'Y'                                       S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C           SET8      IFEQ *BLANKS                                   S71062
     C                     MOVE '0'       *IN78                           S71062
     C                     MOVEL'ON'      SET8                            S71062
     C           KKPM      SETLLTRANSPT                                   S71062
     C                     END                                            S71062
     C           *IN78     IFEQ '0'                                       S71062
     C                     EXSR P1008                                     S71062
     C                     END                                            S71062
     C                     END                                            S71062
     C*
     C** IF "DL" MODULE IS PRESENT
     C           BGDLFX    IFEQ 'Y'
     C           BGDLMM    ANDEQ'Y'
     C           SET9      IFEQ *BLANKS
     C                     MOVE '0'       *IN79
     C                     MOVEL'ON'      SET9
     C***********KKPM      SETLLDEALSPT                                   S01486
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           WBRCA     SETLLCUSDB                                     CPM004
     C                     ELSE                                           CPM004
     C           KKPM      SETLLPMDEALL0                                  S01486
     C                     ENDIF                                          CPM004
     C                     END
     C           *IN79     IFEQ '0'
     C                     EXSR P1009
     C                     END
     C                     END
     C*
     C** IF "LE" MODULE IS PRESENT
     C           BGCSLN    IFEQ 'Y'
     C           SET10     IFEQ *BLANKS
     C                     MOVE '0'       *IN80
     C                     MOVEL'ON'      SET10
     C***********KKPM      SETLLCLOANPT                                   S01486
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           WBRCA     SETLLCLOANB                                    CPM004
     C                     ELSE                                           CPM004
     C           KKPM      SETLLPMCLONL1                                  S01486
     C                     ENDIF                                          CPM004
     C                     END
     C           *IN80     IFEQ '0'
     C                     EXSR P1010
     C                     END
     C                     END
     C*
     C** IF "RE" MODULE IS PRESENT
     C           BGRTBN    IFEQ 'Y'
     C           FCPORS    ANDNE'B'                                       CPM004
     C           BGRTBN    OREQ 'Y'                                       CPM004
     C           BGSDGL    ANDEQ'Y'                                       CPM004
     C           FCPORS    ANDEQ'B'                                       CPM004
     C           SET11     IFEQ *BLANKS
     C                     MOVE '0'       *IN81
     C                     MOVEL'ON'      SET11
     C***********KKPM      SETLLACCNTPT                                   S01486
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           WBRCA     SETLLACCBR                                     CPM004
     C                     ELSE                                           CPM004
     C           KKPM      SETLLPMACCNL1                                  S01486
     C                     ENDIF                                          CPM004
     C                     END
     C           *IN81     IFEQ '0'
     C                     EXSR P1011
     C                     END
     C                     END
     C***"FI"*IS*PRESENT                                                  S01486
     C***********BGFLND    IFEQ 'Y'                                       S01486
     C***********          EXSR P1018                                     S01486
     C***********          END                                            S01486
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,PM0150CCP2                                           S01408
     C*                                                                   S01408
     C** AFTER CONSTRUCTION OF THE ALL SUBFILE POSITION AT THE FIRST
     C** PAGE
     C           RRN       IFNE 0
     C                     Z-ADD1         RRN
     C                     Z-ADD9         ROW
     C                     Z-ADD74        COL
     C                     END
     C*
     C           EP1003    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P1004  S/R TO PROCESS UPDATE SCREEN
     C** CALLED FROM MAIN PROCESSING
     C** CALLS: P1015
     C**        V1004
     C**        P1016
     C**        P1017
     C*****************************************************************
     C*
     C           P1004     BEGSR
     C*
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C                     MOVEL'PM90012' MSMBR4
     C                     CALL 'SDRTVTXT'PLLANG
     C                     MOVELMSGTXT    INFMSG
     C                     MOVE '0'       *IN23
     C*
     C                     WRITEPM0150F2
     C                     WRITEPM0150FM
     C                     EXFMTPM0150C0
     C**  Initialise screen input MSGQ.
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**   Clear program message queue                                    R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ                            R00300
     C                     PARM           TOPRQ                           R00300
     C*********************MOVEL*BLANKS   ZMSGID                          R00300
     C                     MOVEL*BLANKS   ZAMSID                          R00300
     C*                    Z-ADDNNR       RRN
     C*
     C           *INKC     IFEQ '1'
     C           *INKL     OREQ '1'
     C                     MOVE '1'       *INKC
     C                     GOTO EP1004
     C                     END
     C*
     C** CMD4  SELECTED
     C           *INKD     IFEQ '1'
     C** PROCESS 'TRANSFER ALL HOLDINGS' PROMPT
     C                     MOVEL*BLANKS   DDFALL
     C                     Z-ADD22        ROWM
     C                     Z-ADD28        COLM
     C                     EXSR P1015
     C           *INKL     IFEQ '1'
     C                     MOVE '1'       *INKD
     C                     MOVE '0'       *INKL
     C                     END
     C***********ZMSGID    IFEQ *BLANKS                                   R00300
     C           ZAMSID    IFEQ *BLANKS                                   R00300
     C** *INKD='1' TO RETURN TO THE SUBFILE DISPLAY
     C                     MOVE '1'       *INKD
     C*
     C** IF NO ERROR => POSITION THE SUBFILE AT THE FIRST PAGE
     C                     Z-ADD1         RRN
     C                     END
     C                     END
     C*
     C** ENTER SELECTED : VALIDATE SCREEN INPUT
     C           *INKD     IFEQ '0'
     C           *INKC     ANDEQ'0'
     C           *INKL     ANDEQ'0'
     C                     EXSR V1004
     C*
     C***********ZMSGID    IFNE *BLANKS                                   R00300
     C           ZAMSID    IFNE *BLANKS                                   R00300
     C** ERROR ON SUBFILE => DISPLAY THE SUBFILE AT THE FIRST ERROR
     C                     Z-ADDRRN1      RRN
     C                     END
     C*
     C** IF THE INPUT IS VALID UPDATE PORTFOLIO TRANSFER DETAIL
     C** AND UPDATE PORTFOLIO TRANSFER AUDIT
     C***********ZMSGID    IFEQ *BLANKS                                   R00300
     C           ZAMSID    IFEQ *BLANKS                                   R00300
     C                     EXSR P1016
     C***********ZMSGID    IFEQ *BLANKS                                   R00300
     C           ZAMSID    IFEQ *BLANKS                                   R00300
     C                     EXSR P1017
     C           CMTTXT    COMIT
     C                     MOVE '1'       *INKC
     C                     MOVE '1'       *INKL
     C                     ELSE
     C** ERROR ON SUBFILE => DISPLAY THE SUBFILE AT THE FIRST ERROR
     C                     Z-ADDRRN1      RRN
     C                     END
     C                     END
     C                     END
     C*
     C                     END
     C*
     C           EP1004    ENDSR
     C*****************************************************************   S01313
      ****CT                                                              S01313
     C*****************************************************************   S01313
     C****1005  S/R TO LOAD SE POSITIONS TO SUBFILE                       S01313
     C****ALLED FROM S/R P1003                                            S01313
     C****ALLS  S/R  =>  ZEDIT                                            S01313
     C****           =>  *PSSR                                            S01313
     C****           =>  ZFSELN                                           S01313
     C****           =>  ZWTR                                             S01313
     C****           =>  ZRAZ                                             S01313
     C*****************************************************************   S01313
     C****                                                                S01313
     C****       P1005     BEGSR                           ** P1005  BSR**S01313
     C****                                                                S01313
     C****CCESS LF/PMHPOSLL - HISTORIC PORTFOLIO POSITIONS USING          S01313
     C****USTOMER NUMBER AND PORTFOLIO REFERENCE INPUT AS KEY             S01313
     C****       KKPM      SETLLPMHPOSLL                                  S01313
     C****       *IN75     DOWEQ'0'                                       S01313
     C****       KKPM      READEPMHPOSLL                 75               S01313
     C****       *IN75     IFEQ '0'                                       S01313
     C****                                                                S01313
     C****EST SECURITY SHORTNAME => IF IT'S SAME AS PREVIOUS, NO WRITE    S01313
     C****N SUBFILE; ELSE WRITE A LINE IN SUBFILE                         S01313
     C****       QATDSS    IFNE DDREF2                                    S01313
     C****       WWW       ANDNE0                                         S01313
     C****                 EXSR ZWTR                                      S01313
     C****                 EXSR ZRAZ                                      S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****DD '1' IN FIELD WWW (WWW='1' => AT LEAST ONE RECORD EXISTS)     S01313
     C****                 Z-ADD1         WWW     10                      S01313
     C****                                                                S01313
     C****OVE 'SE' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD      S01313
     C*********************MOVE 'SE'      DDMODI                          S01313
     C****                 MOVE ' SE  '   DDMODI                          S01313
     C****                 MOVE 'HISTORY' DDMOD2                          S01313
     C****                                                                S01313
     C****OVEL 'P' IN "HHPOTI" HIDDEN FIELD                               S01313
     C****                 MOVEL'P'       HHPOTI                          S01313
     C****                                                                S01313
     C****CCESS LF/SECTY - SE SECURITIES USING SECURITY SHORTNAME         S01313
     C****ROM LF/PMHPOSLL AS KEY                                          S01313
     C****       QATDSS    CHAINSECTY                72                   S01313
     C****       *IN72     IFEQ '1'                                       S01313
     C****                                                                S01313
     C****RROR                                                            S01313
     C****                 Z-ADD3         DBASE            **DB ERROR 03**S01313
     C****                 MOVEL'SECTY   'DBFILE           ***************S01313
     C****                 MOVELQATDSS    DBKEY                           S01313
     C****                 EXSR *PSSR                                     S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****OVE SECURITY REPORT NAME  FROM LF/SECTY TO NARRATIVE 1          S01313
     C****N PORTFOLIO TRANSFER SUBFILE RECORD                             S01313
     C****                 MOVELSRPN      DDNAR1                          S01313
     C****                                                                S01313
     C****OVE NOMINAL CURRENCY FROM LF/PMHPOSLL TO CURRENCY 1             S01313
     C****N PORTFOLIO TRANSFER SUBFILE RECORD                             S01313
     C****                 MOVELQATNMC    DDCCY1                          S01313
     C****                                                                S01313
     C****F NOMINAL FROM LF/PMHPOSLL IS NEGATIVE, REVERSE SIGN OF         S01313
     C****OMINAL BEFORE INPUT TO STANDARD SR. ZEDIT                       S01313
     C****                 Z-ADD0         QANOM1                          S01313
     C****       QANOML    IFLT 0                                         S01313
     C****       QANOML    MULT -1        QANOM1 110                      S01313
     C****                 ELSE                                           S01313
     C****                 Z-ADDQANOML    QANOM1                          S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****DIT NOMINAL FOR OUTPUT TO SUBFILE RECORD (USE STANDARD          S01313
     C****R. ZEDIT WITH ZFIELD= NOMINAL AND ZADEC= NOMINAL DECIMAL        S01313
     C****LACES, BOTH FROM LF/PMHPOSLL)                                   S01313
     C****                 MOVE *BLANKS   ZFIELD                          S01313
     C****                 MOVE QANOM1    ZFIELD                          S01313
     C****                 Z-ADDQATNMD    ZADEC                           S01313
     C****       16        SUB  ZADEC     ZADIG                           S01313
     C****                 EXSR ZEDIT                                     S01313
     C****                 MOVE *BLANKS   WW15                            S01313
     C****                 MOVE ZFIELD    WW15   15                       S01313
     C****                 MOVEL*BLANKS   WW16   16                       S01313
     C****                                                                S01313
     C****F A TRADE DATE RECORD IS BEING PROCESSED                        S01313
     C****       QATVDA    IFEQ 'T'                                       S01313
     C****                                                                S01313
     C****F NOMINAL FROM LF/PMHPOSLL IS NEGATIVE, MOVE '-'                S01313
     C****O NOMINAL AMOUNT 1 IN SUBFILE                                   S01313
     C****       QANOML    IFLT 0                                         S01313
     C****                 MOVE '-'       WW16                            S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****OVE LEFT EDITED NOMINAL TO NOMINAL AMOUNT 1 ON SUBFILE          S01313
     C****                 MOVELWW15      WW16                            S01313
     C****                 MOVELWW16      DDNOM1                          S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****F A VALUE DATE RECORD IS BEING PROCESSED                        S01313
     C****       QATVDA    IFEQ 'V'                                       S01313
     C****                                                                S01313
     C****F NOMINAL FROM LF/PMHPOSLL IS NEGATIVE, MOVE '-'                S01313
     C****O NOMINAL AMOUNT 2 IN SUBFILE                                   S01313
     C****       QANOML    IFLT 0                                         S01313
     C****                 MOVE '-'       WW16                            S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****OVE LEFT EDITED NOMINAL TO NOMINAL AMOUNT 2 ON SUBFILE          S01313
     C****                 MOVELWW15      WW16                            S01313
     C****                 MOVELWW16      DDNOM2                          S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****OVE SECURITY SHORTNAME  FROM LF/PMHPOSLL TO REFERENCE 2         S01313
     C****N PORTFOLIO TRANSFER SUBFILE RECORD                             S01313
     C****                 MOVELQATDSS    DDREF2                          S01313
     C****                                                                S01313
     C****XECUTE STANDARD SR/ZFSELN - FORMAT SE LINE DESCRIPTION          S01313
     C****ITH ZNMCY=NOMINAL CURRENCY, ZCPNR=COUPON RATE AND               S01313
     C****MATY=MATURITY DATE, ALL FROM LF/SECTY                           S01313
     C****                 MOVELNMCY      ZNMCY                           S01313
     C****                 Z-ADDCPNR      ZCPNR                           S01313
     C****                 Z-ADDMATY      ZMATY                           S01313
     C****                 EXSR ZFSELN                                    S01313
     C****                 MOVELZLIN      DDNAR2                          S01313
     C****                                                                S01313
     C****CCESS PF/PMTRSFXX - PORTFOLIO TRANSFER DETAILS USING            S01313
     C****USTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT, SECURITY       S01313
     C****HORTNAME FROM LF/PMHPOSLL AND MODULE ID = 'SE' AS KEY           S01313
     C****ALL OTHER KEY FIELDS BLANK OR ZERO AS APPROPRIATE)              S01313
     C****                 MOVEL'SE'      WWMODI  2                       S01313
     C****                 MOVEL*BLANKS   WWSESN                          S01313
     C****                 MOVELQATDSS    WWSESN                          S01313
     C****                 Z-ADD*ZERO     WWTRNB                          S01313
     C****                 MOVEL*BLANKS   WWCCY                           S01313
     C****                 Z-ADD0         WWACOD                          S01313
     C****                 Z-ADD0         WWACSQ                          S01313
     C****                 MOVEL'P'       WWPOTI                          S01313
     C****       KKPMTR    CHAINPMTRSFXX             72                   S01313
     C****       *IN72     IFEQ '0'                                       S01313
     C****                                                                S01313
     C****       P8TPTF    IFEQ '9997'                                    S01313
     C****                 MOVELP9R997    DDPTRS                          S01313
     C****                 MOVELP9R997    HHFPTF                          S01313
     C****                 ELSE                                           S01313
     C****                 MOVELP8TPTF    DDPTRS                          S01313
     C****                 MOVELP8TPTF    HHFPTF                          S01313
     C****                 END                                            S01313
     C****                 MOVELP8TNLU    HHTNLU                          S01313
     C****                 ELSE                                           S01313
     C****                 MOVEL*BLANKS   DDPTRS                          S01313
     C****                 MOVEL*BLANKS   HHFPTF                          S01313
     C****                 Z-ADD0         HHTNLU                          S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****                 END                                            S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****RITE LAST RECORD FOR THIS MODULE                                S01313
     C****       WWW       IFNE 0                                         S01313
     C****                 EXSR ZWTR                                      S01313
     C****                 EXSR ZRAZ                                      S01313
     C****                 END                                            S01313
     C****                                                                S01313
     C****       EP1005    ENDSR                                          S01313
     C*****************************************************************
      /EJECT
     C*****************************************************************   56555
     C*  P1005  S/R TO LOAD TRANSFER OF POSITIONS                         56555
     C*  CALLED FROM S/R P1003                                            56555
     C*  CALLS  S/R  =>  ZEDIT                                            56555
     C*              =>  *PSSR                                            56555
     C*              =>  ZFSELN                                           56555
     C*              =>  ZWTR                                             56555
     C*              =>  ZRAZ                                             56555
     C********************************************************************56555
     C*                                                                   56555
     C           P1005     BEGSR                           ** P1005  BSR**56555
     C*                                                                   56555
     C*  ACCESS LF/PMPOSDLL - TRANSFER POSITION FILE                      56555
     C*  CUSTOMER NUMBER, PORTFOLIO FROM SCREEN AND DATE OF *LOVAL        56555
     C*                                                                   56555
     C           *IN75     DOWEQ'0'                        B1             56555
     C           KKPM      READEPMPOSDLL                 75               56555
     C           *IN75     IFEQ '0'                        B2             56555
     C*                                                                   56555
     C           QATDSS    IFNE ZZREF2                     B3             56555
     C           WWW       ANDNE0                                         56555
     C           FLAG      ANDEQ'Y'                                       56555
     C*                                                                   56555
     C*  MOVE 'SE' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD      56555
     C                     MOVE ZZMODI    DDMODI                          56555
     C                     MOVE ZZMOD2    DDMOD2                          56555
     C*                                                                   56555
     C*  MOVEL 'P' IN "HHPOTI" HIDDEN FIELD                               56555
     C                     MOVELZZPOTI    HHPOTI                          56555
     C*  MOVE 'P' IN "DDIND1" FIELD                                       56555
     C                     MOVE ZZIND1    DDIND1                          56555
     C*                                                                   56555
     C*  MOVE SECURITY REPORT NAME  FROM LF/SECTY TO NARRATIVE 1          56555
     C*  IN PORTFOLIO TRANSFER SUBFILE RECORD                             56555
     C                     MOVELZZNAR1    DDNAR1                          56555
     C*                                                                   56555
     C*  MOVE NOMINAL CURRENCY FROM LF/PMPOSDLL TO CURRENCY 1             56555
     C*  IN PORTFOLIO TRANSFER SUBFILE RECORD                             56555
     C                     MOVELZZCCY1    DDCCY1                          56555
     C*                                                                   56555
     C*  NOMINAL FOR OUTPUT TO SUBFILE RECORD                             56555
     C                     MOVELZZNOM1    DDNOM1                          56555
     C*                                                                   56555
     C*  MOVE SECURITY SHORTNAME  FROM LF/PMPOSDLL TO REFERENCE 2         56555
     C*  IN PORTFOLIO TRANSFER SUBFILE RECORD                             56555
     C                     MOVELZZREF2    DDREF2                          56555
     C*                                                                   56555
     C*  EXECUTE STANDARD SR/ZFSELN - FORMAT SE LINE DESCRIPTION          56555
     C                     MOVELZZNAR2    DDNAR2                          56555
     C                     MOVELZZPTRS    DDPTRS                          56555
     C                     MOVELZZFPTF    HHFPTF                          56555
     C                     Z-ADDZZTNLU    HHTNLU                          56555
     C*                                                                   56555
     C                     MOVE 'N'       FLAG                            56555
     C*                                                                   56555
     C*  TEST SECURITY SHORTNAME => IF IT'S SAME AS PREVIOUS, NO WRITE    56555
     C*  IN SUBFILE; ELSE WRITE A LINE IN SUBFILE                         56555
     C*                                                                   56555
     C                     MOVELDDNOM1    ZER    14                       56555
     C           ZER       IFNE *BLANKS                    B4             56555
     C                     EXSR ZWTR                                      56555
     C                     EXSR ZRAZ                                      56555
     C                     END                             E4             56555
     C                     END                             E3             56555
     C*                                                                   56555
     C*  ADD '1' IN FIELD WWW (WWW='1' => AT LEAST ONE RECORD EXISTS)     56555
     C                     Z-ADD1         WWW     10                      56555
     C*                                                                   56555
     C* IF POSITION DATE IS LOWER THAN BACKVALUED DATE (WWBKVD)           56555
     C*                                                                   56555
     C           QAPDAT    IFLT WWBKVD                     B3             56555
     C                     MOVE 'Y'       FLAG                            56555
     C                     EXSR SAVED                                     56555
     C                     END                             E3             56555
     C*                                                                   56555
     C                     END                              E2            56555
     C                     END                              E1            56555
     C*                                                                   56555
     C*  WRITE LAST RECORD FOR THIS MODULE                                56555
     C           *IN75     IFEQ '1'                         B1            56555
     C           WWW       ANDNE0                                         56555
     C           QATDSS    IFEQ ZZREF2                      B2            56555
     C           WWW       ANDNE0                                         56555
     C           FLAG      ANDEQ'Y'                                       56555
     C*                                                                   56555
     C*  MOVE 'SE' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD      56555
     C                     MOVE ZZMODI    DDMODI                          56555
     C                     MOVE ZZMOD2    DDMOD2                          56555
     C*                                                                   56555
     C*  MOVEL 'P' IN "HHPOTI" HIDDEN FIELD                               56555
     C                     MOVELZZPOTI    HHPOTI                          56555
     C*  MOVE 'P' IN "DDIND1" FIELD                                       56555
     C                     MOVE ZZIND1    DDIND1                          56555
     C*                                                                   56555
     C*  MOVE SECURITY REPORT NAME  FROM LF/SECTY TO NARRATIVE 1          56555
     C*  IN PORTFOLIO TRANSFER SUBFILE RECORD                             56555
     C                     MOVELZZNAR1    DDNAR1                          56555
     C*                                                                   56555
     C*  MOVE NOMINAL CURRENCY FROM LF/PMPOSDLL TO CURRENCY 1             56555
     C*  IN PORTFOLIO TRANSFER SUBFILE RECORD                             56555
     C                     MOVELZZCCY1    DDCCY1                          56555
     C*                                                                   56555
     C*  NOMINAL FOR OUTPUT TO SUBFILE RECORD                             56555
     C                     MOVELZZNOM1    DDNOM1                          56555
     C*                                                                   56555
     C*  MOVE SECURITY SHORTNAME  FROM LF/PMPOSDLL TO REFERENCE 2         56555
     C*  IN PORTFOLIO TRANSFER SUBFILE RECORD                             56555
     C                     MOVELZZREF2    DDREF2                          56555
     C*                                                                   56555
     C*  EXECUTE STANDARD SR/ZFSELN - FORMAT SE LINE DESCRIPTION          56555
     C                     MOVELZZNAR2    DDNAR2                          56555
     C                     MOVELZZPTRS    DDPTRS                          56555
     C                     MOVELZZFPTF    HHFPTF                          56555
     C                     Z-ADDZZTNLU    HHTNLU                          56555
     C*                                                                   56555
     C                     MOVE 'N'       FLAG                            56555
     C*                                                                   56555
     C*  TEST SECURITY SHORTNAME => IF IT'S SAME AS PREVIOUS, NO WRITE    56555
     C*  IN SUBFILE; ELSE WRITE A LINE IN SUBFILE                         56555
     C*                                                                   56555
     C                     MOVELDDNOM1    ZER    14                       56555
     C           ZER       IFNE *BLANKS                    B3             56555
     C                     EXSR ZWTR                                      56555
     C                     EXSR ZRAZ                                      56555
     C                     END                             E3             56555
     C                     END                             E2             56555
     C                     END                             E1             56555
     C*                                                                   56555
     C           EP1005    ENDSR                                          56555
     C*                                                                   56555
     C*****************************************************************   56555
     C** SAVED S/R CONTAINING SAVED POSITION DETAILS                      56555
     C** CALLED FROM P1005                                                56555
     C*****************************************************************   56555
     C*                                                                   56555
     C           SAVED     BEGSR                           ** SAVED  BSR**56555
     C*                                                                   56555
     C*  SAVE POSTION DETAILS WHEN FORMATTING RECORD FOR SCREEN           56555
     C*  MOVE 'SE' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD      56555
     C*                                                                   56555
     C                     MOVE ' SE  '   ZZMODI  5                       56555
     C                     MOVE 'HISTORY' ZZMOD2  7                       56555
     C*                                                                   56555
     C*  MOVEL 'P' IN "HHPOTI" HIDDEN FIELD                               56555
     C                     MOVEL'P'       ZZPOTI  1                       56555
     C*  MOVE 'P' IN "DDIND1" FIELD                                       56555
     C                     MOVE 'P'       ZZIND1  1                       56555
     C*                                                                   56555
     C*  ACCESS LF/SECTY - SE SECURITIES USING SECURITY SHORTNAME         56555
     C*  FROM LF/PMPOSDLL AS KEY                                          56555
     C           QATDSS    CHAINSECTY                72                   56555
     C           *IN72     IFEQ '1'                                       56555
     C*                                                                   56555
     C*** ERROR ***                                        ***************56555
     C                     Z-ADD3         DBASE            **DB ERROR 03**56555
     C                     MOVEL'SECTY   'DBFILE           ***************56555
     C                     MOVELQATDSS    DBKEY                           56555
     C                     EXSR *PSSR                                     56555
     C                     END                                            56555
     C*                                                                   56555
     C*  MOVE SECURITY REPORT NAME  FROM LF/SECTY TO NARRATIVE 1          56555
     C*  IN PORTFOLIO TRANSFER SUBFILE RECORD                             56555
     C                     MOVELSRPN      ZZNAR1 20                       56555
     C*                                                                   56555
     C*  MOVE NOMINAL CURRENCY FROM LF/PMPOSDLL TO CURRENCY 1             56555
     C*  IN PORTFOLIO TRANSFER SUBFILE RECORD                             56555
     C                     MOVELQATNMC    ZZCCY1  3                       56555
     C*                                                                   56555
     C*  IF NOMINAL FROM LF/PMPOSDLL IS NEGATIVE, REVERSE SIGN OF         56555
     C*  NOMINAL BEFORE INPUT TO STANDARD SR. ZEDIT                       56555
     C                     Z-ADD0         QANOM1                          56555
     C                     Z-ADDQANOML    HHNOML                          56555
     C           QANOML    IFLT 0                                         56555
     C           QANOML    MULT -1        QANOM1 110                      56555
     C                     ELSE                                           56555
     C                     Z-ADDQANOML    QANOM1                          56555
     C                     END                                            56555
     C*                                                                   56555
     C*  EDIT NOMINAL FOR OUTPUT TO SUBFILE RECORD (USE STANDARD          56555
     C*  SR. ZEDIT WITH ZFIELD= NOMINAL AND ZADEC= NOMINAL DECIMAL        56555
     C*  PLACES, BOTH FROM LF/PMPOSDLL)                                   56555
     C                     MOVE *BLANKS   ZFIELD                          56555
     C                     MOVE QANOM1    ZFIELD                          56555
     C                     Z-ADDQATNMD    ZADEC                           56555
     C           16        SUB  ZADEC     ZADIG                           56555
     C                     EXSR ZEDIT                                     56555
     C                     MOVE *BLANKS   WW15                            56555
     C                     MOVE ZFIELD    WW15   15                       56555
     C                     MOVEL*BLANKS   WW16   16                       56555
     C*                                                                   56555
     C*  ONLY TRADE DATE RECORD IS BEING PROCESSED                        56555
     C           QATVDA    IFEQ 'T'                                       56555
     C*                                                                   56555
     C*  IF NOMINAL FROM LF/PMPOSDLL IS NEGATIVE, MOVE '-'                56555
     C*  TO NOMINAL AMOUNT 1 IN SUBFILE                                   56555
     C           QANOML    IFLT 0                                         56555
     C                     MOVE '-'       WW16                            56555
     C                     END                                            56555
     C*                                                                   56555
     C*  MOVE LEFT EDITED NOMINAL TO NOMINAL AMOUNT 1 ON SUBFILE          56555
     C                     MOVELWW15      WW16                            56555
     C                     MOVELWW16      ZZNOM1 17                       56555
     C                     END                                            56555
     C*                                                                   56555
     C*  MOVE SECURITY SHORTNAME  FROM LF/PMPOSDLL TO REFERENCE 2         56555
     C*  IN PORTFOLIO TRANSFER SUBFILE RECORD                             56555
     C                     MOVELQATDSS    ZZREF2 10                       56555
     C*                                                                   56555
     C*  EXECUTE STANDARD SR/ZFSELN - FORMAT SE LINE DESCRIPTION          56555
     C*  WITH ZNMCY=NOMINAL CURRENCY, ZCPNR=COUPON RATE AND               56555
     C*   MATY=MATURITY DATE, ALL FROM LF/SECTY                           56555
     C                     MOVELNMCY      ZNMCY                           56555
     C                     Z-ADDCPNR      ZCPNR                           56555
     C                     Z-ADDMATY      ZMATY                           56555
     C                     EXSR ZFSELN                                    56555
     C**********           MOVELZLIN      ZZNAR2 20                                     56555 CGL029
     C                     MOVELZLIN      ZZNAR2 24                                           CGL029
     C*                                                                   56555
     C*  ACCESS PF/PMTRSFXX - PORTFOLIO TRANSFER DETAILS USING            56555
     C*  CUSTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT, SECURITY       56555
     C*  SHORTNAME FROM LF/PMPOSDLL AND MODULE ID = 'SE' AS KEY           56555
     C*   ALL OTHER KEY FIELDS BLANK OR ZERO AS APPROPRIATE)              56555
     C                     MOVEL'SE'      WWMODI  2                       56555
     C                     MOVEL*BLANKS   WWSESN                          56555
     C                     MOVELQATDSS    WWSESN                          56555
     C**********           Z-ADD*ZERO     WWTRNB                                        56555 CLE148
     C                     MOVEL*BLANKS   WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWCCY                           56555
     C                     Z-ADD0         WWACOD                          56555
     C                     Z-ADD0         WWACSQ                          56555
     C                     MOVEL*BLANKS   WWBRCA                          095249
     C                     MOVEL'P'       WWPOTI                          56555
     C           KKPMTR    CHAINPMTRSFXX             72                   56555
     C           *IN72     IFEQ '0'                                       56555
     C*                                                                   56555
     C           P8TPTF    IFEQ '9997'                                    56555
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C***********          MOVELP9R997    ZZPTRS  4                 56555 S01486
     C***********          MOVELP9R997    ZZFPTF  4                 56555 S01486
     C                     MOVELFCR997    ZZPTRS  4                       S01486
     C                     MOVELFCR997    ZZFPTF  4                       S01486
     C                     ELSE                                           56555
     C                     MOVELP8TPTF    ZZPTRS                          56555
     C                     MOVELP8TPTF    ZZFPTF                          56555
     C                     END                                            56555
     C                     MOVELP8TNLU    ZZTNLU  50                      56555
     C                     ELSE                                           56555
     C                     MOVEL*BLANKS   ZZPTRS                          56555
     C                     MOVEL*BLANKS   ZZFPTF                          56555
     C                     Z-ADD0         ZZTNLU                          56555
     C                     END                                            56555
     C*                                                                   56555
     C           ESAVED    ENDSR                                          56555
     C*
     C*****************************************************************
     C*
     C** P1006  S/R TO LOAD SE TRADES TO SUBFILE
     C** CALLED FROM S/R P1003
     C** CALLS  S/R  =>  ZEDIT
     C**             =>  ZFSELN
     C**             =>  ZWTR
     C**             =>  ZRAZ
     C*****************************************************************
     C           P1006     BEGSR                           ** P1006  BSR**
     C*
     C** ACCESS LF/TRADPT  - SE TRADES BY PORTFOLIO REFERENCE USING
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE INPUT AS KEY
     C                     MOVE *BLANKS   DDMOD2                          56555
     C           *IN76     DOWEQ'0'
     C           KKPM      READETRADPT                   76
     C           *IN76     IFEQ '0'
     C*
     C                     MOVE RECI      TDRECI  1                       48219
     C*
     C** MOVE 'SE' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD
     C*********************MOVE 'SE'      DDMODI                          B8108
     C                     MOVE ' SE  '   DDMODI                          B8108
     C*
     C** ACCESS LF/SECTY - SE SECURITIES USING SECURITY SHORTNAME
     C** FROM LF/TRADPT AS KEY
     C           TDSS      CHAINSECTY                72
     C************IN89     IFEQ '1'                        ***************S01486
     C           *IN72     IFEQ '1'                        ***************S01486
     C                     Z-ADD10        DBASE            **DB ERROR 10**
     C                     MOVEL'SECTY   'DBFILE           ***************
     C                     MOVELTDSS      DBKEY
     C                     EXSR *PSSR
     C                     END
     C*********************END                             E3      B08275 B8108
     C*                                                                   B08275
     C** TRADES ON MATURED SECURITIES SHOULD NOT BE DISPLAYED FOR         B08275
     C** TRANSFER                                                         B08275
     C** ALSO MAY ONLY TRANSFER TRADES IF ENTERED AFTER BACKVALUE DATE
     C           RECI      IFEQ 'D'                        B3             B08275
     C*****      TDDT      ANDGTWWBKVD                               48219090969
     C           TDDT      ANDGEWWBKVD                                    090969
     C*
     C** MOVEL 'T' IN "HHPOTI" HIDDEN FIELD
     C                     MOVEL'T'       HHPOTI
     C*
     C** MOVE SECURITY REPORT NAME  FROM LF/SECTY TO NARRATIVE 1
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELSRPN      DDNAR1
     C*
     C** MOVE TRADE REFERENCE FROM LF/TRADPT TO REFERENCE 1
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELTDRF      DDREF1
     C*
     C** MOVE SECURITY SHORTNAME  FROM LF/TRADPT TO REFERENCE 2
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELTDSS      DDREF2
     C*
     C** MOVE NOMINAL CURRENCY FROM LF/TRADPT TO CURRENCY 1
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELTNMC      DDCCY1
     C*
     C** EDIT NOMINAL FOR OUTPUT TO SUBFILE RECORD (USE STANDARD
     C** SR. ZEDIT WITH ZFIELD= NOMINAL AND ZADEC= NOMINAL DECIMAL
     C** PLACES, BOTH FROM LF/TRADPT)
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE NOML      ZFIELD
     C                     Z-ADDTNMD      ZADEC
     C           16        SUB  ZADEC     ZADIG
     C                     EXSR ZEDIT
     C                     MOVE *BLANKS   WW15
     C                     MOVE ZFIELD    WW15
     C*
     C** MOVE LEFT EDITED NOMINAL TO NOMINAL AMOUNT 1 ON SUBFILE
     C                     MOVELWW15      DDNOM1
     C*
     C** MOVE LEFT TRADE TYPE FROM LF/TRADPT TO INDICATOR 1 ON
     C** PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELTDTP      DDIND1
     C                     MOVE *BLANKS   DDIND2
     C*
     C** EXECUTE STANDARD SR/ZFSELN - FORMAT SE LINE DESCRIPTION
     C** WITH ZNMCY=NOMINAL CURRENCY, ZCPNR=COUPON RATE AND
     C** ZMATY=MATURITY DATE, ALL FROM LF/SECTY
     C                     MOVELNMCY      ZNMCY
     C                     Z-ADDCPNR      ZCPNR
     C                     Z-ADDMATY      ZMATY
     C                     EXSR ZFSELN
     C                     MOVELZLIN      DDNAR2
     C*
     C** ACCESS PF/PMTRSFXX - PORTFOLIO TRANSFER DETAILS USING
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT, TRANSACTION
     C** NUMBER = TRADE REF. FROM LF/TRADPT AND MODULE ID = 'SE' AS KEY
     C** (ALL OTHER KEY FIELDS BLANK OR ZERO AS APPROPRIATE)
     C                     MOVEL'SE'      WWMODI  2
     C**********           Z-ADD*ZERO     WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWTRNB                                              CLE148
     C                     MOVELTDRF      WWTRNB
     C                     MOVEL*BLANKS   WWCCY
     C                     Z-ADD0         WWACOD
     C                     Z-ADD0         WWACSQ
     C                     MOVEL*BLANKS   WWBRCA                          095249
     C                     MOVEL*BLANKS   WWSESN
     C                     MOVELTDSS      WWSESN
     C                     MOVEL'T'       WWPOTI
     C           KKPMTR    CHAINPMTRSFXX             72
     C           *IN72     IFEQ '0'
     C*
     C           P8TPTF    IFEQ '9997'
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C***********          MOVELP9R997    DDPTRS                          S01486
     C***********          MOVELP9R997    HHFPTF                          S01486
     C                     MOVELFCR997    DDPTRS                          S01486
     C                     MOVELFCR997    HHFPTF                          S01486
     C                     ELSE
     C                     MOVELP8TPTF    DDPTRS
     C                     MOVELP8TPTF    HHFPTF
     C                     END
     C                     MOVELP8TNLU    HHTNLU
     C                     ELSE
     C                     MOVEL*BLANKS   DDPTRS
     C                     MOVEL*BLANKS   HHFPTF
     C                     Z-ADD0         HHTNLU
     C                     END
     C*
     C                     EXSR ZWTR
     C                     EXSR ZRAZ
     C                     END                             E3             B8108
     C                     END
     C                     END
     C*
     C           EP1006    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P1007  S/R TO LOAD SE DEPOT MOVEMENTS TO SUBFILE
     C** CALLED FROM S/R P1003
     C** CALLS  S/R  =>  *PSSR
     C**             =>  ZEDIT
     C**             =>  ZFSELN
     C**             =>  ZWTR
     C**             =>  ZRAZ
     C*****************************************************************
     C*
     C           P1007     BEGSR                           ** P1007  BSR**
     C*
     C***ACCESS*LF/DPTMPT*- SE DEPOT MOVEMENTS BY PORTFOLIO REFERENCE     S01486
     C** ACCESS LF/PMDPTML0 - SE DEPOT MOVEMENTS BY PORTFOLIO REFERENCE   S01486
     C** USING CUSTOMER NUMBER AND PORTFOLIO REFERENCE INPUT AS KEY
     C           *IN77     DOWEQ'0'
     C***********KKPM      READEDPTMPT                   77               S01486
     C           KKPM      READEPMDPTML0                 77               S01486
     C           *IN77     IFEQ '0'
     C*
     C** MOVE 'SE' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD
     C*********************MOVE 'SE'      DDMODI                          B8108
     C                     MOVE ' SE  '   DDMODI                          B8108
     C*
     C** MOVEL 'D' IN "HHPOTI" HIDDEN FIELD
     C                     MOVEL'D'       HHPOTI
     C*
     C** ACCESS LF/SECTY - SE SECURITIES USING SECURITY SHORTNAME
     C***FROM*LF/DPTMPT*AS KEY                                            S01486
     C** FROM LF/PMDPTML0 AS KEY                                          S01486
     C           DPSS      CHAINSECTY                72
     C           *IN72     IFEQ '1'
     C*
     C** ERROR
     C                     Z-ADD4         DBASE            **DB ERROR 04**
     C                     MOVEL'SECTY   'DBFILE           ***************
     C                     MOVELDPSS      DBKEY
     C                     EXSR *PSSR
     C                     END
     C*                                                                   B08275
     C** DEPOT MOVEMENTS SHOULD ONLY BE SHOWN ON LIVE SECURITIES          B08275
     C** ALSO ONLY ALLOW TRANSFER OF DEPOT MOVEMENTS IF ENTERED AFTER
     C** BACKVALUE DATE
     C           RECI      IFEQ 'D'                                       B08275
     C****       DPMD      ANDGTWWBKVD                               48219090969
     C           DPMD      ANDGEWWBKVD                                    090969
     C           RECI      OREQ 'D'                                       48219
     C****       DPDO      ANDGTWWBKVD                               48219090969
     C           DPDO      ANDGEWWBKVD                                    090969
     C*
     C** MOVE SECURITY REPORT NAME  FROM LF/SECTY TO NARRATIVE 1
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELSRPN      DDNAR1
     C*
     C***MOVE*REFERENCE*FROM LF/DPTMPT TO REFERENCE 1                     S01486
     C** MOVE REFERENCE FROM LF/PMDPTML0 TO REFERENCE 1                   S01486
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELDPRN      DDREF1
     C*
     C** MOVE NOMINAL CURRENCY FROM LF/SECTY TO CURRENCY 1
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELNMCY      DDCCY1
     C*
     C** EDIT NOMINAL FOR OUTPUT TO SUBFILE RECORD (USE STANDARD
     C***SR.*ZEDIT*WITH*ZFIELD= NOMINAL AMOUNT FROM LF/DPTMPT             S01486
     C** SR. ZEDIT WITH ZFIELD= NOMINAL AMOUNT FROM LF/PMDPTML0           S01486
     C** AND ZADEC= NOMINAL DECIMAL PLACES FROM LF/SECTY)
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE DPNA      ZFIELD
     C                     Z-ADDNMDP      ZADEC
     C           16        SUB  ZADEC     ZADIG
     C                     EXSR ZEDIT
     C                     MOVE *BLANKS   WW15
     C                     MOVE ZFIELD    WW15
     C*
     C** MOVE LEFT EDITED NOMINAL TO NOMINAL AMOUNT 1 ON SUBFILE
     C                     MOVELWW15      DDNOM1
     C*
     C***MOVE*LEFT*DEPOT*MOVEMENT TYPE FROM LF/DPTMPT TO INDICATOR 1      S01486
     C** MOVE LEFT DEPOT MOVEMENT TYPE FROM LF/PMDPTML0 TO INDICATOR 1    S01486
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD (WILL BE EITHER 'WI' OR
     C** 'WO')
     C                     MOVE DPMV      DDIND1
     C                     MOVE *BLANKS   DDIND2
     C*
     C** EXECUTE STANDARD SR/ZFSELN - FORMAT SE LINE DESCRIPTION
     C** WITH ZNMCY=NOMINAL CURRENCY, ZCPNR=COUPON RATE AND
     C** ZMATY=MATURITY DATE, ALL FROM LF/SECTY
     C                     MOVELNMCY      ZNMCY
     C                     Z-ADDCPNR      ZCPNR
     C                     Z-ADDMATY      ZMATY
     C                     EXSR ZFSELN
     C                     MOVELZLIN      DDNAR2
     C*
     C***MOVE*SECURITY*SHORTNAME**FROM LF/DPTMPT TO REFERENCE 2           S01486
     C** MOVE SECURITY SHORTNAME  FROM LF/PMDPTML0 TO REFERENCE 2         S01486
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELDPSS      DDREF2
     C*
     C** ACCESS PF/PMTRSFXX - PORTFOLIO TRANSFER DETAILS USING
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT, TRANSACTION
     C***NUMBER*=*REFERENCE*FROM*LF/DPTMPT,*SECURITY SHORTNAME FROM       S01486
     C** NUMBER = REFERENCE FROM LF/PMDPTML0, SECURITY SHORTNAME FROM     S01486
     C***LF/DPTMPT*AND*MODULE ID = 'SE' AS KEY                            S01486
     C** LF/PMDPTML0 AND MODULE ID = 'SE' AS KEY                          S01486
     C** (ALL OTHER KEY FIELDS BLANK OR ZERO AS APPROPRIATE)
     C                     MOVEL'SE'      WWMODI
     C**********           Z-ADD*ZERO     WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWTRNB                                              CLE148
     C                     MOVELDPRN      WWTRNB
     C                     MOVEL*BLANKS   WWSESN
     C                     MOVELDPSS      WWSESN
     C                     MOVEL*BLANKS   WWCCY
     C                     Z-ADD0         WWACOD
     C                     Z-ADD0         WWACSQ
     C                     MOVEL*BLANKS   WWBRCA                          095249
     C                     MOVEL'D'       WWPOTI
     C           KKPMTR    CHAINPMTRSFXX             72
     C           *IN72     IFEQ '0'
     C*
     C           P8TPTF    IFEQ '9997'
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C***********          MOVELP9R997    DDPTRS                          S01486
     C***********          MOVELP9R997    HHFPTF                          S01486
     C                     MOVELFCR997    DDPTRS                          S01486
     C                     MOVELFCR997    HHFPTF                          S01486
     C                     ELSE
     C                     MOVELP8TPTF    DDPTRS
     C                     MOVELP8TPTF    HHFPTF
     C                     END
     C                     MOVELP8TNLU    HHTNLU
     C                     ELSE
     C                     MOVEL*BLANKS   DDPTRS
     C                     MOVEL*BLANKS   HHFPTF
     C                     Z-ADD0         HHTNLU
     C                     END
     C*
     C                     EXSR ZWTR
     C                     EXSR ZRAZ
     C                     END                                            B08275
     C                     END
     C                     END
     C*
     C           EP1007    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************   S01486
     C***P1008**S/R TO LOAD FF TRANSACTIONS TO SUBFILE                    S01486
     C***CALLED*FROM S/R P1003                                            S01486
     C***CALLS**S/R  =>  *PSSR                                            S01486
     C***********    =>  ZEDIT                                            S01486
     C***********    =>  ZFFFLN                                           S01486
     C***********    =>  ZWTR                                             S01486
     C***********    =>  ZRAZ                                             S01486
     C*****************************************************************   S01486
     C***********                                                         S01486
     C***********P1008     BEGSR                           ** P1008  BSR**S01486
     C***********                                                         S01486
     C***ACCESS*LF/TRANSPT - FF TRANSACTIONS BY PORTFOLIO REFERENCE       S01486
     C***USING*CUSTOMER NUMBER AND PORTFOLIO REFERENCE INPUT AS KEY       S01486
     C************IN78     DOWEQ'0'                                       S01486
     C***********KKPM      READETRANSPT                  78               S01486
     C************IN78     IFEQ '0'                                       S01486
     C***********                                                         S01486
     C***MOVE*'FF' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD      S01486
     C*********************MOVE 'FF'      DDMODI                    B8108 S01486
     C***********          MOVE ' FF  '   DDMODI                    B8108 S01486
     C***********                                                         S01486
     C***MOVEL*'T' IN "HHPOTI" HIDDEN FIELD                               S01486
     C***********          MOVEL'T'       HHPOTI                          S01486
     C***********                                                         S01486
     C***ACCESS*LF/INTYP - FF INSTRUMENT TYPES USING INSTRUMENT TYPE      S01486
     C***FROM*LF/TRANSPT AS KEY                                           S01486
     C***********ISTT      CHAININTYP                72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***********                                                         S01486
     C***ERROR***                                                         S01486
     C***********          Z-ADD5         DBASE            **DB ERROR 05**S01486
     C***********          MOVEL'INTYP   'DBFILE           ***************S01486
     C***********          MOVELISTT      DBKEY                           S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***MOVE*INSTRUMENT NAME  FROM LF/INTYP TO NARRATIVE 1               S01486
     C***ON*PORTFOLIO TRANSFER SUBFILE RECORD                             S01486
     C***********          MOVELISTN      DDNAR1                          S01486
     C***********                                                         S01486
     C***MOVE*TRANSACTION NUMBER FROM LF/TRANSPT TO REFERENCE 1           S01486
     C***ON*PORTFOLIO TRANSFER SUBFILE RECORD                             S01486
     C***********          MOVELTNBR      DDREF1                          S01486
     C***********                                                         S01486
     C***MOVE*INSTRUMENT CURRENCY FROM LF/TRANSPT TO CURRENCY 1           S01486
     C***ON*PORTFOLIO TRANSFER SUBFILE RECORD                             S01486
     C***********          MOVELISCY      DDCCY1                          S01486
     C***********                                                         S01486
     C***EDIT*NUMBER OF CONTRACTS FOR OUTPUT TO SUBFILE RECORD            S01486
     C***(USE*STANDARD ZEDIT WITH ZFIELD=NUMBER OF CONTRACTS (NUCO)       S01486
     C***FROM*LF/TRANSPT AND ZADEC=0)                                     S01486
     C***********          MOVE *BLANKS   ZFIELD                          S01486
     C***********          MOVE NUCO      ZFIELD                          S01486
     C***********          Z-ADD0         ZADEC                           S01486
     C***********16        SUB  ZADEC     ZADIG                           S01486
     C***********          EXSR ZEDIT                                     S01486
     C***********          MOVE ZFIELD    WW05    5                       S01486
     C***********          MOVE *BLANKS   WW15                            S01486
     C***********          MOVE WW05      WW15                            S01486
     C***********                                                         S01486
     C***MOVE*LEFT EDITED NUMBER OF CONT. TO NOMINAL AMOUNT 1 ON SUBFILE  S01486
     C***********          MOVELWW15      DDNOM1                          S01486
     C***********                                                         S01486
     C***MOVE*LEFT TRANSACTION TYPE FROM LF/TRANSPT TO INDICATOR 1        S01486
     C***ON*PORTFOLIO TRANSFER SUBFILE RECORD (WILL BE EITHER 'P' OR      S01486
     C***'S')****                                                         S01486
     C***********          MOVE *BLANKS   DDIND1                          S01486
     C***********          MOVE *BLANKS   DDIND2                          S01486
     C***********          MOVE TRTY      DDIND1                          S01486
     C***********                                                         S01486
     C***EXECUTE*STANDARD SR/ZFFFLN - FORMAT FF LINE DESCRIPTION          S01486
     C***WITH*ZISCY=INSTRUMENT CURRENCY, ZMTHN=MONTH NUMBER,              S01486
     C***ZYRNO=YEAR NUMBER, ZPCAL=PUT/CALL AND ZSTRP=STRIKE PRICE,        S01486
     C***ALL*FROM LF/TRANSPT                                              S01486
     C***********          MOVELISCY      ZISCY                           S01486
     C***********          Z-ADDMTHN      ZMTHN                           S01486
     C***********          Z-ADDYRNO      ZYRNO                           S01486
     C***********          MOVELPCAL      ZPCAL                           S01486
     C***********          Z-ADDSTRP      ZSTRP                           S01486
     C***********          EXSR ZFFFLN                                    S01486
     C***********          MOVELZLIN      DDNAR2                          S01486
     C***********                                                         S01486
     C***ACCESS*PF/PMTRSFXX - PORTFOLIO TRANSFER DETAILS USING            S01486
     C***CUSTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT, TRANSACTION    S01486
     C***NUMBER*FROM LF/TRANSPT AND MODULE ID = 'FF' AS KEY               S01486
     C***(ALL*OTHER KEY FIELDS BLANK OR ZERO AS APPROPRIATE)              S01486
     C***********          MOVEL'FF'      WWMODI                          S01486
     C***********          Z-ADDTNBR      WWTRNB                          S01486
     C***********          MOVEL*BLANKS   WWSESN                          S01486
     C***********          MOVEL*BLANKS   WWCCY                           S01486
     C***********          Z-ADD0         WWACOD                          S01486
     C***********          Z-ADD0         WWACSQ                          S01486
     C***********          MOVEL'T'       WWPOTI                          S01486
     C***********KKPMTR    CHAINPMTRSFXX             72                   S01486
     C************IN72     IFEQ '0'                                       S01486
     C***********                                                         S01486
     C***********P8TPTF    IFEQ '9997'                                    S01486
     C***********          MOVELP9R997    DDPTRS                          S01486
     C***********          MOVELP9R997    HHFPTF                          S01486
     C***********          ELSE                                           S01486
     C***********          MOVELP8TPTF    DDPTRS                          S01486
     C***********          MOVELP8TPTF    HHFPTF                          S01486
     C***********          END                                            S01486
     C***********          MOVELP8TNLU    HHTNLU                          S01486
     C***********          ELSE                                           S01486
     C***********          MOVEL*BLANKS   DDPTRS                          S01486
     C***********          MOVEL*BLANKS   HHFPTF                          S01486
     C***********          Z-ADD0         HHTNLU                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          EXSR ZWTR                                      S01486
     C***********          EXSR ZRAZ                                      S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********EP1008    ENDSR                                          S01486
     C*****************************************************************
      /EJECT                                                              S71062
     C*****************************************************************   S71062
     C** P1008  S/R TO LOAD FF TRANSACTIONS TO SUBFILE                    S71062
     C** CALLED FROM S/R P1003                                            S71062
     C** CALLS  S/R  =>  *PSSR                                            S71062
     C**             =>  ZEDIT                                            S71062
     C**             =>  ZFFFLN                                           S71062
     C**             =>  ZWTR                                             S71062
     C**             =>  ZRAZ                                             S71062
     C*****************************************************************   S71062
     C*                                                                   S71062
     C           P1008     BEGSR                           ** P1008  BSR**S71062
     C*                                                                   S71062
     C** ACCESS LF/TRANSPT - FF TRANSACTIONS BY PORTFOLIO REFERENCE       S71062
     C** USING CUSTOMER NUMBER AND PORTFOLIO REFERENCE INPUT AS KEY       S71062
     C           *IN78     DOWEQ'0'                                       S71062
     C           KKPM      READETRANSPT                  78               S71062
     C           *IN78     IFEQ '0'                                       S71062
     C*                                                                   S71062
     C** MOVE 'FF' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD      S71062
     C                     MOVE ' FF  '   DDMODI                          S71062
     C*                                                                   S71062
     C** MOVEL 'T' IN "HHPOTI" HIDDEN FIELD                               S71062
     C                     MOVEL'T'       HHPOTI                          S71062
     C*                                                                   S71062
     C** ACCESS LF/INTYP - FF INSTRUMENT TYPES USING INSTRUMENT TYPE      S71062
     C** FROM LF/TRANSPT AS KEY                                           S71062
     C           ISTT      CHAININTYP                72                   S71062
     C           *IN72     IFEQ '1'                                       S71062
     C** ERROR                                             ***************S71062
     C           *LOCK     IN   LDA                        ***************S71062
     C                     Z-ADD5         DBASE            **DB ERROR 05**S71062
     C                     MOVEL'INTYP   'DBFILE           ***************S71062
     C                     MOVELISTT      DBKEY                           S71062
     C                     OUT  LDA                                       S71062
     C                     EXSR *PSSR                                     S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** MOVE INSTRUMENT NAME  FROM LF/INTYP TO NARRATIVE 1               S71062
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD                             S71062
     C                     MOVELISTN      DDNAR1                          S71062
     C*                                                                   S71062
     C** MOVE TRANSACTION NUMBER FROM LF/TRANSPT TO REFERENCE 1           S71062
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD                             S71062
     C                     MOVELTNBR      DDREF1                          S71062
     C*                                                                   S71062
     C** MOVE INSTRUMENT CURRENCY FROM LF/TRANSPT TO CURRENCY 1           S71062
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD                             S71062
     C                     MOVELISCY      DDCCY1                          S71062
     C*                                                                   S71062
     C** EDIT NUMBER OF CONTRACTS FOR OUTPUT TO SUBFILE RECORD            S71062
     C** (USE STANDARD ZEDIT WITH ZFIELD=NUMBER OF CONTRACTS (NUCO)       S71062
     C** FROM LF/TRANSPT AND ZADEC=0)                                     S71062
     C                     MOVE *BLANKS   ZFIELD                          S71062
     C                     MOVE NUCO      ZFIELD                          S71062
     C                     Z-ADD0         ZADEC                           S71062
     C           16        SUB  ZADEC     ZADIG                           S71062
     C                     EXSR ZEDIT                                     S71062
     C                     MOVE ZFIELD    WW05    5                       S71062
     C                     MOVE *BLANKS   WW15                            S71062
     C                     MOVE WW05      WW15                            S71062
     C*                                                                   S71062
     C** MOVE LEFT EDITED NUMBER OF CONT. TO NOMINAL AMOUNT 1 ON SUBFILE  S71062
     C                     MOVELWW15      DDNOM1                          S71062
     C*                                                                   S71062
     C** MOVE LEFT TRANSACTION TYPE FROM LF/TRANSPT TO INDICATOR 1        S71062
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD (WILL BE EITHER 'P' OR      S71062
     C** 'S')                                                             S71062
     C                     MOVE *BLANKS   DDIND1                          S71062
     C                     MOVE *BLANKS   DDIND2                          S71062
     C                     MOVE TRTY      DDIND1                          S71062
     C*                                                                   S71062
     C** EXECUTE STANDARD SR/ZFFFLN - FORMAT FF LINE DESCRIPTION          S71062
     C** WITH ZISCY=INSTRUMENT CURRENCY, ZMTHN=MONTH NUMBER,              S71062
     C** ZYRNO=YEAR NUMBER, ZPCAL=PUT/CALL AND ZSTRP=STRIKE PRICE,        S71062
     C** ALL FROM LF/TRANSPT                                              S71062
     C                     MOVELISCY      ZISCY                           S71062
     C                     Z-ADDMTHN      ZMTHN                           S71062
     C                     Z-ADDYRNO      ZYRNO                           S71062
     C                     MOVELPCAL      ZPCAL                           S71062
     C                     Z-ADDSTRP      ZSTRP                           S71062
     C                     EXSR ZFFFLN                                    S71062
     C                     MOVELZLIN      DDNAR2                          S71062
     C*                                                                   S71062
     C** ACCESS PF/PMTRSFXX - PORTFOLIO TRANSFER DETAILS USING            S71062
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT, TRANSACTION    S71062
     C** NUMBER FROM LF/TRANSPT AND MODULE ID = 'FF' AS KEY               S71062
     C** (ALL OTHER KEY FIELDS BLANK OR ZERO AS APPROPRIATE)              S71062
     C                     MOVEL'FF'      WWMODI                          S71062
     C**********           Z-ADDTNBR      WWTRNB                                       S71062 CLE148
     C                     MOVE TNBR      WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWSESN                          S71062
     C                     MOVEL*BLANKS   WWCCY                           S71062
     C                     Z-ADD0         WWACOD                          S71062
     C                     Z-ADD0         WWACSQ                          S71062
     C                     MOVEL*BLANKS   WWBRCA                          S71062
     C                     MOVEL'T'       WWPOTI                          S71062
     C           KKPMTR    CHAINPMTRSFXX             72                   S71062
     C           *IN72     IFEQ '0'                                       S71062
     C*                                                                   S71062
     C           P8TPTF    IFEQ '9997'                                    S71062
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVELFCR997    DDPTRS                          S71062
     C                     MOVELFCR997    HHFPTF                          S71062
     C                     ELSE                                           S71062
     C                     MOVELP8TPTF    DDPTRS                          S71062
     C                     MOVELP8TPTF    HHFPTF                          S71062
     C                     END                                            S71062
     C                     MOVELP8TNLU    HHTNLU                          S71062
     C                     ELSE                                           S71062
     C                     MOVEL*BLANKS   DDPTRS                          S71062
     C                     MOVEL*BLANKS   HHFPTF                          S71062
     C                     Z-ADD0         HHTNLU                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C                     EXSR ZWTR                                      S71062
     C                     EXSR ZRAZ                                      S71062
     C                     END                                            S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C           EP1008    ENDSR                                          S71062
     C*****************************************************************   S71062
      /EJECT
     C*****************************************************************
     C** P1009  S/R TO LOAD DL DEALS TO SUBFILE
     C** CALLED FROM S/R P1003
     C** CALLS  S/R  =>  *PSSR
     C**             =>  P1012
     C**             =>  P1013
     C**             =>  P1014
     C**             =>  ZWTR
     C**             =>  ZRAZ
     C*****************************************************************
     C*
     C           P1009     BEGSR                           ** P1009  BSR**
     C*
     C***ACCESS*LF/DEALSPT*-*DL*DEALS BY PORTFOLIO REFERENCE USING        S01486
     C** ACCESS LF/PMDEALL0 - DL DEALS BY PORTFOLIO REFERENCE USING       S01486
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE INPUT AS KEY
     C           *IN79     DOWEQ'0'
     C*
     C** INITIALISE FILE INDICATORS
     C***********          MOVE '0'       *IN01                           CPM004
     C***********          MOVE '0'       *IN02                           CPM004
     C                     MOVE '0'       *IN03
     C***********KKPM      READEDEALSPT                  79               S01486
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           WBRCA     READECUSDB                    79               CPM004
     C                     ELSE                                           CPM004
     C           KKPM      READEPMDEALL0                 79               S01486
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C** If Bank Portfolio not supported, process every record read       CPM004
     C** If Bank Portfolio is supported, only process live records        CPM004
     C** with input portfolio reference as input LF does not              CPM004
     C** include these fields as keys                                     CPM004
     C           *IN79     IFEQ '0'
     C           FCPORS    ANDNE'B'                                       CPM004
     C           *IN79     OREQ *OFF                                      CPM004
     C           FCPORS    ANDEQ'B'                                       CPM004
     C           PTFR      ANDEQDDFPTF                                    CPM004
     C           RECI      ANDEQ'D'                                       CPM004
     C*
     C** MOVE 'DL' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD
     C*********************MOVE 'DL'      DDMODI                          B8108
     C                     MOVE 'DL   '   DDMODI                          B8108
     C           RECI      IFNE 'D'                                       B8108
     C                     MOVE 'MATURED' DDMOD2                          B8108
     C                     ELSE                                           B8108
     C                     MOVE *BLANKS   DDMOD2                          B8108
     C                     END                                            B8108
     C*
     C** MOVEL 'T' IN "HHPOTI" HIDDEN FIELD
     C                     MOVEL'T'       HHPOTI
     C*
     C***ACCESS*PF/SDDTSTPP*- DEAL TYPES/SUB-TYPES USING DEAL TYPE        S01486
     C** ACCESS PF/FDDTSTL1 - DEAL TYPES/SUB-TYPES USING DEAL TYPE        S01486
     C***AND*DEAL*SUB-TYPE*FROM LF/DEALSPT AS KEY                         S01486
     C** AND DEAL SUB-TYPE FROM LF/PMDEALL0 AS KEY                        S01486
     C***********KKPMDL    CHAINSDDTSTPP             72                   S01486
     C           KKPMDL    CHAINFDDTSTL1             72                   S01486
     C           *IN72     IFEQ '1'                                       S01486
     C*
     C** ERROR
     C           *LOCK     IN   LDA                        ***************S01486
     C                     Z-ADD6         DBASE            **DB ERROR 06**
     C***********          MOVEL'SDDTSTPP'DBFILE           ***************S01486
     C                     MOVEL'FDDTSTL1'DBFILE           ***************S01486
     C                     MOVELDTYP      DBKEY
     C                     MOVE DLST      DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C***MOVE*DEAL*TYPE NARRATIVE FROM PF/SDDTSTPP TO NARRATIVE 1         S01486
     C** MOVE DEAL TYPE NARRATIVE FROM PF/FDDTSTL1 TO NARRATIVE 1         S01486
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C** If Bank Portfolio is supported, include transaction              CPM004
     C** customer in the narrative.                                       CPM004
     C************IN01     IFEQ '1'                                R10038 CPM004
     C***********          MOVELP7DTNR    WWWK16 16                R10038 S01486
     C*                                                                   CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
     C*                                                                   CPM004
     C           RCDT      IFEQ 'B'                                       CPM004
     C                     MOVELNARR11    WWWK16 16                       S01486
     C                     MOVE *BLANKS   DDNAR1                          R10038
     C                     MOVELPUCY      DDNAR1                          R10038
     C                     MOVE WWWK16    DDNAR1                          R10038
     C                     ELSE                                           R10038
     C***********          MOVELP7DTNR    DDNAR1                          S01486
     C                     MOVELNARR11    DDNAR1                          S01486
     C                     END                                            R10038
     C*                                                                   CPM004
     C                     ELSE                                           CPM004
     C*                                                                   CPM004
     C           RCDT      IFEQ 'B'                                       CPM004
     C                     MOVELPUCY      WWWK16    P                     CPM004
     C                     MOVE WWDTST    WWWK16                          CPM004
     C                     MOVELWWWK16    DDNAR1    P                     CPM004
     C                     ELSE                                           CPM004
     C                     MOVELWWDTST    DDNAR1    P                     CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*
     C***MOVE*DEAL*NUMBER FROM LF/DEALSPT TO REFERENCE 1                  S01486
     C** MOVE DEAL NUMBER FROM LF/PMDEALL0 TO REFERENCE 1                 S01486
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELDLNO      DDREF1
     C*
     C***IF*RECORD*HAS*BEEN*READ*FROM*DEALSDBF*FORMAT*=>**IN01*=*'1'      CPM004
     C** IF RECORD HAS BEEN READ FROM DEALSDBF FORMAT => RCDT = 'B'       CPM004
     C** LOAD FX DEALS TO SUBFILE
     C************IN01     IFEQ '1'                                       CPM004
     C           RCDT      IFEQ 'B'                                       CPM004
     C                     EXSR P1012
     C                     END
     C*
     C***IF*RECORD*HAS*BEEN*READ*FROM*DEALSDCF*FORMAT*=>**IN02*=*'1'      CPM004
     C** IF RECORD HAS BEEN READ FROM DEALSDCF FORMAT =>  RCDT = 'C'      CPM004
     C** LOAD MM DEALS TO SUBFILE
     C************IN02     IFEQ '1'                                       CPM004
     C           RCDT      IFEQ 'C'                                       CPM004
     C                     EXSR P1013                                     4
     C                     END
     C****                                                                58933
     C****F RECORD HAS BEEN READ FROM DEALSDGF FORMAT => *IN03 = '1'      58933
     C****OAD FRA/IRS DEALS TO SUBFILE                                    58933
     C****       *IN03     IFEQ '1'                                       58933
     C****                 EXSR P1014                                     58933
     C****                 END                                            58933
     C*                                                                   CPM004
     C** If Bank Portfolio is supported, save transaction customer        CPM004
     C** for later update                                                 CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C**********           Z-ADDCNUM      HHACUS                                       CPM004 CSD027
     C                     MOVE CNUM      HHACUS                                              CSD027
     C                     ENDIF                                          CPM004
     C*
     C** ACCESS PF/PMTRSFXX - PORTFOLIO TRANSFER DETAILS USING
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT, TRANSACTION
     C***NUMBER=DEAL*NUMBER*FROM LF/DEALSPT AND MODULE ID = 'DL' AS KEY   S01486
     C** NUMBER=DEAL NUMBER FROM LF/PMDEALL0 AND MODULE ID = 'DL' AS KEY  S01486
     C** (ALL OTHER KEY FIELDS BLANK OR ZERO AS APPROPRIATE)
     C                     MOVEL'DL'      WWMODI
     C**********           Z-ADDDLNO      WWTRNB                                              CLE148
     C                     MOVE DLNO      WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWSESN
     C                     MOVEL*BLANKS   WWCCY
     C                     Z-ADD0         WWACOD
     C                     Z-ADD0         WWACSQ
     C                     MOVEL*BLANKS   WWBRCA                          095249
     C                     MOVEL'T'       WWPOTI
     C           KKPMTR    CHAINPMTRSFXX             72
     C           *IN72     IFEQ '0'
     C*
     C           P8TPTF    IFEQ '9997'
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C***********          MOVELP9R997    DDPTRS                          S01486
     C***********          MOVELP9R997    HHFPTF                          S01486
     C                     MOVELFCR997    DDPTRS                          S01486
     C                     MOVELFCR997    HHFPTF                          S01486
     C                     ELSE
     C                     MOVELP8TPTF    DDPTRS
     C                     MOVELP8TPTF    HHFPTF
     C                     END
     C                     MOVELP8TNLU    HHTNLU
     C                     ELSE
     C                     MOVEL*BLANKS   DDPTRS
     C                     MOVEL*BLANKS   HHFPTF
     C                     Z-ADD0         HHTNLU
     C                     END
     C*
     C                     EXSR ZWTR
     C                     EXSR ZRAZ
     C                     END
     C                     END
     C*
     C           EP1009    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P1010  S/R TO LOAD LE LOANS TO SUBFILE
     C** CALLED FROM S/R P1003
     C** CALLS  S/R  =>  *PSSR
     C**             =>  ZEDIT
     C**             =>  ZFLELN
     C**             =>  ZWTR
     C**             =>  ZRAZ
     C*****************************************************************
     C*
     C           P1010     BEGSR                           ** P1010  BSR**
     C*
     C***ACCESS*LF/CLOANPT*- LE LOANS BY PORTFOLIO REFERENCE USING        S01486
     C** ACCESS LF/PMCLONL1 - LE LOANS BY PORTFOLIO REFERENCE USING       S01486
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE INPUT AS KEY
     C           *IN80     DOWEQ'0'
     C***********KKPM      READECLOANPT                  80               S01486
     C*  If Bank Portfolio is supported, use CLOANB  instead              CPM004
     C*  to access LE transactions by branch internal customer            CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           WBRCA     READECLOANB                   80               CPM004
     C                     ELSE                                           CPM004
     C           KKPM      READEPMCLONL1                 80               S01486
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C** If Bank Portfolio not supported, process every record read.      CPM004
     C** If Bank Portfolio is supported, only process live records        CPM004
     C** with input portfolio reference as input LF does not              CPM004
     C** include fields as keys                                           CPM004
     C           *IN80     IFEQ '0'
     C           FCPORS    ANDNE'B'                                       CPM004
     C           *IN80     OREQ *OFF                                      CPM004
     C           FCPORS    ANDEQ'B'                                       CPM004
     C           PTFR      ANDEQDDFPTF                                    CPM004
     C           RECI      ANDEQ'D'                                       CPM004
     C           RCDT      ANDEQ'A'                                       CPM004
     C*
     C** MOVE 'LE' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD
     C*********************MOVE 'LE'      DDMODI                          B8108
     C                     MOVE ' LE  '   DDMODI                          B8108
     C           RECI      IFNE 'D'                                       B8108
     C                     MOVE 'MATURED' DDMOD2                          B8108
     C                     ELSE                                           B8108
     C                     MOVE *BLANKS   DDMOD2                          B8108
     C                     END                                            B8108
     C*
     C** MOVEL 'T' IN "HHPOTI" HIDDEN FIELD
     C                     MOVEL'T'       HHPOTI
     C*
     C** ACCESS LF/SDLOANL1- SD CUSTOMER LENDING LOAN TYPE/SUB-TYPE
     C***TABLE*USING*LOAN*TYPE AND LOAN SUB-TYPE FROM LF/CLOANPT AS KEY   S01486
     C** TABLE USING LOAN TYPE AND LOAN SUB-TYPE FROM LF/PMCLONL1 AS KEY  S01486
     C                     MOVELLTYP      DTYP
     C                     MOVELSUTP      DLST
     C***********KKPMDL    CHAINSDLOANL1             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C                     CALL 'AOLOANR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM LTYP      WWLTYP  2                       S01486
     C                     PARM SUTP      WWSUTP  2                       S01486
     C                     PARM CLAS      WWCLAS  4                                           CLE042
     C           SDLOAN    PARM SDLOAN    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C*
     C** ERROR
     C                     Z-ADD7         DBASE            **DB ERROR 07**
     C***********          MOVEL'SDLOANL1'DBFILE           ***************S01486
     C                     MOVE 'SDLOANPD'DBFILE           ***************S01486
     C                     MOVELDTYP      DBKEY
     C                     CAT  DLST:1    DBKEY                                               CLE042
     C                     CAT  CLAS:1    DBKEY                                               CLE042
     C*********************MOVE DLST      DBKEY                                               CLE042
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C** MOVE LEFT NARRATIVE FROM LF/SDLOANL1 TO NARRATIVE 1
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C** If Bank Portfolio is supported, include transaction customer     CPM004
     C** in the narrative as well.                                        CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
     C                     MOVELAYLNTD    DDNAR1
     C                     ELSE                                           CPM004
     C                     MOVELAYLNTY    WLNTY                           CPM004
     C                     MOVELAYLNST    WLNST                           CPM004
     C                     MOVELCNUM      WCNUM                           CPM004
     C                     MOVELWWLTST    DDNAR1    P                     CPM004
     C                     ENDIF                                          CPM004
     C*
     C***MOVE*LOAN*NUMBER*FROM LF/CLOANPT TO REFERENCE 1                  S01486
     C** MOVE LOAN NUMBER FROM LF/PMCLONL1 TO REFERENCE 1                 S01486
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELLNRF      DDREF1
     C*
     C***MOVE*CURRENCY*CODE*FROM*LF/CLOANPT TO CURRENCY 1                 S01486
     C** MOVE CURRENCY CODE FROM LF/PMCLONL1 TO CURRENCY 1                S01486
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELCCY       DDCCY1
     C*
     C***IF*CURRENT*PRINCIPAL*AMOUNT FROM LF/CLOANPT IS POSITIVE,         S01486
     C** IF CURRENT PRINCIPAL AMOUNT FROM LF/PMCLONL1 IS POSITIVE         S01486
     C** MOVE '-' TO NOMINAL AMOUNT 1 ON ON PORTFOLIO TRANSFER
     C** SUBFILE RECORD
     C                     MOVEL*BLANKS   WW16
     C           CPAM      IFLT 0
     C                     MOVE '-'       WW16
     C                     END
     C*
     C***IF*CURRENT*PRINCIPAL*AMOUNT FROM LF/CLOANPT IS NEGATIVE,         S01486
     C** IF CURRENT PRINCIPAL AMOUNT FROM LF/PMCLONL1 IS NEGATIVE         S01486
     C** REVERSE THE SIGN OF CURRENT PRINCIPAL AMOUNT BEFORE INPUT
     C** TO STANDARD SR/ZEDIT
     C           CPAM      IFLT 0
     C           CPAM      MULT -1        CPAM
     C                     END
     C*
     C** EDIT AMOUNT FOR OUTPUT TO SUBFILE RECORD (USE STANDARD
     C***SR.*ZEDIT*WITH*ZFIELD= AMOUNT FROM LF/CLOANPT                    S01486
     C** SR. ZEDIT WITH ZFIELD= AMOUNT FROM LF/PMCLONL1                   S01486
     C** AND ZADEC= CURRENCY DECIMAL PLACES FOR CURRENCY CODE FROM
     C***PF/TABTG10)                                                      S01486
     C***********CCY       CHAINSDCURRL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM CCY       WWKEY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD0         A6NBDP
     C                     END
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CPAM      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C           16        SUB  ZADEC     ZADIG
     C                     EXSR ZEDIT
     C                     MOVE *BLANKS   WW15
     C                     MOVE ZFIELD    WW15
     C*
     C** MOVE LEFT EDITED CURRENT PRINCIPAL AMOUNT TO NOMINAL
     C** AMOUNT 1 ON PORTFOLIO TRANSFER SUBFILE
     C                     MOVELWW15      WW16
     C                     MOVELWW16      DDNOM1
     C*
     C** EXECUTE STANDARD SR/ZFLELN - FORMAT LE LINE DESCRIPTION
     C** WITH ZCCY=LOAN CURRENCY, ZINRT=INTEREST RATE AND
     C***ZMDAT=MATURITY*DATE,*ALL FROM LF/CLOANPT                         S01486
     C** ZMDAT=MATURITY DATE, ALL FROM LF/PMCLONL1                        S01486
     C                     MOVELCCY       ZCCY
     C                     Z-ADDINTR      ZINRT
     C                     Z-ADDMDAT      ZMDAT
     C                     EXSR ZFLELN
     C                     MOVELZLIN      DDNAR2
     C*                                                                   CPM004
     C** If Bank Portfolio is supported, save transaction customer        CPM004
     C** for later update                                                 CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C**********           Z-ADDCNUM      HHACUS                                       CPM004 CSD027
     C                     MOVE CNUM      HHACUS                                              CSD027
     C                     ENDIF                                          CPM004
     C*
     C** ACCESS PF/PMTRSFXX - PORTFOLIO TRANSFER DETAILS USING
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT, TRANSACTION
     C***NUMBER=LOAN*NUMBER*FROM LF/CLOANPT AND MODULE ID = 'LE' AS KEY   S01486
     C** NUMBER=LOAN NUMBER FROM LF/PMCLONL1 AND MODULE ID = 'LE' AS KEY  S01486
     C** (ALL OTHER KEY FIELDS BLANK OR ZERO AS APPROPRIATE)
     C                     MOVEL'LE'      WWMODI
     C**********           Z-ADDLNRF      WWTRNB                                              CLE148
     C                     MOVE LNRF      WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWSESN
     C                     MOVEL*BLANKS   WWCCY
     C                     Z-ADD0         WWACOD
     C                     Z-ADD0         WWACSQ
     C                     MOVEL*BLANKS   WWBRCA                          095249
     C                     MOVEL'T'       WWPOTI
     C           KKPMTR    CHAINPMTRSFXX             72
     C           *IN72     IFEQ '0'
     C*
     C           P8TPTF    IFEQ '9997'
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C***********          MOVELP9R997    DDPTRS                          S01486
     C***********          MOVELP9R997    HHFPTF                          S01486
     C                     MOVELFCR997    DDPTRS                          S01486
     C                     MOVELFCR997    HHFPTF                          S01486
     C                     ELSE
     C                     MOVELP8TPTF    DDPTRS
     C                     MOVELP8TPTF    HHFPTF
     C                     END
     C                     MOVELP8TNLU    HHTNLU
     C                     ELSE
     C                     MOVEL*BLANKS   DDPTRS
     C                     MOVEL*BLANKS   HHFPTF
     C                     Z-ADD0         HHTNLU
     C                     END
     C*
     C                     EXSR ZWTR
     C                     EXSR ZRAZ
     C                     END
     C                     END
     C*
     C           EP1010    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P1011  S/R TO LOAD RE ACCOUNTS TO SUBFILE
     C** CALLED FROM S/R P1003
     C** CALLS  S/R  =>  *PSSR
     C**             =>  ZEDIT
     C**             =>  ZFRELN
     C**             =>  ZWTR
     C**             =>  ZRAZ
     C*****************************************************************
     C*
     C           P1011     BEGSR                           ** P1011  BSR**
     C*
     C***ACCESS*LF/ACCNTPT*- RE ACCOUNTS BY PORTFOLIO REFERENCE USING     S01486
     C** ACCESS LF/PMACCNL1 - RE ACCOUNTS BY PORTFOLIO REFERENCE USING    S01486
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE INPUT AS KEY
     C           *IN81     DOWEQ'0'
     C***********KKPM      READEACCNTPT                  81               S01486
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           WBRCA     READEACCBR                    81               CPM004
     C                     ELSE                                           CPM004
     C           KKPM      READEPMACCNL1                 81               S01486
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C** If Bank Portfolio not supported, process every record read       CPM004
     C** If Bank Portfolio is supported, only process live records        CPM004
     C** with defined portfolio reference as input LF does not            CPM004
     C** include fields as keys                                           CPM004
     C           *IN81     IFEQ '0'
     C           FCPORS    ANDNE'B'                                       CPM004
     C           *IN81     OREQ *OFF                                      CPM004
     C           FCPORS    ANDEQ'B'                                       CPM004
     C           PTFR      ANDEQDDFPTF                                    CPM004
     C           RECI      ANDEQ'D'                                       CPM004
     C*
     C** MOVE 'RE' TO MODULE ID ON PORTFOLIO TRANSFER SUBFILE RECORD      CPM004
     C** If Bank Portfolio is supported, move 'GL'instead.                CPM004
     C*                                                                   CPM004
     C*********************MOVE 'RE'      DDMODI                          B8108
     C           FCPORS    IFNE 'B'                                       CPM004
     C                     MOVE ' RE  '   DDMODI                    B8108 CPM004
     C                     ELSE                                           CPM004
     C                     MOVE ' GL  '   DDMODI                          CPM004
     C                     ENDIF                                          CPM004
     C           RECI      IFNE 'D'                                       B8108
     C                     MOVE 'CLOSED ' DDMOD2                          B8108
     C                     ELSE                                           B8108
     C                     MOVE *BLANKS   DDMOD2                          B8108
     C                     END                                            B8108
     C*
     C** MOVEL 'T' IN "HHPOTI" HIDDEN FIELD
     C                     MOVEL'T'       HHPOTI
     C*
     C***MOVE*LEFT*ACCOUNT*CODE NAME FROM LF/ACCNTPT TO NARRATIVE 1       S01486
     C** MOVE LEFT ACCOUNT CODE NAME FROM LF/PMACCNL1 TO NARRATIVE 1      S01486
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELANAM      DDNAR1
     C*
     C***MOVE*CURRENCY*CODE*FROM LF/ACCNTPT TO CURRENCY 1                 S01486
     C** MOVE CURRENCY CODE FROM LF/PMACCNL1 TO CURRENCY 1                S01486
     C** ON PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELCCY       DDCCY1
     C*
     C***IF*LEDGER*BALANCE*FROM LF/ACCNTPT IS NEGATIVE, MOVE '-' TO       S01486
     C** IF LEDGER BALANCE FROM LF/PMACCNL1 IS NEGATIVE, MOVE '-' TO      S01486
     C** NOMINAL AMOUNT 1 ON PORTFOLIO TRANSFER SUBFILE RECORD AND
     C** REVERSE THE SIGN OF LEDGER BALANCE BEFORE INPUT
     C** TO STANDARD SR/ZEDIT
     C                     MOVEL*BLANKS   WW16
     C           LDBL      IFLT 0
     C                     MOVE 'CR'      DDIND1
     C           LDBL      MULT -1        LDBL
     C                     ELSE
     C                     MOVE 'DR'      DDIND1
     C                     END
     C*
     C** EDIT LEDGER BAL. FOR OUTPUT TO SUBFILE RECORD (USE STANDARD
     C***SR.*ZEDIT*WITH*ZFIELD= LEDGER BALANCE FROM LF/ACCNTPT            S01486
     C** SR. ZEDIT WITH ZFIELD= LEDGER BALANCE FROM LF/PMACCNL1           S01486
     C** AND ZADEC= CURRENCY DECIMAL PLACES FOR CURRENCY CODE FROM
     C** PF/TABTG10)
     C***********CCY       CHAINSDCURRL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM CCY       WWKEY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD0         A6NBDP
     C                     END
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE LDBL      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C           16        SUB  ZADEC     ZADIG
     C                     EXSR ZEDIT
     C                     MOVE *BLANKS   WW14   14
     C                     MOVE ZFIELD    WW14
     C*
     C** MOVE LEFT EDITED LEDGER BALANCE AMOUNT TO NOMINAL
     C** AMOUNT 1 ON PORTFOLIO TRANSFER SUBFILE
     C                     MOVELWW14      WW16
     C                     MOVELWW16      DDNOM1
     C*
     C** EXECUTE STANDARD SR/ZFRELN - FORMAT RE LINE DESCRIPTION
     C** WITH ZCNUM=CUSTOMER NUMBER, ZCCY=CURRENCY CODE, ZACOD=ACCOUNT
     C***CODE*AND*ZACSQ=ACCOUNT*SEQUENCE, ALL FROM LF/ACCNTPT             S01486
     C** CODE AND ZACSQ=ACCOUNT SEQUENCE, ALL FROM LF/PMACCNL1            S01486
     C                     MOVELCNUM      ZCNUM
     C                     MOVELCCY       ZCCY
     C                     Z-ADDACOD      ZACOD
     C                     Z-ADDACSQ      ZACSQ
     C                     MOVELBRCA      ZBRCA   3                       085862
     C                     EXSR ZFRELN
     C                     MOVELZLIN      DDNAR2
     C*
     C***IF*CLEARED*BALANCE*FROM LF/ACCNTPT IS NEGATIVE, MOVE '-' TO      S01486
     C** IF CLEARED BALANCE FROM LF/PMACCNL1 IS NEGATIVE, MOVE '-' TO     S01486
     C** NOMINAL AMOUNT 2 ON PORTFOLIO TRANSFER SUBFILE RECORD AND
     C** REVERSE THE SIGN OF CLEARED BALANCE BEFORE INPUT
     C** TO STANDARD SR/ZEDIT
     C                     MOVEL*BLANKS   WW16
     C           CLBL      IFLT 0
     C                     MOVE 'CR'      DDIND2
     C           CLBL      MULT -1        CLBL
     C                     ELSE
     C                     MOVE 'DR'      DDIND2
     C                     END
     C*
     C** EDIT CLEARED BAL. FOR OUTPUT TO SUBFILE RECORD (USE STANDARD
     C***SR.*ZEDIT*WITH*ZFIELD= CLEARED BALANCE FROM LF/ACCNTPT           S01486
     C** SR. ZEDIT WITH ZFIELD= CLEARED BALANCE FROM LF/PMACCNL1          S01486
     C** AND ZADEC= CURRENCY DECIMAL PLACES FOR CURRENCY CODE FROM
     C** PF/TABTG10)
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CLBL      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C           16        SUB  ZADEC     ZADIG
     C                     EXSR ZEDIT
     C                     MOVE *BLANKS   WW14
     C                     MOVE ZFIELD    WW14
     C*
     C** MOVE LEFT EDITED CLEARED BALANCE AMOUNT TO NOMINAL
     C** AMOUNT 2 ON PORTFOLIO TRANSFER SUBFILE
     C                     MOVELWW14      WW16
     C                     MOVELWW16      DDNOM2
     C*
     C** ACCESS PF/PMTRSFXX - PORTFOLIO TRANSFER DETAILS USING
     C** CUSTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT, CURRENCY
     C** CODE, ACCOUNT CODE AND ACCOUNT SEQUENCE, ALL FROM
     C***LF/ACCNTPT*AND*MODULE ID = 'RE' AS KEY                           S01486
     C** LF/PMACCNL1 AND MODULE ID = 'RE' AS KEY                          S01486
     C** (Module ID = 'GL' if Bank Portfolio is supported)                CPM004
     C** (ALL OTHER KEY FIELDS BLANK OR ZERO AS APPROPRIATE)
     C           FCPORS    IFNE 'B'                                       CPM004
     C                     MOVEL'RE'      WWMODI
     C                     ELSE                                           CPM004
     C                     MOVEL'GL'      WWMODI                          CPM004
     C                     ENDIF                                          CPM004
     C                     MOVEL*BLANKS   WWCCY
     C                     MOVELCCY       WWCCY
     C                     Z-ADDACOD      WWACOD
     C                     Z-ADDACSQ      WWACSQ
     C                     MOVELBRCA      WWBRCA                          095249
     C**********           Z-ADD*ZERO     WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWSESN
     C                     MOVEL'T'       WWPOTI
     C           KKPMTR    CHAINPMTRSFXX             72
     C           *IN72     IFEQ '0'
     C*
     C           P8TPTF    IFEQ '9997'
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C***********          MOVELP9R997    DDPTRS                          S01486
     C***********          MOVELP9R997    HHFPTF                          S01486
     C                     MOVELFCR997    DDPTRS                          S01486
     C                     MOVELFCR997    HHFPTF                          S01486
     C                     ELSE
     C                     MOVELP8TPTF    DDPTRS
     C                     MOVELP8TPTF    HHFPTF
     C                     END
     C                     MOVELP8TNLU    HHTNLU
     C                     ELSE
     C                     MOVEL*BLANKS   DDPTRS
     C                     MOVEL*BLANKS   HHFPTF
     C                     Z-ADD0         HHTNLU
     C                     END
     C*
     C                     EXSR ZWTR
     C                     EXSR ZRAZ
     C                     END
     C                     END
     C*
     C           EP1011    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P1012  S/R TO LOAD FX DEALS TO SUBFILE
     C** CALLED FROM S/R P1009
     C** CALLS  S/R  =>  ZEDIT
     C**             =>  ZFDLLN
     C*****************************************************************
     C*
     C           P1012     BEGSR                           ** P1012  BSR**
     C*
     C*  NOTE: FX TXNS ARE THE 'WRONG WAY AROUND' BECAUSE THEY ARE FROM
     C*        THE CLIENT'S POINT OF VIEW (UNLIKE THE REST OF MIDAS)
     C*
     C** MOVE '(FX)' IN DDMOD2
     C*********************MOVEL'(FX)'    DDMOD2                          B8108
     C                     MOVE '/FX'     DDMODI                          B8108
     C*
     C** MOVE SELL CURRENCY FROM PF/DEALSDB TO CURRENCY 1 ON
     C** PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELPUCY      DDCCY1
     C*
     C** EDIT SELL AMOUNT FOR OUTPUT TO SUBFILE RECORD (USE STANDARD
     C** SR. ZEDIT WITH ZFIELD= SELL AMOUNT FROM PF/DEALSDB
     C** AND ZADEC= CURRENCY DECIMAL PLACES FOR SELL CURRENCY FROM
     C** PF/SDCURRPD)
     C***********PUCY      CHAINSDCURRL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM PUCY      WWKEY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD0         A6NBDP
     C                     END
     C                     MOVE *BLANKS   ZFIELD
     C*********************MOVE SLAM      ZFIELD                          R10038
     C                     MOVE PUAM      ZFIELD                          R10038
     C                     Z-ADDA6NBDP    ZADEC
     C           16        SUB  ZADEC     ZADIG
     C                     EXSR ZEDIT
     C                     MOVE *BLANKS   WW15
     C                     MOVE ZFIELD    WW15
     C*
     C** MOVE LEFT EDITED SELL AMOUNT TO NOMINAL
     C** AMOUNT 1 ON PORTFOLIO TRANSFER SUBFILE
     C                     MOVELWW15      DDNOM1
     C*
     C** MOVE 'B' (FOR BUY) TO INDICATOR 1 ON PORTFOLIO TRANSFER
     C** SUBFILE
     C                     MOVE 'B'       DDIND1
     C*
     C** EXECUTE STANDARD SR/ZFDLLN - FORMAT DL LINE DESCRIPTION
     C** WITH ZPUCY=PURCHASE CURRENCY, ZSLCY=SALE CURRENCY AND
     C** ZVDAT=VALUE DATE, ALL FROM PF/DEALSDB
     C*********************MOVELPUCY      ZPUCY                           R10038
     C                     MOVELSLCY      ZPUCY                           R10038
     C                     Z-ADDDDAT      ZDDAT   50                      R10038
     C*********************MOVELSLCY      ZSLCY                           R10038
     C                     Z-ADDVDAT      ZVDAT
     C                     EXSR ZFDLLN
     C                     MOVELZLIN      DDNAR2
     C*
     C** MOVE PURCHASE CURRENCY FROM PF/DEALSDB TO CURRENCY 2 ON
     C** PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELSLCY      DDCCY2
     C*
     C** EDIT PURCHASE AMOUNT FOR OUTPUT TO SUBFILE RECORD (USE STANDARD
     C** SR. ZEDIT WITH ZFIELD= PURCHASE AMOUNT FROM PF/DEALSDB
     C** AND ZADEC= CURRENCY DECIMAL PLACES FOR PURCHASE CURRENCY FROM
     C** PF/SDCURRPD)
     C***********SLCY      CHAINSDCURRL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM SLCY      WWKEY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD0         A6NBDP
     C                     END
     C                     MOVE *BLANKS   ZFIELD
     C*********************MOVE PUAM      ZFIELD                          R10038
     C                     MOVE SLAM      ZFIELD                          R10038
     C                     Z-ADDA6NBDP    ZADEC
     C           16        SUB  ZADEC     ZADIG
     C                     EXSR ZEDIT
     C                     MOVE *BLANKS   WW15
     C                     MOVE ZFIELD    WW15
     C*
     C** MOVE LEFT EDITED PURCHASE AMOUNT TO NOMINAL AMOUNT 2
     C** ON PORTFOLIO TRANSFER SUBFILE
     C                     MOVELWW15      DDNOM2
     C*
     C** MOVE 'S' (FOR SELL) TO INDICATOR 2 ON PORTFOLIO TRANSFER
     C** SUBFILE
     C                     MOVE 'S'       DDIND2
     C*
     C           EP1012    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P1013  S/R TO LOAD MM DEALS TO SUBFILE
     C** CALLED FROM S/R P1009
     C** CALLS  S/R  =>  ZEDIT
     C**             =>  ZFDLLN
     C*****************************************************************
     C*
     C           P1013     BEGSR                           ** P1013  BSR**
     C*
     C** MOVE '(MM)' IN DDMOD2
     C*********************MOVEL'(MM)'    DDMOD2                          B8108
     C                     MOVE '/MM'     DDMODI                          B8108
     C*
     C** MOVE CURRENCY CODE FROM PF/DEALSDC TO CURRENCY 1 ON
     C** PORTFOLIO TRANSFER SUBFILE RECORD
     C                     MOVELCCY       DDCCY1
     C*
     C                     MOVEL*BLANKS   WW16
     C*
     C** EDIT PRINCIPAL FOR OUTPUT TO SUBFILE RECORD (USE STANDARD
     C** SR. ZEDIT WITH ZFIELD=PRINCIPAL FROM PF/DEALSDC
     C** AND ZADEC= CURRENCY DECIMAL PLACES FOR CURRENCY CODE FROM
     C** PF/TABTG10)
     C***********CCY       CHAINSDCURRL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM CCY       WWKEY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD0         A6NBDP
     C                     END
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE PCPL      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C           16        SUB  ZADEC     ZADIG
     C                     EXSR ZEDIT
     C                     MOVE *BLANKS   WW15
     C                     MOVE ZFIELD    WW15
     C*
     C** MOVE LEFT EDITED PURCHASE AMOUNT TO NOMINAL
     C** AMOUNT 1 ON PORTFOLIO TRANSFER SUBFILE
     C                     MOVELWW15      DDNOM1
     C*
     C** EXECUTE STANDARD SR/ZFDLLN - FORMAT DL LINE DESCRIPTION
     C** WITH ZCCY=CURRENCY CODE, ZINRT=INTEREST RATE, ZMDAT=MATURITY
     C** DATE AND ZNOTD=NOTICE DAYS, ALL FROM PF/DEALSDC
     C                     MOVELCCY       ZCCY
     C                     Z-ADDINTR      ZINRT
     C                     Z-ADDMDAT      ZMDAT
     C                     Z-ADDNOTD      ZNOTD
     C                     EXSR ZFDLLN
     C                     MOVELZLIN      DDNAR2
     C*
     C           EP1013    ENDSR
     C*****************************************************************   58933
      *****T                                                              58933
     C*****************************************************************   58933
     C****1014  S/R TO LOAD FRA/IRS DEALS TO SUBFILE                      58933
     C****ALLED FROM S/R P1009                                            58933
     C****ALLS  S/R  =>  ZEDIT                                            58933
     C****           =>  ZFDLLN                                           58933
     C*****************************************************************   58933
     C****                                                                58933
     C****       P1014     BEGSR                           ** P1014  BSR**58933
     C****                                                                58933
     C****OVE CURRENCY CODE FROM PF/DEALSDG TO CURRENCY 1 ON              58933
     C****ORTFOLIO TRANSFER SUBFILE RECORD                                58933
     C****                 MOVELUCUCY     DDCCY1                          58933
     C****                                                                58933
     C****DIT AMOUNT FOR OUTPUT TO SUBFILE RECORD (USE STANDARD           58933
     C****R. ZEDIT WITH ZFIELD=AMOUNT FROM PF/DEALSDG                     58933
     C****ND ZADEC= CURRENCY DECIMAL PLACES FOR CURRENCY CODE FROM        58933
     C****F/TABTG10)                                                      58933
     C****       UCUCY     CHAINSDCURRL0             72                   58933
     C****       *IN72     IFEQ '1'                                       58933
     C****                 Z-ADD0         A6NBDP                          58933
     C****                 END                                            58933
     C****                 MOVE *BLANKS   ZFIELD                          58933
     C****                 MOVE UPAMT     ZFIELD                          58933
     C****                 Z-ADDA6NBDP    ZADEC                           58933
     C****       16        SUB  ZADEC     ZADIG                           58933
     C****                 EXSR ZEDIT                                     58933
     C****                 MOVE *BLANKS   WW15                            58933
     C****                 MOVE ZFIELD    WW15                            58933
     C****                                                                58933
     C****OVE LEFT EDITED AMOUNT TO NOMINAL AMOUNT 1                      58933
     C****N PORTFOLIO TRANSFER SUBFILE                                    58933
     C****                 MOVELWW15      DDNOM1                          58933
     C****                                                                58933
     C****F DEAL TYPE IS 'FR', 'RS' OR 'RL', EXECUTE STANDARD             58933
     C****R/ZFDLLN - FORMAT DL LINE DESCRIPTION WITH ZUCUCY=CURRENCY      58933
     C****ODE, ZUEINR=INTEREST RATE AND ZMDAT=MATURITY DATE, ALL          58933
     C****ROM PF/DEALSDG                                                  58933
     C****       DTYP      IFEQ 'FR'                                      58933
     C****       DTYP      OREQ 'RS'                                      58933
     C****       DTYP      OREQ 'RL'                                      58933
     C****                 MOVELUCUCY     ZUCUCY                          58933
     C****                 Z-ADDUEINR     ZUEINR                          58933
     C****                 Z-ADDMDAT      ZMDAT                           58933
     C****                 EXSR ZFDLLN                                    58933
     C****                 MOVELZLIN      DDNAR2                          58933
     C****                 END                                            58933
     C****                                                                58933
     C****F DEAL TYPE IS 'RX', EXECUTE STANDARD                           58933
     C****R/ZFDLLN - FORMAT DL LINE DESCRIPTION WITH ZUCUCY=CURRENCY      58933
     C****ODE, ZTCUCY=THEIR CURRENCY AND ZMDAT=MATURITY DATE, ALL         58933
     C****ROM PF/DEALSDG                                                  58933
     C****       DTYP      IFEQ 'RX'                                      58933
     C****                 MOVELUCUCY     ZUCUCY                          58933
     C****                 MOVELTCUCY     ZTCUCY                          58933
     C****                 Z-ADDMDAT      ZMDAT                           58933
     C****                 EXSR ZFDLLN                                    58933
     C****                 MOVELZLIN      DDNAR2                          58933
     C****                                                                58933
     C****OVE THEIR CURRENCY FROM PF/DEALSDG TO CURRENCY 2 ON             58933
     C****ORTFOLIO TRANSFER SUBFILE RECORD                                58933
     C****                 MOVELTCUCY     DDCCY2                          58933
     C****                                                                58933
     C****DIT AMOUNT FOR OUTPUT TO SUBFILE RECORD (USE STANDARD           58933
     C****R. ZEDIT WITH ZFIELD=TPAMT FROM PF/DEALSDG                      58933
     C****ND ZADEC= CURRENCY DECIMAL PLACES FOR THEIR CURRENCY FROM       58933
     C****F/TABTG10)                                                      58933
     C****       TCUCY     CHAINSDCURRL0             72                   58933
     C****       *IN72     IFEQ '1'                                       58933
     C****                 Z-ADD0         A6NBDP                          58933
     C****                 END                                            58933
     C****                 MOVE *BLANKS   ZFIELD                          58933
     C****                 MOVE TPAMT     ZFIELD                          58933
     C****                 Z-ADDA6NBDP    ZADEC                           58933
     C****       16        SUB  ZADEC     ZADIG                           58933
     C****                 EXSR ZEDIT                                     58933
     C****                 MOVE *BLANKS   WW15                            58933
     C****                 MOVE ZFIELD    WW15                            58933
     C****                                                                58933
     C****OVE LEFT EDITED AMOUNT TO NOMINAL AMOUNT 2                      58933
     C****N PORTFOLIO TRANSFER SUBFILE                                    58933
     C****                 MOVELWW15      DDNOM2                          58933
     C****                 END                                            58933
     C****                                                                58933
     C****       EP1014    ENDSR                                          58933
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P1015  S/R TO PROCESS 'TRANSFER ALL HOLDINGS' PROMPT
     C** CALLED FROM S/R P1004
     C** CALLS  S/R  =>  V1015
     C*****************************************************************
     C*
     C           P1015     BEGSR                           ** P1015  BSR**
     C*
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C                     MOVE '1'       *IN23
     C                     WRITEPM0150F2
     C                     WRITEPM0150C0
     C                     EXFMTPM0150FM
     C**  Initialise screen input MSGQ.
     C*********************CALL 'ZA0250'                                  R00300
     C*                                                                   R00300
     C**   Clear program message queue                                    R00300
     C                     CALL 'Y2CLMSC'                                 R00300
     C                     PARM           TOPQ                            R00300
     C                     PARM           TOPRQ                           R00300
     C*********************MOVEL*BLANKS   ZMSGID                          R00300
     C                     MOVEL*BLANKS   ZAMSID                          R00300
     C                     MOVE '0'       *IN28
     C*
     C           *INKC     IFEQ '1'
     C           *INKL     OREQ '1'
     C                     GOTO EP1015
     C                     END
     C*
     C** VALIDATE SCREEN INPUT
     C                     EXSR V1015
     C***********ZMSGID    IFEQ *BLANKS                                   R00300
     C           ZAMSID    IFEQ *BLANKS                                   R00300
     C*
     C** READ PORTFOLIO TRANSFER SUBFILE
     C                     Z-ADD0         X       50
     C*
     C                     DO   NNR       X
     C           X         CHAINPM0150S0             72
     C           *IN72     IFEQ '0'
     C                     MOVE '0'       *IN29
     C                     MOVELDDFALL    DDPTRS
     C                     UPDATPM0150S0
     C                     END
     C                     END
     C*
     C                     GOTO EP1015
     C                     END
     C                     END
     C*
     C           EP1015    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P1016  S/R TO UPDATE PORTFOLIO TRANSFER DETAILS
     C** CALLED FROM SR/P1004
     C** CALLS  S/R  =>  ZKEY
     C**             =>  W1016
     C*****************************************************************
     C*
     C           P1016     BEGSR
     C*
     C                     Z-ADD0         X
     C                     Z-ADD0         ROW
     C                     Z-ADD0         COL
     C                     Z-ADD0         WWCNT
     C                     DO   NNR       X
     C           X         CHAINPM0150S0             72
     C** READ RECORD FROM PORTFOLIO TRANSFER SUBFILE
     C           *IN72     IFEQ '0'
     C*
     C***ACCESS*PF/PMTRSFPP***PORTFOLIO*TRANSFER DETAILS USING CUSTOMER   S01486
     C** ACCESS PF/PMTRSFPD - PORTFOLIO TRANSFER DETAILS USING CUSTOMER   S01486
     C** NUMBER AND PORTFOLIO REFERENCE AS INPUT, MODULE ID FROM SUBFILE
     C** RECORD AND THE REMAINING KEY FIELDS AS DETERMINED FROM THE
     C** TABLE PLACED IN SPEC.(CF. PROCESSING P1016)
     C                     EXSR ZKEY
     C***********KKPMTR    CHAINPMTRSFPP             73                   S01486
     C           KKPMTR    CHAINPMTRSFPD             73                   S01486
     C           *IN73     IFEQ '0'
     C*
     C** IF A RECORD IS FOUND, A PORTFOLIO TRANSFER HAS ALREADY BEEN
     C** INPUT FOR THIS POSITION/TRANSACTION
     C*
     C** IF TRANSN NO OF LAST UPDATE IS NOT EQUAL TO ORIGINAL TRANSN
     C** NO OF LAST UPDATE FROM SUBFILE RECORD, PERFORM ROLLBACK
     C** AND SEND AN ERROR MESSAGE
     C           P8TNLU    IFNE HHTNLU
     C                     ROLBK
     C                     MOVE '1'       *IN29
     C*********************MOVEL'PM15302' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15302' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C*
     C** => POSITION CURSOR ON THE ERROR FIELD
     C           X         DIV  6         DIV     88                     |
     C           DIV       MULT 6         WWROW   50H                    |
     C           WWROW     IFEQ 0                          ------------+ |
     C                     Z-ADD6         WWROW                        | |
     C                     END                             ------------+ |
     C*                                                                  |
     C           WWROW     SUB  1         WWX     50                     |
     C           WWROW     ADD  WWX       ROW                            |
     C*                                                                  |
     C* RRN1 => TO DISPLAY THE "ERROR" PAGE                              |
     C                     Z-ADDRRN       RRN1    50                     |
     C                     ADD  8         ROW                            |
     C                     Z-ADD74        COL                            |
     C                     UPDATPM0150S0
     C                     GOTO EP1016
     C                     END
     C*
     C** IF TRANSFER TO PORTFOLIO REFERENCE FROM SUBFILE RECORD IS NOT
     C** BLANK (IE. AN AMENDMENT TO A PORTFOLIO TRANSFER) AND
     C** IF TRANSFER TO PORTFOLIO REFERENCE IS NOT EQUAL TO ORIGINAL
     C** TRANSFER TO PORTFOLIO REFERENCE
     C           DDPTRS    IFNE *BLANKS
     C           DDPTRS    ANDNEHHFPTF
     C*
     C** MOVE TRANSFER TO PORTFOLIO REFERENCE FROM SUBFILE RECORD TO
     C** 'TO' PORTFOLIO REFERENCE ON PF/PMTRSFPP
     C                     MOVE DDPTRS    P8TPTF
     C*
     C** UPDATE THE RECORD AS PER W1016
     C                     MOVEL'A'       P8CHTP
     C                     EXSR W1016
     C                     UPDATPMTRSFP0
     C                     END
     C*
     C** IF TRANSFER TO PORTFOLIO REFERENCE FROM SUBFILE RECORD IS
     C** BLANK (IE. AN DELETION OF A PORTFOLIO TRANSFER)
     C           DDPTRS    IFEQ *BLANKS
     C*
     C** DELETE THE RECORD FROM PF/PMTRSFPP
     C                     DELETPMTRSFP0
     C*
     C** SUBSTRACT 1 FROM A COUNT OF PORTFOLIO TRANSFERS GENERATED
     C                     SUB  1         WWCNT
     C                     END
     C                     END
     C*
     C** IF A RECORD IS NOT FOUND (IE. AN INSERTION OF A PORTFOLIO
     C** TRANSFER)
     C           *IN73     IFEQ '1'
     C           DDPTRS    ANDNE*BLANKS
     C*
     C** WRITE A NEW RECORD AS PER W1016
     C** TRANSFER)
     C                     MOVEL'I'       P8CHTP
     C                     EXSR W1016
     C                     WRITEPMTRSFP0
     C*
     C** ADD 1 FROM A COUNT OF PORTFOLIO TRANSFERS GENERATED
     C                     ADD  1         WWCNT
     C                     END
     C*
     C                     END
     C                     END
     C*
     C           EP1016    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P1017  S/R TO UPDATE PORTFOLIO TRANSFER AUDIT
     C** CALLED FROM SR/P1004
     C** CALLS  S/R  =>  *PSSR
     C*****************************************************************
     C*
     C           P1017     BEGSR
     C*
     C***ACCESS*PF/PMTRSFZZ - PORTFOLIO TRANSFER AUDIT RECORD             S01486
     C***********1         CHAINPMTRSFZZ             72                   S01486
     C** ACCESS PF/PMTRSFPA - PORTFOLIO TRANSFER AUDIT RECORD             S01486
     C           1         CHAINPMTRSFPA             72                   S01486
     C           *IN72     IFEQ '0'
     C                     ADD  WWCNT     P8NORE
     C                     UPDATPMTRSFZ0
     C                     ELSE
     C*
     C** ERROR
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD9         DBASE            **DB ERROR 09**
     C***********          MOVEL'PMTRSFZZ'DBFILE           ***************S01486
     C                     MOVEL'PMTRSFPA'DBFILE           ***************S01486
     C                     MOVEL'NONE'    DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C           EP1017    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C***P1018**S/R TO LOAD FI LOANS AND DEPOSITS TO SUBFILE              S01486
     C***CALLED*FROM S/R P1003                                            S01486
     C***CALLS**S/R  =>  P1019                                            S01486
     C**********     =>  P1020                                            S01486
     C*****************************************************************
     C***********P1018     BEGSR                                          S01486
     C***********                                                         S01486
     C***SET*LOWER LIMITS ON LF/FIDPLNPT                                  S01486
     C***********                                                         S01486
     C***********KKPM      SETLLFIDPLNPT                                  S01486
     C***********                                                         S01486
     C***READ*NEXT RECORD ON LF/FIDPLNPT                                  S01486
     C***********                                                         S01486
     C***********          MOVE '0'       *IN05                           S01486
     C***********          MOVE '0'       *IN06                           S01486
     C***********KKPM      READEFIDPLNPT                 70               S01486
     C***********                                                         S01486
     C************IN70     DOWEQ'0'                        - B1           S01486
     C***********                                                         S01486
     C***IF*RECORD READ FROM FILOANPD                                     S01486
     C***********                                                         S01486
     C************IN06     IFEQ '1'                        - B2           S01486
     C***********                                                         S01486
     C*********************MOVEL'FL'      DDMODI                          B8108
     C***********          MOVEL' FL  '   DDMODI                   B8108  S01486
     C***********FLDLTF    IFNE ' '                                B8108  S01486
     C***********          MOVE 'MATURED' DDMOD2                   B8108  S01486
     C***********          ELSE                                    B8108  S01486
     C***********          MOVE *BLANKS   DDMOD2                   B8108  S01486
     C***********          END                                     B8108  S01486
     C**
     C****       FLPTYP    IFEQ 71                         - B3           R05896
     C***SET  EQUIVALENT DEAL TYPE TO 'CD'                                R05896
     C****                 MOVEL'CD'      WWDLET  2                       R05896
     C****                 END                             - E3           R05896
     C****                                                                R05896
     C****       FLPTYP    IFEQ 72                         - B3           R05896
     C***SET  EQUIVALENT DEAL TYPE TO 'TD'                                R05896
     C****                 MOVEL'TD'      WWDLET                          R05896
     C****                 END                             - E3           R05896
     C***SET DEPOSIT SUB TYPE TO LOAN SUB TYPE                            R05896
     C****                 MOVELFLSUTP    WWDLST  2                       R05896
     C****                                                                R05896
     C***********          END                             - E2    R05896 S01486
     C***********                                                         S01486
     C***IF*RECORD READ FROM FIDEPOPD                                     S01486
     C***********                                                         S01486
     C************IN05     IFEQ '1'                        - B2           S01486
     C***********                                                         S01486
     C*********************MOVEL'FD'      DDMODI                          B8108
     C***********          MOVEL' FD  '   DDMODI                   B8108  S01486
     C***********FDDLTF    IFNE ' '                                B8108  S01486
     C***********          MOVE 'MATURED' DDMOD2                   B8108  S01486
     C***********          ELSE                                     B8108 S01486
     C***********          MOVE *BLANKS   DDMOD2                    B8108 S01486
     C***********          END                                      B8108 S01486
     C****                 MOVELFDDEDT    WWDLET                          R05896
     C*********************MOVELFDDPST    WWDLST                          R00428
     C****                 MOVELFDSTRT    WWDLST                          R05896
     C***********                                                         S01486
     C***********          END                             - E2           S01486
     C***********                                                         S01486
     C***ACCESS*SDDTSTPP USING DEAL EQUIVALENT DEAL TYPE AND DEPOSIT      S01486
     C***SUB-TYPE                                                         S01486
     C***********                                                         S01486
     C************IN05     IFEQ '1'                                R05896 S01486
     C****                 MOVELWWDLET    DTYP                     R05896 S01486
     C****                 MOVELWWDLST    DLST                            R05896
     C***********          MOVELFDDTYP    DTYP                     R05896 S01486
     C***********          MOVELFDSTRT    DLST                     R05896 S01486
     C***********KKPMDL    CHAINSDDTSTPP             71                   S01486
     C***********                                                         S01486
     C************IN71     IFEQ '1'                        - B2           S01486
     C***DATA*BASE ERROR                                                  S01486
     C***********          Z-ADD21        DBASE            **DB ERROR 21**S01486
     C***********          MOVEL'SDDTSTPP'DBFILE           ***************S01486
     C***********          MOVELDTYP      DBKEY                           S01486
     C***********          MOVE DLST      DBKEY                           S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          ELSE                            - X2           S01486
     C***MOVE*NARRATIVE TO SUBFILE                                        S01486
     C***********          MOVELP7DTNR    DDNAR1                          S01486
     C***********          END                             - E2           S01486
     C***********          END                             - E2    R05896 S01486
     C***********                                                  R05896 S01486
     C***ACCESS*SDLOANL1 USING LOAN TYPE SUB-TYPE                  R05896 S01486
     C***********                                                  R05896 S01486
     C************IN06     IFEQ '1'                                R05896 S01486
     C***********          MOVELFLLTYP    DTYP                     R05896 S01486
     C***********          MOVELFLSUTP    DLST                     R05896 S01486
     C***********KKPMDL    CHAINSDLOANL1             71            R05896 S01486
     C***********                                                  R05896 S01486
     C************IN71     IFEQ '1'                        - B2    R05896 S01486
     C***DATA*BASE ERROR                                           R05896 S01486
     C***********          Z-ADD81        DBASE            **DB 1**R05896 S01486
     C***********          MOVEL'SDLOANL1'DBFILE           ********R05896 S01486
     C***********          MOVELDTYP      DBKEY                    R05896 S01486
     C***********          MOVE DLST      DBKEY                    R05896 S01486
     C***********          EXSR *PSSR                              R05896 S01486
     C***********          ELSE                            - X2    R05896 S01486
     C***MOVE*NARRATIVE TO SUBFILE                                 R05896 S01486
     C***********          MOVELAYLNTD    DDNAR1                   R05896 S01486
     C***********          END                             - E2    R05896 S01486
     C***********          END                             - E2    R05896 S01486
     C***********                                                         S01486
     C***MOVE*DEPOSIT NUMBER OR LOAN NUMBER TO REFERENCE                  S01486
     C***********                                                         S01486
     C************IN05     IFEQ '1'                        - B2           S01486
     C***********          MOVELFDDENR    DDREF1                          S01486
     C***********          END                             - E2           S01486
     C***********                                                         S01486
     C************IN06     IFEQ '1'                        - B2           S01486
     C***********          MOVELFLLONR    DDREF1                          S01486
     C***********          END                             - E2           S01486
     C***********                                                         S01486
     C***IF*RECORD HAS BEEN READ FROM FIDEPOPD EXECUTE                    S01486
     C***SUBROUTINE P1019 OTHERWISE IF RECORD HAS BEEN READ               S01486
     C***FROM*FILOANPD EXECUTE SUBROUTINE P1020                           S01486
     C***********                                                         S01486
     C************IN06     IFEQ '1'                        - B2           S01486
     C***********          EXSR P1019                                     S01486
     C***********          END                             - E2           S01486
     C***********                                                         S01486
     C************IN05     IFEQ '1'                        - B2           S01486
     C***********          EXSR P1020                                     S01486
     C***********          END                             - E2           S01486
     C***********                                                         S01486
     C***ACCESS*PMTRSFXX PORTFOLIO TRANSFER DETAILS USING                 S01486
     C***CUSTOMER NUMBER AND PORTFOLIO REFERENCE AS INPUT                 S01486
     C***********                                                         S01486
     C***********Y                                                        S01486
     C***********          MOVEL*BLANKS   WWCCY                           S01486
     C***********          Z-ADD0         WWACOD                          S01486
     C***********          Z-ADD0         WWACSQ                          S01486
     C***********          MOVEL'T'       WWPOTI                          S01486
     C***********          MOVEL*BLANKS   WWSESN                          S01486
     C***********                                                         S01486
     C************IN05     IFEQ '1'                        - B2           S01486
     C***********          MOVEL'FD'      WWMODI                          S01486
     C***********          Z-ADDFDDENR    WWTRNB                          S01486
     C***********          END                             - E2           S01486
     C***********                                                         S01486
     C************IN06     IFEQ '1'                        - B2           S01486
     C***********          MOVEL'FL'      WWMODI                          S01486
     C***********          Z-ADDFLLONR    WWTRNB                          S01486
     C***********          END                             - E2           S01486
     C***********                                                         S01486
     C***********KKPMTR    CHAINPMTRSFXX             71                   S01486
     C***********                                                         S01486
     C************IN71     IFEQ '0'                        - B2           S01486
     C***********                                                         S01486
     C***********          Z-ADDP8TNLU    HHTNLU                          S01486
     C***********          MOVELP8POTI    HHPOTI                          S01486
     C***********P8TPTF    IFEQ '9997'                                    S01486
     C***********          MOVELP9R997    DDPTRS                          S01486
     C***********          MOVELP9R997    HHFPTF                          S01486
     C***********          ELSE                                           S01486
     C***********          MOVELP8TPTF    DDPTRS                          S01486
     C***********          MOVELP8TPTF    HHFPTF                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          ELSE                                           S01486
     C***********          MOVEL*BLANKS   DDPTRS                          S01486
     C***********          MOVEL*BLANKS   HHFPTF                          S01486
     C***********          Z-ADD0         HHTNLU                          S01486
     C***********                                                         S01486
     C***********          END                             - E2           S01486
     C***********          EXSR ZWTR                                      S01486
     C***********          EXSR ZRAZ                                      S01486
     C***READ*NEXT RECORD ON LF/FIDPLNPT                                  S01486
     C***********                                                         S01486
     C***********          MOVE '0'       *IN05                           S01486
     C***********          MOVE '0'       *IN06                           S01486
     C***********KKPM      READEFIDPLNPT                 70               S01486
     C***********                                                         S01486
     C***********          END                             - E1           S01486
     C***********                                                         S01486
     C***********          ENDSR                                          S01486
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C***P1019**S/R TO LOAD FI LOANS TO SUBFILE                           S01486
     C***CALLED*FROM S/R P1018                                            S01486
     C***CALLS**S/R  =>                                                   S01486
     C*****************************************************************
     C***********                                                         S01486
     C***********P1019     BEGSR                                          S01486
     C***********                                                         S01486
     C***MOVE*CURRENCY CODE FROM FILOANPD TO CURRENCY 1 ON SUBFILE        S01486
     C***********                                                         S01486
     C***********          MOVELFLLCCY    DDCCY1                          S01486
     C***IF*CURRENT AMOUNT FROM FILOANPD IS POSITIVE                      S01486
     C***********FLCPAM    IFLT 0                                         S01486
     C***********          MOVE '-'       DDNOM1                          S01486
     C***********FLCPAM    MULT -1        FLCPAM                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***CONVERT*AMOUNT                                                   S01486
     C***********                                                         S01486
     C***********          MOVEL*BLANKS   ZFIELD                          S01486
     C***********          MOVE FLCPAM    ZFIELD                          S01486
     C***ACCESS*SDCURRL0 TO GET DECIMAL PLACES                            S01486
     C***********FLLCCY    CHAINSDCURRL0             72                   S01486
     C***********                                                         S01486
     C************IN72     IFEQ '1'                                       S01486
     C***DATA*BASE ERROR                                   ***************S01486
     C***********          Z-ADD22        DBASE            **DB ERROR 22**S01486
     C***********          MOVEL'SDCURRL0'DBFILE           ***************S01486
     C***********          MOVELFLLCCY    DBKEY                           S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          Z-ADDA6NBDP    ZADEC                           S01486
     C***********          EXSR ZEDIT                                     S01486
     C***********          MOVE *BLANKS   WW15                            S01486
     C***********          MOVE ZFIELD    WW15                            S01486
     C***********          MOVEL*BLANKS   WW16                            S01486
     C***********          MOVELWW15      DDNOM1                          S01486
     C***FORMAT*LINE DESCRIPTION                                          S01486
     C***********          MOVELFLLCCY    ZCCY                            S01486
     C***********          Z-ADDFLINTR    ZINRT                           S01486
     C***********          Z-ADDFLMDAT    ZMDAT                           S01486
     C***********          Z-ADD0         ZNOTD                           S01486
     C***********                                                         S01486
     C***********          EXSR ZFDLLN                                    S01486
     C***********          MOVELZLIN      DDNAR2                          S01486
     C***********                                                         S01486
     C***********          MOVE 'T'       HHPOTI                          S01486
     C***********                                                         S01486
     C***********          ENDSR                                          S01486
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C***P1020**S/R TO LOAD FI DEPOSITS TO SUBFILE                        S01486
     C***CALLED*FROM S/R P1018                                            S01486
     C***CALLS**S/R  =>                                                   S01486
     C*****************************************************************
     C***********                                                         S01486
     C***********P1020     BEGSR                                          S01486
     C***********                                                         S01486
     C***MOVE*CURRENCY CODE FROM FIDEPOPD TO CURRENCY 1 ON SUBFILE        S01486
     C***********                                                         S01486
     C***********          MOVELFDCCY     DDCCY1                          S01486
     C***********          MOVE *BLANKS   DDNOM1                          S01486
     C***********                                                         S01486
     C***CONVERT*AMOUNT                                                   S01486
     C***********                                                         S01486
     C***********          MOVEL*BLANKS   ZFIELD                          S01486
     C***********          MOVE FDPCPL    ZFIELD                          S01486
     C***ACCESS*SDCURRL0 TO GET DECIMAL PLACES                            S01486
     C***********FDCCY     CHAINSDCURRL0             72                   S01486
     C***********                                                         S01486
     C************IN72     IFEQ '1'                                       S01486
     C***DATA*BASE ERROR                                   ***************S01486
     C***********          Z-ADD23        DBASE            **DB ERROR 23**S01486
     C***********          MOVEL'SDCURRL0'DBFILE           ***************S01486
     C***********          MOVELFDCCY     DBKEY                           S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          Z-ADDA6NBDP    ZADEC                           S01486
     C***********          EXSR ZEDIT                                     S01486
     C***********          MOVE *BLANKS   WW15                            S01486
     C***********          MOVE ZFIELD    WW15   15                       S01486
     C***********          MOVEL*BLANKS   WW16   16                       S01486
     C***********          MOVELWW15      DDNOM1                          S01486
     C***FORMAT*LINE DESCRIPTION                                          S01486
     C***********          MOVELFDCCY     ZCCY                            S01486
     C***********          Z-ADDFDINTR    ZINRT                           S01486
     C***********          Z-ADDFDMDAT    ZMDAT                           S01486
     C***********          Z-ADDFDNOTD    ZNOTD                           S01486
     C***********                                                         S01486
     C***********          EXSR ZFDLLN                                    S01486
     C***********          MOVELZLIN      DDNAR2                          S01486
     C***********                                                         S01486
     C***********          MOVE 'T'       HHPOTI                          S01486
     C***********                                                         S01486
     C***********          ENDSR                                          S01486
     C*****************************************************************
     C*                                                                   S01408
     C/COPY WNCPYSRC,PM0150CCP3                                           S01408
     C*                                                                   S01408
      /EJECT
     C*****************************************************************
     C** V1002  S/R TO VALIDATE KEY FIELDS
     C** CALLED FROM S/R P1002
     C** CALLS  S/R  =>  VCUST
     C*****************************************************************
     C*
     C           V1002     BEGSR                           ** V1002  BSR**
     C*
     C** CUSTOMER NUMBER / SHORTNAME
     C** Must be a valid shortname or a valid number
     C                     MOVELDDCNUM    INPNM  10
     C                     EXSR VCUST
     C** No error
     C           ERRSW     IFEQ '0'
     C                     MOVEL*BLANKS   DDCNUM
     C                     MOVELOUTNB     DDCNUM
     C                     ELSE
     C** Blank field
     C** Must be entered if a portfolio ref. is specified
     C           ERRSW     IFEQ '9'
     C*********************MOVEL'PM15100' ZMSGID                          R00300
     C                     MOVEL'PM15100' ZAMSID                          R00300
     C                     ELSE                                           CPB001
     C** No Portfolio Transfer allowed for a PB Customer                  CPB001
     C           ERRSW     IFEQ '4'                                       CPB001
     C                     MOVEL'PBUSRMSG'ZAMSGF                          CPB001
     C                     MOVEL'PB00069' ZAMSID                          CPB001
     C                     ELSE
     C** Wrong number
     C           ERRSW     IFEQ '1'
     C*********************MOVEL'PM15102' ZMSGID                          R00300
     C                     MOVEL'PM15102' ZAMSID                          R00300
     C** Wrong short name
     C                     ELSE
     C           ERRSW     IFEQ '2'
     C*********************MOVEL'PM15101' ZMSGID                          R00300
     C                     MOVEL'PM15101' ZAMSID                          R00300
     C                     END
     C                     END
     C                     END                                            CPB001
     C                     END
     C*                                                                   CPM004
     C** Customer is not a valid branch internal customer number          CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           ERRSW     ANDEQ'3'                                       CPM004
     C                     MOVEL'PMA0017' ZAMSID                          CPM004
     C                     ENDIF                                          CPM004
     C*
     C                     MOVE '1'       *IN26
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     MOVEL'PMUSRMSG'ZAMSGF                          CPB001
     C                     END
     C*
     C***IF*ENTERED,*THE*CUSTOMER*MUST BE A VALID PORTFOLIO CUSTOMER      S01486
     C***(IE.*PORTFOLIO*CUSTOMER*INDICATOR  = Y )                         S01486
     C***********ERRSW     IFEQ '0'                                       S01486
     C***********QBPCUS    ANDNE'Y'                                       S01486
     C***********          MOVE '1'       *IN26                           S01486
     C*********************MOVEL'PM15103' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C***********          MOVEL'PM15103' ZAMSID                   R00300 S01486
     C***********          EXSR ZASNMS                             R00300 S01486
     C***********          END                                            S01486
     C*
     C** THE PORTFOLIO REFERENCE MUST BE ENTERED IF A CUSTOMER IS
     C** SPECIFIED
     C           DDCNUM    IFNE *BLANKS
     C           DDFPTF    ANDEQ*BLANKS
     C                     MOVE '1'       *IN27
     C*********************MOVEL'PM15104' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15104' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C** IF ENTERED, EITHER MUST BE A VALID PORTFOLIO REFERENCE FOR
     C** THIS CUSTOMER (IE. A RECORD FOR THIS CUSTOMER/PORTFOLIO
     C** REFERENCE COMBINATION MUST EXIST ON PF/PMPORTPP) OR MUST BE
     C** THE USER-DEFINED PORTFOLIO REFERENCE FOR THE UNASSIGNED
     C** PORTFOLIO (DEFINED INTERNALLY AS '9997') HELD ON PORTFOLIO
     C** MANAGEMENT ICD
     C           DDFPTF    IFNE *BLANKS
     C                     MOVELDDCNUM    WWCNUM
     C***********DDFPTF    IFNE P9R997                                    S01486
     C           DDFPTF    IFNE FCR997                                    S01486
     C           DDFPTF    OREQ FCR997                                    CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C                     MOVELDDFPTF    WWFALL  4
     C***********KKPMPO    CHAINPMPORTPP             73                   S01486
     C           KKPMPO    CHAINPMPORTPD             73                   S01486
     C           *IN73     IFEQ '1'
     C                     MOVE '1'       *IN27
     C*********************MOVEL'PM15105' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15105' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C*                                                                   S01313
     C** WHEN IT IS A VALID CUSTOMER/PORTFOLIO AND NOT 9997,              S01313
     C** IF IT IS A PORTFOLIO PERFORMANCE (PNPSDT <> 99999):              S01313
     C** PORTFOLIO PERFORMANCE MUST NOT BE STARTED                        S01313
     C** (only when Bank Portfolio is not supported)                      CPM004
     C                     ELSE                                           S01313
     C           PNPSDT    IFNE 99999                                     S01313
     C           PNPSDT    ANDLEBJRDNB                                    S01313
     C           FCPORS    ANDNE'B'                                       CPM004
     C                     MOVE '1'       *IN27                           S01313
     C                     MOVEL'PM15112' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     END                                            S01313
     C                     END
      *                                                                   CPM005
      **  Else it's the user-defined portfolio reference for unassigned   CPM005
      **  portfolio (defined internally as '9997') held on portfolio      CPM005
      **  management ICD                                                  CPM005
      *                                                                   CPM005
     C                     ELSE                            X2             CPM005
      *                                                                   CPB001
      ** Default Portfolio no more used when Module PB is switch on       CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE '1'       *IN27                           CPB001
     C                     MOVEL'PBUSRMSG'ZAMSGF                          CPB001
     C                     MOVEL'PB00070' ZAMSID                          CPB001
     C                     MOVELFCR997    ZAMSDA                          CPB001
     C                     EXSR ZASNMS                                    CPB001
     C                     MOVEL'PMUSRMSG'ZAMSGF                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVEL'9997'    WW9997                          CPM005
     C           KKPMP9    CHAINPMCNSDLL             73                   CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '0'                        B3             CPM005
      *                                                                   CPM005
      **  Portfolio performance must not be started                       CPM005
      *                                                                   CPM005
     C           PNPSDT    IFNE 99999                      B4             CPM005
     C           PNPSDT    ANDLEBJRDNB                                    CPM005
     C                     MOVE '1'       *IN27                           CPM005
     C                     MOVEL'PM15112' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                             E4             CPM005
     C                     END                             E3             CPM005
      *                                                                   CPM005
     C           *IN27     IFEQ '0'                        B3             CPM005
      *                                                                   CPM005
      **  Portfolio performance must not be started for total portfolio   CPM005
      *                                                                   CPM005
     C                     MOVEL'9998'    WW9997                          CPM005
     C           KKPMP9    CHAINPMCNSDLL             73                   CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '0'                        B4             CPM005
      *                                                                   CPM005
     C           PNPSDT    IFNE 99999                      B5             CPM005
     C           PNPSDT    ANDLEBJRDNB                                    CPM005
     C                     MOVE '1'       *IN27                           CPM005
     C                     MOVEL'PM15114' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                             E5             CPM005
     C                     END                             E4             CPM005
     C                     END                             E3             CPM005
     C                     ENDIF                                          CPB001
     C                     END
      *                                                                   CPM005
      **  Verify if portfolio is a pool portfolio member                  CPM005
      *                                                                   CPM005
     C                     MOVELDDFPTF    WWFALL                          CPM005
     C           KKPMPO    CHAINPMPPTML1             73                   CPM005
      *                                                                   CPM005
      **  If it's a pool member, verify if pool with performance          CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '0'                        B2             CPM005
     C**********           Z-ADDOSPCNU    WWPCNU                                       CPM005 CSD027
     C                     MOVE OSPCNU    WWPCNU                                              CSD027
     C                     MOVE OSPPTF    WWPPTF                          CPM005
      *                                                                   CPM005
     C           KPOOL     CHAINPMPORTPD             73                   CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '1'                        B3             CPM005
     C                     MOVE OSPPTF    DBKEY                           CPM005
     C                     MOVELOSPCNU    DBKEY            ***************CPM005
     C                     Z-ADD24        DBASE            **DB ERROR 24**CPM005
     C                     MOVE 'PMPORTPD'DBFILE           ***************CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E3             CPM005
      *                                                                   CPM005
      **  If it is a portfolio performance (PNPSDT <> 99999):             CPM005
      **  portfolio performance must not be started                       CPM005
      *                                                                   CPM005
     C           PNPSDT    IFNE 99999                      B3             CPM005
     C           PNPSDT    ANDLEBJRDNB                                    CPM005
     C                     MOVE '1'       *IN27                           CPM005
     C                     MOVEL'PM15116' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                             E3             CPM005
      *                                                                   CPM005
     C                     END                             E2             CPM005
     C                     END
     C*
     C           EV1002    ENDSR
     C**********************************************************************
      /EJECT
     C*****************************************************************
     C** V1004  S/R TO VALIDATE PORTFOLIO TRANSFER SUBFILE
     C** CALLED FROM S/R P1004
     C*****************************************************************
     C*
     C           V1004     BEGSR                           ** V1004  BSR**
     C                     Z-ADD0         X       50
     C                     Z-ADD0         ROW
     C                     Z-ADD0         COL
     C*
     C                     DO   NNR       X
     C           X         CHAINPM0150S0             72
     C           *IN72     IFEQ '0'
     C                     MOVE '0'       *IN29
     C*
     C** IF ENTERED, MUST NOT BE EQUAL TO CURRENT PORTFOLIO REFERENCE
     C** (IE. AS SPECIFIED ON THE START SCREEN)
     C           DDPTRS    IFNE *BLANKS
     C           DDPTRS    ANDEQDDFPTF
     C                     MOVE '1'       *IN29
     C*********************MOVEL'PM15106' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15106' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C** IF ENTERED, EITHER MUST BE A VALID PORTFOLIO REFERENCE FOR
     C** THIS CUSTOMER (IE. A RECORD FOR THIS CUSTOMER/PORTFOLIO
     C** REFERENCE COMBINATION MUST EXIST ON PF/PMPORTPP) OR MUST BE
     C** THE USER-DEFINED PORTFOLIO REFERENCE FOR THE UNASSIGNED
     C** PORTFOLIO (DEFINED INTERNALLY AS '9997') HELD ON PORTFOLIO
     C** MANAGEMENT ICD
     C           DDPTRS    IFNE *BLANKS
     C*
     C***********DDPTRS    IFNE P9R997                                    S01486
     C           DDPTRS    IFNE FCR997                                    S01486
     C           DDPTRS    OREQ FCR997                                    CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C                     MOVELDDPTRS    WWFALL
     C***********KKPMPO    CHAINPMPORTPP             73                   S01486
     C           KKPMPO    CHAINPMPORTPD             73                   S01486
     C           *IN73     IFEQ '1'                                       S01486
     C                     MOVE '1'       *IN29
     C*********************MOVEL'PM15107' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15107' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C*                                                                   S01313
     C** WHEN IT IS A VALID CUSTOMER/PORTFOLIO AND NOT 9997,              S01313
     C** IF IT IS A PORTFOLIO PERFORMANCE (PNPSDT <> 99999):              S01313
     C** PORTFOLIO PERFORMANCE MUST NOT BE STARTED                        S01313
     C                     ELSE                                           S01313
     C           PNPSDT    IFNE 99999                                     S01313
     C           PNPSDT    ANDLEBJRDNB                                    S01313
     C           FCPORS    ANDNE'B'                                       CPM004
     C                     MOVE '1'       *IN29                           S01313
     C                     MOVEL'PM15113' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     END                                            S01313
     C                     END
     C*
     C** IF ENTERED, MUST NOT BE THE PORTFOLIO REFERENCE OF A CLOSING
     C** PORTFOLIO (IE. THE RECORD FOR THIS CUSTOMER/PORTFOLIO
     C** REFERENCE COMBINATION ON PF/PMPORTPP MUST NOT HAVE DATE
     C** PORTFOLIO CLOSED GREATER THAN ZERO)
     C           *IN73     IFEQ '0'
     C           PNDPCL    ANDGT0
     C                     MOVE '1'       *IN29
     C*********************MOVEL'PM15108' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15108' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
      *                                                                   CPM005
      **  Else it's the user-defined portfolio reference for unassigned   CPM005
      **  portfolio (defined internally as '9997') held on portfolio      CPM005
      **  management ICD                                                  CPM005
      *                                                                   CPM005
     C                     ELSE                            X4             CPM005
      *                                                                   CPB001
      ** Default Portfolio no more used when Module PB is switch on       CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE '1'       *IN29                           CPB001
     C                     MOVEL'PBUSRMSG'ZAMSGF                          CPB001
     C                     MOVEL'PB00070' ZAMSID                          CPB001
     C                     MOVELFCR997    ZAMSDA                          CPB001
     C                     EXSR ZASNMS                                    CPB001
     C                     MOVEL'PMUSRMSG'ZAMSGF                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVEL'9997'    WW9997                          CPM005
     C           KKPMP9    CHAINPMCNSDLL             73                   CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '0'                        B5             CPM005
      *                                                                   CPM005
      **  Portfolio performance must not be started                       CPM005
      *                                                                   CPM005
     C           PNPSDT    IFNE 99999                      B6             CPM005
     C           PNPSDT    ANDLEBJRDNB                                    CPM005
     C                     MOVE '1'       *IN29                           CPM005
     C                     MOVEL'PM15113' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                             E6             CPM005
     C                     END                             E5             CPM005
      *                                                                   CPM005
     C           *IN29     IFEQ '0'                        B5             CPM005
      *                                                                   CPM005
      **  Portfolio performance must not be started for total portfolio   CPM005
      *                                                                   CPM005
     C                     MOVEL'9998'    WW9997                          CPM005
     C           KKPMP9    CHAINPMCNSDLL             73                   CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '0'                        B6             CPM005
      *                                                                   CPM005
     C           PNPSDT    IFNE 99999                      B7             CPM005
     C           PNPSDT    ANDLEBJRDNB                                    CPM005
     C                     MOVE '1'       *IN29                           CPM005
     C                     MOVEL'PM15115' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                             E7             CPM005
     C                     END                             E6             CPM005
     C                     END                             E5             CPM005
     C                     ENDIF                                          CPB001
     C                     END
      *                                                                   CPM005
      **  Verify if portfolio is a pool portfolio member                  CPM005
      *                                                                   CPM005
     C                     MOVELDDPTRS    WWFALL                          CPM005
     C           KKPMPO    CHAINPMPPTML1             73                   CPM005
      *                                                                   CPM005
      **  If it's a pool member, verify if pool with performance          CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '0'                        B4             CPM005
     C**********           Z-ADDOSPCNU    WWPCNU                                       CPM005 CSD027
     C                     MOVE OSPCNU    WWPCNU                                              CSD027
     C                     MOVE OSPPTF    WWPPTF                          CPM005
      *                                                                   CPM005
     C           KPOOL     CHAINPMPORTPD             73                   CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '1'                        B5             CPM005
     C                     MOVE OSPPTF    DBKEY                           CPM005
     C                     MOVELOSPCNU    DBKEY            ***************CPM005
     C                     Z-ADD25        DBASE            **DB ERROR 25**CPM005
     C                     MOVE 'PMPORTPD'DBFILE           ***************CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E5             CPM005
      *                                                                   CPM005
      **  If it is a portfolio performance (PNPSDT <> 99999):             CPM005
      **  portfolio performance must not be started                       CPM005
      *                                                                   CPM005
     C           PNPSDT    IFNE 99999                      B5             CPM005
     C           PNPSDT    ANDLEBJRDNB                                    CPM005
     C                     MOVE '1'       *IN29                           CPM005
     C                     MOVEL'PM15117' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                             E5             CPM005
     C                     END                             E4             CPM005
     C*
     C                     END
     C*
     C** IF *IN29 ='1' => ERROR ON FIELD AND IF ROW = 0 & COL = 0
     C** => FIRST TIME ======> POSITION CURSOR ON THE ERROR FIELD
     C           *IN29     IFEQ '1'
     C           ROW       ANDEQ0
     C           COL       ANDEQ0
     C*
     C           X         DIV  6         DIV     88
     C           DIV       MULT 6         WWROW   50H
     C           WWROW     IFEQ 0
     C                     Z-ADD6         WWROW
     C                     END
     C*
     C           WWROW     SUB  1         WWX     50
     C           WWROW     ADD  WWX       ROW
     C*
     C* RRN1 => TO DISPLAY THE "ERROR" PAGE
     C                     Z-ADDRRN       RRN1    50
     C                     ADD  8         ROW
     C                     Z-ADD74        COL
     C*
     C                     END
     C*
     C                     UPDATPM0150S0
     C                     END
     C                     END
     C*
     C           EV1004    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** V1015  S/R TO VALIDATE 'TRANSFER ALL HOLDINGS' PROMPT
     C** CALLED FROM S/R P1015
     C*****************************************************************
     C*
     C           V1015     BEGSR                           ** V1015  BSR**
     C*
     C** IF ENTERED, MUST NOT BE EQUAL TO CURRENT PORTFOLIO REFERENCE
     C** (IE. AS SPECIFIED ON THE START SCREEN)
     C           DDFALL    IFNE *BLANKS
     C           DDFALL    ANDEQDDFPTF
     C                     MOVE '1'       *IN28
     C*********************MOVEL'PM15109' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15109' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C** IF ENTERED, EITHER MUST BE A VALID PORTFOLIO REFERENCE FOR
     C** THIS CUSTOMER (IE. A RECORD FOR THIS CUSTOMER/PORTFOLIO
     C***REFERENCE*COMBINATION*MUST EXIST ON PF/PMPORTPP) OR MUST BE      S01486
     C** REFERENCE COMBINATION MUST EXIST ON PF/PMPORTPD) OR MUST BE      S01486
     C** THE USER-DEFINED PORTFOLIO REFERENCE FOR THE UNASSIGNED
     C** PORTFOLIO (DEFINED INTERNALLY AS '9997') HELD ON PORTFOLIO
     C** MANAGEMENT ICD
     C*
     C***********DDFALL    IFNE P9R997                                    S01486
     C           DDFALL    IFNE FCR997                                    S01486
     C           DDFALL    OREQ FCR997                                    CPB001
     C           DDFALL    ANDNE*BLANKS                                   CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C                     MOVELDDFALL    WWFALL
     C***********KKPMPO    CHAINPMPORTPP             72                   S01486
     C           KKPMPO    CHAINPMPORTPD             72                   S01486
     C           *IN72     IFEQ '1'
     C                     MOVE '1'       *IN28
     C*********************MOVEL'PM15110' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15110' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C*                                                                   S01313
     C** WHEN IT IS A VALID CUSTOMER/PORTFOLIO AND NOT 9997,              S01313
     C** IF IT IS A PORTFOLIO PERFORMANCE (PNPSDT <> 99999):              S01313
     C** PORTFOLIO PERFORMANCE MUST NOT BE STARTED                        S01313
     C                     ELSE                                           S01313
     C           PNPSDT    IFNE 99999                                     S01313
     C           PNPSDT    ANDLEBJRDNB                                    S01313
     C           FCPORS    ANDNE'B'                                       CPM004
     C                     MOVE '1'       *IN28                           S01313
     C                     MOVEL'PM15113' ZAMSID                          S01313
     C                     EXSR ZASNMS                                    S01313
     C                     END                                            S01313
     C                     END
      *                                                                   CPM005
      **  Else it's the user-defined portfolio reference for unassigned   CPM005
      **  portfolio (defined internally as '9997') held on portfolio      CPM005
      **  management ICD                                                  CPM005
      *                                                                   CPM005
     C                     ELSE                            X1             CPM005
     C                     MOVEL'9997'    WW9997                          CPM005
     C           KKPMP9    CHAINPMCNSDLL             73                   CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '0'                        B2             CPM005
      *                                                                   CPM005
      **  Portfolio performance must not be started                       CPM005
      *                                                                   CPM005
     C           PNPSDT    IFNE 99999                      B3             CPM005
     C           PNPSDT    ANDLEBJRDNB                                    CPM005
     C                     MOVE '1'       *IN28                           CPM005
     C                     MOVEL'PM15113' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C           *IN28     IFEQ '0'                        B2             CPM005
      *                                                                   CPM005
      **  Portfolio performance must not be started for total portfolio   CPM005
      *                                                                   CPM005
     C                     MOVEL'9998'    WW9997                          CPM005
     C           KKPMP9    CHAINPMCNSDLL             73                   CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '0'                        B3             CPM005
      *                                                                   CPM005
     C           PNPSDT    IFNE 99999                      B4             CPM005
     C           PNPSDT    ANDLEBJRDNB                                    CPM005
     C                     MOVE '1'       *IN28                           CPM005
     C                     MOVEL'PM15115' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                             E4             CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
     C                     END
      *                                                                   CPM005
      **  Verify if portfolio is a pool portfolio member                  CPM005
      *                                                                   CPM005
     C                     MOVELDDFALL    WWFALL                          CPM005
     C           KKPMPO    CHAINPMPPTML1             73                   CPM005
      *                                                                   CPM005
      **  If it's a pool member, verify if pool with performance          CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '0'                        B1             CPM005
     C**********           Z-ADDOSPCNU    WWPCNU                                       CPM005 CSD027
     C                     MOVE OSPCNU    WWPCNU                                              CSD027
     C                     MOVE OSPPTF    WWPPTF                          CPM005
      *                                                                   CPM005
     C           KPOOL     CHAINPMPORTPD             73                   CPM005
      *                                                                   CPM005
     C           *IN73     IFEQ '1'                        B2             CPM005
     C                     MOVE OSPPTF    DBKEY                           CPM005
     C                     MOVELOSPCNU    DBKEY            ***************CPM005
     C                     Z-ADD26        DBASE            **DB ERROR 26**CPM005
     C                     MOVE 'PMPORTPD'DBFILE           ***************CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  If it is a portfolio performance (PNPSDT <> 99999):             CPM005
      **  portfolio performance must not be started                       CPM005
      *                                                                   CPM005
     C           PNPSDT    IFNE 99999                      B2             CPM005
     C           PNPSDT    ANDLEBJRDNB                                    CPM005
     C                     MOVE '1'       *IN28                           CPM005
     C                     MOVEL'PM15117' ZAMSID                          CPM005
     C                     EXSR ZASNMS                                    CPM005
     C                     END                             E2             CPM005
     C                     END                             E1             CPM005
     C*
     C** IF ENTERED, MUST NOT BE THE PORTFOLIO REFERENCE OF A CLOSING
     C** PORTFOLIO (IE. THE RECORD FOR THIS CUSTOMER/PORTFOLIO
     C** REFERENCE COMBINATION ON PF/PMPORTPP MUST NOT HAVE DATE
     C** PORTFOLIO CLOSED GREATER THAN ZERO)
     C           *IN72     IFEQ '0'
     C           PNDPCL    ANDGT0
     C                     MOVE '1'       *IN28
     C*********************MOVEL'PM15111' ZMSGID                          R00300
     C*********************CALL 'ZA0240'                                  R00300
     C*********************PARM           ZMSGID                          R00300
     C                     MOVEL'PM15111' ZAMSID                          R00300
     C                     EXSR ZASNMS                                    R00300
     C                     END
     C*
     C           EV1015    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** W1016  S/R TO WRITE TO PORTFOLIO TRANSFER DETAILS
     C** CALLED FROM S/R P1016
     C** CALLS  S/R  =>  ZTNLU1
     C*****************************************************************
     C*
     C           W1016     BEGSR
     C                     MOVEL'D'       P8RECI
     C                     Z-ADDBJRDNB    P8LCD
     C                     MOVE BJMRDT    WWHLUP
     C                     Z-ADDWWDLUP    P8DLUP
     C                     MOVE WWMLUP    P8MLUP
     C                     Z-ADDWWYLUP    P8YLUP
     C                     TIME           P8TLUP
     C*
     C** GET NEXT AVAILABLE TRANSACTION NUMBER
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      P8TNLU
     C**********           Z-ADDWWCNUM    P8CNUM                                              CSD027
     C                     MOVE WWCNUM    P8CNUM                                              CSD027
     C***********DDFPTF    IFEQ P9R997                                    S01486
     C           DDFPTF    IFEQ FCR997                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVEL'9997'    P8FPTF
     C                     ELSE
     C                     MOVELDDFPTF    P8FPTF
     C                     END
     C***********DDPTRS    IFEQ P9R997                                    S01486
     C           DDPTRS    IFEQ FCR997                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVEL'9997'    P8TPTF
     C                     ELSE
     C                     MOVELDDPTRS    P8TPTF
     C                     END
     C**********           Z-ADDWWTRNB    P8TRNB                                              CLE148
     C                     MOVE WWTRNB    P8TRNB                                              CLE148
     C                     MOVELWWCCY     P8CCY
     C                     Z-ADDWWACOD    P8ACOD
     C                     Z-ADDWWACSQ    P8ACSQ
     C                     MOVELWWBRCA    P8BRCA                          095249
     C                     MOVELWWSESN    P8SESN
     C                     MOVELWWMODI    P8MODI
     C                     MOVELHHPOTI    P8POTI
     C                     MOVEL'N'       P8DTCL
     C                     MOVEL'Y'       P8TBPR
     C*
     C           P8POTI    IFEQ 'P'                                       56555
     C                     Z-ADDHHNOML    P8NOML                          56555
     C                     ELSE                                           56555
     C                     Z-ADD0         P8NOML                          56555
     C                     END                                            56555
     C*                                                                   CPM004
     C** If Bank Portfolio is supported, update transaction customer      CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C**********           Z-ADDHHACUS    P8ACUS                                       CPM004 CSD027
     C                     MOVE HHACUS    P8ACUS                                              CSD027
     C                     ELSE                                           CPM004
     C**********           Z-ADD0         P8ACUS                                       CPM004 CSD027
     C                     MOVE *BLANKS   P8ACUS                                              CSD027
     C                     ENDIF                                          CPM004
     C*
     C           EW1016    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** ZKEY   S/R TO DETERMINE THE CONTENTS OF KEY FIELDS ON
     C**            PF/PMTRSFPP
     C** CALLED FROM S/R P1016
     C*****************************************************************
     C*
     C           ZKEY      BEGSR
     C*********************MOVE DDMODI    WWMODI                          B8108
     C                     MOVELDDMODI    WWORK3  3                       B8108
     C                     MOVELDDMODI    WWORK2  2                       B8108
     C*                                                                   B8108
     C           WWORK2    IFEQ 'DL'                                      B8108
     C                     MOVE WWORK2    WWMODI                          B8108
     C                     ELSE                                           B8108
     C                     MOVE WWORK3    WWMODI                          B8108
     C                     END                                            B8108
     C*
     C           WWMODI    IFEQ 'SE'
     C           HHPOTI    IFEQ 'P'
     C* SE POSITION
     C**********           Z-ADD*ZERO     WWTRNB  60                                          CLE148
     C                     MOVEL*BLANKS   WWTRNB  6                                           CLE148
     C                     MOVEL*BLANKS   WWCCY   3
     C**********           Z-ADD0         WWACOD  40                                          CGL029
     C                     Z-ADD0         WWACOD 100                                          CGL029
     C                     Z-ADD0         WWACSQ  20
     C                     MOVEL*BLANKS   WWBRCA  3                       095249
     C                     MOVEL*BLANKS   WWCCY   3
     C                     MOVEL*BLANKS   WWSESN 10
     C                     MOVELDDREF2    WWSESN
     C                     MOVELHHPOTI    WWPOTI  1
     C                     END
     C*
     C           HHPOTI    IFEQ 'T'
     C* SE TRADE
     C           HHPOTI    OREQ 'D'
     C* SE DEPOT MOVEMENT
     C**********           Z-ADD*ZERO     WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWTRNB                                              CLE148
     C                     MOVELDDREF1    WWTRNB
     C                     MOVEL*BLANKS   WWCCY
     C                     Z-ADD0         WWACOD
     C                     Z-ADD0         WWACSQ
     C                     MOVEL*BLANKS   WWBRCA                          095249
     C                     MOVEL*BLANKS   WWSESN
     C                     MOVELDDREF2    WWSESN
     C                     MOVELHHPOTI    WWPOTI
     C                     END
     C                     END
     C*
     C           WWMODI    IFEQ 'FF'
     C           WWMODI    OREQ 'DL'
     C           WWMODI    OREQ 'LE'
     C           WWMODI    OREQ 'FD'
     C           WWMODI    OREQ 'FL'
     C**********           Z-ADD*ZERO     WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWTRNB                                              CLE148
     C                     MOVELDDREF1    WWTRNB
     C                     MOVEL*BLANKS   WWCCY
     C                     Z-ADD0         WWACOD
     C                     Z-ADD0         WWACSQ
     C                     MOVEL*BLANKS   WWBRCA                          095249
     C                     MOVEL*BLANKS   WWSESN
     C                     MOVEL'T'       WWPOTI
     C                     END
     C*
     C***********WWMODI    IFEQ 'RE'                                      CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           WWMODI    ANDEQ'GL'                                      CPM004
     C           FCPORS    ORNE 'B'                                       CPM004
     C           WWMODI    ANDEQ'RE'                                      CPM004
     C***********          Z-ADD*ZERO     WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWCCY
     C                     MOVELNAR8      WWCCY
     C                     MOVEL*BLANKS   WWACOD
     C                     MOVELNAR12     WWACOD
     C                     MOVEL*BLANKS   WWACSQ
     C                     MOVELNAR17     WWACSQ
     C                     MOVEL*BLANKS   WWBRCA                          095249
     C                     MOVELNAR16     WWBRCA                          095249
     C                     MOVEL*BLANKS   WWSESN
     C                     MOVEL'T'       WWPOTI
     C                     END
     C*
     C           EZKEY     ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** ZWTR   S/R TO WRITE A LINE ON SUBFILE
     C** CALLED FROM S/R P1005...P1011
     C*****************************************************************
     C*
     C           ZWTR      BEGSR
     C*
     C                     ADD  1         NNR
     C                     ADD  1         RRN
     C                     Z-ADD0         WWW     10
     C                     MOVE '0'       *IN29
     C                     WRITEPM0150S0
     C*
     C           EZWTR     ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** ZRAZ   S/R TO UPDATE SUBFILE FIELDS WITH BLANK
     C** CALLED FROM S/R P1002-P1005...P1011
     C*****************************************************************
     C*
     C           ZRAZ      BEGSR
     C                     MOVEL*BLANKS   HHFPTF
     C                     Z-ADD0         HHTNLU
     C                     MOVEL*BLANKS   HHPOTI
     C                     MOVEL*BLANKS   DDMODI
     C                     MOVEL*BLANKS   DDNAR1
     C                     MOVEL*BLANKS   DDREF1
     C                     MOVEL*BLANKS   DDCCY1
     C                     MOVEL*BLANKS   DDNOM1
     C                     MOVEL*BLANKS   DDIND1
     C                     MOVEL*BLANKS   DDPTRS
     C                     MOVEL*BLANKS   DDMOD2
     C                     MOVEL*BLANKS   DDNAR2
     C                     MOVEL*BLANKS   DDREF2
     C                     MOVEL*BLANKS   DDCCY2
     C                     MOVEL*BLANKS   DDNOM2
     C                     MOVEL*BLANKS   DDIND2
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C**********           Z-ADD*ZEROS    HHACUS                                       CPM004 CSD027
     C                     MOVE *BLANKS   HHACUS                                              CSD027
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C           EZRAZ     ENDSR
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C**  VCUST S/R TO VALIDATE CUST.NO. OR SHORTNAME
     C**  CALLS S/R => ZA0840
     C**
     C*   INPNM - INPUT FIELD      - LENGTH 10
     C*   OUTNB - CUSTOMER NUMBER  - LENGTH 6/0
     C*   ERRSW - ERROR CODE - 0 IF OK - 9 NOT THERE
     C*                      - 1 WRONG NUMBER
     C*                      - 2 WRONG SHORT NAME
     C**********************************************************************
     C*
     C           VCUST     BEGSR
     C**********           Z-ADD*ZEROS    OUTNB   60                                          CSD027
     C                     MOVE *BLANKS   OUTNB   6                                           CSD027
     C                     MOVE *ZEROS    ERRSW   1
     C*
     C**   PRESENT ?
     C           INPNM     IFEQ *ZEROS
     C           INPNM     OREQ *BLANK
     C                     MOVE '9'       ERRSW
     C                     ELSE
     C*                                                                   CPB001
     C                     MOVELINPNM     WWKY10                          CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   WWRTCD                          CPB001
     C                     PARM '*KEY    'WWOPTN                          CPB001
     C                     PARM           WWKY10                          CPB001
     C                     PARM *BLANKS   WWKYST  7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           WWRTCD    ANDEQ*BLANKS                                   CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVE '4'       ERRSW                           CPB001
     C                     ELSE                                           CPB001
     C*
     C****CHECK*NUMBER                                                    S01486
     C***********          MOVE *BLANKS   ZALPH                           S01486
     C***********          Z-ADD0         ZIDP                            S01486
     C***********          Z-ADD6         ZIINT                           S01486
     C***********          MOVE INPNM     ZALPH                           S01486
     C***********          EXSR ZA0840                                    S01486
     C***********                                                         S01486
     C***********ZERCD     IFEQ 0                                         S01486
     C***********                                                         S01486
     C*****Numeric field must be a valid customer number                  S01486
     C***********          MOVE ZAMT      CNUMA   6                       S01486
     C***********CNUMA     CHAINSDPLCSL2             71                   S01486
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM INPNM     WWKY10 10                       S01486
     C           SDPLCS    PARM SDPLCS    DSSDY                           S01486
     C************IN71     IFEQ '1'                                       S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C                     MOVE '1'       ERRSW
     C                     END
     C***********                                                         S01486
     C***********          ELSE                                           S01486
     C***********                                                         S01486
     C*****Alphabetic field must be a valid shortname                     S01486
     C***********          MOVE *BLANKS   SNKEY  10                       S01486
     C***********          MOVE INPNM     SNKEY                           S01486
     C***********SNKEY     CHAINSDPLCSL3             71                   S01486
     C************IN71     IFEQ '1'                                       S01486
     C***********          MOVE '2'       ERRSW                           S01486
     C***********          ELSE                                           S01486
     C***********          MOVE BBCUST    OUTNB                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C                     END
     C*                                                                   CPM004
     C** If Bank Portfolio is Supported, customer entered must be a       CPM004
     C** valid branch internal customer number                            CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           ERRSW     ANDEQ'0'                                       CPM004
     C           QBCUST    CHAINSDBRCHL5             50                   CPM004
     C           *IN50     IFEQ *ON                                       CPM004
     C                     MOVEL'3'       ERRSW                           CPM004
     C                     ELSE                                           CPM004
     C                     MOVELA8BRCD    WBRCA   3                       CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPB001
     C*
     C**   VALID  NUMBER
     C           ERRSW     IFEQ *ZEROS
     C***********ZERCD     ANDEQ*ZEROS                                    S01486
     C***********          Z-ADDZAMT      OUTNB                           S01486
     C***********          MOVE BBCUST    OUTNB                           S01486
     C                     MOVE QBCUST    OUTNB                           S01486
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************               S01486
     C***ZA0840 - Standard routine to transform                           S01486
     C********an alpha field into numeric field                           S01486
     C*****************************************************               S01486
     C***********                                                         S01486
     C***********ZA0840    BEGSR                                          S01486
     C***********                                                         S01486
     C***Initialize the fields and the arrays                             S01486
     C***********          MOVE '0'       *IN44                           S01486
     C***********          MOVE '0'       *IN42                           S01486
     C***********          Z-ADD0         ZERCD   10                      S01486
     C***********          Z-ADD0         ZAMT   150                      S01486
     C***********          MOVEA*BLANKS   ZG                              S01486
     C***********          MOVEAZALPH     ZF                              S01486
     C***********          MOVE *BLANKS   ZALPH  16                       S01486
     C***********          Z-ADD0         ZWK7    10                      S01486
     C***********          Z-ADD0         ZCADP   30                      S01486
     C***********          Z-ADD0         ZCINT   30                      S01486
     C***********          Z-ADD0         ZPIDP   30                      S01486
     C***********          Z-ADD0         ZPODP   30                      S01486
     C***********          Z-ADD0         I       30                      S01486
     C***********          Z-ADD0         J       30                      S01486
     C***********          Z-ADD0         K       30                      S01486
     C***********                                                         S01486
     C***define*the input fields                                          S01486
     C************LIKE     DEFN ZCADP     ZIDP                            S01486
     C************LIKE     DEFN ZCINT     ZIINT                           S01486
     C***********                                                         S01486
     C***first*check that the number input will not produce               S01486
     C***output*with more than 15 figures.                                S01486
     C***********ZIDP      ADD  ZIINT     ZWK2    20                      S01486
     C***********ZWK2      IFGT 15                                        S01486
     C***********          Z-ADD2         ZERCD                           S01486
     C***********          GOTO ZA0849                     367000         S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***work*through input array, ignoring leading zeros a               S01486
     C***also*blanking the leading zeros in the input array               S01486
     C***********          MOVE '0'       *IN43                           S01486
     C***********          ADD  1         I                               S01486
     C***********I         DOWLE16                                        S01486
     C************IN43     ANDEQ'0'                                       S01486
     C***********ZF,I      IFNE ' '                                       S01486
     C***********ZF,I      ANDNE'0'                                       S01486
     C***********          MOVE '1'       *IN43                           S01486
     C***********          SUB  1         I                               S01486
     C***********          END                                            S01486
     C***********          ADD  1         I                               S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***check*the integer part of the number for valid cha               S01486
     C***********I         DOWLE16                                        S01486
     C***********ZF,I      ANDNE'.'                                       S01486
     C***********ZF,I      ANDNE' '                                       S01486
     C***********                                                         S01486
     C***check*for non numeric characters                                 S01486
     C***********ZF,I      IFGT '9'                                       S01486
     C***********ZF,I      ORLT '0'                                       S01486
     C***********          Z-ADD0         ZAMT                            S01486
     C***********          Z-ADD1         ZERCD                           S01486
     C***********          GOTO ZA0849                     367000         S01486
     C***********                                                         S01486
     C***********          ELSE                                           S01486
     C***********                                                         S01486
     C***********          ADD  1         ZCINT                           S01486
     C***********                                                         S01486
     C***check*number of integers is not greater than that                S01486
     C***********ZCINT     IFGT ZIINT                                     S01486
     C***********          Z-ADD0         ZAMT                            S01486
     C***********          Z-ADD2         ZERCD                           S01486
     C***********          GOTO ZA0849                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***multiply*the output amount by 10 then add the numb               S01486
     C***the*input array element being processed.                         S01486
     C***********ZAMT      MULT 10        ZAMT                            S01486
     C***********          MOVE ZF,I      ZWK7                            S01486
     C***********ZAMT      ADD  ZWK7      ZAMT                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***increase array index                                             S01486
     C***********          ADD  1         I                               S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***set*up*position of decimal point in input array                  S01486
     C***********          Z-ADDI         ZPIDP                           S01486
     C***********                                                         S01486
     C***if*the*character pointed to is a decimal point add               S01486
     C***index***                                                         S01486
     C***********I         IFLE 16                                        S01486
     C***********ZF,I      ANDEQ'.'                                       S01486
     C***********          ADD  1         I                               S01486
     C***********          MOVE '1'       *IN42                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***now*validate the decimal part of the number                      S01486
     C***********I         DOWLE16                                        S01486
     C***********                                                         S01486
     C****f*a*blank is found set on the blank input indicat               S01486
     C***********ZF,I      IFEQ ' '                                       S01486
     C***********          MOVE '1'       *IN44                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***if*the*figure is numeric, check that the number of               S01486
     C***places*does not exceed that specified, and that no               S01486
     C***have*been entered.                                               S01486
     C***********ZF,I      IFGE '0'                                       S01486
     C***********ZF,I      ANDLE'9'                                       S01486
     C***********          ADD  1         ZCADP                           S01486
     C***********                                                         S01486
     C***********ZCADP     IFGT ZIDP                                      S01486
     C***********          Z-ADD0         ZAMT                            S01486
     C***********          Z-ADD2         ZERCD                           S01486
     C***********          GOTO ZA0849                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C************IN44     IFEQ '1'                                       S01486
     C***********          Z-ADD0         ZAMT                            S01486
     C***********          Z-ADD1         ZERCD                           S01486
     C***********          GOTO ZA0849                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***update*output amount                                             S01486
     C***********ZAMT      MULT 10        ZAMT                            S01486
     C***********          MOVE ZF,I      ZWK7                            S01486
     C***********          ADD  ZWK7      ZAMT                            S01486
     C***********                                                         S01486
     C***********          ELSE                                           S01486
     C***********                                                         S01486
     C***if*the*character is not numeric and not a blank th               S01486
     C***invalid*                                                         S01486
     C***********ZF,I      IFNE ' '                                       S01486
     C***********          Z-ADD0         ZAMT                            S01486
     C***********          Z-ADD1         ZERCD                           S01486
     C***********          GOTO ZA0849                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***increase index                                                   S01486
     C***********          ADD  1         I                               S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***correct*the output number for any decimal places n               S01486
     C***in*the*alpha field.                                              S01486
     C***********ZIDP      SUB  ZCADP     K                               S01486
     C***********                                                         S01486
     C***increase the index by one to get correct array ent               S01486
     C***********          ADD  1         K                               S01486
     C***********ZAMT      MULT ZH,K      ZAMT                            S01486
     C***********                                                         S01486
     C***now*format the output alpha field, first calculate               S01486
     C***the*decimal point goes                                           S01486
     C***********16        SUB  ZIDP      ZPODP                           S01486
     C***********ZPODP     SUB  1         ZPIDP                           S01486
     C***********                                                         S01486
     C***if*there are no decimal points set the position to               S01486
     C***********ZIDP      IFEQ 0                                         S01486
     C***********          Z-ADD17        ZPODP                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***move*the output number into the input array                      S01486
     C***********          MOVEA*BLANKS   ZF                              S01486
     C***********          MOVE ZAMT      ZAMTA  15                       S01486
     C***********          MOVEAZAMTA     ZF                              S01486
     C***********                                                         S01486
     C***set*up*indexes                                                   S01486
     C***********          Z-ADD1         I                               S01486
     C***********          Z-ADD1         J                               S01486
     C***********          MOVE '0'       *IN40                           S01486
     C***********                                                         S01486
     C***now*fill up the output array                                     S01486
     C***********J         DOWLE16                                        S01486
     C***********                                                         S01486
     C***insert*decimal point if the position is found                    S01486
     C***********J         IFEQ ZPODP                                     S01486
     C***********          MOVE '.'       ZG,J                            S01486
     C***********          ADD  1         J                               S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***insert*the zero before the decimal point                         S01486
     C************IN40     IFEQ '0'                                       S01486
     C***********J         ANDEQZPIDP                                     S01486
     C***********ZF,I      ANDEQ'0'                                       S01486
     C***********          MOVE '1'       *IN40                           S01486
     C***********          MOVE '0'       ZG,J                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***blank*leading zeros                                              S01486
     C************IN40     IFEQ '0'                                       S01486
     C***********ZF,I      ANDEQ'0'                                       S01486
     C***********          MOVE ' '       ZG,J                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***move*a*normal character                                          S01486
     C***********ZF,I      IFGE '1'                                       S01486
     C***********ZF,I      ANDLE'9'                                       S01486
     C***********          MOVE ZF,I      ZG,J                            S01486
     C***********          MOVE '1'       *IN40                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***non*blanked zero                                                 S01486
     C***********ZF,I      IFEQ '0'                                       S01486
     C************IN40     ANDEQ'1'                                       S01486
     C***********          MOVE '0'       ZG,J                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          ADD  1         I                               S01486
     C***********          ADD  1         J                               S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***put*output array into output amount                              S01486
     C***********          MOVEAZG        ZALPH                           S01486
     C***********                                                         S01486
     C***align*figure with zero decimal places.                           S01486
     C***********ZIDP      IFEQ 0                                         S01486
     C***********          MOVE *BLANKS   ZALP1  17                       S01486
     C***********          MOVE ZALPH     ZALP1                           S01486
     C***********          MOVELZALP1     ZALPH                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********ZA0849    ENDSR                                          S01486
     C**********************************************************************
      /EJECT
      /COPY ZSRSRC,ZEDITZ2
      /EJECT
     C********************************************************************
     C*
     C*  ZFSELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR SECURITIES TRADING REL.2
     C*
     C*  FORMAT: XXX 999.9999 DDMMMYY
     C*          XXX =  NOMINAL CURRENCY
     C*          999.9999 = CONPON RATE
     C*          DDMMMYY = MATURITY DATE
     C*
     C*  INPUT  FIELDS
     C*       ZNMCY   3A     NOMINAL CURRENCY
     C*       ZCPNR  117     COUPON RATE
     C*       ZMATY   50     MATURITY DATE
     C*       ZPROT   1A     PROCESSING TYPE
     C*
     C*  OUTPUT  FIELDS
     C********ZLIN***20A*****LINE*DESCRIPTION**************************                       CGL029
      *       ZLIN   24A     LINE DESCRIPTION                                                 CGL029
     C*
     C*  ARRAY USED
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFSELN    BEGSR                           *** ZFSELN ***
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C** MOVE NOMINNAL CURRENCY TO LINE DESCRIPTION
     C                     MOVEAZNMCY     ZLI,01
     C*
     C** IF PROCESSING TYPE     NOT COMMODITIES ZPROT = 2
     C**                        NOT EQUITIES    ZPROT = 4
     C**                        NOT UNIT TRUSTS ZPROT = 7
     C           ZPROT     IFNE '2'
     C           ZPROT     ANDNE'4'
     C           ZPROT     ANDNE'7'
     C*
     C** MOVE COUPON  RATE  TO LINE DESCRIPTION
     C                     Z-ADDZCPNR     ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C**********           MOVE ZWRKN     ZWRKA4  4                                           CGL029
     C                     MOVE ZWRKN     ZWRKA4 10                                           CGL029
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C** MOVE MATURITY DATE TO LINE DESCRIPTION
     C                     Z-ADDZMATY     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C           ZADATE    IFNE *BLANK
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C                     END
     C                     END
     C*
     C** SET ALL   FIELDS TO BLANKS OR ZEROS
     C                     MOVE *BLANKS   ZNMCY   3
     C                     MOVE *BLANKS   ZPROT   1
     C                     Z-ADD*ZEROS    ZCPNR  117
     C                     Z-ADD*ZEROS    ZMATY   50
     C*
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN   24                                           CGL029
     C*
     C                     ENDSR
     C*******************************************************************
      /EJECT
     C********************************************************************S01486
     C***********                                                         S01486
     C***ZFFFLN*SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTIONS01486
     C***********                       FOR FUTURE & OPTIONS              S01486
     C***********                                                         S01486
     C***FORMAT:*XXX MMMYY X 9999.999                                     S01486
     C***********XXX = INSTRUMENT CURRENCY                                S01486
     C***********MMMYY = MONTH/YEAR                                       S01486
     C***********X = PUT/CALL INDICATOR                                   S01486
     C***********999.9999 = STRIKE PRICE                                  S01486
     C***********                                                         S01486
     C***INPUT**FIELDS                                                    S01486
     C********ZISCY   3A     INSTRUMENT CURRENCY                          S01486
     C********ZMTHN   20     MONTH NUMBER                                 S01486
     C********ZYRNO   20     YEAR NUMBER                                  S01486
     C********ZPCAL   1A     PUT/CALL INDICATOR                           S01486
     C********ZSTRP  117     STRIKE PRICE                                 S01486
     C***********                                                         S01486
     C***OUTPUT**FIELDS                                                   S01486
     C********ZLIN   20A     LINE DESCRIPTION                             S01486
     C***********                                                         S01486
     C***ARRAY*USED                                                       S01486
     C********ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG                   S01486
     C***********                                                         S01486
     C********************************************************************S01486
     C***********ZFFFLN    BEGSR                           *** ZFFFLN *** S01486
     C***********                                                         S01486
     C***CLEAR*LINE DESCRIPTION .                                         S01486
     C***********          MOVEA*BLANKS   ZLI                             S01486
     C***********                                                         S01486
     C***MOVE*INTRUMENT CURRENCY TO LINE DESCRIPTION                      S01486
     C***********          MOVEAZISCY     ZLI,01                          S01486
     C***********                                                   59581 S01486
     C***IF*MARKET INSTRUMENT, RETRIEVE D                           59581 S01486
     C***********ISTI      IFEQ 'N'                                 59581 S01486
     C***********                                                         S01486
     C***MOVE*MONTH NAME TO LINE DESCRIPTION                              S01486
     C***********          Z-ADDZMTHN     ZC      30                      S01486
     C***********          MOVEAZMNM,ZC   ZWRKA3                          S01486
     C***********          MOVEAZWRKA3    ZLI,05                          S01486
     C***********                                                         S01486
     C***MOVE*YEAR  NAME TO LINE DESCRIPTION                              S01486
     C***********          MOVE ZYRNO     ZWRKA2  2                       S01486
     C***********          MOVEAZWRKA2    ZLI,08                          S01486
     C***********          END                                       59581S01486
     C***********                                                         S01486
     C***MOVE*PUT/CALL INDICATOR TO LINE DESCRIPTION                      S01486
     C***********          MOVEAZPCAL     ZLI,11                          S01486
     C***********                                                         S01486
     C***IF*OPTION (STRIKE PRICE NOT ZERO) OUTPUT STRIKE PRICE IN ARRAY   S01486
     C***OTHERWISE LEAVE SECTION OF ARRAY BLANK                           S01486
     C***********ZSTRP     IFNE 0                                         S01486
     C***********                                                         S01486
     C***********          Z-ADDZSTRP     ZWRKN   74                      S01486
     C***********          MOVELZWRKN     ZWRKA3  3                       S01486
     C***********          MOVELZWRKA3    ZWRKA2  2                       S01486
     C***********                                                         S01486
     C***SUPRESS*LEADING ZEROES                                           S01486
     C***********ZWRKA2    IFEQ '00'                                      S01486
     C***********          MOVEL'  '      ZWRKA3                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          MOVELZWRKA3    ZWRKA1  1                       S01486
     C***********ZWRKA1    IFEQ '0'                                       S01486
     C***********          MOVEL' '       ZWRKA3                          S01486
     C***********          END                                            S01486
     C***********          MOVE ZWRKN     ZWRKA4  4                       S01486
     C***********          MOVEAZWRKA3    ZLI,13                          S01486
     C***********          MOVEA'.'       ZLI,16                          S01486
     C***********          MOVEAZWRKA4    ZLI,17                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***SET*ALL*  FIELDS TO BLANKS OR ZEROS                              S01486
     C***********          MOVE *BLANKS   ZISCY   3                       S01486
     C***********          Z-ADD*ZEROS    ZYRNO   20                      S01486
     C***********          Z-ADD*ZEROS    ZMTHN   20                      S01486
     C***********          MOVE *BLANKS   ZPCAL   1                       S01486
     C***********          Z-ADD*ZEROS    ZSTRP  117                      S01486
     C***********                                                         S01486
     C***********          MOVEAZLI       ZLIN   20                       S01486
     C***********                                                         S01486
     C***********          ENDSR                                          S01486
     C**************************************************************************
      /EJECT                                                              S71062
     C********************************************************************S71062
     C*                                                                   S71062
     C*  ZFFFLN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTIONS71062
     C*                                 FOR FUTURE & OPTIONS              S71062
     C*                                                                   S71062
     C*  FORMAT: XXX MMMYY X 9999.999                                     S71062
     C*          XXX = INSTRUMENT CURRENCY                                S71062
     C*          MMMYY = MONTH/YEAR                                       S71062
     C*          X = PUT/CALL INDICATOR                                   S71062
     C*          999.9999 = STRIKE PRICE                                  S71062
     C*                                                                   S71062
     C*  INPUT  FIELDS                                                    S71062
     C*       ZISCY   3A     INSTRUMENT CURRENCY                          S71062
     C*       ZMTHN   20     MONTH NUMBER                                 S71062
     C*       ZYRNO   20     YEAR NUMBER                                  S71062
     C*       ZPCAL   1A     PUT/CALL INDICATOR                           S71062
     C********ZSTRP**117*****STRIKE*PRICE***************************S71062CFF004
     C*       ZSTRP  158     STRIKE PRICE                                 CFF004
     C*                                                                   S71062
     C*  OUTPUT  FIELDS                                                   S71062
     C********ZLIN***20A*****LINE*DESCRIPTION**************************                S71062 CGL029
      *       ZLIN   24A     LINE DESCRIPTION                                                 CGL029
     C*                                                                   S71062
     C*  ARRAY USED                                                       S71062
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG                   S71062
     C*                                                                   S71062
     C********************************************************************S71062
     C           ZFFFLN    BEGSR                           *** ZFFFLN *** S71062
     C*                                                                   S71062
     C** CLEAR LINE DESCRIPTION .                                         S71062
     C                     MOVEA*BLANKS   ZLI                             S71062
     C*                                                                   S71062
     C** MOVE INTRUMENT CURRENCY TO LINE DESCRIPTION                      S71062
     C                     MOVEAZISCY     ZLI,01                          S71062
     C*                                                                   S71062
     C** IF MARKET INSTRUMENT, RETRIEVE DATE                              S71062
     C           ISTI      IFEQ 'N'                                       S71062
     C*                                                                   S71062
     C** MOVE MONTH NAME TO LINE DESCRIPTION                              S71062
     C                     Z-ADDZMTHN     ZC      30                      S71062
     C                     MOVEAZMNM,ZC   ZWRKA3                          S71062
     C                     MOVEAZWRKA3    ZLI,05                          S71062
     C*                                                                   S71062
     C** MOVE YEAR  NAME TO LINE DESCRIPTION                              S71062
     C                     MOVE ZYRNO     ZWRKA2  2                       S71062
     C                     MOVEAZWRKA2    ZLI,08                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** MOVE PUT/CALL INDICATOR TO LINE DESCRIPTION                      S71062
     C                     MOVEAZPCAL     ZLI,11                          S71062
     C*                                                                   S71062
     C** IF OPTION (STRIKE PRICE NOT ZERO) OUTPUT STRIKE PRICE IN ARRAY   S71062
     C** OTHERWISE LEAVE SECTION OF ARRAY BLANK                           S71062
     C           ZSTRP     IFNE 0                                         S71062
     C*                                                                   S71062
     C                     Z-ADDZSTRP     ZWRKN   74                      S71062
     C                     MOVELZWRKN     ZWRKA3  3                       S71062
     C                     MOVELZWRKA3    ZWRKA2  2                       S71062
     C*                                                                   S71062
     C** SUPRESS LEADING ZEROES                                           S71062
     C           ZWRKA2    IFEQ '00'                                      S71062
     C                     MOVEL'  '      ZWRKA3                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C                     MOVELZWRKA3    ZWRKA1  1                       S71062
     C           ZWRKA1    IFEQ '0'                                       S71062
     C                     MOVEL' '       ZWRKA3                          S71062
     C                     END                                            S71062
     C**********           MOVE ZWRKN     ZWRKA4  4                                    S71062 CGL029
     C                     MOVE ZWRKN     ZWRKA4                                              CGL029
     C                     MOVEAZWRKA3    ZLI,13                          S71062
     C                     MOVEA'.'       ZLI,16                          S71062
     C                     MOVEAZWRKA4    ZLI,17                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** SET ALL   FIELDS TO BLANKS OR ZEROS                              S71062
     C                     MOVE *BLANKS   ZISCY   3                       S71062
     C                     Z-ADD*ZEROS    ZYRNO   20                      S71062
     C                     Z-ADD*ZEROS    ZMTHN   20                      S71062
     C                     MOVE *BLANKS   ZPCAL   1                       S71062
     C***********          Z-ADD*ZEROS    ZSTRP  117                S71062CFF004
     C           *LIKE     DEFN STRP      ZSTRP                           CFF004
     C                     Z-ADD*ZEROS    ZSTRP                           CFF004
     C*                                                                   S71062
     C**********           MOVEAZLI       ZLIN   20                                    S71062 CGL029
     C                     MOVEAZLI       ZLIN                                                CGL029
     C*                                                                   S71062
     C                     ENDSR                                          S71062
     C********************************************************************S71062
      /EJECT
     C********************************************************************
     C*
     C*  ZFLELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR LENDING
     C*
     C*  FORMAT: XXX 999.9999 DDMMMYY
     C*          XXX =  LOAN CURRENCY
     C*          999.9999 = INTEREST RATE
     C*          DDMMMYY = MATURITY DATE
     C*
     C*  INPUT  FIELDS
     C*       ZCCY    3A     LOAN CURRENCY
     C*       ZINRT  117     INTEREST RATE
     C*       ZMDAT   50     MATURITY DATE
     C*
     C*  OUTPUT  FIELDS
     C********ZLIN***20A*****LINE*DESCRIPTION**************************                       CGL029
      *       ZLIN   24A     LINE DESCRIPTION                                                 CGL029
     C*
     C*  ARRAY USED
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFLELN    BEGSR
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C**   BUILD FORMAT
     C*
     C** MOVE LOAN CURRENCY TO LINE DESCRIPTION
     C                     MOVEAZCCY      ZLI,01
     C*
     C** MOVE INTEREST RATE TO LINE DESCRIPTION
     C                     Z-ADDZINRT     ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C*
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C*
     C** MOVE INTEREST DETAILS INTO OUTPUT ARRAY
     C***********          MOVE ZWRKN     ZWRKA4  4                                           CGL029
     C                     MOVE ZWRKN     ZWRKA4                                              CGL029
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C** MOVE MATURITY DATE TO LINE DESCRIPTION
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C*
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C**
     C** SET ALL   FIELDS TO BLANKS OR ZEROS
     C                     MOVE *BLANKS   ZCCY    3
     C                     Z-ADD*ZEROS    ZINRT  117
     C                     Z-ADD*ZEROS    ZMDAT   50
     C**
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN                                                CGL029
     C**
     C                     ENDSR
     C*******************************************************************
      /EJECT
     C********************************************************************
     C*
     C*    ZFRELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR RETAIL
     C*
     C*  FORMAT: 999999 XXX 9999 99
     C*
     C*          999999 CUSTOMER NUMBER
     C*          XXX = CURRENCY
     C*          9999 = ACCOUNT CODE
     C*          99 = ACCOUNT SEQUENCE
     C*
     C*  INPUT  FIELDS
     C*       ZCNUM   60     CUSTOMER NUMBER
     C*       ZCCY    3A     CURRENCY
     C*       ZACOD   40     ACCOUNT CODE
     C*       ZACSQ   20     ACCOUNT SEQUENCE
     C*
     C*  OUTPUT  FIELDS
     C********ZLIN***20A*****LINE*DESCRIPTION**************************                       CGL029
      *       ZLIN   24A     LINE DESCRIPTION                                                 CGL029
     C*
     C*  ARRAY USED
     C*      ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFRELN    BEGSR                           *** ZFRELN ***
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C** MOVE CUSTOMER NUMBER TO LINE DESCRIPTION
     C                     MOVE ZCNUM     ZWRKA6  6
     C                     MOVEAZWRKA6    ZLI,01
     C*
     C** MOVE CURRENCY TO LINE DESCRIPTION
     C***********          MOVEAZCCY      ZLI,08                          085862
     C                     MOVEAZCCY      ZLI,07                          085862
     C*
     C** MOVE ACCUONT CODE TO LINE DESCRIPTION
     C**********           MOVE ZACOD     ZWRKA4  4                                           CGL029
     C                     MOVE ZACOD     ZWRKA4                                              CGL029
     C***********          MOVEAZWRKA4    ZLI,12                          085862
     C                     MOVEAZWRKA4    ZLI,10                          085862
     C*
     C** MOVE ACCUONT SEQUENCE TO LINE DESCRIPTION
     C                     MOVE ZACSQ     ZWRKA2  2
     C***********          MOVEAZWRKA2    ZLI,17                          085862
     C**********           MOVEAZWRKA2    ZLI,14                                       085862 CGL029
     C**********           MOVEAZBRCA     ZLI,16                                       085862 CGL029
     C                     MOVEAZWRKA2    ZLI,20                                              CGL029
     C                     MOVEAZBRCA     ZLI,22                                              CGL029
     C**
     C**  SET ALL   FIELDS TO BLANKS OR ZEROS
     C**********           Z-ADD*ZEROS    ZCNUM   60                                          CSD027
     C                     MOVE *BLANKS   ZCNUM   6                                           CSD027
     C                     MOVE *BLANKS   ZCCY    3
     C**********           Z-ADD*ZEROS    ZACOD   40                                          CGL029
     C                     Z-ADD*ZEROS    ZACOD  100                                          CGL029
     C                     Z-ADD*ZEROS    ZACSQ   20
     C                     MOVE *BLANKS   ZBRCA                           085862
     C**
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN                                                CGL029
     C**
     C                     ENDSR
     C**************************************************************************
      /EJECT
     C********************************************************************
     C*
     C*  ZFDLLN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR DEALING
     C*
     C*  CASE 1 FX DEALS (DEALSDB)        FORMAT: YYY VVVVVVV(DDDDDDD)
     C*          YYY = CUSTOMER SELL CURRENCY (IE BANK BUY CURRENCY)
     C*          VVVVVVV = VALUE DATE IN DDMMMYY FORMAT
     C*          DDDDDDD = DEAL DATE IN DDMMMYY FORMAT
     C*
     C*  CASE 2 MM DEALS (DEALSDC)        FORMAT: XXX 999.9999 DDMMMYY
     C*                                        OR: XXX 999.9999 999
     C*          XXX = CURRENCY
     C*          999.9999 = INTEREST RATE
     C*          DDMMMYY = MATURITY DATE (IF MATURITY DATE NOT = 0)
     C*          999 = NOTICE DAYS       (IF MATURITY DATE = 0 )
     C*
     C*  CASE 3 FRA/IRS DEALS (DEALSDG) DEAL TYPES FR, RS AND RL
     C*                                    FORMAT: XXX 999.9999 DDMMMYY
     C*          XXX = CURRENCY
     C*          999.9999 = INTEREST RATE
     C*          DDMMMYY = MATURITY DATE
     C*
     C*  CASE 4 FRA/IRS DEALS (DEALSDG) DEAL TYPE  RX
     C*                                    FORMAT: XXX XXX DDMMMYY
     C*          XXX = OUR AND THEIR CURRENCY
     C*          DDMMMYY = MATURITY DATE
     C*
     C*
     C*  INPUT  FIELDS
     C*       ZPUCY   3A     PURCHASE CURRENCY
     C*       ZDDAT   50     DEAL DATE
     C*       ZVDAT   50     VALUE DATE
     C*       ZCCY    3A     CURRENCY
     C*       ZINRT  117     INTEREST RATE
     C*       ZMDAT   50     MATURITY DATE
     C*       ZNOTD   30     NOTICE DAYS
     C*       ZUCUCY  3A     FRA/IRS OUR CURRENCY
     C*       ZUEINR 117     FRA/IRS OUR INTEREST RATE
     C*       ZTCUCY  3A     FRA/IRS THEIR CURRENCY
     C*
     C*  OUTPUT  FIELDS
     C********ZLIN***20A*****LINE*DESCRIPTION**************************                       CGL029
      *       ZLIN   24A     LINE DESCRIPTION                                                 CGL029
     C*
     C*  ARRAY USED
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFDLLN    BEGSR                           *** ZFDLLN ***
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C** FORMAT DETAIL OUTPUT FOR DEAL TYPE CASE 1
     C           ZDDAT     IFNE 0
     C                     MOVEAZPUCY     ZLI,01
     C                     Z-ADDZVDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C*
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,05
     C                     MOVEA'('       ZLI,12
     C*
     C                     Z-ADDZDDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C*
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,13
     C                     MOVEA')'       ZLI,20
     C                     END
     C*
     C** FORMAT DETAIL OUTPUT FOR DEAL TYPE CASE 2
     C           ZCCY      IFNE *BLANKS
     C                     MOVEAZCCY      ZLI,01
     C                     Z-ADDZINRT     ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C*
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C*
     C**********           MOVE ZWRKN     ZWRKA4  4                                           CGL029
     C                     MOVE ZWRKN     ZWRKA4                                              CGL029
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C** IF MATURITY DATE ZERO OUTPUT NOTICE DAYS TO FORMATTED LINE
     C           ZMDAT     IFEQ *ZERO
     C                     MOVE ZNOTD     ZWRKA3  3
     C                     MOVEAZWRKA3    ZLI,14
     C                     ELSE
     C*
     C** OTHERWISE OUTPUT MATURITY DATE
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C                     END
     C*
     C                     END
     C*
     C** FORMAT DETAIL OUTPUT FOR DEAL TYPE CASE 3
     C           ZUCUCY    IFNE *BLANKS
     C           ZTCUCY    ANDEQ*BLANKS
     C                     MOVEAZUCUCY    ZLI,01
     C                     Z-ADDZUEINR    ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C*
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C*
     C**********           MOVE ZWRKN     ZWRKA4  4                                           CGL029
     C                     MOVE ZWRKN     ZWRKA4                                              CGL029
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C*
     C                     END
     C*
     C** FORMAT DETAIL OUTPUT FOR DEAL TYPE CASE 4
     C           ZUCUCY    IFNE *BLANKS
     C           ZTCUCY    ANDNE*BLANKS
     C                     MOVEAZUCUCY    ZLI,01
     C                     MOVEAZTCUCY    ZLI,05
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,09
     C*
     C                     END
     C*
     C** SET ALL  FIELDS TO BLANK OR ZERO
     C                     MOVE *BLANKS   ZCCY    3
     C                     MOVE *BLANKS   ZSLCY   3
     C                     Z-ADD*ZEROS    ZVDAT   50
     C                     MOVE *BLANKS   ZPUCY   3
     C                     Z-ADD*ZEROS    ZINRT  117
     C                     Z-ADD*ZEROS    ZDDAT   50
     C                     Z-ADD*ZEROS    ZMDAT   50
     C                     Z-ADD*ZEROS    ZNOTD   30
     C                     MOVE *BLANKS   ZUCUCY  3
     C                     Z-ADD*ZEROS    ZUEINR 117
     C                     MOVE *BLANKS   ZTCUCY  3
     C*
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN                                                CGL029
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C*******************************************************************
     C**                                                              *
     C**  ZTNLU1 SR. - TO LOCK THE TRANSACTION NUMBER DATA AREA,      *
     C**  ~~~~~~~~~~   ACCESS THE NEXT AVAILABLE TRANSACTION NUMBER,  *
     C**               THEN UPDATE AND RELEASE THE DATA AREA.         *
     C**                                                              *
     C*****************************************************************
     C*
     C           ZTNLU1    BEGSR
     C*
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C*
     C                     ENDSR
     C*****************************************************************
      /EJECT
     C********************************************************************
     C** ZPEND- S/R TO END THE PROGRAM
     C** CALLED FROM MAIN PROCESSING
     C*****************************************************************===
     C*
     C           ZPEND     BEGSR                           ** ZPEND BSR **
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     CLOSESDBRCHL5                                  CPM004
     C                     ENDIF                                          CPM004
     C*
     C** IF "SE" MODULE IS PRESENT
     C           BGSECS    IFEQ 'Y'
     C           FCPORS    ANDNE'B'                                       CPM004
     C****                 CLOSEPMHPOSLL                                  S01313
     C                     CLOSEPMPOSDLL                                  56555
     C                     CLOSESECTY
     C                     CLOSETRADPT
     C***********          CLOSEDPTMPT                                    S01486
     C                     CLOSEPMDPTML0                                  S01486
     C                     END
     C***********                                                         S01486
     C***IF*"FF"*MODULE IS PRESENT                                        S01486
     C***********BGFUOP    IFEQ 'Y'                                       S01486
     C***********          CLOSETRANSPT                                   S01486
     C***********          CLOSEINTYP                                     S01486
     C***********          END                                            S01486
     C*                                                                   S71062
     C** IF "FF" MODULE IS PRESENT                                        S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           BGFUOP    IFEQ 'Y'                                       S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C                     CLOSETRANSPT                                   S71062
     C                     CLOSEINTYP                                     S71062
     C                     END                                            S71062
     C*
     C** IF "DL" MODULE IS PRESENT
     C           BGDLFX    IFEQ 'Y'
     C           BGDLMM    ANDEQ'Y'
     C***********          CLOSEDEALSPT
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     CLOSECUSDB                                     CPM004
     C                     ELSE                                           CPM004
     C                     CLOSEPMDEALL0
     C                     ENDIF                                          CPM004
     C***********          CLOSESDDTSTPP                                  S01486
     C                     CLOSEFDDTSTL1                                  S01486
     C                     END
     C*
     C** IF "LE" MODULE IS PRESENT
     C           BGCSLN    IFEQ 'Y'
     C***********          CLOSECLOANPT                                   S01486
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     CLOSECLOANB                                    CPM004
     C                     ELSE                                           CPM004
     C                     CLOSEPMCLONL1                                  S01486
     C                     ENDIF                                          CPM004
     C***********          CLOSESDLOANL1                                  S01486
     C                     END
     C*
     C** IF "RE" MODULE IS PRESENT
     C           BGRTBN    IFEQ 'Y'
     C***********          CLOSEACCNTPT                                   S01486
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     CLOSEACCBR                                     CPM004
     C                     ELSE                                           CPM004
     C                     CLOSEPMACCNL1                                  S01486
     C                     ENDIF                                          CPM004
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,PM0150CCP4                                           S01408
     C*                                                                   S01408
     C***IF*"FI"*MODULE IS PRESENT                                        S01486
     C***********BGFLND    IFEQ 'Y'                                       S01486
     C***********          CLOSEFIDPLNPT                                  S01486
     C***IF*"DL"*MODULE NOT PRESENT                                       S01486
     C***********WWFLG     IFNE 'Y'                                       S01486
     C***********          CLOSESDDTSTPP                                  S01486
     C***********          END                                            S01486
     C***IF*"LE"*MODULE NOT PRESENT                                       S01486
     C***********BGCSLN    IFNE 'Y'                                       S01486
     C***********          CLOSESDLOANL1                                  S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C*
     C                     MOVE '1'       *INLR
     C           EZPND     ENDSR                           ** END ZPEND **
     C********************************************************************
      /EJECT
     C*****************************************************************   R00300
     C*                                                               *   R00300
     C* ZASNMS   - Send message to program message queue              *   R00300
     C*                                                               *   R00300
     C* CALLS    Y2SNMSGC                                             *   R00300
     C*                                                               *   R00300
     C* CALLED BY   P1016 - To update Portfolio Transfer details.     *   R00300
     C*             V1002 - Validate key fields.                      *   R00300
     C*             V1004 - Validate Portfolio Transfer subfile.      *   R00300
     C*             V1015 - Validate 'Transfer all holdings' prompt.  *   R00300
     C*                                                               *   R00300
     C*****************************************************************   R00300
     C           ZASNMS    BEGSR                                          R00300
     C*                                                                   R00300
     C                     CALL 'Y2SNMGC'                                 R00300
     C                     PARM           ZAPGM            Program queue  R00300
     C                     PARM           ZAPGRL           Rel queue      R00300
     C                     PARM           ZAMSID           Message Id.    R00300
     C                     PARM           ZAMSGF           Message file.  R00300
     C                     PARM           ZAMSDA           Message data.  R00300
     C                     PARM           ZAMSTP           Message type.  R00300
     C*                                                                   R00300
     C** Clear all fields for default mechanism next time.                R00300
     C                     MOVEL*BLANK    ZAPGM            Message queue  R00300
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      R00300
     C                     MOVEL*BLANK    ZAMSDA           Message data.  R00300
     C                     MOVEL*BLANK    ZAMSTP           Message type.  R00300
     C*                                                                   R00300
     C           ZASNM9    ENDSR                           ZASNM9 TAG     R00300
     C*                                                                   R00300
     C*****************************************************************   R00300
      /EJECT
     C********************************************************************
     C**
     C** *PSSR  S/R
     C** CALLED FROM
     C** CALLS NO OTHER S/R'S
     C**
     C********************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C                     SETON                     U7U8LR
     C*
     C** ROLL BACK CHANGES, PRINT DUMP AND CANCEL PROGRAM
     C                     ROLBK
     C                     DUMP
     C                     CALL 'DBERRCTL'                                S01486
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C**  ARRAY REMOVED WITH REMOVAL OF SR ZA0840                         S01486
     C*** array of powers of 10 from 0 to 8                               S01486
     C*000000000000001                                                    S01486
     C*000000000000010                                                    S01486
     C*000000000000100                                                    S01486
     C*000000000001000                                                    S01486
     C*000000000010000                                                    S01486
     C*000000000100000                                                    S01486
     C*000000001000000                                                    S01486
     C*000000010000000                                                    S01486
     C*000000100000000                                                    S01486
     C*000001000000000                                                    S01486
     C*000010000000000                                                    S01486
     C*000100000000000                                                    S01486
     C*001000000000000                                                    S01486
     C*010000000000000                                                    S01486
     C*100000000000000                                                    S01486
     C********************************************************************
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
