     H        1                                                           S01486
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM SE daily transactions extract')               *
     H***********                                                         S01486
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM0390  - SE DAILY TRANSACTION EXTRACT                       *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM004             Date 08Feb96               *
      *                 085867             Date 16Mar95               *
     F*                 081353             DATE 09JAN95               *
     F*                 081368             DATE 13DEC94               *
     F*                 S01486             DATE 03OCT94               *
     F*                 56448 LJ           DATE 14JUN93               *
     F*                 S01313             DATE 06NOV92               *
     F*                 36362      DT      DATE 26FEB92               *
     F*                 B9991      DT      DATE 13NOV91               *
     F*                 B9930      ADIF    DATE 13NOV91               *
     F*                 B07831             DATE 23MAY91               *
     F*                 R05915             DATE 24APR91               *
     F*                 R05880             DATE 24APR91               *
     F*                 R05856             DATE 22APR91               *
     F*                 R10040             DATE 19SEP90               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CSE015 - Forward Valued Depto Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
     F*  CPM004 - Bank Portfolios.                                    *
     F*  085867 - Change Pay A/C and Rec A/C to have the branch code  *
     F*  081353 - Remove ZSFILE coding                                *
     F*  081368 - Instrument typa blank causes Data Base error.       *
     F*  S01486 - Portfolio Management Upgrade to R10                 *
     F*  56448  - LAST CHANGE TYPE INCORRECT FOR DELETED TRADE        *
     F*  S01313 - RECOMPILED DUE TO PORTFOLIO PERFORMANCE             *
     F*  36362  - USE DEFAULT INSTRUMENT TYPE WHEN DBTE 04            *
     F*  B9991  - ADDING OF SOME FIELDS TO IMPROVE PM0400P1 REPORT    *
     F*  B9930  - WRONG ACCOUNT NAME ON REPORT PM0400P1               *
     F*           FIELD ANAM NOT DEFINED IN FILE ACNUM                *
     F*  B07831 - SET AMOUNT OF REALLOWANCE TO ZERO EACH TIME         *
     F*  R05915 - OUTPUT AMOUNT OF REALLOWANCE                        *
     F*  R05880 - TRANSACTIONS INSERTED AND DELETED ON SAME DAY       *
     F*           SHOULD NOT BE OUPUT ON REPORT                       *
     F*  R05856 - IF TRADE AMENDMENT AND DATE MADE COMPLETE *EQ TO    *
     F*           RUN DATE OUTPUT LAST ACTION OF 'I'                  *
     F*  R10040 - OUTPUT ACCOUNT NAME                                 *
     F*                                                               *
     F*****************************************************************
     F***PM0390AUO***E                    PRINTER                         S01486
     F**PM0390AUO   E                    PRINTER      KINFDS SPOOLUS01486 081353
     FPM0390AUO   E                    PRINTER                            081353
     F****PREFIX*OF*SDPORTPD*IS 'P9'                                36362 S01486
     F***SDPORTPDIF**E                    DISK         KINFSR *PSSR 36362 S01486
     F***SDBANKPDIF**E                    DISK                            S01486
     F***PREFIX*BJ***                                                     S01486
     F***************                               KINFSR *PSSR          S01486
     F***PMTRCNZZUF**E           K        DISK                      A     S01486
     FPMTRCNPAUF  E           K        DISK                      A        S01486
     F** PREFIX SA
     F                                              KINFSR *PSSR
     F***PMTRCNPPO***E           K        DISK                            S01486
     FPMTRCNPDO   E           K        DISK                               S01486
     F** PREFIX SA
     F                                              KINFSR *PSSR
     F***SDCUSTL0IF**E           K        DISK                            S01486
     F***PREFIX*BB***                                                     S01486
     F***************                               KINFSR *PSSR          S01486
     F***SDCURRL0IF**E           K        DISK                     R05915 S01486
     F***PREFIX*A6***                                              R05915 S01486
     F***************                               KINFSR *PSSR   R05915 S01486
     FINVTP   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F***SDPLINPDIF**E           K        DISK                            S01486
     F***PREFIX*PD***                                                     S01486
     F***************                               KINFSR *PSSR          S01486
     FSECTY   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F***DPTMVQ1*IS**E           K        DISK                            S01486
     FPMDPTML1IS  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F***TRADSQ1*IP**E           K        DISK                            S01486
     FPMTRADL1IP  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     FACCNT   IF  E           K        DISK                               R10040
     F            ACCNTAAF                          KIGNORE               R10040
     F            ACCNTACF                          KIGNORE               R10040
     F                                              KINFSR *PSSR          R10040
     F*ACNUM   IF  E           K        DISK                        R10040B9930
     FACNUMA  IF  E           K        DISK                               B9930
     F                                              KINFSR *PSSR          R10040
     F            ACCNTABF                          KRENAMEACNUMTBF       R10040
     F***SDACOFL0IF**E           K        DISK                     B9991  S01486
     F***PREFIX*AZ***                                              B9991  S01486
     F***************                               KINFSR *PSSR   B9991  S01486
     FPMDSPGL3IF  E           K        DISK                               B9991
     F** PREFIX PA                                                        B9991
     F                                              KINFSR *PSSR          B9991
      /EJECT
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*    UNUSED INDICATORS
     F*    -----------------
     F*       ..  ..  03  04  05  06  07  08  09  10
     F*       11  12  13  14  15  16  17  18  19  20
     F*       21  22  23  24  25  26  27  28  29  30
     F*       31  32  33  34  35  36  37  38  39  40
     F*       41  42  43  44  45  46  47  48  49  50
     F*       51  52  53  54  55  56  57  58  59  60
     F*       61  62  63  64  65  66  67  68  69  70
     F*       ..  ..  73  74  75  76  77  78  79  80
     F*       81  82  83  84  85  86  87  ..  89  90                      S01486
     F*       91  92  93  94  95  96  97  98  99
     F*
     F*
     F**   INDICATOR USAGE
     F**   ---------------
     F*
     F**   01      TRADE DETAILS READ
     F**   02      DEPOT MOVEMENT READ
     F**   71      FIRST CYCLE
     F**   72      FILES ACCESS INDICATOR
     F*
      /EJECT
     F*
     F**   SUB-ROUTINE DEFINITIONS
     F**   -----------------------
     F*
     F**   #INIT    INITIAL PROCESSING
     F**   #P01     EXTRACT SE TRADES
     F**   #P02     EXTRACT SE DEPOT MOVEMENTS
     F**   #P03     AUDIT PROCESSING
     F**   #W01     WRITE SE TRADES TO TRANSACTION REPORT CONTROL
     F**************FILE (PF/PMTRCNPP)                                    S01486
     F**            FILE (PF/PMTRCNPD)                                    S01486
     F**   #W02     WRITE SE DEPOT MOVEMENT TO TRANSACTION REPORT CONTROL
     F************* FILE (PF/PMTRCNPP)                                    S01486
     F**            FILE (PF/PMTRCNPD)                                    S01486
     F**   #W0301   WRITE TO TRANSACTION REPORT CONTROL  FILE
     F**   #W0302   WRITE TO RE DAILY TRANSACTION EXTRACT AUDIT REPORT
     F**   #SECT    ACCESS SECURITY DETAILS
     F**   #INVT    ACCESS INVESTMENT TYPE DETAILS
     F**   #INST    ACCESS PM INSTRUMENT TYPE DETAILS
     F**   #CUST    ACCESS CUSTOMER DETAILS
     F**   ZFSELN   TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     F**                                FOR SE 2
     F*
      /EJECT
      /COPY ZSRSRC,ZDATE2Z1
     E*
     E** FORMAT SE DETAILS FOR OUTPUT
     E                    ZLI        20  1
     E*
     E**   Array for copyright
     E                    CPY@    1   1 80               COPYRIGHT
      /COPY ZSRSRC,ZPOWER8Z1                                              R05915
      /EJECT
     I*
     ITRADSDF     01
     IDPTMVDF     02
     I*
     I** DATA STRUCTURE TO REDEFINE INVESTMENT KEY
     I            DS
     I                                        1   6 DSKEY
     I                                        1   3 NMCY
     I                                        4   6 SITP
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA*****   UDS                            256                    S01486
     I***********                           132 183 DBLOT                 S01486
     I***********                           132 141 DBFILE                S01486
     ILDA         DS                            256                       S01486
     I                                      134 183 DBLOT                 S01486
     I                                      134 141 DBFILE                S01486
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I*                                                                   CPM004
     I** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
     I** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
     ISDBANK    E DSSDBANKPD                                              S01486
     I** EXTERNAL DS FOR BANK DETAILS                                     S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I** EXTERNAL DS FOR PORTFOLIO DETAILS                                S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I** EXTERNAL DS FOR CUSTOMER DETAILS                                 S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I** EXTERNAL DS FOR CURRENCY DETAILS                                 S01486
     ISDPLIN    E DSSDPLINPD                                              S01486
     I** EXTERNAL DS FOR INSTRUMENT DETAILS                               S01486
     ISDPLCS    E DSSDPLCSPD                                              CPM004
     I**  SD Portfolio Management Customer details                        CPM004
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, LONG  DATA STRUCTURE                S01486
     I*****SPOOLU      DS                                          S01486 081353
     I************************************** 83  92 SFILEU         S01486 081353
     I*********************************** B 123 1240SFNUMU         S01486 081353
     I*********************************** B 367 3680LINE1          S01486 081353
     I*
      /EJECT
     C*****************************************************************
     C*   K E Y   L I S T S
     C*================================================================
     C*
     C**   KEY TO ACCESS THE INVESTMENT TYPES FILE
     C           P1KEY     KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*****************************************************************
     C*                                                               *
     C*  P R O G R A M     I N I T I A L I S A T I O N                *
     C*                                                               *
     C*****************************************************************
     C*
     C** PERFORM INITIAL PROCESSING
     C           WW390     IFEQ *BLANK
     C                     EXSR #INIT
     C                     END
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C*
     C**     MAIN    -  MAIN  PROCESSING
     C*
     C** SAVE CHANGE TYPE
     C           *IN01     IFEQ '1'                                       R05880
     C           RECI      IFEQ 'D'                                       R05880
     C                     MOVE 'I'       WWCHTP                          R05880
     C                     ELSE                                           R05880
     C           RECI      IFEQ 'A'                                       R05880
     C                     MOVE 'A'       WWCHTP                          R05880
     C                     ELSE                                           R05880
     C           RECI      IFEQ '*'                                       R05880
     C           RECI      OREQ 'C'                                       56448
     C                     MOVE 'D'       WWCHTP                          R05880
     C                     END                                            R05880
     C                     END                                            R05880
     C                     END                                            R05880
     C*                                                                   R05856
     C** IF TRADE COMPLETED TODAY OUPUT CHANGE TYPE OF 'I'                R05856
     C           RECI      IFEQ 'A'                                       R05856
     C           TDMC      ANDEQBJRDNB                                    R05856
     C                     MOVE 'I'       WWCHTP                          R05856
     C                     END                                            R05856
     C                     END                                            R05880
     C*                                                                   R05880
     C           *IN02     IFEQ '1'                                       R05880
     C                     MOVE CHTP      WWCHTP                          R05880
     C                     END                                            R05880
     C*
     C** WRITE SE TRADE TO TRANSACTION REPORT CONTROL
     C           *IN01     IFEQ '1'
     C                     EXSR #P01
     C                     END
     C*
     C** WRITE SE DEPOT MOVEMENT TO TRANSACTION REPORT CONTROL
     C           *IN02     IFEQ '1'
     C                     EXSR #P02
     C                     END
     C*
     C** EXSR P03  - AUDIT PROCESSING
     CLR                   EXSR #P03
     C*
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #P01          -  PROCESS SE TRADES
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS         -  #W01   - WRITE TRADES TO TRANSACTIONS FILE
     C**                    #SECT  - ACCESS SECURITY DETAILS
     C**                    #INVT    ACCESS INVESTMENT TYPE DETAILS
     C**                    #INST  - ACCESS PM INSTRUMENT TYPE DETAILS
     C**                    #CUST  - ACCESS CUSTOMER DETAILS
     C**
     C*=========================================================================
     C*
     C           #P01      BEGSR                           *** #P01   ***
     C*
     C** WHEN CHANGE OF SECURITY, ACCESS THE NEW SECURITY,
     C** INVESTMENT TYPE AND PM INSTRUMENT TYPE DETAILS
     C           TDSS      IFNE WWTDSS
     C                     MOVE TDSS      WWSECS
     C                     EXSR #SECT
     C                     EXSR #INVT
     C                     EXSR #INST
     C                     MOVE TDSS      WWTDSS
     C                     END
     C*
     C** WHEN CHANGE OF CUSTOMER, ACCESS THE NEW CUSTOMER DETAILS
     C           TCNR      IFNE WWTCNR
     C                     MOVE TCNR      WWPNP8
     C                     EXSR #CUST
     C**********           Z-ADDTCNR      WWTCNR                                              CSD027
     C                     MOVE TCNR      WWTCNR                                              CSD027
     C                     END
     C*                                                                   CPM004
     C** When change of booking branch, access branch internal customer   CPM004
     C** number, branch customer report name and branch a/c officer       CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           TDBA      ANDNEWWBRCA                                    CPM004
     C                     MOVELTDBA      I#BRCA                          CPM004
     C                     EXSR #BRCA                                     CPM004
     C                     MOVELTDBA      WWBRCA  3                       CPM004
     C                     END                                            CPM004
     C*
     C                     EXSR #W01
     C***                  ADD  1         TRACPT  50                      56448
     C*
     C                     ENDSR                           *** #P01 END **
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #P02          -  PROCESS SE DEPOT MOVEMENTS
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS         -  #W02 - WRITE DEPOT MOVEMENTS TO
     C**                           TRANSACTIONS FILE
     C**                    #SECT  - ACCESS SECURITY DETAILS
     C**                    #INVT    ACCESS INVESTMENT TYPE DETAILS
     C**                    #INST  - ACCESS PM INSTRUMENT TYPE DETAILS
     C**                    #CUST  - ACCESS CUSTOMER DETAILS
     C**
     C*=========================================================================
     C*
     C           #P02      BEGSR                           *** #P02   ***
     C*
     C** WHEN CHANGE OF SECURITY, ACCESS THE NEW SECURITY,
     C** INVESTMENT TYPE AND PM INSTRUMENT TYPE DETAILS
     C           DPSS      IFNE WWDPSS
     C                     MOVE DPSS      WWSECS
     C                     EXSR #SECT
     C                     EXSR #INVT
     C                     EXSR #INST
     C                     MOVE DPSS      WWDPSS
     C                     END
     C*
     C** WHEN CHANGE OF CUSTOMER, ACCESS THE NEW CUSTOMER DETAILS
     C           DPBN      IFNE WWDPBN
     C                     MOVE DPBN      WWPNP8
     C                     EXSR #CUST
     C**********           Z-ADDDPBN      WWDPBN                                              CSD027
     C                     MOVE DPBN      WWDPBN                                              CSD027
     C                     END
     C*                                                                   CPM004
     C** When change of booking branch, access branch internal customer   CPM004
     C** number, branch customer report name and branch a/c officer       CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           DPBA      ANDNEWWBRCA                                    CPM004
     C                     MOVELDPBA      I#BRCA                          CPM004
     C                     EXSR #BRCA                                     CPM004
     C                     MOVELDPBA      WWBRCA                          CPM004
     C                     END                                            CPM004
     C*
     C                     EXSR #W02
     C                     ADD  1         DPTCPT  50
     C*
     C                     ENDSR                           *** #P02 END **
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #W01          -  WRITE TRADES TO TRANSACTIONS FILE
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #W01      BEGSR                           *** #W01   ***
     C*
     C                     MOVE 'D'       SARECI
     C                     MOVE BBACOC    SAACOC
     C**********           Z-ADDTCNR      SACNUM                                              CSD027
     C                     MOVE TCNR      SACNUM                                              CSD027
     C                     MOVE PTFR      SAPTFR
     C                     MOVE PDINNR    SAINNR
     C                     MOVE 'SE'      SAMODI
     C                     MOVE TDRF      SATRNB
     C                     MOVE TDTP      SATRTP
     C                     MOVE *BLANKS   SATRST
     C                     MOVE TDSS      SATDSS
     C                     Z-ADDTNMD      SANMDP
     C                     MOVE SPBS      SASPBS
     C                     Z-ADD*ZERO     SASEQA
     C                     Z-ADDTDDT      SADDAT
     C                     Z-ADDTDVD      SAVDAT
     C                     Z-ADD*ZEROS    SAMDAT
     C**********           Z-ADDTDBR      SABRCD                          S01486
     C                     MOVELTDBA      SABRCD                          S01486
     C                     Z-ADDNOML      SAAMT1
     C                     Z-ADD*ZEROS    SAAMT2
     C                     MOVE TNMC      SACCY1
     C                     MOVE SETC      SACCY2
     C                     Z-ADDTPDY      SAPRC1
     C                     Z-ADDPRIC      SAPRC2
     C                     Z-ADDTDER      SARATA
     C                     Z-ADDSPXR      SARATB
     C                     MOVE TMDI      SAMDV1
     C                     MOVE SPMD      SAMDV2
     C**********           Z-ADD*ZEROS    SABRT1                                              CSD103
     C                     MOVE *BLANKS   SABRT1                                              CSD103
     C**********           Z-ADD*ZEROS    SABRT2                                              CSD103
     C                     MOVE *BLANKS   SABRT2                                              CSD103
     C                     Z-ADD*ZEROS    SARAI1
     C                     Z-ADD*ZEROS    SARAI2
     C                     MOVE *BLANKS   SAFRQ1
     C                     MOVE *BLANKS   SAFRQ2
     C                     Z-ADD*ZEROS    SAIPD1
     C                     Z-ADD*ZEROS    SAIPD2
     C                     Z-ADD*ZEROS    SANDYS
     C                     Z-ADD*ZEROS    SAAINT
     C                     MOVE *BLANKS   SABROK
     C                     Z-ADD*ZEROS    SASWOD
     C                     MOVE ACIN      SAACRI
     C                     Z-ADDITRA      SAPURI
     C*******              Z-ADDRALL      SAVAL1                          R05915
     C                     Z-ADD0         SAVAL1                          B07831
     C*                                                                   R05915
     C** ACCESS THE CURRENCY DETAILS FILE USING THE CURRENCY CODE         R05915
     C           RALL      IFNE 0                                         R05915
     C***********NMCY      CHAINSDCURRL0             72            R05915 S01486
     C***********                                                  R05915 S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM NMCY      WWKEY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C**   PERFORM DATABASE IN ERROR PROCESSING IF NO RECORD FOUND        R05915
     C************IN72     IFEQ '1'                                R05915 S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVELNMCY      DBKEY                           R05915
     C                     MOVEL'12'      DBASE            ***************R05915
     C***********          MOVEL'SDCURRL0'DBFILE    * DB ERROR 02 *R05915 S01486
     C                     MOVE 'SDCURRPD'DBFILE           * DB ERROR 02 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************R05915
     C                     END                                            R05915
     C*                                                                   R05915
     C** CALCULATE AMOUNT OF REALLOWANCE VIA SR/ZAPNUM                    R05915
     C                     Z-ADDNOML      ZNOML                           R05915
     C                     Z-ADDRALL      ZAVPR                           R05915
     C                     Z-ADDNMDP      ZNMDP                           R05915
     C                     Z-ADDA6NBDP    ZNMCD                           R05915
     C                     MOVE SPBS      ZPRCB                           R05915
     C                     EXSR ZAPNUM                                    R05915
     C                     Z-ADDZVALU     SAVAL1                          R05915
     C                     END                                            R05915
     C*                                                                   R05915
     C                     Z-ADDTBCA      SAVAL2
     C                     ADD  TCCA      SAVAL2
     C                     ADD  TCA1      SAVAL2
     C                     ADD  TCA2      SAVAL2
     C                     ADD  TCA3      SAVAL2
     C                     ADD  TCA4      SAVAL2
     C                     ADD  TCA5      SAVAL2
     C                     ADD  TCA6      SAVAL2
     C                     ADD  TCA7      SAVAL2
     C                     MOVE PDDSPG    SARCOA
     C                     MOVE PDITDS    SARSEA
     C                     MOVELSRPN      SAT1XT
     C                     MOVE NMCY      ZNMCY
     C                     Z-ADDCPNR      ZCPNR
     C                     Z-ADDMATY      ZMATY
     C                     MOVE PROT      ZPROT
     C                     EXSR ZFSELN
     C                     MOVE ZLIN      SAT2XT
     C                     MOVE *BLANKS   SACOMC
     C                     MOVE *BLANKS   SACFRQ
     C                     Z-ADD0         SANCDT
     C*
     C           TDTP      IFEQ 'TP'
     C                     MOVE SMTH      SAPAYM
     C                     MOVE PYFM      SAPYAC
     C                     MOVE PYFA      SAPYBR                          085867
     C*
     C                     MOVE SAPAYM    WWSETM                          R10040
     C                     MOVE SAPYAC    WWSTAC                          R10040
     C                     MOVE SAPYBR    WWBRCA                          085867
     C                     EXSR #P40                                      R10040
     C                     MOVE WWANAM    SAPYNM                          R10040
     C*
     C                     MOVE *BLANKS   SARCVM
     C                     MOVE *BLANKS   SARCAC
     C                     MOVE *BLANKS   SARCNM                          R10040
     C                     MOVE *BLANKS   SARCBR                          085867
     C                     ELSE
     C                     MOVE *BLANKS   SAPAYM
     C                     MOVE *BLANKS   SAPYAC
     C                     MOVE *BLANKS   SAPYNM                          R10040
     C                     MOVE *BLANKS   SAPYBR                          085867
     C                     MOVE SMTH      SARCVM
     C                     MOVE PAYT      SARCAC
     C                     MOVE PYTA      SARCBR                          085867
     C*
     C                     MOVE SARCVM    WWSETM                          R10040
     C                     MOVE SARCAC    WWSTAC                          R10040
     C                     MOVE SARCBR    WWBRCA                          085867
     C                     EXSR #P40                                      R10040
     C                     MOVE WWANAM    SARCNM                          R10040
     C*
     C                     END
     C*
     C                     MOVE *BLANKS   SACGST
     C                     MOVE *BLANKS   SACGAD
     C                     MOVE WWCHTP    SACHTP
     C                     MOVE BBCRNM    SACRNM
     C                     MOVE PDISTN    SAISTN
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVELO#ACOF    SABACO                          CPM004
     C                     MOVELO#BICN    SABCNM                          CPM004
     C                     MOVELO#CRNM    SABCRN                          CPM004
     C                     END                                            CPM004
     C*                                                                   R05880
     C** IF TRANSACTION INSERTED & DELETED TODAY DO NOT OUTPUT DETAILS    R05880
     C           SACHTP    IFNE 'D'                                       R05880
     C           TOED      ORNE BJRDNB                                    R05880
     C                     WRITEPMTRCNP0
     C                     ADD  1         TRACPT  50                      56448
     C                     END                                            R05880
     C*
     C                     ENDSR                           *** #W01 END **
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #W02          -  WRITE DEPOT MOVEMENTS TO TRANSACTIONS FILE
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #W02      BEGSR                           *** #W02   ***
     C*
     C                     MOVE 'D'       SARECI
     C                     MOVE BBACOC    SAACOC
     C**********           Z-ADDDPBN      SACNUM                                              CSD027
     C                     MOVE DPBN      SACNUM                                              CSD027
     C                     MOVE PTFR      SAPTFR
     C                     MOVE PDINNR    SAINNR
     C                     MOVE 'SE'      SAMODI
     C                     MOVE DPRN      SATRNB
     C                     MOVE DPMV      SATRTP
     C                     MOVE *BLANKS   SATRST
     C                     MOVE DPSS      SATDSS
     C                     Z-ADDNMDP      SANMDP
     C                     MOVE SPBS      SASPBS
     C                     Z-ADD*ZERO     SASEQA
     C                     Z-ADD*ZERO     SADDAT
     C           DPDO      IFEQ *ZERO
     C                     Z-ADDDPMD      SAVDAT
     C                     ELSE
     C                     Z-ADDDPDO      SAVDAT
     C                     END
     C                     Z-ADD*ZEROS    SAMDAT
     C**********           Z-ADDDPBC      SABRCD                          S01486
     C                     MOVELDPBA      SABRCD                          S01486
     C                     Z-ADDDPNA      SAAMT1
     C                     Z-ADD*ZEROS    SAAMT2
     C                     MOVE NMCY      SACCY1
     C                     MOVE *BLANKS   SACCY2
     C                     Z-ADDMKTP      SAPRC1
     C                     Z-ADD*ZERO     SAPRC2
     C                     Z-ADD*ZERO     SARATA
     C                     Z-ADD*ZERO     SARATB
     C                     MOVE *BLANK    SAMDV1
     C                     MOVE *BLANK    SAMDV2
     C**********           Z-ADD*ZEROS    SABRT1                                              CSD103
     C                     MOVE *BLANKS   SABRT1                                              CSD103
     C**********           Z-ADD*ZEROS    SABRT2                                              CSD103
     C                     MOVE *BLANKS   SABRT2                                              CSD103
     C                     Z-ADD*ZEROS    SARAI1
     C                     Z-ADD*ZEROS    SARAI2
     C                     MOVE *BLANKS   SAFRQ1
     C                     MOVE *BLANKS   SAFRQ2
     C                     Z-ADD*ZEROS    SAIPD1
     C                     Z-ADD*ZEROS    SAIPD2
     C                     Z-ADD*ZEROS    SANDYS
     C                     Z-ADD*ZEROS    SAAINT
     C                     MOVE *BLANKS   SABROK
     C                     Z-ADD*ZEROS    SASWOD
     C                     MOVE *BLANK    SAACRI
     C                     Z-ADD*ZEROS    SAPURI
     C                     Z-ADD*ZEROS    SAVAL1
     C                     Z-ADD*ZEROS    SAVAL2
     C                     MOVE PDDSPG    SARCOA
     C                     MOVE PDITDS    SARSEA
     C                     MOVELSRPN      SAT1XT
     C                     MOVE NMCY      ZNMCY
     C                     Z-ADDCPNR      ZCPNR
     C                     Z-ADDMATY      ZMATY
     C                     MOVE PROT      ZPROT
     C                     EXSR ZFSELN
     C                     MOVE ZLIN      SAT2XT
     C                     MOVE *BLANKS   SACOMC
     C                     MOVE *BLANKS   SACFRQ
     C                     Z-ADD0         SANCDT
     C                     MOVE *BLANKS   SAPAYM
     C                     MOVE *BLANKS   SAPYAC
     C                     MOVE *BLANKS   SAPYNM                          R10040
     C                     MOVE *BLANKS   SARCVM
     C                     MOVE *BLANKS   SARCAC
     C                     MOVE *BLANKS   SARCNM                          R10040
     C                     MOVE *BLANKS   SACGST
     C                     MOVE *BLANKS   SACGAD
     C                     MOVE WWCHTP    SACHTP
     C                     MOVE BBCRNM    SACRNM
     C                     MOVE PDISTN    SAISTN
     C                     MOVE *BLANKS   SAPYBR                          085867
     C                     MOVE *BLANKS   SARCBR                          085867
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVELO#ACOF    SABACO                          CPM004
     C                     MOVELO#BICN    SABCNM                          CPM004
     C                     MOVELO#CRNM    SABCRN                          CPM004
     C                     END                                            CPM004
     C*
     C** IF TRANSACTION INSERTED & DELETED TODAY DO NOT OUTPUT DETAILS    R05880
     C           SACHTP    IFNE 'D'                                       R05880
     C           ORED      ORNE BJRDNB                                    R05880
     C                     WRITEPMTRCNP0
     C                     END                                            R05880
     C*
     C                     ENDSR                           *** #W02 END **
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #SECT           -  ACCESS SECURITY DETAILS
     C**
     C**   CALLED BY #P01  -  TRADES PROCESSING
     C**             #P02  -  DEPOT MOVEMENTS PROCESSING
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #SECT     BEGSR                           * #SECT  BEGS *
     C*
     C**   ACCESS THE SECURITY DETAILS FILE USING THE SECURITY SHORTNAME
     C           WWSECS    CHAINSECTY                72
     C*
     C**   PERFORM DATABASE IN ERROR PROCESSING IF NO RECORD FOUND
     C           *IN72     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVELWWSECS    DBKEY
     C                     MOVEL'02'      DBASE            ***************
     C***********          MOVEL'SECTY   'DBFILE           * DB ERROR 02 *S01486
     C                     MOVE 'SECTY   'DBFILE           * DB ERROR 02 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C*
     C                     ENDSR                           * #SECT  ENDS**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #INVT           -  ACCESS INVESTMENT TYPE DETAILS
     C**
     C**   CALLED BY #P01  -  TRADES PROCESSING
     C**             #P02  -  DEPOT MOVEMENTS PROCESSING
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #INVT     BEGSR                           * #INVT  BEGS *
     C*
     C**   ACCESS THE INVESTMENT TYPES FILE USING SECURITY INVESTMENT
     C**   TYPE AND NOMINAL CURRENCY
     C           P1KEY     CHAININVTP                72
     C*
     C**   PERFORM DATABASE IN ERROR PROCESSING IF NO LIVE RECORD FOUND
     C           *IN72     IFEQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE '1'       *IN72
     C                     END
     C*
     C           *IN72     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVELDSKEY     DBKEY
     C                     MOVEL'03'      DBASE            ***************
     C***********          MOVEL'INVT    'DBFILE           * DB ERROR 03 *S01486
     C                     MOVE 'INVT    'DBFILE           * DB ERROR 03 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C*
     C                     ENDSR                           * #INVT  ENDS**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #INSTP          -  ACCESS PM INSTRUMENT TYPE DETAILS
     C**
     C**   CALLED BY #P01  -  TRADES PROCESSING
     C**             #P02  -  DEPOT MOVEMENTS PROCESSING
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #INST     BEGSR                           * #INST BEGS *
     C*
     C**   ACCESS THE INSTRUMENT TYPES FILE USING THE PM INSTRUMENT TYPE
     C**   FROM THE INVESTMENT TYPE
     C*
     C           INNR      IFEQ *BLANKS                                   S01486
     C***********1         SETLLSDPORTPD                            36362 S01486
     C***********          READ SDPORTPD                 72         36362 S01486
     C***********          MOVE P9DINR    INNR                      36362 S01486
     C***********          CALL 'AOPORTR0'                         S01486 CPM004
     C***********          PARM '*MSG    'WWRTCD  7                S01486 CPM004
     C***********          PARM '*FIRST  'WWOPTN  7                S01486 CPM004
     C***********SDPORT    PARM SDPORT    DSFDY                    S01486 CPM004
     C***********WWRTCD    IFEQ *BLANKS                            081368 CPM004
     C                     MOVE FCDINR    INNR                            081368
     C***********          ELSE                                    081368 CPM004
     C************LOCK     IN   LDA                                081368 CPM004
     C***********          MOVEL'READ   ' DBKEY                    081368 CPM004
     C***********          MOVEL'15'      DBASE            ********081368 CPM004
     C***********          MOVEL'SDPORTPD'DBFILE           * DB ERRO081368S01486
     C***********          MOVE 'SDPORTPD'DBFILE           * DB ERRS01486 CPM004
     C***********          OUT  LDA                        ********081368 CPM004
     C***********          EXSR *PSSR                      ********081368 CPM004
     C***********          END                                     081368 CPM004
     C                     END                                      36362 S01486
     C***********INNR      CHAINSDPLINPD             72                   S01486
     C                     CALL 'AOPLINR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM INNR      WWKEY3  3                       S01486
     C           SDPLIN    PARM SDPLIN    DSSDY                           S01486
     C*
     C**   PERFORM DATABASE IN ERROR PROCESSING IF NO LIVE RECORD FOUND
     C************IN72     IFEQ '0'                                       S01486
     C           WWRTCD    IFEQ *BLANKS                                   S01486
     C           PDRECI    ANDEQ'*'
     C***********          MOVE '1'       *IN72                           S01486
     C                     MOVEL'*ERROR'  WWRTCD                          S01486
     C                     END
     C*
     C************IN72     IFEQ '1'                                       S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVELINNR      DBKEY
     C                     MOVEL'04'      DBASE            ***************
     C***********          MOVEL'SDPLINPD'DBFILE           * DB ERROR 04 *S01486
     C                     MOVE 'SDPLINPD'DBFILE           * DB ERROR 04 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C*                                                                   B9991
     C**   ACCESS THE DISPLAY GROUPS FILE                                 B9991
     C*                                                                   B9991
     C           PDDSPG    CHAINPMDSPGL3             72                   B9991
     C*                                                                   B9991
     C           *IN72     IFEQ '0'                                       B9991
     C                     MOVE PADSPS    SADSPS                          B9991
     C                     ELSE                                           B9991
     C                     MOVE *BLANKS   SADSPS                          B9991
     C                     END                                            B9991
     C*
     C                     ENDSR                           * #INST ENDS**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #CUST           -  ACCESS CUSTOMER DETAILS
     C**
     C**   CALLED BY #P01  -  TRADES PROCESSING
     C**             #P02  -  DEPOT MOVEMENTS PROCESSING
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #CUST     BEGSR                           * #CUST BEGS *
     C*
     C**   ACCESS THE CUSTOMER DETAILS FILE USING THE TRADE CUSTOMER
     C***********WWPNP8    CHAINSDCUSTL0             72                   S01486
     C***********                                                         S01486
     C************IN72     IFEQ '1'                                       S01486
     C                     MOVEL'*CNUM'   WWSORT  7                       S01486
     C                     MOVELWWPNP8    WWCSNM 10                       S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM WWCSNM    WWKY10 10                       S01486
     C                     PARM WWSORT    WWKE7   7                       S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVELWWPNP8    DBKEY
     C                     MOVEL'05'      DBASE            ***************
     C************         MOVEL'SDCUSTL0'DBFILE           * DB ERROR 05 *S01486
     C                     MOVE 'SDCUSTPD'DBFILE           * DB ERROR 05 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C*                                                                   B9991
     C**   ACCESS THE ACCOUNT OFFICERS FILE                               B9991
     C*                                                                   B9991
     C***********BBACOC    CHAINSDACOFL0             72             B9991 S01486
     C***********                                                   B9991 S01486
     C************IN72     IFEQ '0'                                 B9991 S01486
     C************         MOVE AZPRTL    SAPRTL                    B9991 S01486
     C************         ELSE                                     B9991 S01486
     C************         MOVE *BLANKS   SAPRTL                    B9991 S01486
     C************         END                                      B9991 S01486
     C*
     C                     ENDSR                           * #CUST ENDS**
     C*************************************************************************
      /EJECT                                                              CPM004
     C********************************************************************CPM004
     C**                                                                  CPM004
     C**   #BRCA           -  Access Branch Details                       CPM004
     C**                                                                  CPM004
     C**   CALLED BY #P01  -  Trades Processing                           CPM004
     C**             #P02  -  Depot Movements Processing                  CPM004
     C**                                                                  CPM004
     C**   CALLS     AOPLCSR1                                             CPM004
     C**                                                                  CPM004
     C*===================================================================CPM004
     C*                                                                   CPM004
     C           #BRCA     BEGSR                           * #BRCA BEGS * CPM004
     C*                                                                   CPM004
     C**   Access Branch Internal Customer, Branch Customer Report        CPM004
     C**   Name and Branch Account Officer.                               CPM004
     C*                                                                   CPM004
     C                     MOVEL'B'       I#PORS                          CPM004
      *                                                                   CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   @RTCD   7                       CPM004
     C                     PARM '*KEY   ' @OPTN   7                       CPM004
     C                     PARM           I@PARM                          CPM004
     C                     PARM *BLANKS   O@PARM                          CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM004
      *                                                                   CPM004
     C           @RTCD     IFEQ 'PMA0007'                                 CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVEL'16'      DBASE            ***************CPM004
     C                     MOVE 'SDBRCHPD'DBFILE           * DB ERROR 16 *CPM004
     C                     MOVELI#BRCA    DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C                     ENDSR                           * #BRCA ENDS** CPM004
     C********************************************************************CPM004
      /EJECT
     C*************************************************************************
     C**
     C**   #P03          -  AUDIT PROCESSING
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS #W0301  -  WRITE TO TRANSACTION REPORT CONTROL FILE
     C**         #W0302  -  WRITE TO TRANSACTION EXTRACT AUDIT REPORT
     C**
     C*=========================================================================
     C*
     C           #P03      BEGSR                           *** #P03   ***
     C*
     C** ACCESS PF/PMTRCNZZ - TRANSACTION REPORT CONTROL AUDIT FILE
     C                     MOVE '0'       *IN72
     C***********          READ PMTRCNZZ                 72               S01486
     C                     READ PMTRCNPA                 72               S01486
     C                     ADD  TRACPT    SANORE
     C                     ADD  DPTCPT    SANORE
     C                     MOVE 'D'       SARECI
     C*
     C** WRITE TO TRANSACTION REPORT CONTROL AUDIT FILE
     C                     EXSR #W0301
     C*
     C** WRITE TO SE DAILY TRANSACTIONS EXTRACT AUDIT REPORT
     C                     EXSR #W0302
     C*
     C                     ENDSR                           *** #P03 END **
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #W0301        -  WRITE TO TRANSACTION REPORT AUDIT FILE
     C**
     C**   CALLED BY     -  #P03 - AUDIT PROCESSING
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #W0301    BEGSR                           *** #W0301 ***
     C*
     C           *IN72     IFEQ '0'
     C                     UPDATPMTRCNZ0
     C                     ELSE
     C                     WRITEPMTRCNZ0
     C                     END
     C*
     C                     ENDSR                           ** #W0301 END*
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #W0301        -  WRITE TO DAILY TRANS. EXTRACT AUDIT REPORT
     C**
     C**   CALLED BY     -  #P03 - AUDIT PROCESSING
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #W0302    BEGSR                           *** #W0302 ***
     C*
     C                     WRITEPM0390P1
     C*
     C                     ENDSR                           ** #W0302 END*
     C*************************************************************************
      /EJECT
     C********************************************************************
     C*
     C*  ZFSELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR SECURITIES TRADING REL.2
     C*
     C*  FORMAT: XXX 999.9999 DDMMMYY
     C*          XXX =  NOMINAL CURRENCY
     C*          999.9999 = CONPON RATE
     C*          DDMMMYY = MATURITY DATE
     C*
     C*  INPUT  FIELDS
     C*       ZNMCY   3A     NOMINAL CURRENCY
     C*       ZCPNR  117     COUPON RATE
     C*       ZMATY   50     MATURITY DATE
     C*       ZPROT   1A     PROCESSING TYPE
     C*
     C*  OUTPUT  FIELDS
     C*       ZLIN   20A     LINE DESCRIPTION
     C*
     C*  ARRAY USED
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFSELN    BEGSR                           *** ZFSELN ***
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C** MOVE NOMINNAL CURRENCY TO LINE DESCRIPTION
     C                     MOVEAZNMCY     ZLI,01
     C*
     C** IF PROCESSING TYPE     NOT COMMODITIES ZPROT = 2
     C**                        NOT EQUITIES    ZPROT = 4
     C**                        NOT UNIT TRUSTS ZPROT = 7
     C           ZPROT     IFNE '2'
     C           ZPROT     ANDNE'4'
     C           ZPROT     ANDNE'7'
     C*
     C** MOVE COUPON  RATE  TO LINE DESCRIPTION
     C                     Z-ADDZCPNR     ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C                     MOVE ZWRKN     ZWRKA4  4
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C** MOVE MATURITY DATE TO LINE DESCRIPTION
     C                     Z-ADDZMATY     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C           ZADATE    IFNE *BLANK
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C                     END
     C                     END
     C*
     C** SET ALL   FIELDS TO BLANKS OR ZEROS
     C                     MOVE *BLANKS   ZNMCY   3
     C                     MOVE *BLANKS   ZPROT   1
     C                     Z-ADD*ZEROS    ZCPNR  117
     C                     Z-ADD*ZEROS    ZMATY   50
     C*
     C                     MOVEAZLI       ZLIN   20
     C*
     C                     ENDSR
     C*******************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C*****************************************************************
     C**
     C**   #INIT         -  TO GET BANK DETAILS
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #INIT     BEGSR                           ** #INIT **
     C*
     C           *LIKE     DEFN CHTP      WWCHTP           Change type
     C           *LIKE     DEFN TDSS      WWTDSS           Security TD
     C           *LIKE     DEFN DPSS      WWDPSS           Security DP
     C           *LIKE     DEFN TDSS      WWSECS           Security WK
     C           *LIKE     DEFN TCNR      WWTCNR           Customer TD
     C           *LIKE     DEFN DPBN      WWDPBN           Customer DP
     C           *LIKE     DEFN BBCUST    WWPNP8           Customer WK
     C*
      ***  Copyright Statement.                                           S01486
     C                     MOVEACPY@      CPY2@  80
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE *BLANKS   DBLOT
     C                     MOVEL'PM0390'  DBPGM
     C                     OUT  LDA                                       S01486
     C************         READ SDBANKPD                 72               S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM '*MSG   ' WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C*
     C** IF NOT FOUND, ABORT PROGRAM
     C************IN72     IFEQ '1'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE '01'      DBASE
     C***********          MOVEL'SDBANKPD'DBFILE            ************
     C                     MOVE 'SDBANKPD'DBFILE            * DATABASE *
     C                     OUT  LDA                         * ERROR 01 *  S01486
     C                     EXSR *PSSR                       ************  S01486
     C                     END
     C                     MOVEL'Y'       WW390   1
     C*
     C**  CHECK SYSTEM DATE FORMAT (DDMMYY OR MMDDYY):
     C           BJDFIN    IFEQ 'M'                        - B2
     C                     MOVE '1'       *IN98            ON => MMDDYY
     C                     END                             - E2
     C*                                                                   CPM004
     C** ACCESS PM ICD                                                    CPM004
     C*                                                                   CPM004
     C                     CALL 'AOPORTR0'                                CPM004
     C                     PARM *BLANKS   WWRTCD                          CPM004
     C                     PARM '*FIRST  'WWOPTN                          CPM004
     C           SDPORT    PARM SDPORT    DSFDY                           CPM004
     C           WWRTCD    IFNE *BLANKS                                   CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVEL'50'      DBASE            ***************CPM004
     C                     MOVE 'SDPORTPD'DBFILE           * DB ERROR 50 *CPM004
     C                     OUT  LDA                        ***************CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C********************                                         S01486 081353
     C****ENSURE*AUDIT*SPOOL*FILE*RECORDED*BY*RCF                  S01486 081353
     C********************                                         S01486 081353
     C******************** Z-ADDSFNUMU    ZSNUMU  60               S01486 081353
     C********************                                         S01486 081353
     C******************** CALL 'ZSFILE'                           S01486 081353
     C******************** PARM           SEQ     5                S01486 081353
     C******************** PARM *BLANKS   SENTY   3                S01486 081353
     C******************** PARM           SFILEU                   S01486 081353
     C******************** PARM           ZSNUMU                   S01486 081353
     C******************** PARM *BLANK    ZSERR   1                S01486 081353
     C********************                                         S01486 081353
     C********** ZSERR     IFEQ 'Y'                                S01486 081353
     C********************                                         S01486 081353
     C****ERROR*DURING*ZSFILE*PROCESSING,*RETURN*TO*CALLING*PROGRAMS01486 081353
     C********************                                         S01486 081353
     C******************** SETON                     U7U8LR        S01486 081353
     C******************** RETRN                                   S01486 081353
     C******************** END                                     S01486 081353
     C*
     C                     ENDSR                            ** #INIT ESR *
     C*****************************************************************   R10040
     C/EJECT                                                              R10040
     C*****************************************************************   R10040
     C*                                                                   R10040
     C*    #P40   - OBTAIN ACCOUNT NAME                                   R10040
     C*                                                                   R10040
     C*    INPUT PARAMETERS OF ACCOUNT NUMBER AND CURRENCY                R10040
     C*                                                                   R10040
     C*    OUTPUTS ACCOUNT NAME                                           R10040
     C*                                                                   R10040
     C*****************************************************************   R10040
     C           #P40      BEGSR                           * #P40   BSR * R10040
     C*                                                                   R10040
     C                     MOVE *BLANKS   WWANAM 20                       R10040
     C           ACNKEY    KLIST                                          R10040
     C                     KFLD           WWCNUK                          R10040
     C                     KFLD           SACCY1                          R10040
     C                     KFLD           WWACOK                          R10040
     C                     KFLD           WWACSK                          R10040
     C                     KFLD           WWBRCA                          085867
     C*                                                                   R10040
     C** IF SETTLED ACROSS A RETAIL ACCOUNT OBTAIN ACCOUNT NAME           R10040
     C           WWSETM    IFEQ '04'                                      R10040
     C           WWSETM    OREQ '05'                                      R10040
     C           WWSETM    OREQ '14'                                      R10040
     C           WWSETM    OREQ '15'                                      R10040
     C*                                                                   R10040
     C                     MOVE WWSTAC    WWCHK2  2                       R10040
     C*                                                                   R10040
     C** IF 10N ACCOUNT CODE ACCESS LF/ACNUM TO GET RETAIL ACCOUNT        R10040
     C** DETAILS                                                          R10040
     C           WWCHK2    IFEQ *BLANKS                                   R10040
     C           WWSTAC    ANDNE*BLANKS                                   R10040
     C                     MOVELWWSTAC    WWWK10 100                      R10040
     C*                                                                   R10040
     C***********WWWK10    CHAINACNUM                73             R10040B9930
     C           WWWK10    CHAINACNUMA               73                   B9930
     C           *IN73     IFEQ '0'                                       R10040
     C                     MOVE ANAM      WWANAM                          R10040
     C                     END                                            R10040
     C*                                                                   R10040
     C** IF 12A ACCOUNT CODE ACCESS LF/ACCNT TO GET RETAIL ACCOUNT        R10040
     C** DETAILS                                                          R10040
     C                     ELSE                                           R10040
     C                     MOVELWWSTAC    WWWK1A 10                       R10040
     C                     MOVE WWSTAC    WWACSK  20                      R10040
     C**********           MOVELWWSTAC    WWCNUK  60                                   R10040 CSD027
     C                     MOVELWWSTAC    WWCNUK  6                                           CSD027
     C**********           MOVE WWWK1A    WWACOK  40                                   R10040 CGL029
     C                     MOVE WWWK1A    WWACOK 100                                          CGL029
     C*                                                                   R10040
     C           ACNKEY    CHAINACCNT                73                   R10040
     C           *IN73     IFEQ '0'                                       R10040
     C                     MOVE ANAM      WWANAM                          R10040
     C                     END                                            R10040
     C                     END                                            R10040
     C                     END                                            R10040
     C*                                                                   R10040
     C                     MOVE *BLANKS   WWSETM  2                       R10040
     C                     MOVE *BLANKS   WWSTAC 12                       R10040
     C                     MOVE *BLANKS   WWBRCA  3                       085867
     C*                                                                   R10040
     C                     ENDSR                           * #P40   ESR * R10040
     C*************************************************************************
      /EJECT
     C**************************************************************************
      ** *PSSR       :      FILE EXCEPTION ERROR HANDLING SUBROUTINE
      ** CALLED FROM : MAIN
      ** CALLS       :
     C*=========================================================================
     C           *PSSR     BEGSR                            ** *PSSR BSR**
     C*
     C** ROLL BACK CHANGES , DUMP AND RETURN TO THE CALLING PROGRAM
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     DUMP
     C                     RETRN
     C*
     C                     ENDSR                            ** *PSSR ESR**
     C*=========================================================================
      /COPY ZSRSRC,ZAPNUM                                                 R05915
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Finastra International Limited 2001
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
