     H        1                                                           S01486
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM LE daily transactions extract')               *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM0396  - LE DAILY TRANSACTION EXTRACT                       *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 182961             Date 21Apr01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPK009             Date 13Aug99               *
      *                 CPM004             Date 08Feb96               *
     F*                 085867             DATE 16MAR95               *
     F*                 081353             DATE 09JAN95               *
     F*                 S01486             DATE 04OCT94               *
     F*                 062353             DATE 21OCT93               *
     F*                 56452              DATE 12JUN93               *
     F*                 049421             DATE 22JAN93               *
     F*                 B9991      DT      DATE 13NOV91               *
     F*                 B9930      ADIF    DATE 13NOV91               *
     F*                 B7861              DATE 27MAY91               *
     F*                 R05880             DATE 24APR91               *
     F*                 R10040             DATE 19SEP90               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  182961 - Database error occurred due to a blank key field    *
      *           (Instrument Type).  The default Instrument type in  *
      *           PF/SDPORTPD is taken if a blank instrument type is  *
      *           encountered.                                        *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
     F*  CPK009 - Recompile problem found at DBA R3.00 packaging.     *
     F*  CPM004 - Bank Portfolios.                                    *
     F*  085867 - Change Pay A/C and Rec A/C to have the branch code  *
     F*  081353  -  Remove ZSFILE coding                              *
     F*  S01486  -  Portfolio Management Upgrade to R10               *
     F*  062353  -  ADDITIONALLY OUTPUT ROLLOVER DATE                 *
     F*  56452   -  UNSURE DETAILS OUTPUT FROM CUSTOMER PERSPECTIVE   *
     F*  049421  -  HEADER BOX STANDARDISATION                        *
     F*  B7861   -  ARRAYS STRANGELY SET UP.                          *
     F*  R05880  -  TRANSACTIONS INSERTED AND DELETED ON SAME DAY     *
     F*             SHOULD NOT BE OUPUT ON REPORT                     *
     F*  R10040  -  OUTPUT ACCOUNT NAME                               *
     F*  B9991   -  ADDING OF SOME FIELDS TO IMPROVE PM0400P1 REPORT  *
     F*  B9930   -  WRONG ACCOUNT NAME ON REPORT PM0400P1             *
     F*             FIELD ANAM NOT DEFINED IN FILE ACNUM              *
     F*                                                               *
     F*****************************************************************
     FSDPORTPDIF  E                    DISK         KINFSR *PSSR          182961
     F***PM0396AUO***E                    PRINTER                         S01486
     F***PM0396AUO   E                    PRINTER      KINFDS SPOOLUS01486081353
     FPM0396AUO   E                    PRINTER                            S01486
     F***SDBANKPDIF**E                    DISK                            S01486
     F***************                               KINFSR *PSSR          S01486
     F***PMTRCNZZUF**E           K        DISK                      A     S01486
     FPMTRCNPAUF  E           K        DISK                      A        S01486
     F                                              KINFSR *PSSR
     F***PMTRCNPPO***E           K        DISK                            S01486
     FPMTRCNPDO   E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     FCLOAN   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F***SDCUSTL0IF**E           K        DISK                            S01486
     F***************                               KINFSR *PSSR          S01486
     F***SDPLINPDIF**E           K        DISK                            S01486
     F***************                               KINFSR *PSSR          S01486
     F***SDLOANL0IF**E           K        DISK                            S01486
     F***************                               KINFSR *PSSR          S01486
     F***LOAMSQK*IS**E           K        DISK                            S01486
     FPMLOAML0IS  E           K        DISK                               S01486
     F            LOAMSDKF                          KRENAMELOAMSQKF
     F                                              KINFSR *PSSR
     F***CLOANQ1*IP**E           K        DISK                            S01486
     FPMCLONL5IP  E           K        DISK                               S01486
     F            CLOANCLF                          KRENAMECLOANQ1F
     F                                              KINFSR *PSSR
     FACCNT   IF  E           K        DISK                               R10040
     F            ACCNTAAF                          KIGNORE               R10040
     F            ACCNTACF                          KIGNORE               R10040
     F                                              KINFSR *PSSR          R10040
     F*ACNUM   IF  E           K        DISK                        R10040B9930
     FACNUMA  IF  E           K        DISK                               B9930
     F                                              KINFSR *PSSR          R10040
     F            ACCNTABF                          KRENAMEACNUMTBF       R10040
     F***SDACOFL0IF**E           K        DISK                     B9991  S01486
     F***PREFIX*AZ***                                              B9991  S01486
     F***************                               KINFSR *PSSR   B9991  S01486
     FPMDSPGL3IF  E           K        DISK                               B9991
     F** PREFIX PA                                                        B9991
     F                                              KINFSR *PSSR          B9991
      /EJECT
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*    UNUSED INDICATORS
     F*    -----------------
     F*       ..  ..  03  04  05  06  07  08  09  10
     F*       11  12  13  14  15  16  17  18  19  20
     F*       21  22  23  24  25  26  27  28  29  30
     F*       31  32  33  34  35  36  37  38  39  40
     F*       41  42  43  44  45  46  47  48  49  50
     F*       51  52  53  54  55  56  57  58  59  60
     F*       61  62  63  64  65  66  67  68  69  70
     F*       ..  ..  73  74  75  76  77  78  79  80
     F*       81  82  83  84  85  86  87  88  89  90
     F*       91  92  93  94  95  96  97  98  99
     F*
     F**   INDICATOR USAGE
     F**   ---------------
     F*
     F**   01      CLOAN RECORD
     F**   02      LOAMS RECORD
     F**   71      INITIAL PROCESSING
     F**   72      FILES ACCESS INDICATOR
     F**   73      LOAN AMENDMENT TYPE LOKUP INDICATOR
     F*
      /EJECT
     F*
     F**   SUB-ROUTINE DEFINITIONS
     F**   -----------------------
     F*
     F*    #INIT     INITIAL PROCESSING
     F**   #P01      EXTRACT LE LOANS
     F**   #P02      EXTRACT LOAN AMENDMENTS
     F**   #P03      AUDIT PROCESSING
     F**   #W01      WRITE LE LOAN TO TRANSACTION FILE
     F**   #W0201    WRITE PI,MR  LOAN AMENDMENT TO TRANSACTION FILE
     F**   #W0202    WRITE SC,CI,SI  LOAN AMENDMENT TO TRANSACTION FILE
     F**   #W0301    WRITE TO TRANSACTION REPORT CONTROL  FILE
     F**   #W0302    WRITE TO RE DAILY TRANSACTION EXTRACT AUDIT REPORT
     F*    #LOAN     ACCESS LOAN DETAILS
     F*    #LTST     ACCESS LOAN TYPE/SUB-TYPE DETAILS
     F*    #INST     ACCESS PM INSTRUMENT DETAILS
     F*    #CUST     ACCESS CUSTOMER DETAILS
     F*
      /EJECT
     E** FORMAT LE DETAILS FOR OUTPUT  (SR/ZFLELN)
     E                    ZLI        20  1
     E                    AMTPAR  6   6  2               AMEND TYPES
     E*                   NRGUAR  1   5 20               AMEND NARR.      B7861
     E*                   NRLOAN  1   5 20               AMEND NARR.      B7861
     E                    NRGUAR  1   6 20               AMEND NARR.      B7861
     E                    NRLOAN  1   6 20               AMEND NARR.      B7861
      /COPY ZSRSRC,ZDATE2Z1
     E*
     E**   Array for copyright
     E                    CPY@    1   1 80               COPYRIGHT
      /EJECT
     I*
     I***CLOANQ1F****01                                                   S01486
     I***LOAMSQKF****02                                                   S01486
     ICLOANQ1F    01                                                      S01486
      ** Rename NLRA field in CLOANQ1F to distinguish it from same        CPK009
      ** named field defined in record CLOANCKF                           CPK009
      *                                                                   CPK009
     ICLOANZ1F                                                            CPK009
     I              NLRA                            NLRACK                CPK009
     ILOAMSQKF    02                                                      S01486
     I*
     I** DATA STRUCTURE TO REGROUP LOAN TYPE AND SUB-TYPE
     I*
     I            DS
     I****************************************1***4*DSSCCD                                    CLE042
     I                                        1   8 DSSCCD                                    CLE042
     I                                        1   2 LTYP
     I                                        3   4 SUTP
     I                                        5   8 CLAS                                      CLE042
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA********UDS                            256                    S01486
     I**************                        132 183 DBLOT                 S01486
     I**************                        132 141 DBFILE                S01486
     ILDA         DS                            256                       S01486
     I                                      134 183 DBLOT                 S01486
     I                                      134 141 DBFILE                S01486
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I*                                                                   CPM004
     I** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
     I** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
     ISDBANK    E DSSDBANKPD                                              S01486
     I** EXTERNAL DS FOR BANK DETAILS                                     S01486
     ISDPORT    E DSSDPORTPD                                              CPM004
     I** EXTERNAL DS FOR PORTFOLIO DETAILS                                CPM004
     ISDPLIN    E DSSDPLINPD                                              S01486
     I** EXTERNAL DS FOR INSTRUMENT DETAILS                               S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I** EXTERNAL DS FOR CUSTOMER DETAILS                                 S01486
     ISDLOAN    E DSSDLOANPD                                              S01486
     I** EXTERNAL DS FOR LOANS DETAILS                                    S01486
     ISDPLCS    E DSSDPLCSPD                                              CPM004
     I**  SD Portfolio Management Customer details                        CPM004
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, LONG  DATA STRUCTURE                S01486
     I*****SPOOLU      DS                                           S01486081353
     I************************************** 83  92 SFILEU          S01486081353
     I*********************************** B 123 1240SFNUMU          S01486081353
     I*********************************** B 367 3680LINE1           S01486081353
     I*
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  P R O G R A M     I N I T I A L I S A T I O N                *
     C*                                                               *
     C*****************************************************************
     C*
     C***DISPLAY*NON-PORTFOLIO*DISPALY*PICTURE*FROM*PF/PMICD1PP********   S01486
     C***Display*non-portfolio display picture from PF/SDPORTPD    S01486 CPM004
     C************ENTRY    PLIST                                          CPM004
     C***********          PARM           P9DP97  1                       S01486
     C***********          PARM           FCDP97  1                S01486 CPM004
     C*
     C** KEY TO ACCESS DEAL TYPE/SUB-TYPE FILE
     C***********P1KEY*****KLIST                                                              CLE042
     C*********************KFLD           LTYP                                                CLE042
     C*********************KFLD           SUTP                                                CLE042
     C*
     C** PERFORM INITIAL PROCESSING
     C           WW396     IFEQ *BLANK
     C                     EXSR #INIT
     C                     END
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C*
     C**            MAIN  PROCESSING
     C**=======================================================================
     C*
     C** SAVE LAST CHANGE TYPE
     C                     MOVE CHTP      WWCHTP
     C*
     C** PROCESS LE LOAN
     C           *IN01     IFEQ '1'
     C                     EXSR #P01
     C                     END
     C*
     C** PROCESS LOAN AMENDMENT TRANSACTIONS
     C           *IN02     IFEQ '1'
     C                     EXSR #P02
     C                     END
     C*
     C** PERFORM AUDIT PROCESSING
     CLR                   EXSR #P03
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #P01          -  PROCESS LE LOANS
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS         -  #W01   - WRITE LOANS TO TRANSACTIONS FILE
     C**                    #LTST  - ACCESS LOAN TYPE/SUB-TYPE DETAILS
     C**                    #INST  - ACCESS PM INSTRUMENT TYPE DETAILS
     C**                    #CUST  - ACCESS CUSTOMER DETAILS
     C**
     C*=========================================================================
     C*
     C           #P01      BEGSR                           *** #P01   ***
     C*
     C** WHEN CHANGE OF LOAN TYPE OR SUB-TYPE, ACCESS THE LOAN TYPE/
     C** SUB-TYPE AND INSTRUMENT TYPE DETAILS
     C           LTYP      IFNE WWLTYP
     C           SUTP      ORNE WWSUTP
     C           CLAS      ORNE WWCLAS                                                        CLE042
     C                     EXSR #LTST
     C                     EXSR #INST
     C                     MOVE LTYP      WWLTYP
     C                     MOVE SUTP      WWSUTP
     C                     MOVE CLAS      WWCLAS                                              CLE042
     C                     END
     C*
     C** WHEN CHANGE OF CUSTOMER, ACCESS THE NEW CUSTOMER DETAILS
     C           CNUM      IFNE WWCNUM
     C                     MOVE CNUM      WWPNP8
     C                     EXSR #CUST
     C**********           Z-ADDCNUM      WWCNUM                                              CSD027
     C                     MOVE CNUM      WWCNUM                                              CSD027
     C                     END
     C*                                                                   CPM004
     C** When change of booking branch, access branch internal customer   CPM004
     C** number, branch customer report name and branch a/c officer       CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           BRCA      ANDNEWWBRCA                                    CPM004
     C                     EXSR #BRCA                                     CPM004
     C                     MOVELBRCA      WWBRCA  3                       CPM004
     C                     END                                            CPM004
     C*
     C                     EXSR #W01
     C                     ADD  1         LECPT   50
     C*
     C                     ENDSR                           *** #P01 END **
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #P02          -  EXTRACT LOAN AMENDMENTS
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS #W0201  -  WRITE PI, MR LOAN AMENDMENT TO TRANSACTION
     C**                    REPORT CONTROL FILE
     C**         #W0202  -  WRITE SC, CI, SI LOAN AMENDMENT TO TRANSACTION
     C**                    REPORT CONTROL FILE
     C**         #LOAN   - ACCESS LOAN DETAILS
     C**         #LTST   - ACCESS LOAN TYPE/SUB-TYPE DETAILS
     C**         #INST   - ACCESS PM INSTRUMENT TYPE DETAILS
     C**         #CUST   - ACCESS CUSTOMER DETAILS
     C**
     C*=========================================================================
     C*
     C           #P02      BEGSR                           *** #P02   ***
     C*
     C** SAVE LOAN AMENDMENTS DETAILS
     C                     MOVE BRTT      WWBRTT
     C**********           MOVE BRCD      WWBRCD                          S01486
     C                     MOVE BRCA      WWBRCD                          S01486
     C                     Z-ADDVDAT      WWVDAT
     C                     Z-ADDRTSP      WWRTSP
     C*
     C** SET UP AMENDMENT NARRATIVE
     C                     MOVE '0'       *IN73
     C                     Z-ADD1         I       10
     C           AMTP      LOKUPAMTPAR,I                 73
     C           *IN73     IFEQ '1'
     C           PTYP      IFEQ 70                                        R05658
     C                     MOVELNRGUAR,I  WWDESI                          R05658
     C                     ELSE                                           R05658
     C                     MOVELNRLOAN,I  WWDESI                          R05658
     C                     END                                            R05658
     C*********************MOVELAMNAAR,I  WWDESI                          R05658
     C                     END
     C*
     C** ACCESS LOANS FILE TO GE1 PORTFOLIO REFERENCE AND BRANCH CODE
     C                     EXSR #LOAN
     C*
     C** EXTRACT LOAN AMENDMENT IF DISPLAY NON-PORTFOLIO PICTURE
     C** (9997) INDICATOR IS NOT 'N' AND IF PORTFOLIO REFERENCE
     C** NOT BLANK
     C           PTFR      IFEQ *BLANKS
     C                     GOTO #P021
     C                     END
     C*
     C           PTFR      IFEQ '9997'
     C***********P9DP97    ANDEQ'N'                                       S01486
     C           FCDP97    ANDEQ'N'                                       S01486
     C                     GOTO #P021
     C                     END
     C*
     C** WHEN CHANGE OF LOAN TYPE OR SUB-TYPE, ACCESS PF/SDLOANL0
     C** TO GET PM INSTRUMENT TYPE DETAILS
     C           LTYP      IFNE WWLTYP
     C           SUTP      ORNE WWSUTP
     C           CLAS      ORNE WWCLAS                                                        CLE042
     C                     EXSR #LTST
     C                     EXSR #INST
     C                     MOVE LTYP      WWLTYP
     C                     MOVE SUTP      WWSUTP
     C                     MOVE CLAS      WWCLAS                                              CLE042
     C                     END
     C*
     C** WHEN CHANGE OF CUSTOMER, ACCESS THE NEW CUSTOMER DETAILS
     C           CNUM      IFNE WWCNUM
     C                     MOVE CNUM      WWPNP8
     C                     EXSR #CUST
     C**********           Z-ADDCNUM      WWCNUM                                              CSD027
     C                     MOVE CNUM      WWCNUM                                              CSD027
     C                     END
     C*                                                                   CPM004
     C** When change of booking branch, access branch internal customer   CPM004
     C** number, branch customer report name and branch a/c officer       CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           BRCA      ANDNEWWBRCA                                    CPM004
     C                     EXSR #BRCA                                     CPM004
     C                     MOVELBRCA      WWBRCA                          CPM004
     C                     END                                            CPM004
     C*
     C** IF LOAN AMENDMENT TYPE EQUALS TO PI OR MR
     C** WRITE PI MR LOAN AMENDMENT TO TRANSACTION REPORT CONTROL FILE
     C           AMTP      IFEQ 'PI'
     C           AMTP      OREQ 'MR'
     C                     EXSR #W0201
     C                     ADD  1         LMPIMR  50
     C                     END
     C*
     C** IF LOAN AMENDMENT TYPE EQUALS TO CS OR CI OR SI
     C** WRITE CS CI SI LOAN AMENDMENT TO TRANSACTION REPORT CONTROL FILE
     C           AMTP      IFEQ 'CS'
     C           AMTP      OREQ 'CI'
     C           AMTP      OREQ 'SI'
     C                     EXSR #W0202
     C                     ADD  1         SCCISI  50
     C                     END
     C*
     C           #P021     ENDSR                           *** #P02 END **
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #P03          -  AUDIT PROCESSING
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS #W0301  -  WRITE TO TRANSACTION REPORT CONTROL AUDIT FILE
     C**         #W0302  -  WRITE TO LE DAILY TRANSACTIONS EXTRACT AUDIT
     C**                    REPORT
     C**
     C*=========================================================================
     C*
     C           #P03      BEGSR                           *** #P03   ***
     C*
     C***ACCESS*PF/PMTRCNZZ***TRANSACTION REPORT CONTROL AUDIT FILE       S01486
     C***********          READ PMTRCNZZ                 72               S01486
     C** ACCESS PF/PMTRCNPA - TRANSACTION REPORT CONTROL AUDIT FILE       S01486
     C                     READ PMTRCNPA                 72               S01486
     C                     ADD  LMPIMR    SANORE
     C                     ADD  SCCISI    SANORE
     C                     ADD  LECPT     SANORE
     C                     MOVE 'D'       SARECI
     C*
     C** WRITE TO TRANSACTION REPORT CONTROL AUDIT FILE
     C                     EXSR #W0301
     C*
     C** WRITE TO LE DAILY TRANSACTIONS EXTRACT AUDIT REPORT
     C                     EXSR #W0302
     C                     ENDSR                           *** #03 END **
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #W01          -  WRITE LE LOAN TO TRANSACTION REPORT CONTROL
     C**                    FILE
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS         -
     C**
     C*=========================================================================
     C*
     C           #W01      BEGSR                           *** #W01   ***
     C*
     C                     MOVE 'D'       SARECI
     C                     MOVE BBACOC    SAACOC
     C**********           Z-ADDCNUM      SACNUM                                              CSD027
     C                     MOVE CNUM      SACNUM                                              CSD027
     C                     MOVE PTFR      SAPTFR
     C                     MOVE AYINNR    SAINNR
     C                     MOVE 'CL'      SAMODI
     C**********           Z-ADDLNRF      SATRNB                                              CLE148
     C                     MOVELLNRF      SATRNB                                              CLE148
     C                     MOVE LTYP      SATRTP
     C                     MOVE SUTP      SATRST
     C                     MOVELFTYP      SATDSS
     C                     MOVE FSEQ      SATDSS
     C                     Z-ADD*ZEROS    SANMDP
     C                     MOVE *BLANKS   SASPBS
     C                     Z-ADD*ZEROS    SASEQA
     C                     Z-ADDDDAT      SADDAT
     C                     Z-ADDVDAT      SAVDAT
     C                     Z-ADDMDAT      SAMDAT
     C***********          Z-ADDBRCD      SABRCD                          S01486
     C                     MOVELBRCA      SABRCD                          S01486
     C                     Z-ADDCPAM      SAAMT1
     C                     Z-ADD*ZEROS    SAAMT2
     C                     MOVE CCY       SACCY1
     C                     MOVE *BLANKS   SACCY2
     C                     Z-ADD*ZEROS    SAPRC1
     C                     Z-ADD*ZEROS    SAPRC2
     C                     Z-ADD*ZEROS    SARATA
     C                     Z-ADD*ZEROS    SARATB
     C                     MOVE *BLANKS   SAMDV1
     C                     MOVE *BLANKS   SAMDV2
     C**********           Z-ADDBRTT      SABRT1                                              CSD103
     C                     MOVE BRTT      SABRT1                                              CSD103
     C**********           Z-ADD*ZEROS    SABRT2                                              CSD103
     C                     MOVE *BLANKS   SABRT2                                              CSD103
     C                     Z-ADDINTR      SARAI1
     C                     Z-ADD*ZEROS    SARAI2
     C                     MOVE IPFR      SAFRQ1
     C                     MOVE *BLANKS   SAFRQ2
     C                     Z-ADDNIDT      SAIPD1
     C***                  Z-ADD*ZEROS    SAIPD2                          062353
     C                     Z-ADDRLDT      SAIPD2                          062353
     C                     Z-ADD*ZEROS    SAIPD2
     C                     Z-ADD*ZEROS    SANDYS
     C                     Z-ADD*ZEROS    SAAINT
     C                     MOVE *BLANKS   SABROK
     C                     Z-ADD*ZEROS    SASWOD
     C                     MOVE *BLANK    SAACRI
     C                     Z-ADD*ZEROS    SAPURI
     C                     Z-ADD*ZEROS    SAVAL1
     C                     Z-ADD*ZEROS    SAVAL2
     C                     MOVE PDDSPG    SARCOA
     C                     MOVE PDITDS    SARSEA
     C                     MOVELAYLNTD    SAT1XT
     C                     MOVELCCY       ZCCY
     C                     Z-ADDINTR      ZINRT
     C                     Z-ADDMDAT      ZMDAT
     C                     EXSR ZFLELN
     C                     MOVELZLIN      SAT2XT
     C                     MOVE *BLANKS   SACOMC
     C                     MOVE *BLANKS   SACFRQ
     C                     Z-ADD0         SANCDT
     C****                 MOVE SDST      SAPAYM                          56452
     C****                 MOVE OSDA      SAPYAC                          56452
     C                     MOVE MDST      SAPAYM                          56452
     C                     MOVE OMDA      SAPYAC                          56452
     C                     MOVE OMDB      SAPYBR                          085867
     C*
     C                     MOVE SAPAYM    WWSETM                          R10040
     C                     MOVE SAPYAC    WWSTAC                          R10040
     C                     MOVE SAPYBR    WWBRCA                          085867
     C                     EXSR #P40                                      R10040
     C                     MOVE WWANAM    SAPYNM                          R10040
     C*
     C****                 MOVE MDST      SARCVM                          56452
     C****                 MOVE OMDA      SARCAC                          56452
     C                     MOVE SDST      SARCVM                          56452
     C                     MOVE OSDA      SARCAC                          56452
     C                     MOVE OSDB      SARCBR                          085867
     C*
     C                     MOVE SARCVM    WWSETM                          R10040
     C                     MOVE SARCAC    WWSTAC                          R10040
     C                     MOVE SARCBR    WWBRCA                          085867
     C                     EXSR #P40                                      R10040
     C                     MOVE WWANAM    SARCNM                          R10040
     C*
     C                     MOVE *BLANKS   SACGST
     C                     MOVE *BLANKS   SACGAD
     C                     MOVE WWCHTP    SACHTP
     C                     MOVE BBCRNM    SACRNM
     C                     MOVE PDISTN    SAISTN
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVELO#ACOF    SABACO                          CPM004
     C                     MOVELO#BICN    SABCNM                          CPM004
     C                     MOVELO#CRNM    SABCRN                          CPM004
     C                     END                                            CPM004
     C*
     C** IF TRANSACTION INSERTED & DELETED TODAY DO NOT OUTPUT DETAILS    R05880
     C           SACHTP    IFNE 'D'                                       R05880
     C           ORED      ORNE BJRDNB                                    R05880
     C                     WRITEPMTRCNP0
     C                     END                                            R05880
     C*
     C                     ENDSR                           *** #W01 END **
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #W0201        -  WRITE PI, MR LOAN AMENDMENT TO TRANSACTION
     C**                    REPORT CONTROL FILE
     C**
     C**   CALLED BY     -  #P02 - LOAN AMENDMENTS EXTRACT
     C**
     C**   CALLS         -
     C**
     C*=========================================================================
     C*
     C           #W0201    BEGSR                           *** #W0201 ***
     C*
     C                     MOVE 'D'       SARECI
     C                     MOVE BBACOC    SAACOC
     C**********           Z-ADDCNUM      SACNUM                                              CSD027
     C                     MOVE CNUM      SACNUM                                              CSD027
     C                     MOVE PTFR      SAPTFR
     C                     MOVE AYINNR    SAINNR
     C                     MOVE 'DK'      SAMODI
     C**********           Z-ADDLNRF      SATRNB                                              CLE148
     C                     MOVELLNRF      SATRNB                                              CLE148
     C                     MOVE AMTP      SATRTP
     C                     MOVE *BLANKS   SATRST
     C                     MOVE *BLANKS   SATDSS
     C                     Z-ADD*ZEROS    SANMDP
     C                     MOVE *BLANKS   SASPBS
     C                     Z-ADDLASN      SASEQA
     C                     Z-ADD*ZEROS    SADDAT
     C                     Z-ADDWWVDAT    SAVDAT
     C                     Z-ADD*ZEROS    SAMDAT
     C**********           Z-ADDWWBRCD    SABRCD                          S01486
     C                     MOVELWWBRCD    SABRCD                          S01486
     C                     Z-ADDPRAM      SAAMT1
     C                     Z-ADD*ZEROS    SAAMT2
     C                     MOVE CCY       SACCY1
     C                     MOVE *BLANKS   SACCY2
     C                     Z-ADD*ZEROS    SAPRC1
     C                     Z-ADD*ZEROS    SAPRC2
     C                     Z-ADD*ZEROS    SARATA
     C                     Z-ADD*ZEROS    SARATB
     C                     MOVE *BLANKS   SAMDV1
     C                     MOVE *BLANKS   SAMDV2
     C                     Z-ADD*ZEROS    SABRT1
     C                     Z-ADD*ZEROS    SABRT2
     C                     Z-ADD*ZEROS    SARAI1
     C                     Z-ADD*ZEROS    SARAI2
     C                     MOVE *BLANKS   SAFRQ1
     C                     MOVE *BLANKS   SAFRQ2
     C                     Z-ADD*ZEROS    SAIPD1
     C                     Z-ADD*ZEROS    SAIPD2
     C                     Z-ADD*ZEROS    SANDYS
     C                     Z-ADD*ZEROS    SAAINT
     C                     MOVE *BLANKS   SABROK
     C                     Z-ADD*ZEROS    SASWOD
     C                     MOVE *BLANK    SAACRI
     C                     Z-ADD*ZEROS    SAPURI
     C                     Z-ADD*ZEROS    SAVAL1
     C                     Z-ADD*ZEROS    SAVAL2
     C                     MOVE PDDSPG    SARCOA
     C                     MOVE PDITDS    SARSEA
     C                     MOVELWWDESI    SAT1XT
     C                     MOVELCCY       ZCCY
     C                     Z-ADDINTR      ZINRT
     C                     Z-ADDMDAT      ZMDAT
     C                     EXSR ZFLELN
     C                     MOVELZLIN      SAT2XT
     C                     MOVE *BLANKS   SACOMC
     C                     MOVE *BLANKS   SACFRQ
     C                     Z-ADD0         SANCDT
     C*
     C           AMTP      IFEQ 'PI'
     C****                 MOVE SETP      SAPAYM                          56452
     C****                 MOVE OSAC      SAPYAC                          56452
     C                     MOVE SETP      SARCVM                          56452
     C                     MOVE OSAC      SARCAC                          56452
     C                     MOVE OSBR      SARCBR                          085867
     C*
     C****                 MOVE SAPAYM    WWSETM                          56452
     C****                 MOVE SAPYAC    WWSTAC                          56452
     C****                 EXSR #P40                                      56452
     C****                 MOVE WWANAM    SAPYNM                          56452
     C                     MOVE SARCVM    WWSETM                          56452
     C                     MOVE SARCAC    WWSTAC                          56452
     C                     MOVE SARCBR    WWBRCA                          085867
     C                     EXSR #P40                                      56452
     C                     MOVE WWANAM    SARCNM                          56452
     C*
     C****                 MOVE *BLANKS   SARCVM                          56452
     C****                 MOVE *BLANKS   SARCAC                          56452
     C****                 MOVE *BLANKS   SARCNM                          56452
     C                     MOVE *BLANKS   SAPAYM                          56452
     C                     MOVE *BLANKS   SAPYAC                          56452
     C                     MOVE *BLANKS   SAPYNM                          56452
     C                     MOVE *BLANKS   SAPYBR                          085867
     C                     ELSE
     C****                 MOVE *BLANKS   SAPAYM                          56452
     C****                 MOVE *BLANKS   SAPYAC                          56452
     C****                 MOVE *BLANKS   SAPYNM                          56452
     C****                 MOVE SETP      SARCVM                          56452
     C****                 MOVE OSAC      SARCAC                          56452
     C*                                                                   56452
     C****                 MOVE SARCVM    WWSETM                          56452
     C****                 MOVE SARCAC    WWSTAC                          56452
     C****                 EXSR #P40                                      56452
     C****                 MOVE WWANAM    SARCNM                          56452
     C                     MOVE *BLANKS   SARCAC                          56452
     C                     MOVE *BLANKS   SARCVM                          56452
     C                     MOVE *BLANKS   SARCNM                          56452
     C                     MOVE *BLANKS   SARCBR                          085867
     C                     MOVE SETP      SAPAYM                          56452
     C                     MOVE OSAC      SAPYAC                          56452
     C                     MOVE OSBR      SAPYBR                          085867
     C*                                                                   56452
     C                     MOVE SAPAYM    WWSETM                          56452
     C                     MOVE SAPYAC    WWSTAC                          56452
     C                     MOVE SAPYBR    WWBRCA                          085867
     C                     EXSR #P40                                      56452
     C                     MOVE WWANAM    SAPYNM                          56452
     C*
     C                     END
     C*
     C                     MOVE *BLANKS   SACGST
     C                     MOVE *BLANKS   SACGAD
     C                     MOVE WWCHTP    SACHTP
     C                     MOVE BBCRNM    SACRNM
     C                     MOVE PDISTN    SAISTN
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVELO#ACOF    SABACO                          CPM004
     C                     MOVELO#BICN    SABCNM                          CPM004
     C                     MOVELO#CRNM    SABCRN                          CPM004
     C                     END                                            CPM004
     C*
     C** IF TRANSACTION INSERTED & DELETED TODAY DO NOT OUTPUT DETAILS    R05880
     C           SACHTP    IFNE 'D'                                       R05880
     C           ORED      ORNE BJRDNB                                    R05880
     C                     WRITEPMTRCNP0
     C                     END                                            R05880
     C*
     C                     ENDSR                           ** #W0201 END*
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #W0202        -  WRITE SC, CI, SI LOAN AMENDMENT TO TRANSACTION
     C**                    REPORT CONTROL FILE
     C**
     C**   CALLED BY     -  #P02 - LOAN AMENDMENTS EXTRACT
     C**
     C**   CALLS         -
     C**
     C*=========================================================================
     C*
     C           #W0202    BEGSR                           *** #W0202 ***
     C*
     C                     MOVE 'D'       SARECI
     C                     MOVE BBACOC    SAACOC
     C**********           Z-ADDCNUM      SACNUM                                              CSD027
     C                     MOVE CNUM      SACNUM                                              CSD027
     C                     MOVE PTFR      SAPTFR
     C                     MOVE AYINNR    SAINNR
     C                     MOVE 'DK'      SAMODI
     C**********           Z-ADDLNRF      SATRNB                                              CLE148
     C                     MOVELLNRF      SATRNB                                              CLE148
     C                     MOVE AMTP      SATRTP
     C                     MOVE *BLANKS   SATRST
     C                     MOVE *BLANKS   SATDSS
     C                     Z-ADD*ZEROS    SANMDP
     C                     MOVE *BLANKS   SASPBS
     C                     Z-ADDLASN      SASEQA
     C                     Z-ADD*ZEROS    SADDAT
     C                     Z-ADDWWVDAT    SAVDAT
     C                     Z-ADD*ZEROS    SAMDAT
     C***********          Z-ADDWWBRCD    SABRCD                          S01486
     C                     MOVELWWBRCD    SABRCD                          S01486
     C                     Z-ADD*ZEROS    SAAMT1
     C                     Z-ADD*ZEROS    SAAMT2
     C                     MOVE *BLANKS   SACCY1
     C                     MOVE *BLANKS   SACCY2
     C                     Z-ADD*ZEROS    SAPRC1
     C                     Z-ADD*ZEROS    SAPRC2
     C                     Z-ADD*ZEROS    SARATA
     C                     Z-ADD*ZEROS    SARATB
     C                     MOVE *BLANKS   SAMDV1
     C                     MOVE *BLANKS   SAMDV2
     C**********           Z-ADDWWBRTT    SABRT1                                              CSD103
     C                     MOVE WWBRTT    SABRT1                                              CSD103
     C**********           Z-ADD*ZEROS    SABRT2                                              CSD103
     C                     MOVE *BLANKS   SABRT2                                              CSD103
     C                     Z-ADDWWRTSP    SARAI1
     C                     Z-ADD*ZEROS    SARAI2
     C                     MOVE *BLANKS   SAFRQ1
     C                     MOVE *BLANKS   SAFRQ2
     C                     Z-ADD*ZEROS    SAIPD1
     C                     Z-ADD*ZEROS    SAIPD2
     C                     Z-ADD*ZEROS    SANDYS
     C                     Z-ADD*ZEROS    SAAINT
     C                     MOVE *BLANKS   SABROK
     C                     Z-ADD*ZEROS    SASWOD
     C                     MOVE *BLANK    SAACRI
     C                     Z-ADD*ZEROS    SAPURI
     C                     Z-ADD*ZEROS    SAVAL1
     C                     Z-ADD*ZEROS    SAVAL2
     C                     MOVE PDDSPG    SARCOA
     C                     MOVE PDITDS    SARSEA
     C                     MOVELWWDESI    SAT1XT
     C                     MOVELCCY       ZCCY
     C                     Z-ADDINTR      ZINRT
     C                     Z-ADDMDAT      ZMDAT
     C                     EXSR ZFLELN
     C                     MOVELZLIN      SAT2XT
     C                     MOVE *BLANKS   SACOMC
     C                     MOVE *BLANKS   SACFRQ
     C                     Z-ADD0         SANCDT
     C****                 MOVE *BLANKS   SAPAYM                          56452
     C****                 MOVE *BLANKS   SAPYAC                          56452
     C****                 MOVE *BLANKS   SAPYNM                          56452
     C                     MOVE *BLANKS   SARCVM                          56452
     C                     MOVE *BLANKS   SARCAC                          56452
     C                     MOVE *BLANKS   SARCNM                          56452
     C                     MOVE *BLANKS   SARCBR                          085867
     C*
     C           AMTP      IFEQ 'SI'
     C****                 MOVE SETP      SARCVM                          56452
     C****                 MOVE OSAC      SARCAC                          56452
     C****                                                                56452
     C****                 MOVE SARCVM    WWSETM                          56452
     C****                 MOVE SARCAC    WWSTAC                          56452
     C****                 EXSR #P40                                      56452
     C****                 MOVE WWANAM    SARCNM                          56452
     C                     MOVE SETP      SAPAYM                          56452
     C                     MOVE OSAC      SAPYAC                          56452
     C                     MOVE OSBR      SAPYBR                          085867
     C*                                                                   56452
     C                     MOVE SAPAYM    WWSETM                          56452
     C                     MOVE SAPYAC    WWSTAC                          56452
     C                     MOVE SAPYBR    WWBRCA                          085867
     C                     EXSR #P40                                      56452
     C                     MOVE WWANAM    SAPYNM                          56452
     C*
     C                     ELSE
     C****                 MOVE *BLANKS   SARCVM                          56452
     C****                 MOVE *BLANKS   SARCAC                          56452
     C****                 MOVE *BLANKS   SARCNM                          56452
     C                     MOVE *BLANKS   SAPAYM                          56452
     C                     MOVE *BLANKS   SAPYAC                          56452
     C                     MOVE *BLANKS   SAPYNM                          56452
     C                     MOVE *BLANKS   SAPYBR                          085867
     C                     END
     C*
     C                     MOVE *BLANKS   SACGST
     C                     MOVE *BLANKS   SACGAD
     C                     MOVE WWCHTP    SACHTP
     C                     MOVE BBCRNM    SACRNM
     C                     MOVE PDISTN    SAISTN
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVELO#ACOF    SABACO                          CPM004
     C                     MOVELO#BICN    SABCNM                          CPM004
     C                     MOVELO#CRNM    SABCRN                          CPM004
     C                     END                                            CPM004
     C*
     C** IF TRANSACTION INSERTED & DELETED TODAY DO NOT OUTPUT DETAILS    R05880
     C           SACHTP    IFNE 'D'                                       R05880
     C           ORED      ORNE BJRDNB                                    R05880
     C                     WRITEPMTRCNP0
     C                     END                                            R05880
     C*
     C                     ENDSR                           ** #W0202 END*
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #LTST           -  ACCESS LOAN TYPE/SUB-TYPE DETAILS
     C**
     C**   CALLED BY #P01  -  LE LOANS EXTRACT
     C**             #P02  -  LOAN AMENDMENTS EXTRACT
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #LTST     BEGSR                           * #LTST BEGS *
     C*
     C***********P1KEY     CHAINSDLOANL0             72                   S01486
     C                     CALL 'AOLOANR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM LTYP      WWLNTY  2                       S01486
     C                     PARM SUTP      WWLNST  2                       S01486
     C                     PARM CLAS      WWLNCL  4                                           CLE042
     C           SDLOAN    PARM SDLOAN    DSSDY                           S01486
     C*
     C**   PERFORM DATABASE IN ERROR PROCESSING IF NO RECORD FOUND
     C           *IN72     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVELDSSCCD    DBKEY
     C                     MOVEL'02'      DBASE
     C************         MOVEL'SDLOANPD'DBFILE           ***************S01486
     C                     MOVE 'SDLOANPD'DBFILE           * DB ERROR 02 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C                     ENDSR                           * #LTST ENDS**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #INST           -  ACCESS PM INSTRUMENT TYPE DETAILS
     C**
     C**   CALLED BY #P01  -  LE LOANS EXTRACT
     C**             #P02  -  LOAN AMENDMENTS EXTRACT
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #INST     BEGSR                           * #INST BEGS *
      *                                                                   182961
      ** Instrument type is defaulted from PF/SDPORTPD if a blank         182961
      ** instrument type is found.                                        182961
      ** Indicator 35 was used as the operation's resulting indicator.    182961
      *                                                                   182961
     C           AYINNR    IFEQ *BLANKS                                   182961
     C           1         SETLLSDPORTPD                                  182961
     C                     READ SDPORTPD                 35               182961
     C                     MOVE FCDINR    AYINNR                          182961
     C                     ENDIF                                          182961
     C*
     C**   ACCESS THE INSTRUMENT TYPES FILE USING THE PM INSTRUMENT TYPE
     C**   FROM THE LOAN TYPE/SUB-TYPE
     C***********AYINNR    CHAINSDPLINPD             72                   S01486
     C                     CALL 'AOPLINR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM AYINNR    WWKEY3  3                       S01486
     C           SDPLIN    PARM SDPLIN    DSSDY                           S01486
     C*
     C**   PERFORM DATABASE IN ERROR PROCESSING IF NO LIVE RECORD FOUND
     C************IN72     IFEQ '0'                                       S01486
     C           WWRTCD    IFEQ *BLANKS                                   S01486
     C           PDRECI    ANDEQ'*'
     C***********          MOVE '1'       *IN72                           S01486
     C                     MOVEL'*ERROR  'WWRTCD                          S01486
     C                     END
     C*
     C************IN72     IFEQ '1'                                       S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVELAYINNR    DBKEY
     C                     MOVEL'03'      DBASE
     C***********          MOVEL'SDPLINPD'DBFILE           ***************S01486
     C                     MOVE 'SDPLINPD'DBFILE           * DB ERROR 03 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                   B9991
     C**   ACCESS THE DISPLAY GROUPS FILE                                 B9991
     C*                                                                   B9991
     C           PDDSPG    CHAINPMDSPGL3             72                   B9991
     C*                                                                   B9991
     C           *IN72     IFEQ '0'                                       B9991
     C                     MOVE PADSPS    SADSPS                          B9991
     C                     ELSE                                           B9991
     C                     MOVE *BLANKS   SADSPS                          B9991
     C                     END                                            B9991
     C*
     C                     ENDSR                           * #INST ENDS**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #CUST           -  ACCESS CUSTOMER DETAILS
     C**
     C**   CALLED BY #P01  -  LE LOANS EXTRACT
     C**             #P02  -  LOAN AMENDMENTS EXTRACT
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #CUST     BEGSR                           * #CUST BEGS *
     C*
     C**   ACCESS THE CUSTOMER DETAILS FILE USING THE LOAN CUSTOMER
     C***********WWPNP8    CHAINSDCUSTL0             72                   S01486
     C                     MOVEL'*CNUM'   WWSORT  7                       S01486
     C                     MOVELWWPNP8    WWCSNM 10                       S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM WWCSNM    WWKY10 10                       S01486
     C                     PARM WWSORT    WWKE7   7                       S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C*
     C************IN72     IFEQ '1'                                       S01486
     C                     MOVELWWPNP8    DBKEY
     C                     MOVEL'04'      DBASE            ***************
     C************         MOVEL'SDCUSTL0'DBFILE           * DB ERROR 04 *S01486
     C                     MOVE 'SDCUSTPD'DBFILE           * DB ERROR 04 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C***********                                                   B9991 S01486
     C*****ACCESS THE ACCOUNT OFFICERS FILE                         B9991 S01486
     C***********                                                   B9991 S01486
     C***********BBACOC    CHAINSDACOFL0             72             B9991 S01486
     C***********                                                   B9991 S01486
     C************IN72     IFEQ '0'                                 B9991 S01486
     C***********          MOVE AZPRTL    SAPRTL                    B9991 S01486
     C***********          ELSE                                     B9991 S01486
     C***********          MOVE *BLANKS   SAPRTL                    B9991 S01486
     C***********          END                                      B9991 S01486
     C*
     C                     ENDSR                           * #CUST ENDS**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #LOAN           -  ACCESS LOAN DETAILS
     C**
     C**   CALLED BY #P02  -  LOAN AMENDMENTS EXTRACT
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #LOAN     BEGSR                           * #LOAN BEGS *
     C*
     C           LNRF      CHAINCLOAN                72
     C*
     C**   PERFORM DATABASE IN ERROR PROCESSING IF NO RECORD FOUND
     C           *IN72     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVELLNRF      DBKEY
     C                     MOVEL'05'      DBASE            ***************
     C***********          MOVEL'CLOAN   'DBFILE           * DB ERROR 05 *S01486
     C                     MOVE 'CLOAN   'DBFILE           * DB ERROR 05 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C*
     C                     ENDSR                           * #INST ENDS**
     C*************************************************************************
      /EJECT                                                              CPM004
     C********************************************************************CPM004
     C**                                                                  CPM004
     C**   #BRCA           -  Access Branch Details                       CPM004
     C**                                                                  CPM004
     C**   CALLED BY #P01  -  FX Deal Processing                          CPM004
     C**             #P02  -  MM Deal Processing                          CPM004
     C**             #P03  -  Deal Amendment Processing                   CPM004
     C**                                                                  CPM004
     C**   CALLS     AOPLCSR1                                             CPM004
     C**                                                                  CPM004
     C*===================================================================CPM004
     C*                                                                   CPM004
     C           #BRCA     BEGSR                           * #BRCA BEGS * CPM004
     C*                                                                   CPM004
     C**   Access Branch Internal Customer, Branch Customer Report        CPM004
     C**   Name and Branch Account Officer.                               CPM004
     C*                                                                   CPM004
     C                     MOVEL'B'       I#PORS                          CPM004
     C                     MOVELBRCA      I#BRCA                          CPM004
      *                                                                   CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   @RTCD   7                       CPM004
     C                     PARM '*KEY   ' @OPTN   7                       CPM004
     C                     PARM           I@PARM                          CPM004
     C                     PARM *BLANKS   O@PARM                          CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM004
      *                                                                   CPM004
     C           @RTCD     IFEQ 'PMA0007'                                 CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVEL'06'      DBASE            ***************CPM004
     C                     MOVE 'SDBRCHPD'DBFILE           * DB ERROR 06 *CPM004
     C                     MOVELI#BRCA    DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C                     ENDSR                           * #BRCA ENDS** CPM004
     C********************************************************************CPM004
      /EJECT
     C*************************************************************************
     C**
     C**   #W0301        -  WRITE TO TRANSACTION REPORT CONTROL AUDIT FILE
     C**
     C**   CALLED BY     -  #P03 - AUDIT PROCESSING
     C**
     C**   CALLS         -
     C**
     C*=========================================================================
     C*
     C           #W0301    BEGSR                           *** #W0301 ***
     C*
     C           *IN72     IFEQ '0'
     C                     UPDATPMTRCNZ0
     C                     ELSE
     C                     WRITEPMTRCNZ0
     C                     END
     C*
     C                     ENDSR                           ** #W0301 END*
     C*************************************************************************
      /EJECT
     C*************************************************************************
     C**
     C**   #W0302        -  WRITE TO LE DAILY TRANSACTION EXTRACT AUDIT
     C**                    REPORT
     C**
     C**   CALLED BY     -  #P03 - AUDIT PROCESSING
     C**
     C**   CALLS         -
     C**
     C*=========================================================================
     C*
     C           #W0302    BEGSR                           *** #W0302 ***
     C*
     C                     WRITEPM0396P1
     C*
     C                     ENDSR                           ** #W0302 END*
     C*************************************************************************
      /EJECT
     C********************************************************************
     C*
     C*  ZFLELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR LENDING
     C*
     C*  FORMAT: XXX 999.9999 DDMMMYY
     C*          XXX =  LOAN CURRENCY
     C*          999.9999 = INTEREST RATE
     C*          DDMMMYY = MATURITY DATE
     C*
     C*  INPUT  FIELDS
     C*       ZCCY    3A     LOAN CURRENCY
     C*       ZINRT  117     INTEREST RATE
     C*       ZMDAT   50     MATURITY DATE
     C*
     C*  OUTPUT  FIELDS
     C*       ZLIN   20A     LINE DESCRIPTION
     C*
     C*  ARRAY USED
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFLELN    BEGSR
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C**   BUILD FORMAT
     C*
     C** MOVE LOAN CURRENCY TO LINE DESCRIPTION
     C                     MOVEAZCCY      ZLI,01
     C*
     C** MOVE INTEREST RATE TO LINE DESCRIPTION
     C                     Z-ADDZINRT     ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C*
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C*
     C** MOVE INTEREST DETAILS INTO OUTPUT ARRAY
     C                     MOVE ZWRKN     ZWRKA4  4
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C** MOVE MATURITY DATE TO LINE DESCRIPTION
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C*
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C**
     C** SET ALL   FIELDS TO BLANKS OR ZEROS
     C                     MOVE *BLANKS   ZCCY    3
     C                     Z-ADD*ZEROS    ZINRT  117
     C                     Z-ADD*ZEROS    ZMDAT   50
     C**
     C                     MOVEAZLI       ZLIN   20
     C**
     C                     ENDSR
     C*******************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C*************************************************************************
     C**
     C**   #INIT         -  INITIAL PROCESSING
     C**
     C**   CALLED BY     -  MAIN PROCESSING
     C**
     C**   CALLS         -
     C**
     C*=========================================================================
     C           #INIT     BEGSR                           *** #INIT ***
     C*
     C** INITIALIZE WORK FIELDS
     C           *LIKE     DEFN CHTP      WWCHTP
     C           *LIKE     DEFN LTYP      WWLTYP
     C           *LIKE     DEFN SUTP      WWSUTP
     C           *LIKE     DEFN CLAS      WWCLAS                                              CLE042
     C           *LIKE     DEFN BBCUST    WWPNP8
     C           *LIKE     DEFN CNUM      WWCNUM
     C           *LIKE     DEFN BRTT      WWBRTT
     C************LIKE     DEFN BRCD      WWBRCD                          S01486
     C           *LIKE     DEFN BRCA      WWBRCD                          S01486
     C           *LIKE     DEFN VDAT      WWVDAT
     C           *LIKE     DEFN RTSP      WWRTSP
     C           *LIKE     DEFN SAT1XT    WWDESI
     C*
      ***  Copyright Statement.                                           S01486
     C                     MOVEACPY@      CPY2@  80
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE *BLANKS   DBLOT
     C                     MOVEL'PM0396'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C** ACCESS BANK DETAILS
     C***********          READ SDBANKPD                 99               S01486
     C***********                                                         S01486
     C***IF*RECORD NOT FOUND, ABORT PROGRAM                               S01486
     C************IN99     IFEQ '1'                                       S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM '*MSG   ' WWRTCD  7                       S01486
     C                     PARM '*FIRST ' WWOPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C           WWRTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE '01'      DBASE
     C***********          MOVEL'SDBANKPD'DBFILE            ************  S01486
     C                     MOVE 'SDBANKPD'DBFILE            * DATABASE *  S01486
     C*                                   DBKEY             * ERROR 01 *
     C                     OUT  LDA                         ************  S01486
     C                     EXSR *PSSR
     C                     END
     C                     MOVEL'Y'       WW396   1
     C*
     C** TEST DATE FORMAT FOR SR/ZDATE2
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C*                                                                   CPM004
     C** ACCESS PM ICD                                                    CPM004
     C*                                                                   CPM004
     C                     CALL 'AOPORTR0'                                CPM004
     C                     PARM *BLANKS   WWRTCD                          CPM004
     C                     PARM '*FIRST  'WWOPTN                          CPM004
     C           SDPORT    PARM SDPORT    DSFDY                           CPM004
     C           WWRTCD    IFNE *BLANKS                                   CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVEL'50'      DBASE            ***************CPM004
     C                     MOVE 'SDPORTPD'DBFILE           * DB ERROR 50 *CPM004
     C                     OUT  LDA                        ***************CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C*
     C********************                                         S01486 081353
     C****ENSURE*AUDIT*SPOOL*FILE*RECORDED*BY*RCF                  S01486 081353
     C********************                                         S01486 081353
     C******************** Z-ADDSFNUMU    ZSNUMU  60               S01486 081353
     C********************                                         S01486 081353
     C******************** CALL 'ZSFILE'                           S01486 081353
     C******************** PARM           SEQ     5                S01486 081353
     C******************** PARM *BLANKS   SENTY   3                S01486 081353
     C******************** PARM           SFILEU                   S01486 081353
     C******************** PARM           ZSNUMU                   S01486 081353
     C******************** PARM *BLANK    ZSERR   1                S01486 081353
     C********************                                         S01486 081353
     C********** ZSERR     IFEQ 'Y'                                S01486 081353
     C********************                                         S01486 081353
     C****ERROR*DURING*ZSFILE*PROCESSING,*RETURN*TO*CALLING*PROGRAMS01486 081353
     C********************                                         S01486 081353
     C******************** SETON                     U7U8LR        S01486 081353
     C******************** RETRN                                   S01486 081353
     C******************** END                                     S01486 081353
     C                     ENDSR                           ** #INIT END **
     C*****************************************************************   R10040
     C/EJECT                                                              R10040
     C*****************************************************************   R10040
     C*                                                                   R10040
     C*    #P40   - OBTAIN ACCOUNT NAME                                   R10040
     C*                                                                   R10040
     C*    INPUT PARAMETERS OF ACCOUNT NUMBER AND CURRENCY                R10040
     C*                                                                   R10040
     C*    OUTPUTS ACCOUNT NAME                                           R10040
     C*                                                                   R10040
     C*****************************************************************   R10040
     C           #P40      BEGSR                           * #P40   BSR * R10040
     C*                                                                   R10040
     C                     MOVE *BLANKS   WWANAM 20                       R10040
     C           ACNKEY    KLIST                                          R10040
     C                     KFLD           WWCNUK                          R10040
     C                     KFLD           SACCY1                          R10040
     C                     KFLD           WWACOK                          R10040
     C                     KFLD           WWACSK                          R10040
     C                     KFLD           WWBRCA                          085867
     C*                                                                   R10040
     C** IF SETTLED ACROSS A RETAIL ACCOUNT OBTAIN ACCOUNT NAME           R10040
     C           WWSETM    IFEQ '04'                                      R10040
     C           WWSETM    OREQ '05'                                      R10040
     C           WWSETM    OREQ '14'                                      R10040
     C           WWSETM    OREQ '15'                                      R10040
     C*                                                                   R10040
     C                     MOVE WWSTAC    WWCHK2  2                       R10040
     C*                                                                   R10040
     C** IF 10N ACCOUNT CODE ACCESS LF/ACNUM TO GET RETAIL ACCOUNT        R10040
     C** DETAILS                                                          R10040
     C           WWCHK2    IFEQ *BLANKS                                   R10040
     C           WWSTAC    ANDNE*BLANKS                                   R10040
     C                     MOVELWWSTAC    WWWK10 100                      R10040
     C*                                                                   R10040
     C***********WWWK10    CHAINACNUM                73             R10040B9930
     C           WWWK10    CHAINACNUMA               73                   B9930
     C           *IN73     IFEQ '0'                                       R10040
     C                     MOVE ANAM      WWANAM                          R10040
     C                     END                                            R10040
     C*                                                                   R10040
     C** IF 12A ACCOUNT CODE ACCESS LF/ACCNT TO GET RETAIL ACCOUNT        R10040
     C** DETAILS                                                          R10040
     C                     ELSE                                           R10040
     C**********           MOVELWWSTAC    WWWK1A 10                                    R10040 CGL029
     C                     MOVELWWSTAC    WWWK1A 16                                           CGL029
     C                     MOVE WWSTAC    WWACSK  20                      R10040
     C**********           MOVELWWSTAC    WWCNUK  60                                   R10040 CSD027
     C                     MOVELWWSTAC    WWCNUK  6                                           CSD027
     C**********           MOVE WWWK1A    WWACOK  40                                   R10040 CGL029
     C                     MOVE WWWK1A    WWACOK 100                                          CGL029
     C*                                                                   R10040
     C           ACNKEY    CHAINACCNT                73                   R10040
     C           *IN73     IFEQ '0'                                       R10040
     C                     MOVE ANAM      WWANAM                          R10040
     C                     END                                            R10040
     C                     END                                            R10040
     C                     END                                            R10040
     C*                                                                   R10040
     C                     MOVE *BLANKS   WWSETM  2                       R10040
     C                     MOVE *BLANKS   WWSTAC 12                       R10040
     C                     MOVE *BLANKS   WWBRCA  3                       085867
     C*                                                                   R10040
     C                     ENDSR                           * #P40   ESR * R10040
     C**************************************************************************
      /EJECT
     C**************************************************************************
      ** *PSSR       :      FILE EXCEPTION ERROR HANDLING SUBROUTINE
      ** CALLED FROM : MAIN
      ** CALLS       :
     C*=========================================================================
     C           *PSSR     BEGSR                            ** *PSRR BSR**
     C**
     C** ROLL BACK CHANGES , DUMP AND RETURN TO THE CALLING PROGRAM
     C**
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     DUMP
     C                     RETRN
     C**
     C                     ENDSR                            ** *PSRR ESR**
     C*=========================================================================
**  DEAL AMENDMENT TYPES
SCCISIPIPDMR
**  DEAL AMENDMENT NARRATIVES
GUAR RATE CHANGE
GUAR INT CAPITLN
GUAR INT SETTLEMNT
GUAR PRINC INCR
GUAR PRINC DECR
GUAR MANUAL REP
**  LOAN AMENDMENT NARRATIVES
LOAN RATE CHANGE
LOAN INT CAPITLN
LOAN INT SETTLEMNT
LOAN PRINC INCR
LOAN PRINC DECR
LOAN MANUAL REP
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Finastra International Limited 2001
