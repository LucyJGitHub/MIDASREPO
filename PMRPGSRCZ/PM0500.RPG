     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM T/O by Currency per A/C Officer')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                      *
     F*                                                               *
     F*  PM0500  - TURNOVER BY CURRENCY PER A/C OFFICER               *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSD031             Date 10Apr06               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. S01486             Date 28Sep94               *
      *                 47719              Date 23Nov92               *
     F*                 33615              DATE 04NOV91               *
     F*                 32687              DATE 02NOV91               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
     F*  S01486 - PORTFOLIO MANAGEMENT UPGRADE TO R10                 *
     F*  47719  - CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES    *
     F*  32687  - OVERFLOW PROBLEM                                    *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F***SDBANKL1IF**E           K        DISK                            S01486
     F******PREFIX*:*BJ************************************************   S01486
     F***********                                      KINFSR *PSSR       S01486
     F***SDACOFL1IF**E           K        DISK                         UC S01486
     F******PREFIX*:*AZ************************************************   S01486
     F***********                                      KINFSR *PSSR       S01486
     F***SDCURRL0IF**E           K        DISK                            S01486
     F******PREFIX*:*A6************************************************   S01486
     F***********                                      KINFSR *PSSR       S01486
     F***PMHSEXPPIF**E           K        DISK                            S01486
     FPMHSEXPDIF  E           K        DISK                               S01486
     F** PREFIX : Q8
     F                                              KINFSR *PSSR
     F***SDDEPTL1IF**E           K        DISK                            S01486
     F******PREFIX*:*AE************************************************   S01486
     F***********                                      KINFSR *PSSR       S01486
     F***PMTUR1POIF**E                    DISK                            S01486
     FPMTUR1Q0IF  E                    DISK                               S01486
     F                                              KINFSR *PSSR
     F***PM0500P1O***E                    PRINTER                     UC  S01486
     FPM0500P1O   E                    PRINTER      KINFDS SPOOL      UC  S01486
     F** PREFIX : RR
     FPM0500AUO   E                    PRINTER      KINFDS SPOOLU         S01486
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       31         AMOUNT 1 IS GREATER THAN 0
     F*       32         AMOUNT 2 IS GREATER THAN 0
     F*       33         AMOUNT 3 IS GREATER THAN 0
     F*       34         AMOUNT 4 IS GREATER THAN 0
     F*       35         AMOUNT 5 IS GREATER THAN 0
     F*
      ****************************************************************    S01486
     F********70*********NEW*A/C*OFFICER******************************    S01486
     F********71*********NEW*CURRENCY*********************************    S01486
     F********72*********FIRST*RECORD*HAS*BEEN*READ*******************    S01486
     F*       72         SPOOL FILE OPENED                                S01486
     F********81*********FILE*OPERATIONS*INDICATOR*-*SDCURRL0*********    S01486
     F********82*********FILE*OPERATIONS*INDICATOR*-*SDBANKL1*********    S01486
     F********84*********FILE*OPERATIONS*INDICATOR*-*SDDEPTL1*********    S01486
     F********85*********FILE*OPERATIONS*INDICATOR*-*PMTUR1PO*********    S01486
     F*       85         FILE OPERATIONS INDICATOR - PMTUR1Q0             S01486
     F*       86         FILE OPERATIONS INDICATOR - PM0500P1
     F*
     F*       98         DATE IN FORMAT MMDDYY
     F*       99         WORK
     F*
     F*                Unused indicators
     F*                -----------------
     F*       01  02  03  04  05  06  07  08  09  10
     F*       11  12  13  14  15  16  17  18  19  20
     F*       21  22  23  24  25  26  27  28  29  30
     F*       ..  ..  ..  ..  ..  36  37  38  39  40
     F*       41  42  43  44  45  46  47  48  49  50
     F*       51  52  53  54  55  56  57  58  59  60
     F*       61  62  63  64  65  66  67  68  69  70
     F*       71  ..  73  74  75  76  77  78  79  80
     F*       81  82  83  84  ..  ..  87  88  89  90
     F*       91  92  93  94  95  96  97  ..  ..
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     E*=========================================================================
     E*
     E** ARRAY FOR COPYRIGHT
     E*
     E                    CPY@    1   1 80
     E*
     E** ARRAY TO STORE CURRENCIES
     E*
     E                    WWC       200  3
     E*
     E***ARRAY*FOR QCMDEXC - IBM COMMAND                                  S01486
     E***********                                                         S01486
     E***********         CMD     1   1 39                                S01486
     E* ARRAY CONTENTS LINE DELETED AT BOTTOM OF THE PGM , CONTAINING :   S01486
     E* OVRPRTF FILE(PM0500P1) SPLFNAME(PM0500P                           S01486
     E***********                                                         S01486
     E***ARRAY*FOR TEXT TO BE OUTPUT                                      S01486
     E***********                                                         S01486
     E***********         TXT     1   2 30                                S01486
     E* ALL DEPARTMENTS                                                   S01486
     E* ALL ACCOUNT OFFICERS                                              S01486
     E* ARRAY CONTENTS LINE DELETED AT BOTTOM OF THE PGM , CONTAINING :   S01486
     E*
     E** ARRAYS FOR S/R ZSEDIT
     E*
      /COPY ZSRSRC,ZSEDITZ1
     E*
     E** ARRAYS FOR S/R ZDATE2
     E*
      /COPY ZSRSRC,ZDATE2Z1
     E*
     E** ARRAY FOR S/R ZCCYCN
     E*
      /COPY ZSRSRC,ZPOWERZ1
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA         DS                            256
     I**************************************132 141 WWFILE                S01486
     I                                      134 141 WWFILE                S01486
     I                                      142 170 WWKEY
     I                                      171 180 WWPGM
     I                                      181 1830WWASE
     I*
     I** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I** DATA STRUCTURE TO F0RMAT DATES
     I*
     IZDATDS      DS
     I                                        1   60ZDATE
     I****                                    1   20MMTDAY                33615
     I****                                    5   60YYTDAY                33615
     I                                        1   20MMTDY1                33615
     I                                        5   60YYTDY1                33615
      /COPY ZSRSRC,ZSEDITZ2
     I*
     I** DATA STRUCTURE TO F0RMAT AMOUNTS
     I*
     IZOUT21      DS                             21
     I                                        1  16 WFIELD
      *                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I** EXTERNAL DS FOR BANK DETAILS                                     S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I** EXTERNAL DS FOR CURRENCY DETAILS                                 S01486
     ISDACOF    E DSSDACOFPD                                              S01486
     I** EXTERNAL DS FOR A/C OFFICER DETAILS                              S01486
      *                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01486
      *                                                                   S01486
     ISPOOL       DS                                                      S01486
     I                                       83  92 SFILE                 S01486
     I                                    B 123 1240SFNUM                 S01486
     I                                    B 367 3680LINE                  S01486
     ISPOOLU      DS                                                      S01486
     I                                       83  92 SFILEU                S01486
     I                                    B 123 1240SFNUMU                S01486
     I                                    B 367 3680LINE1                 S01486
      *                                                                        *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     -                                                       *
      * #INIT    - INITIALIZE STANDARD FIELDS, ACCESS STANDING DATA      *
      * #PA01    - INITIALIZE PRINTER FILE FIELDS, READ PMTUR1PO         *
      * #PR01    - PROCESS HEADER PRINTING                               *
      * #PR02    - PROCESS DEPARTMENT DETAILS                            *
      * #PR022   - FORMAT INSTRUMENT CCY AMOUNTS, CALCULATE TOTALS          *
      * #PR05    - PROCESS FX DETAILS                                    *
      * #W02     - PRINT INSTRUMENT CCY TOTALS                              *
      * #W04     - FORMAT AND PRINT A/C OFFICER TOTALS                      *
      * #W05     - FORMAT AND PRINT DEPARTMENT TOTALS                    *
      * #NEWP    - START NEW PAGE                                        *
      * #OVRP    - OERRIDE WITH PRINTER FILE                             *
      * #RIDP    - REMOVE IMPLIED DECIMAL PLACES                         *
      * *PSSR    - FILE ERROR HANDLING                                   *
      * ZCCYCN   - CONVERT AMOUNT USING SPOT RATES FOR THE CURRENCIES    *
      * ZCCYXR   - CONVERT AMOUNT USING EXCHANGE RATE BETWEEN CURR.      *
      * ZDATE2   - CONVERT MIDAS DAY NUMBER TO DDMMYY                    *
      * ZSEDIT    - EDIT AMOUNT FOR PRINTING                              *
      * ZZTUR    - CALCULATE RUNNING TOTALS                              *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      * QCMDEXC  -                                                       *
      *                                                                  *
      ********************************************************************
     C*================================================================
     C*
     C**  D E F I N E   W O R K   F I E L D S
     C*
     C************LIKE     DEFN AEPRTL    WWPREF                          S01486
     C           *LIKE     DEFN MMTDAY    MMPREV
     C           *LIKE     DEFN YYTDAY    YYPREV
     C           *LIKE     DEFN SBMTHN    ZZMM
     C           *LIKE     DEFN SBYRNO    ZZYY
     C           *LIKE     DEFN ZAMTT     WWAMNT
     C           *LIKE     DEFN ZAMTT     ZZAMT
     C           *LIKE     DEFN ZAMTT     ZAMT1
     C           *LIKE     DEFN ZAMTT     ZAMT2
     C           *LIKE     DEFN ZAMTT     ZAMT3
     C           *LIKE     DEFN ZAMTT     ZAMT4
     C           *LIKE     DEFN ZAMTT     ZAMT5
     C           *LIKE     DEFN ZAMTT     WWTO21
     C           *LIKE     DEFN ZAMTT     WWTO22
     C           *LIKE     DEFN ZAMTT     WWTO23
     C           *LIKE     DEFN ZAMTT     WWTO24
     C           *LIKE     DEFN ZAMTT     WWTO25
     C************LIKE     DEFN ZAMTT     WWTO41                          S01486
     C************LIKE     DEFN ZAMTT     WWTO42                          S01486
     C************LIKE     DEFN ZAMTT     WWTO43                          S01486
     C************LIKE     DEFN ZAMTT     WWTO44                          S01486
     C************LIKE     DEFN ZAMTT     WWTO45                          S01486
     C************LIKE     DEFN TT        XX                              S01486
     C*================================================================
      /EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR #INIT
     C                     EXSR #PA01
     C*
     C** TERMINATE PROGRAM
     C*
     C                     MOVE '1'       *INLR
     C*================================================================
     C*  P R O G R A M     E N D
     C*================================================================
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #INIT    - INITIALIZE STANDARD FIELDS, ACCESS STANDING DATA      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - FILE ERROR HANDLING                                   *
      * ZDATE2   - CONVERT MIDAS DAY NUMBER TO DDMMYY                    *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCMD    - PARAMETER FIELD FOR PGM 'QCMDEXC'                     *
      * WWPRTL   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #INIT     BEGSR                           ** #INIT  BSR *
     C*
     C                     MOVEL'J'       ZECODE
     C*
     C** RECEIVE INPUT PARAMETERS
     C*
     C           *ENTRY    PLIST
     C                     PARM           SEQ     5                       S01486
     C***********          PARM           WWDEPT  4                       S01486
     C                     PARM           WWACOF  4
     C*
     C** PREPARE LDA
     C*
     C                     MOVEL'PM0500'  DBPGM  10
     C*
     C** GET INSTALLATION CONTROL DATA RECORD 1
     C*
     C***********          READ SDBANKL1                 82               S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST ' P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*
     C************IN82     IFEQ '1'                                       S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD1         DBASE   30       **DB ERROR 01**
     C***********          MOVEL'SDBANKL1'DBFILE 10                       S01486
     C                     MOVEL'SDBANKPD'DBFILE                          S01486
     C                     MOVE *BLANKS   DBKEY  29
     C                     WRITEPM0500F1                                  S01486
     C                     EXSR *PSSR
     C                     ELSE
     C*                                                                   S01486
     C**  WRITE AUDIT FILE HEADER                                         S01486
     C*                                                                   S01486
     C                     MOVE BJURPT    TITL                            S01486
     C                     MOVE BJMRDT    RUNA                            S01486
     C                     WRITEPM0500F0                                  S01486
     C*                                                                   S01486
     C**  ENSURE AUDIT SPOOL FILE RECORDED BY RCF                         S01486
     C*                                                                   S01486
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01486
     C*                                                                   S01486
     C                     CALL 'ZSFILE'                                  S01486
     C                     PARM           SEQ                             S01486
     C                     PARM *BLANKS   SENTY                           S01486
     C                     PARM           SFILEU                          S01486
     C                     PARM           ZSNUMU                          S01486
     C                     PARM *BLANK    ZSERR                           S01486
     C*                                                                   S01486
     C           ZSERR     IFEQ 'Y'                                       S01486
     C*                                                                   S01486
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01486
     C*                                                                   S01486
     C                     SETON                     U7U8LR               S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C*
     C** GET BASE CURRENCY DETAILS
     C*
     C***********BJCYCD    CHAINSDCURRL0             81                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C                     PARM BJCYCD    P@KEY3  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*
     C************IN81     IFEQ '1'                                       S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD2         DBASE            **DB ERROR 02**
     C***********          MOVEL'SDCURRL0'DBFILE                          S01486
     C                     MOVEL'SDCURRPD'DBFILE                          S01486
     C                     MOVELBJCYCD    DBKEY                           S01486
     C                     WRITEPM0500F1                                  S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C****                 MOVE BJCYCD    ZCCYT                           47719
     C****                 Z-ADDA6SPRT    ZRATET                          47719
     C****                 MOVELA6MDIN    ZMDINT                          47719
     C                     MOVE BJCYCD    ZCCYT   3                       47719
     C                     Z-ADDA6SPRT    ZRATET 138                      47719
     C                     MOVELA6MDIN    ZMDINT  1                       47719
     C                     Z-ADDA6NBDP    ZCDPT
     C                     Z-ADDA6NBDP    WWBASE  10
     C*
     C                     END
     C*
     C** INITIALIZE '1ST RECORD' INDICATOR
     C*
     C                     MOVE '0'       *IN72
     C*
     C****BUILD*COMMAND EXPRESSION FOR QCMDEXC                            S01486
     C***********                                                         S01486
     C***********          MOVELCMD,1     WWCMD  43                       S01486
     C***********          MOVE ')'       WWPRTL  4                       S01486
     C*
     C** SAVE NO. OF DECIMAL PLACES FOR BASE CURRENCY
     C*
     C                     MOVELA6NBDP    ZCDPT
     C                     MOVELBJCYCD    RRCYCD
     C*
     C** CALCULATE DATES TO BE USED IN SUBROUTINE ZZTUR
     C*
     C                     MOVE '1'       *IN98
     C                     MOVELBJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C*
     C                     Z-ADDMMTDY1    MMTDAY  20
     C                     Z-ADDYYTDY1    YYTDAY  20
     C*
     C           YYTDAY    IFEQ 0
     C                     Z-ADD99        YYPREV
     C                     ELSE
     C                     MOVE YYTDAY    YYPREV
     C                     SUB  1         YYPREV
     C                     END
     C*
     C           MMTDAY    IFEQ 1
     C                     Z-ADD12        MMPREV
     C                     ELSE
     C                     MOVE MMTDAY    MMPREV
     C                     SUB  1         MMPREV
     C                     END
     C*
     C                     ENDSR                           ** #INIT  ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #PA01    - INITIALIZE PRINTER FILE FIELDS, READ PMTUR1PO         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #OVRP    - OERRIDE WITH PRINTER FILE                             *
      * #PR01    - PROCESS HEADER PRINTING                               *
      * #PR02    - PROCESS DEPARTMENT DETAILS                            *
      * #W05     - FORMAT AND PRINT DEPARTMENT TOTALS                    *
      * #PR05    - PROCESS FX DETAILS                                    *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTO41   - DEPARTMENT TOTAL 1                                    *
      * WWTO42   - DEPARTMENT TOTAL 2                                    *
      * WWTO43   - DEPARTMENT TOTAL 3                                    *
      * WWTO44   - DEPARTMENT TOTAL 4                                    *
      * WWTO45   - DEPARTMENT TOTAL 5                                    *
      *                                                                  *
      ********************************************************************
     C           #PA01     BEGSR                           ** #PA01  BSR *
     C*
     C***********          READ PMTUR1PO                 85               S01486
     C                     READ PMTUR1Q0                 85               S01486
     C*
     C***OPEN*PRINTER FILE                                                S01486
     C***********                                                         S01486
     C***********          EXSR #OVRP                                     S01486
     C*
     C** PRINT HEADER & 'NO DETAIL TO REPORT'
     C*
     C           *IN85     IFEQ '1'
     C*
     C***IF*SPECIFIC DEPARTMENT REQUESTED OBTAIN DEPARTMENT NAME          S01486
     C***********                                                         S01486
     C***********WWDEPT    IFNE '*ALL'                                    S01486
     C***********          MOVELWWDEPT    AEDPCD                          S01486
     C***********          MOVE *BLANKS   RRDPCD                          S01486
     C***********          MOVELAEDPCD    RRDPCD                          S01486
     C***********AEDPCD    CHAINSDDEPTL1             84                   S01486
     C***********          MOVELAEDPNM    RRDPNM                          S01486
     C***********                                                         S01486
     C***OTHERWISE OUTPUT ALL + TEXT                                      S01486
     C***********                                                         S01486
     C***********          ELSE                                           S01486
     C***********          MOVEL'*ALL'    RRDPCD                          S01486
     C***********          MOVE TXT,1     RRDPNM                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***IF*SPECIFIC ACCOUNT OFFICER REQUESTED OBTAIN A/C OFFICER NAME    S01486
     C***********                                                         S01486
     C***********WWACOF    IFNE '*ALL'                                    S01486
     C***********          MOVELWWACOF    AZACOC                          S01486
     C***********          MOVELAZACOC    RRACOC                          S01486
     C***********          OPEN SDACOFL1                                  S01486
     C***********AZACOC    CHAINSDACOFL1             84                   S01486
     C***********          MOVELAZACON    RRACON                          S01486
     C***********          CLOSESDACOFL1                                  S01486
     C***********                                                         S01486
     C***OTHERWISE OUTPUT ALL + TEXT                                      S01486
     C***********                                                         S01486
     C***********          ELSE                                           S01486
     C***********          MOVEL'*ALL'    RRACOC                          S01486
     C***********          MOVE TXT,2     RRACON                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          WRITEHEADRE                                    S01486
     C***********          WRITEDEPMT                                     S01486
     C***********          WRITENODET                                     S01486
     C                     WRITEPM0500F2                                  S01486
     C                     GOTO E#PA01                                    S01486
     C                     END
     C*
     C           *IN85     DOWEQ'0'
     C*
     C***ZEROISE*DEPARTMENT TOTALS                                        S01486
     C***********                                                         S01486
     C***********          Z-ADD0         WWTO41                          S01486
     C***********          Z-ADD0         WWTO42                          S01486
     C***********          Z-ADD0         WWTO43                          S01486
     C***********          Z-ADD0         WWTO44                          S01486
     C***********          Z-ADD0         WWTO45                          S01486
     C***********          MOVE *BLANKS   RRDPCD                          S01486
     C***********          MOVELAEDPCD    RRDPCD                          S01486
     C***********          MOVELAEDPCD    WWDPCD  3                       S01486
     C*
     C***PROCESS*HEADER*PRINTING**************************************    S01486
     C** END PREVIOUS ACCOUNT OFICER SPOOL FILE, IF OPENED                S01486
     C*
     C           *IN72     IFEQ *ON                                       S01486
     C                     EXSR #PR01
     C                     ENDIF                                          S01486
     C***********          Z-ADD0         TT      30                      S01486
     C***********          MOVE 'Y'       WWNDPT  1                       S01486
     C***********                                                         S01486
     C***********AEDPCD    DOWEQWWDPCD                                    S01486
     C************IN85     ANDEQ'0'                                       S01486
     C***********                                                         S01486
     C***PROCESS*DEPARTMENT DETAILS AND CALCULATE DEPARTMENT TOTALS       S01486
     C*
     C                     EXSR #PR02
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********WWTO41    IFEQ 0                                         S01486
     C***********WWTO42    ANDEQ0                                         S01486
     C***********WWTO43    ANDEQ0                                         S01486
     C***********WWTO44    ANDEQ0                                         S01486
     C***********WWTO45    ANDEQ0                                         S01486
     C***********          WRITENOTRN                                     S01486
     C***********          ELSE                                           S01486
     C***********                                                         S01486
     C***FORMAT*AND PRINT DEPARTMENT TOTALS IF ALL ACCOUNT OFFICERS       S01486
     C***IN*DEPARTMENT HAVE BEEN REPORTED                                 S01486
     C***********                                                         S01486
     C***********WWACOF    IFEQ '*ALL'                                    S01486
     C***********          EXSR #W05                                      S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          MOVE *BLANKS   RRDPCD                          S01486
     C***********          MOVELAEDPCD    RRDPCD                          S01486
     C***********          MOVELAEDPCD    WWDPCD                          S01486
     C                     END
     C****                                                                33615
     C****ROCESS FX DETAILS                                               33615
     C****                                                                33615
     C****       *IN72     IFEQ '1'                                       33615
     C****                 EXSR #PR05                                     33615
     C****                 END                                            33615
     C*
     C           *IN72     IFEQ *ON                                       S01486
     C                     WRITEENDRE
     C                     ENDIF                                          S01486
     C           RRACOF    IFEQ *BLANKS                                   S01486
     C                     WRITEPM0500F2                                  S01486
     C                     ENDIF                                          S01486
     C*
     C***********          ENDSR                           ** #PA01  ESR *S01486
     C           E#PA01    ENDSR                           ** #PA01  ESR *S01486
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      **#PR01****-*PROCESS*HEADER*PRINTING****************************   *S01486
      * #PR01    - END OF ONE SPOOL FILE                                 *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **#PR05****-*PROCESS*FX*DETAILS*********************************   *S01486
      **#OVRP****-*OERRIDE*WITH*PRINTER*FILE**************************   *S01486
      **#NEWP****-*START*NEW*PAGE*************************************   *S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      **#PA01****-*INITIALIZE*PRINTER*FILE*FIELDS,*READ*PMTUR1PO*****    *S01486
      * #PR02    - PROCESS DETAILS                                       *S01486
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWPREF   - REFERENCE FIELD FOR PRINTER FILE HANDLING             *
      *                                                                  *
      ********************************************************************
     C           #PR01     BEGSR                           ** #PR01  BSR *
     C*
     C************IN72     IFEQ '0'                                       S01486
     C***********          MOVE '1'       *IN72                           S01486
     C***********          ELSE                                           S01486
     C****                                                                33615
     C****ROCESS FX DETAILS                                               33615
     C****                                                                33615
     C****                 EXSR #PR05                                     33615
     C***********                                                         S01486
     C***OPEN*NEW PRINTER FILE IF NEW PRINTER LOCATION CODE IS READ       S01486
     C***********                                                         S01486
     C***********AEPRTL    IFNE WWPREF                                    S01486
     C                     WRITEENDRE
     C                     CLOSEPM0500P1
     C                     MOVE *OFF      *IN72                           S01486
     C***********          EXSR #OVRP                                     S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********AEDPCD    CHAINSDDEPTL1             84                   S01486
     C***********          MOVELAEDPNM    RRDPNM                          S01486
     C***********          MOVELAZACOC    RRACOC                          S01486
     C***********          MOVELAZACON    RRACON                          S01486
     C***********          EXSR #NEWP                                     S01486
     C*
     C                     ENDSR                           ** #PR01  ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      **#PR02****-*PROCESS*DEPARTMENT*DETAILS*****************************S01486
      * #PR02    - PROCESS  DETAILS                                      *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZZTUR    - CALCULATE RUNNING TOTALS                              *
      * #PR022   - FORMAT INSTRUMENT CCY AMOUNTS, CALCULATE TOTALS          *
      * #W04     - FORMAT AND PRINT A/C OFFICER TOTALS                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #PA01    - INITIALIZE PRINTER FILE FIELDS, READ PMTUR1PO         *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTO21   - A/C OFFICER TOTAL 1                                      *
      * WWTO22   - A/C OFFICER TOTAL 2                                      *
      * WWTO23   - A/C OFFICER TOTAL 3                                      *
      * WWTO24   - A/C OFFICER TOTAL 4                                      *
      * WWTO25   - A/C OFFICER TOTAL 5                                      *
      * XX       - COUNTER FOR CURRENCIES TO STORE                       *
      * TT       - NUMBER OF CURRENCIES STORED                           *
      * WWAMNT   - WORK FIELD FOR CALCULATIONS                           *
      * WWTO41   - DEPARTMENT TOTAL 1                                    *
      * WWTO42   - DEPARTMENT TOTAL 2                                    *
      * WWTO43   - DEPARTMENT TOTAL 3                                    *
      * WWTO44   - DEPARTMENT TOTAL 4                                    *
      * WWTO45   - DEPARTMENT TOTAL 5                                    *
      *                                                                  *
      ********************************************************************
     C           #PR02     BEGSR                           ** #PR02  BSR *
     C*
     C** ZEROISE A/C OFFICER TOTALS
     C*
     C                     Z-ADD0         WWTO21
     C                     Z-ADD0         WWTO22
     C                     Z-ADD0         WWTO23
     C                     Z-ADD0         WWTO24
     C                     Z-ADD0         WWTO25
     C                     MOVE '0'       *IN31
     C                     MOVE '0'       *IN32
     C                     MOVE '0'       *IN33
     C                     MOVE '0'       *IN34
     C                     MOVE '0'       *IN35
     C                     MOVELAZACOC    RRACOC
     C                     MOVELAZACOC    WWACOC  2
     C                     MOVELAZACON    RRACON
     C                     Z-ADD0         WWPSAC  30
     C*
     C***CHECK*WHETHER NEW ACCOUNT OFFICER DETAILS ALREADY OUTPUT         S01486
     C***********                                                         S01486
     C***********WWNDPT    IFEQ 'N'                                       S01486
     C***********          MOVE '1'       *IN70                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********WWNDPT    IFEQ 'Y'                                       S01486
     C***********          MOVE 'N'       WWNDPT                          S01486
     C***********          END                                            S01486
     C*
     C** DO WHILE SAME A/C OFFICER
     C*
     C           AZACOC    DOWEQWWACOC
     C***********AEDPCD    ANDEQWWDPCD                                    S01486
     C           *IN85     ANDEQ'0'
     C*
     C** ZEROISE INSTRUMENT CCY AMOUNTS
     C*
     C                     Z-ADD0         ZAMT1
     C                     Z-ADD0         ZAMT2
     C                     Z-ADD0         ZAMT3
     C                     Z-ADD0         ZAMT4
     C                     Z-ADD0         ZAMT5
     C                     Z-ADD0         ZAMT1A
     C                     Z-ADD0         ZAMT2A
     C                     Z-ADD0         ZAMT3A
     C                     Z-ADD0         ZAMT4A
     C                     Z-ADD0         ZAMT5A
     C*
     C** GET CURRENCY DETAILS FOR CONVERSION
     C*
     C***********SBICCY    CHAINSDCURRL0             81                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C                     PARM SBICCY    P@KEY3  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C****                 MOVE A6CYCD    ZCCYF
     C****                 Z-ADDA6SPRT    ZRATEF
     C****                 MOVELA6MDIN    ZMDINF
     C****                 Z-ADDA6NBDP    ZCDPF
     C                     MOVELA6CYNM    RRCYNM
     C                     MOVELSBICCY    RRICCY
     C*
     C** DO WHILE SAME CURRENCY
     C*
     C           RRICCY    DOWEQSBICCY
     C           AZACOC    ANDEQWWACOC
     C***********AEDPCD    ANDEQWWDPCD                                    S01486
     C           *IN85     ANDEQ'0'
     C*
     C** CALCULATE INSTRUMENT CCY AMOUNTS
     C*
     C                     Z-ADDSBTNVR    ZZAMT
     C                     Z-ADDSBYRNO    ZZYY
     C                     Z-ADDSBMTHN    ZZMM
     C                     EXSR ZZTUR
     C*                                                                   33615
     C** OBTAIN FX RATES FROM PMHSEXPP                                    33615
     C*                                                                   33615
     C           SBICCY    IFNE W1ICCY                                    33615
     C           SBYRNO    ORNE W1YRNO                                    33615
     C           SBMTHN    ORNE W1MTHN                                    33615
     C*                                                                   33615
     C** DETERMINE FX RATE TO BASE WHEN TRANSACTION DONE USING SR/ZHRATE  33615
     C                     Z-ADDSBMTHN    ZMTHN                           33615
     C                     Z-ADDSBYRNO    ZYEARN                          33615
     C                     MOVE SBICCY    ZCCY                            33615
     C                     EXSR ZHRATE                                    33615
     C*                                                                   33615
     C** NO RATE FOUND - TERMINATE WITH DATABASE ERROR                    33615
     C           *IN99     IFEQ '1'                                       33615
     C***********          Z-ADD19        DBASE   30  *DB ERROR 01**33615 S01486
     C***********          MOVEL'PMHSEXPP'DBFILE 10                 33615 S01486
     C                     MOVE ZCCY      DBKEY  29                       33615
     C                     Z-ADD19        DBASE   30       **DB ERROR 19**S01486
     C                     MOVEL'PMHSEXPD'DBFILE                          S01486
     C                     WRITEPM0500F1                                  S01486
     C                     EXSR *PSSR                                     33615
     C                     END                                            33615
     C*                                                                   33615
     C** SET UP DETAILS                                                   33615
     C                     MOVELSBICCY    W1ICCY  3                       33615
     C                     Z-ADDSBYRNO    W1YRNO  20                      33615
     C                     Z-ADDSBMTHN    W1MTHN  20                      33615
     C                     Z-ADDZFXRT     ZCRSRT                          33615
     C                     MOVELZMDIN     ZCRSMD                          33615
     C                     Z-ADDZCDP      ZCDPF                           33615
     C                     END                                            33615
     C*
     C** CONVERT AMOUNT FROM INSTRUMENT CURRENCY TO BASE CURRENCY
     C*
     C                     Z-ADDSBTNVR    ZAMTF
     C                     EXSR ZCCYXR
     C*
     C** CALCULATE RUNNING TOTALS
     C*
     C                     Z-ADDZAMTT     ZZAMT
     C                     Z-ADDSBYRNO    ZZYY
     C                     Z-ADDSBMTHN    ZZMM
     C                     EXSR ZZTURN
     C*
     C***********          READ PMTUR1PO                 85               S01486
     C                     READ PMTUR1Q0                 85               S01486
     C                     END
     C*
     C           ZAMT1     IFNE 0
     C           ZAMT2     ORNE 0
     C           ZAMT3     ORNE 0
     C           ZAMT4     ORNE 0
     C           ZAMT5     ORNE 0
     C*
     C** FORMAT INSTRUMENT CCY AMOUNTS AND CALCULATE TOTALS
     C*
     C                     EXSR #PR022
     C*
     C** PRINT INSTRUMENT CCY TOTALS
     C*
     C                     ADD  1         WWPSAC
     C           *IN72     IFEQ *OFF                                      S01486
     C                     EXSR #OVRP                                     S01486
     C                     ENDIF                                          S01486
     C                     EXSR #W02
     C                     END
     C*
     C                     END
     C*
     C           WWTO21    IFNE 0
     C           WWTO22    ORNE 0
     C           WWTO23    ORNE 0
     C           WWTO24    ORNE 0
     C           WWTO25    ORNE 0
     C*
     C** FORMAT AND PRINT A/C OFFICER TOTALS
     C*
     C           WWPSAC    IFGT 1
     C                     EXSR #W04
     C                     END
     C*
     C***CALCULATE DEPARTMENT TOTALS                                      S01486
     C***********                                                         S01486
     C***********          ADD  WWTO21    WWTO41                          S01486
     C***********          ADD  WWTO22    WWTO42                          S01486
     C***********          ADD  WWTO23    WWTO43                          S01486
     C***********          ADD  WWTO24    WWTO44                          S01486
     C***********          ADD  WWTO25    WWTO45                          S01486
     C                     END
     C*
     C                     ENDSR                           ** #PR02  ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #PR022   - FORMAT INSTRUMENT CCY AMOUNTS, CALCULATE TOTALS          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #RIDP    - REMOVE IMPLIED DECIMAL PLACES                         *
      * ZSEDIT    - EDIT AMOUNT FOR PRINTING                              *
      * ZCCYCN   - CONVERT AMOUNT USING SPOT RATES FOR THE CURRENCIES    *
      * #W02     - PRINT INSTRUMENT CCY TOTALS                              *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #PR02    - PROCESS DEPARTMENT DETAILS                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAMNT   - WORK FIELD FOR CALCULATIONS                           *
      * WWTO21   - A/C OFFICER TOTAL 1                                      *
      * WWTO22   - A/C OFFICER TOTAL 2                                      *
      * WWTO23   - A/C OFFICER TOTAL 3                                      *
      * WWTO24   - A/C OFFICER TOTAL 4                                      *
      * WWTO25   - A/C OFFICER TOTAL 5                                      *
      *                                                                  *
      ********************************************************************
     C           #PR022    BEGSR                           ** #PR022 BSR *
     C*
     C** GET CURRENCY BEING FORMATTED DETAILS
     C*
     C***********RRICCY    CHAINSDCURRL0             81                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C                     PARM RRICCY    P@KEY3  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*
     C************IN81     IFEQ '1'                                       S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD2         DBASE            **DB ERROR 02**
     C***********          MOVEL'SDCURRL0'DBFILE                          S01486
     C                     MOVEL'SDCURRPD'DBFILE                          S01486
     C                     MOVELRRICCY    DBKEY                           S01486
     C                     WRITEPM0500F1                                  S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C                     Z-ADDA6NBDP    ZCDPT   10
     C*
     C                     Z-ADDZAMT1     WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM11
     C*
     C                     Z-ADDA6NBDP    ZCDPT
     C                     Z-ADDZAMT2     WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM12
     C*
     C                     Z-ADDA6NBDP    ZCDPT
     C                     Z-ADDZAMT3     WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM13
     C*
     C                     Z-ADDA6NBDP    ZCDPT
     C                     Z-ADDZAMT4     WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM14
     C*
     C                     Z-ADDA6NBDP    ZCDPT
     C                     Z-ADDZAMT5     WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM15
     C*
     C                     Z-ADDWWBASE    ZCDPT
     C                     ADD  ZAMT1A    WWTO21
     C                     Z-ADDZAMT1A    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM21
     C*
     C                     ADD  ZAMT2A    WWTO22
     C                     Z-ADDZAMT2A    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM22
     C*
     C                     ADD  ZAMT3A    WWTO23
     C                     Z-ADDZAMT3A    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM23
     C*
     C                     ADD  ZAMT4A    WWTO24
     C                     Z-ADDZAMT4A    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM24
     C*
     C                     ADD  ZAMT5A    WWTO25
     C                     Z-ADDZAMT5A    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRAM25
     C                     ENDSR                           ** #PR022 ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #W02     - PRINT INSTRUMENT CCY TOTALS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #NEWP    - START NEW PAGE                                        *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #PR022   - FORMAT INSTRUMENT CCY AMOUNTS, CALCULATE TOTALS          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #W02      BEGSR                           ** #W02   BSR *
     C*
     C***PRINT*NEW A/C OFFICER CODE AND NAME                              S01486
     C***********                                                         S01486
     C************IN70     IFEQ '1'                                       S01486
     C*********************WRITEACOFF                                     32687
     C***********          WRITEACOFF                  86           32687 S01486
     C************IN86     IFEQ '1'                                 32687 S01486
     C***********          EXSR #NEWP                               32687 S01486
     C***********          END                                      32687 S01486
     C***********          MOVE '0'       *IN70                           S01486
     C***********          END                                            S01486
     C*
     C                     WRITEAMNTS                  86
     C*
     C           *IN86     IFEQ '1'
     C                     EXSR #NEWP
     C                     END
     C*
     C                     ENDSR                           ** #W02   ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #W04     - FORMAT AND PRINT A/C OFFICER TOTALS                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #RIDP    - REMOVE IMPLIED DECIMAL PLACES                         *
      * ZSEDIT    - EDIT AMOUNT FOR PRINTING                              *
      * #NEWP    - START NEW PAGE                                        *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #PR02    - PROCESS DEPARTMENT DETAILS                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTO21   - A/C OFFICER TOTAL 1                                      *
      * WWTO22   - A/C OFFICER TOTAL 2                                      *
      * WWTO23   - A/C OFFICER TOTAL 3                                      *
      * WWTO24   - A/C OFFICER TOTAL 4                                      *
      * WWTO25   - A/C OFFICER TOTAL 5                                      *
      *                                                                  *
      ********************************************************************
     C           #W04      BEGSR                           ** #W04   BSR *
     C*
     C** FORMAT A/C OFFICER TOTALS
     C*
     C           WWTO21    IFEQ 0
     C                     MOVE *BLANKS   RRTO21
     C                     ELSE
     C                     Z-ADDWWTO21    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRTO21
     C                     MOVE '1'       *IN31
     C                     END
     C*
     C           WWTO22    IFEQ 0
     C                     MOVE *BLANKS   RRTO22
     C                     ELSE
     C                     Z-ADDWWTO22    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRTO22
     C                     MOVE '1'       *IN32
     C                     END
     C*
     C           WWTO23    IFEQ 0
     C                     MOVE *BLANKS   RRTO23
     C                     ELSE
     C                     Z-ADDWWTO23    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRTO23
     C                     MOVE '1'       *IN33
     C                     END
     C*
     C           WWTO24    IFEQ 0
     C                     MOVE *BLANKS   RRTO24
     C                     ELSE
     C                     Z-ADDWWTO24    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRTO24
     C                     MOVE '1'       *IN34
     C                     END
     C*
     C           WWTO25    IFEQ 0
     C                     MOVE *BLANKS   RRTO25
     C                     ELSE
     C                     Z-ADDWWTO25    WWAMNT
     C                     EXSR #RIDP
     C                     MOVE WWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE WFIELD    RRTO25
     C                     MOVE '1'       *IN35
     C                     END
     C*
     C                     WRITETOTOF                  86
     C*
     C           *IN86     IFEQ '1'
     C                     EXSR #NEWP
     C                     END
     C*
     C                     ENDSR                           ** #W04   ESR *
      ********************************************************************
      ***/EJECT**                                                         S01486
      ********************************************************************S01486
      ***********                                                        *S01486
      **#W05*****- FORMAT AND PRINT DEPARTMENT TOTALS                    *S01486
      ***********                                                        *S01486
      **SUBROUTINE CALLS:                                                *S01486
      **#RIDP****- REMOVE IMPLIED DECIMAL PLACES                         *S01486
      **ZSEDIT*** - EDIT AMOUNT FOR PRINTING                             *S01486
      **#NEWP****- START NEW PAGE                                        *S01486
      ***********                                                        *S01486
      **SUBROUTINE CALLED FROM:                                          *S01486
      **#PA01****- INITIALIZE PRINTER FILE FIELDS, READ PMTUR1PO         *S01486
      ***********                                                        *S01486
      **ROUTINE*USES VARIABLES:                                          *S01486
      **WWAMNT***- WORK FIELD FOR CALCULATIONS                           *S01486
      **WWTO41***- DEPARTMENT TOTAL 1                                    *S01486
      **WWTO42***- DEPARTMENT TOTAL 2                                    *S01486
      **WWTO43***- DEPARTMENT TOTAL 3                                    *S01486
      **WWTO44***- DEPARTMENT TOTAL 4                                    *S01486
      **WWTO45***- DEPARTMENT TOTAL 5                                    *S01486
      ***********                                                        *S01486
      ********************************************************************S01486
     C***********#W05      BEGSR                           ** #W05   BSR *S01486
     C***********                                                         S01486
     C***FORMAT*DEPARTMENT TOTALS                                         S01486
     C***********                                                         S01486
     C***********WWTO41    IFEQ 0                                         S01486
     C***********          MOVE *BLANKS   RRTO41                          S01486
     C***********          ELSE                                           S01486
     C***********          Z-ADDWWTO41    WWAMNT                          S01486
     C***********          EXSR #RIDP                                     S01486
     C***********          MOVE WWAMNT    ZFLD15                          S01486
     C***********          EXSR ZSEDIT                                    S01486
     C***********          MOVE WFIELD    RRTO41                          S01486
     C***********          MOVE '1'       *IN31                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********WWTO42    IFEQ 0                                         S01486
     C***********          MOVE *BLANKS   RRTO42                          S01486
     C***********          ELSE                                           S01486
     C***********          Z-ADDWWTO42    WWAMNT                          S01486
     C***********          EXSR #RIDP                                     S01486
     C***********          MOVE WWAMNT    ZFLD15                          S01486
     C***********          EXSR ZSEDIT                                    S01486
     C***********          MOVE WFIELD    RRTO42                          S01486
     C***********          MOVE '1'       *IN32                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********WWTO43    IFEQ 0                                         S01486
     C***********          MOVE *BLANKS   RRTO43                          S01486
     C***********          ELSE                                           S01486
     C***********          Z-ADDWWTO43    WWAMNT                          S01486
     C***********          EXSR #RIDP                                     S01486
     C***********          MOVE WWAMNT    ZFLD15                          S01486
     C***********          EXSR ZSEDIT                                    S01486
     C***********          MOVE WFIELD    RRTO43                          S01486
     C***********          MOVE '1'       *IN33                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********WWTO44    IFEQ 0                                         S01486
     C***********          MOVE *BLANKS   RRTO44                          S01486
     C***********          ELSE                                           S01486
     C***********          Z-ADDWWTO44    WWAMNT                          S01486
     C***********          EXSR #RIDP                                     S01486
     C***********          MOVE WWAMNT    ZFLD15                          S01486
     C***********          EXSR ZSEDIT                                    S01486
     C***********          MOVE WFIELD    RRTO44                          S01486
     C***********          MOVE '1'       *IN34                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********WWTO45    IFEQ 0                                         S01486
     C***********          MOVE *BLANKS   RRTO45                          S01486
     C***********          ELSE                                           S01486
     C***********          Z-ADDWWTO45    WWAMNT                          S01486
     C***********          EXSR #RIDP                                     S01486
     C***********          MOVE WWAMNT    ZFLD15                          S01486
     C***********          EXSR ZSEDIT                                    S01486
     C***********          MOVE WFIELD    RRTO45                          S01486
     C***********          MOVE '1'       *IN35                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***PRINT*DEPARTMENT TOTALS                                          S01486
     C***********                                                         S01486
     C***********          WRITELINES                  86                 S01486
     C***********                                                         S01486
     C************IN86     IFEQ '1'                                       S01486
     C***********          EXSR #NEWP                                     S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          WRITETOTDE                  86                 S01486
     C***********                                                         S01486
     C************IN86     IFEQ '1'                                       S01486
     C***********          MOVE '0'       *IN86                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          ENDSR                           ** #W05   ESR *S01486
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #NEWP    - START NEW PAGE                                        *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #PR01    - PROCESS HEADER PRINTING                               *
      * #W02     - PRINT INSTRUMENT CCY TOTALS                              *
      * #W04     - FORMAT AND PRINT A/C OFFICER TOTALS                      *
      * #W05     - FORMAT AND PRINT DEPARTMENT TOTALS                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #NEWP     BEGSR                           ** #NEWP  BSR *
     C*
     C                     WRITEHEADRE
     C***********          WRITEDEPMT                                     S01486
     C                     WRITEACOFF                                     S01486
     C                     WRITETRNVR
     C*
     C                     ENDSR                           ** #NEWP  ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      **#OVRP****-*OERRIDE*WITH*PRINTER*FILE*************************    *S01486
      * #OVRP    - OPEN NEW SPOOL FILE                                   *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * QCMDEXC  -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #PA01    - INITIALIZE PRINTER FILE FIELDS, READ PMTUR1PO         *
      * #PR01    - PROCESS HEADER PRINTING                               *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWPRTL   -                                                       *
      * WWPREF   - REFERENCE FIELD FOR PRINTER FILE HANDLING             *
      * WWCMD    - PARAMETER FIELD FOR PGM 'QCMDEXC'                     *
      *                                                                  *
      ********************************************************************
     C           #OVRP     BEGSR                           ** #OVRP  BSR *
     C*
     C****OVRPRTF TO PRINTER FILE PM0500PXXX (XXX = PRINTER LOCATION CODE)S01486
     C***********                                                         S01486
     C***********          MOVELAEPRTL    WWPRTL                          S01486
     C***********          MOVE AEPRTL    WWPREF                          S01486
     C***********          MOVE WWPRTL    WWCMD                           S01486
     C***********          CALL 'QCMDEXC'                                 S01486
     C***********          PARM WWCMD     QCAA   43                       S01486
     C***********          PARM 43        QCAN   155                      S01486
     C                     OPEN PM0500P1
     C*                                                                   S01486
     C**  ENSURE REPORT SPOOL FILE RECORDED BY RCF                        S01486
     C*                                                                   S01486
     C                     Z-ADDSFNUM     ZSNUM   60                      S01486
     C*                                                                   S01486
     C                     CALL 'ZSFILE'                                  S01486
     C                     PARM           SEQ     5                       S01486
     C                     PARM AZACOC    SENTY   3                       S01486
     C                     PARM           SFILE                           S01486
     C                     PARM           ZSNUM                           S01486
     C                     PARM           ZSERR   1                       S01486
     C*                                                                   S01486
     C           ZSERR     IFEQ 'Y'                                       S01486
     C*                                                                   S01486
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01486
     C*                                                                   S01486
     C                     SETON                     U7U8LR               S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     Z-ADD0         PAGE                            S01486
     C                     MOVE *ON       *IN72                           S01486
     C*                                                                   S01486
     C                     CALL 'AOACOFR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C                     PARM AZACOC    P@KEY3  3                       S01486
     C           SDACOF    PARM SDACOF    DSFDY                           S01486
     C                     MOVELAZACON    RRACON                          S01486
     C                     MOVELAZACOC    RRACOC                          S01486
     C                     MOVELAZACOC    RRACOF                          S01486
     C                     MOVELAZACON    RRACNM                          S01486
     C                     EXSR #NEWP                                     S01486
     C*
     C                     ENDSR                           ** #OVRP  ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #RIDP    - REMOVE IMPLIED DECIMAL PLACES                         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #W04     - FORMAT AND PRINT A/C OFFICER TOTALS                      *
      * #PR022   - FORMAT INSTRUMENT CCY AMOUNTS, CALCULATE TOTALS          *
      * #W05     - FORMAT AND PRINT DEPARTMENT TOTALS                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAMNT   - WORK FIELD FOR CALCULATIONS                           *
      *                                                                  *
      ********************************************************************
     C           #RIDP     BEGSR                           ** #RIPD  BSR *
     C*
     C                     Z-ADD1         YY      10
     C*
     C           YY        DOWLEZCDPT
     C                     DIV  10        WWAMNT    H
     C                     ADD  1         YY
     C                     END
     C*
     C                     ENDSR                           ** #RIDP  ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - FILE ERROR HANDLING                                   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #INIT    - INITIALIZE STANDARD FIELDS, ACCESS STANDING DATA      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR                           ** *PSRR  BSR *
     C*
     C** ROLL BACK CHANGES , DUMP AND RETURN TO THE CALLING PROGRAM
     C*
     C                     SETON                     LRU7U8
     C                     DUMP
     C*
     C** UPDATE LDA WITH ERROR INFORMATION
     C*
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVELDBFILE    WWFILE
     C                     MOVELDBKEY     WWKEY
     C                     MOVELDBPGM     WWPGM
     C                     MOVELDBASE     WWASE
     C                     OUT  LDA
     C*                                                                   S01486
     C**  If printer file is open, output database error reference        S01486
     C*                                                                   S01486
     C           *IN72     IFEQ '1'                                       S01486
     C                     WRITEDBERROR                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     RETRN
     C*
     C                     ENDSR                            ** *PSRR ESR**
     C**************************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE1Z2
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZSEDITZ3
      ****/EJECT                                                          47719
      ****/COPY ZSRSRC,ZCCYCN                                             47719
      /EJECT
      /COPY ZSRSRC,ZCCYXR
      /EJECT
      ********************************************************************
      *                                                                  *
      * ZZTUR    - CALCULATE RUNNING TOTALS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #PR02    - PROCESS DEPARTMENT DETAILS                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           ZZTUR     BEGSR                           *** ZZTUR  ***
     C*
     C** CALCULATE TOTAL TURNOVER FOR PREVIOUS YEAR
     C*
     C           ZZYY      IFEQ YYPREV
     C                     ADD  ZZAMT     ZAMT1
     C                     END
     C*
     C** IF PRESENT MONTH IS JANUARY, PREVIOUS MONTH IS DECEMBER
     C*
     C           MMTDAY    IFEQ 1
     C*
     C           ZZYY      IFEQ YYPREV
     C           ZZMM      ANDEQ12
     C                     ADD  ZZAMT     ZAMT2
     C                     END
     C*
     C                     ELSE
     C*
     C           ZZYY      IFEQ YYTDAY
     C           ZZMM      ANDEQMMPREV
     C                     ADD  ZZAMT     ZAMT2
     C                     END
     C*
     C                     END
     C*
     C** CALCULATE RUNNING YEAR TO DATE
     C*
     C           ZZYY      IFEQ YYTDAY
     C                     ADD  ZZAMT     ZAMT3
     C                     END
     C*
     C** CALCULATE RUNNING MONTH LAST YEAR
     C*
     C           ZZYY      IFEQ YYPREV
     C           ZZMM      ANDEQMMTDAY
     C                     ADD  ZZAMT     ZAMT4
     C                     END
     C*
     C** CALCULATE RUNNING MONTH TO DATE
     C*
     C           ZZYY      IFEQ YYTDAY
     C           ZZMM      ANDEQMMTDAY
     C                     ADD  ZZAMT     ZAMT5
     C                     END
     C*
     C           ZZTEND    ENDSR
      **************************************************************************
      *                                                                  *
      * ZZTURN   - CALCULATE RUNNING TOTALS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #PR02    - PROCESS DEPARTMENT DETAILS                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           ZZTURN    BEGSR                           *** ZZTUR  ***
     C*
     C** CALCULATE TOTAL TURNOVER FOR PREVIOUS YEAR
     C*
     C           ZZYY      IFEQ YYPREV
     C                     ADD  ZZAMT     ZAMT1A 150
     C                     END
     C*
     C** IF PRESENT MONTH IS JANUARY, PREVIOUS MONTH IS DECEMBER
     C*
     C           MMTDAY    IFEQ 1
     C*
     C           ZZYY      IFEQ YYPREV
     C           ZZMM      ANDEQ12
     C                     ADD  ZZAMT     ZAMT2A 150
     C                     END
     C*
     C                     ELSE
     C*
     C           ZZYY      IFEQ YYTDAY
     C           ZZMM      ANDEQMMPREV
     C                     ADD  ZZAMT     ZAMT2A 150
     C                     END
     C*
     C                     END
     C*
     C** CALCULATE RUNNING YEAR TO DATE
     C*
     C           ZZYY      IFEQ YYTDAY
     C                     ADD  ZZAMT     ZAMT3A 150
     C                     END
     C*
     C** CALCULATE RUNNING MONTH LAST YEAR
     C*
     C           ZZYY      IFEQ YYPREV
     C           ZZMM      ANDEQMMTDAY
     C                     ADD  ZZAMT     ZAMT4A 150
     C                     END
     C*
     C** CALCULATE RUNNING MONTH TO DATE
     C*
     C           ZZYY      IFEQ YYTDAY
     C           ZZMM      ANDEQMMTDAY
     C                     ADD  ZZAMT     ZAMT5A 150
     C                     END
     C*
     C                     ENDSR
     C*=========================================================================
     C**************************************************************************
     C*                                                                        *
     C*    ZHRATE SR. TO DETERMINE FX RATE TO BASE CURRENCY AT EOM             *
     C*                                                                        *
     C*   INPUT  FIELDS                                                        *
     C*       ZMTHN   20     NUMBER OF MONTH FOR WHICH RATE REQUIRED           *
     C*       ZYEARN  20     NUMBER OF YEAR FOR WHICH RATE REQUIRED            *
     C*       ZCCY    3      CURRENCY FOR WHICH RATE REQUIRED                  *
     C*                                                                        *
     C*   OUTPUT  FIELDS                                                       *
     C*       ZFXRT  138     FX RATE TO BASE CURRENCY                          *
     C*       ZMDIN   1      MULTIPLY/DIVIDE IND TO BASE CURRENCY              *
     C*       ZCDP    10     CURRENCY DECIMAL PLACES                           *
     C*                                                                        *
     C**************************************************************************
     C*
     C           ZHRATE    BEGSR                           *** ZHRATE ***
     C*
     C**   DEFINE ALL FIELDS
     C                     Z-ADDZMTHN     ZMTHN   20
     C                     Z-ADDZYEARN    ZYEARN  20
     C                     MOVE ZCCY      ZCCY    3
     C                     Z-ADDZFXRT     ZFXRT  138
     C                     MOVE ZMDIN     ZMDIN   1
     C                     Z-ADDZCDP      ZCDP    10
     C*
     C** DEFINE KEY LIST USED TO ACCESS PF/PMHSEXPP
     C           HSEXKY    KLIST
     C                     KFLD           ZCCY
     C                     KFLD           ZDAYNO
     C*
     C** DETERMINE END OF MONTH DATE
     C                     MOVELZMTHN     WWWRK4  4
     C                     MOVE ZYEARN    WWWRK4
     C                     MOVE WWWRK4    ZDATE
     C*
     C                     MOVEL'31'      ZDATE
     C*
     C           ZMTHN     IFEQ 4                              B1
     C           ZMTHN     OREQ 6
     C           ZMTHN     OREQ 9
     C           ZMTHN     OREQ 11
     C                     MOVEL'30'      ZDATE
     C                     END                             E1
     C*
     C** FOR MONTH 2 (FEBRUARY DETERMINE IF LEAP YEAR AND IF SO SET TO 29
     C           ZMTHN     IFEQ 2                          B1
     C                     MOVEL'28'      ZDATE
     C*
     C           ZYEARN    DIV  4         WWWRK3  30
     C                     MVR            WWWRK1  10
     C*
     C           WWWRK1    IFEQ 0                          B2
     C                     MOVEL'29'      ZDATE
     C                     END                             E2
     C                     END                             E1
     C*
     C** CONVERT END OF MONTH DATE TO DAY NUMBER FORMAT
     C                     MOVE *IN98     WIND98  1
     C                     MOVE '0'       *IN98
     C                     EXSR ZDATE1
     C                     MOVE WIND98    *IN98
     C*
     C** DETERMINE RATE APPLYING ON THAT DATE FROM PF/PMHSEXPP
     C           *IN99     IFEQ '0'                        B1
     C***********HSEXKY    SETGTPMHSEXPP                                  S01486
     C***********          READPPMHSEXPP                 90               S01486
     C           HSEXKY    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 90               S01486
     C*
     C** IF RATE NOT FOUND FOR CURRENCY USE EARLIEST HISTORICAL RATE
     C           *IN90     IFEQ '1'                            B2
     C           Q8CCY     ORNE ZCCY
     C***********HSEXKY    SETLLPMHSEXPP                                  S01486
     C***********          READ PMHSEXPP                 90               S01486
     C           HSEXKY    SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 90               S01486
     C*
     C** IF NO RATE FOUND FOR CURRENCY TERMINATE PROGRAM WITH ERROR
     C           *IN90     IFEQ '1'                            B3
     C           Q8CCY     ORNE ZCCY
     C                     MOVE '1'       *IN99
     C                     END                                 E3
     C                     END                                 E2
     C                     END                                 E1
     C*
     C** IF CROSS RATE FOUND FOR CURRENCY SET UP OUTPUT PARAMETERS
     C           *IN99     IFEQ '0'                            B1
     C                     Z-ADDQ8SPOT    ZFXRT
     C                     MOVE Q8MDV1    ZMDIN
     C                     Z-ADDQ8CDP     ZCDP
     C                     END                                 E1
     C*
     C                     ENDSR
     C**************************************************************************
     C*=========================================================================
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
