     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Customer portfolio selection')                *
     F*****************************************************************
     F*                                                               *
     F*  Midas - PORTFOLIO MANAGEMENT                                 *
     F*                                                               *
     F*  PM0630 - PM CUSTOMER PORTFOLIO SELECTION                     *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSD007             Date 28Aug00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 06Jul99               *
      *                 166009             Date 20Aug99               *
      *                 147782             Date 08Mar99               *
      *                 131150             Date 03Mar98               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 089251             DATE 19JUN96               *
     F*                 092937             DATE 19JUN96               *
     F*                 088642             DATE 19JUN96               *
     F*                 073935             DATE 19JUN96               *
     F*                 CPM005             DATE 19JUN96               *
     F*                 CFF004             DATE 02OCT96               *
     F*                 095719             DATE 25JUL96               *
     F*                 103084             DATE 24APR96               *
     F*                 CPM004             DATE 07FEB96               *
     F*                 087631             DATE 05SEP95               *
     F*                 087628             DATE 01SEP95               *
     F*                 085817             DATE 13MAR95               *
     F*                 081239             DATE 02FEB95               *
     F*                 082549             DATE 02FEB95               *
     F*                 082446             DATE 31JAN95               *
     F*                 082443             DATE 31JAN95               *
     F*                 081352             DATE 09JAN95               *
     F*                 S01496             DATE 11NOV94               *
     F*                 S01486             DATE 08JUL94               *
     F*                 061059     MF      DATE 04OCT93               *
     F*                 049421             DATE 22JAN93               *
     F*                 056460             DATE 07JUN93               *
     F*                 047719             DATE 24NOV92               *
     F*                 B08124             DATE 06OCT92               *
     F*                 SA9108             DATE 24AUG92               *
     F*                 S01313             DATE 21JUL92               *
     F*                 B8289              DATE 14NOV91               *
     F*                 034760     MF      DATE 21JAN92               *
     F*                 033503     DT      DATE 30DEC91               *
     F*                 032165     ADIF    DATE 20NOV91               *
     F*                 B08275     DHW     DATE 14NOV91               *
     F*                 B08253             DATE 14NOV91               *
     F*                 B08040     DHW     DATE 14NOV91               *
     F*                 B9883      ADIF    DATE 13NOV91               *
     F*                 B9383      ADIF    DATE 13NOV91               *
     F*                 001396     ADIF    DATE 13NOV91               *
     F*                 001395     ADIF    DATE 13NOV91               *
     F*                 B07926             DATE 05JUN91               *
     F*                 B07898             DATE 03JUN91               *
     F*                 B7862              DATE 28MAY91               *
     F*                 B07822             DATE 22MAY91               *
     F*                 SA9109             DATE 29APR91               *
     F*                 B5859              DATE 22APR91               *
     F*                 B5858              DATE 22APR91               *
     F*                 R5735              DATE 25MAR91               *
     F*                 R5702              DATE 19MAR91               *
     F*                 R05667             DATE 13MAR91               *
     F*                 R05650             DATE 11MAR91               *
     F*                 R5646              DATE 09MAR91               *
     F*                 R5608              DATE 06MAR91               *
     F*                 R5574              DATE 02MAR91               *
     F*                 R5544              DATE 26FEB91               *
     F*                 R5543              DATE 26FEB91               *
     F*                 R5504              DATE 20FEB91               *
     F*                 R0177              DATE 16FEB91               *
     F*                 R0175              DATE 15FEB91               *
     F*                 R0171              DATE 15FEB91               *
     F*                 R0170              DATE 15FEB91               *
     F*                 R0151              DATE 13FEB91               *
     F*                 R1089      BZ      DATE 11JAN91               *
     F*                 R1088      BZ      DATE 11JAN91               *
     F*                 R0824              DATE 10DEC90               *
     F*                 R01118             DATE 04DEC90               *
     F*                 R0981      MDS     DATE 27NOV90               *
     F*                 R0578              DATE 20NOV90               *
     F*                 R10051             DATE 01OCT90               *
     F*                 R10032             DATE 17SEP90               *
     F*                 R10038             DATE 10SEP90               *
     F*                 R00296             DATE 10AUG90               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSD007 - Customer Closing                                    *
     F*  CPB001 -  'Private Banking' Module                           *
     F*  166009 - Birth date not translated correctly.                *
     F*  147782 - Field Market value is too small for big amount      *
     F*           So move some fields to left and increase DDTPMV     *
     F*           ( in PM0630DF )
     F*           Some changes in PM0630 as well.                     *
     F*  131150 - Access correspondance file for language info as this*
     F*           is not part of SDCUSTPD anymore.                    *
     F*  089251 - IF NUMBER OF DECIMAL PLACES IS 0, INITIALISE        *
     F*           VARIABLE A WITH 1 TO ACCESS ARRAY POWER OTHERWISE   *
     F*           PROGRAM EXITS WHEN F6 IS PRESSED                    *
     F*  092937 - INCORRECT PORTFOLIO REF SHOWN IN PORTFOLIO NOTEPAD  *
     F*  088642 - CORRECT PARAMETER FOR SE6714 WITH RIGHT PORTF.  REF *
     F*  073935 - LOAD LDA WHEN USING F24                             *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/5 - INSTRUMENT ASSET/LIABILITY SPLIT           *
     F*           PBFG/6 - ADDITIONAL CUSTOMER DETAILS                *
     F*           PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*           PBFG/1 - CHANGE CUSTOMER/PORTFOLIO BASE CURRENCY    *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
     F*  095719 - If change of customer, values of first one are kept *
     F*           for Forex exposure - fix is to re-access limits     *
     F*           file if customer changes.                           *
     F*  103084 - Show combined portfolio position                    *
     F*  CPM004 - Bank Portfolios                                     *
     F*  087631 - Should only use Precious Metal limits if S01433,    *
     F*           Extended Dealing Limits switchable feature is on.   *
     F*  087628 - Recompiled over LBPLEGPD                            *
     F*  085817 - Recompile due to changes in PMLDAPD                 *
     F*  081239 - R10 Private Banking Rework                          *
     F*  082549 - Action code is protected with Pool Portfolio        *
     F*  082446 - Access to SDMMODPD badly positioned                 *
     F*  082443 - If the return code from the access object is blank  *
     F*           it is not a data base error. Remove error process.  *
     F*  081352 - Validate action codes                               *
     F*  S01496 - Incorporation of Jyske Enhancements (S10978)        *
     F*  S01486 - Portfolio Management Upgrade                        *
     F*  061059 - CHECK AT LEAST IF LOMBARD CREDIT IS 'ON'            *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  056460 - DISPLAY '9997' PORTFOLIO IF CONTAINS ANY POSITIONS  *
     F*  47719  - CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES    *
     F*  B08124 - EDIT PM LIMIT AMOUNT WITH CORRECT DECIMAL PLACES    *
     F*  SA9108 - CHANGED FOR POOL PORTFOLIO FUNCTION                 *
     F*  S01313 - CHANGED FOR PORTFOLIO PERFORMANCE                   *
     F*  B8289  - FORWARD PRECIOUS METAL LINE NOT DROPPED ON EXPIRY   *
     F*  34760  - DBERROR AT 09                                       *
     F*  33503  - LOMBARD CREDIT EXTENDED MARGIN IS SWITCHABLE NOW    *
     F*  32165  - WRONG PORTFOLIO TYPE NAME PASSED TO GDA FOR PORTFOLIO*
     F*           9997, 9998 AND 9999.                                *
     F*  B08275 - ALLOW F15 TO VIEW CLOSED PORTFOLIOS                 *
     F*  B08253 - CHECK WHETHER MATURED POSITIONS EXIST               *
     F*  B08040 - SUNDRY FIXES TO SPEED UP COB                        *
     F*  B9883  - RECOMPILED AFTER CHANGE PM0630DD                    *
     F*  001396 - INVALID DECIMAL PLACES WHEN EDITING LOMBARD FIELDS  *
     F*           (FOREX AND FORPM EXPOSURE SCREEN)                   *
     F*  001395 - INCORRECT DECIMAL PLACES TRANFERRED TO OTHERS       *
     F*           PM ENQUIRY                                          *
     F*  B9383  - SUPPRESS INPUT "FPV DOC" AVAILABLE ONLY FOR         *
     F*           SWISS BANKS                                         *
     F*  B07926 - ALL PORTFOLIO VIEWS SHOULD BE SHOWN IRRESPECTIVE    *
     F*           OF INDICATORS FROM SDPORTPD                         *
     F*  B07898 - REALISED P/L SHOWN INCORRECTLY IF CLIENT HAS BOTH   *
     F*           PROFIT AND LOSS (SHOULD SHOW NET FIGURE)            *
     F*  B7862  - SAR9109 SHOULD USE EEMARG INSTEAD OF EEEXPS TO      *
     F*           CALCULATE CUSTOMER MARGIN.                          *
     F*  B07822 - OUTPUT MARKET VALUE FOR INVESTMENT POLICY ENQUIRY   *
     F*  SA9109 - Margin percentage by customer                       *
     F*  B5859  - Problem conversion of Forex limit.                  *
     F*  B5858  - The forex limit/exposure is not necessary inputed   *
     F*           with the base currency.                             *
     F*  R5735  - AVAILABLE FX AND PM SHOULD NOT EXCEED LIMIT LESS    *
     F*           OPEN DEALS                                          *
     F*  R5702  - AVAILABLE FX AND PM SHOULD BE ZERO IF LIMITS ARE    *
     F*           USED BUT NONE ENTERED FOR THIS CUSTOMER             *
     F*  R05667 - PORTFOLIO VALUE AND ACCRUED INTEREST SHOULD BE      *
     F*           CONVERTED TO CUSTOMER BASE CURRENCY USING LAST      *
     F*           NIGHTS SPOT RATES FROM PF/PMHSEXPP                  *
     F*  R05650 - OUTPUT TEXT INDICATING WHETHER CUSTOMER HAS ISSUED  *
     F*           ANY GENERALISED PLEDGES                             *
     F*  R5646  - AVAIL LENDING CANNOT BE ABOVE BORROW POWER          *
     F*  R5608  - AVAILABLE LENDING CANNOT BE BELOW ZERO              *
     F*  R5574  - AVAILABLE LENDING IS LENDING POWER LESS EXPOSURE    *
     F*  R5545  - AVAILABLE BORROWING WRONGLY CALCULATED              *
     F*  R5544  - AVAILABLE BORROWING AND LENDING CAN'T BE NEGATIVE   *
     F*  R5543  - BORROWING POWER INCLUDED PLEDGE RECEIVED INSTEAD    *
     F*           OF USE OF PLEDGE RECEIVED                           *
     F*  R5504  - FX & PM AVAILABILITY WERE NOT CALCULATED            *
     F*  R0177  - WRONG DECIMAL PLACES ON LIMITS                      *
     F*  R0175  - WRONG NARRATIVE DISPLAYED                           *
     F*  R0171  - TO OUTPUT EXPOSURE AMOUNTS                          *
     F*  R0170  - DISPLAY FORWARD LIMIT INSTEAD OF SPOT               *
     F*  R0151  - CORRECT LOMBARD FX AND METAL FIGURES                *
     F*  R1089  - LOMBARD CREDIT INDICATOR IS ON IF INSTALLED.        *
     F*  R1088  - RETURN CODE '2' IS NOT PROCESSED IN LB0305.         *
     F*  R0824  - OUTPUT EXCEPTION INDICATOR TO SUMMARY               *
     F*  R01118 - Lombard details called from Portfolio Management    *
     F*  R0981  - MODIFY DISPLAY OF LOMBARD DETAILS                   *
     F*           + ADD DISPLAY OF PRECIOUS METAL DETAILS             *
     F*  R0578  - MOVE SET UP OF PLEDGE ETC TO SEPARATE ROUTINE       *
     F*  R10051 - DISPLAY 'MANAGED STATUS' AND 'INVESTMENT POLICY'    *
     F*  R10032 - PASS PORTFOLIO MARKET VALUES (TRADE & VALUE DATE)   *
     F*           IN DTAARA/*LDA                                      *
     F*  R10038 - ADDITIONAL DETAILS TO BE DISPLAYED ON SCREEN        *
     F*  R00296 - INVALID DECIMAL PLACES WHEN EDITING LOMBARD FIELDS  *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F**
     F**SDMMODL1IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F** PREFIX 'BG' **
     F**
     F**SDPORTL1IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F***PREFIX 'P9'                                                      S01486
     F**
     F**SDLOMBPDIF  E                    DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F** PREFIX 'LB' **                                                   S01486
     F**                                                            R5504 S01486
     F**SDLOMBX0IF  E                    DISK                       R5504 S01486
     F**********                                    KINFSR *PSSR    R5504 S01486
     F**********  SDLOMBD0                          KRENAMESDLOMB   R5504 S01486
     F** PREFIX 'LB' **                                             R5504 S01486
     F**
     F**SDCURRL1IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F** PREFIX 'Q8' **                                                   R05667
     F**                                                                  R05667
     F**PMHSEXPPIF  E           K        DISK                      R05667 S01486
     FPMHSEXPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR          R05667
     F** PREFIX 'AG' **
     F**
     FLBEXTSL1IF  E           K        DISK
     F                                              KINFSR *PSSR
     F** PREFIX 'ES' **
     F**                                                                  CPM005
     FPMPCBCL3IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     F** PREFIX 'FM' **                                                   CPM005
     FLBEXTRL3IF  E           K        DISK
     F                                              KINFSR *PSSR
     F** PREFIX 'EE' **
     F**
     FGTEES   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F            GTEESHHF                          KIGNORE
     F            GTEESZZF                          KIGNORE
     F** PREFIX '  ' **
     F**
     F**PMGTEES IF  E           K        DISK                             S01486
     FPMGTEEL0IF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F            GTEESGTF                          KRENAMEGTEESGTX
     F** PREFIX '  ' **
     F**
     F**PMPOTTPPIF  E           K        DISK                             S01486
     FPMPOTTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** PREFIX 'QC' **
     F**
     F**PMPORTPPIF  E           K        DISK                             S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** PREFIX 'PN' **
     F**
     F**PMPTFTPPIF  E           K        DISK                             S01486
     FPMPTFTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** PREFIX 'PE' **
     F**
     F**LIMILBL2IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F** PREFIX 'PN' **
     F**
     F*DLIMTL0IF  E           K        DISK                               R0151
     F*                                             KINFSR *PSSR          R0151
     F** PREFIX 'A2' **
     F**
     F**LIMITBX0IF  E           K        DISK                       R0981 S01486
     F**********                                    KINFSR *PSSR    R0981 S01486
     F** PREFIX 'LI' **                                                   R0981
     F**                                                                  R0981
     F**SDLBCSL0IF  E           K        DISK                             S01486
     F**********                                    KINFSR *PSSR          S01486
     F** PREFIX 'PN' **                                                   S01486
     F**SDLBCSX0IF  E           K        DISK                       SA9109S01486
     F**********                                    KINFSR *PSSR    SA9109S01486
     F** PREFIX 'PN' **                                                   SA9109
     FLBPLEGLOIF  E           K        DISK                               R05650
     F                                              KINFSR *PSSR          R05650
     F** PREFIX 'PG' **                                                   R05650
     F**SDDEALPDIF  E                    DISK                       B5858 S01486
     F**********                                    KINFSR *PSSR    B5858 S01486
     F** PREFIX 'QF' **                                                   B08253
     F**PMMFHLPPIF  E           K        DISK                      B08253 S01486
     FPMMFHLPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08253
     FPMPPTDPDIF  E           K        DISK                               CPM004
     F                                              KINFSR *PSSR          CPM004
     F** PREFIX 'BN' **                                                   B5858
     F** PREFIX 'FE' **                                                   CPM005
     FPMASLIL0IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     F** PREFIX 'FI' **                                                   CPM005
     FPMCIALL0IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     F** PREFIX 'FM' **                                                   CPM005
     FPMICALL0IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     F** PREFIX 'FJ' **                                                   CPM005
     FPMNTCMLLIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     FCGCORRL4IF  E           K        DISK                               131150
     F/COPY WNCPYSRC,PM0630F002
     F**PM0630DDCF  E                    WORKSTN                          S01486
     FPM0630DFCF  E                    WORKSTN                            S01486
     F                                        RRN1  KSFILE PM0630S1
     F                                        RRN2  KSFILE PM0630S2
     F/COPY WNCPYSRC,PM0630F001
     F** PREFIX 'DD' **
     F*************************************************************
     F**                                                         **
     F**                  FUNCTION OF INDICATORS                 **
     F**                                                         **
     F*************************************************************
     F**
     F**
     F*************************************************************
     E**
     E** TABLES AND ARRAYS
     E*********************************************************************
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,ZSEDITZ1
      /COPY ZSRSRC,ZPOWERZ1
     E**
     E                    VC1    10  10  1               Valides codes    S01486
     E***********         VC2        19  1               Valides codS01486CPM005
     E                    CPY@    1   1 80
     E** Array containing Copyright statement
     E*
     I*************************************************************
     I**
     I**
     I** EXTERNAL FORMAT FOR GROUP DATA AREA
     I**
     I**WWGDA     E DSPMGRDAPP                                            S01486
     I**
     I***WWLDA     E DSPMLDAPP                                            S01486
     IWWLDA     E DSPMLDAPD                                               S01486
     I**
     IDSFDY     E DSDSFDY                                                 S01486
     I* First DS For Access Programs, Short Data Structure                S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I* Second DS For Access Programs, Long Data Structure                S01486
     I*                                                                   S01486
     IDSLDY     E DSDSLDY                                                 CSD007
      ** Third DS for access programs, very long data structure           CSD007
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
      * Data area LZSTAT                                            33503 S01486
     I**LZSTAT      DS                          256                 33503 S01486
     I************************************** 19  19 MRGP            34760 S01486
     I************************************** 21  21 LBIC            33503 S01486
     I*
     IPSDS       SDS
     I**********                            244 253 WSID                  S01486
     I**********                            254 263 USID                  S01486
     I                                      244 253 WKSTN                 S01486
     I                                      254 263 USER                  S01486
     ISDMMOD    E DSSDMMODPD                                              S01486
     I** EXTERNAL DS FOR LANGUAGE ID'S                                    S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
      ** PM MODULE ACCESSED VIA ACCESS PROGRAM                            S01486
     I*                                                                   S01486
     ISDLOMB    E DSSDLOMBPD                                              S01486
      ** PM MODULE ACCESSED VIA ACCESS PROGRAM                            S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I* DS FOR CURRENCIES DETAILS                                         S01486
     I*                                                                   S01486
     ISDBOOK    E DSSDBOOKPD                                              CPM004
     I** EXTERNAL DS FOR BOOK DETAILS                                     CPM004
     I*                                                                   CPM004
     ISDDEAL    E DSSDDEALPD                                              S01486
     I** EXTERNAL DS FOR DEALING DETAILS                                  S01486
     I*                                                                   S01486
     ISDCLLM    E DSSDCLLMPD                                              S01486
     I** EXTERNAL DS FOR CUSTOMER LIMITS DETAILS                          S01486
     I*                                                                   S01486
     ISDLBCS    E DSSDLBCSPD                                              S01486
     I* Portfolio Customer Details Accessed Via Access Program            S01486
     I*                                                                   S01486
     ISDCUST    E DSSDCUSTPD                                              S01496
     I** DUMMY RECORD FORMAT FOR CUSTOMER DETAILS                         S01496
     I*                                                                   S01496
     I*                                                                   087631
     ISCSARD    E DSSCSARDPD                                              087631
     I** DUMMY RECORD FORMAT FOR SWITCHABLE FEATURES                      087631
     I*                                                                   087631
     I*                                                                   R10051
     IWWPPDG      DS                                                      R10051
     I                                        1   1 WWPDG1                R10051
     I                                        2   2 WWPDG2                R10051
     I                                        3   3 WWPDG3                R10051
     I                                        4   4 WWPDG4                R10051
     I                                        5   5 WWPDG5                R10051
     I                                        6   6 WWPDG6                R00824
     I                                        7   7 WWPDG7                R00824
     I***********                             8   8 WWPDG8          S01313CPM005
     I***********                             9   9 WWPDG9          S01313CPM005
     I***********                            10  10 WWPDGA          S01496CPM005
     I***********                            11  11 WWPDGB          S01496CPM005
     I                                        8   8 WWPDGA                CPM005
     I                                        9   9 WWPDGB                CPM005
     I*                                                                   S01313
     I** OBTAIN LAST EXTRACT DATE FROM DTAARA/PMSTAT                      S01313
     IPMSTAT      DS                            256                       S01313
     I                                        6  100WRUNDT                CPM005
     I                                       29  330W1LXDT                S01313
     I***********                                                   R10051CPM005
     I***Format*Valid codes                                         S01486CPM005
     I***********                                                   S01486CPM005
     I*********** DS                                                S01486CPM005
     I***********                             1  19 WWVALC          S01486CPM005
     I***********                             1   3 DDVAC1          S01486CPM005
     I***********                             5   7 DDVAC2          S01486CPM005
      /COPY ZSRSRC,ZSEDITZ2
     I/COPY WNCPYSRC,PM0630I001
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      * #P1004   - PROCESS PORTFOLIO DETAILS                             *
      * #P1008   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      * #P1005   - PROCESS LOMBARD CREDITS DETAILS                       *
      * #P1006   - PROCESS LENDING DETAILS FOR ISSUING CUSTOMER          *
      * #P1007   - PROCESS LENDING DETAILS FOR RECEIVING CUSTOMER        *
      * #P1009   - FOREX DETAILS                                         *
      * #P1010   - CALCULATE FOREX LIMIT AMOUNT                          *
      * #P1011   - PRECIOUS METAL DETAILS                                *R0981
      * #P1012   - CALCULATE LIMIT FOR PRECIOUS METAL                    *R0981
      * #P1015   - FILL HEADER, DISPLAY SCREEN                           *
      * #P1016   - SET UP INFORMATION FOR PLEDGE ETC..                   *
      * #U1001   - DISPLAY CUSTOMER DETAILS                              *
      * #U1003   - FORMAT LOMBARD DETAILS                                *
      * #U1004   - FORMAT FOREX DETAILS                                  *
      * #U1005   - FORMAT PRECIOUS METAL DETAILS                         *R0981
      * #W1002   - UPDATE DATA AREA                                      *
      * ZCCYCN   - TO CONVERT AN AMOUNT FROM 1 CCY TO ANOTHER            *
      * ZCCYXR   - SEE ZCCYCN                                            *
      * ZDATE2   - TO CONVERT A MIDAS DATE NUMBER IN ALPHA               *
      * ZSEDIT   - TO EDIT A NUMBER WITH DECIMAL POINT                   *
      * *PSSR    - TO PROCESS DATA BASE ERRORS                           *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      * PMC1010  - TO RETRIEVE DATA AREA                                 *
      * PMC1000  - TO UPDATE DATA AREA                                   *
      * PMC1020  - TO STOP GROUP JOB                                     *
      * PM0660   - SEARCH SELECT WINDOW                                  *
      * PMC0630  - TO START THE SCROLL GROUP JOB                         *
      * PM0600   - NOTEPAD                                               *
      * PM0640   - OPTION 'C' TAKEN                                      *
      *                                                                  *
      ********************************************************************
     C***************************************************************
     C**                  CALCULATIONS                             **
     C***************************************************************
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C           *ENTRY    PLIST                                          R01118
     C                     PARM           WWUPRF 10                       R01118
     C**
     C** KEY LIST
     C**
     C           PMPOTT    KLIST
     C**********           KFLD           WWCUSR  60                                          CSD027
     C                     KFLD           WWCUSR  6                                           CSD027
     C                     KFLD           WWPTFR  4
     C**                                                                  CPM005
     C           PMPOT9    KLIST                                          CPM005
     C**********           KFLD           WWCUSR  60                                   CPM005 CSD027
     C                     KFLD           WWCUSR  6                                           CSD027
     C                     KFLD           WKPTFR  4                       CPM005
     C**                                                                  R05667
     C           PMHSEX    KLIST                                          R05667
     C                     KFLD           WWHCCY  3                       R05667
     C****                 KFLD           WWYEST  50                S01313R05667
     C                     KFLD           W1LXDT  50                      S01313
     C**
     C           PMCOMA    KLIST
     C                     KFLD           WWCUSR
     C                     KFLD           WWSTDT  50
     C           LBEXTR    KLIST
     C                     KFLD           QMCNUM
     C                     KFLD           WWFXUP  3
     C**                                                                  B08253
     C           MFHLK     KLIST                                          B08253
     C**********           KFLD           W1CNUM  60                                   B08253 CSD027
     C                     KFLD           W1CNUM  6                                           CSD027
     C                     KFLD           W1PTFR  4                       B08253
     C                     KFLD           W1DSPS  20                      B08253
     C                     KFLD           W1DSPG  3                       B08253
     C                     KFLD           W1ITDS  20                      B08253
     C                     KFLD           W1INNR  3                       B08253
     C****                 KFLD           W1MODI  2                 B08253S01313
     C****                 KFLD           W1RECI  1                 B08253S01313
     C****                 KFLD           W1TDSS 10                 B08253S01313
     C                     KFLD           W1DLSQ  30                      B08253
     C                     KFLD           W1CCY1  3                 S01313B08253
     C                     KFLD           W1TDSS 10                 S01313B08253
     C**********           KFLD           W1TRNB  60                                   B08253 CLE148
     C                     KFLD           W1TRNB  6                                           CLE148
     C**********           KFLD           W1TXT2 20                                    B08253 CGL029
     C                     KFLD           W1TXT2 26                                           CGL029
     C**                                                                  B08253
     C           MFHLK1    KLIST                                          B08253
     C**********           KFLD           W1CNUM  60                                   B08253 CSD027
     C                     KFLD           W1CNUM  6                                           CSD027
     C                     KFLD           W1PTFR  4                       B08253
     C**
     C** PARAMETER LIST
     C**
     C** *************
     C** PROGRAM START
     C** *************
     C**
     C********** *NAMVAR   DEFN           LZSTAT                    33503 S01486
     C**********           IN   LZSTAT                              33503 S01486
     C**********                                                    33503 S01486
     C                     EXSR #P1001
     C**
     C                     RETRN
     C** ***********
     C** PROGRAM END
     C** ***********
     C***************************************************************
     C**
     ******************************************************************   S01496
     C/EJECT                                                              S01496
     ******************************************************************   S01496
     C* P001   : CHANGE SCREEN                                        *   S01496
     ******************************************************************   S01496
     C*                                                                   S01496
     C           P001      BEGSR                                          S01496
     C*                                                                   S01496
     C** PARAMETERS - DEFINITION AND INITIALIZATION                       S01496
     C                     MOVEL*BLANKS   ##CDBR  3                       S01496
     C                     MOVEL*BLANKS   ##CDCN  6                       S01496
     C                     MOVEL*BLANKS   ##CDSN 10                       S01496
     C                     MOVEL*BLANKS   ##PTFR  4                       S01496
     C                     MOVEL*BLANKS   ##CPBI  1                       S01496
     C                     MOVEL*BLANKS   ##CSBI  1                       S01496
     C                     MOVEL*BLANKS   GBLOCK  1                       S01496
     C*                                                                   S01496
     C                     MOVE QMCNUM    ##CDCN                          S01496
     C                     MOVELQMCNUM    PLCUS                           S01496
     C***********          CALL 'AOCUSTR0'                         S01486 CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM *BLANKS   PRTCD                           S01486
     C                     PARM '*KEY'    POPTN                           S01486
     C                     PARM           PLCUS                           S01486
     C                     PARM           KEYST   7                       S01486
     C***********SDCUST    PARM SDCUST    DSSDY                    S01486 CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
     C********** ##CDCN    CHAINSDCUSTL1             70                   S01496
     C*                                                                   S01496
     C********** *IN70     IFEQ '1'                                       S01496
      *                                                                   CSD007
      ** If CSD007 is on, allow processing of a closed record (return     CSD007
      ** code '*NRF' and date deleted equal to zero).                     CSD007
      *                                                                   CSD007
     C           CSD007    IFEQ 'Y'                                       CSD007
     C           PRTCD     ANDEQ'*NRF'                                    CSD007
     C           BBDTDL    ANDEQ*ZERO                                     CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
      *                                                                   CSD007
     C           PRTCD     IFNE *BLANKS                                   S01496
     C                     MOVEL'Y'       QMDBER                          S01496
     C                     MOVEL'Y'       QMENQT                          S01496
     C                     MOVE 'SDCUST'  QMFILE                          S01496
     C                     MOVE 'PM0630'  QMPGM                           S01496
     C                     MOVE ##CDCN    QMKEY            ***************S01496
     C                     Z-ADD11        QMERRN           **DB ERROR 11**S01496
     C*                                                    ***************S01496
     C***UPDATE*GDA                                                       S01496
     C** UPDATE LDA                                                       S01496
     C*                                                                   S01496
     C**********           CALL 'PMC1002'                                 S01496
     C**********           PARM           WWGDA                           S01496
     C                     CALL 'PMC1001'                                 S01496
     C                     PARM           WWLDA                           S01496
     C*                                                                   S01496
     C** CALL PMC1020 TO TERMINATE GROUP JOB                              S01496
     C*                                                                   S01496
     C**********           CALL 'PMC1020'                                 S01496
     C                     RETRN                                          S01496
     C*                                                                   S01496
     C                     END                                            S01496
      *                                                                   CSD007
     C                     ENDIF                                          CSD007
     C*                                                                   S01496
     C** AFTER THE PORTFOLIO INFORMATIONS WAS RECEIVED FROM BASIC FILE    S01496
     C** AND WHEN PROGRAM BUILT THE SUBFILE LINE.                         S01496
     C*                                                                   S01496
     C** 1. SEARCH IF THERE IS A GENERAL BLOCK PURCHASED AND/OR SALES FOR S01496
     C**    CUSTOMER PORTFOLIO BY CALLING RPG/SE6714 WITH PARAMETERS:     S01496
     C**     - BRANCH CODE (3A)  CURRENT   FIELD NAME - BBBRCD - ##CDBR   S01496
     C**     - CUSTOMER    (6A)  CURRENT   FIELD NAME - QMCNUM - ##CDCN   S01496
     C**     - PORTFOLIO   (4A)  BLANK     FIELD NAME - DDPTFR - ##PTFR   S01496
     C**     - CUSTOMER PURCH.GEN.BLOCK IND. (1A)  BLANK         ##CPBI   S01496
     C**     - CUSTOMER SALES GEN.BLOCK IND. (1A)  BLANK         ##CSBI   S01496
     C                     MOVE BBBRCD    ##CDBR                          S01496
     C                     MOVELDDPTFR    ##PTFR                          S01496
     C           DDPTFR    IFEQ FCR997                                    088642
     C                     MOVE '9997'    ##PTFR                          088642
     C                     END                                            088642
     C                     CALL 'SE6714'                                  S01496
     C                     PARM           ##CDBR                          S01496
     C                     PARM           ##CDCN                          S01496
     C                     PARM           ##PTFR                          S01496
     C                     PARM           ##CPBI                          S01496
     C                     PARM           ##CSBI                          S01496
     C*                                                                   S01496
     C** 2. IF 'CUSTOMER PURCH.GEN.BLOCK IND.' = 'Y' OR                   S01496
     C**       'CUSTOMER SALES GEN.BLOCK IND.' = 'Y'                      S01496
     C*                                                                   S01496
     C** 2.1 ADD ON THE HEADER RECORD, AFTER TOWN AND UNDER 'RUN DATE'    S01496
     C**     THE NEW BLOCK INFORMATION EITHER OF 'GB', 'GP', 'GS',        S01496
     C**     DEPENDING CONTENS OF RECEIVED INDICATORS.                    S01496
     C                     SELEC                                          S01496
     C           ##CPBI    WHEQ 'Y'                                       S01496
     C           ##CSBI    ANDEQ'Y'                                       S01496
     C                     MOVEL'B'       GBLOCK                          S01496
     C           ##CPBI    WHEQ 'Y'                                       S01496
     C                     MOVEL'P'       GBLOCK                          S01496
     C           ##CSBI    WHEQ 'Y'                                       S01496
     C                     MOVEL'S'       GBLOCK                          S01496
     C                     OTHER                                          S01496
     C                     MOVEL'N'       GBLOCK                          S01496
     C                     ENDSL                                          S01496
     C                     MOVELGBLOCK    WWPDGB                          S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PMC1003  - TO RETRIEVE DATA AREA *LDA                            *
      * PMC1004  - TO RETRIEVE DATA AREA *GDA                            *
      * PMC1001  - TO UPDATE DATA AREA *LDA                              *
      * PMC1002  - TO UPDATE DATA AREA *GDA                              *
      * PMC1020  - TO STOP GROUP JOB                                     *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      * PM0660   - SEARCH SELECT WINDOW                                  *
      * PMC0630  - TO START THE SCROLL GROUP JOB                         *
      * #P1006   - PROCESS LENDING DETAILS FOR ISSUING CUSTOMER          *
      * #P1007   - PROCESS LENDING DETAILS FOR RECEIVING CUSTOMER        *
      * #P1009   - FOREX DETAILS                                         *
      * #P1011   - PRECIOUS METAL DETAILS                                *R0981
      * #P1015   - FILL HEADER, DISPLAY SCREEN                           *
      * PM0600   - NOTEPAD                                               *
      * #W1002   - UPDATE DATA AREA                                      *
      * PM0640   - OPTION 'C' TAKEN - PORTFOLIO CASHFLOW                 *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWLDA    - *LDA PARAMETER                                        *
      * WWGDA    - *GDA PARAMETER                                        *
      * WWEND    - END PARAMETER                                         *
      * WWGRPJ   - GROUP JOB PARAMETER                                   *
      * QMFLAG   - WORK FLAG                                             *
      **WWSCRL***- SCROLL PARAMETER                                      *CPM005
      * WWFIN    - END PARAMETER                                         *
      * WWGUFL   - GUARANTEE FLAG                                        *
      *                                                                  *
      ********************************************************************
     C           #P1001    BEGSR
     C*                                                                   081239
     C                     CALL 'PMC1003'                                 081239
     C                     PARM           WWLDA                           081239
     C                     MOVE *BLANKS   WWPROG  6                       081239
     C           QMCPGM    IFEQ *BLANKS                                   081239
     C                     MOVE 'PM0630'  QMCPGM                          081239
     C                     CALL 'PMC1001'                                 081239
     C                     PARM           WWLDA                           081239
     C                     MOVE QMCPGM    WWPROG                          081239
     C                     END                                            081239
     C**
     C** PREPARE FIELD ZECODE FOR SUBROUTINE ZSEDIT
     C**
     C                     MOVEL'J'       ZECODE
     C                     MOVEA'0'       *IN
     C                     MOVE '0'       *INKL
     C**
     C** INITIALIZE RECORD NUMBER
     C**
     C                     Z-ADD0         RRN1    40
     C                     Z-ADD0         RRN2    40
     C                     Z-ADD1         SFLRRN
     C**
     C** INITIALIZE FLAGS
     C**
     C                     MOVEL*BLANK    WWFLAG  1
     C                     MOVEL*BLANK    WWGUFL  1
     C                     MOVE '0'       *IN98
     C/COPY WNCPYSRC,PM0630C016
     C*                                                                   S01313
     C** OBTAIN EVENT CONTROL AND LAST EXTRACT DATE                       S01313
     C           *NAMVAR   DEFN           PMSTAT                          S01313
     C                     IN   PMSTAT                                    S01313
     C**                                                                  R10051
     C** INITIALIZE WWPPDG                                                R10051
     C**                                                                  R10051
     C                     MOVE *BLANK    WWPDG1                          R10051
     C                     MOVE *BLANK    WWPDG3                          R10051
     C                     MOVE *BLANK    WWPDG5                          R10051
     C                     MOVE '/'       WWPDG2                          R10051
     C                     MOVE '/'       WWPDG4                          R10051
     C                     MOVE '/'       WWPDG6                          R00824
     C                     MOVE *BLANK    WWPDG7                          R00824
     C***********          MOVE '/'       WWPDG8                    S01313CPM005
     C*                                                                   082446
     C                     CALL 'AOMMODR0'                                082446
     C                     PARM '*DBERR ' @RTCD   7                       082446
     C                     PARM '*FIRST ' @OPTN   7                       082446
     C           SDMMOD    PARM SDMMOD    DSFDY                           082446
     C           @RTCD     IFNE *BLANKS                                   082446
     C                     MOVEL'Y'       QMDBER                          082446
     C                     MOVEL'Y'       QMENQT                          082446
     C                     MOVE 'SDMMOD'  QMFILE                          082446
     C                     MOVE 'PM0630'  QMPGM                           082446
     C                     MOVE *BLANKS   QMKEY            ***************082446
     C                     Z-ADD6         QMERRN           **DB ERROR 06**082446
     C*                                                    ***************082446
     C                     CALL 'PMC1001'                                 082446
     C                     PARM           WWLDA                           082446
     C                     RETRN                                          082446
     C                     END                                            082446
      *                                                                   S01496
      **  Access SAR details file to see if JYSKE Enhcmts is installed.   S01496
      *                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM '       ' @RTCD                           S01496
     C                     PARM '*VERIFY' @OPTN                           S01496
     C                     PARM 'S01496'  @SARD   6                       S01496
     C           SCSARD    PARM SCSARD    DSFDY                           087631
      *                                                                   S01496
     C           @RTCD     IFEQ *BLANK                                    S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C                     END                                            S01496
     C           S01496    IFEQ 'Y'                        B0             S01496
     C                     MOVE '1'       *IN55                           S01496
     C                     ELSE                            X1             S01496
     C                     MOVE '0'       *IN55                           S01496
     C                     END                             E1             S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C                     MOVE '/'       WWPDGA                          S01496
     C                     MOVE *BLANK    WWPDGB                          S01496
     C                     END                                            S01496
     C*                                                                   087631
     C**  Access SAR details file to see if EXTENDED DEALING LIMITS       087631
     C**  is installed.                                                   087631
     C*                                                                   087631
     C                     CALL 'AOSARDR0'                                087631
     C                     PARM *BLANKS   @RTCD                           087631
     C                     PARM '*VERIFY' @OPTN                           087631
     C                     PARM 'S01433'  @SARD                           087631
     C           SCSARD    PARM SCSARD    DSFDY                           087631
      *                                                                   087631
     C           @RTCD     IFEQ *BLANK                                    087631
     C                     MOVE 'Y'       S01433  1                       087631
     C                     END                                            087631
      *                                                                   CGL011
      ** Access Switchable Features file and check if CSD007              CSD007
      ** is switched on or not.                                           CSD007
      *                                                                   CSD007
     C                     CALL 'AOSARDR0'                                CSD007
     C                     PARM *BLANKS   @RTCD   7                       CSD007
     C                     PARM '*VERIFY' @OPTN   7                       CSD007
     C                     PARM 'CSD007'  @SARD   6                       CSD007
     C           SCSARD    PARM SCSARD    DSFDY                           CSD007
      *                                                                   CSD007
     C           @RTCD     IFEQ *BLANKS                                   CSD007
     C                     MOVE 'Y'       CSD007  1                       CSD007
     C                     ELSE                                           CSD007
     C                     MOVE 'N'       CSD007                          CSD007
      *                                                                   CSD007
      ** Database Error, if Return Code is not blanks or *NRF             CSD007
      *                                                                   CSD007
     C           @RTCD     IFNE '*NRF   '                                 CSD007
     C                     MOVEL'Y'       QMDBER                          CSD007
     C                     MOVEL'Y'       QMENQT                          CSD007
     C                     MOVE 'SCSARDPD'QMFILE                          CSD007
     C                     MOVE 'PM0630'  QMPGM                           CSD007
     C                     MOVE 'CSD007'  QMKEY                           CSD007
     C                     Z-ADD17        QMERRN                          CSD007
      *                                                                   CSD007
     C                     CALL 'PMC1001'                                 CSD007
     C                     PARM           WWLDA                           CSD007
     C                     RETRN                                          CSD007
      *                                                                   CSD007
     C                     ENDIF                                          CSD007
     C                     ENDIF                                          CSD007
     C/COPY WNCPYSRC,PM0630C001
     C**                                                                  B5858
     C** ACCESS LF/SDDEALPD TO OBTAIN DL ICD                              B5858
     C**                                                                  B5858
     C**********           READ SDDEALD0                 70         B5858 S01486
     C**                                                                  B5858
     C**********           CALL 'AODEALR0'                                E27228              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD                           E27228
     C                     PARM '*FIRST ' @OPTN                           E27228
     C********** SDDEAL    PARM SDDEAL    DSFDY                           E27228              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01486
     C********** *IN70     IFEQ '1'                                       B5858
     C                     MOVEL'Y'       QMDBER                          B5858
     C                     MOVEL'Y'       QMENQT                          B5858
     C                     MOVE 'SDDEALPD'QMFILE                          B5858
     C                     MOVE 'PM0630'  QMPGM                           B5858
     C                     MOVE *BLANKS   QMKEY            ************** B5858
     C                     Z-ADD7         QMERRN           **DB ERROR 07**B5858
     C**                                                   ************** B5858
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C**UPDATE  GDA                                                 B5858 S01486
     C**********                                                    B5858 S01486
     C**********           CALL 'PMC1002'                           B5858 S01486
     C**********           PARM           WWGDA                     B5858 S01486
     C**********                                                    B5858 S01486
     C** CALL PMC1020 TO TERMINATE GROUP JOB                              B5858
     C**********                                                    B5858 S01486
     C**********                                                    B5858 S01486
     C**********           CALL 'PMC1020'                           B5858 S01486
     C**********                                                    B5858 S01486
     C**********           END                                      B5858 S01486
     C**
     C** RETRIEVE DATA AREA
     C**
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
     C****                                                          S01313R05667
     C***CALCULATE DATE OF LAST COB                                 S01313R05667
     C****       QMRDNB    SUB  1         WWYEST  50                S01313R05667
     C**
     C**
     C** ACCESS LF/SDPORTL1 TO OBTAIN PM ICD
     C**
     C**********           READ SDPORTL1                 70               S01486
     C**
     C********** *IN70     IFEQ '1'                                       S01486
     C**********           MOVEL'Y'       QMDBER                          S01486
     C**********           MOVEL'Y'       QMENQT                          S01486
     C**********           MOVE 'SDPORT'  QMFILE                          S01486
     C**********           MOVE 'PM0630'  QMPGM                           S01486
     C**********           MOVE *BLANKS   QMKEY            ***************S01486
     C**********           Z-ADD1         QMERRN           **DB ERROR 01**S01486
     C**                                                   ***************
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER                          S01486
     C                     MOVEL'Y'       QMENQT                          S01486
     C                     MOVE 'SDPORT'  QMFILE                          S01486
     C                     MOVE 'PM0630'  QMPGM                           S01486
     C                     MOVE *BLANKS   QMKEY            ***************S01486
     C                     Z-ADD1         QMERRN           **DB ERROR 01**S01486
     C**                                                   ***************S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C** UPDATE GDA
     C**
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C**
     C** CALL PMC1020 TO TERMINATE GROUP JOB
     C**
     C**
     C**********           CALL 'PMC1020'                                 S01486
     C**
     C**********           END                                            S01486
     C**
     C** ACCESS PF/SDLOMBPD TO OBTAIN LB ICD
     C**
     C           BGLMCR    IFEQ 'Y'                                       S01486
     C                     CALL 'AOLOMBR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDLOMB    PARM SDLOMB    DSFDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER                          S01486
     C                     MOVEL'Y'       QMENQT                          S01486
     C                     MOVE 'SDLOMBPD'QMFILE                          S01486
     C                     MOVE 'PM0630'  QMPGM                           S01486
     C                     MOVE *BLANKS   QMKEY            ***************S01486
     C                     Z-ADD2         QMERRN           **DB ERROR 02**S01486
     C**                                                   ***************S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C********** LBIC      IFEQ 'Y'                                 061059S01486
     C**********           READ SDLOMBPD                 70               S01486
     C**********                                                          S01486
     C********** *IN70     IFEQ '1'                                       S01486
     C**********           MOVEL'Y'       QMDBER                          S01486
     C**********           MOVEL'Y'       QMENQT                          S01486
     C**********           MOVE 'SDLOMBPD'QMFILE                          S01486
     C**********           MOVE 'PM0630'  QMPGM                           S01486
     C**********           MOVE *BLANKS   QMKEY            ***************S01486
     C**********           Z-ADD2         QMERRN           **DB ERROR 02**S01486
     C** UPDATE GDA                                                       S01486
     C**                                                                  S01486
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C**                                                                  S01486
     C** CALL PMC1020 TO TERMINATE GROUP JOB                              S01486
     C**                                                                  S01486
     C**                                                                  S01486
     C**********           CALL 'PMC1020'                                 S01486
     C**********                                                          S01486
     C**********           END                                            S01486
     C**                                                            R5504 S01486
     C** ACCESS PF/SDLOMBX0 TO OBTAIN LB ICD                        R5504 S01486
     C**                                                            R5504 S01486
     C********** LBIC      IFEQ 'Y'                                 33503 061059
     C**********           READ SDLOMBX0                 70         R5504 S01486
     C**********                                                    R5504 S01486
     C********** *IN70     IFEQ '1'                                 R5504 S01486
     C**********           MOVEL'Y'       QMDBER                    R5504 S01486
     C**********           MOVEL'Y'       QMENQT                    R5504 S01486
     C**********           MOVE 'SDLOMBX0'QMFILE                    R5504 S01486
     C**********           MOVE 'PM0630'  QMPGM                     R5504 S01486
     C**********           MOVE *BLANKS   QMKEY            *********R5504 S01486
     C**********           Z-ADD8         QMERRN           **DB E8**R5504 S01486
     C**********                                           *********R5504 S01486
     C** UPDATE GDA                                                 R5504 S01486
     C**                                                            R5504 S01486
     C**********           CALL 'PMC1002'                           R5504 S01486
     C**********           PARM           WWGDA                     R5504 S01486
     C**********                                                    R5504 S01486
     C** CALL PMC1020 TO TERMINATE GROUP JOB                        R5504 S01486
     C**********                                                    R5504 S01486
     C**********                                                    R5504 S01486
     C**********           CALL 'PMC1020'                           R5504 S01486
     C**********                                                    R5504 S01486
     C**********           END                                      R5504 S01486
     C*********************END                                      33503 061059
     C**
     C** ACCESS SDCURRL1 WITH LOMBARD CREDIT CURRENCY TO
     C** OBTAIN CURRENCY DETAILS
     C**
     C********** LBCCY     CHAINSDCURRL1             70                   S01486
     C********** *IN70     IFEQ '1'                                       S01486
     C**********           MOVEL'Y'       QMDBER                          S01486
     C**********           MOVEL'Y'       QMENQT                          S01486
     C**********           MOVE 'SDCURRL1'QMFILE                          S01486
     C**********           MOVE 'PM0630'  QMPGM                           S01486
     C**********           MOVE LBCCY     QMKEY            ***************S01486
     C**********           Z-ADD3         QMERRN           **DB ERROR 03**S01486
     C**********                                           ***************S01486
     C** UPDATE GDA                                                       S01486
     C**********                                                          S01486
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C**********                                                          S01486
     C** CALL PMC1020 TO TERMINATE GROUP JOB                              S01486
     C**********                                                          S01486
     C**********           CALL 'PMC1020'                                 S01486
     C**********                                                          S01486
     C**********           END                                            S01486
     C                     MOVELLBCYCD    @AJCD                           S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR'  @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER                          S01486
     C                     MOVEL'Y'       QMENQT                          S01486
     C                     MOVE 'SDCURRL1'QMFILE                          S01486
     C                     MOVE 'PM0630'  QMPGM                           S01486
     C                     MOVE LBCYCD    QMKEY            ***************S01486
     C                     Z-ADD3         QMERRN           **DB ERROR 03**S01486
     C**                                                   ***************S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C                     END                                            061059
     C**
     C** SAVE SPOT RATE, CURRENCY DECIMAL PLACES AND MULTIPLY/
     C** DIVIDE INDICATOR
     C**
     C                     Z-ADDA6SPRT    W1SPRT 138
     C                     Z-ADDA6NBDP    W1NBDP  10
     C                     MOVELA6MDIN    W1MDIN  1
     C**********                                                          S01486
     C** ACCESS SDCURRL1 WITH CUSTOMER CURRENCY TO                        S01486
     C** OBTAIN CURRENCY DETAILS                                          S01486
     C**********                                                          S01486
     C********** QMCSBY    CHAINSDCURRL1             70                   S01486
     C********** *IN70     IFEQ '1'                                       S01486
     C**********           MOVEL'Y'       QMDBER                          S01486
     C**********           MOVEL'Y'       QMENQT                          S01486
     C**********           MOVE 'SDCURRL1'QMFILE                          S01486
     C**********           MOVE 'PM0630'  QMPGM                           S01486
     C**********           MOVE QMCSBY    QMKEY            ***************S01486
     C**********           Z-ADD4         QMERRN           **DB ERROR 04**S01486
     C**********                                           ***************S01486
     C** UPDATE GDA                                                       S01486
     C**********                                                          S01486
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C**********                                                          S01486
     C** CALL PMC1020 TO TERMINATE GROUP JOB                              S01486
     C**********                                                          S01486
     C**********           CALL 'PMC1020'                                 S01486
     C**                                                                  S01486
     C**********           END                                            S01486
     C                     MOVELQMCSBY    @AJCD                           S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR'  @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER                          S01486
     C                     MOVEL'Y'       QMENQT                          S01486
     C                     MOVE 'SDCURRL1'QMFILE                          S01486
     C                     MOVE 'PM0630'  QMPGM                           S01486
     C                     MOVE QMCSBY    QMKEY            ***************S01486
     C                     Z-ADD4         QMERRN           **DB ERROR 04**S01486
     C**                                                   ***************S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C**
     C** SAVE SPOT RATE, CURRENCY DECIMAL PLACES AND MULTIPLY/
     C** DIVIDE INDICATOR
     C**
     C                     Z-ADDA6SPRT    W2SPRT 138
     C                     Z-ADDA6NBDP    W2NBDP  10
     C                     MOVELA6MDIN    W2MDIN  1
     C**
     C***ACCESS*SDCURRL1*WITH*BASE*CURRENCY*FOR*ACCOUNTING*TO*********    B5858
     C***OBTAIN*CURRENCY*DETAILS**************************************    B5858
     C** ACCESS SDCURRL1 WITH DEAL CURRENCY ICD FOR ACCOUNTING TO         B5858
     C** OBTAIN CURRENCY DETAILS                                          B5858
     C**
     C**         QMCYCD    CHAINSDCURRL1             70                   B5858
     C********** BNCYCD    CHAINSDCURRL1             70             B5858 S01486
     C********** *IN70     IFEQ '1'                                       S01486
     C**********           MOVEL'Y'       QMDBER                          S01486
     C**********           MOVEL'Y'       QMENQT                          S01486
     C**********           MOVE 'SDCURRL1'QMFILE                          S01486
     C**********           MOVE 'PM0630'  QMPGM                           S01486
     C**********           MOVE QMCYCD    QMKEY            ***************S01486
     C**********           Z-ADD5         QMERRN           **DB ERROR 05**S01486
     C**********                                           ***************S01486
     C** UPDATE GDA                                                       S01486
     C**********                                                          S01486
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C**********                                                          S01486
     C** CALL PMC1020 TO TERMINATE GROUP JOB                              S01486
     C**********                                                          S01486
     C**********           CALL 'PMC1020'                                 S01486
     C**********                                                          S01486
     C**********           END                                            S01486
     C                     MOVELBNCYCD    @AJCD                           S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR'  @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER                          S01486
     C                     MOVEL'Y'       QMENQT                          S01486
     C                     MOVE 'SDCURRL1'QMFILE                          S01486
     C                     MOVE 'PM0630'  QMPGM                           S01486
     C                     MOVE QMCYCD    QMKEY            ***************S01486
     C                     Z-ADD5         QMERRN           **DB ERROR 05**S01486
     C**                                                   ***************S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C**
     C** SAVE SPOT RATE, CURRENCY DECIMAL PLACES AND MULTIPLY/
     C** DIVIDE INDICATOR
     C**
     C                     Z-ADDA6SPRT    W3SPRT 138
     C                     Z-ADDA6NBDP    W3NBDP  10
     C                     MOVELA6MDIN    W3MDIN  1
     C********** P9TVPS    IFEQ 'V'                                       S01486
     C           FCTVPS    IFEQ 'V'                                       S01486
     C                     MOVE '1'       *IN35
     C                     ELSE
     C                     MOVE '0'       *IN35
     C                     END
     C**
     C** ACCESS LF/SDLBCSL0 TO OBTAIN LOMBARD CUSTOMER DETAILS
     C**
     C**********           MOVE QMCNUM    WWPNP8  6                       S01486
     C                     MOVELQMCNUM    WWPNP8  6                       S01486
     C********** WWPNP8    CHAINSDLBCSL0             70                   S01486
     C                     CALL 'AOLBCSR0'                                S01486
     C                     PARM *BLANKS   PRTCD   7                       S01486
     C                     PARM '*KEY'    POPTN   7                       S01486
     C                     PARM WWPNP8    PLCUS  10                       S01486
     C           SDLBCS    PARM SDLBCS    DSFDY                           S01486
     C********** *IN70     IFEQ '0'                                       S01486
     C           PRTCD     IFEQ *BLANKS                                   S01486
     C                     MOVEL'Y'       WWLOMB  1
     C***********          MOVEL'Y'       QMDBER                    S01486082443
     C***********          MOVEL'Y'       QMENQT                    S01486082443
     C***********          MOVE 'SDLBCS'  QMFILE                    S01486082443
     C***********          MOVE 'PM0630'  QMPGM                     S01486082443
     C***********          MOVE *BLANKS   QMKEY      ***************S01486082443
     C***********          Z-ADD9         QMERRN     **DB ERROR 09**S01486082443
     C***********                                    ***************S01486082443
     C***********          CALL 'PMC1001'                           S01486082443
     C***********          PARM           WWLDA                     S01486082443
     C***********          RETRN                                    S01486082443
     C***********                                                   SA9109082443
     C********** MRGP      IFEQ 'Y'                                 34760 S01486
     C********** WWPNP8    CHAINSDLBCSX0             75             SA9109S01486
     C**********                                                    SA9109S01486
     C********** *IN75     IFEQ '1'                                 SA9109S01486
     C**********           MOVEL'Y'       QMDBER                    SA9109S01486
     C**********           MOVEL'Y'       QMENQT                    SA9109S01486
     C**********           MOVE 'SDLBCS'  QMFILE                    SA9109S01486
     C**********           MOVE 'PM0630'  QMPGM                     SA9109S01486
     C**********           MOVE *BLANKS   QMKEY            *********SA9109S01486
     C**********           Z-ADD9         QMERRN           **DB E9**SA9109S01486
     C**********                                           *********SA9109S01486
     C**UPDATE  GDA                                                 SA9109S01486
     C**********                                                    SA9109S01486
     C**********           CALL 'PMC1002'                           SA9109S01486
     C**********           PARM           WWGDA                     SA9109S01486
     C**********                                                    SA9109S01486
     C** CALL PMC1020 TO TERMINATE GROUP JOB                        SA9109S01486
     C**********                                                    SA9109S01486
     C**********                                                    SA9109S01486
     C**********           CALL 'PMC1020'                           SA9109S01486
     C**********                                                    SA9109S01486
     C**********           END                                      SA9109S01486
     C**********           END                                      34760 S01486
     C                     ELSE
     C                     MOVEL'N'       WWLOMB
     C                     END
     C*                                                                   B08253
     C***CHECK*WHETHER*CLOSED*PORTFOLIOS*EXIST*FOR*CUSTOMER*ON*PMPORB08253S01486
     C** CHECK WHETHER CLOSED PORTFOLIOS EXIST FOR CUSTOMER ON PMPORTPD   S01486
     C********** QMCNUM    SETLLPMPORTPP                            B08253S01486
     C**********           READ PMPORTPP                 71         B08253S01486
     C           QMCNUM    SETLLPMPORTPD                                  S01486
     C***********          READ PMPORTPD                 71         S01486092937
     C           QMCNUM    READEPMPORTPD                 71               092937
     C**                                                                  B08253
     C** LOOP WHILE CUSTOMER NUMBER FOUND                                 B08253
     C**                                                                  B08253
     C           PNCNUM    DOWEQQMCNUM                                    B08253
     C           *IN71     ANDEQ'0'                                       B08253
     C**                                                                  B08253
     C           PNRECI    IFEQ '*'                                       B08253
     C                     MOVE '1'       *IN81                           B08253
     C                     END                                            B08253
     C**********           READ PMPORTPP                 71         B08253S01486
     C***********          READ PMPORTPD                 71         S01486092937
     C           QMCNUM    READEPMPORTPD                 71               092937
     C                     END                                            B08253
     C************                                                        082446
     C***ACCESS*LF/SDMMODL1*TO*DETERMINE*WHICH*MODULE*PRESENT*************082446
     C***ON*SYSTEM********************************************************082446
     C************                                                        082446
     C************         CALL 'AOMMODR0'                          S01486082446
     C************         PARM '*DBERR ' @RTCD   7                 S01486082446
     C***********          PARM '*FIRST ' @OPTN   7                 S01486082446
     C***********SDMMOD    PARM SDMMOD    DSFDY                     S01486082446
     C***********@RTCD     IFNE *BLANKS                             S01486082446
     C************         MOVEL'Y'       QMDBER                    S01486082446
     C************         MOVEL'Y'       QMENQT                    S01486082446
     C************         MOVE 'SDMMOD'  QMFILE                    S01486082446
     C************         MOVE 'PM0630'  QMPGM                     S01486082446
     C************         MOVE *BLANKS   QMKEY      ***************S01486082446
     C************         Z-ADD6         QMERRN     **DB ERROR 06**S01486082446
     C************                                   ***************S01486082446
     C************         CALL 'PMC1001'                           S01486082446
     C************         PARM           WWLDA                     S01486082446
     C************         RETRN                                    S01486082446
     C************         END                                      S01486082446
     C**********           READ SDMMODL1                 70               S01486
     C**
     C********** *IN70     IFEQ '1'                                       S01486
     C**********           MOVEL'Y'       QMDBER                          S01486
     C**********           MOVEL'Y'       QMENQT                          S01486
     C**********           MOVE 'SDMMOD'  QMFILE                          S01486
     C**********           MOVE 'PM0630'  QMPGM                           S01486
     C**********           MOVE *BLANKS   QMKEY            ***************S01486
     C**********           Z-ADD6         QMERRN           **DB ERROR 06**S01486
     C**                                                   ***************
     C** UPDATE GDA
     C**
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C**
     C** CALL PMC1020 TO TERMINATE GROUP JOB
     C**
     C**
     C**********           CALL 'PMC1020'                                 S01486
     C**
     C**********           END                                            S01486
     C*                                                                   R01118
     C** CHECK WHETHER LOMBARD CREDITS ON THE SYSTEM                      R01118
     C           BGLMCR    IFEQ 'Y'                                       R01118
     C                     MOVE '1'       *IN80                           R01118
     C                     END                                            R01118
     C***********                                                   S01486CPM005
     C***Set*up*authorised action codes                             S01486CPM005
     C***********                                                   S01486CPM005
     C***********          MOVELQMBRCA    @BRCA                     S01486CPM005
     C***********          Z-ADD0         C       20                S01486CPM005
     C***********          Z-ADD1         D       20                S01486CPM005
      ***********                                                   S01486CPM005
     C***********D         DOWLT10                                  S01486CPM005
      ***********                                                   S01486CPM005
     C***********VC1,D     IFNE *BLANKS                             S01486CPM005
     C***********          MOVELVC1,D     @ZACTN                    S01486CPM005
     C***********          EXSR #AUTH                               S01486CPM005
      ***********                                                   S01486CPM005
     C***********          ADD  1         C                         S01486CPM005
     C***********@ERR      IFEQ 0                                   S01486CPM005
     C***********          MOVELVC1,D     VC2,C                     S01486CPM005
     C***********          END                                      S01486CPM005
     C***********          ADD  1         C                         S01486CPM005
     C***********          MOVEA','       VC2,C                     S01486CPM005
      ***********                                                   S01486CPM005
     C***********          END                                      S01486CPM005
      ***********                                                   S01486CPM005
     C***********          ADD  1         D                         S01486CPM005
     C***********          END                                      S01486CPM005
      ***********                                                   S01486CPM005
     C***********          MOVEAVC2       WWVALC                    S01486CPM005
     C**
     C** SET UP SCREEN DETAILS
     C**
     C                     EXSR #P1002
     C**
     C                     EXSR #P1015
     C**
     C** DO UNTIL TERMINATION FLAG SET TO 'Y'
     C**
     C           WWFLAG    DOUEQ'Y'
     C**
     C** SET TERMINATION FLAG TO 'N'
     C** (THIS MEANS THAT THIS PROCESSING LOOP WILL NEVER
     C**  BE EXITED. TO EXIT PROGRAM RETURN TO PMC0630
     C**
     C                     MOVEL'N'       WWFLAG
     C**
     C                     EXSR #P1003
     C**
     C** IF F3 TAKEN
     C**
     C           *INKC     IFEQ '1'
     C**
     C** SET ENQUIRIES TERMINATING ON *GDA TO 'Y'
     C**
     C                     MOVEL'Y'       QMENQT
     C**
     C** UPDATE *GDA
     C**
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C**
     C**
     C                     END
     C**
     C** IF F4 TAKEN
     C**
     C           *INKD     IFEQ '1'
     C**
     C                     CALL 'PMC0660'
     C                     PARM           WWF12   1
     C                     PARM 'N'       WWIND   1                       CPM005
     C**
     C           WWF12     IFNE 'Y'
     C**
     C** RESET ALL FIELDS OF DTAARA *GDA
     C**
     C                     MOVEL*BLANKS   QMPTF1
     C                     MOVEL*BLANKS   QMPTF2
     C                     MOVEL*BLANKS   QMPTFN
     C                     MOVEL*BLANKS   QMTPMV
     C                     MOVEL*BLANKS   QMVPMV
     C                     MOVEL*BLANKS   QMPTAI
     C                     MOVEL*BLANKS   QMPVAI
     C                     MOVEL*BLANKS   QMPTCY
     C                     Z-ADD0         QMPCDP
     C                     MOVEL*BLANKS   QMPTFT
     C                     MOVEL*BLANKS   QMDPO1
     C                     MOVEL*BLANKS   QMPPDG
     C                     MOVEL*BLANKS   QMDSPG
     C                     MOVEL*BLANKS   QMNDSP
     C                     MOVEL*BLANKS   QMDSPT
     C                     Z-ADD0         QMDSPS
     C                     MOVEL*BLANKS   QMDGMV
     C                     MOVEL*BLANKS   QMDGAI
     C                     MOVEL*BLANKS   QMINNR
     C                     MOVEL*BLANKS   QMISTN
     C                     Z-ADD0         QMITDS
     C                     MOVEL*BLANKS   QMTIMV
     C                     MOVEL*BLANKS   QMVIMV
     C                     MOVEL*BLANKS   QMITAI
     C                     MOVEL*BLANKS   QMIVAI
     C                     MOVEL*BLANKS   QMMODI
     C                     MOVEL*BLANKS   QMSESN
     C**********           Z-ADD0         QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMENQT
     C                     MOVEL*BLANKS   QMDBER
     C                     MOVEL*BLANKS   QMATTN
     C                     MOVEL*BLANKS   QMPGM
     C                     MOVEL*BLANKS   QMFILE
     C                     MOVEL*BLANKS   QMKEY
     C                     Z-ADD0         QMERRN
     C**
     C** UPDATE *GDA
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C**
     C                     END
     C**
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END
     C**
     C** F6 TAKEN
     C**
B1   C           *INKF     IFEQ '1'
     C           BGLMCR    ANDEQ'Y'
     C           WWLOMB    ANDEQ'Y'
     C**
     C                     MOVE '1'       *IN53
     C**
     C** IF FOREX DETAILS  NOT ON SCREEN
     C**
     C           WWGUFL    IFEQ 'L'
     C**
     C** IF NOT DISPLAYED YET
     C**
     C************IN83     IFEQ '0'                                       095719
     C***********          MOVE '1'       *IN83                           095719
     C                     EXSR #P1009
     C           S01433    IFEQ 'Y'                                       087631
     C                     EXSR #P1011                                    R0981
     C                     END                                            087631
     C                     EXSR #P1015
     C***********          END                                            095719
     C**
     C** SET FLAG TO 'G'
     C**
     C                     MOVEL'G'       WWGUFL
     C**
     C                     ELSE
     C**                                                                  R0981
     C           WWGUFL    IFEQ 'M'                                       R0981
     C**         *IN80     OREQ '1'                                       R0981
     C**
     C** SET FLAG TO 'L'
     C**
     C                     MOVEL'L'       WWGUFL
     C**                                                                  R0981
     C** SET FLAG TO 'M' FOR PRECIOUS METAL DETAILS IF A LIMIT EXIST      R0981
     C** FOR THE CUSTOMER                                                 R0981
     C**                                                                  R0981
     C                     ELSE                                           R0981
     C           S01433    IFEQ 'Y'                                       087631
     C                     MOVEL'M'       WWGUFL                          R0981
     C                     ELSE                                           087631
     C                     MOVEL'L'       WWGUFL                          087631
     C                     END                                            087631
     C                     END                                            R0981
     C**
     C                     END
     C**
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END
     C/COPY WNCPYSRC,PM0630C017
     C**
     C** IF F12 TAKEN
     C**
     C           *INKL     IFEQ '1'
     C**                                                                  CPM005
     C                     MOVEL'P'       QMENQT                          CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**
     C**********           CALL 'PMC1020'                                 S01486
     C                     RETRN                                          S01486
     C**
     C                     END
     C**                                                                  B08253
     C** IF F13 TAKEN                                                     B08253
     C**                                                                  B08253
     C           *INKM     IFEQ '1'                                       B08253
     C*                                                                   B08253
     C*                                                                   B08253
     C** IF CLOSED PORTFOLIOS EXIST OUTPUT DETAILS
     C           WWDMAT    IFEQ 'Y'                                       B08253
     C                     MOVE *BLANKS   WWDMAT  1                       B08253
     C                     MOVE '0'       *IN82                           B08253
     C                     ELSE                                           B08253
     C                     MOVE 'Y'       WWDMAT  1                       B08253
     C                     MOVE '1'       *IN82                           B08253
     C                     END                                            B08253
     C*                                                                   B08253
     C                     EXSR #P1002                                    B08253
     C*                                                                   B08253
     C** WRITE SUBFILE TO SCREEN                                          B08253
     C           *IN89     IFEQ '0'                                       B08253
     C                     Z-ADDRRN2      SFLRRN                          B08253
     C                     WRITEPM0630C2                                  B08253
     C                     ELSE                                           B08253
     C                     Z-ADDRRN1      SFLRRN                          B08253
     C                     WRITEPM0630C1                                  B08253
     C                     END                                            B08253
     C                     END                                            B08253
     C**                                                                  R01118
     C** IF F15 TAKEN                                                     R01118
     C**                                                                  R01118
     C           *INKP     IFEQ '1'                                       081239
     C           WWPROG    ANDEQ*BLANKS                                   081239
     C                     MOVE '1'       *INLR                           081239
     C                     RETRN                                          081239
     C                     END                                            081239
     C*                                                                   081239
     C           *INKP     IFEQ '1'                                       R01118
     C           BGLMCR    ANDEQ'Y'                                       R01118
     C           WWLOMB    ANDEQ'Y'                                       R01118
     C*********************MOVE '2'       WWMUFG  1                R01118 R1088
     C                     MOVE '1'       WWMUFG  1                       R1088
     C                     MOVE 'Y'       WWCALL  1                       R01118
     C                     Z-ADD0         WWRTCD  20                      R01118
     C                     CALL 'LB0305'                                  R01118
     C                     PARM           WWMUFG                          R01118
     C                     PARM           WWCNUM                          R01118
     C                     PARM           WWRTCD                          R01118
     C                     PARM           WWUPRF                          R01118
     C                     PARM           WWCALL                          R01118
     C**                                                                  R01118
     C** IF F3 TAKEN IN CALLED PROGRAM                                    R01118
     C           WWRTCD    IFEQ 3                                         R01118
     C**                                                                  R01118
     C** SET ENQUIRIES TERMINATING ON *GDA TO 'Y'                         R01118
     C                     MOVEL'Y'       QMENQT                          R01118
     C**                                                                  R01118
     C** UPDATE *GDA                                                      R01118
     C**********           CALL 'PMC1002'                           R01118S01486
     C**********           PARM           WWGDA                     R01118S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C                     END                                            R01118
     C**                                                                  R01118
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            R01118
     C**
     C** IF F24 TAKEN
     C**
     C                     MOVE '0'       *IN13                           CPM005
     C           *INKY     IFEQ '1'
     C**
     C** CALL  PMC1001 TO UPDATE LDA                                      073935
     C**                                                                  073935
     C           PNPTFR    IFNE *BLANKS                                   073935
     C                     MOVE PNPTFR    WWPTFR                          073935
     C                     END                                            073935
     C                     EXSR #W1002                                    073935
     C**                                                                  073935
     C                     CALL 'PMC1001'                                 073935
     C                     PARM           WWLDA                           073935
     C*                                                                   073935
     C                     MOVE '1'       *IN13                           CPM005
     C**                                                                  CPM005
     C                     MOVE ' '       QMENQT                          CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     MOVEL'PM0630'  PGMNAM 10                       CPM005
     C                     CALL 'PMC0600'
     C                     PARM           PGMNAM                          CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     CALL 'PMC1003'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**
     C                     EXSR #P1015                                    CPM005
     C**                                                                  CPM005
     C                     END
     C**
     C** IF ENTER HAS BEEN PRESSED
     C**
     C           *IN60     IFEQ '0'
     C**
     C** DETERMINE WHICH SUBFILE TO READ
     C**
     C           *IN89     IFEQ '0'
     C                     READCPM0630S2                 79
     C**
     C           *IN79     IFEQ '0'
     C                     MOVE '0'       *IN69                           056460
     C                     MOVELDDACTN    WWACTN  1
     C                     MOVEL*BLANK    DDACTN
     C                     UPDATPM0630S2
     C                     Z-ADDRRN2      SFLRRN
     C                     EXSR #VACO                                     081352
     C                     WRITEPM0630C2
     C                     END
     C**
     C                     ELSE
     C                     READCPM0630S1                 79
     C**
     C           *IN79     IFEQ '0'
     C                     MOVELDDACTN    WWACTN
     C                     MOVEL*BLANK    DDACTN
     C                     UPDATPM0630S1
     C                     Z-ADDRRN1      SFLRRN
     C                     EXSR #VACO                                     081352
     C                     WRITEPM0630C1
     C                     END
     C**
     C                     END
     C******************** MOVELWWACTN    @ZACTN                   S01486 081352
     C******************** EXSR #AUTH                              S01486 081352
     C********** @ERR      IFEQ 1                                  S01486 081352
     C******************** END                                     S01486 081352
     C           *IN57     IFEQ '1'                                       081352
     C                     MOVEL'0'       *IN57                           081352
     C                     GOTO E1001                                     081352
     C                     END                                            081352
     C**
     C***IF*OPTION*'C'*HAS*BEEN*TAKEN                                     CPM005
     C** IF OPTION 'I' HAS BEEN TAKEN                                     CPM005
     C**
     C***********WWACTN    IFEQ 'C'                                       CPM005
     C           WWACTN    IFEQ 'I'                                       CPM005
     C           PMPOTT    CHAINPMICALL0             72                   CPM005
     C           *IN72     IFEQ '0'                                       CPM005
     C**
     C** CALL  PMC1001 TO UPDATE LDA
     C**
     C                     EXSR #W1002
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C***CALL*PM0640*WITH*PARAMETERS PASSED BY GDA                        CPM005
     C***CALL PM6090 WITH PARAMETERS PASSED BY LDA                        CPM005
     C**
     C                     MOVEL'TOTICY  'WWJOB                           CPM005
     C***********          CALL 'PM0640'                                  CPM005
     C                     CALL 'PMC0630'                                 CPM005
     C                     PARM           WWJOB                           CPM005
     C                     PARM           QMENQT                          CPM005
     C**
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD
     C** SET UP IN #W1002
     C                     MOVEL*BLANKS   QMPTF1
     C                     MOVEL*BLANKS   QMPTF2
     C                     MOVEL*BLANKS   QMPTFN
     C                     MOVEL*BLANKS   QMTPMV
     C                     MOVEL*BLANKS   QMVPMV
     C                     MOVEL*BLANKS   QMPTAI
     C                     MOVEL*BLANKS   QMPVAI
     C                     MOVEL*BLANKS   QMPTCY
     C                     Z-ADD0         QMPCDP
     C                     MOVEL*BLANKS   QMPTFT
     C                     MOVEL*BLANKS   QMDPO1
     C                     MOVEL*BLANKS   QMPPDG
     C                     MOVEL*BLANKS   QMPGM
     C                     MOVEL*BLANKS   QMATTN
     C                     MOVEL*BLANKS   QMPOLC                          R00824
     C                     MOVEL*BLANKS   QMPPCS                          SA9108
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '1'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END
     C                     END                                            CPM005
     C**                                                                  CPM005
     C** IF OPTION 'F' HAS BEEN TAKEN                                     CPM005
     C**                                                                  CPM005
     C           WWACTN    IFEQ 'F'                                       CPM005
     C**                                                                  CPM005
     C** CALL  PMC1001 TO UPDATE LDA                                      CPM005
     C**                                                                  CPM005
     C                     EXSR #W1002                                    CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C** CALL PM0640 WITH PARAMETERS PASSED BY LDA                        CPM005
     C**                                                                  CPM005
     C                     CALL 'PM0640'                                  CPM005
     C**                                                                  CPM005
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD                  CPM005
     C** SET UP IN #W1002                                                 CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C** IF OPTION 'E' HAS BEEN TAKEN                                     CPM005
     C**                                                                  CPM005
     C           WWACTN    IFEQ 'E'                                       CPM005
     C**                                                                  CPM005
     C                     Z-ADDWWPMVT    QMPMVT                          CPM005
     C                     Z-ADDWWPMVV    QMPMVV                          CPM005
     C**                                                                  CPM005
     C** CALL  PMC1001 TO UPDATE LDA                                      CPM005
     C**                                                                  CPM005
     C                     EXSR #W1002                                    CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C** CALL PMC630 WITH PARAMETERS PASSED BY LDA TO CALL PM0671         CPM005
     C**                                                                  CPM005
     C                     MOVEL'POSCCY  'WWJOB                           CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC0630'                                 CPM005
     C                     PARM           WWJOB                           CPM005
     C                     PARM           QMENQT                          CPM005
     C**                                                                  CPM005
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD                  CPM005
     C** SET UP IN #W1002                                                 CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C** IF OPTION 'N' HAS BEEN TAKEN                                     CPM005
     C**                                                                  CPM005
     C           WWACTN    IFEQ 'N'                                       CPM005
     C           PMPOTT    CHAINPMNTCMLL             72                   CPM005
     C           *IN72     IFEQ '0'                                       CPM005
     C**                                                                  CPM005
     C** CALL  PMC1001 TO UPDATE LDA                                      CPM005
     C**                                                                  CPM005
     C                     EXSR #W1002                                    CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C** CALL PM6020 WITH PARAMETERS PASSED BY LDA                        CPM005
     C**                                                                  CPM005
     C                     CALL 'PM6020'                                  CPM005
     C*                                                                   CPM005
     C                     CALL 'PMC1003'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD                  CPM005
     C** SET UP IN #W1002                                                 CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '1'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C** IF OPTION 'T' HAS BEEN TAKEN                                     CPM005
     C**                                                                  CPM005
     C           WWACTN    IFEQ 'T'                                       CPM005
     C           WWPTFR    IFNE '9997'                                    CPM005
     C           WWPTFR    ANDNE'9998'                                    CPM005
     C           WWPTFR    ANDNE'9999'                                    CPM005
     C**                                                                  CPM005
     C** CALL  PMC1001 TO UPDATE LDA                                      CPM005
     C**                                                                  CPM005
     C                     EXSR #W1002                                    CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C** CALL PM0720 WITH PARAMETERS PASSED BY LDA                        CPM005
     C**                                                                  CPM005
     C                     CALL 'PM0720'                                  CPM005
     C**                                                                  CPM005
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD                  CPM005
     C** SET UP IN #W1002                                                 CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '1'       *IN09                           CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C**
     C** IF OPTION 'D' HAS BEEN TAKEN
     C** ALLOW ONLY IF RECORD EXIST IN PMASLIL0                           CPM005
     C**
     C           WWACTN    IFEQ 'D'
     C           PMPOTT    CHAINPMASLIL0             72                   CPM005
     C           *IN72     IFEQ '0'                                       CPM005
     C**
     C** CALL  PMC1000 TO UPDATE GDA
     C**
     C                     EXSR #W1002
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C** CALL PMC630
     C**
     C***********          MOVEL'N'       WWSCRL  1                       CPM005
     C                     MOVEL'TOTINS  'WWJOB   8                       CPM005
     C**
     C                     CALL 'PMC0630'
     C***********          PARM           WWSCRL                          CPM005
     C                     PARM           WWJOB                           CPM005
     C                     PARM           QMENQT                          CPM005
     C*                                                                   S01486
     C                     CALL 'PMC1003'                                 S01486
     C                     PARM           WWLDA                           S01486
     C**
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD
     C** SET UP IN #W1002
     C                     MOVEL*BLANKS   QMPTF1
     C                     MOVEL*BLANKS   QMPTF2
     C                     MOVEL*BLANKS   QMPTFN
     C                     MOVEL*BLANKS   QMTPMV
     C                     MOVEL*BLANKS   QMVPMV
     C                     MOVEL*BLANKS   QMPTAI
     C                     MOVEL*BLANKS   QMPVAI
     C                     MOVEL*BLANKS   QMPTCY
     C                     Z-ADD0         QMPCDP
     C                     MOVEL*BLANKS   QMPTFT
     C                     MOVEL*BLANKS   QMDPO1
     C                     MOVEL*BLANKS   QMPPDG
     C                     MOVEL*BLANKS   QMPGM
     C                     MOVEL*BLANKS   QMATTN
     C                     MOVEL*BLANKS   QMPOLC                          R00824
     C                     MOVEL*BLANKS   QMPPCS                          SA9108
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '1'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END
     C                     END                                            CPM005
     C**
     C** IF OPTION 'S' HAS BEEN TAKEN
     C**
     C           WWACTN    IFEQ 'S'
     C**
     C** CALL  PMC1001 TO UPDATE LDA
     C**
     C                     Z-ADDWWPMVT    QMPMVT                          R10032
     C                     Z-ADDWWPMVV    QMPMVV                          R10032
     C*
     C                     EXSR #W1002
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C** CALL PMC630 WITH PARAMETERS PASSED BY LDA
     C**
     C***********          MOVEL'Y'       WWSCRL                          CPM005
     C                     MOVEL'POSINS  'WWJOB                           CPM005
     C**
     C                     CALL 'PMC0630'
     C***********          PARM           WWSCRL                          CPM005
     C                     PARM           WWJOB                           CPM005
     C                     PARM           QMENQT                          CPM005
     C**
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD
     C** SET UP IN #W1002
     C**
     C                     MOVEL*BLANKS   QMPTF1
     C                     MOVEL*BLANKS   QMPTF2
     C                     MOVEL*BLANKS   QMPTFN
     C                     MOVEL*BLANKS   QMTPMV
     C                     MOVEL*BLANKS   QMVPMV
     C                     MOVEL*BLANKS   QMPTAI
     C                     MOVEL*BLANKS   QMPVAI
     C                     MOVEL*BLANKS   QMPTCY
     C                     Z-ADD0         QMPCDP
     C                     MOVEL*BLANKS   QMPTFT
     C                     MOVEL*BLANKS   QMDPO1
     C                     MOVEL*BLANKS   QMPPDG
     C                     MOVEL*BLANKS   QMPGM
     C                     MOVEL*BLANKS   QMATTN
     C                     MOVEL*BLANKS   QMPOLC                          R00824
     C                     MOVEL*BLANKS   QMPPCS                          SA9108
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END
     C**
     C***IF*OPTION*'I'*HAS*BEEN*TAKEN                               R00824CPM005
     C** IF OPTION 'C' HAS BEEN TAKEN                                     CPM005
     C** ALLOW ONLY IF RECORD EXIST IN PMCIALL0                           CPM005
     C**                                                                  R00824
     C***********WWACTN    IFEQ 'I'                                 R00824CPM005
     C           WWACTN    IFEQ 'C'                                       CPM005
     C           PMPOTT    CHAINPMCIALL0             72                   CPM005
     C           *IN72     IFEQ '0'                                       CPM005
     C**                                                                  R00824
     C                     Z-ADDWWPMVT    QMPMVT                          B07822
     C                     Z-ADDWWPMVV    QMPMVV                          B07822
     C**                                                                  R00824
     C** CALL  PMC1001 TO UPDATE LDA                                      R00824
     C                     EXSR #W1002                                    R00824
     C                     CALL 'PMC1001'                                 R00824
     C                     PARM           WWLDA                           R00824
     C**                                                                  R00824
     C***CALL*PM0730*FOR INVESTMENT POLICIES DETAILS                R00824CPM005
     C******               MOVE 'PM0630'  WWCPGM  6                 R00824CPM005
     C******               CALL 'PM0730'                            R00824CPM005
     C******               PARM           WWCPGM                    R00824CPM005
     C                     MOVEL'TOTCCY  'WWJOB   8                       CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC0630'                                 CPM005
     C                     PARM           WWJOB                           CPM005
     C                     PARM           QMENQT                          CPM005
     C**                                                                  R00824
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELDS                 R00824
     C** SET UP IN #W1002                                                 R00824
     C                     MOVEL*BLANKS   QMPTF1                          R00824
     C                     MOVEL*BLANKS   QMPTF2                          R00824
     C                     MOVEL*BLANKS   QMPTFN                          R00824
     C                     MOVEL*BLANKS   QMTPMV                          R00824
     C                     MOVEL*BLANKS   QMVPMV                          R00824
     C                     MOVEL*BLANKS   QMPTAI                          R00824
     C                     MOVEL*BLANKS   QMPVAI                          R00824
     C                     MOVEL*BLANKS   QMPTCY                          R00824
     C                     Z-ADD0         QMPCDP                          R00824
     C                     MOVEL*BLANKS   QMPTFT                          R00824
     C                     MOVEL*BLANKS   QMDPO1                          R00824
     C                     MOVEL*BLANKS   QMPPDG                          R00824
     C                     MOVEL*BLANKS   QMPGM                           R00824
     C                     MOVEL*BLANKS   QMATTN                          R00824
     C                     MOVEL*BLANKS   QMPOLC                          R00824
     C                     MOVEL*BLANKS   QMPPCS                          SA9108
     C                     CALL 'PMC1001'                                 R00824
     C                     PARM           WWLDA                           R00824
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '1'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            R00824
     C                     END                                            CPM005
     C**                                                                  R00824
     C** IF OPTION 'P' HAS BEEN TAKEN                                     CPM005
     C**                                                                  CPM005
     C           WWACTN    IFEQ 'P'                                       CPM005
     C**                                                                  CPM005
     C                     Z-ADDWWPMVT    QMPMVT                          CPM005
     C                     Z-ADDWWPMVV    QMPMVV                          CPM005
     C**                                                                  CPM005
     C** CALL  PMC1001 TO UPDATE LDA                                      CPM005
     C                     EXSR #W1002                                    CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C** CALL PM0730 FOR INVESTMENT POLICIES DETAILS                      CPM005
     C                     MOVE 'PM0630'  WWCPGM  6                       CPM005
     C                     CALL 'PM0730'                                  CPM005
     C                     PARM           WWCPGM                          CPM005
     C**                                                                  CPM005
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELDS                 CPM005
     C** SET UP IN #W1002                                                 CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C                     END
     C*                                                                   081352
     C           E1001     TAG                                            081352
     C**
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1008   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      * #P1005   - PROCESS LOMBARD CREDITS DETAILS                       *
      * #P1006   - PROCESS LENDING DETAILS FOR ISSUING CUSTOMER          *
      * #P1007   - PROCESS LENDING DETAILS FOR RECEIVING CUSTOMER        *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWGUFL   - GUARANTEE FLAG                                        *
      * WWCNUM   - CUSTOMER NUMBER                                       *
      * WWCUSR   - CUSTOMER NUMBER                                       *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      *                                                                  *
      ********************************************************************
     C           #P1002    BEGSR
     C**
     C** CHECK FIRST IF LENDING MODULE OR LOMBARD CREDITS
     C** PRESENT ON SYSTEM. IF AT LEAST ONE MODULE PRESENT
     C** SETON INDICATOR 89 FOR FURTHER WRITE IN SUBFILE 1
     C** OR IN SUBFILE 2
     C**
     C                     MOVE '0'       *IN89
     C**
     C           BGLMCR    IFEQ 'Y'
     C**
     C                     MOVE '1'       *IN89
     C                     MOVEL'L'       WWGUFL
     C**
     C                     ELSE
     C**
     C           BGCSLN    IFEQ 'Y'
     C**
     C                     MOVE '1'       *IN89
     C*********************MOVE 'Y'       WWGUFL                          CPM004
     C                     MOVE 'G'       WWGUFL                          CPM004
     C**
     C                     END
     C**
     C                     END
     C**
     C** CLEAR SUBFILES
     C**
     C                     MOVE '1'       *IN61
     C                     MOVE '1'       *IN62
     C                     WRITEPM0630C1
     C                     WRITEPM0630C2
     C                     MOVE '0'       *IN61
     C                     MOVE '0'       *IN62
     C                     Z-ADD0         RRN1                            B08275
     C                     Z-ADD0         RRN2                            B08275
     C**
     C** LOAD RUN DATE
     C**
     C                     MOVELQMRUNA    DDRUNA
     C**
     C** LOAD CUSTOMER NUMBER FROM LDA
     C**
     C**********           Z-ADDQMCNUM    WWCNUM  60                                          CSD027
     C                     MOVE QMCNUM    WWCNUM  6                                           CSD027
     C**
     C** POSITION IN FILE PMPORTPP
     C**
     C********** WWCNUM    SETLLPMPORTPP                                  S01486
     C           WWCNUM    SETLLPMPORTPD                                  S01486
     C**
     C**********           READ PMPORTPP                 71               S01486
     C***********          READ PMPORTPD                 71         S01486092937
     C           WWCNUM    READEPMPORTPD                 71               092937
     C**
     C** LOOP WHILE CUSTOMER NUMBER FOUND
     C**
     C           PNCNUM    DOWEQWWCNUM
     C           *IN71     ANDEQ'0'
     C**
     C           PNRECI    IFEQ 'D'
     C           WWDMAT    ANDNE'Y'                                       B08253
     C           PNRECI    OREQ '*'                                       B08253
     C           WWDMAT    ANDEQ'Y'                                       B08253
     C*                                                                   B08253
     C**
     C**********           Z-ADDPNCNUM    WWCUSR                                              CSD027
     C                     MOVE PNCNUM    WWCUSR                                              CSD027
     C                     MOVELPNPTFR    WWPTFR
     C**
     C** LOAD SCREEN FIELDS
     C**
     C                     MOVELPNPTFR    DDPTFR
     C                     MOVELPNPTFN    DDPTFN
     C                     MOVELPNPTCY    DDPTCY
     C                     MOVELPNPTCY    WWPTCY
     C**
     C                     EXSR #P1008
     C**
     C** RESET SCREEN FIELDS BEFORE FURTHER PROCESS
     C**
     C                     MOVEL*BLANKS   DDTPMV
     C                     MOVEL*BLANKS   DDPTAI
     C                     MOVEL*BLANKS   DDPPDG
     C**
     C                     END
     C**
     C**********           READ PMPORTPP                 71               S01486
     C***********          READ PMPORTPD                 71         S01486092937
     C           WWCNUM    READEPMPORTPD                 71               092937
     C**
     C                     END
     C**                                                                  SA9108
     C** IF POOL PORTFOLIO CUSTOMER CUSTOMER INDICATOR IS 'Y'             SA9108
     C** DETAILS FOR '9997' '9998' AND '9999' SHOULD NOT BE               SA9108
     C** WRITTEN ON SCREEN                                                SA9108
     C****       QMPPCS    IFNE 'Y'                                 SA9108056460
     C**
     C** IF DISPLAY '9997' PORTFOLIO
     C**
     C***********P9DP97    IFEQ 'Y'                                       B07926
     C********** P9DP97    IFEQ 'Y'                           B0792639345 S01486
     C           FCDP97    IFEQ 'Y'                                       S01486
     C           WWDMAT    IFNE 'Y'                                       B08253
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C**
     C** MOVE REFERENCE
     C**
     C**********           MOVELP9R997    DDPTFR                          S01486
     C                     MOVELFCR997    DDPTFR                          S01486
     C**
     C** MOVE NARRATIVE
     C**
     C**********           MOVELP9N997    DDPTFN                          S01486
     C                     MOVELFCN997    DDPTFN                          S01486
     C**
     C** 'PORTFOLIO CURRENCY' IS CUSTOMER BASE CURRENCY
     C**
     C                     MOVELQMCSBY    DDPTCY
     C                     MOVELQMCSBY    WWPTCY
     C**
     C** WRITE SUBFILE RECORD
     C**
     C**********           Z-ADDQMCNUM    WWCUSR                                              CSD027
     C                     MOVE QMCNUM    WWCUSR                                              CSD027
     C                     MOVEL'9997'    WWPTFR
     C**
     C                     EXSR #P1008
     C**
     C                     END                                            B07926
     C                     ENDIF                                          103084
     C**
     C** IF DISPLAY '9998' PORTFOLIO
     C**
     C***********P9DP98    IFEQ 'Y'                                       056460
     C           QMPPCS    IFNE 'Y'                                       056460
     C********** P9DP98    IFEQ 'Y'                                 056460S01486
     C           FCDP98    IFEQ 'Y'                                       S01486
     C**
     C** MOVE REFERENCE
     C**
     C**********           MOVELP9R998    DDPTFR                          S01486
     C                     MOVELFCR998    DDPTFR                          S01486
     C**
     C** MOVE NARRATIVE
     C**
     C**********           MOVELP9N998    DDPTFN                          S01486
     C                     MOVELFCN998    DDPTFN                          S01486
     C**
     C** 'PORTFOLIO CURRENCY' IS CUSTOMER BASE CURRENCY
     C**
     C                     MOVELQMCSBY    DDPTCY
     C                     MOVELQMCSBY    WWPTCY
     C**
     C** WRITE SUBFILE RECORD
     C**
     C**********           Z-ADDQMCNUM    WWCUSR                                              CSD027
     C                     MOVE QMCNUM    WWCUSR                                              CSD027
     C                     MOVEL'9998'    WWPTFR
     C**
     C                     EXSR #P1008
     C**
     C                     END                                            B07926
     C**                                                                  CPB001
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C**
     C** MOVE REFERENCE  '9999'
     C**
     C**********           MOVELP9R999    DDPTFR                          S01486
     C                     MOVELFCR999    DDPTFR                          S01486
     C**
     C** MOVE NARRATIVE  '9999'
     C**
     C**********           MOVELP9N999    DDPTFN                          S01486
     C                     MOVELFCN999    DDPTFN                          S01486
     C**
     C** 'PORTFOLIO CURRENCY' IS CUSTOMER BASE CURRENCY
     C**
     C                     MOVELQMCSBY    DDPTCY
     C                     MOVELQMCSBY    WWPTCY
     C**
     C** WRITE SUBFILE RECORD
     C**
     C**********           Z-ADDQMCNUM    WWCUSR                                              CSD027
     C                     MOVE QMCNUM    WWCUSR                                              CSD027
     C                     MOVEL'9999'    WWPTFR
     C**
     C                     EXSR #P1008
     C                     ENDIF                                          CPB001
     C                     END                                            B08253
     C**
     C***********          END                                      SA9108103084
     C**
     C** TEST IF LOMBARD CREDITS PRESENT ON SYSTEM
     C** TO FILL DISPLAY SCREEN
     C**
     C           BGLMCR    IFEQ 'Y'
     C           WWLOMB    IFEQ 'Y'
     C                     MOVE '0'       *IN68            *LOMB. CUST.   082446
     C**
     C                     EXSR #P1005
     C**
     C                     ELSE
     C**
     C                     MOVE '1'       *IN68            *NON LOMB. CUST
     C**
     C                     END
     C**
     C                     ELSE
     C**
     C                     EXSR #P1006
     C                     EXSR #P1007
     C**
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWGUFL   - GUARANTEE FLAG                                        *
      *                                                                  *
      ********************************************************************
     C           #P1003    BEGSR
     C**
     C** RETRIEVE DATA AREA *GDA TO CHECK IF TERMINATION INDICATOR 'ON'
     C**
     C**********           CALL 'PMC1004'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C                     CALL 'PMC1003'                                 S01486
     C                     PARM           WWLDA                           S01486
     C           QMENQT    IFNE 'P'
     C           QMENQT    ANDNE' '
     C**********           CALL 'PMC1020'                                 S01486
     C                     RETRN                                          S01486
     C                     END
     C**
     C** RESET INDICATORS
     C**
     C                     MOVE '0'       *IN64                           CPM005
     C                     MOVE '0'       *IN65
     C                     MOVE '0'       *IN66
     C                     MOVE '0'       *IN67
     C**
     C** CHECK WHICH INFOMESSAGE TO SEND FOR COMMAND KEYS
     C**
     C           WWGUFL    IFEQ 'L'
     C           WWLOMB    ANDEQ'Y'
     C                     MOVE '1'       *IN67
     C                     END
     C           WWGUFL    IFEQ 'G'
     C           WWLOMB    ANDEQ'Y'
     C** INDICATOR 80 CHECK IF LOMBARD CREDIT MODULE IS INSTALLED         R1089
     C** ON SYSTEM.                                                       R1089
     C************IN80     ANDEQ'0'                                R0981  R1089
     C********** *IN80     ANDEQ'1'                                       R1089
     C**         *IN80     ANDEQ'0'                                R1089  R0175
     C           S01433    IFEQ 'Y'                                       087631
     C                     MOVE '1'       *IN66
     C                     ELSE                                           087631
     C                     MOVE '1'       *IN65                           087631
     C                     END                                            087631
     C                     END
     C**
     C           WWGUFL    IFEQ 'M'                                       R0981
     C           WWLOMB    ANDEQ'Y'                                       R0981
     C************IN80     OREQ '1'                                       R1089
     C***********WWLOMB    ANDEQ'Y'                                       R1089
     C********** *IN80     ANDEQ'1'                                       R1089
     C*********************MOVE '1'       *IN64                     R0981 R0175
     C**         *IN80     ANDEQ'0'                                 R1089 R0175
     C                     MOVE '1'       *IN65                           R0175
     C                     END                                            R0981
     C**                                                                  R0981
     C****       *IN67     IFEQ '0'                                       R0175
     C****       *IN66     ANDEQ'0'                                       R0175
     C****       *IN64     ANDEQ'0'                                 R0981 R0175
     C****                 MOVE '1'       *IN65                           R0175
     C****                 END                                            R0175
     C           *IN67     IFEQ '0'                                       R0175
     C           *IN66     ANDEQ'0'                                       R0175
     C**         *IN64     ANDEQ'0'                                 R0981 R0175
     C           *IN65     ANDEQ'0'                                 R0981 R0175
     C**                   MOVE '1'       *IN65                           R0175
     C                     MOVE '1'       *IN64                           R0175
     C                     END                                            R0175
     C**
     C                     WRITEPM0630F5
     C**
     C** TEST IF THE SCREEN IS DISPLAYED FOR THE FIRST TIME
     C**
     C           *IN84     IFEQ '0'
     C                     MOVE '1'       *IN84
     C**
     C** IF LOMBARD CREDITS ARE ON THE SYSTEM DISPLAY SCREEN
     C**
     C           BGLMCR    IFEQ 'Y'
     C**
     C                     WRITEPM0630F2
     C**
     C                     ELSE
     C**
     C           BGCSLN    IFEQ 'Y'
     C**
     C                     WRITEPM0630F4
     C**
     C                     END
     C**
     C                     END
     C**
     C** NOT FIRST TIME
     C**
     C                     ELSE
     C**
     C           WWGUFL    IFEQ 'L'
     C**
     C                     WRITEPM0630F2
     C**
     C                     ELSE
     C**
     C           WWGUFL    IFEQ 'G'
     C**
     C                     WRITEPM0630F3
     C**
     C                     END
     C**
     C                     END
     C**
     C** DISPLAY PRECIOUS METAL DETAILS                                   R0981
     C           WWGUFL    IFEQ 'M'                                       R0981
     C                     WRITEPM0630F6                                  R0981
     C                     END                                            R0981
     C**                                                                  R0981
     C                     END
     C**
     C** SEND SUBFILE
     C**
     C           *IN89     IFEQ '0'
     C                     READ PM0630C2                 70
     C                     ELSE
     C                     READ PM0630C1                 70
     C                     END
     C**
     C                     MOVE '0'       *IN53
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1004   - PROCESS PORTFOLIO DETAILS                             *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZCCYCN   - TO CONVERT AN AMOUNT FROM 1 CCY TO ANOTHER            *
      * ZSEDIT  - TO EDIT A NUMBER WITH DECIMAL POINT                   *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1008   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTPMV   - TEMPORARY MARKET VALUE                                *
      *                                                                  *
      ********************************************************************
     C           #P1004    BEGSR
     C**
     C** SET UP FIELDS FOR CURRENCY CONVERSION BELOW
     C**
     C** LOAD PORTFOLIO CURRENCY
     C                     MOVELWWPTCY    ZCCYF
     C**
     C** LOAD CUSTOMER  CURRENCY
     C                     MOVELQMCSBY    ZCCYT
     C********                                                            R05667
     C***LOAD*SPOT RATE FOR PORTFOLIO CURRENCY                            R05667
     C********   WWPTCY    CHAINSDCURRL1             72                   R05667
     C********             Z-ADDA6SPRT    ZRATEF                          R05667
     C********             MOVELA6MDIN    ZMDINF                          R05667
     C********             Z-ADDA6NBDP    ZCDPF                           R05667
     C                     MOVE WWPTCY    WWHCCY                          R05667
     C********** PMHSEX    SETGTPMHSEXPP                            R05667S01486
     C**********           READPPMHSEXPP                 71         R05667S01486
     C           PMHSEX    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 71               S01486
     C*                                                                   R05667
     C           *IN71     IFEQ '1'                                       R05667
     C           Q8CCY     ORNE WWPTCY                                    R05667
     C           Q8RECI    ORNE 'D'                                       R05667
     C                     MOVEL'Y'       QMDBER                          R05667
     C                     MOVEL'Y'       QMENQT                          R05667
     C**********           MOVE 'PMHSEXPP'QMFILE                    R05667S01486
     C                     MOVE 'PMHSEXPD'QMFILE                          S01486
     C                     MOVE 'PM0630'  QMPGM                           R05667
     C                     MOVELWWPTCY    QMKEY            ***************R05667
     C                     Z-ADD50        QMERRN           **DB ERROR 50**R05667
     C                     EXSR *PSSR                      ***************R05667
     C                     END                                            R05667
     C**                                                                  R05667
     C                     Z-ADDQ8SPOT    ZRATEF                          R05667
     C                     MOVELQ8MDV1    ZMDINF                          R05667
     C                     Z-ADDQ8CDP     ZCDPF                           R05667
     C********                                                            R05667
     C***LOAD*SPOT RATE FOR CUSTOMER CURRENCY                             R05667
     C********   QMCSBY    CHAINSDCURRL1             72                   R05667
     C********             Z-ADDA6SPRT    ZRATET                          R05667
     C********             MOVELA6MDIN    ZMDINT                          R05667
     C********             Z-ADDA6NBDP    ZCDPT                           R05667
     C                     MOVE QMCSBY    WWHCCY                          R05667
     C********** PMHSEX    SETGTPMHSEXPP                            R05667S01486
     C**********           READPPMHSEXPP                 71         R05667S01486
     C           PMHSEX    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 71               S01486
     C*                                                                   R05667
     C           *IN71     IFEQ '1'                                       R05667
     C           Q8CCY     ORNE QMCSBY                                    R05667
     C           Q8RECI    ORNE 'D'                                       R05667
     C                     MOVEL'Y'       QMDBER                          R05667
     C                     MOVEL'Y'       QMENQT                          R05667
     C**********           MOVE 'PMHSEXPP'QMFILE                    R05667S01486
     C                     MOVE 'PMHSEXPD'QMFILE                          S01486
     C                     MOVE 'PM0630'  QMPGM                           R05667
     C                     MOVELQMCSBY    QMKEY            ***************R05667
     C                     Z-ADD51        QMERRN           **DB ERROR 51**R05667
     C                     EXSR *PSSR                      ***************R05667
     C                     END                                            R05667
     C**                                                                  R05667
     C                     Z-ADDQ8SPOT    ZRATET                          R05667
     C                     MOVELQ8MDV1    ZMDINT                          R05667
     C                     Z-ADDQ8CDP     ZCDPT                           R05667
     C**
     C** COMPUTE TRADE DATE MARKET VALUE
     C**
     C           QCPTPA    SUB  QCPTNA    WWTPMV 150
     C           WWTPMV    SUB  QCPTMV    WWTPMV
     C**
     C** LOAD TRADE DATE MARKET VALUE IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDWWTPMV    ZFLD15
     C                     Z-ADDZCDPF     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDTRDH
     C**
     C** CONVERT THE TRADE DATE MARKET VALUE FROM PORTFOLIO CURRENCY
     C** TO CUSTOMER BASE CURRENCY
     C**
     C                     Z-ADDWWTPMV    ZAMTF
     C                     EXSR ZCCYCN
     C**
     C** EDIT TRADE DATE MARKET VALUE IN CUSTOMER BASE CURRENCY USING ZSEDIT
     C**
     C                     Z-ADDZAMTT     ZFLD15
     C                     Z-ADDZCDPT     ZDECS
     C                     EXSR ZSEDIT
     C***********          MOVE ZOUT21    WWTRAD 16                       147782
     C                     MOVE ZOUT21    WWTRAD 19                       147782
     C**
     C** COMPUTE VALUE DATE MARKET VALUE
     C**
     C           QCPVPA    SUB  QCPVNA    WWTPMV
     C           WWTPMV    SUB  QCPVMV    WWTPMV
     C**
     C** LOAD VALUE DATE MARKET VALUE IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDWWTPMV    ZFLD15
     C                     Z-ADDZCDPF     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDVALH
     C**
     C** CONVERT THE VALUE DATE MARKET VALUE FROM PORTFOLIO CURRENCY
     C** TO CUSTOMER BASE CURRENCY
     C**
     C                     Z-ADDWWTPMV    ZAMTF
     C                     EXSR ZCCYCN
     C**
     C** EDIT VALUE DATE MARKET VALUE IN CUSTOMER BASE CURRENCY USING ZSEDIT
     C**
     C                     Z-ADDZAMTT     ZFLD15
     C                     Z-ADDZCDPT     ZDECS
     C                     EXSR ZSEDIT
     C***********          MOVE ZOUT21    WWVALU 16                       147782
     C                     MOVE ZOUT21    WWVALU 19                       147782
     C**
     C** LOAD TRADE DATE ACCRUED INTEREST IN PORTFOLIO CURRENCY (FOR LDA)
     C**
     C                     Z-ADDQCPTAI    ZFLD15
     C                     Z-ADDZCDPF     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDTAIH
     C**
     C** CONVERT THE TRADE DATE ACCRUED INTEREST FROM PORTFOLIO CURRENCY
     C** TO CUSTOMER BASE CURRENCY  (FOR SCREEN DISPLAY)
     C**
     C                     Z-ADDQCPTAI    ZAMTF
     C                     EXSR ZCCYCN
     C**
     C** EDIT TRADE DATE ACCRUED INTEREST IN CUSTOMER BASE CURRENCY USING ZSEDIT
     C**
     C                     Z-ADDZAMTT     ZFLD15
     C                     Z-ADDZCDPT     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWTRAI 16
     C**
     C** LOAD VALUE DATE ACCRUED INTEREST IN PORTFOLIO CURRENCY (FOR LDA)
     C**
     C****                 Z-ADDQCPVAI    ZFLD15                          B08040
     C                     Z-ADDQCPTAI    ZFLD15                          B08040
     C                     Z-ADDZCDPF     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDVAIH
     C**
     C** CONVERT THE VALUE DATE ACCRUED INTEREST FROM PORTFOLIO CURRENCY
     C** TO CUSTOMER BASE CURRENCY  (FOR SCREEN DISPLAY)
     C**
     C****                 Z-ADDQCPVAI    ZAMTF                           B08040
     C                     Z-ADDQCPTAI    ZAMTF                           B08040
     C                     EXSR ZCCYCN
     C**
     C** EDIT VALUE DATE ACCRUED INTEREST IN CUSTOMER BASE CURRENCY USING ZSEDIT
     C**
     C                     Z-ADDZAMTT     ZFLD15
     C                     Z-ADDZCDPT     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWVLAI 16
     C**
     C** DISPLAY TRADE OR VALUE DATE MARKET VALUE/ACCRUED INTEREST
     C**
     C********** P9TVPS    IFEQ 'T'                                       S01486
     C           FCTVPS    IFEQ 'T'                                       S01486
     C                     MOVE WWTRAD    DDTPMV
     C                     MOVE WWTRAI    DDPTAI
     C                     ELSE
     C                     MOVE WWVALU    DDTPMV
     C                     MOVE WWVLAI    DDPTAI
     C                     END
     C**                                                                  R0758
     C**                   MOVEL*BLANKS   DDPPDG                          R0758
     C**                                                                  R0758
     C** PLEDGED (Y/N)                                                    R0758
     C**                                                                  R0758
     C***        WWPTFR    IFEQ '9997'                                    R0758
     C***        WWPTFR    OREQ '9998'                                    R0758
     C***        WWPTFR    OREQ '9999'                                    R0758
     C***                  MOVEL*BLANK    DDPPDG                          R0758
     C**                                                                  R0758
     C**                   ELSE                                           R0758
     C**                                                                  R0758
     C**  IF RUN DATE LESS THAN OR EQUAL TO PLEDGE START DATE             R0758
     C**                                                                  R0758
     C**                   MOVE *BLANK    WWPDG1                          R0758
     C**                   MOVE *BLANK    WWPDG3                          R0758
     C**                   MOVE 'N'       WWPDG5                          R0758
     C**                                                                  R0758
     C**         PNPDGS    IFEQ 0                                         R0758
     C**         QMRDNB    ORGT PNPDGF                                    R0758
     C**                                                                  R0758
     C******************** MOVEL'N'       DDPPDG                          R0758
     C**                   MOVE 'N'       WWPDG1                          R0758
     C**                                                                  R0758
     C**                   ELSE                                           R0758
     C**                                                                  R0758
     C**         QMRDNB    IFGE PNPDGS                                    R0758
     C**         QMRDNB    ANDLEPNPDGF                                    R0758
     C**                                                                  R0758
     C******************** MOVEL'Y'       DDPPDG                          R0758
     C**                   MOVE 'Y'       WWPDG1                          R0758
     C**                                                                  R0758
     C**                   END                                            R0758
     C**                                                                  R0758
     C**                   END                                            R0758
     C**                                                                  R0758
     C** MANAGED INDICATOR                                                R0758
     C**                                                                  R0758
     C**                   MOVE PNMNGI    WWPDG3                          R0758
     C**                                                                  R0758
     C** INVESTMENT POLICY                                                R0758
     C**                                                                  R0758
     C**         PNPOLC    IFNE *BLANK                                    R0758
     C**         PNIPIN    OREQ 'Y'                                       R0758
     C**         PNCYIN    OREQ 'Y'                                       R0758
     C**         PNYPIN    OREQ 'Y'                                       R0758
     C**         PNNPIN    OREQ 'Y'                                       R0758
     C**                   MOVE 'Y'       WWPDG5                          R0758
     C**                   END                                            R0758
     C**                                                                  R0758
     C**                   MOVE WWPPDG    DDPPDG                          R0758
     C**                                                                  R0758
     C**                   END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1008   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1004   - PROCESS PORTFOLIO DETAILS                             *
      * #P1016   - SET UP INFORMATION FOR PLEDGE ETC..                   *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1008    BEGSR
     C**
     C** PERFORM ROUTINE TO SET UP PLEDGE ETC INFORMATION
     C**
     C                     EXSR #P1016                                    R0758
     C**                                                                  R10032
     C** SET TRADE AND VALUE DATE PORTFOLIO MARKET VALUE TO ZERO          R10032
     C**                                                                  R10032
     C                     Z-ADD0         QMPMVT 150                      R10032
     C                     Z-ADD0         QMPMVV 150                      R10032
     C********** PMPOTT    CHAINPMPOTTPP             72                   S01486
     C           PMPOTT    CHAINPMPOTTPD             72                   S01486
     C*                                                                   B08253
     C** IF*NOT*FOUND*CHECK*FOR*EXISTENCE*OF*MATURED*POSITIONS*ON*PMMFHLPPB08253
     C** IF NOT FOUND CHECK FOR EXISTENCE OF MATURED POSITIONS ON PMMFHLPDS01486
     C           *IN72     IFEQ '1'                                       B08253
     C                     MOVE WWCUSR    W1CNUM                          B08253
     C                     MOVE WWPTFR    W1PTFR                          B08253
     C                     Z-ADD0         W1DSPS                          B08253
     C                     MOVE *LOVAL    W1DSPG                          B08253
     C                     Z-ADD0         W1ITDS                          B08253
     C                     MOVE *LOVAL    W1INNR                          B08253
     C****                 MOVE *LOVAL    W1MODI                    B08253S01313
     C****                 MOVE *LOVAL    W1RECI                    B08253S01313
     C                     MOVE *LOVAL    W1CCY1                          S01313
     C                     MOVE *LOVAL    W1TDSS                          B08253
     C                     Z-ADD0         W1DLSQ                          B08253
     C**********           Z-ADD0         W1TRNB                                       B08253 CLE148
     C                     MOVEL*BLANKS   W1TRNB                                              CLE148
     C                     MOVE *LOVAL    W1TXT2                          B08253
     C*                                                                   B08253
     C********** MFHLK     SETLLPMMFHLPP                            B08253S01486
     C********** MFHLK1    READEPMMFHLPP                 72         B08253S01486
     C           MFHLK     SETLLPMMFHLPD                                  S01486
     C           MFHLK1    READEPMMFHLPD                 72               S01486
     C*                                                                   B08253
     C                     Z-ADD0         QCPTPA                          B08253
     C                     Z-ADD0         QCPTNA                          B08253
     C                     Z-ADD0         QCPTMV                          B08253
     C                     Z-ADD0         QCPVPA                          B08253
     C                     Z-ADD0         QCPVNA                          B08253
     C                     Z-ADD0         QCPVMV                          B08253
     C                     Z-ADD0         QCPTAI                          B08253
     C                     END                                            B08253
     C**
     C** RECORD FOUND
     C**
     C           *IN72     IFEQ '0'
     C****       QCRECI    ANDEQ'D'                                       B08040
     C**
     C** CONVERT AMOUNTS TO CUSTOMER BASE CURRENCY
     C**
     C                     EXSR #P1004
     C**                                                                  R10032
     C** CALCULATE TRADE DATE PORTFOLIO VALUE                             R10032
     C**                                                                  R10032
     C           QCPTPA    SUB  QCPTNA    QMPMVT                          R10032
     C           QMPMVT    SUB  QCPTMV    QMPMVT                          R10032
     C           QMPMVT    ADD  QCPTAI    QMPMVT                          R10032
     C                     Z-ADDQMPMVT    WWPMVT                          R10032
     C**                                                                  R10032
     C** CALCULATE VALUE DATE PORTFOLIO VALUE                             R10032
     C**                                                                  R10032
     C           QCPVPA    SUB  QCPVNA    QMPMVV                          R10032
     C           QMPMVV    SUB  QCPVMV    QMPMVV                          R10032
     C****       QMPMVV    ADD  QCPVAI    QMPMVV                    B08040R10032
     C           QMPMVV    ADD  QCPTAI    QMPMVV                    B08040R10032
     C                     Z-ADDQMPMVV    WWPMVV                          R10032
     C**
     C** RECORD NOT FOUND
     C**
     C                     ELSE
     C**
     C                     MOVEL*BLANKS   DDTPMV
     C                     MOVEL*BLANKS   DDPTAI
     C*********************MOVEL*BLANKS   DDPPDG                           R0758
     C*                                                                   B08253
     C                     MOVE '1'       *IN69
     C**
     C                     END
     C**
     C** WRITE RECORD TO THE SUBFILE
     C**
     C** NOTE: FOR POOL ONLY OUTPUT '9997' PORTFOLIO IF DETAILS EXIST     056460
     C** IN PORTFOLIO                                                     056460
     C           *IN69     IFEQ '1'                                       056460
     C********** DDPTFR    ANDEQP9R997                             056460 S01486
     C           DDPTFR    ANDEQFCR997                                    S01486
     C           QMPPCS    ANDEQ'Y'                                       056460
     C                     MOVE '0'       *IN69                           082549
     C                     GOTO #P1098                                    056460
     C                     END                                            056460
     C*                                                                   056460
     C/COPY WNCPYSRC,PM0630C018
     C           *IN89     IFEQ '0'
     C                     ADD  1         RRN2
     C                     WRITEPM0630S2
     C                     MOVE '0'       *IN69
     C                     ELSE
     C                     ADD  1         RRN1
     C                     WRITEPM0630S1
     C                     MOVE '0'       *IN69
     C                     END
     C**
     C****                 ENDSR                                          056460
     C           #P1098    ENDSR                                          056460
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1005   - PROCESS LOMBARD CREDITS DETAILS                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZCCYCN   - TO CONVERT AN AMOUNT FROM 1 CCY TO ANOTHER            *
      * ZSEDIT   - TO EDIT A NUMBER WITH DECIMAL POINT                  *
      * #U1003   - FORMAT LOMBARD DETAILS                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWPOWR   - POWER  WORK FIELD                                     *
      * WWEXPO   - EXPOSURE                                              *
      * WWGUAR   - GUARANTEE AMOUNT                                      *
      * WWSTDT   - STARTING DATE                                         *
      * WWCMTL   - COMMITMENT LINE AMOUNT                                *
      * WWTPRD   - WORK FIELD                                            *
      * WWAVA1   - AVAILABILITY ONE                                      *
      * WWAVA2   - AVAILABILITY TWO                                      *
      * WWAVAY   - AVAILABILITY TOTAL WORK FIELD                         *
      *                                                                  *
      ********************************************************************
     C           #P1005    BEGSR
     C**
     C** SET AMOUNTS TO ZERO
     C**
     C                     Z-ADD0         WWBRPR 150       *BORR POWER
     C                     Z-ADD0         WWBRP1 150       *IN LB   CCY
     C                     Z-ADD0         WWBRP2 150       *IN CUST CCY
     C                     Z-ADD0         WWAVBR 150       *AVAIL BORR PWR
     C                     Z-ADD0         WWAVB1 150       * IN LB CCY
     C                     Z-ADD0         WWAVB2 150       * IN CUST CCY
     C                     Z-ADD0         WWLEPO 150
     C                     Z-ADD0         WWAVLE 150       * AVAIL. LEND.
     C                     Z-ADD0         WWAVL1 150       *IN LB CCY
     C                     Z-ADD0         WWAVL2 150       * IN CUST CCY
     C                     Z-ADD0         WWEXPO 150       *EXPOSURE
     C                     Z-ADD0         WWEXP1 150       *IN LB CCY
     C                     Z-ADD0         WWEXP2 150       *IN CUST CCY
     C                     Z-ADD0         WWCOLL 150
     C                     Z-ADD0         WWCMTL 150
     C**
     C** CHAIN WITH CUSTOMER NUMBER TO LF/LBEXTSL1
     C**
     C           QMCNUM    CHAINLBEXTSL1             72
     C** RECORD FOUND
     C           *IN72     IFEQ '0'
     C** CALCULATE BORROWING POWER
     C***********ESLPWR    ADD  ESTPRD    WWBRPR                          R5543
     C           ESLPWR    ADD  ESTPRV    WWBRPR                          R5543
     C                     Z-ADDWWBRPR    WWBRP1
     C** CHECK IF CUSTOMER CURRENCY EQUAL TO LOMBARD CREDIT CURRENCY
     C********** QMCSBY    IFNE LBCCY                                     S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C** CONVERT BORROWING POWER
     C                     Z-ADDWWBRPR    ZAMTF
     C**********           MOVELLBCCY     ZCCYF                           S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT
     C                     Z-ADDW1SPRT    ZRATEF
     C                     Z-ADDW2SPRT    ZRATET
     C                     MOVELW1MDIN    ZMDINF
     C                     MOVELW2MDIN    ZMDINT
     C                     Z-ADDW1NBDP    ZCDPF
     C                     Z-ADDW2NBDP    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWBRPR
     C                     Z-ADDWWBRPR    WWBRP2
     C**
     C                     END
     C** CALCULATE THE EXPOSURE
     C           ESOWEX    ADD  ESTPIU    WWEXPO
     C                     Z-ADDWWEXPO    WWEXP1
     C********** QMCSBY    IFNE LBCCY                                     S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C** CONVERT EXPOSURE
     C                     Z-ADDWWEXPO    ZAMTF
     C**********           MOVELLBCCY     ZCCYF                           S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT
     C                     Z-ADDW1SPRT    ZRATEF
     C                     Z-ADDW2SPRT    ZRATET
     C                     MOVELW1MDIN    ZMDINF
     C                     MOVELW2MDIN    ZMDINT
     C                     Z-ADDW1NBDP    ZCDPF
     C                     Z-ADDW2NBDP    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWEXPO
     C                     Z-ADDWWEXPO    WWEXP2
     C**
     C                     END
     C** CALCULATE WORKFIELD 1 AS COMMITMENT LINE MINUS EXPOSURE
     C           ESCMTL    SUB  WWEXP1    WWWRK1 150
     C** CALCULATE WORKFIELD 1 AS COMMITMENT LINE MINUS EXPOSURE
     C           WWBRP1    SUB  WWEXP1    WWWRK2 150
     C** SET AVAILABLE BORROWING TO LESSER OF WORKFIELD1 AND
     C** WORKFIELD2
     C           WWWRK1    IFLE WWWRK2
     C                     Z-ADDWWWRK1    WWAVBR
     C                     ELSE
     C                     Z-ADDWWWRK2    WWAVBR
     C                     END
     C                     Z-ADDWWAVBR    WWAVB1
     C** CUSTOMER CURRENCY <> LOMBARD CURRENCY
     C********** QMCSBY    IFNE LBCCY                                     S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C** CONVERT AVAILABLE BORROWING POWER
     C                     Z-ADDWWAVBR    ZAMTF
     C**********           MOVELLBCCY     ZCCYF                           S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT
     C                     Z-ADDW1SPRT    ZRATEF
     C                     Z-ADDW2SPRT    ZRATET
     C                     MOVELW1MDIN    ZMDINF
     C                     MOVELW2MDIN    ZMDINT
     C                     Z-ADDW1NBDP    ZCDPF
     C                     Z-ADDW2NBDP    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWAVBR
     C                     Z-ADDWWAVBR    WWAVB2
     C**
     C                     END
     C** CALCULATE AVAILABLE LENDING
     C** AS AVAILABLE LENDING LESS TOTAL EXPOSURE                         R5574
     C**         WWAVB1    SUB  ESTPRD    WWAVLE                          R5574
     C**         ESLPWR    SUB  WWEXPO    WWAVLE                          R5574
     C**                   Z-ADDWWAVLE    WWAVL1                          R5608
     C** CUSTOMER CURRENCY <> LOMBARD CURRENCY                            R5608
     C**         QMCSBY    IFNE LBCCY                                     R5608
     C** CONVERT AVAILABLE BORROWING POWER                                R5608
     C**                   Z-ADDWWAVLE    ZAMTF                           R5608
     C**                   MOVELLBCCY     ZCCYF                           R5608
     C**                   MOVELQMCSBY    ZCCYT                           R5608
     C**                   Z-ADDW1SPRT    ZRATEF                          R5608
     C**                   Z-ADDW2SPRT    ZRATET                          R5608
     C**                   MOVELW1MDIN    ZMDINF                          R5608
     C**                   MOVELW2MDIN    ZMDINT                          R5608
     C**                   Z-ADDW1NBDP    ZCDPF                           R5608
     C**                   Z-ADDW2NBDP    ZCDPT                           R5608
     C**                   EXSR ZCCYCN                                    R5608
     C**                   Z-ADDZAMTT     WWAVLE                          R5608
     C**                   Z-ADDWWAVLE    WWAVL2                          R5608
     C**                                                                  R5608
     C**                   END                                            R5608
     C** CALCULATE TOTAL COLLATERAL
     C***********ESOWCO    ADD  ESTPRD    WWCOLL                          R5543
     C           ESOWCO    ADD  ESTPRV    WWCOLL                          R5543
     C** CUSTOMER CURRENCY <> LOMBARD CURRENCY
     C********** QMCSBY    IFNE LBCCY                                     S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C** CONVERT AVAILABLE BORROWING POWER
     C                     Z-ADDWWCOLL    ZAMTF
     C**********           MOVELLBCCY     ZCCYF                           S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT
     C                     Z-ADDW1SPRT    ZRATEF
     C                     Z-ADDW2SPRT    ZRATET
     C                     MOVELW1MDIN    ZMDINF
     C                     MOVELW2MDIN    ZMDINT
     C                     Z-ADDW1NBDP    ZCDPF
     C                     Z-ADDW2NBDP    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWCOLL
     C**
     C                     END
     C** CALCULATE COMMITMENT LINE
     C                     Z-ADDESCMTL    WWCMTL
     C** CUSTOMER CURRENCY <> LOMBARD CURRENCY
     C********** QMCSBY    IFNE LBCCY                                     S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C** CONVERT AVAILABLE BORROWING POWER
     C                     Z-ADDWWCMTL    ZAMTF
     C**********           MOVELLBCCY     ZCCYF                           S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT
     C                     Z-ADDW1SPRT    ZRATEF
     C                     Z-ADDW2SPRT    ZRATET
     C                     MOVELW1MDIN    ZMDINF
     C                     MOVELW2MDIN    ZMDINT
     C                     Z-ADDW1NBDP    ZCDPF
     C                     Z-ADDW2NBDP    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWCMTL
     C**
     C                     END
     C** CALCULATE LENDING POWER
     C                     Z-ADDESLPWR    WWLEPO
     C** CUSTOMER CURRENCY <> LOMBARD CURRENCY
     C********** QMCSBY    IFNE LBCCY                                     S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C** CONVERT AVAILABLE BORROWING POWER
     C                     Z-ADDWWLEPO    ZAMTF
     C**********           MOVELLBCCY     ZCCYF                           S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT
     C                     Z-ADDW1SPRT    ZRATEF
     C                     Z-ADDW2SPRT    ZRATET
     C                     MOVELW1MDIN    ZMDINF
     C                     MOVELW2MDIN    ZMDINT
     C                     Z-ADDW1NBDP    ZCDPF
     C                     Z-ADDW2NBDP    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWLEPO
     C**
     C                     END
     C** CALCULATE AVAILABLE LENDING                                      R5608
     C** AS AVAILABLE LENDING LESS TOTAL EXPOSURE                         R5608
     C**   IF AVAILABLE BORROWING < = ZERO                                R5646
     C**      SET AVAILABLE LENDING TO ZERO                               R5646
     C**   ELSE                                                           R5646
     C**      IF AVAILABLE LENDING > AVAILABLE BORROWING                  R5646
     C**         SET AVAILABLE LENDING = AVAILABLE BORROWING              R5646
     C*                                                                   R5646
     C           WWLEPO    SUB  WWEXPO    WWAVLE                          R5608
     C           WWAVLE    IFLT 0                                         R5608
     C                     Z-ADD0         WWAVLE                          R5608
     C                     END                                            R5608
     C           WWAVBR    IFLE *ZEROS                                    R5646
     C                     Z-ADD*ZEROS    WWAVLE                          R5646
     C                     ELSE                                           R5646
     C           WWAVLE    IFGT WWAVBR                                    R5646
     C                     Z-ADDWWAVBR    WWAVLE                          R5646
     C                     END                                            R5646
     C                     END                                            R5646
     C*                                                                   R5646
     C**         WWAVLE    IFGT WWCMTL                               R5608R5646
     C**                   Z-ADDWWCMTL    WWAVLE                     R5608R5646
     C**                   END                                       R5608R5646
     C                     Z-ADDWWAVLE    WWAVL1                          R5608
     C                     END
     C**
     C                     EXSR #U1003
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1006   - PROCESS LENDING DETAILS FOR ISSUING CUSTOMER          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZCCYCN   - TO CONVERT AN AMOUNT FROM 1 CCY TO ANOTHER            *
      * ZSEDIT  - TO EDIT A NUMBER WITH DECIMAL POINT                   *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTEMP   - TEMPORARY WORK FIELD                                  *
      * WWGARI   - GUARANTEES ISSUED                                     *
      * WWSEPG   - SECURITY GIVEN                                        *
      * WWCPLG   - PLEDGE GIVEN                                          *
      *                                                                  *
      ********************************************************************
     C           #P1006    BEGSR
     C**
     C** SET LOWER LIMITS ON PMGTEES USING CUSTOMER NUMBER FROM *GDA
     C**
     C********** QMCNUM    SETLLPMGTEES                                   S01486
     C**
     C**********           READ PMGTEES                  72               S01486
     C           QMCNUM    SETLLPMGTEEL0                                  S01486
     C                     READ PMGTEEL0                 72               S01486
     C**
     C** DO WHILE SAME CUSTOMER NUMBER
     C**
     C           QMCNUM    DOWEQCNUM
     C           *IN72     ANDEQ'0'
     C**
     C           QMCSBY    IFEQ CCY
     C**
     C                     Z-ADDTAMT      WWTEMP 130
     C**
     C** IF BASE CURRENCY NOT EQUAL TO GUARANTEE CURRENCY
     C**
     C                     ELSE
     C**
     C** CONVERT TOTAL AMOUNT
     C**
     C                     Z-ADDTAMT      ZAMTF
     C                     MOVELCCY       ZCCYF
     C                     MOVELQMCSBY    ZCCYT
     C**
     C********** CCY       CHAINSDCURRL1             73                   S01486
     C                     MOVELCCY       @AJCD                           S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR'  @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVELA6MDIN    ZMDINF
     C                     Z-ADDA6NBDP    ZCDPF
     C**
     C********** QMCSBY    CHAINSDCURRL1             73                   S01486
     C                     MOVELQMCSBY    @AJCD                           S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR'  @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C                     Z-ADDA6SPRT    ZRATET
     C                     MOVELA6MDIN    ZMDINT
     C                     Z-ADDQMBYDP    ZCDPT
     C**
     C                     EXSR ZCCYCN
     C**
     C                     Z-ADDZAMTT     WWTEMP
     C**
     C**
     C                     END
     C**
     C** CHECK THE GUARANTEE SECURITY INDICATOR
     C**
     C** IF INDICATOR EQUAL TO 'G'
     C** THEN ADD AMOUNT TO AMOUNT OF GUARANTEES ISSUED
     C**
     C           GSCI      IFEQ 'G'
     C                     ADD  WWTEMP    WWGARI 130
     C                     END
     C** IF INDICATOR EQUAL TO 'S'
     C** THEN ADD AMOUNT TO AMOUNT OF SECURITY PLEDGES GIVEN
     C**
     C           GSCI      IFEQ 'S'
     C                     ADD  WWTEMP    WWSEPG 130
     C                     END
     C** IF INDICATOR EQUAL TO 'C'
     C** THEN ADD AMOUNT TO AMOUNT OF COLLATERAL PLEDGES GIVEN
     C**
     C           GSCI      IFEQ 'C'
     C                     ADD  WWTEMP    WWCPLG 130
     C                     END
     C**
     C**********           READ PMGTEES                  72               S01486
     C                     READ PMGTEEL0                 72               S01486
     C**
     C                     END
     C**
     C** EDIT AMOUNT OF GUARANTEE ISSUED USING ZSEDIT
     C**
     C                     Z-ADDWWGARI    ZFLD15
     C                     Z-ADDQMBYDP    ZDECS
     C**
     C                     EXSR ZSEDIT
     C**
     C                     MOVE ZOUT21    DDGUIS
     C**
     C**
     C** EDIT SECURITY PLEDGES GIVEN USING ZSEDIT
     C**
     C                     Z-ADDWWSEPG    ZFLD15
     C                     Z-ADDQMBYDP    ZDECS
     C**
     C                     EXSR ZSEDIT
     C**
     C                     MOVE ZOUT21    DDSECG
     C**
     C**
     C** EDIT COLLATERAL PLEDGES GIVEN USING ZSEDIT
     C**
     C                     Z-ADDWWCPLG    ZFLD15
     C                     Z-ADDQMBYDP    ZDECS
     C**
     C                     EXSR ZSEDIT
     C**
     C                     MOVE ZOUT21    DDCOPG
     C**
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1007   - PROCESS LENDING DETAILS FOR RECEIVING CUSTOMER        *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZCCYCN   - TO CONVERT AN AMOUNT FROM 1 CCY TO ANOTHER            *
      * ZSEDIT  - TO EDIT A NUMBER WITH DECIMAL POINT                   *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTEMP   - TEMPORARY WORK FIELD                                  *
      * WWGARR   - GUARANTEES RECEIVED                                   *
      * WWSEPR   - SECURITY RECEIVED                                     *
      * WWCPLR   - PLEDGE RECEIVED                                       *
      *                                                                  *
      ********************************************************************
     C           #P1007    BEGSR
     C**
     C** SET LOWER LIMITS ON PMGTEES USING CUSTOMER NUMBER FROM *GDA
     C**
     C           QMCNUM    SETLLGTEES
     C**
     C                     READ GTEES                    72
     C**
     C** DO WHILE SAME CUSTOMER NUMBER
     C**
     C           QMCNUM    DOWEQCNUM
     C           *IN72     ANDEQ'0'
     C**
     C           QMCSBY    IFEQ CCY
     C**
     C                     Z-ADDTAMT      WWTEMP 130
     C**
     C** IF BASE CURRENCY NOT EQUAL TO GUARANTEE CURRENCY
     C**
     C                     ELSE
     C**
     C** CONVERT TOTAL AMOUNT
     C**
     C                     Z-ADDTAMT      ZAMTF
     C                     MOVELCCY       ZCCYF
     C                     MOVELQMCSBY    ZCCYT
     C**
     C********** CCY       CHAINSDCURRL1             73                   S01486
     C                     MOVELCCY       @AJCD                           S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR'  @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVELA6MDIN    ZMDINF
     C                     Z-ADDA6NBDP    ZCDPF
     C**
     C********** QMCSBY    CHAINSDCURRL1             73                   S01486
     C                     MOVELQMCSBY    @AJCD                           S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR'  @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C                     Z-ADDA6SPRT    ZRATET
     C                     MOVELA6MDIN    ZMDINT
     C                     Z-ADDQMBYDP    ZCDPT
     C**
     C                     EXSR ZCCYCN
     C**
     C                     Z-ADDZAMTT     WWTEMP
     C**
     C**
     C                     END
     C**
     C** CHECK THE GUARANTEE SECURITY INDICATOR
     C**
     C** IF INDICATOR EQUAL TO 'G'
     C** THEN ADD AMOUNT TO AMOUNT OF GUARANTEES RECEIVED
     C**
     C           GSCI      IFEQ 'G'
     C                     ADD  WWTEMP    WWGARR 130
     C                     END
     C** IF INDICATOR EQUAL TO 'S'
     C** THEN ADD AMOUNT TO AMOUNT OF SECURITY PLEDGES RECEIVED
     C**
     C           GSCI      IFEQ 'S'
     C                     ADD  WWTEMP    WWSEPR 130
     C                     END
     C** IF INDICATOR EQUAL TO 'C'
     C** THEN ADD AMOUNT TO AMOUNT OF COLLATERAL PLEDGES RECEIVED
     C**
     C           GSCI      IFEQ 'C'
     C                     ADD  WWTEMP    WWCPLR 130
     C                     END
     C**
     C                     READ GTEES                    72
     C**
     C                     END
     C**
     C** EDIT AMOUNT OF GUARANTEE RECEIVED USING ZSEDIT
     C**
     C                     Z-ADDWWGARR    ZFLD15
     C                     Z-ADDQMBYDP    ZDECS
     C**
     C                     EXSR ZSEDIT
     C**
     C                     MOVE ZOUT21    DDGURC
     C**
     C**
     C** EDIT SECURITY PLEDGES RECEIVED USING ZSEDIT
     C**
     C                     Z-ADDWWSEPR    ZFLD15
     C                     Z-ADDQMBYDP    ZDECS
     C**
     C                     EXSR ZSEDIT
     C**
     C                     MOVE ZOUT21    DDSECR
     C**
     C**
     C** EDIT COLLATERAL PLEDGES RECEIVED USING ZSEDIT
     C**
     C                     Z-ADDWWCPLR    ZFLD15
     C                     Z-ADDQMBYDP    ZDECS
     C**
     C                     EXSR ZSEDIT
     C**
     C                     MOVE ZOUT21    DDCOPR
     C**
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1009   - FOREX DETAILS                                         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1010   - CALCULATE FOREX LIMIT AMOUNT FOR FOREX                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1009    BEGSR
     C***
     C                     Z-ADD0         WWFOXL 150
     C**                   Z-ADD0         WWFOX1 150                      R0151
     C                     Z-ADD0         WWOPFX 150
     C                     Z-ADD0         WWAVFX 150
     C                     Z-ADD0         WWMARG 150
     C                     Z-ADD0         DDMPFX                          SA9109
     C                     Z-ADD0         WWUNPL 150
     C                     Z-ADD0         WWREPL 150
     C/COPY WNCPYSRC,PM0630C002
     C**
     C** CALCULATE THE FOREX LIMIT AMOUNT USING #P1010
     C**
     C                     EXSR #P1010
     C** DIVIDE THE FX MARGIN % BY 100 TO GET A FACTOR
     C**         LBFXCP    DIV  100       WWFXCP  32                      R0151
     C**         WWFXCP    MULT WWFOXL    WWMARG                          R0151
     C**                                                                  R0151
     C** ACCESS LBEXTRL3 WITH CUSTOMER NUMBER AND MARGIN                  R0151
     C                     MOVELLBFXMA    WWFXUP                          R0151
     C**********           Z-ADDLBFORX    DDMPFX                   SA9109 S01486
     C                     Z-ADDCUFORX    DDMPFX                          S01486
     C           LBEXTR    CHAINLBEXTRL3             73                   R0151
     C** IF RECORD NOT FOUND OR UNREALISED PROFIT EQUAL TO ZERO           R0151
     C** SET UNREALISED PROFIT TO ZERO                                    R0151
     C           *IN73     IFEQ '1'                                       R0151
     C                     Z-ADD0         WWMARG 150                      R0151
     C                     Z-ADD0         WWOPFX 150                      R0171
     C                     ELSE                                           R0151
     C*                    Z-ADDEEEXPS    WWMARG                   R0151  B7862
     C                     Z-ADDEEMARG    WWMARG                          B7862
     C                     Z-ADDEEEXPO    WWOPFX                          R0171
     C**                                                                  R0151
     C********** QMCSBY    IFNE LBCCY                                R0151S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C** CONVERT AVAILABLE BORROWING POWER                                R0151
     C                     Z-ADDWWMARG    ZAMTF                           R0151
     C**********           MOVELLBCCY     ZCCYF                      R0151S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT                           R0151
     C                     Z-ADDW1SPRT    ZRATEF                          R0151
     C                     Z-ADDW2SPRT    ZRATET                          R0151
     C                     MOVELW1MDIN    ZMDINF                          R0151
     C                     MOVELW2MDIN    ZMDINT                          R0151
     C                     Z-ADDW1NBDP    ZCDPF                           R0151
     C                     Z-ADDW2NBDP    ZCDPT                           R0151
     C                     EXSR ZCCYCN                                    R0151
     C                     Z-ADDZAMTT     WWMARG                          R0151
     C**                                                                  R0151
     C** CONVERT OPEN FOREX                                               R0171
     C                     Z-ADDWWOPFX    ZAMTF                           R0171
     C**********           MOVELLBCCY     ZCCYF                      R0171S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT                           R0171
     C                     Z-ADDW1SPRT    ZRATEF                          R0171
     C                     Z-ADDW2SPRT    ZRATET                          R0171
     C                     MOVELW1MDIN    ZMDINF                          R0171
     C                     MOVELW2MDIN    ZMDINT                          R0171
     C                     Z-ADDW1NBDP    ZCDPF                           R0171
     C                     Z-ADDW2NBDP    ZCDPT                           R0171
     C                     EXSR ZCCYCN                                    R0171
     C                     Z-ADDZAMTT     WWOPFX                          R0171
     C**                                                                  R0171
     C                     END                                            R0151
     C                     END                                            R0151
     C** ACCESS LBEXTRL3 WITH CUSTOMER NUMBER AND FX UNREALISED
     C** PROFIT
     C                     MOVELLBFXUP    WWFXUP
     C           LBEXTR    CHAINLBEXTRL3             73
     C** IF RECORD NOT FOUND OR UNREALISED PROFIT EQUAL TO ZERO
     C** SET UNREALISED PROFIT TO ZERO
     C           *IN73     IFEQ '1'
     C                     Z-ADD0         WWPRFL 150
     C                     ELSE
     C******************** Z-ADDEEEXPS    WWPRFL                          R0981
     C                     Z-ADDEECOLL    WWPRFL                          R0981
     C/COPY WNCPYSRC,PM0630C003
     C                     END
     C** ACCESS LBEXTRL3 WITH CUSTOMER NUMBER AND FX UNREALISED
     C** LOSS
     C                     MOVELLBFXUL    WWFXUP
     C           LBEXTR    CHAINLBEXTRL3             73
     C** IF RECORD NOT FOUND OR UNREALISED PROFIT EQUAL TO ZERO
     C** SET UNREALISED PROFIT TO ZERO
     C           *IN73     IFEQ '1'
     C                     Z-ADD0         WWLOSL 150
     C                     ELSE
     C                     Z-ADDEEEXPS    WWLOSL
     C/COPY WNCPYSRC,PM0630C004
     C                     END
     C**
     C** SET THE UNREALISED P/L TO UNREALISED PROFIT MINUS
     C** UNREALISED LOSS
     C           WWPRFL    SUB  WWLOSL    WWUNPL
     C** CUSTOMER CURRENCY <> LOMBARD CURRENCY
     C********** QMCSBY    IFNE LBCCY                                     S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C** CONVERT AVAILABLE BORROWING POWER
     C                     Z-ADDWWUNPL    ZAMTF
     C**********           MOVELLBCCY     ZCCYF                           S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT
     C                     Z-ADDW1SPRT    ZRATEF
     C                     Z-ADDW2SPRT    ZRATET
     C                     MOVELW1MDIN    ZMDINF
     C                     MOVELW2MDIN    ZMDINT
     C                     Z-ADDW1NBDP    ZCDPF
     C                     Z-ADDW2NBDP    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWUNPL
     C/COPY WNCPYSRC,PM0630C005
     C**
     C                     END
     C** ACCESS LBEXTRL0 WITH CUSTOMER NUMBER AND FX CLOSED P/L
     C                     MOVELLBFXPL    WWFXUP
     C           LBEXTR    CHAINLBEXTRL3             73
     C** IF RECORD NOT FOUND OR UNREALISED PROFIT EQUAL TO ZERO
     C** SET UNREALISED PROFIT TO ZERO
     C           *IN73     IFEQ '1'
     C                     Z-ADD0         WWREPL 150
     C*                                                                   R0981
     C** DON'T DISPLAY CLOSED FOREX P/L                                   R0981
     C                     MOVE '1'       *IN58                           R0981
     C                     ELSE
     C**         EEEXPS    IFNE 0                                   R0151 B07898
     C**                   Z-ADDEEEXPS    WWREPL                          R0151
     C**                   Z-SUBEEEXPS    WWREPL                    R0151 B07898
     C**                   ELSE                                     R0151 B07898
     C**                   Z-ADDEECOLL    WWREPL                    R0151 B07898
     C**                   END                                      R0151 B07898
     C           EECOLL    SUB  EEEXPS    WWREPL                          B07898
     C                     END
     C*
     C** IF CUSTOMER CURRENCY NOT EQUAL TO LOMBARD CURRENCY CONVERT
     C** AMOUNT TO CUSTOMER BASE CURRENCY
     C********** QMCSBY    IFNE LBCCY                                     S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C           WWREPL    ANDNE0                                         R0151
     C                     Z-ADDWWREPL    ZAMTF
     C**********           MOVELLBCCY     ZCCYF                           S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT
     C                     Z-ADDW1SPRT    ZRATEF
     C                     Z-ADDW2SPRT    ZRATET
     C                     MOVELW1MDIN    ZMDINF
     C                     MOVELW2MDIN    ZMDINT
     C                     Z-ADDW1NBDP    ZCDPF
     C                     Z-ADDW2NBDP    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWREPL
     C**
     C                     END
     C*                                                                   R5504
     C** CALCULATE FX AVAILABILITY                                        R5504
     C*                                                                   R5702
     C*  AVAILABLE = 0 IF LIMITS USED BUT NONE ENTERED FOR CLIENT         R5702
     C           *IN72     IFEQ '1'                                       R5702
     C           LBLIFX    ANDNE'   '                                     R5702
     C                     Z-ADD*ZERO     WWAVFX                          R5702
     C                     ELSE                                           R5702
     C*                                                                   R5702
     C           LBMGLE    IFEQ 'E'                                       R5504
     C**                                                                  R5504
     C** IF A LIMIT HAS BEEN ENTERED                                      R5504
     C           WWLIMF    IFEQ 'Y'                                       R5504
     C**                                                                  R5504
     C           WWOPFX    IFGT WWFOXL                                    R5504
     C                     Z-ADD*ZERO     WWAVFX                          R5504
     C                     ELSE                                           R5504
     C**                                                                  R5504
     C           LBFXCP    IFEQ *ZERO                                     R5504
     C                     Z-ADD*ZERO     WWAVFX                          R5504
     C                     ELSE                                           R5504
     C           WWAVBR    MULT 100       WWAVFX                          R5504
     C                     DIV  LBFXCP    WWAVFX                          R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C**         WWAVFX    IFGT WWFOXL                               R5504R5735
     C**         WWFOXL    SUB  WWOPFX    WWAVFX                     R5504R5735
     C**                   END                                       R5504R5735
     C** AVAIL FX CANNOT BE > LIMIT - EXPOSURE                            R5735
     C           WWFOXL    SUB  WWOPFX    WWAVF1 150                      R5735
     C           WWAVF1    IFLT WWAVFX                                    R5735
     C                     Z-ADDWWAVF1    WWAVFX                          R5735
     C                     END                                            R5735
     C**                                                                  R5504
     C                     END                                            R5504
     C                     ELSE                                           R5504
     C**                                                                  R5504
     C** IF NO LIMIT HAS BEEN ENTERED                                     R5504
     C           LBFXCP    IFEQ *ZERO                                     R5504
     C                     Z-ADD*ZERO     WWAVFX                          R5504
     C                     ELSE                                           R5504
     C           WWAVBR    MULT 100       WWAVFX                          R5504
     C                     DIV  LBFXCP    WWAVFX                          R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C           LBMGLE    IFEQ 'L'                                       R5504
     C           WWFOXL    SUB  WWOPFX    WWAVFX                          R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C           WWAVFX    IFLT *ZERO                                     R5504
     C                     Z-ADD*ZERO     WWAVFX                          R5504
     C                     END                                            R5504
     C                     END                                            R5702
     C**                                                                  R5504
     C                     EXSR #U1004
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
     C           #P1010    BEGSR
     C**
     C** SET LOWER LIMITS ON LF/LIMILBL2 USING CUSTOMER NUMBER
     C**
     C**         QMCNUM    SETLLLIMILBL2                                  R0151
     C** DO WHILE SAME CUSTOMER OR DATE LOWER OR EQUAL RUN DATE
     C**         QMCNUM    DOUNECNUM                                      R0151
     C**         RECI      OREQ 'D'                                       R0151
     C**         FLED      ANDGEQMRDNB                                    R0151
     C**
     C**                   READ LIMILBL2                 72               R0151
     C**                   END                                            R0151
     C**
     C**         QMCNUM    IFEQ CNUM                                      R0151
     C**         *IN72     ANDEQ'0'                                       R0151
     C**
     C** ACCESS SDLIMTL0 WITH FX LIMIT TYPE
     C**
     C**                   MOVE FLTY      WWFLTY  3                       R0151
     C**         WWFLTY    CHAINSDLIMTL0             73                   R0151
     C**
     C**         *IN73     IFEQ '1'                                       R0151
     C**                   MOVEL'Y'       QMDBER                          R0151
     C**                   MOVEL'Y'       QMENQT                          R0151
     C**                   MOVE 'SDLIMTL0'QMFILE                          R0151
     C**                   MOVE 'PM0630'  QMPGM                           R0151
     C**                   MOVE FLTY      QMKEY            ***************R0151
     C**                   Z-ADD7         QMERRN           **DB ERROR 07**R0151
     C**                                                   ***************
     C** UPDATE GDA
     C**
     C**                   CALL 'PMC1002'                                 R0151
     C**                   PARM           WWGDA                           R0151
     C**
     C** CALL PMC1020 TO TERMINATE GROUP JOB
     C**
     C**
     C**                   CALL 'PMC1020'                                 R0151
     C**
     C**                   END                                            R0151
     C*
     C** DIVIDE % LIMIT FOR FIRST PERIOD BY 100 TO GET LIMIT FACTOR
     C********** A2PL1P ** DIV  100       WWFACT  32                      R0981
     C** MULTIPLY LIMIT AMOUNT BY 1000 TO OBTAIN LIMIT AMOUNT IN UNITS
     C**                                                                  R0151
     C**                                                                  R0151
     C                     MOVE 'N'       WWLIMF  1                       R5504
     C********** QMCNUM    CHAINLIMILBL2             72             R0151 S01486
     C*                                                                   R0151
     C********** *IN72     IFEQ '0'                                 R0151 S01486
     C                     MOVELQMCNUM    @CUSN                           S01486
     C                     CALL 'AOCLLMR0'                                S01486
     C                     PARM '       ' @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @CUSN   6                       S01486
     C                     PARM 'S'       @LEVL   1                       S01486
     C                     PARM 'SYS'     @BCCD   3                       S01486
     C           SDCLLM    PARM SDCLLM    DSFDY                           S01486
     C           @RTCD     IFEQ *BLANK                                    S01486
     C*                                                                   R5504
     C                     MOVE 'Y'       WWLIMF                          R5504
      *                                                                   B8289
      ** NO LIMIT IF THE EXPIRY DATE IS BEFORE THE RUN DATE               B8289
     C********** FLED      IFLT QMRDNB                              B8289 S01486
     C           DZFLED    IFLT QMRDNB                                    S01486
     C**********           Z-ADD0         FAMM                      B8289 S01486
     C           S01433    IFEQ 'Y'                                       087631
     C                     Z-ADD0         DZFXFA                          S01486
     C                     ELSE                                           087631
     C                     Z-ADD0         DZFLAM                          087631
     C                     END                                            087631
     C                     END                                            B8289
     C*                                                                   R0151
     C**         FLAM      MULT 1000      WWFLAM 150                      R0151
     C***********FLAM      MULT 1000      WWFOXL 150                R0151 R0170
     C********** FAMM      MULT 1000      WWFOXL 150                R0170 S01486
     C           S01433    IFEQ 'Y'                                       087631
     C           DZFXFA    MULT 1000      WWFOXL 150                      S01486
     C                     ELSE                                           087631
     C           DZFLAM    MULT 1000      WWFOXL 150                      087631
     C                     END                                            087631
     C** MULTIPLY LIMIT AMOUNT BY FACTOR
     C********** WWFLAM ** MULT WWFACT    WWFOXL                          R0981
     C**         WWFLAM    MULT A2PL1P    WWFOXL                     R0981R0151
     C           W3NBDP    IFNE 0                                         089251
     C           8         SUB  W3NBDP    A       10                      R0177
     C                     ELSE                                           089251
     C                     Z-ADD1         A                               089251
     C                     END                                            089251
     C           WWFOXL    MULT POWER,A   WWFOXL                          R0177
     C**                   Z-ADDWWFOXL    WWFOX1                          R0151
     C*
     C** FOREX LIMIT IS IN UNITS OF BASE CURRENCY. HENCE BASE CURRECNY
     C** DECIMAL PLACES FOR CONVERSION SHOULD BE ZERO
     C           QMCYCD    IFNE QMCSBY
     C           WWFOXL    ANDNE0                                         R0151
     C** CONVERT AVAILABLE BORROWING POWER
     C                     Z-ADDWWFOXL    ZAMTF
     C                     MOVELQMCYCD    ZCCYF
     C                     MOVELQMCSBY    ZCCYT
     C                     Z-ADDW3SPRT    ZRATEF
     C                     Z-ADDW2SPRT    ZRATET
     C                     MOVELW3MDIN    ZMDINF
     C                     MOVELW2MDIN    ZMDINT
     C*******              Z-ADD0         ZCDPF                           B5859
     C                     Z-ADDW3NBDP    ZCDPF                           B5859
     C                     Z-ADDW2NBDP    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWFOXL
     C**
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************R0981
      *                                                                  *R0981
      * #P1011   - PRECIOUS METAL DETAILS                                *R0981
      *                                                                  *R0981
      * SUBROUTINE CALLS:                                                *R0981
      * #P1012   - CALCULATE LIMIT FOR PRECIOUS METAL                    *R0981
      *                                                                  *R0981
      * SUBROUTINE CALLED FROM:                                          *R0981
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *R0981
      *                                                                  *R0981
      * ROUTINE USES VARIABLES:                                          *R0981
      *                                                                  *R0981
      ********************************************************************R0981
     C           #P1011    BEGSR                                          R0981
     C*                                                                   R0981
     C                     Z-ADD0         WWFOXL                          R0151
     C                     Z-ADD0         WWOPFX                          R0981
     C                     Z-ADD0         WWAVFX                          R0981
     C                     Z-ADD0         WWMARG                          R0981
     C                     Z-ADD0         DDMPPM                          SA9109
     C                     Z-ADD0         WWUNPL                          R0981
     C                     Z-ADD0         WWREPL                          R0981
     C/COPY WNCPYSRC,PM0630C006
     C*                                                                   R0981
     C** ACCESS PF/LIMITBX0 USING CUSTOMER NUMBER                         R0981
     C**         QMCNUM    CHAINLIMITBX0             80              R0981R0177
     C                     MOVE 'N'       WWLIMP  1                       R5504
     C********** QMCNUM    CHAINLIMITBX0             99             R0177 S01486
     C**********                                                    R0981 S01486
     C**         *IN80     IFEQ '0'                                  R0981R0981
     C********** *IN99     IFEQ '0'                                 R0981 S01486
     C                     MOVELQMCNUM    @CUSN                           S01486
     C                     CALL 'AOCLLMR0'                                S01486
     C                     PARM '       ' @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @CUSN   6                       S01486
     C                     PARM 'S'       @LEVL   1                       S01486
     C                     PARM 'SYS'     @BCCD   3                       S01486
     C           SDCLLM    PARM SDCLLM    DSFDY                           S01486
     C           @RTCD     IFEQ *BLANK                                    S01486
     C*                                                                   R0981
     C                     MOVE 'Y'       WWLIMP                          R5504
     C** CALCULATE LIMIT                                                  R0981
     C                     EXSR #P1012                                    R0981
     C                     ELSE                                           R0151
     C                     Z-ADD0         WWFOXL                          R0151
     C                     END                                            R0151
     C*                                                                   R0981
     C** DIVIDE THE FX MARGIN % BY 100 TO GET A FACTOR                    R0981
     C**         LBPMCP    DIV  100       WWFXCP                     R0981R0151
     C**         WWFXCP    MULT WWFOXL    WWMARG                     R0981R0151
     C**                                                                  R0151
     C** ACCESS LBEXTRL3 WITH CUSTOMER NUMBER AND MARGIN                  R0151
     C                     MOVELLBPMMA    WWFXUP                          R0151
     C**********           Z-ADDLBFORP    DDMPPM                   SA9109 S01486
     C                     Z-ADDCUFORP    DDMPPM                          S01486
     C           LBEXTR    CHAINLBEXTRL3             73                   R0151
     C** IF RECORD NOT FOUND OR UNREALISED PROFIT EQUAL TO ZERO           R0151
     C** SET UNREALISED PROFIT TO ZERO                                    R0151
     C           *IN73     IFEQ '1'                                       R0151
     C                     Z-ADD0         WWMARG 150                      R0151
     C                     Z-ADD0         WWOPFX                          R0171
     C                     ELSE                                           R0151
     C*                    Z-ADDEEEXPS    WWMARG                   R0151  B7862
     C                     Z-ADDEEMARG    WWMARG                          B7862
     C                     Z-ADDEEEXPO    WWOPFX                          R0171
     C**                                                                  R0151
     C********** QMCSBY    IFNE LBCCY                                R0151S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C** CONVERT AVAILABLE BORROWING POWER                                R0151
     C                     Z-ADDWWMARG    ZAMTF                           R0151
     C**********           MOVELLBCCY     ZCCYF                      R0151S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT                           R0151
     C                     Z-ADDW1SPRT    ZRATEF                          R0151
     C                     Z-ADDW2SPRT    ZRATET                          R0151
     C                     MOVELW1MDIN    ZMDINF                          R0151
     C                     MOVELW2MDIN    ZMDINT                          R0151
     C                     Z-ADDW1NBDP    ZCDPF                           R0151
     C                     Z-ADDW2NBDP    ZCDPT                           R0151
     C                     EXSR ZCCYCN                                    R0151
     C                     Z-ADDZAMTT     WWMARG                          R0151
     C**                                                                  R0151
     C** CONVERT OPEN FOREX                                               R0171
     C                     Z-ADDWWOPFX    ZAMTF                           R0171
     C**********           MOVELLBCCY     ZCCYF                      R0171S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT                           R0171
     C                     Z-ADDW1SPRT    ZRATEF                          R0171
     C                     Z-ADDW2SPRT    ZRATET                          R0171
     C                     MOVELW1MDIN    ZMDINF                          R0171
     C                     MOVELW2MDIN    ZMDINT                          R0171
     C                     Z-ADDW1NBDP    ZCDPF                           R0171
     C                     Z-ADDW2NBDP    ZCDPT                           R0171
     C                     EXSR ZCCYCN                                    R0171
     C                     Z-ADDZAMTT     WWOPFX                          R0171
     C**                                                                  R0171
     C                     END                                            R0151
     C                     END                                            R0151
     C*                                                                   R0981
     C** ACCESS LBEXTRL3 WITH CUSTOMER NUMBER AND FX UNREALISED PROFIT    R0981
     C                     Z-ADD0         WWPRFL                          R0151
     C                     Z-ADD0         WWLOSL                          R0151
     C                     MOVELLBPMUP    WWFXUP                          R0981
     C           LBEXTR    CHAINLBEXTRL3             73                   R0981
     C*                                                                   R0981
     C** IF RECORD NOT FOUND OR UNREALISED PROFIT EQUAL TO ZERO           R0981
     C** SET UNREALISED PROFIT TO ZERO                                    R0981
     C           *IN73     IFEQ '1'                                       R0981
     C                     Z-ADD0         WWPRFL 150                      R0981
     C                     ELSE                                           R0981
     C                     Z-ADDEECOLL    WWPRFL                          R0981
     C/COPY WNCPYSRC,PM0630C007
     C                     END                                            R0981
     C*                                                                   R0981
     C** ACCESS LBEXTRL3 WITH CUSTOMER NUMBER AND FX UNREALISED LOSS      R0981
     C                     MOVELLBPMUL    WWFXUP                          R0981
     C           LBEXTR    CHAINLBEXTRL3             73                   R0981
     C*                                                                   R0981
     C** IF RECORD NOT FOUND OR UNREALISED PROFIT EQUAL TO ZERO           R0981
     C** SET UNREALISED PROFIT TO ZERO                                    R0981
     C           *IN73     IFEQ '1'                                       R0981
     C                     Z-ADD0         WWLOSL 150                      R0981
     C                     ELSE                                           R0981
     C                     Z-ADDEEEXPS    WWLOSL                          R0981
     C                     END                                            R0981
     C*                                                                   R0981
     C** SET THE UNREALISED P/L TO UNREALISED PROFIT MINUS                R0981
     C** UNREALISED LOSS                                                  R0981
     C           WWPRFL    SUB  WWLOSL    WWUNPL                          R0981
     C/COPY WNCPYSRC,PM0630C008
     C*                                                                   R0981
     C** CUSTOMER CURRENCY <> LOMBARD CURRENCY                            R0981
     C********** QMCSBY    IFNE LBCCY                                R0981S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C           WWUNPL    ANDNE0                                         R0151
     C*                                                                   R0981
     C** CONVERT AVAILABLE BORROWING POWER                                R0981
     C                     Z-ADDWWUNPL    ZAMTF                           R0981
     C**********           MOVELLBCCY     ZCCYF                      R0981S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT                           R0981
     C                     Z-ADDW1SPRT    ZRATEF                          R0981
     C                     Z-ADDW2SPRT    ZRATET                          R0981
     C                     MOVELW1MDIN    ZMDINF                          R0981
     C                     MOVELW2MDIN    ZMDINT                          R0981
     C                     Z-ADDW1NBDP    ZCDPF                           R0981
     C                     Z-ADDW2NBDP    ZCDPT                           R0981
     C                     EXSR ZCCYCN                                    R0981
     C                     Z-ADDZAMTT     WWUNPL                          R0981
     C/COPY WNCPYSRC,PM0630C009
     C                     END                                            R0981
     C*                                                                   R0981
     C** ACCESS LBEXTRL0 WITH CUSTOMER NUMBER AND FX CLOSED P/L           R0981
     C                     MOVELLBPMPL    WWFXUP                          R0981
     C           LBEXTR    CHAINLBEXTRL3             73                   R0981
     C*                                                                   R0981
     C** IF RECORD NOT FOUND OR UNREALISED PROFIT EQUAL TO ZERO           R0981
     C** SET UNREALISED PROFIT TO ZERO                                    R0981
     C           *IN73     IFEQ '1'                                       R0981
     C                     Z-ADD0         WWREPL 150                      R0981
     C*                                                                   R0981
     C** DON'T DISPLAY CLOSED FORPM P/L                                   R0981
     C                     MOVE '1'       *IN59                           R0981
     C                     ELSE                                           R0981
     C**         EEEXPS    IFNE 0                                   R0151 B07898
     C**                   Z-SUBEEEXPS    WWREPL                    R0151 B07898
     C*                    Z-ADDEEEXPS    WWREPL                     R0981R0151
     C**                   ELSE                                     R0151 B07898
     C**                   Z-ADDEECOLL    WWREPL                    R0151 B07898
     C**                   END                                      R0151 B07898
     C           EECOLL    SUB  EEEXPS    WWREPL                          B07898
     C                     END                                            R0981
     C*                                                                   R0981
     C** IF CUSTOMER CURRENCY NOT EQUAL TO LOMBARD CURRENCY CONVERT       R0981
     C** AMOUNT TO CUSTOMER BASE CURRENCY                                 R0981
     C********** QMCSBY    IFNE LBCCY                                R0981S01486
     C           QMCSBY    IFNE LBCYCD                                    S01486
     C           WWREPL    ANDNE0                                         R0151
     C                     Z-ADDWWREPL    ZAMTF                           R0981
     C**********           MOVELLBCCY     ZCCYF                      R0981S01486
     C                     MOVELLBCYCD    ZCCYF                           S01486
     C                     MOVELQMCSBY    ZCCYT                           R0981
     C                     Z-ADDW1SPRT    ZRATEF                          R0981
     C                     Z-ADDW2SPRT    ZRATET                          R0981
     C                     MOVELW1MDIN    ZMDINF                          R0981
     C                     MOVELW2MDIN    ZMDINT                          R0981
     C                     Z-ADDW1NBDP    ZCDPF                           R0981
     C                     Z-ADDW2NBDP    ZCDPT                           R0981
     C                     EXSR ZCCYCN                                    R0981
     C                     Z-ADDZAMTT     WWREPL                          R0981
     C                     END                                            R0981
     C*                                                                   R5504
     C** CALCULATE PM AVAILABILITY                                        R5504
     C*                                                                   R5702
     C*  AVAILABLE = 0 IF LIMITS USED BUT NONE ENTERED FOR CLIENT         R5702
     C           WWLIMP    IFEQ 'N'                                       R5702
     C           LBLIPM    ANDNE'   '                                     R5702
     C                     Z-ADD*ZERO     WWAVFX                          R5702
     C                     ELSE                                           R5702
     C*                                                                   R5702
     C           LBMGLE    IFEQ 'E'                                       R5504
     C**                                                                  R5504
     C** IF A LIMIT HAS BEEN ENTERED                                      R5504
     C           WWLIMP    IFEQ 'Y'                                       R5504
     C**                                                                  R5504
     C           WWOPFX    IFGT WWFOXL                                    R5504
     C                     Z-ADD*ZERO     WWAVFX                          R5504
     C                     ELSE                                           R5504
     C**                                                                  R5504
     C           LBPMCP    IFEQ *ZERO                                     R5504
     C                     Z-ADD*ZERO     WWAVFX                          R5504
     C                     ELSE                                           R5504
     C           WWAVBR    MULT 100       WWAVFX                          R5504
     C                     DIV  LBPMCP    WWAVFX                          R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C**         WWAVFX    IFGT WWFOXL                               R5504R5735
     C**         WWFOXL    SUB  WWOPFX    WWAVFX                     R5504R5735
     C**                   END                                       R5504R5735
     C** AVAIL FX CANNOT BE > LIMIT - EXPOSURE                            R5735
     C           WWFOXL    SUB  WWOPFX    WWAVF1 150                      R5735
     C           WWAVF1    IFLT WWAVFX                                    R5735
     C                     Z-ADDWWAVF1    WWAVFX                          R5735
     C                     END                                            R5735
     C**                                                                  R5504
     C                     END                                            R5504
     C                     ELSE                                           R5504
     C**                                                                  R5504
     C** IF NO LIMIT HAS BEEN ENTERED                                     R5504
     C           LBPMCP    IFEQ *ZERO                                     R5504
     C                     Z-ADD*ZERO     WWAVFX                          R5504
     C                     ELSE                                           R5504
     C           WWAVBR    MULT 100       WWAVFX                          R5504
     C                     DIV  LBPMCP    WWAVFX                          R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C           LBMGLE    IFEQ 'L'                                       R5504
     C           WWFOXL    SUB  WWOPFX    WWAVFX                          R5504
     C                     END                                            R5504
     C**                                                                  R5504
     C           WWAVFX    IFLT *ZERO                                     R5504
     C                     Z-ADD*ZERO     WWAVFX                          R5504
     C                     END                                            R5504
     C                     END                                            R5702
     C**                                                                  R5504
     C                     EXSR #U1005                                    R0981
     C**                   END                                       R0981R0151
     C**                                                                  R0981
     C                     ENDSR                                          R0981
      ********************************************************************R0981
      /EJECT                                                              R0981
      ********************************************************************R0981
      *                                                                  *R0981
      * #P1012   - CALCULATE LIMIT FOR PRECIOUS METAL                    *R0981
      *                                                                  *R0981
      * SUBROUTINE CALLS:                                                *R0981
      *                                                                  *R0981
      * SUBROUTINE CALLED FROM:                                          *R0981
      * #P1011   - PRECIOUS METAL DETAILS                                *R0981
      *                                                                  *R0981
      * ROUTINE USES VARIABLES:                                          *R0981
      *                                                                  *R0981
      ********************************************************************R0981
     C           #P1012    BEGSR                                          R0981
      *                                                                   B8289
      ** NO LIMIT IF THE EXPIRY DATE IS BEFORE THE RUN DATE               B8289
     C********** LIPLED    IFLT QMRDNB                              B8289 S01486
     C           DZPLED    IFLT QMRDNB                                    S01486
     C**********           Z-ADD0         LIPSAM                    B8289 S01486
     C                     Z-ADD0         DZPSAM                          S01486
     C                     END                                            B8289
     C*                                                                   R0981
     C** MULTIPLY LIMIT AMOUNT BY 1000 TO OBTAIN LIMIT AMOUNT IN UNITS    R0981
     C**         LIPFAM    MULT 1000      WWFLAM 150                 R0981R0151
     C***********LIPFAM    MULT 1000      WWFOXL 150           0981 R0151 R0170
     C********** LIPSAM    MULT 1000      WWFOXL 150                R0170 S01486
     C           DZPSAM    MULT 1000      WWFOXL 150                      S01486
     C*                                                                   R0981
     C** MULTIPLY LIMIT AMOUNT BY FACTOR                                  R0981
     C**         WWFLAM    MULT A2PL1P    WWFOXL                     R0981R0151
     C           W3NBDP    IFNE 0                                         089251
     C           8         SUB  W3NBDP    A       10                      R0177
     C                     ELSE                                           089251
     C                     Z-ADD1         A                               089251
     C                     END                                            089251
     C           WWFOXL    MULT POWER,A   WWFOXL                          R0177
     C*                                                                   R0981
     C** METAL LIMIT IS IN UNITS OF BASE CURRENCY. HENCE BASE CURRECNY    R0981
     C** DECIMAL PLACES FOR CONVERSION SHOULD BE ZERO                     R0981
     C           QMCYCD    IFNE QMCSBY                                    R0981
     C           WWFOXL    ANDNE0                                         R0151
     C*                                                                   R0981
     C** CONVERT AVAILABLE BORROWING POWER                                R0981
     C                     Z-ADDWWFOXL    ZAMTF                           R0981
     C                     MOVELQMCYCD    ZCCYF                           R0981
     C                     MOVELQMCSBY    ZCCYT                           R0981
     C                     Z-ADDW3SPRT    ZRATEF                          R0981
     C                     Z-ADDW2SPRT    ZRATET                          R0981
     C                     MOVELW3MDIN    ZMDINF                          R0981
     C                     MOVELW2MDIN    ZMDINT                          R0981
     C**********           Z-ADD0         ZCDPF                     R0981 B08124
     C                     Z-ADDW3NBDP    ZCDPF                           B08124
     C                     Z-ADDW2NBDP    ZCDPT                           R0981
     C                     EXSR ZCCYCN                                    R0981
     C                     Z-ADDZAMTT     WWFOXL                          R0981
     C                     END                                            R0981
     C*                                                                   R0981
     C                     ENDSR                                          R0981
      ********************************************************************R0981
      /EJECT                                                              R0981
      ********************************************************************
      *                                                                  *
      * #P1015   - FILL HEADER DETAILS AND SEND SUBFILE                  *
      *                                                                  *
      * SUBROUTINE CALLS: #U1001                                         *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1015    BEGSR
     C**
     C                     EXSR #U1001
     C                     WRITEPM0630F1
     C**
     C           *IN89     IFEQ '0'
     C                     WRITEPM0630C2
     C                     ELSE
     C                     WRITEPM0630C1
     C                     END
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #U1001   - DISPLAY CUSTOMER DETAILS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #U1001    BEGSR
     C**
     C** LOAD FIELDS OF HEADER FORMAT
     C**
     C                     MOVELQMCNUM    DDCNUM
     C                     MOVELQMCRNM    DDCRNM
     C                     MOVELQMCSBY    DDCSBY
     C***********          MOVELQMNCTX    DDNCTX                          CPM005
     C***********          MOVELQMDCTX    DDDCTX                          CPM005
     C***********          MOVELQMLANG    DDLANG                          CPM005
     C***********          MOVEL'GB'      DDLANG                   CPM005 131150
     C** Access Customer Correspondance info for language code            131150
     C           DDCNUM    CHAINCGCORRL4             70                   131150
     C           *IN70     IFEQ '0'                                       131150
     C                     MOVE CDLGID    DDLANG                          131150
     C                     ELSE                                           131150
     C                     MOVE 'XX'      DDLANG                          131150
     C                     END                                            131150
     C**                                                                  131150
     C                     MOVELQMACOC    DDACOC
     C*                                                                   CPM005
     C* ACCESS FILE SDCUSTPD TO RETRIEVE CUSTOMER DETAILS                 CPM005
     C*                                                                   CPM005
     C                     MOVELQMCNUM    PLCUS                           CPM005
     C***********          CALL 'AOCUSTR0'                         CPM005 CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM *BLANKS   PRTCD                           CPM005
     C                     PARM '*KEY'    POPTN                           CPM005
     C                     PARM           PLCUS                           CPM005
     C                     PARM           KEYST   7                       CPM005
     C***********SDCUST    PARM SDCUST    DSSDY                    CPM005 CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
      *                                                                   CSD007
      ** If CSD007 is on, allow processing of a closed record (return     CSD007
      ** code '*NRF' and date deleted equal to zero).                     CSD007
      *                                                                   CSD007
     C           CSD007    IFEQ 'Y'                                       CSD007
     C           PRTCD     ANDEQ'*NRF'                                    CSD007
     C           BBDTDL    ANDEQ*ZERO                                     CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
      *                                                                   CSD007
     C           PRTCD     IFNE *BLANKS                    B1             CPM005
     C                     MOVEL'Y'       QMDBER                          CPM005
     C                     MOVEL'Y'       QMENQT           ***************CPM005
     C                     Z-ADD4         QMERRN           **DB ERROR 04**CPM005
     C                     MOVE 'SDCUSTPD'QMFILE           ***************CPM005
     C                     MOVE 'PM0630'  QMPGM                           CPM005
     C                     MOVE QMCNUM    QMKEY                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     RETRN                                          CPM005
     C                     END                             E1             CPM005
      *                                                                   CSD007
     C                     ENDIF                                          CSD007
     C*                                                                   CPM005
     C                     MOVELBBCNCZ    DDNCTX                          CPM005
     C**
     C** CONVERT DATES
     C**
     C*********            MOVELQMDTA1    DDDAS1                          R10038
     C**
     C**                                                                  166009
     C           QMBDA1    IFEQ *BLANKS                    *IF            166009
     C                     MOVEL*BLANKS   DDBDA1           Date of Birth  166009
     C                     ELSE                                           166009
     C                     MOVELQMBDA1    DDBDA1
     C                     END                             *FI            166009
     C**
     C*********            MOVELQMSAFI    DDSAFI                          R10038
     C                     MOVELQMDCMS    DDDCMS
     C*                                                                   CPM005
     C           QMDCMS    IFEQ 'I'                                       CPM005
     C                     MOVE '1'       *IN22                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN22                           CPM005
     C                     END                                            CPM005
     C*                                                                   CPM005
     C***********          MOVELQMFPVC    DDFPVC                          B9383
     C                     MOVELQMCSSN    DDCSSN                          R10038
     C                     MOVELQMCRTN    DDCRTN                          R10038
     C***********          MOVELQMACON    DDACON                    R10038CPM005
     C*                                                                   CPM005
     C*  SETUP THE 'CONTACT STATUS'                                       CPM005
     C*                                                                   CPM005
     C           QMJAID    IFEQ 'N'                        B1             CPM005
     C           QMPAID    ANDEQ'N'                                       CPM005
     C                     MOVE 'Y'       DDACHO                          CPM005
     C                     MOVE 'Y'       DDPOWA                          CPM005
     C                     MOVE 'I'       DDSIGN                          CPM005
     C                     MOVE 'Y'       DDVECO                          CPM005
     C                     MOVE 'Y'       DDWRCO                          CPM005
     C                     MOVE 'Y'       DDDOCO                          CPM005
     C                     MOVEL*BLANKS   DDUSID                          CPM005
     C                     ELSE                            X1             CPM005
     C           QMACHD    IFEQ *BLANKS                    B2             CPM005
     C           QMPATT    ANDEQ*BLANKS                                   CPM005
     C           QMSIGN    ANDEQ*BLANKS                                   CPM005
     C           QMCVER    ANDEQ*BLANKS                                   CPM005
     C           QMWRIT    ANDEQ*BLANKS                                   CPM005
     C                     MOVE '?'       DDACHO                          CPM005
     C                     MOVE '?'       DDPOWA                          CPM005
     C                     MOVE '?'       DDSIGN                          CPM005
     C                     MOVE '?'       DDVECO                          CPM005
     C                     MOVE '?'       DDWRCO                          CPM005
     C                     MOVE '?'       DDDOCO                          CPM005
     C                     MOVEL*BLANKS   DDUSID                          CPM005
     C                     MOVEL'?'       DDUSID                          CPM005
     C                     ELSE                            X2             CPM005
     C                     MOVE QMACHD    DDACHO                          CPM005
     C                     MOVE QMPATT    DDPOWA                          CPM005
     C                     MOVE QMSIGN    DDSIGN                          CPM005
     C                     MOVE QMCVER    DDVECO                          CPM005
     C                     MOVE QMWRIT    DDWRCO                          CPM005
     C                     MOVE QMDOCU    DDDOCO                          CPM005
     C                     MOVE QMUSID    DDUSID                          CPM005
     C                     END                             E2             CPM005
     C                     END                             E1             CPM005
     C*                                                                   CPM005
     C           QMSCCD    IFNE *BLANKS                                   CPM005
     C                     MOVELQMSCCD    DDSECO                          CPM005
     C                     MOVE '1'       *IN21                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVEL*BLANKS   DDSECO                          CPM005
     C                     MOVE '0'       *IN21                           CPM005
     C                     END                                            CPM005
     C*                                                                   CPM005
     C                     MOVELQMJAID    DDJAID                          CPM005
     C                     MOVELQMPAID    DDPAID                          CPM005
     C                     MOVELQMCCID    DDCCID                          CPM005
     C*                                                                   R05650
     C** CHECK WHETHER CUSTOMER HAS ISSUED ANY PLEDGES                    R05650
     C           QMCNUM    CHAINLBPLEGLO             70                   R05650
     C           *IN70     IFEQ '0'                                       R05650
     C                     MOVE 'Y'       DDGENP                          R05650
     C                     MOVE '1'       *IN23                           CPM005
     C                     ELSE                                           R05650
     C                     MOVE 'N'       DDGENP                          R05650
     C                     MOVE '0'       *IN23                           CPM005
     C                     END                                            R05650
     C/COPY WNCPYSRC,PM0630C019
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #W1002   - UPDATE DATA AREA                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZDATE2   - TO CONVERT A MIDAS DATE NUMBER IN ALPHA               *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCUSR   - CUSTOMER NUMBER                                       *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      * WWTRDT   - TRADE DATE                                            *
      * WWVLDT   - VALUE DATE                                            *
      *                                                                  *
      ********************************************************************
     C           #W1002    BEGSR
     C**
     C***BUILT*KEY*TO*CHAIN*ON*PF/PMPORTPP                                S01486
     C** BUILT KEY TO CHAIN ON PF/PMPORTPD                                S01486
     C**
     C**********           Z-ADDQMCNUM    WWCUSR                                              CSD027
     C                     MOVE QMCNUM    WWCUSR                                              CSD027
     C**
     C**   USE WWPTFR READ OFF SUBFILE TO ACCESS PORTFOLIO DETAILS/TOTALS
     C**
     C           WWPTFR    IFNE '9997'
     C           WWPTFR    ANDNE'9998'
     C           WWPTFR    ANDNE'9999'
     C********** PMPOTT    CHAINPMPORTPP             72                   S01486
     C           PMPOTT    CHAINPMPORTPD             72                   S01486
     C                     ELSE
     C**
     C**   SET 'PORTFOLIO' CURRENCY,DEC.PLACES & DATE OPENED FOR NON-PORTFOLIOS
     C**
     C                     MOVELQMCSBY    PNPTCY
     C                     MOVELQMBYDP    PNPCDP
     C                     Z-ADD*ZERO     PNDPOP
     C                     END
     C**
     C**
     C** PORTFOLIO REFERENCE ON FILE
     C**
     C                     MOVELWWPTFR    QMPTF1
     C**
     C** SET UP PORTFOLIO REFERENCE ON SCREEN
     C**
     C           WWPTFR    IFEQ '9997'
     C**********           MOVELP9R997    QMPTF2                          S01486
     C**********           MOVELP9N997    QMPTFN                          S01486
     C                     MOVELFCR997    QMPTF2                          S01486
     C                     MOVELFCN997    QMPTFN                          S01486
     C                     ELSE
     C**
     C           WWPTFR    IFEQ '9998'
     C**********           MOVELP9R998    QMPTF2                          S01486
     C**********           MOVELP9N998    QMPTFN                          S01486
     C                     MOVELFCR998    QMPTF2                          S01486
     C                     MOVELFCN998    QMPTFN                          S01486
     C                     ELSE
     C**
     C           WWPTFR    IFEQ '9999'
     C**********           MOVELP9R999    QMPTF2                          S01486
     C**********           MOVELP9N999    QMPTFN                          S01486
     C                     MOVELFCR999    QMPTF2                          S01486
     C                     MOVELFCN999    QMPTFN                          S01486
     C                     ELSE
     C**
     C                     MOVELWWPTFR    QMPTF2
     C                     MOVELPNPTFN    QMPTFN
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C**********           MOVELP9TVPS    QMTVPS                          S01486
     C                     MOVELFCTVPS    QMTVPS                          S01486
     C**
     C**  TRADE DATE PORTFOLIO MARKET VALUE
     C**
     C                     MOVE DDTRDH    QMTPMV
     C**
     C**
     C**  VALUE DATE PORTFOLIO MARKET VALUE
     C**
     C                     MOVE DDVALH    QMVPMV
     C**
     C** TRADE DATE PORTFOLIO ACCRUED INTEREST
     C**
     C                     MOVE DDTAIH    QMPTAI
     C**
     C** VALUE DATE PORTFOLIO ACCRUED INTEREST
     C**
     C                     MOVE DDVAIH    QMPVAI
     C**
     C** PORTFOLIO CURRENCY
     C**
     C                     MOVELPNPTCY    QMPTCY
     C**
     C** PORTFOLIO CURRENCY DECIMAL PLACES
     C**
     C*********************Z-ADDPNPCDP    QMPCDP                          001395
     C********** QMPTCY    CHAINSDCURRL1             70             001395S01486
     C**********                                                    001395S01486
     C********** *IN70     IFEQ '1'                        B3       001395S01486
     C**********           MOVEL'Y'       QMDBER                    001395S01486
     C**********           MOVEL'Y'       QMENQT                    001395S01486
     C**********           MOVE 'SDCURRL1'QMFILE                    001395S01486
     C**********           MOVE 'PM0630'  QMPGM                     001395S01486
     C**********           MOVE LBCCY     QMKEY            *********001395S01486
     C**********           Z-ADD10        QMERRN           **DB E0**001395S01486
     C**********                                           *********001395S01486
     C** UPDATE GDA                                                 001395S01486
     C**********                                                    001395S01486
     C**********           CALL 'PMC1002'                           001395S01486
     C**********           PARM           WWGDA                     001395S01486
     C**********                                                    001395S01486
     C** CALL PMC1020 TO TERMINATE GROUP JOB                        001395S01486
     C**********                                                    001395S01486
     C**********           CALL 'PMC1020'                           001395S01486
     C**********                                                    001395S01486
     C**********           END                                      001395S01486
     C                     MOVELQMPTCY    @AJCD                           S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR'  @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM           @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER                    001395S01486
     C                     MOVEL'Y'       QMENQT                    001395S01486
     C                     MOVE 'SDCURRL1'QMFILE                    001395S01486
     C                     MOVE 'PM0630'  QMPGM                     001395S01486
     C                     MOVE LBCYCD    QMKEY            *********001395S01486
     C                     Z-ADD10        QMERRN           **DB E0**001395S01486
     C**                                                   *********001395S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C**                                                                  001395
     C                     MOVE A6NBDP    QMPCDP                          001395
     C**
     C** PORTFOLIO TYPE
     C**
     C           WWPTFR    IFEQ '9997'                                    32165
     C           WWPTFR    OREQ '9998'                                    32165
     C           WWPTFR    OREQ '9999'                                    32165
     C                     MOVE *BLANKS   QMPTFT                          32165
     C                     ELSE                                           32165
     C           PNPTFT    IFNE *BLANK
     C********** PNPTFT    CHAINPMPTFTPP             74                   S01486
     C           PNPTFT    CHAINPMPTFTPD             74                   S01486
     C**
     C                     MOVELPEPTFT    QMPTFT
     C                     END
     C                     END                                            32165
     C**
     C** DATE PORTFOLIO OPENED
     C**
     C                     Z-ADDPNDPOP    ZDAYNO  50
     C                     EXSR ZDATE2
     C                     MOVELZADATE    QMDPO1
     C**
     C** PORTFOLIO PLEDGED INDICATOR
     C**
     C                     MOVELDDPPDG    QMPPDG
     C**
     C** ENQUIRIES TERMINATING
     C**
     C                     MOVEL*BLANKS   QMENQT
     C**
     C** DATA BASE ERROR
     C**
     C                     MOVEL'PM0630'  QMPGM
     C**
     C***ATTENTION*KEY*ALLOWED                                            CPM005
     C** ATTENTION KEY ALLOWED FROM ALL ENQUIRY SCREENS                   CPM005
     C**                                                                  CPM005
     C***********WWACTN    IFEQ 'S'                                       CPM005
     C***********          MOVEL'Y'       QMATTN                          CPM005
     C***********          ELSE                                           CPM005
     C                     MOVEL'N'       QMATTN
     C***********          END                                            CPM005
     C**                                                                  R00824
     C** BANK INVESTMENT POLICY CODE                                      R00824
     C                     MOVE DDPOLH    QMPOLC                          R00824
     C**                                                                  CPM004
     C** IF BANK PORTFOLIOS SUPPORTED, CHECK IF POOL PORTFOLIO SELECTED   CPM004
     C**                                                                  CPM004
     C           QMPORS    IFEQ 'B'                                       CPM004
     C           PMPOTT    CHAINPMPPTDPD             99                   CPM004
     C  N99                MOVEL'Y'       QMPPCS                          CPM004
     C                     END                                            CPM004
     C**                                                                  CPM004
     C** DETERMINE BOOK CODE                                              CPM004
     C**                                                                  CPM004
     C           QMPTF1    IFNE '9998'                                    CPM004
     C           QMPTF1    ANDNE'9999'                                    CPM004
     C**                                                                  CPM004
     C                     CALL 'AOBOOKR1'                                CPM004
     C                     PARM *BLANKS   @RTCD   7                       CPM004
     C                     PARM '*KEY   ' @OPTN   7                       CPM004
     C                     PARM WWPTFR    @PTFR   4                       CPM004
     C           SDBOOK    PARM SDBOOK    DSSDY                           CPM004
     C           @RTCD     IFEQ *BLANK                                    CPM004
     C                     MOVELBDBKCD    QMBOKC                          CPM004
     C                     END                                            CPM004
     C**                                                                  CPM004
     C                     ELSE                                           CPM004
     C                     MOVEL*BLANK    QMBOKC                          CPM004
     C                     END                                            CPM004
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
     C           #U1003    BEGSR
     C**
     C                     Z-ADDWWBRPR    ZFLD15
     C*****                Z-ADDQMBYDP    ZDECS                      R00296
     C                     Z-ADDW2NBDP    ZDECS                      R00296
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDBRPR
     C**
     C                     Z-ADDWWCOLL    ZFLD15
     C*****                Z-ADDQMBYDP    ZDECS                      R00296
     C                     Z-ADDW2NBDP    ZDECS                      R00296
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDCOLL
     C**
     C                     Z-ADDWWEXPO    ZFLD15
     C*****                Z-ADDQMBYDP    ZDECS                      R00296
     C                     Z-ADDW2NBDP    ZDECS                      R00296
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDEXPO
     C**
     C                     Z-ADDWWLEPO    ZFLD15
     C*****                Z-ADDQMBYDP    ZDECS                      R00296
     C                     Z-ADDW2NBDP    ZDECS                      R00296
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDLEPO
     C**
     C                     Z-ADDWWCMTL    ZFLD15
     C*****                Z-ADDQMBYDP    ZDECS                      R00296
     C                     Z-ADDW2NBDP    ZDECS                      R00296
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDCMTL
     C**
     C           WWAVBR    IFGT *ZERO                                     R5544
     C                     Z-ADDWWAVBR    ZFLD15
     C                     ELSE                                           R5544
     C                     Z-ADD*ZEROS    ZFLD15                          R5544
     C                     END                                            R5544
     C*****                Z-ADDQMBYDP    ZDECS                      R00296
     C                     Z-ADDW2NBDP    ZDECS                      R00296
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAVBR
     C**
     C           WWAVLE    IFGT *ZERO                                     R5544
     C                     Z-ADDWWAVLE    ZFLD15
     C                     ELSE                                           R5544
     C                     Z-ADD*ZEROS    ZFLD15                          R5544
     C                     END                                            R5544
     C*****                Z-ADDQMBYDP    ZDECS                      R00296
     C                     Z-ADDW2NBDP    ZDECS                      R00296
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAVLE
     C**
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
     C           #U1004    BEGSR
     C**
     C                     Z-ADDWWFOXL    ZFLD15
     C*********************Z-ADDQMBYDP    ZDECS                           001396
     C                     Z-ADDW2NBDP    ZDECS                           001396
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDFOXL
     C**
     C                     Z-ADDWWOPFX    ZFLD15
     C*********************Z-ADDQMBYDP    ZDECS                           001396
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDOPFX
     C**
     C                     Z-ADDWWAVFX    ZFLD15
     C*********************Z-ADDQMBYDP    ZDECS                           001396
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAVFX
     C**
     C                     Z-ADDWWMARG    ZFLD15
     C*********************Z-ADDQMBYDP    ZDECS                           001396
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMARG
     C**
     C/COPY WNCPYSRC,PM0630C010
     C                     Z-ADDWWUNPL    ZFLD15
     C/COPY WNCPYSRC,PM0630C011
     C*********************Z-ADDQMBYDP    ZDECS                           001396
     C                     EXSR ZSEDIT
     C/COPY WNCPYSRC,PM0630C012
     C                     MOVE ZOUT21    DDUNPL
     C/COPY WNCPYSRC,PM0630C013
     C**
     C           *IN58     IFEQ '0'                                       R0981
     C                     Z-ADDWWREPL    ZFLD15
     C*********************Z-ADDQMBYDP    ZDECS                           001396
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDREPL
     C                     END                                            R0981
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************R0981
      *                                                                  *R0981
      * #U1005   - FORMAT PRECIOUS METAL DETAILS                         *R0981
      *                                                                  *R0981
      * SUBROUTINE CALLS:                                                *R0981
      *                                                                  *R0981
      * SUBROUTINE CALLED FROM:                                          *R0981
      * #P1011   - PRECIOUS METAL DETAILS                                *R0981
      *                                                                  *R0981
      * ROUTINE USES VARIABLES:                                          *R0981
      *                                                                  *R0981
      ********************************************************************R0981
     C           #U1005    BEGSR                                          R0981
     C**                                                                  R0981
     C*********************Z-ADDQMBYDP    ZDECS                           001396
     C                     Z-ADDW2NBDP    ZDECS                           001396
     C                     Z-ADDWWFOXL    ZFLD15                          R0981
     C                     EXSR ZSEDIT                                    R0981
     C                     MOVE ZOUT21    DDFOXM                          R0981
     C**                                                                  R0981
     C                     Z-ADDWWOPFX    ZFLD15                          R0981
     C                     EXSR ZSEDIT                                    R0981
     C                     MOVE ZOUT21    DDOPFM                          R0981
     C**                                                                  R0981
     C                     Z-ADDWWAVFX    ZFLD15                          R0981
     C                     EXSR ZSEDIT                                    R0981
     C                     MOVE ZOUT21    DDAVFM                          R0981
     C**                                                                  R0981
     C                     Z-ADDWWMARG    ZFLD15                          R0981
     C                     EXSR ZSEDIT                                    R0981
     C                     MOVE ZOUT21    DDMARM                          R0981
     C**                                                                  R0981
     C/COPY WNCPYSRC,PM0630C014
     C                     Z-ADDWWUNPL    ZFLD15                          R0981
     C                     EXSR ZSEDIT                                    R0981
     C                     MOVE ZOUT21    DDUNPM                          R0981
     C/COPY WNCPYSRC,PM0630C015
     C**                                                                  R0981
     C           *IN59     IFEQ '0'                                       R0981
     C                     Z-ADDWWREPL    ZFLD15                          R0981
     C                     EXSR ZSEDIT                                    R0981
     C                     MOVE ZOUT21    DDREPM                          R0981
     C                     END                                            R0981
     C**                                                                  R0981
     C                     ENDSR                                          R0981
     C**************************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZSEDITZ3
      /EJECT
      /COPY ZSRSRC,ZCCYCN
      ****/EJECT                                                          47719
      ****/COPY ZSRSRC,ZCCYXR                                             47719
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - TO PROCESS DATA BASE ERRORS                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PMC1000  - TO UPDATE DATA AREA                                   *
      * PMC1020  - TO STOP GROUP JOB                                     *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWPARM   - *GDA PARAMETER                                        *
      * WWEND    - END PARAMETER                                         *
      * WWGRPJ   - GROUP JOB PARAMETER                                   *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C**
     C** UPDATE *GDA
     C**
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C**
     C                     DUMP
     C**
     C**********           CALL 'PMC1020'                                 S01486
     C                     CALL 'DBERRCTL'                                S01486
     C                     RETRN                                          S01486
     C**
     C                     ENDSR
     C**************************************************************S01486CPM005
     C***********                                                   S01486CPM005
      ****/EJECT                                                    S01486CPM005
     C***********                                                   S01486CPM005
     C**************************************************************S01486CPM005
     C***********                                                   S01486CPM005
     C*****#AUTH*- CHECK ACTION CODE AND BRANCH AUTHORITY           S01486CPM005
     C***********                                                   S01486CPM005
     C*****CALLED BY: #V10F0 - PROCESS VALIDATION OF START SCREEN   S01486CPM005
     C*****CALLS:                                                   S01486CPM005
     C***********                                                   S01486CPM005
     C**************************************************************S01486CPM005
     C***********#AUTH     BEGSR                                    S01486CPM005
     C***********                                                   S01486CPM005
     C***Multi-branch system, user must be authorised to action on  S01486CPM005
     C***branch.                                                    S01486CPM005
     C***********                                                   S01486CPM005
     C***********BGMBIN    IFEQ 'Y'                                 S01486CPM005
     C***********          CALL 'ZVACTBU'                           S01486CPM005
     C***********          PARM           @ZACTN  1                 S01486CPM005
     C***********          PARM           @BRCA   3                 S01486CPM005
     C***********          PARM           @ERR    10                S01486CPM005
     C***********                                                   S01486CPM005
     C***********          ELSE                                     S01486CPM005
     C***********                                                   S01486CPM005
     C***Single*branch system, check user is authorised to action coS01486CPM005
     C***********                                                   S01486CPM005
     C***********          CALL 'ZVACTU'                            S01486CPM005
     C***********          PARM           @ZACTN                    S01486CPM005
     C***********          PARM           @ERR                      S01486CPM005
     C***********                                                   S01486CPM005
     C***********          END                                      S01486CPM005
     C***********                                                   S01486CPM005
     C***********          ENDSR                                    S01486CPM005
      **************************************************************S01486CPM005
     C**                                                                  S01486
      /EJECT                                                              S01486
     C**                                                                  S01486
     C********************************************************************S01486
     C*                                                                  *S01486
     C*    #VACO - CHECK FOR VALID ACTION CODE                           *S01486
     C*                                                                  *S01486
     C*    CALLED BY: #V10F0 - PROCESS VALIDATION OF START SCREEN        *S01486
     C*    CALLS:                                                        *S01486
     C*                                                                  *S01486
     C********************************************************************S01486
     C           #VACO     BEGSR                                          S01486
     C*                                                                   S01486
      *                                                                   S01486
     C* Check valid action codes                                          S01486
      *                                                                   S01486
     C                     Z-ADD1         UV      20                      081352
     C                     MOVEL'0'       *IN57                           081352
     C***********WWACTN    LOKUPVC2,UV                   51         081352CPM005
     C           WWACTN    LOKUPVC1,UV                   51               CPM005
     C           *IN51     IFEQ '0'                                       081352
     C                     MOVEL'1'       *IN57                           081352
     C                     END                                            081352
     C***********WWACTN    IFEQ ','                                 081352CPM005
     C***********          MOVEL'1'       *IN57                     081352CPM005
     C***********          END                                      081352CPM005
     C                     ENDSR                                          081352
     C*******************************************************************
     C**
     C** SUBROUTINE TO SET UP DETAIL OF PLEDGE STATUS, MANAGED
     C** INDICATOR AND INVESTMENT POLICY INDICATOR
     C**
     C*******************************************************************
     C           #P1016    BEGSR                                          R0758
     C**                                                                  CPM005
     C                     MOVE '/'       WWPDG2                          CPM005
     C                     MOVE '/'       WWPDG4                          CPM005
     C                     MOVE '/'       WWPDG6                          CPM005
     C**                                                                  R0758
     C** PLEDGED (Y/N)                                                    R0758
     C**                                                                  R0758
     C           WWPTFR    IFEQ '9997'                                    R0758
     C           WWPTFR    OREQ '9998'                                    R0758
     C           WWPTFR    OREQ '9999'                                    R0758
     C                     MOVEL*BLANK    DDPPDG                          R0758
     C**                                                                  CPM005
     C                     MOVE *BLANKS   WWPDG1                          CPM005
     C                     MOVE *BLANKS   WWPDG3                          CPM005
     C                     MOVE *BLANKS   WWPDG5                          CPM005
     C                     MOVE *BLANKS   WWPDG2                          CPM005
     C                     MOVE *BLANKS   WWPDG4                          CPM005
     C                     MOVE *BLANKS   WWPDG6                          CPM005
     C                     MOVE *BLANKS   WWPDG7                          CPM005
     C**                                                                  CPM005
     C                     MOVE *BLANKS   WKPTFR                          CPM005
     C           PMPOT9    CHAINPMPCBCL3             72                   CPM005
     C*                                                                   CPM005
     C** IF RECORD NOT FOUND                                              CPM005
     C           *IN72     IFEQ '1'                                       CPM005
     C                     MOVE 'N'       WWPDG7                          CPM005
     C                     ELSE                                           CPM005
     C*                                                                   CPM005
     C           FMCDAT    IFLT WRUNDT                                    CPM005
     C                     MOVE 'Y'       WWPDG7                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE 'N'       WWPDG7                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C*                                                                   088642
     C           WWPTFR    IFEQ '9997'                                    088642
     C                     MOVE '/'       WWPDGA                          088642
     C                     EXSR P001                                      088642
     C                     ELSE                                           088642
     C                     MOVEL*BLANKS   WWPDGA                          088642
     C                     MOVEL*BLANKS   WWPDGB                          088642
     C                     END                                            088642
     C**                                                                  CPM005
     C                     MOVE WWPPDG    DDPPDG                          CPM005
     C**                                                                  R0758
     C                     ELSE                                           R0758
     C**                                                                  R0758
     C**  IF RUN DATE LESS THAN OR EQUAL TO PLEDGE START DATE             R0758
     C**                                                                  R0758
     C                     MOVE *BLANK    WWPDG1                          R0758
     C                     MOVE *BLANK    WWPDG3                          R0758
     C***********          MOVE 'N'       WWPDG5                     R0758CPM005
     C**                                                                  R0758
     C           PNPDGS    IFEQ 0                                         R0758
     C           QMRDNB    ORGT PNPDGF                                    R0758
     C**                                                                  R0758
     C******************** MOVEL'N'       DDPPDG                          R0758
     C                     MOVE 'N'       WWPDG1                          R0758
     C**                                                                  R0758
     C                     ELSE                                           R0758
     C**                                                                  R0758
     C           QMRDNB    IFGE PNPDGS                                    R0758
     C           QMRDNB    ANDLEPNPDGF                                    R0758
     C**                                                                  R0758
     C******************** MOVEL'Y'       DDPPDG                          R0758
     C                     MOVE 'Y'       WWPDG1                          R0758
     C**                                                                  R0758
     C                     END                                            R0758
     C**                                                                  R0758
     C                     END                                            R0758
     C**                                                                  R0758
     C** MANAGED INDICATOR                                                R0758
     C**                                                                  R0758
     C                     MOVE PNMNGI    WWPDG3                          R0758
     C***********                                                    R0758CPM005
     C***INVESTMENT POLICY                                           R0758CPM005
     C***********                                                    R0758CPM005
     C***********PNPOLC    IFNE *BLANK                               R0758CPM005
     C***********PNIPIN    OREQ 'Y'                                  R0758CPM005
     C***********PNCYIN    OREQ 'Y'                                  R0758CPM005
     C***********PNYPIN    OREQ 'Y'                                  R0758CPM005
     C***********PNNPIN    OREQ 'Y'                                  R0758CPM005
     C***********          MOVE 'Y'       WWPDG5                     R1005CPM005
     C***********          END                                       R1005CPM005
     C**                                                                  R00824
     C** INDICATOR FOR EXCEPTION TO INVESTMENT POLICY                     R00824
     C**                                                                  R00824
     C           PNXPTN    IFEQ *BLANK                                    R00824
     C***********          MOVE 'N'       WWPDG7                    R00824CPM005
     C                     MOVE 'N'       WWPDG5                          CPM005
     C                     ELSE                                           R00824
     C***********          MOVE PNXPTN    WWPDG7                    R00824CPM005
     C                     MOVE PNXPTN    WWPDG5                          CPM005
     C                     END                                            R00824
     C*                                                                   CPM005
     C           PMPOTT    CHAINPMPCBCL3             72                   CPM005
     C*                                                                   CPM005
     C** IF RECORD NOT FOUND                                              CPM005
     C           *IN72     IFEQ '1'                                       CPM005
     C                     MOVE 'N'       WWPDG7                          CPM005
     C                     ELSE                                           CPM005
     C*                                                                   CPM005
     C           FMCDAT    IFLT WRUNDT                                    CPM005
     C                     MOVE 'Y'       WWPDG7                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE 'N'       WWPDG7                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C***********                                                   S01313CPM005
     C***INDICATOR FOR PORTFOLIO PERFORMANCE                        S01313CPM005
     C***********PNPSDT    IFEQ *HIVAL                              S01313CPM005
     C***********          MOVE 'N'       WWPDG9                    S01313CPM005
     C***********          ELSE                                     S01313CPM005
     C***********          MOVE 'Y'       WWPDG9                    S01313CPM005
     C***********          END                                      S01313CPM005
     C**                                                                  R1005
     C           S01496    IFEQ 'Y'                        B0             S01496
     C                     EXSR P001                                      S01496
     C                     END                                            S01496
     C                     MOVE WWPPDG    DDPPDG                          R1005
     C**                                                                  R00824
     C                     MOVE PNPOLC    DDPOLH                          R00824
     C**                                                                  R1005
     C                     END                                            R0758
     C**                                                                  R0758
     C                     ENDSR                                          R0758
     C**                                                                  R0758
     C***  VC1 - Valid codes for program                                  CPM005
      *CDSI                                                               CPM005
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  VC1 - Valid codes for program                                         CPM005
CDEFINPST                                                                 CPM005
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
