     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Holdings by currency')                        *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                                 *
     F*                                                               *
     F*  PM0671 - PM HOLDINGS BY CURRENCY                             *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
     F*  !--------------------------------------------------------!   *
     F*  ! BE CAREFUL |                                           !   *
     F*  ! When you add a Fix in this Program, may be you should  !   *
     F*  ! put it also in the RPG/PM0670                          !   *
     F*  !--------------------------------------------------------!   *
     F*                                                               *
      *  Last Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 196468             Date 10Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 167710             Date 22Sep99               *
      *                 160217             Date 06Aug99               *
     F*                 126062             Date 26Nov97               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 109063             DATE 03MAR97               *
     F*                 CPM005             DATE 10JUN96               *
     F*                 S10978             DATE 21APR93               *
     F*                 062813             DATE 09NOV93               *
     F*                 S01124             DATE 25JUL94               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  196468 - Database error occurred due to a blank key field    *
     F*           (Instrument Type). The default Instrument type in   *
     F*           PF/SDPORTPD is taken if a blank instrument type is  *
     F*           encountered. Applied fix 119833.                    *
     F*  167710 - Fields Market Price and Folio Price too small.      *
     F*           Lenght increased from 10 to 12 in PM0671DF.         *
     F*  126062 - FIELD NOT CORRECTLY ALIGNED                         *
     F*  160217 - Correct loading of subfile when records in PMHOLDPD *
     F*           are very similar.                                   *
     F*  109063 - TDD is not large enough to hold all records for     *
     F*           subfile display.                                    *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*  S10978 - JYSZRH: EARLY REDEMPTIONS                           *
     F*  062813 - ERROR ON PORTFOLIO ENQUIRY WITH BLOCK MESSAGE;      *
     F*           INVALID CUSTOMER NUMBER PASSED TO SE6542 PGM        *
     F*  S01124 - PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F***********                                                  S10978 CPM005
     F**CLINT   IF  E           K        DISK                      S10978 CPM005
     F*********** CLINTCAF                          KIGNORE        S10978 CPM005
     F*********** CLINTCCF                          KIGNORE        S10978 CPM005
     F*********** CLINTC1F                          KIGNORE        S10978 CPM005
     FSDPORTPDIF  E                    DISK         KINFSR *PSSR                              196468
     F**PM0671DDCF  E                    WORKSTN                          CPM005
     FPM0671DFCF  E                    WORKSTN                            CPM005
     F                                        RRN1  KSFILE PM0671S1
     F                                        RRN2  KSFILE PM0671S2
     F                                        RRN3  KSFILE PM0671S3
     F                                        RRN4  KSFILE PM0671S4
      *
     F**PMCCYTPPIF  E           K        DISK                             CPM005
     FPMCCYTPDIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR
      *
     F****SDPLINPDIF  E           K        DISK                           CPM005
     F***********                                   KINFSR *PSSR          CPM005
      *
     FPMHOLDLBIF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMHOLDP0                          KRENAMEPMHOLDP4
     FPMHOLDL6IF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMHOLDP0                          KRENAMEPMHOLDP6
     F****PMMFHLPPIF  E           K        DISK                           CPM005
     FPMMFHLPDIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR
     F            PMHOLDP0                          KRENAMEPMMFHLP0
     F****PMPORTPPIF  E           K        DISK                           CPM005
     FPMPORTPDIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR
     F****SDPORTPDIF  E                    DISK                           CPM005
     F**********                                    KINFSR *PSSR          CPM005
     F****SDLOMBPDIF  E                    DISK                           CPM005
     F**********                                    KINFSR *PSSR          CPM005
     F****SDCURRL0IF  E           K        DISK                           CPM005
     F**********                                    KINFSR *PSSR          CPM005
     FINTYP   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F**PMTMPTPPIF  E           K        DISK                             CPM005
     FPMTMPTPDIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR
      *********************************************************************
      *
      ** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
      *
      ** ARRAY TO TRANSMIT ORDER NUMBER AS A PARAMETER TO PM2130
     E                    ORD        50  3
      *
     E***ARRAY*TO*ENABLE*ATTENTION*KEY                                    CPM005
     E**********          ATN     1   1 22                                CPM005
      *
      ** ARRAY FOR NARRATIVES
     E**********          NARR    1   2 20                                CPM005
     E                    NARR        2 20                                CPM005
      **
      /COPY ZSRSRC,FFPRCSZ2
      /COPY ZSRSRC,ZSEDITZ1
      /COPY ZSRSRC,ZEDITZ1
      /COPY ZSRSRC,ZPOWERZ1
      /COPY ZSRSRC,ZDATE2Z1
      *
      ** PAGE HEADING ARRAYS: TRADE DATE LIVE RECORDS
     E**********          TDD       150 61  A                             109063
     E**********          TDD      1500 61  A                                          109063 CGL029
     E                    TDD      1500 67  A                                                 CGL029
     E                    HOAR     1500  5 0                              160217
      *
     E                    VC1    10  10  1               Valides codes    CPM005
      ********************************************************************
      *
      ** EXTERNAL FORMAT FOR GROUP DATA AREA
     I****WWGDA     E DSPMGRDAPP                                          CPM005
      *
     I****WWLDA     E DSPMLDAPP                                           CPM005
     IWWLDA     E DSPMLDAPD                                               CPM005
      *
      ** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     IPSDS       SDS
     I**********                            244 253 WSID                  CPM005
     I**********                            254 263 USID                  CPM005
     I                                      244 253 WKSTN                 CPM005
     I                                      254 263 USER                  CPM005
      *
      ** DATA STRUCTURE FOR RETAIL PROCESSING
     I            DS
     I**********                              1  18 WWTEXT                                    CGL029
     I                                        1  24 WWTEXT                                    CGL029
     I                                        1   60WWTCNM
     I***********                             7   7 FILL1                 CPM005
     I***********                             8  10 WWTCCY                CPM005
     I***********                            11  11 FILL2                 CPM005
     I***********                            12  150WWTACO                CPM005
     I***********                            16  16 FILL3                 CPM005
     I***********                            17  180WWTACS                CPM005
     I                                        7   9 WWTCCY                CPM005
     I**********                             10  130WWTACO                             CPM005 CGL029
     I**********                             14  150WWTACS                             CPM005 CGL029
     I**********                             16  18 WWBRCD                             CPM005 CGL029
     I                                       10  190WWTACO                                    CGL029
     I                                       20  210WWTACS                                    CGL029
     I                                       22  24 WWBRCD                                    CGL029
      *
      ** DATA STRUCTURE TO OUTPUT FIELDS TO SUBFILE
     I            DS
     I                                        1  26 WWNARA
     I                                       27  27 FIELA1
     I                                       28  33 FIELA2
     I                                       34  34 FIELA3
     I                                       35  35 FIELA4
     I                                       36  36 FIELA5
     I                                       27  36 FIELDA
     I                                        1  36 WWTOGA
     I            DS
     I                                        1  23 WWNARB
     I                                       24  26 FIELB1
     I                                       27  27 FIELB2
     I                                       28  33 FIELB3
     I                                       34  34 FIELB4
     I                                       35  35 FIELB5
     I                                       36  36 FIELB6
     I                                       24  36 FIELDB
     I                                        1  36 WWTOGB
     I            DS
     I**********                              1  20 WWNARC                                    CGL029
     I                                        1  26 WWNARC                                    CGL029
     I                                        1   3 WWCCY1
     I                                        4   9 WWFFMT
     I**********                             21  21 FIELDC                                    CGL029
     I**********                             22  31 WWSECU                                    CGL029
     I**********                              1  31 WWTOGC                                    CGL029
     I                                       27  27 FIELDC                                    CGL029
     I                                       28  37 WWSECU                                    CGL029
     I                                        1  37 WWTOGC                                    CGL029
     I            DS
     I                                        1  21 WWNARD
     I                                       22  22 FIELD1
     I                                       23  28 FIELD2
     I                                       29  29 FIELD3
     I                                       30  30 FIELD4
     I                                       31  31 FIELD5
     I                                       22  31 FIELDD
     I                                        1  31 WWTOGD
     I            DS
     I                                        1  15 WWNOM1
     I                                        4   4 WWNOM2
     I***********                             6   7 WWNOM4                CPM005
     I***********                             8   8 WWSIGN                CPM005
     I                                       16  16 FILLD1
     I**********                             17  36 WWNAR1                                    CGL029
     I**********                              1  36 WWTOGW                                    CGL029
     I                                       17  42 WWNAR1                                    CGL029
     I                                        1  42 WWTOGW                                    CGL029
     I            DS
     I                                        1  15 WWNOM3
     I                                        6   7 WWNOM4                CPM005
     I                                        8   8 WWSIGN                CPM005
     I                                       16  16 FILLD3
     I**********                             17  36 WWNAR3                                    CGL029
     I**********                              1  36 WWTOGY                                    CGL029
     I                                       17  42 WWNAR3                                    CGL029
     I                                        1  42 WWTOGY                                    CGL029
      /COPY ZSRSRC,ZSEDITZ2
      /COPY ZSRSRC,FFSRDSZ1
      /COPY ZSRSRC,FFPRCSZ3
      *
      ** DATA STRUCTURE FOR PAGE HEADING INFORMATION
     IWWPAGE      DS
     I                                        1   3 QFCCY1
     I                                        4   50QFDSPS
     I                                        6   8 QFDSPG
     I                                        9  100QFITDS
     I                                       11  13 QFINNR
     I                                       14  24 QFPOSQ
     I                                       25  34 QFTDSS
     I**********                             35  400QFTRNB                                    CLE148
     I                                       35  40 QFTRNB                                    CLE148
     I                                       41  460WWACCU                CPM005
     I**********                             41  60 QFTXT2                                    CGL029
     I                                       41  66 QFTXT2                                    CGL029
     I                                       41  43 WWFFMC
     I***********                            44  48 WWFFMY                CPM005
     I                                       45  49 WWFFMY                CPM005
     I**********                             61  61 WWDETT                                    CGL029
     I                                       67  67 WWDETT                                    CGL029
      *
     IWWHDR       DS
     I                                        1   3 W1CCY1
     IW2SCRN      DS
     I**********                              1   60W2CNUM                                    CSD027
     I                                        1   6 W2CNUM                                    CSD027
     I                                        7  10 W2PTFR
     I                                       11  120W2DSPS
     I                                       13  15 W2DSPG
     I                                       16  170W2ITDS
     I                                       18  20 W2INNR
     I                                       21  230W2DLSQ
     I                                       24  26 W2CCY1
     I                                       27  36 W2TDSS
     I**********                             37  420W2TRNB                                    CLE148
     I                                       37  42 W2TRNB                                    CLE148
     I**********                             43  62 W2TXT2                                    CGL029
     I                                       43  68 W2TXT2                                    CGL029
     I*                                                                   CPM005
     ISDMMOD    E DSSDMMODPD                                              CPM005
     I** EXTERNAL DS Module ID                                            CPM005
     I*                                                                   CPM005
     ISDPORT    E DSSDPORTPD                                              CPM005
     I** EXTERNAL DS FOR PORTFOLIO DETAILS                                CPM005
     I*                                                                   CPM005
     ISDLOMB    E DSSDLOMBPD                                              CPM005
     I** LB MODULE ACCESSED VIA ACCESS PROGRAM                            CPM005
     I*                                                                   CPM005
     ISDCURR    E DSSDCURRPD                                              CPM005
     I* DS FOR CURRENCIES DETAILS                                         CPM005
     I*                                                                   CPM005
     ISDPLIN    E DSSDPLINPD                                              CPM005
     I** EXTERNAL DS FOR INSTRUMENT DETAILS                               CPM005
     I*                                                                   CPM005
     ISDCUST    E DSSDCUSTPD                                              CPM005
     I** DUMMY RECORD FORMAT FOR CUSTOMER DETAILS                         CPM005
     I*                                                                   CPM005
     ISDBANK    E DSSDBANKPD                                              CPM005
     I** EXTERNAL DS FOR BANK DETAILS                                     CPM005
     I*                                                                   CPM005
     IDSFDY     E DSDSFDY                                                 CPM005
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                CPM005
     I*                                                                   CPM005
     IDSSDY     E DSDSSDY                                                 CPM005
     I* Second DS For Access Programs, Long Data Structure                CPM005
      *
     ICPYR@#      DS
      *
      ** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
     I            DS
      *
      ** DATA STRUCTURE TO DISPLAY SETTLEMENT DATE ONLY WHEN FF
     I                                        1   2 WWDDAY
     I I            '/'                       3   3 WWORK1
     I                                        4   5 WWMNTH
     I I            '/'                       6   6 WWORK2
     I                                        7   8 WWYEAR
     I                                        1   8 WWSETD
     I            DS
     I                                        1   20WWDSET
     I                                        3   40WWMSET
     I                                        5   60WWYSET
     I***********                             1   60QFSETD                CPM005
     I                                        1   60WKSETD                CPM005
      *
     I            DS
      *
      ** DATA STRUCTURE TO DISPLAY NARRATIVE WHEN FF
     I                                        1  31 WWOPTS
     I                                        1   5 WWFOIS
     I                                        7  11 WWMTYR
     I                                       13  20 WWDATE
     I                                       22  27 WWTNBR
     I                                       28  28 WWNEGS                CPM005
      *
      ** DATABASE ERROR
     IWWCCYT      DS
     I**********                              1   60QFCNUM                                    CSD027
     I                                        1   6 QFCNUM                                    CSD027
     I                                        7  10 QFPTFR
     I                                       11  13 WWCURR
     I            DS                                                      S10978
     I                                        1  31 #FLD##                S10978
     I                                       26  27 #FLDG#                S10978
     I                                       29  30 #FLDS#                S10978
     I                                       25  31 #FLDB#                S10978
     I**                                                                  S10978
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P1001   - PROCESS HOLDINGS                                      *
      * #P1002   - LOAD SUBFILE                                          *
      * #P1004   - ACCESS CURRENCY TOTALS                                *
      * #P1005   - ACCESS INSTRUMENT TYPE TOTALS                         *
      * #P1006   - FORMAT 'SE' HOLDINGS                                  *
      * #P1007   - FORMAT NON 'SE' HOLDINGS                              *
      * #P1008   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      * #P1009   - LOAD SUBFILE WITH ALL POSITIONS                       *
      * #P1010   - DISPLAY INSTRUMENT DETAILS                            *
      * #P1011   - DISPLAY TRANSACTION DETAILS                           *
      * #P1012   - DISPLAY DETAILS OF PLEDGE                             *
      * #P1014   - SETUP ARRAY OF DATE HEADINGS                          *
      * #V1001   - VALIDATE SELECTED HOLDINGS                            *
      * #U1001   - FILL HEADER FIELD                                     *
      * LBTYP    - RETRIEVE GUARANTEES PLEDGES TYPE                      *
      * #BLANK   - BLANK SCREEN FIELD                                    *
      * #SCRN    - SETTING UP SCREEN HEADER AND FOOTER                   *
      * #FILE    - SETTING UP SCREEN HEADER AND FOOTER ARRAYS            *
      * ZCCYXR   -                                                       *
      * *PSSR    - PROCESS DATA BASE ERROR                               *
      * FFPRCS   -                                                       *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      * PMC1003  - RETRIEVE *LDA                                         *
      * QCMDEXC  - COMMAND EXEC                                          *
      * PMC1001  - UPDATE *LDA                                           *
      * PMC0660  - SEARCH AND SELECT PROMPT                              *
      * PM0640   - PORTFOLIO CASHFLOWS                                   *
      * PMC0600  - CUSTOMER NOTEPAD                                      *
      * PM0650   - INSTRUMENT CASHFLOWS                                  *
      * PM6180   - CLOSE OUT                                             *
      **PMC1002**-*UPDATE**GDA********************************************CPM005
      **PMC1004**-*RETRIEVE**GDA******************************************CPM005
      **PMC1020**-*END*GROUPS*JOBS****************************************CPM005
      * PM2000   - DEALS DETAILS                                         *
      * PM2010   - LOAN DETAILS                                          *
      * PM2020   - SE DETAILS                                            *
      * PM2030   - FO INSTRUMENT DETAILS                                 *
      * PM2040   - RETAILS ACCOUNT DETAILS                               *
      * PM2130   - GUARANTEES AND PLEDGES                                *
      * PM2140   - FIDUCIARY DEPOSIT                                     *
      * PM2050   - SE PORTFOLIO MOVEMENTS                                *
      * PM2055   - PORTFOLIO MOVEMENTS (SE)                              *CPM005
      * PM2070   - DEAL AMENDMENT PER DEAL                               *
      * PM2080   - LOAN AMENDMENT PER LOAN                               *
      * PM2090   - FO TRANSACTIONS DETAILS                               *
      * PM2120   - RETAILS ACCOUNT MOVEMENTS                             *
      * PM2160   - FI DEPOSIT AMENDMENT                                  *
      *                                                                  *
      ********************************************************************
     C*                                                                   CPM005
     C                     MOVEACPY@      CPY2@  80                       CPM005
     C*                                                                   CPM005
     C           PMHOLA    KLIST
     C                     KFLD           QFCNUM
     C                     KFLD           QFPTFR
     C                     KFLD           QFCCY1
     C                     KFLD           QFDSPS
     C                     KFLD           QFDSPG
     C                     KFLD           QFITDS
     C                     KFLD           QFINNR
     C                     KFLD           QFPOSQ
     C                     KFLD           QFTDSS
     C                     KFLD           QFTRNB
     C                     KFLD           QFTXT2
     C*
     C           PMHOLD    KLIST
     C                     KFLD           QFCNUM
     C                     KFLD           QFPTFR
     C                     KFLD           QFDSPS
     C                     KFLD           QFDSPG
     C                     KFLD           QFITDS
     C                     KFLD           QFINNR
     C                     KFLD           QFDLSQ
     C                     KFLD           QFCCY1
     C                     KFLD           QFTDSS
     C                     KFLD           QFTRNB
     C                     KFLD           QFTXT2
      *
     C           KLPORT    KLIST
     C                     KFLD           QFCNUM
     C                     KFLD           QFPTFR
      *
     C           PMHOL6    KLIST
     C                     KFLD           WWTDS1 10
     C**********           KFLD           WWCNM1  60                                          CSD027
     C                     KFLD           WWCNM1  6                                           CSD027
     C                     KFLD           WWTVD1  1
     C                     KFLD           WWPTF1  4
      *
     C           PMCCYT    KLIST
     C**********           KFLD           K1CNUM  60                                          CSD027
     C                     KFLD           K1CNUM  6                                           CSD027
     C                     KFLD           K1PTFR  4
     C                     KFLD           K1CCY1  3
      *
     C           PMCCY2    KLIST
     C**********           KFLD           K2CNUM  60                                          CSD027
     C                     KFLD           K2CNUM  6                                           CSD027
     C                     KFLD           K2PTFR  4
     C                     KFLD           K2DSPS  20
     C                     KFLD           K2DSPG  3
     C                     KFLD           K2ITDS  20
     C                     KFLD           K2INSC  3
     C                     KFLD           K2CCY1  3
     C********************************************************************
      *
     C                     EXSR #INIT
      *
     C                     EXSR #P1001
      *
     C                     RETRN
     ******************************************************************   S10978
     C/EJECT                                                              S10978
     ******************************************************************   S10978
     C* P002   : CHANGE SCREEN DETAILS                                *   S10978
     ******************************************************************   S10978
     C*                                                                   S10978
     C           P002      BEGSR                                          S10978
     C*                                                                   S10978
     C** PARAMETERS - DEFINITION AND INITIALIZATION                       S10978
     C                     MOVEL*BLANKS   ##CDBR  3                       S10978
     C                     MOVEL*BLANKS   ##CDCN  6                       S10978
     C                     MOVEL*BLANKS   ##CDSN 10                       S10978
     C                     MOVEL*BLANKS   ##PTFR  4                       S10978
     C                     MOVEL*BLANKS   ##CPBI  1                       S10978
     C                     MOVEL*BLANKS   ##CSBI  1                       S10978
     C                     MOVEL*OFF      ##FLAG  1                       S10978
     C                     MOVEL*BLANKS   HBLOCK  2                       S10978
     C                     MOVEL*BLANKS   GBLOCK  2                       S10978
     C                     MOVEL*BLANKS   SBLOCK  2                       S10978
     C*                                                                   S10978
     C** AFTER THE SECURITY INFORMATIONS WAS RECEIVED FROM BASIC FILE     S10978
     C** LF/SECTY                                                         S10978
     C*                                                                   S10978
     C** 1. SEARCH IF THERE IS A GENERAL BLOCK PURCHASED AND/OR SALES FOR S10978
     C**    SECURITY BY CALLING RPG/SE6712 WITH PARAMETERS:               S10978
     C**     - BRANCH CODE (3A)  CURRENT   FIELD NAME - CDBR - ##CDBR     S10978
     C**     - SECURITY    (10A) CURRENT   FIELD NAME - CDSN - ##CDSN     S10978
     C**     - SECURITY PURCH.GEN.BLOCK IND. (1A)  BLANK       ##CPBI     S10978
     C**     - SECURITY SALES GEN.BLOCK IND. (1A)  BLANK       ##CSBI     S10978
     C******************** MOVE BRCD      ##CDBR                   S10978 CPM005
     C                     MOVE BBBRCD    ##CDBR                          CPM005
     C                     MOVELQFTDSS    ##CDSN                          S10978
     C                     CALL 'SE6712'                                  S10978
     C                     PARM           ##CDBR                          S10978
     C                     PARM           ##CDSN                          S10978
     C                     PARM           ##CPBI                          S10978
     C                     PARM           ##CSBI                          S10978
     C*                                                                   S10978
     C** 2. IF 'SECURITY PURCH.GEN.BLOCK IND.' = 'Y' OR                   S10978
     C**       'SECURITY SALES GEN.BLOCK IND.' = 'Y'                      S10978
     C*                                                                   S10978
     C** 2.1 MOVE 'BLK' INTO THE FIRST CURRENCY FIELD OF THE SECOND       S10978
     C**     SUBFILE RECORD                                               S10978
     C**     MOVE LEFT 'GB', 'GP', 'GS', DEPENDING CONTENS OF THE         S10978
     C**     RECEIVED INDICATORS INTO THE SECURITY REFERENCE FIELD        S10978
     C**     OF THE SECOND LINE OF THE SUBFILE RECORD.                    S10978
     C                     SELEC                                          S10978
     C           ##CPBI    WHEQ 'Y'                                       S10978
     C           ##CSBI    ANDEQ'Y'                                       S10978
     C                     MOVEL'GB'      GBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C           ##CPBI    WHEQ 'Y'                                       S10978
     C                     MOVEL'GP'      GBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C           ##CSBI    WHEQ 'Y'                                       S10978
     C                     MOVEL'GS'      GBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C                     OTHER                                          S10978
     C                     MOVEL*BLANKS   GBLOCK                          S10978
     C                     ENDSL                                          S10978
     C*                                                                   S10978
     C** 3. SEARCH IF THERE IS A SPECIFIC BLOCK PURCHASED AND/OR SALES    S10978
     C**    FOR CUSTOMER/SECURITY BY CALLING RPG/SE6716 WITH PARAMETERS:  S10978
     C**     - BRANCH CODE (3A)  CURRENT   FIELD NAME - CDBR - ##CDBR     S10978
     C**     - CUSTOMER    (6A)  CURRENT   FIELD NAME - CDCN - ##CDCN     S10978
     C**     - SECURITY    (10A) CURRENT   FIELD NAME - CDSN - ##CDSN     S10978
     C**     - PORTFOLIO   (4A)  CURRENT   FIELD NAME          ##PTFR     S10978
     C**     - PURCH.SPEC.BLOCK IND. (1A)  BLANK               ##CPBI     S10978
     C**     - SALES SPEC.BLOCK IND. (1A)  BLANK               ##CSBI     S10978
     C******************** MOVE BRCD      ##CDBR                   S10978 CPM005
     C                     MOVE BBBRCD    ##CDBR                          CPM005
     C                     MOVE QFCNUM    ##CDCN                          S10978
     C                     MOVELQFTDSS    ##CDSN                          S10978
     C                     MOVELQFPTFR    ##PTFR                          S10978
     C                     CALL 'SE6716'                                  S10978
     C                     PARM           ##CDBR                          S10978
     C                     PARM           ##CDCN                          S10978
     C                     PARM           ##CDSN                          S10978
     C                     PARM           ##PTFR                          S10978
     C                     PARM           ##CPBI                          S10978
     C                     PARM           ##CSBI                          S10978
     C*                                                                   S10978
     C** 4. IF 'PURCH.SPECIFIC BLOCK IND.' = 'Y' OR                       S10978
     C**       'SALES SPECIFIC BLOCK IND.' = 'Y'                          S10978
     C*                                                                   S10978
     C** 4.1 MOVE 'BLK' INTO THE FIRST CURRENCY FIELD OF THE SECOND       S10978
     C**     SUBFILE RECORD. IT COULD BE ALREADY DONE BY 2.1.             S10978
     C**     MOVE RIGHT 'SB', 'SP', 'SS', DEPENDING CONTENS OF THE        S10978
     C**     RECEIVED INDICATORS INTO THE SECURITY REFERENCE FIELD        S10978
     C**     OF THE SECOND LINE OF THE SUBFILE RECORD.                    S10978
     C                     SELEC                                          S10978
     C           ##CPBI    WHEQ 'Y'                                       S10978
     C           ##CSBI    ANDEQ'Y'                                       S10978
     C                     MOVEL'SB'      SBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C           ##CPBI    WHEQ 'Y'                                       S10978
     C                     MOVEL'SP'      SBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C           ##CSBI    WHEQ 'Y'                                       S10978
     C                     MOVEL'SS'      SBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C                     OTHER                                          S10978
     C                     MOVEL*BLANKS   SBLOCK                          S10978
     C                     ENDSL                                          S10978
     C*                                                                   S10978
     C           ##FLAG    IFEQ *ON                                       S10978
     C                     MOVELDDTOG4    #FLD##                          S10978
     C                     MOVEL*BLANKS   #FLDB#                          S10978
     C                     MOVELGBLOCK    #FLDG#                          S10978
     C                     MOVELSBLOCK    #FLDS#                          S10978
     C                     MOVEL#FLD##    DDTOG4                          S10978
     C                     MOVEL'BLK'     DDCCY2                          S10978
     C                     ENDIF                                          S10978
     C*                                                                   S10978
     C                     ENDSR                                          S10978
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PMC1003  - RETRIEVE *LDA                                         *
      * QCMDEXC  - COMMAND EXEC                                          *
      * PMC1001  - UPDATE *LDA                                           *
      * #P1014   - SETUP ARRAY OF DATE HEADINGS                          *
      * #P1002   - LOAD SUBFILE                                          *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWMAFF   - FIRST TIME PROGRAM CALLED                             *
      * WWDSPO   - SAVE CURRENCY                                         *
      * WWACTN   - ACTION CODE                                           *
      * WWPRIC   - EDIT MARKET YIELD                                     *
      * WWPRI1   - EDIT MARKET YIELD                                     *
      * WWPRI3   - EDIT MARKET PRICE                                     *
      * WWLDA    - DATAAREA LDA                                          *
      * WWCNUM   - WORK FIELD CUSTOMER NBR                               *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      * WWFLD    - WORK FIELD FOR ATTN                                   *
      * WWNUMB   - WORK FIELD FOR ATTN                                   *
      * WWMODI   - MODULE ID                                             *
      * WWRECI   - RECI OF HOLDING                                       *
      * WWTDSS   - SHORT NAME                                            *
      * WWTRNB   - TRANSACTION NBR                                       *
      * WWDETT   - PAGE HEADINGS                                         *
      * WWPAG1   - WORK FIELD PAGE HEADING                               *
      * WWDISP   - SCREEN TO OUTPUT                                      *
      * WWINTV   - INTERIM TRADE/VALUE INDICATOR                         *
      *                                                                  *
      ********************************************************************
     C           #INIT     BEGSR
      *
     C                     MOVEA*BLANKS   ORD
     C                     Z-ADD0         PL
     C**                                                                  CPM005
     C** Acces file SDMMODPD to check if multibranching system            CPM005
     C**                                                                  CPM005
     C                     CALL 'AOMMODR0'                                CPM005
     C                     PARM '*DBERR ' @RTCD   7                       CPM005
     C                     PARM '*FIRST ' @OPTN   7                       CPM005
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPM005
     C           @RTCD     IFNE *BLANKS                                   CPM005
     C                     MOVEL'Y'       QMDBER                          CPM005
     C                     MOVEL'Y'       QMENQT                          CPM005
     C                     MOVE 'SDMMOD'  QMFILE                          CPM005
     C                     MOVE 'PM0671'  QMPGM                           CPM005
     C                     MOVE *BLANKS   QMKEY            ***************CPM005
     C                     Z-ADD6         QMERRN           **DB ERROR 06**CPM005
     C**                                                   ***************CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     RETRN                                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  Access SAR details file to see if JYSKE Enhcmts is installed.   CPM005
      *                                                                   CPM005
     C                     CALL 'AOSARDR0'                                CPM005
     C                     PARM '       ' @RTCD                           CPM005
     C                     PARM '*VERIFY' @OPTN                           CPM005
     C                     PARM 'S01496'  @SARD   6                       CPM005
      *                                                                   CPM005
     C           @RTCD     IFEQ *BLANK                                    CPM005
     C                     MOVE 'Y'       S01496  1                       CPM005
     C                     END                                            CPM005
     C           S01496    IFEQ 'Y'                        B1             CPM005
     C                     MOVE '1'       *IN62                           CPM005
     C                     ELSE                            X1             CPM005
     C                     MOVE '0'       *IN62                           CPM005
     C                     END                             E1             CPM005
     C*                                                                   CPM005
      *
      ** FIRST TIME PROGRAM CALLED OBTAIN PM ICD
      **  AND LB ICD                                                      CPM005
     C           WWMAFF    IFEQ *BLANKS
     C********** 1         SETLLSDLOMBPD                                  CPM005
     C**********           READ SDLOMBPD                 73               CPM005
     C           BGLMCR    IFEQ 'Y'                                       CPM005
     C                     CALL 'AOLOMBR0'                                CPM005
     C                     PARM '*DBERR ' @RTCD   7                       CPM005
     C                     PARM '*FIRST ' @OPTN   7                       CPM005
     C           SDLOMB    PARM SDLOMB    DSFDY                           CPM005
     C                     END                                            CPM005
     C********** 1         SETLLSDPORTPD                                  CPM005
     C**********           READ SDPORTPD                 73               CPM005
     C                     CALL 'AOPORTR0'                                CPM005
     C                     PARM '*DBERR ' @RTCD   7                       CPM005
     C                     PARM '*FIRST ' @OPTN   7                       CPM005
     C           SDPORT    PARM SDPORT    DSFDY                           CPM005
     C*                                                                   CPM005
     C** If Bank Portfolios are supported, treat as if FF off             CPM005
     C           BGFUOP    IFEQ 'Y'                                       CPM005
     C           FCPORS    ANDNE'B'                                       CPM005
     C                     MOVE '1'       *IN40                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN40                           CPM005
     C                     END                                            CPM005
     C                     END
     C*                                                                   CPM005
     C** GET INSTALLATION CONTROL DATA RECORD 1                           CPM005
     C*                                                                   CPM005
     C                     CALL 'AOBANKR0'                                CPM005
     C                     PARM *BLANKS   WWRTCD  7                       CPM005
     C                     PARM '*FIRST ' WWOPTN  7                       CPM005
     C           SDBANK    PARM SDBANK    DSFDY                           CPM005
      *                                                                   CPM005
      **  SET UP PARAMETER TO RETRIEVE MESSAGE FROM MESSAGE FILE          CPM005
     C           PLLANG    PLIST                                          CPM005
     C                     PARM           MSMBR4  7                       CPM005
     C                     PARM           MSGER  10                       CPM005
     C                     PARM           MSGTXT 80                       CPM005
      *                                                                   CPM005
     C                     MOVEL'PMUSRMSG'MSGER                           CPM005
      *                                                                   CPM005
     C                     MOVEL'PM60005' MSMBR4                          CPM005
     C                     CALL 'SDRTVTXT'PLLANG                          CPM005
     C                     MOVELMSGTXT    NARR,1    P                     CPM005
      *                                                                   CPM005
     C                     MOVEL'PM60006' MSMBR4                          CPM005
     C                     CALL 'SDRTVTXT'PLLANG                          CPM005
     C                     MOVELMSGTXT    NARR,2    P                     CPM005
      *
      ** RESET WORK FIELDS
     C                     MOVEL*BLANKS   WWDSPO  3
     C                     MOVEL*BLANKS   WWACTN  1
     C                     MOVEL'D'       WWMAFF  1
     C                     Z-ADD0         WWPRIC 105
     C***********          Z-ADD0         WWPRI1 104                      167710
     C                     Z-ADD0         WWPRI1 114                      167710
     C***********          Z-ADD0         WWPRI3 103                      167710
     C                     Z-ADD0         WWPRI3 113                      167710
      *
      ** RESET INDICATORS
     C                     MOVE '0'       *IN
     C                     MOVE '0'       *INKL
      *
     C                     MOVEL'J'       ZECODE
      *
      ** RETRIEVE DATA AREA *LDA
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
      *
     C***LOAD*DATA*AREA *GDA*INFORMATIONS                                 CPM005
     C** LOAD DATA AREA *LDA INFORMATIONS                                 CPM005
     C                     MOVELQMRUNA    DDRUNA
     C**********           Z-ADDQMCNUM    WWCNUM  60                                          CSD027
     C                     MOVE QMCNUM    WWCNUM  6                                           CSD027
     C                     MOVELQMPTF1    WWPTFR  4
      *                                                                   CPM005
     C           S01496    IFEQ 'Y'                                       CPM005
     C**                                                                  S10978
     C** READ CLIENT FILE TO OBTAIN BRANCH CODE                           S10978
     C**                                                                  S10978
     C***********QMCNUM    CHAINCLINT                73            S10978 CPM005
     C**                                                                  CPM005
     C** READ CLIENT FILE TO OBTAIN BRANCH CODE                           CPM005
     C**                                                                  CPM005
     C                     MOVELQMCNUM    PLCUS  10                       CPM005
     C                     CALL 'AOCUSTR0'                                CPM005
     C                     PARM '*DBERR'  @RTCD                           CPM005
     C                     PARM '*KEY'    @OPTN                           CPM005
     C                     PARM           PLCUS                           CPM005
     C                     PARM           KEYST   7                       CPM005
     C           SDCUST    PARM SDCUST    DSSDY                           CPM005
     C                     END                                            CPM005
      *
     C***SET*ATTENTION*PROGRAM                                            CPM005
     C**********           MOVEAATN       WWFLD  22                       CPM005
     C**********           Z-ADD22        WWNUMB 155                      CPM005
     C**********           CALL 'QCMDEXC'                                 CPM005
     C**********           PARM           WWFLD                           CPM005
     C**********           PARM           WWNUMB                          CPM005
      *
      ** IF ATTENTION KEY NOT ALLOWED, PROGRAM IS CALLED FROM
      ** PM0630 THUS LOAD DATAAREA INFORMATIONS IN KEY LIST
      ** OTHERWISE CALL SYSTEM PROGRAM TO SET ATTENTION PROGRAM
      ** AND LOAD KEY FIELDS WITH BLANKS
     C           QMATTN    IFEQ 'Y'
     C                     MOVE '0'       *IN79
      *
     C                     MOVEL*BLANKS   WWMODI
     C                     MOVEL*BLANKS   WWRECI  1
     C                     MOVEL*BLANKS   WWTDSS 10
     C**********           Z-ADD0         WWTRNB  60                                          CLE148
     C                     MOVEL*BLANK    WWTRNB  6                                           CLE148
     C                     ELSE
      *
     C                     MOVEL'Y'       QMATTN
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
      *
     C                     MOVE '1'       *IN79
     C                     MOVEL*BLANKS   WWMODI
     C                     MOVEL*BLANKS   WWRECI
     C                     MOVELQMSESN    WWTDSS
     C**********           Z-ADDQMTRNB    WWTRNB                                              CLE148
     C                     MOVELQMTRNB    WWTRNB                                              CLE148
     C                     END
      *
      ** MOVE FIELDS FROM DTAARA/*LDA TO FIELDS USED TO ACCESS HOLDINGS FI
     C                     Z-ADD*ZEROS    QFDSPS
     C                     MOVEL*BLANKS   QFDSPG
     C**********           Z-ADDQMCNUM    QFCNUM                                              CSD027
     C                     MOVE QMCNUM    QFCNUM                                              CSD027
     C                     MOVE QMPTF1    QFPTFR
     C                     MOVE QMCCY1    QFCCY1
     C                     Z-ADD*ZEROS    QFITDS
     C                     MOVE *BLANKS   QFINNR
     C                     MOVE *BLANKS   QFTDSS
     C**********           Z-ADD*ZEROS    QFTRNB                                              CLE148
     C                     MOVEL*BLANKS   QFTRNB                                              CLE148
     C                     MOVE 'D'       WWDETT
     C                     MOVE *LOVAL    QFPOSQ
     C                     MOVE *LOVAL    QFTXT2
      *
      ** USING PARAMETERS RECEIVED FROM DTAARA/*LDA OBTAIN FULL KEY DETAIL
      ** FROM PF/PMHOLDPP
     C           PMHOLA    SETLLPMHOLDLB
     C                     READ PMHOLDLB                 72
      *
     C**********           MOVE WWPAGE    WWPAG1 61                                           CGL029
     C                     MOVE WWPAGE    WWPAG1 67                                           CGL029
      *
      ** SET UP ARRAYS OF PAGE HEADINGS FOR TRADE / VALUE DATE AS APPROPRI
     C                     EXSR #P1014
      *
      ** SET THE SCREEN INDICATOR TO '1' - WHICH SCREEN IS OUTPUT
     C                     MOVE '1'       WWDISP  1
      *
     C***IF*DISPLAY*TRADE/VALUE*DATE*ON*DTAARA *GDA*IS*'T'                CPM005
     C** IF DISPLAY TRADE/VALUE DATE ON DTAARA *LDA IS 'T'                CPM005
     C           QMTVPS    IFEQ 'T'
      *
      ** SET INTERIM TRADE/VALUE INDICATOR TO 'T'
     C                     MOVEL'T'       WWINTV  1
     C                     MOVE '1'       *IN53
     C***IF*DISPLAY*TRADE/VALUE*DATE*ON*DTAARA *GDA*IS*'V'                CPM005
     C** IF DISPLAY TRADE/VALUE DATE ON DTAARA *LDA IS 'V'                CPM005
     C                     ELSE
     C                     MOVEL'V'       WWINTV  1
     C                     MOVE '0'       *IN53
     C                     END
      *
      ** FORCE POSITION IN FILE  BY SETTING ON INDICATOR OF ROLLUP
     C                     MOVE '1'       *IN23
     C                     EXSR #P1002
     C                     MOVE '0'       *IN23
      *                                                                   CPM005
     C           QMACTP    IFEQ *BLANKS                                   CPM005
     C                     MOVEL'PM0671'  QMACTP    P                     CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     END                                            CPM005
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1001   - PROCESS HOLDINGS                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #U1001   - FILL HEADER FIELD                                     *
      * PMC1001  - UPDATE *LDA                                           *
      * PMC0660  - SEARCH AND SELECT PROMPT                              *
      * PMC1003  - RETRIEVE *LDA                                         *
      * #P1002   - LOAD SUBFILE                                          *
      * #SCRN    - SETTING UP SCREEN HEADER AND FOOTER                   *
      * PM0640   - PORTFOLIO CASHFLOWS                                   *
      * PMC0600  - CUSTOMER NOTEPAD                                      *
      * #V1001   - VALIDATE SELECTED HOLDINGS                            *
      * PM0650   - INSTRUMENT CASHFLOWS                                  *
      * PM6180   - CLOSE OUT                                             *
      * #P1008   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      * #P1010   - DISPLAY INSTRUMENT DETAILS                            *
      * #P1011   - DISPLAY TRANSACTION DETAILS                           *
      * #P1012   - DISPLAY DETAILS OF PLEDGE                             *
      **PMC1002**-*UPDATE**GDA********************************************CPM005
      **PMC1004**-*RETRIEVE**GDA******************************************CPM005
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWFLAG   - WORK FIELD TO DISPLAY SCREEN                          *
      * WWDISP   - SCREEN TO OUTPUT                                      *
      * WWGLOB   - GLOBAL POSITION                                       *
      * WWMAFF   - FIRST TIME PROGRAM CALLED                             *
      * WWHDR    - HEADER                                                *
      * WWLDA    - DATAAREA LDA                                          *
      * WWF12    - F12                                                   *
      * WWPAG1   - WORK FIELD PAGE HEADING                               *
      * WWFSTR   - FIRST PAGE                                            *
      * WWLSTR   - LAST SCREEN                                           *
      * WWF13    - F13                                                   *
      * WWNOPG   - NBR OF PAGES                                          *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      * WWRECI   - RECI OF HOLDING                                       *
      * WWMODI   - MODULE ID                                             *
      * WWTRNB   - TRANSACTION NBR                                       *
      * WWTDSS   - SHORT NAME                                            *
      * WWTSCR   - WORK FIELD PAGE HEADING                               *
      * WWACTN   - ACTION CODE                                           *
      **WWGDA****-*DATAAREA**GDA******************************************CPM005
      *                                                                  *
      ********************************************************************
     C           #P1001    BEGSR
      *
      ** DO UNTIL TERMINATION FLAG IS SET TO 'Y'
     C           WWFLAG    DOUEQ'Y'
      *
      ** SET TERMINATION FLAG TO 'N'
     C                     MOVEL'N'       WWFLAG  1
     C                     MOVEL*BLANK    DDACTN
      *
      ** FOLLOWING DISPLAY INDICATOR SEND CORRESPONDING FORMAT
     C           WWDISP    IFEQ '1'
      *
      ** FORMAT SUBFILE
     C                     EXSR #U1001
     C                     WRITEPM0671F3
     C                     WRITEPM0671F1
     C                     EXFMTPM0671C1
     C                     ELSE
      *
      ** FORMAT SUBFILE
     C                     EXSR #U1001
     C                     WRITEPM0671F3
     C                     WRITEPM0671F1
     C                     EXFMTPM0671C2
     C                     END
      *
     C                     MOVE '0'       *IN56
     C                     MOVE '0'       *IN57
     C                     MOVE '0'       *IN62
     C                     MOVE '0'       *IN58
     C                     MOVE *OFF      *IN63                           CPM005
     C                     MOVE '0'       *IN69
     C                     MOVE '0'       *IN68
     C                     MOVE '0'       *IN74
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN42                           CPM005
     C                     MOVE 'N'       WWGLOB
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF F4 TAKEN - SEARCH
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKD     IFEQ '1'
      *
      ** DETERMINE DISPLAY GROUP AND INSTRUMENT CURRENTLY DISPLAYED AT
      ** TOP OF SCREEN
     C           WWMAFF    IFEQ 'D'
      *
     C                     MOVELTDD,A     WWHDR   3
      *
     C                     END
      *
     C                     MOVE W1CCY1    QMCCY1
      *
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
      *
      ** DISPLAY SEARCH AND SELECT PROMPT
     C                     CALL 'PMC0660'
     C                     PARM           WWF12   1
     C                     PARM 'Y'       WWIND   1                       CPM005
      *
     C           WWF12     IFNE 'Y'
      *
      ** RETRIEVE DATA AREA *LDA TO READ INFORMATIONS PASSED BY
      ** PROGRAM PM0660
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
      *
      ** LOAD SUBFILE WITH TRADE DATE HOLDINGS
     C                     MOVELQMCCY1    QFCCY1
     C                     Z-ADD*LOVAL    QFDSPS
     C                     MOVEL*LOVAL    QFDSPG
     C                     Z-ADD*LOVAL    QFDSPS
     C                     MOVEL*LOVAL    QFDSPG
     C                     Z-ADD*LOVAL    QFITDS
     C                     MOVEL*LOVAL    QFINNR
     C                     MOVE *LOVAL    QFPOSQ
     C                     MOVEL*LOVAL    QFTDSS
     C**********           Z-ADD*LOVAL    QFTRNB                                              CLE148
     C                     MOVEL*LOVAL    QFTRNB                                              CLE148
     C                     MOVE *LOVAL    QFTXT2
      *
      ** USING PARAMETERS RECEIVED FROM DTAARA/*LDA OBTAIN FULL KEY DETAIL
      ** FROM PF/PMHOLDPP
     C           PMHOLA    SETLLPMHOLDLB
     C                     READ PMHOLDLB                 72
      *
     C                     MOVE WWPAGE    WWPAG1
      *
      ** LOAD NEXT PAGE OF TRADE / VALUE DATE HOLDINGS
     C                     EXSR #P1002
      *
     C                     END
      *
     C                     END
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF F11 TAKEN - WINDOW LEFT <> RIGHT
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKK     IFEQ '1'
      *
      ** IF THE SCREEN DISPLAY IS EQUAL TO '1' SET IT TO '2'
     C           WWDISP    IFEQ '1'
     C                     MOVEL'2'       WWDISP
     C                     MOVE '1'       *IN54
     C                     ELSE
      *
      ** IF THE SCREEN DISPLAY IS EQUAL TO '2' SET IT TO '1'
     C                     MOVEL'1'       WWDISP
     C                     MOVE '0'       *IN54
     C                     END
      *
     C                     END
      *
      ** DETERMINE SCREEN TO DISPLAY
     C           *INKM     IFEQ '1'
     C                     Z-ADD1         A
     C           WWMAFF    IFEQ 'D'
      *
      ** F13 NOT ALLOWED IF NOT FLAT MATURED POSITIONS FOR CUSTOMER
      ** AND PORTFOLIO. SET FILE POINTER BEFORE FIRST RECORD ON
     C***PF/PMMFHLPP                                                      CPM005
     C** PF/PMMFHLPD                                                      CPM005
     C                     MOVE QMCNUM    QFCNUM
     C                     MOVE QMPTF1    QFPTFR
     C                     Z-ADD*LOVAL    QFDSPS
     C                     MOVE *LOVAL    QFDSPG
     C                     Z-ADD*LOVAL    QFITDS
     C                     MOVE *LOVAL    QFINNR
     C                     MOVE *LOVAL    QFTDSS
     C                     Z-ADD*LOVAL    QFDLSQ
     C**********           Z-ADD*LOVAL    QFTRNB                                              CLE148
     C                     MOVEL*LOVAL    QFTRNB                                              CLE148
     C                     MOVE *LOVAL    QFTXT2
     C                     MOVE *LOVAL    QFCCY1
      *
     C********** PMHOLD    SETLLPMMFHLPP                                  CPM005
     C**********           READ PMMFHLPP                 72               CPM005
     C           PMHOLD    SETLLPMMFHLPD                                  CPM005
     C                     READ PMMFHLPD                 72               CPM005
      *
      ** IF NO RECORDS EXIST FOR CUSTOMER OUTPUT ERROR MESSAGE
     C           *IN72     IFEQ '1'
     C           QFCNUM    ORNE QMCNUM
     C           QFPTFR    ORNE QMPTF1
     C                     MOVE '1'       *IN74
      *
      ** .....OTHERWISE SET UP VARIABLES CONTAINING DETAILS OF FIRST
      ** AND LAST POSITIONS FOR CUSTOMER
     C                     ELSE
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWFSTR 62                                           CGL029
     C                     MOVE W2SCRN    WWFSTR 68                                           CGL029
      *
      ** OBTAIN DETAILS OF LAST FLAT / MATURE POSITION
     C                     Z-ADD*HIVAL    QFDSPS
     C                     MOVE *HIVAL    QFDSPG
     C                     Z-ADD*HIVAL    QFITDS
     C                     MOVE *HIVAL    QFINNR
     C                     MOVE *HIVAL    QFTDSS
     C                     Z-ADD*LOVAL    QFDLSQ
     C**********           Z-ADD*HIVAL    QFTRNB                                              CLE148
     C                     MOVEL*HIVAL    QFTRNB                                              CLE148
     C                     MOVE *HIVAL    QFTXT2
     C                     MOVE *HIVAL    QFCCY1
      *
     C********** PMHOLD    SETLLPMMFHLPP                           B08253 S01486
     C**********           READPPMMFHLPP                 72        B08253 S01486
     C           PMHOLD    SETLLPMMFHLPD                                  S01486
     C                     READPPMMFHLPD                 72               S01486
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWLSTR 62                                           CGL029
     C                     MOVE W2SCRN    WWLSTR 68                                           CGL029
      *
     C                     MOVEL'M'       WWMAFF
     C                     MOVE '1'       *IN65
     C                     END
      *
     C                     ELSE
     C                     MOVEL'D'       WWMAFF
     C                     MOVE '0'       *IN65
     C                     END
      *
      ** REBUILD DISPLAY SCREENS
     C           *IN74     IFEQ '0'
     C                     MOVE 'Y'       WWF13   1
     C                     EXSR #P1002
      *
     C                     MOVE 'N'       WWF13
      *
     C                     END
      *
     C                     END
     C**                                                                  CPM005
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++CPM005
     C** IF F22 TAKEN                                                     CPM005
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++CPM005
     C**                                                                  CPM005
     C           *INKW     IFEQ '1'                                       CPM005
     C**                                                                  CPM005
     C           QMACTP    IFEQ *BLANKS                                   CPM005
     C           QMACTP    OREQ 'PM0671'                                  CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC0610'                                 CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1003'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C           QMENQT    IFEQ 'C'                                       CPM005
     C           QMENQT    OREQ 'P'                                       CPM005
     C           QMENQT    OREQ 'Y'                                       CPM005
     C                     MOVE 'Y'       WWFLAG                          CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C                     ELSE                                           CPM005
     C                     RETRN                                          CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C                     END                                            CPM005
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      ** IF F23 TAKEN - PORTFOLIO CASHFLOW
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKX     IFEQ '1'
      *
     C                     CALL 'PM0640'
      *
     C                     END
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      ** IF F24 TAKEN - CUSTOMER MANAGEMENT
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKY     IFEQ '1'
      *
     C                     MOVEL'PM0671'  PGMNAM 10                       CPM005
     C                     CALL 'PMC0600'
     C                     PARM           PGMNAM                          CPM005
      *
     C                     END
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      ** IF ROLLUP REQUESTED
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *IN23     IFEQ '1'
      *
      ** SET UP WORKFIELD CONTAINING NUMBER OF PAGES OF INFORMATION
     C           WWMAFF    IFEQ 'D'
     C                     Z-ADDWWTDLV    WWNOPG  50
     C                     ELSE
     C                     Z-ADDWWTDFL    WWNOPG
     C                     END
      *
      ** IF ROLLUP ON THE LAST PAGE SEND WARNING MESSAGE
     C           WWMAFF    IFEQ 'D'
     C           A         ANDEQWWNOPG
     C           WWMAFF    OREQ 'M'
     C           WWBSCR    ANDEQWWLSTR
     C                     MOVE '1'       *IN68
      *
     C                     ELSE
      *
      ** INTERIM TRADE/VALUE
      ** RETRIEVE NEXT PARAMETERS
     C                     MOVELQMPTF1    WWPTFR
     C                     MOVE *BLANKS   WWRECI
     C                     MOVE *BLANKS   WWMODI  2
     C**********           Z-ADD0         WWTRNB                                              CLE148
     C                     MOVEL*BLANK    WWTRNB                                              CLE148
     C                     MOVE *BLANKS   WWTDSS
      *
     C                     EXSR #P1002
      *
     C                     END
      *
     C                     END
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      ** IF ROLLDOWN REQUESTED
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *IN24     IFEQ '1'
      *
      ** IF ROLLDOWN ON THE FIRST PAGE SEND WARNING MESSAGE
     C           WWMAFF    IFEQ 'D'
     C           A         ANDEQ1
     C           WWMAFF    OREQ 'M'
     C           WWFSTR    ANDEQWWTSCR
     C                     MOVE '1'       *IN68
      *
     C                     ELSE
      *
      ** INTERIM TRADE/VALUE
      ** RETRIEVE CURRENT PARAMETERS
     C                     MOVELQMPTF1    WWPTFR
     C                     MOVE *BLANKS   WWRECI
     C                     MOVE *BLANKS   WWMODI
     C**********           Z-ADD0         WWTRNB                                              CLE148
     C                     MOVEL*BLANK    WWTRNB                                              CLE148
     C                     MOVE *BLANKS   WWTDSS
      *
     C                     EXSR #P1002
      *
     C                     END
      *
     C                     END
      ** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      ** IF ENTER HAS BEEN PRESSED
      ** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *IN60     IFEQ '0'
      *
      ** TEST WHICH FORMAT IS ACTIVE
     C           WWDISP    IFEQ '1'
     C                     READCPM0671S1                 70
      *
     C** CHANGE OCCURED
     C           *IN70     IFEQ '0'
     C                     MOVELDDACTN    WWACTN
     C                     MOVEL*BLANKS   DDACTN
      *
      ** IF INSTRUMENT DETAILS READ SET ON INDICATOR 51 SO THAT
      ** DISPLAYED IN RED
     C           DDCOLR    IFEQ 'Y'
     C                     MOVE '1'       *IN51
     C                     END
      *
     C                     UPDATPM0671S1
     C                     MOVE '0'       *IN51
     C                     END
     C                     ELSE
     C                     READCPM0671S2                 70
      *
      ** CHANGE OCCURED
     C           *IN70     IFEQ '0'
     C                     MOVELDDACTN    WWACTN
     C                     MOVEL*BLANKS   DDACTN
      *
      ** IF INSTRUMENT DETAILS READ SET ON INDICATOR 51 SO THAT
      ** DISPLAYED IN RED
     C           DDCOLR    IFEQ 'Y'
     C                     MOVE '1'       *IN51
     C                     END
     C                     UPDATPM0671S2
     C                     MOVE '0'       *IN51
     C                     END
     C                     END
      *
      ** IF A CHANGE OCCURED
     C           *IN70     IFEQ '0'
      *
      ** VALIDATE INPUT AS PER #V1001
     C                     EXSR #V1001
      *
     C           *IN80     IFEQ '0'
      *
      ***ACTION*'F'                                                       CPM005
      ** ACTION 'K'                                                       CPM005
     C********** WWACTN    IFEQ 'F'                                       CPM005
     C           WWACTN    IFEQ 'K'                                       CPM005
      *
     C           DDMODH    IFEQ 'IT'
     C                     MOVELDDTYPE    QMINNR
     C                     END
      *
     C                     MOVELDDMODH    QMMODI
     C           DDMODH    IFEQ 'SE'
     C                     MOVELDDSHOR    QMSESN
     C**********           Z-ADD*ZERO     QMTRNB                                              CLE148
     C                     MOVEL*BLANK    QMTRNB                                              CLE148
     C                     ELSE
     C                     MOVEL*BLANKS   QMSESN
     C                     MOVELDDTRNH    QMTRNB
     C                     END
      *
      ***UPDATE**GDA                                                      CPM005
      ** UPDATE *LDA                                                      CPM005
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
      *
      ** CALL PM0650 TO DISPLAY CASHFLOW FOR HOLDINGS
     C                     CALL 'PM0650'
      *
      ** RESET FIELDS
     C                     MOVEL*BLANKS   QMINNR
     C                     MOVEL*BLANKS   QMMODI
     C                     MOVEL*BLANKS   QMSESN
     C**********           Z-ADD*ZERO     QMTRNB                                              CLE148
     C                     MOVEL*BLANK    QMTRNB                                              CLE148
      *
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
      *
     C                     END
     C**                                                                  CPM005
     C           S01496    IFEQ 'Y'                                       CPM005
     C**                                                                  S10978
     C***ACTION*'B'                                                S10978 CPM005
     C** ACTION 'D'                                                       CPM005
     C**                                                                  S10978
     C***********WWACTN    IFEQ 'B'                                S10978 CPM005
     C           WWACTN    IFEQ 'D'                                       CPM005
     C**                                                                  S10978
     C           DDMODH    IFEQ 'IT'                                      S10978
     C                     MOVELDDTYPE    QMINNR                          S10978
     C                     END                                            S10978
     C**                                                                  S10978
     C                     MOVELDDMODH    QMMODI                          S10978
     C           DDMODH    IFEQ 'SE'                                      S10978
     C                     MOVELDDSHOR    QMSESN                          S10978
     C**********           Z-ADD*ZERO     QMTRNB                                       S10978 CLE148
     C                     MOVEL*BLANK    QMTRNB                                              CLE148
     C                     ELSE                                           S10978
     C                     MOVEL*BLANKS   QMSESN                          S10978
     C                     MOVELDDTRNH    QMTRNB                          S10978
     C                     END                                            S10978
     C**                                                                  S10978
     C***UPDATE**GDA                                               S10978 CPM005
     C** UPDATE *LDA                                                      CPM005
     C**                                                                  S10978
     C                     CALL 'PMC1001'                                 S10978
     C                     PARM           WWLDA                           S10978
     C**                                                                  S10978
     C** READ CLIENT FILE TO OBTAIN BRANCH CODE                           S10978
     C**                                                                  S10978
     C********** QFCNUM    CHAINCLINT                73            S10978 CPM005
     C                     MOVELQFCNUM    PLCUS                           CPM005
     C                     CALL 'AOCUSTR0'                                CPM005
     C                     PARM '*DBERR'  @RTCD                           CPM005
     C                     PARM '*KEY'    @OPTN                           CPM005
     C                     PARM           PLCUS                           CPM005
     C                     PARM           KEYST   7                       CPM005
     C           SDCUST    PARM SDCUST    DSSDY                           CPM005
     C**                                                                  S10978
     C** CALL SE6542 TO DISPLAY BLOCKED POSITIONS                         S10978
     C**                                                                  S10978
     C******************** MOVE BRCD      KBRCD   3                S10978 CPM005
     C                     MOVE BBBRCD    KBRCD   3                       CPM005
     C*********************MOVE QFCNUM    KCNUM   6                S10978 062813
     C                     MOVE DDCNUM    KCNUM   6                       062813
     C                     MOVE DDPTFR    KPTFR   4                       S10978
     C                     MOVE DDSHOR    KSESN  10                       S10978
     C                     Z-ADDQMRDNB    KRUNA   50                      S10978
     C**                                                                  S10978
     C                     CALL 'SE6542'                                  S10978
     C                     PARM           KBRCD                           S10978
     C                     PARM           KCNUM                           S10978
     C                     PARM           KPTFR                           S10978
     C                     PARM           KSESN                           S10978
     C                     PARM           KRUNA                           S10978
     C**                                                                  S10978
     C** RESET FIELDS                                                     S10978
     C**                                                                  S10978
     C                     MOVEL*BLANKS   QMINNR                          S10978
     C                     MOVEL*BLANKS   QMMODI                          S10978
     C                     MOVEL*BLANKS   QMSESN                          S10978
     C**********           Z-ADD*ZERO     QMTRNB                                       S10978 CLE148
     C                     MOVEL*BLANK    QMTRNB                                              CLE148
     C**                                                                  S10978
     C                     CALL 'PMC1001'                                 S10978
     C                     PARM           WWLDA                           S10978
     C**                                                                  S10978
     C                     END                                            S10978
     C                     END                                            CPM005
      *
      ** ACTION 'O'
     C           WWACTN    IFEQ 'O'
      *
      ***UPDATE**GDA                                                      CPM005
      ** UPDATE *LDA                                                      CPM005
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
      *
     C                     CALL 'PM6180'
     C                     PARM           DDTRNH
     C***********          PARM           WWLDA                           CPM005
      *
      ** RESET FIELDS
     C                     MOVEL*BLANKS   QMINNR
     C                     MOVEL*BLANKS   QMMODI
     C                     MOVEL*BLANKS   QMSESN
     C**********           Z-ADD*ZERO     QMTRNB                                              CLE148
     C                     MOVEL*BLANK    QMTRNB                                              CLE148
      *
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
      *
     C                     END
      *
      ** ACTION 'G'
     C           WWACTN    IFEQ 'G'
      *
      ** RESTORE FIELDS FROM RECORD
     C                     MOVELDDMODH    WWMODI
     C                     MOVELDDRECH    WWRECI
     C                     MOVELDDSHOR    WWTDSS
     C                     MOVE DDTRNH    WWTRNB
      *
     C                     EXSR #P1008
      *
      ** LOAD PMHOLD KEY WITH CURRENT VALUES
     C                     MOVELQMPTF1    WWPTFR
     C                     MOVE *BLANKS   WWRECI
     C                     MOVE *BLANKS   WWTDSS
     C                     MOVE *BLANKS   WWMODI
     C**********           Z-ADD0         WWTRNB                                              CLE148
     C                     MOVEL*BLANK    WWTRNB                                              CLE148
      *
     C                     END
      *
      ***ACTION*'D'                                                       CPM005
      ** ACTION 'V'                                                       CPM005
     C***********WWACTN    IFEQ 'D'                                       CPM005
     C           WWACTN    IFEQ 'V'                                       CPM005
      *
     C           DDMODH    IFEQ 'SE'
     C**********           Z-ADD*ZERO     QMTRNB                                              CLE148
     C                     MOVEL*BLANK    QMTRNB                                              CLE148
     C                     ELSE
     C                     MOVEL*BLANKS   QMSESN
     C                     END
      *
      ** UPDATE *LDA
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
      *
     C                     EXSR #P1010
      *
     C                     END
      *
      ** ACTION 'T'
     C           WWACTN    IFEQ 'T'
      *
     C                     EXSR #P1011
      *
     C                     END
      *
      ** ACTION 'P'
     C           WWACTN    IFEQ 'P'
      *
     C                     EXSR #P1012
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     END
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      ** IF F3 TAKEN
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKC     IFEQ '1'
      *
      ***SET*ENQUIRIES*TERMINATING*FIELD*IN**GDA*TO*'Y'                   CPM005
      ** SET ENQUIRIES TERMINATING FIELD IN *LDA TO 'Y'                   CPM005
     C                     MOVEL'Y'       QMENQT
      *
      ***UPDATE**GDA                                                      CPM005
      ** UPDATE *LDA                                                      CPM005
     C***********          CALL 'PMC1002'                                 CPM005
     C***********          PARM           WWGDA                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *
     C                     END
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      ** IF F12 TAKEN - RETURN TO CALLING PROGRAM
      ** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKL     IFEQ '1'
      *
     C                     MOVEL'P'       QMENQT
     C***********          CALL 'PMC1002'                                 CPM005
     C***********          PARM           WWGDA                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     END
      *
      ***ENQUIRE*DATA*AREA**GDA                                           CPM005
      ** ENQUIRE DATA AREA *LDA                                           CPM005
     C***********          CALL 'PMC1004'                                 CPM005
     C***********          PARM           WWGDA                           CPM005
     C                     CALL 'PMC1003'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *
     C           QMENQT    IFEQ 'Y'
     C           QMENQT    OREQ 'P'
     C           QMENQT    OREQ 'C'
     C           QMENQT    OREQ 'D'                                       CPM005
     C                     MOVEL'Y'       WWFLAG
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1002   - LOAD SUBFILE                                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #BLANK   - BLANK SCREEN FIELD                                    *
      * #FILE    - SETTING UP SCREEN HEADER AND FOOTER ARRAYS            *
      * #SCRN    - SETTING UP SCREEN HEADER AND FOOTER                   *
      * #P1004   - ACCESS CURRENCY TOTALS                                *
      * #P1005   - ACCESS INSTRUMENT TYPE TOTALS                         *
      * #P1006   - FORMAT 'SE' HOLDINGS                                  *
      * #P1007   - FORMAT NON 'SE' HOLDINGS                              *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P1001   - PROCESS HOLDINGS                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWMAFF   - FIRST TIME PROGRAM CALLED                             *
      * WWF13    - F13                                                   *
      * WWNOPG   - NBR OF PAGES                                          *
      * WWPAG1   - WORK FIELD PAGE HEADING                               *
      * WWPAGX   - WORK FIELD PAGE HEADING                               *
      * WWPAGY   - WORK FIELD PAGE HEADING                               *
      * WWPAG2   - WORK FIELD PAGE HEADING                               *
      * WWPAGE   - PAGE HEADINGS                                         *
      * WWDSPO   - SAVE CURRENCY                                         *
      * WWINNO   - SAVE INSTRUMENT CODE                                  *
      * WWFSTR   - FIRST PAGE                                            *
      * WWTSCR   - WORK FIELD PAGE HEADING                               *
      * WWBSCR   - BOTTOM SCREEN                                         *
      * WWCNUM   - WORK FIELD CUSTOMER NBR                               *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      * WWDETT   - PAGE HEADINGS                                         *
      *                                                                  *
      ********************************************************************
     C           #P1002    BEGSR
      *
     C                     Z-ADD0         RRN1    40
     C                     Z-ADD0         RRN2    40
     C                     MOVE '1'       *IN61
     C                     WRITEPM0671C1
     C                     WRITEPM0671C2
     C                     MOVE '0'       *IN61
     C                     EXSR #BLANK
      *
      ** IF PAGE BACKWARD IS REQUIRED SET ARRAY INDEX TO PREVIOUS PAGE
      ** HEADING. PROCESSING NOT REQUIRED FOR F13 AS NEXT PAGE DETERMINED
      ** AFTER F13 TAKEN
     C           WWMAFF    IFNE 'M'
     C           WWF13     IFNE 'Y'
     C           *IN24     IFEQ '1'
     C           A         ANDGT1
     C           A         SUB  1         A       50
     C                     END
      *
      ** SET UP WORKFIELD CONTAINING NUMBER OF PAGES OF INFORMATION
     C           WWMAFF    IFEQ 'D'
     C                     Z-ADDWWTDLV    WWNOPG  50
     C                     ELSE
     C                     Z-ADDWWTDFL    WWNOPG
     C                     END
      *
      ** IF PAGE FORWARD IS REQUIRED SET ARRAY INDEX TO NEXT PAGE
      ** HEADING
     C           *IN23     IFEQ '1'
     C           A         ANDLTWWNOPG
     C           A         ADD  1         A
     C                     END
      *
      ** IF DETAILS RECEIVED FROM WINDOW PROGRAM PM0660 PERFORM LOKUP
      ** TO DETERMINE WHICH PAGE OF DETAILS ARE TO BE DISPLAYED
     C           WWPAG1    IFNE *BLANKS
     C                     Z-ADD1         A
      *
     C           WWMAFF    IFEQ 'D'
     C           WWPAG1    LOKUPTDD,A                72
      *
     C                     MOVELWWPAG1    WWPAGX 48
     C                     MOVELTDD,A     WWPAGY 48
     C           WWPAGX    IFEQ WWPAGY
     C                     ADD  1         A
     C                     END
     C                     ELSE
     C                     Z-ADD2         A
     C                     MOVE '1'       *IN72
     C                     END
      *
     C           *IN72     IFEQ '1'
     C           A         IFNE 1
     C           A         SUB  1         A
     C                     END
     C                     ELSE
      *
     C**********           MOVE *BLANKS   WWPAG2 61                                           CGL029
     C                     MOVE *BLANKS   WWPAG2 67                                           CGL029
     C           WWMAFF    IFEQ 'D'
     C           WWPAG2    LOKUPTDD,A                    72
     C                     END
     C           A         SUB  1         A
     C                     END
      *
     C                     MOVE *BLANKS   WWPAG1
     C                     END
     C                     END
     C                     END
      *
      ** MOVE PAGE HEADING FROM MATURE / LIVE ARRAY AS APPROPRIATE
      ** INTO DATA STRUCTURE USED TO ACCESS PMHOLDL1
     C           A         IFNE 0
     C           WWMAFF    OREQ 'M'
      *
     C           WWMAFF    IFEQ 'D'
     C                     MOVE TDD,A     WWPAGE
      *
      ** SAVE DISPLAY GROUP AND INSTRUMENT AT TOP OF PAGE
     C                     MOVELQFCCY1    WWDSPO
     C                     MOVELQFINNR    WWINNO
     C                     MOVE QMCNUM    QFCNUM
     C                     MOVE QMPTF1    QFPTFR
      *
      ** USE PAGE HEADING FROM ARRAY TO SET FILE POINTER FOR FIRST RECORD
      ** TO BE READ
     C           QFMODI    IFNE 'RE'
     C                     MOVE *BLANKS   QFTXT2
     C                     END
      *
     C           PMHOLA    SETLLPMHOLDLB
     C                     READ PMHOLDLB                 72
      * Reaccess PMHOLDPD file to position on the correct record.         160217
     C                     MOVEAHOAR,A    XRRN                            160217
     C           XRRN      IFNE 0                                         160217
     C           XRRN      DOUEQ0                                         160217
     C                     READ PMHOLDLB                 72               160217
     C                     SUB  1         XRRN                            160217
     C                     END                                            160217
     C                     END                                            160217
      *
      ** SET FILE POINTER FOR FLAT / MATURED POSITIONS
     C                     ELSE
      *
      ** IF THIS IS THE FIRST TIME FLAT/MATURED POSITIONS DISPLAYED SET
      ** FILE POINTER BEFORE FIRST RECORD
     C           WWF13     IFEQ 'Y'
     C                     MOVE WWFSTR    W2SCRN
     C                     EXSR #FILE
     C********** PMHOLD    SETLLPMMFHLPP                                  CPM005
     C**********           READ PMMFHLPP                 72               CPM005
     C           PMHOLD    SETLLPMMFHLPD                                  CPM005
     C                     READ PMMFHLPD                 72               CPM005
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWTSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWTSCR 68                                           CGL029
     C                     END
      *
      ** IF A ROLLUP HAS BEEN REQUESTED SET FILE POINTER AFTER LAST
      ** RECORD ON PREVIOUS SCREEN
     C           *IN23     IFEQ '1'
     C                     MOVE WWBSCR    W2SCRN
     C                     EXSR #FILE
     C********** PMHOLD    SETGTPMMFHLPP                                  CPM005
     C**********           READ PMMFHLPP                 72               CPM005
     C           PMHOLD    SETGTPMMFHLPD                                  CPM005
     C                     READ PMMFHLPD                 72               CPM005
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWTSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWTSCR                                              CGL029
     C                     END
      *
      ** IF A ROLLDOWN HAS BEEN REQUESTED SET FILE POINTER BEFORE FIRST
      ** RECORD ON PREVIOUS SCREEN
     C           *IN24     IFEQ '1'
     C                     MOVE WWTSCR    W2SCRN
     C                     EXSR #FILE
     C********** PMHOLD    SETLLPMMFHLPP                                  CPM005
     C**********           READPPMMFHLPP                 72               CPM005
     C           PMHOLD    SETLLPMMFHLPD                                  CPM005
     C                     READPPMMFHLPD                 72               CPM005
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWBSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWBSCR 68                                           CGL029
     C                     END
     C                     END
      *
      ** SET K EQUAL TO ZERO
     C                     Z-ADD0         K
      *
     C           *IN72     DOWEQ'0'
     C********** K         ANDLT7                                         CPM005
     C           K         ANDLT6                                         CPM005
     C           QFCNUM    ANDEQWWCNUM
     C           QFPTFR    ANDEQWWPTFR
      *
      ** SAVE DETAILS OF FIRST AND LAST RECORD ON SCREEN
     C                     EXSR #SCRN
     C           WWF13     IFEQ 'Y'
     C           *IN23     OREQ '1'
     C**********           MOVE W2SCRN    WWBSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWBSCR                                              CGL029
     C                     ELSE
     C**********           MOVE W2SCRN    WWTSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWTSCR                                              CGL029
     C                     END
      *
     C           QFRECI    IFEQ 'D'
     C           WWMAFF    ANDEQ'D'
     C           QFRECI    ORNE 'D'
     C           WWMAFF    ANDEQ'M'
      *
      ** CURRENCY CHANGED
     C           WWMAFF    IFEQ 'D'
     C           K         IFEQ 0
     C           WWDETT    ANDEQ'D'
     C           QFCCY1    ORNE WWDSPO
     C                     EXSR #P1004
     C                     ADD  1         K
     C                     MOVE QFCCY1    WWDSPO
      *
      ** WRITE DISPLAY GROUP HEADING RECORD IN SUBFILE
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN52
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
     C                     WRITEPM0671S1
     C                     WRITEPM0671S2
     C                     MOVE '0'       *IN59
     C                     MOVE '0'       *IN52
     C********** K         CABEQ7         #P1029                          CPM005
     C           K         CABEQ6         #P1029                          CPM005
     C                     EXSR #P1005
     C                     ADD  1         K
     C                     MOVE QFINNR    WWINNO
      *
      ** WRITE INSTRUMENT GROUP HEADING RECORD IN SUBFILE
     C                     MOVE '1'       *IN51
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
     C                     WRITEPM0671S1
     C                     WRITEPM0671S2
     C                     MOVE '0'       *IN51
     C********** K         CABEQ7         #P1029                          CPM005
     C           K         CABEQ6         #P1029                          CPM005
     C                     END
     C                     END
      *
      ** INSTRUMENT CHANGED
     C           WWMAFF    IFEQ 'D'
     C           K         IFEQ 0
     C           WWDETT    ANDEQ'I'
     C           K         OREQ 1
     C           WWDETT    ANDEQ'D'
     C           QFINNR    ORNE WWINNO
     C                     EXSR #P1005
     C                     ADD  1         K
     C                     MOVE QFINNR    WWINNO
      *
      ** WRITE INSTRUMENT GROUP HEADING RECORD IN SUBFILE
     C                     MOVE '1'       *IN51
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
     C                     WRITEPM0671S1
     C                     WRITEPM0671S2
     C                     MOVE '0'       *IN51
     C********** K         CABEQ7         #P1029                          CPM005
     C           K         CABEQ6         #P1029                          CPM005
     C                     END
     C                     END
      *
      ** IF MODULE ID IS 'SE'
     C           QFMODI    IFEQ 'SE'
     C                     EXSR #P1006
     C**                                                                  S10978
     C           S01496    IFEQ 'Y'                                       CPM005
     C                     EXSR P002                                      S10978
     C                     END                                            CPM005
     C**                                                                  S10978
     C                     END
      *
      ** IF MODULE ID IS NOT 'SE'
     C           QFMODI    IFNE 'SE'
     C                     EXSR #P1007
     C                     END
      *
     C                     ADD  1         K
      *
      ** WRITE A RECORD TO THE SUBFILE
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
      *
      ** FOR ROLL BACKWARDS ON MATURED POSITIONS WRITE SCREEN RECORDS
      ** OUT IN REVERSE SEQUENCE
     C           WWMAFF    IFEQ 'M'
     C           *IN24     ANDEQ'1'
     C                     Z-ADDRRN1      W1RRN1  50
     C                     Z-ADDRRN2      W1RRN2  50
     C********** 8         SUB  RRN1      RRN1                            CPM005
     C********** 8         SUB  RRN2      RRN2                            CPM005
     C           7         SUB  RRN1      RRN1                            CPM005
     C           7         SUB  RRN2      RRN2                            CPM005
     C                     END
      *
     C                     WRITEPM0671S1
     C                     WRITEPM0671S2
      *
      ** RESTORE SAVED VALUE OF RRN1 AND RRN2
     C           WWMAFF    IFEQ 'M'
     C           *IN24     ANDEQ'1'
     C                     Z-ADDW1RRN1    RRN1
     C                     Z-ADDW1RRN2    RRN2
     C                     END
      *
     C********** K         CABEQ7         #P1029                          CPM005
     C           K         CABEQ6         #P1029                          CPM005
     C                     END
      *
      ** READ NEXT HOLDING RECORD
     C           WWMAFF    IFEQ 'D'
     C                     READ PMHOLDLB                 72
     C                     ELSE
     C*
     C           *IN24     IFEQ '1'
     C**********           READPPMMFHLPP                 72               CPM005
     C                     READPPMMFHLPD                 72               CPM005
     C                     ELSE
     C**********           READ PMMFHLPP                 72               CPM005
     C                     READ PMMFHLPD                 72               CPM005
     C                     END
      *
     C                     END
     C                     END
      *
      ** IF NO LIVE RECORDS TO BE DISPLAYED OUTPUT BLANKS TO SUBFILE
     C                     ELSE
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
     C                     MOVE '1'       *IN59
     C                     MOVE '0'       *IN52
     C                     MOVE '0'       *IN51
     C                     MOVE *BLANKS   DDTOG1
     C                     MOVE *BLANKS   DDCCY1
     C                     MOVE *BLANKS   DDMKTP
     C                     MOVE *BLANKS   DDMKFX
     C                     MOVE *BLANKS   DDMVPC
     C                     MOVE *BLANKS   DDTOG2
     C                     MOVE *BLANKS   DDCCY2
     C                     MOVE *BLANKS   DDFOPR
     C                     MOVE *BLANKS   DDFXRA
     C                     MOVE *BLANKS   DDAIPC
     C                     MOVE *BLANKS   DDTOG3
     C                     MOVE *BLANKS   DDMVIC
     C                     MOVE *BLANKS   DDMKTY
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVE *BLANKS   DDTOG4
     C                     MOVE *BLANKS   DDAIIC
     C                     MOVE *BLANKS   DDFOLY
     C                     MOVE *BLANKS   DDEXPL
     C                     WRITEPM0671S1
     C                     WRITEPM0671S2
     C                     MOVE '0'       *IN59
     C                     MOVE '0'       *IN52
     C                     MOVE '0'       *IN51
     C                     MOVE '0'       *IN53
     C                     END
      *
     C           #P1029    ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1004   - ACCESS CURRENCY TOTALS                                *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #BLANK   - BLANK SCREEN FIELD                                    *
      **PMC1002**-*UPDATE**GDA********************************************CPM005
      **PMC1020**-*END*GROUPS*JOBS****************************************CPM005
      * ZSEDIT   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - LOAD SUBFILE                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCCYT   - DATABASE ERROR                                        *
      **WWGDA****-*DATAAREA**GDA******************************************CPM005
      * WWNARA   - OUTPUT FIELDS IN SUBFILE                              *
      * WWTOGA   - OUTPUT FIELDS IN SUBFILE                              *
      * WWDMV    - WORK FIELD DISPLAY AMOUNT                             *
      * WWINTV   - INTERIM TRADE/VALUE INDICATOR                         *
      *                                                                  *
      ********************************************************************
     C           #P1004    BEGSR
      *
      ** RESET FIELDS
     C                     EXSR #BLANK
      *
     C***********QFCCY1    CHAINSDCURRL0             73                   CPM005
      *
     C                     MOVELQFCCY1    @AJCD                           CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM '*DBERR'  @RTCD   7                       CPM005
     C                     PARM '*KEY   ' @OPTN   7                       CPM005
     C                     PARM           @AJCD   3                       CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
     C           @RTCD     IFNE *BLANKS                                   CPM005
     C************IN73     IFEQ '1'                                       CPM005
      *
      ***SET 'ENQUIRIES TERMINATING' FIELD IN *GDA TO 'Y'                 CPM005
      ** SET 'ENQUIRIES TERMINATING' FIELD IN *LDA TO 'Y'                 CPM005
     C                     MOVEL'Y'       QMENQT
      *
     C                     MOVEL'Y'       QMDBER           *****************
     C                     MOVEL'SDCURRL0'QMFILE           ** DB ERROR 06 **
     C                     MOVELQFCCY1    QMKEY            *****************
     C                     MOVEL'PM0671'  QMPGM
     C                     Z-ADD6         QMERRN
      ***UPDATE *GDA                                                      CPM005
      ** UPDATE *LDA                                                      CPM005
     C***********          CALL 'PMC1002'                                 CPM005
     C***********          PARM           WWGDA                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *
      ** END PROGRAM AND ACTIVE GROUP JOBS
     C***********          CALL 'PMC1020'                                 CPM005
      *
     C                     END
      *
      ** FILL RECORD OF SUBFILE
     C                     MOVEL*BLANK    DDACTN
      *
     C                     MOVEL*BLANK    FIELDA
     C                     MOVE *BLANKS   WWNARA
     C                     MOVE NARR,1    WWNARA
     C                     MOVELWWTOGA    DDTOG1
     C                     MOVELWWTOGA    DDTOG3
      *
     C**********           Z-ADDQFCNUM    K1CNUM                                              CSD027
     C                     MOVE QFCNUM    K1CNUM                                              CSD027
     C                     MOVELQFPTFR    K1PTFR
     C                     MOVELQFCCY1    K1CCY1
     C***********PMCCYT    CHAINPMCCYTPP             73                   CPM005
     C           PMCCYT    CHAINPMCCYTPD             73                   CPM005
      *
     C           *IN73     IFEQ '1'
     C                     Z-ADD0         QGPTPA
     C                     Z-ADD0         QGPTNA
     C                     Z-ADD0         QGPTMV
     C                     Z-ADD0         QGPVPA
     C                     Z-ADD0         QGPVNA
     C                     Z-ADD0         QGPVMV
     C                     Z-ADD0         QGPTAI
     C                     END
     C**
     C** FILL RECORD OF SUBFILE
     C**
     C                     Z-ADD0         WWPMV  150
     C                     Z-ADD0         WWDMV  150
     C                     Z-ADD0         WWPCT  180
     C                     MOVE *BLANK    WWPCTA  6
     C**
     C                     Z-ADD0         WWPTPA 130
     C           WWINTV    IFEQ 'T'
     C                     Z-ADDQMPMVT    WWPMV
     C           WWPTPA    ADD  QGPTPA    WWPTPA
     C           WWPTPA    SUB  QGPTNA    WWPTPA
     C           WWPTPA    SUB  QGPTMV    WWPTPA
     C                     Z-ADDWWPTPA    WWDMV
     C           WWDMV     ADD  QGPTAI    WWDMV
     C                     Z-ADDWWPTPA    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C**
     C                     Z-ADDQGPTAI    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     ELSE
     C                     Z-ADDQMPMVV    WWPMV
     C           WWPTPA    ADD  QGPVPA    WWPTPA
     C           WWPTPA    SUB  QGPVNA    WWPTPA
     C           WWPTPA    SUB  QGPVMV    WWPTPA
     C                     Z-ADDWWPTPA    WWDMV
     C           WWDMV     ADD  QGPTAI    WWDMV
     C                     Z-ADDWWPTPA    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C**
     C                     Z-ADDQGPTAI    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     END
     C**
     C**
     C           WWPMV     IFNE 0
     C           WWDMV     MULT 1000      WWPCT
     C           WWPCT     DIV  WWPMV     WWPCT     H
     C                     END
     C                     Z-ADDWWPCT     ZFLD15
     C                     Z-ADD1         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWPCTA
     C**
     C                     MOVE *BLANK    FIELDA
     C                     MOVE '('       FIELA1
     C                     MOVE WWPCTA    FIELA2
     C                     MOVE '%'       FIELA3
     C                     MOVE ')'       FIELA4
     C                     MOVELA6CYNM    WWNARA
     C                     MOVE QGCCY     WWNARA
     C**
     C                     MOVELWWTOGA    DDTOG2
     C**
     C                     MOVE *BLANK    FIELDD
     C                     MOVE '('       FIELD1
     C                     MOVE WWPCTA    FIELD2
     C                     MOVE '%'       FIELD3
     C                     MOVE ')'       FIELD4
     C                     MOVELA6CYNM    WWNARD
     C                     MOVE QGCCY     WWNARD
     C                     MOVELWWTOGD    DDTOG4
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1005   - ACCESS INSTRUMENT TYPE TOTALS                         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #BLANK   - BLANK SCREEN FIELD                                    *
      **PMC1002**-*UPDATE *GDA********************************************CPM005
      **PMC1020**-*END*GROUPS*JOBS****************************************CPM005
      * ZSEDIT   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - LOAD SUBFILE                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      **WWGDA****-*DATAAREA**GDA******************************************CPM005
      * WWNARB   - OUTPUT FIELDS IN SUBFILE                              *
      * WWTOGB   - OUTPUT FIELDS IN SUBFILE                              *
      *                                                                  *
      ********************************************************************
     C           #P1005    BEGSR
      *
      ** RESET FIELDS
     C                     EXSR #BLANK
     C*                                                                                       196468
     C** Instrument type is defaulted from PF/SDPORTPD if a blank                             196468
     C** instrument type is found.                                                            196468
     C** Indicator 35 was used as the operation's resulting indicator.                        196468
     C*                                                                                       196468
     C           QFINNR    IFEQ *BLANKS                                                       196468
     C           1         SETLLSDPORTPD                                                      196468
     C                     READ SDPORTPD                 35                                   196468
     C                     MOVE FCDINR    QFINNR                                              196468
     C                     END                                                                196468
      *
      ** ACCESS PF/SDPLINPD FOR THE INSTRUMENT TYPE DETAILS
      ** USING THE INSTRUMENT TYPE FROM THE HOLDINGS FILE
     C********** QFINNR    CHAINSDPLINPD             73                   CPM005
     C                     CALL 'AOPLINR0'                                CPM005
     C                     PARM '*MSG    'WWRTCD  7                       CPM005
     C                     PARM '*KEY    'WWOPTN  7                       CPM005
     C                     PARM QFINNR    WWKEY   3                       CPM005
     C           SDPLIN    PARM SDPLIN    DSFDY                           CPM005
     C**                                                                  CPM005
     C           WWRTCD    IFNE *BLANKS                                   CPM005
     C********** *IN73     IFEQ '1'                                       CPM005
      *
     C***SET*'ENQUIRIES*TERMINATING'*FIELD*IN *GDA*TO*'Y'                 CPM005
     C** SET 'ENQUIRIES TERMINATING' FIELD IN *LDA TO 'Y'                 CPM005
     C                     MOVEL'Y'       QMENQT
     C                     MOVEL'Y'       QMDBER           *****************
     C                     MOVEL'SDPLINPD'QMFILE           ** DB ERROR 02 **
     C                     MOVELQFINNR    QMKEY            *****************
     C                     Z-ADD2         QMERRN
     C***UPDATE *GDA                                                      CPM005
     C** UPDATE *LDA                                                      CPM005
     C**********           CALL 'PMC1002'                                 CPM005
     C**********           PARM           WWGDA                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *
      ** END PROGRAM AND ACTIVE GROUP JOBS
     C**********           CALL 'PMC1020'                                 CPM005
      *
     C                     END
     C                     MOVEL*BLANK    FIELDB
     C                     MOVE NARR,2    WWNARB
     C                     MOVELWWTOGB    DDTOG1
     C                     MOVELWWTOGB    DDTOG3
     C**
     C                     MOVE PDISTN    WWNARB
     C                     MOVE *BLANKS   WWNARD
     C                     MOVE PDISTN    WWNARD
      *
      ***ACCESS*PF/PMCIALPP*USING*PARAMETERS*FROM**GDA                    CPM005
      ** ACCESS PF/PMTMPTPD USING PARAMETERS FROM *LDA                    CPM005
     C**********           Z-ADDQFCNUM    K2CNUM                                              CSD027
     C                     MOVE QFCNUM    K2CNUM                                              CSD027
     C                     MOVELQFPTFR    K2PTFR
     C                     Z-ADDQFDSPS    K2DSPS
     C                     MOVELQFDSPG    K2DSPG
     C                     Z-ADDQFITDS    K2ITDS
     C                     MOVELQFINNR    K2INSC
     C                     MOVELQFCCY1    K2CCY1
     C***********PMCCY2    CHAINPMTMPTPP             73                   CPM005
     C           PMCCY2    CHAINPMTMPTPD             73                   CPM005
      *
     C           *IN73     IFEQ '1'
     C                     Z-ADD0         QTPTPA
     C                     Z-ADD0         QTPTNA
     C                     Z-ADD0         QTPTMV
     C                     Z-ADD0         QTPVPA
     C                     Z-ADD0         QTPVNA
     C                     Z-ADD0         QTPVMV
     C                     Z-ADD0         QTPTAI
     C                     END
     C*
     C** CALCULATE MARKET VALUE AND ACCRUED INTEREST FOR TRADE DATE POSNS
     C                     Z-ADD0         WWPTPA
     C           WWINTV    IFEQ 'T'
     C                     Z-ADDQMPMVT    WWPMV
     C           WWPTPA    ADD  QTPTPA    WWPTPA
     C           WWPTPA    SUB  QTPTNA    WWPTPA
     C           WWPTPA    SUB  QTPTMV    WWPTPA
     C                     Z-ADDWWPTPA    WWIMV
     C           WWIMV     ADD  QTPTAI    WWIMV
     C                     Z-ADDWWPTPA    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C**
     C                     Z-ADDQTPTAI    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     ELSE
     C*
     C** CALCULATE MARKET VALUE AND ACCRUED INTEREST FOR VALUE DATE POSNS
     C                     Z-ADDQMPMVV    WWPMV  150
     C           WWPTPA    ADD  QTPVPA    WWPTPA
     C           WWPTPA    SUB  QTPVNA    WWPTPA
     C           WWPTPA    SUB  QTPVMV    WWPTPA
     C                     Z-ADDWWPTPA    WWIMV
     C           WWIMV     ADD  QTPTAI    WWIMV  150
     C                     Z-ADDWWPTPA    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C**
     C                     Z-ADDQTPTAI    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     END
     C*
     C** CALCULATE PERCENTAGES
     C           WWPMV     IFNE 0
     C           WWIMV     MULT 1000      WWPCT  180
     C           WWPCT     DIV  WWPMV     WWPCT     H
     C                     END
     C                     Z-ADDWWPCT     ZFLD15
     C                     Z-ADD1         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWPCTA  6
     C**
     C                     MOVE *BLANK    FIELDB
     C                     MOVE '('       FIELB2
     C                     MOVE WWPCTA    FIELB3
     C                     MOVE '%'       FIELB4
     C                     MOVE ')'       FIELB5
     C**
     C                     MOVELWWTOGB    DDTOG2
     C**
     C                     MOVE *BLANK    FIELDD
     C                     MOVE '('       FIELD1
     C                     MOVE WWPCTA    FIELD2
     C                     MOVE '%'       FIELD3
     C                     MOVE ')'       FIELD4
     C**
     C                     MOVELWWTOGD    DDTOG4
      *
      ** FILL RECORD OF SUBFILE
     C                     MOVELQFINNR    DDTYPE
     C                     MOVEL'IT'      DDMODH
     C                     MOVEL*BLANK    DDACTN
     C                     MOVEL*BLANK    FIELDB
     C                     MOVE 'Y'       DDCOLR
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1006   - FORMAT 'SE' HOLDINGS                                  *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #BLANK   - BLANK SCREEN FIELD                                    *
      * ZSEDIT   -                                                       *
      * ZEDIT    -                                                       *
      * ZCCYXR   -                                                       *
      * ZDATE2   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - LOAD SUBFILE                                          *
      * #P1009   - LOAD SUBFILE WITH ALL POSITIONS                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWNAR1   - OUTPUT FIELDS IN SUBFILE                              *
      * WWNAR3   - OUTPUT FIELDS IN SUBFILE                              *
      * WWNOM1   - OUTPUT FIELDS IN SUBFILE                              *
      * WWNOM3   - OUTPUT FIELDS IN SUBFILE                              *
      * WWWR15   - EDIT OTHER AMOUNT                                     *
      * WWTOGW   - OUTPUT FIELDS IN SUBFILE                              *
      * WWTOGY   - OUTPUT FIELDS IN SUBFILE                              *
      * WWPRI3   - EDIT MARKET PRICE                                     *
      * WWPRI1   - EDIT MARKET YIELD                                     *
      * WWRATE   - EDIT MARKET FX RATE                                   *
      * WWNARC   - OUTPUT FIELDS IN SUBFILE                              *
      * WWSECU   - DISPLAY NARRATIVE                                     *
      * WWTOGC   - OUTPUT FIELD IN SUBFILE                               *
      * WWPRIC   - EDIT MARKET YIELD                                     *
      * WWGLOB   - GLOBAL POSITION                                       *
      *                                                                  *
      ********************************************************************
     C           #P1006    BEGSR
      *
      ** RESET FIELDS
     C                     EXSR #BLANK
      *
      ** LOAD DISPLAY GROUP AND INSTRUMENT TYPE INFORMATIONS
      ** FOR FURTHER READ
     C                     MOVELQFDSPG    DDDSPH
     C                     MOVELQFINNR    DDINRH
     C                     Z-ADDQFDSPS    DDDSSH
     C                     Z-ADDQFITDS    DDINSH
     C                     MOVE QFSPLD    DDSPLH
      *
      ** SAVE SECURITY SHORT NAME AND TRANSACTION NUMBER IN HIDDEN FIELD
     C                     MOVELQFTDSS    DDSHOR
     C                     MOVELQFTRNB    DDTRNH
     C                     MOVELQFTVDA    DDTVDH
      *
      ** SAVE RECI
     C                     MOVELQFRECI    DDRECH
      *
      ** MOVE MIDAS INSTRUMENT NAME TO NARRATIVE
     C                     MOVELQFTXT1    WWNAR1
     C                     MOVELQFTXT2    WWNAR3
     C                     MOVELQFMODI    DDMODH
      *
      ** CONVERT THE LINE AMOUNT 1
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
      *
      ** CONVERT THE OTHER AMOUNT
     C           QFOAMT    IFEQ *HIVAL
     C***********QFPOST    ANDEQ'C'                                 CPM005CPM005
     C           QFAMT1    OREQ QFOAMT
     C***********QFPOST    ANDEQ'C'                                 CPM005CPM005
     C                     MOVE *BLANKS   WWNOM3
     C                     ELSE
     C                     Z-ADDQFOAMT    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWWR15 14
     C                     MOVELWWWR15    WWNOM3
     C                     MOVEL'('       WWNOM3
     C                     MOVE ')'       WWNOM3
     C                     END
      *
     C           QFSPLD    IFEQ 'Y'
     C                     MOVEL' P '     DDCCY2
     C                     MOVE '1'       *IN53
     C                     END
      *
     C                     MOVELWWTOGW    DDTOG1
     C                     MOVELWWTOGY    DDTOG2
      *
      ** CURRENCY 1 & CURRENCY 2
     C                     MOVELQFCCY1    DDCCY1
      *
      ** EDIT MARKET PRICE
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVE *BLANKS   DDMKTP                          CPM005
     C           QFMPRC    IFGT 0                                         CPM005
     C***********QFMPRC    IFGT 99999                                     167710
     C***********          Z-ADD3         ZADEC                           167710
     C***********          Z-ADD6         ZADIG                           167710
     C*** This test is not very useful, because at the moment             167710
     C***  field QFMPRC is 15/8 => cannot be greater than 9999999.        167710
     C           QFMPRC    IFGT 9999999                                   167710
     C                     Z-ADD3         ZADEC                           167710
     C                     Z-ADD8         ZADIG                           167710
     C                     Z-ADDQFMPRC    WWPRI3
     C                     MOVE WWPRI3    ZFIELD
     C                     EXSR ZEDIT                                     CPM005
     C                     MOVE ZFIELD    DDMKTP                          CPM005
     C                     ELSE
     C                     Z-ADDQFMPRC    WWPRI1
     C                     MOVE WWPRI1    ZFIELD
     C***********          Z-ADD5         ZADIG                           167710
     C                     Z-ADD7         ZADIG                           167710
     C                     Z-ADD4         ZADEC
     C                     END
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKTP
     C                     ELSE                                           CPM005
     C**********           Z-ADDQFMPRC    WWPRI1                    CPM005126062
     C**********           MOVE WWPRI1    ZFLD15                    CPM005126062
     C**********           Z-ADD4         ZDECS                     CPM005126062
     C**********           EXSR ZSEDIT                              CPM005126062
     C**********           MOVE ZOUT21    DDMKTP                    CPM005126062
     C                     MOVE WWPRI1    ZFIELD                          126062
     C                     Z-ADD7         ZADIG                           167710
     C                     Z-ADD4         ZADEC                           126062
     C                     EXSR ZEDIT                                     126062
     C                     MOVE ZFIELD    DDMKTP                          126062
     C                     END                                            CPM005
      *
      ** EDIT MARKET FX RATE
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFMFXR    WWRATE    H
     C                     MOVE WWRATE    ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKFX
      *
      ** CONVERT MARKET VALUE FROM INSTRUMENT TO PORTFOLIO CCY USING ZCCYX
     C                     Z-ADDQFMVAL    ZAMTF
     C                     Z-ADDQFCDP2    ZCDPF
     C                     Z-ADDQMPCDP    ZCDPT
     C                     Z-ADDQFMFXR    ZCRSRT
     C                     MOVE QFMFMD    ZCRSMD
     C                     EXSR ZCCYXR
      *
      ** EDIT MARKET VALUE IN PORTFOLIO CURRENCY
     C                     Z-ADDZAMTT     ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
      *
      ** EDIT MARKET VALUE IN INSTRUMENT CURRENCY
     C                     Z-ADDQFMVAL    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVIC
      *
      ** EDIT P&L MARKET
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
      *
      ** MOVE SECURITY SHORTNAME TO TRANSACTION/SECURITY REFERENCE
     C                     MOVELQFTXT1    WWNARC
     C                     MOVE *BLANKS   WWSECU
     C                     MOVE WWTOGC    DDTOG3
      *
     C                     MOVELQFTDSS    WWSECU
     C                     MOVELQFTXT2    WWNARC
     C                     MOVE WWTOGC    DDTOG4
     C                     MOVE *BLANKS   WWSECU
      *
      ** CONVERT ACCRUED INTEREST FROM INSTRUMENT TO PORTFOLIO CCY USING Z
     C                     Z-ADDQFACIS    ZAMTF
     C                     Z-ADDQFCDP2    ZCDPF
     C                     Z-ADDQMPCDP    ZCDPT
     C                     Z-ADDQFMFXR    ZCRSRT
     C                     MOVE QFMFMD    ZCRSMD
     C                     EXSR ZCCYXR
      *
      ** EDIT ACCRUED INTEREST IN PORTFOLIO CURRENCY
     C                     Z-ADDZAMTT     ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
      *
      ** EDIT ACCRUED INTEREST IN INSTRUMENT CURRENCY
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
      *
      ** EDIT BOOK PRICE
     C           QFBOPR    IFNE *ZERO
     C                     MOVEL*BLANKS   ZFIELD
     C           QFBOPR    IFGT 99999
     C                     Z-ADD3         ZADEC
     C                     Z-ADD6         ZADIG
     C                     Z-ADDQFBOPR    WWPRI3
     C                     MOVE WWPRI3    ZFIELD
     C                     ELSE
     C                     Z-ADDQFBOPR    WWPRI1    H
     C                     MOVE WWPRI1    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     END
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFOPR
     C                     ELSE
     C                     MOVE *BLANK    DDFOPR
     C                     END
      *
      ** EDIT BOOK (FOLIO) FX RATE
      ** IF POSITION TYPE NOT EQUAL TO 'FC' OR 'FO' ELSE OUTPUT
      ** VALUE DATE
     C           QFPOST    IFEQ 'FC'
     C           QFPOST    OREQ 'FO'
     C                     Z-ADDQFVDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    DDFXRA
     C                     ELSE
     C           QFBFXR    IFNE *ZERO
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFBFXR    WWRATE  84H
     C                     MOVE WWRATE    ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFXRA
     C                     ELSE
     C                     MOVE *BLANK    DDFXRA
     C                     END
     C                     END
      *
      ** EDIT FX P/L
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDEXPL
      *
      ** EDIT MARKET YIELD
      ** IF POSITION TYPE NOT EQUAL TO 'FC' OR 'FO' ELSE OUTPUT
      ** 'OPEN' OR 'CLOSED'
     C           QFPOST    IFNE 'FC'
     C           QFPOST    ANDNE'FO'
     C           QFMKYD    IFGT *ZERO
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFMKYD    WWPRIC    H
     C                     MOVE WWPRIC    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD5         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKTY
     C                     ELSE
     C           QFMKYD    IFEQ -9999
     C                     MOVE *BLANKS   DDMKTY
     C                     MOVE 'N/A '    DDMKTY
     C                     ELSE
     C                     MOVEL*BLANKS   DDMKTY
     C                     END
     C                     END
     C                     ELSE
     C           QFPOST    IFEQ 'FC'
     C                     MOVE 'Closed'  DDMKTY
     C                     ELSE
     C                     MOVE 'Open'    DDMKTY
     C                     END
     C                     END
      *
      ** EDIT BOOK YIELD
      ** IF POSITION TYPE NOT EQUAL TO 'FC' OR 'FO' ELSE OUTPUT
      ** VALUE DATE
     C           QFPOST    IFEQ 'FC'
     C           QFPOST    OREQ 'FO'
     C                     Z-ADDQFVDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    DDFOLY
     C                     ELSE
     C           QFBKYD    IFGT *ZERO
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFBKYD    WWPRIC    H
     C                     MOVE WWPRIC    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD5         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFOLY
     C                     ELSE
     C           QFBKYD    IFEQ -9999
     C                     MOVE *BLANKS   DDFOLY
     C                     MOVE 'N/A '    DDFOLY
     C                     ELSE
     C                     MOVEL*BLANKS   DDFOLY
     C                     END
     C                     END
     C                     END
      *
      ** FORMAT PORTFOLIO CURRENCY
     C           WWGLOB    IFNE 'Y'
     C                     MOVE *BLANKS   DDPTCY
     C                     MOVE *BLANKS   DDPTFR
     C                     ELSE
     C                     MOVE QMPTCY    DDPTCY
      *
     C           QFPTFR    IFEQ '9997'
     C**********           MOVE P9R997    DDPTFR                          CPM005
     C                     MOVE FCR997    DDPTFR                          CPM005
     C                     ELSE
     C                     MOVE QFPTFR    DDPTFR
     C                     END
     C                     END
     C*                                                                   S01124
     C** IF FX P/L EXISTS OUTPUT TEXT '+FX' IN CURRENCY 2                 S01124
     C           QFPOST    IFEQ 'FC'                                      S01124
     C           QFPOST    OREQ 'FO'                                      S01124
     C           QFPLFX    IFNE 0                                         S01124
     C                     MOVE '+FX'     DDCCY2                          S01124
     C                     END                                            S01124
     C                     END                                            S01124
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1007   - FORMAT NON 'SE' HOLDINGS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #BLANK   - BLANK SCREEN FIELD                                    *
      * ZEDIT    -                                                       *
      * ZSEDIT   -                                                       *
      * *PSSR    - PROCESS DATA BASE ERROR                               *
      * ZCCYCN   -                                                       *
      * ZCCYXR   -                                                       *
      * FFPRCS   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - LOAD SUBFILE                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWNAR1   - OUTPUT FIELDS IN SUBFILE                              *
      * WWNAR3   - OUTPUT FIELDS IN SUBFILE                              *
      * WWNOM3   - OUTPUT FIELDS IN SUBFILE                              *
      * WWNOM1   - OUTPUT FIELDS IN SUBFILE                              *
      * WWNOM2   - OUTPUT FIELDS IN SUBFILE                              *
      * WWDDAY   - DISPLAY SETTLEMENT DATE WHEN FF                       *
      * WWMNTH   - DISPLAY SETTLEMENT DATE WHEN FF                       *
      * WWYEAR   - DISPLAY SETTLEMENT DATE WHEN FF                       *
      * WWNOM4   - OUTPUT FIELDS IN SUBFILE                              *
      * WWSIGN   - DISPLAY NARRATIVE                                     *
      * WWTEXT   - DS FOR RETAIL                                         *
      * WWTCCY   - DS FOR RETAIL                                         *
      * WWTACO   - DS FOR RETAIL                                         *
      * WWTACS   - DS FOR RETAIL                                         *
      * WWWR15   - EDIT OTHER AMOUNT                                     *
      * WWORK5   - EDIT LINE FOR GUARANTEE                               *
      * WWORK9   - EDIT LINE FOR PLEDGE                                  *
      * WWORK3   - EDIT LINE FOR PLEDGE                                  *
      * WWTOGW   - OUTPUT FIELDS IN SUBFILE                              *
      * WWTOGY   - OUTPUT FIELDS IN SUBFILE                              *
      * WWPRI1   - EDIT MARKET YIELD                                     *
      * WWRATE   - EDIT MARKET FX RATE                                   *
      * WWNARC   - OUTPUT FIELDS IN SUBFILE                              *
      * WWSECU   - DISPLAY NARRATIVE                                     *
      * WWTOGC   - OUTPUT FIELD IN SUBFILE                               *
      * WWOPTS   - DISPLAY NARRATIVE WHEN FF                             *
      * WWFOIS   - DISPLAY NARRATIVE WHEN FF                             *
      * WWMTYR   - DISPLAY NARRATIVE WHEN FF                             *
      * WWDATE   - DISPLAY NARRATIVE WHEN FF                             *
      * WWTNBR   - DISPLAY NARRATIVE WHEN FF                             *
      * WWFFMT   - DISPLAY NARRATIVE                                     *
      * WWCCY1   - DISLPAY NARRATIVE                                     *
      * WWFFMC   - PAGE HEADINGS                                         *
      *                                                                  *
      ********************************************************************
     C           #P1007    BEGSR
      *
      ** RESET FIELDS
     C                     EXSR #BLANK
      *
      ** LOAD MIDAS INSTRUMENT NAME AND DETAILS ENQUIRIES IN SUBFILE
     C                     MOVELQFTXT1    WWNAR1
     C                     MOVELQFTXT2    WWNAR3
     C                     MOVEL*BLANKS   WWNOM3
      *
      ** SAVE RECI AND MODULE ID
     C                     MOVELQFRECI    DDRECH
     C                     MOVELQFMODI    DDMODH
     C                     Z-ADDQFAMT2    DDAMTH
     C*
     C** IF TRANSACTION IS FORWARD AND MODULE ID ONE OF 'FI' 'FX' 'MD'
     C** 'ML' 'FR' LE' OUTPUT TEXT 'FORWARD'
     C           QFMODI    IFEQ 'FI'                       B1
     C           QFMODI    OREQ 'FX'
     C           QFMODI    OREQ 'MD'
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'FR'
     C           QFMODI    OREQ 'LE'
      *
     C           QFTVDA    IFEQ 'T'                        B2
     C           QMTVPS    ANDEQ'T'
     C           QFTVDA    OREQ 'X'
     C           QMTVPS    ANDEQ'V'
     C                     MOVEL'FORWARD' WWNOM3
     C                     END                             E2
      *
      ** OUTPUT TEXT 'CHANGES PENDING' IF ANY DEAL AMENDMENTS
      ** OUTSTANDING
     C           QFDLAM    IFEQ 'Y'                        B2
     C           QFTVDA    IFEQ 'T'                        B3
     C                     MOVE '/CHG PDG'WWNOM3
     C                     ELSE                            X3
     C                     MOVEL'CHANGES 'WWNOM3
     C                     MOVE 'PENDING' WWNOM3
     C                     END                             E3
     C                     END                             E2
      *
     C                     END                             E1
      *
      ** IF MODULE ID = 'FF'
     C** If Bank Portfolios are supported, treat as if FF off             CPM005
     C           QFMODI    IFEQ 'FF'                       B1
     C           BGFUOP    ANDEQ'Y'                                       CPM005
     C           FCPORS    ANDNE'B'                                       CPM005
     C                     MOVEL*BLANKS   WWNOM1
      *
      ** SAVE TRANSACTION NUMBER & INSTRUMENT TYPE IN HIDDEN FIELDS
     C********** QFTRNB    IFLT 0                                                      CPM005 CLE148
     C**********           Z-SUBQFTRNB    WWORK4  60                                   CPM005 CLE148
     C                     MOVELQFTRNB    WRKFLD  60                                          CLE148
     C           WRKFLD    IFLT 0                                                             CLE148
     C                     Z-SUBWRKFLD    WWORK4  60                                          CLE148
     C                     MOVE WWORK4    DDTRNH                          CPM005
     C                     MOVE '-'       DDSIGH                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE QFTRNB    DDTRNH
     C                     MOVE ' '       DDSIGH                          CPM005
     C                     END                                            CPM005
     C                     MOVE QFFOIS    DDFOIH
     C                     Z-ADDQFCLON    DDCLOH
      *
      ** DISPLAY PURCHASE/SELL INDICATOR
     C                     MOVELQFDTYP    WWNOM2
      *
      ** DISPLAY SETTLEMENT DATE
     C**                                                                  CPM005
     C           BJDFIN    IFEQ 'M'                                       CPM005
     C                     MOVE '1'       *IN98                           CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C                     Z-ADDQFSETD    ZDAYNO                          CPM005
     C                     EXSR ZDATE2                                    CPM005
     C                     MOVELZDATE     WKSETD                          CPM005
     C**                                                                  CPM005
     C                     MOVE WWDSET    WWDDAY
     C                     MOVE WWMSET    WWMNTH
     C                     MOVE WWYSET    WWYEAR
     C                     MOVELWWSETD    WWNOM3
      *
      ** REFORMAT NUMBER OF OPEN CONTRACTS
      *
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C*
     C                     MOVELZOUT21    WWMK22 22
     C           QFDTYP    IFEQ 'S '
     C                     MOVE '- '      WWMK22
     C                     END
     C                     MOVE WWMK22    WWNOM1
     C                     END                             E1
      *
      ** IF MODULE ID = 'DL'
     C           QFMODI    IFEQ 'MD'
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'FR'
     C           QFMODI    OREQ 'FX'
      *
      ** SAVE TRANSACTION NUMBER IN HIDDEN FIELD
     C                     MOVE QFTRNB    DDTRNH
      *
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C           QFAMT1    IFGT *ZEROS
     C           QFMODI    ANDEQ'FX'
     C                     MOVE ZOUT21    WFLD16 16
     C                     MOVELWFLD16    WWNOM1
     C                     ELSE
     C                     MOVE ZOUT21    WWNOM1
     C                     END
     C*                                                                   CPM005
     C** FOR A MM LOAN NOMINAL SHOULD BE SIGNED '-'                       CPM005
     C           FCPORS    IFNE 'B'                                       CPM005
     C           QFDTYP    IFEQ 'IP'                                      CPM005
     C           QFDTYP    OREQ 'TI'                                      CPM005
     C           QFDTYP    OREQ 'LN'                                      CPM005
     C           QFDTYP    OREQ 'CL'                                      CPM005
     C           QFDTYP    OREQ 'DL'                                      CPM005
     C                     MOVE '-'       WWNOM1                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
      *
      ** ADD THE 'BUY OR SELL' INDICATOR IN NOMINAL 1
     C                     MOVELQFBYSF    WWNOM1
      *
      ** IF THE LINE 2 AMOUNT FROM HOLDINGS FILE IS NON ZERO
     C           QFAMT2    IFNE 0
      *
      ** EDIT THE LINE 2 AMOUNT
     C                     Z-ADDQFAMT2    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C           QFAMT2    IFGT *ZEROS
     C           QFMODI    ANDEQ'FX'
     C                     MOVE ZOUT21    WFLD16 16
     C                     MOVELWFLD16    WWNOM3
     C                     ELSE
     C                     MOVE ZOUT21    WWNOM3
     C                     END
      *
      ** ADD THE 'BUY OR SELL' INDICATOR IN NOMINAL 2
     C           QFBYSF    IFEQ 'B'
     C                     MOVEL'S'       WWNOM3
     C                     ELSE
     C                     MOVEL'B'       WWNOM3
     C                     END
      *
     C                     END
      *
      ** MOVE THE RELATED DEAL NUMBER INTO THE 'MARKET PRICE'
     C           QFRLDN    IFNE 0
     C                     MOVE QFRLDN    DDMKTP
     C                     END
      *
      ** CONVERT ACCRUED INTEREST INTO PORTFOLIO CURRENCY
     C           QFFPLC    IFNE *BLANKS
     C********** QFFPLC    CHAINSDCURRL0             73                   CPM005
      *
     C                     MOVELQFFPLC    @AJCD                           CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM '*DBERR'  @RTCD   7                       CPM005
     C                     PARM '*KEY   ' @OPTN   7                       CPM005
     C                     PARM           @AJCD   3                       CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
     C           @RTCD     IFNE *BLANKS                                   CPM005
     C********** *IN73     IFEQ '1'                                       CPM005
     C                     MOVEL'SDCURRL0'QMFILE           *****************
     C                     MOVELQFFPLC    QMKEY            ** DB ERROR 03 **
     C                     Z-ADD3         QMERRN           *****************
     C                     EXSR *PSSR
     C                     END
      *
     C                     Z-ADDQFACIS    ZAMTF
     C                     MOVE QFFPLC    ZCCYF
     C                     MOVE A6NBDP    ZCDPF
     C                     MOVE A6MDIN    ZMDINF
     C                     MOVE A6SPRT    ZRATEF
     C***********QMPTCY    CHAINSDCURRL0             73                   CPM005
      *
     C                     MOVELQMPTCY    @AJCD                           CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM '*DBERR'  @RTCD   7                       CPM005
     C                     PARM '*KEY   ' @OPTN   7                       CPM005
     C                     PARM           @AJCD   3                       CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
     C           @RTCD     IFNE *BLANKS                                   CPM005
     C********** *IN73     IFEQ '1'                                       CPM005
     C                     MOVEL'SDCURRL0'QMFILE           *****************
     C                     MOVELQMPTCY    QMKEY            ** DB ERROR 04 **
     C                     Z-ADD4         QMERRN           *****************
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE QMPTCY    ZCCYT
     C                     MOVE A6NBDP    ZCDPT
     C                     MOVE A6MDIN    ZMDINT
     C                     MOVE A6SPRT    ZRATET
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     ZFLD15
     C                     Z-ADDZCDPT     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDZCDPF     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C                     ELSE
     C                     Z-ADD0         ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     MOVE *BLANKS   DDAIIC
     C                     END
      *
      ** OUTPUT DESCRIPTIVE ACCORDING TO THE STATUS OF THE TRANSACTION
     C           QFOPCL    IFEQ 'O'
     C                     MOVE QFRLDN    DDMTPL
     C                     MOVEL'Close by'DDMTPL
     C                     END
      *
     C           QFOPCL    IFEQ 'L'
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVEL'Open    'DDMTPL
     C                     END
      *
     C           QFOPCL    IFEQ 'C'
      *
     C           QFDTYP    IFEQ 'OP'
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVEL'Closed  'DDMTPL
     C                     ELSE
     C                     MOVE QFRLDN    DDMTPL
     C                     MOVEL'Close of'DDMTPL
     C                     END
      *
     C                     END
      *
     C           QFOPCL    IFEQ 'M'
     C                     MOVEL'Matured 'DDMTPL
     C                     END
      *
     C                     END
      *
      ** IF MODULE ID = 'FI'
     C           QFMODI    IFEQ 'FI'
      *
      ** SAVE TRANSACTION NUMBER IN HIDDEN FIELD
     C                     MOVE QFTRNB    DDTRNH
      *
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
      *
     C                     END
      *
      ** IF MODULE ID = 'LE'
     C           QFMODI    IFEQ 'LE'
      *
      ** SAVE TRANSACTION NUMBER IN HIDDEN FIELD
     C                     MOVE QFTRNB    DDTRNH
     C           QMPORS    IFEQ 'B'                                       CPM005
     C                     Z-ADDQFAMT1    ZFLD15                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-SUBQFAMT1    ZFLD15
     C                     END                                            CPM005
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
      *
     C                     END
      *
      ** IF THE MODULE ID IS 'RE'
     C           QFMODI    IFEQ 'RE'
      *
      ** SAVE ACCOUNT CODE AND ACCOUNT SEQUENCE IN HIDDEN FIELDS
     C                     MOVELWWACCU    DDACCU                          CPM005
     C                     MOVELQFTXT2    WWTEXT
     C                     MOVE WWTCCY    DDCCYH
     C                     MOVE WWTACO    DDACOH
     C                     MOVE WWTACS    DDACSH
     C                     MOVE WWBRCD    DDBRCH                          CPM005
      *
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
      *
     C           QMPORS    IFNE 'B'                                       CPM005
     C           QFAMT1    IFLE 0
     C                     MOVE ' '       WWNOM1
     C                     ELSE
     C                     MOVE '-'       WWNOM1
     C                     END
     C                     END                                            CPM005
      *
      ** CONVERT THE OTHER AMOUNT
     C           QFOAMT    IFEQ *HIVAL
     C           QFAMT1    OREQ QFOAMT                                    38412
     C                     MOVE *BLANKS   WWNOM3
     C                     ELSE
     C                     Z-ADDQFOAMT    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWWR15 14
     C           QMPORS    IFNE 'B'                                       CPM005
     C           QFOAMT    IFLE 0
     C                     MOVE ' '       WWWR15
     C                     ELSE
     C                     MOVE '-'       WWWR15
     C                     END
     C                     END                                            CPM005
     C                     MOVELWWWR15    WWNOM3
     C                     MOVEL'('       WWNOM3
     C                     MOVE ')'       WWNOM3
     C                     END
      *
     C                     END
      *
      ** IF MODULE ID = 'LB'
     C           QFMODI    IFEQ 'LB'
      *
      ** SAVE TRANSACTION NUMBER IN HIDDEN FIELD
     C                     MOVE QFTRNB    DDTRNH
      *
      * STORE GUARANTEE TYPE FOR LOMBARDS CREDIT IN HIDDEN FIELD
     C                     MOVE QFINNR    DDTYPE
     C                     MOVE QFTXT2    WRK14  14
     C                     Z-ADDRRN1      PL      20
     C                     ADD  1         PL
     C                     MOVELWRK14     DTORDN  3
     C                     MOVE DTORDN    ORD,PL
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
      *
      ** SET UP INDICATOR STATING WHETHER GUARANTEE / PLEDGE GIVEN OR
      ** OR RECEIVED
     C                     MOVELQFTXT2    WWORK5  5
     C           WWORK5    IFEQ 'GIVEN'
     C                     MOVEL'G'       WWNOM1
     C                     ELSE
     C                     MOVEL'R'       WWNOM1
     C                     END
      *
      ** EDIT THE LINE 2 AMOUNT FOR PLEDGES
     C                     MOVELQFTXT2    WWORK9  9
     C                     MOVE WWORK9    WWORK3  3
     C           WWORK3    IFNE *BLANKS
     C           WWORK3    ANDNE'FXD'
     C                     Z-ADDQFAMT2    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM3
     C                     MOVEL'U'       WWNOM3
     C                     ELSE
     C                     MOVE *BLANKS   WWNOM3
     C                     MOVE *BLANKS   QFCCY2
     C                     END
      *
     C                     END
      *
     C                     MOVELWWTOGW    DDTOG1
     C                     MOVELWWTOGY    DDTOG2
      *
      ** CURRENCY 1 & CURRENCY 2
     C                     MOVELQFCCY1    DDCCY1
     C           QFMODI    IFEQ 'FF'
     C                     MOVEL*BLANKS   DDCCY2
     C                     ELSE
     C                     MOVELQFCCY2    DDCCY2
     C                     END
      *
      ** IF THE MARKET PRICE IS NON ZERO
     C           QFMPRC    IFNE 0
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFMPRC    WWPRI1    H
     C                     MOVE WWPRI1    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKTP
     C                     ELSE
      *
     C           QFRLDN    IFEQ 0
     C                     MOVEL*BLANKS   DDMKTP
     C                     END
      *
     C                     END
      *
      ** CONVERT MARKET VALUE FROM INSTRUMENT TO PORTFOLIO CCY USING ZCCYX
     C           QFAMT2    IFEQ 0
     C           QFMODI    OREQ 'FF'
     C                     Z-ADDQFMVAL    ZAMTF
     C                     Z-ADDQFCDP1    ZCDPF
     C                     Z-ADDQMPCDP    ZCDPT
     C                     Z-ADDQFMFXR    ZCRSRT
     C                     MOVE QFMFMD    ZCRSMD
     C                     EXSR ZCCYXR
      *
      ** EDIT MARKET VALUE IN PORTFOLIO CURRENCY
     C                     Z-ADDZAMTT     ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
      *
      ** FOR FX DEALS OUTPUT FX PROFIT AND LOSS AS MARKET VALUE
     C                     ELSE
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
      *
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C                     END
      *
      ** EDIT MARKET VALUE IN INSTRUMENT CURRENCY
     C                     Z-ADDQFMVAL    ZFLD15
     C           QFAMT2    IFNE 0
     C           QFMODI    ANDNE'FF'
     C           QFFPLC    IFEQ QFCCY1
     C                     Z-ADDQFCDP1    ZDECS
     C                     ELSE
     C                     Z-ADDQFCDP2    ZDECS
     C                     END
     C                     ELSE
     C                     Z-ADDQFCDP1    ZDECS
     C                     END
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVIC
      *
      ** IF THE MARKET FX RATE IS NON ZERO
     C           QFMFXR    IFNE 0
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFMFXR    WWRATE    H
     C                     MOVE WWRATE    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKFX
     C                     ELSE
     C                     MOVEL*BLANKS   DDMKFX
     C                     END
      *
      ** IF THE P/L MARKET IS NON ZERO
     C           QFPLMK    IFNE 0
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
      *
     C                     ELSE
      *
     C           QFOPCL    IFEQ *BLANKS
     C                     MOVEL*BLANKS   DDMTPL
     C                     END
      *
     C                     END
      *
      ** MOVE TRANSACTION NUMBER TO TRANSACTION REFERENCE
      ** SET UP FIELDS ON SECON SCREEN
     C                     MOVELQFTXT1    WWNARC
     C                     MOVE *BLANKS   WWSECU
      *
     C           QFMODI    IFNE 'RE'
     C                     MOVELQFTRNB    WWSECU
     C                     END
      *
      ** SET UP PROFIT / LOSS CURRENCY
     C           QFMODI    IFEQ 'FX'
     C           QFOPCL    ANDNE'C'
     C           QFOPCL    ANDNE'M'
     C                     MOVE QFFPLC    WWTOGC
     C                     END
     C                     MOVE WWTOGC    DDTOG3
      *
     C                     MOVE *BLANKS   WWSECU
     C                     MOVELQFTXT2    WWNARC
      *
      ** DISPLAY AMERICAN OR EUROPEAN ONLY FOR FF
     C** If Bank Portfolios are supported, treat as if FF off             CPM005
     C           QFMODI    IFEQ 'FF'
     C           BGFUOP    ANDEQ'Y'                                       CPM005
     C           FCPORS    ANDNE'B'                                       CPM005
     C*
     C                     SELEC
     C           QFAEIN    WHEQ 'A'                        B2
     C                     MOVEL'AMERICAN'WWSECU
     C           QFAEIN    WHEQ 'E'                        B3
     C                     MOVEL'EUROPEAN'WWSECU
     C                     OTHER                           X3
     C                     MOVEL*BLANKS   WWSECU
     C                     ENDSL
      *
      ** DISPLAY NARRATIVE
     C                     MOVEL*BLANKS   WWOPTS
     C                     MOVELQFFOIS    WWFOIS
     C                     MOVELWWFFMY    WWMTYR
     C                     MOVELWWSETD    WWDATE
     C********** QFTRNB    IFLT 0                                                      CPM005 CLE148
     C**********           Z-SUBQFTRNB    QFTRNB                                       CPM005 CLE148
     C**********           MOVELQFTRNB    WWTNBR                                       CPM005 CLE148
     C                     MOVELQFTRNB    WRKFLD                                              CLE148
     C           WRKFLD    IFLT 0                                                             CLE148
     C                     Z-SUBWRKFLD    WRKFLD                                              CLE148
     C                     MOVELWRKFLD    WWTNBR                                              CLE148
     C                     MOVE '-'       WWNEGS                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVELQFTRNB    WWTNBR
     C                     MOVE ' '       WWNEGS                          CPM005
     C                     END                                            CPM005
     C                     MOVELWWOPTS    DDTOG3
      *
      ** DISPLAY INSTRUMENT CURRENCY ON SECOND LINE
     C                     MOVEL*BLANKS   WWFFMT
     C                     MOVELQFCCY1    WWCCY1
      *
     C                     END
      *
     C                     MOVE WWTOGC    DDTOG4
      *
      ** IF THE ACCRUED INTEREST AMOUNT IS NON ZERO EDIT FOR OUTPUT
     C           QFMODI    IFEQ 'RE'
     C           QFMODI    OREQ 'FI'
     C           QFMODI    OREQ 'LE'
     C           QFMODI    OREQ 'MD'
     C           QFMODI    OREQ 'ML'
     C           QFAMT2    ANDEQ0
      *
      ** CONVERT ACCRUED INTEREST FROM INSTRUMENT TO PORTFOLIO CCY USING Z
     C                     Z-ADDQFACIS    ZAMTF
     C                     Z-ADDQFCDP1    ZCDPF
     C                     Z-ADDQMPCDP    ZCDPT
     C                     Z-ADDQFMFXR    ZCRSRT
     C                     MOVE QFMFMD    ZCRSMD
     C                     EXSR ZCCYXR
      *
      ** EDIT ACCRUED INTEREST IN PORTFOLIO CURRENCY
     C                     Z-ADDZAMTT     ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
      *
      ** EDIT ACCRUED INTEREST IN INSTRUMENT CURRENCY
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C                     ELSE
      *
     C           QFOPCL    IFEQ *BLANKS
     C                     MOVEL*BLANKS   DDAIPC
     C                     MOVEL*BLANKS   DDAIIC
     C                     END
      *
     C                     END
      *
      ** IF THE BOOK PRICE IS NON ZERO
     C           QFBOPR    IFNE 0
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFBOPR    WWPRI1    H
     C                     MOVE WWPRI1    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFOPR
     C                     ELSE
     C                     MOVEL*BLANKS   DDFOPR
     C                     END
      *
      ** IF THE BOOK FX RATE IS NON ZERO
     C           QFBFXR    IFNE 0
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFBFXR    WWRATE    H
     C                     MOVE WWRATE    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFXRA
     C                     ELSE
     C                     MOVEL*BLANKS   DDFXRA
     C                     END
      *
     C           QFMODI    IFEQ 'LE'
     C           QFMODI    OREQ 'MD'
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'FX'
     C           QFMODI    OREQ 'FR'
      *
      ** CONVERT THE P&L MARKET
     C           QFAMT2    IFEQ 0
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
     C                     END
      *
      ** EDIT THE FX P/L
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDEXPL
      *
     C                     ELSE
     C                     MOVEL*BLANKS   DDMTPL
     C                     MOVEL*BLANKS   DDEXPL
     C                     END
      *
      ** SET OTHER FIELDS TO BLANK
     C                     MOVEL*BLANKS   DDMKTY
     C                     MOVEL*BLANKS   DDFOLY
      *
      ** DISPLAY WHEN FF
     C** If Bank Portfolios are supported, treat as if FF off             CPM005
     C           QFMODI    IFEQ 'FF'
     C           BGFUOP    ANDEQ'Y'                                       CPM005
     C           FCPORS    ANDNE'B'                                       CPM005
      *
      ** PURCHASE INTEREST
     C           QFPUIT    IFNE *ZEROS
     C                     Z-ADDQFPUIT    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C                     MOVELWWFFMC    DDFOLY
     C                     ELSE
     C                     MOVEL*BLANKS   DDAIIC
     C                     MOVEL*BLANKS   DDFOLY
     C                     END
      *
      ** NBR OF CONTRACT <> NBR OF ORIGINAL CONTRACT
     C           QFAMT1    IFNE QFAMT2
     C*
     C           QFAMT1    IFNE *ZEROS
     C                     MOVE ' Part Cl'DDFOLY
     C                     ELSE
     C                     MOVE ' Closed 'DDFOLY
     C                     END
     C*
     C                     ELSE
     C                     MOVE ' Open   'DDFOLY
     C                     END
      *
      ** ACCESS INTYPD TO RETRIEVE TICKS DENOMINATOR AND MINIMUM PRICE
      ** FLUCTUATION TO DISPLAY MARKET AND BOOK PRICE
     C           QFFOIS    CHAININTYP                73
     C           *IN73     IFEQ '1'                        *****************
     C                     MOVEL'INTYP'   QMFILE           ** DB ERROR 05 **
     C                     MOVELQFFOIS    QMKEY            *****************
     C                     Z-ADD5         QMERRN
     C                     EXSR *PSSR
     C                     END
      *
      ** MARKET PRICE
     C           QFMPRC    IFNE *ZEROS
     C                     Z-ADDQFMPRC    FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C***********          MOVELFFSPRC    DDMKTP                          CPM005
      ** Ouput of FFSPRC now 16 long therefore move in most significant   CPM005
      ** part of FFSPRC.                                                  CPM005
      ** Determine number of leading and trailing blanks.                 CPM005
     C           ' '       CHECKFFSPRC    @L      20                      CPM005
     C           ' '       CHEKRFFSPRC    @R      20                      CPM005
      *                                                                   CPM005
      ** Check if trailing zeroes required (as determined by MNPF).       CPM005
     C           TKDM      IFEQ 100                                       CPM005
     C                     MOVE MNPF      TMPMNP 15                       CPM005
     C           '1'       CHECKTMPMNP    @NDP    20                      CPM005
     C           @NDP      IFGT @R                                        CPM005
     C                     Z-ADD@NDP      @R                              CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
      ** Determine number of characters to extract.                       CPM005
     C           @R        SUB  @L        RSUBL   20                      CPM005
     C                     ADD  1         RSUBL                           CPM005
      ** Extract relevant characters.                                     CPM005
     C           RSUBL     SUBSTFFSPRC:@L DDMKTP    P                     CPM005
     C                     ELSE
     C                     MOVEL*BLANKS   DDMKTP
     C                     END
      *
      ** BOOK PRICE
     C           QFBOPR    IFNE *ZEROS
     C                     Z-ADDQFBOPR    FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C***********          MOVELFFSPRC    DDFOPR                          CPM005
      ** Ouput of FFSPRC now 16 long therefore move in most significant   CPM005
      ** part of FFSPRC.                                                  CPM005
      ** Determine number of leading and trailing blanks.                 CPM005
     C           ' '       CHECKFFSPRC    @L      20                      CPM005
     C           ' '       CHEKRFFSPRC    @R      20                      CPM005
      *                                                                   CPM005
      ** Check if trailing zeroes required (as determined before by MNPF).CPM005
     C           TKDM      IFEQ 100                                       CPM005
     C           @NDP      ANDGT@R                                        CPM005
     C                     Z-ADD@NDP      @R                              CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
      ** Determine number of characters to extract.                       CPM005
     C           @R        SUB  @L        RSUBL   20                      CPM005
     C                     ADD  1         RSUBL                           CPM005
      ** Extract relevant characters.                                     CPM005
     C           RSUBL     SUBSTFFSPRC:@L DDFOPR    P                     CPM005
     C                     ELSE
     C                     MOVEL*BLANKS   DDFOPR
     C                     END
      *
      ** PROFIT AND LOSS MARKET
     C           QFPLMK    IFNE *ZEROS
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
     C                     ELSE
     C                     MOVEL*BLANKS   DDMTPL
     C                     END
      *
      ** PROFIT AND LOSS MARKET FX
     C           QFPLFX    IFNE *ZEROS
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDEXPL
     C                     ELSE
     C                     MOVEL*BLANKS   DDEXPL
     C                     END
      *
      ** DISPLAY ACCRUED INTEREST
     C           QFACIS    IFNE *ZEROS
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     ELSE
     C                     MOVEL*BLANKS   DDAIPC
     C                     END
      *
     C                     END
     C*
     C** IF DISPLAYING THE NOTIONAL FX DEAL OVERWRITE FIR
     C           QFMODI    IFEQ 'FX'
     C           WWMAFF    IFEQ 'D'
     C           QFBYSF    ANDEQ'S'
     C                     MOVE DDCCY1    DDCCY2
     C                     MOVE *BLANKS   DDCCY1
     C                     MOVELDDTOG1    WFSIXT 16
     C                     MOVELWFSIXT    DDTOG2
     C                     MOVE *BLANKS   WFSIXT
     C                     MOVELWFSIXT    DDTOG1
     C                     ELSE
     C                     MOVE *BLANKS   DDCCY2
     C                     MOVE *BLANKS   WFSIXT
     C                     MOVELWFSIXT    DDTOG2
     C                     END
     C                     END
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1008   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1009   - LOAD SUBFILE WITH ALL POSITIONS                       *
      * #U1001   - FILL HEADER FIELD                                     *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS HOLDINGS                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWGLOB   - GLOBAL POSITION                                       *
      * WWDISP   - SCREEN TO OUTPUT                                      *
      *                                                                  *
      ********************************************************************
     C           #P1008    BEGSR
      *
     C                     MOVE '1'       *IN55
      *
      ** LOAD SUBFILE WITH PORTFOLIO & GLOBAL POSITION
     C                     MOVEL'Y'       WWGLOB  1
     C                     EXSR #P1009
     C                     MOVE 'N'       WWGLOB
      *
      ** DO UNTIL CMD3 OR ENTER PRESSED
     C           *INKC     DOUEQ'1'
     C           *INKL     OREQ '1'
      *
      ** IF THE SCREEN DISPLAY INDICATOR IS '1'
     C           WWDISP    IFEQ '1'
      *
      ** FORMAT SUBFILE
     C                     EXSR #U1001
     C                     MOVE '1'       *IN53
     C                     WRITEPM0671F4
     C                     WRITEPM0671F1
     C                     EXFMTPM0671C3
     C                     ELSE
      *
      ** FORMAT SUBFILE
     C                     EXSR #U1001
     C                     MOVE '0'       *IN53
     C                     WRITEPM0671F4
     C                     WRITEPM0671F1
     C                     EXFMTPM0671C4
     C                     END
      *
      ** SET SCREEN INDICATOR ON
     C                     MOVE '0'       *IN80
      *
      ** IF F11 TAKEN
     C           *INKK     IFEQ '1'
      *
     C           WWDISP    IFEQ '1'
     C                     MOVEL'2'       WWDISP
     C                     MOVE '0'       *IN54
     C                     ELSE
     C                     MOVEL'1'       WWDISP
     C                     MOVE '1'       *IN54
     C                     END
      *
     C                     END
      *
      ** IF ENTER HAS BEEN PRESSED
     C                     END
      *
     C                     MOVE '1'       *IN55
     C                     MOVE '0'       *INKL
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1009   - LOAD SUBFILE WITH ALL POSITIONS                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - PROCESS DATA BASE ERROR                               *
      * #P1006   - FORMAT 'SE' HOLDINGS                                  *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1008   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCNM1   - WORK FIELD CUSTOMER NBR                               *
      * WWTDS1   - KFIELD                                                *
      * WWTVD1   - KFIELD                                                *
      * WWPTF1   - KFIELD                                                *
      * WWMAFF   - FIRST TIME PROGRAM CALLED                             *
      *                                                                  *
      ********************************************************************
     C           #P1009    BEGSR
      *
     C                     MOVE '1'       *IN61
     C                     WRITEPM0671C3
     C                     WRITEPM0671C4
     C                     MOVE '0'       *IN61
     C                     Z-ADD0         RRN3
     C                     Z-ADD0         RRN4
      *
     C                     MOVE WWCNUM    WWCNM1
     C                     MOVE DDSHOR    WWTDS1
     C                     MOVE DDTVDH    WWTVD1
     C                     MOVE *LOVAL    WWPTF1
      *
      *  READ ALL HOLDINGS FOR THIS SECURITY,CUSTOMER & TRADE/VALUE BASIS
     C           PMHOL6    SETLLPMHOLDL6
     C                     READ PMHOLDL6                 75
      *
     C           QFTDSS    DOWEQWWTDS1
     C           QFCNUM    ANDEQWWCNM1
     C           QFTVDA    ANDEQWWTVD1
     C           *IN75     ANDEQ'0'
      *
      ** WRITE TO SUBFILE IF NORMAL PORTFOLIO HOLDING
     C           QFPTFR    IFNE '9998'
     C           QFPTFR    ANDNE'9999'
     C           QFRECI    IFEQ 'D'
     C           QFRECI    ORNE 'D'
     C           WWMAFF    ANDEQ'M'
      *
      ** ACCESS PORTFOLIO DETAILS TO OBTAIN CURRENCY
     C           QFPTFR    IFNE '9997'
     C********** KLPORT    CHAINPMPORTPP             73                   CPM005
     C           KLPORT    CHAINPMPORTPD             73                   CPM005
      *
     C           *IN73     IFEQ '1'
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE PNPTCY    QMPTCY  3
     C                     Z-ADDPNPCDP    QMPCDP  10
     C                     ELSE
     C                     MOVE QMCSBY    QMPTCY  3
     C                     Z-ADDQMBYDP    QMPCDP  10
     C                     END
     C                     EXSR #P1006
      *
      ** REFORMAT DETAILS RECIVED FROM #P1006
     C                     MOVE DDTOG1    DDTOG5
     C                     MOVE DDTOG2    DDTOG6
     C           WWNOM3    IFNE *BLANKS
     C                     MOVEL'('       DDTOG6
     C                     END
     C                     MOVE DDMKTY    DDMKY1
     C                     MOVE DDFOLY    DDFOY1
      *
     C                     ADD  1         RRN3    40
     C                     ADD  1         RRN4    40
     C                     WRITEPM0671S3
     C                     WRITEPM0671S4
     C                     END
     C                     END
      *
     C                     READ PMHOLDL6                 75
      *
     C                     END
     C*                                                                   CPM005
     C** IF NO DETAILS WRITTEN TO SUBFILE OUTPUT TEXT 'NO OPEN            CPM005
     C** POSITIONS'                                                       CPM005
     C           RRN3      IFEQ 0                                         CPM005
     C           RRN4      ANDEQ0                                         CPM005
     C                     MOVE *BLANKS   DDPTFR                          CPM005
     C                     MOVE *BLANKS   DDCCY1                          CPM005
     C                     MOVE *BLANKS   DDTOG5                          CPM005
     C                     MOVE *BLANKS   DDMKTP                          CPM005
     C                     MOVE *BLANKS   DDMKFX                          CPM005
     C                     MOVE *BLANKS   DDMVPC                          CPM005
     C                     MOVE *BLANKS   DDPTCY                          CPM005
     C                     MOVE *BLANKS   DDCCY2                          CPM005
     C                     MOVE *BLANKS   DDTOG6                          CPM005
     C                     MOVE *BLANKS   DDFOPR                          CPM005
     C                     MOVE *BLANKS   DDFXRA                          CPM005
     C                     MOVE *BLANKS   DDAIPC                          CPM005
     C                     MOVE *BLANKS   DDTOG3                          CPM005
     C                     MOVE *BLANKS   DDMVIC                          CPM005
     C                     MOVE *BLANKS   DDMKY1                          CPM005
     C                     MOVE *BLANKS   DDMTPL                          CPM005
     C                     MOVE *BLANKS   DDPTCY                          CPM005
     C                     MOVE *BLANKS   DDTOG4                          CPM005
     C                     MOVE *BLANKS   DDAIIC                          CPM005
     C                     MOVE *BLANKS   DDFOY1                          CPM005
     C                     MOVE *BLANKS   DDEXPL                          CPM005
     C                     MOVE 'NO OPEN' DDTOG6                          CPM005
     C                     MOVEL'POSITION'DDFOPR                          CPM005
     C                     MOVE 'S '      DDFOPR                          CPM005
     C                     MOVE 'NO OPEN' DDTOG4                          CPM005
     C                     MOVEL'POSITION'DDAIIC                          CPM005
     C                     MOVE 'S      ' DDAIIC                          CPM005
     C                     ADD  1         RRN3    40                      CPM005
     C                     ADD  1         RRN4    40                      CPM005
     C                     WRITEPM0671S3                                  CPM005
     C                     WRITEPM0671S4                                  CPM005
     C                     END                                            CPM005
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1010   - DISPLAY INSTRUMENT DETAILS                            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PM2000   - DEALS DETAILS                                         *
      * PM2010   - LOAN DETAILS                                          *
      * PM2020   - SE DETAILS                                            *
      * PM2030   - FO INSTRUMENT DETAILS                                 *
      * PM2040   - RETAILS ACCOUNT DETAILS                               *
      * LBTYP    - RETRIEVE GUARANTEES PLEDGES TYPE                      *
      * PM2130   - GUARANTEES AND PLEDGES                                *
      * PM2140   - FIDUCIARY DEPOSIT                                     *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS HOLDINGS                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1010    BEGSR
      *
      ** MODULE ID 'DL'
     C           DDMODH    IFEQ 'FX'
     C           DDMODH    OREQ 'MD'
     C           DDMODH    OREQ 'ML'
     C           DDMODH    OREQ 'FR'
      *
      ** CALL PROGRAM 'PM2000' - DEAL DETAILS
     C                     CALL 'PM2000'
     C                     PARM           DDTRNH
      *
     C                     END
      *
      ** MODULE ID 'LE'
     C           DDMODH    IFEQ 'LE'
      *
      ** CALL PROGRAM 'PM2010' - LOANS DETAILS
     C                     CALL 'PM2010'
     C                     PARM           DDTRNH
      *
     C                     END
      *
      ** MODULE ID 'SE'
     C           DDMODH    IFEQ 'SE'
      *
      ** CALL PROGRAM 'PM2020' - SECURITY DETAILS
     C                     CALL 'PM2020'
     C                     PARM           DDSHOR
      *
     C                     END
      *
      ** MODULE ID 'FF'
     C           DDMODH    IFEQ 'FF'
      *
      ** CALL PROGRAM 'PM2030' - F&O INSTRUMENT DETAILS
     C                     CALL 'PM2030'
     C                     PARM           DDFOIH
      *
     C                     END
      *
      ** MODULE ID 'RE'
     C           DDMODH    IFEQ 'RE'
      *
      ** CALL PROGRAM 'PM2040' - RETAIL ACCOUNT DETAILS
     C                     CALL 'PM2040'
     C                     PARM           DDACCU                          CPM005
     C                     PARM           DDCCYH
     C                     PARM           DDACOH
     C                     PARM           DDACSH
     C                     PARM           DDBRCH                          CPM005
      *
     C                     END
      *
      ** MODULE ID 'LB'
     C           DDMODH    IFEQ 'LB'
      *
      ** CALL PROGRAM 'PM2130' - LOMBARD DETAILS
      * RETRIEVE TYPE OF GUARANTEE TO PASSED PM2130
     C                     EXSR LBTYP
      *
     C                     Z-ADD0         PL
     C                     Z-ADDRRN1      PL
     C                     MOVE ORD,PL    DDORDN
     C                     CALL 'PM2130'
     C                     PARM           DDTRNH
     C                     PARM           TYPE
     C                     PARM           DDORDN
      *
     C                     END
      *
      ** MODULE ID 'FD'
     C           DDMODH    IFEQ 'FI'
      *
      ** CALL PROGRAM 'PM2140' - FI DEPOSIT DETAILS
     C                     CALL 'PM2140'
     C                     PARM           DDTRNH
      *
     C                     END
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1011   - DISPLAY TRANSACTION DETAILS                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PM2050   - SE PORTFOLIO MOVEMENTS                                *
      * PM2055   - PORTFOLIO MOVEMENTS (SE)                              *CPM005
      * PM2070   - DEAL AMENDMENT PER DEAL                               *
      * PM2080   - LOAN AMENDMENT PER LOAN                               *
      * PM2090   - FO TRANSACTIONS DETAILS                               *
      * PM2120   - RETAILS ACCOUNT MOVEMENTS                             *
      * PM2160   - FI DEPOSIT AMENDMENT                                  *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS HOLDINGS                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINTV   - INTERIM TRADE/VALUE INDICATOR                         *
      *                                                                  *
      ********************************************************************
     C           #P1011    BEGSR
      *
      ** MODULE ID 'SE'
     C           DDMODH    IFEQ 'SE'
     C**                                                                  CPM005
     C** IF NOT BANK PORTFOLIOS                                           CPM005
     C**                                                                  CPM005
     C           QMPORS    IFNE 'B'                                       CPM005
      *
      ** CALL PROGRAM 'PM2050' - PORTFOLIO MOVEMENTS (SE)
     C                     CALL 'PM2050'
     C                     PARM           DDSHOR
     C                     PARM           WWINTV
     C**********           PARM           P9R997                          CPM005
     C                     PARM           FCR997                          CPM005
     C**                                                                  CPM005
     C                     ELSE                                           CPM005
     C**                                                                  CPM005
     C** CALL PROGRAM 'PM2055' - PORTFOLIO MOVEMENTS (SE)                 CPM005
     C**                                                                  CPM005
     C                     CALL 'PM2055'                                  CPM005
     C                     PARM           DDSHOR                          CPM005
     C                     PARM           QMBRCA                          CPM005
     C                     PARM           QMBOKC                          CPM005
     C                     PARM           WWMRKT  1                       CPM005
     C                     PARM           WWINTV                          CPM005
     C**                                                                  CPM005
     C                     END                                            CPM005
      *
     C                     END
      *
      ** MODULE ID 'DL'
     C           DDMODH    IFEQ 'FX'
     C           DDMODH    OREQ 'MD'
     C           DDMODH    OREQ 'ML'
     C           DDMODH    OREQ 'FR'
      *
      ** CALL PROGRAM 'PM2070' - DEAL AMENDMENT PER DEAL
     C                     CALL 'PM2070'
     C                     PARM           DDTRNH
      *
     C                     END
      *
      ** MODULE ID 'LE'
     C           DDMODH    IFEQ 'LE'
      *
      ** CALL PROGRAM 'PM2080' - LOAN AMENDMENTS PER LOAN
     C                     CALL 'PM2080'
     C                     PARM           DDTRNH
      *
     C                     END
      *
      ** MODULE ID 'FF'
     C           DDMODH    IFEQ 'FF'
      *
      ** CALL PROGRAM 'PM2090' - F&O TRANSACTION DETAILS
     C                     CALL 'PM2090'
     C                     PARM           DDTRNH
     C                     PARM           DDSIGH                          CPM005
      *
     C                     END
      *
      ** MODULE ID 'RE'
     C           DDMODH    IFEQ 'RE'
      *
      ** CALL PROGRAM 'PM2090' - F&O TRANSACTION DETAILS
     C                     CALL 'PM2120'
     C                     PARM           DDACCU                          CPM005
     C                     PARM           DDCCYH
     C                     PARM           DDACOH
     C                     PARM           DDACSH
     C                     PARM           DDBRCH                          CPM005
      *
     C                     END
      *
      ** MODULE ID 'FI'
     C           DDMODH    IFEQ 'FI'
      *
      ** CALL PROGRAM 'PM2160' - FI DEPOSIT AMENDMENTS PER DEPOSIT
     C                     CALL 'PM2160'
     C                     PARM           DDTRNH
      *
     C                     END
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1012   - DISPLAY DETAILS OF PLEDGE                             *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * LBTYP    - RETRIEVE GUARANTEES PLEDGES TYPE                      *
      * PM2130   - GUARANTEES AND PLEDGES                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS HOLDINGS                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1012    BEGSR
      *
      * RETRIEVE TYPE OF GUARANTEE TO PASSED PM2130
     C                     EXSR LBTYP
      *
     C                     Z-ADD0         PL
     C                     Z-ADDRRN1      PL
     C                     MOVE ORD,PL    DDORDN
      *
     C                     CALL 'PM2130'
     C                     PARM           DDTRNH
     C                     PARM           TYPE
     C                     PARM           DDORDN  3
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1014   - SETUP ARRAY OF DATE HEADINGS                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWDSPO   - SAVE CURRENCY                                         *
      * WWINNO   - SAVE INSTRUMENT CODE                                  *
      * WWDETT   - PAGE HEADINGS                                         *
      * WWPAGE   - PAGE HEADINGS                                         *
      * WWTDLV   - NBR OF PAGE                                           *
      * WWTDFL   - NBR OF PAGE                                           *
      *                                                                  *
      ********************************************************************
     C           #P1014    BEGSR
      *
     C                     MOVE QMCNUM    QFCNUM
     C                     MOVE QMPTF1    QFPTFR
     C                     MOVE *LOVAL    QFDSPS
     C                     MOVE *LOVAL    QFDSPG
     C                     MOVE *LOVAL    QFCCY1
     C                     MOVE *LOVAL    QFITDS
     C                     MOVE *LOVAL    QFINNR
     C                     MOVE *LOVAL    QFMODI
     C                     MOVE *LOVAL    QFRECI
     C                     MOVE *LOVAL    QFTDSS
     C                     MOVE *LOVAL    QFTRNB
     C                     MOVE *LOVAL    QFPOSQ
     C                     MOVE *LOVAL    QFTXT2
     C                     Z-ADD0         I       50
     C                     Z-ADD0         J       50
     C                     MOVE *BLANKS   WWDSPO
     C                     MOVE *BLANKS   WWINNO
      *
      ** SET FILE POINTER TO FIRST RECORD FOR PORTFOLIO AND READ RECORD
     C           PMHOLA    SETLLPMHOLDLB
     C                     READ PMHOLDLB                 72
      *
      ** SAVE DISPLAY GROUP AND INSTRUMENT TYPE READ
     C**********           Z-ADD7         K       50                      CPM005
     C**********           Z-ADD7         L       50                      CPM005
     C                     Z-ADD6         K       50                      CPM005
     C                     Z-ADD6         L       50                      CPM005
     C                     Z-ADD0         XRRN    50                      160217
     C**********           Z-ADD0         XFCNUM  60                                   160217 CSD027
     C                     MOVE *BLANKS   XFCNUM  6                                           CSD027
     C                     MOVEL*BLANKS   XFPTFR  4                       160217
     C                     Z-ADD0         XFDSPS  20                      160217
     C                     MOVEL*BLANKS   XFDSPG  3                       160217
     C                     Z-ADD0         XFITDS  20                      160217
     C                     MOVEL*BLANKS   XFINNR  3                       160217
     C                     MOVEL*BLANKS   XFPOSQ 11                       160217
     C                     MOVEL*BLANKS   XFTDSS 10                       160217
     C**********           MOVEL*BLANKS   XFTRNB  60                                   160217 CLE148
     C                     MOVEL*BLANKS   XFTRNB  6                                           CLE148
     C                     MOVEL*BLANKS   XWACCU  60                      160217
     C                     MOVEL*BLANKS   XFTXT2 10                       160217
     C                     MOVEL*BLANKS   XWFFMC  3                       160217
     C                     MOVEL*BLANKS   XWFFMY  5                       160217
      *
     C           *IN72     DOWEQ'0'
     C           QFCNUM    ANDEQQMCNUM
     C           QFPTFR    ANDEQQMPTF1
      *
     C           QFRECI    IFEQ 'D'
      *
     C           QFCNUM    IFEQ XFCNUM                                    160217
     C           QFPTFR    ANDEQXFPTFR                                    160217
     C           QFDSPS    ANDEQXFDSPS                                    160217
     C           QFDSPG    ANDEQXFDSPG                                    160217
     C           QFITDS    ANDEQXFITDS                                    160217
     C           QFINNR    ANDEQXFINNR                                    160217
     C           QFPOSQ    ANDEQXFPOSQ                                    160217
     C           QFTDSS    ANDEQXFTDSS                                    160217
     C           QFTRNB    ANDEQXFTRNB                                    160217
     C           WWACCU    ANDEQXWACCU                                    160217
     C           QFTXT2    ANDEQXFTXT2                                    160217
     C           WWFFMC    ANDEQXWFFMC                                    160217
     C           WWFFMY    ANDEQXWFFMY                                    160217
     C                     ADD  1         XRRN                            160217
     C                     ELSE                                           160217
     C                     Z-ADD0         XRRN                            160217
     C                     END                                            160217
     C**********           Z-ADDQFCNUM    XFCNUM                                       160217 CSD027
     C                     MOVE QFCNUM    XFCNUM                                              CSD027
     C                     MOVELQFPTFR    XFPTFR                          160217
     C                     MOVELQFDSPS    XFDSPS                          160217
     C                     MOVELQFDSPG    XFDSPG                          160217
     C                     Z-ADDQFITDS    XFITDS                          160217
     C                     MOVELQFINNR    XFINNR                          160217
     C                     MOVELQFPOSQ    XFPOSQ                          160217
     C                     MOVELQFTDSS    XFTDSS                          160217
     C**********           Z-ADDQFTRNB    XFTRNB                                       160217 CLE148
     C                     MOVELQFTRNB    XFTRNB                                              CLE148
     C                     Z-ADDWWACCU    XWACCU                          160217
     C                     MOVELQFTXT2    XFTXT2                          160217
     C                     MOVELWWFFMC    XWFFMC                          160217
     C                     MOVELWWFFMY    XWFFMY                          160217
      *                                                                   160217
      ** ON CHANGE OF DISPLAY GROUP ADD 1 TO K AND SET TYPE TO 'D'
     C           QFCCY1    IFNE WWDSPO
     C                     ADD  1         K
     C                     MOVE 'D'       WWDETT  1
     C                     END
      *
      ***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
      ** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
      ** TO ARRAY
     C********** K         IFEQ 8                                         CPM005
     C           K         IFEQ 7                                         CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END
      *
      ** ON CHANGE OF INSTRUMENT GROUP ADD 1 TO K AND SET TYPE TO 'I'
     C           QFINNR    IFNE WWINNO
     C           QFCCY1    ORNE WWDSPO
     C                     MOVE QFINNR    WWINNO  3
     C                     MOVE QFCCY1    WWDSPO  3
     C                     ADD  1         K
     C                     MOVE 'I'       WWDETT  1
     C                     END
      *
      ***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
      ** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
      ** TO ARRAY
     C********** K         IFEQ 8                                         CPM005
     C           K         IFEQ 7                                         CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END
      *
      ** FOR EACH SET OF DETAILS TO BE OUTPUT ADD 1 TO K AND SET TYPE TO 'T'
     C                     ADD  1         K
     C                     MOVE 'T'       WWDETT  1
      *
      ***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
      ** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
      ** TO ARRAY
     C********** K         IFEQ 8                                         CPM005
     C           K         IFEQ 7                                         CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END
     C                     END
      *
      *FOR*EACH*SET*OF*DETAILS*TO*BE*OUTPUT*ADD*1*TO*K*AND*SET*TYPE*TO*'T'CPM005
      ** FOR EACH SET OF DETAILS TO BE OUTPUT ADD 1 TO L                  CPM005
      ** AND SET TYPE TO 'T'                                              CPM005
     C                     ADD  1         L
     C                     MOVE 'T'       WWDETT  1
      *
      ***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
      ** IF L EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
      ** TO ARRAY
     C********** L         IFEQ 8                                         CPM005
     C           L         IFEQ 7                                         CPM005
     C                     ADD  1         J
     C                     Z-ADD1         L
     C                     END
      *
      ** READ NEXT HOLDING RECORD
     C                     READ PMHOLDLB                 72
     C                     END
      *
      ** SAVE NUMBER OF PAGES OF LIVE AND MATURED HOLDINGS
     C                     Z-ADDI         WWTDLV  50
     C                     Z-ADDJ         WWTDFL  50
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #V1001   - VALIDATE SELECTED HOLDINGS                            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS HOLDINGS                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWACTN   - ACTION CODE                                           *
      * WWGLOB   - GLOBAL POSITION                                       *
      *                                                                  *
      ********************************************************************
     C           #V1001    BEGSR
      *
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN56
     C                     MOVE '0'       *IN57
     C                     MOVE '0'       *IN62
     C                     MOVE '0'       *IN58
     C                     MOVE *OFF      *IN63                           CPM005
     C                     MOVE '0'       *IN67
     C                     MOVE '0'       *IN69
     C                     MOVE '0'       *IN18
     C                     MOVE '0'       *IN33
     C                     MOVE '0'       *IN30
     C                     MOVE '0'       *IN31
     C*                                                                   CPM005
     C                     EXSR #VACO                                     CPM005
     C           *IN42     IFEQ '1'                                       CPM005
     C                     MOVE '1'       *IN80                           CPM005
     C                     GOTO E1001                                     CPM005
     C                     END                                            CPM005
     C**
     C***IF*POOL*PORTFOLIO*CUSTOMER*MUST*NOT*BE*G,*P,*T,*F*OR*O.          CPM005
     C** IF POOL PORTFOLIO CUSTOMER MUST NOT BE C, G, P OR T.             CPM005
     C**
     C           QMPPCS    IFEQ 'Y'
     C**
     C           WWACTN    IFEQ 'G'
     C           WWACTN    OREQ 'P'
     C           WWACTN    OREQ 'T'
     C***********WWACTN    OREQ 'F'                                       CPM005
     C           WWACTN    OREQ 'K'                                       CPM005
     C           WWACTN    OREQ 'O'                                       CPM005
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN30
     C                     END
     C**
     C                     END
     C**
     C** IF POOL PORTFOLIO CUSTOMER; D ENTERED AND MODULE DL, LE OR RE.
     C**
     C           QMPPCS    IFEQ 'Y'
     C********** WWACTN    ANDEQ'D'                                       CPM005
     C           WWACTN    ANDEQ'V'                                       CPM005
     C**
     C           DDMODH    IFNE 'SE'
     C           DDMODH    ANDNE'FF'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN31
     C                     END
     C**
     C                     END
      *
      ** OPTION 'G' IS VALID ONLY FOR SECURITY POSITIONS
     C           WWACTN    IFEQ 'G'
     C           WWGLOB    ANDEQ'Y'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN67
     C                     ELSE
      *
     C           WWACTN    IFEQ 'G'
     C           DDMODH    ANDNE'SE'
      *
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN56
      *
     C                     END
     C                     END
      *
     C           WWACTN    IFEQ 'T'
     C           DDMODH    ANDNE'SE'
     C           DDMODH    ANDNE'FX'
     C           DDMODH    ANDNE'MD'
     C           DDMODH    ANDNE'ML'
     C           DDMODH    ANDNE'FR'
     C           DDMODH    ANDNE'LE'
     C           DDMODH    ANDNE'FF'
     C           DDMODH    ANDNE'RE'
     C           DDMODH    ANDNE'FI'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN57
     C                     END
      *
     C           WWACTN    IFEQ 'T'
     C           DDMODH    ANDEQ'FX'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN57
     C                     END
      *
     C***********WWACTN    IFEQ 'F'                                       CPM005
     C           WWACTN    IFEQ 'K'                                       CPM005
     C           DDMODH    ANDEQ'RE'
     C***********WWACTN    OREQ 'F'                                       CPM005
     C           WWACTN    OREQ 'K'                                       CPM005
     C           DDMODH    ANDEQ'FF'
     C***********WWACTN    OREQ 'F'                                       CPM005
     C           WWACTN    OREQ 'K'                                       CPM005
     C           DDMODH    ANDEQ*BLANKS
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN58
     C                     END
      *
     C           WWACTN    IFEQ 'P'
     C           DDMODH    ANDNE'SE'
     C           WWACTN    OREQ 'P'
     C           DDSPLH    ANDNE'Y'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN69
     C                     END
     C**
     C** OPTION T IS ONLY VALID ON BONDS IF PORTFOLIO IS NOT CONSOLIDATED
     C** OR NOT COMBINED
     C*
     C           WWACTN    IFEQ 'T'
     C           DDMODH    ANDEQ'SE'
     C*
     C           WWPTFR    IFEQ '9998'
     C           WWPTFR    OREQ '9999'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN33
     C                     END
     C                     END
      *
     C           WWACTN    IFEQ 'O'
     C           DDMODH    ANDNE'FF'
     C           WWACTN    OREQ 'O'
     C           DDCLOH    ANDEQ*ZEROS
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN62
     C                     END
      *
     C           E1001     TAG                                            CPM005
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #U1001   - FILL HEADER FIELD                                     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS HOLDINGS                                      *
      * #P1008   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINTV   - INTERIM TRADE/VALUE INDICATOR                         *
      *                                                                  *
      ********************************************************************
     C           #U1001    BEGSR
      *
      ** CUSTOMER NUMBER
     C                     MOVELQMCNUM    DDCNUM
      *
      ** CUSTOMER REPORT NAME
     C                     MOVELQMCRNM    DDCRNM
      *
      ** PORTFOLIO REFERENCE  ON SCREEN
     C                     MOVELQMPTF2    DDPTFR
      *
      ** PORTFOLIO NARRATIVE
     C                     MOVELQMPTFN    DDPTFN
      *
      ** MARKET VALUE AND ACCRUED INTEREST
     C           WWINTV    IFEQ 'T'
     C                     MOVE QMTPMV    DDMARK
     C                     MOVE QMPTAI    DDACCR
     C                     ELSE
     C                     MOVE QMVPMV    DDMARK
     C                     MOVE QMPVAI    DDACCR
     C                     END
      *
      ** PORTFOLIO CURRENCY
     C                     MOVELQMPTCY    DDCCY
      *
      ** PORTFOLIO TYPE
     C                     MOVELQMPTFT    DDPTYP
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * LBTYP    - RETRIEVE GUARANTEES PLEDGES TYPE                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1010   - DISPLAY INSTRUMENT DETAILS                            *
      * #P1012   - DISPLAY DETAILS OF PLEDGE                             *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           LBTYP     BEGSR
      *
     C           DDTYPE    IFEQ LBPLEG
     C                     MOVE 'P'       TYPE    1
     C                     ELSE
      *
     C           DDTYPE    IFEQ LBGUAR
     C                     MOVE 'G'       TYPE
     C                     ELSE
      *
     C           DDTYPE    IFEQ LBCOLI
     C                     MOVE 'C'       TYPE
     C                     ELSE
      *
     C           DDTYPE    IFEQ LBSECU
     C                     MOVE 'S'       TYPE
     C                     ELSE
     C                     MOVE *BLANK    TYPE
     C                     END
     C                     END
     C                     END
     C                     END
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      /COPY ZSRSRC,ZSEDITZ3
      /EJECT
      /COPY ZSRSRC,ZEDITZ2
      /EJECT
      ***/COPY ZSRSRCPM,ZCCYCN                                            CPM005
      /COPY ZSRSRC,ZCCYCN                                                 CPM005
      /EJECT                                                              CPM005
      /COPY ZSRSRC,ZCCYXR                                                 CPM005
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BLANK   - BLANK SCREEN FIELD                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - LOAD SUBFILE                                          *
      * #P1004   - ACCESS CURRENCY TOTALS                                *
      * #P1005   - ACCESS INSTRUMENT TYPE TOTALS                         *
      * #P1006   - FORMAT 'SE' HOLDINGS                                  *
      * #P1007   - FORMAT NON 'SE' HOLDINGS                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #BLANK    BEGSR
      *
     C                     MOVE '0'       *IN53
      *
      ** RESET HIDDEN FIELDS
     C                     MOVEL*BLANKS   DDSHOR
     C                     MOVEL*BLANKS   DDRECH
     C                     MOVEL*BLANKS   DDMODH
     C                     MOVEL*BLANKS   DDTRNH
     C                     MOVEL*BLANKS   DDFOIH
     C                     MOVEL*BLANKS   DDACCU                          CPM005
     C                     MOVEL*BLANKS   DDCCYH
     C                     MOVEL*BLANKS   DDACOH
     C                     MOVEL*BLANKS   DDACSH
     C                     MOVEL*BLANKS   DDBRCH                          CPM005
     C                     MOVEL*BLANKS   DDDSPH
     C                     MOVEL*BLANKS   DDINRH
     C                     Z-ADD0         DDINSH
     C                     Z-ADD0         DDDSSH
     C                     Z-ADD0         DDCLOH
      *
      ** RESET SUBFILE FIELDS
     C                     MOVEL*BLANKS   DDTOG1
     C                     MOVEL*BLANKS   DDCCY1
     C                     MOVEL*BLANKS   DDMKTP
     C                     MOVEL*BLANKS   DDMKFX
     C                     MOVEL*BLANKS   DDMVPC
     C                     MOVEL*BLANKS   DDMVIC
     C                     MOVEL*BLANKS   DDTOG2
     C                     MOVEL*BLANKS   DDCCY2
     C                     MOVEL*BLANKS   DDFOPR
     C                     MOVEL*BLANKS   DDFXRA
     C                     MOVEL*BLANKS   DDAIPC
     C                     MOVEL*BLANKS   DDAIIC
     C                     MOVEL*BLANKS   DDMKTY
     C                     MOVEL*BLANKS   DDMTPL
     C                     MOVEL*BLANKS   DDFOLY
     C                     MOVEL*BLANKS   DDEXPL
     C                     MOVEL*BLANKS   DDCOLR
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #SCRN    - SETTING UP SCREEN HEADER AND FOOTER                   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS HOLDINGS                                      *
      * #P1002   - LOAD SUBFILE                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #SCRN     BEGSR
      *
     C                     MOVE QFCNUM    W2CNUM
     C                     MOVE QFPTFR    W2PTFR
     C                     MOVE QFDSPS    W2DSPS
     C                     MOVE QFDSPG    W2DSPG
     C                     MOVE QFITDS    W2ITDS
     C                     MOVE QFINNR    W2INNR
     C                     MOVE QFCCY1    W2CCY1
     C                     MOVE QFTDSS    W2TDSS
     C                     MOVE QFDLSQ    W2DLSQ
     C                     MOVE QFTRNB    W2TRNB
     C                     MOVE QFTXT2    W2TXT2
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #FILE    - SETTING UP SCREEN HEADER AND FOOTER ARRAYS            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - LOAD SUBFILE                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #FILE     BEGSR
      *
     C                     MOVE W2CNUM    QFCNUM
     C                     MOVE W2PTFR    QFPTFR
     C                     MOVE W2DSPS    QFDSPS
     C                     MOVE W2DSPG    QFDSPG
     C                     MOVE W2ITDS    QFITDS
     C                     MOVE W2INNR    QFINNR
     C                     MOVE W2TDSS    QFTDSS
     C                     MOVE W2DLSQ    QFDLSQ
     C                     MOVE W2CCY1    QFCCY1
     C                     MOVE W2TRNB    QFTRNB
     C                     MOVE W2TXT2    QFTXT2
      *
     C                     ENDSR
      ********************************************************************CPM005
     C**********                                                          CPM005
     C*****ZCCYXR SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER     CPM005
     C*****CURRENCY USING AN EXCHANGE RATE BETWEEN THE TWO CURRENCIES     CPM005
     C**********                                                          CPM005
     C****INPUT  FIELDS                                                   CPM005
     C********ZAMTF  150     AMOUNT IN 'FROM' CURRENCY                    CPM005
     C********ZCRSRT 138     CROSS EXCHANGE RATE                          CPM005
     C********ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR         CPM005
     C**********             NOTE: FIELD EITHER SET UP IN SR/ZCCYCN OR IF CPM005
     C**********             M / D INDICATOR FOR NON-BASE CURRENCY        CPM005
     C********ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY  CPM005
     C********ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY    CPM005
     C**********                                                          CPM005
     C****OUTPUT  FIELDS                                                  CPM005
     C********ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNTCPM005
     C**********                                                          CPM005
     C****WORK*FIELDS                                                     CPM005
     C********ZWKPX   20     POWER INDEX                                  CPM005
     C********ZWK153 153                                                  CPM005
     C**********                                                          CPM005
     C****ALSO*REQUIRED                                                   CPM005
     C********POWER ARRAY                                                 CPM005
     C**********                                                          CPM005
     C****CALLED BY:                                                      CPM005
     C**********                                                          CPM005
     C********************************************************************CPM005
     C***********ZCCYXR    BEGSR                           *** ZCCYXR *** CPM005
     C***********                                                         CPM005
     C*****DEFINE ALL FIELDS                                              CPM005
     C***********          Z-ADDZAMTF     ZAMTF  150                      CPM005
     C***********          Z-ADDZCDPF     ZCDPF   10                      CPM005
     C***********          Z-ADDZCDPT     ZCDPT   10                      CPM005
     C***********          Z-ADDZAMTT     ZAMTT  150                      CPM005
     C***********          Z-ADDZCRSRT    ZCRSRT 138                      CPM005
     C***********          MOVE ZCRSMD    ZCRSMD  1                       CPM005
     C***********          Z-ADDZWKPX     ZWKPX   20                      CPM005
     C***********          Z-ADDZWK153    ZWK153 153                      CPM005
     C**********                                                          CPM005
     C***IF*CROSS EXCHANGE RATE IS EQUAL TO ZERO                          CPM005
     C***SET*ZAMTT  TO *ZERO  & EXIT                                      CPM005
     C***********ZCRSRT    IFEQ 0                                         CPM005
     C***********          Z-ADD*ZEROS    ZAMTT                           CPM005
     C***********          GOTO ZCCEND                                    CPM005
     C***********          END                                            CPM005
     C**********                                                          CPM005
     C***IF*DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF) EQUALS DECIMAL    CPM005
     C***DECIMAL PLACES  FOR 'TO' CURRENCY                                CPM005
     C***********ZCDPF     IFEQ ZCDPT                                     CPM005
     C**********                                                          CPM005
     C***IF*CROSS RATE MULTIPLY/DIVIDE INDICATOR EQUALS 'D'               CPM005
     C***SET*AMOUNT IN 'TO' EQUAL TO AMOUNT IN FROM CURRENCY (ZAMTF)      CPM005
     C***DIVIDED BY CROSS EXCHANGE RATE                                   CPM005
     C***********ZCRSMD    IFEQ 'D'                                       CPM005
     C***********          Z-ADDZAMTF     ZAMTT                           CPM005
     C***********ZAMTT     DIV  ZCRSRT    ZAMTT     H                     CPM005
     C***********          END                                            CPM005
     C**********                                                          CPM005
     C***IF*CROSS RATE MULTIPLY/DIVIDE INDICATOR EQUALS 'M'               CPM005
     C***SET*AMOUNT IN 'TO' EQUAL TO AMOUNT IN FROM CURRENCY (ZAMTF)      CPM005
     C***MULTIPLIED BY CROSS EXCHANGE RATE                                CPM005
     C***********ZCRSMD    IFEQ 'M'                                       CPM005
     C***********          Z-ADDZAMTF     ZAMTT                           CPM005
     C***********ZAMTT     MULT ZCRSRT    ZAMTT     H                     CPM005
     C***********          END                                            CPM005
     C***********          END                                            CPM005
     C**********                                                          CPM005
     C***IF*DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF)  NOT EQUALS DECIMACPM005
     C***DECIMAL PLACES  FOR 'TO' CURRENCY                                CPM005
     C***********ZCDPF     IFNE ZCDPT                                     CPM005
     C**********                                                          CPM005
     C***SUBTRACT DECIMAL PLACES 'FROM' FROM DECIMAL PLACES 'TO' IN POWER CPM005
     C***********ZCDPT     SUB  ZCDPF     ZWKPX                           CPM005
     C***********ZWKPX     ADD  4         Z       20                      CPM005
     C**********                                                          CPM005
     C***IF*POWER ELEMENT (8,4) LESS THAN 1                               CPM005
     C***********POWER,Z   IFLT 1                                         CPM005
     C**********                                                          CPM005
     C***MULTIPLY AMOUNT IN FROM CURRENCY BY ELEMENT IN POWER ARRAY       CPM005
     C***********POWER,Z   MULT ZAMTF     ZWK153                          CPM005
     C**********                                                          CPM005
     C***SET*AMOUNT IN 'TO' EQUAL TO AMOUNT WORK FIELD ZWK153             CPM005
     C***DIVIDED    BY CROSS EXCHANGE RATE                                CPM005
     C***********ZCRSMD    IFEQ 'D'                                       CPM005
     C***********ZWK153    DIV  ZCRSRT    ZAMTT     H                     CPM005
     C***********          END                                            CPM005
     C**********                                                          CPM005
     C***SET*AMOUNT IN 'TO' EQUAL TO AMOUNT WORK FIELD ZWK153             CPM005
     C***MULTIPLIED BY CROSS EXCHANGE RATE                                CPM005
     C***********ZCRSMD    IFEQ 'M'                                       CPM005
     C***********ZWK153    MULT ZCRSRT    ZAMTT     H                     CPM005
     C***********          END                                            CPM005
     C***********          END                                            CPM005
     C**********                                                          CPM005
     C***IF*POWER ELEMENT (8,4) GREATER OR EQUAL TO 1                     CPM005
     C***********POWER,Z   IFGE 1                                         CPM005
     C**********                                                          CPM005
     C***MULTIPLY AMOUNT IN FROM CURRENCY BY ELEMENT IN POWER ARRAY       CPM005
     C***********ZAMTF     MULT POWER,Z   ZAMTF                           CPM005
     C**********                                                          CPM005
     C***TEST*CROSS MULT/DIV INDICATOR                                    CPM005
     C***********ZCRSMD    IFEQ 'D'                                       CPM005
     C**********                                                          CPM005
     C***SET*AMOUNT IN 'TO' EQUAL TO AMOUNT IN 'FROM' CURRENCY            CPM005
     C***DIVIDED    BY CROSS EXCHANGE RATE                                CPM005
     C***********ZAMTF     DIV  ZCRSRT    ZAMTT     H                     CPM005
     C***********          END                                            CPM005
     C**********                                                          CPM005
     C***TEST*CROSS MULT/DIV INDICATOR                                    CPM005
     C***********ZCRSMD    IFEQ 'M'                                       CPM005
     C**********                                                          CPM005
     C***SET*AMOUNT IN 'TO' EQUAL TO AMOUNT IN 'FROM' CURRENCY            CPM005
     C***MULTIPLIED BY CROSS EXCHANGE RATE                                CPM005
     C***********ZAMTF     MULT ZCRSRT    ZAMTT     H                     CPM005
     C***********          END                                            CPM005
     C***********          END                                            CPM005
     C***********          END                                            CPM005
     C***********ZCCEND    ENDSR                                          CPM005
      ********************************************************************CPM005
      /EJECT
     C*****************************************************************   CPM005
     C*                                                               *   CPM005
     C*    #VACO - CHECK FOR VALID ACTION CODE                        *   CPM005
     C*                                                               *   CPM005
     C*    CALLED BY: #V10F0 - PROCESS VALIDATION OF START SCREEN     *   CPM005
     C*    CALLS:                                                     *   CPM005
     C*                                                               *   CPM005
     C*****************************************************************   CPM005
     C           #VACO     BEGSR                                          CPM005
     C*                                                                   CPM005
     C*                                                                   CPM005
     C** Check valid action codes                                         CPM005
     C*                                                                   CPM005
     C                     Z-ADD1         UV      20                      CPM005
     C                     MOVEL'0'       *IN42                           CPM005
     C           WWACTN    LOKUPVC1,UV                   41               CPM005
     C*                                                                   CPM005
     C           *IN41     IFEQ '0'                                       CPM005
     C                     MOVEL'1'       *IN42                           CPM005
     C                     END                                            CPM005
     C*                                                                   CPM005
     C                     ENDSR                                          CPM005
      *****************************************************************   CPM005
     C/EJECT                                                              CPM005
      ********************************************************************
      *                                                                  *
      * *PSSR    - PROCESS DATA BASE ERROR                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **PMC1002**-*UPDATE**GDA********************************************CPM005
      **PMC1020**-*END GROUPS*JOBS****************************************CPM005
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1007   - FORMAT NON 'SE' HOLDINGS                              *
      * #P1009   - LOAD SUBFILE WITH ALL POSITIONS                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      **WWGDA****-*DATAAREA**GDA******************************************CPM005
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
      *
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C                     MOVEL'PM0671'  QMPGM
      *
      ***UPDATE**GDA                                                      CPM005
      ** UPDATE *LDA                                                      CPM005
     C***********          CALL 'PMC1002'                                 CPM005
     C***********          PARM           WWGDA                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *
     C                     DUMP
      *
     C***********          CALL 'PMC1020'                                 CPM005
      *
     C                     ENDSR
     C****************************************************************
     C**                                                             *
     C**  SR:FFPRCS   - CONVERTS A PRICE IN FILE FORMAT ( 11,7P )    *
     C**                TO ITS EQUIVALENT SCREEN FORMAT ( 12  A )    *
     C**                                                             *
     C****INPUTS******-*FFPRIC*(11,7P)*PRICE*(*FILE*FORMAT*)**********    CPM005
     C**  INPUTS      - FFPRIC (15,8P) PRICE ( FILE FORMAT )         *    CPM005
     C**                FFTKDM  (3,0P) TICKS DENOMINATOR             *
     C******************FFMNPF*(11,7P)*MINIMUM*PRICE*FLUCTUATION******    CPM005
     C****OUTPUTS*****-*FFSPRC*(12**A)*PRICE*(*SCREEN*FORMAT*)********    CPM005
     C**                FFMNPF (15,8P) MINIMUM PRICE FLUCTUATION     *    CPM005
     C**  OUTPUTS     - FFSPRC (16  A) PRICE ( SCREEN FORMAT )       *    CPM005
     C**                                                             *
     C****************************************************************
     C**      SUBROUTINE ONLY CHANGED FOR THIS PROGRAM               *
     C**      CHANGE I TO W                                          *
     C**      CHANGE J TO Z                                          *
     C****************************************************************
     C           FFPRCS    BEGSR                           ** FFPRCS SR **
     C**
     C**
     C**
     C*     DEFINE INPUT FIELDS
     C**
     C** FFPRIC Previously Defined.                                       CPM005
     C***********          Z-ADDFFPRIC    FFPRIC 117                      CPM005
     C                     Z-ADDFFPRIC    FFPRIC                          CPM005
     C                     Z-ADDFFTKDM    FFTKDM  30
     C** FFMNPF Previously Defined.                                       CPM005
     C***********          Z-ADDFFMNPF    FFMNPF 117                      CPM005
     C                     Z-ADDFFMNPF    FFMNPF                          CPM005
     C**
     C*     INITIALISE O/P FIELD FFSPRC
     C**
     C** FFSPRC Previously Defined.                                       CPM005
     C***********          MOVE *BLANK    FFSPRC 12                       CPM005
     C                     MOVE *BLANK    FFSPRC                          CPM005
     C**
     C*     SEARCH FFPRIC FOR 1ST NON ZERO ELEMENT BEFORE DECIMAL
     C**
     C                     Z-ADD1         W       20
     C***********W         DOWLT4                                         CPM005
     C           W         DOWLT7                                         CPM005
     C           FFFP,W    ANDEQ0
     C**
     C                     ADD  1         W
     C**
     C                     END
     C**
     C******MOVE*ELEMENTS*FROM*FIRST*NON*ZERO*POSITION*TO*4TH*OF*FFFP     CPM005
     C**    MOVE ELEMENTS FROM FIRST NON ZERO POSITION TO 7TH OF FFFP     CPM005
     C*     TO CORRESPONDING POSITIONS IN FFSP
     C**
     C***********W         DOWLE4                                         CPM005
     C           W         DOWLE7                                         CPM005
     C**
     C                     MOVE FFFP,W    FFSP,W
     C                     ADD  1         W
     C**
     C                     END
     C**
     C*     SET UP DECIMAL OR FRACTION FORMAT SEPARATOR
     C**
     C           FFTKDM    IFEQ 100
     C*
     C                     MOVE '.'       FFPT    1
     C*
     C                     ELSE
     C*
     C                     MOVE '-'       FFPT
     C*
     C                     END
     C**
     C*     DETERMINE NUMBER OF SIGNIFICANT DECIMAL DIGITS
     C**
     C*     IF TICK =100 DETERMINE NO. DECIMAL PLACES FROM FFMNPF
     C**
     C           FFTKDM    IFEQ 100
     C**
     C***********          Z-ADD7         W                               CPM005
     C                     Z-ADD8         W                               CPM005
     C           W         DOWGT0
     C           FFMF,W    ANDEQ0
     C*
     C                     SUB  1         W
     C*
     C                     END
     C                     Z-ADDW         FFN     20
     C**
     C                     ELSE
     C**
     C*    DETERMINE NO. OF SIGNIFICANT DIGITS FROM TICK VALUE
     C**
     C           FFTKDM    IFLE 10
     C                     Z-ADD1         FFN
     C                     END
     C**
     C           FFTKDM    IFGT 10
     C           FFTKDM    ANDLE100
     C                     Z-ADD2         FFN
     C                     END
     C**
     C           FFTKDM    IFGT 100
     C                     Z-ADD3         FFN
     C                     END
     C**
     C                     END
     C**
     C*    IF NUMBER OF SIGNIFICANT DECIMALS<> 0
     C**
     C           FFN       IFNE 0
     C**
     C*    MOVE FFPT IN TO OUT FIELD
     C**
     C***********          MOVE FFPT      FFSP,5                          CPM005
     C                     MOVE FFPT      FFSP,8                          CPM005
     C**
     C*    MOVE SIGNIFICANT DIGITS TO CORRESPONDING
     C*    POSITIONS IN FFSP
     C**
     C***********          Z-ADD5         W                               CPM005
     C                     Z-ADD8         W                               CPM005
     C           FFN       DOWNE0
     C*
     C           W         ADD  1         Z       20
     C                     MOVE FFFP,W    FFSP,Z
     C                     ADD  1         W
     C                     SUB  1         FFN
     C*
     C                     END
     C**
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C***   ATN - ARRAY TO ENABLE ATTN KEY                                CPM005
     C* SETATNPGM PGM(PMC0610)                                            CPM005
     C***   NARR - NARRATIVES                                             CPM005
     C*Currency                                                           CPM005
     C*Instrument Type                                                    CPM005
     C**
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   POWER - POWERS OF 10 FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  VC1 - Valid codes for program                                         CPM005
VKGPTDO                                                                   CPM005
