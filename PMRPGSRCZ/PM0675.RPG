     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Holdings Scroll Screen')                      *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                                 *
     F*                                                               *
     F*  PM0675 - PM HOLDINGS SCROLL SCREEN FOR DELETED CUSTOMERS     *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CLE148             Date 23Jul12               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM005             Date 29Jul96               *
      *                 CFF004             Date 11Sep96               *
     F*                 CPM003             DATE 02MAY96               *
     F*                 101496             DATE 28MAR96               *
     F*                 S71062             DATE 27FEB96               *
     F*                 085817             DATE 13MAR95               *
     F*                 S01486             DATE 08JUL94               *
     F*                 038430             DATE 20AUG93               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  CPM005 - Private Banking Phase II                            *
     F*           Focus Group Changes Upgraded to DBA                 *
     F*           Just Recompiled because of PM File(s) changes       *
     F*  CFF004 - Increase in size of Price Fields                    *
     F*  CPM003 - FF/PM Interface upgrade to Release 10               *
     F*  101496 - Title not being set up correctly                    *
     F*  S71062 - FF/PM Interface - PM Changes                        *
     F*  085817 - Recompile due to changes in PMLDAPD                 *
     F*  S01486 - Portfolio Management Upgrade                        *
     F*  038430 - CREATED FOR ENHANCEMENTS TO CUSTOMER INSERTION /    *
     F*           DELETION                                            *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F**
     F****PM0675DDCF  E                    WORKSTN                        S01486
     FPM0675DFCF  E                    WORKSTN                            S01486
     F                                        RRN1  KSFILE PM0675S1
     F                                        RRN2  KSFILE PM0675S2
     F** PREFIX 'QF' **
     F****PMCLOCPPIF  E           K        DISK                           S01486
     FPMCLOCPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     FINTYP   IF  E           K        DISK                               S71062
     F                                              KINFSR *PSSR          S71062
     F******************************************************************
     F**
     F** FUNCTION OF INDICATORS
     F**
     F******************************************************************
     F**
     F** U7      : DATA BASE ERROR
     F** U8      : DATA BASE ERROR
     F** KC      : EXIT OF JOB
     F** KL      : EXIT OF PROGRAM
     F** KK      : WINDOW RIGHT<>LEFT
     F**
      ** ARRAY FOR COPYRIGHT
      *
     E                    CPY@    1   1 80
     E                    TITL    1   2  5                                101496
      /COPY ZSRSRC,FFPRCSZ2                                               S71062
      /COPY ZSRSRC,ZSEDITZ1
      /COPY ZSRSRC,ZEDITZ1
      /COPY ZSRSRC,ZDATE2Z1                                               S71062
     I**
     I** EXTERNAL FORMAT FOR GROUP DATA AREA
     I**
     I****WWGDA     E DSPMGRDAPP
     I**
     I****WWLDA     E DSPMLDAPP                                           S01486
     IWWLDA     E DSPMLDAPD                                               S01486
     I**
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     IPSDS       SDS
     I**********                            244 253 WSID                  S01486
     I**********                            254 263 USID                  S01486
     I                                      244 253 WKSTN                 S01486
     I                                      254 263 USER                  S01486
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I            DS
     I                                        1  16 WWNOM1
     I                                        4   4 WWNOM2                S71062
     I**********                             17  36 WWNAR1                                    CGL029
     I**********                              1  36 WWTOGW                                    CGL029
     I                                       17  42 WWNAR1                                    CGL029
     I                                        1  42 WWTOGW                                    CGL029
     I            DS
     I                                        1  16 WWNOM3
     I                                        6   7 WWNOM4                S71062
     I                                        8   8 WWSIGN                S71062
     I**********                             17  36 WWNAR3                                    CGL029
     I**********                              1  36 WWTOGY                                    CGL029
     I                                       17  42 WWNAR3                                    CGL029
     I                                        1  42 WWTOGY                                    CGL029
     I            DS
     I**********                              1  20 WWNARC                                    CGL029
     I                                        1  26 WWNARC                                    CGL029
     I                                        1   3 WWCCY1                S71062
     I                                        4   9 WWFFMT                S71062
     I**********                             21  21 FIELDC                                    CGL029
     I**********                             22  31 WWSECU                                    CGL029
     I**********                              1  31 WWTOGC                                    CGL029
     I                                       27  27 FIELDC                                    CGL029
     I                                       28  37 WWSECU                                    CGL029
     I                                        1  37 WWTOGC                                    CGL029
     I            DS
     I**********                              1   60QFCNUM                                    CSD027
     I                                        1   6 QFCNUM                                    CSD027
     I                                        7  10 QFPTF1
     I                                       11  120QFDSPS
     I                                       13  15 QFDSPG
     I                                       16  170QFITDS
     I                                       18  20 QFINNR
     I                                       21  230QFDLSQ
     I                                       24  26 QFCCY1
     I                                       27  27 QFRECI
     I                                       28  37 QFTDSS
     I**********                             38  430QFTRNB                                    CLE148
     I                                       38  43 QFTRNB                                    CLE148
     I**********                             44  63 QFTXT2                                    CGL029
     I                                       44  63 QQTXT2                                    CGL029
     I                                       44  46 WWFFMC                S71062
     I                                       48  52 WWFFMY                S71062
     I**********                              1  63 WWSCRN                                    CGL029
     I                                        1  89 WWSCRN                                    CGL029
     ISDPORT    E DSSDPORTPD                                              CPM003
     I** Portfolio Management ICD                                         CPM003
     I*                                                                   CPM003
     ISDMMOD    E DSSDMMODPD                                              S71062
     I** EXTERNAL DS Module ID                                            S71062
     I*                                                                   S71062
     ISDBANK    E DSSDBANKPD                                              S71062
     I** EXTERNAL DS FOR BANK DETAILS                                     S71062
     I*                                                                   S71062
     IDSFDY     E DSDSFDY                                                 S71062
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S71062
     I*                                                                   S71062
     IDSSDY     E DSDSSDY                                                 S71062
     I* Second DS For Access Programs, Long Data Structure                S71062
     I*                                                                   S71062
     I            DS                                                      S71062
     I*                                                                   S71062
     I** DATA STRUCTURE TO DISPLAY SETTLEMENT DATE ONLY WHEN FF           S71062
     I*                                                                   S71062
     I                                        1   2 WWDDAY                S71062
     I I            '/'                       3   3 WWORK1                S71062
     I                                        4   5 WWMNTH                S71062
     I I            '/'                       6   6 WWORK2                S71062
     I                                        7   8 WWYEAR                S71062
     I                                        1   8 WWSETD                S71062
     I            DS                                                      S71062
     I                                        1   20WWDSET                S71062
     I                                        3   40WWMSET                S71062
     I                                        5   60WWYSET                S71062
     I                                        1   60WKSETD                S71062
     I*                                                                   S71062
     I            DS                                                      S71062
     I*                                                                   S71062
     I** Data structure to display narrative when FF                      S71062
     I*                                                                   S71062
     I                                        1  31 WWOPTS                S71062
     I                                        1   5 WWFOIS                S71062
     I                                        7  11 WWMTYR                S71062
     I                                       13  20 WWDATE                S71062
     I                                       22  27 WWTNBR                S71062
      /COPY ZSRSRC,ZSEDITZ2
      /COPY ZSRSRC,FFSRDSZ1                                               S71062
      /COPY ZSRSRC,FFPRCSZ3                                               S71062
     C           CLOCKY    KLIST
     C                     KFLD           QMCNUM
     C                     KFLD           QMPTF1
     C*
     C           CLOCK1    KLIST
     C                     KFLD           QMCNUM
     C                     KFLD           QMPTF1
     C                     KFLD           WWDSPS
     C                     KFLD           WWDSPG
     C                     KFLD           WWITDS
     C                     KFLD           WWINNR
     C                     KFLD           WWDLSQ
     C                     KFLD           WWCCY1
     C                     KFLD           WWRECI
     C                     KFLD           WWTDSS
     C                     KFLD           WWTRNB
     C                     KFLD           WWTXT2
     C********************************************************
     C** P R O G R A M   S T A R T
     C********************************************************
     C*
     C** INITIAL PROCESSING
     C                     EXSR #INIT
     C*
     C** FORMAT FIRST DETAILS FOR OUTPUT
     C                     EXSR #P1001
     C*
     C** CONTROL DISPLAY OF FILE
     C                     EXSR #P1003
     C**
     C                     RETRN
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      ********************************************************************
     C           #INIT     BEGSR
     C**                                                                  S71062
     C** Acces file SDMMODPD to check if multibranching system            S71062
     C**                                                                  S71062
     C                     CALL 'AOMMODR0'                                S71062
     C                     PARM '*DBERR ' @RTCD   7                       S71062
     C                     PARM '*FIRST ' @OPTN   7                       S71062
     C           SDMMOD    PARM SDMMOD    DSFDY                           S71062
     C           @RTCD     IFNE *BLANKS                                   S71062
     C                     MOVEL'Y'       QMDBER                          S71062
     C                     MOVEL'Y'       QMENQT                          S71062
     C                     MOVE 'SDMMOD'  QMFILE                          S71062
     C                     MOVE 'PM0680'  QMPGM                           S71062
     C                     MOVE *BLANKS   QMKEY            ***************S71062
     C                     Z-ADD1         QMERRN           **DB ERROR 01**S71062
     C**                                                   ***************S71062
     C                     CALL 'PMC1001'                                 S71062
     C                     PARM           WWLDA                           S71062
     C                     RETRN                                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C           BGFUOP    IFEQ 'Y'                                       CPM003
     C** Access PM ICD for FCPORS, Type of Portfolios supported           CPM003
     C                     CALL 'AOPORTR0'                                CPM003
     C                     PARM '*DBERR ' @RTCD                           CPM003
     C                     PARM '*FIRST ' @OPTN                           CPM003
     C           SDPORT    PARM SDPORT    DSFDY                           CPM003
     C           @RTCD     IFNE *BLANKS                                   CPM003
     C                     MOVEL'Y'       QMDBER                          CPM003
     C                     MOVEL'Y'       QMENQT                          CPM003
     C                     MOVE 'SDPORTPD'QMFILE                          CPM003
     C                     MOVE 'PM0680'  QMPGM                           CPM003
     C                     MOVE *BLANKS   QMKEY            ***************CPM003
     C                     Z-ADD1         QMERRN           **DB ERROR 01**CPM003
     C*                                                    ***************CPM003
     C                     CALL 'PMC1001'                                 CPM003
     C                     PARM           WWLDA                           CPM003
     C                     RETRN                                          CPM003
     C                     END                                            CPM003
     C                     END                                            CPM003
     C*                                                                   CPM003
     C** GET INSTALLATION CONTROL DATA RECORD 1                           S71062
     C*                                                                   S71062
     C                     CALL 'AOBANKR0'                                S71062
     C                     PARM *BLANKS   WWRTCD  7                       S71062
     C                     PARM '*FIRST ' WWOPTN  7                       S71062
     C           SDBANK    PARM SDBANK    DSFDY                           S71062
     C*
     C** RETRIEVE DATA AREA *LDA
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
     C*
     C**  SET UP FIELDS OUTPUT IN SCREEN HEADER
     C                     MOVE QMRUNA    DDRUNA
     C                     MOVE QMCNUM    DDCNUM
     C                     MOVE QMCRNM    DDCRNM
     C                     MOVE QMPTF2    DDPTFR
     C                     MOVE QMPTFN    DDPTFN
     C                     MOVE QMPTCY    DDCCY
     C                     MOVE QMPTFT    DDPTYP
     C**                                                                  101496
     C** IF DISPLAY TRADE/VALUE DATE ON DTAARA *LDA IS 'T'                101496
     C**                                                                  101496
     C           QMTVPS    IFEQ 'T'                                       101496
     C                     MOVELTITL,1    DDTITR                          101496
     C                     ELSE                                           101496
     C                     MOVELTITL,2    DDTITR                          101496
     C                     END                                            101496
     C*
     C** DETERMINE LAST SET OF DETAILS FOR PORTFOLIO
     C                     MOVE *HIVAL    WWDSPS  20
     C                     MOVE *HIVAL    WWDSPG  3
     C                     MOVE *HIVAL    WWITDS  20
     C                     MOVE *HIVAL    WWINNR  3
     C                     MOVE *HIVAL    WWDLSQ  30
     C                     MOVE *HIVAL    WWCCY1  3
     C                     MOVE *HIVAL    WWRECI  1
     C                     MOVE *HIVAL    WWTDSS 10
     C**********           MOVE *HIVAL    WWTRNB  60                                          CLE148
     C                     MOVE *HIVAL    WWTRNB  6                                           CLE148
     C**********           MOVE *HIVAL    WWTXT2 20                                           CGL029
     C                     MOVE *HIVAL    WWTXT2 26                                           CGL029
     C***********CLOCK1    SETGTPMCLOCPP                                  S01486
     C***********          READPPMCLOCPP                 60               S01486
     C           CLOCK1    SETGTPMCLOCPD                                  S01486
     C                     READPPMCLOCPD                 60               S01486
     C*
     C** SAVE LAST SET OF DETAILS
     C**********           MOVE WWSCRN    WWBSCR 63                                           CGL029
     C                     MOVE WWSCRN    WWBSCR 89                                           CGL029
     C*
     C** SAVE FIRST SET OF DETAILS
     C***********CLOCKY    SETLLPMCLOCPP                                  S01486
     C***********CLOCKY    READEPMCLOCPP                 60               S01486
     C           CLOCKY    SETLLPMCLOCPD                                  S01486
     C           CLOCKY    READEPMCLOCPD                 60               S01486
     C**********           MOVE WWSCRN    WWTSCR 63                                           CGL029
     C                     MOVE WWSCRN    WWTSCR 89                                           CGL029
     C*
     C***********CLOCKY    SETLLPMCLOCPP                                  S01486
     C           CLOCKY    SETLLPMCLOCPD                                  S01486
     C*
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1001   - FORMAT NEXT 7 RECORDS FOR OUTPUT                      *
      *                                                                  *
      *                                                                  *
      ********************************************************************
     C           #P1001    BEGSR
     C*
     C** CLEAR SUBFILE
     C                     MOVE '1'       *IN55
     C                     WRITEPM0675C1
     C                     WRITEPM0675C2
     C                     MOVE '0'       *IN55
     C*
     C** FORMAT POSITIONS FOR OUTPUT
     C                     Z-ADD0         K       30
     C                     Z-ADD0         RRN1    10
     C                     Z-ADD0         RRN2    10
     C***********CLOCKY    READEPMCLOCPP                 60               S01486
     C           CLOCKY    READEPMCLOCPD                 60               S01486
     C           *IN60     DOWEQ'0'
     C********** K         ANDLT7                                         S01486
     C           K         ANDLT6                                         S01486
     C*
     C** SAVE FIRST DETAILS OUTPUT
     C           K         IFEQ 0
     C**********           MOVE WWSCRN    WWFSDT 63                                           CGL029
     C                     MOVE WWSCRN    WWFSDT 89                                           CGL029
     C                     END
     C*
     C** FORMAT RECORD FOR OUTPUT
     C                     EXSR #P1002
     C                     ADD  1         K
     C*
     C********** K         IFLT 7                                         S01486
     C           K         IFLT 6                                         S01486
     C***********CLOCKY    READEPMCLOCPP                 60               S01486
     C           CLOCKY    READEPMCLOCPD                 60               S01486
     C                     END
     C*
     C                     END
     C*
     C** SAVE LAST SET OF DETAILS OUTPUT
     C**********           MOVE WWSCRN    WWLSDT 63                                           CGL029
     C                     MOVE WWSCRN    WWLSDT 89                                           CGL029
     C*
     C** IF LAST RECORD READ RESET FILE POINTER AFTER LAST RECORD FOR
     C** PORTFOLIO
     C           *IN60     IFEQ '1'
     C***********CLOCK1    SETGTPMCLOCPP                                  S01486
     C           CLOCK1    SETGTPMCLOCPD                                  S01486
     C                     Z-ADDK         WWSVK   30
     C                     END
     C*
     C                     ENDSR
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1002   - FORMAT DETAILS FOR OUTPUT                             *
      *                                                                  *
      ********************************************************************
     C           #P1002    BEGSR
     C*
     C** SET ALL SUBFILE FIELDS TO BLANK
     C                     MOVE *BLANKS   DDSTAT
     C                     MOVE *BLANKS   DDCCY1
     C                     MOVE *BLANKS   DDTOG1
     C                     MOVE *BLANKS   DDMKTP
     C                     MOVE *BLANKS   DDMKFX
     C                     MOVE *BLANKS   DDMVPC
     C                     MOVE *BLANKS   DDCCY2
     C                     MOVE *BLANKS   DDTOG2
     C                     MOVE *BLANKS   DDFOPR
     C                     MOVE *BLANKS   DDFXRA
     C                     MOVE *BLANKS   DDAIPC
     C                     MOVE *BLANKS   DDTOG3
     C                     MOVE *BLANKS   DDMVIC
     C                     MOVE *BLANKS   DDMKTY
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVE *BLANKS   DDTOG4
     C                     MOVE *BLANKS   DDAIIC
     C                     MOVE *BLANKS   DDFOLY
     C                     MOVE *BLANKS   DDEXPL
     C*
     C** SET UP DETAILS FOR OUTPUT ON SCREEN
     C           QFRECI    IFEQ 'D'
     C                     MOVE 'L'       DDSTAT
     C                     ELSE
     C                     MOVE QFRECI    DDSTAT
     C                     END
     C*
     C** FORMAT DETAILS FOR OUTPUT FOR SE POSITIONS
     C           QFMODI    IFEQ 'SE'                       B1
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
     C*
     C** CONVERT THE OTHER AMOUNT
     C           QFOAMT    IFEQ *HIVAL                     B2
     C           QFAMT1    OREQ QFOAMT
     C                     MOVE *BLANKS   WWNOM3
     C                     ELSE                            X2
     C                     Z-ADDQFOAMT    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWWR15 15
     C                     MOVELWWWR15    WWNOM3
     C                     MOVEL'('       WWNOM3
     C                     MOVE ')'       WWNOM3
     C                     END                             E2
     C*
     C                     MOVE QFTXT1    WWNAR1
     C                     MOVE QFTXT2    WWNAR3
     C*
     C                     MOVELWWTOGW    DDTOG1
     C                     MOVELWWTOGY    DDTOG2
     C*
     C                     MOVELQFCCY1    DDCCY1
     C*
     C** EDIT MARKET PRICE
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVE *BLANKS   DDMKTP
     C           QFMPRC    IFGT 99999                      B2
     C                     Z-ADD3         ZADEC
     C                     Z-ADD6         ZADIG
     C                     Z-ADDQFMPRC    WWPRI3 103H
     C                     MOVE WWPRI3    ZFIELD
     C                     ELSE                            X2
     C                     Z-ADDQFMPRC    WWPRI1
     C                     MOVE WWPRI1    ZFIELD
     C                     Z-ADD4         ZDECS
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     END                             E2
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKTP
     C*
     C** EDIT MARKET FX RATE
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFMFXR    WWRATE    H
     C                     MOVE WWRATE    ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKFX
     C**
     C** EDIT MARKET VALUE IN PORTFOLIO CURRENCY
     C                     Z-ADDQFMVPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C*
     C** EDIT MARKET VALUE IN INSTRUMENT CURRENCY
     C                     Z-ADDQFMVAL    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVIC
     C*
     C** EDIT P&L MARKET
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
     C*
     C** MOVE SECURITY SHORTNAME TO TRANSACTION/SECURITY REFERENCE
     C                     MOVELQFTXT1    WWNARC
     C                     MOVELQFTDSS    WWSECU
     C                     MOVE WWTOGC    DDTOG3
     C*
     C                     MOVE *BLANKS   WWSECU
     C                     MOVELQFTXT2    WWNARC
     C                     MOVE WWTOGC    DDTOG4
     C*
     C** EDIT ACCRUED INTEREST IN PORTFOLIO CURRENCY
     C                     Z-ADDQFAIPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C*d
     C** EDIT ACCRUED INTEREST IN INSTRUMENT CURRENCY
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C*
     C** EDIT BOOK PRICE
     C           QFBOPR    IFNE *ZERO                      B2
     C                     MOVEL*BLANKS   ZFIELD
     C           QFBOPR    IFGT 99999                      B3
     C                     Z-ADD3         ZADEC
     C                     Z-ADD6         ZADIG
     C                     Z-ADDQFBOPR    WWPRI3
     C                     MOVE WWPRI3    ZFIELD
     C                     ELSE                            X3
     C                     Z-ADDQFBOPR    WWPRI1    H
     C                     MOVE WWPRI1    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     END                             E3
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFOPR
     C                     ELSE                            X2
     C                     MOVE *BLANK    DDFOPR
     C                     END                             E2
     C*
     C** EDIT BOOK (FOLIO) FX RATE
     C           QFBFXR    IFNE *ZERO                      B2
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFBFXR    WWRATE  84H
     C                     MOVE WWRATE    ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFXRA
     C                     ELSE                            X2
     C                     MOVE *BLANK    DDFXRA
     C                     END                             E2
     C*
     C** EDIT FX P/L
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDEXPL
     C*
     C** EDIT MARKET YIELD
     C           QFMKYD    IFGT *ZERO                      B2
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFMKYD    WWPRIC 105H
     C                     MOVE WWPRIC    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD5         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKTY
     C                     ELSE                            X2
     C           QFMKYD    IFEQ -9999                      B3
     C                     MOVE *BLANKS   DDMKTY
     C                     MOVE 'N/A '    DDMKTY
     C                     ELSE                            X3
     C                     MOVEL*BLANKS   DDMKTY
     C                     END                             E3
     C                     END                             E2
     C*
     C** EDIT BOOK YIELD
     C           QFBKYD    IFGT *ZERO                      B2
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFBKYD    WWPRIC    H
     C                     MOVE WWPRIC    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD5         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFOLY
     C                     ELSE                            X2
     C           QFBKYD    IFEQ -9999                      B3
     C                     MOVE *BLANKS   DDFOLY
     C                     MOVE 'N/A '    DDFOLY
     C                     ELSE                            X3
     C                     MOVEL*BLANKS   DDFOLY
     C                     END                             E3
     C                     END                             E2
     C*
     C** OTHERWISE FORMAT NON-SE DETAILS FOR OUTPUT
     C                     ELSE                            X1
     C*
     C** LOAD MIDAS INSTRUMENT NAME AND DETAILS ENQUIRIES IN SUBFILE
     C                     MOVELQFTXT1    WWNAR1
     C                     MOVELQFTXT2    WWNAR3
     C*
     C                     MOVEL*BLANKS   WWNOM3
     C*
     C** IF MODULE ID = 'FF'
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           QFMODI    IFEQ 'FF'                       B2
     C           BGFUOP    ANDEQ'Y'                                       S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C                     MOVEL*BLANKS   WWNOM1                          S71062
     C*                                                                   S71062
     C** DISPLAY SETTLEMENT DATE                                          S71062
     C**                                                                  S71062
     C           BJDFIN    IFEQ 'M'                                       S71062
     C                     MOVE '1'       *IN98                           S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C                     Z-ADDQFSETD    ZDAYNO                          S71062
     C                     EXSR ZDATE2                                    S71062
     C                     MOVELZDATE     WKSETD                          S71062
     C**                                                                  S71062
     C                     MOVE WWDSET    WWDDAY                          S71062
     C                     MOVE WWMSET    WWMNTH                          S71062
     C                     MOVE WWYSET    WWYEAR                          S71062
     C                     MOVELWWSETD    WWNOM3                          S71062
     C**                                                                  S71062
     C**                                                                  S71062
     C** REFORMAT NUMBER OF OPEN CONTRACTS                                S71062
     C**                                                                  S71062
     C******               Z-ADDQFAMT1    ZFLD15                          S71062
     C******               Z-ADD0         ZDECS                           S71062
     C******               EXSR ZSEDIT                                    S71062
     C******               MOVE ZOUT21    WWNOM1                          S71062
     C                     Z-ADDQFAMT1    ZFLD15                          S71062
     C                     Z-ADD0         ZDECS                           S71062
     C                     EXSR ZSEDIT                                    S71062
     C*                                                                   S71062
     C                     MOVELZOUT21    WWMK22 22                       S71062
     C           QFDTYP    IFEQ 'S '                                      S71062
     C                     MOVE '- '      WWMK22                          S71062
     C                     END                                            S71062
     C                     MOVE WWMK22    WWNOM1                          S71062
     C**                                                                  S71062
     C** DISPLAY PURCHASE/SELL INDICATOR                                  S71062
     C**                                                                  S71062
     C                     MOVELQFDTYP    WWNOM2                          S71062
     C                     END                             E2
     C*
     C** IF MODULE ID = 'DL'
     C           QFMODI    IFEQ 'MD'                       B2
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'FR'
     C           QFMODI    OREQ 'FX'
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
     C*
     C** FOR A MM LOAN NOMINAL SHOULD BE SIGNED '-'
     C           QFDTYP    IFEQ 'IP'                       B3
     C           QFDTYP    OREQ 'TI'
     C           QFDTYP    OREQ 'LN'
     C           QFDTYP    OREQ 'CL'
     C           QFDTYP    OREQ 'DL'
     C                     MOVE '-'       WWNOM1
     C                     END                             E3
     C*
     C** ADD THE 'BUY OR SELL' INDICATOR IN NOMINAL 1
     C                     MOVELQFBYSF    WWNOM1
     C*
     C** IF THE LINE 2 AMOUNT FROM HOLDINGS FILE IS NON ZERO
     C           QFAMT2    IFNE 0                          B3
     C*
     C** EDIT THE LINE 2 AMOUNT
     C                     Z-ADDQFAMT2    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM3
     C*
     C** ADD THE 'BUY OR SELL' INDICATOR IN NOMINAL 2
     C           QFBYSF    IFEQ 'B'                        B4
     C                     MOVEL'S'       WWNOM3
     C                     ELSE                            X4
     C                     MOVEL'B'       WWNOM3
     C                     END                             E4
     C*
     C                     END                             E3
     C*
     C** MOVE THE RELATED DEAL NUMBER INTO THE 'MARKET PRICE'
     C           QFRLDN    IFNE 0                          B3
     C           QFBYSF    ANDNE*BLANKS
     C                     MOVE QFRLDN    DDMKTP
     C                     END                             E3
     C*
     C                     Z-ADDQFAIPC    ZFLD15                    47863
     C                     Z-ADDQMPCDP    ZDECS                     47863
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C*
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C**
     C** OUTPUT DESCRIPTIVE ACCORDING TO THE STATUS OF THE TRANSACTION
     C           QFOPCL    IFEQ 'O'                        B3
     C                     MOVE QFRLDN    DDMTPL
     C                     MOVEL'Close by'DDMTPL
     C                     END                             E3
     C**
     C           QFOPCL    IFEQ 'L'                        B3
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVEL'Open    'DDMTPL
     C                     END                             E3
     C**
     C           QFOPCL    IFEQ 'C'                        B3
     C**
     C           QFDTYP    IFEQ 'OP'                       B4
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVEL'Closed  'DDMTPL
     C                     ELSE                            X4
     C                     MOVE QFRLDN    DDMTPL
     C                     MOVEL'Close of'DDMTPL
     C                     END                             E4
     C**
     C                     END                             E3
     C**
     C           QFOPCL    IFEQ 'M'                        B3
     C                     MOVEL'Matured 'DDMTPL
     C                     END                             E3
     C**
     C                     END                             E2
     C**
     C** IF MODULE ID = 'FD' OR 'FL'
     C           QFMODI    IFEQ 'FI'                       B2
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
     C                     END                             E2
     C*
     C** IF MODULE ID = 'LE'
     C           QFMODI    IFEQ 'LE'                       B2
     C                     Z-SUBQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
     C                     END                             E2
     C*
     C** IF THE MODULE ID IS 'RE'
     C           QFMODI    IFEQ 'RE'                       B2
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
     C*
     C           QFAMT1    IFLE 0                          B3
     C                     MOVE ' '       WWNOM1
     C                     ELSE                            X3
     C                     MOVE '-'       WWNOM1
     C                     END                             E3
     C*
     C** CONVERT THE OTHER AMOUNT
     C           QFOAMT    IFEQ *HIVAL                     B3
     C           QFAMT1    OREQ QFOAMT
     C                     MOVE *BLANKS   WWNOM3
     C                     ELSE                            X3
     C                     Z-ADDQFOAMT    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWWR15
     C           QFOAMT    IFLE 0                          B4
     C                     MOVE ' '       WWWR15
     C                     ELSE                            X4
     C                     MOVE '-'       WWWR15
     C                     END                             E4
     C                     MOVE WWWR15    FLD15  15
     C                     MOVELFLD15     WWNOM3
     C                     MOVEL'('       WWNOM3
     C                     MOVE ')'       WWNOM3
     C                     END                             E3
     C**
     C                     END                             E2
     C*
     C** IF MODULE ID = 'LB'
     C           QFMODI    IFEQ 'LB'                       B2
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
     C*
     C** SET UP INDICATOR STATING WHETHER GUARANTEE / PLEDGE GIVEN OR
     C** OR RECEIVED
     C                     MOVELQFTXT2    WWORK5  5
     C           WWORK5    IFEQ 'GIVEN'                    B3
     C                     MOVEL'G'       WWNOM1
     C                     ELSE                            X3
     C                     MOVEL'R'       WWNOM1
     C                     END                             E3
     C*
     C** IF THE LINE 2 AMOUNT FROM HOLDINGS FILE IS NON ZERO
     C** EDIT THE LINE 2 AMOUNT FOR PLEDGES
     C                     MOVELQFTXT2    WWORK9  9
     C                     MOVE WWORK9    WWORK3  3
     C           WWORK3    IFNE *BLANKS                    B3
     C           WWORK3    ANDNE'FXD'
     C                     Z-ADDQFAMT2    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM3
     C                     MOVEL'U'       WWNOM3
     C                     ELSE                            X3
     C                     MOVE *BLANKS   WWNOM3
     C                     MOVE *BLANKS   QFCCY2
     C                     END                             E3
     C**
     C                     END                             E2
     C**
     C                     MOVELWWTOGW    DDTOG1
     C                     MOVELWWTOGY    DDTOG2
     C*
     C** CURRENCY 1 & CURRENCY 2
     C                     MOVELQFCCY1    DDCCY1
     C***********          MOVELQFCCY2    DDCCY2                          S71062
     C           QFMODI    IFEQ 'FF'                                      S71062
     C                     MOVEL*BLANKS   DDCCY2                          S71062
     C                     ELSE                                           S71062
     C                     MOVELQFCCY2    DDCCY2                          S71062
     C                     END                                            S71062
     C*
     C** IF THE MARKET PRICE IS NON ZERO
     C           QFMPRC    IFNE 0                          B2
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFMPRC    WWPRI1 104H
     C                     MOVE WWPRI1    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKTP
     C                     ELSE                            X2
     C**
     C           QFRLDN    IFEQ 0                          B3
     C                     MOVEL*BLANKS   DDMKTP
     C                     END                             E3
     C**
     C                     END                             E2
     C*
     C** CONVERT MARKET VALUE FROM INSTRUMENT TO PORTFOLIO CCY USING ZCCYX
     C           QFAMT2    IFEQ 0                          B2
     C           QFMODI    OREQ 'FF'                                      S71062
     C*
     C** EDIT MARKET VALUE IN PORTFOLIO CURRENCY
     C                     Z-ADDQFMVPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C*
     C** FOR FX DEALS OUTPUT FX PROFIT AND LOSS AS MARKET VALUE
     C                     ELSE                            X2
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C*
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C                     END                             E2
     C**
     C** EDIT MARKET VALUE IN INSTRUMENT CURRENCY
     C**
     C                     Z-ADDQFMVAL    ZFLD15
     C           QFAMT2    IFNE 0                          B2
     C           QFMODI    ANDNE'FF'                                      S71062
     C           QFFPLC    IFEQ QFCCY1                     B3
     C                     Z-ADDQFCDP1    ZDECS
     C                     ELSE                            X3
     C                     Z-ADDQFCDP2    ZDECS
     C                     END                             E3
     C                     ELSE                            X2
     C                     Z-ADDQFCDP1    ZDECS
     C                     END                             E2
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVIC
     C*
     C** IF THE MARKET FX RATE IS NON ZERO
     C           QFMFXR    IFNE 0                          B2
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFMFXR    WWRATE    H
     C                     MOVE WWRATE    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKFX
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDMKFX
     C                     END                             E2
     C**
     C** IF THE P/L MARKET IS NON ZERO
     C**
     C           QFPLMK    IFNE 0                          B2
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
     C**
     C                     ELSE                            X2
     C**
     C           QFOPCL    IFEQ *BLANKS                    B3
     C                     MOVEL*BLANKS   DDMTPL
     C                     END                             E3
     C**
     C                     END                             E2
     C*
     C** MOVE TRANSACTION NUMBER TO TRANSACTION REFERENCE
     C                     MOVELQFTXT1    WWNARC
     C                     MOVE *BLANKS   WWSECU
     C*
     C           QFMODI    IFNE 'RE'                       B2
     C                     MOVELQFTRNB    WWSECU
     C                     END                             E2
     C*
     C** SET UP PROFIT / LOSS CURRENCY
     C           QFMODI    IFEQ 'FX'                       B2
     C           QFOPCL    ANDNE'C'
     C           QFOPCL    ANDNE'M'
     C                     MOVE QFFPLC    WWTOGC
     C                     END                             E2
     C                     MOVE WWTOGC    DDTOG3
     C**
     C                     MOVE *BLANKS   WWSECU
     C                     MOVELQFTXT2    WWNARC
     C*                                                                   S71062
     C** Display American or European only for FF                         S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C*                                                                   S71062
     C           QFMODI    IFEQ 'FF'                       B2             S71062
     C           BGFUOP    ANDEQ'Y'                                       S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C*                                                                   S71062
     C                     SELEC                           B3             S71062
     C           QFAEIN    WHEQ 'A'                                       S71062
     C                     MOVEL'AMERICAN'WWSECU                          S71062
     C           QFAEIN    WHEQ 'E'                                       S71062
     C                     MOVEL'EUROPEAN'WWSECU                          S71062
     C                     OTHER                                          S71062
     C                     MOVEL*BLANKS   WWSECU                          S71062
     C                     ENDSL                           E3             S71062
     C*                                                                   S71062
     C** Display narrative                                                S71062
     C**                                                                  S71062
     C                     MOVEL*BLANKS   WWOPTS                          S71062
     C                     MOVELQFFOIS    WWFOIS                          S71062
     C                     MOVELWWFFMY    WWMTYR                          S71062
     C                     MOVELWWSETD    WWDATE                          S71062
     C                     MOVELQFTRNB    WWTNBR                          S71062
     C                     MOVELWWOPTS    DDTOG3                          S71062
     C**                                                                  S71062
     C** Display instrument currency on second line                       S71062
     C**                                                                  S71062
     C                     MOVEL*BLANKS   WWFFMT                          S71062
     C                     MOVELQFCCY1    WWCCY1                          S71062
     C                     END                             E2             S71062
     C*
     C                     MOVE WWTOGC    DDTOG4
     C**
     C** IF THE ACCRUED INTEREST AMOUNT IS NON ZERO EDIT FOR OUTPUT
     C           QFMODI    IFEQ 'RE'                       B2
     C           QFMODI    OREQ 'FI'
     C           QFMODI    OREQ 'LE'
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'MD'
     C           QFAMT2    ANDEQ0
     C**
     C** EDIT ACCRUED INTEREST IN PORTFOLIO CURRENCY
     C                     Z-ADDQFAIPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C**
     C** EDIT ACCRUED INTEREST IN INSTRUMENT CURRENCY
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C                     ELSE                            X2
     C**
     C           QFOPCL    IFEQ *BLANKS                    B3
     C                     MOVEL*BLANKS   DDAIPC
     C                     MOVEL*BLANKS   DDAIIC
     C                     END                             E3
     C**
     C                     END                             E2
     C*
     C** IF THE BOOK PRICE IS NON ZERO
     C           QFBOPR    IFNE 0                          B2
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFBOPR    WWPRI1    H
     C                     MOVE WWPRI1    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFOPR
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDFOPR
     C                     END                             E2
     C**
     C** IF THE BOOK FX RATE IS NON ZERO
     C           QFBFXR    IFNE 0                          B2
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFBFXR    WWRATE    H
     C                     MOVE WWRATE    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFXRA
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDFXRA
     C                     END                             E2
     C**
     C           QFMODI    IFEQ 'LE'                       B2
     C           QFMODI    OREQ 'MD'
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'FX'
     C           QFMODI    OREQ 'FR'
     C           QFMODI    OREQ 'FI'
     C**
     C** CONVERT THE P&L MARKET
     C           QFAMT2    IFEQ 0                          B3
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
     C                     END                             E3
     C**
     C** EDIT THE FX P/L
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDEXPL
     C**
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDMTPL
     C                     MOVEL*BLANKS   DDEXPL
     C                     END                             E2
     C**
     C** SET OTHER FIELDS TO BLANK
     C**
     C                     MOVEL*BLANKS   DDMKTY
     C                     MOVEL*BLANKS   DDFOLY
     C*                                                                   S71062
     C** DISPLAY WHEN FF                                                  S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C*                                                                   S71062
     C           QFMODI    IFEQ 'FF'                       B2             S71062
     C           BGFUOP    ANDEQ'Y'                                       S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C*                                                                   S71062
     C** PURCHASE INTEREST                                                S71062
     C*                                                                   S71062
     C           QFPUIT    IFNE *ZEROS                     B3             S71062
     C                     Z-ADDQFPUIT    ZFLD15                          S71062
     C                     Z-ADDQFCDP2    ZDECS                           S71062
     C                     EXSR ZSEDIT                                    S71062
     C                     MOVE ZOUT21    DDAIIC                          S71062
     C                     MOVELWWFFMC    DDFOLY                          S71062
     C                     ELSE                            X3             S71062
     C                     MOVEL*BLANKS   DDAIIC                          S71062
     C                     MOVEL*BLANKS   DDFOLY                          S71062
     C                     END                             E3             S71062
     C*                                                                   S71062
     C** NBR OF CONTRACT <> NBR OF ORIGINAL CONTRACT                      S71062
     C*                                                                   S71062
     C           QFAMT1    IFNE QFAMT2                     B3             S71062
     C*                                                                   S71062
     C           QFAMT1    IFNE *ZEROS                     B4             S71062
     C                     MOVE ' Part Cl'DDFOLY                          S71062
     C                     ELSE                            X4             S71062
     C                     MOVE ' Closed 'DDFOLY                          S71062
     C                     END                             E4             S71062
     C*                                                                   S71062
     C                     ELSE                            X3             S71062
     C                     MOVE ' Open   'DDFOLY                          S71062
     C                     END                             E3             S71062
     C*                                                                   S71062
     C** ACCESS INTYPD TO RETRIEVE TICKS DENOMINATOR AND MINIMUM PRICE    S71062
     C** FLUCTUATION TO DISPLAY MARKET AND BOOK PRICE                     S71062
     C*                                                                   S71062
     C           QFFOIS    CHAININTYP                73                   S71062
     C           *IN73     IFEQ '1'                        ***************S71062
     C                     MOVEL'INTYP'   QMFILE           ** DB ERROR 02*S71062
     C                     MOVELQFFOIS    QMKEY            ***************S71062
     C                     Z-ADD2         QMERRN                          S71062
     C                     EXSR *PSSR                                     S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** MARKET PRICE                                                     S71062
     C*                                                                   S71062
     C           QFMPRC    IFNE *ZEROS                     B3             S71062
     C                     Z-ADDQFMPRC    FFPRIC                          S71062
     C                     Z-ADDTKDM      FFTKDM                          S71062
     C                     Z-ADDMNPF      FFMNPF                          S71062
     C                     EXSR FFPRCS                                    S71062
     C***********          MOVELFFSPRC    DDMKTP                    S71062CFF004
      ** Ouput of FFSPRC now 16 long therefore move in most significant   CFF004
      ** part of FFSPRC.                                                  CFF004
      ** Determine number of leading and trailing blanks.                 CFF004
     C           ' '       CHECKFFSPRC    @L      20                      CFF004
     C           ' '       CHEKRFFSPRC    @R      20                      CFF004
      *                                                                   CFF004
      ** Check if trailing zeroes required (as determined by MNPF).       CFF004
     C           TKDM      IFEQ 100                                       CFF004
     C                     MOVE MNPF      TMPMNP 15                       CFF004
     C           '1'       CHECKTMPMNP    @NDP    20                      CFF004
     C           @NDP      IFGT @R                                        CFF004
     C                     Z-ADD@NDP      @R                              CFF004
     C                     ENDIF                                          CFF004
      *                                                                   CFF004
     C                     ENDIF                                          CFF004
      *                                                                   CFF004
      ** Determine number of characters to extract.                       CFF004
     C           @R        SUB  @L        RSUBL   20                      CFF004
     C                     ADD  1         RSUBL                           CFF004
      ** Extract relevant characters.                                     CFF004
     C           RSUBL     SUBSTFFSPRC:@L DDMKTP    P                     CFF004
     C                     ELSE                            X3             S71062
     C                     MOVEL*BLANKS   DDMKTP                          S71062
     C                     END                             E3             S71062
     C*                                                                   S71062
     C** BOOK PRICE                                                       S71062
     C*                                                                   S71062
     C           QFBOPR    IFNE *ZEROS                     B3             S71062
     C                     Z-ADDQFBOPR    FFPRIC                          S71062
     C                     Z-ADDTKDM      FFTKDM                          S71062
     C                     Z-ADDMNPF      FFMNPF                          S71062
     C                     EXSR FFPRCS                                    S71062
     C***********          MOVELFFSPRC    DDFOPR                    S71062CFF004
      ** Ouput of FFSPRC now 16 long therefore move in most significant   CFF004
      ** part of FFSPRC.                                                  CFF004
      ** Determine number of leading and trailing blanks.                 CFF004
     C           ' '       CHECKFFSPRC    @L      20                      CFF004
     C           ' '       CHEKRFFSPRC    @R      20                      CFF004
      *                                                                   CFF004
      ** Check if trailing zeroes required (as determined before by MNPF).CFF004
     C           TKDM      IFEQ 100                                       CFF004
     C           @NDP      ANDGT@R                                        CFF004
     C                     Z-ADD@NDP      @R                              CFF004
     C                     ENDIF                                          CFF004
      *                                                                   CFF004
      ** Determine number of characters to extract.                       CFF004
     C           @R        SUB  @L        RSUBL   20                      CFF004
     C                     ADD  1         RSUBL                           CFF004
      ** Extract relevant characters.                                     CFF004
     C           RSUBL     SUBSTFFSPRC:@L DDFOPR    P                     CFF004
     C                     ELSE                            X3             S71062
     C                     MOVEL*BLANKS   DDFOPR                          S71062
     C                     END                             E3             S71062
     C*                                                                   S71062
     C** PROFIT AND LOSS MARKET                                           S71062
     C*                                                                   S71062
     C           QFPLMK    IFNE *ZEROS                     B3             S71062
     C                     Z-ADDQFPLMK    ZFLD15                          S71062
     C                     Z-ADDQMPCDP    ZDECS                           S71062
     C                     EXSR ZSEDIT                                    S71062
     C                     MOVE ZOUT21    DDMTPL                          S71062
     C                     ELSE                            X3             S71062
     C                     MOVEL*BLANKS   DDMTPL                          S71062
     C                     END                             E3             S71062
     C*                                                                   S71062
     C** PROFIT AND LOSS MARKET FX                                        S71062
     C*                                                                   S71062
     C           QFPLFX    IFNE *ZEROS                     B3             S71062
     C                     Z-ADDQFPLFX    ZFLD15                          S71062
     C                     Z-ADDQMPCDP    ZDECS                           S71062
     C                     EXSR ZSEDIT                                    S71062
     C                     MOVE ZOUT21    DDEXPL                          S71062
     C                     ELSE                            X3             S71062
     C                     MOVEL*BLANKS   DDEXPL                          S71062
     C                     END                             E3             S71062
     C*                                                                   S71062
     C** DISPLAY ACCRUED INTEREST                                         S71062
     C**                                                                  S71062
     C           QFACIS    IFNE *ZEROS                     B3             S71062
     C                     Z-ADDQFACIS    ZFLD15                          S71062
     C                     Z-ADDQFCDP2    ZDECS                           S71062
     C                     EXSR ZSEDIT                                    S71062
     C                     MOVE ZOUT21    DDAIPC                          S71062
     C                     ELSE                            X3             S71062
     C                     MOVEL*BLANKS   DDAIPC                          S71062
     C                     END                             E3             S71062
     C*                                                                   S71062
     C                     END                             E2             S71062
     C                     END                             E1
     C*
     C** OUTPUT RECORDS TO SUBFILES
     C                     ADD  1         RRN1
     C                     WRITEPM0675S1
     C                     ADD  1         RRN2
     C                     WRITEPM0675S2
     C*
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1003   - CONTROL DISPLAY OF SCREEN                             *
      *                                                                  *
      ********************************************************************
     C           #P1003    BEGSR
     C*
     C** DO UNTIL EITHER F3 OR F12 TAKEN
     C                     MOVE 'Y'       WWLEFT  1
     C                     MOVE '0'       *IN54
     C           *INKC     DOUEQ'1'                        B1
     C           *INKL     OREQ '1'
     C*
     C** IF ROLLUP TAKEN FORMAT NEXT 7 RECORDS FOR OUTPUT
     C           *IN50     IFEQ '1'
     C                     EXSR #P1001
     C                     END
     C*
     C** IF ROLLDOWN TAKEN FORMAT 7 PREVIOUS RECORDS
     C           *IN51     IFEQ '1'
     C                     EXSR #P1004
     C                     END
     C*
     C** DETERMINE SCREEN (LEFT/RIGHT) TO BE DISPLAYED
     C           *INKK     IFEQ '1'                        B2
     C*
     C           WWLEFT    IFEQ 'Y'                        B3
     C                     MOVE 'N'       WWLEFT
     C                     MOVE '1'       *IN54
     C                     ELSE                            X3
     C                     MOVE 'Y'       WWLEFT
     C                     MOVE '0'       *IN54
     C                     END                             E3
     C*
     C                     END                             E2
     C*
     C** IF FIRST SET OF DETAILS OUTPUT DO NOT ALLOW ROLLDOWN
     C           WWFSDT    IFEQ WWTSCR                     B2
     C                     MOVE '0'       *IN53
     C                     ELSE                            X2
     C                     MOVE '1'       *IN53
     C                     END                             E2
     C*
     C** IF LAST SET OF DETAILS OUTPUT DO NOT ALLOW ROLLUP
     C           WWLSDT    IFEQ WWBSCR                     B2
     C                     MOVE '0'       *IN52
     C                     ELSE                            X2
     C                     MOVE '1'       *IN52
     C                     END                             E2
     C*
     C** DETERMINE WHETHER LEFT OR RIGHT SCREEN TO BE OUTPUT
     C           WWLEFT    IFEQ 'Y'                        B2
     C                     WRITEPM0675F1
     C                     WRITEPM0675C1
     C                     WRITEPM0675F2
     C                     READ PM0675F2                 70
     C                     ELSE                            X2
     C                     WRITEPM0675F1
     C                     WRITEPM0675C2
     C                     WRITEPM0675F2
     C                     READ PM0675F2                 70
     C                     END                             E2
     C*
     C** IF F3 TAKEN
     C           *INKC     IFEQ '1'                        B2
     C**
     C***SET*ENQUIRIES*TERMINATING*ON *GDA*TO*'Y'                         S01486
     C** SET ENQUIRIES TERMINATING ON *LDA TO 'Y'                         S01486
     C**
     C                     MOVEL'Y'       QMENQT
     C**
     C***UPDATE *GDA                                                      S01486
     C** UPDATE *LDA                                                      S01486
     C**
     C***********          CALL 'PMC1002'                                 S01486
     C***********          PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C                     END                             E2
     C*
     C** IF F12 TAKEN
     C           *INKL     IFEQ '1'                        B2
     C**********           CALL 'PMC1020'                                 S01486
     C                     RETRN                                          S01486
     C                     END                             E2
     C                     END                             E1
     C*
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1004   - FORMAT PREVIOUS 7 RECORDS FOR OUTPUT                  *
      *                                                                  *
      *                                                                  *
      ********************************************************************
     C           #P1004    BEGSR
     C*
     C** REPOSITION FILE TO FIRST SCREEN RECORD TO BE OUTPUT
     C           WWSVK     IFNE 0
     C********** 6         SUB  WWSVK     K                               S01486
     C           5         SUB  WWSVK     K                               S01486
     C                     Z-ADD0         WWSVK
     C                     ELSE
     C                     Z-ADD0         K
     C                     END
     C*
     C********** K         DOWLT14                                        S01486
     C           K         DOWLT13                                        S01486
     C***********          READPPMCLOCPP                 60               S01486
     C                     READPPMCLOCPD                 60               S01486
     C                     ADD  1         K
     C                     END
     C*
     C** CLEAR SUBFILE
     C                     MOVE '1'       *IN55
     C                     WRITEPM0675C1
     C                     WRITEPM0675C2
     C                     MOVE '0'       *IN55
     C*
     C** POSITION TO START OF CLOSED CUSTOMER POSITION DETAILS
     C***********CLOCKY    READEPMCLOCPP                 60               S01486
     C           CLOCKY    READEPMCLOCPD                 60               S01486
     C*
     C** FORMAT POSITIONS FOR OUTPUT
     C                     Z-ADD0         K
     C                     Z-ADD0         RRN1    10
     C                     Z-ADD0         RRN2    10
     C           *IN60     DOWEQ'0'
     C********** K         ANDLT7                                         S01486
     C           K         ANDLT6                                         S01486
     C*
     C** SAVE FIRST DETAILS OUTPUT
     C           K         IFEQ 0
     C**********           MOVE WWSCRN    WWFSDT 63                                           CGL029
     C                     MOVE WWSCRN    WWFSDT                                              CGL029
     C                     END
     C*
     C** FORMAT RECORD FOR OUTPUT
     C                     EXSR #P1002
     C                     ADD  1         K
     C*
     C********** K         IFLT 7                                         S01486
     C           K         IFLT 6                                         S01486
     C***********CLOCKY    READEPMCLOCPP                 60               S01486
     C           CLOCKY    READEPMCLOCPD                 60               S01486
     C                     END
     C*
     C                     END
     C*
     C** SAVE LAST SET OF DETAILS OUTPUT
     C**********           MOVE WWSCRN    WWLSDT 63                                           CGL029
     C                     MOVE WWSCRN    WWLSDT                                              CGL029
     C*
     C                     ENDSR
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - PROCESS DATA BASE ERRORS                              *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C                     MOVEL'PM0670'  QMPGM
     C**
     C***UPDATE *GDA                                                      S01486
     C** UPDATE *LDA                                                      S01486
     C**
     C***********          CALL 'PMC1002'                                 S01486
     C***********          PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C**
     C                     DUMP
     C**
     C**********           CALL 'PMC1020'                                 S01486
     C**
     C                     ENDSR
     C****************************************************************    S71062
     C**                                                             *    S71062
     C****SR:FFPRCS***-*CONVERTS*A*PRICE*IN*FILE*FORMAT*(*11,7P*)*****    S71062
     C******************TO*ITS*EQUIVALENT*SCREEN*FORMAT*(*12**A*)*****    S71062
     C**  SR:FFPRCS   - CONVERTS A PRICE IN FILE FORMAT ( 15,8P )    *    S71062
     C**                TO ITS EQUIVALENT SCREEN FORMAT ( 16  A )    *    S71062
     C**                                                             *    S71062
     C****INPUTS******-*FFPRIC*(11,7P)*PRICE*(*FILE*FORMAT*)********S71062CFF004
     C**  INPUTS      - FFPRIC (15,8P) PRICE ( FILE FORMAT )              CFF004
     C**                FFTKDM  (3,0P) TICKS DENOMINATOR             *    S71062
     C******************FFMNPF*(11,7P)*MINIMUM*PRICE*FLUCTUATION****S71062CFF004
     C**                FFMNPF (15,8P) MINIMUM PRICE FLUCTUATION          CFF004
     C****OUTPUTS*****-*FFSPRC*(12**A)*PRICE*(*SCREEN*FORMAT*)******S71062CFF004
     C**  OUTPUTS     - FFSPRC (16  A) PRICE ( SCREEN FORMAT )       *    CFF004
     C**                                                             *    S71062
     C****************************************************************    S71062
     C**      SUBROUTINE ONLY CHANGED FOR THIS PROGRAM               *    S71062
     C**      CHANGE I TO W                                          *    S71062
     C**      CHANGE J TO Z                                          *    S71062
     C****************************************************************    S71062
     C           FFPRCS    BEGSR                           ** FFPRCS SR **S71062
     C**                                                                  S71062
     C**                                                                  S71062
     C**                                                                  S71062
     C*     DEFINE INPUT FIELDS                                           S71062
     C**                                                                  S71062
     C** FFPRIC Previously Defined.                                       CFF004
     C***********          Z-ADDFFPRIC    FFPRIC 117                S71062CFF004
     C                     Z-ADDFFPRIC    FFPRIC                          CFF004
     C                     Z-ADDFFTKDM    FFTKDM  30                      S71062
     C** FFMNPF Previously Defined.                                       CFF004
     C***********          Z-ADDFFMNPF    FFMNPF 117                S71062CFF004
     C                     Z-ADDFFMNPF    FFMNPF                          CFF004
     C**                                                                  S71062
     C*     INITIALISE O/P FIELD FFSPRC                                   S71062
     C**                                                                  S71062
     C** FFSPRC Previously Defined.                                       CFF004
     C***********          MOVE *BLANK    FFSPRC 12                 S71062CFF004
     C                     MOVE *BLANK    FFSPRC                          CFF004
     C**                                                                  S71062
     C*     SEARCH FFPRIC FOR 1ST NON ZERO ELEMENT BEFORE DECIMAL         S71062
     C**                                                                  S71062
     C                     Z-ADD1         W       20                      S71062
     C***********W         DOWLT4                                   S71062CFF004
     C           W         DOWLT7                                         CFF004
     C           FFFP,W    ANDEQ0                                         S71062
     C**                                                                  S71062
     C                     ADD  1         W                               S71062
     C**                                                                  S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C******MOVE*ELEMENTS*FROM*FIRST*NON*ZERO*POSITION*TO*4TH*OF*FFFP71062CFF004
     C******MOVE*ELEMENTS*FROM FIRST NON ZERO POSITION TO 7TH OF FFFP     CFF004
     C*     TO CORRESPONDING POSITIONS IN FFSP                            S71062
     C**                                                                  S71062
     C***********W         DOWLE4                                   S71062CFF004
     C           W         DOWLE7                                         CFF004
     C**                                                                  S71062
     C                     MOVE FFFP,W    FFSP,W                          S71062
     C                     ADD  1         W                               S71062
     C**                                                                  S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C*     SET UP DECIMAL OR FRACTION FORMAT SEPARATOR                   S71062
     C**                                                                  S71062
     C           FFTKDM    IFEQ 100                                       S71062
     C*                                                                   S71062
     C                     MOVE '.'       FFPT    1                       S71062
     C*                                                                   S71062
     C                     ELSE                                           S71062
     C*                                                                   S71062
     C                     MOVE '-'       FFPT                            S71062
     C*                                                                   S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C*     DETERMINE NUMBER OF SIGNIFICANT DECIMAL DIGITS                S71062
     C**                                                                  S71062
     C*     IF TICK =100 DETERMINE NO. DECIMAL PLACES FROM FFMNPF         S71062
     C**                                                                  S71062
     C           FFTKDM    IFEQ 100                                       S71062
     C**                                                                  S71062
     C***********          Z-ADD7         W                         S71062CFF004
     C                     Z-ADD8         W                               CFF004
     C           W         DOWGT0                                         S71062
     C           FFMF,W    ANDEQ0                                         S71062
     C*                                                                   S71062
     C                     SUB  1         W                               S71062
     C*                                                                   S71062
     C                     END                                            S71062
     C                     Z-ADDW         FFN     20                      S71062
     C**                                                                  S71062
     C                     ELSE                                           S71062
     C**                                                                  S71062
     C*    DETERMINE NO. OF SIGNIFICANT DIGITS FROM TICK VALUE            S71062
     C**                                                                  S71062
     C           FFTKDM    IFLE 10                                        S71062
     C                     Z-ADD1         FFN                             S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C           FFTKDM    IFGT 10                                        S71062
     C           FFTKDM    ANDLE100                                       S71062
     C                     Z-ADD2         FFN                             S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C           FFTKDM    IFGT 100                                       S71062
     C                     Z-ADD3         FFN                             S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C*    IF NUMBER OF SIGNIFICANT DECIMALS<> 0                          S71062
     C**                                                                  S71062
     C           FFN       IFNE 0                                         S71062
     C**                                                                  S71062
     C*    MOVE FFPT IN TO OUT FIELD                                      S71062
     C**                                                                  S71062
     C***********          MOVE FFPT      FFSP,5                    S71062CFF004
     C                     MOVE FFPT      FFSP,8                          CFF004
     C**                                                                  S71062
     C*    MOVE SIGNIFICANT DIGITS TO CORRESPONDING                       S71062
     C*    POSITIONS IN FFSP                                              S71062
     C**                                                                  S71062
     C***********          Z-ADD5         W                         S71062CFF004
     C                     Z-ADD8         W                               CFF004
     C           FFN       DOWNE0                                         S71062
     C*                                                                   S71062
     C           W         ADD  1         Z       20                      S71062
     C                     MOVE FFFP,W    FFSP,Z                          S71062
     C                     ADD  1         W                               S71062
     C                     SUB  1         FFN                             S71062
     C*                                                                   S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C                     ENDSR                                          S71062
     C********************************************************************S71062
     C**
      /EJECT
      /COPY ZSRSRC,ZSEDITZ3
      /EJECT
      /COPY ZSRSRC,ZEDITZ2
      /EJECT                                                              S71062
      /COPY ZSRSRC,ZDATE2Z2                                               S71062
      /EJECT                                                              S71062
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   TITL - TITLES
TRADE
VALUE
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                      S71062
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                        S71062
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES                                            S71062
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
