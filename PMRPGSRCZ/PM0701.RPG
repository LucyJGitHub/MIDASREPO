     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Positions for selected ccy enquiry')          *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                                 *
     F*                                                               *
     F*  PM0701 - PM POSITIONS FOR SELECTED CURRENCY ENQUIRY          *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
     F*  !--------------------------------------------------------!   *
     F*  ! BE CAREFULL |                                          !   *
     F*  ! When you add a Fix in this Program, may be you should  !   *
     F*  ! put it also in the RPG/PM0700                          !   *
     F*  !--------------------------------------------------------!   *
     F*                                                               *
      *  Last Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 160217             Date 28Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM005             Date 10Jun96               *
     F*                 S10978             DATE 28APR93               *
     F*                 062813             DATE 09NOV93               *
     F*                 S01124             DATE 03JUN94               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  160217 - Correct loading of subfile when records in PMHOLDPD *
     F*           are very similar.                                   *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*  S10978 - JYSZRH: EARLY REDEMPTIONS                           *
     F*  062813 - ERROR ON PORTFOLIO ENQUIRY WITH BLOCK MESSAGE;      *
     F*           INVALID CUSTOMER NUMBER PASSED TO SE6542 PGM        *
     F*  S01124 - PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F***********                                                  S10978 CPM005
     F**CLINT   IF  E           K        DISK                      S10978 CPM005
     F*********** CLINTCAF                          KIGNORE        S10978 CPM005
     F*********** CLINTCCF                          KIGNORE        S10978 CPM005
     F*********** CLINTC1F                          KIGNORE        S10978 CPM005
     F**
     F****PM0701DDCF  E                    WORKSTN                        CPM005
     FPM0701DFCF  E                    WORKSTN                            CPM005
     F                                        RRN1  KSFILE PM0701S1
     F                                        RRN2  KSFILE PM0701S2
     F                                        RRN3  KSFILE PM0701S3
     F                                        RRN4  KSFILE PM0701S4
     F**
     FPMHOLDL9IF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMHOLDP0                          KRENAMEPMHOLDP9
     F**
     F** PREFIX 'QF' **
     F**
     FPMHOLDL6IF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMHOLDP0                          KRENAMEPMHOLDP6
     F** PREFIX 'QF' **
     F****PMMFHLPPIF  E           K        DISK                           CPM005
     FPMMFHLPDIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR
     F            PMHOLDP0                          KRENAMEPMMFHLP0
     F** PREFIX 'PN' **
     F**
     F****PMPORTPPIF  E           K        DISK                           CPM005
     FPMPORTPDIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR
     F** PREFIX 'QA' **
     F**
     F****SDPLINPDIF  E           K        DISK                           CPM005
     F***********                                   KINFSR *PSSR          CPM005
     FPMCIALL0IF  E           K        DISK
     F                                              KINFSR *PSSR
     FPMCIALL1IF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMCIALD0                          KRENAMEPMCIALD1
     FPMCIALL2IF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMCIALD0                          KRENAMEPMCIALD2
     FPMCIALL3IF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMCIALD0                          KRENAMEPMCIALD3
     F***PMCCYTPPIF  E           K        DISK                            CPM005
     FPMCCYTPDIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR
     F***PMTMPTPPIF  E           K        DISK                            CPM005
     FPMTMPTPDIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR
     F****SDPORTPDIF  E                    DISK                           CPM005
     F**********                                    KINFSR *PSSR          CPM005
     F** PREFIX 'LB' **
     F****SDLOMBPDIF  E                    DISK                           CPM005
     F**********                                    KINFSR *PSSR          CPM005
     F** PREFIX 'A6' **
     F****SDCURRL0IF  E           K        DISK                           CPM005
     F**********                                    KINFSR *PSSR          CPM005
     FINTYP   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F******************************************************************
     F**
     F** FUNCTION OF INDICATORS
     F**
     F******************************************************************
     F**
     F** U7      : DATA BASE ERROR
     F** U8      : DATA BASE ERROR
     F** KC      : EXIT OF JOB
     F** KL      : EXIT OF PROGRAM
     F** KI      : TRADE/VALUE DATE SWAP
     F** KK      : WINDOW RIGHT<>LEFT
     F** KX      : CASHFLOW
     F** KY      : CUSTOMER NOTEPAD
     F**
     F***51******:*PM0701DD*INDICATOR*FOR*TITLE                           CPM005
     F***52******:*PM0701DD*INDICATOR*FOR*TITLE                           CPM005
     F***53******:*PM0701DD*INDICATOR                                     CPM005
     F***54******:*PM0701DD*INDICATOR                                     CPM005
     F** 51      : PM0701DF INDICATOR FOR TITLE                           CPM005
     F** 52      : PM0701DF INDICATOR FOR TITLE                           CPM005
     F** 53      : PM0701DF INDICATOR                                     CPM005
     F** 54      : PM0701DF INDICATOR                                     CPM005
     F**
     F***59******:*PM0701DD*INDICATOR*-*PROTECT*MODE                      CPM005
     F***60******:*PM0701DD*INDICATOR*-*ANY*VALID*KEY                     CPM005
     F***56-58***:*PM0701DD*INDICATOR*-*ERROR*INDICATORS                  CPM005
     F***67******:*PM0701DD*INDICATOR*-*ERROR*INDICATOR                   CPM005
     F** 59      : PM0701DF INDICATOR - PROTECT MODE                      CPM005
     F** 60      : PM0701DF INDICATOR - ANY VALID KEY                     CPM005
     F** 56-58   : PM0701DF INDICATOR - ERROR INDICATORS                  CPM005
     F** 67      : PM0701DF INDICATOR - ERROR INDICATOR                   CPM005
     F**
     F** 70 - 72 : FILE PROCESSING
     F**
     F** 79      : CALLED FROM PM0660(SEARCH AND SELECT)
     F**
     F** 80      : PROGRAM ERROR INDICATOR
     F**
     F** 90 - 99 : STANDARD SUBROUTINES
     F**
     F******************************************************************
     E**
     E**
     E** TABLES AND ARRAYS
     E*********************************************************************
      ***ARRAY*FOR*COPYRIGHT                                              CPM005
      ** ARRAY FOR COPYRIGHT                                              CPM005
      *
     E                    CPY@    1   1 80
     E**
      ** ARRAY FOR TO TRANSMIT ORDER NUMBER AS A PARAMETER TO PM2130
      *
     E                    ORD        50  3
     E***********                                                         CPM005
     E***ARRAY*TO*ENABLE*ATTENTION*KEY                                    CPM005
     E***********                                                         CPM005
     E***********         ATN     1   1 22                                CPM005
     E*
     E** PAGE HEADING ARRAYS: TRADE DATE LIVE RECORDS
     E**********          TVDD      150 63  A                                                 CGL029
     E                    TVDD      150 69  A                                                 CGL029
     E                    HOAR      150  5 0                              160217
     E**
      /COPY ZSRSRC,FFPRCSZ2
      /COPY ZSRSRC,ZSEDITZ1
      /COPY ZSRSRC,ZEDITZ1
      /COPY ZSRSRC,ZPOWERZ1
      /COPY ZSRSRC,ZDATE2Z1
     E**********          BLK     1   4 25                                CPM005
     E                    BLK         4 25                                CPM005
     E**
     E** ARRAY FOR NARRATIVES
     E**
     E**********          NARR    1   2 15                                CPM005
     E                    NARR        2 15                                CPM005
     E**                                                                  CPM005
     E                    VC1    10  10  1               Valides codes    CPM005
     E********************************************************************
     I**
     I** EXTERNAL FORMAT FOR GROUP DATA AREA
     I**
     I****WWGDA     E DSPMGRDAPP                                          CPM005
     I**
     I****WWLDA     E DSPMLDAPP                                           CPM005
     IWWLDA     E DSPMLDAPD                                               CPM005
     I**
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     IPSDS       SDS
     I**********                            244 253 WSID                  CPM005
     I**********                            254 263 USID                  CPM005
     I                                      244 253 WKSTN                 CPM005
     I                                      254 263 USER                  CPM005
     I**
     I** DATA STRUCTURE FOR RETAIL PROCESSING
     I**
     I            DS
     I**********                              1  18 WWTEXT                                    CGL029
     I                                        1  24 WWTEXT                                    CGL029
     I                                        1   60WWTCNM
     I***********                             7   7 FILL1                 CPM005
     I***********                             8  10 WWTCCY                CPM005
     I***********                            11  11 FILL2                 CPM005
     I***********                            12  150WWTACO                CPM005
     I***********                            16  16 FILL3                 CPM005
     I***********                            17  180WWTACS                CPM005
     I                                        7   9 WWTCCY                CPM005
     I**********                             10  130WWTACO                             CPM005 CGL029
     I**********                             14  150WWTACS                             CPM005 CGL029
     I**********                             16  18 WWBRCD                             CPM005 CGL029
     I                                       10  190WWTACO                                    CGL029
     I                                       20  210WWTACS                                    CGL029
     I                                       22  24 WWBRCD                                    CGL029
     I**
     I** DATA STRUCTURE TO OUTPUT FIELDS TO SUBFILE
     I            DS
     I**********                              1  40 DDLIN1                                    CGL029
     I                                        1  46 DDLIN1                                    CGL029
     I*
     I                                        1   4 DDPER1
     I                                        1   3 FIELA1
     I                                        4   4 FIELA2
     I*
     I                                        1   3 DDCCY1
     I*
     I**********                              5  40 DDTOG1                                    CGL029
     I                                        5  46 DDTOG1                                    CGL029
     I                                        5  19 DDNOM1
     I                                       20  20 DDFIL1
     I**********                             21  40 DDNARR                                    CGL029
     I                                       21  46 DDNARR                                    CGL029
     I            DS
     I**********                              1  40 DDLIN2                                    CGL029
     I                                        1  46 DDLIN2                                    CGL029
     I*
     I                                        1   4 DDPER2
     I                                        1   3 FIELB1
     I                                        4   4 FIELB2
     I*
     I                                        1   3 DDCCY2
     I*
     I**********                              5  40 DDTOG2                                    CGL029
     I                                        5  46 DDTOG2                                    CGL029
     I                                        5  19 DDNOM2
     I                                       20  20 DDFIL2
     I**********                             21  40 DDDETA                                    CGL029
     I                                       21  46 DDDETA                                    CGL029
     I            DS
     I                                        1  21 ZOUT21
     I                                       18  20 WWPERC
      /COPY ZSRSRC,ZSEDITZ2
      /COPY ZSRSRC,FFSRDSZ1
      /COPY ZSRSRC,FFPRCSZ3
     I**
     I** DATA STRUCTURE FOR PAGE HEADING INFORMATION
     I**
     IWWPAGE      DS
     I                                        1   2 QFPOST
     I                                        3   5 QFCCY1
     I                                        6   70QFDSPS
     I                                        8  10 QFDSPG
     I                                       11  120QFITDS
     I                                       13  15 QFINNR
     I                                       16  26 QFPOSQ
     I                                       27  36 QFTDSS
     I**********                             37  420QFTRNB                                    CLE148
     I                                       37  42 QFTRNB                                    CLE148
     I                                       43  480QFACNO                CPM005
     I**********                             43  62 QFTXT2                                    CGL029
     I**********                             63  63 WWDETT                                    CGL029
     I                                       43  68 QFTXT2                                    CGL029
     I                                       69  69 WWDETT                                    CGL029
     I*
     I                                       43  45 WWFFMC
     I                                       47  51 WWFFMY
     IW2SCRN      DS
     I**********                              1   60W2CNUM                                    CSD027
     I                                        1   6 W2CNUM                                    CSD027
     I                                        7  10 W2PTFR
     I                                       11  120W2DSPS
     I                                       13  15 W2DSPG
     I                                       16  170W2ITDS
     I                                       18  20 W2INNR
     I                                       21  230W2DLSQ
     I                                       24  26 W2CCY1
     I                                       27  36 W2TDSS
     I**********                             37  420W2TRNB                                    CLE148
     I                                       37  42 W2TRNB                                    CLE148
     I**********                             43  62 W2TXT2                                    CGL029
     I                                       43  68 W2TXT2                                    CGL029
     ISDMMOD    E DSSDMMODPD                                              CPM005
     I** EXTERNAL DS FOR MODULES DETAILS                                  CPM005
     I*                                                                   CPM005
     ISDPORT    E DSSDPORTPD                                              CPM005
     I** EXTERNAL DS FOR PORTFOLIO DETAILS                                CPM005
     I*                                                                   CPM005
     ISDLOMB    E DSSDLOMBPD                                              CPM005
      ** LB MODULE ACCESSED VIA ACCESS PROGRAM                            CPM005
     I*                                                                   CPM005
     ISDCURR    E DSSDCURRPD                                              CPM005
     I* DS FOR CURRENCIES DETAILS                                         CPM005
     I*                                                                   CPM005
     ISDCUST    E DSSDCUSTPD                                              CPM005
     I** DUMMY RECORD FORMAT FOR CUSTOMER DETAILS                         CPM005
     I*                                                                   CPM005
     ISDBANK    E DSSDBANKPD                                              CPM005
     I** EXTERNAL DS FOR BANK DETAILS                                     CPM005
     I*                                                                   CPM005
     ISDPLIN    E DSSDPLINPD                                              CPM005
     I** EXTERNAL DS FOR INSTRUMENT DETAILS                               CPM005
     I*                                                                   CPM005
     ISCSARD    E DSSCSARDPD                                              CPM005
     I** DUMMY RECORD FORMAT FOR SWITCHABLE FEATURES                      CPM005
     I*                                                                   CPM005
     IDSFDY     E DSDSFDY                                                 CPM005
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                CPM005
     IDSSDY     E DSDSSDY                                                 CPM005
     I* FIRST DS FOR ACCESS PROGRAMS, LONG  DATA STRUCTURE                CPM005
     I*
     ICPYR@#      DS
     I*
     I** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I            DS                                                      S10978
     I                                        1   6 #FLD##                S10978
     I                                        1   2 #FLDG#                S10978
     I                                        4   5 #FLDS#                S10978
     I                                        1   6 #FLDB#                S10978
     I**                                                                  S10978
     I*
     I            DS
     I*
     I** DATA STRUCTURE TO DISPLAY SETTLEMENT DATE ONLY WHEN FF
     I*
     I                                        1   2 WWDDAY
     I I            '/'                       3   3 WWORK1
     I                                        4   5 WWMNTH
     I I            '/'                       6   6 WWORK2
     I                                        7   8 WWYEAR
     I                                        1   8 WWSETD
     I            DS
     I                                        1   20WWDSET
     I                                        3   40WWMSET
     I                                        5   60WWYSET
     I***********                             1   60QFSETD                CPM005
     I                                        1   60WKSETD                CPM005
     I            DS
     I*
     I** DATA STRUCTURE TO DISPLAY DDNOM1
     I*
     I                                        1  15 WWNOM1
     I                                        4   4 WWNO12
     I                                        6   7 WWNO13
     I                                        8   8 WWSIGN
     I            DS
     I*
     I** DATA STRUCTURE TO DISPLAY DDNAR2
     I*
     I**********                              1  20 WWNAR2                                    CGL029
     I                                        1  26 WWNAR2                                    CGL029
     I                                        1   5 WWFOIS
     I                                        7  11 WWMTYR
     I                                       13  20 WWDATE
     I            DS
     I*
     I** DATA STRUCTURE TO DISPLAY DDDET2
     I*
     I**********                              1  20 DDDET2                                    CGL029
     I                                        1  26 DDDET2                                    CGL029
     I                                        1   3 WWCCY1
     I                                        4   9 WWMONT
     I*
     I**  DISPLAY TITLE ON SCREEN
     I            DS
     I                                        1  18 DDCUPO
     I                                        1   4 DDCUP1
     I                                        5  18 DDCUP2
     I**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P1001   - PROCESS PM HOLDINGS SCREEN                            *
      * #P1002   - LOAD SUBFILE WITH TRADE DATE HOLDINGS                 *
      * #P1003   - LOAD SUBFILE WITH VALUE DATE HOLDINGS                 *
      * #P1004   - FORMAT 'SE' HOLDINGS FOR OUTPUT TO SUBFILE            *
      * #P1005   - FORMAT 'FF' 'DL' 'LE' AND 'RE' HOLDINGS               *
      * #P1006   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      * #P1007   - LOAD SUBFILE WITH ALL POSITIONS FOR SECURITY          *
      * #P1008   - DISPLAY INSTRUMENT DETAILS OF A HOLDING               *
      * #P1009   - DISPLAY TRANSACTION DETAILS OF A HOLDING              *
      * #P1010   - DISPLAY DETAILS OF PLEDGES                            *
      * #P1011   - SET UP ARRAY OF VALUE DATE PAGE HEADINGS              *
      * #P1012   - SET UP ARRAY OF TRADE DATE PAGE HEADINGS              *
      * #V1001   - VALIDATE SUBFILE ENTRIES                              *
      * #U1001   - FILL SUBFILE HEADER                                   *
      * ZSEDIT   - TO CONVERT NUMERIC FIELD WITH DECIMAL POINT           *
      * ZEDIT    - TO CONVERT A NUMERIC FIELD WITH DECIMAL POINT         *
      * *PSSR    - TO PROCESS DATA BASE ERRORS                           *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      **PMC1010**-*PROGRAM*CALLED*TO*RETRIEVE *GDA************************CPM005
      * PMC1003  - PROGRAM CALLED TO RETRIEVE *LDA                       *CPM005
      **QCMDEXC* -*SYSTEM*PORGRAM*****************************************CPM005
      **PMC1000**-*PROGRAM*CALLED*TO*UPDATE *GDA**************************CPM005
      * PMC1001  - PROGRAM CALLED TO UPDATE *LDA                         *CPM005
      **PMC1020**-*PROGRAM*CALLED*TO*END*GROUP*JOB************************CPM005
      * PM0660   - SEARCH AND PROMPT SELECT                              *
      * PM0640   - PORTFOLIO CASHFLOW                                    *
      * PM0600   - CUSTOMER NOTEPAD                                      *
      * PM0650   - INSTRUMENT CASHFLOW                                   *
      * PM2000   - DEAL DETAILS                                          *
      * PM2010   - LOAN DETAILS                                          *
      * PM2020   - SECURITY DETAILS                                      *
      * PM2030   - F&O INSTRUMENT DETAILS                                *
      * PM2040   - RETAIL ACCOUNT DETAILS                                *
      * PM2050   - PORTFOLIO MOVEMENTS (SE)                              *
      * PM2055   - PORTFOLIO MOVEMENTS (SE)                              *CPM005
      * PM2070   - DEAL AMENDMENTS PER DEAL                              *
      * PM2080   - LOAN AMENDMENTS PER LOAN                              *
      * PM2090   - F&O TRANSACTION DETAILS                               *
      *                                                                  *
      ********************************************************************
     C*                                                                   CPM005
     C                     MOVEACPY@      CPY2@  80                       CPM005
     C*                                                                   CPM005
     C**
     C** KEY LISTS
     C**
     C           PMHOLA    KLIST
     C                     KFLD           QFCNUM
     C                     KFLD           QFPTFR
     C                     KFLD           QFCCY1
     C                     KFLD           QFPOST
     C                     KFLD           QFDSPS
     C                     KFLD           QFDSPG
     C                     KFLD           QFITDS
     C                     KFLD           QFINNR
     C                     KFLD           QFPOSQ
     C                     KFLD           QFTDSS
     C                     KFLD           QFTRNB
     C                     KFLD           QFTXT2
     C           PMHOLD    KLIST
     C                     KFLD           QFCNUM
     C                     KFLD           QFPTFR
     C                     KFLD           QFDSPS
     C                     KFLD           QFDSPG
     C                     KFLD           QFITDS
     C                     KFLD           QFINNR
     C                     KFLD           QFDLSQ
     C                     KFLD           QFCCY1
     C                     KFLD           QFTDSS
     C                     KFLD           QFTRNB
     C                     KFLD           QFTXT2
     C**
     C           PMHOLZ    KLIST
     C                     KFLD           QFCNUM
     C                     KFLD           QFPTFR
     C                     KFLD           QFDSPS
     C                     KFLD           QFDSPG
     C                     KFLD           QFITDS
     C                     KFLD           QFINNR
     C                     KFLD           QFDLSQ
     C                     KFLD           QFCCY1
     C                     KFLD           QFTDSS
     C                     KFLD           QFTRNB
     C                     KFLD           QFTXT2
     C**
     C           PMHOLG    KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           WWPTFR
     C                     KFLD           WWDSPS
     C                     KFLD           WWDSPG
     C                     KFLD           WWITDS
     C                     KFLD           WWINNR
     C**
     C           PMHOL6    KLIST
     C                     KFLD           WWTDS1 10
     C**********           KFLD           WWCNM1  60                                          CSD027
     C                     KFLD           WWCNM1  6                                           CSD027
     C                     KFLD           WWTVD1  1
     C                     KFLD           WWPTF1  4
     C**
     C           KLPORT    KLIST
     C                     KFLD           QFCNUM
     C                     KFLD           QFPTFR
      *
      **  ACCESS PMCIALL0
     C           PMCIA0    KLIST
     C**********           KFLD           W0CNUM  60                                          CSD027
     C                     KFLD           W0CNUM  6                                           CSD027
     C                     KFLD           W0PTF1  4
     C                     KFLD           W0CURR  3
     C                     KFLD           W0POTY  2
     C                     KFLD           W0TOTT  1
      *
      **  ACCESS PMCIALL1
     C           PMCIA1    KLIST
     C**********           KFLD           W1CNUM  60                                          CSD027
     C                     KFLD           W1CNUM  6                                           CSD027
     C                     KFLD           W1PTF1  4
     C                     KFLD           W1CURR  3
      *
      **  ACCESS PMCIALL2
     C           PMCIA2    KLIST
     C**********           KFLD           W0CNUM  60                                          CSD027
     C                     KFLD           W0CNUM  6                                           CSD027
     C                     KFLD           W0PTF1  4
     C                     KFLD           W0CURR  3
     C                     KFLD           W0POTY  2
     C                     KFLD           W0INSC  3
      *
      **  ACCESS PMCIALL3
     C           PMCIA3    KLIST
     C**********           KFLD           W0CNUM  60                                          CSD027
     C                     KFLD           W0CNUM  6                                           CSD027
     C                     KFLD           W0PTF1  4
     C                     KFLD           W0CURR  3
     C                     KFLD           W0POTY  2
     C                     KFLD           W0TOTT  1
     C                     KFLD           W0DGRS  20
     C                     KFLD           W0DGRC  3
     C                     KFLD           W0INDS  20
     C                     KFLD           W0INSC  3
      *
      ****ACCESS*PMTMPTPP                                                 CPM005
      **  ACCESS PMTMPTPD                                                 CPM005
     C           PMTMPT    KLIST
     C                     KFLD           QFCNUM
     C                     KFLD           QFPTFR
     C                     KFLD           QFDSPS
     C                     KFLD           QFDSPG
     C                     KFLD           QFITDS
     C                     KFLD           QFINNR
     C                     KFLD           QMCCY1
      *
      ****ACCESS*PMCCYTPP                                                 CPM005
      **  ACCESS PMCCYTPD                                                 CPM005
     C           PMCCYT    KLIST
     C                     KFLD           QFCNUM
     C                     KFLD           QFPTFR
     C                     KFLD           QMCCY1
     C********************************************************
     C** P R O G R A M   S T A R T
     C********************************************************
     C**
     C                     EXSR #INIT
     C**
     C                     EXSR #P1001
     C**
     C                     RETRN
     C********************************************************
     C** P R O G R A M   E N D
     C********************************************************
     C**
     ******************************************************************   S10978
     C/EJECT                                                              S10978
     ******************************************************************   S10978
     C* P002   : CHANGE SCREEN DETAILS                                *   S10978
     ******************************************************************   S10978
     C*                                                                   S10978
     C           P002      BEGSR                                          S10978
     C*                                                                   S10978
     C** PARAMETERS - DEFINITION AND INITIALIZATION                       S10978
     C                     MOVEL*BLANKS   ##CDBR  3                       S10978
     C                     MOVEL*BLANKS   ##CDCN  6                       S10978
     C                     MOVEL*BLANKS   ##CDSN 10                       S10978
     C                     MOVEL*BLANKS   ##PTFR  4                       S10978
     C                     MOVEL*BLANKS   ##CPBI  1                       S10978
     C                     MOVEL*BLANKS   ##CSBI  1                       S10978
     C                     MOVEL*OFF      ##FLAG  1                       S10978
     C                     MOVEL*BLANKS   HBLOCK  2                       S10978
     C                     MOVEL*BLANKS   GBLOCK  2                       S10978
     C                     MOVEL*BLANKS   SBLOCK  2                       S10978
     C*                                                                   S10978
     C** AFTER THE SECURITY INFORMATIONS WAS RECEIVED FROM BASIC FILE     S10978
     C** LF/SECTY                                                         S10978
     C*                                                                   S10978
     C** 1. SEARCH IF THERE IS A GENERAL BLOCK PURCHASED AND/OR SALES FOR S10978
     C**    SECURITY BY CALLING RPG/SE6712 WITH PARAMETERS:               S10978
     C**     - BRANCH CODE (3A)  CURRENT   FIELD NAME - CDBR - ##CDBR     S10978
     C**     - SECURITY    (10A) CURRENT   FIELD NAME - CDSN - ##CDSN     S10978
     C**     - SECURITY PURCH.GEN.BLOCK IND. (1A)  BLANK       ##CPBI     S10978
     C**     - SECURITY SALES GEN.BLOCK IND. (1A)  BLANK       ##CSBI     S10978
     C******************** MOVE BRCD      ##CDBR                   S10978 CPM005
     C                     MOVE BBBRCD    ##CDBR                          CPM005
     C                     MOVELQFTDSS    ##CDSN                          S10978
     C                     CALL 'SE6712'                                  S10978
     C                     PARM           ##CDBR                          S10978
     C                     PARM           ##CDSN                          S10978
     C                     PARM           ##CPBI                          S10978
     C                     PARM           ##CSBI                          S10978
     C*                                                                   S10978
     C** 2. IF 'SECURITY PURCH.GEN.BLOCK IND.' = 'Y' OR                   S10978
     C**       'SECURITY SALES GEN.BLOCK IND.' = 'Y'                      S10978
     C*                                                                   S10978
     C** 2.1 MOVE 'BLK' INTO THE FIRST CURRENCY FIELD OF THE SECOND       S10978
     C**     SUBFILE RECORD                                               S10978
     C**     MOVE LEFT 'GB', 'GP', 'GS', DEPENDING CONTENS OF THE         S10978
     C**     RECEIVED INDICATORS INTO THE SECURITY REFERENCE FIELD        S10978
     C**     OF THE SECOND LINE OF THE SUBFILE RECORD.                    S10978
     C                     SELEC                                          S10978
     C           ##CPBI    WHEQ 'Y'                                       S10978
     C           ##CSBI    ANDEQ'Y'                                       S10978
     C                     MOVEL'GB'      GBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C           ##CPBI    WHEQ 'Y'                                       S10978
     C                     MOVEL'GP'      GBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C           ##CSBI    WHEQ 'Y'                                       S10978
     C                     MOVEL'GS'      GBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C                     OTHER                                          S10978
     C                     MOVEL*BLANKS   GBLOCK                          S10978
     C                     ENDSL                                          S10978
     C*                                                                   S10978
     C** 3. SEARCH IF THERE IS A SPECIFIC BLOCK PURCHASED AND/OR SALES    S10978
     C**    FOR CUSTOMER/SECURITY BY CALLING RPG/SE6716 WITH PARAMETERS:  S10978
     C**     - BRANCH CODE (3A)  CURRENT   FIELD NAME - CDBR - ##CDBR     S10978
     C**     - CUSTOMER    (6A)  CURRENT   FIELD NAME - CDCN - ##CDCN     S10978
     C**     - SECURITY    (10A) CURRENT   FIELD NAME - CDSN - ##CDSN     S10978
     C**     - PORTFOLIO   (4A)  CURRENT   FIELD NAME          ##PTFR     S10978
     C**     - PURCH.SPEC.BLOCK IND. (1A)  BLANK               ##CPBI     S10978
     C**     - SALES SPEC.BLOCK IND. (1A)  BLANK               ##CSBI     S10978
     C******************** MOVE BRCD      ##CDBR                   S10978 CPM005
     C                     MOVE BBBRCD    ##CDBR                          CPM005
     C                     MOVE QFCNUM    ##CDCN                          S10978
     C                     MOVELQFTDSS    ##CDSN                          S10978
     C                     MOVELQFPTFR    ##PTFR                          S10978
     C                     CALL 'SE6716'                                  S10978
     C                     PARM           ##CDBR                          S10978
     C                     PARM           ##CDCN                          S10978
     C                     PARM           ##CDSN                          S10978
     C                     PARM           ##PTFR                          S10978
     C                     PARM           ##CPBI                          S10978
     C                     PARM           ##CSBI                          S10978
     C*                                                                   S10978
     C** 4. IF 'PURCH.SPECIFIC BLOCK IND.' = 'Y' OR                       S10978
     C**       'SALES SPECIFIC BLOCK IND.' = 'Y'                          S10978
     C*                                                                   S10978
     C** 4.1 MOVE 'BLK' INTO THE FIRST CURRENCY FIELD OF THE SECOND       S10978
     C**     SUBFILE RECORD. IT COULD BE ALREADY DONE BY 2.1.             S10978
     C**     MOVE RIGHT 'SB', 'SP', 'SS', DEPENDING CONTENS OF THE        S10978
     C**     RECEIVED INDICATORS INTO THE SECURITY REFERENCE FIELD        S10978
     C**     OF THE SECOND LINE OF THE SUBFILE RECORD.                    S10978
     C                     SELEC                                          S10978
     C           ##CPBI    WHEQ 'Y'                                       S10978
     C           ##CSBI    ANDEQ'Y'                                       S10978
     C                     MOVEL'SB'      SBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C           ##CPBI    WHEQ 'Y'                                       S10978
     C                     MOVEL'SP'      SBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C           ##CSBI    WHEQ 'Y'                                       S10978
     C                     MOVEL'SS'      SBLOCK                          S10978
     C                     MOVEL*ON       ##FLAG                          S10978
     C                     OTHER                                          S10978
     C                     MOVEL*BLANKS   SBLOCK                          S10978
     C                     ENDSL                                          S10978
     C*                                                                   S10978
     C           ##FLAG    IFEQ *ON                                       S10978
     C                     MOVELDDTOG4    #FLD##                          S10978
     C                     MOVEL*BLANKS   #FLDB#                          S10978
     C                     MOVELGBLOCK    #FLDG#                          S10978
     C                     MOVELSBLOCK    #FLDS#                          S10978
     C                     MOVEL#FLD##    DDTOG4                          S10978
     C                     MOVEL'BLK'     DDCCY2                          S10978
     C                     ENDIF                                          S10978
     C*                                                                   S10978
     C                     ENDSR                                          S10978
     C* P002   : CHANGE SCREEN DETAILS                                *   S10978
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BLANK   - RESET SCREEN FIELDS                                   *
      *                                                                  *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1004
      * #P1005                                                           *
      * #P1007                                                           *
      *                                                                  *
      ********************************************************************
     C           #BLANK    BEGSR
     C**
     C** RESET HIDDEN FIELDS
     C**
     C                     MOVEL*BLANKS   DDSHOR
     C                     MOVEL*BLANKS   DDRECH
     C                     MOVEL*BLANKS   DDMODH
     C                     MOVEL*BLANKS   DDTRNH
     C                     MOVEL*BLANKS   DDFOIH
     C                     MOVEL*BLANKS   DDCNUM                          CPM005
     C                     MOVEL*BLANKS   DDCCYH
     C                     MOVEL*BLANKS   DDACOH
     C                     MOVEL*BLANKS   DDACSH
     C                     MOVEL*BLANKS   DDBRCH                          CPM005
     C                     Z-ADD0         DDCLOH
     C**
     C** RESET SUBFILE FIELDS
     C**
     C                     MOVEL*BLANKS   DDNARR
     C                     MOVEL*BLANKS   DDNAR2
     C                     MOVEL*BLANKS   DDNOM1
     C                     MOVEL*BLANKS   DDFIL1
     C                     MOVE *BLANKS   DDCCY1
     C                     MOVEL*BLANKS   DDMKTP
     C                     MOVEL*BLANKS   DDMFXR
     C                     MOVEL*BLANKS   DDMVPC
     C                     MOVEL*BLANKS   DDMVIC
     C                     MOVEL*BLANKS   DDDETA
     C                     MOVEL*BLANKS   DDDET2
     C                     MOVEL*BLANKS   DDNOM2
     C                     MOVEL*BLANKS   DDFIL2
     C                     MOVE *BLANKS   DDCCY2
     C                     MOVEL*BLANKS   DDFOPR
     C                     MOVEL*BLANKS   DDFFXR
     C                     MOVEL*BLANKS   DDAIPC
     C                     MOVEL*BLANKS   DDAIIC
     C                     MOVEL*BLANKS   DDSECU
     C                     MOVEL*BLANKS   DDAMEU
     C                     MOVEL*BLANKS   DDMKTY
     C                     MOVEL*BLANKS   DDMTPL
     C                     MOVEL*BLANKS   DDFOLY
     C                     MOVEL*BLANKS   DDEXPL
     C                     MOVEL*BLANKS   DDCOLR
     C                     MOVE *BLANKS   DDTOG4                          S10978
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **PMC1010**-*PROGRAM*CALLED*TO*RETRIEVE *GDA************************CPM005
      * PMC1003  - PROGRAM CALLED TO RETRIEVE *LDA                       *CPM005
      **QCMDEXC**-*SYSTEM*PORGRAM*****************************************CPM005
      * #P1002   - LOAD SUBFILE WITH TRADE DATE HOLDINGS                 *
      * #P1003   - LOAD SUBFILE WITH VALUE DATE HOLDINGS                 *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      **WWPARM***- *GDA***************************************************CPM005
      * WWPARM   - *LDA                                                  *CPM005
      * WWCNUM   - CUSTOMER NUMBER                                       *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      * WWDSPS   - DISPLAY SEQUENCE                                      *
      * WWDSPG   - DISPLAY GROUP                                         *
      * WWITDS   - INSTRUMENT DISPLAY SEQUENCE                           *
      * WWINNR   - INSTRUMENT TYPE                                       *
      * WWFLD    - WORK FIELD                                            *
      * WWNUMB   - PARAMETER                                             *
      * WWDISP   - DISPLAY INDICATOR                                     *
      * WWINTV   - INTERIM TRADE/VALUE INDICATOR                         *
      *                                                                  *
      ********************************************************************
     C           #INIT     BEGSR
     C*
     C                     MOVEA*BLANKS   ORD
     C                     Z-ADD0         PL
      *                                                                   CPM005
      **  Access SAR details file to see if JYSKE Enhcmts is installed.   CPM005
      *                                                                   CPM005
     C                     CALL 'AOSARDR0'                                CPM005
     C                     PARM '       ' @RTCD                           CPM005
     C                     PARM '*VERIFY' @OPTN                           CPM005
     C                     PARM 'S01496'  @SARD   6                       CPM005
     C           SCSARD    PARM SCSARD    DSFDY                           CPM005
      *                                                                   CPM005
     C           @RTCD     IFEQ *BLANK                                    CPM005
     C                     MOVE 'Y'       S01496  1                       CPM005
     C                     END                                            CPM005
     C           S01496    IFEQ 'Y'                        B0             CPM005
     C                     MOVE '1'       *IN51                           CPM005
     C                     ELSE                            X1             CPM005
     C                     MOVE '0'       *IN51                           CPM005
     C                     END                             E1             CPM005
     C*                                                                   CPM005
     C** Access file SDMMODPD                                             CPM005
     C*                                                                   CPM005
     C                     CALL 'AOMMODR0'                                CPM005
     C                     PARM '*DBERR ' @RTCD   7                       CPM005
     C                     PARM '*FIRST ' @OPTN   7                       CPM005
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPM005
     C*
     C** FIRST TIME PROGRAM CALLED OBTAIN PM ICD
     C**  AND LB ICD
     C           WWMAFF    IFEQ *BLANKS
     C********** 1         SETLLSDLOMBPD                                  CPM005
     C**********           READ SDLOMBPD                 73               CPM005
     C           BGLMCR    IFEQ 'Y'                                       CPM005
     C                     CALL 'AOLOMBR0'                                CPM005
     C                     PARM '*DBERR ' @RTCD   7                       CPM005
     C                     PARM '*FIRST ' @OPTN   7                       CPM005
     C           SDLOMB    PARM SDLOMB    DSFDY                           CPM005
     C                     END                                            CPM005
     C********** 1         SETLLSDPORTPD                                  CPM005
     C**********           READ SDPORTPD                 73               CPM005
     C                     CALL 'AOPORTR0'                                CPM005
     C                     PARM '*DBERR ' @RTCD   7                       CPM005
     C                     PARM '*FIRST ' @OPTN   7                       CPM005
     C           SDPORT    PARM SDPORT    DSFDY                           CPM005
     C                     END
     C*                                                                   CPM005
     C** GET INSTALLATION CONTROL DATA RECORD 1                           CPM005
     C*                                                                   CPM005
     C                     CALL 'AOBANKR0'                                CPM005
     C                     PARM *BLANKS   WWRTCD  7                       CPM005
     C                     PARM '*FIRST ' WWOPTN  7                       CPM005
     C           SDBANK    PARM SDBANK    DSFDY                           CPM005
     C**
     C** RESET WORK FIELDS
     C**
     C                     MOVEL*BLANKS   WWSAVR
     C                     MOVEL*BLANKS   WWSAVM
     C                     MOVEL*BLANKS   WWSAVS
     C                     MOVEL*BLANKS   WWSAVD
     C                     MOVEL*BLANKS   WWACTN  1
     C                     MOVEL*BLANKS   WWPOSO  2
     C                     MOVEL*BLANKS   WWINTO  3
     C                     MOVEL'D'       WWMAFF  1
     C                     Z-ADD0         WWPRIC 105
     C                     Z-ADD0         WWPRI1 104
     C                     Z-ADD0         WWPRI3 103
     C                     Z-ADD0         WWPRI2 102                      CPM005
     C*
     C                     MOVEA*BLANKS   TVDD
     C**
     C** RESET INDICATORS
     C**
     C                     MOVE '0'       *IN
     C                     MOVE '0'       *INKL
     C**
     C                     MOVEL'J'       ZECODE
      *                                                                   CPM005
      **  SET UP PARAMETER TO RETRIEVE MESSAGE FROM MESSAGE FILE          CPM005
     C           PLLANG    PLIST                                          CPM005
     C                     PARM           MSMBR4  7                       CPM005
     C                     PARM           MSGER  10                       CPM005
     C                     PARM           MSGTXT 80                       CPM005
      *                                                                   CPM005
     C                     MOVEL'PMUSRMSG'MSGER                           CPM005
      *                                                                   CPM005
     C                     Z-ADD1         X       10                      CPM005
     C                     MOVEL'PM6000'  MSMBR4                          CPM005
      *                                                                   CPM005
     C           X         DOWLT5                                         CPM005
     C                     MOVE X         MSMBR4                          CPM005
     C                     CALL 'SDRTVTXT'PLLANG                          CPM005
     C                     MOVELMSGTXT    BLK,X     P                     CPM005
     C                     ADD  1         X                               CPM005
     C                     ENDDO                                          CPM005
      *                                                                   CPM005
     C                     MOVEL'PM60007' MSMBR4                          CPM005
     C                     CALL 'SDRTVTXT'PLLANG                          CPM005
     C                     MOVELMSGTXT    NARR,1    P                     CPM005
      *                                                                   CPM005
     C                     MOVEL'PM60006' MSMBR4                          CPM005
     C                     CALL 'SDRTVTXT'PLLANG                          CPM005
     C                     MOVELMSGTXT    NARR,2    P                     CPM005
     C**
     C** RETRIEVE DATA AREA *LDA
     C**
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
     C**
     C********** QMTRNB    IFNE 0                                                             CLE148
     C           QMTRNB    IFNE *BLANKS                                                       CLE148
     C           QMSESN    ORNE *BLANKS
     C                     MOVE '1'       *IN79
     C                     END
     C**
     C***LOAD*DATA*AREA *GDA*INFORMATIONS                                 CPM005
     C** LOAD DATA AREA *LDA INFORMATIONS                                 CPM005
     C**
     C                     MOVELQMRUNA    DDRUNA
     C**********           Z-ADDQMCNUM    WWCNUM  60                                          CSD027
     C                     MOVE QMCNUM    WWCNUM  6                                           CSD027
     C                     MOVELQMPTF1    WWPTFR  4
     C                     MOVE QMPOTY    WWPOTY  2
     C                     Z-ADDQMDSPS    WWDSPS  20
     C                     MOVELQMDSPG    WWDSPG  3
     C                     Z-ADDQMITDS    WWITDS  20
     C                     MOVELQMINNR    WWINNR  3
     C                     MOVELQMTOTT    PPTOTT  1        TOTAL TYPE
     C*
     C**********           Z-ADDQMCNUM    W1CNUM                                              CSD027
     C                     MOVE QMCNUM    W1CNUM                                              CSD027
     C                     MOVELQMPTF1    W1PTF1
     C                     MOVEL*BLANKS   W1CURR
     C*
     C                     Z-ADD*ZEROS    PPASSV 150
     C                     Z-ADD*ZEROS    PPLIAV 150
      *
      ** ACCESS TO PMCIALPP
     C           PMCIA1    SETLLPMCIALL1
     C                     READ PMCIALL1                 72
      *
      ** SAVE CUSTOMER NUMBER & PORTFOLIO REFERENCE
     C**********           Z-ADDFICNUM    WSCNUM  60                                          CSD027
     C                     MOVE FICNUM    WSCNUM  6                                           CSD027
     C                     MOVELFIPTFR    WSPTFR  4
      *
     C           *IN72     DOWEQ*OFF                       *BW1
     C           FICNUM    ANDEQWSCNUM
     C           FIPTFR    ANDEQWSPTFR
      *
      **  ADD ASSET & LIABILITY VALUE
     C                     ADD  FIASVL    PPASSV
     C                     ADD  FILIVL    PPLIAV
      *
      **  READ NEXT RECORD
     C                     READ PMCIALL1                 72
      *
     C                     ENDDO                           *EW1
      *
     C                     MOVELQMCCY1    W1CURR
     C*
     C** ACCESS TO PMASLIPP
     C           PMCIA1    CHAINPMCIALL1             72
     C*
     C           *IN72     IFEQ '1'                        ***************
     C                     MOVEL'PMCIALL1'QMFILE           ** DB ERROR 07*
     C                     MOVELW1CURR    QMKEY            ***************
     C                     Z-ADD7         QMERRN
     C                     EXSR *PSSR
     C                     END
      *
      ** EDIT ASSET & LIABILITY VALUE
     C                     Z-ADDFIASVL    PPASVL 150
     C                     Z-ADDFILIVL    PPLIVL 150
     C***********                                                         CPM005
     C***SET*ATTENTION*PROGRAM                                            CPM005
     C***********                                                         CPM005
     C***********QMATTN    IFEQ 'Y'                                       CPM005
     C***********          MOVEAATN       WWFLD  22                       CPM005
     C***********          Z-ADD22        WWNUMB 155                      CPM005
     C***********          CALL 'QCMDEXC'                                 CPM005
     C***********          PARM           WWFLD                           CPM005
     C***********          PARM           WWNUMB                          CPM005
     C***********          END                                            CPM005
     C*
     C** MOVE FIELDS FROM DTAARA/*LDA TO FIELDS USED TO ACCESS HOLDINGS FILE
     C**********           Z-ADDQMCNUM    QFCNUM                                              CSD027
     C                     MOVE QMCNUM    QFCNUM                                              CSD027
     C                     MOVE QMPTF1    QFPTFR
     C                     MOVE QMCCY1    QFCCY1
     C                     MOVE QMPOTY    QFPOST
     C                     Z-ADDQMDSPS    QFDSPS
     C                     MOVE QMDSPG    QFDSPG
     C                     Z-ADDQMITDS    QFITDS
     C                     MOVE QMINNR    QFINNR
     C                     MOVE QMSESN    QFTDSS
     C**********           Z-ADDQMTRNB    QFTRNB                                              CLE148
     C                     MOVELQMTRNB    QFTRNB                                              CLE148
     C                     MOVE *LOVAL    QFPOSQ
     C                     MOVE *LOVAL    QFTXT2
     C*
     C** USING PARAMETERS RECEIVED FROM DTAARA/*LDA OBTAIN FULL KEY DETAILS
     C** FROM PF/PMHOLDPP
     C           PMHOLA    SETLLPMHOLDL9
     C                     READ PMHOLDL9                 72
     C*
     C                     MOVE 'T'       WWDETT
     C**********           MOVE WWPAGE    WWPAG1 63                                           CGL029
     C                     MOVE WWPAGE    WWPAG1 69                                           CGL029
     C**
     C** SET UP ARRAYS OF PAGE HEADINGS FOR TRADE / VALUE DATE AS APPROPRIATE
     C**
     C** POSITION TYPE EQUAL TO 'B' (BLOCK TOTAL)
     C**
     C           PPTOTT    IFEQ 'B'                        B2
     C                     EXSR #P102B
     C                     ELSE                            X2
     C**
     C** POSITION TYPE EQUAL TO 'A' (CURRENCY TOTAL)
     C**
     C           PPTOTT    IFEQ 'A'                        B3
     C                     EXSR #P102A
     C                     ELSE                            X3
     C**
     C** POSITION TYPE EQUAL TO 'I' (INSTRUMENT TOTAL)
     C**
     C                     EXSR #P102I
     C                     END                             E3
     C                     END                             E2
     C**
     C** SET THE SCREEN INDICATOR TO '1' - WHICH SCREEN IS OUTPUT
     C**
     C                     MOVE '1'       WWDISP  1
     C**
     C***IF*DISPLAY*TRADE/VALUE*DATE*ON*DTAARA *GDA*IS*'T'                CPM005
     C** IF DISPLAY TRADE/VALUE DATE ON DTAARA *LDA IS 'T'                CPM005
     C**
     C           QMTVPS    IFEQ 'T'
     C**
     C** SET INTERIM TRADE/VALUE INDICATOR TO 'T'
     C**
     C                     MOVEL'T'       WWINTV  1
     C                     MOVE '1'       *IN53
     C                     ELSE
     C                     MOVEL'V'       WWINTV  1
     C                     MOVE '0'       *IN53
     C                     END
     C**
     C** FORCE POSITION IN FILE BY SETTING ON INDICATOR OF ROLLDOWN
     C**
     C                     MOVE '1'       *IN23
     C                     MOVE 'Y'       WWFORC  1
     C                     EXSR #P1002
     C                     MOVE '0'       *IN23
     C**                                                                  CPM005
     C           QMACTP    IFEQ *BLANKS                                   CPM005
     C                     MOVEL'PM0701'  QMACTP    P                     CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     END                                            CPM005
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1001   - PROCESS PM HOLDINGS SCREEN                            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #U1001   - FILL SUBFILE HEADER                                   *
      **PMC1000**-*PROGRAM*CALLED*TO*UPDATE *GDA**************************CPM005
      * PMC1001  - PROGRAM CALLED TO UPDATE *LDA                         *CPM005
      **PMC1020**-*PROGRAM*CALLED*TO*END*GROUP*JOB************************CPM005
      * PM0660   - SEARCH AND PROMPT SELECT                              *
      **PMC1010**-*PROGRAM*CALLED*TO*RETRIEVE *GDA************************CPM005
      * PMC1003  - PROGRAM CALLED TO RETRIEVE *LDA                       *CPM005
      * #P1002   - LOAD SUBFILE WITH TRADE DATE HOLDINGS                 *
      * #P1003   - LOAD SUBFILE WITH VALUE DATE HOLDINGS                 *
      * PM0640   - PORTFOLIO CASHFLOW                                    *
      * PM0600   - CUSTOMER NOTEPAD                                      *
      * #V1001   - VALIDATE SUBFILE ENTRIES                              *
      * PM0650   - INSTRUMENT CASHFLOW                                   *
      * #P1006   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      * #P1008   - DISPLAY INSTRUMENT DETAILS OF A HOLDING               *
      * #P1009   - DISPLAY TRANSACTION DETAILS OF A HOLDING              *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWFLAG   - WORK FLAG                                             *
      * WWDISP   - DISPLAY INDICATOR                                     *
      **WWPARM***- *GDA***************************************************CPM005
      * WWPARM   - *LDA                                                  *CPM005
      * WWEND    - END PARAMETER                                         *
      * WWGRPJ   - GROUP JOB PARAMETER                                   *
      * WWINTV   - INTERIM TRADE/VALUE INDICATOR                         *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      *                                                                  *
      ********************************************************************
     C           #P1001    BEGSR
     C**
     C                     WRITEPM0701F6
     C**
     C** DO UNTIL TERMINATION FLAG IS SET TO 'Y'
     C**
     C           WWFLAG    DOUEQ'Y'
     C**
     C** SET TERMINATION FLAG TO 'N'
     C**
     C                     MOVEL'N'       WWFLAG  1
     C                     MOVEL*BLANK    DDACTN
     C**
     C** FOLLOWING DISPLAY INDICATOR SEND CORRESPONDING FORMAT
     C**
     C           WWDISP    IFEQ '1'
     C**
     C** FORMAT SUBFILE
     C**
     C                     EXSR #U1001
     C                     WRITEPM0701F3
     C                     WRITEPM0701F1
     C*
     C* IF NO DETAILS READ, INIT SUBFILE TO PROCESS IT WITH NO DETAILS
     C*
     C           RRN1      IFEQ 0
     C                     SETON                     62
     C                     ELSE
     C                     SETOF                     62
     C                     END
     C                     EXFMTPM0701C1
     C                     ELSE
     C**
     C** FORMAT SUBFILE
     C**
     C                     EXSR #U1001
     C                     WRITEPM0701F3
     C                     WRITEPM0701F1
     C*
     C* IF NO DETAILS READ, INIT SUBFILE TO PROCESS IT WITH NO DETAILS
     C*
     C           RRN2      IFEQ 0
     C                     SETON                     62
     C                     ELSE
     C                     SETOF                     62
     C                     END
     C*
     C                     EXFMTPM0701C2
     C                     END
     C**
     C                     CALL 'ZA0250'
     C                     MOVE '0'       *IN56
     C                     MOVE '0'       *IN57
     C                     MOVE '0'       *IN58
     C                     MOVE '0'       *IN63
     C                     MOVE '0'       *IN67
     C                     MOVE '0'       *IN66
     C                     MOVE '0'       *IN68
     C                     MOVE '0'       *IN74
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN42                           CPM005
     C                     MOVE 'N'       WWGLOB
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF F11 TAKEN - WINDOW LEFT <> RIGHT
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C**
     C           *INKK     IFEQ '1'
     C**
     C** IF THE SCREEN DISPLAY IS EQUAL TO '1' SET IT TO '2'
     C**
     C           WWDISP    IFEQ '1'
     C                     MOVEL'2'       WWDISP
     C                     MOVE '1'       *IN54
     C                     ELSE
     C**
     C** IF THE SCREEN DISPLAY IS EQUAL TO '2' SET IT TO '1'
     C**
     C                     MOVEL'1'       WWDISP
     C                     MOVE '0'       *IN54
     C                     END
     C**
     C                     END
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++       CPM005
     C** IF F13 TAKEN - MATURE FLAT FLAG                                  CPM005
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++       CPM005
     C*
     C** DETERMINE SCREEN TO DISPLAY
     C           *INKM     IFEQ '1'                        B1
     C           WWMAFF    IFEQ 'D'                        B2
     C*
     C** F13 NOT ALLOWED IF NOT FLAT MATURED POSITIONS FOR CUSTOMER
     C** AND PORTFOLIO. SET FILE POINTER BEFORE FIRST RECORD ON
     C***PF/PMMFHLPP                                                      CPM005
     C** PF/PMMFHLPD                                                      CPM005
     C                     MOVE QMCNUM    QFCNUM
     C                     MOVE QMPTF1    QFPTFR
     C                     Z-ADD*LOVAL    QFDSPS
     C                     MOVE *LOVAL    QFDSPG
     C                     Z-ADD*LOVAL    QFITDS
     C                     MOVE *LOVAL    QFINNR
     C                     MOVE *LOVAL    QFTDSS
     C                     Z-ADD*LOVAL    QFDLSQ
     C**********           Z-ADD*LOVAL    QFTRNB                                              CLE148
     C                     MOVEL*LOVAL    QFTRNB                                              CLE148
     C                     MOVE *LOVAL    QFTXT2
     C                     MOVE *LOVAL    QFCCY1
     C*
     C********** PMHOLD    SETLLPMMFHLPP                                  CPM005
     C**********           READ PMMFHLPP                 72               CPM005
     C           PMHOLD    SETLLPMMFHLPD                                  CPM005
     C                     READ PMMFHLPD                 72               CPM005
     C*
     C** IF NO RECORDS EXIST FOR CUSTOMER OUTPUT ERROR MESSAGE
     C           *IN72     IFEQ '1'                        B3
     C           QFCNUM    ORNE QMCNUM
     C           QFPTFR    ORNE QMPTF1
     C                     MOVE '1'       *IN74
     C*
     C** .....OTHERWISE SET UP VARIABLES CONTAINING DETAILS OF FIRST
     C** AND LAST POSITIONS FOR CUSTOMER
     C                     ELSE                            X3
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWFSTR 62                                           CGL029
     C                     MOVE W2SCRN    WWFSTR 68                                           CGL029
     C*
     C** OBTAIN DETAILS OF LAST FLAT / MATURE POSITION
     C                     Z-ADD*HIVAL    QFDSPS
     C                     MOVE *HIVAL    QFDSPG
     C                     Z-ADD*HIVAL    QFITDS
     C                     MOVE *HIVAL    QFINNR
     C                     MOVE *HIVAL    QFTDSS
     C                     Z-ADD*LOVAL    QFDLSQ
     C**********           Z-ADD*HIVAL    QFTRNB                                              CLE148
     C                     MOVEL*HIVAL    QFTRNB                                              CLE148
     C                     MOVE *HIVAL    QFTXT2
     C                     MOVE *HIVAL    QFCCY1
     C*
     C********** PMHOLD    SETLLPMMFHLPP                                  CPM005
     C**********           READPPMMFHLPP                 72               CPM005
     C           PMHOLD    SETLLPMMFHLPD                                  CPM005
     C                     READPPMMFHLPD                 72               CPM005
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWLSTR 62                                           CGL029
     C                     MOVE W2SCRN    WWLSTR 68                                           CGL029
     C*
     C                     MOVEL'M'       WWMAFF
     C                     MOVE '1'       *IN65
     C                     END                             E3
     C*
     C                     ELSE                            X2
     C                     MOVEL'D'       WWMAFF
     C                     MOVE '0'       *IN65
     C                     END                             E2
     C*
     C** REBUILD DISPLAY SCREENS
     C           *IN74     IFEQ '0'                        B2
     C                     MOVE 'Y'       WWF13   1
     C                     EXSR #P1002
     C*
     C                     MOVE 'N'       WWF13
     C*
     C                     END                             E2
     C*
     C                     END                             E1
     C**                                                                  CPM005
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++CPM005
     C** IF F22 TAKEN                                                     CPM005
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++CPM005
     C**                                                                  CPM005
     C           *INKW     IFEQ '1'                                       CPM005
     C**                                                                  CPM005
     C                     MOVEL'PM0701'  QMACTP    P                     CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC0610'                                 CPM005
     C**                                                                  CPM005
     C                     CALL 'PMC1003'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  CPM005
     C           QMENQT    IFEQ 'C'                                       CPM005
     C           QMENQT    OREQ 'P'                                       CPM005
     C           QMENQT    OREQ 'Y'                                       CPM005
     C                     MOVE 'Y'       WWFLAG                          CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C                     END                                            CPM005
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF F23 TAKEN - PORTFOLIO CASHFLOW
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKX     IFEQ '1'
     C**
     C                     CALL 'PM0640'
     C**
     C                     END
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF F24 TAKEN - CUSTOMER MANAGEMENT
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKY     IFEQ '1'
     C**
     C                     MOVEL'PM0701'  PGMNAM 10                       CPM005
     C                     CALL 'PMC0600'
     C                     PARM           PGMNAM                          CPM005
     C**
     C                     END
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF ROLLUP REQUESTED
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *IN23     IFEQ '1'
     C*
     C** SET UP WORKFIELD CONTAINING NUMBER OF PAGES OF INFORMATION
     C           WWMAFF    IFEQ 'D'                        B2
     C                     Z-ADDWWTDLV    WWNOPG  50
     C                     ELSE                            X2
     C                     Z-ADDWWTDFL    WWNOPG
     C                     END                             E2
     C**
     C** IF ROLLUP ON THE LAST PAGE SEND WARNING MESSAGE
     C**
     C           WWMAFF    IFEQ 'D'
     C           A         ANDEQWWNOPG
     C           WWMAFF    OREQ 'M'
     C           WWBSCR    ANDEQWWLSTR
     C                     MOVE '1'       *IN68
     C**
     C                     ELSE
     C**
     C** IF INTERIM TRADE/VALUE INDICATOR IS EQUAL TO 'T'
     C**
     C** RETRIEVE NEXT PARAMETERS
     C**
     C                     MOVELQMPTF1    WWPTFR
     C**
     C                     EXSR #P1002
     C**
     C                     END
     C**
     C                     END
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF ROLLDOWN REQUESTED
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *IN24     IFEQ '1'
     C**
     C** IF ROLLDOWN ON THE FIRST PAGE SEND WARNING MESSAGE
     C**
     C           WWMAFF    IFEQ 'D'
     C           A         ANDEQ1
     C           WWMAFF    OREQ 'M'
     C           WWFSTR    ANDEQWWTSCR
     C                     MOVE '1'       *IN68
     C**
     C                     ELSE
     C**
     C** IF INTERIM TRADE/VALUE INDICATOR IS EQUAL TO 'T'
     C**
     C** RETRIEVE CURRENT PARAMETERS
     C**
     C                     MOVELQMPTF1    WWPTFR
     C**
     C                     EXSR #P1002
     C**
     C                     END
     C**
     C                     END
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF ENTER HAS BEEN PRESSED
     C** +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *IN60     IFEQ '0'
     C**
     C** TEST WHICH FORMAT IS ACTIVE
     C**
     C           WWDISP    IFEQ '1'
     C                     READCPM0701S1                 70
     C** CHANGE OCCURED
     C**
     C           *IN70     IFEQ '0'
     C                     MOVELDDACTN    WWACTN
     C                     MOVEL*BLANKS   DDACTN
     C*
     C** IF INSTRUMENT DETAILS READ SET ON INDICATOR 51 SO THAT
     C** DISPLAYED IN RED
     C           DDCOLR    IFEQ 'Y'
     C                     MOVE '1'       *IN51
     C                     END
     C*
     C                     UPDATPM0701S1
     C                     MOVE '0'       *IN51
     C                     END
     C                     ELSE
     C                     READCPM0701S2                 70
     C** CHANGE OCCURED
     C**
     C           *IN70     IFEQ '0'
     C                     MOVELDDACTN    WWACTN
     C                     MOVEL*BLANKS   DDACTN
     C*
     C** IF INSTRUMENT DETAILS READ SET ON INDICATOR 51 SO THAT
     C** DISPLAYED IN RED
     C           DDCOLR    IFEQ 'Y'
     C                     MOVE '1'       *IN51
     C                     END
     C                     UPDATPM0701S2
     C                     MOVE '0'       *IN51
     C                     END
     C                     END
     C**
     C** IF A CHANGE OCCURED
     C**
     C           *IN70     IFEQ '0'
     C**
     C** VALIDATE INPUT AS PER #V1001
     C**
     C                     EXSR #V1001
     C**
     C           *IN80     IFEQ '0'
     C**
     C** ACTION 'G'
     C**
     C           WWACTN    IFEQ 'G'
     C**
     C** RESTORE FIELDS FROM RECORD
     C**
     C                     MOVELDDMODH    WWSAVM  2
     C                     MOVELDDRECH    WWSAVR  1
     C                     MOVELDDSHOR    WWSAVS 10
     C**********           MOVE DDTRNH    WWSAVT  60                                          CLE148
     C                     MOVE DDTRNH    WWSAVT  6                                           CLE148
     C                     MOVELDDTVDH    WWSAVD  1
     C**
     C                     EXSR #P1006
     C**
     C** POSITION IN FILE
     C**
     C                     MOVELQMPTF1    WWPTFR
     C                     END
     C**
     C***ACTION*'F'                                                       CPM005
     C** ACTION 'K'                                                       CPM005
     C**
     C********** WWACTN    IFEQ 'F'                                       CPM005
     C           WWACTN    IFEQ 'K'                                       CPM005
     C**
     C           DDMODH    IFEQ 'IT'
     C                     MOVELDDTYPE    QMINNR
     C                     END
     C**
     C                     MOVELDDMODH    QMMODI
     C           DDMODH    IFEQ 'SE'
     C                     MOVELDDSHOR    QMSESN
     C**********           Z-ADD*ZERO     QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C                     ELSE
     C                     MOVEL*BLANKS   QMSESN
     C                     MOVELDDTRNH    QMTRNB
     C                     END
     C**
     C***UPDATE *GDA                                                      CPM005
     C** UPDATE *LDA                                                      CPM005
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C** CALL PM0650 TO DISPLAY CASHFLOW FOR HOLDINGS
     C**
     C                     CALL 'PM0650'
     C                     CALL 'PMC1003'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**
     C** RESET FIELDS
     C**
     C                     MOVEL*BLANKS   QMINNR
     C                     MOVEL*BLANKS   QMMODI
     C                     MOVEL*BLANKS   QMSESN
     C**********           Z-ADD*ZERO     QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C                     END
     C**                                                                  CPM005
     C           S01496    IFEQ 'Y'                                       CPM005
     C**                                                                  S10978
     C***ACTION*'B'                                                S10978 CPM005
     C** ACTION 'D'                                                       CPM005
     C**                                                                  S10978
     C********** WWACTN    IFEQ 'B'                                S10978 CPM005
     C           WWACTN    IFEQ 'D'                                       CPM005
     C**                                                                  S10978
     C                     MOVELDDMODH    QMMODI                          S10978
     C           DDMODH    IFEQ 'SE'                                      S10978
     C                     MOVELDDSHOR    QMSESN                          S10978
     C**********           Z-ADD*ZERO     QMTRNB                                       S10978 CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C                     ELSE                                           S10978
     C                     MOVEL*BLANKS   QMSESN                          S10978
     C                     MOVELDDTRNH    QMTRNB                          S10978
     C                     END                                            S10978
     C**                                                                  S10978
     C***UPDATE**GDA                                               S10978 CPM005
     C** UPDATE *LDA                                                      CPM005
     C**                                                                  S10978
     C                     CALL 'PMC1001'                                 S10978
     C                     PARM           WWLDA                           S10978
     C**                                                                  S10978
     C** READ CLIENT FILE TO OBTAIN BRANCH CODE                           S10978
     C**                                                                  S10978
     C***********QFCNUM    CHAINCLINT                73            S10978 CPM005
     C**                                                                  CPM005
     C                     MOVELQFCNUM    PLCUS  10                       CPM005
     C                     CALL 'AOCUSTR0'                                CPM005
     C                     PARM '*DBERR'  @RTCD                           CPM005
     C                     PARM '*KEY'    @OPTN                           CPM005
     C                     PARM           PLCUS                           CPM005
     C                     PARM           KEYST   7                       CPM005
     C           SDCUST    PARM SDCUST    DSSDY                           CPM005
     C**                                                                  S10978
     C** CALL SE6542 TO DISPLAY BLOCKED POSITIONS                         S10978
     C**                                                                  S10978
     C******************** MOVE BRCD      KBRCD   3                S10978 CPM005
     C                     MOVE BBBRCD    KBRCD   3                       CPM005
     C*********************MOVE QFCNUM    KCNUM   6                S10978 062813
     C                     MOVE DDCNUM    KCNUM   6                       062813
     C                     MOVE DDPTFR    KPTFR   4                       S10978
     C                     MOVE DDSHOR    KSESN  10                       S10978
     C                     Z-ADDQMRDNB    KRUNA   50                      S10978
     C**                                                                  S10978
     C                     CALL 'SE6542'                                  S10978
     C                     PARM           KBRCD                           S10978
     C                     PARM           KCNUM                           S10978
     C                     PARM           KPTFR                           S10978
     C                     PARM           KSESN                           S10978
     C                     PARM           KRUNA                           S10978
     C                     CALL 'PMC1003'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**                                                                  S10978
     C** RESET FIELDS                                                     S10978
     C**                                                                  S10978
     C                     MOVEL*BLANKS   QMMODI                          S10978
     C                     MOVEL*BLANKS   QMSESN                          S10978
     C**********           Z-ADD*ZERO     QMTRNB                                       S10978 CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C**                                                                  S10978
     C                     CALL 'PMC1001'                                 S10978
     C                     PARM           WWLDA                           S10978
     C**                                                                  S10978
     C                     END                                            S10978
     C                     END                                            CPM005
     C**
     C** ACTION 'O'
     C**
     C           WWACTN    IFEQ 'O'                        *B1
     C**
     C***UPDATE**GDA                                                      CPM005
     C** UPDATE *LDA                                                      CPM005
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C                     CALL 'PM6180'
     C                     PARM           DDTRNH
     C***********          PARM           WWLDA                           CPM005
     C**
     C** RESET FIELDS
     C**
     C                     MOVEL*BLANKS   QMINNR
     C                     MOVEL*BLANKS   QMMODI
     C                     MOVEL*BLANKS   QMSESN
     C**********           Z-ADD*ZERO     QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C                     END                             *E1
     C**
     C***ACTION*'D'                                                       CPM005
     C** ACTION 'V'                                                       CPM005
     C**
     C********** WWACTN    IFEQ 'D'                                       CPM005
     C           WWACTN    IFEQ 'V'                                       CPM005
     C**
     C           DDMODH    IFEQ 'SE'
     C                     MOVELDDAMEU    QMSESN
     C**********           Z-ADD*ZERO     QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C                     ELSE
     C                     MOVEL*BLANKS   QMSESN
     C                     MOVELDDSECU    QMTRNB
     C                     END
     C**
     C***UPDATE *GDA                                                      CPM005
     C** UPDATE *LDA                                                      CPM005
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C                     EXSR #P1008
     C**
     C                     END
     C**
     C** ACTION 'T'
     C**
     C           WWACTN    IFEQ 'T'
     C**
     C                     EXSR #P1009
     C**
     C                     END
     C**
     C**
     C** ACTION 'P'
     C**
     C           WWACTN    IFEQ 'P'
     C**
     C**
     C                     EXSR #P1010
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF F3 TAKEN
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKC     IFEQ '1'
     C**
     C***SET*ENQUIRIES*TERMINATING*FIELD*IN *GDA*TO*'Y'                   CPM005
     C** SET ENQUIRIES TERMINATING FIELD IN *LDA TO 'Y'                   CPM005
     C**
     C                     MOVEL'Y'       QMENQT
     C**
     C***UPDATE *GDA                                                      CPM005
     C** UPDATE *LDA                                                      CPM005
     C**
     C**********           CALL 'PMC1002'                                 CPM005
     C**********           PARM           WWGDA                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     MOVEL'Y'       WWFLAG
     C**
     C                     END
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C** IF F12 TAKEN - RETURN TO CALLING PROGRAM
     C** ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     C           *INKL     IFEQ '1'
     C**
     C                     MOVEL'Y'       WWFLAG
     C**
     C                     END
     C**
     C***ENQUIRE*DATA*AREA *GDA                                           CPM005
     C** ENQUIRE DATA AREA *LDA                                           CPM005
     C**
     C**********           CALL 'PMC1004'                                 CPM005
     C**********           PARM           WWGDA                           CPM005
     C                     CALL 'PMC1003'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**
     C           QMENQT    IFEQ 'Y'
     C           QMENQT    OREQ 'P'                                       CPM005
     C           QMENQT    OREQ 'C'                                       CPM005
     C           QMENQT    OREQ 'D'                                       CPM005
     C                     MOVEL'Y'       WWFLAG
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1002   - LOAD SUBFILE WITH TRADE DATE HOLDINGS                 *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1004   - FORMAT 'SE' HOLDINGS FOR OUTPUT TO SUBFILE            *
      * #P1005   - FORMAT 'FF' 'DL' 'LE' AND 'RE' HOLDINGS               *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P1001   - PROCESS PM HOLDINGS SCREEN                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      *                                                                  *
      ********************************************************************
     C           #P1002    BEGSR
     C**
     C                     Z-ADD0         RRN1    40
     C                     Z-ADD0         RRN2    40
     C                     MOVE '1'       *IN61
     C                     WRITEPM0701C1
     C                     WRITEPM0701C2
     C                     MOVE '0'       *IN61
     C**
     C                     EXSR #BLANK
     C*
     C** IF PAGE BACKWARD IS REQUIRED SET ARRAY INDEX TO PREVIOUS PAGE
     C** HEADING. PROCESSING NOT REQUIRED FOR F13 AS NEXT PAGE DETERMINED
     C** AFTER F13 TAKEN
     C           WWMAFF    IFNE 'M'
     C           WWF13     IFNE 'Y'                        B1
     C           *IN24     IFEQ '1'                        B2
     C           A         ANDGT1
     C           A         SUB  1         A       50
     C                     END                             E2
     C*
     C** SET UP WORKFIELD CONTAINING NUMBER OF PAGES OF INFORMATION
     C           WWMAFF    IFEQ 'D'                        B2
     C                     Z-ADDWWTDLV    WWNOPG  50
     C                     ELSE                            X2
     C                     Z-ADDWWTDFL    WWNOPG
     C                     END                             E2
     C*
     C** IF PAGE FORWARD IS REQUIRED SET ARRAY INDEX TO NEXT PAGE
     C** HEADING
     C           *IN23     IFEQ '1'                        B2
     C           A         ANDLTWWNOPG
     C           A         ADD  1         A
     C                     END                             E2
     C*
     C** IF DETAILS RECEIVED FROM WINDOW PROGRAM PM0660 PERFORM LOKUP
     C** TO DETERMINE WHICH PAGE OF DETAILS ARE TO BE DISPLAYED
     C           WWPAG1    IFNE *BLANKS                    B2
     C                     Z-ADD1         A
     C*
     C           WWMAFF    IFEQ 'D'                        B3
     C           WWPAG1    LOKUPTVDD,A               72
     C*
     C**********           MOVELWWPAG1    WWPAGX 62                                           CGL029
     C**********           MOVELTVDD,A    WWPAGY 62                                           CGL029
     C                     MOVELWWPAG1    WWPAGX 68                                           CGL029
     C                     MOVELTVDD,A    WWPAGY 68                                           CGL029
     C           WWPAGX    IFEQ WWPAGY                     B4
     C                     ADD  1         A
     C                     END                             E4
     C                     ELSE                            X3
     C                     Z-ADD2         A
     C                     MOVE '1'       *IN72
     C                     END                             E3
     C** IF ROLL DOWN KEY USED, VALUE OF A ALREADY CACULATED.
     C*
     C           *IN24     IFEQ '0'
     C*
     C           *IN72     IFEQ '1'                        B3
     C           A         IFNE 0
     C           A         SUB  1         A
     C                     END
     C                     ELSE                            X3
     C*
     C**********           MOVE *BLANKS   WWPAG2 63                                           CGL029
     C                     MOVE *BLANKS   WWPAG2 69                                           CGL029
     C           WWMAFF    IFEQ 'D'                        B4
     C           WWPAG2    LOKUPTVDD,A                   72
     C                     END                             E4
     C           A         SUB  1         A
     C                     END                             E3
     C                     END
     C*
     C                     MOVE *BLANKS   WWPAG1
     C                     END                             E2
     C                     END                             E1
     C                     END
     C*
     C** MOVE PAGE HEADING FROM MATURE / LIVE ARRAY AS APPROPRIATE
     C** INTO DATA STRUCTURE USED TO ACCESS PMHOLDL1
     C           A         IFNE 0                          B1
     C           WWMAFF    OREQ 'M'
     C*
     C           WWMAFF    IFEQ 'D'                        B2
     C                     MOVE TVDD,A    WWPAGE
     C*
     C** SAVE POSITION TYPE AND INSTRUMENT AT TOP OF PAGE
     C                     MOVELQFPOST    WWPOSO
     C                     MOVELQFINNR    WWINNO
     C                     MOVE QMCNUM    QFCNUM
     C                     MOVE QMPTF1    QFPTFR
     C                     MOVE QMCCY1    QFCCY1
     C*
     C** USE PAGE HEADING FROM ARRAY TO SET FILE POINTER FOR FIRST RECORD
     C** TO BE READ
     C           QFMODI    IFNE 'RE'
     C                     MOVE *BLANKS   QFTXT2
     C                     END
     C*
     C           PMHOLA    SETLLPMHOLDL9
     C                     READ PMHOLDL9                 72
      *                                                                   160217
      *Reaccess PMHOLDPD to position on the correct record.               160217
     C                     MOVEAHOAR,A    XRRN                            160217
     C           XRRN      IFNE 0                                         160217
     C           XRRN      DOUEQ0                                         160217
     C                     READ PMHOLDL9                 72               160217
     C                     SUB  1         XRRN                            160217
     C                     END                                            160217
     C                     END                                            160217
     C*
     C** SET FILE POINTER FOR FLAT / MATURED POSITIONS
     C                     ELSE                              X2
     C*
     C** IF THIS IS THE FIRST TIME FLAT/MATURED POSITIONS DISPLAYED SET
     C** FILE POINTER BEFORE FIRST RECORD
     C           WWF13     IFEQ 'Y'                        B3
     C                     MOVE WWFSTR    W2SCRN
     C                     EXSR #FILE
     C********** PMHOLD    SETLLPMMFHLPP                                  CPM005
     C**********           READ PMMFHLPP                 72               CPM005
     C           PMHOLD    SETLLPMMFHLPD                                  CPM005
     C                     READ PMMFHLPD                 72               CPM005
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWTSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWTSCR 68                                           CGL029
     C                     END                             E3
     C*
     C** IF A ROLLUP HAS BEEN REQUESTED SET FILE POINTER AFTER LAST
     C** RECORD ON PREVIOUS SCREEN
     C           *IN23     IFEQ '1'                        B3
     C                     MOVE WWBSCR    W2SCRN
     C                     EXSR #FILE
     C********** PMHOLD    SETGTPMMFHLPP                                  CPM005
     C**********           READ PMMFHLPP                 72               CPM005
     C           PMHOLD    SETGTPMMFHLPD                                  CPM005
     C                     READ PMMFHLPD                 72               CPM005
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWTSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWTSCR                                              CGL029
     C                     END                             E3
     C*
     C** IF A ROLLDOWN HAS BEEN REQUESTED SET FILE POINTER BEFORE FIRST
     C** RECORD ON PREVIOUS SCREEN
     C           *IN24     IFEQ '1'                        B3
     C                     MOVE WWTSCR    W2SCRN
     C                     EXSR #FILE
     C********** PMHOLD    SETLLPMMFHLPP                                  CPM005
     C**********           READPPMMFHLPP                 72               CPM005
     C           PMHOLD    SETLLPMMFHLPD                                  CPM005
     C                     READPPMMFHLPD                 72               CPM005
     C                     EXSR #SCRN
     C**********           MOVE W2SCRN    WWBSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWBSCR 68                                           CGL029
     C                     END                             E3
     C                     END                             E2
     C**
     C** SET K EQUAL TO ZERO
     C**
     C                     Z-ADD0         K
     C**
     C           WWMAFF    IFEQ 'D'                        B11
     C**
     C           PPTOTT    IFEQ 'B'
     C**
     C           *IN72     DOWEQ'0'
     C********** K         ANDLT7                                         CPM005
     C           K         ANDLT6                                         CPM005
     C           QFCNUM    ANDEQWWCNUM
     C           QFPTFR    ANDEQWWPTFR
     C           QFPOST    ANDEQQMPOTY
     C           QFCCY1    ANDEQQMCCY1
     C*
     C                     EXSR #P1016
     C*
     C                     END
     C                     END
     C**
     C           PPTOTT    IFEQ 'A'
     C**
     C           *IN72     DOWEQ'0'
     C********** K         ANDLT7                                         CPM005
     C           K         ANDLT6                                         CPM005
     C           QFCNUM    ANDEQWWCNUM
     C           QFPTFR    ANDEQWWPTFR
     C           QFCCY1    ANDEQQMCCY1
     C*
     C                     EXSR #P1016
     C                     END
     C                     END
     C**
     C           PPTOTT    IFEQ 'I'
     C**
     C           *IN72     DOWEQ'0'
     C********** K         ANDLT7                                         CPM005
     C           K         ANDLT6                                         CPM005
     C           QFCNUM    ANDEQWWCNUM
     C           QFPTFR    ANDEQWWPTFR
     C           QFPOST    ANDEQQMPOTY
     C           QFDSPG    ANDEQQMDSPG
     C           QFINNR    ANDEQQMINNR
     C           QFCCY1    ANDEQQMCCY1
     C*
     C                     EXSR #P1016
     C                     END
     C                     END
     C*
     C                     ELSE                            X11
     C**
     C           *IN72     DOWEQ'0'                        B2
     C********** K         ANDLT7                                         CPM005
     C           K         ANDLT6                                         CPM005
     C           QFCNUM    ANDEQWWCNUM
     C           QFPTFR    ANDEQWWPTFR
     C*
     C** SAVE DETAILS OF FIRST AND LAST RECORD ON SCREEN
     C                     EXSR #SCRN
     C           WWF13     IFEQ 'Y'                        B3
     C           *IN23     OREQ '1'
     C**********           MOVE W2SCRN    WWBSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWBSCR                                              CGL029
     C                     ELSE                            X3
     C**********           MOVE W2SCRN    WWTSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWTSCR                                              CGL029
     C                     END                             E3
     C**
     C** IF MODULE ID IS 'SE'
     C**
     C           QFMODI    IFEQ 'SE'                       B3
     C                     EXSR #P1004
     C**                                                                  S10978
     C** READ CLIENT FILE TO OBTAIN BRANCH CODE                           S10978
     C**                                                                  S10978
     C***********QFCNUM    CHAINCLINT                73            S10978 CPM005
     C**                                                                  CPM005
     C                     MOVELQFCNUM    PLCUS  10                       CPM005
     C                     CALL 'AOCUSTR0'                                CPM005
     C                     PARM '*DBERR'  @RTCD                           CPM005
     C                     PARM '*KEY'    @OPTN                           CPM005
     C                     PARM           PLCUS                           CPM005
     C                     PARM           KEYST   7                       CPM005
     C           SDCUST    PARM SDCUST    DSSDY                           CPM005
     C**                                                                  S10978
     C                     EXSR P002                                      S10978
     C**                                                                  S10978
     C                     END                             E3
     C**
     C** IF MODULE ID IS NOT 'SE'
     C**
     C           QFMODI    IFNE 'SE'                       B3
     C                     EXSR #P1005
     C                     END                             E3
     C**
     C                     ADD  1         K
     C**
     C** WRITE A RECORD TO THE SUBFILE
     C**
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
     C*
     C** FOR ROLL BACKWARDS ON MATURED POSITIONS WRITE SCREEN RECORDS
     C** OUT IN REVERSE SEQUENCE
     C           WWMAFF    IFEQ 'M'                        B3
     C           *IN24     ANDEQ'1'
     C                     Z-ADDRRN1      W1RRN1  50
     C                     Z-ADDRRN2      W1RRN2  50
     C********** 8         SUB  RRN1      RRN1                            CPM005
     C********** 8         SUB  RRN2      RRN2                            CPM005
     C           7         SUB  RRN1      RRN1                            CPM005
     C           7         SUB  RRN2      RRN2                            CPM005
     C                     END                             E3
     C**
     C                     WRITEPM0701S1
     C                     WRITEPM0701S2
     C*
     C** RESTORE SAVED VALUE OF RRN1 AND RRN2
     C           WWMAFF    IFEQ 'M'                        B3
     C           *IN24     ANDEQ'1'
     C                     Z-ADDW1RRN1    RRN1
     C                     Z-ADDW1RRN2    RRN2
     C                     END                             E3
     C*
     C*********  K         CABEQ7         #P1029                          CPM005
     C           K         CABEQ6         #P1029                          CPM005
     C*
     C** READ NEXT HOLDING RECORD
     C*
     C           *IN24     IFEQ '1'                        B3
     C**********           READPPMMFHLPP                 72               CPM005
     C                     READPPMMFHLPD                 72               CPM005
     C                     ELSE                            X3
     C**********           READ PMMFHLPP                 72               CPM005
     C                     READ PMMFHLPD                 72               CPM005
     C                     END                             E3
     C*
     C                     END                             E2
     C                     END                             E11
     C*
     C** IF NO LIVE RECORDS TO BE DISPLAYED OUTPUT BLANKS TO SUBFILE
     C                     ELSE
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
     C                     MOVE '1'       *IN59
     C                     MOVE '0'       *IN52
     C                     MOVE *BLANKS   DDNOM1
     C                     MOVEL*BLANKS   DDFIL1
     C                     MOVE *BLANKS   DDCCY1
     C                     MOVE *BLANKS   DDNARR
     C                     MOVE *BLANKS   DDNAR2
     C                     MOVE *BLANKS   DDMKTP
     C                     MOVE *BLANKS   DDMFXR
     C                     MOVE *BLANKS   DDMVPC
     C                     MOVE *BLANKS   DDNOM2
     C                     MOVEL*BLANKS   DDFIL2
     C                     MOVE *BLANKS   DDCCY2
     C                     MOVE *BLANKS   DDDETA
     C                     MOVE *BLANKS   DDDET2
     C                     MOVE *BLANKS   DDFOPR
     C                     MOVE *BLANKS   DDFFXR
     C                     MOVE *BLANKS   DDAIPC
     C                     MOVE *BLANKS   DDNARR
     C                     MOVE *BLANKS   DDSECU
     C                     MOVE *BLANKS   DDAMEU
     C                     MOVE *BLANKS   DDMVIC
     C                     MOVE *BLANKS   DDMKTY
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVE *BLANKS   DDDETA
     C                     MOVE *BLANKS   DDAIIC
     C                     MOVE *BLANKS   DDFOLY
     C                     MOVE *BLANKS   DDEXPL
     C                     MOVE *BLANKS   DDTOG1
     C                     MOVE *BLANKS   DDTOG2
     C                     MOVE *BLANKS   DDTOG4                          S10978
     C                     WRITEPM0701S1
     C                     WRITEPM0701S2
     C                     MOVE '0'       *IN59
     C                     MOVE '0'       *IN52
     C                     MOVE '0'       *IN53
     C                     END                             E1
     C**
     C           #P1029    ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1004   - FORMAT 'SE' HOLDINGS FOR OUTPUT TO SUBFILE            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZSEDIT   - TO CONVERT NUMERIC FIELD WITH DECIMAL POINT           *
      * ZEDIT    - TO CONVERT A NUMERIC FIELD WITH DECIMAL POINT         *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - LOAD SUBFILE WITH TRADE DATE HOLDINGS                 *
      * #P1003   - LOAD SUBFILE WITH VALUE DATE HOLDINGS                 *
      * #P1007   - LOAD SUBFILE WITH PORTFOLIO & GLOBAL POSITION         *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1004    BEGSR
     C**
     C                     EXSR #BLANK
     C**
     C** SAVE SECURITY SHORT NAME AND TRANSACTION NUMBER IN HIDDEN FIELD
     C**
     C                     MOVELQFTDSS    DDSHOR
     C                     MOVELQFTRNB    DDTRNH
     C                     MOVELQFTVDA    DDTVDH
     C                     MOVELQFSPLD    DDSPLH
     C**
     C** SAVE RECI
     C**
     C                     MOVELQFRECI    DDRECH
     C**
     C** MOVE MIDAS INSTRUMENT NAME TO NARRATIVE
     C**
     C                     MOVELQFTXT1    DDNARR
     C                     MOVELQFTXT1    DDNAR2
     C                     MOVELQFTXT2    DDDETA
     C                     MOVELQFTXT2    DDDET2
     C**
     C                     MOVELQFMODI    DDMODH
     C**
     C** CONVERT THE LINE AMOUNT 1
     C**
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM1
     C**
     C** CONVERT THE OTHER AMOUNT
     C**
     C           QFOAMT    IFEQ *HIVAL
     C***********QFPOST    ANDEQ'C'                                 CPM005CPM005
     C           QFAMT1    OREQ QFOAMT
     C***********QFPOST    ANDEQ'C'                                 CPM005CPM005
     C                     MOVE *BLANKS   DDNOM2
     C                     ELSE
     C                     Z-ADDQFOAMT    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWWR15 15
     C                     MOVELWWWR15    DDNO22
     C                     MOVE DDNO22    DDNOM2
     C                     MOVEL'('       DDNOM2
     C                     MOVE ')'       DDNOM2
     C                     END
     C           QFSPLD    IFEQ 'Y'
     C                     MOVEL' P '     DDCCY2
     C                     MOVE '1'       *IN53
     C                     END
     C**
     C** CURRENCY 1 & CURRENCY 2
     C**
     C                     MOVELQFCCY1    DDCCY1
     C**
     C** EDIT THE MARKET PRICE
     C**
     C                     MOVEL*BLANKS   ZFIELD
     C           QFMPRC    IFGT 99999
     C                     Z-ADD6         ZADIG
     C                     Z-ADD3         ZADEC
     C                     Z-ADDQFMPRC    WWPRI3
     C                     MOVE WWPRI3    ZFIELD
     C                     ELSE
     C                     Z-ADDQFMPRC    WWPRI1
     C                     MOVE WWPRI1    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     END
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKTP
     C**
     C** EDIT THE MARKET FX RATE
     C**
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFMFXR    WWRATE    H
     C                     MOVE WWRATE    ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMFXR
     C**
     C** EDIT THE MARKET VALUE IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDQFMVPC    ZAMTT
     C                     Z-ADDQFMVPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C**
     C** EDIT THE MARKET VALUE IN INSTRUMENT CURRENCY
     C**
     C                     Z-ADDQFMVAL    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVIC
     C**
     C** CONVERT THE P&L MARKET
     C**
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
     C**
     C** MOVE SECURITY SHORTNAME TO TRANSACTION/SECURITY REFERENCE
     C**
     C                     MOVELQFTDSS    DDAMEU
     C**
     C** EDIT ACCRUED INTEREST IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDQFAIPC    ZAMTT
     C                     Z-ADDQFAIPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C**
     C** EDIT ACCRUED INTEREST IN INSTRUMENT CURRENCY
     C**
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C**
     C** EDIT BOOK (FOLIO) PRICE
     C**
     C           QFBOPR    IFNE *ZERO
     C                     MOVEL*BLANKS   ZFIELD
     C           QFBOPR    IFGT 99999
     C                     Z-ADD6         ZADIG
     C                     Z-ADD3         ZADEC
     C                     Z-ADDQFMPRC    WWPRI3
     C                     MOVE WWPRI3    ZFIELD
     C                     ELSE
     C                     Z-ADDQFBOPR    WWPRI1
     C                     MOVE WWPRI1    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     END
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFOPR
     C                     ELSE
     C                     MOVE *BLANK    DDFOPR
     C                     END
     C**
     C** EDIT BOOK (FOLIO) FX RATE
     C**
      ** IF POSITION TYPE NOT EQUAL TO 'FC' OR 'FO' ELSE OUTPUT
      ** VALUE DATE
     C           QFPOST    IFEQ 'FC'
     C           QFPOST    OREQ 'FO'
     C                     Z-ADDQFVDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    DDFFXR
     C                     ELSE
     C           QFBFXR    IFNE *ZERO
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFBFXR    WWRATE  84H
     C                     MOVE WWRATE    ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFFXR
     C                     ELSE
     C                     MOVE *BLANK    DDFFXR
     C                     END
     C                     END
     C**
     C** EDIT THE FX P/L
     C**
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDEXPL
     C**
     C** EDIT THE MARKET YIELD
     C**
      ** IF POSITION TYPE NOT EQUAL TO 'FC' OR 'FO' ELSE OUTPUT
      ** 'OPEN' OR 'CLOSED'
     C           QFPOST    IFNE 'FC'
     C           QFPOST    ANDNE'FO'
     C           QFMKYD    IFGT *ZERO
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFMKYD    WWPRIC    H
     C                     MOVE WWPRIC    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD5         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKTY
     C                     ELSE
     C           QFMKYD    IFEQ -9999
     C                     MOVE *BLANKS   DDMKTY
     C                     MOVE 'N/A '    DDMKTY
     C                     ELSE
     C                     MOVE *BLANK    DDMKTY
     C                     END
     C                     END
     C                     ELSE
     C           QFPOST    IFEQ 'FC'
     C                     MOVE 'Closed'  DDMKTY
     C                     ELSE
     C                     MOVE 'Open'    DDMKTY
     C                     END
     C                     END
     C**
     C** EDIT THE BOOK (FOLIO) YIELD
      ** IF POSITION TYPE NOT EQUAL TO 'FC' OR 'FO' ELSE OUTPUT
      ** VALUE DATE
     C           QFPOST    IFEQ 'FC'
     C           QFPOST    OREQ 'FO'
     C                     Z-ADDQFVDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    DDFOLY
     C                     ELSE
     C           QFBKYD    IFGT *ZERO
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADDQFBKYD    WWPRIC    H
     C                     MOVE WWPRIC    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD5         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFOLY
     C                     ELSE
     C           QFBKYD    IFEQ -9999
     C                     MOVE *BLANKS   DDFOLY
     C                     MOVE 'N/A '    DDFOLY
     C                     ELSE
     C                     MOVE *BLANK    DDFOLY
     C                     END
     C                     END
     C                     END
     C**
     C** FORMAT PORTFOLIO CURRENCY
     C           WWGLOB    IFNE 'Y'
     C                     MOVE *BLANKS   DDPTCY
     C                     MOVE *BLANKS   DDPTFR
     C                     ELSE
     C*
     C           QFPTFR    IFEQ '9997'
     C**********           MOVE P9R997    DDPTFR                          CPM005
     C                     MOVE FCR997    DDPTFR                          CPM005
     C                     ELSE
     C                     MOVE QFPTFR    DDPTFR
     C                     END
     C                     MOVE QMPTCY    DDPTCY
     C                     MOVE DDFOLY    DDFOL1
     C                     MOVE DDMKTY    DDMKT1
     C                     END
     C*                                                                   S01124
     C** IF FX P/L EXISTS OUTPUT TEXT '+FX' IN CURRENCY 2                 S01124
     C           QFPOST    IFEQ 'FC'                                      S01124
     C           QFPOST    OREQ 'FO'                                      S01124
     C           QFPLFX    IFNE 0                                         S01124
     C                     MOVE '+FX'     DDCCY2                          S01124
     C                     END                                            S01124
     C                     END                                            S01124
     C*
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1005   - FORMAT 'FF' 'DL' 'LE' AND 'RE' HOLDINGS               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZSEDIT   - TO CONVERT NUMERIC FIELD WITH DECIMAL POINT           *
      * ZEDIT    - TO CONVERT A NUMERIC FIELD WITH DECIMAL POINT         *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - LOAD SUBFILE WITH TRADE DATE HOLDINGS                 *
      * #P1003   - LOAD SUBFILE WITH VALUE DATE HOLDINGS                 *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1005    BEGSR
     C**
     C                     EXSR #BLANK
     C*
     C** IF TRANSACTION IS FORWARD AND MODULE ID ONE OF 'FD' 'FL' 'DL'
     C** OR 'LE' OUTPUT TEXT 'FORWARD'
     C           QFMODI    IFEQ 'FI'
     C           QFMODI    OREQ 'MD'
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'FX'
     C           QFMODI    OREQ 'FR'
     C           QFMODI    OREQ 'LE'
     C*
     C           QFTVDA    IFEQ 'T'
     C           QMTVPS    ANDEQ'T'
     C           QFRECI    ANDEQ'D'
     C           QFTVDA    OREQ 'X'
     C           QMTVPS    ANDEQ'V'
     C           QFRECI    ANDEQ'D'
     C                     MOVEL'FORWARD' DDNOM2
     C                     END
     C*
     C** OUTPUT TEXT 'CHANGES PENDING' IF ANY DEAL AMENDMENTS
     C** OUTSTANDING
     C           QFDLAM    IFEQ 'Y'                        B2
     C           QFTVDA    IFEQ 'T'                        B3
     C                     MOVE '/CHG PDG'DDNOM2
     C                     ELSE                            X3
     C                     MOVEL'CHANGES 'DDNOM2
     C                     MOVE 'PENDING' DDNOM2
     C                     END                             E3
     C                     END                             E2
     C*
     C                     END
     C**
     C** LOAD MIDAS INSTRUMENT NAME AND DETAILS ENQUIRIES IN SUBFILE
     C**
     C                     MOVELQFTXT1    DDNARR
     C                     MOVELQFTXT1    DDNAR2
     C                     MOVELQFTXT2    DDDETA
     C                     MOVELQFTXT2    DDDET2
     C                     MOVELQFCCY1    WWCCY1
     C**
     C**
     C** SAVE RECI AND MODULE ID
     C**
     C                     MOVELQFRECI    DDRECH
     C                     MOVELQFMODI    DDMODH
     C                     Z-ADDQFAMT2    DDAMTH
     C                     MOVE QFTDSS    DDSHOR
     C                     MOVE QFTDSS    DDAMEU
     C**
     C** IF MODULE ID = 'FF'
     C**
     C           QFMODI    IFEQ 'FF'                       B1
     C*
     C** DISPLAY AMERICAN OR EUROPEAN ONLY FOR FF
     C*
     C                     SELEC
     C           QFAEIN    WHEQ 'A'                        B2
     C***********          MOVEL'AMERICAN'DDAMEU                          CPM005
     C                     MOVEL'AM'      DDAMEU                          CPM005
     C           QFAEIN    WHEQ 'E'                        B3
     C***********          MOVEL'EUROPEAN'DDAMEU                          CPM005
     C                     MOVEL'EU'      DDAMEU                          CPM005
     C                     OTHER                           X3
     C                     MOVEL*BLANKS   DDAMEU
     C                     ENDSL
     C**
     C** SAVE TRANSACTION NUMBER & F&O INSTRUMENT TYPE IN HIDDEN FIELD
     C**
     C********** QFTRNB    IFLT 0                                                      CPM005 CLE148
     C**********           Z-SUBQFTRNB    WWORK7  60                                   CPM005 CLE148
     C                     MOVELQFTRNB    WRKFLD  60                                          CLE148
     C           WRKFLD    IFLT 0                                                             CLE148
     C                     Z-SUBWRKFLD    WWORK7  60                                          CLE148
     C                     MOVE WWORK7    DDTRNH                          CPM005
     C                     MOVE '-'       DDSIGH                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE QFTRNB    DDTRNH
     C                     MOVE ' '       DDSIGH                          CPM005
     C                     END                                            CPM005
     C                     MOVE QFFOIS    DDFOIH
     C                     Z-ADDQFCLON    DDCLOH
     C***********                                                         CPM005
     C***DISPLAY*PURCHASE/SELL*INDICATOR                                  CPM005
     C***********                                                         CPM005
     C***********          MOVELQFDTYP    WWNO12                          CPM005
     C*                                                                   CPM005
     C** DISPLAY SETTLEMENT DATE                                          CPM005
     C**                                                                  CPM005
     C           BJDFIN    IFEQ 'M'                                       CPM005
     C                     MOVE '1'       *IN98                           CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C                     Z-ADDQFSETD    ZDAYNO                          CPM005
     C                     EXSR ZDATE2                                    CPM005
     C                     MOVELZDATE     WKSETD                          CPM005
     C*
     C** DISPLAY SETTLEMENT DATE
     C**
     C                     MOVE WWDSET    WWDDAY
     C                     MOVE WWMSET    WWMNTH
     C                     MOVE WWYSET    WWYEAR
     C                     MOVELWWSETD    DDNOM2
     C*
     C** DISPLAY NARRATIVE
     C**
     C                     MOVEL*BLANKS   WWNAR2
     C                     MOVEL*BLANKS   DDNAR2
     C                     MOVELQFFOIS    WWFOIS
     C                     MOVELWWFFMY    WWMTYR
     C                     MOVELWWSETD    WWDATE
     C                     MOVELWWNAR2    DDNAR2
     C*
     C** DISPLAY NARRATIVE DDDET2 WITHOUT MONTH & YEAR
     C**
     C                     MOVEL*BLANKS   WWMONT
     C**
     C** REFORMAT NUMBER OF OPEN CONTRACTS
     C**
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C*
     C                     MOVELZOUT21    WWMK22 22
     C           QFDTYP    IFEQ 'S '
     C                     MOVE '- '      WWMK22
     C                     END
     C                     MOVE WWMK22    DDNOM1
     C*                                                                   CPM005
     C** DISPLAY PURCHASE/SELL INDICATOR                                  CPM005
     C**                                                                  CPM005
     C                     MOVELQFDTYP    DDNOM1                          CPM005
     C                     END                             E1
     C**
     C** IF MODULE ID = 'DL'
     C**
     C           QFMODI    IFEQ 'MD'                       B1
     C           QFMODI    OREQ 'DL'
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'FX'
     C           QFMODI    OREQ 'FR'
     C**
     C** SAVE TRANSACTION NUMBER IN HIDDEN FIELD
     C**
     C                     MOVE QFTRNB    DDTRNH
     C**
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C           QFAMT1    IFGT *ZEROS                     B2
     C           QFMODI    ANDEQ'FX'
     C                     MOVE ZOUT21    WFLD16 16
     C                     MOVELWFLD16    DDNOM1
     C                     ELSE                            X2
     C                     MOVE ZOUT21    DDNOM1
     C                     END                             E2
     C*
     C** FOR A MM LOAN NOMINAL SHOULD BE SIGNED '-'
     C           FCPORS    IFNE 'B'                                       CPM005
     C           QFDTYP    IFEQ 'IP'
     C           QFDTYP    OREQ 'TI'
     C           QFDTYP    OREQ 'LN'
     C           QFDTYP    OREQ 'CL'
     C           QFDTYP    OREQ 'DL'
     C                     MOVE '-'       DDNOM1
     C                     END
     C                     END                                            CPM005
     C**
     C** ADD THE 'BUY OR SELL' INDICATOR IN NOMINAL 1
     C                     MOVELQFBYSF    DDNOM1
     C**
     C** IF THE LINE 2 AMOUNT FROM HOLDINGS FILE IS NON ZERO
     C**
     C           QFAMT2    IFNE 0                          B2
     C**
     C** EDIT THE LINE 2 AMOUNT
     C**
     C                     Z-ADDQFAMT2    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C           QFAMT2    IFGT *ZEROS                     B3
     C           QFMODI    ANDEQ'FX'
     C                     MOVE ZOUT21    WFLD16
     C                     MOVELWFLD16    DDNOM2
     C                     ELSE                            X3
     C                     MOVE ZOUT21    DDNOM2
     C                     END                             E3
     C**
     C** ADD THE 'BUY OR SELL' INDICATOR IN NOMINAL 2
     C           QFBYSF    IFEQ 'B'                        B3
     C                     MOVEL'S'       DDNOM2
     C                     ELSE
     C                     MOVEL'B'       DDNOM2
     C                     END                             E3
     C**
     C** MOVE THE RELATED DEAL NUMBER INTO THE 'MARKET PRICE'
     C           QFRLDN    IFNE 0                          B3
     C           QFBYSF    ANDNE*BLANKS
     C                     MOVE QFRLDN    DDMKTP
     C                     END                             E3
     C**
     C** CONVERT ACCRUED INTEREST INTO PORTFOLIO CURRENCY
     C           QFFPLC    IFNE *BLANKS                    B3
     C********** QFFPLC    CHAINSDCURRL0             73                   CPM005
     C**********                                                          CPM005
     C********** *IN73     IFEQ '1'                        B4             CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM '*MSG   ' @RTCD   7                       CPM005
     C                     PARM '*KEY    'WWOPTN  7                       CPM005
     C                     PARM QFFPLC    WWKEY2  3                       CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
     C           @RTCD     IFNE *BLANKS                                   CPM005
     C**********           MOVEL'SDCURRL0'QMFILE           ** DB ERROR 01*CPM005
     C                     MOVEL'SDCURRPD'QMFILE           ** DB ERROR 01*CPM005
     C                     MOVELQFFPLC    QMKEY            ***************
     C                     Z-ADD1         QMERRN
     C                     EXSR *PSSR
     C                     END                             E4
     C**
     C                     Z-ADDQFACIS    ZAMTF
     C                     MOVE QFFPLC    ZCCYF
     C                     MOVE A6NBDP    ZCDPF
     C                     MOVE A6MDIN    ZMDINF
     C                     MOVE A6SPRT    ZRATEF
     C                     Z-ADDQFAIPC    ZAMTT
     C                     Z-ADDQFAIPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     MOVE QFFPLC    DDSECU
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDZCDPF     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C                     ELSE                            X3
     C                     Z-ADD0         ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     MOVE *BLANKS   DDAIIC
     C                     END                             E3
     C**
     C** OUTPUT DESCRIPTIVE ACCORDING TO THE STATUS OF THE TRANSACTION
     C           QFOPCL    IFEQ 'O'                        B3
     C                     MOVE QFRLDN    DDMTPL
     C                     MOVEL'Close by'DDMTPL
     C                     END                             E3
     C**
     C           QFOPCL    IFEQ 'L'                        B3
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVEL'Open    'DDMTPL
     C                     END                             E3
     C**
     C           QFOPCL    IFEQ 'C'                        B3
     C**
     C           QFDTYP    IFEQ 'OP'                       B4
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVEL'Closed  'DDMTPL
     C                     ELSE                            X4
     C                     MOVE QFRLDN    DDMTPL
     C                     MOVEL'Close of'DDMTPL
     C                     END                             E4
     C**
     C                     END                             E3
     C**
     C           QFOPCL    IFEQ 'M'                        B3
     C                     MOVEL'Matured 'DDMTPL
     C                     END                             E3
     C**
     C                     END                             E2
     C**
     C                     END                             E1
     C**
     C** IF MODULE ID = 'FD' OR 'FL'
     C**
     C           QFMODI    IFEQ 'FI'
     C**
     C** SAVE TRANSACTION NUMBER IN HIDDEN FIELD
     C**
     C                     MOVE QFTRNB    DDTRNH
     C**
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM1
     C**
     C                     END
     C**
     C           QFMODI    IFEQ 'DL'                       B1
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C           QFAMT1    IFGT *ZEROS                     B2
     C                     MOVE ZOUT21    WFLD16 16
     C                     MOVELWFLD16    DDNOM1
     C                     ELSE                            X2
     C                     MOVE ZOUT21    DDNOM1
     C                     END                             E2
     C                     END                             E1
     C** IF MODULE ID = 'LE'
     C**
     C           QFMODI    IFEQ 'LE'
     C**
     C** SAVE TRANSACTION NUMBER IN HIDDEN FIELD
     C**
     C                     MOVE QFTRNB    DDTRNH
     C**
     C           QMPORS    IFEQ 'B'                                       CPM005
     C                     Z-ADDQFAMT1    ZFLD15                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-SUBQFAMT1    ZFLD15
     C                     END                                            CPM005
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM1
     C**
     C                     END
     C**
     C** IF MODULE ID = 'LB'
     C**
     C           QFMODI    IFEQ 'LB'
     C**
     C* STORE GUARANTEE TYPE FOR LOMBARDS CREDIT IN HIDDEN FIELD
     C                     MOVE QFINNR    DDTYPE
     C**
     C**********           MOVE QFTXT2    WRK14  14                                           CGL029
     C                     MOVE QFTXT2    WRK14  20                                           CGL029
     C                     ADD  1         PL      20
     C                     MOVELWRK14     DDORDN  3
     C                     MOVE DDORDN    ORD,PL
     C**
     C** SAVE TRANSACTION NUMBER IN HIDDEN FIELD
     C**
     C                     MOVE QFTRNB    DDTRNH
     C**
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM1
     C*
     C** SET UP CHARACTER INDICATING WHETHER PLEDGE GIVEN OR RECEIVED
     C                     MOVELQFTXT2    WWORK5  5
     C           WWORK5    IFEQ 'GIVEN'
     C                     MOVEL'G'       DDNOM1
     C                     ELSE
     C                     MOVEL'R'       DDNOM1
     C                     END
     C**
     C** EDIT THE LINE 2 AMOUNT
     C**
     C                     MOVELQFTXT2    WWORK9  9
     C                     MOVE WWORK9    WWORK3  3
     C           WWORK3    IFNE *BLANKS
     C           WWORK3    ANDNE'FXD'
     C                     Z-ADDQFAMT2    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM2
     C                     MOVEL'U'       DDNOM2
     C                     ELSE
     C                     MOVE *BLANKS   DDNOM2
     C                     MOVE *BLANKS   QFCCY2
     C                     END                             E1
     C**
     C                     END
     C**
     C** IF THE MODULE ID IS 'RE'
     C**
     C           QFMODI    IFEQ 'RE'
     C**
     C** SAVE ACCOUNT CODE AND ACCOUNT SEQUENCE IN HIDDEN FIELDS
     C**
     C                     MOVELQFTXT2    WWTEXT
     C                     MOVE WWTCCY    DDCCYH
     C                     MOVE WWTACO    DDACOH
     C                     MOVE WWTACS    DDACSH
     C                     MOVE WWBRCD    DDBRCH                          CPM005
     C**
     C                     Z-ADDQFAMT1    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM1
     C**
     C           QMPORS    IFNE 'B'                                       CPM005
     C           QFAMT1    IFLE 0
     C                     MOVE ' '       DDNOM1
     C                     ELSE
     C                     MOVE '-'       DDNOM1
     C                     END
     C                     END                                            CPM005
     C** CONVERT THE OTHER AMOUNT
     C**
     C           QFOAMT    IFEQ *HIVAL
     C           QFAMT1    OREQ QFOAMT
     C                     MOVE *BLANKS   DDNOM2
     C                     ELSE
     C                     Z-ADDQFOAMT    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWWR15 15
     C           QMPORS    IFNE 'B'                                       CPM005
     C           QFOAMT    IFLE 0                          B2
     C                     MOVE ' '       WWWR15
     C                     ELSE                            X2
     C                     MOVE '-'       WWWR15
     C                     END                             E2
     C                     END                                            CPM005
     C                     MOVE ')'       DDNO22 16
     C                     MOVELWWWR15    DDNO22
     C                     MOVE DDNO22    DDNOM2
     C                     MOVEL'('       DDNOM2
     C                     END
     C**
     C                     END
     C**
     C** CURRENCY 1 & CURRENCY 2
     C**
     C                     MOVELQFCCY1    DDCCY1
     C           QFMODI    IFEQ 'FF'
     C                     MOVEL*BLANKS   DDCCY2
     C                     ELSE
     C                     MOVELQFCCY2    DDCCY2
     C                     END
     C**
     C** IF THE MARKET PRICE IS NON ZERO
     C**
     C           QFMPRC    IFNE 0
     C                     MOVEL*BLANKS   ZFIELD
     C           QFMPRC    IFGT 999999                                    CPM005
     C                     Z-ADD7         ZADIG                           CPM005
     C                     Z-ADD2         ZADEC                           CPM005
     C                     Z-ADDQFMPRC    WWPRI2                          CPM005
     C                     MOVE WWPRI2    ZFIELD                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFMPRC    WWPRI1    H
     C                     MOVE WWPRI1    ZFIELD
     C                     END                                            CPM005
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMKTP
     C                     ELSE
     C**
     C           QFRLDN    IFEQ 0
     C                     MOVEL*BLANKS   DDMKTP
     C                     END
     C**
     C                     END
     C**
     C** IF THE MARKET FX RATE IS NON ZERO
     C**
     C           QFMFXR    IFNE 0
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFMFXR    WWRATE    H
     C                     MOVE WWRATE    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDMFXR
     C                     ELSE
     C                     MOVEL*BLANKS   DDMFXR
     C                     END
     C**
     C** CONVERT THE MARKET VALUE FROM INSTRUMENT TO PORTFOLIO CCY USING ZCCYXR
     C**
     C           QFAMT2    IFEQ 0
     C           QFMODI    OREQ 'FF'
     C**
     C** EDIT THE MARKET VALUE IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDQFMVPC    ZAMTT
     C                     Z-ADDQFMVPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C*
     C** FOR FX DEALS OUTPUT FX PROFIT AND LOSS AS MARKET VALUE
     C                     ELSE
     C*
     C** FOR DISPLAY OF 'NOTIONAL' FX DEALS DUE TO SE TRADES WITH
     C** SETTLEMENT CURRENCY *NE NOMINAL CURRENCY OUTPUT MARKET VALUE
     C** ZERO; OTHERWISE MARKET VALUE FOR FX DEALS IS FX P/L
     C           QFTDSS    IFEQ *BLANKS
     C                     Z-ADDQFPLFX    ZFLD15
     C                     ELSE
     C                     Z-ADD0         ZFLD15
     C                     END
     C*
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C                     END
     C**
     C** EDIT THE MARKET VALUE IN INSTRUMENT CURRENCY
     C**
     C                     Z-ADDQFMVAL    ZFLD15
     C           QFAMT2    IFNE 0
     C           QFMODI    ANDNE'FF'
     C           QFFPLC    IFEQ QFCCY1
     C                     Z-ADDQFCDP1    ZDECS
     C                     ELSE
     C                     Z-ADDQFCDP2    ZDECS
     C                     END
     C                     ELSE
     C                     Z-ADDQFCDP1    ZDECS
     C                     END
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVIC
     C**
     C** IF THE P/L MARKET IS NON ZERO
     C**
     C           QFPLMK    IFNE 0
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
     C**
     C                     ELSE
     C**
     C           QFOPCL    IFEQ *BLANKS
     C                     MOVEL*BLANKS   DDMTPL
     C                     END
     C**
     C                     END
     C**
     C** MOVE TRANSACTION NUMBER TO TRANSACTION REFERENCE
     C**
     C           QFMODI    IFEQ 'RE'
     C                     MOVE *BLANKS   DDSECU
     C                     MOVE QFACNO    DDACNO                          CPM005
     C                     ELSE
     C           QFMODI    IFEQ 'FF'                                      CPM005
     C*                                                                   CPM005
     C********** QFTRNB    IFLT 0                                                      CPM005 CLE148
     C**********           Z-SUBQFTRNB    QFTRNB                                       CPM005 CLE148
     C**********           MOVELQFTRNB    WWTNBR  7                                    CPM005 CLE148
     C                     MOVELQFTRNB    WRKFLD                                              CLE148
     C           WRKFLD    IFLT 0                                                             CLE148
     C                     Z-SUBWRKFLD    WRKFLD                                              CLE148
     C                     MOVELWRKFLD    WWTNBR  7                                           CLE148
     C                     MOVE '-'       WWTNBR                          CPM005
     C                     MOVELWWTNBR    DDSECU                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVELQFTRNB    DDSECU                          CPM005
     C                     END                                            CPM005
     C*                                                                   CPM005
     C                     ELSE                                           CPM005
     C                     MOVELQFTRNB    DDSECU
     C                     END                                            CPM005
     C                     END
     C**
     C** IF THE ACCRUED INTEREST AMOUNT IS NON ZERO EDIT FOR OUTPUT
     C           QFMODI    IFEQ 'RE'
     C           QFMODI    OREQ 'FI'
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'MD'
     C           QFMODI    OREQ 'LE'
     C           QFAMT2    ANDEQ0
     C**
     C** EDIT ACCRUED INTEREST IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDQFAIPC    ZAMTT
     C                     Z-ADDQFAIPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C**
     C** EDIT ACCRUED INTEREST IN INSTRUMENT CURRENCY
     C**
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDQFCDP1    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C                     ELSE
     C**
     C           QFOPCL    IFEQ *BLANKS
     C                     MOVEL*BLANKS   DDAIPC
     C                     MOVEL*BLANKS   DDAIIC
     C                     END
     C**
     C                     END
     C**
     C** IF THE BOOK PRICE IS NON ZERO
     C**
     C           QFBOPR    IFNE 0
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFBOPR    WWPRI1    H
     C                     MOVE WWPRI1    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFOPR
     C                     ELSE
     C                     MOVEL*BLANKS   DDFOPR
     C                     END
     C**
     C** IF THE BOOK FX RATE IS NON ZERO
     C**
     C           QFBFXR    IFNE 0
     C                     MOVEL*BLANKS   ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD4         ZADEC
     C                     Z-ADDQFBFXR    WWRATE    H
     C                     MOVE WWRATE    ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDFFXR
     C                     ELSE
     C                     MOVEL*BLANKS   DDFFXR
     C                     END
     C**
     C           QFMODI    IFEQ 'LE'
     C           QFMODI    OREQ 'DL'
     C           QFMODI    OREQ 'MD'
     C           QFMODI    OREQ 'ML'
     C           QFMODI    OREQ 'FX'
     C           QFMODI    OREQ 'FR'
     C           QFMODI    OREQ 'FI'
     C**
     C** EDIT THE P&L MARKET
     C**
     C           QFAMT2    IFEQ 0
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
     C                     END
     C**
     C** EDIT THE FX P/L
     C**
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDEXPL
     C**
     C                     ELSE
     C                     MOVEL*BLANKS   DDMTPL
     C                     MOVEL*BLANKS   DDEXPL
     C                     END
     C**
     C** SET OTHER FIELDS TO BLANK
     C**
     C                     MOVEL*BLANKS   DDMKTY
     C                     MOVEL*BLANKS   DDFOLY
     C**
     C*
     C** DISPLAY WHEN FF
     C*
     C           QFMODI    IFEQ 'FF'                       B1
     C*
     C** PURCHASE INTEREST
     C*
     C           QFPUIT    IFNE *ZEROS                     B2
     C                     Z-ADDQFPUIT    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIIC
     C                     MOVELWWFFMC    DDFOLY
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDAIIC
     C                     MOVEL*BLANKS   DDFOLY
     C                     END                             E2
     C*
     C** NBR OF CONTRACT <> NBR OF ORIGINAL CONTRACT
     C*
     C           QFAMT1    IFNE QFAMT2                     B2
     C*
     C           QFAMT1    IFNE *ZEROS                     B3
     C                     MOVE ' Part Cl'DDFOLY
     C                     ELSE                            X3
     C                     MOVE ' Closed 'DDFOLY
     C                     END                             E3
     C*
     C                     ELSE                            X2
     C                     MOVE ' Open   'DDFOLY
     C                     END                             E2
     C*
     C** ACCESS INTYPD TO RETRIEVE TICKS DENOMINATOR AND MINIMUM PRICE
     C** FLUCTUATION TO DISPLAY MARKET AND BOOK PRICE
     C*
     C           QFFOIS    CHAININTYP                73
     C           *IN73     IFEQ '1'                        ***************
     C                     MOVEL'INTYP'   QMFILE           ** DB ERROR 02
     C                     MOVELQFFOIS    QMKEY            ***************
     C                     Z-ADD2         QMERRN
     C                     EXSR *PSSR
     C                     END
     C*
     C** MARKET PRICE
     C*
     C           QFMPRC    IFNE *ZEROS                     B2
     C                     Z-ADDQFMPRC    FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C***********          MOVELFFSPRC    DDMKTP                          CPM005
      ** Ouput of FFSPRC now 16 long therefore move in most significant   CPM005
      ** part of FFSPRC.                                                  CPM005
      ** Determine number of leading and trailing blanks.                 CPM005
     C           ' '       CHECKFFSPRC    @L      20                      CPM005
     C           ' '       CHEKRFFSPRC    @R      20                      CPM005
      *                                                                   CPM005
      ** Check if trailing zeroes required (as determined by MNPF).       CPM005
     C           TKDM      IFEQ 100                                       CPM005
     C                     MOVE MNPF      TMPMNP 15                       CPM005
     C           '1'       CHECKTMPMNP    @NDP    20                      CPM005
     C           @NDP      IFGT @R                                        CPM005
     C                     Z-ADD@NDP      @R                              CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
      ** Determine number of characters to extract.                       CPM005
     C           @R        SUB  @L        RSUBL   20                      CPM005
     C                     ADD  1         RSUBL                           CPM005
      ** Extract relevant characters.                                     CPM005
     C           RSUBL     SUBSTFFSPRC:@L DDMKTP    P                     CPM005
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDMKTP
     C                     END                             E2
     C*
     C** BOOK PRICE
     C*
     C           QFBOPR    IFNE *ZEROS                     B2
     C                     Z-ADDQFBOPR    FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C***********          MOVELFFSPRC    DDFOPR                          CPM005
      ** Ouput of FFSPRC now 16 long therefore move in most significant   CPM005
      ** part of FFSPRC.                                                  CPM005
      ** Determine number of leading and trailing blanks.                 CPM005
     C           ' '       CHECKFFSPRC    @L      20                      CPM005
     C           ' '       CHEKRFFSPRC    @R      20                      CPM005
      *                                                                   CPM005
      ** Check if trailing zeroes required (as determined before by MNPF).CPM005
     C           TKDM      IFEQ 100                                       CPM005
     C           @NDP      ANDGT@R                                        CPM005
     C                     Z-ADD@NDP      @R                              CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
      ** Determine number of characters to extract.                       CPM005
     C           @R        SUB  @L        RSUBL   20                      CPM005
     C                     ADD  1         RSUBL                           CPM005
      ** Extract relevant characters.                                     CPM005
     C           RSUBL     SUBSTFFSPRC:@L DDFOPR    P                     CPM005
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDFOPR
     C                     END                             E2
     C*
     C** PROFIT AND LOSS MARKET
     C*
     C           QFPLMK    IFNE *ZEROS                     B2
     C                     Z-ADDQFPLMK    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMTPL
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDMTPL
     C                     END                             E2
     C*
     C** PROFIT AND LOSS MARKET FX
     C*
     C           QFPLFX    IFNE *ZEROS                     B2
     C                     Z-ADDQFPLFX    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDEXPL
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDEXPL
     C                     END                             E2
     C*
     C** DISPLAY ACCRUED INTEREST
     C**
     C           QFACIS    IFNE *ZEROS                     B2
     C                     Z-ADDQFACIS    ZFLD15
     C                     Z-ADDQFCDP2    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C                     ELSE                            X2
     C                     MOVEL*BLANKS   DDAIPC
     C                     END                             E2
     C*
     C                     END                             E1
     C*
     C** IF DISPLAYING THE NOTIONAL FX DEAL OVERWRITE FIR
     C           QFMODI    IFEQ 'FX'
     C           WWMAFF    IFEQ 'D'
     C           QFBYSF    ANDEQ'S'
     C                     MOVELDDCCY1    DDCCY2
     C                     MOVELDDNOM1    DDNOM2
     C                     MOVE *BLANKS   DDCCY1
     C                     MOVE *BLANKS   DDNOM1
     C                     ELSE
     C                     MOVE *BLANKS   DDCCY2
     C                     MOVE *BLANKS   DDNOM2
     C                     END
     C                     END
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1006   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1007   - LOAD SUBFILE WITH PORTFOLIO & GLOBAL POSITION         *
      * #U1001   - FILL SUBFILE HEADER                                   *
      * #V1001   - VALIDATE SUBFILE ENTRIES                              *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS PM HOLDINGS SCREEN                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWDISP   - DISPLAY INDICATOR                                     *
      * WWINTV   - INTERIM TRADE/VALUE INDICATOR                         *
      *                                                                  *
      ********************************************************************
     C           #P1006    BEGSR
     C**
     C** LOAD SUBFILE WITH PORTFOLIO & GLOBAL POSITION
     C**
     C                     MOVEL'Y'       WWGLOB  1
     C                     EXSR #P1007
     C                     MOVEL'N'       WWGLOB
     C**
     C** DO UNTIL CMD3 OR F12 ENTERED
     C**
     C************INKC     DOUEQ'1'                        B1             CPM005
     C************INKL     OREQ '1'                                       CPM005
     C           QMENQT    DOUEQ'Y'                                       CPM005
     C           QMENQT    OREQ 'C'                                       CPM005
     C           QMENQT    OREQ 'P'                                       CPM005
     C           QMENQT    OREQ 'D'                                       CPM005
     C           *INKL     OREQ '1'                                       CPM005
     C**
     C**
     C** IF THE SCREEN DISPLAY INDICATOR IS '1'
     C**
     C           WWDISP    IFEQ '1'                        B2
     C**
     C** FORMAT SUBFILE
     C**
     C                     EXSR #U1001
     C                     MOVE '1'       *IN53
     C                     WRITEPM0701F4
     C                     WRITEPM0701F1
     C*
     C* IF NO DETAILS READ, INIT SUBFILE TO PROCESS IT WITH NO DETAILS
     C*
     C           RRN3      IFEQ 0
     C                     SETON                     62
     C                     ELSE
     C                     SETOF                     62
     C                     END
     C*
     C                     EXFMTPM0701C3
     C                     ELSE                            X2
     C**
     C** FORMAT SUBFILE
     C**
     C                     EXSR #U1001
     C                     MOVE '0'       *IN53
     C                     WRITEPM0701F4
     C                     WRITEPM0701F1
     C*
     C* IF NO DETAILS READ, INIT SUBFILE TO PROCESS IT WITH NO DETAILS
     C*
     C           RRN4      IFEQ 0
     C                     SETON                     62
     C                     ELSE
     C                     SETOF                     62
     C                     END
     C*
     C                     EXFMTPM0701C4
     C                     END                             E2
     C**
     C** SET SCREEN INDICATOR ON
     C**
     C                     MOVE '0'       *IN80
     C*                                                                   CPM005
     C** If F3  pressed, exit program                                     CPM005
     C*                                                                   CPM005
     C           *INKC     IFEQ '1'                                       CPM005
     C                     MOVE 'Y'       QMENQT                          CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     END                                            CPM005
     C*                                                                   CPM005
     C** If F22 pressed, access Enquiry selection screen                  CPM005
     C*                                                                   CPM005
     C           *INKW     IFEQ '1'                                       CPM005
     C                     CALL 'PMC0610'                                 CPM005
     C*                                                                   CPM005
     C** Retrieve *LDA values                                             CPM005
     C*                                                                   CPM005
     C                     CALL 'PMC1003'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     END                                            CPM005
     C**
     C** IF F11 TAKEN
     C**
     C           *INKK     IFEQ '1'                        B2
     C**
     C           WWDISP    IFEQ '1'                        B3
     C                     MOVEL'2'       WWDISP
     C                     MOVE '1'       *IN54
     C                     ELSE                            X3
     C                     MOVEL'1'       WWDISP
     C                     MOVE '0'       *IN54
     C                     END                             E3
     C**
     C                     END                             E2
     C**
     C                     END                             E1
     C**
     C                     MOVE '0'       *INKL
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1007   - LOAD SUBFILE WITH PORTFOLIO & GLOBAL POSITION         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1004   - FORMAT 'SE' HOLDINGS FOR OUTPUT TO SUBFILE            *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1006   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINTV   - INTERIM TRADE/VALUE INDICATOR                         *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      *                                                                  *
      ********************************************************************
     C           #P1007    BEGSR
     C**
     C                     MOVE '1'       *IN61
     C                     WRITEPM0701C3
     C                     WRITEPM0701C4
     C                     MOVE '0'       *IN61
     C                     Z-ADD0         RRN3    40
     C                     Z-ADD0         RRN4    40
     C**
     C                     MOVE WWCNUM    WWCNM1
     C                     MOVE DDSHOR    WWTDS1
     C                     MOVE DDTVDH    WWTVD1
     C                     MOVE *LOVAL    WWPTF1
     C*
     C*  READ ALL HOLDINGS FOR THIS SECURITY,CUSTOMER & TRADE/VALUE BASIS
     C*
     C           PMHOL6    SETLLPMHOLDL6
     C**
     C                     READ PMHOLDL6                 75
     C**
     C           QFTDSS    DOWEQWWTDS1
     C           QFCNUM    ANDEQWWCNM1
     C           QFTVDA    ANDEQWWTVD1
     C           *IN75     ANDEQ'0'
     C**
     C** WRITE TO SUBFILE IF NORMAL PORTFOLIO HOLDING
     C**
     C           QFPTFR    IFNE '9998'
     C           QFPTFR    ANDNE'9999'
     C           QFRECI    IFEQ 'D'
     C           QFRECI    ORNE 'D'
     C           WWMAFF    ANDEQ'M'
     C*
     C** ACCESS PORTFOLIO DETAILS TO OBTAIN CURRENCY
     C           QFPTFR    IFNE '9997'
     C********** KLPORT    CHAINPMPORTPP             73                   CPM005
     C           KLPORT    CHAINPMPORTPD             73                   CPM005
     C*
     C           *IN73     IFEQ '1'
     C                     EXSR *PSSR
     C                     END
     C*
     C                     MOVE PNPTCY    QMPTCY  3
     C                     Z-ADDPNPCDP    QMPCDP  10
     C                     ELSE
     C                     MOVE QMCSBY    QMPTCY  3
     C                     Z-ADDQMBYDP    QMPCDP  10
     C                     END
     C*
     C                     EXSR #P1004
     C*
     C** REFORMAT DETAILS RECEIVED FROM #P1004
     C                     MOVE DDNOM1    DDNOMA
     C                     MOVE DDNOM2    DDNOMB
     C***
     C           DDNOM2    IFNE *BLANKS
     C                     MOVEL'('       DDNOMB
     C                     END
     C***
     C                     ADD  1         RRN3
     C                     ADD  1         RRN4
     C                     WRITEPM0701S3
     C                     WRITEPM0701S4
     C                     END
     C                     END
     C**
     C                     READ PMHOLDL6                 75
     C**
     C                     END
     C*
     C** IF NO DETAILS WRITTEN TO SUBFILE OUTPUT TEXT 'NO OPEN
     C** POSITIONS'
     C           RRN3      IFEQ 0
     C           RRN4      ANDEQ0
     C                     MOVE *BLANKS   DDPTFR
     C                     MOVE *BLANKS   DDNOMA
     C                     MOVE *BLANKS   DDNARR
     C                     MOVE *BLANKS   DDNAR2
     C                     MOVE *BLANKS   DDMKTP
     C                     MOVE *BLANKS   DDMFXR
     C                     MOVE *BLANKS   DDMVPC
     C                     MOVE *BLANKS   DDPTCY
     C                     MOVE *BLANKS   DDNOMB
     C                     MOVE *BLANKS   DDDETA
     C                     MOVE *BLANKS   DDDET2
     C                     MOVE *BLANKS   DDFOPR
     C                     MOVE *BLANKS   DDFFXR
     C                     MOVE *BLANKS   DDAIPC
     C                     MOVE *BLANKS   DDNARR
     C                     MOVE *BLANKS   DDSECU
     C                     MOVE *BLANKS   DDAMEU
     C                     MOVE *BLANKS   DDMVIC
     C                     MOVE *BLANKS   DDMKT1
     C                     MOVE *BLANKS   DDMTPL
     C                     MOVE *BLANKS   DDPTCY
     C                     MOVE *BLANKS   DDDETA
     C                     MOVE *BLANKS   DDAIIC
     C                     MOVE *BLANKS   DDFOL1
     C                     MOVE *BLANKS   DDEXPL
     C                     MOVE *BLANKS   DDTOG1
     C                     MOVE *BLANKS   DDTOG2
     C                     MOVE 'NO OPEN' DDMKTP
     C                     MOVEL'POSITION'DDMFXR
     C                     MOVE 'S'       DDMFXR
     C                     MOVE 'NO OPEN' DDMVIC
     C                     MOVEL'POSITION'DDMKT1
     C                     MOVE 'S '      DDMKT1
     C                     ADD  1         RRN3    40
     C                     ADD  1         RRN4    40
     C                     WRITEPM0701S3
     C                     WRITEPM0701S4
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1008   - DISPLAY INSTRUMENT DETAILS OF A HOLDING               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PM2000   - DEAL DETAILS                                          *
      * PM2010   - LOAN DETAILS                                          *
      * PM2020   - SECURITY DETAILS                                      *
      * PM2030   - F&O INSTRUMENT DETAILS                                *
      * PM2040   - RETAIL ACCOUNT DETAILS                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS PM HOLDINGS SCREEN                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1008    BEGSR
     C**
     C** MODULE ID 'DL'
     C**
     C           DDMODH    IFEQ 'MD'
     C           DDMODH    OREQ 'DL'
     C           DDMODH    OREQ 'ML'
     C           DDMODH    OREQ 'FR'
     C           DDMODH    OREQ 'FX'
     C**
     C** CALL PROGRAM 'PM2000' - DEAL DETAILS UNLESS FX DEAL FOR SECURITY
     C** POSITION IN WHICH CASE DISPLAY TRADE
     C           DDSHOR    IFEQ *BLANKS
     C                     CALL 'PM2000'
     C                     PARM           DDTRNH
     C                     ELSE
     C                     CALL 'PM2060'
     C                     PARM           WWRETC  1
     C                     PARM           DDTRNH
     C                     END
     C**
     C                     END
     C**
     C** MODULE ID 'LE'
     C**
     C           DDMODH    IFEQ 'LE'
     C**
     C** CALL PROGRAM 'PM2010' - LOANS DETAILS
     C**
     C                     CALL 'PM2010'
     C                     PARM           DDTRNH
     C**
     C                     END
     C**
     C** MODULE ID 'SE'
     C**
     C           DDMODH    IFEQ 'SE'
     C**
     C** CALL PROGRAM 'PM2020' - SECURITY DETAILS
     C**
     C                     CALL 'PM2020'
     C                     PARM           DDSHOR
     C**
     C                     END
     C**
     C** MODULE ID 'FF'
     C**
     C           DDMODH    IFEQ 'FF'
     C**
     C** CALL PROGRAM 'PM2030' - F&O INSTRUMENT DETAILS
     C**
     C                     CALL 'PM2030'
     C                     PARM           DDFOIH
     C**
     C                     END
     C**
     C** MODULE ID 'RE'
     C**
     C           DDMODH    IFEQ 'RE'
     C**
     C** CALL PROGRAM 'PM2040' - RETAIL ACCOUNT DETAILS
     C**
     C                     CALL 'PM2040'
     C                     PARM           DDCNUM                          CPM005
     C                     PARM           DDCCYH
     C                     PARM           DDACOH
     C                     PARM           DDACSH
     C                     PARM           DDBRCH                          CPM005
     C**
     C                     END
     C**
     C** MODULE ID 'LB'
     C**
     C           DDMODH    IFEQ 'LB'
     C**
     C** CALL PROGRAM 'PM2130' - LOMBARD DETAILS
     C**
     C*
     C* RETRIEVE TYPE OF GUARANTEE TO PASSED PM2130
     C*
     C                     EXSR LBTYP
     C*                                                                   CPM005
     C                     Z-ADD0         PL                              CPM005
     C                     Z-ADDRRN1      PL                              CPM005
     C                     MOVE ORD,PL    DDORDN                          CPM005
     C*
     C                     CALL 'PM2130'
     C                     PARM           DDTRNH
     C                     PARM           TYPE
     C                     PARM           DDORDN
     C**
     C                     END
     C**
     C** MODULE ID 'FD'
     C**
     C           DDMODH    IFEQ 'FI'
     C**
     C** CALL PROGRAM 'PM2140' - FI DEPOSIT DETAILS
     C**
     C                     CALL 'PM2140'
     C                     PARM           DDTRNH
     C**
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1009   - DISPLAY TRANSACTION DETAILS OF A HOLDING              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PM2050   - PORTFOLIO MOVEMENTS (SE)                              *
      * PM2055   - PORTFOLIO MOVEMENTS (SE)                              *CPM005
      * PM2070   - DEAL AMENDMENTS PER DEAL                              *
      * PM2080   - LOAN AMENDMENTS PER LOAN                              *
      * PM2090   - F&O TRANSACTION DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS PM HOLDINGS SCREEN                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1009    BEGSR
     C**
     C** MODULE ID 'SE'
     C**
     C           DDMODH    IFEQ 'SE'
     C**                                                                  CPM005
     C** IF NOT BANK PORTFOLIOS                                           CPM005
     C**                                                                  CPM005
     C           QMPORS    IFNE 'B'                                       CPM005
     C**
     C** CALL PROGRAM 'PM2050' - PORTFOLIO MOVEMENTS (SE)
     C**
     C                     CALL 'PM2050'
     C                     PARM           DDSHOR
     C                     PARM           WWINTV
     C**********           PARM           P9R997                          CPM005
     C                     PARM           FCR997                          CPM005
     C**                                                                  CPM005
     C                     ELSE                                           CPM005
     C**                                                                  CPM005
     C** CALL PROGRAM 'PM2055' - PORTFOLIO MOVEMENTS (SE)                 CPM005
     C**                                                                  CPM005
     C                     CALL 'PM2055'                                  CPM005
     C                     PARM           DDSHOR                          CPM005
     C                     PARM           QMBRCA                          CPM005
     C                     PARM           QMBOKC                          CPM005
     C                     PARM           WWMRKT  1                       CPM005
     C                     PARM           WWINTV                          CPM005
     C**                                                                  CPM005
     C                     END                                            CPM005
     C**
     C                     END
     C**
     C** MODULE ID 'DL'
     C**
     C           DDMODH    IFEQ 'MD'
     C           DDMODH    OREQ 'DL'
     C           DDMODH    OREQ 'ML'
     C           DDMODH    OREQ 'FR'
     C           DDMODH    OREQ 'FX'
     C**
     C** CALL PROGRAM 'PM2070' - DEAL AMENDMENT PER DEAL
     C**
     C                     CALL 'PM2070'
     C                     PARM           DDTRNH
     C**
     C                     END
     C**
     C** MODULE ID 'LE'
     C**
     C           DDMODH    IFEQ 'LE'
     C**
     C** CALL PROGRAM 'PM2080' - LOAN AMENDMENTS PER LOAN
     C**
     C                     CALL 'PM2080'
     C                     PARM           DDTRNH
     C**
     C                     END
     C**
     C** MODULE ID 'FF'
     C**
     C           DDMODH    IFEQ 'FF'
     C**
     C** CALL PROGRAM 'PM2090' - F&O TRANSACTION DETAILS
     C**
     C                     CALL 'PM2090'
     C                     PARM           DDTRNH
     C                     PARM           DDSIGH                          CPM005
     C**
     C                     END
     C**
     C** MODULE ID 'RE'
     C**
     C           DDMODH    IFEQ 'RE'
     C**
     C** CALL PROGRAM 'PM2090' - F&O TRANSACTION DETAILS
     C**
     C                     CALL 'PM2120'
     C                     PARM           DDCNUM                          CPM005
     C                     PARM           DDCCYH
     C                     PARM           DDACOH
     C                     PARM           DDACSH
     C                     PARM           DDBRCH                          CPM005
     C**
     C                     END
     C**
     C** MODULE ID 'FD'
     C**
     C           DDMODH    IFEQ 'FI'
     C**
     C** CALL PROGRAM 'PM2160' - FI DEPOSIT AMENDMENTS PER DEPOSIT
     C**
     C                     CALL 'PM2160'
     C                     PARM           DDTRNH
     C**
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1010   - PLEDGES DETAILS                                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1010    BEGSR
     C**
     C*
     C* RETRIEVE TYPE OF GUARANTEE TO PASSED PM2130
     C*
     C                     EXSR LBTYP
     C*
     C                     Z-ADD0         PL
     C                     Z-ADDRRN1      PL
     C                     MOVE ORD,PL    DDORDN
     C*
     C                     CALL 'PM2130'
     C                     PARM           DDTRNH
     C                     PARM           TYPE
     C                     PARM           DDORDN
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P102I   - SET UP ARRAYS OF TRADE DATE PAGE HEADINGS             *
      *            (TOTAL TYPE 'I' - INSTRUMENT)                         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P102I    BEGSR
     C*
     C                     MOVE QMCNUM    QFCNUM
     C                     MOVE QMPTF1    QFPTFR
     C                     MOVE QMCCY1    QFCCY1
     C                     MOVE QMPOTY    QFPOST
     C                     Z-ADDQMDSPS    QFDSPS
     C                     MOVE QMDSPG    QFDSPG
     C                     Z-ADDQMITDS    QFITDS
     C                     MOVE QMINNR    QFINNR
     C                     MOVE *LOVAL    QFMODI
     C                     MOVE *LOVAL    QFRECI
     C                     MOVE *LOVAL    QFTDSS
     C                     MOVE *LOVAL    QFTRNB
     C                     MOVE *LOVAL    QFPOSQ
     C                     MOVE *LOVAL    QFTXT2
     C                     Z-ADD0         I       50
     C                     Z-ADD0         J       50
     C                     MOVE *BLANKS   WWPOSO  2
     C                     MOVE *BLANKS   WWINNO  3
     C*
     C** SET FILE POINTER TO FIRST RECORD FOR PORTFOLIO AND READ RECORD
     C           PMHOLA    SETLLPMHOLDL9
     C                     READ PMHOLDL9                 72
     C**
     C** SAVE DISPLAY GROUP AND INSTRUMENT TYPE READ
     C******************** Z-ADD7         K       50                      CPM005
     C******************** Z-ADD7         L       50                      CPM005
     C                     Z-ADD6         K       50                      CPM005
     C                     Z-ADD6         L       50                      CPM005
     C                     Z-ADD0         XRRN    50                      160217
     C**********           Z-ADD0         XFCNUM  60                                   160217 CSD027
     C                     MOVE *BLANKS   XFCNUM  6                                           CSD027
     C                     MOVEL*BLANKS   XFPTFR  4                       160217
     C                     Z-ADD0         XFDSPS  20                      160217
     C                     MOVEL*BLANKS   XFDSPG  3                       160217
     C                     Z-ADD0         XFITDS  20                      160217
     C                     MOVEL*BLANKS   XFINNR  3                       160217
     C                     MOVEL*BLANKS   XFPOSQ 11                       160217
     C                     MOVEL*BLANKS   XFTDSS 10                       160217
     C**********           MOVEL*BLANKS   XFTRNB  60                                   160217 CLE148
     C                     MOVEL*BLANKS   XFTRNB  6                                           CLE148
     C                     MOVEL*BLANKS   XWACCU  60                      160217
     C                     MOVEL*BLANKS   XFTXT2 10                       160217
     C                     MOVEL*BLANKS   XWFFMC  3                       160217
     C                     MOVEL*BLANKS   XWFFMY  5                       160217
     C**
     C           *IN72     DOWEQ'0'                        B1
     C           QFCNUM    ANDEQQMCNUM
     C           QFPTFR    ANDEQQMPTF1
     C           QFDSPG    ANDEQQMDSPG
     C           QFINNR    ANDEQQMINNR
     C           QFPOST    ANDEQQMPOTY
     C**
     C           QFRECI    IFEQ 'D'                        B2
     C           QFCCY1    ANDEQQMCCY1
     C*
      *                                                                   160217
     C           QFCNUM    IFEQ XFCNUM                                    160217
     C           QFPTFR    ANDEQXFPTFR                                    160217
     C           QFDSPS    ANDEQXFDSPS                                    160217
     C           QFDSPG    ANDEQXFDSPG                                    160217
     C           QFITDS    ANDEQXFITDS                                    160217
     C           QFINNR    ANDEQXFINNR                                    160217
     C           QFPOSQ    ANDEQXFPOSQ                                    160217
     C           QFTDSS    ANDEQXFTDSS                                    160217
     C           QFTRNB    ANDEQXFTRNB                                    160217
     C           QFTXT2    ANDEQXFTXT2                                    160217
     C           WWFFMC    ANDEQXWFFMC                                    160217
     C           WWFFMY    ANDEQXWFFMY                                    160217
     C                     ADD  1         XRRN                            160217
     C                     ELSE                                           160217
     C                     Z-ADD0         XRRN                            160217
     C                     END                                            160217
     C**********           Z-ADDQFCNUM    XFCNUM                                       160217 CSD027
     C                     MOVE QFCNUM    XFCNUM                                              CSD027
     C                     MOVELQFPTFR    XFPTFR                          160217
     C                     MOVELQFDSPS    XFDSPS                          160217
     C                     MOVELQFDSPG    XFDSPG                          160217
     C                     Z-ADDQFITDS    XFITDS                          160217
     C                     MOVELQFINNR    XFINNR                          160217
     C                     MOVELQFPOSQ    XFPOSQ                          160217
     C                     MOVELQFTDSS    XFTDSS                          160217
     C**********           Z-ADDQFTRNB    XFTRNB                                       160217 CLE148
     C                     MOVELQFTRNB    XFTRNB                                              CLE148
     C                     MOVELQFTXT2    XFTXT2                          160217
     C                     MOVELWWFFMC    XWFFMC                          160217
     C                     MOVELWWFFMY    XWFFMY                          160217
      *                                                                   160217
     C                     MOVE 'N'       WCHGI
     C*
     C** ON CHANGE OF POSITION TYPE ADD 1 TO K AND SET TYPE TO 'D'
     C           QFPOST    IFNE WWPOSO                     B3
     C                     MOVE 'Y'       WCHGI
     C                     MOVE QFPOST    WWPOSO  2
     C                     ADD  1         K
     C                     MOVE 'D'       WWDETT  1
     C                     END                             E3
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C********** K         IFEQ 8                          B3             CPM005
     C           K         IFEQ 7                          B3             CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TVDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END                             E3
     C*
     C** ON CHANGE OF INSTRUMENT GROUP ADD 1 TO K AND SET TYPE TO 'I'
     C           QFINNR    IFNE WWINNO                     B3
     C           WCHGI     OREQ 'Y'
     C                     MOVE QFINNR    WWINNO  3
     C                     ADD  1         K
     C                     MOVE 'I'       WWDETT  1
     C                     END                             E3
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF L EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C********** L         IFEQ 8                          B3             CPM005
     C           L         IFEQ 7                          B3             CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TVDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END                             E3
     C*
     C** FOR EACH SET OF DETAILS TO BE OUTPUT ADD 1 TO K AND SET TYPE TO 'T'
     C                     ADD  1         K
     C                     MOVE 'T'       WWDETT  1
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C********** K         IFEQ 8                          B3             CPM005
     C           K         IFEQ 7                          B3             CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TVDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END                             E3
     C                     END                             E2
     C*
     C** FOR EACH SET OF DETAILS TO BE OUTPUT ADD 1 TO K AND SET TYPE TO 'T'
     C                     ADD  1         L
     C                     MOVE 'T'       WWDETT  1
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF L EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C********** L         IFEQ 8                          B3             CPM005
     C           L         IFEQ 7                          B3             CPM005
     C                     ADD  1         J
     C                     Z-ADD1         L
     C                     END                             E2
     C*
     C** READ NEXT HOLDING RECORD
     C                     READ PMHOLDL9                 72
     C                     END                             E1
     C*
     C** SAVE NUMBER OF PAGES OF LIVE AND MATURED HOLDINGS
     C                     Z-ADDI         WWTDLV  50
     C                     Z-ADDJ         WWTDFL  50
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P102A   - SET UP ARRAYS OF TRADE DATE PAGE HEADINGS             *
      *            (TOTAL TYPE 'A' - CURRENCY)                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P102A    BEGSR
     C*
     C                     MOVE QMCNUM    QFCNUM
     C                     MOVE QMPTF1    QFPTFR
     C                     MOVE QMCCY1    QFCCY1
     C                     MOVE *LOVAL    QFPOST
     C                     Z-ADD*LOVAL    QFDSPS
     C                     MOVE *LOVAL    QFDSPG
     C                     Z-ADD*ZEROS    QFITDS
     C                     MOVE *BLANKS   QFINNR
     C                     MOVE *LOVAL    QFMODI
     C                     MOVE *LOVAL    QFRECI
     C                     MOVE *LOVAL    QFTDSS
     C                     MOVE *LOVAL    QFTRNB
     C                     MOVE *LOVAL    QFPOSQ
     C                     MOVE *LOVAL    QFTXT2
     C                     Z-ADD0         I       50
     C                     Z-ADD0         J       50
     C                     Z-ADD0         XRRN    50                      160217
     C**********           Z-ADD0         XFCNUM  60                                   160217 CSD027
     C                     MOVE *BLANKS   XFCNUM  6                                           CSD027
     C                     MOVEL*BLANKS   XFPTFR  4                       160217
     C                     Z-ADD0         XFDSPS  20                      160217
     C                     MOVEL*BLANKS   XFDSPG  3                       160217
     C                     Z-ADD0         XFITDS  20                      160217
     C                     MOVEL*BLANKS   XFINNR  3                       160217
     C                     MOVEL*BLANKS   XFPOSQ 11                       160217
     C                     MOVEL*BLANKS   XFTDSS 10                       160217
     C**********           MOVEL*BLANKS   XFTRNB  60                                   160217 CLE148
     C                     MOVEL*BLANKS   XFTRNB  6                                           CLE148
     C                     MOVEL*BLANKS   XWACCU  60                      160217
     C                     MOVEL*BLANKS   XFTXT2 10                       160217
     C                     MOVEL*BLANKS   XWFFMC  3                       160217
     C                     MOVEL*BLANKS   XWFFMY  5                       160217
     C                     MOVE *BLANKS   WWINNO  3
     C*
     C** SET FILE POINTER TO FIRST RECORD FOR PORTFOLIO AND READ RECORD
     C           PMHOLA    SETLLPMHOLDL9
     C                     READ PMHOLDL9                 72
     C**
     C** SAVE DISPLAY GROUP AND INSTRUMENT TYPE READ
     C******************** Z-ADD7         K       50                      CPM005
     C******************** Z-ADD7         L       50                      CPM005
     C                     Z-ADD6         K       50                      CPM005
     C                     Z-ADD6         L       50                      CPM005
     C**
     C           *IN72     DOWEQ'0'                        B1
     C           QFCNUM    ANDEQQMCNUM
     C           QFPTFR    ANDEQQMPTF1
     C           QFCCY1    ANDEQQMCCY1
     C**
     C           QFRECI    IFEQ 'D'                        B2
     C*
     C           QFCNUM    IFEQ XFCNUM                                    160217
     C           QFPTFR    ANDEQXFPTFR                                    160217
     C           QFDSPS    ANDEQXFDSPS                                    160217
     C           QFDSPG    ANDEQXFDSPG                                    160217
     C           QFITDS    ANDEQXFITDS                                    160217
     C           QFINNR    ANDEQXFINNR                                    160217
     C           QFPOSQ    ANDEQXFPOSQ                                    160217
     C           QFTDSS    ANDEQXFTDSS                                    160217
     C           QFTRNB    ANDEQXFTRNB                                    160217
     C           QFTXT2    ANDEQXFTXT2                                    160217
     C           WWFFMC    ANDEQXWFFMC                                    160217
     C           WWFFMY    ANDEQXWFFMY                                    160217
     C                     ADD  1         XRRN                            160217
     C                     ELSE                                           160217
     C                     Z-ADD0         XRRN                            160217
     C                     END                                            160217
     C**********           Z-ADDQFCNUM    XFCNUM                                       160217 CSD027
     C                     MOVE QFCNUM    XFCNUM                                              CSD027
     C                     MOVELQFPTFR    XFPTFR                          160217
     C                     MOVELQFDSPS    XFDSPS                          160217
     C                     MOVELQFDSPG    XFDSPG                          160217
     C                     Z-ADDQFITDS    XFITDS                          160217
     C                     MOVELQFINNR    XFINNR                          160217
     C                     MOVELQFPOSQ    XFPOSQ                          160217
     C                     MOVELQFTDSS    XFTDSS                          160217
     C**********           Z-ADDQFTRNB    XFTRNB                                       160217 CLE148
     C                     MOVELQFTRNB    XFTRNB                                              CLE148
     C                     MOVELQFTXT2    XFTXT2                          160217
     C                     MOVELWWFFMC    XWFFMC                          160217
     C                     MOVELWWFFMY    XWFFMY                          160217
      *                                                                   160217
     C                     MOVE 'N'       WCHGI
     C*
     C** ON CHANGE OF POSITION TYPE ADD 1 TO K AND SET TYPE TO 'D'
     C           QFPOST    IFNE WWPOSO                     B3
     C                     MOVE 'Y'       WCHGI
     C                     MOVE QFPOST    WWPOSO  2
     C                     ADD  1         K
     C                     MOVE 'D'       WWDETT  1
     C                     END                             E3
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C***********K         IFEQ 8                          B3             CPM005
     C           K         IFEQ 7                          B3             CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TVDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END                             E3
     C*
     C** ON CHANGE OF INSTRUMENT GROUP ADD 1 TO K AND SET TYPE TO 'I'
     C           QFINNR    IFNE WWINNO                     B3
     C           WCHGI     OREQ 'Y'
     C                     MOVE QFINNR    WWINNO  3
     C                     ADD  1         K
     C                     MOVE 'I'       WWDETT  1
     C                     END                             E3
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C***********K         IFEQ 8                          E3             CPM005
     C           K         IFEQ 7                          B3             CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TVDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END                             E3
     C*
     C** FOR EACH SET OF DETAILS TO BE OUTPUT ADD 1 TO K AND SET TYPE 'T'
     C                     ADD  1         K
     C                     MOVE 'T'       WWDETT  1
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C***********K         IFEQ 8                          B3             CPM005
     C           K         IFEQ 7                          B3             CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TVDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END                             E3
     C                     END                             E2
     C*
     C** FOR EACH SET OF DETAILS TO BE OUTPUT ADD 1 TO K AND SET TYPE 'T''
     C                     ADD  1         L
     C                     MOVE 'T'       WWDETT  1
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF L EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C***********L         IFEQ 8                          B2             CPM005
     C           L         IFEQ 7                          B2             CPM005
     C                     ADD  1         J
     C                     Z-ADD1         L
     C                     END                             E2
     C*
     C** READ NEXT HOLDING RECORD
     C                     READ PMHOLDL9                 72
     C                     END                             E1
     C*
     C** SAVE NUMBER OF PAGES OF LIVE AND MATURED HOLDINGS
     C                     Z-ADDI         WWTDLV  50
     C                     Z-ADDJ         WWTDFL  50
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P102B   - SET UP ARRAYS OF TRADE DATE PAGE HEADINGS             *
      *            (TOTAL TYPE 'D' - POSITION TYPE)                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P102B    BEGSR
     C*
     C                     MOVE QMCNUM    QFCNUM
     C                     MOVE QMPTF1    QFPTFR
     C                     MOVE QMCCY1    QFCCY1
     C                     MOVE QMPOTY    QFPOST
     C                     Z-ADD*ZEROS    QFDSPS
     C                     MOVE *BLANKS   QFDSPG
     C                     Z-ADD*ZEROS    QFITDS
     C                     MOVE *BLANKS   QFINNR
     C                     MOVE *LOVAL    QFMODI
     C                     MOVE *LOVAL    QFRECI
     C                     MOVE *LOVAL    QFTDSS
     C                     MOVE *LOVAL    QFTRNB
     C                     MOVE *LOVAL    QFPOSQ
     C                     MOVE *LOVAL    QFTXT2
     C                     Z-ADD0         I       50
     C                     Z-ADD0         J       50
     C                     MOVE *BLANKS   WWPOSO  2
     C                     MOVE *BLANKS   WWINNO  3
     C                     Z-ADD0         XRRN    50                      160217
     C**********           Z-ADD0         XFCNUM  60                                   160217 CSD027
     C                     MOVE *BLANKS   XFCNUM  6                                           CSD027
     C                     MOVEL*BLANKS   XFPTFR  4                       160217
     C                     Z-ADD0         XFDSPS  20                      160217
     C                     MOVEL*BLANKS   XFDSPG  3                       160217
     C                     Z-ADD0         XFITDS  20                      160217
     C                     MOVEL*BLANKS   XFINNR  3                       160217
     C                     MOVEL*BLANKS   XFPOSQ 11                       160217
     C                     MOVEL*BLANKS   XFTDSS 10                       160217
     C**********           MOVEL*BLANKS   XFTRNB  60                                   160217 CLE148
     C                     MOVEL*BLANKS   XFTRNB  6                                           CLE148
     C                     MOVEL*BLANKS   XWACCU  60                      160217
     C                     MOVEL*BLANKS   XFTXT2 10                       160217
     C                     MOVEL*BLANKS   XWFFMC  3                       160217
     C                     MOVEL*BLANKS   XWFFMY  5                       160217
     C*
     C** SET FILE POINTER TO FIRST RECORD FOR PORTFOLIO AND READ RECORD
     C           PMHOLA    SETLLPMHOLDL9
     C                     READ PMHOLDL9                 72
     C**
     C** SAVE DISPLAY GROUP AND INSTRUMENT TYPE READ
     C***********          Z-ADD7         K       50                      CPM005
     C***********          Z-ADD7         L       50                      CPM005
     C                     Z-ADD6         K       50                      CPM005
     C                     Z-ADD6         L       50                      CPM005
     C**
     C           *IN72     DOWEQ'0'                        B1
     C           QFCNUM    ANDEQQMCNUM
     C           QFPTFR    ANDEQQMPTF1
     C           QFPOST    ANDEQQMPOTY
     C**
     C           QFRECI    IFEQ 'D'                        B2
     C           QFCCY1    ANDEQQMCCY1
     C*
     C           QFCNUM    IFEQ XFCNUM                                    160217
     C           QFPTFR    ANDEQXFPTFR                                    160217
     C           QFDSPS    ANDEQXFDSPS                                    160217
     C           QFDSPG    ANDEQXFDSPG                                    160217
     C           QFITDS    ANDEQXFITDS                                    160217
     C           QFINNR    ANDEQXFINNR                                    160217
     C           QFPOSQ    ANDEQXFPOSQ                                    160217
     C           QFTDSS    ANDEQXFTDSS                                    160217
     C           QFTRNB    ANDEQXFTRNB                                    160217
     C           QFTXT2    ANDEQXFTXT2                                    160217
     C           WWFFMC    ANDEQXWFFMC                                    160217
     C           WWFFMY    ANDEQXWFFMY                                    160217
     C                     ADD  1         XRRN                            160217
     C                     ELSE                                           160217
     C                     Z-ADD0         XRRN                            160217
     C                     END                                            160217
     C**********           Z-ADDQFCNUM    XFCNUM                                       160217 CSD027
     C                     MOVE QFCNUM    XFCNUM                                              CSD027
     C                     MOVELQFPTFR    XFPTFR                          160217
     C                     MOVELQFDSPS    XFDSPS                          160217
     C                     MOVELQFDSPG    XFDSPG                          160217
     C                     Z-ADDQFITDS    XFITDS                          160217
     C                     MOVELQFINNR    XFINNR                          160217
     C                     MOVELQFPOSQ    XFPOSQ                          160217
     C                     MOVELQFTDSS    XFTDSS                          160217
     C**********           Z-ADDQFTRNB    XFTRNB                                       160217 CLE148
     C                     MOVELQFTRNB    XFTRNB                                              CLE148
     C                     MOVELQFTXT2    XFTXT2                          160217
     C                     MOVELWWFFMC    XWFFMC                          160217
     C                     MOVELWWFFMY    XWFFMY                          160217
      *                                                                   160217
     C                     MOVE 'N'       WCHGI   1
     C*
     C** ON CHANGE OF POSITION TYPE ADD 1 TO K AND SET TYPE TO 'D'
     C           QFPOST    IFNE WWPOSO                     B3
     C                     MOVE 'Y'       WCHGI
     C                     MOVE QFPOST    WWPOSO  2
     C                     ADD  1         K
     C                     MOVE 'D'       WWDETT  1
     C                     END                             E3
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C***********K         IFEQ 8                          B3             CPM005
     C           K         IFEQ 7                          B3             CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TVDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END                             E3
     C*
     C** ON CHANGE OF INSTRUMENT GROUP ADD 1 TO K AND SET TYPE TO 'I'
     C           QFINNR    IFNE WWINNO                     B3
     C           WCHGI     OREQ 'Y'
     C                     MOVE QFINNR    WWINNO  3
     C                     ADD  1         K
     C                     MOVE 'I'       WWDETT  1
     C                     END                             E3
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C***********K         IFEQ 8                          E3             CPM005
     C           K         IFEQ 7                          B3             CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TVDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END                             E3
     C*
     C** FOR EACH SET OF DETAILS TO BE OUTPUT ADD 1 TO K AND SET TYPE 'T'
     C                     ADD  1         K
     C                     MOVE 'T'       WWDETT  1
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF K EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C***********K         IFEQ 8                          B3             CPM005
     C           K         IFEQ 7                          B3             CPM005
     C                     ADD  1         I
     C                     MOVE WWPAGE    TVDD,I
     C                     MOVE XRRN      HOAR,I                          160217
     C                     Z-ADD1         K
     C                     END                             E3
     C                     END                             E2
     C*
     C** FOR EACH SET OF DETAILS TO BE OUTPUT ADD 1 TO K AND SET TYPE 'T''
     C                     ADD  1         L
     C                     MOVE 'T'       WWDETT  1
     C*
     C***IF*K*EQUAL*TO*EIGHT*WRITE*DETAILS*TO*APPEAR*ON*PAGE*HEADING      CPM005
     C** IF L EQUAL TO SEVEN WRITE DETAILS TO APPEAR ON PAGE HEADING      CPM005
     C** TO ARRAY
     C***********L         IFEQ 8                          B2             CPM005
     C           L         IFEQ 7                          B2             CPM005
     C                     ADD  1         J
     C                     Z-ADD1         L
     C                     END                             E2
     C*
     C** READ NEXT HOLDING RECORD
     C                     READ PMHOLDL9                 72
     C                     END                             E1
     C*
     C** SAVE NUMBER OF PAGES OF LIVE AND MATURED HOLDINGS
     C                     Z-ADDI         WWTDLV  50
     C                     Z-ADDJ         WWTDFL  50
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* #P1013   - ACCESS POSITION TYPE DETAILS & TOTALS                 *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           #P1013    BEGSR
     C**
     C** RESET FIELDS
     C**
     C                     EXSR #BLANK
     C**
     C** FILL RECORD OF SUBFILE
     C**
     C                     MOVEL*BLANK    DDACTN
     C**
     C**********           Z-ADDQFCNUM    W0CNUM                                              CSD027
     C                     MOVE QFCNUM    W0CNUM                                              CSD027
     C                     MOVE QFPTFR    W0PTF1
     C                     MOVE QMCCY1    W0CURR
     C                     MOVE QFPOST    W0POTY
     C                     MOVE 'B'       W0TOTT
     C**
     C           PMCIA0    CHAINPMCIALL0             73
     C**
     C           *IN73     IFEQ '1'
     C**
     C                     Z-ADD*ZEROS    FIASVL
     C                     Z-ADD*ZEROS    FILIVL
     C**
     C                     END
     C*
     C**  EDIT ASSET VALUE
     C                     Z-ADDFIASVL    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM1
     C*
     C**  EDIT LIABILITY VALUE
     C                     Z-ADDFILIVL    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM2
     C**
     C           PPASSV    IFNE 0
     C           FIASVL    DIV  PPASSV    ZZASSV  43H
     C           ZZASSV    MULT 100       WWPAS   30H
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE WWPAS     ZFLD15
     C                     Z-ADD*ZEROS    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE WWPERC    WPERCA  3
     C                     ELSE
     C                     MOVEL'  0'     WPERCA
     C                     END
     C**
     C                     MOVE WPERCA    FIELA1
     C                     MOVE '%'       FIELA2
     C                     MOVELNARR,1    DDNARR
     C**
     C           PPLIAV    IFNE 0
     C           FILIVL    DIV  PPLIAV    ZZLIAV  43H
     C           ZZLIAV    MULT 100       WWPLI   30H
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE WWPLI     ZFLD15
     C                     Z-ADD*ZEROS    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE WWPERC    WPERCL  3
     C                     ELSE
     C                     MOVEL'  0'     WPERCL
     C                     END
     C**
     C**  RETRIEVE NARRATIVE FOR BLOCK POSITIONS
     C**
     C           QFPOST    IFEQ 'C '
     C                     MOVELBLK,1     DDDET2    P
     C                     MOVELBLK,1     DDDETA    P
     C                     ENDIF
     C           QFPOST    IFEQ 'FC'
     C                     MOVELBLK,2     DDDET2    P
     C                     MOVELBLK,2     DDDETA    P
     C                     ENDIF
     C           QFPOST    IFEQ 'FO'
     C                     MOVELBLK,3     DDDET2    P
     C                     MOVELBLK,3     DDDETA    P
     C                     ENDIF
     C           QFPOST    IFEQ 'UV'
     C                     MOVELBLK,4     DDDET2    P
     C                     MOVELBLK,4     DDDETA    P
     C                     ENDIF
     C                     MOVE WPERCL    FIELB1
     C                     MOVE '%'       FIELB2
     C**
     C                     MOVELNARR,1    DDNAR2
     C**
     C***********PMCCYT    CHAINPMCCYTPP             73                   CPM005
     C           PMCCYT    CHAINPMCCYTPD             73                   CPM005
     C**
     C           *IN73     IFEQ '1'
     C**
     C                     MOVELQFCNUM    WWORK4 10
     C                     MOVE QFPTFR    WWORK4
     C                     MOVELWWORK4    WWORK6 13
     C                     MOVE QMCCY1    WWORK6
     C**
     C***SET*'ENQUIRIES*TERMINATING'*FIELD*IN**GDA*TO*'Y'                 CPM005
     C** SET 'ENQUIRIES TERMINATING' FIELD IN *LDA TO 'Y'                 CPM005
     C**
     C                     MOVEL'Y'       QMENQT
     C**
     C                     MOVEL'Y'       QMDBER           ***************
     C***********          MOVEL'PMCCYTPP'QMFILE           ** DB ERROR 06*CPM005
     C                     MOVEL'PMCCYTPD'QMFILE           ** DB ERROR 06*CPM005
     C                     MOVELWWORK6    QMKEY            ***************
     C                     Z-ADD6         QMERRN
     C***UPDATE**GDA                                                      CPM005
     C***********          CALL 'PMC1002'                                 CPM005
     C***********          PARM           WWGDA                           CPM005
     C** UPDATE *LDA                                                      CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C***********                                                         CPM005
     C***END*PROGRAM AND ACTIVE GROUP JOBS                                CPM005
     C***********                                                         CPM005
     C***********          CALL 'PMC1020'                                 CPM005
     C**
     C                     END
     C**
     C                     Z-ADD*ZEROS    WWMVPC 150
     C**
     C                     Z-ADD*ZEROS    WAOPEN 150
     C                     Z-ADD*ZEROS    WLOPEN 150
     C                     Z-ADD*ZEROS    WACLOS 150
     C                     Z-ADD*ZEROS    WLCLOS 150
     C**
     C***IF*DISPLAY*TRADE/VALUE*DATE*ON*DTAARA**GDA*IS*'T'                CPM005
     C** IF DISPLAY TRADE/VALUE DATE ON DTAARA *LDA IS 'T'                CPM005
     C**
     C           QFPOST    IFEQ 'C '
     C**
     C           QMTVPS    IFEQ 'T'
     C           QGPTPA    SUB  QGPTNA    WWMVPC
     C           WWMVPC    SUB  QGPTMV    WWMVPC
     C                     ELSE
     C           QGPVPA    SUB  QGPVNA    WWMVPC
     C           WWMVPC    SUB  QGPVMV    WWMVPC
     C                     ENDIF
     C                     ENDIF
     C**
     C** SETUP KEY FIELDS TO ACCESS PMCIALL3 FOR THE OPEN POSITIONS
     C**
     C**********           Z-ADDQFCNUM    W0CNUM                                              CSD027
     C                     MOVE QFCNUM    W0CNUM                                              CSD027
     C                     MOVE QFPTFR    W0PTF1
     C                     MOVE QFCCY1    W0CURR
     C                     MOVE 'FO'      W0POTY
     C                     MOVE 'B'       W0TOTT
     C                     Z-ADD0         W0DGRS
     C                     MOVE *BLANKS   W0DGRC
     C                     Z-ADD0         W0INDS
     C                     MOVE *BLANKS   W0INSC
     C**
     C** RETRIEVE FORWARD OPEN ASSET & FORWARD OPEN LIABILITY
     C**
     C           PMCIA3    CHAINPMCIALL3             73
     C**
     C           *IN73     IFEQ '1'
     C                     Z-ADD*ZEROS    WAOPEN
     C                     Z-ADD*ZEROS    WLOPEN
     C                     ELSE
     C                     Z-ADDFIASVL    WAOPEN
     C                     Z-ADDFILIVL    WLOPEN
     C                     ENDIF
     C**
     C** RETRIEVE FORWARD OPEN ASSET & FORWARD OPEN LIABILITY
     C**
     C                     MOVE 'FC'      W0POTY
     C**
     C           PMCIA3    CHAINPMCIALL3             73
     C**
     C           *IN73     IFEQ '1'
     C                     Z-ADD*ZEROS    WACLOS
     C                     Z-ADD*ZEROS    WLCLOS
     C                     ELSE
     C                     Z-ADDFIASVL    WACLOS
     C                     Z-ADDFILIVL    WLCLOS
     C                     ENDIF
     C**
     C           QFPOST    IFEQ 'C '
     C           WWMVPC    SUB  WAOPEN    WWMVPC
     C           WWMVPC    ADD  WLOPEN    WWMVPC
     C           WWMVPC    SUB  WACLOS    WWMVPC
     C           WWMVPC    ADD  WLCLOS    WWMVPC
     C                     ENDIF
     C**
     C           QFPOST    IFEQ 'FC'
     C           WACLOS    SUB  WLCLOS    WWMVPC
     C                     ENDIF
     C**
     C           QFPOST    IFEQ 'FO'
     C           WAOPEN    SUB  WLOPEN    WWMVPC
     C                     ENDIF
     C**
     C                     Z-ADDWWMVPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C**
     C           QFPOST    IFNE 'FO'
     C           QFPOST    ANDNE'FC'
     C           QFPOST    ANDNE'UV'
     C                     Z-ADDQGPTAI    ZFLD15
     C                     ELSE
     C                     Z-ADD0         ZFLD15
     C                     END
     C**
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C**
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C* #P1014   - ACCESS INSTRUMENT TYPE DETAILS & TOTALS               *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           #P1014    BEGSR
     C**
     C** RESET FIELDS
     C**
     C                     EXSR #BLANK
     C**
     C** ACCESS PF/SDPLINPD FOR THE INSTRUMENT TYPE DETAILS
     C** USING THE INSTRUMENT TYPE FROM THE HOLDINGS FILE
     C**
     C********** QFINNR    CHAINSDPLINPD             73                   CPM005
     C                     CALL 'AOPLINR0'                                CPM005
     C                     PARM '*MSG    'WWRTCD  7                       CPM005
     C                     PARM '*KEY    'WWOPTN  7                       CPM005
     C                     PARM QFINNR    WWKEY   3                       CPM005
     C           SDPLIN    PARM SDPLIN    DSFDY                           CPM005
     C**                                                                  CPM005
     C           WWRTCD    IFNE *BLANKS                                   CPM005
     C**
     C************IN73     IFEQ '1'                                       CPM005
     C**
     C***SET*'ENQUIRIES*TERMINATING'*FIELD*IN *GDA*TO*'Y'                 CPM005
     C** SET 'ENQUIRIES TERMINATING' FIELD IN *LDA TO 'Y'                 CPM005
     C**
     C                     MOVEL'Y'       QMENQT
     C**
     C                     MOVEL'Y'       QMDBER           ***************
     C                     MOVEL'SDPLINPD'QMFILE           ** DB ERROR 05*
     C                     MOVELQFINNR    QMKEY            ***************
     C                     Z-ADD5         QMERRN
     C***UPDATE *GDA                                                      CPM005
     C** UPDATE *LDA                                                      CPM005
     C**********           CALL 'PMC1002'                                 CPM005
     C**********           PARM           WWGDA                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C***********                                                         CPM005
     C***END*PROGRAM AND ACTIVE GROUP JOBS                                CPM005
     C***********                                                         CPM005
     C**********           CALL 'PMC1020'                                 CPM005
     C**
     C                     END
     C**
     C** FILL RECORD OF SUBFILE
     C**
     C                     MOVELQFINNR    DDTYPE
     C                     MOVEL'IT'      DDMODH
     C**
     C                     MOVEL*BLANK    DDACTN
     C**
     C**********           Z-ADDQFCNUM    W0CNUM                                              CSD027
     C                     MOVE QFCNUM    W0CNUM                                              CSD027
     C                     MOVE QFPTFR    W0PTF1
     C                     MOVE QMCCY1    W0CURR
     C                     MOVE QFPOST    W0POTY
     C                     MOVE QFINNR    W0INSC
     C**
     C           PMCIA2    CHAINPMCIALL2             73
     C**
     C                     MOVE *BLANKS   DDMVPC
     C                     MOVE *BLANKS   DDAIPC
     C**
     C           *IN73     IFEQ '1'
     C**
     C                     Z-ADD*ZEROS    FIASVL
     C                     Z-ADD*ZEROS    FILIVL
     C**
     C                     END
     C*
     C**  EDIT ASSET VALUE
     C                     Z-ADDFIASVL    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM1
     C*
     C**  EDIT LIABILITY VALUE
     C                     Z-ADDFILIVL    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDNOM2
     C**
     C           PPASSV    IFNE 0
     C           FIASVL    DIV  PPASSV    ZZASSV  43H
     C           ZZASSV    MULT 100       WWPAS   30H
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE WWPAS     ZFLD15
     C                     Z-ADD*ZEROS    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE WWPERC    WPERCA  3
     C                     ELSE
     C                     MOVEL'  0'     WPERCA
     C                     END
     C**
     C                     MOVE WPERCA    FIELA1
     C                     MOVE '%'       FIELA2
     C                     MOVELNARR,2    DDNARR
     C**
     C           PPLIAV    IFNE 0
     C           FILIVL    DIV  PPLIAV    ZZLIAV  43H
     C           ZZLIAV    MULT 100       WWPLI   30H
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE WWPLI     ZFLD15
     C                     Z-ADD*ZEROS    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE WWPERC    WPERCL  3
     C                     ELSE
     C                     MOVEL'  0'     WPERCL
     C                     END
     C**
     C                     MOVE WPERCL    FIELB1
     C                     MOVE '%'       FIELB2
     C                     MOVELPDISTN    DDDETA
     C**
     C                     MOVELNARR,2    DDNAR2
     C                     MOVELPDISTN    DDDET2
     C**
     C                     MOVE 'Y'       DDCOLR
     C**
     C***********PMTMPT    CHAINPMTMPTPP             73                   CPM005
     C           PMTMPT    CHAINPMTMPTPD             73                   CPM005
     C**
     C           *IN73     IFEQ '1'
     C**
     C                     MOVELQMCNUM    WWORK4 10
     C                     MOVE QMPTF1    WWORK4
     C                     MOVELWWORK4    WWORK6 13
     C                     MOVE QMCCY1    WWORK6
     C**
     C***SET*'ENQUIRIES*TERMINATING'*FIELD*IN**GDA*TO*'Y'                 CPM005
     C** SET 'ENQUIRIES TERMINATING' FIELD IN *LDA TO 'Y'                 CPM005
     C**
     C                     MOVEL'Y'       QMENQT
     C**
     C                     MOVEL'Y'       QMDBER           ***************
     C***********          MOVEL'PMTMPTPP'QMFILE           ** DB ERROR 07*CPM005
     C                     MOVEL'PMTMPTPD'QMFILE           ** DB ERROR 07*CPM005
     C                     MOVELWWORK6    QMKEY            ***************
     C                     Z-ADD8         QMERRN
     C***UPDATE**GDA                                                      CPM005
     C***********          CALL 'PMC1002'                                 CPM005
     C***********          PARM           WWGDA                           CPM005
     C** UPDATE *LDA                                                      CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C***********                                                         CPM005
     C***END*PROGRAM AND ACTIVE GROUP JOBS                                CPM005
     C***********                                                         CPM005
     C***********          CALL 'PMC1020'                                 CPM005
     C**
     C                     END
     C**
     C                     Z-ADD*ZEROS    WWMVPC 150
     C**
     C                     Z-ADD*ZEROS    WAOPEN 150
     C                     Z-ADD*ZEROS    WLOPEN 150
     C                     Z-ADD*ZEROS    WACLOS 150
     C                     Z-ADD*ZEROS    WLCLOS 150
     C**
     C***IF*DISPLAY*TRADE/VALUE*DATE*ON*DTAARA**GDA*IS*'T'                CPM005
     C** IF DISPLAY TRADE/VALUE DATE ON DTAARA *LDA IS 'T'                CPM005
     C**
     C           QFPOST    IFEQ 'C '
     C**
     C           QMTVPS    IFEQ 'T'
     C           QTPTPA    SUB  QTPTNA    WWMVPC
     C           WWMVPC    SUB  QTPTMV    WWMVPC
     C                     ELSE
     C           QTPVPA    SUB  QTPVNA    WWMVPC
     C           WWMVPC    SUB  QTPVMV    WWMVPC
     C                     ENDIF
     C                     ENDIF
     C**
     C** SETUP KEY FIELDS TO ACCESS PMCIALL3 FOR THE OPEN POSITIONS
     C**
     C**********           Z-ADDQFCNUM    W0CNUM                                              CSD027
     C                     MOVE QFCNUM    W0CNUM                                              CSD027
     C                     MOVE QFPTFR    W0PTF1
     C                     MOVE QFCCY1    W0CURR
     C                     MOVE 'FO'      W0POTY
     C                     MOVE 'I'       W0TOTT
     C                     Z-ADDQFDSPS    W0DGRS
     C                     MOVE QFDSPG    W0DGRC
     C                     Z-ADDQFITDS    W0INDS
     C                     MOVE QFINNR    W0INSC
     C**
     C** RETRIEVE FORWARD OPEN ASSET & FORWARD OPEN LIABILITY
     C**
     C           PMCIA3    CHAINPMCIALL3             73
     C**
     C           *IN73     IFEQ '1'
     C                     Z-ADD*ZEROS    WAOPEN
     C                     Z-ADD*ZEROS    WLOPEN
     C                     ELSE
     C                     Z-ADDFIASVL    WAOPEN
     C                     Z-ADDFILIVL    WLOPEN
     C                     ENDIF
     C**
     C** RETRIEVE FORWARD OPEN ASSET & FORWARD OPEN LIABILITY
     C**
     C                     MOVE 'FC'      W0POTY
     C**
     C           PMCIA3    CHAINPMCIALL3             73
     C**
     C           *IN73     IFEQ '1'
     C                     Z-ADD*ZEROS    WACLOS
     C                     Z-ADD*ZEROS    WLCLOS
     C                     ELSE
     C                     Z-ADDFIASVL    WACLOS
     C                     Z-ADDFILIVL    WLCLOS
     C                     ENDIF
     C**
     C           QFPOST    IFEQ 'C '
     C           WWMVPC    SUB  WAOPEN    WWMVPC
     C           WWMVPC    ADD  WLOPEN    WWMVPC
     C           WWMVPC    SUB  WACLOS    WWMVPC
     C           WWMVPC    ADD  WLCLOS    WWMVPC
     C                     ENDIF
     C**
     C           QFPOST    IFEQ 'FC'
     C           WACLOS    SUB  WLCLOS    WWMVPC
     C                     ENDIF
     C**
     C           QFPOST    IFEQ 'FO'
     C           WAOPEN    SUB  WLOPEN    WWMVPC
     C                     ENDIF
     C**
     C                     Z-ADDWWMVPC    ZFLD15
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDMVPC
     C**
     C           QFPOST    IFEQ 'C '
     C                     Z-ADDQTPTAI    ZFLD15
     C                     ELSE
     C                     Z-ADD0         ZFLD15
     C                     END
     C**
     C                     Z-ADDQMPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDAIPC
     C**
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* #P1016   -                                                       *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           #P1016    BEGSR
     C*
     C** SAVE DETAILS OF FIRST AND LAST RECORD ON SCREEN
     C                     EXSR #SCRN
     C           WWF13     IFEQ 'Y'
     C           *IN23     OREQ '1'
     C**********           MOVE W2SCRN    WWBSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWBSCR                                              CGL029
     C                     ELSE
     C**********           MOVE W2SCRN    WWTSCR 62                                           CGL029
     C                     MOVE W2SCRN    WWTSCR                                              CGL029
     C                     END
     C**
     C           QFRECI    IFEQ 'D'                        B2
     C           WWMAFF    ANDEQ'D'
     C           QFRECI    ORNE 'D'
     C           WWMAFF    ANDEQ'M'
     C*
     C                     MOVE 'N'       WCHGI
     C*
     C** IF FIRST RECORD READ AND POSITION TYPE TITLE TO BE DISPLAYED
     C** OR POSITION TYPE HAS CHANGED
     C           WWMAFF    IFEQ 'D'                        B4
     C           K         IFEQ 0                          B5
     C           WWDETT    ANDEQ'D'
     C           QFPOST    ORNE WWPOSO
     C                     MOVE 'Y'       WCHGI
     C                     EXSR #P1013
     C                     ADD  1         K
     C                     MOVE QFPOST    WWPOSO
     C*
     C** WRITE POSITION TYPE HEADING RECORD IN SUBFILE
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN52
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
     C                     WRITEPM0701S1
     C                     WRITEPM0701S2
     C                     MOVE *BLANKS   DDLIN1
     C                     MOVE *BLANKS   DDLIN2
     C                     MOVE '0'       *IN59
     C                     MOVE '0'       *IN52
     C***********K         CABEQ7         #P1059                          CPM005
     C           K         CABEQ6         #P1059                          CPM005
     C                     END                             E5
     C                     END                             E4
     C*
     C** IF FIRST RECORD READ AND INSTRUMENT GROUP TITLE TO BE DISPLAYED
     C** OR INSTRUMENT GROUP HAS CHANGED
     C           WWMAFF    IFEQ 'D'                        B4
     C           K         IFEQ 0                          B5
     C           WWDETT    ANDEQ'I'
     C           K         OREQ 1
     C           WWDETT    ANDEQ'D'
     C           QFINNR    ORNE WWINNO
     C           WCHGI     OREQ 'Y'
     C                     MOVE 'N'       WCHGI
     C                     EXSR #P1014
     C                     ADD  1         K
     C                     MOVE QFINNR    WWINNO
     C*
     C** WRITE INSTRUMENT GROUP HEADING RECORD IN SUBFILE
     C**
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN51
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
     C                     WRITEPM0701S1
     C                     WRITEPM0701S2
     C                     MOVE *BLANKS   DDLIN1
     C                     MOVE *BLANKS   DDLIN2
     C                     MOVE '0'       *IN59
     C                     MOVE '0'       *IN51
     C***********K         CABEQ7         #P1059                          CPM005
     C           K         CABEQ6         #P1059                          CPM005
     C                     END                             E5
     C                     END                             E4
     C**
     C** IF MODULE ID IS 'SE'
     C**
     C           QFMODI    IFEQ 'SE'                       B3
     C                     EXSR #P1004
     C                     END                             E3
     C**
     C** IF MODULE ID IS NOT 'SE'
     C**
     C           QFMODI    IFNE 'SE'                       B3
     C                     EXSR #P1005
     C                     END                             E3
     C**
     C                     ADD  1         K
     C**
     C** WRITE A RECORD TO THE SUBFILE
     C**
     C                     ADD  1         RRN1
     C                     ADD  1         RRN2
     C*
     C** FOR ROLL BACKWARDS ON MATURED POSITIONS WRITE SCREEN RECORDS
     C** OUT IN REVERSE SEQUENCE
     C           WWMAFF    IFEQ 'M'                        B4
     C           *IN24     ANDEQ'1'
     C                     Z-ADDRRN1      W1RRN1  50
     C                     Z-ADDRRN2      W1RRN2  50
     C***********8         SUB  RRN1      RRN1                            CPM005
     C***********8         SUB  RRN2      RRN2                            CPM005
     C           7         SUB  RRN1      RRN1                            CPM005
     C           7         SUB  RRN2      RRN2                            CPM005
     C                     END                             E4
     C**
     C                     WRITEPM0701S1
     C                     WRITEPM0701S2
     C*
     C** RESTORE SAVED VALUE OF RRN1 AND RRN2
     C           WWMAFF    IFEQ 'M'                        B4
     C           *IN24     ANDEQ'1'
     C                     Z-ADDW1RRN1    RRN1
     C                     Z-ADDW1RRN2    RRN2
     C                     END                             E4
     C*
     C********** K         CABEQ7         #P1059                          CPM005
     C           K         CABEQ6         #P1059                          CPM005
     C                     END                             E2
     C*
     C** READ NEXT HOLDING RECORD
     C           WWMAFF    IFEQ 'D'                        B2
     C                     READ PMHOLDL9                 72
     C                     ELSE                            X2
     C*
     C           *IN24     IFEQ '1'                        B3
     C**********           READPPMMFHLPP                 72               CPM005
     C                     READPPMMFHLPD                 72               CPM005
     C                     ELSE                            X3
     C**********           READ PMMFHLPP                 72               CPM005
     C                     READ PMMFHLPD                 72               CPM005
     C                     END                             E3
     C*
     C                     END                             E2
     C*
     C           #P1059    ENDSR
     C********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #V1001   - VALIDATE SUBFILE ENTRIES                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS PM HOLDINGS SCREEN                            *
      * #P1006   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      *                                                                  *
      ********************************************************************
     C           #V1001    BEGSR
     C**
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN56
     C                     MOVE '0'       *IN57
     C                     MOVE '0'       *IN58
     C                     MOVE '0'       *IN63
     C                     MOVE '0'       *IN67
     C                     MOVE '0'       *IN66
     C                     MOVE '0'       *IN30
     C                     MOVE '0'       *IN31
     C                     MOVE '0'       *IN33
     C*                                                                   CPM005
     C                     EXSR #VACO                                     CPM005
     C           *IN42     IFEQ '1'                                       CPM005
     C                     MOVE '1'       *IN80                           CPM005
     C                     GOTO E1001                                     CPM005
     C                     END                                            CPM005
     C**
     C** IF POOL PORTFOLIO CUSTOMER MUST NOT BE T,F,G,P OR O.
     C**
     C           QMPPCS    IFEQ 'Y'
     C**
     C           WWACTN    IFEQ 'T'
     C           WWACTN    OREQ 'F'
     C           WWACTN    OREQ 'G'
     C           WWACTN    OREQ 'P'
     C           WWACTN    OREQ 'O'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN30
     C                     END
     C**
     C                     END
     C**
     C** IF POOL PORTFOLIO CUSTOMER; D ENTERED AND MODULE DL, LE OR RE.
     C**
     C           QMPPCS    IFEQ 'Y'
     C           WWACTN    ANDEQ'D'
     C**
     C           DDMODH    IFNE 'SE'
     C           DDMODH    ANDNE'FF'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN31
     C                     END
     C**
     C                     END
     C**
     C** OPTION 'G' IS VALID ONLY FOR SECURITY POSITIONS
     C**
     C           WWACTN    IFEQ 'G'
     C           WWGLOB    ANDEQ'Y'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN67
     C                     ELSE
     C**
     C           WWACTN    IFEQ 'G'
     C           DDMODH    ANDNE'SE'
     C**
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN56
     C**
     C                     END
     C**
     C                     END
     C**
     C**
     C           WWACTN    IFEQ 'T'
     C           DDMODH    ANDNE'SE'
     C           DDMODH    ANDNE'DL'
     C           DDMODH    ANDNE'MD'
     C           DDMODH    ANDNE'ML'
     C           DDMODH    ANDNE'FR'
     C           DDMODH    ANDNE'FX'
     C           DDMODH    ANDNE'LE'
     C           DDMODH    ANDNE'FF'
     C           DDMODH    ANDNE'RE'
     C           DDMODH    ANDNE'FI'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN57
     C                     END
     C**
     C           WWACTN    IFEQ 'T'
     C           DDMODH    ANDEQ'FX'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN57
     C                     END
     C**
     C***********WWACTN    IFEQ 'F'                                       CPM005
     C           WWACTN    IFEQ 'K'                                       CPM005
     C           DDMODH    ANDEQ'RE'
     C***********WWACTN    OREQ 'F'                                       CPM005
     C           WWACTN    OREQ 'K'                                       CPM005
     C           DDMODH    ANDEQ'FF'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN58
     C                     END
     C**
     C           WWACTN    IFEQ 'P'
     C           DDMODH    ANDNE'SE'
     C           WWACTN    OREQ 'P'
     C           DDSPLH    ANDNE'Y'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN66
     C                     END
     C**
     C** OPTION T IS ONLY VALID ON BONDS IF PORTFOLIO IS NOT CONSOLIDATED
     C** OR NOT COMBINED
     C*
     C           WWACTN    IFEQ 'T'
     C           DDMODH    ANDEQ'SE'
     C*
     C           WWPTFR    IFEQ '9998'
     C           WWPTFR    OREQ '9999'
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN33
     C                     END
     C                     END
     C**
     C           WWACTN    IFEQ 'O'
     C           DDMODH    ANDNE'FF'
     C           WWACTN    OREQ 'O'
     C           DDCLOH    ANDEQ*ZEROS
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN63
     C                     END
     C**
     C           E1001     TAG                                            CPM005
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #U1001   - FILL SUBFILE HEADER                                   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - PROCESS PM HOLDINGS SCREEN                            *
      * #P1006   - DISPLAY CUSTOMER GLOBAL POSITION                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINTV   - INTERIM TRADE/VALUE INDICATOR                         *
      *                                                                  *
      ********************************************************************
     C           #U1001    BEGSR
     C**
     C** CUSTOMER NUMBER
     C**
     C                     MOVELQMCNUM    DDCNUM
     C**
     C** CUSTOMER REPORT NAME
     C**
     C                     MOVELQMCRNM    DDCRNM
     C**
     C** PORTFOLIO REFERENCE  ON SCREEN
     C**
     C                     MOVELQMPTF2    DDPTFR
     C**
     C** PORTFOLIO NARRATIVE
     C**
     C                     MOVELQMPTFN    DDPTFN
     C**
     C***********QMPTCY    CHAINSDCURRL0             73                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM '*MSG   ' @RTCD   7                       CPM005
     C                     PARM '*KEY    'WWOPTN  7                       CPM005
     C                     PARM QMPTCY    WWKEY2  3                       CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
     C           @RTCD     IFNE *BLANKS                                   CPM005
     C**
     C************IN73     IFEQ '1'                        ***************CPM005
     C***********          MOVEL'SDCURRL0'QMFILE           ** DB ERROR 01*CPM005
     C                     MOVEL'SDCURRPD'QMFILE           ** DB ERROR 01*CPM005
     C                     MOVELQMPTCY    QMKEY            ***************
     C                     Z-ADD3         QMERRN
     C                     EXSR *PSSR
     C                     END
     C**
     C                     Z-ADDA6NBDP    W6NBDP  10
     C**
     C** PORTFOLIO TOTAL ASSETS
     C**
     C                     Z-ADDPPASSV    ZFLD15
     C                     Z-ADDW6NBDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DPTOTA
     C**
     C           PPASSV    IFEQ *ZEROS
     C                     MOVE '1'       *IN76
     C                     ELSE
     C                     MOVE '0'       *IN76
     C                     END
     C**
     C** PORTFOLIO TOTAL LIABILITIES
     C**
     C                     Z-ADDPPLIAV    ZFLD15
     C                     Z-ADDW6NBDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DPTOTL
     C**
     C           PPLIAV    IFEQ *ZEROS
     C                     MOVE '1'       *IN77
     C                     ELSE
     C                     MOVE '0'       *IN77
     C                     END
     C**
     C** PORTFOLIO CURRENCY
     C**
     C                     MOVELQMPTCY    DDCCY
     C                     MOVELQMPTCY    DDCUR1
     C                     MOVELQMPTCY    DDCUR2
      *
      **  RETRIEVE NARRATIVE
     C***********QMCCY1    CHAINSDCURRL0             73                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM '*MSG   ' @RTCD   7                       CPM005
     C                     PARM '*KEY    'WWOPTN  7                       CPM005
     C                     PARM QMCCY1    WWKEY2  3                       CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
     C           @RTCD     IFNE *BLANKS                                   CPM005
     C**
     C************IN73     IFEQ *ON                                       CPM005
     C***********          MOVEL'SDCURRL0'QMFILE                          CPM005
     C                     MOVEL'SDCURRPD'QMFILE                          CPM005
     C                     MOVELQMCCY1    QMKEY            ***************
     C                     Z-ADD8         QMERRN           **DB ERROR 08**
     C                     EXSR *PSSR                      ***************
     C                     END
      *
      **  DISPLAY NARRATIVE
     C                     MOVELA6CYCD    DDCUP1
     C                     MOVELA6CYNM    DDCUP2
     C**
     C** POSITION TYPE TOTAL ASSETS
     C**
     C                     Z-ADDPPASVL    ZFLD15
     C                     Z-ADDW6NBDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DPOSTA
     C**
     C** CALCULATE % POSITION TYPE ASSETS
     C**
     C           PPASSV    IFNE *ZEROS                       1
     C           PPASVL    DIV  PPASSV    ZZASSV  43H
     C           ZZASSV    MULT 100       WWPASS  41
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE WWPASS    ZFLD15
     C                     Z-ADD1         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DPERCA
     C                     MOVE '%'       DPERCA
     C                     ELSE
     C                     MOVE '  0.0%'  DPERCA
     C                     END
     C**
     C** POSITION TYPE TOTAL LIABILITIES
     C**
     C                     Z-ADDPPLIVL    ZFLD15
     C                     Z-ADDW6NBDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DPOSTL
     C**
     C** CALCULATE % POSITION TYPE LIABILITIES
     C**
     C           PPLIAV    IFNE *ZEROS                       1
     C           PPLIVL    DIV  PPLIAV    ZZLIAV  43H
     C           ZZLIAV    MULT 100       WWPLIA  41
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE WWPLIA    ZFLD15
     C                     Z-ADD1         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DPERCL
     C                     MOVE '%'       DPERCL
     C                     ELSE
     C                     MOVE '  0.0%'  DPERCL
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * LBTYP    - RETRIEVE GUARANTEES/PLEDGE TYPE                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1010   - DISPLAY INTRUMENT DETAILS OF A HOLDING                *
      * #P1012   - PLEDGES DETAILS                                       *
      *                                                                  *
      ********************************************************************
     C           LBTYP     BEGSR
     C*
     C           DDTYPE    IFEQ LBPLEG
     C                     MOVE 'P'       TYPE    1
     C                     ELSE
     C*
     C           DDTYPE    IFEQ LBGUAR
     C                     MOVE 'G'       TYPE
     C                     ELSE
     C*
     C           DDTYPE    IFEQ LBCOLI
     C                     MOVE 'C'       TYPE
     C                     ELSE
     C*
     C           DDTYPE    IFEQ LBSECU
     C                     MOVE 'S'       TYPE
     C                     ELSE
     C                     MOVE *BLANK    TYPE
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #SCRN  - ROUTINE SETTING UP SCREEN HEADER & FOOTER ARRAYS        *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #SCRN     BEGSR
     C**
     C                     MOVE QFCNUM    W2CNUM
     C                     MOVE QFPTFR    W2PTFR
     C                     MOVE QFDSPS    W2DSPS
     C                     MOVE QFDSPG    W2DSPG
     C                     MOVE QFITDS    W2ITDS
     C                     MOVE QFINNR    W2INNR
     C                     MOVE QFCCY1    W2CCY1
     C                     MOVE QFTDSS    W2TDSS
     C                     MOVE QFTDSS    W2TDSS
     C                     MOVE QFTRNB    W2TRNB
     C                     MOVE QFTXT2    W2TXT2
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #FILE  - ROUTINE SETTING UP SCREEN HEADER & FOOTER ARRAYS        *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #FILE     BEGSR
     C**
     C                     MOVE W2CNUM    QFCNUM
     C                     MOVE W2PTFR    QFPTFR
     C                     MOVE W2DSPS    QFDSPS
     C                     MOVE W2DSPG    QFDSPG
     C                     MOVE W2ITDS    QFITDS
     C                     MOVE W2INNR    QFINNR
     C                     MOVE W2TDSS    QFTDSS
     C                     MOVE W2DLSQ    QFDLSQ
     C                     MOVE W2CCY1    QFCCY1
     C                     MOVE W2TRNB    QFTRNB
     C                     MOVE W2TXT2    QFTXT2
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT                                                              CPM005
      *****************************************************************   CPM005
     C*                                                               *   CPM005
     C*    #VACO - CHECK FOR VALID ACTION CODE                        *   CPM005
     C*                                                               *   CPM005
     C*    CALLED BY: #V10F0 - PROCESS VALIDATION OF START SCREEN     *   CPM005
     C*    CALLS:                                                     *   CPM005
     C*                                                               *   CPM005
     C*****************************************************************   CPM005
     C           #VACO     BEGSR                                          CPM005
     C*                                                                   CPM005
     C** Check valid action codes                                         CPM005
     C*                                                                   CPM005
     C                     Z-ADD1         UV      20                      CPM005
     C                     MOVEL'0'       *IN42                           CPM005
     C           WWACTN    LOKUPVC1,UV                   41               CPM005
     C*                                                                   CPM005
     C           *IN41     IFEQ '0'                                       CPM005
     C                     MOVEL'1'       *IN42                           CPM005
     C                     END                                            CPM005
     C*                                                                   CPM005
     C                     ENDSR                                          CPM005
     C*****************************************************************   CPM005
      /EJECT
      /COPY ZSRSRC,ZEDITZ2
      /EJECT
      /COPY ZSRSRC,ZSEDITZ3
      /EJECT
      /COPY ZSRSRC,ZCCYCN
      /EJECT
      /COPY ZSRSRC,ZCCYXR
      /EJECT                                                              CPM005
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - TO PROCESS DATA BASE ERRORS                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **PMC1000**-*PROGRAM*CALLED*TO*UPDATE *GDA**************************CPM005
      * PMC1001  - PROGRAM CALLED TO UPDATE *LDA                         *CPM005
      **PMC1020**-*PROGRAM*CALLED*TO*END*GROUP*JOB************************CPM005
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      **WWPARM***- *GDA***************************************************CPM005
      * WWPARM   - *LDA                                                  *CPM005
      * WWEND    - END PARAMETER                                         *
      * WWGRPJ   - GROUP JOB PARAMETER                                   *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'PM0701'  QMPGM
     C                     MOVEL'Y'       QMENQT
     C**
     C***UPDATE *GDA                                                      CPM005
     C** UPDATE *LDA                                                      CPM005
     C**
     C**********           CALL 'PMC1002'                                 CPM005
     C**********           PARM           WWGDA                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C**
     C                     DUMP
     C**
     C**********           CALL 'PMC1020'                                 CPM005
     C                     CALL 'DBERRCTL'                                CPM005
     C                     RETRN                                          CPM005
     C**
     C                     ENDSR
     C****************************************************************
     C**                                                             *
     C**  SR:FFPRCS   - CONVERTS A PRICE IN FILE FORMAT ( 11,7P )    *
     C**                TO ITS EQUIVALENT SCREEN FORMAT ( 12  A )    *
     C**                                                             *
     C****INPUTS******-*FFPRIC*(11,7P)*PRICE*(*FILE*FORMAT*)**********    CPM005
     C**  INPUTS      - FFPRIC (15,8P) PRICE ( FILE FORMAT )         *    CPM005
     C**                FFTKDM  (3,0P) TICKS DENOMINATOR             *
     C******************FFMNPF*(11,7P)*MINIMUM*PRICE*FLUCTUATION******    CPM005
     C****OUTPUTS*****-*FFSPRC*(12**A)*PRICE*(*SCREEN*FORMAT*)********    CPM005
     C**                FFMNPF (15,8P) MINIMUM PRICE FLUCTUATION     *    CPM005
     C**  OUTPUTS     - FFSPRC (16  A) PRICE ( SCREEN FORMAT )       *    CPM005
     C**                                                             *
     C****************************************************************
     C**      SUBROUTINE ONLY CHANGED FOR THIS PROGRAM               *
     C**      CHANGE I TO W                                          *
     C**      CHANGE J TO Z                                          *
     C****************************************************************
     C           FFPRCS    BEGSR                           ** FFPRCS SR **
     C**
     C**
     C**
     C*     DEFINE INPUT FIELDS
     C**
     C** FFPRIC Previously Defined.                                       CPM005
     C***********          Z-ADDFFPRIC    FFPRIC 117                      CPM005
     C                     Z-ADDFFPRIC    FFPRIC                          CPM005
     C                     Z-ADDFFTKDM    FFTKDM  30
     C** FFMNPF Previously Defined.                                       CPM005
     C***********          Z-ADDFFMNPF    FFMNPF 117                      CPM005
     C                     Z-ADDFFMNPF    FFMNPF                          CPM005
     C**
     C*     INITIALISE O/P FIELD FFSPRC
     C**
     C** FFSPRC Previously Defined.                                       CPM005
     C***********          MOVE *BLANK    FFSPRC 12                       CPM005
     C                     MOVE *BLANK    FFSPRC                          CPM005
     C**
     C*     SEARCH FFPRIC FOR 1ST NON ZERO ELEMENT BEFORE DECIMAL
     C**
     C                     Z-ADD1         W       20
     C***********W         DOWLT4                                         CPM005
     C           W         DOWLT7                                         CPM005
     C           FFFP,W    ANDEQ0
     C**
     C                     ADD  1         W
     C**
     C                     END
     C**
     C******MOVE*ELEMENTS*FROM*FIRST*NON*ZERO*POSITION*TO*4TH*OF*FFFP     CPM005
     C**    MOVE ELEMENTS FROM FIRST NON ZERO POSITION TO 7TH OF FFFP     CPM005
     C*     TO CORRESPONDING POSITIONS IN FFSP
     C**
     C***********W         DOWLE4                                         CPM005
     C           W         DOWLE7                                         CPM005
     C**
     C                     MOVE FFFP,W    FFSP,W
     C                     ADD  1         W
     C**
     C                     END
     C**
     C*     SET UP DECIMAL OR FRACTION FORMAT SEPARATOR
     C**
     C           FFTKDM    IFEQ 100
     C*
     C                     MOVE '.'       FFPT    1
     C*
     C                     ELSE
     C*
     C                     MOVE '-'       FFPT
     C*
     C                     END
     C**
     C*     DETERMINE NUMBER OF SIGNIFICANT DECIMAL DIGITS
     C**
     C*     IF TICK =100 DETERMINE NO. DECIMAL PLACES FROM FFMNPF
     C**
     C           FFTKDM    IFEQ 100
     C**
     C***********          Z-ADD7         W                               CPM005
     C                     Z-ADD8         W                               CPM005
     C           W         DOWGT0
     C           FFMF,W    ANDEQ0
     C*
     C                     SUB  1         W
     C*
     C                     END
     C                     Z-ADDW         FFN     20
     C**
     C                     ELSE
     C**
     C*    DETERMINE NO. OF SIGNIFICANT DIGITS FROM TICK VALUE
     C**
     C           FFTKDM    IFLE 10
     C                     Z-ADD1         FFN
     C                     END
     C**
     C           FFTKDM    IFGT 10
     C           FFTKDM    ANDLE100
     C                     Z-ADD2         FFN
     C                     END
     C**
     C           FFTKDM    IFGT 100
     C                     Z-ADD3         FFN
     C                     END
     C**
     C                     END
     C**
     C*    IF NUMBER OF SIGNIFICANT DECIMALS<> 0
     C**
     C           FFN       IFNE 0
     C**
     C*    MOVE FFPT IN TO OUT FIELD
     C**
     C***********          MOVE FFPT      FFSP,5                          CPM005
     C                     MOVE FFPT      FFSP,8                          CPM005
     C**
     C*    MOVE SIGNIFICANT DIGITS TO CORRESPONDING
     C*    POSITIONS IN FFSP
     C**
     C***********          Z-ADD5         W                               CPM005
     C                     Z-ADD8         W                               CPM005
     C           FFN       DOWNE0
     C*
     C           W         ADD  1         Z       20
     C                     MOVE FFFP,W    FFSP,Z
     C                     ADD  1         W
     C                     SUB  1         FFN
     C*
     C                     END
     C**
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C***   ATN - ARRAY TO ENABLE ATTN KEY                                CPM005
     C* SETATNPGM PGM(PMC0610)                                            CPM005
     C***   BLK - BLOCK TOTAL NARRTIVE                                    CPM005
     C*CURRENT POSNS                                                      CPM005
     C*FORWARD CLOSED                                                     CPM005
     C*FORWARD OPEN                                                       CPM005
     C*UNVALUED POSNS                                                     CPM005
     C***   NARR - NARRATIVES                                             CPM005
     C*Position Type                                                      CPM005
     C*Instrument Type                                                    CPM005
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   POWER - POWERS OF 10 FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  VC1 - Valid codes for program                                         CPM005
VKGPTDO                                                                   CPM005
