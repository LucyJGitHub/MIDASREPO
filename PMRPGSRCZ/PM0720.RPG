     H
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Portfolio details enquiry')                   *
/*OVRF*: OVRDBF FILE(PMPORTXX) TOFILE(PMPORTPD) SHARE(*NO)          : *   S01486
/*OVRF*: OVRDBF FILE(PMCHRGXX) TOFILE(PMCHRGPD) SHARE(*NO)          : *   S01486
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                                 *
     F*                                                               *
     F*  PM0720 - PM PORTFOLIO DETAILS ENQUIRY                        *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC003             Date 25Feb97               *
     F*                 CPM005             Date 09JUL96               *
     F*                 CPM003             DATE 02MAY96               *
     F*                 S71062             DATE 30NOV95               *
     F*                 085817             DATE 13MAR95               *
     F*                 S01486             DATE 08JUL94               *
     F*                 SA9108             DATE 06NOV91               *
     F*                 049421             DATE 22JAN93               *
     F*                 S01313             DATE 05MAY92               *
     F*                 R00824             DATE 09NOV90               *
     F*                 R10014             DATE 05/09/90              *
     F*                 033617             DATE 08/08/90              *
     F*****************************************************************
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
     F*  CAC003 - Profit Centre Accounting Development Phase 3.       *
     F*  CPM005 - Private Banking Phase II                            *
     F*           Focus Group Changes Upgraded to DBA                 *
     F*           PBFG/5 - INSTRUMENT ASSET/LIABILITY SPLIT           *
     F*           PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*  CPM003 - FF/PM Interface upgrade to Release 10               *
     F*  S71062 - PM/FF Interface.                                    *
     F*  085817 - Recompile due to changes in PMLDAPD                 *
     F*  S01486 - Portfolio Management Upgrade                        *
     F*  SA9108 - POOL SECURITIES TRANSACTIONS (ONLY RECOMPILED       *
     F*           FOR DTAARA/LDA)                                     *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  S01313 - CHANGES FOR PORTFOLIO PERFORMANCE                   *
     F*  R00824 - INVESTMENT POLICY DETAILS AMENDMENT                 *
     F*  R10014 - WRITE SUBFILE EMPTY IF NO CHARGES                   *
     F*  33617  - SUBFILE NOT CLEARED                                 *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*: OVRDBF FILE(PMPORTXX) TOFILE(PMPORTPP) SHARE(*NO)          : *   S01486
     F*: OVRDBF FILE(PMCHRGXX) TOFILE(PMCHRGPP) SHARE(*NO)          : *   S01486
     F*                                                               *
     F*****************************************************************
     F**
      * BANK DETAILS
     F**
     F****SDBANKL1IF  E                    DISK                           S01486
     F**********                                    KINFSR *PSSR          S01486
     F**
      * PORTFOLIO DEFINITION DETAILS
     F**
     F****PMPORTPPIF  E           K        DISK                           S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**
      * PORTFOLIO CHARGE DETAILS
     F**
     F****PMCHRGPPIF  E           K        DISK                           S01486
     FPMCHRGPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**
      * CHARGE CODES
     F**
     F****PMCGCDPPIF  E           K        DISK                           S01486
     FPMCGCDPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**
      * BANK INVESTMENT POLICY DETAILS
     F**
     F****PMBIPNPPIF  E           K        DISK                           S01486
     F********************************************* KINFSR *PSSR          S01486
     F** DISPLAY FILE
     F**
     F****PM0720DDCF  E                    WORKSTN                        S01486
     FPM0720DFCF  E                    WORKSTN                            S01486
     F                                        RRN   KSFILE PM0720E2
      *
     F*===========================================================
      *
     E**
     E*                   CPY@    1   1 80
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E**
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E**
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E**
     E** ARRAY FOR ZEDIT
     E                    ZS1        15  1 0
     E                    ZS2        21  1
     E** ARRAY FOR ZALIGN
     E                    ZA1        16  1               ZALIGN/ZEDIT ARRAY
     E**
     E                    ZA2        16  1               ZALIGN/ZEDIT ARRAY
     E**
     I**
     I** EXTERNAL FORMAT FOR GROUP DATA AREA
     I**
     I****WWLDA     E DSPMLDAPP                                           S01486
     IWWLDA     E DSPMLDAPD                                               S01486
     I****WWGDA     E DSPMGRDAPP                                          S01486
     I**
     ISDBANK    E DSSDBANKPD                                              S01486
     I* Bank Details Accesses Via Access Program                          S01486
     IPMBIPN    E DSPMBIPNPD                                              S01486
     I** EXTERNAL DS FOR DOCUMENT COMMENT CODE                            S01486
     ISDMMOD    E DSSDMMODPD                                              S71062
     I** EXTERNAL DS FOR MODULES                                          S71062
     ISDPORT    E DSSDPORTPD                                              CPM003
     I** Portfolio Management ICD                                         CPM003
     I**                                                                  CAC003
     ISCSARD    E DSSCSARDPD                                              CAC003
     I** EXTERNAL DS FOR SAR'S FILE                                       CAC003
     I*                                                                   CPM003
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     IPSDS       SDS
     I**********                            244 253 WSID                  S01486
     I**********                            254 263 USID                  S01486
     I                                      244 253 WKSTN                 S01486
     I                                      254 263 USER                  S01486
     I**
     I**
      *
      *  PROGRAM START
      *
     C                     EXSR #INIT
      **
     C           *INKC     DOWEQ'0'                        -B1
     C           *INKL     ANDEQ'0'
      *
     C                     MOVE '0'       *IN25
     C                     MOVE '0'       *IN26
      *
      ** PREPARE PORTFOLIO DETAILS SCREEN FOR OUTPUT
      *
     C           WWCONT    IFEQ 1
     C                     EXSR #P01
     C                     END
      *
      ** PREPARE PORTFOLIO CHARGE DETAILS FOR OUTPUT
      *
     C           WWCONT    IFEQ 2
     C                     EXSR #P02
     C                     END
      **
      ** F3 TAKEN
      *
     C           *INKC     IFEQ '1'                        -B2
      *
      ** SET ENQUIRIES TERMINATING TO 'Y'
      *
     C                     MOVE 'Y'       QMENQT
      *
      ***WRITE*DETAILS*ON *GDA                                            S01486
      ** WRITE DETAILS ON *LDA                                            S01486
      *
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
      *
      ** TO END GROUP JOBS
     C**********           CALL 'PMC1020'                                 S01486
      *
     C                     END                             -E2
      **                                                                  R00824
      ** F5 TAKEN                                                         R00824
      *                                                                   R00824
     C           *INKE     IFEQ '1'                        -B2            R00824
     C**                                                                  R00824
     C** CALL  PMC1001 TO UPDATE LDA                                      R00824
     C                     MOVELPNPTCY    QMPTCY                          R00824
     C                     Z-ADDPNPCDP    QMPCDP                          R00824
     C                     MOVELPNPOLC    QMPOLC                          R00824
     C                     MOVEL'PM0720'  QMPGM                           R00824
     C                     CALL 'PMC1001'                                 R00824
     C                     PARM           WWLDA                           R00824
     C**                                                                  R00824
     C** CALL PM0730 FOR INVESTMENT POLICIES DETAILS                      R00824
     C                     MOVE 'PM0720'  WWCPGM  6                       R00824
     C                     CALL 'PM0730'                                  R00824
     C                     PARM           WWCPGM                          R00824
     C**                                                                  R00824
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELDS                 R00824
     C                     MOVEL*BLANKS   QMPTCY                          R00824
     C                     Z-ADD0         QMPCDP                          R00824
     C                     MOVEL*BLANKS   QMPOLC                          R00824
     C                     MOVEL*BLANKS   QMPGM                           R00824
     C                     CALL 'PMC1001'                                 R00824
     C                     PARM           WWLDA                           R00824
     C                     END                             -E2            R00824
     C/COPY WNCPYSRC,PM0720C001
      *
      ** F25 TAKEN
     C           *IN25     IFEQ '1'
     C           WWCONT    ANDNE2
     C                     ADD  1         WWCONT
     C                     END
      ** F26 TAKEN
     C           *IN26     IFEQ '1'
     C           WWCONT    ANDNE1
     C                     SUB  1         WWCONT
     C                     END
      ** PROGRAM END
     C                     END                             -E1
      **
     C                     RETRN
      *
      ** INITIAL PROCESSING
      *
     C********************************************************************
      /EJECT
      **************************************************************************
     C           #INIT     BEGSR                           **INIT BSR**
      *
     C** TO RETRIEVE DATA FROM DTTAARA/*LDA
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
      *
     C                     MOVE '1'       *IN65
     C                     MOVE '0'       *INKL
     C                     MOVE *BLANKS   WWORK1  1
     C                     MOVE *BLANKS   WWORK2  1
     C                     MOVE QMCNUM    WWCNUM  6
     C                     MOVE QMPTF1    WWPTF1  4
     C                     Z-ADD1         WWCONT  10
     C                     Z-ADD1         RRN     30
     C** CLEAR SUBFILE
     C                     WRITEPM0720F2                                  33617
     C                     MOVE '0'       *IN65                           33617
     C           *LIKE     DEFN POCGCO    WWCGCO
     C           *LIKE     DEFN POCGSP    WWCGSP
     C           *LIKE     DEFN POCGSI    WWCGSI
     C*          *LIKE     DEFN POCCSP    WWCCSP
     C*          *LIKE     DEFN POCISP    WWCISP
     C           *LIKE     DEFN POCGEI    WWCGEI
      *
     C           LIST1     KLIST
     C                     KFLD           QMCNUM
     C                     KFLD           QMPTF1
     C           LIST2     KLIST
     C                     KFLD           QMCNUM
     C                     KFLD           QMPTF1
     C                     KFLD           WWCGSQ  20
     C           LIST3     KLIST
     C                     KFLD           PNBCGY
     C                     KFLD           WWCGCO
      *
     C********** 1         SETLLSDBANKL1                                  S01486
     C**********           READ SDBANKL1                 71               S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
      *
     C** TO PROCESS DATABASE ERRORS
     C********** *IN71     IFEQ '1'                        ***************S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVE 'SDBANKL1'QMFILE           * DBERROR 01  *
     C                     MOVE *BLANKS   QMKEY            ***************
     C                     Z-ADD1         QMERRN
     C                     EXSR *PSSR
     C                     END
     C** Access SDMMODPD to check Future & Options switch on or off       S71062
     C                     CALL 'AOMMODR0'                                S71062
     C                     PARM '*DBERR ' @RTCD   7                       S71062
     C                     PARM '*FIRST ' @OPTN   7                       S71062
     C           SDMMOD    PARM SDMMOD    DSFDY                           S71062
     C           @RTCD     IFNE *BLANKS                    ***************S71062
     C                     MOVE 'SDMMODPD'QMFILE           * DBERROR 20  *S71062
     C                     MOVE *BLANKS   QMKEY            ***************S71062
     C                     Z-ADD20        QMERRN                          S71062
     C                     EXSR *PSSR                                     S71062
     C                     END                                            S71062
     C*                                                                   CAC003
     C** Check if Analytical Accounting and Switchable Feature            CAC003
     C** CAC003 are switched on.                                          CAC003
     C                     MOVE '0'       *IN21                           CAC003
     C*                                                                   CAC003
     C                     CALL 'AOSARDR0'                                CAC003
     C                     PARM           @RTCD   7                       CAC003
     C                     PARM '*VERIFY' @OPTN   7                       CAC003
     C                     PARM 'CAC003'  WWSARD  6                       CAC003
     C           SCSARD    PARM SCSARD    DSFDY                           CAC003
      *                                                                   CAC003
     C           @RTCD     IFEQ *BLANK                                    CAC003
     C           BGN0ST    ANDEQ'Y'                                       CAC003
     C                     MOVE '1'       *IN21                           CAC003
     C                     ENDIF                                          CAC003
     C/COPY WNCPYSRC,PM0720C002
     C**                                                                  S71062
     C           BGFUOP    IFEQ 'Y'                                       CPM003
     C** Access PM ICD for FCPORS, Type of Portfolios supported           CPM003
     C                     CALL 'AOPORTR0'                                CPM003
     C                     PARM '*DBERR ' @RTCD                           CPM003
     C                     PARM '*FIRST ' @OPTN                           CPM003
     C           SDPORT    PARM SDPORT    DSFDY                           CPM003
     C           @RTCD     IFNE *BLANKS                                   CPM003
     C                     MOVE *BLANKS   QMKEY            ***************CPM003
     C                     Z-ADD6         QMERRN           * DB ERROR 06 *CPM003
     C                     MOVE 'SDPORTPD'QMFILE           ***************CPM003
     C                     EXSR *PSSR                                     CPM003
     C                     END                                            CPM003
     C                     END                                            CPM003
     C*                                                                   CPM003
     C           BGFUOP    IFEQ 'Y'                                       S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C                     MOVE *ON       *IN20                           S71062
     C                     ELSE                                           S71062
     C                     MOVE *OFF      *IN20                           S71062
     C                     END                                            S71062
      *
     C                     ENDSR                           **INIT ENDSR
      *
     C********************************************************************
      /EJECT
      **************************************************************************
     C           #P01      BEGSR                           **P01 BSR**
      *
     C           WWORK1    IFEQ *BLANK                     -B1
     C                     MOVEL'Y'       WWORK1
      **ACCESS*PMPORTPP*BY*CUSTOMER*NUMBER                                S01486
      * ACCESS PMPORTPD BY CUSTOMER NUMBER                                S01486
     C********** LIST1     CHAINPMPORTPP             72                   S01486
     C           LIST1     CHAINPMPORTPD             72                   S01486
      *
      * DATABASE ERROR
     C           *IN72     IFEQ '1'                        -B2************
     C**********           MOVEL'PMPORTPP'QMFILE           * DBERROR 02  *S01486
     C                     MOVEL'PMPORTPD'QMFILE           * DBERROR 02  *S01486
     C                     MOVEL'LIST1'   QMKEY            ***************
     C                     Z-ADD2         QMERRN
     C                     EXSR *PSSR
     C                     END                             -E2
      *
     C                     MOVE PNACSQ    DDACSQ                          S71062
      *                                                                   S71062
      * CONVERT AND SET DATE PORTFOLIO OPENED
     C           PNDPOP    IFNE 0                          -B2
     C                     Z-ADDPNDPOP    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDDPOP
     C                     ELSE
     C                     MOVEL*BLANKS   DDDPOP
     C                     END                             -E2
      *
      * CONVERT AND SET DATE PORTFOLIO CLOSED
     C           PNDPCL    IFNE 0                          -B2
     C                     Z-ADDPNDPCL    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDDPCL
     C                     ELSE
     C                     MOVEL*BLANKS   DDDPCL
     C                     END                             -E2
      *
      * CONVERT AND SET PLEDGE START DATE
     C           PNPDGS    IFNE 0                          -B2
     C                     Z-ADDPNPDGS    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDPDGS
     C                     ELSE
     C                     MOVEL*BLANKS   DDPDGS
     C                     END                             -E2
      *
      * CONVERT AND SET PLEDGE FINISH DATE
     C           PNPDGF    IFNE 0                          -B2
     C                     Z-ADDPNPDGF    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDPDGF
     C                     ELSE
     C                     MOVEL*BLANKS   DDPDGF
     C                     END                             -E2
     C*                                                                   CAC003
     C** If Analytical Accounting and Switchable Feature are              CAC003
     C** available;                                                       CAC003
     C           *IN21     IFEQ '1'                                       CAC003
     C                     MOVE PNPRFC    DDPRFC                          CAC003
     C                     ENDIF                                          CAC003
      *
      * CONVERT AND SET NEXT VALUATION DATE
     C           PNVLND    IFNE 0                          -B2
     C                     Z-ADDPNVLND    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDVLND
     C                     ELSE
     C                     MOVEL*BLANKS   DDVLND
     C                     END                             -E2
      *
      * CONVERT AND SET NEXT CASHFLOW REPORT DATE
     C           PNCASN    IFNE 0                          -B2
     C                     Z-ADDPNCASN    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDCASN
     C                     ELSE
     C                     MOVEL*BLANKS   DDCASN
     C                     END                             -E2
      *
      **ACCESS*PMBIPNPP*BY*BANK*INVESTMENT*POLICY*CODE                    S01486
      * ACCESS PMBIPNPD BY BANK INVESTMENT POLICY CODE                    S01486
      *
     C           PNPOLC    IFNE *BLANKS                    -B2
     C                     MOVELPNPOLC    @POLC                           S01486
     C                     CALL 'AOBIPNR0'                                S01486
     C                     PARM '*DBERR ' @RTCD                           S01486
     C                     PARM '*KEY   ' @OPTN                           S01486
     C                     PARM           @POLC   2                       S01486
     C           PMBIPN    PARM PMBIPN    DSFDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C********** PNPOLC    CHAINPMBIPNPP             73                   S01486
      *
      * DATABASE ERROR
     C********** *IN73     IFEQ '1'                        -B3************S01486
     C**********           MOVEL'PMBIPNPP'QMFILE           * DBERROR 03  *S01486
     C                     MOVEL'PMBIPNPD'QMFILE           * DBERROR 03  *S01486
     C                     MOVEL'PNPOLC'  QMKEY            ***************
     C                     Z-ADD3         QMERRN
     C                     EXSR *PSSR
     C                     END                             -E3
     C                     MOVELPSPOLN    DDPOLN
     C                     ELSE                            -X2
     C                     MOVE *BLANKS   DDPOLN
     C                     END                             -E2
     C*
     C           PNIPIN    IFEQ 'Y'                        -B2
     C           PNCYIN    OREQ 'Y'
     C           PNYPIN    OREQ 'Y'
     C           PNNPIN    OREQ 'Y'
     C                     MOVE 'Y'       DDCIPD
     C                     ELSE
     C                     MOVE 'N'       DDCIPD
     C                     END                             -E2
     C                     MOVELQMRUNA    DDRUNA
     C                     MOVELPNCNUM    DDCNUM
     C                     MOVELQMCRNM    DDCRNM
     C                     MOVELQMPTF1    DDPTF1
     C                     MOVELQMPTFN    DDPTFN
     C                     MOVELPNPTCY    DDPTCY
     C                     MOVELPNPTFT    DDPTFT
     C                     MOVELPNMNGI    DDMNGI
     C                     MOVELPNVLFQ    DDVLFQ
     C                     MOVELPNVLDM    DDVLDM
     C****                 MOVELPNAAD1    DDAAD1                          S01313
     C****                 MOVELPNAAD2    DDAAD2                          S01313
     C****                 MOVELPNAAD3    DDAAD3                          S01313
     C****                 MOVELPNAAD4    DDAAD4                          S01313
     C****                 MOVELPNAAD5    DDAAD5                          S01313
     C                     MOVELPNS1VR    DDS1VR                          S01313
     C                     MOVELPNS2VR    DDS2VR
     C                     MOVELPNS3VR    DDS3VR
     C                     MOVELPNS4VR    DDS4VR
     C                     MOVELPNS5VR    DDS5VR
     C                     MOVELPNS6VR    DDS6VR
     C                     MOVELPNS7VR    DDS7VR                          S01313
     C                     MOVELPNS8VR    DDS8VR                          S01313
     C                     MOVELPNS9VR    DDS9VR                          CPM005
     C                     MOVELPNS0VR    DDS0VR                          CPM005
     C                     MOVELPNRPYP    DDRPYP                          S01313
     C                     MOVELPNTYSM    DDTYSM                          S01313
     C                     MOVELPNADPP    DDADPP                          S01313
     C                     MOVELPNPMNG    DDPMNG                          S01313
     C                     MOVELQMSCCD    DDSECO                          CPM005
      *
      * CONVERT AND SET PERFORMANCE START DATE
     C           PNPSDT    IFNE 0
     C           PNPSDT    ANDNE99999
     C                     Z-ADDPNPSDT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDPSDT
     C                     ELSE
     C                     MOVEL*BLANKS   DDPSDT
     C                     END
     C                     MOVELPNCASF    DDCASF
     C                     MOVELPNPOLC    DDPOLC
      *
     C                     END
     C                     EXFMTPM0720F1
      *
     C                     ENDSR                           **P01 ENDSR*
      *
     C********************************************************************
      /EJECT
      **************************************************************************
     C           #P02      BEGSR                           **P02 BSR**
      *
     C           WWORK2    IFEQ *BLANK
     C                     MOVEL'Y'       WWORK2
     C                     MOVE *LOVAL    WWCGSQ
      *
      **SET*ON*PMCHRGPP                                                   S01486
      * SET ON PMCHRGPD                                                   S01486
     C********** LIST2     SETLLPMCHRGPP                                  S01486
     C**********           READ PMCHRGPP                 76               S01486
     C           LIST2     SETLLPMCHRGPD                                  S01486
     C                     READ PMCHRGPD                 76               S01486
      *
      * DETAILS FOR SAME CUSTOMER AND PORTFOLIO
     C           QMCNUM    DOWEQPOCNUM                     - B1
     C           WWPTF1    ANDEQPOPTFR
     C           *IN76     ANDEQ'0'                                       CPM005
      *
      * CHARGE EFFECTIVE INDICATOR = C
     C           POCGEI    IFEQ 'C'                        - B2
     C                     MOVELPOCGCO    WWCGCO
     C                     MOVELPOCGSP    WWCGSP
     C                     MOVELPOCGSI    WWCGSI
     C                     MOVE 'C'       WWCGEI
     C                     END                             - E2
      *
      * CHARGE EFFECTIVE INDICATOR = N AND CHARGE CODE START PERIOD NOT BLANK
     C           POCGEI    IFEQ 'N'                        - B2
     C           POCCSP    ANDNE*BLANKS
     C                     MOVELPOCCSP    WWCGCO
     C                     MOVELPOCSSP    WWCGSP
     C                     MOVELPOCISP    WWCGSI
     C                     MOVE 'C'       WWCGEI
     C                     END                             - E2
      *
      * CHARGE EFFECTIVE INDICATOR = N AND CHARGE CODE START PERIOD BLANK
     C           POCGEI    IFEQ 'N'
     C           POCCSP    ANDEQ*BLANKS                    - B2
     C                     MOVELPOCGCO    WWCGCO
     C                     MOVELPOCGSP    WWCGSP
     C                     MOVELPOCGSI    WWCGSI
     C                     MOVE 'N'       WWCGEI
     C                     END                             - E2
      *
      * CHARGE CODE NOT BLANK
     C           WWCGCO    IFNE *BLANKS                    - B2
     C********** LIST3     CHAINPMCGCDPP             75                   S01486
     C           LIST3     CHAINPMCGCDPD             75                   S01486
     C                     END                             - E2
      *
      * DATABASE ERRORS
     C           *IN75     IFEQ '1'                        - B2***********
     C**********           MOVEL'PMCGDPP' QMFILE            * DBERROR 04 *S01486
     C                     MOVEL'PMCGCDPD'QMFILE            * DBERROR 04 *S01486
     C                     MOVEL'LIST3'   QMKEY             **************
     C                     Z-ADD4         QMERRN
     C                     EXSR *PSSR
     C                     END                             - E2
      *
     C                     MOVE *BLANKS   DDCGSP
     C                     MOVE *BLANKS   DDCGSS
      *
      * CHARGE BASIS FLAT
     C           P5CGBS    IFEQ 'F'                        - B2
     C           WWCGSP    ANDNE0
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVE WWCGSP    ZFIELD
     C                     Z-ADDPNBCGD    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDCGSP
     C                     MOVE WWCGSI    DDCGSS
     C                     END                             - E2
      *
      * CHARGE BASIS PERCENTAGE
     C           P5CGBS    IFEQ 'P'                        - B2
     C           WWCGSP    ANDNE0
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVE WWCGSP    ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    DDCGSP
     C                     MOVE WWCGSI    DDCGSS
     C                     END                             - E2
      *
     C           WWCGSP    IFEQ 0
     C                     MOVE *BLANKS   DDCGSP
     C                     END
     C*
     C                     MOVELQMRUNA    DDRUNA
     C                     MOVELPOCGFQ    DDCGFQ
     C           POCGDY    IFEQ 0
     C                     MOVE *BLANKS   DDCGDY
     C                     ELSE
     C                     MOVELPOCGDY    DDCGDY
     C                     END
     C                     Z-ADDPOCGND    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    DDCGND
     C                     MOVELPOCGST    DDCGST
     C                     MOVELPOCSFQ    DDCSFQ
     C                     MOVELPOCSDY    DDCSDY
     C                     Z-ADDPOCSND    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    DDCSND
     C*                                                                   CAC003
     C** If Analytical Accounting and Switchable Feature are              CAC003
     C** available;                                                       CAC003
     C           *IN21     IFEQ '1'                                       CAC003
     C                     MOVE POPFRC    DDPFR2                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     MOVELQMCNUM    DDCNUM
     C                     MOVELQMCRNM    DDCRNM
     C                     MOVELQMPTF1    DDPTF1
     C                     MOVELQMPTFN    DDPTFN
     C                     MOVELPNBCGY    DDBCGY
     C                     MOVELPNCSCY    DDCSCY
     C                     MOVELPNCUSA    DDCUSA
     C                     MOVELPOCGCO    DDCGCO
     C                     MOVELPOCGEI    DDCGEI
     C**
     C**
     C                     WRITEPM0720E2
     C                     ADD  1         RRN
     C*********************MOVE '0'       *IN65
     C**
     C**********           READ PMCHRGPP                 76               S01486
     C                     READ PMCHRGPD                 76               S01486
     C**
     C                     END                             - E1
     C**
     C           RRN       IFEQ 1                                         R10014
     C                     MOVELPNBCGY    DDBCGY                          R10014
     C                     MOVELPNCSCY    DDCSCY                          R10014
     C                     MOVELPNCUSA    DDCUSA                          R10014
     C                     MOVE *BLANK    DDCGCO                          R10014
     C                     MOVE *BLANK    DDCGSP                          R10014
     C                     MOVE *BLANK    DDCGSS                          R10014
     C                     MOVE *BLANK    DDCGEI                          R10014
     C                     MOVE *BLANK    DDCGFQ                          R10014
     C                     MOVE *BLANK    DDCGDY                          R10014
     C                     MOVE *BLANK    DDCGND                          R10014
     C                     MOVE *BLANK    DDCGST                          R10014
     C                     MOVE *BLANK    DDCSFQ                          R10014
     C                     MOVE *BLANK    DDCSDY                          R10014
     C                     MOVE *BLANK    DDCSND                          R10014
     C*                                                                   CAC003
     C** If Analytical Accounting and Switchable Feature are              CAC003
     C** available;                                                       CAC003
     C           *IN21     IFEQ '1'                                       CAC003
     C                     MOVE *BLANK    DDPFR2                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     WRITEPM0720E2                                  R10014
     C                     ADD  1         RRN                             R10014
     C                     END                                            R10014
     C**
     C                     END                             - E1
     C**
     C                     WRITEPM0720F3
     C                     EXFMTPM0720F2
     C**
     C                     ENDSR                           **P02 ENDSR*
     C********************************************************************
      /EJECT
      **************************************************************************
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO ZDEND2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C                     MOVELZDAY      ZWRK4   40
     C                     MOVE ZDAY      ZWRK4
     C                     MOVE ZMTH      ZWRK4
     C                     MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C**
     C********************************************************************
      /EJECT
      **************************************************************************
     C           ZEDIT     BEGSR                           ***  ZEDIT  ***
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**                                                                 *
     C*       SET UP WORK FIELDS                                         *
     C*                                                                  *
     C                     MOVEA' '       ZA1                            *
     C                     MOVEA' '       ZA2                            *
     C*                                                                  *
     C                     Z-ADD16        Z1      20                     *
     C                     Z-ADD16        Z2      20                     *
     C*                                                                  *
     C           16        SUB  ZADEC     ZADEC2  20                     *
     C*                                                                  *
     C*
     C                     MOVEAZFIELD    ZA1                            *
     C*                                                                  *
     C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES               *
     C*                                                                  *
     C           ZADEC     COMP 0                        91              *
     C   91                GOTO ZT20                                     *
     C**                                                                 *
     C           ZT10      TAG                             ** ZT10 TAG ***
     C**                                                                 *
     C*                                                                  *
     C*       SET UP DECIMALS                                            *
     C*                                                                  *
     C                     MOVE ZA1,Z1    ZA2,Z2                         *
     C           Z1        SUB  1         Z1                             *
     C           Z2        SUB  1         Z2                             *
     C*                                                                  *
     C           Z2        COMP 0                        90              *
     C   90                GOTO ZT30                                     *
     C*                                                                  *
     C*       CHECK IF END OF DECIMALS                                   *
     C**                                                                 *
     C           Z2        COMP ZADEC2               90                  *
     C   90                GOTO ZT10                                     *
     C*                                                                  *
     C**                                                                 *
     C*       PUT IN DECIMAL PLACE                                       *
     C*                                                                  *
     C                     MOVE '.'       ZA2,Z2                         *
     C           Z2        SUB  1         Z2                             *
     C*                                                                  *
     C           ZT20      TAG                             ** ZT20 TAG ***
     C*                                                                  *
     C*       SET UP INTEGERS                                            *
     C*                                                                  *
     C                     MOVE ZA1,Z1    ZA2,Z2                         *
     C           Z1        SUB  1         Z1                             *
     C           Z2        SUB  1         Z2                             *
     C**                                                                 *
     C           Z2        COMP 0                    90                  *
     C   90                GOTO ZT20                                     *
     C*                                                                  *
     C*       PUT IN LEADING BLANKS                                      *
     C*                                                                  *
     C           ZT30      TAG                             ** ZT30 TAG ***
     C**                                                                 *
     C                     Z-ADD1         Z2                             *
     C**                                                                 *
     C           ZT40      TAG                             ** ZT40 TAG ***
     C*                                                                  *
     C           ZA2,Z2    COMP '0'                  9090                *
     C   90      ZA2,Z2    COMP ' '                  9090                *
     C*                                                                  *
     C   90                GOTO ZT50                                     *
     C*                                                                  *
     C                     MOVE ' '       ZA2,Z2                         *
     C           Z2        ADD  1         Z2                             *
     C*                                                                  *
     C           Z2        COMP 16                     90                *
     C   90                GOTO ZT40                                     *
     C*                                                                  *
     C*       IF NO INTEGERS PUT IN LEADING ZERO                         *
     C*                                                                  *
     C           ZT50      TAG                             ** ZT50 TAG ***
     C*                                                                  *
     C                     Z-ADDZADEC2    Z2                             *
     C  N91      Z2        SUB  1         Z2                             *
     C           ZA2,Z2    COMP ' '                      90              *
     C   90                MOVE '0'       ZA2,Z2                         *
     C*                                                                  *
     C*       SET UP OUTPUT FIELD                                        *
     C*                                                                  *
     C           ZT60      TAG                             ** ZT60 TAG ***
     C*                                                                  *
     C                     MOVEAZA2       ZFIELD 16                      *
     C**                                                                 *
     CSR         ZEND      ENDSR                           ** ZEND **    *
     C**
     C*================================================================
     C           *PSSR     BEGSR                           **PSSR**
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C                     MOVEL'PM0720'  QMPGM
     C**
     C***UPDATE *GDA                                                      S01486
     C** UPDATE *LDA                                                      S01486
     C**
     C**********           CALL 'PMC1002'                                 S01486
     C**********           PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C**
     C                     DUMP
     C**
     C                     RETRN
     C**
     C                     ENDSR                                    **PSSR ENDSR
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
