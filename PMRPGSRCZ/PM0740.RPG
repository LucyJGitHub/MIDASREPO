     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Customer summary details enquiry')            *
      *****************************************************************
      *                                                               *
      *  Midas - Portfolio Management Module                          *
      *                                                               *
      *  PM0740 - Customer Summary Details Enquiry                    *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CER071             Date 01Aug16               *
      *                 CER070             Date 19Aug14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 CER045             Date 20Jul09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 166009             Date 20Aug99               *
      *                 131150             Date 03Mar98               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM005             DATE 17JUN96               *
      *                 S01124             DATE 15JUN94               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CER071 - BAIS - Legal Form field (Recompile)                 *
      *  CER070 - BuBa Reporting / BAIS V.1.16.0 (Recompile)          *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER045 - German Features - Reporting Bundesbank (Recompile)  *
      *  CRE026 - Consumer Banking                                    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  166009 - Birth date not translated correctly.                *
      *  131150 - Access correspondance file for language info as this*
      *           is not part of SDCUSTPD anymore.                    *
      *  CPM005 - Private Banking Phase 2                             *
      *           Focus Group Changes upgraded to DBA                 *
      *  S01124 - PBFG/6 - ADDITIONAL CUSTOMER DETAILS                *
      *                                                               *
      *****************************************************************
     F***SDBANKL1IF  E           K        DISK         KINFSR *PSSR       CPM005
     F***SDPLCSL1IF  E           K        DISK         KINFSR *PSSR       CPM005
     F***SDCUSTL1IF  E           K        DISK         KINFSR *PSSR       CPM005
     F***SDCUSTY0IF  E           K        DISK         KINFSR *PSSR       CPM005
     F*                                                                   CPM005
     F**  Customer Service Fees Details - E6                              CPM005
     FSDCFCDL0IF  E           K        DISK         KINFSR *PSSR          CPM005
     F*                                                                   CPM005
     F* Additional customer details update.                               CPM005
     FSDACUSL0IF  E           K        DISK         KINFSR *PSSR          CPM005
     F***SDALTNL2IF  E           K        DISK         KINFSR *PSSR       CPM005
     F***PMCSNPPPIF  E           K        DISK         KINFSR *PSSR      UCPM005
     FPMCSNPPDIF  E           K        DISK         KINFSR *PSSR      UC  CPM005
     FCGCORRL4IF  E           K        DISK                               131150
     F***PM0740DDCF  E                    WORKSTN      KINFSR *PSSR       CPM005
     FPM0740DFCF  E                    WORKSTN      KINFSR *PSSR          CPM005
     F                                        DDRRN KSFILE PM0740S0
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       03         EXIT                    (PF3)                 N
     F*       12         PREVIOUS SCREEN        (PF12)                 N
     F*
     F*       25         ROLLUP
     F*
     F*       43         CLEAR SUBFILE DEATAILS
     F*       44         ROLLUP BEYOND END OF SUBFILE - CUSTOMER SFL
     F*       49         VLDCMDKY
     F*
     F********80         FILE OPERATIONS INDICATOR - SDBANKL1             CPM005
     F********81         FILE OPERATIONS INDICATOR - SDPLCSL1             CPM005
     F********82         FILE OPERATIONS INDICATOR - SDCUSTL1             CPM005
     F********83         FILE OPERATIONS INDICATOR - PMCSNPPP             CPM005
     F*       83         FILE OPERATIONS INDICATOR - PMCSNPPD             CPM005
     F********84         FILE OPERATIONS INDICATOR - SDCUSTY0             CPM005
     F********85         FILE OPERATIONS INDICATOR - SDALTNL2             CPM005
     F********87         FILE OPERATIONS INDICATOR - PM0740DD             CPM005
     F*       87         FILE OPERATIONS INDICATOR - PM0740DF             CPM005
     F*
     F*       98         DATE FORMAT = MMDDYY
     F*       99         WORK
     F*
     F*                Unused indicators
     F*                -----------------
     F*       01  02  ..  04  05  06  07  08  09  10
     F*       11  ..  13  14  15  16  17  18  19  20
     F*       21  22  23  24  ..  26  27  28  29  30
     F*       31  32  33  34  35  36  37  38  39  40
     F*       41  42  ..  ..  45  46  47  48  ..  50
     F*       51  52  53  54  55  56  57  58  59  60
     F*       61  62  63  64  65  66  67  68  69  70
     F*       71  72  73  74  75  76  77  78  79  ..
     F*       ..  ..  ..  ..  ..  86  ..  88  89  90
     F*       91  92  93  94  95  96  97  ..  ..
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F*       'WWAID' VALUES USED
     F*
     F*       03         F3
     F*       12         F12
     F*       RA         ENTER PRESSED
     F*       UP         ROLLUP
     F*       DN         ROLLDOWN
     F*****************************************************************
      /EJECT
     E*****************************************************************
     E**********          ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYCPM005
     E**********          ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYCPM005
     E**********          ZMNM   12  12  3               ZDATE2 SR. ARRAY CPM005
      *                                                                   CPM005
      ** ARRAY FOR ZDATE SUBROUTINE                                       CPM005
      /COPY ZSRSRC,ZDATE2Z1                                               CPM005
     E*
     E                    CPY@    1   1 80
     E*****************************************************************
      /EJECT
     I*****************************************************************
     I*
     I***PGMDS*****ESDSY2PGDSP                                            CPM005
     I**Program*data*structure.                                           CPM005
     I*
     I** EXTERNAL FORMAT FOR GROUP DATA AREA
     I*
     I***WWGDA     E DSPMGRDAPP                                           CPM005
     I*
     I***WWLDA     E DSPMLDAPP                                            CPM005
     IWWLDA     E DSPMLDAPD                                               CPM005
     I*                                                                   CPM005
     IPSDS       SDS                                                      CPM005
     I                                      244 253 WKSTN                 CPM005
     I                                      254 263 USER                  CPM005
     I*                                                                   CPM005
     ISDBANK    E DSSDBANKPD                                              CPM005
      ** Data Structure for Bank Details Access Program                   CPM005
      *                                                                   CPM005
     ISDALTN    E DSSDALTNPD                                              CPM005
      ** Data structure for alternate name and addresses                  CPM005
      *                                                                   CPM005
     ISDPLCS    E DSSDPLCSPD                                              CPM005
      *                                                                   CPM005
      ** SD Portfolio Management Customer Details                         CPM005
     ISDCUST    E DSSDCUSTPD                                              CPM005
      *                                                                   CPM005
      ** SD Customer Details                                              CPM005
     ISCSARD    E DSSCSARDPD                                              CPM005
      ** Data Structure for SAR's File                                    CPM005
      *                                                                   CPM005
     IDSFDY     E DSDSFDY                                                 CPM005
      ** Short Data Structure for Access Programs                         CPM005
      *                                                                   CPM005
     IDSSDY     E DSDSSDY                                                 CPM005
      ** Long Data Structure for Access Programs                          CPM005
      *                                                                   CPM005
     I** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     -                                                       *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P01     - FORMAT SCREEN DETAILS                                 *
      * #P02     - FORMAT CUSTOMER NOTEPAD DETAILS                       *
      * #P03     - DISPLAY CUSTOMET NOTEPAD DETAILS                      *
      * #ENDG    - WRITE DETAILS TO *GDA AND END GROUP JOBS              *
      * #SFLC    - FILL CUSTOMER SUBFILE                                 *
      * #VCMD    - VALIDATE COMMAND KEYS                                 *
      * *PSSR    - FILE ERROR HANDLING                                   *
      *                                                                  *
      ********************************************************************
     C*
     C**  DEFINE KEYS
     C*
     C           WWKEYC    KLIST
     C**********           KFLD           WWCNUM  60                                          CSD027
     C                     KFLD           WWCNUM  6                                           CSD027
     C                     KFLD           DDRRN
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *  P R O G R A M     S T A R T
      ********************************************************************
     C           *ENTRY    PLIST                                          CPM005
     C                     PARM           #PGM   10                       CPM005
     C*
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR #INIT
     C*
     C** FORMAT SCREEN DETAILS
     C*
     C                     EXSR #P01
     C*
     C** FORMAT NOTEPAD DETAILS
     C*
     C                     EXSR #P02
     C*
     C** PROCESS NOTEPAD SCREEN
     C*
     C                     EXSR #P03
     C*
     C** EXIT
     C*
     C                     EXSR #ENDG
     C*
     C** TERMINATE PROGRAM
     C*
     C                     RETRN
     C*
      ********************************************************************
      *  P R O G R A M     E N D
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - FILE ERROR HANDLING                                   *
      * PMC1010  - RETRIEVE DATA FROM *GDA                               *
      * #ENDG    - WRITE DETAILS TO *GDA AND END GROUP JOBS              *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      ********************************************************************
     C           #INIT     BEGSR                           ** #INIT BSR **
     C*
     C                     MOVE '0'       *IN
     C                     MOVE '0'       *INKL
     C**
     C** GET DATA FROM GROUP DATA AREA
     C*
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
     C                     MOVELQMRUNA    DDRUNA
     C                     MOVELQMCNUM    DDCNUM
     C                     MOVELQMCNUM    WWCNUM
     C                     MOVELQMCSSN    DDCSSN
     C                     MOVELQMCCID    DDCCID
     C                     MOVELQMDCMS    DDDCMS
     C*
     C           QMDCMS    IFEQ 'I'
     C                     MOVE '1'       *IN22
     C                     ELSE
     C                     MOVE '0'       *IN22
     C                     END
     C*
     C                     MOVELQMJAID    DDJAID
     C                     MOVELQMPAID    DDPAID
     C                     MOVELQMREID    DDREID
     C*
     C                     MOVELQMACOC    DDACOC
     C                     MOVELQMACON    DDACON
     C                     MOVELQMLANG    DDLANL
     C                     MOVELQMNCTX    DDNCTX
     C                     MOVELQMDCTX    DDDCTX
     C**********           MOVEL##JOB     WSID                            CPM005
     C*
     C** GET INSTALLATION CONTROL DATA RECORD 1
     C*
     C********** *LOVAL    SETLLSDBANKL1                                  CPM005
     C**********           READ SDBANKL1                 80               CPM005
     C                     CALL 'AOBANKR0'                                CPM005
     C                     PARM *BLANKS   WRTCD   7                       CPM005
     C                     PARM '*FIRST ' WOPTN   7                       CPM005
     C           SDBANK    PARM SDBANK    DSFDY                           CPM005
     C*                                                                   CPM005
     C********** *IN80     IFEQ '1'                                       CPM005
     C           WRTCD     IFNE *BLANKS                    ***************CPM005
     C                     Z-ADD1         QMERRN           **DB ERROR 01**
     C                     MOVE 'SDBANKPD'QMFILE           ***************CPM005
     C**********           MOVEL'SDBANKL1'QMFILE                          CPM005
     C                     MOVE *BLANKS   QMKEY
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF FOUND CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
     C*
     C           BJDFIN    IFEQ 'M'                        MMDDYY, 98 ON
     C                     MOVE '1'       *IN98
     C                     END
     C*                                                                   CPM005
     C** ACCESS SAR FILE TO CHECK "CUSTOMER SERVICE FEES"                 CPM005
     C*                                                                   CPM005
     C                     MOVEL'S01423'  WSARD   6                       CPM005
     C                     CALL 'AOSARDR0'                                CPM005
     C                     PARM *BLANKS   WRTCD                           CPM005
     C                     PARM '*VERIFY' WOPTN                           CPM005
     C                     PARM           WSARD                           CPM005
     C           SCSARD    PARM SCSARD    DSFDY                           CPM005
     C*                                                                   CPM005
     C           WRTCD     IFEQ *BLANKS                                   CPM005
     C                     MOVEL'Y'       WWSFEE  1                       CPM005
     C                     ELSE                                           CPM005
     C                     MOVEL'N'       WWSFEE                          CPM005
     C                     END                                            CPM005
     C*                                                                   CPM005
     C** ACCESS SAR FILE TO CHECK "ADDITIONAL CUSTOMER DETAILS"           CPM005
     C*                                                                   CPM005
     C                     MOVEL'S01425'  WSARD                           CPM005
     C                     CALL 'AOSARDR0'                                CPM005
     C                     PARM *BLANKS   WRTCD                           CPM005
     C                     PARM '*VERIFY' WOPTN                           CPM005
     C                     PARM           WSARD                           CPM005
     C           SCSARD    PARM SCSARD    DSFDY                           CPM005
     C*                                                                   CPM005
     C           WRTCD     IFEQ *BLANKS                                   CPM005
     C                     MOVEL'Y'       WWACUD  1                       CPM005
     C                     ELSE                                           CPM005
     C                     MOVEL'N'       WWACUD                          CPM005
     C                     END                                            CPM005
     C*
     C           E#INIT    ENDSR                           ** #INIT ESR **
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P01     - FORMAT SCREEN DETAILS                                 *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P01      BEGSR                           ** #P01  BSR **
     C**********                                                          CPM005
     C**ACCESS*FILE*SDCUSTY0*TO*RETRIEVE*CUSTOMER*DETAILS                 CPM005
     C**********                                                          CPM005
     C**********           MOVE QMCNUM    KCUST                           CPM005
     C********** KCUST     CHAINSDCUSTY0             84                   CPM005
     C********** *IN84     IFEQ '1'                        B1             CPM005
     C**********           Z-ADD3         QMERRN           **DB ERROR 03**CPM005
     C**********           MOVEL'SDCUSTY0'QMFILE                          CPM005
     C**********           MOVE *BLANKS   QMKEY                           CPM005
     C**********           EXSR *PSSR                                     CPM005
     C**********           END                             E1             CPM005
     C                     MOVE QMCNUM    KCUST   6                       CPM005
     C*                                                                   CPM005
     C                     MOVE '1'       *IN70                           CPM005
     C                     MOVE '1'       *IN71                           CPM005
     C*                                                                   CPM005
     C* ACCESS FILE CUSTOMER FEES DETAILS TO RETRIEVE HOLD MAIL INDICATOR CPM005
     C* IF NO RECORD FOUND, SET HOLD MAIL INDICATOR TO 'N'                CPM005
     C*
     C                     MOVEL'N'       DDHLDM                          CPM005
     C                     MOVEL'N'       DDNRAC                          CPM005
     C*                                                                   CPM005
     C           WWSFEE    IFEQ 'Y'                        B*1            CPM005
     C           KCUST     CHAINSDCFCDL0             70                   CPM005
     C*                                                                   CPM005
     C           *IN70     IFEQ '0'                        B*2            CPM005
     C                     MOVELE6HMIN    DDHLDM                          CPM005
     C                     MOVELE6NAIN    DDNRAC                          CPM005
     C                     END                             E*2            CPM005
     C                     END                             E*1            CPM005
     C*                                                                   CPM005
     C* ACCESS FILE ADDITIONNAL CUSTOMER DETAILS TO RETRIEVE DATE OF LAST CPM005
     C* VISIT, FAX NUMBER, TELEX NUMBER.                                  CPM005
     C* IF NO RECORD FOUND, SET THEM TO *BLANKS                           CPM005
     C*                                                                   CPM005
     C                     MOVE *BLANKS   DDLVIS                          CPM005
     C                     MOVE *BLANKS   DDFAXN                          CPM005
     C                     MOVE *BLANKS   DDTLXN                          CPM005
     C*                                                                   CPM005
     C           WWACUD    IFEQ 'Y'                        B*1            CPM005
     C           KCUST     CHAINSDACUSL0             71                   CPM005
     C*                                                                   CPM005
     C           *IN71     IFEQ '0'                        B*2            CPM005
     C                     Z-ADDE5DOLV    ZDAYNO                          CPM005
     C                     EXSR ZDATE2                                    CPM005
     C                     MOVELZADATE    DDLVIS                          CPM005
     C*                                                                   CPM005
     C                     MOVE E5FXNB    DDFAXN                          CPM005
     C                     MOVE E5TXNB    DDTLXN                          CPM005
     C                     END                             E*2            CPM005
     C                     END                             E*1            CPM005
     C*                                                                   CPM005
     C*
     C**********           MOVE CUNRAC    DDNRAC                          CPM005
     C*
     C**********           MOVE CULVIS    ZDAYNO                          CPM005
     C**********           EXSR ZDATE2                                    CPM005
     C**********           MOVELZADATE    DDLVIS                          CPM005
     C*
     C**********           MOVE CUHLDM    DDHLDM                          CPM005
     C**********           MOVE CUFAXN    DDFAXN                          CPM005
     C**********           MOVE CUTLXN    DDTLXN                          CPM005
     C*
     C*  SETUP THE 'CONTACT STATUS'
     C*
     C                     MOVELQMCRNM    DDCRNM
     C**                                                                         166009
     C           QMBDA1    IFEQ *BLANKS                    *IF                   166009
     C                     MOVEL*BLANKS   DDBRTH           Date of Birth         166009
     C                     ELSE                                                  166009
     C                     MOVELQMBDA1    DDBRTH
     C                     END                             *FI                   166009
     C*
     C           QMJAID    IFEQ 'N'                        B1
     C           QMPAID    ANDEQ'N'
     C                     MOVE 'Y'       DDACHO
     C                     MOVE 'Y'       DDPOWA
     C                     MOVE 'I'       DDSIGN
     C                     MOVE 'Y'       DDVECO
     C                     MOVE 'Y'       DDWRCO
     C                     MOVE 'Y'       DDDOCO
     C                     MOVEL*BLANKS   DDUSID
     C                     ELSE                            X1
     C           QMACHD    IFEQ *BLANKS                    B2
     C           QMPATT    ANDEQ*BLANKS
     C           QMSIGN    ANDEQ*BLANKS
     C           QMCVER    ANDEQ*BLANKS
     C           QMWRIT    ANDEQ*BLANKS
     C                     MOVE '?'       DDACHO
     C                     MOVE '?'       DDPOWA
     C                     MOVE '?'       DDSIGN
     C                     MOVE '?'       DDVECO
     C                     MOVE '?'       DDWRCO
     C                     MOVE '?'       DDDOCO
     C                     MOVEL'?'       DDUSID
     C                     ELSE                            X2
     C                     MOVE QMACHD    DDACHO
     C                     MOVE QMPATT    DDPOWA
     C                     MOVE QMSIGN    DDSIGN
     C                     MOVE QMCVER    DDVECO
     C                     MOVE QMWRIT    DDWRCO
     C                     MOVE QMDOCU    DDDOCO
     C                     MOVE QMUSID    DDUSID
     C                     END                             E2
     C                     END                             E1
     C*
     C* ACCESS FILE SDALTNL2 TO RETRIEVE ALTERNATE ADDRESSES DETAILS
     C*
     C                     MOVE QMCNUM    KCUST
     C********** KCUST     CHAINSDALTNL2             85                   CPM005
     C                     CALL 'AOALTNR0'                                CPM005
     C                     PARM '*MSG   ' WRTCD                           CPM005
     C                     PARM '*KEYFST' WOPTN                           CPM005
     C                     PARM KCUST     @CUST   6                       CPM005
     C                     PARM *LOVAL    @ADCD   1                       CPM005
     C           SDALTN    PARM SDALTN    DSFDY                           CPM005
     C************IN85     IFEQ '1'                        B1             CPM005
     C           WRTCD     IFNE *BLANKS                                   CPM005
     C                     MOVE 'N'       DDALTN
     C                     ELSE                            X1
     C                     MOVE 'Y'       DDALTN
     C                     END                             E1
     C*
     C* ACCESS FILE SDCUSTL1 TO RETRIEVE CUSTOMER DETAILS
     C*
     C**********           MOVE QMCNUM    KCUST   6                       CPM005
     C********** KCUST     CHAINSDCUSTL1             82                   CPM005
      *                                                                   CPM005
     C                     MOVELQMCNUM    PLCUST 10                       CPM005
     C                     CALL 'AOCUSTR0'                                CPM005
     C                     PARM *BLANKS   WRTCD                           CPM005
     C                     PARM '*KEY   ' WOPTN                           CPM005
     C                     PARM           PLCUST                          CPM005
     C                     PARM *BLANKS   WKSTS   7                       CPM005
     C           SDCUST    PARM SDCUST    DSSDY                           CPM005
     C*                                                                   CPM005
     C           WRTCD     IFNE *BLANKS                    B1             CPM005
     C********** *IN82     IFEQ '1'                        B1             CPM005
     C                     Z-ADD4         QMERRN           **DB ERROR 04**
     C                     MOVEL'SDCUSTL1'QMFILE
     C                     MOVE *BLANKS   QMKEY
     C                     EXSR *PSSR
     C                     END                             E1
     C*
     C                     MOVE BBDOIC    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDDOIC
     C*
     C                     MOVE BBCNCZ    DDCNCZ
     C                     MOVE BBCOLC    DDCOLC
     C                     MOVE BBCNA1    DDCNA1
     C                     MOVE BBCNA2    DDCNA2
     C                     MOVE BBCNA3    DDCNA3
     C                     MOVE BBCNA4    DDCNA4
     C                     MOVE BBCTNB    DDCTNB
     C*                                                                   CPM005
     C* THERE IS NO ALTERNATIVE TO THE LANGUAGE FIELD (BBLANG) ON THE     CPM005
     C* CUSTOMER FILE. THIS WAS USED IN REL. 3 FOR MULTILANGUAGE REPORTS. CPM005
     C* THIS FACILITY IS NOT IN RELEASE 10. THEREFORE, DEFAULT TO 'GB'.   CPM005
     C*                                                                   CPM005
     C**********           MOVE BBLANG    DDLANC                          CPM005
     C***********          MOVE 'GB'      DDLANC                   CPM005 131150
     C** Access Customer Correspondance info for language code            131150
     C           KCUST     CHAINCGCORRL4             70                   131150
     C           *IN70     IFEQ '0'                                       131150
     C                     MOVE CDLGID    DDLANC                          131150
     C                     ELSE                                           131150
     C                     MOVE 'XX'      DDLANC                          131150
     C                     END                                            131150
     C**                                                                  131150
     C*
     C* ACCESS FILE SDPLCSL1 TO RETRIEVE PM CUSTOMER DETAILS
     C*
     C********** BBCSSN    CHAINSDPLCSL1             81                   CPM005
     C                     MOVELBBCSSN    WCNUM  10                       CPM005
     C                     CALL 'AOPLCSR0'                                CPM005
     C                     PARM *BLANKS   WRTCD                           CPM005
     C                     PARM '*KEY   ' WOPTN                           CPM005
     C                     PARM           WCNUM                           CPM005
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM005
     C********** *IN81     IFEQ '1'                        B1             CPM005
     C           WRTCD     IFNE *BLANKS                    B1             CPM005
     C                     Z-ADD2         QMERRN           **DB ERROR 02**
     C                     MOVEL'SDPLCSL1'QMFILE
     C                     MOVE *BLANKS   QMKEY
     C                     EXSR *PSSR
     C                     END                             E1
     C*
     C           QBSECO    IFNE *BLANKS
     C                     MOVE QBSECO    DDSECO
     C                     MOVE '1'       *IN21
     C                     ELSE
     C                     MOVE *BLANKS   DDSECO
     C                     MOVE '0'       *IN21
     C                     END
     C*                                                                   CPM005
     C           #PGM      IFEQ 'PM0620'                                  CPM005
     C           #PGM      OREQ 'PM0630'                                  CPM005
     C                     MOVE '1'       *IN23                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN23                           CPM005
     C                     END                                            CPM005
     C*
     C           E#P01     ENDSR                           ** #P01  ESR **
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P02     - FORMAT NOTEPAD DETAILS                                *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #SFLC    - FILL SUBFILE                                          *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      ********************************************************************
     C           #P02      BEGSR                           ** #P02  BSR **
     C*
     C** INITIALIZE SCREEN
     C*
     C                     WRITEPM0740F0
     C*
     C** INITIALIZE SUBFILE
     C*
     C                     Z-ADD1         DDRRN
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN81
     C                     WRITEPM0740C0
     C                     MOVE '1'       *IN80
     C*
     C** ACCESS FILE RECORD
     C*
     C**********           OPEN PMCSNPPP                                  CPM005
     C********** WWCNUM    CHAINPMCSNPPP             84                   CPM005
     C                     OPEN PMCSNPPD                                  CPM005
     C           WWCNUM    CHAINPMCSNPPD             84                   CPM005
     C*
     C** FILL SUBFILE
     C*
     C                     EXSR #SFLC
     C*
     C           E#P02     ENDSR                           ** #P02   ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P03     - PROCESS PM NOTEPAD SCREEN                             *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #VCMD    - VALIDATE COMMAND KEYS                                 *
      * #SFLC    - FILL CUSTOMERO SUBFILE                                *
      * PMC1010  - RETRIEVE DATA FROM *GDA                               *
      * #ENDG    - WRITE DETAILS TO *GDA AND END GROUP JOBS              *
      * PM0165   - CUSTOMER DOCUMENTATION MAINTENANCE                    *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      ********************************************************************
     C           #P03      BEGSR                           ** #P03   BSR**
     C*
     C** DISPLAY TITLE AND CUSTOMER NOTEPAD HEADER
     C*
     C                     MOVE 'RA'      WWAID
     C                     MOVE *BLANKS   DDSELE
     C*
     C** D O   U N T I L   F 3   O R   F 1 2   T A K E N
     C*
     C           WWAID     DOUEQ'03'                       B1
     C           WWAID     OREQ '12'
     C*
     C                     MOVE ' '       QMENQT
     C**********           CALL 'PMC1002'                                 CPM005
     C**********           PARM           WWGDA                           CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C*
     C                     MOVE *BLANKS   DDSELE                          CPM005
     C                     WRITEPM0740F1
     C                     Z-ADD1         DDRRN
     C                     EXFMTPM0740C0
      *                                                                   CPM005
     C                     MOVE '0'       *IN82                           CPM005
     C*
     C** COMMAND KEYS
     C*
     C                     EXSR #VCMD
      *                                                                   CPM005
     C           DDSELE    IFNE 'C'                                       CPM005
     C           DDSELE    ANDNE'D'                                       CPM005
     C           DDSELE    ANDNE'J'                                       CPM005
     C           DDSELE    ANDNE'M'                                       CPM005
     C           DDSELE    ANDNE'N'                                       CPM005
     C           DDSELE    ANDNE'P'                                       CPM005
     C           DDSELE    ANDNE'R'                                       CPM005
     C           DDSELE    ANDNE'V'                                       CPM005
     C           DDSELE    ANDNE'A'                                       CPM005
     C           DDSELE    ANDNE' '                                       CPM005
     C                     MOVEL'1'       *IN82                           CPM005
     C                     ELSE                                           CPM005
     C*
     C** 'ENTER'
     C*
     C           WWAID     IFEQ 'RA'                       B2
     C           DDSELE    ANDEQ*BLANKS
     C           #PGM      ANDEQ'PM0620'                                  CPM005
     C           WWAID     OREQ 'RA'                                      CPM005
     C           DDSELE    ANDEQ*BLANKS                                   CPM005
     C           #PGM      ANDEQ'PM0630'                                  CPM005
     C*****                MOVE ' '       QMENQT
     C                     LEAVE
     C                     END                             E2
     C*
     C** ROLL UP WITH CURSOR ON CUSTOMER SUBFILE
     C*
     C           WWAID     IFEQ 'UC'                       B2
     C********** WWCNUM    READEPMCSNPPP                 84               CPM005
     C           WWCNUM    READEPMCSNPPD                 84               CPM005
     C                     EXSR #SFLC
     C                     END                             E2
     C*
     C** SELECTION 'A'
     C*
     C           DDSELE    IFEQ 'A'                        B2
     C                     CALL 'PM0710'
     C                     PARM 'A'       WALT    1
     C                     END                             E2
     C*
     C** SELECTION 'C'
     C*
     C           DDSELE    IFEQ 'C'                        B2
     C                     CALL 'PM3130'
     C                     END                             E2
     C*
     C** SELECTION 'D'
     C*
     C           DDSELE    IFEQ 'D'                        B2
     C                     CALL 'PM0165'
     C                     END                             E2
     C*
     C** SELECTION 'J'
     C*
     C           DDSELE    IFEQ 'J'                        B2
     C                     CALL 'PM3110'
     C                     END                             E2
     C*
     C** SELECTION 'M'
     C*
     C           DDSELE    IFEQ 'M'                        B2
     C                     CALL 'PM0710'
     C                     PARM *BLANKS   WFIELD  2
     C                     END                             E2
     C*
     C** SELECTION 'N'
     C*
     C           DDSELE    IFEQ 'N'                        B2
     C**********           CLOSEPMCSNPPP                                  CPM005
     C                     CLOSEPMCSNPPD                                  CPM005
     C                     CALL 'PMC0602'
     C                     EXSR #P02
     C                     END                             E2
     C*
     C** SELECTION 'P'
     C*
     C           DDSELE    IFEQ 'P'                        B2
     C                     CALL 'PM3120'
     C                     END                             E2
     C*
     C** SELECTION 'R'
     C*
     C           DDSELE    IFEQ 'R'                        B2
     C                     CALL 'PM3100'
     C                     END                             E2
     C*
     C** SELECTION 'V'
     C*
     C           DDSELE    IFEQ 'V'                        B2
     C**********           CALL 'PMC0822'                                 CPM005
     C                     CALL 'FCC0201'                                 CPM005
     C                     PARM 'PMC0950' WWCOMP 10                       CPM005
     C                     PARM '10001'   WWSEQ   5                       CPM005
     C                     PARM 'PM0950'  WWPRGM 10                       CPM005
     C                     PARM 'B'       WWBRCH  1                       CPM005
     C                     END                             E2
     C*
     C** GET DATA FROM GROUP DATA AREA
     C*
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
     C**********                                                          CPM005
     C***GET*DATA FROM *GDA                                               CPM005
     C**********                                                          CPM005
     C**********           CALL 'PMC1004'                                 CPM005
     C**********           PARM           WWGDA                           CPM005
     C*
     C           QMENQT    IFEQ ' '                        B2
     C           DDSELE    IFEQ 'J'                        B3
     C           DDSELE    OREQ 'P'
     C           DDPAID    IFNE 'N'                        B4
     C           DDJAID    ORNE 'N'
     C           QMACHD    IFNE *BLANKS                    B5
     C           QMPATT    ORNE *BLANKS
     C           QMSIGN    ORNE *BLANKS
     C           QMCVER    ORNE *BLANKS
     C           QMWRIT    ORNE *BLANKS
     C           QMBDA1    ORNE *BLANKS
     C           QMCRNM    ORNE *BLANKS
     C                     MOVE QMACHD    DDACHO
     C                     MOVE QMPATT    DDPOWA
     C                     MOVE QMSIGN    DDSIGN
     C                     MOVE QMCVER    DDVECO
     C                     MOVE QMWRIT    DDWRCO
     C                     MOVE QMDOCU    DDDOCO
     C                     MOVE QMUSID    DDUSID
     C                     END                             E5
     C                     END                             E4
     C                     END                             E3
     C                     END                             E2
     C                     END                                            CPM005
     C*
     C** F3 TAKEN FROM PM3100 / PM3110 / PM3120 / PM3130 / PM0165 / PM0710 /
     C*                PMC602 / PMC0821
     C*
     C           QMENQT    IFEQ 'Y'                        B2
     C                     MOVEL'03'      WWAID
     C                     END                             E2
     C*
     C                     END                             E1
     C*
     C           E#P03     ENDSR                           ** #P03   ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #ENDG    - WRITE DETAILS TO *GDA AND END GROUP JOBS              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P03     - PROCESS NOTEPAD SCREEN                                *
      *                                                                  *
      ********************************************************************
     C           #ENDG     BEGSR                           ** #ENDG  BSR**
     C*
     C**********           CLOSEPMCSNPPP                                  CPM005
     C                     CLOSEPMCSNPPD                                  CPM005
     C*
     C           WWAID     IFEQ '03'
     C                     MOVE 'Y'       QMENQT
     C                     END
     C           WWAID     IFEQ '12'
     C                     MOVE 'P'       QMENQT
     C                     END
     C*
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**********           CALL 'PMC1002'                                 CPM005
     C**********           PARM           WWGDA                           CPM005
     C*
     C                     MOVE *ON       *INLR
     C*
     C                     ENDSR                           ** #ENDG  ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #SFLC    - FILL SUBFILE                                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P01     - FORMAT NOTEPAD DETAILS                                *
      * #P03     - PROCESS NOTEPAD SCREEN                                *
      *                                                                  *
      ********************************************************************
     C           #SFLC     BEGSR                           ** #SFLC  BSR**
     C*
     C*
     C** INITIALIZE RECORD NUMBER
     C*
     C                     Z-ADD1         DDRRN
     C*
     C** FILL SUBFILE
     C*
     C           *IN84     DOWEQ'0'                        B1
     C                     MOVE *BLANKS   DDNTPD
     C*
     C           DDRRN     IFEQ PRNOTS                     B2
     C           PRRECI    ANDEQ'D'
     C                     MOVELPRNTPD    DDNTPD
     C                     END                             E2
     C*
     C                     WRITEPM0740S0
     C                     ADD  1         DDRRN      81
     C*
     C           DDRRN     IFGT PRNOTS                     B2
     C********** WWCNUM    READEPMCSNPPP                 84               CPM005
     C           WWCNUM    READEPMCSNPPD                 84               CPM005
     C                     END                             E2
     C*
     C                     END                             E1
     C*
     C           E#SFLC    ENDSR                           ** #SFLC  ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #VCMD    - VALIDATE COMMAND KEYS                                 *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P03     - PROCESS PM NOTEPAD SCREEN                             *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAID    -                                                       *
      *                                                                  *
      ********************************************************************
     C           #VCMD     BEGSR                           ** #VCMD  BSR **
     C*
     C** If ENTER pressed, the VLDCMDKEY indicator will be off
     C*
     C           *IN49     IFEQ '0'
     C                     MOVE 'RA'      WWAID   2
     C                     END
     C*
     C** If F3
     C*
     C           *INKC     IFEQ '1'
     C                     MOVE '03'      WWAID
     C                     MOVE '0'       *INKC
     C                     END
     C*
     C** If F12
     C*
     C           *INKL     IFEQ '1'
     C                     MOVE '12'      WWAID
     C                     MOVE '0'       *INKL
     C                     END
     C*
     C** If ROLLUP pressed
     C*
     C           *IN25     IFEQ '1'
     C                     MOVE 'UC'      WWAID
     C                     MOVE '0'       *IN25
     C                     END
     C*
     C                     ENDSR                           ** #VCMD  ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - FILE ERROR HANDLING                                   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PMC1000  - WRITE DETAILS TO *GDA                                 *
      **PMC1020**-*END*GROUP*JOBS*****************************************CPM005
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P01     - FORMAT CUSTOMER NOTEPAD DETAILS                       *
      * #P02     - FORMAT PORTFOLIO NOTEPAD DETAILS                      *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR                            ** *PSSR BSR**
     C*
     C**********           CLOSEPMCSNPPP                                  CPM005
     C                     CLOSEPMCSNPPD                                  CPM005
     C*
     C                     MOVE 'Y'       QMENQT
     C                     MOVE 'Y'       QMDBER
     C                     MOVE 'PM0740'  QMPGM
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**********           CALL 'PMC1002'                                 CPM005
     C**********           PARM           WWGDA                           CPM005
     C                     RETRN
     C*
     C                     ENDSR                            ** *PSSR ESR**
     C********************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2                                               CPM005
      /EJECT                                                              CPM005
     C********************************************************************CPM005
     C**********                                                          CPM005
     C*****ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.            CPM005
     C**********                                                          CPM005
     C*****THE*YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.         CPM005
     C**********                                                          CPM005
     C********** ZDATE2    BEGSR                           *** ZDATE2 *** CPM005
     C**********                                                          CPM005
     C*****CLEAR LEAP YEAR WORK FIELD.                                    CPM005
     C**********           MOVE 'N'       ZLEAP   1                       CPM005
     C**********                                                          CPM005
     C*****CLEAR DATE FIELDS.                                             CPM005
     C**********           Z-ADD0         ZDATE   60                      CPM005
     C**********           MOVEL'       ' ZADATE  7                       CPM005
     C**********                                                          CPM005
     C*****CALCULATION TO DEFINE INPUT DAY NUMBER.                        CPM005
     C**********           Z-ADDZDAYNO    ZDAYNO  50                      CPM005
     C**********                                                          CPM005
     C*****DETERMINE YEAR NUMBER.                                         CPM005
     C**********                                                          CPM005
     C*****ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.                    CPM005
     C********** ZDAYNO    SUB  1         ZDAYN1  50                      CPM005
     C********** ZDAYN1    IFLT 0                                         CPM005
     C**********           GOTO ZDEND2                                    CPM005
     C**********           END                                            CPM005
     C**********                                                          CPM005
     C*****CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.             CPM005
     C********** ZDAYN1    DIV  1461      ZLYR    20                      CPM005
     C**********           MVR            ZDAYN1           SAVE REMAINING CPM005
     C**********                                           DAYS           CPM005
     C*****CALCULATE NUMBER OF REMAINING YEARS.                           CPM005
     C**********           Z-ADD1         ZWRK2   20                      CPM005
     C********** ZDTAG1    TAG                             ** ZDTAG1 TAG *CPM005
     C********** ZDAYN1    IFGE ZYDY,ZWRK2                                CPM005
     C********** ZWRK2     ADD  1         ZWRK2                           CPM005
     C**********           GOTO ZDTAG1                                    CPM005
     C**********           END                                            CPM005
     C**********                                                          CPM005
     C********** ZWRK2     SUB  1         ZWRK2                           CPM005
     C**********                                                          CPM005
     C*****DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.                  CPM005
     C********** ZWRK2     IFNE 0                                         CPM005
     C********** ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                          CPM005
     C**********           END                                            CPM005
     C**********                                                          CPM005
     C*****CALCULATE ACTUAL YEAR NUMBER.                                  CPM005
     C********** ZLYR      MULT 4         ZWRK3   30                      CPM005
     C********** ZWRK3     ADD  72        ZWRK3            BASE IS 1972   CPM005
     C**********           Z-ADDZWRK3     ZYEAR   20                      CPM005
     C********** ZYEAR     ADD  ZWRK2     ZYEAR            YEAR           CPM005
     C**********                                                          CPM005
     C*****DETERMINE MONTH NUMBER.                                        CPM005
     C**********                                                          CPM005
     C*****ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.         CPM005
     C********** ZWRK2     IFEQ 0                                         CPM005
     C********** ZDAYN1    IFEQ 59                                        CPM005
     C**********           MOVE 'Y'       ZLEAP                           CPM005
     C**********           END                                            CPM005
     C********** ZDAYN1    IFGE 59                                        CPM005
     C********** ZDAYN1    SUB  1         ZDAYN1                          CPM005
     C**********           END                                            CPM005
     C**********           END                                            CPM005
     C**********                                                          CPM005
     C*****CALCULATE MONTH NUMBER.                                        CPM005
     C**********           Z-ADD2         ZWRK2                           CPM005
     C********** ZDTAG2    TAG                             ** ZDTAG2 TAG *CPM005
     C********** ZDAYN1    IFGE ZMDY,ZWRK2                                CPM005
     C********** ZWRK2     ADD  1         ZWRK2                           CPM005
     C**********           GOTO ZDTAG2                                    CPM005
     C**********           END                                            CPM005
     C**********                                                          CPM005
     C********** ZWRK2     SUB  1         ZWRK2                           CPM005
     C**********                                                          CPM005
     C**********           Z-ADDZWRK2     ZMTH    20       MONTH          CPM005
     C**********                                                          CPM005
     C*****DETERMINE DAY OF MONTH.                                        CPM005
     C**********                                                          CPM005
     C*****ADD BACK LAST DAY OF YEAR ADJUSTMENT.                          CPM005
     C********** ZDAYN1    ADD  1         ZDAYN1                          CPM005
     C**********                                                          CPM005
     C*****CALCULATE DAY OF MONTH.                                        CPM005
     C********** ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY            CPM005
     C**********                                                          CPM005
     C*****ADD*BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.       CPM005
     C********** ZLEAP     IFEQ 'Y'                                       CPM005
     C********** ZDAY      ADD  1         ZDAY                            CPM005
     C**********           END                                            CPM005
     C**********                                                          CPM005
     C*****FORMAT DATE, DDMMYY OR MMDDYY.                                 CPM005
     C**N98*****           MOVELZDAY      ZWRK4   40                      CPM005
     C***98*****           MOVE ZDAY      ZWRK4                           CPM005
     C**N98*****           MOVE ZMTH      ZWRK4                           CPM005
     C***98*****           MOVELZMTH      ZWRK4                           CPM005
     C**********           MOVELZWRK4     ZDATE                           CPM005
     C**********           MOVE ZYEAR     ZDATE                           CPM005
     C**********                                                          CPM005
     C*****FORMAT ALPHA DATE, DDMMMYY.                                    CPM005
     C**********           MOVELZDAY      ZWRK5   5                       CPM005
     C********** ZDAY      IFLT 10                                        CPM005
     C**********           MOVEL' '       ZWRK5                           CPM005
     C**********           END                                            CPM005
     C**********           MOVE ZMNM,ZMTH ZWRK5                           CPM005
     C**********           MOVELZWRK5     ZADATE                          CPM005
     C**********           MOVE ZYEAR     ZADATE                          CPM005
     C**********                                                          CPM005
     C********** ZDEND2    ENDSR                           * ZDEND2 ENDSR*CPM005
     C**********                                                          CPM005
     C**********                                                          CPM005
     C********************************************************************
      /EJECT
     C********************************************************************
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Finastra International Limited 2001
