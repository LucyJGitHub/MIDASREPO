     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Update Historic Turnover')                    *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module.                     *
     F*                                                               *
     F*  RPG/PM0940 - UPDATE HISTORIC TURNOVER                        *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 BUG23967           Date 14May09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01486             Date 05JUL94               *
     F*                 33615              Date 01JUL91               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
     F*  BUG23967 - Add Local Industry Code Field.                    *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*  33615  - OUTPUT INSTRUMENT DISPLAY GROUP TO FILE             *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F** PREFIX : BJ
     F**SDBANKPDIF  E           K        DISK         KINFSR *PSSR        S01486
     F***********                                   KINFSR *PSSR          S01486
     F** PREFIX : SC
     F**PMCHTVPPIF  E           K        DISK                             S01486
     FPMCHTVPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** PREFIX : QJ
     F**PMHITVPPUF  E           K        DISK                      A      S01486
     FPMHITVPDUF  E           K        DISK                      A        S01486
     F                                              KINFSR *PSSR
     F** PREFIX : RR
     FPM0940AUO   E                    PRINTER
     F                                              KINFSR *PSSR
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F********80*********FILE OPERATIONS INDICATOR - SDBANKL1             S01486
     F********81*********FILE OPERATIONS INDICATOR - PMCHTVPP             S01486
     F********82*********FILE OPERATIONS INDICATOR - PMHITVPP             S01486
     F*       81         FILE OPERATIONS INDICATOR - PMCHTVPD             S01486
     F*       82         FILE OPERATIONS INDICATOR - PMHITVPD             S01486
     F*
     F*                Unused indicators
     F*                -----------------
     F*       01  02  03  04  05  06  07  08  09  10
     F*       11  12  13  14  15  16  17  18  19  20
     F*       21  22  23  24  25  26  27  28  29  30
     F*       31  32  33  34  35  36  37  38  39  40
     F*       41  42  43  44  45  46  47  48  49  50
     F*       51  52  53  54  55  56  57  58  59  60
     F*       61  62  63  64  65  66  67  68  69  70
     F*       71  72  73  74  75  76  77  78  79  ..
     F*       ..  ..  83  84  85  86  87  88  89  90
     F*       91  92  93  94  95  96  97  98  99
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     E*=========================================================================
     E*
     E** ARRAY FOR COPYRIGHT
     E*
     E                    CPY@    1   1 80
     I*
     I** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     ISDBANK    E DSSDBANKPD                                              S01486
     I** EXTERNAL DS FOR BANK DETAILS                                     S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     I*                                                                   S01486
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     I****LDA********UDS****************************256                   S01486
     I***************************************32 183 DBLOT                 S01486
     I**************************************132 141 DBFILE                S01486
     ILDA         DS                            256                       S01486
     I                                      134 183 DBLOT                 S01486
     I                                      134 141 DBFILE                S01486
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      **#U01*****- UPDATE TURNOVER RECORD ON PF/PMHITVPP                 *S01486
      **#W01*****- WRITE NEW TURNOVER RECORD TO PMHITVPP                 *S01486
      * #U01     - UPDATE TURNOVER RECORD ON PF/PMHITVPD                 *S01486
      * #W01     - WRITE NEW TURNOVER RECORD TO PMHITVPD                 *S01486
      * *PSSR    - STANDARD ERROR PROCESSING ROUTINE                     *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      *                                                                  *
      ********************************************************************
     C*
     C***DEFINE*KEY*FOR*CHAINING TO PMHITVPP                              S01486
     C** DEFINE KEY FOR CHAINING TO PMHITVPD                              S01486
     C*
     C           WWKEY1    KLIST
     C                     KFLD           SCCNUM
     C                     KFLD           SCPTFR
     C                     KFLD           SCINNR
     C                     KFLD           SCICCY
     C**********           KFLD           SCLIND                                            BUG23967
     C                     KFLD           SCLOIC                                            BUG23967
     C                     KFLD           SCYRNO
     C                     KFLD           SCMTHN
     C*                                                                        *
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
     C                     Z-ADD0         RRNREC
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL*BLANK    DBLOT                           S01486
     C                     MOVEL'PM0940'  DBPGM
     C                     OUT  LDA                                       S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL'SDBANKPD'DBFILE           ***************S01486
     C                     Z-ADD1         DBASE            * DBERROR  01 *S01486
     C                     MOVEL@OPTN     DBKEY            ***************S01486
     C                     MOVEL@OPTN     DBOPTN  7                       S01486
     C                     OUT  LDA                                       S01486
     C***********          READ SDBANKL1                 80               S01486
     C*
     C************IN80     IFEQ '1'                        ***************S01486
     C***********          Z-ADD1         DBASE            **DB ERROR 01**S01486
     C***********          MOVEL'SDBANKPD'DBFILE           ***************S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C** READ FIRST CHANGED RECORD
     C*
     C***********          READ PMCHTVPP                 81               S01486
     C                     READ PMCHTVPD                 81               S01486
     C*
     C***IF*ANY*CHANGED*RECORDS*FOUND*UPDATE PF/PMHITVPP                  S01486
     C** IF ANY CHANGED RECORDS FOUND UPDATE PF/PMHITVPD                  S01486
     C*
     C           *IN81     DOWEQ'0'
     C           WWKEY1    CHAINPMHITVP0             82
     C*
     C***IF*RECORD*ALREADY*ON PF/PMHITVPP ADD AMOUNTS TO THAT             S01486
     C** IF RECORD ALREADY ON PF/PMHITVPD ADD AMOUNTS TO THAT             S01486
     C** RECORD
     C*
     C           *IN82     IFEQ '0'
     C                     EXSR #U01
     C*
     C***OTHERWISE*WRITE*A*NEW*RECORD TO PF/PMHITVPP                      S01486
     C** OTHERWISE WRITE A NEW RECORD TO PF/PMHITVPD                      S01486
     C*
     C                     ELSE
     C                     EXSR #W01
     C                     END
     C*
     C***********          READ PMCHTVPP                 81               S01486
     C                     READ PMCHTVPD                 81               S01486
     C                     END
     C*
     C** PRINT AUDIT REPORT
     C*
     C                     WRITEPM0940A0
     C*
     C** TERMINATE PROGRAM
     C*
     C                     MOVE '1'       *INLR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      **#U01*****-*UPDATE*TURNOVER RECORD ON PF/PMHITVPP                 *S01486
      * #U01     - UPDATE TURNOVER RECORD ON PF/PMHITVPD                 *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #U01      BEGSR                           * #U01   BSR *
     C*
     C                     ADD  SCTNVR    QJTNVR
     C                     ADD  SCTNVF    QJTNVF
     C                     ADD  SCNUCO    QJNUCO
     C                     UPDATPMHITVP0
     C*
     C                     ENDSR                           * #U01   ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      **#W0******-*WRITE*NEW*TURNOVER RECORD TO PMHITVPP                 *S01486
      * #W01     - WRITE NEW TURNOVER RECORD TO PMHITVPD                 *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #W01      BEGSR                           * #W01   BSR *
     C*
     C                     MOVE 'D'       QJRECI
     C                     MOVE SCCNUM    QJCNUM
     C                     MOVE SCPTFR    QJPTFR
     C                     MOVE SCINNR    QJINNR
     C                     MOVE SCDSPG    QJDSPG                          33615
     C                     MOVE SCICCY    QJICCY
     C**********           MOVE SCLIND    QJLIND                                            BUG23967
     C                     MOVE SCLOIC    QJLOIC                                            BUG23967
     C                     MOVE SCYRNO    QJYRNO
     C                     MOVE SCMTHN    QJMTHN
     C                     Z-ADDSCTNVR    QJTNVR
     C                     Z-ADDSCTNVF    QJTNVF
     C                     Z-ADDSCNUCO    QJNUCO
     C                     WRITEPMHITVP0
     C                     ADD  1         RRNREC
     C*
     C                     ENDSR                           * #W01   ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - STANDARD ERROR PROCESSING ROUTINE                     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR                            ** *PSRR BSR**
     C*
     C** ROLL BACK CHANGES , DUMP AND RETURN TO THE CALLING PROGRAM
     C*
     C           @RUN      IFEQ *BLANK                                    S01486
     C                     MOVE 'Y'       @RUN    1                       S01486
     C                     WRITEPM0940A0                                  S01486
     C***********          SETON                     LRU7U8               S01486
     C                     SETON                     U7U8                 S01486
     C                     WRITEERRORAU                                   S01486
     C                     END                                            S01486
     C                     DUMP
     C                     SETON                         LR               S01486
     C                     RETRN
     C*
     C                     ENDSR                            ** *PSRR ESR**
**  CPY@
(c) Finastra International Limited 2001
