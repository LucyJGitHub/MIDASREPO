     H        1
      *****************************************************************
/*OVR *: OVRDBF FILE(SDPLCSPT) TOFILE(SDPLCSL0)                     : *   S01486
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Process customer status change')              *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                                 *
     F*                                                               *
     F*  PM1030 - PROCESS CUSTOMER STATUS CHANGE                      *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CDL096             Date 22Sep14               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183          Date 20Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CSW212             Date 03May12               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE143             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER048             Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 22Sep06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CSE071             Date 19Jul05               *
      *                 CAS009             Date 16May05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CAS008             Date 16Jun06               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CGL014             Date 20Oct03               *
      *                 CLE025             Date 20Oct03               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 222727             Date 05Nov03               *
      *                 CAP074             Date 08Aug02               *
      *                 194370             Date 12Jul01               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      *                 CDL010             Date 02Aug02               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 180707             Date 25Jul00               *
      *                 CAS002             Date 14Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 12Jul00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 178439             Date 02May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE012             Date 16Aug99               *
      *                 CPB001             Date 12Jul99               *
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      * Midas DBA 3.01 Patch E ---------------------------------------*
      *                 170520             Date 19Nov99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPK009             Date 13Aug99               *
     F*                 130862             Date 18Oct98               *
     F*                 CPM005             Date 14Nov96               *
     F*                 CFF004             Date 02Oct96               *
     F*                 CPM003             DATE 02MAY96               *
     F*                 S71062             DATE 25JAN96               *
     F*                 S01408             DATE 01APR96               *
     F*                 101190             DATE 01MAR96               *
     F*                 092961             DATE 04OCT95               *
     F*                 S01496             DATE 14NOV94               *
     F*                 S01486             DATE 06JUL94               *
     F*                 049213             DATE 05MAY93               *
     F*                 049421             DATE 22JAN93               *
     F*                 51939              DATE 19OCT93               *
     F*                 61488      MF      DATE 01OCT93               *
     F*                 61228      MF      DATE 23SEP93               *
     F*                 61063              DATE 24SEP93               *
     F*                 59512              DATE 13AUG93               *
     F*                 38430              DATE 13AUG93               *
     F*                 58933              DATE 02AUG93               *
     F*                 58879              DATE 15JUL93               *
     F*                 S01313                                        *
     F*                 47719              DATE 19JAN93               *
     F*                 49213              DATE 05JAN93               *
     F*                 41644      MF      DATE 15JUL92               *
     F*                 42635              DATE 17JUL92               *
     F*                 034679             DATE 17JAN92               *
     F*                 B8920              DATE 27JUN91               *
     F*                 R1048_DW           DATE 26SEP90               *
     F*                 R10049             DATE 26SEP90               *
     F*                 EMFIX              DATE 10SEP90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CSW212 - SWIFT 2012 Changes (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate (Recompile)                                    *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CAS008 - IAS 39 Enhancements (Recompile)                     *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CGL014 - Collaterals Processing (Recompile)                  *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it. Recompile due to changes in         *
      *           FXDEALPP, MMDELDPP, MMDENBPP AND MMDENSPP.          *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  CAS002 - Hedge Strategy/Linkage (Recompile)                  *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CSE023 - Treaty Withholding Tax (Recompiled)                 *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
     F*  178439 - Incorrect processing of Walkin and Walkout when     *
     F*           CSE015 present.                                     *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
     F*  CPB001 -  'Private Banking' Module                           *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
      *  170520 - Recompile over changed TRANSD file                  *
     F*  CPK009 - Recompile problem found at DBA R3.00 packaging.     *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  CPM005 - Private Banking Phase 2  - Recompile only           *
     F*           Focus Group Changes upgraded to DBA                 *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
     F*  CPM003 - FF/PM Interface upgrade to Release 10               *
     F*  S71062 - FF/PM interface                                     *
     F*           Re-activate FF coding                               *
     F*  S01408 - Addition of core hook PM1030CCP3                    *
     F*         - Addition of core hook PM1030CCP2                    *
     F*         - Addition of core hook PM1030CCP1                    *
     F*         - Addition of core hook PM1030OOP1                    *
     F*         - Addition of core hook PM1030FFP2                    *
     F*         - Addition of core hook PM1030FFP1                    *
     F*  101190 - Portfolio Ref. is being changed to 9997 on Insert,  *
     F*           when not blank.                                     *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  S01496 - Incorporation of Jyske Enhancements (S10978)        *
     F*  S01486 - Private Banking upgrade to Release 10               *
     F*  049213 - RECOMPILE OVER NEW VERSION OF SR/ZFXAVP             *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  51939  - CORRECT TAKEON OF SE POSITIONS                      *
     F*  61488  - INCLUDE PORTFOLIO REFERENCE IN FXDEALPP             *
     F*           AND MMDELDPP                                        *
     F*  61228  - BYPAS ZYIELD CALL MATURED SECURITY                  *
     F*           EM FIX ADDED MANY TIMES IN PROGRAM |                *
     F*  61063  - SET PERFORMANCE REQUIRED INDICATOR TO 'N'           *
     F*  59512  - WRONG POSITION IF A TRADE IS DELETED AND ANOTHER ONE*
     F*           ENTERED THE SAMR WAY                                *
     F*  38430  - ENHANCEMENTS TO CUSTOMER INSERTION / DELETION       *
     F*  58933  - REMOVE FRA/IRS TRANSACTIONS FROM PROGRAM            *
     F*  58879  - FILE INCORRECT FOR USE WHEN DELETING PORTFOLIO CUST *
     F*  S01313 - RECOMPILE DUE TO PORTFOLIO PERFORMANCE              *
     F*  47719  - USE EXTERNAL SUBROUTINES ZCCYCN AND ZCCYXR INSTEAD  *
     F*           OF INCORRECT ONCE INTERNALLY DESCRIBED.             *
     F*  49213  - RECOMPILE OVER NEW VERSION OF SR/ZFXAVP             *
     F*  41644  - MARKET PRICE WRONG (DUE TO DIVISIONS).              *
     F*  42635  - DISCREPANCY BETWEEN PGM AND DDS                     *
     F*  034679 - REMOVE PORTFOLIO REFERENCE FROM MATURED AND         *
     F*           HISTORIC POSITIONS                                  *
     F*  B8920  - CALCULATE YIELD WHEN TAKING ON POSITIONS            *
     F*  R1048  - Delete physical record flaged in "PM".              *
     F*  R10049 - Changes required for FX Rates on Depot movements.   *
     F*****************************************************************
     FPM1030AUO   E                    PRINTER
     F                                              KINFSR *PSSR
     F***SDBANKL1IF**E           K        DISK                            S01486
     F****Prefix*BJ****************************************************   S01486
     F***********                                   KINFSR *PSSR          S01486
     F***SDPORTPDIF**E           K        DISK                            S01486
     F****Prefix*P9****************************************************   S01486
     F***********                                   KINFSR *PSSR          S01486
     F***SDSTRDL1IF**E           K        DISK                            S01486
     F****Prefix*BV****************************************************   S01486
     F***********                                   KINFSR *PSSR          S01486
     F***PMCPOSZZUF**E           K        DISK                            S01486
     FPMCPOSPAUF  E           K        DISK                               S01486
     F**  Prefix QA
     F                                              KINFSR *PSSR
     F***SDDTSTPPUF**E           K        DISK                      A     S01486
     FFDDTSTL0UF  E           K        DISK                      A        S01486
     F                                              KINFSR *PSSR
     F***SDDTSTZZUF**E           K        DISK                        UC  S01486
     F***********                                   KINFSR *PSSR          S01486
     FSECTY   IF  E           K        DISK
     F                                              KINFSR *PSSR
     FTRADCU  IF  E           K        DISK                               38430
     F            TRADSDF                           KRENAMETRADSDY        38430
     F                                              KINFSR *PSSR          38430
     FHSTTTR  IF  E           K        DISK                               38430
     F            HSTTRDF                           KRENAMEHSTTRDY        38430
     F                                              KINFSR *PSSR          38430
     FTRADC   UF  E           K        DISK                               38430
     F                                              KINFSR *PSSR
     F*CUSDE***UF  E           K        DISK                              38430
     F****        DEALSDAF                          KIGNORE               38430
     F****        DEALSDDF                          KIGNORE               38430
     F****        DEALSDEF                          KIGNORE               38430
     F****        DEALSDFF                          KIGNORE               38430
     F****        DEALSDGF                          KIGNORE               38430
     F***DEALSP4*UF**E           K        DISK                      38430 S01486
     FPMDEALL4UF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     FFXDEALLLUF  E           K        DISK                               61488
     FMMDEALLLUF  E           K        DISK                               61488
     F*DEALSP3*UF**E           K        DISK                        03467938430
     F****        DEALSDBF                          KRENAMEDEALSDB1 03467938430
     F****        DEALSDCF                          KRENAMEDEALSDC1 03467938430
     F****        DEALSDGF                          KRENAMEDEALSDG1 58933 38430
     F****                                          KINFSR *PSSR    03467938430
     FDEPMVC  UF  E           K        DISK
     F                                              KINFSR *PSSR
     F***TRANSC**UF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     FTRANSC  UF  E           K        DISK                           UC  S71062
     F                                              KINFSR *PSSR          S71062
     F***CLOANC**UF**E           K        DISK                            S01486
     FPMCLONL6UF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F****CLOANP3 UF  E           K        DISK                     03467958879
     F****        CLOANCLF                          KRENAMECLOANCL1 03467958879
     F****                                          KINFSR *PSSR    03467958879
     F***CLOANP5*UF**E           K        DISK                      38430 S01486
     FPMCLONL0UF  E           K        DISK                               S01486
     F            CLOANCLF                          KRENAMECLOANCL1       38430
     F                                              KINFSR *PSSR          38430
     FACCNT   UF  E           K        DISK
     F                                              KINFSR *PSSR
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F***FIDEPOL1UF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F***FILOANL4UF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     FCAPRH   UF  E           K        DISK
     F                                              KINFSR *PSSR
     FPMCPSNL0IF  E           K        DISK
     F                                              KINFSR *PSSR
     FPMAPOSLLUF  E           K        DISK                      A
     F**  Prefix QA
     F                                              KINFSR *PSSR
     F***SDPLCSPTUF**E           K        DISK                            S01486
     F*                                                                   S01408
     F/COPY WNCPYSRC,PM1030FFP1                                           S01408
     F*                                                                   S01408
     FSDPLCSPTIF  E           K        DISK                               S01486
     F**  Prefix QB
     F                                              KINFSR *PSSR
     F*                                                                   S01408
     F/COPY WNCPYSRC,PM1030FFP2                                           S01408
     F*                                                                   S01408
     F***SDSECSL0IF**E           K        DISK                      38430 S01486
     F****Prefix*BF*************************************************38430 S01486
     F***********                                   KINFSR *PSSR    38430 S01486
     F***SDCUSTL0IF**E           K        DISK                      38430 S01486
     F****Prefix*BB*************************************************38430 S01486
     F***********                                   KINFSR *PSSR    38430 S01486
     F***POSETC**UF**E           K        DISK                      38430 S01486
     FPMPOSDL0UF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR          38430
     F***PMHSEXPPIF**E           K        DISK                            S01486
     FPMHSEXPDIF  E           K        DISK                               S01486
     F** Prefix 'Q8'
     F                                              KINFSR *PSSR
     F***SDCURRL0IF**E           K        DISK                            S01486
     F***Prefix*'A6'***************************************************   S01486
     F***********                                   KINFSR *PSSR          S01486
     FSEDEV   IF  E           K        DISK
     F                                              KINFSR *PSSR
     FSECEO   IF  E           K        DISK                               S01486
     F            SEDEVDF                           KRENAMESEDEVDO        S01486
     F            SNDEVDF                           KRENAMESNDEVDO        S01486
     F                                              KINFDS FDS1           S01496
     F                                              KINFSR *PSSR          S01486
     FINVTP   IF  E           K        DISK                               B8920
     F                                              KINFSR *PSSR          B8920
     FSECDEPL0UF  E           K        DISK                      A    UC  S01496
     F                                              KINFSR *PSSR          S01496
     FSECDEPL2IF  E           K        DISK                           UC  S01496
     F            CDEPPDF                           KRENAMECDEPPTF        S01496
     F                                              KINFSR *PSSR          S01496
     FCDEPD   UF  E           K        DISK                           UC  S01496
     F            CDEPPDF                           KRENAMECDEPDF         S01496
     F                                              KINFSR *PSSR          S01496
     FSEERALL3UF  E           K        DISK                           UC  S01496
     F**  Prefix VC                                                       S01496
     F                                              KINFSR *PSSR          S01496
     FSEERALL4UF  E           K        DISK                      A    UC  S01496
     F            SEERALD0                          KRENAMESEERALD4       S01496
     F**  Prefix VC                                                       S01496
     F                                              KINFSR *PSSR          S01496
     FSEBLKPL4UF  E           K        DISK                           UC  S01496
     F**  Prefix VD                                                       S01496
     F                                              KINFSR *PSSR          S01496
     FPMPORTPDIF  E           K        DISK                           UC  S01496
     F                                              KINFSR *PSSR          S01496
     FCDEPPA  UF  E                    DISK                           UC  S01496
     F                                              KINFSR *PSSR          S01496
     F*                                                                   S01408
     F/COPY WNCPYSRC,PM1030FFP3                                           S01408
     F*                                                                   S01408
     F*
      /EJECT
     F*================================================================
     F*
     F* ID F  C  H  L    Function of indicators
     F*
     F*                Unused indicators
     F*                -----------------
     F*       ..  ..  ..  ..  ..  ..  07  08  09  10
     F*       11  12  13  14  15  16  17  18  19  20
     F*       21  22  23  24  25  26  27  28  29  30
     F*       31  32  33  34  35  36  37  38  39  40
     F*       41  42  43  44  45  46  47  48  49  50
     F*       51  52  53  54  55  56  57  58  59  60
     F*       61  62  63  64  65  66  67  68  69  70
     F*       ..  ..  ..  ..  75  76  77  78  79  80
     F*       81  82  83  84  85  86  87  88  89  90
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..
     F*
     F*
     F*       U7&U8      Database error
     F*       LR         End of program
     F*
     F*       01         DEALSDBF record id. indicator
     F*       02         DEALSDCF record id. indicator
     F********03*********DEALSDGF*record*id.*indicator*****************   S01486
     F*
     F*       04         DEALSDB1 record id. indicator                    034679
     F*       05         DEALSDC1 record id. indicator                    034679
     F*       06         DEALSDG1 record id. indicator                    034679
     F*
     F*       71         LF/SDPLCSPT read indicator
     F********72*********PF/PMCPOSZZ*read*indicator********************   S01486
     F*       72         PF/PMCPOSPA read indicator                       S01486
     F*       73         General files read indicator
     F*       74         General chain indicator
     F*
     F*       90-99      Standard subroutines indicator
     F*
      /EJECT
     E*================================================================
     E*
     E**   Array for copyright
     E                    CPY@    1   1 80               COPYRIGHT
     E*
     E**   Array for PF/DEALSDC deal types
     E                    DTYPES  9   9  2               DEAL TYPES
     E*
     E                    POR        50  4               Portfolio Ref    S01496
     E*                                                                   S01496
      /COPY ZSRSRC,ZPOWERZ1
      /COPY ZSRSRC,ZPOWER8Z1
      /COPY ZSRSRC,ZDAYSZ1
      /COPY ZSRSRC,ZNCDZ1
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,ZACCRZ0                                                S01486
      /EJECT
     I*================================================================
      ** Rename PLDCPD field in INVTPDF to distinguish it from same       CPK009
      ** named field defined in FDDTSTPD                                  CPK009
      *                                                                   CPK009
     IINVTPDF                                                             CPK009
      * Rename Default pricing group                                      CPK009
     I              PLDPCD                          DEFPRG                CPK009
     ISECTYDF                                                             61228
     I              RECI                            SERECI                61228
     I*
     ITRADSDY
     I              RECI                            WWRECI
     I              ACIN                            WWACIN
     I              ITRA                            WWITRA
     I              CRSK                            SECRSK                                    CAS006
     I*                                                                   38430
     IHSTTRDY                                                             38430
     I              RECI                            WWRECI                38430
     I              ACIN                            WWACIN                38430
     I              ITRA                            WWITRA                38430
     I              CRSK                            SECRSK                                    CAS006
     I*
     ITRADSDF     08                                                      38430
     I              CRSK                            SECRSK                                    CAS006
     IHSTTRDF     09                                                      38430
     I              CRSK                            SECRSK                                    CAS006
     IDEALSDBF    01
     IDEALSDCF    02
     I*DEALSDGF****03                                                     58933
     I*DEALSDB1****04                                               03467938430
     I*DEALSDC1****05                                               03467938430
     ICLOANCLF    06                                                      38430
     ICLOANCZF    07                                                      38430
     I*DEALSDG1****06                                               03467958933
     I*                                                                   S01496
     ICDEPPAF                                                             S01496
     I              TNLU                            XXTNLU                S01496
     I*
     I**   Data structure for compilation - copyright insertion.
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZYLDZ1
     I*
     I*****Data*structure*to*concatenate*last*amendment*date***********   S01486
     I************DS                                                      S01486
     I****************************************1   7 WWDLUP                S01486
     I****************************************1   20P7DLUP                S01486
     I****************************************3   5 P7MLUP                S01486
     I****************************************6   70P7YLUP                S01486
     I*
     I**   Data structure to redifine customer number
     I            DS
     I                                        1   6 QBCUST
     I**********                              1   60WWCUST                                    CSD027
     I                                        1   6 WWCUST                                    CSD027
     I*
     I**   Local data area for database error details
     I***LDA********UDS                            256                    S01486
     I**************************************132 183 DBLOT                 S01486
     I**************************************132 141 DBFILE                S01486
     ILDA         DS                            256                       S01486
     I                                      134 183 DBLOT                 S01486
     I                                      134 141 DBFILE                S01486
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*                                                                   S01496
     I** File status data structure - record format                       S01496
     I*                                                                   S01496
     IFDS1        DS                                                      S01496
     I                                     *RECORD  @FORM                 S01496
     ISDPORT    E DSSDPORTPD                                              S01486
     I**  Portfolio Definition Via Access Program                         S01486
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  External DS for bank details                                    S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Currencies details accessed via access program                  S01486
     I*                                                                   S01486
     ISDSTRD    E DSSDSTRDPD                                              S01486
     I**  Securities Trading Details                                      S01486
     I*                                                                   S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I**  Customers details accessed via access program                   S01486
     I*                                                                   S01486
     ISDSECS    E DSSDSECSPD                                              S01486
     I**  Securities Trading Customers details                            S01486
     I*                                                                   S01486
     ISDMMOD    E DSSDMMODPD                                              S71062
     I**  MIDAS MODULES details                                           S71062
     I*                                                                   S71062
     ISCSARD    E DSSCSARDPD                                              S01486
     I**  External data structure for switchable features detail          S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I**  First DS for access programs, short data structure              S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I** Second DS for access programs, long data structure               S01486
     I*                                                                   S01486
     IDSLDY     E DSDSLDY                                                 CPB001
     I** Third DS for access programs, very long data structure           CPB001
     I*                                                                   CPB001
     I/COPY WNCPYSRC,PM1030I001
      /EJECT
     C*****************************************************************
     C*
     C           *ENTRY    PLIST
     C                     PARM           WWECD   5
     C*
     C**   Key to access deal type/sub-type details
     C           DTKEY     KLIST
     C                     KFLD           DTYP
     C                     KFLD           DLST
     C*
     C**   Key to access trade details
     C           TRKEY     KLIST
     C                     KFLD           WWCUST
     C                     KFLD           WWTRAD
     C*
     C**   Key to access depot movement details
     C           DPKEY     KLIST
     C                     KFLD           WWCUST
     C                     KFLD           WWDEPM
     C*
     C**   Key to access account details
     C           ACKEY     KLIST
     C                     KFLD           WWCUST
     C                     KFLD           WWCCYK
     C                     KFLD           WWACOD
     C                     KFLD           WWACSQ
     C*
     C**   Key to access customer average prices details
     C           CAKEY     KLIST
     C                     KFLD           WWCUST
     C*
     C**   Key to access portfolio security positions details
     C           PMKEY     KLIST
     C                     KFLD           WWCUST
     C*
     C**   Key to access portfolio historic exchange rates
     C           PMHSEX    KLIST
     C                     KFLD           WWCCYH  3
     C                     KFLD           WWPDAT  50
     C*                                                                   B8920
     C* INVESTMENT TYPES                         LF/INVTP                 B8920
     C*                                                                   B8920
     C           KINVT     KLIST                                          B8920
     C                     KFLD           NMCY                            B8920
     C                     KFLD           SITP                            B8920
     C*                                                                   034679
     C* DEALS BY PORTFOLIO                       LF/DEALSP3               034679
     C           KDEAL     KLIST                                          034679
     C**********           KFLD           W1CNUM  60                                   034679 CSD027
     C                     KFLD           W1CNUM  6                                           CSD027
     C                     KFLD           W1PTFR  4                       034679
     C*********************KFLD           W1RECI  1                034679 42635
     C                     KFLD           W1DTYP  2                       42635
     C                     KFLD           W1DLST  2                       42635
     C                     KFLD           W1DLNO  60                      034679
     C*                                                                   034679
     C* DEALS BY PORTFOLIO                       LF/DEALSP3               034679
     C           KDEALE    KLIST                                          034679
     C**********           KFLD           W1CNUM  60                                   034679 CSD027
     C                     KFLD           W1CNUM  6                                           CSD027
     C*                                                                   034679
     C* LOANS BY PORTFOLIO                       LF/CLOANP3               034679
     C***********KLOAN*****KLIST                                                       034679 CLE042
     C*********************KFLD           W1CNUM                                       034679 CLE042
     C*********************KFLD           W1PTFR                   034679 42635
     C*********************KFLD           W1RECI                   034679 42635
     C*********************KFLD           W1LNRF  60               034679 42635
     C*********************KFLD           W1LTYP  2                                    42635 CLE042
     C*********************KFLD           W1SUTP  2                                    42635 CLE042
     C*                                                                   034679
     C* LOANS BY PORTFOLIO                       LF/CLOANP3               034679
     C***********KLOANE****KLIST                                                       034679 CLE042
     C*********************KFLD           W1CNUM                                       034679 CLE042
     C*                                                                   S01496
     C**   Key to access ER Allocations Details                           S01496
     C           KALL1     KLIST                                          S01496
     C**********           KFLD           WWCUST  60                                   S01496 CSD027
     C                     KFLD           WWCUST  6                                           CSD027
     C                     KFLD           WWERRF  6                       S01496
     C                     KFLD           WWBRCD  3                       S01496
     C**********           KFLD           WWDDPT  60                                   S01496 CSD027
     C                     KFLD           WWDDPT  6                                           CSD027
     C*                                                                   S01496
     C           KALL2     KLIST                                          S01496
     C**********           KFLD           W2CUST  60                                   S01496 CSD027
     C                     KFLD           W2CUST  6                                           CSD027
     C                     KFLD           W2ERRF  6                       S01496
     C                     KFLD           W2BRCD  3                       S01496
     C**********           KFLD           W2DDPT  60                                   S01496 CSD027
     C                     KFLD           W2DDPT  6                                           CSD027
     C*                                                                   S01496
     C           KEY1      KLIST                                          S01496
     C**********           KFLD           WWCUST  60                                   S01496 CSD027
     C                     KFLD           WWCUST  6                                           CSD027
     C                     KFLD           KCDBR   3                       S01496
     C**********           KFLD           KCDPT   60                                   S01496 CSD027
     C                     KFLD           KCDPT   6                                           CSD027
     C                     KFLD           KCDSN  10                       S01496
     C                     KFLD           KDDTE   50                      S01496
     C*                                                                   S01496
     C           KEY2      KLIST                                          S01496
     C                     KFLD           KCDBR1  3                       S01496
     C**********           KFLD           KCDPT1  60                                   S01496 CSD027
     C                     KFLD           KCDPT1  6                                           CSD027
     C                     KFLD           KCDSN1 10                       S01496
     C**********           KFLD           WWCUST  60                                   S01496 CSD027
     C                     KFLD           WWCUST  6                                           CSD027
     C                     KFLD           KPTFR1  4                       S01496
     C                     KFLD           KDDTE1  50                      S01496
     C*                                                                   S01496
     C           KEY3      KLIST                                          S01496
     C                     KFLD           KCDSN2 10                       S01496
     C                     KFLD           KTYPE2  2                       S01496
     C                     KFLD           KDDTE2  50                      S01496
      /EJECT
     C*****************************************************************
     C*
     C**   Perform initial processing
     C                     EXSR #INIT
     C*
     C**   Access portfolio customers file
     C           *LOVAL    SETLLSDPLCSPT
     C                     READ SDPLCSPT                 71
     C*
     C**   Perform processing until end of file reached
     C           *IN71     DOWEQ'0'                        B1
     C*                                                                   38430
     C           QBLCD     IFEQ BJRDNB                     B2             38430
     C*
     C**   Perform processing for inserted portfolio
     C***********QBCHTP    IFEQ 'I'                        B3             S01486
     C           QBTYLC    IFEQ 'I'                        B3             S01486
     C                     EXSR #P01
     C                     ADD  1         WWRCIN
     C                     END                             E3
     C*
     C**   Perform processing for deleted portfolio
     C***********QBCHTP    IFEQ 'D'                        B3             S01486
     C           QBTYLC    IFEQ 'D'                        B3             S01486
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVEL*BLANKS   KEYCN                           CPB001
     C                     MOVELQBCUST    KEYCN                           CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD                           CPB001
     C                     PARM '*KEY  '  @OPTN                           CPB001
     C                     PARM           KEYCN                           CPB001
     C                     PARM *BLANKS   KEYST                           CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   CPB001
     C           @RTCD     IFNE *BLANKS                                   CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD63        DBASE            ***************CPB001
     C                     MOVEL'SDCUSTPD'DBFILE           * DB ERROR 63 *CPB001
     C                     MOVELQBCUST    DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C**   If Private Banking OFF                                         CPB001
     C**   Or Private Banking ON and Customer NOT a Private Customer      CPB001
     C**   Perform processing for Deleted Portfolio                       CPB001
     C           BGN4ST    IFEQ 'N'                                       CPB001
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           BBPRBA    ANDEQ'N'                                       CPB001
     C                     EXSR #P02
     C                     ADD  1         WWRCDL
     C                     ENDIF                                          CPB001
     C                     END                             E3
     C*                                                                   38430
     C                     END                                            38430
     C*
     C**   Read following record
     C                     READ SDPLCSPT                 71
     C*
     C                     END
     C*
     C**   Access portfolio positions trailer
     C***********          READ PMCPOSZZ                 72*ON=NOT THERE  S01486
     C                     READ PMCPOSPA                 72*ON=NOT THERE  S01486
     C*
     C           *IN72     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD04        DBASE            ***************
     C***********          MOVEL'PMCPOSZZ'DBFILE           * DB ERROR 04 *S01486
     C                     MOVEL'PMCPOSPA'DBFILE           * DB ERROR 04 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C*
     C**   Calculate number of positions
     C                     ADD  WWWRIT    QANORE
     C                     SUB  WWDELT    QANORE
     C*
     C                     UPDATPMCPOSZ0
     C*
     C**   Output audit report
     C                     EXSR #W01
     C*
     C                     MOVE '1'       *INLR
     C                     RETRN
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**   I N D E X   O F   S U B R O U T I N E S
     C*================================================================
     C**
     C**   MAIN     Main processing
     C**
     C**   #INIT    Initial processing
     C**
     C**   #P01     Process customer insertions
     C**
     C**   #P02     Process customer deletions
     C**
     C*****#P03*****Calculate*historic*positions*on*PF/PMCPOSPP********   S01486
     C**   #P03     Calculate historic positions on PF/PMCPOSPD           S01486
     C**
     C**   #P04     Update historic customer actions on PF/CAPRHD
     C**
     C**   #P05     Maintain running total of positions in security
     C**
     C*****#P06*****Update*PF/PMCPOSPP*********************************   S01486
     C**   #P06     Update PF/PMCPOSPD                                    S01486
     C**
     C**   #P07     Calculate Trade Portfolio Value
     C**
     C**   #P08     Calculate Depot Movement Portfolio Value
     C**
     C**   #P09     Determine Spot Rate,Multiply Divide Indicator
     C**
     C**   #W01     Print audit report
     C**
     C*****#W02*****Generate*trade*date*position*on*PF/PMCPOSPP********   S01486
     C**   #W02     Generate trade date position on PF/PMCPOSPD           S01486
     C**
     C*****#W03*****Generate*value*date*position*on*PF/PMCPOSPP********   S01486
     C**   #W03     Generate value date position on PF/PMCPOSPD           S01486
     C**
     C**   #W04     Update PM details on PF/CAPRHD
     C**
     C*****#W05*****Update*deal*type/sub-type details*on*PF/SDDTSTPP***   S01486
     C**   #W05     Update deal type/sub-type details on PF/FDDTSTL0      S01486
     C**
     C**   *PSSR    File error handling
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #P01      - to process portfolio customer insertion
     C**
     C**   CALLED BY - main processing
     C**
     C**   CALLS     - #W05  - to create new deal type/sub-type record
     C**             - #P04  - to update customer average price
     C**             - #P03  - to calculate starting position
     C**             - #P07  - to calculate Trade Portfolio Value
     C**
     C**
     C*=========================================================================
     C*
     C           #P01      BEGSR                           * #P01 BEGSR *
     C*
     C*================================================================
     C**   DEALS BY CUSTOMER FILE PROCESSING
     C*================================================================
     C**   Read customer's deals file
     C                     MOVE '0'       *IN73
     C****       WWCUST    SETLLCUSDE                                     38430
     C****       WWCUST    READECUSDE                    73               38430
     C                     MOVE '0'       *IN01                           38430
     C                     MOVE '0'       *IN02                           38430
     C***********WWCUST    SETLLDEALSP4                             38430 S01486
     C***********WWCUST    READEDEALSP4                  73         38430 S01486
     C           WWCUST    SETLLPMDEALL4                                  S01486
     C           WWCUST    READEPMDEALL4                 73               S01486
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C*                                                                   38430
     C           RECI      IFNE '*'                                       38430
     C           RECI      ANDNE'R'                                       38430
     C*
     C**   If record from PF/DEALSDC, check deal type
     C           *IN02     IFEQ '1'
     C                     MOVE '0'       *IN02
     C                     Z-ADD1         X       20
     C           DTYP      LOKUPDTYPES,X                 02
     C                     END
     C*                                                                   38430
     C** FOR MM DEAL DETERMINE CROSS RATE NOMINAL TO PORTFOLIO CURRENCY   38430
     C           *IN02     IFEQ '1'                                       38430
     C                     MOVE CCY       WWCCYH                          38430
     C                     Z-ADDDDAT      WWPDAT                          38430
     C                     EXSR #P09                                      38430
     C                     MOVE NMCY      ZCCYF                           38430
     C                     Z-ADDWWSPOT    ZRATEF                          38430
     C                     MOVELWWMDIN    ZMDINF                          38430
     C                     Z-ADDQ8CDP     ZCDPF                           38430
     C*                                                                   38430
     C** Perform S/R #P09 for Customer Base Currency                      38430
     C                     MOVELQBCSBY    WWCCYH                          38430
     C                     EXSR #P09                                      38430
     C                     MOVE QBCSBY    ZCCYT                           38430
     C                     Z-ADDWWSPOT    ZRATET                          38430
     C                     MOVELWWMDIN    ZMDINT                          38430
     C                     Z-ADDQBBYDP    ZCDPT                           38430
     C*                                                                   38430
     C** Obtain Cross FX Rate                                             38430
     C                     EXSR ZCCYCN                                    38430
     C                     Z-ADDZCRSRT    FXRD                            38430
     C                     END                                            38430
     C*
     C**   Access deal type/sub-type details
     C           *IN01     IFEQ '1'
     C           *IN02     OREQ '1'
     C****       *IN03     OREQ '1'                                       58933
     C***********DTKEY     CHAINSDDTSTPP             74                   S01486
     C           DTKEY     CHAINFDDTSTL0             74                   S01486
     C*
     C           *IN74     IFEQ '0'
     C*
     C**   If record deleted, change record id.
     C***********P7RECI    IFEQ '*'                                       S01486
     C***********          MOVE 'D'       P7RECI                          S01486
     C***********          UPDATSDDTSTP0                                  S01486
     C***********          ADD  1         WWNORE                          S01486
     C           RCID11    IFEQ '*'                                       S01486
     C                     MOVE 'D'       RCID11                          S01486
     C                     UPDATFDDTSTPD                                  S01486
     C                     END
     C                     ELSE
     C*
     C**   If record not found, create a new record
     C                     EXSR #W05
     C***********          ADD  1         WWNORE                          S01486
     C                     END
     C*
     C/COPY WNCPYSRC,PM1030C001
     C           PTFR      IFEQ *BLANKS                                   EMFIX
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE CNUM      ZZCNUM  6                       CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    PTFR
     C                     ENDIF                                          CPB001
     C                     END                                            EMFIX
     C/COPY WNCPYSRC,PM1030C002
     C*
     C                     MOVE *BLANKS   HLEX                            38430
     C*
     C**   Update appropriate record
     C           *IN01     IFEQ '1'
     C                     EXCPTDEALBU
     C           DLNO      CHAINFXDEALP0             01                   61488
     C           *IN01     IFEQ '0'                                       61488
     C           FHPTFR    ANDEQ*BLANKS                                   101190
     C/COPY WNCPYSRC,PM1030C003
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE FHDCNO    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    FHPTFR                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    FHPTFR                          61488
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C004
     C                     EXCPTFXDEAU                                    61488
     C                     END                                            61488
     C                     MOVE '0'       *IN01
     C                     END
     C           *IN02     IFEQ '1'
     C                     EXCPTDEALCU
     C           DLNO      CHAINMMDELDP0             02                   61488
     C           *IN02     IFEQ '0'                                       61488
     C           HKPTFR    ANDEQ*BLANKS                                   101190
     C/COPY WNCPYSRC,PM1030C005
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE HKCNUM    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    HKPTFR                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    HKPTFR                          61488
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C006
     C                     EXCPTMMDELU                                    61488
     C                     END                                            61488
     C                     MOVE '0'       *IN02
     C                     END
     C****       *IN03     IFEQ '1'                                       58933
     C****                 EXCPTDEALGU                                    58933
     C****                 MOVE '0'       *IN03                           58933
     C****                 END                                            58933
     C                     END
     C                     END
     C*
     C**   Read following record detail
     C****       WWCUST    READECUSDE                    73               38430
     C                     MOVE '0'       *IN01                           38430
     C                     MOVE '0'       *IN02                           38430
     C***********WWCUST    READEDEALSP4                  73         38430 S01486
     C           WWCUST    READEPMDEALL4                 73               S01486
     C                     END
     C*
     C***********          MOVE '0'       *IN73                           S01486
     C***********          OPEN SDDTSTZZ               73                 S01486
     C************IN73     IFEQ '0'                                       S01486
     C***********          READ SDDTSTZZ                 73               S01486
     C***********                                                         S01486
     C************IN73     IFEQ '0'                                       S01486
     C***********          ADD  WWNORE    P7NORE                          S01486
     C***********          UPDATSDDTSTZ0                                  S01486
     C***********          CLOSESDDTSTZZ                                  S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C************IN73     IFEQ '1'                                       S01486
     C***********          Z-ADD05        DBASE            ***************S01486
     C***********          MOVEL'SDDTSTZZ'DBFILE           * DB ERROR 05 *S01486
     C***********          EXSR *PSSR                      ***************S01486
     C***********          END                                            S01486
     C*
     C*================================================================
     C**   TRADES BY CUSTOMER FILE PROCESSING
     C*================================================================
     C                     MOVE *BLANKS   WWTRAD
     C****       TRKEY     SETLLTRADCU                                    38430
     C           WWCUST    SETLLTRADC                                     38430
     C                     MOVE '0'       *IN73
     C                     MOVE '0'       *IN08                           38430
     C                     MOVE '0'       *IN09                           38430
     C****                 READ TRADCU                   73               38430
     C                     READ TRADC                    73               38430
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C           WWCUST    ANDEQTCNR
     C*
     C****       WWRECI    IFNE '*'                                       38430
     C****       WWRECI    ANDNE'C'                                       38430
     C           RECI      IFNE '*'                                       38430
     C           RECI      ANDNE'C'                                       38430
     C           PTFR      ANDEQ*BLANKS                                   EMFIX
     C/COPY WNCPYSRC,PM1030C007
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    PTFR
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C008
     C*
     C** CALCULATE TRADE PORTFOLIO VALUE (MORE SPECIFICALLY,THE FX RATE)
     C*
     C                     EXSR #P07
     C*                                                                   38430
     C           *IN08     IFEQ '1'                                       38430
     C                     EXCPTTRADSU
     C                     END                                            38430
     C           *IN09     IFEQ '1'                                       38430
     C                     EXCPTHSTTRU                                    38430
     C                     END                                            38430
     C                     END
     C*
     C****                 READ TRADCU                   73               38430
     C                     MOVE '0'       *IN08                           38430
     C                     MOVE '0'       *IN09                           38430
     C                     READ TRADC                    73               38430
     C                     END
     C*
     C*================================================================
     C**   DEPOT MOVEMENTS FILE PROCESSING
     C*================================================================
     C           DPKEY     SETLLDEPMVC
     C                     MOVE '0'       *IN73
     C                     READ DEPMVC                   73
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'                        B1
     C           WWCUST    ANDEQDPBN
     C*
     C           RECI      IFNE '*'                        B2
     C           DPMV      IFEQ 'WI'                       B3
     C           DPMV      OREQ 'WO'
     C           PTFR      IFEQ *BLANKS                    B4             EMFIX
     C/COPY WNCPYSRC,PM1030C009
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    PTFR
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C010
     C******************** EXCPTDPTMVU                                    R10049
     C*                                                                   R10049
     C** Access security details                                          R10049
     C           DPSS      CHAINSECTY                74                   R10049
     C*                                                                   R10049
     C           *IN74     IFEQ '1'                        B5             R10049
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD12        DBASE            ***************R10049
     C                     MOVEL'SECTY   'DBFILE           * DB ERROR 12 *R10049
     C                     MOVELDPSS      DBKEY            ***************R10049
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     R10049
     C                     END                             E5             R10049
     C*                                                                   B8920
     C** CHAIN FOR INVESTMENT TYPE FOR PROCESSING TYPE                    B8920
     C*                                                                   B8920
     C           KINVT     CHAININVTP                74                   B8920
     C*                                                                   B8920
     C           *IN74     IFEQ '1'                        B5             B8920
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD59        DBASE            ***************B8920
     C                     MOVEL'INVTP   'DBFILE           * DB ERROR 59 *B8920
     C                     MOVELNMCY      DBKEY            ***************B8920
     C                     MOVELSITP      DBKEY                           B8920
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     B8920
     C                     END                             E5             B8920
     C*                                                                   R10049
     C** Set Movement Date                                                R10049
     C           DPMD      IFEQ 0                          B5             R10049
     C                     Z-ADDDPDO      WWPDAT                          R10049
     C                     ELSE                            X5             R10049
     C                     Z-ADDDPMD      WWPDAT                          R10049
     C                     END                             E5             R10049
     C*                                                                   R10049
     C                     Z-ADD1         ZAMTF                           R10049
     C*                                                                   R10049
     C** Perform S/R #P09 for Nominal Currency                            R10049
     C                     MOVE NMCY      WWCCYH                          R10049
     C                     EXSR #P09                                      R10049
     C                     MOVE NMCY      ZCCYF                           R10049
     C                     Z-ADDWWSPOT    ZRATEF                          R10049
     C                     MOVELWWMDIN    ZMDINF                          R10049
     C                     Z-ADDQ8CDP     ZCDPF                           R10049
     C*                                                                   R10049
     C** Perform S/R #P09 for Customer Base Currency                      R10049
     C                     MOVELQBCSBY    WWCCYH                          R10049
     C                     EXSR #P09                                      R10049
     C                     MOVE QBCSBY    ZCCYT                           R10049
     C                     Z-ADDWWSPOT    ZRATET                          R10049
     C                     MOVELWWMDIN    ZMDINT                          R10049
     C                     Z-ADDQBBYDP    ZCDPT                           R10049
     C*                                                                   R10049
     C** Obtain Cross FX Rate                                             R10049
     C                     EXSR ZCCYCN                                    R10049
     C                     Z-ADDZCRSRT    SPXR                            R10049
     C                     MOVELZCRSMD    SPMD                            R10049
     C                     MOVE 'N'       CWDI                            R10049
     C                     Z-ADD0         CYLD                            R10049
     C*                                                                   38430
     C** CALCULATE YIELD ON DEPOT MOVEMENT                                38430
     C           PROT      IFEQ '1'                        B5             38430
     C           PROT      OREQ '3'                                       38430
     C           PROT      OREQ '5'                                       38430
     C           PROT      OREQ '6'                                       38430
     C           PROT      OREQ '8'                                       38430
     C           PROT      OREQ '9'                                       38430
     C*                                                                   38430
     C           MATY      IFNE *ZERO                      B6             38430
     C*                                                                   38430
     C** IF THE SECURITY IS INTEREST BEARING,USE AIBD METHOD,ELSE DISCOUNT38430
     C*                                                                   38430
     C           CD01      IFNE *ZERO                      B7             38430
     C                     MOVEL'A '      SYBS                            38430
     C                     ELSE                            X7             38430
     C                     MOVEL'DA'      SYBS                            38430
     C                     END                             E7             38430
     C*                                                                   38430
     C           DYBS      IFEQ '4'                        B7             38430
     C                     MOVE '3'       DYBS                            38430
     C                     MOVE '1'       DVBS                            38430
     C                     END                             E7             38430
     C*                                                                   38430
     C                     Z-ADDMKTP      ZPRICE 158                      38430
     C                     Z-ADDDPVD      ZFDATE  50                      38430
     C                     Z-ADDZFDATE    ECD     50                      38430
     C           SERECI    IFEQ 'D'                                       61228
     C                     EXSR ZYLDO                                     38430
     C                     ELSE                                           61228
     C                     Z-ADD0         ZYLDOT                          61228
     C                     END                                            61228
     C                     Z-ADDZYLDOT    CYLD                            38430
     C                     END                             E6             38430
     C                     END                             E5             38430
     C*                                                                   R10049
     C** Update file DEPMVC                                               R10049
     C                     EXCPTDPTMVU                                    R10049
     C                     END                             E4             EMFIX
     C                     END                             E3
     C                     END                             E2
     C*
     C                     READ DEPMVC                   73
     C                     END                             E1
     C*
     C*================================================================
     C*****FINANCIAL*FUTURES*FILE*PROCESSING***************************   S01486
     C*================================================================
     C***********WWCUST    SETLLTRANSC                                    S01486
     C***********          MOVE '0'       *IN73                           S01486
     C***********WWCUST    READETRANSC                   73               S01486
     C***********                                                         S01486
     C*****Process*record*for*the*same*customer************************   S01486
     C************IN73     DOWEQ'0'                                       S01486
     C****       RECI      IFEQ 'D'                                       38430
     C***********RECI      IFNE '*'                                 38430 S01486
     C***********PTFR      ANDEQ*BLANKS                                   S01486
     C***********          MOVE '9997'    PTFR                            S01486
     C***********          EXCPTTRANSU                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********WWCUST    READETRANSC                   73               S01486
     C***********          END                                            S01486
     C*
     C*================================================================   S71062
     C**   FINANCIAL FUTURES FILE PROCESSING                              S71062
     C*================================================================   S71062
     C           BGFUOP    IFEQ 'Y'                                       S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C           WWCUST    SETLLTRANSC                                    S71062
     C                     MOVE '0'       *IN73                           S71062
     C           WWCUST    READETRANSC                   73               S71062
     C*                                                                   S71062
     C**   Process record for the same customer                           S71062
     C           *IN73     DOWEQ'0'                                       S71062
     C           RECI      IFNE '*'                                       S71062
     C           PTFR      ANDEQ*BLANKS                                   S71062
     C/COPY WNCPYSRC,PM1030C011
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    PTFR                            S71062
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C012
     C                     EXCPTTRANSU                                    S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C           WWCUST    READETRANSC                   73               S71062
     C                     END                                            S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C*================================================================
     C**   CUSTOMER LOANS FILE PROCESSING
     C*================================================================
     C***********WWCUST    SETLLCLOANC                                    S01486
     C           WWCUST    SETLLPMCLONL6                                  S01486
     C                     MOVE '0'       *IN73
     C***********WWCUST    READECLOANC                   73               S01486
     C           WWCUST    READEPMCLONL6                 73               S01486
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C           RECI      IFEQ 'D'
     C           PTYP      IFEQ 61
     C           PTYP      OREQ 62
     C           PTYP      OREQ 63
     C           PTYP      OREQ 70
     C           PTYP      OREQ 80                                                            CLE028
     C           PTFR      IFEQ *BLANKS                                   EMFIX
     C/COPY WNCPYSRC,PM1030C013
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    PTFR
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C014
     C                     MOVE *BLANKS   HLEX                            38430
     C                     EXCPTCLOANU
     C                     END                                            EMFIX
     C                     END
     C                     END
     C***********WWCUST    READECLOANC                   73               S01486
     C           WWCUST    READEPMCLONL6                 73               S01486
     C                     END
     C*                                                                   38430
     C** READ THROUGH MATURED LOANS AND MOVE INTO '9997' PORTFOLIO        38430
     C***********WWCUST    SETLLCLOANP5                             38430 S01486
     C           WWCUST    SETLLPMCLONL0                                  S01486
     C                     MOVE '0'       *IN73                           38430
     C                     MOVE '0'       *IN06                           38430
     C                     MOVE '0'       *IN07                           38430
     C***********WWCUST    READECLOANP5                  73         38430 S01486
     C           WWCUST    READEPMCLONL0                 73               S01486
     C*                                                                   38430
     C**   Process record for the same customer                           38430
     C           *IN73     DOWEQ'0'                        B1             38430
     C           PTYP      IFEQ 61                         B2             38430
     C           PTYP      OREQ 62                                        38430
     C           PTYP      OREQ 63                                        38430
     C           PTYP      OREQ 70                                        38430
     C           PTYP      OREQ 80                                                            CLE028
     C           PTFR      IFEQ *BLANKS                    B3             38430
     C/COPY WNCPYSRC,PM1030C015
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    PTFR                            38430
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C016
     C                     MOVE *BLANKS   HLEX                            38430
     C*                                                                   38430
     C           *IN06     IFEQ '1'                        B4             38430
     C                     EXCPTCLOANP                                    38430
     C                     END                             E4             38430
     C*                                                                   38430
     C           *IN07     IFEQ '1'                        B4             38430
     C                     EXCPTCLOANZ                                    38430
     C                     END                             E4             38430
     C*                                                                   38430
     C                     END                             E3             38430
     C                     END                             E2             38430
     C*                                                                   38430
     C                     MOVE '0'       *IN06                           38430
     C                     MOVE '0'       *IN07                           38430
     C***********WWCUST    READECLOANP5                  73         38430 S01486
     C           WWCUST    READEPMCLONL0                 73               S01486
     C                     END                             E1             38430
     C*================================================================
     C**   ACCOUNT DETAILS FILE PROCESSING
     C*================================================================
     C           ACKEY     SETLLACCNT
     C                     MOVE '0'       *IN73
     C                     READ ACCNT                    73
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C           WWCUST    ANDEQCNUM
     C****       RECI      IFEQ 'D'                                       38430
     C****       ATYP      ANDEQ'R'                                       38430
     C           ATYP      IFEQ 'R'                                       38430
     C           PTFR      ANDEQ*BLANKS                                   EMFIX
     C/COPY WNCPYSRC,PM1030C017
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    PTFR
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C018
     C                     MOVE *BLANKS   HLEX                            38430
     C                     EXCPTACCNTU
     C                     END
     C                     READ ACCNT                    73
     C                     END
     C*================================================================
     C*****FIDUCIARY*DEPOSITS*FILE*PROCESSING*****************************S01486
     C*================================================================
     C***********WWCUST    SETLLFIDEPOL1                                  S01486
     C***********          MOVE '0'       *IN73                           S01486
     C***********WWCUST    READEFIDEPOL1                 73               S01486
     C***********                                                         S01486
     C*****Process*record*for*the*same*customer************************   S01486
     C************IN73     DOWEQ'0'                                       S01486
     C****       FDDLTF    IFEQ *BLANK                                    38430
     C***********FDDLTF    IFNE '*'                                 38430 S01486
     C***********FDPTFR    ANDEQ*BLANKS                             38430 S01486
     C***                  MOVE '9997'    PTFR                            EMFIX
     C***********          MOVE '9997'    FDPTFR                    EMFIX S01486
     C***********          MOVE *BLANKS   FDHLEX                    38430 S01486
     C***********                                                   38430 S01486
     C***DETERMINE*CROSS*RATE*NOMINAL*TO*PORTFOLIO*CURRENCY*********38430 S01486
     C***********          MOVE FDCCY     WWCCYH                    38430 S01486
     C***********          Z-ADDFDDDAT    WWPDAT                    38430 S01486
     C***********          EXSR #P09                                38430 S01486
     C***********          MOVE NMCY      ZCCYF                     38430 S01486
     C***********          Z-ADDWWSPOT    ZRATEF                    38430 S01486
     C***********          MOVELWWMDIN    ZMDINF                    38430 S01486
     C***********          Z-ADDQ8CDP     ZCDPF                     38430 S01486
     C***********                                                   38430 S01486
     C***Perform*S/R*#P09*for*Customer*Base*Currency****************38430 S01486
     C***********          MOVELQBCSBY    WWCCYH                    38430 S01486
     C***********          EXSR #P09                                38430 S01486
     C***********          MOVE QBCSBY    ZCCYT                     38430 S01486
     C***********          Z-ADDWWSPOT    ZRATET                    38430 S01486
     C***********          MOVELWWMDIN    ZMDINT                    38430 S01486
     C***********          Z-ADDQBBYDP    ZCDPT                     38430 S01486
     C***********                                                   38430 S01486
     C***Obtain*Cross*FX*Rate***************************************38430 S01486
     C***********          EXSR ZCCYCN                              38430 S01486
     C***********          Z-ADDZCRSRT    FDFXRD                    38430 S01486
     C***********                                                   38430 S01486
     C***********          EXCPTFIDEPU                                    S01486
     C***********          END                                            S01486
     C***********WWCUST    READEFIDEPOL1                 73               S01486
     C***********          END                                            S01486
     C*================================================================
     C*****FIDUCIARY*LOANS*FILE*PROCESSING*****************************   S01486
     C*================================================================
     C***********WWCUST    SETLLFILOANL4                                  S01486
     C***********          MOVE '0'       *IN73                           S01486
     C***********WWCUST    READEFILOANL4                 73               S01486
     C***********                                                         S01486
     C*****Process*record*for*the*same*customer************************   S01486
     C************IN73     DOWEQ'0'                                       S01486
     C***********FLPTFR    IFEQ *BLANKS                             EMFIX S01486
     C***********          MOVE '9997'    PTFR                      EMFIX S01486
     C***********          MOVE '9997'    FLPTFR                    EMFIX S01486
     C***********          EXCPTFILOAU                                    S01486
     C***********          END                                      EMFIX S01486
     C***********WWCUST    READEFILOANL4                 73               S01486
     C***********          END                                            S01486
     C*                                                                   S01408
     C/COPY WNCPYSRC,PM1030CCP1                                           S01408
     C*                                                                   S01408
     C*================================================================
     C**   CUSTOMER AVERAGE PRICES FILE PROCESSING
     C*================================================================
     C           CAKEY     SETLLCAPRHDF
     C                     MOVE '0'       *IN73
     C                     READ CAPRHDF                  73
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C           WWCUST    ANDEQCSCN
     C           RECI      IFNE '*'
     C           RECI      ANDNE'C'
     C                     EXSR #P04
     C                     END
     C                     READ CAPRHDF                  73
     C                     END
     C*                                                                   S01496
     C**  Perform the following only if Jyske Enhancements feature        S01496
     C**  is installed                                                    S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C*                                                                   S01496
     C*================================================================   S01496
     C**   CUSTOMER DEPOT POSITIONS BY DATE PROCESSING                    S01496
     C*================================================================   S01496
     C           WWCUST    SETLLCDEPD                                     S01496
     C                     READ CDEPD                    73               S01496
     C*                                                                   S01496
     C**   Process record for the same customer                           S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C           WWCUST    ANDEQCDCN                                      S01496
     C*                                                                   S01496
     C           PTFR      IFEQ *BLANKS                                   101190
     C/COPY WNCPYSRC,PM1030C019
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    PTFR                            S01496
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C020
     C                     EXCPTCDEPU                                     S01496
     C                     ENDIF                                          101190
     C*                                                                   S01496
     C                     READ CDEPD                    73               S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C*================================================================   S01496
     C**   ALLOCATIONS BY CUSTOMER AND PORTFOLIO REFERENCE PROCESSING     S01496
     C*================================================================   S01496
     C           WWCUST    SETLLSEERALL3                                  S01496
     C                     READ SEERALL3                 73               S01496
     C*                                                                   S01496
     C**   Process record for the same customer                           S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C           WWCUST    ANDEQVCCNUM                                    S01496
     C*                                                                   S01496
     C           VCPTFR    IFEQ *BLANKS                                   101190
     C/COPY WNCPYSRC,PM1030C021
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    VCPTFR                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    VCPTFR                          S01496
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C022
     C                     EXCPTSEERU                                     S01496
     C                     ENDIF                                          101190
     C*                                                                   S01496
     C                     READ SEERALL3                 73               S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C*================================================================   S01496
     C**   GENERAL BLOCKS BY CUSTOMER PROCESSING                          S01496
     C*================================================================   S01496
     C           WWCUST    SETLLSEBLKPL4                                  S01496
     C                     READ SEBLKPL4                 73               S01496
     C*                                                                   S01496
     C**   Process record for the same customer                           S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C           WWCUST    ANDEQVDCNUM                                    S01496
     C*                                                                   S01496
     C           VDPTFR    IFEQ *BLANKS                                   S01496
     C/COPY WNCPYSRC,PM1030C023
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    VDPTFR                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    VDPTFR                          S01496
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C024
     C                     EXCPTSEBLU                                     S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     READ SEBLKPL4                 73               S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  End of S01496 = 'Y'                                             S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C*================================================================
     C**   CUSTOMER POSITIONS FILE PROCESSING
     C*================================================================
     C**   Calculate starting position
     C                     EXSR #P03
     C*
     C*================================================================
     C*
     C*****Set*up*the*portfolio*customer*flag**************************   S01486
     C***********          MOVE 'Y'       QBPCUS                          S01486
     C***********          UPDATSDPLCSP0                                  S01486
     C*
     C                     ENDSR                           * #P01 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #P02      - to process portfolio customer deletion
     C**
     C**   CALLED BY - main processing
     C**
     C**   CALLS     - #W05  - to create new deal type/sub-type record
     C**             - #P04  - to update customer average price
     C**             - #P03  - to calculate starting position
     C**
     C*=========================================================================
     C*
     C           #P02      BEGSR                           * #P02 BEGSR *
     C*
     C*================================================================
     C**   DEALS BY CUSTOMER FILE PROCESSING
     C*================================================================
     C*
     C**   Read customer's deals file
     C                     MOVE '0'       *IN73
     C****       WWCUST    SETLLCUSDE                                     034679
     C****       WWCUST    READECUSDE                    73               034679
     C                     MOVE WWCUST    W1CNUM                          034679
     C                     MOVE *LOVAL    W1PTFR                          034679
     C*********************MOVE *LOVAL    W1RECI                   034679 42635
     C                     MOVE *LOVAL    W1DLNO                          034679
     C                     MOVE *LOVAL    W1DTYP                          42635
     C                     MOVE *LOVAL    W1DLST                          42635
     C*********************MOVE *LOVAL    W1LTYP                                        42635 CLE042
     C*********************MOVE *LOVAL    W1SUTP                                        42635 CLE042
     C****       KDEAL     SETLLDEALSP3                             03467938430
     C****       KDEALE    READEDEALSP3                  73         03467938430
     C                     MOVE '0'       *IN01                           38430
     C                     MOVE '0'       *IN02                           38430
     C***********W1CNUM    SETLLDEALSP4                             38430 S01486
     C***********W1CNUM    READEDEALSP4                  73         38430 S01486
     C           W1CNUM    SETLLPMDEALL4                                  S01486
     C           W1CNUM    READEPMDEALL4                 73               S01486
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'                        B1
     C*
     C**   Update appropriate record
     C                     MOVE *BLANKS   PTFR
     C                     MOVE *BLANKS   HLEX                            38430
     C                     Z-ADD0         FXRD                            38430
     C****       *IN01     IFEQ '1'                                       034679
     C****                 EXCPTDEALBU                                    034679
     C****       *IN04     IFEQ '1'                        B2       03467938430
     C           *IN01     IFEQ '1'                        B2             38430
     C****                 EXCPTDEALDB                              03467938430
     C                     EXCPTDEALBU                                    38430
     C*                                                                   61488
     C** UPDATE CORRESPONDING FXDEALPP RECORD                             61488
     C           DLNO      CHAINFXDEALP0             01                   61488
     C           *IN01     IFEQ '0'                                       61488
     C                     MOVE *BLANKS   FHPTFR                          61488
     C                     EXCPTFXDEAU                                    61488
     C                     END                                            61488
     C****                 MOVE '0'       *IN01                           034679
     C                     MOVE '0'       *IN04                           034679
     C                     END                             E2
     C****       *IN02     IFEQ '1'                                       034679
     C****                 EXCPTDEALCU                                    034679
     C****       *IN05     IFEQ '1'                        B2       03467938430
     C           *IN02     IFEQ '1'                        B2             38430
     C****                 EXCPTDEALDC                              03467938430
     C                     EXCPTDEALCU                                    38430
     C****                 MOVE '0'       *IN02                           034679
     C*                                                                   61488
     C** DELETE CORRESPONDING MMDELDPP RECORD                             61488
     C           DLNO      CHAINMMDELDP0             02                   61488
     C           *IN02     IFEQ '0'                                       61488
     C                     MOVE *BLANKS   HKPTFR                          61488
     C                     EXCPTMMDELU                                    61488
     C                     END                                            61488
     C                     MOVE '0'       *IN05                           034679
     C                     END                             E2
     C****       *IN03     IFEQ '1'                                       034679
     C****                 EXCPTDEALGU                                    034679
     C****       *IN06     IFEQ '1'                                 03467958933
     C****                 EXCPTDEALDG                              03467958933
     C****                 MOVE '0'       *IN03                           034679
     C****                 MOVE '0'       *IN06                     03467958933
     C****                 END                                            58933
     C*
     C**   Read following record detail
     C****       WWCUST    READECUSDE                    73               034679
     C****       KDEALE    READEDEALSP3                  73         03467938430
     C                     MOVE '0'       *IN01                           38430
     C                     MOVE '0'       *IN02                           38430
     C***********W1CNUM    READEDEALSP4                  73         38430 S01486
     C           W1CNUM    READEPMDEALL4                 73               S01486
     C                     END                             E1
     C*
     C*================================================================
     C**   TRADES BY CUSTOMER FILE PROCESSING
     C*================================================================
     C                     MOVE *BLANKS   WWTRAD
     C****       TRKEY     SETLLTRADCU                                    38430
     C           WWCUST    SETLLTRADC                                     38430
     C                     MOVE '0'       *IN73
     C****                 READ TRADCU                   73               38430
     C                     MOVE '0'       *IN08                           38430
     C                     MOVE '0'       *IN09                           38430
     C                     READ TRADC                    73               38430
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C           WWCUST    ANDEQTCNR
     C*
     C           WWRECI    IFNE '*'
     C           WWRECI    ANDNE'C'
     C                     MOVE *BLANK    PTFR
     C                     Z-ADD*ZERO     SPXR
     C                     MOVEL*BLANK    SPMD
     C*                                                                   38430
     C           *IN08     IFEQ '1'                                       38430
     C                     EXCPTTRADSU
     C                     END                                            38430
     C           *IN09     IFEQ '1'                                       38430
     C                     EXCPTHSTTRU                                    38430
     C                     END                                            38430
     C*
     C                     END
     C*
     C****                 READ TRADCU                   73               38430
     C                     MOVE '0'       *IN08                           38430
     C                     MOVE '0'       *IN09                           38430
     C                     READ TRADC                    73               38430
     C                     END
     C*
     C*================================================================
     C**   DEPOT MOVEMENTS FILE PROCESSING
     C*================================================================
     C           DPKEY     SETLLDEPMVC
     C                     MOVE '0'       *IN73
     C                     READ DEPMVC                   73
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C           WWCUST    ANDEQDPBN
     C*
     C           RECI      IFNE '*'
     C                     MOVE *BLANKS   PTFR
     C****                 MOVE *BLANKS   SPXR                      R1004938430
     C                     Z-ADD0         SPXR                            38430
     C                     MOVE *BLANKS   SPMD                            R10049
     C                     Z-ADD0         CYLD                            38430
     C                     MOVE 'N'       CWDI                            38430
     C                     EXCPTDPTMVU
     C                     END
     C*
     C                     READ DEPMVC                   73
     C                     END
     C*================================================================   38430
     C**   CUSTOMER AVERAGE PRICES FILE PROCESSING                        38430
     C*================================================================   38430
     C           WWCUST    SETLLCAPRHDF                                   38430
     C                     MOVE '0'       *IN73                           38430
     C                     READ CAPRHDF                  73               38430
     C*                                                                   38430
     C**   Process record for the same customer                           38430
     C           *IN73     DOWEQ'0'                                       38430
     C           WWCUST    ANDEQCSCN                                      38430
     C                     MOVE '*'       PMTI                            38430
     C                     MOVE '*'       PMVI                            38430
     C                     MOVE *BLANKS   PTFR                            38430
     C                     MOVE *BLANKS   ACIN                            38430
     C                     Z-ADD0         ITRA                            38430
     C                     Z-ADD0         CFAP                            38430
     C                     Z-ADD0         CAVR                            38430
     C                     Z-ADD0         CFXR                            38430
     C                     Z-ADD0         CYLD                            38430
     C                     Z-ADD0         OTHD                            38430
     C                     EXCPTCAPRHU                                    38430
     C                     READ CAPRHDF                  73               38430
     C                     END                                            38430
     C*                                                                   38430
     C*================================================================   38430
     C**   POSITION SETTLEMENT UPDATING                                   38430
     C*================================================================   38430
     C***********WWCUST    SETLLPOSETC                              38430 S01486
     C           WWCUST    SETLLPMPOSDL0                                  S01486
     C                     MOVE '0'       *IN73                           38430
     C***********WWCUST    READEPOSETC                   73         38430 S01486
     C           WWCUST    READEPMPOSDL0                 73               S01486
     C*                                                                   38430
     C**   Process record for the same customer                           38430
     C           *IN73     DOWEQ'0'                                       38430
     C                     MOVE *BLANKS   PTFR                            38430
     C                     EXCPTPOSETU                                    38430
     C***********WWCUST    READEPOSETC                   73         38430 S01486
     C           WWCUST    READEPMPOSDL0                 73               S01486
     C                     END                                            38430
     C*
     C*================================================================
     C*****FINANCIAL*FUTURES*FILE*PROCESSING******************************S01486
     C*================================================================
     C***********WWCUST    SETLLTRANSC                                    S01486
     C***********          MOVE '0'       *IN73                           S01486
     C***********WWCUST    READETRANSC                   73               S01486
     C***********                                                         S01486
     C*****Process*record*for*the*same*customer************************   S01486
     C************IN73     DOWEQ'0'                                       S01486
     C****       RECI      IFEQ 'D'                                       38430
     C***********          MOVE *BLANKS   PTFR                            S01486
     C***********          EXCPTTRANSU                                    S01486
     C****                 END                                            38430
     C***********                                                         S01486
     C***********WWCUST    READETRANSC                   73               S01486
     C***********          END                                            S01486
     C*
     C*================================================================   S71062
     C**   FINANCIAL FUTURES FILE PROCESSING                              S71062
     C*================================================================   S71062
     C           BGFUOP    IFEQ 'Y'                                       S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C           WWCUST    SETLLTRANSC                                    S71062
     C                     MOVE '0'       *IN73                           S71062
     C           WWCUST    READETRANSC                   73               S71062
     C*                                                                   S71062
     C**   Process record for the same customer                           S71062
     C           *IN73     DOWEQ'0'                                       S71062
     C                     MOVE *BLANKS   PTFR                            S71062
     C                     EXCPTTRANSU                                    S71062
     C*                                                                   S71062
     C           WWCUST    READETRANSC                   73               S71062
     C                     END                                            S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C*================================================================
     C**   CUSTOMER LOANS FILE PROCESSING
     C*================================================================
     C****       WWCUST    SETLLCLOANC                                    034679
     C****                 MOVE '0'       *IN73                           034679
     C****       WWCUST    READECLOANC                   73               034679
     C****       KLOAN     SETLLCLOANP3                             03467958879
     C****                 MOVE '0'       *IN73                     03467958879
     C****       KLOANE    READECLOANP3                  73         03467958879
     C***********WWCUST    SETLLCLOANC                              58879 S01486
     C           WWCUST    SETLLPMCLONL6                                  S01486
     C                     MOVE '0'       *IN73                           58879
     C***********WWCUST    READECLOANC                   73         58879 S01486
     C           WWCUST    READEPMCLONL6                 73               S01486
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C*
     C****       RECI      IFEQ 'D'
     C                     MOVE *BLANKS   PTFR                            38430
     C                     MOVE *BLANKS   HLEX                            38430
     C****                 EXCPTCLOANU                                    034679
     C****                 EXCPTCLOAN1                              03467958879
     C                     EXCPTCLOANU                                    58879
     C****                 END                                            38430
     C*
     C****       WWCUST    READECLOANC                   73               034679
     C****       KLOANE    READECLOANP3                  73         03467958879
     C***********WWCUST    READECLOANC                   73         58879 S01486
     C           WWCUST    READEPMCLONL6                 73               S01486
     C                     END
     C*                                                                   38430
     C** MOVE MATURED LOANS OUT OF 9997 PORTFOLIO                         38430
     C***********WWCUST    SETLLCLOANP5                             38430 S01486
     C           WWCUST    SETLLPMCLONL0                                  S01486
     C                     MOVE '0'       *IN73                           38430
     C                     MOVE '0'       *IN06                           38430
     C                     MOVE '0'       *IN07                           38430
     C***********WWCUST    READECLOANP5                  73         38430 S01486
     C           WWCUST    READEPMCLONL0                 73               S01486
     C*                                                                   38430
     C**   Process record for the same customer                           38430
     C           *IN73     DOWEQ'0'                                       38430
     C*                                                                   38430
     C                     MOVE *BLANKS   PTFR                            38430
     C                     MOVE *BLANKS   HLEX                            38430
     C*                                                                   38430
     C           *IN06     IFEQ '1'                                       38430
     C                     EXCPTCLOANP                                    38430
     C                     END                                            38430
     C*                                                                   38430
     C           *IN07     IFEQ '1'                                       38430
     C                     EXCPTCLOANZ                                    38430
     C                     END                                            38430
     C*                                                                   38430
     C*                                                                   38430
     C                     MOVE '0'       *IN06                           38430
     C                     MOVE '0'       *IN07                           38430
     C***********WWCUST    READECLOANP5                  73         38430 S01486
     C           WWCUST    READEPMCLONL0                 73               S01486
     C                     END                                            38430
     C*================================================================
     C**   ACCOUNT DETAILS FILE PROCESSING
     C*================================================================
     C           ACKEY     SETLLACCNT
     C                     MOVE '0'       *IN73
     C                     READ ACCNT                    73
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C           WWCUST    ANDEQCNUM
     C                     MOVE *BLANKS   PTFR
     C                     MOVE *BLANKS   HLEX                            38430
     C                     EXCPTACCNTU
     C*
     C                     READ ACCNT                    73
     C                     END
     C*================================================================
     C*****FIDUCIARY*DEPOSITS*FILE*PROCESSING**************************   S01486
     C*================================================================
     C***********WWCUST    SETLLFIDEPOL1                                  S01486
     C***********          MOVE '0'       *IN73                           S01486
     C***********WWCUST    READEFIDEPOL1                 73               S01486
     C***********                                                         S01486
     C*****Process*record*for*the*same*customer************************   S01486
     C************IN73     DOWEQ'0'                                       S01486
     C***********FDDLTF    IFEQ *BLANK                                    S01486
     C***                  MOVE *BLANKS   PTFR                            EMFIX
     C***********          MOVE *BLANKS   FDPTFR                    EMFIX S01486
     C***********          Z-ADD0         FDFXRD                    38430 S01486
     C***********          MOVE *BLANKS   FDHLEX                    38430 S01486
     C***********          EXCPTFIDEPU                                    S01486
     C***********          END                                            S01486
     C***********WWCUST    READEFIDEPOL1                 73               S01486
     C***********          END                                            S01486
     C*================================================================
     C*****FIDUCIARY*LOANS*FILE*PROCESSING*****************************   S01486
     C*================================================================
     C***********WWCUST    SETLLFILOANL4                                  S01486
     C***********          MOVE '0'       *IN73                           S01486
     C***********WWCUST    READEFILOANL4                 73               S01486
     C***********                                                         S01486
     C*****Process*record*for*the*same*customer************************   S01486
     C************IN73     DOWEQ'0'                                       S01486
     C***                  MOVE *BLANKS   PTFR                            EMFIX
     C***********          MOVE *BLANKS   FLPTFR                    EMFIX S01486
     C***********          EXCPTFILOAU                                    S01486
     C***********WWCUST    READEFILOANL4                 73               S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****Set*up*the*portfolio*customer*flag**************************   S01486
     C***********          MOVE 'N'       QBPCUS                          S01486
     C***********          MOVE '*'       QBRECI                          S01486
     C******************   UPDATSDPLCSP0                                  R1048
     C***********          DELETSDPLCSP0                            R1048 S01486
     C*                                                                   S01408
     C/COPY WNCPYSRC,PM1030CCP2                                           S01408
     C*                                                                   S01408
     C*
     C*================================================================
     C**   PORTFOLIO SECURITY POSITIONS PROCESSING
     C*================================================================
     C           PMKEY     SETLLPMAPOSLL
     C                     MOVE '0'       *IN73
     C                     READ PMAPOSLL                 73
     C*
     C**   Process record for the same customer
     C           *IN73     DOWEQ'0'
     C           WWCUST    ANDEQQACNUM
     C                     DELETPMCPOSP0
     C*
     C           QARECI    IFEQ 'D'
     C                     ADD  1         WWDELT
     C                     END
     C*
     C                     READ PMAPOSLL                 73
     C                     END
     C*                                                                   S01496
     C**  Perform the following only if Jyske Enhancements feature        S01496
     C**  is installed                                                    S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C*                                                                   S01496
     C*================================================================   S01496
     C**   ALLOCATIONS BY CUSTOMER AND PORTFOLIO REFERENCE PROCESSING     S01496
     C*================================================================   S01496
     C*                                                                   S01496
     C**  Access allocations file with key of cust no. (being deleted)    S01496
     C**  and all other details set to *LOVAL                             S01496
     C*                                                                   S01496
     C                     MOVE *BLANKS   WWERRF                          S01496
     C                     MOVE *BLANKS   WWBRCD                          S01496
     C**********           Z-ADD*ZEROS    WWDDPT                                       S01496 CSD027
     C                     MOVE *BLANKS   WWDDPT                                              CSD027
     C*                                                                   S01496
     C           KALL1     SETLLSEERALL4                                  S01496
     C                     READ SEERALL4                 73               S01496
     C*                                                                   S01496
     C**  Process record for the same customer                            S01496
     C*                                                                   S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C           WWCUST    ANDEQVCCNUM                                    S01496
     C*                                                                   S01496
     C**  Save ER reference                                               S01496
     C*                                                                   S01496
     C                     MOVE VCERRF    WWERRF                          S01496
     C*                                                                   S01496
     C**  Do while ER reference equal saved reference and record read     S01496
     C**  for same customer                                               S01496
     C*                                                                   S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C           WWCUST    ANDEQVCCNUM                                    S01496
     C           WWERRF    ANDEQVCERRF                                    S01496
     C*                                                                   S01496
     C**  Set workfields 'Ex-Date Nominal Position' to *ZEROS             S01496
     C**                 'Nominal Allocated'                              S01496
     C*                                                                   S01496
     C                     Z-ADD*ZEROS    WWEXPO 130                      S01496
     C                     Z-ADD*ZEROS    WWNOMA 130                      S01496
     C*                                                                   S01496
     C**  Save branch code and depot number                               S01496
     C*                                                                   S01496
     C                     MOVE VCBRCD    WWBRCD                          S01496
     C**********           Z-ADDVCDDPT    WWDDPT                                       S01496 CSD027
     C                     MOVE VCDDPT    WWDDPT                                              CSD027
     C*                                                                   S01496
     C**  Do while same branch code, depot number and ER Reference        S01496
     C**  and record read for same customer                               S01496
     C*                                                                   S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C           WWCUST    ANDEQVCCNUM                                    S01496
     C           WWERRF    ANDEQVCERRF                                    S01496
     C           WWBRCD    ANDEQVCBRCD                                    S01496
     C           WWDDPT    ANDEQVCDDPT                                    S01496
     C*                                                                   S01496
     C**  Add ex-date nominal position and nominal alloc. to workfields   S01496
     C*                                                                   S01496
     C                     ADD  VCEXPO    WWEXPO                          S01496
     C                     ADD  VCNOMA    WWNOMA                          S01496
     C*                                                                   S01496
     C**  Save details for output                                         S01496
     C*                                                                   S01496
     C                     MOVE VCERRF    W1ERRF  6                       S01496
     C                     MOVE VCBRCD    W1BRCD  3                       S01496
     C**********           Z-ADDVCDDPT    W1DDPT  60                                   S01496 CSD027
     C                     MOVE VCDDPT    W1DDPT  6                                           CSD027
     C                     MOVE VCERTP    W1ERTP  1                       S01496
     C                     MOVE VCBOOK    W1BOOK  2                       S01496
     C                     MOVE VCSESN    W1SESN 10                       S01496
     C                     Z-ADDVCBEDT    W1BEDT  50                      S01496
     C*                                                                   S01496
     C**  Delete record from SEERALPD                                     S01496
     C*                                                                   S01496
     C                     DELETSEERALD4                                  S01496
     C*                                                                   S01496
     C**  Read next record                                                S01496
     C*                                                                   S01496
     C                     READ SEERALL4                 73               S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Save current key fields                                         S01496
     C*                                                                   S01496
     C**********           Z-ADDVCCNUM    W2CUST                                       S01496 CSD027
     C                     MOVE VCCNUM    W2CUST                                              CSD027
     C                     MOVE VCERRF    W2ERRF                          S01496
     C                     MOVE VCBRCD    W2BRCD                          S01496
     C**********           Z-ADDVCDDPT    W2DDPT                                       S01496 CSD027
     C                     MOVE VCDDPT    W2DDPT                                              CSD027
     C*                                                                   S01496
     C**  Set up details for output                                       S01496
     C*                                                                   S01496
     C                     MOVE 'D'       VCRECI                          S01496
     C                     Z-ADDBJRDNB    VCLCD                           S01496
     C                     MOVE 'A'       VCCHTP                          S01496
     C                     MOVE *BLANKS   VCLUID                          S01496
     C                     MOVEL'PM1030'  VCLUID                          S01496
     C                     MOVE W1ERRF    VCERRF                          S01496
     C                     MOVE W1BRCD    VCBRCD                          S01496
     C**********           Z-ADDW1DDPT    VCDDPT                                       S01496 CSD027
     C                     MOVE W1DDPT    VCDDPT                                              CSD027
     C                     MOVE W1ERTP    VCERTP                          S01496
     C                     MOVE W1BOOK    VCBOOK                          S01496
     C**********           Z-ADDWWCUST    VCCNUM                                       S01496 CSD027
     C                     MOVE WWCUST    VCCNUM                                              CSD027
     C                     MOVE *BLANKS   VCPTFR                          S01496
     C                     Z-ADDWWEXPO    VCEXPO                          S01496
     C                     Z-ADDWWNOMA    VCNOMA                          S01496
     C                     MOVE W1SESN    VCSESN                          S01496
     C                     Z-ADDW1BEDT    VCBEDT                          S01496
     C                     MOVE *BLANKS   VCTRRF                          S01496
     C                     MOVE *BLANKS   VCRVRF                          S01496
     C                     Z-ADD*ZEROS    VCPMNO                          S01496
     C                     Z-ADD*ZEROS    VCCFNO                          S01496
     C*                                                                   S01496
     C**  Write customer allocation record                                S01496
     C*                                                                   S01496
     C                     WRITESEERALD4                                  S01496
     C*                                                                   S01496
     C**  Read record to retrieve correct contents of the fields          S01496
     C*                                                                   S01496
     C           KALL2     CHAINSEERALL4             73                   S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C*================================================================   S01496
     C**   CUSTOMER DEPOT POSITIONS BY DATE PROCESSING                    S01496
     C*================================================================   S01496
     C*                                                                   S01496
     C**  Set up an array of all portfolios for customer                  S01496
     C*                                                                   S01496
     C                     MOVE *BLANKS   POR                             S01496
     C                     Z-ADD1         Y       20                      S01496
     C*                                                                   S01496
     C           *LOVAL    SETLLPMPORTPD                                  S01496
     C                     READ PMPORTPD                 73               S01496
     C*                                                                   S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C*                                                                   S01496
     C**  If it's the same customer                                       S01496
     C*                                                                   S01496
     C           WWCUST    IFEQ PNCNUM                                    S01496
     C*                                                                   S01496
     C           PNPTFR    LOKUPPOR                      77               S01496
     C*                                                                   S01496
     C**  If record does not exist in array, add it                       S01496
     C*                                                                   S01496
     C           *IN77     IFEQ '0'                                       S01496
     C                     MOVEAPNPTFR    POR,Y                           S01496
     C                     ADD  1         Y                               S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Read next record                                                S01496
     C*                                                                   S01496
     C                     READ PMPORTPD                 73               S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     Z-ADD*ZEROS    WNBRR                           S01496
     C*                                                                   S01496
     C           WWCUST    SETLLSECDEPL0                                  S01496
     C                     READ SECDEPL0                 73               S01496
     C*                                                                   S01496
     C**  Process record for the same customer                            S01496
     C*                                                                   S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C           WWCUST    ANDEQCDCN                                      S01496
     C*                                                                   S01496
     C**  Save branch, depot, security, market and date                   S01496
     C*                                                                   S01496
     C                     MOVE CDPA      SCDBR   3                       S01496
     C**********           Z-ADDWWCUST    SCDCN   60                                   S01496 CSD027
     C**********           Z-ADDCDPT      SCDPT   60                                   S01496 CSD027
     C                     MOVE WWCUST    SCDCN   6                                           CSD027
     C                     MOVE CDPT      SCDPT   6                                           CSD027
     C                     MOVE CDSN      SCDSN  10                       S01496
     C                     MOVE CDMK      SCDMK   1                       S01496
     C                     Z-ADDDDTE      SDDTE   50                      S01496
     C*                                                                   S01496
     C**  Determine customer position                                     S01496
     C**  Calculate total position for customer, branch, depot,           S01496
     C**  security and date                                               S01496
     C*                                                                   S01496
     C                     EXSR #P10                                      S01496
     C*                                                                   S01496
     C**  SETGT with key of customer being deleted, saved branch,         S01496
     C**  depot, security and date                                        S01496
     C*                                                                   S01496
     C                     MOVE SCDBR     KCDBR                           S01496
     C**********           Z-ADDSCDPT     KCDPT                                        S01496 CSD027
     C                     MOVE SCDPT     KCDPT                                               CSD027
     C                     MOVE SCDSN     KCDSN                           S01496
     C                     Z-ADDSDDTE     KDDTE                           S01496
     C*                                                                   S01496
     C           KEY1      SETGTSECDEPL0                                  S01496
     C*                                                                   S01496
     C**  Read next record                                                S01496
     C*                                                                   S01496
     C                     READ SECDEPL0                 73               S01496
     C*                                                                   S01496
     C**  Write details to CDEPPD                                         S01496
     C*                                                                   S01496
     C                     EXSR #W06                                      S01496
     C*                                                                   S01496
     C           KEY1      SETGTSECDEPL0                                  S01496
     C*                                                                   S01496
     C**  Read next record                                                S01496
     C*                                                                   S01496
     C                     READ SECDEPL0                 73               S01496
     C*                                                                   S01496
     C**  Incrementation of 'Number of records on file'                   S01496
     C*                                                                   S01496
     C                     ADD  1         WNBRR   50                      S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           WWCUST    SETLLSECDEPL0                                  S01496
     C                     READ SECDEPL0                 73               S01496
     C*                                                                   S01496
     C**  Process record for the same customer                            S01496
     C*                                                                   S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C           WWCUST    ANDEQCDCN                                      S01496
     C*                                                                   S01496
     C**  Delete record                                                   S01496
     C*                                                                   S01496
     C                     DELETCDEPPDF                                   S01496
     C*                                                                   S01496
     C**  Subtract 1 from 'Number of records on file'                     S01496
     C*                                                                   S01496
     C                     SUB  1         WNBRR                           S01496
     C*                                                                   S01496
     C**  Read next record                                                S01496
     C*                                                                   S01496
     C                     READ SECDEPL0                 73               S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           1         SETLLCDEPPA                                    S01496
     C                     READ CDEPPA                   73               S01496
     C*                                                                   S01496
     C**  Record not found, terminate program with database error         S01496
     C*                                                                   S01496
     C           *IN73     IFEQ '1'                                       S01496
     C           *LOCK     IN   LDA                                       S01496
     C                     Z-ADD13        DBASE            ***************S01496
     C                     MOVEL'CDEPPA  'DBFILE           * DB ERROR 13 *S01496
     C                     MOVE *BLANKS   DBKEY            ***************S01496
     C                     OUT  LDA                                       S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Calculate new number of records on file                         S01496
     C*                                                                   S01496
     C           NORE      ADD  WNBRR     NORE    50                      S01496
     C*                                                                   S01496
     C**  Update CDEPPA with new number of records on file                S01496
     C*                                                                   S01496
     C                     UPDATCDEPPAF                                   S01496
     C*                                                                   S01496
     C*================================================================   S01496
     C**   GENERAL BLOCKS BY CUSTOMER PROCESSING                          S01496
     C*================================================================   S01496
     C           WWCUST    SETLLSEBLKPL4                                  S01496
     C                     READ SEBLKPL4                 73               S01496
     C*                                                                   S01496
     C**  Process record for the same customer                            S01496
     C*                                                                   S01496
     C           *IN73     DOWEQ'0'                                       S01496
     C           WWCUST    ANDEQVDCNUM                                    S01496
     C*                                                                   S01496
     C                     Z-ADDBJRDNB    VDLCD                           S01496
     C                     MOVE 'A'       VDCHTP                          S01496
     C                     MOVE *BLANKS   VDLUID                          S01496
     C                     MOVEL'PM1030'  VDLUID                          S01496
     C                     MOVE *BLANKS   VDPTFR                          S01496
     C                     UPDATSEBLKPD0                                  S01496
     C*                                                                   S01496
     C                     READ SEBLKPL4                 73               S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  End of S01496 = 'Y'                                             S01496
     C                     END                                            S01496
     C*
     C                     ENDSR                           * #P02 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C*****#P03******-*calculate*historic*positions*on*PF/PMCPOSPP*****   S01486
     C*    #P03      - calculate historic positions on PF/PMCPOSPD        S01486
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #P03      BEGSR                           * #P03 BEGSR *
     C*
     C                     Z-ADD*ZEROS    WWTSNT
     C                     Z-ADD*ZEROS    WWTSNV
     C                     Z-ADD*ZEROS    WWTSEX
     C                     Z-ADD*ZEROS    WWTSPT
     C                     Z-ADD*ZEROS    WWTSPV
     C*
     C**   Access customer positions file
     C                     MOVE *BLANKS   WWCSSC
     C***********          Z-ADD*ZEROS    WWCSBR                          S01486
     C                     MOVEL*BLANKS   WWCSBR                          S01486
     C                     Z-ADD*ZEROS    WWCSDA
     C                     MOVE 'N'       WWFLAG  1                       51939
     C           CAKEY     SETLLPMCPSNL0
     C                     MOVE '0'       *IN73
     C                     READ PMCPSNL0                 73
     C*
     C**   Process records for the same customer
     C           *IN73     DOWEQ'0'                        B1
     C           WWCUST    ANDEQCSCN
     C*
     C**   Access security details
     C           CSSC      CHAINSECTY                74
     C*
     C           *IN74     IFEQ '1'                        B2
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD06        DBASE            ***************
     C                     MOVEL'SECTY   'DBFILE           * DB ERROR 06 *
     C                     MOVELCSSC      DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E2
     C*                                                                   38430
     C** CHAIN FOR INVESTMENT TYPE FOR PROCESSING TYPE                    38430
     C           KINVT     CHAININVTP                74                   38430
     C*                                                                   38430
     C           *IN74     IFEQ '1'                        B2             38430
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD59        DBASE            ***************38430
     C                     MOVEL'INVTP   'DBFILE           * DB ERROR 59 *38430
     C                     MOVELNMCY      DBKEY            ***************38430
     C                     MOVELSITP      DBKEY                           38430
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     38430
     C                     END                             E2             38430
     C*
     C**   Save security reference when change of security
     C                     MOVE CSSC      WWCSSC
     C*
     C**   Process records for same security
     C           *IN73     DOWEQ'0'                        B2
     C           CSSC      ANDEQWWCSSC
     C           CSCN      ANDEQWWCUST                                    38430
     C*
     C**   If details saved and not processed flag 'ON'
     C           WWFLAG    IFEQ 'Y'                        B3
     C*
     C**   and change of branch or position date greater than backvalue
     C***********CSBR      IFNE WWCSBR                     B4             S01486
     C           CSBA      IFNE WWCSBR                     B4             S01486
     C****       CSDA      ORGE WWVDNA                                    51939
     C           CSDA      ORGT WWVDNA                                    51939
     C*
     C**   date, calculate totals and reset flag and fields
     C                     EXSR #P05
     C                     MOVE 'N'       WWFLAG  1
     C                     MOVE *BLANKS   WWCSBR
     C                     Z-ADD*ZEROS    WWCSDA
     C                     Z-ADD*ZEROS    WWCSNT
     C                     Z-ADD*ZEROS    WWCSNV
     C                     Z-ADD*ZEROS    WWCSNS
     C                     Z-ADD*ZEROS    WWCSEX
     C                     Z-ADD*ZEROS    WWCSPT
     C                     Z-ADD*ZEROS    WWCSPV
     C                     END                             E4
     C*
     C                     END                             E3
     C*
     C**   If position date less than backvalue date, seton flag and
     C**   save detail fields
     C****       CSDA      IFLT WWVDNA                     B3             51939
     C           CSDA      IFLE WWVDNA                     B3             51939
     C                     MOVE 'Y'       WWFLAG
     C***********          MOVE CSBR      WWCSBR                          S01486
     C                     MOVE CSBA      WWCSBR                          S01486
     C                     Z-ADDCSDA      WWCSDA
     C                     Z-ADDCSNT      WWCSNT
     C                     Z-ADDCSNV      WWCSNV
     C                     Z-ADDCSNS      WWCSNS
     C                     Z-ADDCSEX      WWCSEX
     C                     Z-ADDCSPT      WWCSPT
     C                     Z-ADDCSPV      WWCSPV
     C                     END                             E3
     C*
     C**   Read next position details
     C                     READ PMCPSNL0                 73
     C                     END                             E2
     C*
     C**   If flag 'ON', calculate totals and reset flag and fields
     C           WWFLAG    IFEQ 'Y'                        B2
     C                     EXSR #P05
     C                     MOVE 'N'       WWFLAG
     C                     MOVE *BLANKS   WWCSBR
     C                     Z-ADD*ZEROS    WWCSDA
     C                     Z-ADD*ZEROS    WWCSNT
     C                     Z-ADD*ZEROS    WWCSNV
     C                     Z-ADD*ZEROS    WWCSNS
     C                     Z-ADD*ZEROS    WWCSEX
     C                     Z-ADD*ZEROS    WWCSPT
     C                     Z-ADD*ZEROS    WWCSPV
     C                     END                             E2
     C*
     C*****Calculate*details*for*output*to*PF/PMCPOSPP*****************   S01486
     C**   Calculate details for output to PF/PMCPOSPD                    S01486
     C                     EXSR #P06
     C                     END                             E1
     C*
     C                     ENDSR                           * #P03 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #P04      - update historic customer actions on PF/CAPRHD
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**             - #P07  - to calculate Trade Portfolio Value
     C**             - #P08  - to calculate Depot Movement Portfolio Value
     C**
     C*=========================================================================
     C*
     C           #P04      BEGSR                           * #P04 BEGSR *
     C*
     C**   For settlement action or price change, set up new PM fields
     C**   to blank or zero and update file
     C           CSSE      IFEQ '0'
     C           CSSE      OREQ '4'
     C                     MOVE '*'       PMTI
     C                     MOVE '*'       PMVI
     C                     MOVE *BLANKS   PTFR
     C                     MOVE *BLANKS   ACIN
     C                     Z-ADD*ZEROS    ITRA
     C                     Z-ADD*ZEROS    CFAP
     C                     Z-ADD*ZEROS    CAVR
     C                     Z-ADD*ZEROS    CFXR
     C                     Z-ADD*ZEROS    CYLD
     C                     Z-ADD*ZEROS    OTHD                            38430
     C                     EXCPTCAPRHU
     C                     END
     C*
     C**   Process trade action or depot movement
     C           CSSE      IFEQ '1'
     C           CSSE      OREQ '3'
     C*
     C**   Access Security for nominal currency
     C           CSSC      CHAINSECTY                74
     C*
     C           *IN74     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD09        DBASE            ***************
     C                     MOVEL'SECTY   'DBFILE           * DB ERROR 09 *
     C                     MOVELCSSC      DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                   B8920
     C** CHAIN FOR INVESTMENT TYPE FOR PROCESSING TYPE                    B8920
     C*                                                                   B8920
     C           KINVT     CHAININVTP                74                   B8920
     C*                                                                   B8920
     C           *IN74     IFEQ '1'                                       B8920
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD59        DBASE            ***************B8920
     C                     MOVEL'INVTP   'DBFILE           * DB ERROR 59 *B8920
     C                     MOVELNMCY      DBKEY            ***************B8920
     C                     MOVELSITP      DBKEY                           B8920
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     B8920
     C                     END                                            B8920
     C**
     C**  Acess  LF/SDCURRL0 for the nominal currency decimal places
     C**
     C***********NMCY      CHAINSDCURRL0             74                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*KEY  '  @OPTN   7                       S01486
     C                     PARM NMCY      @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C************IN74     IFEQ '1'                        ***************S01486
     C           @RTCD     IFNE *BLANKS                    ***************S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD10        DBASE            **DB ERROR 10**
     C***********          MOVEL'SDCURRL0'DBFILE           ***************S01486
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01486
     C                     MOVELNMCY      DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C**
     C                     Z-ADDA6NBDP    NOMCDP  10
     C*
     C* TRADE
     C*
     C           CSSE      IFEQ '1'
     C                     MOVE 'Y'       WFOUND  1
     C                     MOVE CSRF      WWTRAD
     C           TRKEY     CHAINTRADCU               74
     C*
     C           *IN74     IFEQ '1'
     C           CSRF      CHAINHSTTTR               74                   38430
     C           *IN74     IFEQ '1'                                       38430
     C                     MOVE 'N'       WFOUND                          38430
     C                     END                                            38430
     C****                 Z-ADD07        DBASE            ***************38430
     C****                 MOVEL'TRADCU  'DBFILE           * DB ERROR 07 *38430
     C****                 MOVELWWTRAD    DBKEY            ***************38430
     C****                 EXSR *PSSR                                     38430
     C                     END
     C*
     C** CALCULATE TRADE PORTFOLIO VALUE
     C*
     C           WFOUND    IFEQ 'Y'                                       38430
     C                     Z-ADDWWITRA    ITRA                            38430
     C                     EXSR #P07
     C                     END                                            38430
     C*
     C                     END
     C*
     C* DEPOT MOVEMENT
     C*
     C           CSSE      IFEQ '3'
     C*
     C** CALCULATE DEPOT MOVEMENT PORTFOLIO VALUE
     C*
     C                     EXSR #P08
     C*
     C                     END
     C*
     C**   Update PF/CAPRHD
     C           CSSE      IFEQ '1'                                       59512
     C           WWRECI    ANDEQ'C'                                       59512
     C           CSSE      OREQ '1'                                       59512
     C           WWRECI    ANDEQ'*'                                       59512
     C                     GOTO ENDP04                                    59512
     C                     END                                            59512
     C*                                                                   59512
     C           WFOUND    IFEQ 'Y'                                       38430
     C                     EXSR #W04
     C                     END                                            38430
     C                     END
     C*
     C*********************ENDSR                           * #P04 ENDSR * 59512
     C           ENDP04    ENDSR                           * #P04 ENDSR * 59512
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #P05      - maintain running total of positions in security
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #P05      BEGSR                           * #P05 BEGSR *
     C*
     C**   Total trade date nominal
     C                     ADD  WWCSNT    WWTSNT
     C*
     C**   Total value date nominal
     C                     ADD  WWCSNV    WWTSNV
     C*
     C**   Total ex-coupon nominal
     C                     ADD  WWCSEX    WWTSEX
     C*
     C**   Total trade date AP numerator
     C                     ADD  WWCSPT    WWTSPT
     C*
     C**   Total value date AP numerator
     C                     ADD  WWCSPV    WWTSPV
     C*
     C           WWCSDA    IFGT WWDATG
     C                     Z-ADDWWCSDA    WWDATG
     C                     END
     C*
     C                     ENDSR                           * #P05 ENDSR *
1734 C**
1648 C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C*****#P06******-*update*PF/PMCPOSPP******************************   S01486
     C**   #P06      - update PF/PMCPOSPD                                 S01486
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #P06      BEGSR                           * #P06 BEGSR *
     C*
     C**   If trade date nominal not zero, write trade date position
     C           WWTSNT    IFNE *ZEROS
     C                     ADD  1         WWWRIT
     C                     EXSR #W02
     C                     END
     C*
     C**   If value date nominal not zero, write trade date position
     C           WWTSNV    IFNE *ZEROS
     C                     ADD  1         WWWRIT
     C                     EXSR #W03
     C                     END
     C*
     C                     Z-ADD*ZEROS    WWTSNT
     C                     Z-ADD*ZEROS    WWTSNV
     C                     Z-ADD*ZEROS    WWTSEX
     C                     Z-ADD*ZEROS    WWTSPT
     C                     Z-ADD*ZEROS    WWTSPV
     C                     Z-ADD*ZEROS    WWDATG
     C*
     C                     ENDSR                           * #P06 ENDSR *
1734 C**
1648 C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #P07      - Calculate Trade Portfolio Value
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #P07      BEGSR                           * #P07 BEGSR *
     C*
     C* CALCULATE THE TRADE VALUE IN SETTLEMENT CURRENCY
     C*
     C           TVSN      ADD  TVSP      CTVLSC 150
     C                     ADD  TOSV      CTVLSC
     C*
     C* CALCULATE THE EXCHANGE RATE FROM NOMINAL TO SETTLEMENT CURRENCY
     C*
     C           TCTR      IFNE *ZERO
     C           CTVLSC    DIV  TCTR      ERNSC  158H
     C                     ELSE
     C                     Z-ADD*ZERO     ERNSC
     C                     END
     C*
     C* CONVERT PURCHASED INT,CHARGES & COMMISSIONS TO SETTLEMENT CURRENCY
     C*
     C           TBCA      ADD  TCCA      CCTL   150
     C           TCA1      ADD  TCA2      CCCT   150
     C                     ADD  TCA3      CCCT
     C                     ADD  TCA4      CCCT
     C                     ADD  TCA5      CCCT
     C                     ADD  TCA6      CCCT
     C                     ADD  TCA7      CCCT
     C                     ADD  TAXA      CCCT
     C           ITRA      MULT ERNSC     ITRASC 150H
     C           CCTL      MULT ERNSC     CCTLSC 150H
     C           CCCT      MULT ERNSC     CCCTSC 150H
     C*
     C* SUBTRACT PURCHASED INT & CHARGES & COMMISSIONS (IF REQUIRED) FROM
     C* TOTAL VALUE TO GET CUSTOMER TRADE VALUE IN SETTLEMENT CURRENCY
     C*
     C           CTVLSC    SUB  ITRASC    SETAM  150
     C****       CCAP      IFEQ 'Y'                                       38430
     C           CCAP      IFEQ 'N'                                       38430
     C                     SUB  CCTLSC    SETAM
     C                     END
     C****       COCP      IFEQ 'Y'                                       38430
     C           COCP      IFEQ 'N'                                       38430
     C                     SUB  CCCTSC    SETAM
     C                     END
     C**
     C** IF SETTLEMENT CURRENCY EQUALS CUSTOMER BASE CURRENCY
     C**
     C           SETC      IFEQ QBCSBY
     C                     Z-ADDSETAM     CFAP
     C                     Z-ADD1         SPXR
     C                     MOVEL'M'       SPMD
     C                     ELSE
     C**
     C** SET ZAMTF EQUAL TO TRADE VALUE IN SETTLEMENT CURRENCY
     C**
     C                     Z-ADDSETAM     ZAMTF
     C**
     C** SET ZCCYF EQUAL TO SETTLEMENT CURRENCY FROM LF/TRADS
     C**
     C                     MOVELSETC      ZCCYF
     C**
     C**SET ZCCYT EQUAL TO CUSTOMER BASE CURRENCY
     C**
     C                     MOVELQBCSBY    ZCCYT
     C**
     C** DETERMINE EXCHANGE RATE FOR SETTLEMENT CURRENCY
     C**
     C                     MOVELSETC      WWCCYH
     C                     Z-ADDTDDT      WWPDAT
     C**
     C                     EXSR #P09
     C**
     C** SET ZRATEF AND ZMDINF EQUAL TO THE SPOT RATE AND MULTIPLY/DIVIDE
     C** INDICATOR DETERMINED BY #P09
     C**
     C                     Z-ADDWWSPOT    ZRATEF
     C                     MOVELWWMDIN    ZMDINF
     C**
     C** DETERMINE EXCHANGE RATE FOR CUSTOMER BASE CURRENCY
     C**
     C                     MOVELQBCSBY    WWCCYH
     C                     Z-ADDTDDT      WWPDAT
     C**
     C                     EXSR #P09
     C**
     C** SET ZRATET AND ZMDINT EQUAL TO THE SPOT RATE AND MULTIPLY/DIVIDE
     C** INDICATOR DETERMINED BY #P09
     C**
     C                     Z-ADDWWSPOT    ZRATET
     C                     MOVELWWMDIN    ZMDINT
     C**
     C**  ACCESS LF/SDCURRL0 USING THE SETTLEMENT CURRENCY
     C** FOR THE SETTLEMENT CURRENCY DECIMAL PLACES
     C**
     C***********SETC      CHAINSDCURRL0             74                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   @RTCD                           S01486
     C                     PARM '*KEY  '  @OPTN                           S01486
     C                     PARM SETC      @AJCD                           S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C************IN74     IFEQ '1'                        ***************S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD08        DBASE            **DB ERROR 08**
     C***********          MOVEL'SDCURRL0'DBFILE           ***************S01486
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01486
     C                     MOVELSETC      DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C**
     C                     Z-ADDA6NBDP    ZCDPF
     C**
     C** SET ZCDPT EQUAL TO THE CUSTOMER BASE CURRENCY DECIMAL PLACES
     C**
     C                     Z-ADDQBBYDP    ZCDPT
     C**
     C** CONVERT COUNTERVALUE FROM SETTLEMENT CURRENCY TO CUSTOMER BASE CURRENCY
     C**
     C                     EXSR ZCCYCN
     C**
     C                     Z-ADDZAMTT     CFAP
     C                     Z-ADDZCRSRT    SPXR
     C                     MOVELZCRSMD    SPMD
     C                     END
     C**
     C                     ENDSR                           * #P07 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #P08      - Calculate Depot Movement Portfolio Value
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #P08      BEGSR                           * #P08 BEGSR *
     C**
     C** SET ZAMTF EQUAL TO  THE DEPOT MOVEMENT VALUE IN NOMINAL CURRENCY
     C**
     C           CSTB      IFNE *ZERO
     C                     Z-ADDCSTB      ZAMTF
     C                     ELSE
     C                     Z-ADDCSVB      ZAMTF
     C                     END
     C**
     C** SET ZCCYF EQUAL TO THE NOMINAL CURRENCY FROM LF/SECTY
     C**
     C                     MOVELNMCY      ZCCYF
     C**
     C** SET ZCCYT EQUAL TO THE CUSTOMER BASE CURRENCY
     C**
     C                     MOVELQBCSBY    ZCCYT
     C**
     C** DETERMINE EXCHANGE RATE FOR THE NOMINAL CURRENCY
     C**
     C                     MOVELNMCY      WWCCYH
     C**
     C** MOVEMENT DATE IN OR OUT DEPENDING ON WHICH IS NON ZERO
     C**
     C                     Z-ADDCSDA      WWPDAT                          R10049
     C********   DPMD      IFNE 0
     C********             Z-ADDDPMD      WWPDAT
     C********             ELSE
     C********             Z-ADDDPDO      WWPDAT
     C********             END
     C**
     C                     EXSR #P09
     C**
     C** SET ZRATEF AND ZMDINF EQUAL TO THE SPOT RATE AND MULT/DIV
     C** INDICATOR DETERMINED BY #P09
     C**
     C                     Z-ADDWWSPOT    ZRATEF
     C                     MOVELWWMDIN    ZMDINF
     C**
     C** DETERMINE EXCHANGE RATE FOR THE CUSTOMER BASE CURRENCY
     C** THE DATE IS AS ABOVE
     C**
     C                     MOVELQBCSBY    WWCCYH
     C**
     C                     EXSR #P09
     C**
     C** SET ZRATET AND ZMDINT EQUAL TO THE SPOT RATE AND MULT/DIV
     C** INDICATOR DETERMINED BY #P09
     C**
     C                     Z-ADDWWSPOT    ZRATET
     C                     MOVELWWMDIN    ZMDINT
     C**
     C** SET ZCDPF EQUAL TO THE NOMINAL CURRENCY DECIMAL PLACES
     C**
     C                     Z-ADDNOMCDP    ZCDPF
     C**
     C** SET ZCDPT EQUAL TO THE CUSTOMER BASE CURRENCY DECIMAL PLACES
     C**
     C                     Z-ADDQBBYDP    ZCDPT
     C**
     C                     EXSR ZCCYCN
     C**
     C                     Z-ADDZAMTT     CFAP
     C                     ENDSR                           * #P08 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #P09      - Determine Spot Rate,Multiply Divide Indicator
     C**
     C**   CALLED BY -
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #P09      BEGSR                           * #P09 BEGSR *
     C**
     C***********PMHSEX    SETGTPMHSEXPP                                  S01486
     C           PMHSEX    SETGTPMHSEXPD                                  S01486
     C**
     C***READ*PREVIOUS*ON*PF/PMHSEXPP*************************************S01486
     C** READ PREVIOUS ON PF/PMHSEXPD                                     S01486
     C**
     C***********          READPPMHSEXPP                 75               S01486
     C                     READPPMHSEXPD                 75               S01486
     C**
     C           *IN75     IFEQ '0'
     C           WWCCYH    ANDEQQ8CCY
     C**
     C***SET*SPOT*RATE*EQUAL*TO*SPOT*RATE*FROM*PF/PMHSEXPP*************   S01486
     C***&*MUL/DIV*INDICATOR*EQUAL*TO*MULT/DIV*INDICATOR*FROM*PF/PMHSEXPP S01486
     C** SET SPOT RATE EQUAL TO SPOT RATE FROM PF/PMHSEXPD                S01486
     C** & MUL/DIV INDICATOR EQUAL TO MULT/DIV INDICATOR FROM PF/PMHSEXPD S01486
     C**
     C                     Z-ADDQ8SPOT    WWSPOT 138
     C                     MOVE Q8MDV1    WWMDIN  1
     C**
     C** OTHERWISE IF RECORD NOT FOUND GET NEXT AVAILABLE RATE
     C**
     C                     ELSE
     C***********PMHSEX    SETLLPMHSEXPP                                  S01486
     C           PMHSEX    SETLLPMHSEXPD                                  S01486
     C**
     C***READ*FROM*PF/PMHSEXPP********************************************S01486
     C** READ FROM PF/PMHSEXPD                                            S01486
     C**
     C***********          READ PMHSEXPP                 75               S01486
     C                     READ PMHSEXPD                 75               S01486
     C**
     C           *IN75     IFEQ '0'
     C           WWCCYH    ANDEQQ8CCY
     C**
     C***SET*SPOT*RATE*EQUAL*TO*SPOT*RATE*FROM*PF/PMHSEXPP*************   S01486
     C***&*MUL/DIV*INDICATOR*EQUAL*TO*MULT/DIV*INDICATOR*FROM*PF/PMHSEXPP S01486
     C** SET SPOT RATE EQUAL TO SPOT RATE FROM PF/PMHSEXPD                S01486
     C** & MUL/DIV INDICATOR EQUAL TO MULT/DIV INDICATOR FROM PF/PMHSEXPD S01486
     C**
     C                     Z-ADDQ8SPOT    WWSPOT
     C                     MOVE Q8MDV1    WWMDIN
     C**
     C** OTHERWISE IF RECORD NOT FOUND ACCESS SDCURRL0
     C**
     C                     ELSE
     C**
     C***********WWCCYH    CHAINSDCURRL0             76                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   @RTCD                           S01486
     C                     PARM '*KEY  '  @OPTN                           S01486
     C                     PARM WWCCYH    @AJCD                           S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C************IN76     IFEQ '1'                        ***************S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD11        DBASE            **DB ERROR 11**
     C***********          MOVEL'SDCURRL0'DBFILE           ***************S01486
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01486
     C                     MOVELWWCCYH    DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C**
     C** SET SPOT RATE EQUAL TO SPOT RATE FROM SDCURRL0
     C** AND MULT/DIV INDICATOR EQUAL TO MULT/DIV
     C** INDICATOR FROM SDCURRL0
     C**
     C                     Z-ADDA6SPRT    WWSPOT
     C                     MOVELA6MDIN    WWMDIN
     C**
     C                     END
     C**
     C                     END
     C                     ENDSR                           * #P09 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C*****************************************************************   S01496
     C**                                                              *   S01496
     C**   #P10      - Following routine calculates total position    *   S01496
     C**               for customer, branch, depot and security on    *   S01496
     C**               certain date. To do this, the position for each*   S01496
     C**               of the customer's portfolios existing on the   *   S01496
     C**               saved date is obtained. These positions are    *   S01496
     C**               then summed to give the total position.        *   S01496
     C**                                                              *   S01496
     C**   CALLED BY -                                                *   S01496
     C**                                                              *   S01496
     C**   CALLS     - #P11 - Accumulate customer position            *   S01496
     C**                                                              *   S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C           #P10      BEGSR                           * #P10 BEGSR * S01496
     C*                                                                   S01496
     C**  Set workfields containing accumulated values of CECN, CDNT,     S01496
     C**  CDNV AND CDNS to zeros                                          S01496
     C*                                                                   S01496
     C                     Z-ADD*ZEROS    WCECN  150                      S01496
     C                     Z-ADD*ZEROS    WCDNT  150                      S01496
     C                     Z-ADD*ZEROS    WCDNV  150                      S01496
     C                     Z-ADD*ZEROS    WCDNS  150                      S01496
     C                     Z-ADD1         Z       20                      S01496
     C*                                                                   S01496
     C           Z         DOWLTY                                         S01496
     C*                                                                   S01496
     C**  Set up key fields                                               S01496
     C*                                                                   S01496
     C                     MOVE SCDBR     KCDBR1                          S01496
     C**********           Z-ADDSCDPT     KCDPT1                                       S01496 CSD027
     C                     MOVE SCDPT     KCDPT1                                              CSD027
     C                     MOVE SCDSN     KCDSN1                          S01496
     C                     MOVE POR,Z     KPTFR1                          S01496
     C                     Z-ADDSDDTE     KDDTE1                          S01496
     C*                                                                   S01496
     C           KEY2      SETGTSECDEPL2                                  S01496
     C*                                                                   S01496
     C**  Read previous record                                            S01496
     C*                                                                   S01496
     C                     READPSECDEPL2                 74               S01496
     C*                                                                   S01496
     C**  If record read for same branch, depot, security, cust and ptfr  S01496
     C*                                                                   S01496
     C           KCDBR1    IFEQ CDPA                                      S01496
     C           KCDPT1    ANDEQCDPT                                      S01496
     C           KCDSN1    ANDEQCDSN                                      S01496
     C           WWCUST    ANDEQCDCN                                      S01496
     C           KPTFR1    ANDEQPTFR                                      S01496
     C           *IN74     ANDEQ'0'                                       S01496
     C*                                                                   S01496
     C**  Perform SR/#P11 to accumulate customer position                 S01496
     C*                                                                   S01496
     C                     EXSR #P11                                      S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ADD  1         Z                               S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ENDSR                           * #P10 ENDSR * S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
     C/EJECT                                                              S01496
     C*****************************************************************   S01496
     C**                                                              *   S01496
     C**   #P11      - Accumulate customer position                   *   S01496
     C**                                                              *   S01496
     C**   CALLED BY - #P10                                           *   S01496
     C**                                                              *   S01496
     C**   CALLS     -                                                *   S01496
     C**                                                              *   S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C           #P11      BEGSR                           * #P11 BEGSR * S01496
     C*                                                                   S01496
     C**  Set workfields with values of CDNT, CDNV and CDNS               S01496
     C*                                                                   S01496
     C                     ADD  CDNT      WCDNT                           S01496
     C                     ADD  CDNV      WCDNV                           S01496
     C                     ADD  CDNS      WCDNS                           S01496
     C*                                                                   S01496
     C**  Check for existence of coupon/dividend event between position   S01496
     C**  date (CDEPPT) and position date (CDEPDT). If coupon/dividend    S01496
     C**  event found, the ex-coupon nominal should be reset to zero.     S01496
     C*                                                                   S01496
     C                     MOVE SCDSN     KCDSN2                          S01496
     C*                                                                   S01496
     C           PROT      IFEQ '4'                                       S01496
     C                     MOVE 'DV'      KTYPE2                          S01496
     C                     ELSE                                           S01496
     C                     MOVE 'CP'      KTYPE2                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     Z-ADDSDDTE     KDDTE2                          S01496
     C*                                                                   S01496
     C**  SETLL on LF/SECEO with key of saved security, event type 'DV'   S01496
     C**  (for securities processing type 4) or 'CP' and date.            S01496
     C*                                                                   S01496
     C           KEY3      SETLLSECEO                                     S01496
     C*                                                                   S01496
     C**  Read previous record to get next CP/DV event                    S01496
     C*                                                                   S01496
     C                     READPSECEO                    78               S01496
     C*                                                                   S01496
     C           *IN78     IFEQ '0'                                       S01496
     C           @FORM     IFEQ 'SNDEVDF'                                 S01496
     C*                                                                   S01496
     C**  If record read for the same security with event type CP or DV   S01496
     C**  and event date greater than date on SECDEPL2                    S01496
     C*                                                                   S01496
     C           KCDSN2    IFEQ SNSN                                      S01496
     C           SNET      ANDEQ'CP'                                      S01496
     C           SNDT      ANDGTDDTE                                      S01496
     C           KCDSN2    OREQ SNSN                                      S01496
     C           SNET      ANDEQ'DV'                                      S01496
     C           SNDT      ANDGTDDTE                                      S01496
     C                     Z-ADD*ZEROS    CECN                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           KCDSN2    IFEQ SDSN                                      S01496
     C           SDET      ANDEQ'CP'                                      S01496
     C           SDED      ANDGTDDTE                                      S01496
     C           KCDSN2    OREQ SDSN                                      S01496
     C           SDET      ANDEQ'DV'                                      S01496
     C           SDED      ANDGTDDTE                                      S01496
     C                     Z-ADD*ZEROS    CECN                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Add CECN to workfield containing accumulated value of CECN      S01496
     C*                                                                   S01496
     C                     ADD  CECN      WCECN                           S01496
     C*                                                                   S01496
     C                     ENDSR                           * #P11 ENDSR * S01496
     C*                                                                   S01496
     C********************************************************************S01496
      /EJECT
     C**************************************************************************
     C**
     C**   #W01      - print audit report
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #W01      BEGSR                           * #W01 BEGSR *
     C*
     C                     Z-ADDWWRCIN    RRRCIN
     C                     Z-ADDWWRCDL    RRRCDL
     C*
     C                     WRITEHEADAU
     C                     WRITETOTAU
     C***********          WRITEENDAU                                     S01486
     C*                                                                   S01496
     C**  If S01496 is installed, close appropriate files                 S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C                     CLOSESECDEPL0                                  S01496
     C                     CLOSESECDEPL2                                  S01496
     C                     CLOSECDEPD                                     S01496
     C                     CLOSECDEPPA                                    S01496
     C                     CLOSESEERALL3                                  S01496
     C                     CLOSESEERALL4                                  S01496
     C                     CLOSESEBLKPL4                                  S01496
     C                     CLOSEPMPORTPD                                  S01496
     C                     END                                            S01496
     C*
     C                     ENDSR                           * #W01 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C*****#W02******-*generate*trade*date*position*on*PF/PMCPOSPP*****   S01486
     C**   #W02      - generate trade date position on PF/PMCPOSPD        S01486
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #W02      BEGSR                           * #W02 BEGSR *
     C*
     C****                 MOVE 'H'       QARECI                          38430
     C                     MOVE 'D'       QARECI                          38430
     C**********           Z-ADDWWCUST    QACNUM                                              CSD027
     C                     MOVE WWCUST    QACNUM                                              CSD027
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    QAPTFR                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    QAPTFR
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C025
     C                     MOVE WWCSSC    QATDSS
     C                     MOVE 'T'       QATVDA
     C                     Z-ADDWWDATG    QAPDAT
     C                     Z-ADDWWTSNT    QANOML
     C                     Z-ADDWWTSEX    QACSEX
     C                     Z-ADDWWTSPT    QAAPNM
     C*                                                                   38430
     C** CALCULATE FX AP NUMERATOR. TO DO THIS:                           38430
     C** 1  DETEMINE CROSS RATE NOMINAL TO PORTFOLIO CURRENCY ON POSITION 38430
     C**    DATE                                                          38430
     C** 2  CONVERT AP NUMERATOR USING THIS RATE                          38430
     C                     Z-ADD*ZEROS    QAFXAP                          38430
     C                     MOVE NMCY      WWCCYH                          38430
     C                     Z-ADDQAPDAT    WWPDAT                          38430
     C                     EXSR #P09                                      38430
     C                     MOVE NMCY      ZCCYF                           38430
     C                     Z-ADDWWSPOT    ZRATEF                          38430
     C                     MOVELWWMDIN    ZMDINF                          38430
     C                     Z-ADDQ8CDP     ZCDPF                           38430
     C                     Z-ADDQ8CDP     WS8CDP  10                      38430
     C*                                                                   38430
     C** Perform S/R #P09 for Customer Base Currency                      38430
     C                     MOVELQBCSBY    WWCCYH                          38430
     C                     EXSR #P09                                      38430
     C                     MOVE QBCSBY    ZCCYT                           38430
     C                     Z-ADDWWSPOT    ZRATET                          38430
     C                     MOVELWWMDIN    ZMDINT                          38430
     C                     Z-ADDQBBYDP    ZCDPT                           38430
     C*                                                                   38430
     C** CONVERT AP NUMERATOR INTO FX AP NUMERATOR                        38430
     C                     Z-ADDQAAPNM    ZAMTF                           38430
     C                     EXSR ZCCYCN                                    38430
     C                     Z-ADDZAMTT     QAFXAP                          38430
     C*                                                                   38430
     C                     Z-ADD*ZEROS    QAPILP
     C                     Z-ADD*ZEROS    QAACDI
     C                     Z-ADD*ZEROS    QABVLD
     C                     MOVE NMCY      QATNMC
     C                     Z-ADDNMDP      QATNMD
     C                     MOVE QBCSBY    QAPTCY
     C                     Z-ADDQBBYDP    QAPCDP
     C*                                                                   38430
     C** CALCULATE YIELD ON POSITION IF REQUIRED                          38430
     C                     Z-ADD*ZEROS    QAAYNM                          38430
     C           PROT      IFEQ '1'                        B1             38430
     C           PROT      OREQ '3'                                       38430
     C           PROT      OREQ '5'                                       38430
     C           PROT      OREQ '6'                                       38430
     C           PROT      OREQ '8'                                       38430
     C           PROT      OREQ '9'                                       38430
     C*                                                                   38430
     C           MATY      IFNE *ZERO                      B2             38430
     C*                                                                   38430
     C** IF THE SECURITY IS INTEREST BEARING,USE AIBD METHOD,ELSE DISCOUNT38430
     C*                                                                   38430
     C           CD01      IFNE *ZERO                      B3             38430
     C                     MOVEL'A '      SYBS                            38430
     C                     ELSE                            X3             38430
     C                     MOVEL'DA'      SYBS                            38430
     C                     END                             E3             38430
     C*                                                                   38430
     C           DYBS      IFEQ '4'                        B3             38430
     C                     MOVE '3'       DYBS                            38430
     C                     MOVE '1'       DVBS                            38430
     C                     END                             E3             38430
     C*                                                                   38430
     C** PRICE USED IN CALCULATIONS SHOULD BE AVERAGE PRICE               38430
     C                     Z-ADDQANOML    ZNOML                           38430
     C                     Z-ADDQAAPNM    ZVALU                           38430
     C                     Z-ADDNMDP      ZNMDP                           38430
     C                     Z-ADDWS8CDP    ZNMCD                           38430
     C                     MOVE SPBS      ZPRCB                           38430
     C                     EXSR ZAVPRC                                    38430
     C                     Z-ADDZAVPR     ZPRICE                          38430
     C                     Z-ADDQAPDAT    ZFDATE                          38430
     C                     Z-ADDZFDATE    ECD                             38430
     C           SERECI    IFEQ 'D'                                       61228
     C                     EXSR ZYLDO                                     38430
     C*                                                                   38430
     C** CONVERT YIELD RETURNED FROM SR/ZYLDO TO THE AVERAGE YIELD        38430
     C***NUMERATOR*TO*BE*OUTPUT*ON*PMCPOSPP*************************38430 S01486
     C** NUMERATOR TO BE OUTPUT ON PMCPOSPD                               S01486
     C                     Z-ADDQANOML    ZNOML                           38430
     C                     Z-ADDZYLDOT    ZAVYD                           38430
     C                     Z-ADDNMDP      ZNMDP                           38430
     C                     Z-ADDWS8CDP    ZNMCD                           38430
     C                     EXSR ZAYNUM                                    38430
     C                     ELSE                                           61228
     C                     Z-ADD0         ZVALU                           61228
     C                     END                                            61228
     C                     Z-ADDZVALU     QAAYNM                          38430
     C                     END                             E2             38430
     C                     END                             E1             38430
     C*                                                                   38430
     C                     MOVE QBCSBY    QACSBY                          38430
     C                     Z-ADDQBBYDP    QABYDP                          38430
     C*                                                                   38430
     C***OBTAIN*CUSTOMER*CLASSIFICATION*FROM*LF/SDSECSL0************38430 S01486
     C***********QBCUST    CHAINSDSECSL0             74             38430 S01486
     C** Obtain customer classification from SDSECSPD                     S01486
     C                     CALL 'AOSECSR0'                                S01486
     C                     PARM *BLANKS   @RTCD                           S01486
     C                     PARM '*KEY  '  @OPTN                           S01486
     C                     PARM           QBCUST                          S01486
     C           SDSECS    PARM SDSECS    DSSDY                           S01486
     C*                                                                   38430
     C************IN74     IFEQ '1'                                 38430 S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD61        DBASE            ***************38430
     C***********          MOVEL'SDSECSL0'DBFILE           * DB ERRO38430 S01486
     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 59 *S01486
     C                     MOVELQBCUST    DBKEY            ***************38430
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     38430
     C                     END                                            38430
     C*                                                                   38430
     C                     MOVE BFCLAS    QACLAS                          38430
     C*                                                                   38430
     C** OBTAIN ACCOUNT OFFICER CODE FROM LF/SDCUSTL0                     38430
     C***********QBCUST    CHAINSDCUSTL0             74             38430 S01486
     C                     MOVEL*BLANKS   KEYCN                           S01486
     C                     MOVELQBCUST    KEYCN                           S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   @RTCD                           S01486
     C                     PARM '*KEY  '  @OPTN                           S01486
     C                     PARM           KEYCN  10                       S01486
     C                     PARM *BLANKS   KEYST   7                       S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C*                                                                   38430
     C************IN74     IFEQ '1'                                 38430 S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD62        DBASE            ***************38430
     C***********          MOVEL'SDCUSTL0'DBFILE           * DB ERRO38430 S01486
     C                     MOVEL'SDCUSTPD'DBFILE           * DB ERROR 59 *S01486
     C                     MOVELQBCUST    DBKEY            ***************38430
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     38430
     C                     END                                            38430
     C*                                                                   38430
     C                     MOVE BBACOC    QAACOC                          38430
     C*                                                                   38430
     C                     Z-ADDWWTSNV    QAOTNM                          38430
     C                     Z-ADDWWTSEX    QAOTEX                          38430
     C                     MOVE 'Y'       QAAPBC                          38430
     C                     MOVE *BLANKS   QAFLEX                          38430
     C                     MOVE SCOR      QACOLC                          38430
     C                     MOVE BBBRCD    QABRCD                          38430
     C                     Z-ADD0         QANPDT                          38430
     C****                 MOVE 'Y'       QAPFMR                    38430 61063
     C                     MOVE 'N'       QAPFMR                          61063
     C*                                                                   38430
     C                     WRITEPMCPOSP0
     C*
     C                     ENDSR                           * #W02 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C*****#W03******-*generate*value*date*position*on*PF/PMCPOSPP*****   S01486
     C**   #W03      - generate value date position on PF/PMCPOSPD        S01486
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #W03      BEGSR                           * #W03 BEGSR *
     C*
     C****                 MOVE 'H'       QARECI                          38430
     C                     MOVE 'D'       QARECI                          38430
     C**********           Z-ADDWWCUST    QACNUM                                              CSD027
     C                     MOVE WWCUST    QACNUM                                              CSD027
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    QAPTFR                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    QAPTFR
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C026
     C                     MOVE WWCSSC    QATDSS
     C                     MOVE 'V'       QATVDA
     C                     Z-ADDWWDATG    QAPDAT
     C                     Z-ADDWWTSNV    QANOML
     C                     Z-ADDWWTSEX    QACSEX
     C                     Z-ADDWWTSPV    QAAPNM
     C*                                                                   38430
     C** CALCULATE FX AP NUMERATOR. TO DO THIS:                           38430
     C** 1  DETEMINE CROSS RATE NOMINAL TO PORTFOLIO CURRENCY ON POSITION 38430
     C**    DATE                                                          38430
     C** 2  CONVERT AP NUMERATOR USING THIS RATE                          38430
     C                     Z-ADD*ZEROS    QAFXAP                          38430
     C                     MOVE NMCY      WWCCYH                          38430
     C                     Z-ADDQAPDAT    WWPDAT                          38430
     C                     EXSR #P09                                      38430
     C                     MOVE NMCY      ZCCYF                           38430
     C                     Z-ADDWWSPOT    ZRATEF                          38430
     C                     MOVELWWMDIN    ZMDINF                          38430
     C                     Z-ADDQ8CDP     ZCDPF                           38430
     C                     Z-ADDQ8CDP     WS8CDP  10                      38430
     C*                                                                   38430
     C** Perform S/R #P09 for Customer Base Currency                      38430
     C                     MOVELQBCSBY    WWCCYH                          38430
     C                     EXSR #P09                                      38430
     C                     MOVE QBCSBY    ZCCYT                           38430
     C                     Z-ADDWWSPOT    ZRATET                          38430
     C                     MOVELWWMDIN    ZMDINT                          38430
     C                     Z-ADDQBBYDP    ZCDPT                           38430
     C*                                                                   38430
     C** CONVERT AP NUMERATOR INTO FX AP NUMERATOR                        38430
     C                     Z-ADDQAAPNM    ZAMTF                           38430
     C                     EXSR ZCCYCN                                    38430
     C                     Z-ADDZAMTT     QAFXAP                          38430
     C*                                                                   38430
     C                     Z-ADD*ZEROS    QAPILP
     C                     Z-ADD*ZEROS    QAACDI
     C                     Z-ADD*ZEROS    QABVLD
     C                     MOVE NMCY      QATNMC
     C                     Z-ADDNMDP      QATNMD
     C                     MOVE QBCSBY    QAPTCY
     C                     Z-ADDQBBYDP    QAPCDP
     C*                                                                   38430
     C** CALCULATE YIELD ON POSITION IF REQUIRED                          38430
     C                     Z-ADD*ZEROS    QAAYNM                          38430
     C           PROT      IFEQ '1'                        B1             38430
     C           PROT      OREQ '3'                                       38430
     C           PROT      OREQ '5'                                       38430
     C           PROT      OREQ '6'                                       38430
     C           PROT      OREQ '8'                                       38430
     C           PROT      OREQ '9'                                       38430
     C*                                                                   38430
     C           MATY      IFNE *ZERO                      B2             38430
     C*                                                                   38430
     C** IF THE SECURITY IS INTEREST BEARING,USE AIBD METHOD,ELSE DISCOUNT38430
     C*                                                                   38430
     C           CD01      IFNE *ZERO                      B3             38430
     C                     MOVEL'A '      SYBS                            38430
     C                     ELSE                            X3             38430
     C                     MOVEL'DA'      SYBS                            38430
     C                     END                             E3             38430
     C*                                                                   38430
     C           DYBS      IFEQ '4'                        B3             38430
     C                     MOVE '3'       DYBS                            38430
     C                     MOVE '1'       DVBS                            38430
     C                     END                             E3             38430
     C*                                                                   38430
     C** PRICE USED IN CALCULATIONS SHOULD BE AVERAGE PRICE               38430
     C                     Z-ADDQANOML    ZNOML                           38430
     C                     Z-ADDQAAPNM    ZVALU                           38430
     C                     Z-ADDNMDP      ZNMDP                           38430
     C                     Z-ADDWS8CDP    ZNMCD                           38430
     C                     MOVE SPBS      ZPRCB                           38430
     C                     EXSR ZAVPRC                                    38430
     C                     Z-ADDZAVPR     ZPRICE                          38430
     C                     Z-ADDQAPDAT    ZFDATE                          38430
     C                     Z-ADDZFDATE    ECD                             38430
     C           SERECI    IFEQ 'D'                                       61228
     C                     EXSR ZYLDO                                     38430
     C*                                                                   38430
     C** CONVERT YIELD RETURNED FROM SR/ZYLDO TO THE AVERAGE YIELD        38430
     C***NUMERATOR*TO*BE*OUTPUT*ON*PMCPOSPP*************************38430 S01486
     C** NUMERATOR TO BE OUTPUT ON PMCPOSPD                               S01486
     C                     Z-ADDQANOML    ZNOML                           38430
     C                     Z-ADDZYLDOT    ZAVYD                           38430
     C                     Z-ADDNMDP      ZNMDP                           38430
     C                     Z-ADDWS8CDP    ZNMCD                           38430
     C                     EXSR ZAYNUM                                    38430
     C                     ELSE                                           61228
     C                     Z-ADD0         ZVALU                           61228
     C                     END                                            61228
     C                     Z-ADDZVALU     QAAYNM                          38430
     C                     END                             E2             38430
     C                     END                             E1             38430
     C*                                                                   38430
     C                     MOVE QBCSBY    QACSBY                          38430
     C                     Z-ADDQBBYDP    QABYDP                          38430
     C*                                                                   38430
     C***OBTAIN*CUSTOMER*CLASSIFICATION*FROM*LF/SDSECSL0************38430 S01486
     C***********QBCUST    CHAINSDSECSL0             74             38430 S01486
     C** Obtain Customer Classification from SDSECSPD                     S01486
     C                     CALL 'AOSECSR0'                                S01486
     C                     PARM *BLANKS   @RTCD                           S01486
     C                     PARM '*KEY  '  @OPTN                           S01486
     C                     PARM           QBCUST                          S01486
     C           SDSECS    PARM SDSECS    DSSDY                           S01486
     C*                                                                   38430
     C************IN74     IFEQ '1'                                 38430 S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD61        DBASE            ***************38430
     C***********          MOVEL'SDSECSL0'DBFILE           * DB ERRO38430 S01486
     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 59 *S01486
     C                     MOVELQBCUST    DBKEY            ***************38430
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     38430
     C                     END                                            38430
     C*                                                                   38430
     C                     MOVE BFCLAS    QACLAS                          38430
     C*                                                                   38430
     C** OBTAIN ACCOUNT OFFICER CODE FROM LF/SDCUSTL0                     38430
     C***********QBCUST    CHAINSDCUSTL0             74             38430 S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   @RTCD                           S01486
     C                     PARM '*KEY  '  @OPTN                           S01486
     C                     PARM QBCUST    KEYCN                           S01486
     C                     PARM *BLANKS   KEYST                           S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C*                                                                   38430
     C************IN74     IFEQ '1'                                 38430 S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD62        DBASE            ***************38430
     C***********          MOVEL'SDCUSTL0'DBFILE           * DB ERRO38430 S01486
     C                     MOVEL'SDCUSTPD'DBFILE           * DB ERROR 59 *S01486
     C                     MOVELQBCUST    DBKEY            ***************38430
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     38430
     C                     END                                            38430
     C*                                                                   38430
     C                     MOVE BBACOC    QAACOC                          38430
     C*                                                                   38430
     C                     Z-ADDWWTSNT    QAOTNM                          38430
     C                     Z-ADDWWTSEX    QAOTEX                          38430
     C                     MOVE 'Y'       QAAPBC                          38430
     C                     MOVE *BLANKS   QAFLEX                          38430
     C                     MOVE SCOR      QACOLC                          38430
     C                     MOVE BBBRCD    QABRCD                          38430
     C                     Z-ADD0         QANPDT                          38430
     C                     MOVE 'Y'       QAPFMR                          38430
     C*
     C                     WRITEPMCPOSP0
     C*
     C                     ENDSR                           * #W03 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #W04      - update PM details on PF/CAPRHD
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #W04      BEGSR                           * #W04 BEGSR *
     C*
     C           CSTB      IFNE *ZEROS
     C*                                                                   38430
     C           CSDA      IFGT WWVDNA                                    38430
     C                     MOVE 'D'       PMTI
     C                     ELSE                                           38430
     C                     MOVE 'H'       PMTI                            38430
     C                     END                                            38430
     C*                                                                   38430
     C                     ELSE
     C                     MOVE '*'       PMTI
     C                     END
     C*
     C           CSVB      IFNE *ZEROS
     C*                                                                   38430
     C           CSDA      IFGT WWVDNA                                    38430
     C                     MOVE 'D'       PMVI
     C                     ELSE                                           38430
     C                     MOVE 'H'       PMVI                            38430
     C                     END                                            38430
     C*                                                                   38430
     C                     ELSE
     C                     MOVE '*'       PMVI
     C                     END
     C*
     C           PTFR      IFEQ *BLANKS                                   EMFIX
     C/COPY WNCPYSRC,PM1030C027
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE WWCUST    ZZCNUM                          CPB001
     C                     EXSR #CUST                                     CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE '9997'    PTFR
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,PM1030C028
     C                     END                                            EMFIX
     C*
     C           CSSE      IFEQ '3'
     C                     MOVE *BLANK    ACIN
     C                     Z-ADD*ZEROS    ITRA
     C           CSE015    IFEQ 'N'                                       178439
     C           CSDA      IFGT WWVDNA                                    51939
     C                     MOVE 'D'       PMVI                            B8920
     C                     MOVE 'D'       PMTI                            B8920
     C                     ELSE                                           51939
     C                     MOVE 'H'       PMVI                            51939
     C                     MOVE 'H'       PMTI                            51939
     C                     END                                            51939
     C                     END                                            178439
     C*                                                                   51939
     C                     END
     C*
     C           CSSE      IFEQ '1'
     C                     MOVE WWACIN    ACIN
     C                     Z-ADDWWITRA    ITRA
     C                     END
     C*
     C** CFAP HAS BEEN DETERMINED WITHIN P07 OR P08
     C*
     C**
     C** DETERMINE THE CUSTOMER FX RATE USING STANDARD SUBROUTINE
     C** ZFXAVP
     C**
     C           CSTB      IFNE *ZERO
     C                     Z-ADDCSTB      ZAPNM
     C                     Z-ADDTDVD      OTHD                            38430
     C                     ELSE
     C                     Z-ADDCSVB      ZAPNM
     C                     Z-ADDTDDT      OTHD                            38430
     C                     END
     C                     Z-ADDCFAP      ZFXAP
     C                     Z-ADDNOMCDP    ZNMCD
     C                     Z-ADDQBBYDP    ZPTCD
     C**
     C                     EXSR ZFXAVP
     C**
     C** SET CUSTOMER FX RATE ON PF/CAPRHD EQUAL TO THE AVERAGE EXCHANGE
     C** RATE ZAVFX FROM SR ZFXAVP
     C**
     C                     Z-ADDZAVFX     CFXR
     C**
     C                     Z-ADD*ZEROS    CAVR
     C*                                                                   B8920
     C** CALCULATE YIELD FROM THE TRADE /DEPOT MOVEMENT PRICE             B8920
     C*                                                                   B8920
     C                     Z-ADD*ZERO     CYLD                            B8920
     C           PROT      IFEQ '1'                        B1             B8920
     C           PROT      OREQ '3'                                       B8920
     C           PROT      OREQ '5'                                       B8920
     C           PROT      OREQ '6'                                       B8920
     C           PROT      OREQ '8'                                       B8920
     C           PROT      OREQ '9'                                       B8920
     C*                                                                   B8920
     C           MATY      IFNE *ZERO                      B2             B8920
     C*******    DYBS      ANDNE'4'                                       B8920
     C*                                                                   B8920
     C** IF THE SECURITY IS INTEREST BEARING,USE AIBD METHOD,ELSE DISCOUNTB8920
     C*                                                                   B8920
     C           CD01      IFNE *ZERO                      B3             B8920
     C                     MOVEL'A '      SYBS                            B8920
     C                     ELSE                            X3             B8920
     C                     MOVEL'DA'      SYBS                            B8920
     C                     END                             E3             B8920
     C*                                                                   B8920
     C           DYBS      IFEQ '4'                        B3             B8920
     C                     MOVE '3'       DYBS                            B8920
     C                     MOVE '1'       DVBS                            B8920
     C                     END                             E3             B8920
     C*                                                                   B8920
     C** IF A TRADE,CALCULATE USING PRICE FROM TRADE AND VALUE DATE       B8920
     C** FROM CAPRHD                                                      B8920
     C***********          Z-ADDCSAP      ZPRICE 158                      B8920
     C           CSSE      IFEQ '1'                        B3             B8920
     C                     Z-ADDPRIC      ZPRICE 158                      B8920
     C                     Z-ADDTDVD      ZFDATE  50                      B8920
     C*                                                                   B8920
     C** ...OTHERWISE TAKE COUPON RATE FROM SECURITY DATE FROM CAPRHD     B8920
     C                     ELSE                            X3             B8920
     C                     Z-ADDMKTP      ZPRICE 158                      B8920
     C                     Z-ADDCSDA      ZFDATE                          B8920
     C                     END                             E3             B8920
     C                     Z-ADDZFDATE    ECD     50                      B8920
     C           SERECI    IFEQ 'D'                                       61228
     C                     EXSR ZYLDO                                     B8920
     C                     ELSE                                           61228
     C                     Z-ADD0         ZYLDOT                          61228
     C                     END                                            61228
     C                     Z-ADDZYLDOT    CYLD                            B8920
     C                     END                             E2             B8920
     C                     END                             E1             B8920
     C*
     C                     EXCPTCAPRHU
     C*
     C                     ENDSR                           * #W04 ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C*****#W05******-*update*deal*type/sub-type*details*on*PF/SDDTSTPP   S01486
     C*    #W05      - update deal type/sub-type details on PF/FDDTSTPD   S01486
     C**
     C**   CALLED BY - #P01  - portfolio customer insertion processing
     C**
     C**   CALLS     -
     C**
     C*=========================================================================
     C*
     C           #W05      BEGSR                           * #W05 BEGSR *
     C*
     C***********          MOVE 'D'       P7RECI                          S01486
     C***********          MOVE BJMRDT    WWDLUP                          S01486
     C***********          TIME           P7TLUP                          S01486
     C***********          MOVE 'I'       P7CHTP                          S01486
     C***********          Z-ADDBJRDNB    P7LCD                           S01486
     C***********          Z-ADD*ZEROS    P7TNLU                          S01486
     C***********          MOVE DTYP      P7DTYP                          S01486
     C***********          MOVE DLST      P7DLST                          S01486
     C***********          MOVE *BLANKS   P7DTNR                          S01486
     C***********          MOVEL'DEALING' P7DTNR                          S01486
     C***********          MOVE P9DINR    P7INNR                          S01486
     C***********          Z-ADD*ZEROS    P7SWNB                          S01486
     C                     MOVE 'D'       RCID11                          S01486
     C                     MOVE 'I'       TYLC11                          S01486
     C                     Z-ADDBJRDNB    LCD11                           S01486
     C                     MOVE DTYP      DTPE11                          S01486
     C                     MOVE DLST      DLST11                          S01486
     C                     MOVE *BLANKS   NARR11                          S01486
     C                     MOVEL'DEALING' NARR11                          S01486
     C                     MOVE FCDINR    INNR                            S01486
     C*
     C***********          WRITESDDTSTP0                                  S01486
     C                     WRITEFDDTSTPD                                  S01486
     C*
     C                     ENDSR                           * #W05 ENDSR *
     C**
     C**************************************************************************
     C/EJECT                                                              S01496
     C*****************************************************************   S01496
     C**                                                              *   S01496
     C**   #W06      -  Write details to CDEPPD                       *   S01496
     C**                                                              *   S01496
     C**   CALLED BY -                                                *   S01496
     C**                                                              *   S01496
     C**   CALLS     -                                                *   S01496
     C**                                                              *   S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C           #W06      BEGSR                           * #W06 BEGSR * S01496
     C*                                                                   S01496
     C           SCDCN     IFEQ CDCN                                      S01496
     C           SCDBR     ANDEQCDPA                                      S01496
     C           SCDPT     ANDEQCDPT                                      S01496
     C           SCDSN     ANDEQCDSN                                      S01496
     C                     MOVE 'H'       RECI             Record Id      S01496
     C                     ELSE                                           S01496
     C                     MOVE 'D'       RECI             Record Id      S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     MOVE SCDBR     CDPA             Branch         S01496
     C**********           Z-ADDSCDCN     CDCN             Customer                    S01496 CSD027
     C                     MOVE SCDCN     CDCN             Customer                           CSD027
     C                     MOVE SCDSN     CDSN             Security Short S01496
     C**********           Z-ADDSCDPT     CDPT             Depot                       S01496 CSD027
     C                     MOVE SCDPT     CDPT             Depot                              CSD027
     C                     MOVE SCDMK     CDMK             Market Indic.  S01496
     C                     Z-ADDSDDTE     DDTE             Date           S01496
     C                     Z-ADDWCECN     CECN             Ex-Coupon Nom. S01496
     C                     Z-ADDWCDNT     CDNT             Nominal - Trad S01496
     C                     Z-ADDWCDNV     CDNV             Nominal - Val. S01496
     C                     Z-ADD*ZEROS    SNPT             Sum Nominal    S01496
     C                     Z-ADD*ZEROS    CDST             Sum Nominal    S01496
     C                     Z-ADDWCDNS     CDNS             Nominal - Sett S01496
     C                     Z-ADD*ZEROS    SAPP             Sum AP Numerat S01496
     C                     Z-ADD*ZEROS    SAPS             Sum AP Numerat S01496
     C                     Z-ADD*ZEROS    CNPV             Sum Nom - P    S01496
     C                     Z-ADD*ZEROS    CNSV             Sum Nom - S    S01496
     C                     Z-ADD*ZEROS    SAPV             Sem AP Num - P S01496
     C                     Z-ADD*ZEROS    SPSV             Sum AP Num - S S01496
     C                     Z-ADD*ZEROS    CNSI             Nominal Settl. S01496
     C                     Z-ADD*ZEROS    TNLU             Trans No of L  S01496
     C                     MOVE *BLANKS   PTFR             Portfolio Ref  S01496
     C*                                                                   S01496
     C                     WRITECDEPPDF                                   S01496
     C*                                                                   S01496
     C                     ENDSR                           * #W06 ENDSR * S01496
     C**                                                                  S01496
     C*****************************************************************   S01496
      /EJECT
     C/COPY ZSRSRC,ZYLDOZ1
     C/COPY ZSRSRC,ZYLDZ2
     C/COPY ZSRSRC,ZDAYSZ2
     C/COPY ZSRSRC,ZDYYRZ3
     C/COPY ZSRSRC,ZDATE2Z4
     C/COPY ZSRSRC,ZDATE1Z2
     C/COPY ZSRSRC,ZNCDZ3
     C/COPY ZSRSRC,ZLCDZ1
      /EJECT
      /COPY ZSRSRC,ZCCYCN                                                  47719
      /EJECT                                                               47719
      /COPY ZSRSRC,ZCCYXR                                                  47719
     C/COPY ZSRSRC,ZACCZZ1                                                S01486
     C/COPY ZSRSRC,ZCNSDZ1                                                S01486
     C/COPY ZSRSRC,ZCALCD                                                 S01486
     C/COPY ZSRSRC,ZACCRZ1                                                S01486
     C/COPY ZSRSRC,ZRATEZ1                                                S01486
      /EJECT                                                               47719
     C/COPY ZSRSRC,ZFXAVP                                                 049213
     C*************************************************************************
     C*                                                                       *
     C*  ZFXAVP - CALCULATE AVERAGE FX RATE                                   *
     C*                                                                       *
     C*  PURPOSE : TO CALCULATE AN AVERAGE FX RATE (VALUE OF HOLDING IN       *
     C*            PORTFOLIO CURRENCY DIVIDED BY VALUE IN NOMINAL CURRENCY)   *
     C*                                                                       *
     C*  INPUT  FIELDS                                                        *
     C*       ZAPNM  15 0     AVERAGE PRICE NUMERATOR                         *
     C*       ZFXAP  15 0     FX AVERAGE PRICE NUMERATOR                      *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3)           *
     C*       ZPTCD   1 0     PORTFOLIO CURRENCY DECIMAL PLACES (0-3)         *
     C*                                                                       *
     C*  OUTPUT  FIELDS                                                       *
     C*       ZAVFX  13 8     AVERAGE FX RATE                                 *
     C*                                                                       *
     C*  ALSO REQUIRED                                                        *
     C*       POWER8 ARRAY    ARRAY FOR CURRENCY CONVERSIONS                  *
     C*                                                                       *
     C*  WORK FIELDS:                                                          *
     C*       ZI      1 0     INDEX TO POWER ARRAY                            *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                       *
     C*************************************************************************
     C********** ZFXAVP    BEGSR                           *** ZFXAVP *** 049213
     C*
     C** DEFINE ALL FIELDS
     C*
     C**********           Z-ADDZAPNM     ZAPNM  150                      049213
     C**********           Z-ADDZFXAP     ZFXAP  150                      049213
     C**********           Z-ADDZNMCD     ZNMCD   10                      049213
     C**********           Z-ADDZPTCD     ZPTCD   10                      049213
     C**********           Z-ADDZAVFX     ZAVFX  138                      049213
     C*
     C** IF AP NUMERATOR = 0   END PROCESS
     C********** ZAPNM     IFEQ 0                                         049213
     C**********           Z-ADD0         ZAVFX                           049213
     C*
     C** IF AP NUMERATOR NOT = ZEROS
     C**********           ELSE                                           049213
     C*
     C** DIVIDE FX AP NUMERATOR BY AP NUMERATOR
     C********** ZFXAP     DIV  ZAPNM     ZAVFX     H                     049213
     C*
     C** SET POWER8 INDEX TO 5 - NBR NOM CCY DEC. PLACES + NBR PORT CCY DEC. PL.
     C********** 5         SUB  ZNMCD     ZI      10                      049213
     C**********           ADD  ZPTCD     ZI                              049213
     C*
     C** DIVIDE AVERAGE PRICE BY POWER
     C********** ZAVFX     DIV  POWER8,ZI ZAVFX     H                     049213
     C*
     C** SET AVERAGE PRICE POSITIVE
     C********** ZAVFX     IFLE 0                                         049213
     C**********           Z-SUBZAVFX     ZAVFX                           049213
     C**********           END                                            049213
     C*
     C** END CONDITION NOMINAL = ZERO
     C**********           END                                            049213
     C*
     C********** ZXAVP9    ENDSR                                          049213
      **************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C**   #INIT     - to initialize static fields and access bank details
     C**
     C**   CALLED BY - main processing
     C**
     C**   CALLS
     C**
     C*=========================================================================
     C*
     C           #INIT     BEGSR                           * #INIT BEGSR *
     C*
     C/COPY WNCPYSRC,PM1030C031
     C**   Define work fields
     C           *LIKE     DEFN TDRF      WWTRAD           Trade
     C           *LIKE     DEFN DPRN      WWDEPM           Depot
     C           *LIKE     DEFN CCY       WWCCYK           Currency
     C           *LIKE     DEFN ACOD      WWACOD           A/C code
     C           *LIKE     DEFN ACSQ      WWACSQ           A/C sequence
     C           *LIKE     DEFN CSSC      WWCSSC
     C************LIKE     DEFN CSBR      WWCSBR                          S01486
     C           *LIKE     DEFN CSBA      WWCSBR                          S01486
     C           *LIKE     DEFN CSDA      WWCSDA
     C           *LIKE     DEFN CSDA      WWDATG
     C           *LIKE     DEFN CSNT      WWCSNT
     C           *LIKE     DEFN CSNV      WWCSNV
     C           *LIKE     DEFN CSNS      WWCSNS
     C           *LIKE     DEFN CSEX      WWCSEX
     C           *LIKE     DEFN CSPT      WWCSPT
     C           *LIKE     DEFN CSPV      WWCSPV
     C           *LIKE     DEFN CSNT      WWTSNT
     C           *LIKE     DEFN CSNV      WWTSNV
     C           *LIKE     DEFN CSEX      WWTSEX
     C           *LIKE     DEFN CSPT      WWTSPT
     C           *LIKE     DEFN CSPV      WWTSPV
     C           *LIKE     DEFN QATDSS    WWTDSS
     C*
     C                     Z-ADD*ZEROS    WWRCIN  50
     C                     Z-ADD*ZEROS    WWRCDL  50
     C                     Z-ADD*ZEROS    WWNORE  50
     C                     Z-ADD*ZEROS    WWDELT  50
     C                     Z-ADD*ZEROS    WWWRIT  50
     C                     Z-ADD1         WWRRN   10
     C                     MOVE *BLANKS   WWDEPM
     C                     MOVE *BLANKS   WWCCYK
     C                     MOVE *ZEROS    WWACOD
     C                     MOVE *ZEROS    WWACSQ
     C                     MOVE *BLANKS   WWTDSS
     C*
     C**   Initialize database error fields
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE *BLANKS   DBLOT
     C                     MOVEL'PM1030'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C**   Access bank details to get run date
     C***********          READ SDBANKL1                 72*ON=NOT THERE  S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM '*MSG   ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*
     C************IN72     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD01        DBASE            ***************
     C***********          MOVEL'SDBANKL1'DBFILE           * DB ERROR 01 *S01486
     C                     MOVEL'SDBANKPD'DBFILE           * DB ERROR 01 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C*
     C**   Check system date format, DDMMYY or MMDDYY.
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98            ** MMDDYY **
     C                     END
     C*
     C**   Access Portfolio installation control data record
     C***********          READ SDPORTPD                 72*ON=NOT THERE  S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM '*MSG   ' PRTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C*
     C************IN72     IFEQ '1'                                       S01486
     C           PRTCD     IFNE *BLANKS                    B2             S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD02        DBASE            ***************
     C                     MOVEL'SDPORTPD'DBFILE           * DB ERROR 02 *
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C*                                                                   S71062
     C**   Access MIDAS MODULES                                           S71062
     C                     CALL 'AOMMODR0'                                S71062
     C                     PARM '*MSG   ' PRTCD   7                       S71062
     C                     PARM '*FIRST ' @OPTN   7                       S71062
     C           SDMMOD    PARM SDMMOD    DSFDY                           S71062
     C*                                                                   S71062
     C           PRTCD     IFNE *BLANKS                                   S71062
     C           *LOCK     IN   LDA                                       S71062
     C                     Z-ADD02        DBASE            ***************S71062
     C                     MOVEL'SDMMODPD'DBFILE           * DB ERROR 02 *S71062
     C                     OUT  LDA                        ***************S71062
     C                     EXSR *PSSR                                     S71062
     C                     END                                            S71062
     C*
     C**   Access Securities Trading installation control data record
     C***********          READ SDSTRDL1                 72*ON=NOT THERE  S01486
     C           BGSECS    IFEQ 'Y'                                       S71062
     C                     CALL 'AOSTRDR0'                                S01486
     C                     PARM '*MSG   ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01486
     C*
     C************IN72     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD03        DBASE            ***************
     C***********          MOVEL'SDSTRDL1'DBFILE           * DB ERROR 03 *S01486
     C                     MOVEL'SDSTRDPD'DBFILE           * DB ERROR 03 *S01486
     C                     OUT  LDA                        ***************S01486
     C                     EXSR *PSSR                      ***************
     C                     END
     C                     END                                            S71062
     C*                                                                   S71062
     C           BGFUOP    IFEQ 'Y'                                       S71062
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C                     OPEN TRANSC                                    S71062
     C                     END                                            S71062
     C*
     C**   Calculate back value date
     C                     MOVE WWECD     WWVDNA  50
     C                     SUB  BVBVP     WWVDNA
     C*
     C                     MOVELBVCCAP    COCP    1        CHARGES
     C                     MOVELBVCMCP    CCAP    1        COMMISSIONS
     C*                                                                   S01496
     C**  Check if feature "Jyske Enhancements" is on                     S01496
     C*                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   WLRTCD  7                       S01496
     C                     PARM '*VERIFY' WLOPTN  7                       S01496
     C                     PARM 'S01496'  WLSARD  6                       S01496
     C           SCSARD    PARM SCSARD    DSSDY                           S01496
     C                     MOVE 'N'       S01496  1                       S01496
     C*                                                                   S01496
     C           WLRTCD    IFEQ *BLANKS                                   S01496
     C*                                                                   S01496
     C**  If S01496 is installed, open appropriate files                  S01496
     C*                                                                   S01496
     C                     MOVE 'Y'       S01496                          S01496
     C                     OPEN SECDEPL0                                  S01496
     C                     OPEN SECDEPL2                                  S01496
     C                     OPEN CDEPD                                     S01496
     C                     OPEN CDEPPA                                    S01496
     C                     OPEN SEERALL3                                  S01496
     C                     OPEN SEERALL4                                  S01496
     C                     OPEN SEBLKPL4                                  S01496
     C                     OPEN PMPORTPD                                  S01496
     C*                                                                   S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C**  Return code other than *NRF                                     S01496
     C*                                                                   S01496
     C           WLRTCD    IFNE '*NRF'                                    S01496
     C           *LOCK     IN   LDA                                       S01496
     C                     Z-ADD15        DBASE            ***************S01496
     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 15 *S01496
     C                     MOVELWLOPTN    DBKEY            ***************S01496
     C                     OUT  LDA                                       S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                                            S01496
     C                     END                                            S01496
      *                                                                   178439
      **  Determine if feature CSE015 is installed.                       178439
      *                                                                   178439
     C                     MOVE 'N'       CSE015  1                       178439
     C                     CALL 'AOSARDR0'                                178439
     C                     PARM '       ' WLRTCD                          178439
     C                     PARM '*VERIFY' WLOPTN                          178439
     C                     PARM 'CSE015'  WLSARD                          178439
      *                                                                   178439
     C           WLRTCD    IFEQ *BLANK                                    178439
     C                     MOVE 'Y'       CSE015                          178439
     C                     ELSE                                           178439
     C                     MOVE 'N'       CSE015                          178439
      *                                                                   178439
      ** Database Error (return code other than *NRF)                     178439
      *                                                                   178439
     C           WLRTCD    IFNE '*NRF   '                                 178439
     C           *LOCK     IN   LDA                                       178439
     C                     MOVEL'SCSARDPD'DBFILE           ***************178439
     C                     MOVEL'CSE015'  DBKEY            * DB ERROR 22 *178439
     C                     Z-ADD22        DBASE            ***************178439
     C                     OUT  LDA                                       178439
     C                     MOVE *ON       *INU7                           178439
     C                     MOVE *ON       *INU8                           178439
     C                     MOVE *ON       *INLR                           178439
     C                     EXSR *PSSR                                     178439
     C                     ENDIF                                          178439
      *                                                                   178439
     C                     ENDIF                                          178439
     C/COPY WNCPYSRC,PM1030C029
     C*
     C                     ENDSR                           * #INIT ENDSR *
     C*
     C**************************************************************************
      /EJECT
     C**************************************************************************
      ** *PSSR       :      FILE EXCEPTION ERROR HANDLING SUBROUTINE
      ** CALLED FROM : MAIN
      ** CALLS       :
     C*=========================================================================
     C           *PSSR     BEGSR                            ** *PSRR BSR**
     C*
     C**   DUMP AND RETURN TO THE CALLING PROGRAM
     C*
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C*
     C                     WRITEHEADAU
     C                     WRITEERRORAU
     C***********          WRITEENDAU                                     S01486
     C                     DUMP
     C                     RETRN
     C**
     C                     ENDSR                            ** *PSRR ESR**
      ********************************************************************CPB001
      *                                                                   CPB001
      *   #CUST - SR TO DETERMINE IF CUSTOMER IS A PRIVATE CUSTOMER       CPB001
      *                                                                   CPB001
      ********************************************************************CPB001
     C           #CUST     BEGSR                                          CPB001
     C*                                                                   CPB001
     C**********           MOVELZZCNUM    KPCNUM  60                                   CPB001 CSD027
     C                     MOVELZZCNUM    KPCNUM  6                                           CSD027
     C                     MOVE 'N'       WWVAL   1                       CPB001
     C           KPCNUM    SETLLPMPORTPD                                  CPB001
     C           KPCNUM    READEPMPORTPD                 89               CPB001
     C*                                                                   CPB001
     C           *IN89     DOWEQ*OFF                                      CPB001
     C           WWVAL     ANDEQ'N'                                       CPB001
     C*                                                                   CPB001
     C           PNDPCL    IFEQ 0                                         CPB001
     C           PNRECI    ANDEQ'D'                                       CPB001
     C                     MOVE 'Y'       WWVAL                           CPB001
     C                     ELSE                                           CPB001
     C           KPCNUM    READEPMPORTPD                 89               CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C                     ENDDO                                          CPB001
     C*                                                                   CPB001
     C                     ENDSR                                          CPB001
     C********************************************************************
     C/COPY WNCPYSRC,PM1030C030
     C**************************************************************************
     C*                                                                   38430
      /COPY ZSRSRC,ZAVPRC                                                 38430
     C*                                                                   38430
      ***/COPY*ZSRSRC,ZAYNUM                                        38430 S01486
     C*****************************************************************   S01486
     C*                                                               *   S01486
     C*  ZAYNUM - CALCULATE AY NUMERATOR                              *   S01486
     C*                                                               *   S01486
     C*  PURPOSE:  To multiply a nominal position by the yield on the *   S01486
     C*            position to give a 'Yield' value of the position   *   S01486
     C*            with the correct number of decimal places for the  *   S01486
     C*            nominal currency.                                  *   S01486
     C*                                                               *   S01486
     C*  INPUT FIELDS:                                                *   S01486
     C*       ZNOML  15 0     Nominal                                 *   S01486
     C*       ZAVYD  11 7     Average Yield                           *   S01486
     C*       ZNMDP   1 0     Nominal Decimal Places (0-4)            *   S01486
     C*       ZNMCD   1 0     Nominal Currency Decimal Places (0-3)   *   S01486
     C*                                                               *   S01486
     C*  OUTPUT FIELDS:                                               *   S01486
     C*       ZVALU  15 0     Value                                   *   S01486
     C*                                                               *   S01486
     C*  ALSO REQUIRED:                                               *   S01486
     C*       POWER8 Array of multiplying factors for nominal decimal *   S01486
     C*                                                               *   S01486
     C*  WORK FIELDS:                                                 *   S01486
     C*       ZVAL0  15 0 - Average yield with 0 decimal places       *   S01486
     C*       ZVAL1  15 1 - --------------- '' ----------------       *   S01486
     C*       ZVAL2  15 2 - --------------- '' ----------------       *   S01486
     C*       ZVAL3  15 3 - --------------- '' ----------------       *   S01486
     C*       ZI      1 0 - Power Array                               *   S01486
     C*                                                               *   S01486
     C*  CALLED FROM:                                                 *   S01486
     C*                                                               *   S01486
     C*****************************************************************   S01486
     C           ZAYNUM    BEGSR                           *** ZAYNUM *** S01486
     C*                                                                   S01486
     C** Define all fields                                                S01486
     C                     Z-ADDZNOML     ZNOML  150                      S01486
     C                     Z-ADDZAVYD     ZAVYD  117                      S01486
     C                     Z-ADDZNMDP     ZNMDP   10                      S01486
     C                     Z-ADDZNMCD     ZNMCD   10                      S01486
     C                     Z-ADDZVALU     ZVALU  150                      S01486
     C*                                                                   S01486
     C** If number of currency decimal places I = 0                       S01486
     C           ZNMCD     IFEQ 0                                         S01486
     C           ZNOML     MULT ZAVYD     ZVAL0  150H                     S01486
     C                     MOVE ZVAL0     ZVALU                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** If number of currency decimal places I = 1                       S01486
     C           ZNMCD     IFEQ 1                                         S01486
     C           ZNOML     MULT ZAVYD     ZVAL1  151H                     S01486
     C                     MOVE ZVAL1     ZVALU                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** If number of currency decimal places I = 2                       S01486
     C           ZNMCD     IFEQ 2                                         S01486
     C           ZNOML     MULT ZAVYD     ZVAL2  152H                     S01486
     C                     MOVE ZVAL2     ZVALU                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** If number of currency decimal places I = 3                       S01486
     C           ZNMCD     IFEQ 3                                         S01486
     C           ZNOML     MULT ZAVYD     ZVAL3  153H                     S01486
     C                     MOVE ZVAL3     ZVALU                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** Set index ZI equal to 5 - (nominal decimal places)               S01486
     C           5         SUB  ZNMDP     ZI      10                      S01486
     C*                                                                   S01486
     C** Multiply ZVALU by POWER8,ZI to get amount with nominal decimal   S01486
     C** places                                                           S01486
     C           ZVALU     MULT POWER8,ZI ZVALU                           S01486
     C*                                                                   S01486
     C                     ENDSR                                          S01486
     C*****************************************************************   S01486
     C/EJECT                                                              S01486
     O**
     O** DEALS
     O**
     ODEALSDBFE                DEALBU
     O                         PTFR
     O                         HLEX                                       38430
     OFXDEALP0E                FXDEAU                                     61488
     O                         FHPTFR                                     61488
     ODEALSDCFE                DEALCU
     O                         PTFR
     O                         FXRD                                       38430
     O                         HLEX                                       38430
     OMMDELDP0E                MMDELU                                     61488
     O                         HKPTFR                                     61488
     O*DEALSDGFE***             DEALGU                                    58933
     O****                     PTFR                                       58933
     O*DEALSDB1E***             DEALDB                              34679 38430
     O****                     PTFR                                 34679 38430
     O*DEALSDC1E***             DEALDC                              03467938430
     O****                     PTFR                                 03467938430
     O*DEALSDG1E***             DEALDG                              03467958933
     O****                     PTFR                                 03467958933
     O**
     O** TRADES
     O**
     OTRADSDF E                TRADSU
     O                         PTFR
     O                         SPXR
     O                         SPMD
     O**                                                                  38430
     OHSTTRDF E                HSTTRU                                     38430
     O                         PTFR                                       38430
     O                         SPXR                                       38430
     O                         SPMD                                       38430
     O**
     O** DEPOT MOVEMENTS
     O**
     ODPTMVDF E                DPTMVU
     O                         PTFR
     O                         SPXR                                       R10049
     O                         SPMD                                       R10049
     O                         CYLD                                       38430
     O                         CWDI                                       38430
     O**
     O** POSITION SETTLEMENTS
     O**
     OPOSETDF E                POSETU
     O                         PTFR
     O**
     O***F&O*TRANSACTIONS**********************************************   S01486
     O***********                                                         S01486
     O***TRANSDF E                TRANSU                                  S01486
     O***********              PTFR                                       S01486
     O**                                                                  S71062
     O** F&O TRANSACTIONS                                                 S71062
     O**                                                                  S71062
     OTRANSDF E                TRANSU                                     S71062
     O                         PTFR                                       S71062
     O**
     O** LE LOANS
     O**
     OCLOANCLFE                CLOANU
     O                         PTFR
     O                         HLEX                                       38430
     OCLOANCL1E                CLOANP                                     38430
     O                         PTFR                                       38430
     O                         HLEX                                       38430
     OCLOANCZFE                CLOANZ                                     38430
     O                         PTFR                                       38430
     O                         HLEX                                       38430
     O****CLOANCL1E            CLOAN1                               03467958879
     O****                     PTFR                                 03467958879
     O**
     O** ACCOUNTS
     O**
     OACCNTABFE                ACCNTU
     O                         PTFR
     O                         HLEX                                       38430
     O**
     O***FID*DEPOSITS**************************************************   S01486
     O***********                                                         S01486
     O***FIDEPOD0E                FIDEPU                                  S01486
     O***??                    PTFR
     O***********              FDPTFR                               EMFIX S01486
     O***********              FDHLEX                               38430 S01486
     O***********              FDFXRD                               38430 S01486
     O***********                                                         S01486
     O***FID*LOANS*****************************************************   S01486
     O***********                                                         S01486
     O***FILOAND0E                FILOAU                                  S01486
     O***??                    PTFR
     O***********              FLPTFR                               EMFIX S01486
     O*                                                                   S01408
     O/COPY WNCPYSRC,PM1030OOP1                                           S01408
     O*                                                                   S01408
     O**
     O** CUSTOMER AVERAGE PRICE ACTIONS
     O**
     OCAPRHDF E                CAPRHU
     O                         PMTI
     O                         PMVI
     O                         PTFR
     O                         ACIN
     O                         ITRA
     O                         CFAP
     O                         CAVR
     O                         CFXR
     O                         CYLD
     O                         OTHD                                       38430
     O*                                                                   S01496
     O** Customer depot positions by date                                 S01496
     O*                                                                   S01496
     OCDEPDF  E                CDEPU                                      S01496
     O                         PTFR                                       S01496
     O*                                                                   S01496
     O** General blocks by customer                                       S01496
     O*                                                                   S01496
     OSEBLKPD0E                SEBLU                                      S01496
     O                         VDPTFR                                     S01496
     O*                                                                   S01496
     O** Allocations by customer and portfolio reference                  S01496
     O*                                                                   S01496
     OSEERALD0E                SEERU                                      S01496
     O                         VCPTFR                                     S01496
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  DTYPES
LNDLTIIPCLITTDCDCI
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
