     H        1                                                           S01486
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Maintain DTAARA PMSTAT')                      *
     H**********                                                          S01486
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                             *
     F*                                                               *
     F*  PM1040 - MAINTAIN DTAARA PMSTAT                              *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CCB020             Date 06Aug12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01486             Date 02Jun94               *
      *                 R01141             Date 04Dec90               *
     F*                 CFFX01             DATE 23JUL90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CCB020 - COB Restructure - Secondary COB Infrastructure      *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  S01486 - Private Banking upgrade to Release 10               *
     F*  R01141 - WHEN CALLED DURING INPUT CYCLE INITIATION EVENT     *
     F*           CONTROL DATE SHOULD BE EQUAL TO RUN DATE            *
     F*  CFFX01 - UPDATE POSITIONS 16-18 IN PMSTAT.                   *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F***SDBANKL1IF**E***        K        DISK                            S01486
     F**********                                    KINFSR *PSSR          S01486
     F***RECORD*ID***BJ'**************************************************S01486
     F***SDGELRL1IF**E***        K        DISK                            S01486
     F**********                                    KINFSR *PSSR          S01486
     F***RECORD*ID***BK'**************************************************S01486
     FPM1040AUO   E                    PRINTER                        UC  S01486
     F*************************************************************
     E**
     E** TABLES AND ARRAYS
     E*********************************************************************
      ** ARRAY FOR COPYRIGHT
      *
     E                    CPY@    1   1 80
     E**
     ISDBANK    E DSSDBANKPD                                              S01486
     I** EXTERNAL DS FOR BANK DETAILS                                     S01486
     ISDGELR    E DSSDGELRPD                                              S01486
     I** GEN. LEDGER DETAILS ACCESSED VIA ACCESS PROGRAM                  S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     IPSDS       SDS
     I                                      247 249 WSID
     I                                      254 263 USID
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     I***MPHAS       DS                                                                       CCB020
     I**********                              1   1 WWPHAS                                    CCB020
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     I***LDA********UDS*********************       256                    S01486
     I**************************************132 183 DBLOT                 S01486
     I**************************************132 141 DBFILE                S01486
     ILDA         DS                            256                       S01486
     I                                      134 183 DBLOT                 S01486
     I                                      134 141 DBFILE                S01486
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I** DATA AREA PMSTAT
     I*
     IPMSTAT     UDS                            256
     I                                        1   5 WWEVTD
     I                                        6  10 WWRUNA
     I                                       11  15 WWEV60
     I**********                             16  18 WWBUSY          CFFX01S01486
     I*
     ICPYR@#      DS
     I*
     I** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                                     CGL029
      *                                                                                       CGL029
     C*************************************************************
     C** P R O G R A M    S T A R T
     C*************************************************************
     C**
     C*
     C** RECEIVE INPUT PARAMETER
     C           *ENTRY    PLIST
     C                     PARM           ONREQ   1
     C**
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL'PM1040'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C***OBTAIN*PHASE*OF*DAILY*CYCLE*FROM*DTAARA/MPHAS*****************                       CCB020
     C*
     C********** *NAMVAR   DEFN           MPHAS                                               CCB020
     C********** *LOCK     IN   MPHAS                                                         CCB020
     C**********           OUT  MPHAS                                                         CCB020
      *                                                                                       CCB020
      ** Check if system is in COB Phase                                                      CCB020
      *                                                                                       CCB020
     C                     MOVEL'CBC00100'@RTPRM  9                                           CCB020
     C                     MOVE '1'       @RTPRM                                              CCB020
     C                     CALL @RTPRM                                                        CCB020
     C                     PARM *BLANKS   COBST   4                                           CCB020
      *                                                                                       CCB020
     C**
     C** ACCESS SDBANKL1 TO GET BANK DETAILS
     C**
     C*********************READ SDBANKL1                 70               S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM '*MSG   ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*
     C************IN70     IFEQ '1'                        ***************S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVEL@OPTN     DBKEY                           S01486
     C                     Z-ADD1         DBASE            **DB ERROR 01**
     C                     MOVEL'SDBANKL1'DBFILE           ***************
     C                     EXSR *PSSR
     C                     ELSE
     C**
     C** RECORD FOUND -  LOAD RUN DATE
     C**
     C                     MOVE BJRDNB    WWRUNA
     C**
     C                     END
     C**
     C** ACCESS SDGELRL1 TO GET GENERAL LEDGER DETAILS
     C**
     C*********************READ SDGELRL1                 70               S01486
     C**********           CALL 'AOGELRR0'                                             S01486 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01486 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*
     C************IN70     IFEQ '1'                        ***************S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVEL@OPTN     DBKEY                           S01486
     C                     Z-ADD2         DBASE            **DB ERROR 02**
     C                     MOVEL'SDGELRL1'DBFILE           ***************
     C                     EXSR *PSSR
     C                     END
     C**
     C** DETERMINE THE EVENT CONTROL DATE
     C**
     C** SUTRACT 1 FROM NEXT WORKING DATE
     C**
     C           BJDNWD    SUB  1         WWDNWD  50
     C**
     C** CALCULATE EVENT CONTROL DATE AS LESSER OF DATE OF NEXT WORKING
     C** DAY - 1 AND ACCRUALS PROFIT DATE
     C**
     C           WWDNWD    IFLT BKAPDT
     C**
     C** SETUP EVENT CONTROL DATE IN PMSTAT WITH NEXT WORKING DAY
     C**
     C                     Z-ADDWWDNWD    WWCFEV
     C                     MOVE WWDNWD    WWEVTD
     C**
     C                     ELSE
     C**
     C** SETUP EVENT CONTROL DATE IN PMSTAT WITH ACCRUALS PROFIT DATE
     C**
     C                     Z-ADDBKAPDT    WWCFEV
     C                     MOVE BKAPDT    WWEVTD
     C**
     C                     END
     C*                                                                   R01141
     C** IF PROGRAM RUNNING DURING INPUT CYCLE INITIATION SET EVENT       R01141
     C** CONTROL DATE TO RUN DATE                                         R01141
     C********** WWPHAS    IFEQ 'F'                                                    R01141 CCB020
     C********** WWPHAS    OREQ 'X'                                                    R01141 CCB020
     C           COBST     IFEQ '*NO'                                                         CCB020
     C                     MOVE BJRDNB    WWEVTD                          R01141
     C                     END                                            R01141
     C*
     C** CALCULATE CASHFLOW EVENT CONTROL DATE
     C** IF PROGRAM CALLED DURING INPUT CYCLE INITIATION EVENT
     C** CASHFLOW EVENT CONTROL DATE SET TO RUN DATE + 60 DAYS
     C********** WWPHAS    IFEQ 'A'                                                           CCB020
     C           COBST     IFEQ '*NO'                                                         CCB020
     C                     Z-ADDBJRDNB    WWCFEV  50
     C           WWCFEV    ADD  60        WWCFEV
     C                     MOVE WWCFEV    WWEV60
     C                     END
     C*
     C** IF PROGRAM CALLED DURING MAIN PART OF COB (IE NOT COB ON REQUEST)
     C********** WWPHAS    IFNE 'A'                                                           CCB020
     C           COBST     IFEQ '*YES'                                                        CCB020
     C           ONREQ     ANDEQ'N'
     C           WWCFEV    ADD  60        WWCFEV
     C                     MOVE WWCFEV    WWEV60
     C                     END
     C*
     C** IF PROGRAM CALLED DURING COB ON REQUEST PROCESSING
     C********** WWPHAS    IFNE 'A'                                                           CCB020
     C           COBST     IFEQ '*YES'                                                        CCB020
     C           ONREQ     ANDEQ'Y'
     C                     Z-ADDBJDNWD    WWCFEV  50
     C           WWCFEV    ADD  60        WWCFEV
     C                     MOVE WWCFEV    WWEV60
     C                     END
     C***********                                                   CFFX01S01486
     C***SET*POS.16-18*OF*PMSTAT*TO*'OLD'***************************CFFX01S01486
     C***********                                                   CFFX01S01486
     C***********          MOVE 'OLD'     WWBUSY                    CFFX01S01486
     C**
     C                     MOVE '1'       *INLR
     C*************************************************************
     C** P R O G R A M    E N D
     C*************************************************************
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C** OUTPUT TO AUDIT                                                  S01486
     C                     OPEN PM1040AU                                  S01486
     C                     WRITEHEADAU                                    S01486
     C                     WRITEERRORAU                                   S01486
     C                     CLOSEPM1040AU                                  S01486
     C**
     C** ROLL BACK CHANGES, PRINT DUMP AND CANCEL PROGRAM
     C**
     C                     DUMP
     C**
     C                     MOVE '1'       *INLR
     C**
     C                     RETRN
     C**
     C                     ENDSR
**  CPY@
(c) Finastra International Limited 2001
