     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Portfolio holdings update')                   *
/*OVRF*: OVRDBF FILE(PMCPOSXX) TOFILE(PMCPSTLL) SHARE(*NO)          : *
/*OVRF*: OVRDBF FILE(PMCPOSOT) TOFILE(PMCPSTLL) SHARE(*NO)          : *
/*OVRF*: OVRDBF FILE(PMAPOSLX) TOFILE(PMAPOSLL) SHARE(*NO)          : *
/*OVRF*: OVRDBF FILE(SEEVNT) TOFILE(SECED) SHARE(*NO)               : *
/*OVRF*: OVRDBF FILE(SECET) SHARE(*NO)                              : *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM1140 - SE Portfolio Holdings Update                        *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. AR1075401          Date 01Jun20               *
      *  Prev Amend No. 248698             Date 01Jun20               *           
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 08Jul15               *
      *                 MD020103           Date 23Apr13               *
      *                 250227             Date 01Feb13               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23967           Date 14May09               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 194370             Date 12Jul01               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 180707             Date 25Jul00               *
      *                 182961             Date 02Jul01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 171874             Date 26Jun01               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 09Jul99               *
      *                 160100             Date 11Jun99               *
     F*                 149578             Date 03Dec98               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 130862             Date 18Oct98               *
     F*                 104786             Date 01Aug96               *
     F*                 097158             Date 28Jun96               *
     F*                 CPM005             DATE 28JUN96               *
     F*                 CFF004             DATE 02OCT96               *
     F*                 053103             DATE 02JUL96               *
     F*                 068169             DATE 15MAR94               *
     F*                 065217             DATE 06JAN94               *
     F*                 063601             DATE 07MAY96               *
     F*                 S71062             DATE 24JAN96               *
     F*                 101188             DATE 06MAR96               *
     F*                 CPM004             DATE 21MAR96               *
     F*                 095867             DATE 08NOV95               *
     F*                 092961             DATE 04OCT95               *
     F*                 087628             DATE 01SEP95               *
     F*                 081350             DATE 09JAN95               *
     F*                 S01486             DATE 11AUG94               *
     F*                 062885             DATE 04NOV93               *
     F*                 058181             DATE 07JUL93               *
     F*                 057020             DATE 18JUN93               *
     F*                 056548     LJ      DATE 09JUN93               *
     F*                 056463             DATE 08JUN93               *
     F*                 050207     MF      DATE 10MAR93               *
     F*                 051250     MF      DATE 10MAR93               *
     F*                 037854     MF      DATE 31MAR92               *
     F*                 038152             DATE 18DEC92               *
     F*                 041644     MF      DATE 15JUL92               *
     F*                 062862             DATE 04NOV93               *
     F*                 52474              DATE 18MAR93               *
     F*                 50593              DATE 10FEB93               *
     F*                 49768              DATE 09FEB93               *
     F*                 49213              DATE 09FEB93               *
     F*                 48219              DATE 19OCT92               *
     F*                 47719              DATE 24NOV92               *
     F*                 043190             DATE 29OCT92               *
     F*                 SA9108             DATE 26AUG92               *
     F*                 S01313             DATE 28APR92               *
     F*                 R37474             DATE 23MAR92               *
     F*                 B08268             DATE 21OCT91               *
     F*                 B08253             DATE 10OCT91               *
     F*                 B08255             DATE 07OCT91               *
     F*                 B08040             DATE 03JUL91               *
     F*                 B08035             DATE 02JUL91               *
     F*                 B08000             DATE 29JUN91               *
     F*                 B08013             DATE 28JUN91               *
     F*                 B05982             DATE 15MAY91               *
     F*                 R05763             DATE 27MAR91               *
     F*                 R05661             DATE 12MAR91               *
     F*                 R00631             DATE 20NOV90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  AR1075401 - Increase QANOML and QAOTNM length in PMCPOSPD.   *
      *              Adjust workfield WWNOML. (Child: AR1075402)      *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *           
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  MD020103 - DBASE error on PM1140 due to blanks instrument    *
      *             type. If instrument type is blanks, move value    *
      *             retrieved from PF/SDPORTPD to field INNR instead  *
      *             of WWINNR.                                        *
      *  250227 - Preventive fix to ensure that customer yield rate   *
      *           calculation will be executed only for yield based   *
      *           securities. Applied for AR1067108A.                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23967 - Add Local Industry Code Field. (Recompile)        *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus                                          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  182961 - Database error occurred due to a blank key field    *
      *           (Instrument Type).  The default Instrument type in  *
      *           PF/SDPORTPD is taken if a blank instrument type is  *
      *           encountered.                                        *
      *  171874 - ZAINSH changes - only recompile                     *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  160100 - Take euro rates for euro ccy.                       *
     F*  149578 - Calculate yiled regardless of basis.                *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  104786 - Book Yield percentage not produced if security      *
     F*           Yield basis not defined                             *
     F*  097158 - Initialize Field 'QFVDAT' to use it for Performance *
     F*         - If QFVDAT different than 0, field used for forward  *
     F*           value date event (not processed for performance     *
     F*           reconciliation reports if QFVDAT greater than ecd)  *
     F*           See also PM1620, PM1630, PM1640, PM6430.            *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/2 - CALCULATE & REPORT PERF. FOR ALL CUST.PORT *
     F*           PBFG/5 - INSTRUMENT ASSET LIABILITY SPLIT           *
     F*  CFF004 - INCREASE IN SIZE OF PRICE FIELDS,(RECOMPILED ONLY)  *
     F*  053103 - POSITION TO INCLUDE ANY OUTSTANDING SETTLEMENTS     *
     F*           (PARTLY REPLACES 38152)                             *
     F*  068169 - Do not update FLEX for a mature security - part of  *
     F*           fix 52474.                                          *
     F*  065217 - Pgm tried to update a record which has not been read*
     F*           in - check that the record has been read in.        *
     F*  063601 - Adding mumber of days in field without resetting to *  *
     F*           to zero first causes error - use Z-ADD, not ADD.    *  *
     F*  S71062   Output additional fields SPBS and NMDP              *
     F*  101188 - Invalid decimal data being written to PMMFHLPD.     *
     F*           Fix is to use keyed delete instead of read and      *
     F*           delete, which means record does not need to be      *
     F*           read in, so save fields not required.               *
     F*  CPM004 - Clear data structure WWSAVE at start of program     *
     F*           Also correct save lengths                           *
     F*  095867 - Nominal decimal places and price basis need to be   *
     F*           set up for performance                              *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  087628 - Recompiled over LBPLEGPD                            *
     F*  081350 - Remove part of coding on LDA                        *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*  062885 - ADD SUBR ZCCYXR EXTERNALLY CALLED                   *
     F*  058181 - SE HOLDING SHOULD ALWAYS BE VALUED                  *
     F*  057020 - OUTPUT DOUBLE PRECISION FX RATE                     *
     F*  056548 - FORWARD VALUE DATE POSITIONS MUST BE WRITTEN TO     *
     F*           'PMHOLDPP' EVEN IF HOLIDAYS DECLARED                *
     F*         - OTHER NOMINAL AMOUNT MUST NOT CONTAIN '*HIVAL'      *
     F*           (APPLY SAME FIX AS FOR DEFINED PORTFOLIO) SA9108    *
     F*  056463 - ALL POSITIONS MUST HAVE MARKET VALUE & ACCRUED      *
     F*           INTEREST OF 0                                       *
     F*  050207 - USE FIX 37854 FOR ALL SUBROUTINE                    *
     F*  051250 - DO NOT WRITE IN PMHOLDPP IF VALUE IS 0.             *
     F*  037854 - MARKET PRICE WRONG (DUE TO DIVISIONS).              *
     F*  038152 - IF COUPON OR MATURITY FALLS ON NON WORKING DAY      *
     F*           SHOULD STILL BE DISPLAYED ON NEXT WORKING DAY       *
     F*  041644 - MARKET PRICE WRONG (DUE TO DIVISIONS). (REMOVE      *
     F*           PHYSICALLY)                                         *
     F*  062862 - CHANGE CODING FOR DTAARA PMSTAT                     *
     F*  52474  - DO NOT UPDATE FLEX FOR MATURED SECURITY             *
     F*  50593  - RECOMPILE OVER NEW SR/ZAVPRC                        *
     F*  49768  - CORRECTION TO WRITE AND DROP ON PF/PMMFHLPP         *
     F*  49213  - RECOMPLIED OVER NEW VERSION OF SR/ZFXAVP            *
     F*  48219  - CHANGE TO KEEP PM POSITIONS TO TRADE RETENTION DATE *
     F*  47719  - CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES    *
     F*  043190 - IF LAST POSITION DATE < LAST COUPON DATE SHOULD NOT *
     F*           SUBTRACT EX-COUPON NOMINAL FROM ZAMTP               *
     F*  SA9108 - CHANGES FOR POOL PORTFOLIOS                         *
     F*  S01313 - CHANGES FOR PORTFOLIO PERFORMANCE                   *
     F*  R37474 - ADD TOTALLING FIELDS TO PF/PMHOLDPP FOR MIDASQ      *
     F*  B08268 - SUNDRY FIXES TO SPEED UP GENERATION OF CASHFLOWS    *
     F*  B08253 - EXTRACT MATURED POSITIONS TO A SEPARATE FILE        *
     F*  B08255 - SPEED UP COB BY SPLITTING TOTALLING FILES           *
     F*  B08040 - ENHANCEMENTS TO SPEED UP COB                        *
     F*  B08035 - ONLY PERFORM SR/ZYIELD ON CHANGE OF SECURITY        *
     F*  B08000 - DO NOT PERFORM YIELD CALCULATIONS FOR UNIT BASED    *
     F*           OR VERY LOW PRICED SECURITIES                       *
     F*  B08013 - IF SECURITY NOT FOUND ON SECTY SET POSITION ID ON   *
     F*           PF/PMCPOSPP TO 'I'. DO NOT END PROGRAM WITH DB ERR  *
     F*  B05982 - ALTERED DUE TO CHANGES TO SR/ZAINSH                 *
     F*  R05763 - MATURED POSITIONS SHOULD HAVE ZERO MARKET VALUE AND *
     F*           ACCRUED INTEREST                                    *
     F*  R05661 - ALTER YIELD CALCULATIONS TO CORRESPOND TO SE2405    *
     F*           ALSO IF YIELD 0 OR NEGATIVE OUTPUT -9999            *
     F*  R00631 - DISPLAY FXRATES ACCORDING TO INTERNATIONAL STANDARD *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F**  PREFIX OF PMCPOSXX IS 'QA'                                      B08040
     FPMCPOSXXUF  E           K        DISK                               B08040
     F            PMCPOSP0                          KRENAMEPMCPOSX0       B08040
     F                                              KINFSR *PSSR          B08040
     F**  PREFIX OF PMCPOSL0 IS 'QA'                                      B08253
     FPMCPOSL0IF  E           K        DISK                               B08253
     F            PMCPOSP0                          KRENAMEPMCPOS0        B08253
     F                                              KINFSR *PSSR          B08253
     F****PREFIX*OF*PMPORTQ2*IS*'PN'*****************************         S01486
     F***PMPORTQ2IF**E           K        DISK                            S01486
     F*********** PMPORTP0                          KRENAMEPMPORTQ0       S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*PMCHRGQ1*IS*'PO'*****************************         S01486
     F***PMCHRGQ1IF**E           K        DISK                            S01486
     F*********** PMCHRGP0                          KRENAMEPMCHRGQ0       S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDBANKL1*IS*'BJ'*****************************         S01486
     F***SDBANKL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDPORTPD*IS*'P9'*****************************  B08040 S01486
     F***SDPORTPDIF**E                    DISK                     B08040 S01486
     F***********                                   KINFSR *PSSR   B08040 S01486
     F****PREFIX*OF*SDCURRL0*IS*'A6'*****************************         S01486
     F***SDCURRL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     FSECTY   IF  E           K        DISK
     F                                              KINFSR *PSSR
     FINVTP   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDPLINPD*IS*'PD'*****************************         S01486
     F***SDPLINPDIF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F**  PREFIX OF PMDSPGPP IS 'PA'
     F***PMDSPGPPIF**E           K        DISK                            S01486
     FPMDSPGPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMVLGHPP IS 'PB'
     F***PMVLGHPPIF**E           K        DISK                            S01486
     FPMVLGHPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F****PREFIX OF SDPLCSL0 IS 'QB'                                      B08040
     F*DPLCSL0IF  E           K        DISK                               B08040
     F****                                          KINFSR *PSSR          B08040
     F****PREFIX OF PMPORTPP IS 'PN'                                      B08040
     F*MPORTPPIF  E           K        DISK                               B08040
     F****                                          KINFSR *PSSR          B08040
     F****PREFIX*OF*PMCPOSLL*IS*'QA'*****************************         S01486
     F***PMCPOSLLIF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     FSEEVNT  IF  E           K        DISK                               B05982
     F                                              KINFSR *PSSR
     FSECET   IF  E           K        DISK                               B05982
     F            SEDEVDF                           KRENAMESEDEVD1
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMAPOSLL IS 'QA'
     FPMAPOSLLIF  E           K        DISK                               B08253
     F            PMCPOSP0                          KRENAMEPMAPOSP0       B08253
     F                                              KINFSR *PSSR          B08253
     F**  PREFIX OF PMAPOSLL IS 'QA'                                      B08040
     FPMAPOSLXUF  E           K        DISK                               B08040
     F            PMCPOSP0                          KRENAMEPMAPOSPX       B08040
     F                                              KINFSR *PSSR          B08040
     F**  PREFIX OF PMCPOSZZ IS 'QA'
     F***PMCPOSZZUF**E           K        DISK                            S01486
     FPMCPOSPAUF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHPOSLL IS 'QA'
     FPMHPOSLLUF  E           K        DISK
     F                                              KINFSR *PSSR
     F            PMCPOSP0                          KRENAMEPMHPOSP0
     F**  PREFIX OF PMHOLDZZ IS 'QF'
     F***PMHOLDZZUF**E           K        DISK                      A     S01486
     FPMHOLDPAUF  E           K        DISK                      A        S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF LBPLEGTU IS 'PG'
     F***LBPLEGTUIF**E           K        DISK                            S01486
     FLBPLEGLQIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDPP IS 'QF'                                      B08253
     FPMMFHLL1UF  E           K        DISK                      A        B08253
     F            PMHOLDP0                          KRENAMEPMMFHLP0       B08253
     F                                              KINFSR *PSSR          B08253
     F**  PREFIX OF PMHOLDPP IS 'QF'
     F***PMHOLDPPO** E           K        DISK                            S01486
     FPMHOLDPDO   E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDPP IS 'QF'                                      B08040
     F***PMHOLDX0O***E           K        DISK                     B08040 S01486
     FPMHOLDQ0O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08040
     F**  PREFIX OF PMHOLDPP IS 'QF'                                      B08255
     F***PMHOLDX1O***E           K        DISK                     B08255 S01486
     FPMHOLDQ1O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08255
     F**  NO PREFIX TO PMPOSET1                                           053103
     FPMPOSET1IF  E           K        DISK                               053103
     F                                              KINFSR *PSSR          053103
     FSDPORTPDIF  E                    DISK         KINFSR *PSSR          182961
     FPM1140AUO   E                    PRINTER
     F*                                                                   S01486
     F**   Security Events by Type/Desc/Date (used by Subr. ZACCZ)        S01486
     FSECEO   IF  E           K        DISK         KINFSR *PSSR          S01486
     F            SNDEVDF                           KRENAMESNDEVDO        S01486
     F            SEDEVDF                           KRENAMESEDEVDO        S01486
     F*                                                                   S01486
     E*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       71         INDICATOR FOR READ
     F*       72         INDICATOR FOR CHAIN
     F*       73         INDICATOR FOR READ
     F*       74         INDICATOR FOR READ OF LBPLEGTU
     F*       75         AT LEAST ONE RECORD READ FROM LF/PMCPOSL0
     F*       88         INDICATOR FOR READ IN SR/ZAISCH
     F*       89         INDICATOR FOR READ/CHAIN IN SR/ZAINSH &
     F*                  SR/ZAISCH
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   .. *
     F**      * 61   62   63   64   65   66   67   68   69   70 *
     F**      * ..   ..   ..   ..   ..   76   77   78   79   80 *
     F**      * 81   82   83   84   85   86   87   ..   ..   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     E*****************************************************************
     E*                                                                   B08040
     E** TABLES/ARRAYS USED TO AVOID FILE ACCESS OPERATIONS               B08040
     E                    CYCD      200  3                                B08040
     E                    NBDP      200  1 0                              B08040
     E                    RKSQ      200  3 0                              B08040
     E                    SPRT      200 13 8                              B08040
     E                    MDIN      200  1                                B08040
     E                    DSPG      200  3                                B08040
     E                    DSPS      200  2 0                              B08040
     E                    VALG      200  3                                B08040
     E                    VLGS      200  2 0                              B08040
     E                    INCI      200  1                                160100
     E                    EUER      200 13 8                              160100
     E                    EUMD      200  1                                160100
     E*
     E                    CPY@    1   1 80
     E*
     E** FORMAT SE DETAILS FOR OUTPUT  (SR/ZFRELN)
     E**********          ZLI        20  1                                                    CGL029
     E                    ZLI        26  1                                                    CGL029
     E*
      /COPY ZSRSRC,ZPOWER8Z1
      /COPY ZSRSRC,ZPOWERZ1
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,ZNCDZ1
      /COPY ZSRSRC,ZDAYSZ1
     I*****************************************************************
     I*
     I*  RENAME FIELDS FROM SECEF - FORMAT SNDEVDF (FOR ZAINSH/ZAISCH)
     ISNDEVDF
     I              SNSN                            SDSN
     I              SNDT                            SDED
     I              SNET                            SDET
     I*                                                                   B08253
     I*  RENAME FIELDS FROM PMCPOSL0                                      B08253
     IPMCPOS0                                                             B08253
     I              QARECI                          CPRECI                B08253
     I              QACNUM                          CPCNUM                B08253
     I              QAPTFR                          CPPTFR                B08253
     I              QATDSS                          CPTDSS                B08253
     I              QATVDA                          CPTVDA                B08253
     I              QAPDAT                          CPPDAT                B08253
     I              QANOML                          CPNOML                B08253
     I              QACSEX                          CPCSEX                B08253
     I              QAAPNM                          CPAPNM                B08253
     I              QAFXAP                          CPFXAP                B08253
     I              QAPILP                          CPPILP                B08253
     I              QAACDI                          CPACDI                B08253
     I              QABVLD                          CPBVLD                B08253
     I              QATNMC                          CPTNMC                B08253
     I              QATNMD                          CPTNMD                B08253
     I              QAPTCY                          CPPTCY                B08253
     I              QAPCDP                          CPPCDP                B08253
     I              QAAYNM                          CPAYNM                B08253
     I              QACSBY                          CPCSBY                B08253
     I              QABYDP                          CPBYDP                B08253
     I              QACLAS                          CPCLAS                B08253
     I              QAACOC                          CPACOC                B08253
     I              QAOTNM                          CPOTNM                B08253
     I              QAOTEX                          CPOTEX                B08253
     I              QAAPBC                          CPAPBC                B08255
     I              QAFLEX                          CPFLEX                B08253
     I              QACOLC                          CPCOLC                B08268
     I              QABRCD                          CPBRCD                B08268
     I              QANPDT                          CPNPDT                B08268
     I*                                                                   B08040
     I*  RENAME FIELDS FROM PMAPOSLL                                      B08040
     IPMAPOSPX                                                            B08040
     I              QARECI                          APRECI                B08040
     I              QACNUM                          APCNUM                B08040
     I              QAPTFR                          APPTFR                B08040
     I              QATDSS                          APTDSS                B08040
     I              QATVDA                          APTVDA                B08040
     I              QAPDAT                          APPDAT                B08040
     I              QANOML                          APNOML                B08040
     I              QACSEX                          APCSEX                B08040
     I              QAAPNM                          APAPNM                B08040
     I              QAFXAP                          APFXAP                B08040
     I              QAPILP                          APPILP                B08040
     I              QAACDI                          APACDI                B08040
     I              QABVLD                          APBVLD                B08040
     I              QATNMC                          APTNMC                B08040
     I              QATNMD                          APTNMD                B08040
     I              QAPTCY                          APPTCY                B08040
     I              QAPCDP                          APPCDP                B08040
     I              QAAYNM                          APAYNM                B08040
     I              QACSBY                          APCSBY                B08040
     I              QABYDP                          APBYDP                B08040
     I              QACLAS                          APCLAS                B08040
     I              QAACOC                          APACOC                B08040
     I              QAOTNM                          APOTNM                B08040
     I              QAOTEX                          APOTEX                B08040
     I              QAAPBC                          APAPBC                B08255
     I              QAFLEX                          APFLEX                B08253
     I              QACOLC                          APCOLC                B08268
     I              QABRCD                          APBRCD                B08268
     I              QANPDT                          APNPDT                B08268
     I*                                                                   B08040
     I*  RENAME FIELDS FROM PMHPOSLL                                      B08040
     IPMHPOSP0                                                            B08040
     I              QARECI                          HPRECI                B08040
     I              QACNUM                          HPCNUM                B08040
     I              QAPTFR                          HPPTFR                B08040
     I              QATDSS                          HPTDSS                B08040
     I              QATVDA                          HPTVDA                B08040
     I              QAPDAT                          HPPDAT                B08040
     I              QANOML                          HPNOML                B08040
     I              QACSEX                          HPCSEX                B08040
     I              QAAPNM                          HPAPNM                B08040
     I              QAFXAP                          HPFXAP                B08040
     I              QAPILP                          HPPILP                B08040
     I              QAACDI                          HPACDI                B08040
     I              QABVLD                          HPBVLD                B08040
     I              QATNMC                          HPTNMC                B08040
     I              QATNMD                          HPTNMD                B08040
     I              QAPTCY                          HPPTCY                B08040
     I              QAPCDP                          HPPCDP                B08040
     I              QAAYNM                          HPAYNM                B08040
     I              QACSBY                          HPCSBY                B08040
     I              QABYDP                          HPBYDP                B08040
     I              QACLAS                          HPCLAS                B08040
     I              QAACOC                          HPACOC                B08040
     I              QAOTNM                          HPOTNM                B08040
     I              QAOTEX                          HPOTEX                B08040
     I              QAAPBC                          HPAPBC                B08255
     I              QAFLEX                          HPFLEX                B08253
     I              QACOLC                          HPCOLC                B08268
     I              QABRCD                          HPBRCD                B08268
     I              QANPDT                          HPNPDT                B08268
     I*                                                                   S01313
     I** DS USED TO PASS PARAMETERS TO CALLED PROGRAMS                    S01313
     I***WWSAVE****E DSPMHOLDPP                                    S01313 S01486
     I***WWSAVE****E*DSPMHOLDPD                                           101188
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I****PMSTAT      DS                                                  062862
     IPMSTAT    E DS                                                      062862
     I                                        1   50WWECD
     I                                        1 256 WWSTAT
      /COPY ZSRSRC,ZNCDZ2
      /COPY ZSRSRC,ZYLDZ1
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     IPSDS       SDS
     I                                      244 246 WSID
     I                                      254 263 USIDXX
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA********UDS                            256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *                                                                   CPM005
      **  DS to write position sequencing in PMHOLDPD                     CPM005
     I            DS                                                      CPM005
     I                                        1  11 WWPOSQ                CPM005
     I**********                              1   3 NMCY            CPM005CPM005
     I                                        1   3 WWNMCY                CPM005
     I I            'A'                       4   4 WWORK1                CPM005
     I                                        5   90WWMATY                CPM005
     I*
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Midas  Bank details                                          S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I**  Midas  SD Portfolio Management ICD details                   S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Midas  Currencies details                                    S01486
     I*                                                                   S01486
     ISDPLIN    E DSSDPLINPD                                              S01486
     I**  Midas  Portfolio Lending Instrument Types details            S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure                                            S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I**  Long data structure                                             S01486
     I*                                                                   S01486
     ISDMMOD    E DSSDMMODPD                                              CPB001
     I**  Module Details Accesses Via Access Program                      CPB001
     I*                                                                   CPB001
     ISDGELR    E DSSDGELRPD                                              160100
     I** General ledger details                                           160100
     I/COPY WNCPYSRC,PM1140I001
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * INDEX OF SUBROUTINES                                                   *
      * MAIN     - MAIN PROCESSING                                             *
      * INIT     - INITIAL PROCESSING                                          *
      * FULX     - FULL EXTRACT                                                *
      * CRGX     - CHARGING EXTRACT                                            *
      * VALX     - VALUATION EXTRACT                                           *
      * P01      - ACCESS INSTRUMENT DETAILS                                   *
      * P02      - ACCESS CUSTOMER DETAILS                                     *
      * P03      - ACCESS PORTFOLIO DETAILS                                    *
      * P04      - FORMAT DETAILS FOR OUT. TO THE PORT. HOLDINGS FILE          *
      * P05      - UPDATE PORTFOLIO AND CUSTOMER TOTALS                        *
      * P06      - DETERMINE INTEREST DETAILS                                  *
      * P07      - AUDIT PROCESSING                                            *
      * P08      - CHECK WHETHER FLAT POSITION TO BE OUTPUT FOR 9998 & 9999    *
      * U01      - DELETE OPEN POSITION FOR DELETED SECURITY                   *
      * U02      - UPDATE LF/PMHPOSLL                                          *
      * U03      - UPDATE PF/PMCPOSZZ                                          *
      * U04      - DELETE ALL OPEN POSITIONS FOR DELETED PORTFOLIO             *
      * W01      - WRITE TO PORTFOLIO HOLDINGS (PORTFOLIO)                     *
      * W02      - WRITE TO PORTFOLIO HOLDINGS (PORTF. CONSOLIDATED)           *
      * W03      - WRITE TO PORTFOLIO HOLDINGS (CUST. CONSOLIDATED)            *
      * W04      - WRITE TO PORTFOLIO HOLDINGS AUDIT                           *
      * W05      - WRITE PORTFOLIO HOLDINGS UPDATE (SE) AUDIT REPORT           *
      * Z01      - ZEROIZE ALL TOTAL FIELDS                                    *
      * ZNCD     - CALCUL THE NEXT COUPON DATE                                 *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      * ZCCYXR   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      * ZPRCI    - OUTPUT PRICE AS % PRICE                                     *
      * ZYLDI    - OUTPUT YIELD AS % PRICE                                     *
      * ZYLD     - CALCULATE YIELDS OR PRICE                                   *
      * ZYLDO    - OUTPUT PRICE AS PRICE/DISCOUNT/YIELD                        *
      * ZFSELN   - FORMAT THE 20A PORTF. MANAGEMENT DESC. TO SE 2              *
      * ZAVPRC   - CALCUL AVERAGE PRICE FOR A HOLDING                          *
      * ZFXAVP   - CALCUL AVERAGE FX RATE FOR A HOLDING                        *
      * ZAPNUM   - CALCUL AP NUMERATOR                                         *
      * ZDATE1   - VALIDATE DATE SUBMITTED                                     *
      * ZDATE2   - CONVERT A DAY NUMBER TO A DATE FORMAT                       *
      * ZAINSH   - CALCUL SE ACCRUED INTEREST - NON SCHULDSCHEIN               *
      * ZAISCH   - CALCUL SE ACCRUED INTEREST - SCHULDSCHEIN                   *
      * ZRATE    - CALCUL EFFECTIVE RATE                                       *
      * ZACCR    - CALCUL INTEREST ACCRUED BETWEEN 2 DATES                     *
      * ZDAYS    - CALCUL NUMBER OF DAYS BETWEEN TWO DATES                     *
      * ZDYYR    - CALCUL NUMBER OF DAYS IN INTEREST YEAR                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      *                                                                        *
      * EXTERNAL ROUTINES CALLED                                               *
      * ZYIELD   - CALCUL YIELDS OR PRICES                                     *
      *                                                                        *
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** KEY DEFINITION
     C*****************************************************************
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C           KPORT     KLIST
     C                     KFLD           KKCNUM
     C                     KFLD           KKPTFR
     C*
     C***********KPORQ2    KLIST                                          S01486
     C***********          KFLD           PNCNUM                          S01486
     C***********          KFLD           PNPTFR                          S01486
     C***********                                                         S01486
     C***********KCHRQ1    KLIST                                          S01486
     C***********          KFLD           POCNUM                          S01486
     C***********          KFLD           POPTFR                          S01486
     C*
     C           KPMC      KLIST
     C                     KFLD           QACNUM
     C                     KFLD           QAPTFR
     C                     KFLD           QATDSS
     C                     KFLD           QATVDA
     C*                                                                   B08040
     C           KAPOS     KLIST                                          B08040
     C                     KFLD           QACNUM                          B08040
     C                     KFLD           QAPTFR                          B08040
     C                     KFLD           QATDSS                          B08040
     C                     KFLD           QATVDA                          B08040
     C                     KFLD           QAPDAT                          B08040
     C*                                                                   B08040
     C           KPOST     KLIST                                          B08040
     C                     KFLD           QATDSS                          B08040
     C                     KFLD           QACNUM                          B08040
     C                     KFLD           WWTVD1  1                       B08040
     C                     KFLD           QAPTFR                          B08040
     C*                                                                   B08253
     C           KMFHL     KLIST                                          B08253
     C                     KFLD           QFCNUM                          B08253
     C                     KFLD           QFMODI                          B08253
     C                     KFLD           QFTRNB                          B08253
     C                     KFLD           QFTDSS                          B08253
     C                     KFLD           QFTXT2                          B08253
     C                     KFLD           QFPTFR                          B08253
     C*                                                                   49768
     C           KMFHL1    KLIST                                          49768
     C                     KFLD           QFCNUM                          49768
     C                     KFLD           QFMODI                          49768
     C                     KFLD           QFTRNB                          49768
     C                     KFLD           QFTDSS                          49768
     C                     KFLD           QFTXT2                          49768
     C                     KFLD           @PTFR                           101188
     C*                                                                   B08253
     C           KCPOS     KLIST                                          B08253
     C                     KFLD           WWTDSS                          B08253
     C                     KFLD           WWCNUM                          B08253
     C                     KFLD           WWTVDA                          B08253
     C                     KFLD           W1PTFR  4                       B08253
     C*                                                                   B08253
     C           KCPS1     KLIST                                          B08253
     C                     KFLD           WWTDSS                          B08253
     C                     KFLD           WWCNUM                          B08253
     C                     KFLD           WWTVDA                          B08253
     C*                                                                   038152
     C           SECDKY    KLIST                                          038152
     C                     KFLD           WWTDSS                          038152
     C                     KFLD           WWSDET  2                       038152
     C                     KFLD           WWSDED  50                      038152
     C*                                                                   053103
     C           POSETK    KLIST                                          053103
     C                     KFLD           QACNUM                          053103
     C                     KFLD           QAPTFR                          053103
     C                     KFLD           QATDSS                          053103
     C                     KFLD           WWPEVT                          053103
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** MAIN PROCESSING
     C*****************************************************************
     C*
     C           *ENTRY    PLIST
     C                     PARM           MODE    1
     C                     PARM           WWTVPS  1                       B08040
     C                     PARM           WWMTEX  1                       B08253
     C*
     C                     EXSR INIT
     C*
     C** IF MODE PARAMETER IS 'F' (FOR FULL EXTRACT) EXECUTE PROCESS
     C** FULX
     C           MODE      IFEQ 'F'
     C                     EXSR FULX
     C***********          ELSE                                           S01486
     C***********                                                         S01486
     C***OTHERWISE,*IF*THE*MODE*PARAMETER*IS*'C'*(FOR CHARGING EXTRACT)   S01486
     C***EXECUTE*PROCESS*CRGX************************************         S01486
     C***********MODE      IFEQ 'C'                                       S01486
     C***********          EXSR CRGX                                      S01486
     C***********          ELSE                                           S01486
     C***********                                                         S01486
     C***OTHERWISE*(VALUATION*EXTRACT)*EXECUTE*PROCESS*VALX******         S01486
     C***********          EXSR VALX                                      S01486
     C***********          END                                            S01486
     C                     END
     C*
     C** EXECUTE PROCESS P07 - AUDIT PROCESSING
     C                     EXSR P07
     C                     SETON                     LR
     C*
     C*****************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * INIT     - INITIAL PROCESSING                                          *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * Z01      - ZEROIZE ALL TOTAL FIELDS                                    *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           INIT      BEGSR                           ** INIT  BSR **
     C*                                                                   S01486
     C**  Define local data area                                          S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C/COPY WNCPYSRC,PM1140C024
      *                                                                   CPM004
      **Clear*WWSAVE*to*initialise*fields*correctly*for*write***    CPM004101188
      ************                                                  CPM004101188
     C************         CLEARWWSAVE                              CPM004101188
     C*
     C** PREPARE LDA
     C*                                                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM1140'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C                     MOVE 'N'       QFSPLD
     C*                                                                   B08040
     C** SET INDICATOR TO REVERSE OF POSITION                             B08040
     C           WWTVPS    IFEQ 'T'                                       B08040
     C                     MOVE 'V'       WWTVD1                          B08040
     C                     ELSE                                           B08040
     C                     MOVE 'T'       WWTVD1                          B08040
     C                     END                                            B08040
     C*
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1******************         S01486
     C***********          READ SDBANKL1                 71               S01486
     C************IN71     IFEQ '1'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD1         DBASE            **DB ERROR 01**S01486
     C***********          MOVEL'SDBANKL1'DBFILE           ***************S01486
     C***********          MOVEL*BLANKS   DBKEY                           S01486
     C*                                                                   S01486
     C**  Access bank details                                             S01486
     C*                                                                   S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            ***************S01486
     C                     MOVE 'SDBANKPD'DBFILE           *DB ERROR 001 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C** TEST DATE FORMAT FOR SR/ZDATE2
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C                     END
     C*                                                                   CPB001
     C**  Access Module Details                                           CPB001
     C*                                                                   CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM *BLANKS   P@RTCD                          CPB001
     C                     PARM '*FIRST'  P@OPTN                          CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
     C*                                                                   CPB001
     C           P@RTCD    IFNE *BLANKS                                   CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD29        DBASE            ***************CPB001
     C                     MOVE 'SDMMODPD'DBFILE           *DB ERROR 029 *CPB001
     C                     MOVEL'*FIRST'  DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   B08040
     C***GET*PORTFOLIO*MANAGEMENT*INSTALLATION*CONTROL*DATA*RECORD B08040 S01486
     C***********1         SETLLSDPORTPD                           B08040 S01486
     C***********          READ SDPORTPD                 71        B08040 S01486
     C************IN71     IFEQ '1'                        ********B08040 S01486
     C***********          Z-ADD21        DBASE            **DB ERRB08040 S01486
     C***********          MOVEL'SDPORTPD'DBFILE           ********B08040 S01486
     C***********          MOVEL*BLANKS   DBKEY                    B08040 S01486
     C*                                                                   S01486
     C**  Access Portfolio Management ICD                                 S01486
     C*                                                                   S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD21        DBASE            ***************S01486
     C                     MOVE 'SDPORTPD'DBFILE           *DB ERROR 021 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C/COPY WNCPYSRC,PM1140C001
     C***READ*THROUGH*SDCURRL0*SETTING*UP*ARRAY*OF*CURRENCIES****  B08040 S01486
     C***********          READ SDCURRL0                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the first Currency record                                  S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C                     PARM           P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD23        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 023 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set up array of currencies                                      S01486
     C*                                                                   S01486
     C                     Z-ADD1         B       30                      B08040
     C************IN72     DOWEQ'0'                                B08040 S01486
     C           P@RTCD    DOWNE'*EOF'                                    S01486
     C                     MOVE A6CYCD    CYCD,B                          B08040
     C                     Z-ADDA6SPRT    SPRT,B                          B08040
     C                     MOVE A6MDIN    MDIN,B                          B08040
     C                     Z-ADDA6NBDP    NBDP,B                          B08040
     C                     Z-ADDA6RKSQ    RKSQ,B                          B08040
     C                     MOVE A6INCY    INCI,B                          160100
     C                     Z-ADDA6EUER    EUER,B                          160100
     C                     MOVE A6EUMD    EUMD,B                          160100
     C                     ADD  1         B                               B08040
     C***********          READ SDCURRL0                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the next record in currencies file                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*NEXT '  P@OPTN                          S01486
     C                     PARM           P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           P@RTCD    ANDNE'*EOF'                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD24        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 024 *S01486
     C                     MOVEL'*NEXT '  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C** READ THROUGH PMDSPGPP SETTING UP ARRAY OF DISPLAY GROUPS         B08040
     C***********          READ PMDSPGPP                 72        B08040 S01486
     C                     READ PMDSPGPD                 72               S01486
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PADSPG    DSPG,B                          B08040
     C                     Z-ADDPADSPS    DSPS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMDSPGPP                 72        B08040 S01486
     C                     READ PMDSPGPD                 72               S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C** READ THROUGH PMVLGHPP SETTING UP ARRAY OF VALUATION GROUPS       B08040
     C***********          READ PMVLGHPP                 72        B08040 S01486
     C                     READ PMVLGHPD                 72               S01486
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PBVALG    VALG,B                          B08040
     C                     Z-ADDPBVLGS    VLGS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMVLGHPP                 72        B08040 S01486
     C                     READ PMVLGHPD                 72               S01486
     C                     END                                            B08040
     C*
     C** DEFINE DATA AREA PMSTAT
     C           *NAMVAR   DEFN           PMSTAT
     C                     IN   PMSTAT
     C**************************                                   S01486 081350
     C****Define*local*data*area                                   S01486 081350
     C**************************                                   S01486 081350
     C********** *NAMVAR   DEFN           LDA                      S01486 081350
     C*
     C** ZEROIZE ALL PORTFOLIO AND CUSTOMER TOTALS (NOMINAL ETC.)
     C                     EXSR Z01
     C*
     C** READ FIRST RECORD FROM LF/LBPLEGTU TO OBTAIN DETAILS OF FIRST
     C** PLEDGED SECURITY POSITION
     C***********          READ LBPLEGTU                 74               S01486
     C                     READ LBPLEGLQ                 74               S01486
     C                     MOVELPGSESN    WWTES1 16
     C                     MOVE PGISSB    WWTES1
     C                     MOVELWWTES1    WWPLEG 20
     C                     MOVE PGPTFR    WWPLEG
     C*
     C** Call access object : General Ledger                              160100
     C*                                                                   160100
     C**********           CALL 'AOGELRR0'                                160100              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' P@RTCD                          160100
     C                     PARM '*FIRST ' P@OPTN                          160100
     C********** SDGELR    PARM SDGELR    DSFDY                           160100              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   160100
      **  If record not found, DB error                                   160100
     C           P@RTCD    IFNE *BLANKS                    *B1            160100
     C                     Z-ADD20        DBASE            ***************160100
     C                     MOVE 'SDGELRPD'DBFILE           * DB ERROR 20 *160100
     C                     MOVEL*BLANKS   DBKEY            ***************160100
     C                     EXSR *PSSR                                     160100
     C                     END                             *E1            160100
     C*                                                                   160100
     C*
     C           EINIT     ENDSR                           ** END INIT  **
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * FULX     - FULL EXTRACT                                                *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * W02      - WRITE TO PORTFOLIO HOLDINGS (PORTF. CONSOLIDATED)           *
      * W03      - WRITE TO PORTFOLIO HOLDINGS (CUST. CONSOLIDATED)            *
      * Z01      - ZEROIZE ALL TOTAL FIELDS                                    *
      * P01      - ACCESS INSTRUMENT DETAILS                                   *
      * P02      - ACCESS CUSTOMER DETAILS                                     *
      * P03      - ACCESS PORTFOLIO DETAILS                                    *
      * U01      - DELETE ALL OPEN POSITIONS FOR DELETED PORTFOLIO             *
      * U02      - UPDATE LF/PMHPOSLL                                          *
      * P04      - FORMAT DETAILS FOR OUT. TO THE PORT. HOLDINGS FILE          *
      * P05      - UPDATE PORTFOLIO AND CUSTOMER TOTALS                        *
      * W01      - WRITE TO PORTFOLIO HOLDINGS (PORTFOLIO)                     *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWTDSS   - SECURITY FROM LF(PMCPOSL0                                   *
      * WWCNUM   - CUSTOMER NUMBER                                             *
      * WWTVDA   - TRADE/VALUE DATE FROM LF/PMCPOSL0                           *
      * WWPTFR   - PORTFOLIO REFERENCE                                         *
      * WWNOML   - NOMINAL FROM LF/PMCPOSL0                                    *
      * WWAPNM   - AP NUMERATOR FROM LF/PMCPOSL0                               *
      * WWAYNM   - AY NUMERATOR FROM LF/PMCPOSL0                               *
      * WWFXAP   - FX AP NUMERATOR FROM LF/PMCPOSL0                            *
      * WWCSEX   - EX-COUPON NOMINAL FROM LF/PMCPOSL0                          *
      * WWTNMC   - NOMINAL CURRENCY FROM LF/PMCPOSL0                           *
      * WWPTCY   - PORTFOLIO CURRENCY FROM LF/PMCPOSL0                         *
      * WWPILP   - PURCHASED INTEREST FROM LF/PMCPOSL0                         *
      * WWRECI   - RECORD ID FROM LF/SECTY                                     *
      *                                                                        *
      **************************************************************************
     C           FULX      BEGSR                           ** FULX  BSR **
     C*
     C** READ FROM LF/PMCPOSL0 (CURRENT PORTFOLIO POSITIONS IN SECURITY
     C** SEQUENCE)
     C****                 READ PMCPOSL0                 71               B08040
     C************         READ PMCPOSXX                 71        B08040 065217
     C                     READ PMCPOSXX               6971               065217
     C*                                                                   S01486
     C**  Check if main file is empty                                     S01486
     C*                                                                   S01486
     C           *IN71     IFEQ '1'                                       S01486
     C                     MOVE 'Y'       WEMPTY  1                       S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANK    WEMPTY                          S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Process each LF/PMCPOSXX record                                 S01486
     C*                                                                   S01486
     C           *IN71     DOWEQ'0'                        B1
     C*
     C** IF AT LEAST ONE POSITION HAS PREVIOUSLY BEEN PROCESSED AND
     C** THE POSITION READ IN IS FOR A NEW SECURITY, CUSTOMER, OR
     C** TRADE/VALUE BASIS
     C           *IN75     IFEQ '1'                        B2
     C           WWTDSS    IFNE QATDSS                     B3
     C           WWCNUM    ORNE QACNUM
     C           WWTVDA    ORNE QATVDA
     C*                                                                   B08253
     C** CHECK WHETHER RECORDS TO BE OUTPUT FOR '9998' AND '9999'         B08253
     C** PORTFOLIOS ON FLAT POSITION EXTRACT RUN                          B08253
     C                     MOVE 'Y'       WWOUTP  1                       B08253
     C                     MOVE 'Y'       WWOUTC  1                       49768
     C           WWMTEX    IFEQ 'M'                                       B08253
     C                     EXSR P08                                       B08253
     C                     END                                            B08253
     C*
     C** WRITE A RECORD TO THE PORTFOLIO HOLDINGS FILE AS PER W02
     C** (PORTFOLIO CONSOLIDATED RECORD)
     C                     MOVE 'N'       QFSPLD
     C**********           Z-ADD0         QFTRNB                                              CLE148
     C                     MOVEL*BLANKS   QFTRNB                                              CLE148
     C           WWOUTP    IFEQ 'Y'                                       B08253
     C                     EXSR W02
     C                     END                                            B08253
     C*
     C** WRITE A RECORD TO THE PORTFOLIO HOLDINGS FILE AS PER W03
     C** IF PRIVATE BANKING MODULE IS NOT SWITCH *ON                      CPB001
     C** (CUSTOMER CONSOLIDATED RECORD)
     C********** WWOUTP    IFEQ 'Y'                                 B08253 49768
     C           WWOUTC    IFEQ 'Y'                                       49768
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     EXSR W03
     C                     END                                            B08253
     C*
     C** ZEROIZE ALL PORTFOLIO AND CUSTOMER TOTALS (NOMINAL...)
     C                     EXSR Z01
     C                     MOVE '0'       *IN75
     C                     END                             E3
     C                     END                             E2
     C*
     C** ON CHANGE OF SECURITY
     C** ACCESS INSTRUMENT DETAILS AS PER P01
     C           WWTDSS    IFNE QATDSS                     B2
     C                     EXSR P01
     C                     END                             E2
     C****                                                                B08040
     C****N CHANGE OF CUSTOMER                                            B08040
     C****CCESS CUSTOMER DETAILS FOR THE CUSTOMER NUMBER ON LF/PMCPOSL0   B08040
     C****S PER P02                                                       B08040
     C****       WWCNUM    IFNE QACNUM                     B2             B08040
     C****                 MOVE QACNUM    WCNUM   6                       B08040
     C****                 EXSR P02                                       B08040
     C****                 END                             E2             B08040
     C*
     C** ON CHANGE OF CUSTOMER OR PORTFOLIO REFERENCE
     C*
     C           WWCNUM    IFNE QACNUM                     B2
     C           WWPTFR    ORNE QAPTFR
     C*
     C** ACCESS PORTFOLIO DETAILS FOR THE CUSTOMER AND PORTF. REF.
     C** ON LF/PMCPOSL0 AS PER P03
     C**********           Z-ADDQACNUM    KKCNUM  60                                          CSD027
     C                     MOVE QACNUM    KKCNUM  6                                           CSD027
     C                     MOVE QAPTFR    KKPTFR  4
     C                     EXSR P03
     C                     END                             E2
     C*
     C** SAVE SOME FIELDS FROM FILE PMCPOSS
     C**********           Z-ADDQACNUM    WWCNUM  60                                          CSD027
     C                     MOVE QACNUM    WWCNUM  6                                           CSD027
     C                     MOVELQAPTFR    WWPTFR  4
     C                     MOVELQATVDA    WWTVDA  1
     C                     MOVELQATDSS    WWTDSS 10
     C**********           Z-ADDQANOML    WWNOML 110                                       AR1075401
     C                     Z-ADDQANOML    WWNOML 150                                       AR1075401
     C                     Z-ADDQAOTNM    WWOTNM 150                      B08040
     C                     Z-ADDQAOTEX    WWOTEX 110                      B08040
     C                     Z-ADDQAAPNM    WWAPNM 150
     C                     Z-ADDQAAYNM    WWAYNM 150
     C                     Z-ADDQAFXAP    WWFXAP 150
     C                     Z-ADDQACSEX    WWCSEX 150
     C                     MOVELQATNMC    WWTNMC  3
     C                     MOVELQAPTCY    WWPTCY  3
     C                     MOVELQACSBY    WWCSBY  3
     C                     Z-ADDQAPILP    WWPILP
     C                     MOVE QAAPBC    WWAPBC  1                       B08255
     C                     MOVELQAPFM8    WWPFM8  1                       CPM005
     C                     MOVELQAPFM9    WWPFM9  1                       CPM005
     C****                                                                B08040
     C***IF THE PORTFOLIO OF THE POSITION READ IN FROM LF/PMCPOSL0        B08040
     C***HAS BEEN CLOSED, IN OTHER WORDS IF THE RECORD ON PF/PMPORTPP     B08040
     C***FOR THE CUSTOMER AND PORTFOLIO REFERENCE HAS A RECORD ID OF      B08040
     C***'*'                                                              B08040
     C****       PNRECI    IFEQ '*'                                       B08040
     C****                                                                B08040
     C***UPDATE THE RECORD ID OF THE RECORD READ IN FROM LF/PMCPOSL0      B08040
     C***TO 'I' AS PER U01                                                B08040
     C****                 EXSR U01                                       B08040
     C****                                                                B08040
     C***ADD 1 TO A COUNT OF PORTFOLIO POSITIONS REMOVED                  B08040
     C****                 ADD  1         PPPREM                          B08040
     C******               ELSE                                           B08013
     C****                 END                                            B08013
     C*
     C** PORTFOLIO IS LIVE
     C** IF THE SECURITY OF THE POSITION READ IN FROM LF/PMCPOSL0
     C** HAS MATURED OR IS DELETED, IN OTHER WORDS IF THE RECORD
     C** ON LF/SECTY FOR THAT SECURITY HAS A RECORD ID OF 'M' OR '*'
     C****       PNRECI    IFEQ 'D'                        B2             B08040
     C*                                                                   053103
     C** FOR PM A SECURITY POSITION ONLY MATURES WHEN THERE ARE NO        053103
     C** POSITION SETTLEMENTS OUTSTANDING ON SECURITY                     053103
     C                     MOVE 'N'       WWMTNW  1                       053103
     C           WWRECI    IFEQ 'M'                        B2             053103
     C                     MOVE 'CP'      WWPEVT  2                       053103
     C           POSETK    CHAINPMPOSET1             78                   053103
     C           *IN78     IFEQ '1'                        B3             053103
     C                     MOVE 'MT'      WWPEVT                          053103
     C           POSETK    CHAINPMPOSET1             78                   053103
     C                     END                             E3             053103
     C*                                                                   053103
     C           *IN78     IFEQ '0'                        B3             053103
     C                     MOVE 'Y'       WWMTNW  1                       053103
     C                     MOVE 'D'       WWRECI                          053103
     C                     END                             E3             053103
     C                     END                             E2             053103
     C*                                                                   053103
     C           WWRECI    IFEQ '*'                        B3             B08013
     C           WWRECI    OREQ 'M'                                       B08013
     C*                                                                   B08013
     C****       WWRECI    IFEQ '*'                        B4       B08253B08013
     C                     EXSR U01                                       B08013
     C                     ADD  1         PPPREM                          B08013
     C****                 END                             E4       B08253B08013
     C*
     C** ACCESS LF/PMHPOSLL USING THE CUSTOMER NUMBER , PORTFOLIO
     C** REFERENCE, SECURITY SHORTNAME AND TRADE/VALUE DATE BASIS
     C** FROM LF/PMCPOSL0
     C                     MOVE 'T'       QATVDA
     C****       KPMC      CHAINPMHPOSLL             72                   48219
     C           KPMC      SETLLPMHPOSLL             72                   48219
     C           KPMC      READEPMHPOSLL                 72               48219
     C****       *IN72     IFEQ '0'                        B4             48219
     C           *IN72     DOWEQ'0'                        B4             48219
     C*
     C** UPDATE THE RECORD ID OF THE RECORD READ IN FROM LF/PMHPOSLL
     C** TO 'I' AS PER U02
     C                     EXSR U02
     C           KPMC      READEPMHPOSLL                 72               48219
     C                     END                             E4
     C*                                                                   B08013
     C                     MOVE 'V'       QATVDA                          B08013
     C****       KPMC      CHAINPMHPOSLL             72                   48219
     C           KPMC      SETLLPMHPOSLL             72                   48219
     C           KPMC      READEPMHPOSLL                 72               48219
     C****       *IN72     IFEQ '0'                        B4             48219
     C           *IN72     DOWEQ'0'                        B4             48219
     C                     EXSR U02                                       B08013
     C           KPMC      READEPMHPOSLL                 72               48219
     C                     END                             E4             B08013
     C                     END                             E3             B08013
     C*
     C** IF THE SECURITY OF THE POSITION READ IN FROM LF/PMCPOSL0
     C** IS NOT DELETED IN OTHER WORDS IF THE RECORD ON LF/SECTY FOR
     C** THAT SECURITY DOES NOT HAVE A RECORD ID OF '*'
     C           WWRECI    IFNE '*'                        B3
     C*
     C** FORMAT DETAILS FOR OUTPUT TO THE PORTFOLIO HOLDINGS FILE
     C** AS PER P04
     C                     EXSR P04
     C*
     C** UPDATE THE PORTFOLIO AND CUSTOMER TOTALS AS PER P05
     C                     EXSR P05
     C*
     C** WRITE A RECORD TO THE PORTFOLIO HOLDINGS FILE AS PER W01
     C** (PORTFOLIO RECORD)
     C                     EXSR W01
     C*
     C** ADD 1 TO A COUNT OF PORTFOLIO HOLDINGS CREATED
     C****                 ADD  1         PPHCRE                          B08040
     C*
     C** SET ON *IN75 => MEANS THAT AT LEAST ONE RECORD HAS BEEN
     C**              => PROCESSED
     C                     MOVE '1'       *IN75
     C                     END                             E3
     C****                 END                             E2             B08040
     C*                                                                   49768
     C** IF EXTRACTING DETAILS OF FLAT / MATURED POSITIONS                49768
     C** OR EXTRACTING DETAILS OF LIVE POSITIONS AND FLAT POSITION        49768
     C** EXTRACTED INDICATOR IS ON; THEN UPDATE PMCPOSPP                  49768
     C           WWMTEX    IFEQ 'M'                                       49768
     C           WWRECI    ANDEQ'D'                                       52474
     C           WWMTEX    OREQ 'L'                                       49768
     C           QAFLEX    ANDEQ'Y'                                       49768
     C           WWRECI    ANDEQ'D'                                       068169
     C*
     C** IF EXTRACTING DETAILS OF FLAT POSITIONS UPDATE EXTRACTED
     C** INDICATOR TO 'Y'
     C           WWMTEX    IFEQ 'M'
     C           WWRECI    ANDEQ'D'                                       S01313
     C                     MOVE 'Y'       QAFLEX
     C                     END                                            49768
     C*                                                                   49768
     C** IF EXTRACTING DETAILS OF LIVE POSITIONS UPDATE EXTRACTED         49768
     C** INDICATOR TO ' '                                                 49768
     C           WWMTEX    IFEQ 'L'                                       49768
     C                     MOVE ' '       QAFLEX                          49768
     C                     END                                            49768
     C*                                                                   49768
     C************         UPDATPMCPOSX0                                  065217
     C  N71N69             UPDATPMCPOSX0                                  065217
     C                     END
     C*
     C** READ FROM LF/PMCPOSL0
     C****                 READ PMCPOSL0                 71
     C************         READ PMCPOSXX                 71               065217
     C                     READ PMCPOSXX               6971               065217
     C                     END                             E1
     C*
     C** IF AT LEAST ONE POSITION HAS BEEN PROCESSED
     C           *IN75     IFEQ '1'                        B1
     C*                                                                   B08253
     C** CHECK WHETHER RECORDS TO BE OUTPUT FOR '9998' AND '9999'         B08253
     C** PORTFOLIOS ON FLAT POSITION EXTRACT RUN                          B08253
     C                     MOVE 'Y'       WWOUTP  1                       B08253
     C                     MOVE 'Y'       WWOUTC                          49768
     C           WWMTEX    IFEQ 'M'                                       B08253
     C                     EXSR P08                                       B08253
     C                     END                                            B08253
     C*
     C** WRITE A RECORD TO THE PORTFOLIO HOLDINGS FILE AS PER W02
     C** (PORTFOLIO CONSOLIDATED RECORD)
     C                     MOVE 'N'       QFSPLD
     C**********           Z-ADD0         QFTRNB                                              CLE148
     C                     MOVEL*BLANKS   QFTRNB                                              CLE148
     C           WWOUTP    IFEQ 'Y'                                       B08253
     C                     EXSR W02
     C                     END                                            B08253
     C*
     C** WRITE A RECORD TO THE PORTFOLIO HOLDINGS FILE AS PER W03
     C** IF PRIVATE BANKING MODULE IS NOT SWITCH *ON                      CPB001
     C** (CUSTOMER CONSOLIDATED RECORD)
     C********** WWOUTP    IFEQ 'Y'                                 B08253 49768
     C           WWOUTC    IFEQ 'Y'                                       49768
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     EXSR W03
     C                     END                                            B08253
     C                     END                             E1
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * CRGX     - CHARGING EXTRACT                                            *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * P02      - ACCESS CUSTOMER DETAILS                                     *
      * P03      - ACCESS PORTFOLIO DETAILS                                    *
      * P01      - ACCESS INSTRUMENT DETAILS                                   *
      * P04      - FORMAT DETAILS FOR OUT. TO THE PORT. HOLDINGS FILE          *
      * W01      - WRITE TO PORTFOLIO HOLDINGS (PORTFOLIO)                     *
      * P05      - UPDATE PORTFOLIO AND CUSTOMER TOTALS                        *
      * W02      - WRITE TO PORTFOLIO HOLDINGS (PORTF. CONSOLIDATED)           *
      * W03      - WRITE TO PORTFOLIO HOLDINGS (CUST. CONSOLIDATED)            *
      * Z01      - ZEROIZE ALL TOTAL FIELDS                                    *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWCNUM   - CUSTOMER NUMBER                                             *
      * WWPTFR   - PORTFOLIO REFERENCE                                         *
      * WWTDSS   - SECURITY FROM LF(PMCPOSL0                                   *
      * WWTVDA   - TRADE/VALUE DATE FROM LF/PMCPOSL0                           *
      * WWNOML   - NOMINAL FROM LF/PMCPOSL0                                    *
      * WWAPNM   - AP NUMERATOR FROM LF/PMCPOSL0                               *
      * WWAYNM   - AY NUMERATOR FROM LF/PMCPOSL0                               *
      * WWFXAP   - FX AP NUMERATOR FROM LF/PMCPOSL0                            *
      * WWCSEX   - EX-COUPON NOMINAL FROM LF/PMCPOSL0                          *
      * WWTNMC   - NOMINAL CURRENCY FROM LF/PMCPOSL0                           *
      * WWPTCY   - PORTFOLIO CURRENCY FROM LF/PMCPOSL0                         *
      * WWPILP   - PURCHASED INTEREST FROM LF/PMCPOSL0                         *
      * WWRECI   - RECORD ID FROM LF/SECTY                                     *
      *                                                                        *
      **************************************************************************
     C***********CRGX      BEGSR                           ** CRGX  BSR **S01486
     C***********                                                         S01486
     C***READ*FROM*LF/PMCHRGQ1*(PORTFOLIOS*DUE*FOR*CHARGING)*****         S01486
     C***********          READ PMCHRGQ1                 71               S01486
     C************IN71     DOWEQ'0'                                       S01486
     C****                                                                B08040
     C****N CHANGE OF CUSTOMER                                            B08040
     C****CCESS CUSTOMER DETAILS FOR THE CUSTOMER NUMBER ON LF/PMCHRGQ1   B08040
     C****S PER P02                                                       B08040
     C****       WWCNUM    IFNE POCNUM                                    B08040
     C****                 MOVE POCNUM    WCNUM                           B08040
     C****                 EXSR P02                                       B08040
     C****                 END                                            B08040
     C***********                                                         S01486
     C***ON*CHANGE*OF*CUSTOMER*OR*PORTFOLIO*REFERENCE************         S01486
     C***ACCESS*PORTFOLIO*DETAILS*FOR*THE*CUSTOMER*AND*PORTFOLIO*         S01486
     C***REFERENCE*ON*LF/PMCHRGQ1*AS*PER*P03*********************         S01486
     C***********WWCNUM    IFNE POCNUM                                    S01486
     C***********WWPTFR    ORNE POPTFR                                    S01486
     C***********          Z-ADDPOCNUM    KKCNUM                          S01486
     C***********          MOVE POPTFR    KKPTFR                          S01486
     C***********          EXSR P03                                       S01486
     C***********                                                         S01486
     C***READ*EQUAL*FROM*LF/PMCPOSLL*(CURRENT*PORTFOLIO*POSITIONS)        S01486
     C***WITH*A*KEY*OF*CUSTOMER*AND*PORTFOLIO*REFERENCE*FROM*****         S01486
     C***LF/PMCHRGQ1*********************************************         S01486
     C***********KCHRQ1    SETLLPMCPOSLL                                  S01486
     C***********KCHRQ1    READEPMCPOSLL                 73               S01486
     C***********          MOVELPOCNUM    WWCNUM                          S01486
     C************IN73     DOWEQ'0'                                       S01486
     C***********                                                         S01486
     C***ON*CHANGE*OF*SECURITY***********************************         S01486
     C***ACCESS*INSTRUMENT*DETAILS*AS*PER*P01********************         S01486
     C***********WWTDSS    IFNE QATDSS                                    S01486
     C***********          EXSR P01                                       S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***SAVE*SOME*FIELDS*FROM*FILE*PMCPOSS**********************         S01486
     C***********          MOVELQAPTFR    WWPTFR                          S01486
     C***********          MOVELQATVDA    WWTVDA                          S01486
     C***********          MOVELQATDSS    WWTDSS                          S01486
     C***********          Z-ADDQANOML    WWNOML                          S01486
     C***********          Z-ADDQAOTNM    WWOTNM                   B08040 S01486
     C***********          Z-ADDQAOTEX    WWOTEX                   B08040 S01486
     C***********          Z-ADDQAAPNM    WWAPNM                          S01486
     C***********          Z-ADDQAAYNM    WWAYNM                          S01486
     C***********          Z-ADDQAFXAP    WWFXAP                          S01486
     C***********          Z-ADDQACSEX    WWCSEX                          S01486
     C***********          MOVELQATNMC    WWTNMC                          S01486
     C***********          MOVELQAPTCY    WWPTCY                          S01486
     C***********          Z-ADDQAPILP    WWPILP                          S01486
     C***********                                                         S01486
     C***IF*THE*SECURITY*OF*THE*POSITION*READ*IN*FROM*LF/PMCPOSLL         S01486
     C***IS*LIVE*IE.*THE RECORD*ID*ON*LF/SECTY*FOR*THAT*SECURITY*IS       S01486
     C***'D'*****************************************************         S01486
     C***********WWRECI    IFEQ 'D'                                       S01486
     C***********                                                         S01486
     C***FORMAT*DETAILS*FOR*OUTPUT*TO*THE*PORTFOLIO*HOLDINGS*FILE         S01486
     C***AS*PER*P04**********************************************         S01486
     C***********          EXSR P04                                       S01486
     C***********                                                         S01486
     C***WRITE*A*RECORD*TO*THE*PORTFOLIO*HOLDINGS*FILE*AS*PER*W01         S01486
     C***(PORTFOLIO*RECORD)**************************************         S01486
     C***********          EXSR W01                                       S01486
     C***********                                                         S01486
     C***ADD*1*TO*A*COUNT*OF*PORTFOLIO*HOLDINGS*CREATED**********         S01486
     C****                 ADD  1         PPHCRE                          B08040
     C***********                                                         S01486
     C***UPDATE*THE*PORTFOLIO*AND*CUSTOMER*TOTALS*AS*PER*P05*****         S01486
     C***********          EXSR P05                                       S01486
     C***********                                                         S01486
     C***WRITE*A*RECORD*TO*THE*PORTFOLIO*HOLDINGS*FILE*AS*PER*W02         S01486
     C***(PORTFOLIO*CONSOLIDATED*RECORD)*************************         S01486
     C***********          MOVE 'N'       QFSPLD                          S01486
     C***********          Z-ADD0         QFTRNB                          S01486
     C***********          EXSR W02                                       S01486
     C***********                                                         S01486
     C***WRITE*A*RECORD*TO*THE*PORTFOLIO*HOLDINGS*FILE*AS*PER*W03         S01486
     C***(CUSTOMER*CONSOLIDATED*RECORD)**************************         S01486
     C***********          EXSR W03                                       S01486
     C***********                                                         S01486
     C***NOTE*THAT*THESE*RECORDS*ARE*NOT*ACTUALLY*CONSOLIDATED*TOTALS     S01486
     C***BUT*ARE*OUTPUT*IN*THIS*MODE*AS*THEY*ARE*REQUIRED*BY*PM1150*FOR   S01486
     C***TOTALS**************************************************         S01486
     C***********                                                         S01486
     C***ZEROIZE*ALL*PORTFOLIO*AND*CUSTOMER*TOTALS*(NOMINAL*ETC.)         S01486
     C***********          EXSR Z01                                       S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***READ*EQUAL*FROM*LF/PMCPOSLL*(CURRENT*PORTFOLIO*POSITIONS)        S01486
     C***WITH*A*KEY*OF*THE*CUSTOMER*AND*PORTFOLIO*REFERENCE*FROM          S01486
     C***LF/PMCHRGQ1*********************************************         S01486
     C***********KCHRQ1    READEPMCPOSLL                 73               S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***READ*FROM*LF/PMCHRGQ1*(PORTFOLIOS*DUE*FOR*CHARGING)*****         S01486
     C***********          READ PMCHRGQ1                 71               S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          ENDSR                                          S01486
     C***********                                                         S01486
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * VALX     - VALUATION EXTRACT                                           *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * P02      - ACCESS CUSTOMER DETAILS                                     *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * P01      - ACCESS INSTRUMENT DETAILS                                   *
      * P04      - FORMAT DETAILS FOR OUT. TO THE PORT. HOLDINGS FILE          *
      * W01      - WRITE TO PORTFOLIO HOLDINGS (PORTFOLIO)                     *
      * P05      - UPDATE PORTFOLIO AND CUSTOMER TOTALS                        *
      * W02      - WRITE TO PORTFOLIO HOLDINGS (PORTF. CONSOLIDATED)           *
      * W03      - WRITE TO PORTFOLIO HOLDINGS (CUST. CONSOLIDATED)            *
      * Z01      - ZEROIZE ALL TOTAL FIELDS                                    *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWCNUM   - CUSTOMER NUMBER                                             *
      * WWC9NP   - SPOT RATE FOR PORTF. CUR. FROM LF/SDCURRL0                  *
      * WWA8SP   - MULT/DIV. IND. FOR PORTFOLIO CUR. FROM LF/SDCURRL0          *
      * WWDANP   - PORTFOLIO CUR.DE.PLACES FROM LF/SDCURRL0                    *
      * WWTDSS   - SECURITY FROM LF(PMCPOSL0                                   *
      * WWPTFR   - PORTFOLIO REFERENCE                                         *
      * WWTVDA   - TRADE/VALUE DATE FROM LF/PMCPOSL0                           *
      * WWNOML   - NOMINAL FROM LF/PMCPOSL0                                    *
      * WWAPNM   - AP NUMERATOR FROM LF/PMCPOSL0                               *
      * WWAYNM   - AY NUMERATOR FROM LF/PMCPOSL0                               *
      * WWFXAP   - FX AP NUMERATOR FROM LF/PMCPOSL0                            *
      * WWCSEX   - EX-COUPON NOMINAL FROM LF/PMCPOSL0                          *
      * WWTNMC   - NOMINAL CURRENCY FROM LF/PMCPOSL0                           *
      * WWPTCY   - PORTFOLIO CURRENCY FROM LF/PMCPOSL0                         *
      * WWPILP   - PURCHASED INTEREST FROM LF/PMCPOSL0                         *
      * WWRECI   - RECORD ID FROM LF/SECTY                                     *
      *                                                                        *
      **************************************************************************
     C***********VALX      BEGSR                           ** VALX  BSR **S01486
     C***********                                                         S01486
     C***READ*FROM*LF/PMPORTQ2*(PORTFOLIOS*DUE*FOR*VALUATION)****         S01486
     C***********          READ PMPORTQ2                 71               S01486
     C************IN71     DOWEQ'0'                                       S01486
     C****                                                                B08040
     C****N CHANGE OF CUSTOMER                                            B08040
     C****CCESS CUSTOMER DETAILS FOR THE CUSTOMER NUMBER ON LF/PMPORTQ2   B08040
     C****S PER P02                                                       B08040
     C****       WWCNUM    IFNE PNCNUM                                    B08040
     C****                 MOVE PNCNUM    WCNUM                           B08040
     C****                 EXSR P02                                       B08040
     C****                 END                                            B08040
     C***********                                                         S01486
     C***ACCESS*THE*SPOT*RATE*FOR*THE*PORTFOLIO*CURRENCY*FROM****         S01486
     C***LF/SDCURRL0*USING*THE*PORTFOLIO*CURRENCY*ON*LF/PMPORTQ2*         S01486
     C****       PNPTCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD2         DBASE            **DB ERROR 02**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELPNPTCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****ETRIEVE THE SPOT RATE FOR THE PORTFOLIO CURRENCY                B08040
     C****                 Z-ADDA6SPRT    WWC9NP 138                      B08040
     C****                                                                B08040
     C****ETRIEVE MULT/DIV.IN. FOR THE PORTFOLIO CURRENCY                 B08040
     C****                 MOVELA6MDIN    WWA8SP  1                       B08040
     C****                                                                B08040
     C****ETRIEVE*PORTFOLIO*CURRENCY*DEC.*PLACES*****************  B08040 S01486
     C****                 Z-ADDA6NBDP    WWDANP  10                      B08040
     C****                 END                                            B08040
     C***********                                                  B08040 S01486
     C***********          Z-ADD1         B                        B08040 S01486
     C****       PNPTCY    LOKUPCYCD,B                   72               B08040
     C***********QAPTCY    LOKUPCYCD,B                   72        B08040 S01486
     C***ERROR***************************************************  B08040 S01486
     C************IN72     IFEQ '0'                        ********B08040 S01486
     C***********          Z-ADD2         DBASE            **DB ERRB08040 S01486
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C****                 MOVELPNPTCY    DBKEY                           B08040
     C***********          MOVELQAPTCY    DBKEY                    B08040 S01486
     C***********          EXSR *PSSR                              B08040 S01486
     C***********          ELSE                                    B08040 S01486
     C***********          Z-ADDSPRT,B    A6SPRT                   B08040 S01486
     C***********          MOVE MDIN,B    A6MDIN                   B08040 S01486
     C***********          Z-ADDNBDP,B    A6NBDP                   B08040 S01486
     C***********          Z-ADDRKSQ,B    A6RKSQ                   B08040 S01486
     C***********          Z-ADDA6SPRT    WWC9NP 138               B08040 S01486
     C***********          MOVELA6MDIN    WWA8SP  1                B08040 S01486
     C***********          Z-ADDA6NBDP    WWDANP  10               B08040 S01486
     C***********          Z-ADDA6RKSQ    WWRKSQ  30               B08040 S01486
     C***********          END                                     B08040 S01486
     C***********                                                         S01486
     C***READ*EQUAL*FROM*LF/PMCPOSLL*(CURRENT*PORTFOLIO*POSITIONS)        S01486
     C***WITH*A*KEY*OF*CUSTOMER*AND*PORTFOLIO*REFERENCE*FROM*****         S01486
     C***LF/PMPORTQ2*********************************************         S01486
     C***********KPORQ2    SETLLPMCPOSLL                                  S01486
     C***********KPORQ2    READEPMCPOSLL                 73               S01486
     C***********          MOVELPNCNUM    WWCNUM                          S01486
     C************IN73     DOWEQ'0'                                       S01486
     C***********                                                         S01486
     C***ON*CHANGE*OF*SECURITY***********************************         S01486
     C***ACCESS*INSTRUMENT*DETAILS*AS*PER*P01********************         S01486
     C***********WWTDSS    IFNE QATDSS                                    S01486
     C***********          EXSR P01                                       S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***SAVE*SOME*FIELDS*FROM*FILE*PMCPOSS**********************         S01486
     C***********          MOVELQAPTFR    WWPTFR                          S01486
     C***********          MOVELQATVDA    WWTVDA                          S01486
     C***********          MOVELQATDSS    WWTDSS                          S01486
     C***********          Z-ADDQANOML    WWNOML                          S01486
     C***********          Z-ADDQAOTNM    WWOTNM                   B08040 S01486
     C***********          Z-ADDQAOTEX    WWOTEX                   B08040 S01486
     C***********          Z-ADDQAAPNM    WWAPNM                          S01486
     C***********          Z-ADDQAAYNM    WWAYNM                          S01486
     C***********          Z-ADDQAFXAP    WWFXAP                          S01486
     C***********          Z-ADDQACSEX    WWCSEX                          S01486
     C***********          MOVELQATNMC    WWTNMC                          S01486
     C***********          MOVELQAPTCY    WWPTCY                          S01486
     C***********          Z-ADDQAPILP    WWPILP                          S01486
     C***********                                                         S01486
     C***IF*THE*SECURITY*OF*THE*POSITION*READ*IN*FROM*LF/PMCPOSLL         S01486
     C***IS*LIVE*IE.*THE*RECORD*ID*ON*LF/SECTY*FOR*THAT*SECURITY*IS       S01486
     C***'D'*****************************************************         S01486
     C***********WWRECI    IFEQ 'D'                                       S01486
     C***********                                                         S01486
     C***FORMAT*DETAILS*FOR*OUTPUT*TO*THE*PORTFOLIO*HOLDINGS*FILE         S01486
     C***AS*PER*P04**********************************************         S01486
     C***********          EXSR P04                                       S01486
     C***********                                                         S01486
     C***WRITE*A*RECORD*TO*THE*PORTFOLIO*HOLDINGS*FILE*AS*PER*W01         S01486
     C***(PORTFOLIO*RECORD)**************************************         S01486
     C***********          EXSR W01                                       S01486
     C***********                                                         S01486
     C***ADD*1*TO*A*COUNT*OF*PORTFOLIO*HOLDINGS*CREATED**********         S01486
     C****                 ADD  1         PPHCRE                          B08040
     C***********                                                         S01486
     C***UPDATE*THE*PORTFOLIO*AND*CUSTOMER*TOTALS*AS*PER*P05*****         S01486
     C***********          EXSR P05                                       S01486
     C***********                                                         S01486
     C***WRITE*A*RECORD*TO*THE*PORTFOLIO*HOLDINGS*FILE*AS*PER*W02         S01486
     C***(PORTFOLIO*CONSOLIDATED*RECORD)*************************         S01486
     C***********          MOVE 'N'       QFSPLD                          S01486
     C***********          Z-ADD0         QFTRNB                          S01486
     C***********          EXSR W02                                       S01486
     C***********                                                         S01486
     C***WRITE*A*RECORD*TO*THE*PORTFOLIO*HOLDINGS*FILE*AS*PER*W03         S01486
     C***(CUSTOMER*CONSOLIDATED*RECORD)**************************         S01486
     C***********          EXSR W03                                       S01486
     C***********                                                         S01486
     C***NOTE*THAT*THESE*RECORDS*ARE*NOT*ACTUALLY*CONSOLIDATED*TOTALS     S01486
     C***BUT*ARE*OUTPUT*IN*THIS*MODE*AS*THEY*ARE*REQUIRED*BY*PM1150*FOR   S01486
     C***TOTALS**************************************************         S01486
     C***********                                                         S01486
     C***ZEROIZE*ALL*PORTFOLIO*AND*CUSTOMER*TOTALS*(NOMINAL*ETC.)         S01486
     C***********          EXSR Z01                                       S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***READ*EQUAL*FROM*LF/PMCPOSLL*(CURRENT*PORTFOLIO*POSITIONS)        S01486
     C***WITH*A*KEY*OF*THE*CUSTOMER*AND*PORTFOLIO*REFERENCE*FROM          S01486
     C***LF/PMPORTQ2*********************************************         S01486
     C***********KPORQ2    READEPMCPOSLL                 73               S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***READ*FROM*LF/PMPORTQ2*(PORTFOLIOS*DUE*FOR*VALUATION)****         S01486
     C***********          READ PMPORTQ2                 71               S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          ENDSR                                          S01486
     C***********                                                         S01486
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P01      - ACCESS INSTRUMENT DETAILS                                   *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * ZPRCI    - OUTPUT PRICE AS % PRICE                                     *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * FULX     - FULL EXTRACT                                                *
      * CRGX     - CHARGING EXTRACT                                            *
      * VALX     - VALUATION EXTRACT                                           *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWRECI   - RECORD IDENT.                                               *
      * WWNMDP   - NOMINAL DEC. PLACES FROM LF/SECTY                           *
      * WWNMCY   - NOMINAL CURRENCY FROM LF/SECTY                              *
      * WWSCOR   - COUNTRY OF RISK FROM LF/SECTY                               *
      * WWSIDY   - INDUSTRY FROM LF/SECTY                                      *
      * WWC9NN   - SPOT RATE FOR NOMINAL CUR. FROM LF/SDCURRL0                 *
      * WWA8SN   - MULT/DIV. IND. FOR NOMINAL CUR. FROM LF/SDCURRL0            *
      * WWDANN   - NOMINAL CUR.DEC.PLACES FROM LF/SDCURRL0                     *
      * WWINNR   - INVESTMENT TYPE FROM LF/INVTP                               *
      * WWECD    - EVENT CONTROL DATE                                          *
      * WWMKPR   - MARKET PRICE                                                *
      * WWITDS   - DISPLAY GROUP SEQ. FROM PF/SDPLINPD                         *
      * WWVLIS   - INSTRUMENT TYPE VALUATION SEQUENCE FROM SDPLINPD            *
      * WWDSPG   - DISPLAY GROUP FROM PF/SDPLINPD                              *
      * WWVALG   - VALUATION GROUP FROM PF/SDPLINPD                            *
      * WWDSPS   - DISPLAY GROUP SEQ. FROM PF/PMDSPGPP                         *
      * WWVLGS   - VALUATION GROUP SEQUENCE FROM PF/PMVLGSPP                   *
      *                                                                        *
      **************************************************************************
     C           P01       BEGSR                           ** P01   BSR **
     C*
     C** ACCESS THE SECURITIES FILE LF/SECTY USING THE SECURITY
     C** SHORTNAME FROM PF/PMCPOSPP
     C           QATDSS    CHAINSECTY                72
     C           *IN72     IFEQ '1'
     C***ERROR                                                            B08013
     C****                 Z-ADD3         DBASE            **DB ERROR 03**B08013
     C****                 MOVEL'SECTY'   DBFILE           ***************B08013
     C****                 MOVELQATDSS    DBKEY                           B08013
     C****                 EXSR *PSSR                                     B08013
     C                     MOVE '*'       WWRECI                          B08013
     C                     Z-ADD0         QFNMDP                          S71062
     C                     MOVE 'U'       QFSPBS                          S71062
     C                     GOTO P019                                      B08013
     C                     ELSE
     C*
     C** SAME SOME FIELDS
     C***********          MOVE 'N'       WWMTNW  1                 038152053103
     C***********RECI      IFEQ 'M'                        B2       038152053103
     C***********MATY      IFLE BJRDNB                     B3       038152053103
     C***********          MOVELRECI      WWRECI  1                       053103
     C***********          ELSE                            X3       038152053103
     C***********          MOVE 'D'       WWRECI                    038152053103
     C***********          MOVE 'Y'       WWMTNW                    038152053103
     C***********          END                             E3       038152053103
     C***********                                                   038152053103
     C***********          ELSE                            X3       038152053103
     C***********          MOVE RECI      WWRECI                    038152053103
     C**********           END                             E2       038152053103
     C                     MOVELRECI      WWRECI  1                       053103
     C                     Z-ADDNMDP      WWNMDP  10
     C                     MOVELNMCY      WWNMCY  3
     C                     MOVELSCOR      WWSCOR  2
     C**********           Z-ADDSIDY      WWSIDY  30                                          CER020
     C                     MOVE LOIC      WWLOIC  3                                           CER020
     C                     Z-ADDNMDP      QFNMDP                          S71062
     C                     MOVE SPBS      QFSPBS                          S71062
     C                     END
     C*
     C** ACCESS THE CURRENCIES FILE LF/SDCURRL0 USING THE NOMINAL
     C** CURRENCY FROM LF/SECTY
     C****       NMCY      CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD4         DBASE            **DB ERROR 04**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELNMCY      DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****ETRIEVE THE SPOT RATE FOR THE NOMINAL CURRENCY                  B08040
     C****                 Z-ADDA6SPRT    WWC9NN 138                      B08040
     C****                                                                B08040
     C****ETRIEVE MULT/DIV.IN. FOR THE NOMINAL CURRENCY                   B08040
     C****                 MOVELA6MDIN    WWA8SN  1                       B08040
     C****                                                                B08040
     C****ETRIEVE NOMINAL CURRENCY DEC. PLACES                            B08040
     C****                 Z-ADDA6NBDP    WWDANN  10                      B08040
     C****                                                                B08040
     C****AVE NOMINAL CURRENCY CHECKING SEQUENCE                          B08040
     C****                 Z-ADDA6RKSQ    WWRKNM  30                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           NMCY      LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD4         DBASE            **DB ERROR 04**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELNMCY      DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWC9NN 138                      B08040
     C                     MOVELA6MDIN    WWA8SN  1                       B08040
     C                     Z-ADDA6NBDP    WWDANN  10                      B08040
     C                     Z-ADDA6RKSQ    WWRKNM  30                      B08040
     C                     MOVELINCI,B    A6INCY                          160100
     C                     Z-ADDEUER,B    A6EUER                          160100
     C                     MOVE EUMD,B    A6EUMD                          160100
     C                     MOVELA6INCY    WWINCN  1                       160100
     C                     Z-ADDA6EUER    WWEUEN 138                      160100
     C                     MOVELA6EUMD    WWEUMN  1                       160100
     C                     Z-ADDA6NBDP    WWNBDN  10                      160100
     C                     END                                            B08040
     C*
     C** ACCESS THE INVESTMENT TYPES FILE LF/INVTP USING THE NOMINAL
     C** CURRENCY AND INVESTMENT TYPE FROM LF/SECTY
     C           KINV      KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C           KINV      CHAININVTP                72
     C           *IN72     IFEQ '1'
     C           RECI      OREQ '*'
     C** ERROR
     C                     Z-ADD5         DBASE            **DB ERROR 05**
     C***********          MOVEL'INVTP'   DBFILE           ***************S01486
     C                     MOVE 'INVTP'   DBFILE                          S01486
     C                     MOVELNMCY      DBKY6   6
     C                     MOVE SITP      DBKY6
     C                     MOVELDBKY6     DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *                                                                   182961
      ** Instrument type is defaulted from PF/SDPORTPD if a blank         182961
      ** instrument type is found.                                        182961
      ** Indicator 35 was used as the operation's resulting indicator.    182961
      *                                                                   182961
     C********** WWINNR    IFEQ *BLANKS                                              182961 MD020103
     C           INNR      IFEQ *BLANKS                                                     MD020103
     C           1         SETLLSDPORTPD                                  182961
     C                     READ SDPORTPD                 35               182961
     C**********           MOVE FCDINR    WWINNR                                     182961 MD020103
     C                     MOVE FCDINR    INNR                                              MD020103
     C                     ENDIF                                          182961
     C*
     C** SAVE SOME FIELDS
     C                     MOVELINNR      WWINNR  3
     C                     END
     C*
     C** CONVERT THE MARKET PRICE FROM LF/SECTY FROM A DISCOUNT/YIELD
     C** INTO A % PRICE ZPRCOT USING STANDARD SUBROUTINE ZPRCI WITH INPUT
     C** PARAMATERS ZPRCIN EQUAL TO MKPR FROM LF/SECTY AND ZFDATE
     C** EQUAL TO THE EVENT CONTROL DATE (AS DETERMINED IN P/INIT)
     C********** WWMTNW    IFEQ 'N'                        B1      038152053103
     C           WWRECI    IFEQ 'D'                        B1            053103
     C*                                                                   038152
     C           MKPR      IFNE *ZERO
     C                     Z-ADDMKPR      ZPRCIN
     C                     Z-ADDWWECD     ZFDATE
     C                     EXSR ZPRCI
     C                     Z-ADDZPRCOT    WWMKPR 158
     C                     ELSE
     C                     Z-ADD*ZERO     WWMKPR
     C                     END
     C*                                                                   038152
     C                     ELSE                            X1             038152
     C*                                                                   038152
     C** CHECK FOR 'RC' EVENT ON DIARY FILE                               038152
     C                     Z-ADDMATY      WWSDED                          038152
     C                     MOVE 'RC'      WWSDET                          038152
     C           SECDKY    CHAINSECET                78                   038152
     C*                                                                   038152
     C** IF 'RC' EVENT NOT FOUND CHECK FOR 'RP' EVENT                     038152
     C           *IN78     IFEQ '1'                        B2             038152
     C           RECI      OREQ '*'                                       038152
     C                     MOVE 'RP'      WWSDET                          038152
     C           SECDKY    CHAINSECET                78                   038152
     C                     END                             E2             038152
     C*                                                                   038152
     C** IF NEITHER 'RC' NOR 'RP' EVENTS FOUND SET TO 100%                038152
     C           *IN78     IFEQ '1'                        B2             038152
     C           RECI      OREQ '*'                                       038152
     C*                                                                   038152
     C** IF NEITHER RC NOR RP USE 100 IF PRICE BASIS IS P,ELSE 1 (U)      038152
     C*                                                                   038152
     C           SPBS      IFEQ 'P'                        B3             038152
     C                     Z-ADD100       WWMKPR                          038152
     C                     END                             E3             038152
     C           SPBS      IFEQ 'U'                        B3             038152
     C                     Z-ADD1         WWMKPR                          038152
     C                     END                             E3             038152
     C*                                                                   038152
     C                     ELSE                                           038152
     C                     Z-ADDSDRP      WWMKPR                          038152
     C                     END                             E2             038152
     C*                                                                   038152
     C                     END                             E1             038152
     C*
     C** ACCESS THE PM INSTRUMENT TYPES FILE PF/SDPLINPD USING THE
     C** INSTRUMENT TYPE FROM LF/INVTP
     C***********INNR      CHAINSDPLINPD             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***********PDRECI    OREQ '*'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD6         DBASE            **DB ERROR 06**S01486
     C***********          MOVEL'SDPLINPD'DBFILE           ***************S01486
     C***********          MOVELINNR      DBKEY                           S01486
     C*                                                                   S01486
     C                     CALL 'AOPLINR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM INNR      P@INNR  3                       S01486
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD6         DBASE            ***************S01486
     C                     MOVE 'SDPLINPD'DBFILE           *DB ERROR 006 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@INNR    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C*
     C** SAVE SOME FIELDS
     C                     Z-ADDPDITDS    WWITDS  20
     C                     Z-ADDPDVLIS    WWVLIS  20
     C                     MOVELPDDSPG    WWDSPG  3
     C                     MOVELPDVALG    WWVALG  3
     C                     END
     C*
     C** ACCESS THE DISPLAY GROUP DETAILS FILE PF/PMDSPGPP USING
     C** THE DISPLAY GROUP FROM PF/SDPLINPD
     C****       PDDSPG    CHAINPMDSPGPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****       PARECI    OREQ '*'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD7         DBASE            **DB ERROR 07**B08040
     C****                 MOVEL'PMDSPGPP'DBFILE           ***************B08040
     C****                 MOVELPDDSPG    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****                 Z-ADDPADSPS    WWDSPS  20                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PDDSPG    LOKUPDSPG,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD7         DBASE            **DB ERROR 07**B08040
     C***********          MOVEL'PMDSPGPP'DBFILE           ********B08040 S01486
     C                     MOVE 'PMDSPGPD'DBFILE                          S01486
     C                     MOVELPDDSPG    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDDSPS,B    WWDSPS  20                      B08040
     C                     END                                            B08040
     C*
     C** ACCESS THE VALUATION GROUP HEADINGS FILE PF/PMVLGHPP
     C** USING THE VALUATION GROUP FROM PF/SDPLINPD
     C****       PDVALG    CHAINPMVLGHPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****       PBRECI    OREQ '*'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD8         DBASE            **DB ERROR 08**B08040
     C****                 MOVEL'PMVLGHPP'DBFILE           ***************B08040
     C****                 MOVELPDVALG    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****                 Z-ADDPBVLGS    WWVLGS  20                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PDVALG    LOKUPVALG,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD8         DBASE            **DB ERROR 08**B08040
     C***********          MOVEL'PMVLGHPP'DBFILE           ********B08040 S01486
     C                     MOVE 'PMVLGHPD'DBFILE                          S01486
     C                     MOVELPDVALG    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDVLGS,B    WWVLGS  20                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** IF THE SECURITY IS INTEREST BEARING,USE AIBD METHOD,ELSE DISCOUNTB08040
     C*                                                                   B08040
     C           CD01      IFNE *ZERO                                     B08040
     C           DYBS      ANDNE'4'                                       B08040
     C                     MOVEL'A '      SYBS                            B08040
     C                     ELSE                                           B08040
     C                     MOVEL'DA'      SYBS                            B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C           DYBS      IFEQ '4'                                       B08040
     C                     MOVE '3'       DYBS                            B08040
     C                     MOVE '1'       DVBS                            B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CALCULATE MARKET YIELD ON SECURITY                               B08040
     C           PROT      IFNE '2'                                       B08035
     C           PROT      ANDNE'4'                                       B08035
     C           PROT      ANDNE'7'                                       B08035
     C           MATY      ANDNE0                                         B08035
     C           SPBS      ANDNE'U'                                       B08035
     C           MKPR      ANDGT1                                         B08035
     C*                                                                   B08035
     C** CALCULATE THE MARKET YIELD FROM THE MARKET PRICE USING STAN      B08035
     C** SUBROUTINE ZYLDO WITH INPUT PARM.:                               B08035
     C**  PRICE: EQUAL TO THE MARKET PRICE                                B08035
     C**  FDATE: EQUAL TO THE EVENT CONTROL DATE (P/INIT)                 B08035
     C                     Z-ADDMKPR      ZPRICE 158                      B08035
     C                     Z-ADDWWECD     ZFDATE                          B08035
      *                                                                                       250227
     C           SEDKY     SETLLSEDEVDF                                                       250227
     C           SEDKY     READESEDEVDF                  90                                   250227
     C                     MOVE '0'       *IN91                                               250227
     C           *IN90     DOWEQ'0'                                                           250227
     C           *IN91     ANDEQ'0'                                                           250227
     C           RECI      IFNE '*'                                                           250227
     C           SDET      ANDEQ'RC'                                                          250227
     C           RECI      ORNE '*'                                                           250227
     C           SDET      ANDEQ'RP'                                                          250227
     C                     MOVE '1'       *IN91                                               250227
     C                     Z-ADDSDRP      WKPRIC 159                                          250227
     C                     ELSE                                                               250227
     C           SEDKY     READESEDEVDF                  90                                   250227
     C                     END                                                                250227
     C                     END                                                                250227
      *                                                                                       250227
     C           *IN90     IFEQ '1'                                                           250227
     C                     Z-ADD100       WKPRIC                                              250227
     C                     END                                                                250227
      *                                                                                       250227
     C           WKPRIC    IFGT ZPRICE                                                        250227
     C                     Z-ADDWKPRIC    ZPRICE                                              250227
     C                     ENDIF                                                              250227
      *                                                                                       250227
     C           STBS      IFEQ 'Y'                                                           250227
     C                     EXSR ZYLDO                                     B08035
     C           ZYLDOT    IFGT 0                                         B08035
     C                     Z-ADDZYLDOT    WWMKYD 117                      B08035
     C                     ELSE                                           B08035
     C                     Z-SUB9999      WWMKYD                          B08035
     C                     END                                            B08035
     C                     ENDIF                                                              250227
     C**                                                                  B08035
     C**  ..OTHERWISE YIELD CANNOT BE CALCULATED ON SECURITY              B08035
     C                     ELSE                                           B08035
     C                     Z-ADD0         WWMKYD                          B08035
     C                     END                                            B08035
     C*
     C****                 ENDSR                                          B08013
     C           P019      ENDSR                                          B08013
     C*
     C********************************************************************B08040
      ****CT                                                              B08040
      ********************************************************************B08040
      ****                                                                B08040
      ****2      - ACCESS CUSTOMER DETAILS                                B08040
      ****                                                                B08040
      ****BROUTINE CALLS:                                                 B08040
      ****SSR    - ERROR SUBROUTINE                                       B08040
      ****                                                                B08040
      ****BROUTINE CALLED FROM:                                           B08040
      ****LX     - FULL EXTRACT                                           B08040
      ****GX     - CHARGING EXTRACT                                       B08040
      ****LX     - VALUATION EXTRACT                                      B08040
      ****                                                                B08040
      ****UTINE USES VARIABLES:                                           B08040
      ****AVCD   - ACCOUNT OFFICER FROM LF/SDPLCSL0                       B08040
      ****                                                                B08040
      ********************************************************************B08040
     C****       P02       BEGSR                           *** P02    *** B08040
     C****                                                                B08040
     C****CCESS CUSTOMER DETAILS FROM LF/SDPLCSL0 USING A KEY OF THE      B08040
     C****USTOMER NUMBER PASSED TO THIS PROCESS                           B08040
     C****       WCNUM     CHAINSDPLCSL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD9         DBASE            **DB ERROR 09**B08040
     C****                 MOVEL'SDPLCSL0'DBFILE           ***************B08040
     C****                 MOVELWCNUM     DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****                 MOVELBBACOC    WWACOC  2                       B08040
     C****                 END                                            B08040
     C****                                                                B08040
     C****                 ENDSR                                          B08040
     C****                                                                B08040
     C********************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P03      - ACCESS PORTFOLIO DETAILS                                    *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * FULX     - FULL EXTRACT                                                *
      * CRGX     - CHARGING EXTRACT                                            *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWC9NP   - SPOT RATE FOR PORTF. CUR. FROM LF/SDCURRL0                  *
      * WWA8SP   - MULT/DIV. IND. FOR PORTFOLIO CUR. FROM LF/SDCURRL0          *
      * WWDANP   - PORTFOLIO CUR.DE.PLACES FROM LF/SDCURRL0                    *
      *                                                                        *
      **************************************************************************
     C           P03       BEGSR                           *** P03    ***
     C****                                                                B08040
     C**** IF HOLDING IS IN THE 'UNASSIGNED' PORTFOLIO                    B08040
     C****                                                                B08040
     C****       KKPTFR    IFEQ '9997'                                    B08040
     C****                                                                B08040
     C****SE THE CUSTOMER DETAILS FROM LF/SDPLCSL0 AS THE 'PORTFOLIO' DETAB08040
     C****                                                                B08040
     C****                 MOVEL'D'       PNRECI                          B08040
     C****                 MOVELQBCSBY    PNPTCY                          B08040
     C****                 Z-ADDQBBYDP    PNPCDP                          B08040
     C****                                                                B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****CCESS THE PORTFOLIO DEFINITION DETAILS FROM PF/PMPORTPP USING A B08040
     C****EY OF THE CUSTOMER & PORTFOLIO REFERENCE PASSED TO THIS PROCESS B08040
     C****                                                                B08040
     C****       KPORT     CHAINPMPORTPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                             ***************B08040
     C****                 Z-ADD10        DBASE            **DB ERROR 10**B08040
     C****                 MOVEL'PMPORTPP'DBFILE           ***************B08040
     C****                 MOVELKKCNUM    DBKY10 10                       B08040
     C****                 MOVE KKPTFR    DBKY10                          B08040
     C****                 MOVELDBKY10    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 END                                            B08040
     C****                 END                                            B08040
     C*
     C** IF THE PORTFOLIO RECORD ID IS 'D'
     C*
     C***********PNRECI    IFEQ 'D'                                       R00631
     C*
     C** ACCESS THE SPOT RATE FOR THE PORTFOLIO CURRENCY FROM
     C** LF/SDCURRL0 USING THE PORTFOLIO CURRENCY ON PF/PMPORTPP
     C****       PNPTCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                             ***************B08040
     C****                 Z-ADD11        DBASE            **DB ERROR 11**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELPNPTCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 END                                            B08040
     C****                 Z-ADDA6SPRT    WWC9NP 138                      B08040
     C****                 MOVELA6MDIN    WWA8SP  1                       B08040
     C****                 Z-ADDA6NBDP    WWDANP  10                      B08040
     C****                 Z-ADDA6RKSQ    WWRKSQ  30                      B08040
     C************         END                                            B08040
     C                     Z-ADD1         B                               B08040
     C****       PNPTCY    LOKUPCYCD,B                   72               B08040
     C           QAPTCY    LOKUPCYCD,B                   72               B08040
     C*                                                                ***B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD11        DBASE            **DB ERROR 11**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C****                 MOVELPNPTCY    DBKEY                           B08040
     C                     MOVELQAPTCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWC9NP 138                      B08040
     C                     MOVELA6MDIN    WWA8SP  1                       B08040
     C                     Z-ADDA6NBDP    WWDANP  10                      B08040
     C                     Z-ADDA6RKSQ    WWRKSQ  30                      B08040
     C                     MOVELINCI,B    A6INCY                          160100
     C                     Z-ADDEUER,B    A6EUER                          160100
     C                     MOVE EUMD,B    A6EUMD                          160100
     C                     MOVELA6INCY    WWINCP  1                       160100
     C                     Z-ADDA6EUER    WWEUEP 138                      160100
     C                     MOVELA6EUMD    WWEUMP  1                       160100
     C                     Z-ADDA6NBDP    WWNBDP  10                      160100
     C****                                                                B08040
     C****F PORTFOLIO HAS BEEN DELETED PERFORM U04 TO REMOVE ALL          B08040
     C****OSITIONS FOR PORTFOLIO                                          B08040
     C****       PNRECI    CASEQ'*'       U04                             B08040
     C****                 END                                            B08040
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P04      - FORMAT DETAILS FOR OUT. TO THE PORT. HOLDINGS FILE          *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * ZFSELN   - FORMAT THE 20A PORTF. MANAGEMENT DESC. TO SE 2              *
      * ZAVPRC   - CALCUL AVERAGE PRICE FOR A HOLDING                          *
      * ZFXAVP   - CALCUL AVERAGE FX RATE FOR A HOLDING                        *
      * ZAPNUM   - CALCUL AP NUMERATOR                                         *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      * P06      - DETERMINE INTEREST DETAILS                                  *
      * ZYLDO    - OUTPUT PRICE AS PRICE/DISCOUNT/YIELD                        *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * FULX     - FULL EXTRACT                                                *
      * CRGX     - CHARGING EXTRACT                                            *
      * VALX     - VALUATION EXTRACT                                           *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWTXT1   - INSTRUMENT NAME FROM LF/SECTY                               *
      * WWNMCY   - NOMINAL CURRENCY FROM LF/SECTY                              *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAIL NARRATIVE                         *
      * WWNOML   - NOMINAL FROM LF/PMCPOSL0                                    *
      * WWAPNM   - AP NUMERATOR FROM LF/PMCPOSL0                               *
      * WWAYNM   - AY NUMERATOR FROM LF/PMCPOSL0                               *
      * WWNMDP   - NOMINAL DEC. PLACES FROM LF/SECTY                           *
      * WWDANN   - NOMINAL CUR.DEC.PLACES FROM LF/SDCURRL0                     *
      * WWBPRC   - BOOK PRICE                                                  *
      * WWBFXR   - BOOK FX RATE                                                *
      * WWMVAL   - MARKET VALUE IN NOMINAL CURRENCY                            *
      * WWBVAL   - BOOK VALUE                                                  *
      * WWMKPR   - MARKET PRICE                                                *
      * WWPLMK   - PROFIT/LOSS MARKET                                          *
      * WWTNMC   - NOMINAL CURRENCY FROM LF/PMCPOSL0                           *
      * WWPTCY   - PORTFOLIO CURRENCY FROM LF/PMCPOSL0                         *
      * WWC9NN   - SPOT RATE FOR NOMINAL CUR. FROM LF/SDCURRL0                 *
      * WWC9NP   - SPOT RATE FOR PORTF. CUR. FROM LF/SDCURRL0                  *
      * WWA8SN   - MULT/DIV. IND. FOR NOMINAL CUR. FROM LF/SDCURRL0            *
      * WWA8SP   - MULT/DIV. IND. FOR PORTFOLIO CUR. FROM LF/SDCURRL0          *
      * WWDANP   - PORTFOLIO CUR.DE.PLACES FROM LF/SDCURRL0                    *
      * WWFXAP   - FX AP NUMERATOR FROM LF/PMCPOSL0                            *
      * WWPLFX   - PROFIT/LOSS FX                                              *
      * WWPTFR   - PORTFOLIO REFERENCE                                         *
      * WWPILP   - PURCHASED INTEREST FROM LF/PMCPOSL0                         *
      * WWINTK   - ACCRUED INTEREST CALCULATED IN STANDARD SR                  *
      * WWNIDT   - NEXT INTEREST DATE                                          *
      * WWSLID   - START/LAST INTEREST DATE                                    *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTERESTS                            *
      * WWECD    - EVENT CONTROL DATE                                          *
      * WWBKYD   - BOOK YIELD                                                  *
      * WWMKYD   - MARKET YIELD                                                *
      * WWDRYD   - DIRECT YIELD                                                *
      *                                                                        *
      **************************************************************************
     C           P04       BEGSR                           *** P04    ***
     C*
     C** CHECK WHETHER THE SECURITY POSITION IS CURRENTLY PLEDED
     C*
     C** SET UP STRING CONTAINING DETAILS OF PORTFOLIO POSITION
     C**********           Z-ADD0         QFTRNB                                              CLE148
     C                     MOVEL*BLANKS   QFTRNB                                              CLE148
     C           *IN74     IFEQ '0'
     C                     MOVELQATDSS    WWTES1 16
     C                     MOVE QACNUM    WWTES1
     C                     MOVELWWTES1    WWCPOS 20
     C                     MOVE QAPTFR    WWCPOS
     C*
     C** IF KEY FROM LF/PMCPOSL0 EQUAL TO PLEDGED POSITION ON LBPLEGTU
     C** SET PLEDGED INDICATOR TO 'Y'
     C           WWCPOS    IFEQ WWPLEG
     C                     MOVE 'Y'       QFSPLD
     C                     MOVELPGBPSN    QFTRNB
     C                     MOVE PGSEQN    QFTRNB
     C                     ELSE
     C                     MOVE 'N'       QFSPLD
     C**********           Z-ADD0         QFTRNB                                              CLE148
     C                     MOVEL*BLANKS   QFTRNB                                              CLE148
     C*
     C** CHECK WHETHER KEY FROM PMCPOSL0 AFTER KEY FROM LF/LBPLEGTU
     C** AND IF TRUE READ THE NEXT RECORD FROM LF/LBPLEGTU
     C           WWCPOS    IFGT WWPLEG
     C***********          READ LBPLEGTU                 74               S01486
     C                     READ LBPLEGLQ                 74               S01486
     C                     MOVELPGSESN    WWTES1 16
     C                     MOVE PGISSB    WWTES1
     C                     MOVELWWTES1    WWPLEG 20
     C                     MOVE PGPTFR    WWPLEG
     C*
     C** IF THE KEYS ARE NOW THE SAME SET THE PORTFOLIO PLEDGED FLAG ON
     C           WWCPOS    IFEQ WWPLEG
     C                     MOVE 'Y'       QFSPLD
     C                     MOVELPGBPSN    QFTRNB
     C                     MOVE PGSEQN    QFTRNB
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C** MOVE THE SECURITY REPORT NAME FROM LF/SECTY INTO THE MIDAS
     C** INSTRUMENT NAME
     C                     MOVELSRPN      WWTXT1 20
     C*
     C** DETERMINE THE INSTRUMENT ENQUIRY DETAILS NARRATIVE USING THE
     C** STANDARD SUBROUTINE ZFSELN WITH THE FOLLOWING INPUT PARM.:
     C** ZNMCY: NOMINAL CURRENCY FROM LF/SECTY
     C** ZCPNR: COUPON (RATE) FROM LF/SECTY
     C** ZMATY: MATURITY DATE FROM LF/SECTY
     C                     MOVELWWNMCY    ZNMCY
     C                     Z-ADDCPNR      ZCPNR
     C                     Z-ADDMATY      ZMATY
     C                     MOVE PROT      ZPROT
     C                     EXSR ZFSELN
     C**********           MOVELZLIN      WWTXT2 20                                           CGL029
     C                     MOVELZLIN      WWTXT2 26                                           CGL029
     C*
     C** DETERMINE THE BOOK PRICE (WHICH IS THE POSITION AP NUMERATOR
     C** DIVIDED BY THE POSITION NOMINAL) USING THE STANDARD SUBROUTINE
     C** ZAVPRC WITH THE FOLLOWING INPUT PARAMETERS:
     C** ZNOML: NOMINAL FROM PF/PMCPOSPP
     C** ZVALU: AP NUMERATOR FROM PF/PMCPOSPP
     C** ZNMDP: NOMINAL DECIMAL PLACES FROM LF/SECTY
     C** ZNMCD: NOMINAL CURRENCY DECIMAL PLACES FROM LF/SDCURRL0
     C** ZPRCB: PRICE BASIS FROM LF/SECTY
     C                     Z-ADDWWNOML    ZNOML
     C                     Z-ADDWWAPNM    ZVALU
     C                     Z-ADDWWNMDP    ZNMDP
     C                     Z-ADDWWDANN    ZNMCD
     C                     MOVELSPBS      ZPRCB
     C                     EXSR ZAVPRC
     C                     Z-ADDZAVPR     WWBPRC 158
     C*                                                                   B08040
     C** CALCULATE MARKET FX RATE FROM NOMINAL CCY TO PORTFOLIO CURRENCY  B08040
     C*                                                                   160100
     C** Take the euro rates for Euro ccy                                 160100
     C*                                                                   160100
     C           WWNMCY    IFEQ BKEURO                     B2             160100
     C           WWINCP    ANDEQ'Y'                                       160100
     C           QAPTCY    OREQ BKEURO                                    160100
     C           WWINCN    ANDEQ'Y'                                       160100
     C           WWINCN    OREQ 'Y'                                       160100
     C           WWINCP    ANDEQ'Y'                                       160100
     C*                                                                   160100
     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       160100
     C           WWNMCY    IFEQ BKEURO                     B3             160100
     C                     MOVE 'M'       ZMDINF                          160100
     C                     Z-ADD1         ZRATEF                          160100
     C                     Z-ADDWWNBDN    ZCDPF                           160100
     C                     ELSE                            X3             160100
     C                     Z-ADDWWEUEN    ZRATEF                          160100
     C                     MOVE WWEUMN    ZMDINF                          160100
     C                     Z-ADDWWNBDN    ZCDPF                           160100
     C                     END                             E3             160100
     C*                                                                   160100
     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       160100
     C           QAPTCY    IFEQ BKEURO                     B3             160100
     C                     MOVE 'M'       ZMDINT                          160100
     C                     Z-ADD1         ZRATET                          160100
     C                     Z-ADDWWNBDP    ZCDPT                           160100
     C                     ELSE                            X3             160100
     C                     Z-ADDWWEUEP    ZRATET                          160100
     C                     MOVE WWEUMP    ZMDINT                          160100
     C                     Z-ADDWWNBDP    ZCDPT                           160100
     C                     END                             E3             160100
     C*                                                                   160100
     C                     Z-ADD1         ZAMTF                           160100
     C                     MOVE WWNMCY    ZCCYF                           160100
     C                     MOVE QAPTCY    ZCCYT                           160100
     C*                                                                   160100
     C           ZCCYF     IFEQ BKEURO                     B3             160100
     C                     Z-ADDZRATET    QFMFXR                          160100
     C                     MOVE ZMDINT    QFMFMD                          160100
     C                     Z-ADDZRATET    WWBFXR                          160100
     C                     GOTO EEUR1                                     160100
     C                     END                             E3             160100
     C           ZCCYT     IFEQ BKEURO                     B3             160100
     C                     Z-ADDZRATEF    QFMFXR                          160100
     C                     MOVE ZMDINF    QFMFMD                          160100
     C                     Z-ADDZRATEF    WWBFXR                          160100
     C                     GOTO EEUR1                                     160100
     C                     END                             E3             160100
     C*                                                                   160100
     C                     ELSE                            X2             160100
     C*                                                                   160100
     C                     Z-ADD1         ZAMTF                           B08040
     C                     MOVE WWNMCY    ZCCYF                           B08040
     C                     MOVE QAPTCY    ZCCYT                           B08040
     C                     Z-ADDWWC9NN    ZRATEF                          B08040
     C                     Z-ADDWWC9NP    ZRATET                          B08040
     C                     MOVE WWA8SN    ZMDINF                          B08040
     C                     MOVE WWA8SP    ZMDINT                          B08040
     C                     Z-ADDWWDANN    ZCDPF                           B08040
     C                     Z-ADDWWDANP    ZCDPT                           B08040
     C******************** EXSR ZCCYCN                             B08040 037854
     C*                                                                   160100
     C                     END                             E2             160100
     C*                                                                   160100
     C                     EXSR ZCCYCN                                    057020
     C                     Z-ADDZCRSRN    QFMFXD                          057020
     C                     EXSR CONVN                                     050207
     C*                                                                   B08040
     C** CONVERT RATE INTO MULTIPLY RATE                                  B08040
     C           ZCRSMD    IFEQ 'D'                                       B08040
     C           1         DIV  ZCRSRT    WWMFXR 138H                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDZCRSRT    WWMFXR 138                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CONVERT MARKET FX RATE TO FORMAT DEFINED BY RANKING SEQUENCE     B08040
     C           WWRKSQ    IFLT WWRKNM                                    B08040
     C           1         DIV  WWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'D'       QFMFMD                          B08040
     C                     ELSE                                        67 B08040
     C                     Z-ADDWWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'M'       QFMFMD                          B08040
     C                     END                                         67 B08040
     C*
     C** DETERMINE THE BOOK FX RATE (WHICH IS THE POSITION FX AP NUMERATOR
     C** DIVIDED BY THE POSITION AP NUMERATOR) USING THE STANDARD SUBROUTINE
     C** ZFXAVP WITH THE FOLLOWING INPUT PARAMETERS:
     C** ZAPNM: AP NUMERATOR FROM PF/PMCPOSPP
     C** ZFXAP: FX AP NUMERATOR FROM PF/PMCPOSPP
     C** ZNMCD: NOMINAL CURRENCY DECIMAL PLACES FROM LF/SDCURRL0
     C** ZPTCD: PORTFOLIO CURRENCY DECIMAL PLACES FROM LF/SDCURRL0
     C                     Z-ADDWWAPNM    ZAPNM
     C                     Z-ADDWWFXAP    ZFXAP
     C                     Z-ADDWWDANN    ZNMCD
     C                     Z-ADDWWDANP    ZPTCD
     C                     EXSR ZFXAVP
     C                     Z-ADDZAVFX     WWBFXR 138
     C*
     C** IF PORTFOLIO CURRENCY HAS HIGHER RANK THAN NOMINAL CUURENCY
     C** TAKE INVERSE OF BOOK FX RATE
     C           WWRKSQ    IFLT WWRKNM                                    R00631
     C           WWBFXR    ANDNE0                                         R00631
     C           1         DIV  WWBFXR    WWBFXR                          R00631
     C                     END                                            R00631
     C*                                                                   160100
     C           EEUR1     TAG                                            160100
     C*
     C** DETERMINE THE MARKET VALUE IN NOMINAL CURRENCY (WHICH IS THE
     C** POSITION NOMINAL X MARKET PRICE) USING THE STANDARD SUBROUTINE
     C** ZAPNUM WITH THE FOLLOWING PARM.:
     C** ZNOML: NOMINAL FROM LF/PMCPOSPP
     C** ZAVPR: MARKET PRICE FROM LF/SECTY (CONVERTED TO %PRICE)
     C** ZNMDP: NOMINAL DECIMAL PLACES FROM LF/SECTY
     C** ZNMCD: NOMINAL CURRENCY DECIMAL PLACES FROM LF/SDCURRL0
     C** ZPRCB: PRICE BASIS FROM LF/SECTY
     C                     Z-ADDWWNOML    ZNOML
     C                     Z-ADDWWMKPR    ZAVPR
     C                     Z-ADDWWNMDP    ZNMDP
     C                     Z-ADDWWDANN    ZNMCD
     C                     MOVELSPBS      ZPRCB
     C                     EXSR ZAPNUM
     C                     Z-ADDZVALU     WWMVAL 150
     C*
     C** THE BOOK VALUE IN NOMINAL CURRENCY IS EQUIVALENT TO THE AP
     C** NUMERATOR FROM THE CURRENT PORTFOLIO POSITION
     C                     Z-ADDWWAPNM    WWBVAL 150
     C*
     C** IF THE MARKET PRICE IS ZERO, SET THE PROFIT/LOSS - MARKET IN
     C** PORTFOLIO CURRENCY EQUAL TO ZERO
     C           WWMKPR    IFEQ 0
     C                     Z-ADD0         WWPLMK 150
     C                     ELSE
     C*
     C** CALCULATE THE PROFIT/LOSS - MARKET IN NOMINAL CURRENCY AS
     C** FOLLOWS:
     C** SUBTRACT THE BOOK VALUE IN NOMINAL CURRENCY FROM THE MARKET
     C** VALUE IN NOMINAL CURRENCY TO GET THE PROFIT/LOSS - MARKET IN
     C** NOMINAL CURRENCY
     C           WWMVAL    SUB  WWBVAL    WWPLMK
     C*
     C** CONVERT THE PROFIT/LOSS - MARKET IN NOMINAL CURRENCY TO AN
     C** AMOUNT IN PORTFOLIO CURRENCY USING THE STANDARD SUBROUTINE
     C** ZCCYCN WITH THE FOLLOWING INPUT PARM.:
     C** ZAMTF: PROFIT/LOSS - MARKET IN NOMINAL CURRENCY (ABOVE)
     C** ZCCYF: NOMINAL CURRENCY
     C** ZCCYT: PORTFOLIO CURRENCY
     C** ZRATEF: SPOT RATE FOR NOMINAL CURRENCY FROM LF/SDCURRL0
     C** ZRATET: SPOT RATE FOR PORTFOLIO CURRENCY FROM LF/SDCURRL0
     C** ZMDINF: MULT/DIV. IN. FOR NOMINAL CUR. FROM SDCURRL0
     C** ZMDINT: MULT/DIV. IN. FOR PORTFOLIO CUR. FROM SDCURRL0
     C** ZCDPF: NOMINAL CURRENCY DECIMAL PLACES FROM LF/SDCURRL0
     C** ZCDPT: PORTFOLIO CURRENCY DECIMAL PLACES FROM LF/SDCURRL0
     C                     Z-ADDWWPLMK    ZAMTF
     C                     MOVELWWTNMC    ZCCYF
     C                     MOVELWWPTCY    ZCCYT
     C                     Z-ADDWWC9NN    ZRATEF
     C                     Z-ADDWWC9NP    ZRATET
     C                     MOVELWWA8SN    ZMDINF
     C                     MOVELWWA8SP    ZMDINT
     C                     Z-ADDWWDANN    ZCDPF
     C                     Z-ADDWWDANP    ZCDPT
     C******************** EXSR ZCCYCN                                    037854
     C                     EXSR CONVN                                     050207
     C                     Z-ADDZAMTT     WWPLMK
     C                     END
     C*
     C** CONVERT THE BOOK VALUE IN NOMINAL CURRENCY TO A BOOK VALUE
     C** IN PORTFOLIO CURRENCY USING THE STANDARD SUBROUTINE ZCCYCN
     C** WITH THE FOLLOWING INPUT PARM.:
     C** ZAMTF: BOOK VALUE IN NOMINAL CURRENCY (ABOVE)
     C** ZCCYF: NOMINAL CURRENCY
     C** ZCCYT: PORTFOLIO CURRENCY
     C** ZRATEF: SPOT RATE FOR NOMINAL CURRENCY FROM LF/SDCURRL0
     C** ZRATET: SPOT RATE FOR PORTFOLIO CURRENCY FROM LF/SDCURRL0
     C** ZMDINF: MULT/DIV. IN. FOR NOMINAL CUR. FROM SDCURRL0
     C** ZMDINT: MULT/DIV. IN. FOR PORTFOLIO CUR. FROM SDCURRL0
     C** ZCDPF: NOMINAL CURRENCY DECIMAL PLACES FROM LF/SDCURRL0
     C** ZCDPT: PORTFOLIO CURRENCY DECIMAL PLACES FROM LF/SDCURRL0
     C                     Z-ADDWWBVAL    ZAMTF
     C                     MOVELWWTNMC    ZCCYF
     C                     MOVELWWPTCY    ZCCYT
     C                     Z-ADDWWC9NN    ZRATEF
     C                     Z-ADDWWC9NP    ZRATET
     C                     MOVELWWA8SN    ZMDINF
     C                     MOVELWWA8SP    ZMDINT
     C                     Z-ADDWWDANN    ZCDPF
     C                     Z-ADDWWDANP    ZCDPT
     C******************** EXSR ZCCYCN                                    037854
     C                     EXSR CONVN                                     050207
     C                     Z-ADDZAMTT     WWBVAL
     C*
     C** CALCULATE THE PROFIT/LOSS - FX AS FOLLOWS:
     C** SUBTRACT THE FX AP NUMERATOR ON PF/PMCPOSPP FROM THE BOOK
     C** VALUE IN PORTFOLIO CURRENCY TO GET THE PROFIT/LOSS - FX IN
     C** PORTFOLIO CURRENCY
     C           WWBVAL    SUB  WWFXAP    WWPLFX 150
     C*
     C** IF THE PROCESSING TYPE FROM LF/INVTP IS NOT 2,4 AND 7 AND
     C** IF THE COUPON RATE DAY 1 (CD01) ON LF/SECTY IS NON-ZERO
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C           CD01      ANDNE0
     C*
     C** DETERMINE THE INTEREST DETAILS FOR THIS HOLDING AS PER P06
     C                     EXSR P06
     C                     ELSE
     C*
     C** THE SECURITY IS NON-INTEREST BEARING
     C** SET THE PURCHASED INTEREST, ACCRUED INTEREST, NEXT INTEREST
     C** DATE, START/LAST INTEREST DATE, AND NUMBER OF DAYS ACCRUED
     C** INTEREST ALL EQUAL TO ZERO
     C                     Z-ADD0         WWPILP 150
     C                     Z-ADD0         WWINTK 150
     C                     Z-ADD0         WWNIDT  50
     C                     Z-ADD0         WWSLID  50
     C                     Z-ADD0         WWNODA  30
     C                     END
     C*
     C** IF THE PROCESSING TYPE FROM LF/INVTP IS NOT 2, 4 AND 7
     C                     Z-ADD0         WWBKYD
     C*****                Z-ADD0         WWMKYD                          B08035
     C                     Z-ADD0         WWDRYD
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C***********DYBS******ANDNE'4'                                       R05661
     C           MATY      ANDNE0                                         R05661
     C           SPBS      ANDNE'U'                                       B08000
     C           MKPR      ANDGT1                                         B08000
     C*
     C** CALCULATE THE BOOK YIELD FROM THE AVERAGE YIELD NUMERATOR USING
     C** SUBROUTINE ZAVYLD WITH INPUT PARM.:
     C** ZNOML : EQUAL TO THE POSITION NOMINAL
     C** ZVALU : EQUAL TO THE AVERAGE YIELD NUMERATOR
     C** ZNMDP : EQUAL TO THE NOMINAL DECIMAL PLACES
     C** ZNMCD : EQUAL TO THE NOMINAL CURRENCY DECIMAL PLACES
     C           WWAYNM    IFNE 0                                         R05661
     C                     Z-ADDWWNOML    ZNOML
     C                     Z-ADDWWAYNM    ZVALU
     C                     Z-ADDWWNMDP    ZNMDP
     C                     Z-ADDWWDANN    ZNMCD
     C                     EXSR ZAVYLD
     C                     Z-ADDZAVYD     WWBKYD 117
     C                     ELSE                                           R05661
     C                     Z-SUB9999      WWBKYD                          R05661
     C                     END                                            R05661
     C*                                                                   104786
     C*** BOOK YIELD calculation only produced if Yield Basis entered     104786
     C*                                                                   104786
     C           SYBS      IFEQ *BLANKS                                   104786
     C***********          Z-ADD0         WWBKYD                   104786 149578
     C                     END                                            104786
     C****                                                                B08035
     C***CALCULATE THE MARKET YIELD FROM THE MARKET PRICE USING STANDARD  B08035
     C***SUBROUTINE ZYLDO WITH INPUT PARM.:                               B08035
     C***ZPRICE: EQUAL TO THE MARKET PRICE                                B08035
     C***ZFDATE: EQUAL TO THE EVENT CONTROL DATE (P/INIT)                 B08035
     C                     Z-ADDWWMKPR    ZPRICE 158                      B08035
     C****                 Z-ADDWWECD     ZFDATE                          B08035
     C****                 EXSR ZYLDO                                     B08035
     C****       ZYLDOT    IFGT 0                                         B08035
     C****                 Z-ADDZYLDOT    WWMKYD 117                      B08035
     C****                 ELSE                                           B08035
     C****                 Z-SUB9999      WWMKYD                          B08035
     C****                 END                                            B08035
     C*
     C** CALCULATE THE DIRECT YIELD BY DIVIDING THE COUPON RATE BY THE
     C** MARKET PRICE
     C** IF THE MARKET PRICE IS ZERO, DIRECT YIELD IS ZERO
     C           WWMKPR    IFNE 0
     C           CPNR      DIV  WWMKPR    WWDRYD    H
     C                     MULT 100       WWDRYD
     C                     ELSE
     C                     Z-ADD0         WWDRYD 117
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P05      - UPDATE PORTFOLIO AND CUSTOMER TOTALS                        *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * FULX     - FULL EXTRACT                                                *
      * CRGX     - CHARGING EXTRACT                                            *
      * VALX     - VALUATION EXTRACT                                           *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWPTFR   - PORTFOLIO REFERENCE                                         *
      * WWNOML   - NOMINAL FROM LF/PMCPOSL0                                    *
      * WWPMT1   - TOTAL PORTFOLIO NOMINAL AMOUNT                              *
      * WWMVAL   - MARKET VALUE IN NOMINAL CURRENCY                            *
      * WWPVAL   - TOTAL PORTFOLIO MARKET VALUE                                *
      * WWPILP   - PURCHASED INTEREST FROM LF/PMCPOSL0                         *
      * WWPPLP   - TOTAL PORTFOLIO PURCHASED INTEREST                          *
      * WWINTK   - ACCRUED INTEREST CALCULATED IN STANDARD SR                  *
      * WWPNAC   - TOTAL PORTFOLIO ACCRUED INTEREST                            *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTERESTS                            *
      * WWPODA   - TOTAL PORTFOLIO NUMBER OF DAYS ACCRUED INTEREST             *
      * WWPLMK   - PROFIT/LOSS MARKET                                          *
      * WWPLFX   - PROFIT/LOSS FX                                              *
      * WWCMT1   - TOTAL CUSTOMER NOMINAL                                      *
      * WWCVAL   - TOTAL CUSTOMER MARKET VALUE                                 *
      * WWCILP   - TOTAL CUSTOMER PURCHASED INTEREST                           *
      * WWCNAC   - TOTAL CUSTOMER ACCRUED INTEREST                             *
      * WWCODA   - TOTAL CUSTOMER NUMBER OF DAYS ACCRUED INTEREST              *
      *                                                                        *
      **************************************************************************
     C           P05       BEGSR                           *** P05    ***
     C*
     C** IF THE PORTFOLIO REFERENCE IS NOT '9997'
     C           WWPTFR    IFNE '9997'
     C*                                                                   49768
     C**********           Z-ADDWWCNUM    W5CNUM  60                                    49768 CSD027
     C                     MOVE WWCNUM    W5CNUM  6                                           CSD027
     C                     MOVE WWTDSS    W5TDSS 10                       49768
     C*
     C** ADD THE NOMINAL TO THE TOTAL PORTFOLIO NOMINAL
     C                     ADD  WWNOML    WWPMT1 150
     C                     ADD  WWOTNM    WWPOMT 150                      B08040
     C*
     C** ADD THE MARKET VALUE TO THE TOTAL PORTFOLIO MARKET VALUE
     C                     ADD  WWMVAL    WWPVAL 150
     C*
     C** ADD THE PURCHASED INTEREST TO THE TOTAL PORTFOLIO PURCHASED
     C** INTEREST
     C                     ADD  WWPILP    WWPPLP 150
     C*
     C** ADD THE ACCRUED INTEREST TO THE TOTAL PORTFOLIO ACCRUED INTEREST
     C                     ADD  WWINTK    WWPNAC 150
     C*
     C** ADD THE NUMBER OF DAYS ACCRUED INTEREST TO THE TOTAL PORTFOLIO
     C** NUMBER OF DAYS ACCRUED INTEREST
     C*********************ADD  WWNODA    WWPODA  50                      063601
     C                     Z-ADDWWNODA    WWPODA  50                      063601
     C*
     C                     END
     C*
     C** ADD THE NOMINAL TO THE TOTAL CUSTOMER NOMINAL
     C                     ADD  WWNOML    WWCMT1 150
     C                     ADD  WWOTNM    WWCOMT 150
     C*
     C** ADD THE MARKET VALUE TO THE TOTAL CUSTOMER MARKET VALUE
     C                     ADD  WWMVAL    WWCVAL 150
     C*
     C** ADD THE PURCHASED INTEREST TO THE TOTAL CUSTOMER PURCHASED
     C** INTEREST
     C                     ADD  WWPILP    WWCILP 150
     C*
     C** ADD THE ACCRUED INTEREST TO THE TOTAL CUSTOMER ACCRUED INTEREST
     C                     ADD  WWINTK    WWCNAC 150
     C*
     C** ADD THE NUMBER OF DAYS ACCRUED INTEREST TO THE TOTAL CUSTOMER
     C** NUMBER OF DAYS ACCRUED INTEREST
     C*********************ADD  WWNODA    WWCODA  50                      063601
     C                     Z-ADDWWNODA    WWCODA  50                      063601
     C*
     C                     ENDSR
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P06      - DETERMINE INTEREST DETAILS                                  *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * ZNCD     - CALCUL THE NEXT COUPON DATE                                 *
      * ZAINSH   - CALCUL SE ACCRUED INTEREST - NON SCHULDSCHEIN               *
      * ZAISCH   - CALCUL SE ACCRUED INTEREST - SCHULDSCHEIN                   *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P04      - FORMAT DETAILS FOR OUT. TO THE PORT. HOLDINGS FILE          *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWECD    - EVENT CONTROL DATE                                          *
      * WWNIDT   - NEXT INTEREST DATE                                          *
      * WWSLID   - START/LAST INTEREST DATE                                    *
      * WWNOML   - NOMINAL FROM LF/PMCPOSL0                                    *
      * WWCSEX   - EX-COUPON NOMINAL FROM LF/PMCPOSL0                          *
      * WWTDSS   - SECURITY FROM LF(PMCPOSL0                                   *
      * WWCNUM   - CUSTOMER NUMBER                                             *
      * WWPTFR   - PORTFOLIO REFERENCE                                         *
      * WWTVDA   - TRADE/VALUE DATE FROM LF/PMCPOSL0                           *
      * WWINTK   - ACCRUED INTEREST CALCULATED IN STANDARD SR                  *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTERESTS                            *
      *                                                                        *
      **************************************************************************
     C           P06       BEGSR                           *** P06    ***
     C*
     C** CALCULATE THE NEXT COUPON DATE AS PER STANDARD SUBROUTINE
     C** ZNCD, PASSING THE FOLLOWING PARM.:
     C** CD  : ARRAY OF COUPON DATES FROM LF/SECTY
     C** CR  : ARRAY OF RATE/PAYMENT INDICATORS FROM LF/SECTY
     C** ITLD: INITIAL DATE FROM LF/SECTY
     C** FCPN: FIRST COUPON DATE FROM LF/SECTY
     C** MATY: MATURITY DATE FROM LF/SECTY
     C** ECD : EVENT CONTROL DATE FROM P/INIT
     C                     Z-ADDWWECD     ECD     50
     C                     EXSR ZNCD
     C*
     C** SET THE NEXT INTEREST DATE EQUAL TO THE NEXT COUPON DATE
     C** CALCULATED ABOVE
     C                     Z-ADDNCD       WWNIDT
     C*
     C** SET THE START /LAST INTEREST DATE EQUAL TO THE LAST COUPON
     C** DATE LCPN FROM LF/SECTY
     C                     Z-ADDLCPN      WWSLID
     C/COPY WNCPYSRC,PM1140C002
     C***********          Z-ADDLCPN      ZFMDAT                    038152053103
     C***********          Z-ADDWWECD     ZTODAT                    038152053103
     C************                                                  038152053103
     C***IF MATURITY HAS OCCURRED ON NON-WORKING DAY INTEREST SHOULD038152053103
     C***BE ACCRUED FROM LAST COUPON DATE TO MATURITY DATE          038152053103
     C***********WWMTNW    IFEQ 'Y'                        B1       038152053103
     C***********          Z-ADDMATY      WWNIDT                    038152053103
     C***********          Z-ADDMATY      ZTODAT                    038152053103
     C***********MATY      SUB  1         ZECD                      038152053103
     C***********          EXSR ZLCD                                038152053103
     C***********          Z-ADDZZLCD     WWSLID                    038152053103
     C***********          Z-ADDZZLCD     ZFMDAT                    038152053103
     C**********           Z-ADDZZLCD     LCPN                      038152053103
     C***********          END                             E1       038152053103
     C***********                                                   038152053103
     C***IF COUPON HAS OCCURRED ON NON-WORKING DAY INTEREST SHOULD  038152053103
     C***BE ACCRUED FROM LAST COUPON DATE BEFORE RUN DATE TO ECD    038152053103
     C***********WWMTNW    IFEQ 'N'                        B1       038152053103
     C***********LCPN      ANDGTBJRDNB                              038152053103
     C***********          Z-ADDWWECD     ZTODAT                    038152053103
     C***********          Z-ADDBJRDNB    ZECD                      038152053103
     C***********          EXSR ZLCD                                038152053103
     C***********          Z-ADDZZLCD     WWSLID                    038152053103
     C**********           Z-ADDZZLCD     ZFMDAT                    038152053103
     C***********          Z-ADDZZLCD     LCPN                      038152053103
     C**************       END                             E1       038152053103
     C*                                                                   053103
     C** DETERMINE LAST COUPON DATE                                       053103
     C           LCPN      IFGT WWECD                      B1             053103
     C                     Z-ADDWWECD     ZECD                            053103
     C                     EXSR ZLCD                                      053103
     C                     Z-ADDZZLCD     WWSLID                          053103
     C                     Z-ADDZZLCD     ZFMDAT                          053103
     C                     Z-ADDZZLCD     LCPN                            053103
     C                     END                             E1             053103
     C*                                                                   B08040
     C** IF THE INTEREST CALCULATION START DATE IS BEFORE THE SARTING     B08040
     C** DATE CALCULATE THE INTEREST ACCRUED                              B08040
     C           LCPN      IFLT WWECD                                     B08040
     C           WWMTNW    ANDEQ'N'                                       053103
     C/COPY WNCPYSRC,PM1140C003
     C*
     C** IF THE PROCESSING TYPE FROM LF/INVTP IS NOT EQUAL TO 6 IE.
     C** THIS IS NOT A SCHULDSCHEIN SECURITY
     C           PROT      IFNE '6'
     C*
     C****ET THE PRINCIPAL AMOUNT ZAMTP EQUAL TO THE NOMINAL MINUS        043190
     C****HE EX-COUPON NOMINAL, BOTH FROM PF/PMCPOSPP                     043190
     C** IF A COUPON DATE HAS OCCURRED SINCE THE POSITION DATE THE EX-    043190
     C** COUPON AMOUNT WILL HAVE BEEN CLEARED. THEREFORE USE THE          043190
     C** NOMINAL POSITION                                                 043190
     C           QAPDAT    IFLT LCPN                                      043190
     C                     Z-ADDWWNOML    ZAMTP                           043190
     C                     ELSE                                           043190
     C           WWNOML    SUB  WWCSEX    ZAMTP
     C                     END                                            043190
     C*
     C** SET THE FROM DATE ZFMDAT EQUAL TO THE LAST COUPON DATE LCPN
     C** FROM LF/SECTY
     C******************** Z-ADDLCPN      ZFMDAT                          038152
     C                     Z-ADDLCPN      ZFMDAT                          053103
     C*
     C** SET THE TO DATE ZTODAT EQUAL TO THE EVENT CONTROL DATE WWECD
     C** FROM SR/INIT
     C******************** Z-ADDWWECD     ZTODAT                          038152
     C                     Z-ADDWWECD     ZTODAT                          053103
     C*
     C** SET THE SECURITY ZSSNM EQUAL TO THAT FROM PF/PMCPOSPP
     C                     MOVELWWTDSS    ZSSNM
     C*
     C** SET THE NOMINAL CURRENCY DECIMAL PLACES TO THAT FROM LF/SDCURRL0
     C                     Z-ADDWWDANN    A6NBDP
     C*
     C** CALCULATE THE ACCRUED INTEREST FROM THE LAST COUPON DATE TO
     C** THE EVENT CONTROL DATE AS PER STANDARD SUBROUTINE ZAINSH
     C                     EXSR ZAINSH
     C                     END
     C*
     C** IF THE PROCESSING TYPE FROM LF/INVTP IS EQUAL TO 6 IE.
     C** THIS IS A SCHULDSCHEIN SECURITY
     C           PROT      IFEQ '6'
     C*
     C** SET THE FROM DATE ZFMDAT EQUAL TO THE LAST COUPON DATE
     C** LCPN FROM LF/SECTY
     C******************** Z-ADDLCPN      ZFMDAT                          038152
     C                     Z-ADDLCPN      ZFMDAT                          053103
     C*
     C** SET THE TO DATE ZTODAT EQUAL TO THE EVENT CONTROL
     C** DATE ECD FROM P/INIT
     C******************** Z-ADDWWECD     ZTODAT                          038152
     C                     Z-ADDWWECD     ZTODAT                          053103
     C*
     C** SET THE CUSTOMER ZCUST EQUAL TO THAT FROM PF/PMCPOSPP
     C**********           Z-ADDWWCNUM    ZCUST                                               CSD027
     C                     MOVE WWCNUM    ZCUST                                               CSD027
     C*
     C** SET THE PORTFOLIO REFERENCE ZPTRF EQUAL TO THAT FROM
     C** PF/PMCPOSPP
     C                     MOVELWWPTFR    ZPTRF
     C*
     C** SET THE SECURITY ZSSNM EQUAL TO THAT FROM PF/PMCPOSPP
     C                     MOVELWWTDSS    ZSSNM
     C*
     C** SET THE TRADE/VALUE BASIS ZTVBS EQUAL TO THAT FROM
     C** PF/PMCPOSPP
     C                     MOVELWWTVDA    ZTVBS
     C*
     C** SET THE NOMINAL CURRENCY DECIMAL PLACES TO THAT FROM LF/SDCURRL0
     C                     Z-ADDWWDANN    A6NBDP
     C*
     C** CALCULATE THE ACCRUED INTEREST FROM THE LAST COUPON DATE
     C** TO THE EVENT CONTROL DATE AS PER STANDARD SUBROUTINE ZAISCH
     C                     EXSR ZAISCH
     C                     END
     C*
     C** SET THE PURCHASED INTEREST EQUAL TO THE PURCHASED INTEREST
     C** FROM LF/PMCPOSPP (EQUAL TO WWPILP AS ABOVE)
     C*
     C** SET THE ACCRUED INTEREST EQUAL TO THE TOTAL ACCRUED INTEREST
     C** FROM SR/ZAINSH/ZAISCH
     C                     Z-ADDZTOAI     WWINTK
     C*
     C** SET THE NUMBER OF DAYS ACCRUED INTEREST EQUAL TO THE TOTAL
     C** NUMBER OF INTEREST DAYS FROM SR/ZAINSH/ZAISCH
     C                     Z-ADDZTOND     WWNODA
     C                     ELSE
     C                     Z-ADD0         WWINTK
     C                     Z-ADD0         WWNODA
     C                     END
     C*                                                                   053103
     C** CHECK FOR COUPON EVENTS OUTSTANDING. ADD AMOUNT DUE TO ACCRUED   053103
     C** INTEREST                                                         053103
     C                     MOVE 'CP'      WWPEVT                          053103
     C           POSETK    SETLLPMPOSET1                                  053103
     C           POSETK    READEPMPOSET1                 78               053103
     C*                                                                   053103
     C           *IN78     DOWEQ'0'                        B1             053103
     C           PDUD      IFLE WWECD                      B2             053103
     C                     ADD  PAMD      WWINTK                          053103
     C*                                                                   053103
     C** DETERMINE LAST COUPON DATE BEFORE POSITION SETTLEMENT DATE       053103
     C           PDUD      SUB  1         ZECD                            053103
     C                     EXSR ZLCD                                      053103
     C****       PDUD      SUB  ZZLCD     WXNODA  50                      053103
     C****                 ADD  WXNODA    WWNODA                          053103
     C                     Z-ADDZZLCD     WWSLID                          053103
     C                     Z-ADDZZLCD     ZSDATE                          053103
     C                     Z-ADDECD       ZEDATE                          053103
     C                     EXSR ZDAYS                                     053103
     C                     Z-ADDZDDAYS    WWNODA                          053103
     C                     END                             E2             053103
     C*                                                                   053103
     C           POSETK    READEPMPOSET1                 78               053103
     C                     END                             E1             053103
     C*                                                                   053103
     C                     ENDSR
      **************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P07      - AUDIT PROCESSING                                            *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * U03      - UPDATE PF/PMCPOSZZ                                          *
      * W04      - WRITE TO PORTFOLIO HOLDINGS AUDIT                           *
      * W05      - WRITE PORTFOLIO HOLDINGS UPDATE (SE) AUDIT REPORT           *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           P07       BEGSR                           *** P07    ***
     C*
     C** IF THE MODE PARM. IS 'F' (FOR FULL EXTRACT)
     C           MODE      IFEQ 'F'
     C*
     C** ACCESS THE PORTFOLIO POSITIONS AUDIT PF/PMCPOSZZ
     C***********          READ PMCPOSZZ                 72               S01486
     C                     READ PMCPOSPA                 72               S01486
     C           *IN72     IFEQ '1'
     C** ERROR
     C                     Z-ADD12        DBASE            **DB ERROR 12**
     C***********          MOVEL'PMCPOSZZ'DBFILE           ***************S01486
     C                     MOVE 'PMCPOSPA'DBFILE                          S01486
     C                     MOVEL*BLANKS   DBKEY
     C                     EXSR *PSSR
     C                     ELSE
     C*
     C** UPDATE PF/PMCPOSZZ AS PER U03
     C                     EXSR U03
     C                     END
     C                     END
     C*
     C** ACCESS THE PORTFOLIO HOLDINGS AUDIT PF/PMHOLDZZ
     C***********          READ PMHOLDZZ                 72               S01486
     C                     READ PMHOLDPA                 72               S01486
     C*
     C** WRITE/UPDATE A RECORD ON PF/PMHOLDZZ AS PER W04
     C                     EXSR W04
     C*
     C** PRODUCE PORTFOLIO HOLDINGS UPDATE (SE) AUDIT REPORT AS PER
     C** W05-WRITE PORTFOLIO HOLDINGS UPDATE (SE) AUDIT REPORT
     C                     EXSR W05
     C*
     C                     ENDSR                           *** EP07   ***
     C*
      ********************************************************************B08253
      /EJECT                                                              B08253
      ********************************************************************B08253
      *                                                                   B08253
      * P08      - CHECK WHETHER 9998 AND 9999 POSITION TO BE OUTPUT      B08253
      *                                                                   B08253
      * SUBROUTINE CALLS:                                                 B08253
      *                                                                   B08253
      * SUBROUTINE CALLED FROM:                                           B08253
      * FULX     - FULL EXTRACT                                           B08253
      *                                                                   B08253
      ********************************************************************B08253
     C           P08       BEGSR                           *** P08    *** B08253
     C*                                                                   B08253
     C** SET FILE POINTER BEFORE FIRST POSITION ON PMCPOSPP               B08253
     C                     MOVE *LOVAL    W1PTFR                          B08253
     C           KCPOS     SETLLPMCPOSL0                                  B08253
     C*                                                                   B08253
     C** READ THROUGH ALL RECORD FOR CUSTOMER AND SECURITY. IF ANY        B08253
     C** POSITIONS FOUND WITH NOMINAL OR OTHER NOMINAL NOT EQUAL TO       B08253
     C** ZERO POSITIONS SHOULD NOT BE OUTPUT FOR '9998' AND '9999'        B08253
     C** PORTFOLIOS (THESE POSITIONS OUTPUT IN NORMAL RUN)                B08253
     C           KCPS1     READEPMCPOSL0                 76               B08253
     C           *IN76     DOWEQ'0'                                       B08253
     C*                                                                   B08253
     C           CPNOML    IFNE 0                                         B08253
     C           CPOTNM    ORNE 0                                         B08253
     C*                                                                   49768
     C           CPPTFR    IFNE '9997'                                    49768
     C                     MOVE 'N'       WWOUTP                          B08253
     C                     END                                            49768
     C                     MOVE 'N'       WWOUTC                          49768
     C*                                                                   49768
     C                     END                                            B08253
     C*                                                                   B08253
     C           KCPS1     READEPMCPOSL0                 76               B08253
     C                     END                                            B08253
     C*                                                                   B08253
     C                     ENDSR                           *** EP07   *** B08253
     C*                                                                   B08253
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * U01      - UPDATE LF/PMCPOSXX                                          *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * FULX     - FULL EXTRACT                                                *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           U01       BEGSR                           *** U01    ***
     C                     MOVEL'I'       QARECI
     C****                 UPDATPMCPOS0                                   B08040
     C************         UPDATPMCPOSX0                                  065271
     C  N71N69             UPDATPMCPOSX0                                  065217
     C*                                                                   B08040
     C** CHECK FOR THE OTHER TRADE/VALUE DATE POSITION AND REMOVE IT      B08040
     C           QATVDA    IFEQ 'T'                                       B08040
     C                     MOVE 'V'       QATVDA                          B08040
     C                     ELSE                                           B08040
     C                     MOVE 'T'       QATVDA                          B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C**********           Z-ADDQACNUM    WSCNUM  60                                   B08040 CSD027
     C                     MOVE QACNUM    WSCNUM  6                                           CSD027
     C                     MOVE QAPTFR    WSPTFR  4                       B08040
     C                     MOVE QATDSS    WSTDSS 10                       B08040
     C                     MOVE QATVDA    WSTVDA  1                       B08040
     C                     Z-ADD*HIVAL    QAPDAT                          B08040
     C*                                                                   B08040
     C** ACCESS TRADE/VALUE DATE POSITION AND DELETE IF FOUND             B08040
     C           KAPOS     SETGTPMAPOSLX                                  B08040
     C                     READPPMAPOSLX                 70               B08040
     C*                                                                   B08040
     C           *IN70     IFEQ '0'                                       B08040
     C           APRECI    IFEQ 'D'                                       B08040
     C           APCNUM    ANDEQWSCNUM                                    B08040
     C           APPTFR    ANDEQWSPTFR                                    B08040
     C           APTDSS    ANDEQWSTDSS                                    B08040
     C           APTVDA    ANDEQWSTVDA                                    B08040
     C                     MOVE 'I'       APRECI                          B08040
     C                     ADD  1         PPPREM                          B08040
     C                     END                                            B08040
     C                     UPDATPMAPOSPX                                  B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C                     ENDSR                           *** EU01   ***
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * U02      - UPDATE LF/PMHPOSLL                                          *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * FULX     - FULL EXTRACT                                                *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           U02       BEGSR                           *** U02    ***
     C********             MOVEL'I'       QARECI                          B08040
     C                     MOVEL'I'       HPRECI                          B08040
     C                     UPDATPMHPOSP0
     C                     ENDSR                           *** EU02   ***
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * U03      - UPDATE PF/PMCPOSZZ                                          *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P07      - AUDIT PROCESSING                                            *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           U03       BEGSR                           *** U03    ***
     C                     SUB  PPPREM    QANORE
     C                     UPDATPMCPOSZ0
     C                     ENDSR                           *** EU03   ***
     C*
     C**************************************************************************
      ****CT
      **************************************************************************
      ****                                                                     *
      ****4      - IF PORTFOLIO DELETED REMOVE ALL 'D' POSITIONS               *
      ****         FOR DELETED PORTFOLIOS                                      *
      ****                                                                     *
      ****BROUTINE CALLS:                                                      *
      ****                                                                     *
      ****BROUTINE CALLED FROM:                                                *
      ****LX     - FULL EXTRACT                                                *
      ****                                                                     *
      ****UTINE USES VARIABLES:                                                *
      ****                                                                     *
      **************************************************************************
     C****       U04       BEGSR                           *** U04    *** B08040
     C****                                                                B08040
     C****ELEASE RECORD LOCK ON PMCPOSXX                                  B08040
     C****                 UPDATPMCPOSX0                                  B08040
     C****                                                                B08040
     C****AVE CUSTOMER AND PORTFOLIO                                      B08040
     C****                 Z-ADDQACNUM    WSCNUM  60                      B08040
     C****                 MOVE QAPTFR    WSPTFR  4                       B08040
     C****                                                                B08040
     C****ET FILE POINTER BEFORE FIRST POSITION FOR PORTFOLIO             B08040
     C****                 MOVE *LOVAL    QATDSS                          B08040
     C****                 MOVE *LOVAL    QATVDA                          B08040
     C****                 Z-ADD0         QAPDAT                          B08040
     C****                                                                B08040
     C****       KAPOS     SETLLPMAPOSLX                                  B08040
     C****                                                                B08040
     C****EAD THROUGH ALL TRADE  OR VALUE DATE POSITIONS FOR PORTFOLIO    B08040
     C****                 READ PMAPOSLX                 70               B08040
     C****       *IN70     DOWEQ'0'                        B1             B08040
     C****       APCNUM    ANDEQWSCNUM                                    B08040
     C****       APPTFR    ANDEQWSPTFR                                    B08040
     C****                                                                B08040
     C****F HISTORIC OR LIVE POSITION SET RECORD ID TO 'I'                B08040
     C****       APRECI    IFEQ 'D'                        B2             B08040
     C****                 MOVE 'I'       APRECI                          B08040
     C****                 UPDATPMAPOSPX                                  B08040
     C****                 ADD  1         PPPREM                          B08040
     C****                 END                             E2             B08040
     C****                                                                B08040
     C****       APRECI    IFEQ 'H'                        B2             B08040
     C****                 MOVE 'I'       APRECI                          B08040
     C****                 UPDATPMAPOSPX                                  B08040
     C****                 END                             E2             B08040
     C****                                                                B08040
     C****                 READ PMAPOSLX                 70               B08040
     C****                 END                             E1             B08040
     C****                                                                B08040
     C****ELEASE ANY LOCKED RECORD                                        B08040
     C****       *IN70     IFEQ '0'                        B1             B08040
     C****                 UPDATPMAPOSPX                                  B08040
     C****                 END                             E1             B08040
     C****                                                                B08040
     C****                 ENDSR                           *** EU01   *** B08040
     C****                                                                B08040
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W01      - WRITE TO PORTFOLIO HOLDINGS (PORTFOLIO)                     *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * FULX     - FULL EXTRACT                                                *
      * CRGX     - CHARGING EXTRACT                                            *
      * VALX     - VALUATION EXTRACT                                           *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWNOML   - NOMINAL FROM LF/PMCPOSL0                                    *
      * WWRECI   - RECORD IDENT.                                               *
      * WWAVCD   - ACCOUNT OFFICER FROM LF/SDPLCSL0                            *
      * WWCNUM   - CUSTOMER NUMBER                                             *
      * WWPTFR   - PORTFOLIO REFERENCE                                         *
      * WWTVDA   - TRADE/VALUE DATE FROM LF/PMCPOSL0                           *
      * WWINNR   - INVESTMENT TYPE FROM LF/INVTP                               *
      * WWITDS   - DISPLAY GROUP SEQ. FROM PF/SDPLINPD                         *
      * WWVLIS   - INSTRUMENT TYPE VALUATION SEQUENCE FROM SDPLINPD            *
      * WWDSPG   - DISPLAY GROUP FROM PF/SDPLINPD                              *
      * WWDSPS   - DISPLAY GROUP SEQ. FROM PF/PMDSPGPP                         *
      * WWVALG   - VALUATION GROUP FROM PF/SDPLINPD                            *
      * WWVLGS   - VALUATION GROUP SEQUENCE FROM PF/PMVLGSPP                   *
      * WWTDSS   - SECURITY FROM LF(PMCPOSL0                                   *
      * WWTXT1   - INSTRUMENT NAME FROM LF/SECTY                               *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAIL NARRATIVE                         *
      * WWNMCY   - NOMINAL CURRENCY FROM LF/SECTY                              *
      * WWNMDP   - CURRENCY DEC. PLACES                                        *
      * WWDANN   - NOMINAL CUR.DEC.PLACES FROM LF/SDCURRL0                     *
      * WWMKPR   - WORK MARKET PRICE FIELD                                     *
      * WWBPRC   - BOOK PRICE                                                  *
      * WWBFXR   - BOOK FX RATE                                                *
      * WWMVAL   - MARKET VALUE IN NOMINAL CURRENCY                            *
      * WWPILP   - PURCHASED INTEREST FROM LF/PMCPOSL0                         *
      * WWINTK   - ACCRUED INTEREST CALCULATED IN STANDARD SR                  *
      * WWNIDT   - NEXT INTEREST DATE                                          *
      * WWSLID   - START/LAST INTEREST DATE                                    *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTERESTS                            *
      * WWPLMK   - PROFIT/LOSS MARKET IN PORTFOLIO CURRENCY                    *
      * WWPLFX   - PROFIT/LOSS FX                                              *
      * WWBKYD   - BOOK YIELD                                                  *
      * WWMKYD   - MARKET YIELD                                                *
      * WWDRYD   - DIRECT YIELD                                                *
      * WWSCOR   - COUNTRY OF RISK FROM LF/SECTY                               *
      * WWSIDY   - INDUSTRY FROM LF/SECTY                                      *
      *                                                                        *
      **************************************************************************
     C           W01       BEGSR                           *** W01    ***
     C***IF*TRADE*AND*VALUE*DATE*NOMINALS*ARE*THE*SAME*RESET*OTHER  B08040SA9108
     C***NOMINAL*AMOUNT*TO*ZERO                                     B08040SA9108
     C***********WWOAMT    IFEQ WWNOML                              B08040SA9108
     C*********************Z-ADD*HIVAL    WWOAMT                    B08040SA9108
     C*********************END                                      B08040SA9108
     C*
     C** IF NOMINAL FROM PF/PMCPOSPP IS ZERO => 'F' FOR FLAT
     C** OTHERWISE, RECORD ID FROM LF/SECTY ('D' OR 'M')
     C           WWNOML    IFEQ 0
     C***********WWOAMT    ANDEQ*HIVAL                              B08040SA9108
     C           WWOTNM    ANDEQ0                                   B08040SA9108
     C                     MOVEL'F'       QFRECI
     C                     ELSE
     C                     MOVELWWRECI    QFRECI
     C                     END
     C****                                                                B08040
     C****CCOUNT OFFICER: FROM LF/SDPLCSL0                                B08040
     C****                 MOVELWWACOC    QFACOC                          B08040
     C                     MOVELQAACOC    QFACOC                          B08040
     C*
     C** CUSTOMER NUMBER: FROM PF/PMCPOSPP
     C**********           Z-ADDWWCNUM    QFCNUM                                              CSD027
     C                     MOVE WWCNUM    QFCNUM                                              CSD027
     C*
     C** PORTFOLIO REFERENCE: FROM PF/PMCPOSPP
     C                     MOVELWWPTFR    QFPTFR
     C*
     C** TRADE/VALUE DATE INDICATOR: FROM PF/PMCPOSPP
     C                     MOVELWWTVDA    QFTVDA
     C*
     C** MODULE ID: 'SE'
     C                     MOVEL'SE'      QFMODI
     C*
     C** INSTRUMENT TYPE: FROM LF/INVTP
     C                     MOVELWWINNR    QFINNR
     C*
     C** INSTRUMENT TYPE DISPLAY SEQUENCE: DISPLAY GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWITDS    QFITDS
     C*
     C** INSTRUMENT TYPE VALUATION SEQUENCE: VALUATION GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWVLIS    QFVLIS
     C*
     C** DISPLAY GROUP: FROM PF/SDPLINPD
     C                     MOVELWWDSPG    QFDSPG
     C*
     C** DISPLAY GROUP SEQUENCE: FROM PF/PMDSPGPP
     C                     Z-ADDWWDSPS    QFDSPS
     C*
     C** VALUATION GROUP: FROM PF/SDPLINPD
     C                     MOVELWWVALG    QFVALG
     C*
     C** VALUATION GROUP SEQUENCE: FROM PF/PMVLGHPP
     C                     Z-ADDWWVLGS    QFVLGS
     C*
     C** SECURITY SHORTNAME: FROM PF/PMCPOSPP
     C                     MOVELWWTDSS    QFTDSS
     C*
     C** DEAL TYPE: BLANK
     C                     MOVE *BLANK    QFDTYP
     C*
     C** MIDAS INSTRUMENT NAME: SEE PROCESS P04
     C                     MOVELWWTXT1    QFTXT1
     C*
     C** INSTRUMENT ENQUIRY DETAILS: SEE PROCESS P04
     C                     MOVELWWTXT2    QFTXT2
     C*
     C** LINE 1 AMOUNT: NOMINAL FROM PF/PMCPOSPP
     C                     Z-ADDWWNOML    QFAMT1
     C*
     C** LINE 2 AMOUNT: ZERO
     C                     Z-ADD0         QFAMT2
     C*                                                                   B08040
     C** OTHER NOMINAL AMOUNT FROM PF/PMCPOSPP                            B08040
     C                     Z-ADDWWOTNM    QFOAMT                          B08040
     C*
     C** CURRENCY 1: NOMINAL CURRENCY FROM LF/SECTY
     C                     MOVELWWNMCY    QFCCY1
     C*
     C** CURRENCY 2: BLANK
     C                     MOVEL*BLANKS   QFCCY2
     C*
     C** CURRENCY DEC. PLACES 1: NOMINAL DEC. PLACES FROM LF/SECTY
     C                     Z-ADDWWNMDP    QFCDP1
     C                     Z-ADDWWNMDP    QFNMDP                          095867
     C                     MOVELSPBS      QFSPBS                          095867
     C*
     C** CURRENCY DEC. PLACES 2: NOMINAL CUR. DEC. PLACES FROM
     C** LF/SDCURRL0
     C                     Z-ADDWWDANN    QFCDP2
     C*
     C** MARKET PRICE: SEE PROCESS P04
     C                     Z-ADDWWMKPR    QFMPRC
     C*
     C** BOOK PRICE: SEE PROCESS P04
     C                     Z-ADDWWBPRC    QFBOPR
     C*
     C** BOOK FX RATE: SEE PROCESS P04
     C                     Z-ADDWWBFXR    QFBFXR
     C*
     C** MARKET VALUE: MARKET VALUE IN NOMINAL CURRENCY
     C                     Z-ADDWWMVAL    QFMVAL
     C*
     C** PURCHASED INTEREST: SEE PROCESS P04
     C                     Z-ADDWWPILP    QFPUIT
     C*
     C** ACCRUED INTEREST: SEE PROCESS P04
     C                     Z-ADDWWINTK    QFACIS
     C*
     C** NEXT INTEREST DATE: SEE PROCESS P04
     C                     Z-ADDWWNIDT    QFNIDT
     C*
     C** START/LAST INTEREST DATE: SEE PROCESS P04
     C                     Z-ADDWWSLID    QFSLID
     C*
     C** NUMBER OF DAYS ACCRUED INTEREST: SEE PROCESS P04
     C                     Z-ADDWWNODA    QFNODA
     C*
     C** PROFIT/LOSS MARKET: SEE PROCESS P04 (P/L - MARKET IN PORT.
     C** CURRENCY)
     C                     Z-ADDWWPLMK    QFPLMK
     C*
     C** PROFIT/LOSS FX: SEE PROCESS P04 (P/L - FX IN PORT. CURRENCY)
     C                     Z-ADDWWPLFX    QFPLFX
     C*
     C** BOOK YIELD: SEE PROCESS P04
     C                     Z-ADDWWBKYD    QFBKYD
     C*
     C** MARKET YIELD: SEE PROCESS P04
     C                     Z-ADDWWMKYD    QFMKYD                          B08040
     C*
     C** DIRECT YIELD: SEE PROCESS P04
     C                     Z-ADDWWDRYD    QFDRYD
     C*
     C** COUNTRY OF RISK: FROM LF/SECTY
     C           WWSCOR    IFNE *BLANKS                                   B08040
     C                     MOVELWWSCOR    QFCNTR
     C                     ELSE                                           B08040
     C***********          MOVE P9CNCD    QFCNTR                   B08040 S01486
     C                     MOVE FCCNCD    QFCNTR                          S01486
     C                     END                                            B08040
     C*
     C** INDUSTRY: FROM LF/SECTY
     C********** WWSIDY    IFNE 0                                                      B08040 CER020
     C**********           Z-ADDWWSIDY    QFLIND                                              CER020
     C           WWLOIC    IFNE *BLANKS                                                       CER020
     C                     MOVE WWLOIC    QFLOIC                                              CER020
     C                     ELSE                                           B08040
     C***********          MOVE P9LICD    QFLIND                   B08040 S01486
     C**********           MOVE FCLICD    QFLIND                                       S01486 CER020
     C                     MOVE FCLICD    QFLOIC                                              CER020
     C                     END                                            B08040
     C*                                                                   R05763
     C***IF*FIDUCIARY*HAS*MATURED*MARKET*VALUE*AND*ACCRUED*INTERESTR05763 S01486
     C***MUST*BE*ZERO********************************************  R05763 S01486
     C***********QFRECI    IFEQ 'M'                                R05763 S01486
     C***********          Z-ADD0         QFMVAL                   R05763 S01486
     C***********          Z-ADD0         QFACIS                   R05763 S01486
     C***********          Z-ADD0         QFPLMK                   R05763 S01486
     C***********          Z-ADD0         QFPLFX                   R05763 S01486
     C***********          END                                     R05763 S01486
     C*                                                                   S01313
     C** SET UP FIELDS REQUIRED FOR PORTFOLIO PERFORMANCE                 S01313
     C                     Z-ADDWWECD     QFDXTR                          S01313
     C                     Z-ADD0         QFVDAT                          097158
     C*
     C** IF EITHER NOMINAL OR ACCRUED INTEREST NOT ZERO SET HOLDING
     C** VALUED TO 'Y'
     C                     MOVE 'N'       QFHLDV                          S01313
     C********** QFAMT1    IFNE 0                                         058181
     C********** QFACIS    ORNE 0                                         058181
     C                     MOVE 'Y'       QFHLDV                          S01313
     C******************** END                                            058181
     C*                                                                   S01313
     C** PERFORMANCE REQUIRED SET TO INDICATOR FROM PMCPOSPP              S01313
     C           QAPFMR    IFEQ *BLANKS                                   S01313
     C                     MOVE 'N'       QFPFMR                          S01313
     C                     ELSE                                           S01313
     C                     MOVE QAPFMR    QFPFMR                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C                     MOVE *ZEROS    QFDLSQ                          S01313
     C*
     C** WRITE A RECORD IN FILE PMHOLDPP
     C           QFRECI    IFEQ 'M'                                       B08253
     C           QFRECI    OREQ 'F'                                       B08253
     C*                                                                   B08253
     C** DELETE ANY MATURED / FLAT POSITIONS IF ALREADY EXISTS            B08253
     C***********          MOVELWWSAVE    WWSAV1200                S01313 101188
     C**********           MOVE WWSAVE    WWSAV2 81                S01313 CPM004
     C***********          MOVE WWSAVE    WWSAV2 99                CPM004 101188
     C***********KMFHL     CHAINPMMFHLL1             70            B08253 101188
     C************IN70     IFEQ '0'                                B08253 101188
     C***********          DELETPMMFHLP0                           B08253 101188
     C***********          END                                     B08253 101188
     C***********                                                  B08253 101188
     C***********          MOVELWWSAV1    WWSAVE                   S01313 101188
     C***********          MOVE WWSAV2    WWSAVE                   S01313 101188
     C/COPY WNCPYSRC,PM1140C004
     C           KMFHL     DELETPMMFHLP0             70                   101188
     C                     Z-ADD0         QFMVPC                          056463
     C                     Z-ADD0         QFMVPC                          056463
     C                     MOVE *BLANKS   QFINTC                          056463
     C                     WRITEPMMFHLP0                                  B08253
     C/COPY WNCPYSRC,PM1140C005
     C                     ELSE                                           B08253
     C*                                                                   49768
     C** IF POSITION WAS PREVIOUSLY FLAT DELETE ALL POSITIONS FOR         49768
     C** CUSTOMER AND SECURITY FROM PF/PMMFHLPP                           49768
     C           QAFLEX    IFEQ 'Y'                                       49768
     C           WWMTEX    ANDEQ'L'                                       49768
     C*                                                                   101188
     C                     MOVE QAPTFR    @PTFR   4                       101188
     C/COPY WNCPYSRC,PM1140C006
     C           KMFHL1    DELETPMMFHLP0             70                   101188
     C                     MOVE '9998'    @PTFR                           101188
     C           KMFHL1    DELETPMMFHLP0             70                   101188
     C                     MOVE '9998'    @PTFR                           101188
     C           KMFHL1    DELETPMMFHLP0             70                   101188
     C/COPY WNCPYSRC,PM1140C007
     C*                                                                   101188
     C***********          MOVELWWSAVE    WWSAV1200                 49768 101188
     C**********           MOVE WWSAVE    WWSAV2 81                S01313 CPM004
     C***********          MOVE WWSAVE    WWSAV2                          CPM004
     C***********KMFHL1    SETLLPMMFHLL1                            49768 101188
     C***********KMFHL1    READEPMMFHLL1                 70         49768 101188
     C***********                                                   49768 101188
     C************IN70     DOWEQ'0'                                 49768 101188
     C***********                                                   49768 101188
     C***********QFPTFR    IFEQ QAPTFR                              49768 101188
     C***********QFPTFR    OREQ '9998'                              49768 101188
     C***********QFPTFR    OREQ '9999'                              49768 101188
     C***********          DELETPMMFHLP0                            49768 101188
     C***********          END                                      49768 101188
     C***********                                                   49768 101188
     C***********KMFHL1    READEPMMFHLL1                 70         49768 101188
     C***********          END                                      49768 101188
     C***********                                                   49768 101188
     C***********          MOVELWWSAV1    WWSAVE                    49768 101188
     C***********          MOVE WWSAV2    WWSAVE                    49768 101188
     C*                                                                   49768
     C                     END                                            49768
     C*                                                                   B08040
     C** WRITE DETAILS TO HOLDINGS TOTAL FILE                             B08040
     C           WWMTEX    IFEQ 'L'                                       R37474
     C                     EXSR #HLDX0                                    R37474
     C                     ELSE                                           CPM005
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD PMHOLDQ0 PMHOLDQ1            CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C                     END                                            R37474
     C*                                                                   B08040
     C           QFAMT1    IFNE 0                                         051250
     C           QFOAMT    ORNE 0                                         056548
     C           QFACIS    ORNE 0                                         051250
     C/COPY WNCPYSRC,PM1140C008
     C                     WRITEPMHOLDP0
     C/COPY WNCPYSRC,PM1140C009
     C                     ADD  1         PPHCRE                          B08040
     C                     END                                            051250
     C                     END                                            B08253
     C*                                                                   B08040
     C** WRITE DETAILS TO HOLDINGS TOTAL FILE                             B08040
     C*R37474    WWMTEX    IFEQ 'L'                                 R37474B08253
     C****                 EXSR #HLDX0                              R37474B08040
     C****                 END                                      R37474B08253
     C*                                                                   B08040
     C                     ENDSR                           *** EW01   ***
      *
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W02      - WRITE TO PORTFOLIO HOLDINGS (PORTF. CONSOLIDATED)           *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * FULX     - FULL EXTRACT                                                *
      * CRGX     - CHARGING EXTRACT                                            *
      * VALX     - VALUATION EXTRACT                                           *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWPMT1   - TOTAL PORTFOLIO NOMINAL AMOUNT                              *
      * WWRECI   - RECORD IDENT.                                               *
      * WWAVCD   - ACCOUNT OFFICER FROM LF/SDPLCSL0                            *
      * WWCNUM   - CUSTOMER NUMBER                                             *
      * WWTVDA   - TRADE/VALUE DATE FROM LF/PMCPOSL0                           *
      * WWINNR   - INVESTMENT TYPE FROM LF/INVTP                               *
      * WWITDS   - DISPLAY GROUP SEQ. FROM PF/SDPLINPD                         *
      * WWVLIS   - INSTRUMENT TYPE VALUATION SEQUENCE FROM SDPLINPD            *
      * WWDSPG   - DISPLAY GROUP FROM PF/SDPLINPD                              *
      * WWDSPS   - DISPLAY GROUP SEQ. FROM PF/PMDSPGPP                         *
      * WWVALG   - VALUATION GROUP FROM PF/SDPLINPD                            *
      * WWVLGS   - VALUATION GROUP SEQUENCE FROM PF/PMVLGSPP                   *
      * WWTDSS   - SECURITY FROM LF(PMCPOSL0                                   *
      * WWTXT1   - INSTRUMENT NAME FROM LF/SECTY                               *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAIL NARRATIVE                         *
      * WWNMCY   - NOMINAL CURRENCY FROM LF/SECTY                              *
      * WWNMDP   - CURRENCY DEC. PLACES                                        *
      * WWDANN   - NOMINAL CUR.DEC.PLACES FROM LF/SDCURRL0                     *
      * WWMKPR   - WORK MARKET PRICE FIELD                                     *
      * WWPVAL   - TOTAL PORTFOLIO MARKET VALUE                                *
      * WWPPLP   - TOTAL PORTFOLIO PURCHASED INTEREST                          *
      * WWPNAC   - TOTAL PORTFOLIO ACCRUED INTEREST                            *
      * WWNIDT   - NEXT INTEREST DATE                                          *
      * WWSLID   - START/LAST INTEREST DATE                                    *
      * WWPODA   - TOTAL PORTFOLIO NUMBER OF DAYS ACCRUED INTEREST             *
      * WWMKYD   - MARKET YIELD                                                *
      * WWSCOR   - COUNTRY OF RISK FROM LF/SECTY                               *
      * WWSIDY   - INDUSTRY FROM LF/SECTY                                      *
      *                                                                        *
      **************************************************************************
     C           W02       BEGSR                           *** W02    ***
     C****                                                                B08040
     C****F TOTAL PORTFOLIO NOMINAL IS ZERO , DO NOT WRITE A '9998' RECORDB08040
     C****                                                                B08040
     C****       WWPMT1    IFEQ 0                                         B08040
     C****                 GOTO ENDW02                                    B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C***IF*TRADE*AND*VALUE*DATE*NOMINALS*ARE*THE*SAME*RESET*OTHER  B08040056548
     C***NOMINAL*AMOUNT*TO*ZERO                                     B08040056548
     C***********WWPMT1    IFEQ WWPOMT                              B08040056548
     C*********************Z-ADD*HIVAL    WWPMT1                    B08040056548
     C*********************END                                      B08040056548
     C*                                                                   B08040
     C** IF*TOTAL*CUSTOMER*NOMINAL*IS*ZERO*=>*'F'*FOR*FLAT******   B08040 056548
     C** IF NOMINAL FROM PF/PMCPOSPP IS ZERO => 'F' FOR FLAT              056548
     C** OTHERWISE, RECORD ID FROM LF/SECTY ('D' OR 'M')                  B08040
     C           WWPMT1    IFEQ 0                                         B08040
     C***********WWPOMT    ANDEQ*HIVAL                              B08040056548
     C           WWPOMT    ANDEQ0                                   B08040056548
     C******************** GOTO ENDW02                              B08040 49768
     C                     MOVEL'F'       QFRECI                          49768
     C                     ELSE                                           49768
     C                     MOVELWWRECI    QFRECI                          49768
     C                     END                                            B08040
     C*
     C** RECORD ID FROM LF/SECTY ('D' OR 'M')
     C******************** MOVELWWRECI    QFRECI                          49768
     C****                                                                B08040
     C****CCOUNT OFFICER: FROM LF/SDPLCSL0                                B08040
     C****                 MOVELWWACOC    QFACOC                          B08040
     C*
     C** CUSTOMER NUMBER: FROM PF/PMCPOSPP
     C**********           Z-ADDWWCNUM    QFCNUM                                              CSD027
     C                     MOVE WWCNUM    QFCNUM                                              CSD027
     C*
     C** PORTFOLIO REFERENCE: '9998'
     C                     MOVEL'9998'    QFPTFR
     C*
     C** TRADE/VALUE DATE INDICATOR: FROM PF/PMCPOSPP
     C                     MOVELWWTVDA    QFTVDA
     C*
     C** MODULE ID: 'SE'
     C                     MOVEL'SE'      QFMODI
     C*
     C** INSTRUMENT TYPE: FROM LF/INVTP
     C                     MOVELWWINNR    QFINNR
     C*
     C** INSTRUMENT TYPE DISPLAY SEQUENCE: DISPLAY GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWITDS    QFITDS
     C*
     C** INSTRUMENT TYPE VALUATION SEQUENCE: VALUATION GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWVLIS    QFVLIS
     C*
     C** DISPLAY GROUP: FROM PF/SDPLINPD
     C                     MOVELWWDSPG    QFDSPG
     C*
     C** DISPLAY GROUP SEQUENCE: FROM PF/PMDSPGPP
     C                     Z-ADDWWDSPS    QFDSPS
     C*
     C** VALUATION GROUP: FROM PF/SDPLINPD
     C                     MOVELWWVALG    QFVALG
     C*
     C** VALUATION GROUP SEQUENCE: FROM PF/PMVLGHPP
     C                     Z-ADDWWVLGS    QFVLGS
     C*
     C** SECURITY SHORTNAME: FROM PF/PMCPOSPP
     C                     MOVELWWTDSS    QFTDSS
     C*
     C** DEAL TYPE: BLANK
     C                     MOVE *BLANK    QFDTYP
     C*
     C** MIDAS INSTRUMENT NAME: SEE PROCESS P04
     C                     MOVELWWTXT1    QFTXT1
     C*
     C** INSTRUMENT ENQUIRY DETAILS: SEE PROCESS P04
     C                     MOVELWWTXT2    QFTXT2
     C*
     C** LINE 1 AMOUNT: TOTAL PORTFOLIO NOMINAL
     C                     Z-ADDWWPMT1    QFAMT1
     C*
     C** LINE 2 AMOUNT: ZERO
     C                     Z-ADD0         QFAMT2
     C*                                                                   B08040
     C** OTHER TOTAL PORTFOLIO NOMINAL AMOUNT                             B08040
     C                     Z-ADDWWPOMT    QFOAMT                          B08040
     C*
     C** CURRENCY 1: NOMINAL CURRENCY FROM LF/SECTY
     C                     MOVELWWNMCY    QFCCY1
     C*
     C** CURRENCY 2: BLANK
     C                     MOVEL*BLANKS   QFCCY2
     C*
     C** CURRENCY DEC. PLACES 1: NOMINAL DEC. PLACES FROM LF/SECTY
     C                     Z-ADDWWNMDP    QFCDP1
     C                     Z-ADDWWNMDP    QFNMDP                          095867
     C                     MOVELSPBS      QFSPBS                          095867
     C*
     C** CURRENCY DEC. PLACES 2: NOMINAL CUR. DEC. PLACES FROM
     C** LF/SDCURRL0
     C                     Z-ADDWWDANN    QFCDP2
     C*
     C** MARKET PRICE: SEE PROCESS P04
     C                     Z-ADDWWMKPR    QFMPRC
     C*
     C** BOOK PRICE: MUST BE ZERO
     C                     Z-ADD0         QFBOPR
     C*
     C** BOOK FX RATE: ZERO
     C                     Z-ADD0         QFBFXR
     C*
     C** MARKET VALUE: TOTAL PORTFOLIO MARKET VALUE
     C                     Z-ADDWWPVAL    QFMVAL
     C*
     C** PURCHASED INTEREST: TOTAL PORTFOLIO PURCHASED INTEREST
     C                     Z-ADDWWPPLP    QFPUIT
     C*
     C** ACCRUED INTEREST: TOTAL PORTFOLIO ACCRUED INTEREST
     C                     Z-ADDWWPNAC    QFACIS
     C*
     C** NEXT INTEREST DATE: SEE PROCESS P04
     C                     Z-ADDWWNIDT    QFNIDT
     C*
     C** START/LAST INTEREST DATE: SEE PROCESS P04
     C                     Z-ADDWWSLID    QFSLID
     C*
     C** NUMBER OF DAYS ACCRUED INTEREST: TOTAL PORTFOLIO NUMBER OF
     C** DAYS ACCRUED INTEREST
     C                     Z-ADDWWPODA    QFNODA
     C*
     C** PROFIT/LOSS MARKET: ZERO
     C                     Z-ADD0         QFPLMK
     C*
     C** PROFIT/LOSS FX: ZERO
     C                     Z-ADD0         QFPLFX
     C*
     C** BOOK YIELD: MUST BE ZERO
     C                     Z-ADD0         QFBKYD
     C*
     C** MARKET YIELD: SEE PROCESS P04
     C                     Z-ADDWWMKYD    QFMKYD                          B08040
     C*
     C** DIRECT YIELD: ZERO
     C                     Z-ADD0         QFDRYD
     C*
     C** INDUSTRY: FROM LF/SECTY
     C********** WWSIDY    IFNE 0                                                      B08040 CER020
     C**********           Z-ADDWWSIDY    QFLIND                                              CER020
     C           WWLOIC    IFNE *BLANKS                                                       CER020
     C                     MOVE WWLOIC    QFLOIC                                              CER020
     C                     ELSE                                           B08040
     C***********          MOVE P9LICD    QFLIND                   B08040 S01486
     C**********           MOVE FCLICD    QFLIND                                       S01486 CER020
     C                     MOVE FCLICD    QFLOIC                                              CER020
     C                     END                                            B08040
     C*
     C** COUNTRY OF RISK: FROM LF/SECTY
     C           WWSCOR    IFNE *BLANKS                                   B08040
     C                     MOVELWWSCOR    QFCNTR
     C                     ELSE                                           B08040
     C***********          MOVE P9CNCD    QFCNTR                   B08040 S01486
     C                     MOVE FCCNCD    QFCNTR                          S01486
     C                     END                                            B08040
     C*                                                                   R05763
     C** IF SECURITY HAS MATURED MARKET VALUE AND ACCRUED INTEREST        R05763
     C** MUST BE ZERO                                                     R05763
     C           QFRECI    IFEQ 'M'                                       R05763
     C                     Z-ADD0         QFMVAL                          R05763
     C                     Z-ADD0         QFACIS                          R05763
     C                     Z-ADD0         QFPLMK                          R05763
     C                     Z-ADD0         QFPLFX                          R05763
     C                     END                                            R05763
     C*                                                                   B08040
     C** OBTAIN DETAILS OF CUSTOMER BASE CURRNCY FROM ARRAY               B08040
     C                     Z-ADD1         B                               B08040
     C           WWCSBY    LOKUPCYCD,B                   72               B08040
     C** ERROR                                                            B08040
     C           *IN72     IFEQ '0'                        ***************B08040
     C                     Z-ADD22        DBASE            **DB ERROR 02**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWCSBY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    WWSPCS 138                      B08040
     C                     MOVE MDIN,B    WWMDCS  1                       B08040
     C                     Z-ADDNBDP,B    WWDPCS  10                      B08040
     C                     Z-ADDRKSQ,B    WWRKCS  30                      B08040
     C                     MOVELINCI,B    WWINCP                          160100
     C                     Z-ADDEUER,B    WWEUEP                          160100
     C                     MOVE EUMD,B    WWEUMP                          160100
     C                     Z-ADDNBDP,B    WWNBDP                          160100
     C                     END                                            B08040
     C*                                                                   B08040
     C** CALCULATE MARKET FX RATE FROM NOMINAL CCY TO PORTFOLIO CURRENCY  B08040
     C*                                                                   160100
     C** Take the euro rates for Euro ccy                                 160100
     C*                                                                   160100
     C           WWNMCY    IFEQ BKEURO                     B2             160100
     C           WWINCP    ANDEQ'Y'                                       160100
     C           WWCSBY    OREQ BKEURO                                    160100
     C           WWINCN    ANDEQ'Y'                                       160100
     C           WWINCN    OREQ 'Y'                                       160100
     C           WWINCP    ANDEQ'Y'                                       160100
     C*                                                                   160100
     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       160100
     C           WWNMCY    IFEQ BKEURO                     B3             160100
     C                     MOVE 'M'       ZMDINF                          160100
     C                     Z-ADD1         ZRATEF                          160100
     C                     Z-ADDWWNBDN    ZCDPF                           160100
     C                     ELSE                            X3             160100
     C                     Z-ADDWWEUEN    ZRATEF                          160100
     C                     MOVE WWEUMN    ZMDINF                          160100
     C                     Z-ADDWWNBDN    ZCDPF                           160100
     C                     END                             E3             160100
     C*                                                                   160100
     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       160100
     C           WWCSBY    IFEQ BKEURO                     B3             160100
     C                     MOVE 'M'       ZMDINT                          160100
     C                     Z-ADD1         ZRATET                          160100
     C                     Z-ADDWWNBDP    ZCDPT                           160100
     C                     ELSE                            X3             160100
     C                     Z-ADDWWEUEP    ZRATET                          160100
     C                     MOVE WWEUMP    ZMDINT                          160100
     C                     Z-ADDWWNBDP    ZCDPT                           160100
     C                     END                             E3             160100
     C*                                                                   160100
     C                     Z-ADD1         ZAMTF                           160100
     C                     MOVE WWNMCY    ZCCYF                           160100
     C                     MOVE WWCSBY    ZCCYT                           160100
     C*                                                                   160100
     C           ZCCYF     IFEQ BKEURO                     B3             160100
     C                     Z-ADDZRATET    QFMFXR                          160100
     C                     MOVE ZMDINT    QFMFMD                          160100
     C                     Z-ADDZRATET    WWBFXR                          160100
     C                     GOTO EEUR2                                     160100
     C                     END                             E3             160100
     C           ZCCYT     IFEQ BKEURO                     B3             160100
     C                     Z-ADDZRATEF    QFMFXR                          160100
     C                     MOVE ZMDINF    QFMFMD                          160100
     C                     Z-ADDZRATEF    WWBFXR                          160100
     C                     GOTO EEUR2                                     160100
     C                     END                             E3             160100
     C*                                                                   160100
     C                     ELSE                            X2             160100
     C*                                                                   160100
     C                     Z-ADD1         ZAMTF                           B08040
     C                     MOVE WWNMCY    ZCCYF                           B08040
     C                     MOVE WWCSBY    ZCCYT                           B08040
     C                     Z-ADDWWC9NN    ZRATEF                          B08040
     C                     Z-ADDWWSPCS    ZRATET                          B08040
     C                     MOVE WWA8SN    ZMDINF                          B08040
     C                     MOVE WWMDCS    ZMDINT                          B08040
     C                     Z-ADDWWDANN    ZCDPF                           B08040
     C                     Z-ADDWWDPCS    ZCDPT                           B08040
     C******************** EXSR ZCCYCN                             B08040 037854
     C*                                                                   160100
     C                     END                             E2             160100
     C*                                                                   160100
     C                     EXSR ZCCYCN                                    057020
     C                     Z-ADDZCRSRN    QFMFXD                          057020
     C                     EXSR CONVN                                     050207
     C*                                                                   B08040
     C** CONVERT RATE INTO MULTIPLY RATE                                  B08040
     C           ZCRSMD    IFEQ 'D'                                       B08040
     C           1         DIV  ZCRSRT    WWMFXR 138H                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDZCRSRT    WWMFXR 138                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CONVERT MARKET FX RATE TO FORMAT DEFINED BY RANKING SEQUENCE     B08040
     C           WWRKCS    IFLT WWRKNM                                    B08040
     C           1         DIV  WWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'D'       QFMFMD                          B08040
     C                     ELSE                                        67 B08040
     C                     Z-ADDWWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'M'       QFMFMD                          B08040
     C                     END                                         67 B08040
     C*                                                                   160100
     C           EEUR2     TAG                                            160100
     C*                                                                   S01313
     C** SET UP FIELDS REQUIRED FOR PORTFOLIO PERFORMANCE                 S01313
     C                     Z-ADDWWECD     QFDXTR                          S01313
     C                     Z-ADD0         QFVDAT                          097158
     C*
     C** IF EITHER NOMINAL OR ACCRUED INTEREST NOT ZERO SET HOLDING
     C** VALUED TO 'Y'
     C                     MOVE 'N'       QFHLDV                          S01313
     C********** QFAMT1    IFNE 0                                         058181
     C********** QFACIS    ORNE 0                                         058181
     C                     MOVE 'Y'       QFHLDV                          S01313
     C******************** END                                            058181
     C*
     C***********          MOVE 'N'       QFPFMR                   S01313 CPM005
     C*                                                                   CPM005
     C           WWPFM8    IFEQ *BLANKS                                   CPM005
     C                     MOVE 'N'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE WWPFM8    QFPFMR                          CPM005
     C                     END                                            CPM005
     C*
     C                     MOVE *ZEROS    QFDLSQ                          S01313
     C*
     C** WRITE A RECORD IN FILE PMHOLDPP
     C           QFRECI    IFEQ 'M'                                       B08253
     C           QFRECI    OREQ 'F'                                       B08253
     C*                                                                   47968
     C           QFRECI    IFEQ 'M'                                       47968
     C           QFRECI    OREQ 'F'                                       47968
     C           QFTDSS    ANDEQW5TDSS                                    49768
     C           QFCNUM    ANDEQW5CNUM                                    49768
     C*                                                                   B08253
     C** DELETE ANY MATURED / FLAT POSITIONS IF ALREADY EXISTS            B08253
     C***********          MOVELWWSAVE    WWSAV1200                S01313 101188
     C**********           MOVE WWSAVE    WWSAV2 81                S01313 CPM004
     C***********          MOVE WWSAVE    WWSAV2                   CPM004 101188
     C***********KMFHL     CHAINPMMFHLL1             70            B08253 101188
     C************IN70     IFEQ '0'                                B08253 101188
     C***********          DELETPMMFHLP0                           B08253 101188
     C***********          END                                     B08253 101188
     C***********                                                  B08253 101188
     C***********          MOVELWWSAV1    WWSAVE                   S01313 101188
     C***********          MOVE WWSAV2    WWSAVE                   S01313 101188
     C/COPY WNCPYSRC,PM1140C010
     C           KMFHL     DELETPMMFHLP0             70                   101188
     C                     WRITEPMMFHLP0                                  B08253
     C/COPY WNCPYSRC,PM1140C011
     C                     END                                            49768
     C                     ELSE                                           B08253
     C*                                                                   B08040
     C** WRITE DETAILS TO HOLDINGS TOTAL FILE                             B08040
     C           WWMTEX    IFEQ 'L'                                       R37474
     C                     EXSR #HLDX0                                    R37474
     C                     ELSE                                           CPM005
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD PMHOLDQ0 PMHOLDQ1            CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C                     END                                            R37474
     C*                                                                   B08040
     C           QFAMT1    IFNE 0                                         051250
     C           QFOAMT    ORNE 0                                         056548
     C           QFACIS    ORNE 0                                         051250
     C/COPY WNCPYSRC,PM1140C012
     C                     WRITEPMHOLDP0
     C                     ADD  1         PPHCRE                          B08040
     C/COPY WNCPYSRC,PM1140C013
     C                     END                                            051250
     C                     END                                            B08253
     C*                                                                   B08040
     C** WRITE DETAILS TO HOLDINGS TOTAL FILE                             B08040
     C****       WWMTEX    IFEQ 'L'                                 R37474B08253
     C****                 EXSR #HLDX0                              R37474B08040
     C****                 END                                      R37474B08253
     C*                                                                   B08040
     C           ENDW02    ENDSR                           *** EW02   ***
      *
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W03      - WRITE TO PORTFOLIO HOLDINGS (CUST. CONSOLIDATED)            *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * FULX     - FULL EXTRACT                                                *
      * CRGX     - CHARGING EXTRACT                                            *
      * VALX     - VALUATION EXTRACT                                           *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWCMT1   - TOTAL CUSTOMER NOMINAL                                      *
      * WWRECI   - RECORD IDENT.                                               *
      * WWAVCD   - ACCOUNT OFFICER FROM LF/SDPLCSL0                            *
      * WWCNUM   - CUSTOMER NUMBER                                             *
      * WWTVDA   - TRADE/VALUE DATE FROM LF/PMCPOSL0                           *
      * WWINNR   - INVESTMENT TYPE FROM LF/INVTP                               *
      * WWITDS   - DISPLAY GROUP SEQ. FROM PF/SDPLINPD                         *
      * WWVLIS   - INSTRUMENT TYPE VALUATION SEQUENCE FROM SDPLINPD            *
      * WWDSPG   - DISPLAY GROUP FROM PF/SDPLINPD                              *
      * WWDSPS   - DISPLAY GROUP SEQ. FROM PF/PMDSPGPP                         *
      * WWVALG   - VALUATION GROUP FROM PF/SDPLINPD                            *
      * WWVLGS   - VALUATION GROUP SEQUENCE FROM PF/PMVLGSPP                   *
      * WWTDSS   - SECURITY FROM LF(PMCPOSL0                                   *
      * WWTXT1   - INSTRUMENT NAME FROM LF/SECTY                               *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAIL NARRATIVE                         *
      * WWNMCY   - NOMINAL CURRENCY FROM LF/SECTY                              *
      * WWNMDP   - CURRENCY DEC. PLACES                                        *
      * WWDANN   - NOMINAL CUR.DEC.PLACES FROM LF/SDCURRL0                     *
      * WWMKPR   - WORK MARKET PRICE FIELD                                     *
      * WWCVAL   - TOTAL CUSTOMER MARKET VALUE                                 *
      * WWCILP   - TOTAL CUSTOMER PURCHASED INTEREST                           *
      * WWCNAC   - TOTAL CUSTOMER ACCRUED INTEREST                             *
      * WWNIDT   - NEXT INTEREST DATE                                          *
      * WWSLID   - START/LAST INTEREST DATE                                    *
      * WWCODA   - TOTAL CUSTOMER NUMBER OF DAYS ACCRUED INTEREST              *
      * WWMKYD   - MARKET YIELD                                                *
      * WWSCOR   - COUNTRY OF RISK FROM LF/SECTY                               *
      * WWSIDY   - INDUSTRY FROM LF/SECTY                                      *
      *                                                                        *
      **************************************************************************
     C           W03       BEGSR                           *** W03    ***
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD PMHOLDQ0 PMHOLDQ1            CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C*                                                             B08040056548
     C***IF*TRADE*AND*VALUE*DATE*NOMINALS*ARE*THE*SAME*RESET*OTHER* B08040056548
     C** NOMINAL AMOUNT TO ZERO                                     B08040056548
     C***        WWCMT1    IFEQ WWCOMT                              B08040056548
     C***                  Z-ADD*HIVAL    WWCOMT                    B08040056548
     C***                  END                                      B08040056548
     C*
     C** IF TOTAL CUSTOMER NOMINAL IS ZERO => 'F' FOR FLAT
     C** OTHERWISE, RECORD ID FROM LF/SECTY ('D' OR 'M')
     C           WWCMT1    IFEQ 0
     C***********WWCOMT    ANDEQ*HIVAL                              B08040056548
     C           WWCOMT    ANDEQ0                                   B08040056548
     C                     MOVEL'F'       QFRECI
     C                     ELSE
     C                     MOVELWWRECI    QFRECI
     C                     END
     C****                                                                B08040
     C****CCOUNT OFFICER: FROM LF/SDPLCSL0                                B08040
     C****                 MOVELWWACOC    QFACOC                          B08040
     C*
     C** CUSTOMER NUMBER: FROM PF/PMCPOSPP
     C**********           Z-ADDWWCNUM    QFCNUM                                              CSD027
     C                     MOVE WWCNUM    QFCNUM                                              CSD027
     C*
     C** PORTFOLIO REFERENCE: '9999'
     C                     MOVEL'9999'    QFPTFR
     C*
     C** TRADE/VALUE DATE INDICATOR: FROM PF/PMCPOSPP
     C                     MOVELWWTVDA    QFTVDA
     C*
     C** MODULE ID: 'SE'
     C                     MOVEL'SE'      QFMODI
     C*
     C** INSTRUMENT TYPE: FROM LF/INVTP
     C                     MOVELWWINNR    QFINNR
     C*
     C** INSTRUMENT TYPE DISPLAY SEQUENCE: DISPLAY GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWITDS    QFITDS
     C*
     C** INSTRUMENT TYPE VALUATION SEQUENCE: VALUATION GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWVLIS    QFVLIS
     C*
     C** DISPLAY GROUP: FROM PF/SDPLINPD
     C                     MOVELWWDSPG    QFDSPG
     C*
     C** DISPLAY GROUP SEQUENCE: FROM PF/PMDSPGPP
     C                     Z-ADDWWDSPS    QFDSPS
     C*
     C** VALUATION GROUP: FROM PF/SDPLINPD
     C                     MOVELWWVALG    QFVALG
     C*
     C** VALUATION GROUP SEQUENCE: FROM PF/PMVLGHPP
     C                     Z-ADDWWVLGS    QFVLGS
     C*
     C** SECURITY SHORTNAME: FROM PF/PMCPOSPP
     C                     MOVELWWTDSS    QFTDSS
     C*
     C** DEAL TYPE: BLANK
     C                     MOVE *BLANK    QFDTYP
     C*
     C** MIDAS INSTRUMENT NAME: SEE PROCESS P04
     C                     MOVELWWTXT1    QFTXT1
     C*
     C** INSTRUMENT ENQUIRY DETAILS: SEE PROCESS P04
     C                     MOVELWWTXT2    QFTXT2
     C*
     C** LINE 1 AMOUNT: TOTAL CUSTOMER NOMINAL
     C                     Z-ADDWWCMT1    QFAMT1
     C*
     C** LINE 2 AMOUNT: ZERO
     C                     Z-ADD0         QFAMT2
     C*
     C** OTHER TOTAL CUSTOMER NOMINAL
     C                     Z-ADDWWCOMT    QFOAMT
     C*
     C** CURRENCY 1: NOMINAL CURRENCY FROM LF/SECTY
     C                     MOVELWWNMCY    QFCCY1
     C*
     C** CURRENCY 2: BLANK
     C                     MOVEL*BLANKS   QFCCY2
     C*
     C** CURRENCY DEC. PLACES 1: NOMINAL DEC. PLACES FROM LF/SECTY
     C                     Z-ADDWWNMDP    QFCDP1
     C                     Z-ADDWWNMDP    QFNMDP                          095867
     C                     MOVELSPBS      QFSPBS                          095867
     C*
     C** CURRENCY DEC. PLACES 2: NOMINAL CUR. DEC. PLACES FROM
     C** LF/SDCURRL0
     C                     Z-ADDWWDANN    QFCDP2
     C*
     C** MARKET PRICE: SEE PROCESS P04
     C                     Z-ADDWWMKPR    QFMPRC
     C*
     C** BOOK PRICE: MUST BE ZERO
     C                     Z-ADD0         QFBOPR
     C*
     C** BOOK FX RATE: ZERO
     C                     Z-ADD0         QFBFXR
     C*
     C** MARKET VALUE: TOTAL CUSTOMER MARKET VALUE
     C                     Z-ADDWWCVAL    QFMVAL
     C*
     C** PURCHASED INTEREST: TOTAL CUSTOMER PURCHASED INTEREST
     C                     Z-ADDWWCILP    QFPUIT
     C*
     C** ACCRUED INTEREST: TOTAL CUSTOMER ACCRUED INTEREST
     C                     Z-ADDWWCNAC    QFACIS
     C*
     C** NEXT INTEREST DATE: SEE PROCESS P04
     C                     Z-ADDWWNIDT    QFNIDT
     C*
     C** START/LAST INTEREST DATE: SEE PROCESS P04
     C                     Z-ADDWWSLID    QFSLID
     C*
     C** NUMBER OF DAYS ACCRUED INTEREST: TOTAL CUSTOMER NUMBER OF
     C** DAYS ACCRUED INTEREST
     C                     Z-ADDWWCODA    QFNODA
     C*
     C** PROFIT/LOSS MARKET: ZERO
     C                     Z-ADD0         QFPLMK
     C*
     C** PROFIT/LOSS FX: ZERO
     C                     Z-ADD0         QFPLFX
     C*
     C** BOOK YIELD: MUST BE ZERO
     C                     Z-ADD0         QFBKYD
     C*
     C** MARKET YIELD: SEE PROCESS P04
     C                     Z-ADDWWMKYD    QFMKYD                          B08040
     C*
     C** DIRECT YIELD: ZERO
     C                     Z-ADD0         QFDRYD
     C*
     C** INDUSTRY: FROM LF/SECTY
     C********** WWSIDY    IFNE 0                                                      B08040 CER020
     C**********           Z-ADDWWSIDY    QFLIND                                              CER020
     C           WWLOIC    IFNE *BLANKS                                                       CER020
     C                     MOVE WWLOIC    QFLOIC                                              CER020
     C                     ELSE                                           B08040
     C***********          MOVE P9LICD    QFLIND                   B08040 S01486
     C**********           MOVE FCLICD    QFLIND                                       S01486 CER020
     C                     MOVE FCLICD    QFLOIC                                              CER020
     C                     END                                            B08040
     C*
     C** COUNTRY OF RISK: FROM LF/SECTY
     C           WWSCOR    IFNE *BLANKS                                   B08040
     C                     MOVELWWSCOR    QFCNTR
     C                     ELSE                                           B08040
     C***********          MOVE P9CNCD    QFCNTR                   B08040 S01486
     C                     MOVE FCCNCD    QFCNTR                          S01486
     C                     END                                            B08040
     C*                                                                   R05763
     C***IF*FIDUCIARY*HAS*MATURED*MARKET*VALUE*AND*ACCRUED*INTERESTR05763 S01486
     C***MUST*BE*ZERO********************************************  R05763 S01486
     C***********QFRECI    IFEQ 'M'                                R05763 S01486
     C***********          Z-ADD0         QFMVAL                   R05763 S01486
     C***********          Z-ADD0         QFACIS                   R05763 S01486
     C***********          Z-ADD0         QFPLMK                   R05763 S01486
     C***********          Z-ADD0         QFPLFX                   R05763 S01486
     C***********          END                                     R05763 S01486
     C*                                                                   B08040
     C** OBTAIN DETAILS OF CUSTOMER BASE CURRNCY FROM ARRAY               B08040
     C                     Z-ADD1         B                               B08040
     C           WWCSBY    LOKUPCYCD,B                   72               B08040
     C** ERROR                                                            B08040
     C           *IN72     IFEQ '0'                        ***************B08040
     C                     Z-ADD22        DBASE            **DB ERROR 02**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWCSBY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    WWSPCS 138                      B08040
     C                     MOVE MDIN,B    WWMDCS  1                       B08040
     C                     Z-ADDNBDP,B    WWDPCS  10                      B08040
     C                     Z-ADDRKSQ,B    WWRKCS  30                      B08040
     C                     MOVELINCI,B    WWINCP                          160100
     C                     Z-ADDEUER,B    WWEUEP                          160100
     C                     MOVE EUMD,B    WWEUMP                          160100
     C                     Z-ADDNBDP,B    WWNBDP                          160100
     C                     END                                            B08040
     C*                                                                   B08040
     C** CALCULATE MARKET FX RATE FROM NOMINAL CCY TO PORTFOLIO CURRENCY  B08040
     C*                                                                   160100
     C** Take the euro rates for Euro ccy                                 160100
     C*                                                                   160100
     C           WWNMCY    IFEQ BKEURO                     B2             160100
     C           WWINCP    ANDEQ'Y'                                       160100
     C           WWCSBY    OREQ BKEURO                                    160100
     C           WWINCN    ANDEQ'Y'                                       160100
     C           WWINCN    OREQ 'Y'                                       160100
     C           WWINCP    ANDEQ'Y'                                       160100
     C*                                                                   160100
     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       160100
     C           WWNMCY    IFEQ BKEURO                     B3             160100
     C                     MOVE 'M'       ZMDINF                          160100
     C                     Z-ADD1         ZRATEF                          160100
     C                     Z-ADDWWNBDN    ZCDPF                           160100
     C                     ELSE                            X3             160100
     C                     Z-ADDWWEUEN    ZRATEF                          160100
     C                     MOVE WWEUMN    ZMDINF                          160100
     C                     Z-ADDWWNBDN    ZCDPF                           160100
     C                     END                             E3             160100
     C*                                                                   160100
     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       160100
     C           WWCSBY    IFEQ BKEURO                     B3             160100
     C                     MOVE 'M'       ZMDINT                          160100
     C                     Z-ADD1         ZRATET                          160100
     C                     Z-ADDWWNBDP    ZCDPT                           160100
     C                     ELSE                            X3             160100
     C                     Z-ADDWWEUEP    ZRATET                          160100
     C                     MOVE WWEUMP    ZMDINT                          160100
     C                     Z-ADDWWNBDP    ZCDPT                           160100
     C                     END                             E3             160100
     C*                                                                   160100
     C                     Z-ADD1         ZAMTF                           160100
     C                     MOVE WWNMCY    ZCCYF                           160100
     C                     MOVE WWCSBY    ZCCYT                           160100
     C*                                                                   160100
     C           ZCCYF     IFEQ BKEURO                     B3             160100
     C                     Z-ADDZRATET    QFMFXR                          160100
     C                     MOVE ZMDINT    QFMFMD                          160100
     C                     Z-ADDZRATET    WWBFXR                          160100
     C                     GOTO EEUR3                                     160100
     C                     END                             E3             160100
     C           ZCCYT     IFEQ BKEURO                     B3             160100
     C                     Z-ADDZRATEF    QFMFXR                          160100
     C                     MOVE ZMDINF    QFMFMD                          160100
     C                     Z-ADDZRATEF    WWBFXR                          160100
     C                     GOTO EEUR3                                     160100
     C                     END                             E3             160100
     C*                                                                   160100
     C                     ELSE                            X2             160100
     C*                                                                   160100
     C                     Z-ADD1         ZAMTF                           B08040
     C                     MOVE WWNMCY    ZCCYF                           B08040
     C                     MOVE WWCSBY    ZCCYT                           B08040
     C                     Z-ADDWWC9NN    ZRATEF                          B08040
     C                     Z-ADDWWSPCS    ZRATET                          B08040
     C                     MOVE WWA8SN    ZMDINF                          B08040
     C                     MOVE WWMDCS    ZMDINT                          B08040
     C                     Z-ADDWWDANN    ZCDPF                           B08040
     C                     Z-ADDWWDPCS    ZCDPT                           B08040
     C******************** EXSR ZCCYCN                             B08040 037854
     C*                                                                   160100
     C                     END                             E2             160100
     C*                                                                   160100
     C                     EXSR ZCCYCN                                    057020
     C                     Z-ADDZCRSRN    QFMFXD                          057020
     C                     EXSR CONVN                                     050207
     C*                                                                   B08040
     C** CONVERT RATE INTO MULTIPLY RATE                                  B08040
     C           ZCRSMD    IFEQ 'D'                                       B08040
     C           1         DIV  ZCRSRT    WWMFXR 138H                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDZCRSRT    WWMFXR 138                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CONVERT MARKET FX RATE TO FORMAT DEFINED BY RANKING SEQUENCE     B08040
     C           WWRKCS    IFLT WWRKNM                                    B08040
     C           1         DIV  WWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'D'       QFMFMD                          B08040
     C                     ELSE                                        67 B08040
     C                     Z-ADDWWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'M'       QFMFMD                          B08040
     C                     END                                         67 B08040
     C*                                                                   160100
     C           EEUR3     TAG                                            160100
     C*                                                                   S01313
     C** SET UP FIELDS REQUIRED FOR PORTFOLIO PERFORMANCE                 S01313
     C                     Z-ADDWWECD     QFDXTR                          S01313
     C                     Z-ADD0         QFVDAT                          097158
     C*
     C** IF EITHER NOMINAL OR ACCRUED INTEREST NOT ZERO SET HOLDING
     C** VALUED TO 'Y'
     C                     MOVE 'N'       QFHLDV                          S01313
     C********** QFAMT1    IFNE 0                                         058181
     C********** QFACIS    ORNE 0                                         058181
     C                     MOVE 'Y'       QFHLDV                          S01313
     C******************** END                                            058181
     C*
     C***********          MOVE 'N'       QFPFMR                   S01313 CPM005
      *                                                                   CPM005
     C           WWPFM9    IFEQ *BLANKS                                   CPM005
     C                     MOVE 'N'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE WWPFM9    QFPFMR                          CPM005
     C                     END                                            CPM005
     C*
     C                     MOVE *ZEROS    QFDLSQ                          S01313
     C*
     C** WRITE A RECORD IN FILE PMHOLDPP
     C           QFRECI    IFEQ 'M'                                       B08253
     C           QFRECI    OREQ 'F'                                       B08253
     C*                                                                   B08253
     C** DELETE ANY MATURED / FLAT POSITIONS IF ALREADY EXISTS            B08253
     C***********          MOVELWWSAVE    WWSAV1200                S01313 101188
     C**********           MOVE WWSAVE    WWSAV2 81                S01313 CPM004
     C***********          MOVE WWSAVE    WWSAV2                   CPM004 101188
     C***********KMFHL     CHAINPMMFHLL1             70            B08253 101188
     C************IN70     IFEQ '0'                                B08253 101188
     C***********          DELETPMMFHLP0                           B08253 101188
     C***********          END                                     B08253 101188
     C***********                                                  B08253 101188
     C***********          MOVELWWSAV1    WWSAVE                   S01313 101188
     C***********          MOVE WWSAV2    WWSAVE                   S01313 101188
     C/COPY WNCPYSRC,PM1140C014
     C           KMFHL     DELETPMMFHLP0             70                   101188
     C                     WRITEPMMFHLP0                                  B08253
     C/COPY WNCPYSRC,PM1140C015
     C                     ELSE                                           B08253
     C*                                                                   B08040
     C** WRITE DETAILS TO HOLDINGS TOTAL FILE                             B08040
     C           WWMTEX    IFEQ 'L'                                       B08253
     C                     EXSR #HLDX0                                    B08040
     C                     ELSE                                           CPM005
     C*                                                                   CPM005
     C** CALL SR FOR NEW FIELDS IN PMHOLDPP PMHOLDX0 PMHOLDX1             CPM005
     C                     EXSR NEWFLD                                    CPM005
     C                     END                                            B08253
     C*                                                                   B08253
     C           QFAMT1    IFNE 0                                         051250
     C           QFOAMT    ORNE 0                                         056548
     C           QFACIS    ORNE 0                                         051250
     C/COPY WNCPYSRC,PM1140C016
     C                     WRITEPMHOLDP0
     C                     ADD  1         PPHCRE                          B08040
     C/COPY WNCPYSRC,PM1140C017
     C                     END                                            051250
     C                     END                                            B08253
     C*                                                                   B08040
     C** WRITE DETAILS TO HOLDINGS TOTAL FILE                             B08040
     C****       WWMTEX    IFEQ 'L'                                 R37474B08253
     C****                 EXSR #HLDX0                              R37474B08040
     C****                 END                                      R37474B08253
     C*                                                                   B08040
     C                     ENDSR                           *** EW03   ***
      *
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W04      - WRITE TO PORTFOLIO HOLDINGS AUDIT                           *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P07      - AUDIT PROCESSING                                            *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           W04       BEGSR                           *** W04    ***
     C                     MOVEL'D'       QFRECI
     C                     ADD  PPHCRE    QFNORE
     C*
     C** IF RECORD NOT FOUND ON PF/PMHOLDZZ, WRITE A RECORD
     C/COPY WNCPYSRC,PM1140C018
     C           *IN72     IFEQ '1'
     C                     WRITEPMHOLDZ0
     C                     ELSE
     C*
     C** OTHERWISE, UPDATE RECORD
     C                     UPDATPMHOLDZ0
     C                     END
     C/COPY WNCPYSRC,PM1140C019
     C                     ENDSR                           *** EW04   ***
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W05      - WRITE PORTFOLIO HOLDINGS UPDATE (SE) AUDIT REPORT           *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P07      - AUDIT PROCESSING                                            *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           W05       BEGSR                           *** W05    ***
     C*                                                                   S01486
     C/COPY WNCPYSRC,PM1140C020
     C                     WRITEPM1140PP
     C/COPY WNCPYSRC,PM1140C021
     C*                                                                   S01486
     C           WEMPTY    IFEQ 'Y'                                       S01486
     C                     WRITENODTLS                                    S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     ENDSR                           *** EW05   ***
     C*
     C********************************************************************B08040
      /EJECT                                                              B08040
      ********************************************************************B08040
      *                                                                  *B08040
      * #HLDX0   - CALCULATE DETAILS TO BE OUTPUT TO PMHOLDX0            *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLS:                                                *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLED FROM:                                          *B08040
      * W01      - WRITE TO PMHOLDPP                                     *B08040
      *                                                                  *B08040
      * ROUTINE USES VARIABLES:                                          *B08040
      *                                                                  *B08040
      ********************************************************************B08040
     C           #HLDX0    BEGSR                           * W03    BSR * B08040
     C*                                                                   B08255
     C****       QFPTFR    IFNE '9998'                              R37474B08255
     C****       QFPTFR    ANDNE'9999'                              R37474B08255
     C****       WWAPBC    OREQ 'N'                                 R37474B08255
     C*                                                                   B08040
     C** DETERMINE PORTFOLIO VALUATION CURRENCY                           B08040
     C           QFPTFR    IFNE '9997'                     B1             B08040
     C           QFPTFR    ANDNE'9998'                                    B08040
     C           QFPTFR    ANDNE'9999'                                    B08040
     C                     MOVE WWPTCY    WWVLCY  3                       B08040
     C                     ELSE                            X1             B08040
     C                     MOVE WWCSBY    WWVLCY                          B08040
     C                     END                             E1             B08040
     C*                                                                   B08040
     C** IF VALUATION CURRENCY DIFFERENT TO CURRENCY 1 SET UP PARAMETER   B08040
     C** TO BE USED IN SR/ZCCYCN                                          B08040
     C           WWVLCY    IFNE QFCCY1                     B1             B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           QFCCY1    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        B2*************B08040
     C                     Z-ADD27        DBASE            * DB ERROR 16 *B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELQFCCY1    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     MOVE QFCCY1    ZCCYF                           B08040
     C                     Z-ADDSPRT,B    ZRATEF                          B08040
     C                     MOVE MDIN,B    ZMDINF                          B08040
     C                     Z-ADDNBDP,B    ZCDPF                           B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWVLCY    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        B2 ************B08040
     C                     Z-ADD28        DBASE            * DB ERROR 16 *B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWVLCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     MOVE WWVLCY    ZCCYT                           B08040
     C                     Z-ADDSPRT,B    ZRATET                          B08040
     C                     MOVE MDIN,B    ZMDINT                          B08040
     C                     Z-ADDNBDP,B    ZCDPT                           B08040
     C*                                                                   B08040
     C** CONVERT MARKET VALUE TO PORTFOLIO CURRENCY                       B08040
     C                     Z-ADDQFMVAL    ZAMTF                           B08040
     C******************** EXSR ZCCYCN                             B08040 037854
     C                     EXSR CONVN                                     050207
     C                     Z-ADDZAMTT     WWMVL1 150                      B08040
     C*                                                                   B08040
     C** CONVERT ACCRUED INTEREST TO PORTFOLIO CURRENCY                   B08040
     C                     Z-ADDQFACIS    ZAMTF                           B08040
     C******************** EXSR ZCCYCN                             B08040 037854
     C                     EXSR CONVN                                     050207
     C                     Z-ADDZAMTT     WWACI1 150                      B08040
     C*                                                                   B08040
     C** ... OTHERWISE USE VALUES WRITTEN TO PMHOLDPP                     B08040
     C                     ELSE                            X1             B08040
     C                     Z-ADDQFMVAL    WWMVL1                          B08040
     C                     Z-ADDQFACIS    WWACI1                          B08040
     C                     END                             E1             B08040
     C*                                                                   B08040
     C** SET ALL TOTAL FIELDS TO ZERO                                     B08040
     C                     Z-ADD0         QFPTPA                          B08040
     C                     Z-ADD0         QFPTNA                          B08040
     C                     Z-ADD0         QFPTMV                          B08040
     C                     Z-ADD0         QFPVPA                          B08040
     C                     Z-ADD0         QFPVNA                          B08040
     C                     Z-ADD0         QFPVMV                          B08040
     C                     Z-ADD0         QFPTAI                          B08040
     C                     Z-ADD0         QFPTNI                          B08040
     C                     Z-ADD0         QFMVPC                          R37474
     C                     Z-ADD0         QFAIPC                          R37474
     C*
     C** ADD MARKET VALUE AND ACCRUED INTEREST TO TOTALLING FIELDS
     C           WWTVPS    IFEQ 'T'                        B1
     C           QFTVDA    IFEQ 'T'                        B2
     C           WWMVL1    IFGT 0                          B3             B08040
     C                     Z-ADDWWMVL1    QFPTPA                          B08040
     C                     ELSE                            X3             B08040
     C                     Z-SUBWWMVL1    QFPTNA                          B08040
     C                     END                             E3             B08040
     C                     Z-ADDWWACI1    QFPTAI                          B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     ELSE                            X1             B08040
     C*                                                                   B08040
     C           QFTVDA    IFEQ 'V'                        B2
     C           WWMVL1    IFGT 0                          B3             B08040
     C                     Z-ADDWWMVL1    QFPVPA                          B08040
     C                     ELSE                            X3             B08040
     C                     Z-SUBWWMVL1    QFPVNA                          B08040
     C                     END                             E3             B08040
     C                     Z-ADDWWACI1    QFPTAI                          B08040
     C                     END                             E2             B08040
     C                     END                             E1             B08040
     C*                                                                   R37474
     C** CALCULATE EXTRA FIELDS TO BE OUTPUT TO PMHOLDPP FOR MIDASQ       R37474
     C           QFPTPA    IFNE 0                          B1             R37474
     C           QFPVPA    ORNE 0                                         R37474
     C                     Z-ADDQFPTPA    QFMVPC                          R37474
     C                     ADD  QFPVPA    QFMVPC                          R37474
     C                     MOVE '+'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTNA    IFNE 0                          B1             R37474
     C           QFPVNA    ORNE 0                                         R37474
     C                     Z-SUBQFPTNA    QFMVPC                          R37474
     C                     SUB  QFPVNA    QFMVPC                          R37474
     C                     MOVE '-'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTMV    IFNE 0                          B1             R37474
     C           QFPVMV    ORNE 0                                         R37474
     C                     Z-SUBQFPTMV    QFMVPC                          R37474
     C                     SUB  QFPVMV    QFMVPC                          R37474
     C                     MOVE 'L'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFMVPC    IFEQ 0                          B1             R37474
     C                     MOVE 'N'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C                     Z-ADDQFPTAI    QFAIPC                          R37474
     C*                                                                   B08040
     C** WRITE DETAILS TO PMHOLDX0                                        B08040
     C                     MOVE QFCCY1    QFCCY                           B08040
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD PMHOLDQ0 PMHOLDQ1            CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C*                                                                   B08255
     C           QFPTFR    IFNE '9998'                                    R37474
     C           QFPTFR    ANDNE'9999'                                    R37474
     C           WWAPBC    OREQ 'N'                                       R37474
     C*                                                                   B08255
     C           QFAMT1    IFNE 0                                         051250
     C           QFOAMT    ORNE 0                                         056548
     C           QFACIS    ORNE 0                                         051250
     C/COPY WNCPYSRC,PM1140C022
     C           WWAPBC    IFEQ 'N'                                       B08255
     C                     WRITEPMHOLDD1                                  B08040
     C                     ELSE                                           B08255
     C                     WRITEPMHOLDD0                                  B08040
     C                     END                                            B08255
     C/COPY WNCPYSRC,PM1140C023
     C                     END                                            051250
     C                     END                                            B08255
     C*                                                                   B08040
     C                     ENDSR                           * W03    ESR * B08040
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * Z01      - ZEROIZE ALL TOTAL FIELDS                                    *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * INIT     - INITIAL PROCESSING                                          *
      * FULX     - FULL EXTRACT                                                *
      * CRGX     - CHARGING EXTRACT                                            *
      * VALX     - VALUATION EXTRACT                                           *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWPMT1   - TOTAL PORTFOLIO NOMINAL AMOUNT                              *
      * WWPVAL   - TOTAL PORTFOLIO MARKET VALUE                                *
      * WWPPLP   - TOTAL PORTFOLIO PURCHASED INTEREST                          *
      * WWPNAC   - TOTAL PORTFOLIO ACCRUED INTEREST                            *
      * WWPODA   - TOTAL PORTFOLIO NUMBER OF DAYS ACCRUED INTEREST             *
      * WWCMT1   - TOTAL CUSTOMER NOMINAL                                      *
      * WWCVAL   - TOTAL CUSTOMER MARKET VALUE                                 *
      * WWCILP   - TOTAL CUSTOMER PURCHASED INTEREST                           *
      * WWCNAC   - TOTAL CUSTOMER ACCRUED INTEREST                             *
      * WWCODA   - TOTAL CUSTOMER NUMBER OF DAYS ACCRUED INTEREST              *
      *                                                                        *
      **************************************************************************
     C           Z01       BEGSR                           *** Z01    ***
     C*
     C** ZEROIZE ALL TOTAL FIELDS
     C                     Z-ADD0         WWPMT1
     C                     Z-ADD0         WWPVAL
     C                     Z-ADD0         WWPPLP
     C                     Z-ADD0         WWPNAC
     C                     Z-ADD0         WWPODA
     C                     Z-ADD0         WWPOMT                          B08040
     C                     Z-ADD0         WWCMT1
     C                     Z-ADD0         WWCVAL
     C                     Z-ADD0         WWCILP
     C                     Z-ADD0         WWCNAC
     C                     Z-ADD0         WWCODA
     C                     Z-ADD0         WWCOMT                          B08040
     C                     ENDSR                           *** EZ01   *
     C**************************************************************************
      /EJECT
      /COPY ZSRSRC,ZNCDZ3
      /EJECT
      /COPY ZSRSRC,ZCCYCN
      ****/EJECT                                                          47719
      ****/COPY ZSRSRC,ZCCYXR                                             47719
      /EJECT                                                              062885
      /COPY ZSRSRC,ZCCYXR                                                 062885
      /EJECT
      /COPY ZSRSRC,ZPRCIZ1
      /EJECT
      /COPY ZSRSRC,ZLCDZ1
      /EJECT
      /COPY ZSRSRC,ZYLDIZ1
      /EJECT
      /COPY ZSRSRC,ZYLDZ2
      /EJECT
      /COPY ZSRSRC,ZYLDOZ1
      /EJECT
      /COPY ZSRSRC,ZACCZZ1                                                S01486
      /EJECT                                                              S01486
      /COPY ZSRSRC,ZCNSDZ1                                                S01486
      /EJECT                                                              S01486
      /COPY ZSRSRC,ZCALCD                                                 S01486
      /EJECT                                                              S01486
     C********************************************************************
     C*
     C*  ZFSELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR SECURITIES TRADING REL.2
     C*
     C*  FORMAT: XXX 999.9999 DDMMMYY
     C*          XXX =  NOMINAL CURRENCY
     C*          999.9999 = CONPON RATE
     C*          DDMMMYY = MATURITY DATE
     C*
     C*  INPUT  FIELDS
     C*       ZNMCY   3A     NOMINAL CURRENCY
     C*       ZCPNR  117     COUPON RATE
     C*       ZMATY   50     MATURITY DATE
     C*       ZPROT   1A     PROCESSING TYPE
     C*
     C*  OUTPUT  FIELDS
     C*       ZLIN   20A     LINE DESCRIPTION
     C*
     C*  ARRAY USED
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFSELN    BEGSR                           *** ZFSELN ***
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C** MOVE NOMINNAL CURRENCY TO LINE DESCRIPTION
     C                     MOVEAZNMCY     ZLI,01
     C*
     C** IF PROCESSING TYPE     NOT COMMODITIES ZPROT = 2
     C**                        NOT EQUITIES    ZPROT = 4
     C**                        NOT UNIT TRUSTS ZPROT = 7
     C           ZPROT     IFNE '2'
     C           ZPROT     ANDNE'4'
     C           ZPROT     ANDNE'7'
     C*
     C** MOVE COUPON  RATE  TO LINE DESCRIPTION
     C                     Z-ADDZCPNR     ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C                     MOVE ZWRKN     ZWRKA4  4
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C** MOVE MATURITY DATE TO LINE DESCRIPTION
     C                     Z-ADDZMATY     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C           ZADATE    IFNE *BLANK
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C                     END
     C                     END
     C*
     C** SET ALL   FIELDS TO BLANKS OR ZEROS
     C                     MOVE *BLANKS   ZNMCY   3
     C                     MOVE *BLANKS   ZPROT   1
     C                     Z-ADD*ZEROS    ZCPNR  117
     C                     Z-ADD*ZEROS    ZMATY   50
     C*
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN   26                                           CGL029
     C*
     C                     ENDSR
     C*******************************************************************
      /EJECT
     C**************************************************************************
     C*                                                                        *
     C*  ZAVPRC  CALCULATE AVERAGE PRICE                                       *
     C*                                                                        *
     C*  PURPOSE : TO CALCULATE AN AVERAGE PRICE (BY DIVIDING THE              *
     C*            VALUE OF A HOLDING BY THE NOMINAL)                          *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C*       ZNOML  11 0     NOMINAL                                          *
     C*       ZVALU  15 0     VALUE                                            *
     C*       ZNMDP   1 0     NOMINAL DECIMAL PLACES (0-4)                     *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3 )           *
     C*       ZPRCB   1 A     PRICE BASIS (P/U)                                *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZAVPR  15 8     AVERAGE PRICE                                    *
     C*                                                                        *
     C*  ALSO REQUIRED                                                         *
     C*       POWER8 ARRAY                                                     *
     C*                                                                        *
     C*  WORK FIELDS:                                                          *
     C*       ZI      1 0 - INDEX TO POWER ARRAY                               *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                        *
     C**************************************************************************
     C********** ZAVPRC    BEGSR                           *** ZAVP       49213
     C**********                                                          49213
     C**********ALL FIELDS                                                49213
     C**********                                                          49213
     C**********           Z-ADDZNOML     ZNOML  110                      49213
     C**********           Z-ADDZVALU     ZVALU  150                      49213
     C**********           Z-ADDZNMDP     ZNMDP   10                      49213
     C**********           Z-ADDZNMCD     ZNMCD   10                      49213
     C**********           MOVE ZPRCB     ZPRCB   1                       49213
     C**********           Z-ADDZAVPR     ZAVPR  158                      49213
     C*
     C** IF NOMINAL = 0   END PROCESS
     C********** ZNOML     IFEQ 0                                         49213
     C**********           Z-ADD0         ZAVPR                           49213
     C*
     C** IF NOMINAL NOT = ZEROS
     C**********           ELSE                                           49213
     C*
     C** DIVIDE VALUE BY NOMINAL   IN ZAVPR
     C********** ZVALU     DIV  ZNOML     ZAVPR                           49213
     C*
     C** IF PRICE BASIS IS PERCENTAGE
     C********** ZPRCB     IFEQ 'P'                                       49213
     C********** 100       MULT ZAVPR     ZAVPR                           49213
     C**********           END                                            49213
     C*
     C** SET POWER8 INDEX TO 5 - NBR NOMINAL DEC. PLACES + NBR CURRENCY DEC. PL.
     C********** 5         SUB  ZNMDP     ZI      10                      49213
     C**********           ADD  ZNMCD     ZI                              49213
     C*
     C** DIVIDE AVERAGE PRICE BY POWER
     C********** ZAVPR     DIV  POWER8,ZI ZAVPR     H                     49213
     C*
     C** SET AVERAGE PRICE POSITIVE
     C********** ZAVPR     IFLE 0                                         49213
     C**********           Z-SUBZAVPR     ZAVPR                           49213
     C**********           END                                            49213
     C*
     C** END CONDITION NOMINAL = ZERO
     C**********           END                                            49213
     C*
     C**
     C**********           ENDSR                                          49213
     C**************************************************************************
      /EJECT
     C*************************************************************************
     C*                                                                       *
     C*  ZFXAVP - CALCULATE AVERAGE FX RATE                                   *
     C*                                                                       *
     C*  PURPOSE : TO CALCULATE AN AVERAGE FX RATE (VALUE OF HOLDING IN       *
     C*            PORTFOLIO CURRENCY DIVIDED BY VALUE IN NOMINAL CURRENCY)   *
     C*                                                                       *
     C*  INPUT  FIELDS                                                        *
     C*       ZAPNM  15 0     AVERAGE PRICE NUMERATOR                         *
     C*       ZFXAP  15 0     FX AVERAGE PRICE NUMERATOR                      *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3)           *
     C*       ZPTCD   1 0     PORTFOLIO CURRENCY DECIMAL PLACES (0-3)         *
     C*                                                                       *
     C*  OUTPUT  FIELDS                                                       *
     C*       ZAVFX  13 8     AVERAGE FX RATE                                 *
     C*                                                                       *
     C*  ALSO REQUIRED                                                        *
     C*       POWER8 ARRAY    ARRAY FOR CURRENCY CONVERSIONS                  *
     C*                                                                       *
     C*  WORK FIELDS:                                                          *
     C*       ZI      1 0     INDEX TO POWER ARRAY                            *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                       *
     C*************************************************************************
     C********** ZFXAVP    BEGSR                           *** ZFXA       49213
     C*
     C** DEFINE ALL FIELDS
     C*
     C**********           Z-ADDZAPNM     ZAPNM  150                      49213
     C**********           Z-ADDZFXAP     ZFXAP  150                      49213
     C**********           Z-ADDZNMCD     ZNMCD   10                      49213
     C**********           Z-ADDZPTCD     ZPTCD   10                      49213
     C**********           Z-ADDZAVFX     ZAVFX  138                      49213
     C*
     C** IF AP NUMERATOR = 0   END PROCESS
     C********** ZAPNM     IFEQ 0                                         49213
     C**********           Z-ADD0         ZAVFX                           49213
     C*
     C** IF AP NUMERATOR NOT = ZEROS
     C**********           ELSE                                           49213
     C*
     C** DIVIDE FX AP NUMERATOR BY AP NUMERATOR
     C********** ZFXAP     DIV  ZAPNM     ZAVFX     H                     49213
     C*
     C** SET POWER8 INDEX TO 5 - NBR NOM CCY DEC. PLACES + NBR PORT CCY DEC. PL.
     C********** 5         SUB  ZNMCD     ZI      10                      49213
     C**********           ADD  ZPTCD     ZI                              49213
     C*
     C** DIVIDE AVERAGE PRICE BY POWER
     C********** ZAVFX     DIV  POWER8,ZI ZAVFX     H                     49213
     C*
     C** SET AVERAGE PRICE POSITIVE
     C********** ZAVFX     IFLE 0                                         49213
     C**********           Z-SUBZAVFX     ZAVFX                           49213
     C**********           END                                            49213
     C*
     C** END CONDITION NOMINAL = ZERO
     C**********           END                                            49213
     C*
     C********** ZXAVP9    ENDSR                                          49213
      **************************************************************************
      /EJECT
     C**************************************************************************
     C*                                                                        *
     C*  ZAVYLD  CALCULATE AVERAGE YIELD                                       *
     C*                                                                        *
     C*  PURPOSE : TO CALCULATE AN AVERAGE YIELD (BY DIVIDING THE              *
     C*            YIELD VALUE OF A HOLDING BY THE NOMINAL)                    *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C*       ZNOML  11 0     NOMINAL                                          *
     C*       ZVALU  15 0     VALUE                                            *
     C*       ZNMDP   1 0     NOMINAL DECIMAL PLACES (0-4)                     *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3 )           *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZAVYD  15 8     AVERAGE YIELD                                    *
     C*                                                                        *
     C*  ALSO REQUIRED                                                         *
     C*       POWER8 ARRAY                                                     *
     C*                                                                        *
     C*  WORK FIELDS:                                                          *
     C*       ZI      1 0 - INDEX TO POWER ARRAY                               *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                        *
     C**************************************************************************
     C********** ZAVYLD    BEGSR                           *** ZAVY       49213
     C*
     C** DEFINE ALL FIELDS
     C*
     C**********           Z-ADDZNOML     ZNOML  110                      49213
     C**********           Z-ADDZVALU     ZVALU  150                      49213
     C**********           Z-ADDZNMDP     ZNMDP   10                      49213
     C**********           Z-ADDZNMCD     ZNMCD   10                      49213
     C**********           Z-ADDZAVYD     ZAVYD  117                      49213
     C*
     C** IF NOMINAL = 0   END PROCESS
     C********** ZNOML     IFEQ 0                                         49213
     C**********           Z-ADD0         ZAVYD                           49213
     C*
     C** IF NOMINAL NOT = ZEROS
     C**********           ELSE                                           49213
     C*
     C** DIVIDE VALUE BY NOMINAL   IN ZAVYD
     C********** ZVALU     DIV  ZNOML     ZAVYD                           49213
     C*
     C** SET POWER8 INDEX TO 5 - NBR NOMINAL DEC. PLACES + NBR CURRENCY DEC. PL.
     C********** 5         SUB  ZNMDP     ZI      10                      49213
     C**********           ADD  ZNMCD     ZI                              49213
     C*
     C** DIVIDE AVERAGE PRICE BY POWER
     C********** ZAVYD     DIV  POWER8,ZI ZAVYD     H                     49213
     C*
     C** SET AVERAGE YIELD POSITIVE
     C********** ZAVYD     IFLE 0                                         49213
     C**********           Z-SUBZAVYD     ZAVYD                           49213
     C**********           END                                            49213
     C*
     C** END CONDITION NOMINAL = ZERO
     C**********           END                                            49213
     C*
     C**
     C**********           ENDSR                                          49213
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C*                                                                        *
     C*  ZAPNUM - CALCULATE AP NUMERATOR                                       *
     C*                                                                        *
     C*  PURPOSE : TO MULTIPLY A NOMINAL POSITION BY THE PRICE OF THE          *
     C*  POSITION TO GIVE A VALUE OF THE POSITION WITH THE CORRECT NUMBER      *
     C*  OF DECIMAL PLACES FOR THE NOMINAL CURRENCY                            *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C*       ZNOML  11 0     NOMINAL                                          *
     C*       ZAVPR  15 8     AVERAGE PRICE                                    *
     C*       ZNMDP   1 0     NOMINAL DECIMAL PLACES (0-4)                     *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3)            *
     C*       ZPRCB   1 A     PRICE BASIS (P/U)                                *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZVALU  15 0     VALUE                                            *
     C*                                                                        *
     C*  ALSO REQUIRED                                                         *
     C*       POWER8 ARRAY OF MULTIPLYING FACTORS FOR NOMINAL DECIMAL PLACES   *
     C*                                                                        *
     C*  WORK FIELDS:                                                          *
     C*       ZVAL0  15 0 - AVERAGE PRICE WITH 0 DECIMAL PLACES                *
     C*       ZVAL1  15 1 - --------------- '' ----------------                *
     C*       ZVAL2  15 2 - --------------- '' ----------------                *
     C*       ZVAL3  15 3 - --------------- '' ----------------                *
     C*       ZI      1 0 - POWER ARRAY                                        *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                        *
     C*************************************************************************
     C********** ZAPNUM    BEGSR                           *** ZAPN       49213
     C*
     C** DEFINE ALL FIELDS
     C**********           Z-ADDZNOML     ZNOML  110                      49213
     C**********           Z-ADDZAVPR     ZAVPR  158                      49213
     C**********           Z-ADDZNMDP     ZNMDP   10                      49213
     C**********           Z-ADDZNMCD     ZNMCD   10                      49213
     C**********           MOVE ZPRCB     ZPRCB   1                       49213
     C**********           Z-ADDZVALU     ZVALU  150                      49213
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 0
     C********** ZNMCD     IFEQ 0                                         49213
     C********** ZNOML     MULT ZAVPR     ZVAL0  150H                     49213
     C**********           MOVE ZVAL0     ZVALU                           49213
     C**********           END                                            49213
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 1
     C********** ZNMCD     IFEQ 1                                         49213
     C********** ZNOML     MULT ZAVPR     ZVAL1  151H                     49213
     C**********           MOVE ZVAL1     ZVALU                           49213
     C**********           END                                            49213
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 2
     C********** ZNMCD     IFEQ 2                                         49213
     C********** ZNOML     MULT ZAVPR     ZVAL2  152H                     49213
     C**********           MOVE ZVAL2     ZVALU                           49213
     C**********           END                                            49213
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 3
     C********** ZNMCD     IFEQ 3                                         49213
     C********** ZNOML     MULT ZAVPR     ZVAL3  153H                     49213
     C**********           MOVE ZVAL3     ZVALU                           49213
     C**********           END                                            49213
     C*
     C** SET INDEX ZI EQUAL TO 5 -. NOMINAL DECIMAL PLACES )
     C********** 5         SUB  ZNMDP     ZI      10                      49213
     C*
     C** MULTIPLY ZVALU BY  POWER8,ZI TO GET AMOUNT WITH NOMINAL DECIMAL PLACES
     C********** ZVALU     MULT POWER8,ZI ZVALU                           49213
     C*
     C** PRICE BASIS IF = PERCENTAGE
     C********** ZPRCB     IFEQ 'P'                                       49213
     C********** ZVALU     DIV  100       ZVALU     H                     49213
     C**********           END                                            49213
     C*
     C**********           ENDSR                                          49213
     C*************************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE1Z2
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZAINSH                                                 B05982
      /EJECT
      /COPY ZSRSRC,ZAISCH                                                 B05982
      /EJECT
      /COPY ZSRSRC,ZRATEZ1
      /EJECT
      /COPY ZSRSRC,ZACCRZ1
      /EJECT
      /COPY ZSRSRC,ZDAYSZ2
      /EJECT
      /COPY ZSRSRC,ZDYYRZ3
      /EJECT
      /COPY ZSRSRC,ZAVPRC                                                 49213
      /COPY ZSRSRC,ZFXAVP                                                 49213
      /COPY PMCPYSRC,ZAVYLD                                               49213
      /COPY ZSRSRC,ZAPNUM                                                 49213
      **************************************************************************
      *                                                                        *
      * *PSSR    - ERROR SUBROUTINE                                            *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * INIT     - INITIAL PROCESSING                                          *
      * VALX     - VALUATION EXTRACT                                           *
      * P01      - ACCESS INSTRUMENT DETAILS                                   *
      * P02      - ACCESS CUSTOMER DETAILS                                     *
      * P03      - ACCESS PORTFOLIO DETAILS                                    *
      * P07      - AUDIT PROCESSING                                            *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           *PSSR     BEGSR
     C*
     C           WWERRO    IFEQ ' '
     C                     MOVE 'Y'       WWERRO  1
     C*
     C           DBASE     IFNE 0
     C*
     C**  PRINT ERROR MESSAGE:
     C                     WRITEERRORAU
     C                     ELSE
     C                     Z-ADD999       DBASE
     C                     END
     C*
     C                     DUMP
     C                     END
     C*
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
     C*  SUBROUTINE INTEGRATED  37854                                    037854*
     C*                                                                  037854
     C*                                                                  037854*
     C*  ZCCYCN SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER      037854*
     C*  CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES            037854*
     C*                                                                  037854*
     C*  INPUT  FIELDS                                                   037854*
     C*       ZAMTF  150     AMOUNT IN 'FROM' CURRENCY                   037854*
     C*       ZCCYF   3A     FROM CURRENCY                               037854*
     C*       ZCCYT   3A     TO CURRENCY                                 037854*
     C*       ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY               037854*
     C*       ZRATET 138     SPOT RATE FOR 'TO' CURRENCY                 037854*
     C*       ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CURRENCY37854*
     C*       ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURRENCY 037854*
     C*       ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY 037854*
     C*       ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY   037854*
     C*                                                                  037854*
     C*  OUTPUT  FIELDS                                                  037854*
     C*       ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT)    *
     C*       ZCRSRT 138     CROSS EXCHANGE RATE                         037854*
     C*       ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR        037854*
     C*                                                                  037854*
     C*                                                                  037854*
     C*  CALLS:                                                          037854*
     C*       ZCCYXR                                                     037854*
     C*                                                                  037854*
     C*  CALLED BY:                                                      037854*
     C*                                                                  037854*
     C**************************************************************************
     C*                                                                   037854
     C           CONVN     BEGSR                                          050207
     C*                                                                   037854
     C** DEFINE ALL FIELDS                                                037854
     C                     Z-ADDZAMTF     ZAMTF  150                      037854
     C                     MOVE ZCCYF     ZCCYF   3                       037854
     C                     MOVE ZCCYT     ZCCYT   3                       037854
     C                     Z-ADDZRATEF    ZRATEF 138                      037854
     C                     Z-ADDZRATET    ZRATET 138                      037854
     C                     MOVE ZMDINF    ZMDINF  1                       037854
     C                     MOVE ZMDINT    ZMDINT  1                       037854
     C                     Z-ADDZCDPF     ZCDPF   10                      037854
     C                     Z-ADDZCDPT     ZCDPT   10                      037854
     C                     Z-ADDZAMTT     ZAMTT  150                      037854
     C                     Z-ADDZCRSRT    ZCRSRT 138                      037854
     C                     MOVE ZCRSMD    ZCRSMD  1                       037854
     C*                                                                   037854
     C** IF 'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TO' CURRENCY
     C** EQUAL TO AMOUNT IN 'FROM' CURRENCY
     C           ZCCYF     IFEQ ZCCYT                                     037854
     C                     Z-ADDZAMTF     ZAMTT                           037854
     C                     Z-ADD1         ZCRSRT                          037854
     C                     MOVE 'M'       ZCRSMD                          037854
     C                     ELSE                                           037854
     C*                                                                   037854
     C** INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO                 037854
     C                     Z-ADD*ZEROS    ZCRSRT                          037854
     C                     MOVE ZMDINF    ZCRSMD                          041644
     C*                                                                   037854
     C** IF MULT/DIV INDIC. FOR 'FROM' IS = MULT/DIV INDIC FOR 'TO' INDIC 037854
     C**   AND SPOT RATE FOR 'TO' CURRENCY (ZRATET) IS NOT = ZERO         037854
     C           ZMDINF    IFEQ ZMDINT                                    037854
     C           ZRATET    ANDNE*ZEROS                                    037854
     C           ZRATEF    IFGT ZRATET                                    037854
     C           ZRATEF    DIV  ZRATET    ZCRSRT                          037854
     C                     ELSE                                           037854
     C           ZRATET    DIV  ZRATEF    ZCRSRT                          037854
     C           ZMDINF    IFEQ 'D'                                       041644
     C                     MOVE 'M'       ZCRSMD                          037854
     C                     ELSE                                           041644
     C                     MOVE 'D'       ZCRSMD                          041644
     C                     END                                            041644
     C                     END                                            037854
     C*                                                                   037854
     C** IF MULT/DIV INDIC FOR 'FROM' IS NOT= MULT/DIV INDIC FOR 'TO' INDIC
     C** OR  SPOT RATE FOR 'TO' CURRENCY (ZRATET) IS  = ZERO
     C                     ELSE                                           037854
     C           ZRATEF    MULT ZRATET    ZCRSRT                          037854
     C                     END                                            037854
     C*                                                                   037854
     C** MOVE MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULT/DIV   037854
     C** INDICATOR (ZCRSMD)                                               037854
     C*********************MOVE ZMDINF    ZCRSMD                   037854 041644
     C*                                                                   037854
     C** EXECUTE   SR ZCCYXR                                              037854
     C                     EXSR ZCCYXR                                    037854
     C                     END                                            037854
     C                     ENDSR                                          050207
      *****************************************************************   CPM005
      *                                                               *   CPM005
      *  NEWFLD   - New field in PMHOLDPD PMHOLDQ0 PMHOLDQ1           *   CPM005
      *                                                               *   CPM005
      *  Subroutine Calls:                                            *   CPM005
      *                                                               *   CPM005
      *  Subroutine Called From:                                      *   CPM005
      *  W01      -                                                   *   CPM005
      *  W02      -                                                   *   CPM005
      *  W03      -                                                   *   CPM005
      *                                                               *   CPM005
      *  Routine Uses Variables:                                      *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
     C           NEWFLD    BEGSR                                          CPM005
      *                                                                   CPM005
     C           MATY      IFEQ *ZEROS                                    CPM005
     C                     Z-ADD99000     WWMATY                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADDMATY      WWMATY                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     MOVELWWPOSQ    QFPOSQ                          CPM005
     C                     MOVEL'C '      QFPOTY                          CPM005
     C                     MOVEL'C '      QFPOST                          CPM005
      *                                                                   CPM005
     C           WWMVL1    ADD  WWACI1    WWORK2 150                      CPM005
     C           WWORK2    IFGT *ZEROS                                    CPM005
     C                     Z-ADD*ZEROS    QFASVL                          CPM005
     C           WWMVL1    ADD  WWACI1    QFASVL                          CPM005
     C                     MOVEL'A'       QFASLI                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADD*ZEROS    QFASVL                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C           WWORK2    IFLT *ZEROS                                    CPM005
     C                     Z-SUBWWMVL1    WWMVL1                          CPM005
     C           WWMVL1    SUB  WWACI1    QFLIVL                          CPM005
     C                     MOVEL'L'       QFASLI                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADD*ZEROS    QFLIVL                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
     C********************************************************************
     C*
**  CPY@
(c) Finastra International Limited 2001
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
