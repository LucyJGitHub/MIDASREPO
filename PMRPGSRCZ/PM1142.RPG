     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Update FF portfolio holdings')                *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM1142  - Update FF Portfolio Holdings                       *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CLE148             Date 23Jul12               *
      *                 AR746662           Date 03May11               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23967           Date 15May09               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247517             Date 09May07               *
      *                 CPK027             Date 17Apr07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 241147A            Date 07Nov06               *
      *                 241147             Date 26Oct06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 215528             Date 21Mar03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun02               *
      *                 CAS002             Date 14Jan02               *
      *                 182961             Date 21Apr01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 09Jul99               *
      * Midas DBA 3.01 Patch E ---------------------------------------*
      *                 170520             Date 19Nov99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAP003             Date 18Aug98               *
      *                 CPM005             DATE 01JUL96               *
      *                 CFF004             DATE 12SEP96               *
     F*                 CPM003             DATE 01DEC95               *
     F*                 077485             DATE 17OCT94               *
     F*                 076371             DATE 26SEP94               *
     F*                 075998             DATE 19SEP94               *
     F*                 S71062             DATE 22FEB94               *
     F*                 079510             DATE 30NOV94               *
     F*                 072242             DATE 08JUN94               *
     F*                 072323             DATE 21JUN94               *
     F*                 061296             DATE 27SEP93               *
     F*                 061297             DATE 29SEP93               *
     F*                 061230             DATE 24SEP93               *
     F*                 059581             DATE 17AUG93               *
     F*                 057020             DATE 18JUN93               *
     F*                 046167             DATE 22OCT92               *
     F*                 047719             DATE 19JAN93               *
     F*                 S01313             DATE 28APR92               *
     F*                 R37474             DATE 23MAR92               *
     F*                 B08255             DATE 07OCT91               *
     F*                 B08040             DATE 04JUL91               *
     F*                 R05669             DATE 13MAR91               *
     F*                 R01159             DATE 02JAN91               *
     F*                                                               *
     F*****************************************************************
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR746662 - Discrepancy in premium amount in Currency OTC     *
      *             screen and Projected Available Balance Enquiry    *
      *             Applied fix 249171. (Recompile)                   *
      *             (Child: Artf746663)                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23967 - Add Local Industry Code Field.                    *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  247517 - Reversed fix 241147.                                *
      *  CPK027 - Errors in compiling MP1_3_TTTS - recompile over     *
      *           changed FFTVCLZ2.                                   *
      *  241147A - Recompile.                                         *
      *  241147 - Recompile.                                          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  215528 - System is associating a wrong premium amount.       *
      *           Recompiled only.                                    *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed FFYTOPZ1.                    *
      *  CAS002 - Hedge Strategy/Linkage (Recompile)                  *
      *  182961 - Database error occurred due to a blank key field    *
      *           (Instrument Type).  The default Instrument type in  *
      *           PF/SDPORTPD is taken if a blank instrument type is  *
      *           encountered.                                        *
     F*  CPB001 -  'Private Banking' Module                           *
      *  170520 - Recompile over changed TRANSD file                  *
      *  CAP003 - Conversion of Midas inputs to modular API structure *
      *           (phase 2) - recompiled                              *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/2 - CALCULATE & REPORT PERF. FOR ALL CUST.PORT *
     F*           PBFG/5 - INSTRUMENT ASSET LIABILITY SPLIT           *
     F*           PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*  CFF004 - Increase in size of Price Fields                    *
     F*  CPM003 - FF PM Interface Upgrade to R10.                     *
     F*  077485 - FF/PM INTERFACE : MATURE FLAT POSITIONS NOT         *
     F*           EXTRACTED FOR FF TRADES                             *
     F*  076371 - FF/PM INTERFACE CORRECTIONS                         *
     F*  075998 - FF/PM PERFORMANCE INTERFACE CHANGES                 *
     F*  S71062 - FF/PM INTERFACE : PM CHANGES                        *
     F*  079510 - DO NOT CONSIDER FF IF PTFR IS BLANK.                *
     F*  072242 - OUTPUT ADDITIONAL FIELDS NMDP & SPBS                *
     F*  072323 - EXTRACT PORTFOLIO FOR FF CONCERNS ONLY PRIVATE      *
     F*           CUSTOMER TRANSACTIONS                               *
     F*  061296 - SUB IF PURCHASE AND ADD IF SOLD                     *
     F*  061297 - STRIKE PRICE TRUNCATED                              *
     F*  061230 - ARRAY INDEX ERROR FOR OTC                           *
     F*  059581 - YEAR & MONTH ARE ZEROES FOR OTC INSTRUMENTS -       *
     F*           ALTER STANDARD FF DEFINITION OUTPUT                 *
     F*  057020 - OUTPUT DOUBLE PRECISION FX RATE                     *
     F*  046167 - INCORPORATE F&O STRIKE PRICE.                       *
     F*  047719 - USE EXTERNAL SUBROUTINES ZCCYCN AND ZCCYXR INSTEAD  *
     F*           OF INCORRECT ONCE INTERNALLY DESCRIBED.             *
     F*  S01313 - CHANGES FOR PORTFOLIO PERFORMANCE                   *
     F*  R37474 - ADD TOTALLING FIELDS TO PF/PMHOLDPP FOR MIDASQ      *
     F*  B08255 - SPEED UP COB BY SPLITTING TOTALLING FILES           *
     F*  B08040 - SUNDRY FIXES TO SPEED UP COB                        *
     F*  R05669 - ADD DEFAULT INDUSTRY AND COUNTRY CODE TO SCREEN     *
     F*  R01159 - FOR FUTURES & OPTIONS UNREALISED MARKET P&L         *
     F*            MUST BE SHOWN AS ACCRUED INTEREST                  *
     F*****************************************************************
     FTRANS2  IF  E           K        DISK
     F                                              KINFSR *PSSR
     F****PREFIX*OF*PMCHRGQ1*IS*'PO'**************************************CPM003
     F***PMCHRGQ1IF**E           K        DISK                            CPM003
     F*********** PMCHRGP0                          KRENAMEPMCHRGQ0       CPM003
     F***********                                   KINFSR *PSSR          CPM003
     F****PREFIX*OF*PMPORTQ2*IS*'PN'**************************************CPM003
     F***PMPORTQ2IF**E           K        DISK                            CPM003
     F*********** PMPORTP0                          KRENAMEPMPORTQ0       CPM003
     F***********                                   KINFSR *PSSR          CPM003
     F****PREFIX*OF*SDBANKL1*IS*'BJ'**************************************CPM003
     F***SDBANKL1IF**E           K        DISK                            CPM003
     F***********                                   KINFSR *PSSR          CPM003
     F***TRANSPT*IF**E           K        DISK                            CPM003
     F*********** TRANSDF                           KRENAMETRANSDF0       CPM003
     F***********                                   KINFSR *PSSR          CPM003
     FTRANS9  UF  E           K        DISK                               077485
     F            TRANSDF                           KRENAMETRANSDF9       077485
     F                                              KINFSR *PSSR          077485
     FINTYP   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDPLINPD*IS*'PD'**************************************CPM003
     F***SDPLINPDIF**E           K        DISK                            CPM003
     F***********                                   KINFSR *PSSR          CPM003
     F****PREFIX*OF*PMDSPGPP*IS*'PA'**************************************CPM003
     F***PMDSPGPPIF**E           K        DISK                            CPM003
     F**  PREFIX OF PMDSPGPD IS 'PA'                                      CPM003
     FPMDSPGPDIF  E           K        DISK                               CPM003
     F                                              KINFSR *PSSR
     F****PREFIX*OF*PMVLGHPP*IS*'PB'**************************************CPM003
     F***PMVLGHPPIF**E           K        DISK                            CPM003
     F**  PREFIX OF PMVLGHPD IS 'PB'                                      CPM003
     FPMVLGHPDIF  E           K        DISK                               CPM003
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDCURRL0*IS*'A6'**************************************CPM003
     F***SDCURRL0IF**E           K        DISK                            CPM003
     F***********                                      KINFSR *PSSR       CPM003
     F***PRICS***IF**E           K        DISK                            S71062
     FPRICS1  IF  E           K        DISK                               S71062
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDPLCSL0*IS*'BB'**************************************CPM003
     F***SDPLCSL0IF**E           K        DISK                            CPM003
     F***********                                   KINFSR *PSSR          CPM003
     F****PREFIX*OF*PMPORTPP*IS*'PN'**************************************CPM003
     F***PMPORTPPIF**E           K        DISK                            CPM003
     F**  PREFIX OF PMPORTPD IS 'PN'                                      CPM003
     FPMPORTPDIF  E           K        DISK                               CPM003
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDPORTPD*IS*'P9'********************************R05669CPM003
     F*DPORTPDIF**E*****      K        DISK                               B08040
     F***SDPORTPDIF**E                    DISK                   B08040   CPM003
     F***********                                   KINFSR *PSSR R05669   CPM003
     F****PREFIX*OF*PMHOLDZZ*IS*'QF'**************************************CPM003
     F***PMHOLDZZUF**E           K        DISK                      A     CPM003
     F**  PREFIX OF PMHOLDPA IS 'QF'                                      CPM003
     FPMHOLDPAUF  E           K        DISK                      A        CPM003
     F****PREFIX*OF*PMHOLDPP*IS*'QF'**************************************CPM003
     F***PMHOLDPPO***E           K        DISK                            CPM003
     F**  PREFIX OF PMHOLDPD IS 'QF'                                      CPM003
     FPMHOLDPDO   E           K        DISK                               CPM003
     F                                              KINFSR *PSSR
     F****PREFIX*OF*PMHOLDPP*IS*'QF'********************************B08040CPM003
     F***PMHOLDX0O***E           K        DISK                      B08040CPM003
     F**  PREFIX OF PMHOLDPD IS 'QF'                                      CPM003
     FPMHOLDQ0O   E           K        DISK                               CPM003
     F                                              KINFSR *PSSR          B08040
     F****PREFIX*OF*PMHOLDPP*IS*'QF'********************************B08255CPM003
     F***PMHOLDX1O***E           K        DISK                      B08255CPM003
     F**  PREFIX OF PMHOLDQ1 IS 'QF'                                      CPM003
     FPMHOLDQ1O   E           K        DISK                               CPM003
     F                                              KINFSR *PSSR          B08255
     FCLOSTTM IF  E           K        DISK                               S71062
     F                                              KINFSR *PSSR          S71062
     FCLOST9  IF  E           K        DISK                               S71062
     F                                              KINFSR *PSSR          S71062
     FMARKT   IF  E           K        DISK                               S71062
     F                                              KINFSR *PSSR          S71062
     F***TABLETJ*IF**E           K        DISK                      S71062CPM003
     F***********                                   KINFSR *PSSR    S71062CPM003
     F***PMHSEXPPIF**E           K        DISK                      S71062CPM003
     FPMHSEXPDIF  E           K        DISK                               CPM003
     F                                              KINFSR *PSSR          S71062
     FPMEVCYPDO   E                    DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     FSDPORTPDIF  E                    DISK         KINFSR *PSSR          182961
     FPM1142AUO   E                    PRINTER
     E*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       71 => INDICATOR FOR READ
     F*       72 => INDICATOR FOR CHAIN-READ
     F*       73 => INDICATOR FOR READE
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   70 *
     F**      * ..   ..   ..   74   75   76   77   78   79   80 *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     E*****************************************************************
     E*                                                                   B08040
     E** TABLES/ARRAYS USED TO AVOID FILE ACCESS OPERATIONS               B08040
     E                    CYCD      200  3                                B08040
     E                    SPRT      200 13 8                              B08040
     E                    MDIN      200  1                                B08040
     E                    NBDP      200  1 0                              B08040
     E                    RKSQ      200  3 0                              B08040
     E                    DSPG      200  3                                B08040
     E                    DSPS      200  2 0                              B08040
     E                    VALG      200  3                                B08040
     E                    VLGS      200  2 0                              B08040
     E**********          ZLI        20  1                                                    CGL029
     E                    ZLI        26  1                                                    CGL029
     E*
     E                    CPY@    1   1 80
     E*
     E** FORMAT SE DETAILS FOR OUTPUT  (SR/ZFRELN)
     E*
     E** POWER ARRAY DEFINITION
     E                    POWER   1   7  7 3             POWER ARRAY
     E** ARRAY DEFINITION FOR SR/ZFFFLN
0120 E                    ZMNM   12  12  3               SR/ZFFFLN
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYS71062
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYS71062
     E*
     E**********          TABDY   7   7  1   TABNO   1 0           S71062 CPM003
      /COPY ZSRSRC,FFDATEZ1                                               CPM003
     E*                                                                   S71062
     E****ARRAY*FOR*SR*FFDATE**************************************S71062 CPM003
     E***********         HCCY       25  3                         S71062 CPM003
     E****ZDATE3*S/R*ARRAR*FOR*HOLIDAYS****************************S71062 CPM003
     E***********                                                  S71062 CPM003
     E***********         ZHC        50  3                         S71062 CPM003
     E***CURRENCY*ARRAY*READING*FROM*THE*2*HOLIDAY*RECORDS*********S71062 CPM003
      /COPY ZSRSRC,ZHOLE                                                  CPM003
     E*                                                                   S71062
     I*****************************************************************
     IINTYPDF                                                             CPM003
     I              CTAM                            FFCTAM                CPM003
     I              CNTT                            FFCNTT                CPM003
     I***TABLETJF***                                               S71062 CPM003
     I***********      HCCY                            HOLC        S71062 CPM003
     I**** Rename of holiday currencies array on Holidays file     S71062 CPM003
     I/COPY ZSRSRC,ZHOLI                                                  CPM003
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I**  FFPRIC ( FILE  FORMAT OF PRICE )
     I            DS
     I***********                             1  11 FFFP                  CFF004
     I***********                             1  117FFPRIC                CFF004
     I***********                             1   40FFINTG                CFF004
     I***********                             1   4 FFIN                  CFF004
     I***********                             5   50FFDCN1                CFF004
     I***********                             5   60FFDCN2                CFF004
     I***********                             5   70FFDCN3                CFF004
     I***********                             5   70FFDECN                CFF004
     I***********                             5  110FFOSTE                CFF004
     I***********                             5  11 FFDECA                CFF004
     I                                        1  15 FFFP                  CFF004
     I                                        1  158FFPRIC                CFF004
     I                                        1   70FFINTG                CFF004
     I                                        1   7 FFIN                  CFF004
     I                                        8   80FFDCN1                CFF004
     I                                        8   90FFDCN2                CFF004
     I                                        8  100FFDCN3                CFF004
     I                                        8  100FFDECN                CFF004
     I                                        8  150FFOSTE                CFF004
     I                                        8  150FFDECD                                    241147
     I                                        8  15 FFDECA                CFF004
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     IPSDS       SDS
     I                                      244 246 WSID
     I                                      254 263 USIDXX
     I*                                                                   S01313
     IPMSTAT    E DS                                                      S01313
     I                                        1   50WWECD                 S01313
     I                                        1 256 WWSTAT                S01313
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA********UDS                            256                    CPM003
     I***********                           132 183 DBLOT                 CPM003
     I***********                           132 141 DBFILE                CPM003
     ILDA         DS                            256                       CPM003
     I                                      134 183 DBLOT                 CPM003
     I                                      134 141 DBFILE                CPM003
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I**   DATA STRUCTURE FOR SR. FFDATE TO DEFINE WORK FIELDS            S71062
     I*                                                                   S71062
     I/COPY ZSRSRC,FFDATEZ2                                               CPM003
     I/COPY ZSRSRC,ZYLDZ1                                                 CPM003
     I***FFDATC******DS                                            S71062 CPM003
     I***************                         1   1 FFAA           S71062 CPM003
     I***************                         1   2 FFAB           S71062 CPM003
     I***************                         2   2 FFB            S71062 CPM003
     I***************                         3   3 FFC            S71062 CPM003
     I***************                         4   5 FFDEA          S71062 CPM003
     I***************                         4   6 FFDEF          S71062 CPM003
     I***************                         6   6 FFF            S71062 CPM003
     I***************                         7   7 FFG            S71062 CPM003
     I            DS                                                      S71062
     I                                        1   5 ISTT                  S71062
     I                                        1   2 MRKT                  S71062
     I************DS                                               S71062 CPM003
     I************                            1  75 HOLC           S71062 CPM003
     I************                            1  75 HCCY           S71062 CPM003
     I**Data*structure*to load up holiday currency array           S71062 CPM003
      *                                                                   CPM005
      **  DS to write position sequencing for processing type 1,3,4,6     CPM005
      *                                                                   CPM005
     I            DS                                                      CPM005
     I                                        1  11 WWPOSQ                CPM005
     I                                        1   3 WWCCY1                CPM005
     I                                        4   80WWDATE                CPM005
      *                                                                   CPM005
      **  DS to write position sequencing for processing type 2,5         CPM005
      *                                                                   CPM005
     I            DS                                                      CPM005
     I                                        1  11 WXPOSQ                CPM005
     I                                        1   30WXDSEQ                CPM005
     I                                        4   80WXDATE                CPM005
     I                                        9  11 WXCCY2                CPM005
     ISDBANK    E DSSDBANKPD                                              CPM003
     I**  Midas  Bank details                                             CPM003
     ISDCURR    E DSSDCURRPD                                              CPM003
     I**  Midas  Currencies details                                       CPM003
     ISDPLIN    E DSSDPLINPD                                              CPM003
     I**  Midas  Instrument details                                       CPM003
     ISDPLCS    E DSSDPLCSPD                                              CPM003
     I**  Midas  Portfolio customers                                      CPM003
     ISDCUST    E DSSDCUSTPD                                              CPM003
     I**  Midas  Customers details                                        CPM003
     ISDPORT    E DSSDPORTPD                                              CPM003
     I**  Midas  Portfolio ICD                                            CPM003
     IDSFDY     E DSDSFDY                                                 CPM003
     I**  Short data structure                                            CPM003
     I*                                                                   CPM003
     IDSSDY     E DSDSSDY                                                 CPM003
     I**  Long data structure                                             CPM003
     I/COPY WNCPYSRC,PM1142I001
     I*                                                                   CPB001
     IDSLDY     E DSDSLDY                                                 CPB001
     I**  Very Long data structure                                        CPB001
     I*                                                                   CPB001
     ISDMMOD    E DSSDMMODPD                                              CPB001
     I**  Module Details Accesses Via Access Program                      CPB001
     I*                                                                   CPB001
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * INIT     - INITIAL PROCESSING                                    *
      * FULX     - FULL EXTRACT                                          *
      * CRGX     - CHARGING EXTRACT                                      *
      * VALX     - VALUATION EXTRACT                                     *
      * P01      - ACCESS INSTRUMENT DETAILS                             *
      * P02      - ACCESS MARKET PRICE                                   *
      * P03      - ACCESS CUSTOMER DETAILS                               *
      * P04      - ACCESS PORTFOLIO DETAILS                              *
      * P05      - FORMAT & OUTPUT DETAILS TO PORTF. HOLDINGS FILE       *
      * P06      - AUDIT PROCESSING                                      *
      * W01      - WRITE TO PORTFOLIO HOLDINGS                           *
      * W02      - WRITE TO PORTFOLIO HOLDINGS AUDIT                     *
      * W03      - WRITE TO PORTF. HOLDINGS UPDATE (FF) AUDIT REPORT     *
      * W04      - Write to Portfolio Event Currency                  *   CPM005
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER        *
      * ZCCYXR   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER        *
      * ZFFFLN   - FORMAT THE 20A PORTF. MANAGEMENT LINE DESCRIPTION     *
      * FFPLCL   - CALCULATE PROFIT OR LOSS FOR A GIVEN CONTRACT NUM.    *
      * FFTVCL   - CALCULATE TRANSACTION VALUE FOR A GIVEN CONTRACT #    *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      *                                                                  *
      ********************************************************************
     C**************************************************************************
      /EJECT
     C*****************************************************************
     C** KEY DEFINITION
     C*****************************************************************
     C*
     C           KPORT     KLIST
     C                     KFLD           KKCUSC
     C                     KFLD           KKPTFR
     C*
     C***********KPORQ2    KLIST                                          CPM003
     C***********          KFLD           PNCNUM                          CPM003
     C***********          KFLD           PNPTFR                          CPM003
     C*
     C***********KCHRQ1    KLIST                                          CPM003
     C***********          KFLD           POCNUM                          CPM003
     C***********          KFLD           POPTFR                          CPM003
     C*
     C           KPRI      KLIST
     C                     KFLD           ISTT
     C                     KFLD           YRNO
     C                     KFLD           MTHN
     C                     KFLD           PCAL
     C                     KFLD           STRP
     C*                                                                   077485
     C           KTRS9     KLIST                                          077485
     C                     KFLD           KTRSD   50                      077485
     C                     KFLD           KTNBR   60                      077485
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** MAIN PROCESSING
     C*****************************************************************
     C*
     C           *ENTRY    PLIST
     C                     PARM           MODE    1
     C                     PARM           WWTVPS  1                       B08040
     C                     PARM           WWMHEX  1                       077485
     C*
     C                     EXSR INIT
     C*
     C** IF MODE PARAMETER IS 'F' (FOR FULL EXTRACT) EXECUTE PROCESS
     C** FULX
     C           MODE      IFEQ 'F'
     C                     EXSR FULX
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C***OTHERWISE,*IF*THE*MODE*PARAMETER*IS*'C'*(FOR*CHARGING*EXTRACT)***CPM003
     C***EXECUTE*PROCESS*CRGX*********************************************CPM003
     C***********MODE      IFEQ 'C'                                       CPM003
     C***********          EXSR CRGX                                      CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C***OTHERWISE*(VALUATION*EXTRACT)*EXECUTE*PROCESS*VALX***************CPM003
     C***********          EXSR VALX                                      CPM003
     C***********          END                                            CPM003
     C                     END
     C*
     C** EXECUTE PROCESS P06 - AUDIT PROCESSING
     C                     EXSR P06
     C                     SETON                     LR
     C*
     C*****************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INIT     - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           INIT      BEGSR                           ** INIT  BSR **
     C*
      ***  Copyright Statement.                                           CPM003
     C                     MOVEACPY@      ACT@   80                       CPM003
     C** PREPARE LDA
     C           *NAMVAR   DEFN           LDA                             CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM1142'  DBPGM
     C                     OUT  LDA                                       CPM003
     C                     Z-ADD0         QFNMDP                          072242
     C                     MOVE 'U'       QFSPBS                          072242
     C*                                                                   S01313
     C** DEFINE DATA AREA PMSTAT                                          S01313
     C           *NAMVAR   DEFN           PMSTAT                          S01313
     C                     IN   PMSTAT                                    S01313
     C                     Z-ADDWWECD     QFDXTR                          S01313
     C*
     C** GET INSTALLATION CONTROL DATA RECORD 1
     C***********          READ SDBANKL1                 71               CPM003
     C************IN71     IFEQ '1'                                       CPM003
     C***ERROR************************************************************CPM003
     C***********          Z-ADD1         DBASE            **DB ERROR 01**CPM003
     C***********          MOVEL'SDBANKL1'DBFILE           ***************CPM003
     C***********          MOVEL*BLANKS   DBKEY                           CPM003
     C*                                                                   CPM003
     C**  Access bank details                                             CPM003
     C*                                                                   CPM003
     C                     CALL 'AOBANKR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD  7                       CPM003
     C                     PARM '*FIRST'  P@OPTN  7                       CPM003
     C           SDBANK    PARM SDBANK    DSFDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                                   CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD1         DBASE            ***************CPM003
     C                     MOVE 'SDBANKPD'DBFILE           *DB ERROR 001 *CPM003
     C                     MOVEL'*FIRST'  DBKEY            ***************CPM003
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END
     C*                                                                   S71062
     C**   DETERMINE DATE FORMAT                                          S71062
     C           BJDFIN    IFEQ 'M'                                       S71062
     C                     MOVE '1'       *IN98                           S71062
     C                     END                                            S71062
     C*                                                                   CPB001
     C**  Access Module Details                                           CPB001
     C*                                                                   CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM *BLANKS   P@RTCD                          CPB001
     C                     PARM '*FIRST'  P@OPTN                          CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
     C*                                                                   CPB001
     C           P@RTCD    IFNE *BLANKS                                   CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD5         DBASE            ***************CPB001
     C                     MOVE 'SDMMODPD'DBFILE           *DB ERROR 005 *CPB001
     C                     MOVEL'*FIRST'  DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   R05669
     C** GET PORTFOLIO MANAGEMENT INSTALLATION CONTROL DATA RECORD        R05669
     C***********          READ SDPORTPD                 71               B08040
     C***********1         SETLLSDPORTPD                           B08040 CPM003
     C***********          READ SDPORTPD          71               B08040 CPM003
     C************IN71     IFEQ '1'                 ***************R05669 CPM003
     C***********          Z-ADD21        DBASE     **DB ERROR 21**R05669 CPM003
     C***********          MOVEL'SDPORTPD'DBFILE    ***************R05669 CPM003
     C***********          MOVEL*BLANKS   DBKEY                    R05669 CPM003
     C/COPY WNCPYSRC,PM1142C001
     C*                                                                   CPM003
     C**  Access Portfolio Management ICD                                 CPM003
     C*                                                                   CPM003
     C                     CALL 'AOPORTR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*FIRST'  P@OPTN                          CPM003
     C           SDPORT    PARM SDPORT    DSFDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                                   CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD2         DBASE            ***************CPM003
     C                     MOVE 'SDPORTPD'DBFILE           *DB ERROR   2 *CPM003
     C                     MOVEL'*FIRST'  DBKEY            ***************CPM003
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     R05669
     C                     END                                            R05669
     C*                                                                   R05669
     C***********          MOVE P9CNCD    QFCNTR                  R05669  CPM003
     C***********          MOVE P9LICD    QFLIND                  R05669  CPM003
     C                     MOVE FCCNCD    QFCNTR                          CPM003
     C**********           MOVE FCLICD    QFLIND                                     CPM003 BUG23967
     C                     MOVE FCLICD    QFLOIC                                            BUG23967
     C*                                                                   B08040
     C*  READ THROUGH SDCURRL0 SETTING UP ARRAY OF CURRENCIES             B08040
     C***********          READ SDCURRL0                 72        B08040 CPM003
     C***********          Z-ADD1         B       30               B08040 CPM003
     C************IN72     DOWEQ'0'                                B08040 CPM003
     C***********          MOVE A6CYCD    CYCD,B                   B08040 CPM003
     C***********          Z-ADDA6SPRT    SPRT,B                   B08040 CPM003
     C***********          MOVE A6MDIN    MDIN,B                   B08040 CPM003
     C***********          Z-ADDA6NBDP    NBDP,B                   B08040 CPM003
     C***********          Z-ADDA6RKSQ    RKSQ,B                   B08040 CPM003
     C***********          ADD  1         B                        B08040 CPM003
     C***********          READ SDCURRL0                 72        B08040 CPM003
     C*                                                                   CPM003
     C**  Read the first Currency record                                  CPM003
     C*                                                                   CPM003
     C                     CALL 'AOCURRR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*FIRST'  P@OPTN                          CPM003
     C                     PARM           P@CYCD  3                       CPM003
     C           SDCURR    PARM SDCURR    DSSDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                                   CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD3         DBASE            ***************CPM003
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR   3 *CPM003
     C                     MOVEL'*FIRST'  DBKEY            ***************CPM003
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     CPM003
     C                     ENDIF                                          CPM003
     C*                                                                   CPM003
     C**  Set up array of currencies                                      CPM003
     C*                                                                   CPM003
     C                     Z-ADD1         B       30                      CPM003
     C           P@RTCD    DOWNE'*EOF'                                    CPM003
     C                     MOVE A6CYCD    CYCD,B                          CPM003
     C                     Z-ADDA6SPRT    SPRT,B                          CPM003
     C                     Z-ADDA6NBDP    NBDP,B                          CPM003
     C                     MOVE A6MDIN    MDIN,B                          CPM003
     C                     Z-ADDA6RKSQ    RKSQ,B                          CPM003
     C                     ADD  1         B                               CPM003
     C*                                                                   CPM003
     C**  Read the next record in currencies file                         CPM003
     C*                                                                   CPM003
     C                     CALL 'AOCURRR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*NEXT '  P@OPTN                          CPM003
     C                     PARM           P@CYCD  3                       CPM003
     C           SDCURR    PARM SDCURR    DSSDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                                   CPM003
     C           P@RTCD    ANDNE'*EOF'                                    CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD4         DBASE            ***************CPM003
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR   4 *CPM003
     C                     MOVEL'*NEXT '  DBKEY            ***************CPM003
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     CPM003
     C                     ENDIF                                          CPM003
     C*                                                                   CPM003
     C                     END                                            B08040
     C*                                                                   B08040
     C***READ*THROUGH*PMDSPGPP*SETTING*UP*ARRAY*OF*DISPLAY*GROUPS**B08040 CPM003
     C***********          READ PMDSPGPP                 72        B08040 CPM003
     C** READ THROUGH PMDSPGPD SETTING UP ARRAY OF DISPLAY GROUPS         CPM003
     C                     READ PMDSPGPD                 72               CPM003
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PADSPG    DSPG,B                          B08040
     C                     Z-ADDPADSPS    DSPS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMDSPGPP                 72        B08040 CPM003
     C                     READ PMDSPGPD                 72               CPM003
     C                     END                                            B08040
     C*                                                                   B08040
     C***READ*THROUGH*PMVLGHPP*SETTING*UP*ARRAY*OF*VALUATION*GROUPSB08040 CPM003
     C***********          READ PMVLGHPP                 72        B08040 CPM003
     C** READ THROUGH PMVLGHPD SETTING UP ARRAY OF VALUATION GROUPS       CPM003
     C                     READ PMVLGHPD                 72               CPM003
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PBVALG    VALG,B                          B08040
     C                     Z-ADDPBVLGS    VLGS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMVLGHPP                 72        B08040 CPM003
     C                     READ PMVLGHPD                 72               CPM003
     C                     END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD*HIVAL    QFOAMT                          B08040
     C*                                                                   B08040
     C           EINIT     ENDSR                           ** END INIT  **
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * P01      - ACCESS INSTRUMENT DETAILS                             *
      * P02      - ACCESS MARKET PRICE                                   *
      * P03      - ACCESS CUSTOMER DETAILS                               *
      * P04      - ACCESS PORTFOLIO DETAILS                              *
      * P05      - FORMAT & OUTPUT DETAILS TO PORTF. HOLDINGS FILE       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWISTT   - INSTRUMENT TYPE FROM PF/TRANSD                        *
      * WWYRNO   - YEAR NUMBER FROM PF/TRANSD                            *
      * WWMTHN   - MONTH NUMBER FROM PF/TRANSD                           *
      * WWPCAL   - OUT/CALL INDICATOR FROM PF/TRANSD                     *
      * WWSTRP   - STRIKE PRICE FROM PF/TRANSD                           *
      * WWCUSC   - CUSTOMER NUMBER FROM PF/TRANSD                        *
      * WWPTFR   - PORTFOLIO REFERENCE FROM PF/TRANSD                    *
      * WWTRTY   - TRANSACTION TYPE FROM PF/TRANSD                       *
      * WWTNBR   - TRANSACTION NUMBER FROM PF/TRANSD                     *
      * WWNOCO   - NUMBER OF OPEN CONTRACTS FROM PF/TRANSD               *
      * WWCOPR   - CONTRACT PRICE FROM PF/TRANSD                         *
      * WWISCY   - INSTRUMENT CURRENCY FROM PF/TRANSD                    *
      *                                                                  *
      ********************************************************************
     C           FULX      BEGSR                           ** FULX  BSR **
     C*
     C** READ FROM LF/TRANS2 (FF TRANSACTIONS BY INSTRUMENT TYPE)
     C                     READ TRANS2                   71
     C*                                                                   CPM003
     C**  Check if main file is empty                                     CPM003
     C*                                                                   CPM003
     C           *IN71     IFEQ '1'                                       CPM003
     C                     MOVE 'Y'       WEMPTY  1                       CPM003
     C                     ELSE                                           CPM003
     C                     MOVE *BLANK    WEMPTY                          CPM003
     C                     ENDIF                                          CPM003
     C           *IN71     DOWEQ'0'
     C*
     C** IF THE NUMBER OF OPEN CONTRACTS (CUSTOMER/BOOK) IS ZERO
     C** AND PROGRAM EXTRACTS LIVE POSITIONS (3RD PARAMETER IS 'L')       077485
     C** READ AGAIN FROM LF/TRANS2
     C           NOCO      IFNE 0
     C********** CUSC      ANDNE0                                                      072323 CSD027
     C           CUSC      ANDNE*BLANKS                                                       CSD027
     C           PTFR      ANDNE*BLANKS                                   079510
     C           NOCO      OREQ 0                                         077485
     C           WWMHEX    ANDEQ'M'                                       077485
     C********** CUSC      ANDNE0                                                      072323 CSD027
     C           CUSC      ANDNE*BLANKS                                                       CSD027
     C           PTFR      ANDNE*BLANKS                                   079510
     C*
     C** IF THIS IS THE FIRST RECORD PROCESSED OR THE INSTRUMENT
     C** TYPE ON THIS RECORD IS DIFFERENT FROM THE INSTRUMENT TYPE
     C** ON THE PREVIOUS RECORD, ACCESS INSTRUMENT DETAILS AS PER P01
     C           WWISTT    IFNE ISTT
     C                     EXSR P01
     C                     END
     C*
     C** IF THIS IS THE FIRST RECORD PROCESSED OR THE INSTRUMENT
     C** TYPE, YEAR NUMBER, MONTH NUMBER, PUT/CALL INDICATOR OR
     C** STRIKE PRICE ON THIS RECORD HAVE CHANGED FROM THOSE ON THE
     C** PREVIOUS RECORD, ACCESS THE CURRENT MARKET PRICE AS PER P02
     C           WWISTT    IFNE ISTT
     C           WWYRNO    ORNE YRNO
     C           WWMTHN    ORNE MTHN
     C           WWPCAL    ORNE PCAL
     C           WWSTRP    ORNE STRP
     C                     EXSR P02
     C                     END
     C*
     C** IF THIS IS THE FIRST RECORD PROCESSED OR THE CUSTOMER CODE
     C** ON THIS RECORD IS DIFFERENT FROM THE CUSTOMER CODE ON THE
     C** PREVIOUS RECORD, ACCESS CUSTOMER DETAILS FOR THE CUSTOMER
     C** NUMBER ON LF/TRANS2 AS PER P03
     C           WWCUSC    IFNE CUSC
     C                     MOVE CUSC      WCUSC   6
     C                     EXSR P03
     C                     END
     C*
     C** IF THIS IS THE FIRST RECORD PROCESSED AND PORTF. REFERENCE
     C** IS NOT '9997' OR THE CUSTOMER CODE OR PORTFOLIO REFERENCE
     C** ON THIS RECORD IS DIFFERENT FROM THE CUSTOMER AND PORTFOLIO
     C** REFERENCE ON THE PREVIOUS RECORD AND PORTFOLIO REFERENCE IS
     C** NOT EQUAL TO '9997', ACCESS PORTFOLIO DETAILS FOR THE
     C** CUSTOMER AND PORTFOLIO REFERENCE ON LF/TRANS2 AS PER P04
     C           WWCUSC    IFNE CUSC
     C           PTFR      ANDNE'9997'
     C           WWPTFR    ORNE PTFR
     C           PTFR      ANDNE'9997'
     C**********           Z-ADDCUSC      KKCUSC  60                                          CSD027
     C                     MOVE CUSC      KKCUSC  6                                           CSD027
     C                     MOVE PTFR      KKPTFR  4
     C                     EXSR P04
     C                     END
     C*
     C** SAVE SOME FIELDS FROM FILE TRANS2
     C*                                                                   S71062
     C** WHEN THE TRANSACTION IS ENTERED WITH NO BROKER (BOOK VS CUSTOMER)S71062
     C** THE PURCHASE OR SALE IS CONSIDERED FROM THE BANKS POINT OF VIEW. S71062
     C** SO, INVERSE THE 'P'/'S' CODES TO REFLECT THE CUSTOMER'S POINT OF S71062
     C** VIEW.                                                            S71062
     C********** BOCO      IFEQ *ZEROS                                                 S71062 CSD027
     C           BOCO      IFEQ *BLANKS                                                       CSD027
     C*                                                                   S71062
     C           TRTY      IFEQ 'P'                                       S71062
     C                     MOVEL'S'       WWTRTY                          S71062
     C                     ELSE                                           S71062
     C                     MOVEL'P'       WWTRTY                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** WHEN BROKER AND CUSTOMER ARE DEFINED ON THE TRADE, THE PURCHASE  S71062
     C** OR SALE IS CONSIDERED FROM THE CUSTOMER POINT OF VIEW            S71062
     C                     ELSE                                           S71062
     C                     MOVELTRTY      WWTRTY  1
     C                     END                                            S71062
     C*                                                                   S71062
     C                     Z-ADDYRNO      WWYRNO  20
     C                     Z-ADDMTHN      WWMTHN  20
     C                     Z-ADDTNBR      WWTNBR  60
     C**********           Z-ADDCUSC      WWCUSC  60                                          CSD027
     C                     MOVE CUSC      WWCUSC  6                                           CSD027
     C                     MOVELISTT      WWISTT  5
     C                     Z-ADDNOCO      WWNOCO  50
     C***********          Z-ADDCOPR      WWCOPR 117                      CFF004
     C           *LIKE     DEFN COPR      WWCOPR                          CFF004
     C                     Z-ADDCOPR      WWCOPR                          CFF004
     C                     MOVELISCY      WWISCY  3
     C                     MOVELPTFR      WWPTFR  4
     C                     MOVELPCAL      WWPCAL  1
     C***********          Z-ADDSTRP      WWSTRP 117                      CFF004
     C           *LIKE     DEFN STRP      WWSTRP                          CFF004
     C                     Z-ADDSTRP      WWSTRP                          CFF004
     C                     Z-ADDTRSD      WWTRSD  50                      S71062
     C                     Z-ADDNUCO      WWNUCO  50                      S71062
     C*
     C** FORMAT AND OUTPUT DETAILS TO THE PORTFOLIO HOLDINGS FILE
     C** AS PER P05
     C                     EXSR P05
     C                     END
     C*
     C** READ FROM LF/TRANS2
     C                     READ TRANS2                   71
     C                     END
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ************                                                        CPM003
      ********************************************************************CPM003
      ************                                                       *CPM003
      **CRGX*****-*CHARGING*EXTRACT***************************************CPM003
      ************                                                       *CPM003
      **SUBROUTINE*CALLS:*************************************************CPM003
      **P03******-*ACCESS*CUSTOMER*DETAILS********************************CPM003
      **P04******-*ACCESS*PORTFOLIO*DETAILS*******************************CPM003
      **P01******-*ACCESS*INSTRUMENT*DETAILS******************************CPM003
      **P02******-*ACCESS*MARKET*PRICE************************************CPM003
      **P05******-*FORMAT*&*OUTPUT*DETAILS*TO*PORTF.*HOLDINGS*FILE********CPM003
      ************                                                       *CPM003
      **SUBROUTINE*CALLED*FROM:*******************************************CPM003
      **MAIN*****-*MAIN*PROCESSING****************************************CPM003
      ************                                                       *CPM003
      **ROUTINE*USES*VARIABLES:*******************************************CPM003
      **WWCNUM***-*CUSTOMER*NUMBER*FROM*PF/PMCHRGQ1***********************CPM003
      **WWPTFR***-*PORTFOLIO*REFERENCE*FROM*PF/PMCHRGQ1*******************CPM003
      **WWPTCY***-*PORTFOLIO*CURRENCY*FROM*PF/PMPORTPP********************CPM003
      **WWPTCY***-*PORTFOLIO*CURRENCY*FROM*PF/PMPORTPD********************CPM003
      **WWISTT***-*INSTRUMENT*TYPE*FROM*PF/TRANSD*************************CPM003
      **WWYRNO***-*YEAR*NUMBER*FROM*PF/TRANSD*****************************CPM003
      **WWMTHN***-*MONTH*NUMBER*FROM*PF/TRANSD****************************CPM003
      **WWPCAL***-*OUT/CALL*INDICATOR*FROM PF/TRANSD**********************CPM003
      **WWSTRP***-*STRIKE*PRICE*FROM*PF/TRANSD****************************CPM003
      **WWTRTY***-*TRANSACTION*TYPE*FROM*PF/TRANSD************************CPM003
      **WWTNBR***-*TRANSACTION*NUMBER*FROM*PF/TRANSD**********************CPM003
      **WWCUSC***-*CUSTOMER*NUMBER*FROM*PF/TRANSD*************************CPM003
      **WWNOCO***-*NUMBER*OF*OPEN*CONTRACTS*******************************CPM003
      **WWCOPR***-*CONTRACT*PRICE*FROM*PF/TRANSD**************************CPM003
      **WWISCY***-*INSTRUMENT*CURRENCY*FROM PF/TRANSD*********************CPM003
      ************                                                       *CPM003
      ********************************************************************CPM003
     C***********CRGX      BEGSR                           ** CRGX  BSR **CPM003
     C************                                                        CPM003
     C***READ*FROM*LF/PMCHRGQ1*(PORTFOLIOS*DUE*FOR*CHARGING)**************CPM003
     C************         READ PMCHRGQ1                 71               CPM003
     C************                                                        CPM003
     C****Check*if*main*file*is*empty*************************************CPM003
     C************                                                        CPM003
     C************IN71     IFEQ '1'                                       CPM003
     C************         MOVE 'Y'       WEMPTY  1                       CPM003
     C************         ELSE                                           CPM003
     C************         MOVE *BLANK    WEMPTY                          CPM003
     C************         ENDIF                                          CPM003
     C************IN71     DOWEQ'0'                                       CPM003
     C************                                                        CPM003
     C***ON*CHANGE*OF*CUSTOMER********************************************CPM003
     C***ACCESS*CUSTOMER*DETAILS*FOR*THE*CUSTOMER*NUMBER*ON*LF/PMCHRGQ1***CPM003
     C***AS*PER*P03*******************************************************CPM003
     C***********WWCNUM    IFNE POCNUM                                    CPM003
     C************         MOVE POCNUM    WCUSC                           CPM003
     C************         EXSR P03                                       CPM003
     C************         END                                            CPM003
     C************                                                        CPM003
     C***ON*CHANGE*OF*CUSTOMER*OR*PORTFOLIO*******************************CPM003
     C***ACCESS*PORTFOLIO*DETAILS*FOR*THE*CUSTOMER*AND*PORTFOLIO**********CPM003
     C***REFERENCE*ON*LF/PMCHRGQ1*AS*PER*P04******************************CPM003
     C***********WWCNUM    IFNE POCNUM                                    CPM003
     C***********WWPTFR    ORNE POPTFR                                    CPM003
     C************         Z-ADDPOCNUM    KKCUSC                          CPM003
     C************         MOVE POPTFR    KKPTFR                          CPM003
     C************         EXSR P04                                       CPM003
     C************                                                        CPM003
     C***READ*EQUAL*FROM*LF/TRANSPT*(FF*TRANSACTIONS*BY*PORTFOLIO)********CPM003
     C***WITH*A*KEY*OF*CUSTOMER*AND*PORTFOLIO*REFERENCE*FROM**************CPM003
     C***LF/PMCHRGQ1******************************************************CPM003
     C***********KCHRQ1    SETLLTRANSPT                                   CPM003
     C***********KCHRQ1    READETRANSPT                  73               CPM003
     C************         MOVELPOCNUM    WWCNUM                          CPM003
     C************         MOVELPOPTFR    WWPTFR                          CPM003
     C************IN73     DOWEQ'0'                                       CPM003
     C************                                                        CPM003
     C***ON*CHANGE*OF*INSTRUMENT*TYPE*************************************CPM003
     C***ACCESS*INSTRUMENT*DETAILS*AS*PER*P01*****************************CPM003
     C***********WWISTT    IFNE ISTT                                      CPM003
     C************         EXSR P01                                       CPM003
     C************         END                                            CPM003
     C************                                                        CPM003
     C***ON*CHANGE*OF*THE*INSTRUMENT*TYPE,********************************CPM003
     C***YEAR*NUMBER,*MONTH*NUMBER,*PUT/CALL*INDICATOR*OR*****************CPM003
     C***STRIKE*PRICE,*ACCESS*THE*CURRENT*MARKET*PRICE*AS*PER*P02*********CPM003
     C***********WWISTT    IFNE ISTT                                      CPM003
     C***********WWYRNO    ORNE YRNO                                      CPM003
     C***********WWMTHN    ORNE MTHN                                      CPM003
     C***********WWPCAL    ORNE PCAL                                      CPM003
     C***********WWSTRP    ORNE STRP                                      CPM003
     C************         EXSR P02                                       CPM003
     C************         END                                            CPM003
     C************                                                        CPM003
     C***SAVE*SOME*FIELDS*FROM*FILE*TRANS2********************************CPM003
     C************                                                  S71062CPM003
     C***WHEN*THE*TRANSACTION*IS*ENTERED*WITH*NO*BROKER*(BOOK*VS*)**S71062CPM003
     C***THE*PURCHASE*OR*SALE*IS*CONSIDERED*FROM*THE*BANKS*POINT****S71062CPM003
     C***SO,*INVERSE*THE*'P'/'S'*CODES*TO*REFLECT*THE*CUSTOMER'S****S71062CPM003
     C***VIEW.******************************************************S71062CPM003
     C***********BOCO      IFEQ *ZEROS                              S71062CPM003
     C************                                                  S71062CPM003
     C***********TRTY      IFEQ 'P'                                 S71062CPM003
     C************         MOVEL'S'       WWTRTY                    S71062CPM003
     C************         ELSE                                     S71062CPM003
     C************         MOVEL'P'       WWTRTY                    S71062CPM003
     C************         END                                      S71062CPM003
     C************                                                  S71062CPM003
     C***WHEN*BROKER*AND*CUSTOMER*ARE*DEFINED*ON*THE*TRADE,*THE*PURCS71062CPM003
     C***OR*SALE*IS*CONSIDERED*FROM*THE*CUSTOMER*POINT*OF*VIEW******S71062CPM003
     C************         ELSE                                     S71062CPM003
     C************         MOVELTRTY      WWTRTY                          CPM003
     C************         END                                      S71062CPM003
     C************                                                  S71062CPM003
     C************         Z-ADDYRNO      WWYRNO                          CPM003
     C************         Z-ADDMTHN      WWMTHN                          CPM003
     C************         Z-ADDTNBR      WWTNBR                          CPM003
     C************         Z-ADDCUSC      WWCUSC                          CPM003
     C************         MOVELISTT      WWISTT                          CPM003
     C************         Z-ADDNOCO      WWNOCO                          CPM003
     C************         Z-ADDCOPR      WWCOPR                          CPM003
     C************         MOVELISCY      WWISCY                          CPM003
     C************         MOVELPCAL      WWPCAL                          CPM003
     C************         Z-ADDSTRP      WWSTRP                          CPM003
     C************         Z-ADDTRSD      WWTRSD                   S71062 CPM003
     C************         Z-ADDNUCO      WWNUCO                   S71062 CPM003
     C************                                                        CPM003
     C***IF*THE*NUMBER*OF*OPEN*CONTRACTS*(CUSTOMER/BOOK)*IS*NOT*ZERO******CPM003
     C***********NOCO      IFNE 0                                         CPM003
     C************                                                        CPM003
     C***FORMAT*AND*OUTPUT*DETAILS*TO*THE*PORTFOLIO*HOLDINGS*FILE*********CPM003
     C***AS*PER*P05                                                       CPM003
     C************         EXSR P05                                       CPM003
     C************         END                                            CPM003
     C************                                                        CPM003
     C***READ*EQUAL*FROM*LF/TRANSPT*(FF*TRANSACTIONS*BY*PORTFOLIO)********CPM003
     C***WITH*A*KEY*OF*THE*CUSTOMER*AND*PORTFOLIO*REFERENCE*FROM**********CPM003
     C***LF/PMCHRGQ1******************************************************CPM003
     C***********KCHRQ1    READETRANSPT                  73               CPM003
     C************         END                                            CPM003
     C************         END                                            CPM003
     C************                                                        CPM003
     C***READ*FROM*LF/PMCHRGQ1*(PORTFOLIOS*DUE*FOR*CHARGING)**************CPM003
     C************         READ PMCHRGQ1                 71               CPM003
     C************         END                                            CPM003
     C************                                                        CPM003
     C************         ENDSR                                          CPM003
     C************                                                        CPM003
      ********************************************************************CPM003
      **/EJECT****                                                        CPM003
      ********************************************************************CPM003
      ************                                                       *CPM003
      **VALX*****-*VALUATION*EXTRACT**************************************CPM003
      ************                                                       *CPM003
      **SUBROUTINE*CALLS:*************************************************CPM003
      **P03******-*ACCESS*CUSTOMER*DETAILS********************************CPM003
      ***PSSR****-*ERROR*SUBROUTINE***************************************CPM003
      **P01******-*ACCESS*INSTRUMENT*DETAILS******************************CPM003
      **P02******-*ACCESS*MARKET*PRICE************************************CPM003
      **P05******-*FORMAT*&*OUTPUT*DETAILS*TO*PORTF.*HOLDINGS*FILE********CPM003
      ************                                                       *CPM003
      **SUBROUTINE*CALLED*FROM:*******************************************CPM003
      **MAIN*****-*MAIN*PROCESSING****************************************CPM003
      ************                                                       *CPM003
      **ROUTINE*USES*VARIABLES:*******************************************CPM003
      **WWCNUM***-*CUSTOMER*NUMBER*FROM*PF/PMPORTQ2***********************CPM003
      **WWC9NP***-*SPOT*RATE*FOR*PORTFOLIO*CURRENCY***********************CPM003
      **WWA8SP***-*MULT./DIV.*INDICATOR*FOR*PORTFOLIO*CURRENCY************CPM003
      **WWDANP***-*DECIMAL*PLACES*FOR*PORTFOLIO*CURRENCY******************CPM003
      ***********                                                        *CPM003
      **WWPTCY***-*PORTFOLIO*CURRENCY*FROM*PF/PMPORTPP********************CPM003
      **WWPTCY***-*PORTFOLIO*CURRENCY*FROM*PF/PMPORTPD********************CPM003
      **WWPTFR***-*PORTFOLIO*REFERENCE*FROM*PF/PMPORTQ2*******************CPM003
      **WWISTT***-*INSTRUMENT*TYPE*FROM*PF/TRANSD*************************CPM003
      **WWYRNO***-*YEAR*NUMBER*FROM*PF/TRANSD*****************************CPM003
      **WWMTHN***-*MONTH*NUMBER*FROM*PF/TRANSD****************************CPM003
      **WWPCAL***-*OUT/CALL*INDICATOR*FROM*PF/TRANSD**********************CPM003
      **WWSTRP***-*STRIKE*PRICE*FROM*PF/TRANSD****************************CPM003
      **WWTRTY***-*TRANSACTION*TYPE*FROM*PF/TRANSD************************CPM003
      **WWTNBR***-*TRANSACTION*NUMBER*FROM*PF/TRANSD**********************CPM003
      **WWCUSC***-*CUSTOMER*NUMBER*FROM*PF/TRANSD*************************CPM003
      **WWNOCO***-*NUMBER*OF*OPEN*CONTRACTS*******************************CPM003
      **WWCOPR***-*CONTRACT*PRICE*FROM*PF/TRANSD**************************CPM003
      **WWISCY***-*INSTRUMENT*CURRENCY*FROM*PF/TRANSD*********************CPM003
      ***********                                                        *CPM003
      ********************************************************************CPM003
     C***********VALX      BEGSR                           ** VALX  BSR **CPM003
     C***********                                                         CPM003
     C***READ*FROM*LF/PMPORTQ2*(PORTFOLIOS*DUE*FOR*VALUATION)*************CPM003
     C***********          READ PMPORTQ2                 71               CPM003
     C***********                                                         CPM003
     C****Check*if*main*file*is*empty*************************************CPM003
     C***********                                                         CPM003
     C************IN71     IFEQ '1'                                       CPM003
     C***********          MOVE 'Y'       WEMPTY  1                       CPM003
     C***********          ELSE                                           CPM003
     C***********          MOVE *BLANK    WEMPTY                          CPM003
     C***********          ENDIF                                          CPM003
     C************IN71     DOWEQ'0'                                       CPM003
     C***********                                                         CPM003
     C***ON*CHANGE*OF*CUSTOMER********************************************CPM003
     C***ACCESS*CUSTOMER*DETAILS*FOR*THE*CUSTOMER*NUMBER*ON*LF/PMPORTQ2***CPM003
     C***AS*PER*P03*******************************************************CPM003
     C***********WWCNUM    IFNE PNCNUM                                    CPM003
     C************         MOVE PNCNUM    WCUSC                           CPM003
     C************         EXSR P03                                       CPM003
     C************         END                                            CPM003
     C************                                                        CPM003
     C***ACCESS*THE*SPOT*RATE*FOR*THE*PORTFOLIO*CURRENCY*FROM*************CPM003
     C***LF/SDCURRL0*USING*THE*PORTFOLIO*CURRENCY*ON*LF/PMPORTQ2**********CPM003
     C***********PNPTCY    CHAINSDCURRL0             72             B08040CPM003
     C************IN72     IFEQ '1'                                 B08040CPM003
     C****RROR****                                                  B08040CPM003
     C************         Z-ADD2         DBASE            **DB E2**B08040CPM003
     C************         MOVEL'SDCURRL0'DBFILE           *********B08040CPM003
     C************         MOVELPNPTCY    DBKEY                     B08040CPM003
     C************         EXSR *PSSR                               B08040CPM003
     C************         ELSE                                     B08040CPM003
     C************                                                  B08040CPM003
     C****ETRIEVE*THE SPOT RATE FOR THE PORTFOLIO CURRENCY          B08040CPM003
     C***********          Z-ADDA6SPRT    WWC9NP 138                B08040CPM003
     C****                                                                B08040
     C****ETRIEVE MULT/DIV.IN. FOR THE PORTFOLIO CURRENCY                 B08040
     C****                 MOVELA6MDIN    WWA8SP  1                       B08040
     C****                                                                B08040
     C****ETRIEVE PORTFOLIO CURRENCY DEC. PLACES                          B08040
     C****                 Z-ADDA6NBDP    WWDANP  10                      B08040
     C****                                                                B08040
     C****ORTFOLIO CURRENCY FROM PF/PMPORTPP                              B08040
     C****                 MOVELPNPTCY    WWPTCY  3                       B08040
     C****                 END                                            B08040
     C***********                                                  B08040 CPM003
     C***********          Z-ADD1         B                        B08040 CPM003
     C***********PNPTCY    LOKUPCYCD,B                   72        B08040 CPM003
     C***********                                                  B08040 CPM003
     C************IN72     IFEQ '0'                                B08040 CPM003
     C***********          Z-ADD2         DBASE    **DB ERROR 02**B08040  CPM003
     C***********          MOVEL'SDCURRL0'DBFILE                  B08040  CPM003
     C***********          MOVELPNPTCY    DBKEY                   B08040  CPM003
     C***********          EXSR *PSSR                             B08040  CPM003
     C***********          ELSE                                   B08040  CPM003
     C***********          Z-ADDSPRT,B    A6SPRT                  B08040  CPM003
     C***********          MOVE MDIN,B    A6MDIN                  B08040  CPM003
     C***********          Z-ADDNBDP,B    A6NBDP                  B08040  CPM003
     C***********          Z-ADDRKSQ,B    A6RKSQ                  B08040  CPM003
     C***********          Z-ADDA6SPRT    WWC9NP 138              B08040  CPM003
     C***********          MOVELA6MDIN    WWA8SP  1               B08040  CPM003
     C***********          Z-ADDA6NBDP    WWDANP  10              B08040  CPM003
     C***********          Z-ADDA6RKSQ    WWRKSP  30              B08040  CPM003
     C***********          MOVELPNPTCY    WWPTCY  3               B08040  CPM003
     C***********          END                                    B08040  CPM003
     C***********                                                         CPM003
     C***READ*EQUAL*FROM*LF/TRANSPT*(FF*TRANSACTIONS*BY*PORTFOLIO)********CPM003
     C***WITH*A*KEY*OF*CUSTOMER*AND*PORTFOLIO*REFERENCE*FROM**************CPM003
     C***LF/PMPORTQ2******************************************************CPM003
     C***********KPORQ2    SETLLTRANSPT                                   CPM003
     C***********KPORQ2    READETRANSPT                  73               CPM003
     C***********          MOVELPNCNUM    WWCNUM  60                      CPM003
     C***********          MOVELPNPTFR    WWPTFR                          CPM003
     C************IN73     DOWEQ'0'                                       CPM003
     C***********                                                         CPM003
     C***ON*CHANGE*OF*INSTRUMENT*TYPE*************************************CPM003
     C***ACCESS*INSTRUMENT*DETAILS*AS*PER*P01*****************************CPM003
     C***********WWISTT    IFNE ISTT                                      CPM003
     C***********          EXSR P01                                       CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***ON*CHANGE*OF*THE*INSTRUMENT*TYPE,********************************CPM003
     C***YEAR*NUMBER,*MONTH*NUMBER,*PUT/CALL*INDICATOR*OR*****************CPM003
     C***STRIKE*PRICE,*ACCESS*THE*CURRENT*MARKET*PRICE*AS*PER*P02*********CPM003
     C***********WWISTT    IFNE ISTT                                      CPM003
     C***********WWYRNO    ORNE YRNO                                      CPM003
     C***********WWMTHN    ORNE MTHN                                      CPM003
     C***********WWPCAL    ORNE PCAL                                      CPM003
     C***********WWSTRP    ORNE STRP                                      CPM003
     C***********          EXSR P02                                       CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***SAVE*SOME*FIELDS*FROM*FILE*TRANS2********************************CPM003
     C***********                                                  S71062 CPM003
     C***WHEN*THE*TRANSACTION*IS*ENTERED*WITH*NO*BROKER*(BOUSTOMER)S71062 CPM003
     C***THE*PURCHASE*OR*SALE*IS*CONSIDERED*FROM*THE*BANKS*F*VIEW.*S71062 CPM003
     C***SO,*INVERSE*THE*'P'/'S'*CODES*TO*REFLECT*THE*CUSTOOINT*OF*S71062 CPM003
     C***VIEW.*****************************************************S71062 CPM003
     C***********BOCO      IFEQ *ZEROS                             S71062 CPM003
     C***********                                                  S71062 CPM003
     C***********TRTY      IFEQ 'P'                                S71062 CPM003
     C***********          MOVEL'S'       WWTRTY                   S71062 CPM003
     C***********          ELSE                                    S71062 CPM003
     C***********          MOVEL'P'       WWTRTY                   S71062 CPM003
     C***********          END                                     S71062 CPM003
     C***********                                                  S71062 CPM003
     C***WHEN*BROKER*AND*CUSTOMER*ARE*DEFINED*ON*THE*TRADE,RCHASE**S71062 CPM003
     C***OR*SALE*IS*CONSIDERED*FROM*THE*CUSTOMER*POINT*OF*VIEW*****S71062 CPM003
     C***********          ELSE                                    S71062 CPM003
     C***********          MOVELTRTY      WWTRTY                          CPM003
     C***********          END                                     S71062 CPM003
     C***********                                                  S71062 CPM003
     C***********          Z-ADDYRNO      WWYRNO                          CPM003
     C***********          Z-ADDMTHN      WWMTHN                          CPM003
     C***********          Z-ADDTNBR      WWTNBR                          CPM003
     C***********          Z-ADDCUSC      WWCUSC                          CPM003
     C***********          MOVELISTT      WWISTT                          CPM003
     C***********          Z-ADDNOCO      WWNOCO                          CPM003
     C***********          Z-ADDCOPR      WWCOPR                          CPM003
     C***********          MOVELISCY      WWISCY                          CPM003
     C***********          MOVELPCAL      WWPCAL                          CPM003
     C***********          Z-ADDSTRP      WWSTRP                          CPM003
     C***********          Z-ADDTRSD      WWTRSD                   S71062 CPM003
     C***********          Z-ADDNUCO      WWNUCO                   S71062 CPM003
     C***********                                                         CPM003
     C***IF*THE*NUMBER*OF*OPEN*CONTRACTS*(CUSTOMER/BOOK)*IS*NOT*ZERO******CPM003
     C***********NOCO      IFNE 0                                         CPM003
     C***********                                                         CPM003
     C***FORMAT*AND*OUTPUT*DETAILS*TO*THE*PORTFOLIO*HOLDINGS*FILE*********CPM003
     C***AS*PER*P05*******************************************************CPM003
     C***********          EXSR P05                                       CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***READ*EQUAL*FROM*LF/TRANSPT*(FF*TRANSACTIONS*BY*PORTFOLIO)********CPM003
     C***WITH*A*KEY*OF*THE*CUSTOMER*AND*PORTFOLIO*REFERENCE*FROM**********CPM003
     C***LF/PMPORTQ2******************************************************CPM003
     C***********KPORQ2    READETRANSPT                  73               CPM003
     C***********          END                                            CPM003
     C************                                                        CPM003
     C***READ*FROM*LF/PMPORTQ2*(PORTFOLIOS*DUE*FOR*VALUATION)*************CPM003
     C***********          READ PMPORTQ2                 71               CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
      /EJECT
      ********************************************************************
      *                                                                  *
      * P01      - ACCESS INSTRUMENT DETAILS                             *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      **CRGX*****-*CHARGING*EXTRACT***************************************CPM003
      **VALX*****-*VALUATION*EXTRACT**************************************CPM003
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWISTN   - INSTRUMENT NAME FROM LF/INTYP                         *
      * WWTKDM   - TICKS DENOMINATOR FROM LF/INTYP                       *
      * WWMNPF   - MINIMUM PRICE FLUCTUATION FROM LF/INTYP               *
      * WWTKVL   - TICK VALUE FROM LF/INTYP                              *
      * WWINNR   - PM INSTRUMENT TYPE NARRATIVE FROM LF/INTYP            *
      * WWISCY   - INSTRUMENT CURRENCY FROM PF/TRANSD                    *
      * WWC9NI   - SPOT RATE FOR INSTRUMENT CURRENCY                     *
      * WWA8SI   - MULT./DIV. INDICATOR FOR INSTRUMENT CURRENCY          *
      * WWDANI   - DECIMAL PLACES FOR INSTRUMENT CURRENCY                *
      * WWVLIS   - VALUATION GROUP INSTRUMENT SEQUENCE FROM PF/SDPLINPD  *
      * WWITDS   - DISPLAY GROUP SEQUENCE FROM PF/SDPLINPD               *
      * WWDSPG   - DISPLAY GROUP FROM PF/SDPLINPD                        *
      * WWVALG   - VALUATION GROUP FROM PF/SDPLINPD                      *
      **WWDSPS***-*DISPLAY*GROUP*SEQUENCE*FROM*PF/PMDSPGPP****************CPM003
      **WWVLGS***-*VALUATION*GROUP*SEQUENCE*FROM*PF/PMVLGHPP**************CPM003
      * WWDSPS   - DISPLAY GROUP SEQUENCE FROM PF/PMDSPGPD               *
      * WWVLGS   - VALUATION GROUP SEQUENCE FROM PF/PMVLGHPD             *
      *                                                                  *
      ********************************************************************
     C           P01       BEGSR                           ** P01   BSR **
     C*
     C** ACCESS LF/INTYP - FF INSTRUMENT TYPES FOR PM INSTRUMENT TYPE,
     C** INSTRUMENT NAME, TICKS DENOMINATOR, MINIMUM PRICE FLUCTUATION
     C** AND TICK VALUE USING INSTRUMENT TYPE FROM PF/TRANSD AS KEY
     C           ISTT      CHAININTYP                72
     C           *IN72     IFEQ '1'
     C           RECI      OREQ '*'
     C           *LOCK     IN   LDA                                       CPM003
     C** ERROR
     C***********          Z-ADD3         DBASE            **DB ERROR 03**CPM003
     C                     Z-ADD6         DBASE            **DB ERROR 06**CPM003
     C***********          MOVEL'INTYP'   DBFILE           ***************CPM003
     C                     MOVE 'INTYP'   DBFILE           ***************CPM003
     C                     MOVELISTT      DBKEY
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     ELSE
      *                                                                   182961
      ** Instrument type is defaulted from PF/SDPORTPD if a blank         182961
      ** instrument type is found.                                        182961
      ** Indicator 35 was used as the operation's resulting indicator.    182961
      *                                                                   182961
     C           INNR      IFEQ *BLANKS                                   182961
     C           1         SETLLSDPORTPD                                  182961
     C                     READ SDPORTPD                 35               182961
     C                     MOVE FCDINR    INNR                            182961
     C                     ENDIF                                          182961
     C*
     C** SAME SOME FIELDS
     C                     MOVELISTN      WWISTN 20
     C                     Z-ADDTKDM      WWTKDM  30
     C***********          Z-ADDMNPF      WWMNPF 117                      CFF004
     C           *LIKE     DEFN MNPF      WWMNPF                          CFF004
     C                     Z-ADDMNPF      WWMNPF                          CFF004
     C                     Z-ADDTKVL      WWTKVL 145
     C                     MOVELINNR      WWINNR  3
     C                     MOVELAEIN      WWAEIN  1        Amer./Europ.   S71062
     C***********          Z-ADDCTAM      WWCTAM 130  Contingent AmtS71062CPM003
     C                     Z-ADDFFCTAM    WWCTAM 130       Contingent Amt CPM003
     C                     MOVELOTHC      WWOTHC  3        Other Currency S71062
     C           WWOTHC    IFNE *BLANKS                                   076371
     C                     Z-ADD1         B                               076371
     C           WWOTHC    LOKUPCYCD,B                   72               076371
     C*                                                                   076371
     C           *IN72     IFEQ '0'                                       076371
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD12        DBASE      **DB ERROR 02**076371CPM003
     C***********          MOVEL'SDCURRL0'DBFILE     ***************076371CPM003
     C                     Z-ADD7         DBASE            **DB ERROR 07**CPM003
     C                     MOVE 'SDCURRPD'DBFILE           ***************CPM003
     C                     MOVELWWOTHC    DBKEY                           076371
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     076371
     C                     ELSE                                           076371
     C                     Z-ADDNBDP,B    WWOTH1  10                      076371
     C                     END                                            076371
     C                     END                                            076371
     C*                                                                   S71062
     C** DETERMINE THE TYPE OF INSTRUMENT : FUTURE (1, 2 OR 3) OR OPTION  S71062
     C                     MOVE '0'       *IN50            Future/Option  S71062
     C                     MOVE '0'       *IN51            Up Front/At endS71062
     C                     MOVE '0'       *IN52            OTC            S71062
     C*                                                                   S71062
     C           ISPT      IFEQ 1                          B*2            S71062
     C           ISPT      OREQ 2                                         S71062
     C           ISPT      OREQ 3                                         S71062
     C           ISPT      OREQ 7                                         CPM003
     C                     MOVE '1'       *IN50            Future         S71062
     C                     ELSE                            X*2            S71062
     C*                                                                   S71062
     C** DETERMINE IF THE PREMIUM PAID UP FRONT/AT END (ONLY FOR OPTION)  S71062
     C           PUPF      IFEQ 'Y'                        B*3            S71062
     C                     MOVE '1'       *IN51            Paid Up front  S71062
     C                     END                             E*3            S71062
     C                     END                             E*2            S71062
     C*                                                                   S71062
     C** DETERMINE IF IT'S AN OTC INSTRUMENT                              S71062
     C           ISTI      IFEQ 'Y'                        B*2            S71062
     C                     MOVE '1'       *IN52            OTC            S71062
     C                     END                             E*2            S71062
     C                     END
     C*
     C** IF THE INSTRUMENT CURRENCY ON THIS INSTRUMENT IS DIFFERENT
     C** FROM THAT ON THE LAST INSTRUMENT PROCESSED
     C           ISCY      IFNE WWISCY
     C*
     C*  ACCESS LF/SDCURRL0 - CURRENCIES FOR CURRENCY DECIMAL PLACES,
     C** SPOT RATE AND MULTIPLY/DIVIDE INDICATOR USING INSTRUMENT
     C** CURRENCY FROM LF/INTYP AS KEY
     C****       ISCY      CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD4         DBASE            **DB ERROR 04**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELISCY      DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****ETRIEVE THE SPOT RATE FOR THE CURRENCY                          B08040
     C****                 Z-ADDA6SPRT    WWC9NI 138                      B08040
     C****                                                                B08040
     C****ETRIEVE MULT/DIV.IN. FOR THE CURRENCY                           B08040
     C****                 MOVELA6MDIN    WWA8SI  1                       B08040
     C****                                                                B08040
     C****ETRIEVE CURRENCY DEC. PLACES                                    B08040
     C****                 Z-ADDA6NBDP    WWDANI  10                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           ISCY      LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C***********          Z-ADD4         DBASE     **DB ERROR 04**B08040 CPM003
     C***********          MOVEL'SDCURRL0'DBFILE                   B08040 CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD7         DBASE            **DB ERROR 07**CPM003
     C                     MOVE 'SDCURRPD'DBFILE                          CPM003
     C                     MOVELISCY      DBKEY                           B08040
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWC9NI 138                      B08040
     C                     MOVELA6MDIN    WWA8SI  1                       B08040
     C                     Z-ADDA6NBDP    WWDANI  10                      B08040
     C                     Z-ADDA6RKSQ    WWRKSI  30                      B08040
     C                     END                                            B08040
     C                     END
     C*
     C** ACCESS PF/SDPLINPD - INSTRUMENT TYPES FOR INSTRUMENT TYPE
     C** SEQUENCE, DISPLAY GROUP AND VALUATION GROUP USING
     C** PM INSTRUMENT TYPE NARRATIVE FROM LF/INTYP AS KEY
     C***********INNR      CHAINSDPLINPD             72                   CPM003
     C************IN72     IFEQ '1'                                       CPM003
     C***********PDRECI    OREQ '*'                                       CPM003
     C***ERROR************************************************************CPM003
     C***********          Z-ADD5         DBASE            **DB ERROR 05**CPM003
     C***********          MOVEL'SDPLINPD'DBFILE           ***************CPM003
     C***********          MOVELINNR      DBKEY                           CPM003
     C*                                                                   CPM003
     C**  Access Instrument types details                                 CPM003
     C*                                                                   CPM003
     C                     CALL 'AOPLINR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*KEY  '  P@OPTN                          CPM003
     C                     PARM INNR      P@INNR  3                       CPM003
     C           SDPLIN    PARM SDPLIN    DSFDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                                   CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD8         DBASE            ***************CPM003
     C                     MOVE 'SDPLINPD'DBFILE           *DB ERROR 008 *CPM003
     C                     MOVEL*BLANKS   DBKEY            ***************CPM003
     C                     MOVELINNR      DBKEY                           CPM003
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     ELSE
     C*
     C** SAVE SOME FIELDS
     C                     Z-ADDPDVLIS    WWVLIS  20
     C                     Z-ADDPDITDS    WWITDS  20
     C                     MOVELPDDSPG    WWDSPG  3
     C                     MOVELPDVALG    WWVALG  3
     C                     END
     C*
     C***ACCESS*THE*DISPLAY*GROUP*DETAILS*FILE*PF/PMDSPGPP*USING**********CPM003
     C** ACCESS THE DISPLAY GROUP DETAILS FILE PF/PMDSPGPD USING
     C** THE DISPLAY GROUP FROM PF/SDPLINPD
     C****       PDDSPG    CHAINPMDSPGPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****       PARECI    OREQ '*'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD6         DBASE            **DB ERROR 06**B08040
     C****                 MOVEL'PMDSPGPP'DBFILE           ***************B08040
     C****                 MOVELPDDSPG    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****                 Z-ADDPADSPS    WWDSPS  20                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PDDSPG    LOKUPDSPG,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD6         DBASE     **DB ERROR 06**B08040 CPM003
     C***********          MOVEL'PMDSPGPP'DBFILE    ***************B08040 CPM003
     C                     Z-ADD9         DBASE            **DB ERROR 09**B08040
     C                     MOVE 'PMDSPGPD'DBFILE           ***************B08040
     C                     MOVELPDDSPG    DBKEY                           B08040
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDDSPS,B    WWDSPS  20                      B08040
     C                     Z-ADDDSPS,B    PADSPS                          B08040
     C                     END                                            B08040
     C*
     C***ACCESS*THE*VALUATION*GROUP*HEADINGS*FILE*PF/PMVLGHPP*************CPM003
     C** ACCESS THE VALUATION GROUP HEADINGS FILE PF/PMVLGHPD             CPM003
     C** USING THE VALUATION GROUP FROM PF/SDPLINPD
     C****       PDVALG    CHAINPMVLGHPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****       PBRECI    OREQ '*'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD7         DBASE            **DB ERROR 07**B08040
     C****                 MOVEL'PMVLGHPP'DBFILE           ***************B08040
     C****                 MOVELPDVALG    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****                 Z-ADDPBVLGS    WWVLGS  20                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PDVALG    LOKUPVALG,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD7         DBASE     **DB ERROR 07**B08040 CPM003
     C***********          MOVEL'PMVLGHPP'DBFILE    ***************B08040 CPM003
     C                     Z-ADD10        DBASE            **DB ERROR 07**CPM003
     C                     MOVE 'PMVLGHPD'DBFILE           ***************CPM003
     C                     MOVELPDVALG    DBKEY                           B08040
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDVLGS,B    PBVLGS                          B08040
     C                     Z-ADDPBVLGS    WWVLGS  20                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P02      - ACCESS MARKET PRICE                                   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      ***********                                                        *CPM003
      **CRGX*****-*CHARGING*EXTRACT***************************************CPM003
      **VALX*****-*VALUATION*EXTRACT**************************************CPM003
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      **WWPLEC***-*MARKET*PRICE*FROM*LF/PRICS                            *S71062
      * WWPLEC   - MARKET PRICE FROM LF/PRICS1                           *S71062
      *                                                                  *
      ********************************************************************
     C           P02       BEGSR                           *** P02    ***
     C*
     C*******ACCESS LF/PRICS - MARKET PRICES FOR LAST END OF CENTRE PRICE S71062
     C** ACCESS LF/PRICS1 - MARKET PRICES FOR LAST END OF CENTRE PRICE    S71062
     C** USING INSTRUMENT TYPE, YEAR NUMBER, MONTH NUMBER, PUT/CALL
     C** INDICATOR AND STRIKE PRICE FROM PF/TRANSD AS KEY
     C***********KPRI      CHAINPRICS                72                   S71062
     C           KPRI      CHAINPRICS1               72                   S71062
     C           *IN72     IFEQ '1'
     C           RECI      OREQ '*'
     C***********          Z-ADD0         WWPLEC 158                      CFF004
     C           *LIKE     DEFN PLEC      WWPLEC                          CFF004
     C                     Z-ADD0         WWPLEC                          CFF004
     C                     ELSE
     C                     Z-ADDPLEC      WWPLEC
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P03      - ACCESS CUSTOMER DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      **CRGX*****-*CHARGING*EXTRACT***************************************CPM003
      **VALX*****-*VALUATION*EXTRACT**************************************CPM003
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAVCD   - ACCOUNT OFFICER CODE FROM LF/SDPLCSL0                 *
      *                                                                  *
      ********************************************************************
     C           P03       BEGSR                           *** P03    ***
     C*
     C***ACCESS*CUSTOMER*DETAILS*FROM*LF/SDPLCSL0*USING*A*KEY*OF*THE******CPM003
     C** ACCESS CUSTOMER DETAILS FROM PF/SDPLCSPD USING A KEY OF THE      CPM003
     C** CUSTOMER NUMBER PASSED TO THIS PROCESS
     C***********WCUSC     CHAINSDPLCSL0*            72                   CPM003
     C************IN72     IFEQ '1'                                       CPM003
     C***ERROR************************************************************CPM003
     C***********          Z-ADD8         DBASE            **DB ERROR 08**CPM003
     C***********          MOVEL'SDPLCSL0'DBFILE           ***************CPM003
     C***********          MOVELWCUSC     DBKEY                           CPM003
     C*                                                                   CPM003
     C**  Access Portfolio Management Customer details                    CPM003
     C*                                                                   CPM003
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOPLCSR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*KEY  '  P@OPTN                          CPM003
     C                     PARM WCUSC     P@CUST 10                       CPM003
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                    *1             CPM003
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD11        DBASE            ***************CPM003
     C                     MOVE 'SDPLCSPD'DBFILE           *DB ERROR  11 *CPM003
     C                     MOVELP@CUST    DBKEY                           CPM003
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C**********           ELSE                            x1             CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPM003
     C**  Access Customer details                                         CPM003
     C*                                                                   CPM003
     C**********           CALL 'AOCUSTR0'                         CPM003 CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*KEY  '  P@OPTN                          CPM003
     C                     PARM WCUSC     P@CUST 10                       CPM003
     C                     PARM           P@KYST  7                       CPM003
     C********** SDCUST    PARM SDCUST    DSFDY                    CPM003 CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                    B2             CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD12        DBASE            ***************CPM003
     C                     MOVE 'SDCUSTPD'DBFILE           *DB ERROR  12 *CPM003
     C                     MOVELP@CUST    DBKEY                           CPM003
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     CPM003
     C**********           ELSE                            X2      CPM003 CPB001
     C                     ENDIF                                          CPB001
     C*
     C** SAVE SOME FIELDS
     C                     MOVELBBACOC    WWACOC  2
     C*                                                                   CPB001
     C** Default Base Currency if Private banking Module is active        CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C**********           Z-ADDCUSC      KKCUSC  60                                   CPB001 CSD027
     C                     MOVE CUSC      KKCUSC  6                                           CSD027
     C                     MOVE PTFR      KKPTFR  4                       CPB001
     C           KPORT     CHAINPMPORTPD             72                   CPB001
     C*                                                                   CPB001
     C           *IN72     IFEQ *ON                                       CPB001
     C           PNRECI    OREQ '*'                                       CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD36        DBASE            **DB ERROR 36**CPB001
     C                     MOVE 'PMPORTPD'DBFILE                          CPB001
     C                     MOVELCUSC      DBKEY     P                     CPB001
     C                     MOVE PTFR      DBKEY                           CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C                     MOVELPNPTCY    QBCSBY                          CPB001
     C                     Z-ADDPNPCDP    QBBYDP                          CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
     C*
     C** DETERMINE CUSTOMER BASE CURRENCY DETAILS
     C                     Z-ADD1         B                               B08040
     C           QBCSBY    LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                        B3             B08040
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD10        DBASE     **DB ERROR 10**B08040 CPM003
     C***********          MOVEL'SDCURRL0'DBFILE                   B08040 CPM003
     C                     Z-ADD12        DBASE            **DB ERROR 12**CPM003
     C                     MOVE 'SDCURRPD'DBFILE                          CPM003
     C                     MOVELQBCSBY    DBKEY                           B08040
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                            X3             B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWC9NC 138                      B08040
     C                     MOVELA6MDIN    WWA8SC  1                       B08040
     C                     Z-ADDA6NBDP    WWDANC  10                      B08040
     C                     Z-ADDA6RKSQ    WWRKSC  30                      B08040
     C                     END                             E3             B08040
     C**********           END                             E2             CPB001
     C**********           END                             E1             CPB001
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P04      - ACCESS PORTFOLIO DETAILS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      **CRGX*****-*CHARGING*EXTRACT***************************************CPM003
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWC9NP   - SPOT RATE FOR PORTFOLIO CURRENCY                      *
      * WWA8SP   - MULT./DIV. INDICATOR FOR PORTFOLIO CURRENCY           *
      * WWDANP   - DECIMAL PLACES FOR PORTFOLIO CURRENCY                 *
      **WWPTCY***-*PORTFOLIO*CURRENCY*FROM*PF/PMPORTPP********************CPM003
      * WWPTCY   - PORTFOLIO CURRENCY FROM PF/PMPORTPD                   *CPM003
      *                                                                  *
      ********************************************************************
     C           P04       BEGSR                           *** P04    ***
     C*
     C***ACCESS*PF/PMPORTPP*-*PORTFOLIO*DEFINITION*DETAILS*FOR PORTF.*****CPM003
     C** ACCESS PF/PMPORTPD - PORTFOLIO DEFINITION DETAILS FOR PORTF.     CPM003
     C** CURRENCY USING CUSTOMER CODE AND PORTFOLIO REFERENCE FROM
     C** TRANS2 AS KEY
     C***********KPORT     CHAINPMPORTPP             72                   CPM003
     C           KPORT     CHAINPMPORTPD             72                   CPM003
     C           *IN72     IFEQ '1'
     C           PNRECI    OREQ '*'
     C           *LOCK     IN   LDA                                       CPM003
     C** ERROR
     C***********          MOVEL'PMPORTPP'DBFILE           ***************CPM003
     C***********          Z-ADD9         DBASE            ***************CPM003
     C                     Z-ADD13        DBASE            **DB ERROR 13**CPM003
     C                     MOVE 'PMPORTPD'DBFILE           ***************CPM003
     C                     MOVELKKCUSC    DBKY10 10
     C                     MOVE KKPTFR    DBKY10
     C                     MOVELDBKY10    DBKEY
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END
     C*
     C** ACCESS THE SPOT RATE FOR THE PORTFOLIO CURRENCY FROM
     C***LF/SDCURRL0*USING*THE*PORTFOLIO*CURRENCY*ON*PF/PMPORTPP**********CPM003
     C*  LF/SDCURRL0 USING THE PORTFOLIO CURRENCY ON PF/PMPORTPD          CPM003
     C****       PNPTCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD10        DBASE            **DB ERROR 10**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELPNPTCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                 Z-ADDA6SPRT    WWC9NP 138                      B08040
     C****                 MOVELA6MDIN    WWA8SP  1                       B08040
     C****                 Z-ADDA6NBDP    WWDANP  10                      B08040
     C****                 MOVELPNPTCY    WWPTCY  3                       B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PNPTCY    LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD10        DBASE     **DB ERROR 10**B08040 CPM003
     C***********          MOVEL'SDCURRL0'DBFILE                   B08040 CPM003
     C                     Z-ADD14        DBASE            **DB ERROR 14**CPM003
     C                     MOVE 'SDCURRPD'DBFILE                          CPM003
     C                     MOVELPNPTCY    DBKEY                           B08040
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWC9NP 138                      B08040
     C                     MOVELA6MDIN    WWA8SP  1                       B08040
     C                     Z-ADDA6NBDP    WWDANP  10                      B08040
     C                     Z-ADDA6RKSQ    WWRKSP  30                      B08040
     C****                 MOVELPNPTCY    WWPTCY  3                       B08040
     C                     MOVELPNPTCY    WWPTCY  3                       S71062
     C                     END                                            B08040
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P05      - FORMAT & OUTPUT DETAILS TO PORTF. HOLDINGS FILE       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZFFFLN   - FORMAT THE 20A PORTF. MANAGEMENT LINE DESCRIPTION     *
      * FFPLCL   - CALCULATE PROFIT OR LOSS FOR A GIVEN CONTRACT NUM.    *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER        *
      * W01      - WRITE TO PORTFOLIO HOLDINGS                           *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      **CRGX*****-*CHARGING*EXTRACT***************************************CPM003
      **VALX*****-*VALUATION*EXTRACT**************************************CPM003
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWISCY   - INSTRUMENT CURRENCY FROM PF/TRANSD                    *
      * WWMTHN   - MONTH NUMBER FROM PF/TRANSD                           *
      * WWYRNO   - YEAR NUMBER FROM PF/TRANSD                            *
      * WWPCAL   - OUT/CALL INDICATOR FROM PF/TRANSD                     *
      * WWSTRP   - STRIKE PRICE FROM PF/TRANSD                           *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS NARRATIVE                  *
      * WWTRTY   - TRANSACTION TYPE FROM PF/TRANSD                       *
      * WWAMT1   - NUMBER OF OPEN CONTRACTS CUSTOMER/BOOK                *
      * WWPTFR   - PORTFOLIO REFERENCE FROM PF/TRANSD                    *
      * WWPLEC   - MARKET PRICE FROM LF/PRICS                            *
      * WWPLMK   - PROFIT/LOSS MARKET                                    *
      * WWNOCO   - NUMBER OF OPEN CONTRACTS                              *
      * WWCOPR   - CONTRACT PRICE FROM PF/TRANSD                         *
      * WWTKDM   - TICKS DENOMINATOR FROM LF/INTYP                       *
      * WWMNPF   - MINIMUM PRICE FLUCTUATION FROM LF/INTYP               *
      * WWTKVL   - TICK VALUE FROM LF/INTYP                              *
      **WWPTCY***-*PORTFOLIO*CURRENCY*FROM*PF/PMPORTPP********************CPM003
      * WWPTCY   - PORTFOLIO CURRENCY FROM PF/PMPORTPD                   *CPM003
      * WWC9NI   - SPOT RATE FOR INSTRUMENT CURRENCY                     *
      * WWC9NP   - SPOT RATE FOR PORTFOLIO CURRENCY                      *
      * WWA8SI   - MULT./DIV. INDICATOR FOR INSTRUMENT CURRENCY          *
      * WWA8SP   - MULT./DIV. INDICATOR FOR PORTFOLIO CURRENCY           *
      * WWDANI   - DECIMAL PLACES FOR INSTRUMENT CURRENCY                *
      * WWDANP   - DECIMAL PLACES FOR PORTFOLIO CURRENCY                 *
      *                                                                  *
      ********************************************************************
     C           P05       BEGSR                           *** P05    ***
     C*
     C** DETERMINE THE INSTRUMENT ENQUIRY DETAILS NARRATIVE USING THE
     C** STANDARD SUBROUTINE ZFFFLN WITH THE FOLLOWING INPUT PARM.:
     C***ZISCY:*INSTRUMENT*CURRENCY                                       S71062
     C** ZISCY: CONTINGENT CURRENCY                                       S71062
     C** ZMTHN: MONTH NUMBER
     C** ZYRNO: YEAR NUMBER
     C** ZPCAL: PUT/CALL
     C** ZSTRP: STRIKE PRICE  =>  ALL FROM PF/TRANSD
     C*********************MOVELWWISCY    ZISCY                           S71062
     C           WWOTHC    IFNE *BLANKS                                   076371
     C                     MOVELWWOTHC    ZISCY                           S71062
     C                     ELSE                                           076371
     C                     MOVELWWISCY    ZISCY                           076371
     C                     END                                            076371
     C*                                                                   076371
     C                     Z-ADDWWMTHN    ZMTHN
     C                     Z-ADDWWYRNO    ZYRNO
     C                     MOVELWWPCAL    ZPCAL
     C                     Z-ADDWWSTRP    ZSTRP
     C                     EXSR ZFFFLN
     C**********           MOVELZLIN      WWTXT2 20                                           CGL029
     C                     MOVELZLIN      WWTXT2 26                                           CGL029
     C*
     C***IF TRANSACTION TYPE FROM PF/TRANSD IS 'P', SET LINE 1 AMOUNT     S71062
     C***ON PF/PMHOLDPP EQUAL TO NUMBER OF OPEN CONTRACTS                 S71062
     C***CUSTOMER/BOOK (NOCO) FROM PF/TRANSD (IE. Z-ADD NUMBER OF OPEN    S71062
     C***CONTRACTS CUSTOMER/BOOK TO LINE 1 AMOUNT)                        S71062
     C***********WWTRTY    IFEQ 'P'                                       S71062
     C**************       Z-ADDWWNOCO    WWAMT1 150                      61296
     C*********************Z-SUBWWNOCO    WWAMT1 150                61296 S71062
     C*********************ELSE                                           S71062
     C*
     C***TRANSACTION TYPE IS 'S'                                          S71062
     C***REVERSE THE SIGN OF THE NUMBER OF OPEN CONTRACTS                 S71062
     C***CUSTOMER/BOOK FROM PF/TRANSD BEFORE OUTPUT TO LINE 1 AMOUNT      S71062
     C***ON PF/PMHOLDPP (IE. Z-SUB NUMBER OF OPEN CONTRACTS               S71062
     C***CUSTOMER/BOOK TO LINE 1 AMOUNT)                                  S71062
     C**************       Z-SUBWWNOCO    WWAMT1                          61296
     C*********************Z-ADDWWNOCO    WWAMT1                    61296 S71062
     C*********************END                                            S71062
     C*                                                                   S71062
     C                     Z-ADDWWNOCO    WWAMT1 150                      S71062
     C*                                                                   S71062
     C*                                                                   046167
     C** SET UP STRIKE PRICE                                              046167
     C***********          Z-ADDWWSTRP    WWSTPR 117                046167CFF004
     C           *LIKE     DEFN STRP      WWSTPR                          CFF004
     C                     Z-ADDWWSTRP    WWSTPR                          CFF004
     C*
     C** IF THE PORTFOLIO REFERENCE IS NOT '9997'
     C****       WWPTFR    IFNE '9997'                                    B08040
     C*
     C** IF LAST END OF CENTRE PRICE IS EQUAL TO ZERO, SET
     C** PROFIT/LOSS - MARKET EQUAL TO ZERO
     C           WWPLEC    IFEQ 0
     C                     Z-ADD0         WWPLMK 150
     C                     Z-ADD0         WWMVAL 150                      R01159
     C                     ELSE
     C*                                                                   S71062
     C** CALCULATE BOOK FX RATE FROM INSTRUMENT CCY TO PORTFOLIO CURRENCY S71062
     C** ON THE TRADE DATE                                                S71062
     C                     Z-ADD1         B                               S71062
     C           WWPTCY    LOKUPCYCD,B                   72               S71062
     C*                                                                   S71062
     C** ERROR                                                            S71062
     C           *IN72     IFEQ '0'                        ***************S71062
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD25        DBASE     **DB ERROR 25**S71062 CPM003
     C***********          MOVEL'SDCURRL0'DBFILE    ***************S71062 CPM003
     C                     Z-ADD15        DBASE            **DB ERROR 25**CPM003
     C                     MOVE 'SDCURRPD'DBFILE           ***************CPM003
     C                     MOVELWWPTCY    DBKEY                           S71062
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     S71062
     C                     ELSE                                           S71062
     C                     Z-ADDRKSQ,B    WWRKC1                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** CALCULATE MARKET VALUE                                           S71062
     C** 1. FOR THE FUTURES OR THE OPTIONS WITH PREMIUM PAID AT END       S71062
     C**    THE MARKET VALUE IS EQUAL TO THE UNREALISED PROFIT AND LOSS   S71062
     C**    CONVERTED TO THE PORTFOLIO CURRENCY USING THE SPOT MARKET     S71062
     C**    FX RATE                                                       S71062
     C*                                                                   S71062
     C           *IN50     IFEQ '1'                                       S71062
     C           *IN51     ORNE '1'                                       S71062
     C*
     C** CALCULATE PROFIT/LOSS - MARKET IN INSTRUMENT CURRENCY (USE
     C** STANDARD SR/FFPLCL WITH THE FOLLOWING INPUT PARM.:
     C** FFNOC = NUMBER OF OPEN CONTRACTS CUST/BOOK, PF/TRANSD
     C** FFPRCX= CONTRACT PRICE, PF/TRANSD
     C** FFPRCY= LAST END OF CENTRE PRICE, LF/PRICS
     C** FFTKDM= TICKS DENOMINATOR, LF/INTYP
     C** FFMNPF= MINIMUM PRICE FLUCTUATION, LF/INTYP
     C** FFTKVL= TICK VALUE, LF/INTYP
     C                     Z-ADDWWNOCO    FFNOC
     C***********          Z-ADDWWCOPR    FFPRCX                          CPM003
     C***********          Z-ADDWWPLEC    FFPRCY                          CPM003
     C***********          Z-ADDWWCOPR    FFPRCY 117                CPM003CFF004
     C***********          Z-ADDWWPLEC    FFPRCX 117                CPM003CFF004
     C           *LIKE     DEFN COPR      FFPRCY                          CFF004
     C                     Z-ADDWWCOPR    FFPRCY                          CFF004
     C           *LIKE     DEFN PLEC      FFPRCX                          CFF004
     C                     Z-ADDWWPLEC    FFPRCX                          CFF004
     C                     Z-ADDWWTKDM    FFTKDM
     C                     Z-ADDWWMNPF    FFMNPF
     C                     Z-ADDWWTKVL    FFTKVL
     C                     Z-ADDWWCTAM    FFCTAM                          CPM003
     C                     EXSR FFPLCL
     C*********************Z-ADDFFPOL     WWPLMK                          S71062
     C           WWTRTY    IFEQ 'S'                                       S71062
     C                     Z-SUBFFPOL     FFPOL                           S71062
     C                     END                                            S71062
     C*                                                                   R01159
     C** SET MARKET VALUE OF INSTRUMENT TO UNREALISED PROFIT / LOSS       R01159
     C                     Z-ADDFFPOL     WWMVAL 150                      R01159
     C*
     C***CONVERT THE PROFIT/LOSS - MARKET IN INSTRUMENT CURRENCY TO AN    S71062
     C***AMOUNT IN PORTFOLIO CURRENCY USING THE STANDARD SUBROUTINE       S71062
     C***ZCCYCN WITH THE FOLLOWING INPUT PARM.:                           S71062
     C***ZAMTF: PROFIT/LOSS - MARKET IN INSTRUMENT CURRENCY (ABOVE)       S71062
     C***ZCCYF: INSTRUMENT CURRENCY                                       S71062
     C***ZCCYT: PORTFOLIO CURRENCY                                        S71062
     C***ZRATEF: SPOT RATE FOR INSTRUMENT CURRENCY FROM LF/SDCURRL0       S71062
     C***ZRATET: SPOT RATE FOR PORTFOLIO CURRENCY FROM LF/SDCURRL0        S71062
     C***ZMDINF: MULT/DIV. IN. FOR INSTRUMENT CUR. FROM SDCURRL0          S71062
     C***ZMDINT: MULT/DIV. IN. FOR PORTFOLIO CUR. FROM SDCURRL0           S71062
     C***ZCDPF: INSTRUMENT CURRENCY DECIMAL PLACES FROM LF/SDCURRL0       S71062
     C***ZCDPT: PORTFOLIO CURRENCY DECIMAL PLACES FROM LF/SDCURRL0        S71062
     C********             Z-ADDWWPLMK    ZAMTF                           S71062
     C********             MOVELWWISCY    ZCCYF                           S71062
     C********             MOVELWWPTCY    ZCCYT                           S71062
     C********             Z-ADDWWC9NI    ZRATEF                          S71062
     C********             Z-ADDWWC9NP    ZRATET                          S71062
     C********             MOVELWWA8SI    ZMDINF                          S71062
     C********             MOVELWWA8SP    ZMDINT                          S71062
     C********             Z-ADDWWDANI    ZCDPF                           S71062
     C********             Z-ADDWWDANP    ZCDPT                           S71062
     C********                                                     B08040 S71062
     C***FOR*9997 PORTFOLIO CONVERT TO VALUE IN PORTFOLIO CUSTOMER B08040 S71062
     C********   WWPTFR    IFEQ '9997'                             B08040 S71062
     C********             MOVELQBCSBY    ZCCYT                    B08040 S71062
     C********             Z-ADDWWC9NC    ZRATET                   B08040 S71062
     C********             MOVELWWA8SC    ZMDINT                   B08040 S71062
     C********             Z-ADDWWDANC    ZCDPT                    B08040 S71062
     C********             END                                     B08040 S71062
     C********                                                     B08040 S71062
     C********             EXSR ZCCYCN                                    S71062
     C********             Z-ADDZAMTT     WWPLMK                          S71062
     C*                                                                   S71062
     C** 2. FOR THE OPTIONS WITH PREMIUM PAID UP FRONT                    S71062
     C**    THE MARKET VALUE IS EQUAL TO THE PREMIUM CALCULATED WITH      S71062
     C**    THE MARKET PRICE, CONVERTED TO THE PORTFOLIO CURRENCY USING   S71062
     C**    THE SPOT MARKET FX RATE                                       S71062
     C*                                                                   S71062
     C                     ELSE                                           S71062
     C*                                                                   S71062
     C                     Z-ADDWWNOCO    FFNOC                           S71062
     C                     Z-ADDWWPLEC    FFPRIC                          S71062
     C                     Z-ADDWWTKDM    FFTKDM                          S71062
     C                     Z-ADDWWMNPF    FFMNPF                          S71062
     C                     Z-ADDWWTKVL    FFTKVL                          S71062
     C                     Z-ADDWWCTAM    FFCTAM                          CPM003
     C                     EXSR FFPMCL                                    S71062
     C*                                                                   S71062
     C           WWTRTY    IFEQ 'S'                                       S71062
     C                     Z-SUBFFPREM    FFPREM                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** SET MARKET VALUE OF INSTRUMENT TO PREMIUM CALCULATED             S71062
     C                     Z-ADDFFPREM    WWMVAL                          S71062
     C****                                                          S71062076371
     C***FOR OPTIONS WITH PREMIUM PAID UP FRONT, CONVERT THE PREMIUMS71062076371
     C***PAID TO THE PORTFOLIO CURRENCY AT THE BOOK FX RATE         S71062076371
     C****                                                          S71062076371
     C****                 Z-ADDWWNOCO    FFNOC                     S71062076371
     C****                 Z-ADDWWCOPR    FFPRIC                    S71062076371
     C****                 Z-ADDWWTKDM    FFTKDM                    S71062076371
     C****                 Z-ADDWWMNPF    FFMNPF                    S71062076371
     C****                 Z-ADDWWTKVL    FFTKVL                    S71062076371
     C****                 EXSR FFPMCL                              S71062076371
     C****                                                          S71062076371
     C****       WWTRTY    IFEQ 'S'                                 S71062076371
     C****                 Z-SUBFFPREM    FFPREM                    S71062076371
     C****                 END                                      S71062076371
     C****                                                          S71062076371
     C****                 Z-ADDFFPREM    WWPREM 130                S71062076371
     C****                                                          S71062076371
     C****       FFPREM    MULT QFBFXR    WWACIS 150H               S71062076371
     C*                                                             S71062076371
     C                     END                                      S71062076371
     C                     END
     C****                 END                                            B08040
     C*
     C***IF*THE*PORTFOLIO*REFERENCE*IS*'9997'                             R01159
     C********** WWPTFR ** IFEQ '9997'                                    R01159
     C*
     C***SET*THE*PROFIT/LOSS*MARKET*EQUAL*TO*ZERO                         R01159
     C******************** Z-ADD0         WWPLMK                          R01159
     C******************** END                                            R01159
     C*
     C** WRITE A RECORD TO THE PORTFOLIO HOLDINGS FILE AS PER W01
     C** SET THE PORTFOLIO REFERENCE EQUAL TO THAT FROM PF/TRANSD
     C** (PORTFOLIO RECORD)
     C                     MOVELWWPTFR    WPTFR   4
     C                     EXSR W01
     C                     Z-ADD0         WWPLMK                          B08040
     C*
     C** IF THE PORTFOLIO REFERENCE ON PF/TRANSD IS NOT '9997'
     C           WWPTFR    IFNE '9997'
     C*
     C** WRITE A RECORD TO THE PORTFOLIO HOLDINGS FILE AS PER W01
     C** SET THE PORTFOLIO REFERENCE EQUAL TO '9998' (PORTFOLIO
     C** CONSOLIDATED RECORD)
     C                     MOVEL'9998'    WPTFR
     C                     EXSR W01
     C                     END
     C*
     C** IF PRIVATE BANKING MODULE IS NOT SWITCH *ON                      CPB001
     C** WRITE A RECORD TO THE PORTFOLIO HOLDINGS FILE AS PER W01
     C** SET THE PORTFOLIO REFERENCE EQUAL TO '9999' (CUSTOMER
     C** CONSOLIDATED RECORD)
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVEL'9999'    WPTFR
     C                     EXSR W01
     C                     ENDIF                                          CPB001
     C*
     C** ADD 1 TO A COUNT OF PORTFOLIO HOLDINGS CREATED
     C                     ADD  1         PPHCRE
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P06      - AUDIT PROCESSING                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * W02      - WRITE TO PORTFOLIO HOLDINGS AUDIT                     *
      * W03      - WRITE TO PORTF. HOLDINGS UPDATE (FF) AUDIT REPORT     *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           P06       BEGSR                           *** P06    ***
     C*
     C***ACCESS*THE*PORTFOLIO*HOLDINGS*AUDIT*PF/PMHOLDZZ******************CPM003
     C*********************READ*PMHOLDZZ*****************72***************CPM003
     C** ACCESS THE PORTFOLIO HOLDINGS AUDIT PF/PMHOLDPA                  CPM003
     C                     READ PMHOLDPA                 72               CPM003
     C           *IN72     IFEQ '1'
     C*
     C** SET NUMBER OF LIVE RECORDS EQUAL TO A COUNT OF PORTFOLIO
     C** HOLDINGS CREATED
     C***WRITE*A*RECORD*TO*PF/PMHOLDZZ*AS*PER*W02*************************CPM003
     C** WRITE A RECORD TO PF/PMHOLDPA AS PER W02                         CPM003
     C                     Z-ADDPPHCRE    QFNORE
     C                     EXSR W02
     C                     ELSE
     C*
     C** ADD COUNT OF PORTFOLIO HOLDINGS CREATED TO NUMBER OF LIVE
     C***RECORDS*ON*PF/PMHOLDZZ*******************************************CPM003
     C***UPDATE*PF/PMHOLDZZ*AS*PER*W02************************************CPM003
     C** RECORDS ON PF/PMHOLDPA                                           CPM003
     C** UPDATE PF/PMHOLDPA AS PER W02                                    CPM003
     C                     ADD  PPHCRE    QFNORE
     C                     EXSR W02
     C                     END
     C*
     C** PRODUCE AUDIT REPORT AS PER W03 - WRITE TO PORTFOLIO HOLDINGS
     C** UPDATE (FF) AUDIT REPORT
     C                     EXSR W03
     C*
     C                     ENDSR                           *** EP06   ***
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W01      - WRITE TO PORTFOLIO HOLDINGS                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * W04      - Write on Portfolio Event Currency                  *   CPM005
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P05      - FORMAT & OUTPUT DETAILS TO PORTF. HOLDINGS FILE       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAVCD   - ACCOUNT OFFICER CODE FROM LF/SDPLCSL0                 *
      * WWCUSC   - CUSTOMER NUMBER FROM PF/TRANSD                        *
      * WWINNR   - PM INSTRUMENT TYPE NARRATIVE FROM LF/INTYP            *
      * WWITDS   - DISPLAY GROUP SEQUENCE FROM PF/SDPLINPD               *
      * WWDSPG   - DISPLAY GROUP FROM PF/SDPLINPD                        *
      **WWDSPS***-*DISPLAY*GROUP*SEQUENCE*FROM*PF/PMDSPGPP****************CPM003
      * WWDSPS   - DISPLAY GROUP SEQUENCE FROM PF/PMDSPGPD               *CPM003
      * WWVALG   - VALUATION GROUP FROM PF/SDPLINPD                      *
      **WWVLGS***-*VALUATION*GROUP*SEQUENCE*FROM*PF/PMVLGHPP**************CPM003
      * WWVLGS   - VALUATION GROUP SEQUENCE FROM PF/PMVLGHPD             *CPM003
      * WWTNBR   - TRANSACTION NUMBER FROM PF/TRANSD                     *
      * WWISTN   - INSTRUMENT NAME FROM LF/INTYP                         *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS NARRATIVE                  *
      * WWAMT1   - NUMBER OF OPEN CONTRACTS CUSTOMER/BOOK                *
      * WWISCY   - INSTRUMENT CURRENCY FROM PF/TRANSD                    *
      * WWDANI   - DECIMAL PLACES FOR INSTRUMENT CURRENCY                *
      * WWPLEC   - MARKET PRICE FROM LF/PRICS                            *
      * WWCOPR   - CONTRACT PRICE FROM PF/TRANSD                         *
      * WWPLMK   - PROFIT/LOSS MARKET                                    *
      *                                                                  *
      ********************************************************************
     C           W01       BEGSR                           *** W01    ***
     C*
     C                     MOVEL'D'       QFRECI
     C*
     C** ACCOUNT OFFICER: FROM LF/SDPLCSL0
     C                     MOVELWWACOC    QFACOC
     C*
     C** CUSTOMER NUMBER: FROM PF/TRANSD
     C**********           Z-ADDWWCUSC    QFCNUM                                              CSD027
     C                     MOVE WWCUSC    QFCNUM                                              CSD027
     C*
     C** PORTFOLIO REFERENCE: AS SET UP IN P05
     C                     MOVELWPTFR     QFPTFR
     C*
     C** TRADE/VALUE DATE INDICATOR: 'X'
     C                     MOVEL'X'       QFTVDA
     C*
     C** MODULE ID: 'FF'
     C                     MOVEL'FF'      QFMODI
     C*
     C** INSTRUMENT TYPE: FROM LF/INTYP
     C                     MOVELWWINNR    QFINNR
     C*
     C** INSTRUMENT TYPE DISPLAY SEQUENCE: DISPLAY GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWITDS    QFITDS
     C*
     C** DISPLAY GROUP: FROM PF/SDPLINPD
     C                     MOVELWWDSPG    QFDSPG
     C*
     C** DISPLAY GROUP SEQUENCE: FROM PF/PMDSPGPP
     C                     Z-ADDWWDSPS    QFDSPS
     C*
     C** VALUATION GROUP: FROM PF/SDPLINPD
     C                     MOVELWWVALG    QFVALG
     C*
     C** VALUATION GROUP SEQUENCE: FROM PF/PMVLGHPP
     C                     Z-ADDWWVLGS    QFVLGS
     C*
     C** INSTRUMENT TYPE VALUATION SEQUENCE: FROM PF/SDPLINPD
     C                     Z-ADDWWVLIS    QFVLIS
     C*
     C** TRANSACTION NUMBER: TNBR FROM PF/TRANSD
     C**********           Z-ADDWWTNBR    QFTRNB                                              CLE148
     C                     MOVELWWTNBR    QFTRNB                                              CLE148
     C*
     C** SECURITY SHORTNAME: *BLANKS
     C                     MOVEL*BLANKS   QFTDSS
     C*
     C** DEAL TYPE: TRTY FROM PF/TRANSD
     C                     MOVELWWTRTY    QFDTYP
     C*
     C** F&O INSTRUMENT TYPE: ISTT FROM PF/TRANSD
     C                     MOVELWWISTT    QFFOIS
     C*
     C** MIDAS INSTRUMENT NAME: ISTN FROM LF/INTYP
     C                     MOVELWWISTN    QFTXT1
     C*
     C** INSTRUMENT ENQUIRY DETAILS: SEE PROCESS P05
     C                     MOVELWWTXT2    QFTXT2
     C*
     C** LINE 1 AMOUNT: AS SET UP IN P05
     C                     Z-ADDWWAMT1    QFAMT1
     C*
     C***LINE*2*AMOUNT:*ZERO                                              S71062
     C*********************Z-ADD0         QFAMT2                          S71062
     C** LINE 2 AMOUNT: ZERO                                              S71062
     C                     Z-ADDWWNUCO    QFAMT2                          S71062
     C*
     C** CURRENCY 1: INSTRUMENT CURRENCY FROM PF/TRANSD
     C                     MOVELWWISCY    QFCCY1
     C*
     C***CURRENCY*2:*BLANK                                                S71062
     C*********************MOVEL*BLANKS   QFCCY2                          S71062
     C** CURRENCY 2: PORTFOLIO CURRENCY                                   S71062
     C****                 MOVELWWPTCY    QFCCY2                    S71062076371
     C                     MOVELWWOTHC    QFCCY2                          076371
     C*
     C*  CURRENCY DEC. PLACES 1: INSTRUMENT DEC. PLACES FROM LF/SDCURRL0
     C                     Z-ADDWWDANI    QFCDP1
     C*
     C***CURRENCY*DEC.*PLACES*2:*ZERO                                     S71062
     C*********************Z-ADD0         QFCDP2                          S71062
     C** CURRENCY DEC. PLACES 2: PORTFOLIO DEC. PLACES FROM LF/SDCURRL0   S71062
     C****                 Z-ADDWWDANP    QFCDP2                    S71062076371
     C                     Z-ADDWWOTH1    QFCDP2                          076371
     C*
     C** MARKET PRICE: LAST END OF CENTRE PRICE
     C                     Z-ADDWWPLEC    QFMPRC
     C*
     C** BOOK PRICE: CONTRACT PRICE
     C                     Z-ADDWWCOPR    QFBOPR
     C*
     C***BOOK*FX*RATE:*ZERO                                               S71062
     C*********************Z-ADD0         QFBFXR                          S71062
     C*
     C***MARKET*VALUE:*ZERO                                               R01159
     C******************** Z-ADD0         QFMVAL                          R01159
     C***MARKET*VALUE                                              R01159 S71062
     C*********************Z-ADDWWMVAL    QFMVAL                   R01159 S71062
     C                     Z-ADDWWMVAL    QFMVAL                          076371
     C*
     C***PURCHASED*INTEREST:*ZERO                                         S71062
     C*********************Z-ADD0         QFPUIT                          S71062
     C** PURCHASED INTEREST: CONTINGENT AMOUNT MULTIPLIED BY THE NUMBER   S71062
     C** OF OPEN CONTRACTS IN INSTRUMENT CURRENCY (FOR OTC OPTION)        S71062
     C           *IN50     IFEQ '0'                                       S71062
     C           *IN52     ANDEQ'1'                                       S71062
     C           WWCTAM    MULT WWNOCO    QFPUIT                          S71062
     C                     ELSE                                           S71062
     C                     Z-ADD0         QFPUIT                          S71062
     C                     END                                            S71062
     C*
     C***ACCRUED*INTEREST:*ZERO                                           S71062
     C*********************Z-ADD0         QFACIS                          S71062
     C*
     C** NEXT INTEREST DATE: 0
     C                     Z-ADD0         QFNIDT
     C*
     C** START/LAST INTEREST DATE: ZERO
     C                     Z-ADD0         QFSLID
     C*
     C** NUMBER OF DAYS ACCRUED INTEREST: ZERO
     C                     Z-ADD0         QFNODA
     C*
     C** PROFIT/LOSS MARKET: SEE PROCESS P05
     C*********************Z-ADDWWPLMK    QFPLMK                          S71062
     C*
     C***PROFIT/LOSS*FX:*ZERO                                             S71062
     C*********************Z-ADD0         QFPLFX                          S71062
     C*
     C** BOOK YIELD: ZERO
     C                     Z-ADD0         QFBKYD
     C*
     C** MARKET YIELD: ZERO
     C                     Z-ADD0         QFMKYD
     C*
     C** DIRECT YIELD: ZERO
     C                     Z-ADD0         QFDRYD
     C*
     C***COUNTRY OF RISK: BLANK                                           R05669
     C***********          MOVEL*BLANKS   QFCNTR                          R05669
     C***********                                                         R05669
     C***INDUSTRY: ZERO                                                   R05669
     C***********          Z-ADD0         QFLIND                          R05669
     C*                                                                   046167
     C** STRIKE PRICE: AS SET UP IN P05                                   046167
     C                     Z-ADDWWSTPR    QFSTRP                          046167
     C*
     C** SECURITY POSITION PLEDGED: 'N'
     C                     MOVE 'N'       QFSPLD
     C*                                                                   S71062
     C** AMERICAN/EUROPEAN OPTION TYPE                                    S71062
     C                     MOVELWWAEIN    QFAEIN                          S71062
     C*                                                                   S71062
     C** CONVERTED SETTLEMENT DATE                                        S71062
     C*                                                                   S71062
     C           *IN52     IFEQ '0'                        Non OTC        S71062
     C           MRKT      CHAINMARKT                72                   S71062
     C*                                                                   S71062
     C           *IN72     IFEQ '1'                        ***************S71062
     C           *LOCK     IN   LDA
     C***********          Z-ADD24        DBASE    ***************S71062  CPM003
     C***********          MOVEL'MARKT   'DBFILE   ***************S71062  CPM003
     C                     Z-ADD17        DBASE            **DB ERROR 17**CPM003
     C                     MOVE 'MARKT   'DBFILE           ***************CPM003
     C                     MOVELMRKT      DBKEY                           S71062
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C                     MOVE SEDF      FFDATC                          S71062
     C                     Z-ADDWWMTHN    FFMTH                           S71062
     C                     Z-ADDWWYRNO    FFYR                            S71062
     C                     MOVE MKLC      FFCCY1                          S71062
     C                     MOVE ISCY      FFCCY2                          S71062
     C                     MOVE OTHC      FFCCY3                          S71062
     C                     EXSR FFDATE                                    S71062
     C                     Z-ADDFFDAY     QFSETD           Settlemnt Date S71062
     C                     ELSE                                           S71062
     C                     Z-ADDSETD      QFSETD                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** CLOSE OUT NUMBER                                                 S71062
     C           WWNUCO    IFNE WWNOCO                                    S71062
     C*                                                                   S71062
     C                     MOVE '0'       *IN73                           S71062
     C*                                                                   S71062
     C           WWTNBR    SETLLCLOSTTM                                   S71062
     C           WWTNBR    READECLOSTTM                  72               S71062
     C*                                                                   S71062
     C** ERROR                                                            S71062
     C           *IN72     IFEQ '1'                        ***************S71062
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD23        DBASE     **DB ERROR 23**S71062 CPM003
     C***********          MOVEL'CLOSTTM 'DBFILE    ***************S71062 CPM003
     C                     Z-ADD18        DBASE            **DB ERROR 18**CPM003
     C                     MOVE 'CLOSTTM 'DBFILE           ***************CPM003
     C                     MOVELWWTNBR    DBKEY                           S71062
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C           *IN73     DOWEQ'0'                                       S71062
     C           *IN72     ANDEQ'0'                                       S71062
     C*                                                                   S71062
     C                     Z-ADDCLON      WWCLON  60                      S71062
     C           WWCLON    CHAINCLOST9               72                   S71062
     C*                                                                   S71062
     C** ERROR                                                            S71062
     C           *IN72     IFEQ '1'                        ***************S71062
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD24        DBASE     **DB ERROR 24**S71062 CPM003
     C***********          MOVEL'CLOST9  'DBFILE    ***************S71062 CPM003
     C                     Z-ADD19        DBASE            **DB ERROR 19**CPM003
     C                     MOVE 'CLOST9  'DBFILE           ***************CPM003
     C                     MOVELWWCLON    DBKEY                           S71062
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** IF NOT LIVE RECORD OR IF THE CLOSE OUT REVERSAL INDICATOR IS 'Y' S71062
     C** CONTINUE THE PROCESSING AND READ THE NEXT RECORD                 S71062
     C           RECI      IFNE 'D'                                       S71062
     C           CORI      OREQ 'Y'                                       S71062
     C                     MOVE '0'       *IN73                           S71062
     C           WWTNBR    READECLOSTTM                  72               S71062
     C                     ELSE                                           S71062
     C                     MOVE '1'       *IN73                           S71062
     C                     END                                            S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C** LIVE CLOSE OUT FOUND (WITH REVERSAL INDICATOR TO 'N')            S71062
     C           *IN73     IFEQ '1'                                       S71062
     C                     Z-ADDCLON      QFCLON                          S71062
     C                     ELSE                                           S71062
     C                     Z-ADD*ZEROS    QFCLON                          S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C                     ELSE                                           S71062
     C                     Z-ADD*ZEROS    QFCLON                          S71062
     C                     END                                            S71062
     C*                                                                   B08040
     C** OBTAIN FX RATE FROM ISSUE CURRNCY TO PORTFOLIO CCY FROM ARRAY    B08040
     C                     Z-ADD1         B                               B08040
     C           QFPTFR    IFNE '9997'                                    B08040
     C           QFPTFR    ANDNE'9998'                                    B08040
     C           QFPTFR    ANDNE'9999'                                    B08040
     C           PNPTCY    LOKUPCYCD,B                   72               B08040
     C                     ELSE                                           B08040
     C           QBCSBY    LOKUPCYCD,B                   72               B08040
     C                     END                                            B08040
     C** ERROR                                                            B08040
     C           *IN72     IFEQ '0'                        ***************B08040
     C           *LOCK     IN   LDA                                       CPM003
     C************         Z-ADD22        DBASE     **DB ERROR 02**B08040 CPM003
     C************         MOVEL'SDCURRL0'DBFILE                   B08040 CPM003
     C                     Z-ADD21        DBASE            **DB ERROR 21**CPM003
     C                     MOVE 'SDCURRPD'DBFILE                          CPM003
     C                     MOVELQBCSBY    DBKEY                           B08040
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    WWSPC1 138                      B08040
     C                     MOVE MDIN,B    WWMDC1  1                       B08040
     C                     Z-ADDNBDP,B    WWDPC1  10                      B08040
     C                     Z-ADDRKSQ,B    WWRKC1  30                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CALCULATE MARKET FX RATE FROM NOMINAL CCY TO PORTFOLIO CURRENCY  B08040
     C                     Z-ADD1         ZAMTF                           B08040
     C                     MOVE QFCCY1    ZCCYF                           B08040
     C                     MOVE CYCD,B    ZCCYT                           B08040
     C                     Z-ADDWWC9NI    ZRATEF                          B08040
     C                     Z-ADDWWSPC1    ZRATET                          B08040
     C                     MOVE WWA8SI    ZMDINF                          B08040
     C                     MOVE WWMDC1    ZMDINT                          B08040
     C                     Z-ADDWWDANI    ZCDPF                           B08040
     C                     Z-ADDWWDPC1    ZCDPT                           B08040
     C                     EXSR ZCCYCN                                    B08040
     C                     Z-ADDZCRSRN    QFMFXD                          57020
     C*                                                                   B08040
     C** CONVERT RATE INTO MULTIPLY RATE                                  B08040
     C           ZCRSMD    IFEQ 'D'                                       B08040
     C           1         DIV  ZCRSRT    WWMFXR 138H                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDZCRSRT    WWMFXR 138                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CONVERT MARKET FX RATE TO FORMAT DEFINED BY RANKING SEQUENCE     B08040
     C****       WWRKSI    IFLT WWRKC1                              B08040076371
     C           WWRKSI    IFGT WWRKC1                                    076371
     C           1         DIV  WWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'D'       QFMFMD                          B08040
     C                     ELSE                                        67 B08040
     C*********************Z-ADDWWMFXR    QFMFXR 138H              B08040 S71062
     C                     Z-ADDWWMFXR    QFMFXR 138                      S71062
     C                     MOVE 'M'       QFMFMD                          B08040
     C                     END                                         67 B08040
     C*                                                                   S71062
     C** SET UP INPUT FIELDS FOR SR/ZBAKRT :                              S71062
     C                     MOVELWWISCY    ZCCYF                           S71062
     C                     MOVELWWPTCY    ZCCYT                           S71062
     C                     Z-ADDWWTRSD    ZSDATE                          S71062
     C                     EXSR ZBAKRT                                    S71062
     C                     Z-ADDZCRSRT    WWBFXR 138                      S71062
     C*                                                                   S71062
     C** CONVERT BOOK FX RATE TO FORMAT DEFINED BY RANKING SEQUENCE       S71062
     C****       WWRKSI    IFLT WWRKC1                             S71062 076371
     C           WWRKSI    IFGT WWRKC1                                    076371
     C           1         DIV  WWBFXR    QFBFXR 138H                     S71062
     C                     ELSE                                           S71062
     C                     Z-ADDWWBFXR    QFBFXR 138                      S71062
     C                     END                                            S71062
     C*                                                                   R37474
     C** IF MARKET VALUE OR ACCRUED INTEREST NON ZERO OUTPUT TOTAL I      R37474
     C           WWMHEX    IFEQ 'L'                                       077485
     C                     EXSR #HLDX0                                    R37474
     C                     END                                            077485
     C*                                                                   076371
     C** CALCULATE MARKET P/L AS DIFFERENCE BETWEEN PRICE PAID AND        076371
     C** CURRENT MARKET PRICE                                             076371
     C                     Z-ADDWWNOCO    FFNOC                           076371
     C                     Z-ADDWWCOPR    FFPRCY                          076371
     C                     Z-ADDWWPLEC    FFPRCX                          076371
     C                     Z-ADDWWTKDM    FFTKDM                          076371
     C                     Z-ADDWWMNPF    FFMNPF                          076371
     C                     Z-ADDWWTKVL    FFTKVL                          076371
     C                     Z-ADDWWCTAM    FFCTAM                          CPM003
     C                     EXSR FFPLCL                                    076371
     C           WWTRTY    IFEQ 'S'                                       076371
     C                     Z-SUBFFPOL     FFPOL                           076371
     C                     END                                            076371
     C*                                                                   076371
     C** CONVERT FROM NOMINAL TO PORTFOLIO CCY                            076371
     C                     Z-ADDFFPOL     ZAMTF                           076371
     C                     MOVE QFCCY1    ZCCYF                           076371
     C                     MOVE CYCD,B    ZCCYT                           076371
     C                     Z-ADDWWC9NI    ZRATEF                          076371
     C                     Z-ADDWWSPC1    ZRATET                          076371
     C                     MOVE WWA8SI    ZMDINF                          076371
     C                     MOVE WWMDC1    ZMDINT                          076371
     C                     Z-ADDWWDANI    ZCDPF                           076371
     C                     Z-ADDWWDPC1    ZCDPT                           076371
     C                     EXSR ZCCYCN                                    076371
     C                     Z-ADDZAMTT     QFPLMK                          076371
     C*                                                                   076371
     C** CALCULATE PREMIUM PAID FOR OPTION                                076371
     C                     Z-ADDWWNUCO    FFNOC                           076371
     C*                                                                   CPM003
     C**   Use the strike price in the Premium calculation.               CPM003
     C**   for processing type 8                                          CPM003
     C*                                                                   CPM003
     C           ISPT      IFEQ 8                                         CPM003
     C                     Z-ADDWWSTRP    FFPRIC                          CPM003
     C*                                                                   CPM003
     C**   for other types of options use the contract price              CPM003
     C*                                                                   CPM003
     C                     ELSE                                           CPM003
     C                     Z-ADDWWCOPR    FFPRIC                          076371
     C                     END                                            CPM003
     C*                                                                   CPM003
     C                     Z-ADDWWTKDM    FFTKDM                          076371
     C                     Z-ADDWWMNPF    FFMNPF                          076371
     C                     EXSR FFPMCL                                    076371
     C*                                                                   CPM003
     C**   for processing type 8, multiply the amount calculated          CPM003
     C**   by the contract price.                                         CPM003
     C*                                                                   CPM003
     C           ISPT      IFEQ 8                                         CPM003
     C                     MULT WWCOPR    FFPREM                          CPM003
     C                     END                                            CPM003
     C*                                                                   CPM003
     C*                                                                   076371
     C** FOR OPTIONS WITH PREMIUM PAID UP FRONT CALCULATE FX/P/L          076371
     C                     Z-ADD0         QFPLFX                          076371
     C           *IN51     IFEQ '1'                                       076371
     C*                                                                   076371
     C** CALCULATE PREMIUM PAID AT START EQUIVALENT IN PORTFOLIO CCY      076371
     C                     Z-ADDFFPREM    ZAMTF                           076371
     C                     Z-ADDWWBFXR    ZCRSRT                          076371
     C                     MOVE 'M'       ZCRSMD                          076371
     C                     Z-ADDWWDANI    ZCDPF                           076371
     C                     Z-ADDWWDPC1    ZCDPT                           076371
     C                     EXSR ZCCYXR                                    076371
     C                     Z-ADDZAMTT     WWOLDV 150                      076371
     C*                                                                   076371
     C** CALCULATE CURRENT VALUE OF PREMIUM PAID AT START                 076371
     C                     Z-ADDFFPREM    ZAMTF                           076371
     C                     Z-ADDQFMFXR    ZCRSRT                          076371
     C                     MOVE QFMFMD    ZCRSMD                          076371
     C                     Z-ADDWWDANI    ZCDPF                           076371
     C                     Z-ADDWWDPC1    ZCDPT                           076371
     C                     EXSR ZCCYXR                                    076371
     C                     Z-ADDZAMTT     WWNEWV 150                      076371
     C*                                                                   076371
     C** FX P/L IS DIFFERENCE BETWEEN VALUE OF PREMIUM AT START AND       076371
     C** CURRENT VALUE OF PREMIUM                                         076371
     C           WWTRTY    IFEQ 'P'                                       076371
     C           WWNEWV    SUB  WWOLDV    QFPLFX                          076371
     C                     ELSE                                           076371
     C           WWOLDV    SUB  WWNEWV    QFPLFX                          076371
     C                     END                                            076371
     C                     END                                            076371
     C*                                                                   S71062
     C** CALCULATE BOOK FX RATE FROM INSTRUMENT CCY TO PORTFOLIO CURRENCY S71062
     C** ON THE TRADE DATE                                                S71062
     C*                                                                   S01313
     C****                 MOVE 'Y'       QFHLDV                    S01313075998
     C                     MOVE 'N'       QFHLDV                          075998
     C*                                                                   S01313
     C                     MOVE *ZEROS    QFDLSQ                          S01313
     C*                                                                   S01313
     C** IF RECORD FOR DEFINED PORTFOLIO AND PERFORMANCE START DATE *LE   S01313
     C** DNWD SET 'PERFORMANCE FIGURES REQUIRED' TO 'Y'                   S01313
     C** OTHERWISE SET TO 'N'                                             S01313
     C                     MOVE 'N'       QFPFMR                          S01313
     C           QFPTFR    IFNE '9997'                                    S01313
     C           QFPTFR    ANDNE'9998'                                    S01313
     C           QFPTFR    ANDNE'9999'                                    S01313
     C***********PNPSDT    ANDLEBJDNWD                             S01313 CPM005
     C           PNPSDT    IFLE BJDNWD                                    CPM005
     C           PNPSDT    ANDNE*ZEROS                                    CPM005
     C                     MOVE 'Y'       QFPFMR                          S01313
     C                     END                                            CPM005
      *                                                                   CPM005
      **  If 9997, 9998 or 9999 portfolios, check flags in PF/SDPLCSPD    CPM005
      *                                                                   CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9997'                                    CPM005
     C           QBPFM7    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9998'                                    CPM005
     C           QBPFM8    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9999'                                    CPM005
     C           QBPFM9    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     END                                            S01313
     C*                                                                   077485
     C           WWMHEX    IFEQ 'M'                                       077485
     C                     MOVE 'M'       QFRECI                          077485
     C                     END                                            077485
     C*
     C***WRITE*A*RECORD*IN*FILE*PMHOLDPP**********************************CPM003
     C** WRITE A RECORD IN FILE PMHOLDPD                                  CPM003
     C/COPY WNCPYSRC,PM1142C002
     C                     WRITEPMHOLDP0
     C/COPY WNCPYSRC,PM1142C003
      *                                                                   CPM005
     C           QFPTFR    IFNE '9998'                                    CPM005
     C           QFPTFR    ANDNE'9999'                                    CPM005
      *                                                                   CPM005
      **  Write on PMEVCYPD only if forex                                 CPM005
      *                                                                   CPM005
     C           ISPT      IFEQ 2                                         CPM005
     C           ISPT      OREQ 5                                         CPM005
     C                     EXSR W04                                       CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C*                                                                   077485
     C** IF MATURITY RUN, UPDATE EXTRACTED INDICATOR ON TRANSD            077485
     C           WWMHEX    IFEQ 'M'                                       077485
     C           QFPTFR    ANDNE'9998'                                    077485
     C           QFPTFR    ANDNE'9999'                                    077485
     C*                                                                   077485
     C                     Z-ADDTRSD      KTRSD                           077485
     C                     Z-ADDTNBR      KTNBR                           077485
     C*                                                                   077485
     C           KTRS9     CHAINTRANS9               70                   077485
     C*                                                                   077485
     C** IF RECORD FOUND UPDATE INDICATOR                                 077485
     C           *IN70     IFEQ '0'                                       077485
     C                     MOVE 'Y'       MHEX                            077485
     C                     UPDATTRANSDF9                                  077485
     C*                                                                   077485
     C** ..... OTHERWISE TERMINATE PROGRAM WITH DATABASE ERROR            077485
     C                     ELSE                            ***************077485
     C                     Z-ADD30        DBASE            **DB ERROR 30**077485
     C                     MOVEL'TRANS9  'DBFILE           ***************077485
     C                     MOVELTRSD      DBKEY                           077485
     C                     MOVE TNBR      DBKEY                           077485
     C                     EXSR *PSSR                                     077485
     C                     END                                            077485
     C                     END                                            077485
     C****                                                                R37474
     C***IF MARKET VALUE OR ACCRUED INTEREST NON ZERO OUTPUT TOTAL I      R37474
     C****                 EXSR #HLDX0                                    R37474
     C*                                                                   B08040
     C                     ENDSR                           *** EW01   ***
      *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W02      - WRITE TO PORTFOLIO HOLDINGS AUDIT                     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P06      - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           W02       BEGSR                           *** W02    ***
     C                     MOVEL'D'       QFRECI
     C/COPY WNCPYSRC,PM1142C004
     C           *IN72     IFEQ '1'
     C                     WRITEPMHOLDZ0
     C                     ELSE
     C                     UPDATPMHOLDZ0
     C                     END
     C/COPY WNCPYSRC,PM1142C005
     C                     ENDSR                           *** EW02   ***
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W03      - WRITE TO PORTF. HOLDINGS UPDATE (FF) AUDIT REPORT     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P06      - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           W03       BEGSR                           *** W03    ***
     C/COPY WNCPYSRC,PM1142C006
     C                     WRITEPM1142PP
     C/COPY WNCPYSRC,PM1142C007
     C*                                                                   CPM003
     C           WEMPTY    IFEQ 'Y'                                       CPM003
     C                     WRITENODTLS                                    CPM003
     C                     ENDIF                                          CPM003
     C*                                                                   CPM003
     C                     ENDSR                           *** EW03   ***
      ********************************************************************CPM005
      /EJECT                                                              CPM005
      *****************************************************************   CPM005
      *                                                               *   CPM005
      * W04      - Write on Portfolio Event Currency                  *   CPM005
      *                                                               *   CPM005
      * Subroutine Calls:                                             *   CPM005
      *                                                               *   CPM005
      * Subroutine Called From:                                       *   CPM005
      * W01      - Write to Portfolio Holdings                        *   CPM005
      *                                                               *   CPM005
      * Routine Uses Variables:                                       *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
     C           W04       BEGSR                           *** W04    *** CPM005
      *                                                                   CPM005
     C                     MOVEL'D'       FGRECI           Record Id      CPM005
     C**********           Z-ADDQFCNUM    FGCNUM           Cust Nbr                    CPM005 CSD027
     C                     MOVE QFCNUM    FGCNUM           Cust Nbr                           CSD027
     C                     MOVELQFPTFR    FGPTFR           Portfolio Ref  CPM005
     C                     Z-ADDQFVDAT    FGEVDT           Event Date     CPM005
     C                     MOVEL*BLANKS   FGEVFX           Event Type FX  CPM005
     C                     Z-ADDQFDSPS    FGDGRS           Group Seq      CPM005
     C                     MOVELQFINNR    FGINSC           Instrument CodeCPM005
     C                     Z-ADDQFITDS    FGINDS           Instrument Seq CPM005
     C                     MOVEL'FO'      FGEVTY           Event Type     CPM005
      *                                                                   CPM005
      **  Access to retrieve base ccy details                             CPM005
      *                                                                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM QBCSBY    P@CYCD                          CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
      **  If record not found:                                            CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                    *B2            CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD34        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DB ERROR 34 *CPM005
     C                     MOVELQBCSBY    DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                           *E2            CPM005
      *                                                                   CPM005
     C                     MOVELA6CYCD    BCCYT   3                       CPM005
     C                     Z-ADDA6SPRT    BRATET 138                      CPM005
     C                     MOVELA6MDIN    BMDINT  1                       CPM005
     C                     Z-ADDA6NBDP    BCDPT   10                      CPM005
      *                                                                   CPM005
     C           QFPTFR    IFNE '9997'                     *B1            CPM005
     C           QFPTFR    ANDNE'9998'                                    CPM005
     C           QFPTFR    ANDNE'9999'                                    CPM005
      *                                                                   CPM005
      **  Access to retrieve portfolio ccy                                CPM005
      *                                                                   CPM005
     C**********           Z-ADDQFCNUM    KKCUSC                                       CPM005 CSD027
     C                     MOVE QFCNUM    KKCUSC                                              CSD027
     C                     MOVELQFPTFR    KKPTFR                          CPM005
      *                                                                   CPM005
     C           KPORT     CHAINPMPORTPD             71                   CPM005
      *                                                                   CPM005
      **  If record not found:                                            CPM005
      *                                                                   CPM005
     C           *IN71     IFEQ *ON                        *B2            CPM005
     C                     Z-ADD32        DBASE            ***************CPM005
     C                     MOVEL'PMPORTPD'DBFILE           * DB ERROR 32 *CPM005
     C                     MOVELKKCUSC    DBKY10           ***************CPM005
     C                     MOVE KKPTFR    DBKY10                          CPM005
     C                     MOVELDBKY10    DBKEY                           CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                           *E2            CPM005
      *                                                                   CPM005
      **  Access to retrieve portfolio ccy details                        CPM005
      *                                                                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM PNPTCY    P@CYCD                          CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
      **  If record not found:                                            CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                                   CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD33        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DB ERROR 33 *CPM005
     C                     MOVELPNPTCY    DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                           *E2            CPM005
      *                                                                   CPM005
     C                     MOVELPNPTCY    PCCYT   3                       CPM005
     C                     Z-ADDA6SPRT    PRATET 138                      CPM005
     C                     MOVELA6MDIN    PMDINT  1                       CPM005
     C                     Z-ADDA6NBDP    PCDPT   10                      CPM005
     C                     ENDIF                           *E1            CPM005
      *                                                                   CPM005
      **  Write a record for the other currency                           CPM005
      *                                                                   CPM005
     C                     Z-ADD*ZEROS    WWXAMT 150                      CPM005
     C           QFAMT1    MULT FFCTAM    WWXAMT                          CPM005
     C                     MOVELOTHC      WWXCCY  3                       CPM005
      *                                                                   CPM005
      **  Access with sett or nominal ccy to retrieve details             CPM005
      *                                                                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM WWXCCY    P@CYCD                          CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
      **  If record not found:                                            CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                                   CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD31        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DB ERROR 31 *CPM005
     C                     MOVELWWXCCY    DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                           *E1            CPM005
      *                                                                   CPM005
     C                     MOVELA6CYCD    ZCCYF                           CPM005
     C                     Z-ADDA6SPRT    ZRATEF                          CPM005
     C                     MOVELA6MDIN    ZMDINF                          CPM005
     C                     Z-ADDA6NBDP    ZCDPF                           CPM005
      *                                                                   CPM005
     C           QFPTFR    IFNE '9997'                     *B1            CPM005
     C           QFPTFR    ANDNE'9998'                                    CPM005
     C           QFPTFR    ANDNE'9999'                                    CPM005
      *                                                                   CPM005
      **  If other currency not equal to portfolio currency               CPM005
      *                                                                   CPM005
     C           PCCYT     IFNE WWXCCY                     *B2            CPM005
     C                     MOVELPCCYT     ZCCYT                           CPM005
     C                     Z-ADDPRATET    ZRATET                          CPM005
     C                     MOVELPMDINT    ZMDINT                          CPM005
     C                     Z-ADDPCDPT     ZCDPT                           CPM005
     C                     Z-ADDWWXAMT    ZAMTF                           CPM005
     C                     EXSR ZCCYCN                                    CPM005
     C                     Z-ADDZAMTT     WW1AMT 150                      CPM005
     C                     ELSE                            X*2            CPM005
     C                     Z-ADDWWXAMT    WW1AMT                          CPM005
     C                     END                             *E2            CPM005
      *                                                                   CPM005
      **  If portfolio currency is the same as the base currency          CPM005
      *                                                                   CPM005
     C           PCCYT     IFEQ BCCYT                      *B2            CPM005
     C                     Z-ADDWW1AMT    WW2AMT                          CPM005
     C                     ELSE                            X*2            CPM005
      *                                                                   CPM005
      **  If other currency not equal to base currency                    CPM005
      *                                                                   CPM005
     C           BCCYT     IFNE WWXCCY                     *B3            CPM005
     C                     MOVELBCCYT     ZCCYT                           CPM005
     C                     Z-ADDBRATET    ZRATET                          CPM005
     C                     MOVELBMDINT    ZMDINT                          CPM005
     C                     Z-ADDBCDPT     ZCDPT                           CPM005
     C                     EXSR ZCCYCN                                    CPM005
     C                     Z-ADDZAMTT     WW2AMT 150                      CPM005
     C                     ELSE                            X*3            CPM005
     C                     Z-ADDWWXAMT    WW2AMT 150                      CPM005
     C                     END                             *E3            CPM005
     C                     END                             *E2            CPM005
      *                                                                   CPM005
      **  Portfolio reference is '9997', '9998' or '9999'                 CPM005
      *                                                                   CPM005
     C                     ELSE                            X*1            CPM005
      *                                                                   CPM005
     C           BCCYT     IFNE WWXCCY                     *B2            CPM005
     C                     Z-ADDWWXAMT    ZAMTF                           CPM005
     C                     MOVELBCCYT     ZCCYT                           CPM005
     C                     Z-ADDBRATET    ZRATET                          CPM005
     C                     MOVELBMDINT    ZMDINT                          CPM005
     C                     Z-ADDBCDPT     ZCDPT                           CPM005
     C                     EXSR ZCCYCN                                    CPM005
     C                     Z-ADDZAMTT     WW1AMT                          CPM005
     C                     Z-ADDZAMTT     WW2AMT                          CPM005
     C                     ELSE                            X*2            CPM005
     C                     Z-ADDWWXAMT    WW1AMT                          CPM005
     C                     Z-ADDWWXAMT    WW2AMT                          CPM005
     C                     END                             *E2            CPM005
     C                     END                             *E1            CPM005
      *                                                                   CPM005
      **  Determine long or short positions                               CPM005
      *                                                                   CPM005
     C           PCAL      IFEQ 'C'                        B*1            CPM005
     C                     Z-ADDWW1AMT    FGMNT1                          CPM005
     C                     Z-ADDWW2AMT    FGMNT2                          CPM005
     C                     ELSE                            X*1            CPM005
     C                     Z-SUBWW1AMT    FGMNT1                          CPM005
     C                     Z-SUBWW2AMT    FGMNT2                          CPM005
     C                     ENDIF                           E*1            CPM005
      *                                                                   CPM005
     C                     MOVELWWXCCY    FGCURR                          CPM005
     C/COPY WNCPYSRC,PM1142C008
     C                     WRITEPMEVCYD0                                  CPM005
     C/COPY WNCPYSRC,PM1142C009
      *                                                                   CPM005
      **  Write a record for the instrument currency                      CPM005
      *                                                                   CPM005
     C                     Z-ADD*ZEROS    WWXAMT 150                      CPM005
     C           QFAMT1    MULT FFCTAM    WWXAMT                          CPM005
     C                     MOVELISCY      WWXCCY                          CPM005
      *                                                                   CPM005
      **  Access with sett or nominal ccy to retrieve details             CPM005
      *                                                                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM WWXCCY    P@CYCD                          CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
      **  If record not found:                                            CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                    *B2            CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD35        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DB ERROR 35 *CPM005
     C                     MOVELWWXCCY    DBKEY            ***************CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     OUT  LDA                                       CPM005
     C                     ENDIF                           *E2            CPM005
      *                                                                   CPM005
     C                     MOVELA6CYCD    ZCCYT                           CPM005
     C                     Z-ADDA6SPRT    ZRATET                          CPM005
     C                     MOVELA6MDIN    ZMDINT                          CPM005
     C                     Z-ADDA6NBDP    ZCDPT                           CPM005
     C                     MOVELA6CYCD    ICCYT   3                       CPM005
     C                     Z-ADDA6SPRT    IRATET 138                      CPM005
     C                     MOVELA6MDIN    IMDINT  1                       CPM005
     C                     Z-ADDA6NBDP    ICDPT   10                      CPM005
      *                                                                   CPM005
     C                     Z-ADDWWXAMT    ZAMTF                           CPM005
     C                     Z-ADDSTRP      ZCRSRT                          CPM005
     C                     MOVE 'M'       ZCRSMD                          CPM005
     C                     EXSR ZCCYXR                                    CPM005
     C                     Z-ADDZAMTT     WWXAMT                          CPM005
      *                                                                   CPM005
     C           QFPTFR    IFNE '9997'                     *B1            CPM005
     C           QFPTFR    ANDNE'9998'                                    CPM005
     C           QFPTFR    ANDNE'9999'                                    CPM005
      *                                                                   CPM005
      **  If instrument currency not equal to portfolio currency          CPM005
      *                                                                   CPM005
     C           PCCYT     IFNE WWXCCY                     *B2            CPM005
     C                     Z-ADDWWXAMT    ZAMTF                           CPM005
     C                     Z-ADDQFMFXR    ZCRSRT                          CPM005
     C                     MOVE QFMFMD    ZCRSMD                          CPM005
     C                     Z-ADDICDPT     ZCDPF                           CPM005
     C                     Z-ADDPCDPT     ZCDPT                           CPM005
     C                     EXSR ZCCYXR                                    CPM005
     C                     Z-ADDZAMTT     WW1AMT 150                      CPM005
     C                     ELSE                            X*2            CPM005
     C                     Z-ADDWWXAMT    WW1AMT 150                      CPM005
     C                     END                             *E2            CPM005
      *                                                                   CPM005
      **  If portfolio currency is the same as the base currency          CPM005
      *                                                                   CPM005
     C           PCCYT     IFEQ BCCYT                      *B2            CPM005
     C                     Z-ADDWW1AMT    WW2AMT                          CPM005
     C                     ELSE                            X*2            CPM005
      *                                                                   CPM005
      **  If instrument currency not equal to base currency               CPM005
      *                                                                   CPM005
     C           BCCYT     IFNE WWXCCY                     *B3            CPM005
     C                     MOVELICCYT     ZCCYF                           CPM005
     C                     MOVELBCCYT     ZCCYT                           CPM005
     C                     Z-ADDIRATET    ZRATEF                          CPM005
     C                     Z-ADDBRATET    ZRATET                          CPM005
     C                     MOVELIMDINT    ZMDINF                          CPM005
     C                     MOVELBMDINT    ZMDINT                          CPM005
     C                     Z-ADDICDPT     ZCDPF                           CPM005
     C                     Z-ADDBCDPT     ZCDPT                           CPM005
     C                     EXSR ZCCYCN                                    CPM005
     C                     Z-ADDZAMTT     WW2AMT 150                      CPM005
     C                     ELSE                            X*3            CPM005
     C                     Z-ADDWWXAMT    WW2AMT 150                      CPM005
     C                     END                             *E3            CPM005
     C                     END                             *E2            CPM005
      *                                                                   CPM005
      **  Portfolio reference is '9997', '9998' or '9999'                 CPM005
      *                                                                   CPM005
     C                     ELSE                            X*1            CPM005
      *                                                                   CPM005
     C                     Z-ADDWWXAMT    ZAMTF                           CPM005
     C                     Z-ADDQFMFXR    ZCRSRT                          CPM005
     C                     MOVE QFMFMD    ZCRSMD                          CPM005
     C                     Z-ADDICDPT     ZCDPF                           CPM005
     C                     Z-ADDBCDPT     ZCDPT                           CPM005
     C                     EXSR ZCCYXR                                    CPM005
     C                     Z-ADDZAMTT     WW1AMT                          CPM005
     C                     Z-ADDZAMTT     WW2AMT                          CPM005
     C                     END                             *E1            CPM005
      *                                                                   CPM005
      **  Determine long or short positions                               CPM005
      *                                                                   CPM005
     C           PCAL      IFEQ 'C'                        B*1            CPM005
     C                     Z-SUBWW1AMT    FGMNT1                          CPM005
     C                     Z-SUBWW2AMT    FGMNT2                          CPM005
     C                     ELSE                            X*1            CPM005
     C                     Z-ADDWW1AMT    FGMNT1                          CPM005
     C                     Z-ADDWW2AMT    FGMNT2                          CPM005
     C                     ENDIF                           E*1            CPM005
      *                                                                   CPM005
     C                     MOVELWWXCCY    FGCURR                          CPM005
     C/COPY WNCPYSRC,PM1142C010
     C                     WRITEPMEVCYD0                                  CPM005
     C/COPY WNCPYSRC,PM1142C011
      *                                                                   CPM005
     C                     ENDSR                           *** EW04   *** CPM005
      /EJECT                                                              B08040
      ********************************************************************B08040
      *                                                                  *B08040
      **#HLDX0***-*CALCULATE*DETAILS*TO*BE*OUTPUT*TO*PMHOLDX0*******B08040CPM003
      * #HLDX0   - CALCULATE DETAILS TO BE OUTPUT TO PMHOLDQ0            *CPM003
      *                                                                  *B08040
      * SUBROUTINE CALLS:                                                *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLED FROM:                                          *B08040
      **W01******-*WRITE*TO*PMHOLDPP********************************B08040CPM003
      * W01      - WRITE TO PMHOLDPD                                     *CPM003
      *                                                                  *B08040
      * ROUTINE USES VARIABLES:                                          *B08040
      *                                                                  *B08040
      ********************************************************************B08040
     C           #HLDX0    BEGSR                           * W03    BSR * B08040
     C*                                                                   B08255
     C****       QFPTFR    IFNE '9998'                     B1       R37474B08255
     C****       QFPTFR    ANDNE'9999'                              R37474B08255
     C****       QBAPBC    OREQ 'N'                                 R37474B08255
     C*                                                                   B08040
     C** DETERMINE PORTFOLIO VALUATION CURRENCY                           B08040
     C           QFPTFR    IFNE '9997'                     B1             B08040
     C           QFPTFR    ANDNE'9998'                                    B08040
     C           QFPTFR    ANDNE'9999'                                    B08040
     C                     MOVE PNPTCY    WWVLCY  3                       B08040
     C                     ELSE                            X1             B08040
     C                     MOVE QBCSBY    WWVLCY                          B08040
     C                     END                             E1             B08040
     C*                                                                   B08040
     C** IF VALUATION CURRENCY DIFFERENT TO CURRENCY 1 SET UP PARAMETER   B08040
     C** TO BE USED IN SR/ZCCYCN                                          B08040
     C           WWVLCY    IFNE QFCCY1                     B1             B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           QFCCY1    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        B2*************B08040
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD27        DBASE      * DB ERROR 16 *B08040CPM003
     C***********          MOVEL'SDCURRL0'DBFILE                   B08040 CPM003
     C                     Z-ADD23        DBASE            * DB ERROR 23 *CPM003
     C                     MOVE 'SDCURRPD'DBFILE                          CPM003
     C                     MOVELQFCCY1    DBKEY                           B08040
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     MOVE QFCCY1    ZCCYF                           B08040
     C                     Z-ADDSPRT,B    ZRATEF                          B08040
     C                     MOVE MDIN,B    ZMDINF                          B08040
     C                     Z-ADDNBDP,B    ZCDPF                           B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWVLCY    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        B2 ************B08040
     C           *LOCK     IN   LDA                                       CPM003
     C***********          Z-ADD28        DBASE     * DB ERROR 16 *B08040 CPM003
     C***********          MOVEL'SDCURRL0'DBFILE                   B08040 CPM003
     C                     Z-ADD24        DBASE            * DB ERROR 24 *CPM003
     C                     MOVE 'SDCURRPD'DBFILE                          CPM003
     C                     MOVELWWVLCY    DBKEY                           B08040
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR                                     B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     MOVE WWVLCY    ZCCYT                           B08040
     C                     Z-ADDSPRT,B    ZRATET                          B08040
     C                     MOVE MDIN,B    ZMDINT                          B08040
     C                     Z-ADDNBDP,B    ZCDPT                           B08040
     C*                                                                   B08040
     C** CONVERT MARKET VALUE TO PORTFOLIO CURRENCY                       B08040
     C                     Z-ADDQFMVAL    ZAMTF                           B08040
     C                     EXSR ZCCYCN                                    B08040
     C                     Z-ADDZAMTT     WWMVL1 150                      B08040
     C*                                                                   B08040
     C*******OTHERWISE*USE*VALUES*WRITTEN*TO*PMHOLDPP**************B08040 CPM003
     C** ... OTHERWISE USE VALUES WRITTEN TO PMHOLDPD                     CPM003
     C                     ELSE                            X1             B08040
     C                     Z-ADDQFMVAL    WWMVL1                          B08040
     C                     END                             E1             B08040
     C*                                                                   B08040
     C** SET ALL TOTAL FIELDS TO ZERO                                     B08040
     C                     Z-ADD0         QFPTPA                          B08040
     C                     Z-ADD0         QFPTNA                          B08040
     C                     Z-ADD0         QFPTMV                          B08040
     C                     Z-ADD0         QFPVPA                          B08040
     C                     Z-ADD0         QFPVNA                          B08040
     C                     Z-ADD0         QFPVMV                          B08040
     C                     Z-ADD0         QFPTAI                          B08040
     C                     Z-ADD0         QFPTNI                          B08040
     C                     Z-ADD0         QFMVPC                          R37474
     C                     Z-ADD0         QFAIPC                          R37474
     C*                                                                   B08040
     C** ADD MARKET VALUE AND ACCRUED INTEREST TO TOTALLING FIELDS        B08040
     C           WWTVPS    IFEQ 'T'                        B1             B08040
     C           WWMVL1    IFGT 0                          B2             B08040
     C                     Z-ADDWWMVL1    QFPTPA                          B08040
     C                     ELSE                            X2             B08040
     C                     Z-SUBWWMVL1    QFPTNA                          B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     ELSE                            X1             B08040
     C           WWMVL1    IFGT 0                          B2             B08040
     C                     Z-ADDWWMVL1    QFPVPA                          B08040
     C                     ELSE                            X2             B08040
     C                     Z-SUBWWMVL1    QFPVNA                          B08040
     C                     END                             E2             B08040
     C                     END                             E1             B08040
     C*                                                                   R37474
     C***CALCULATE*EXTRA*FIELDS*TO*BE*OUTPUT*TO*PMHOLDPP*FOR*MIDASQR37474 CPM003
     C** CALCULATE EXTRA FIELDS TO BE OUTPUT TO PMHOLDPD FOR MIDASQ       CPM003
     C           QFPTPA    IFNE 0                          B1             R37474
     C           QFPVPA    ORNE 0                                         R37474
     C                     Z-ADDQFPTPA    QFMVPC                          R37474
     C                     ADD  QFPVPA    QFMVPC                          R37474
     C                     MOVE '+'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTNA    IFNE 0                          B1             R37474
     C           QFPVNA    ORNE 0                                         R37474
     C                     Z-SUBQFPTNA    QFMVPC                          R37474
     C                     SUB  QFPVNA    QFMVPC                          R37474
     C                     MOVE '-'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTMV    IFNE 0                          B1             R37474
     C           QFPVMV    ORNE 0                                         R37474
     C                     Z-SUBQFPTMV    QFMVPC                          R37474
     C                     SUB  QFPVMV    QFMVPC                          R37474
     C                     MOVE 'L'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFMVPC    IFEQ 0                          B1             R37474
     C                     MOVE 'N'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C                     Z-ADDQFPTAI    QFAIPC                          R37474
     C*                                                                   B08040
     C***WRITE*DETAILS*TO*PMHOLDX0*********************************B08040 CPM003
     C** WRITE DETAILS TO PMHOLDQ0                                        CPM003
     C                     MOVE QFCCY1    QFCCY                           B08040
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD PMHOLDQ0 PMHOLDQ1            CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C*                                                                   B08255
     C           QFPTFR    IFNE '9998'                     B1             R37474
     C           QFPTFR    ANDNE'9999'                                    R37474
     C           QBAPBC    OREQ 'N'                                       R37474
     C/COPY WNCPYSRC,PM1142C012
     C*                                                                   B08255
     C           QBAPBC    IFEQ 'N'                                       B08255
     C                     WRITEPMHOLDD1                                  B08040
     C                     ELSE                                           B08255
     C                     WRITEPMHOLDD0                                  B08040
     C                     END                                            B08255
     C/COPY WNCPYSRC,PM1142C013
     C                     END                                            B08255
     C*                                                                   B08040
     C                     ENDSR                           * W03    ESR * B08040
      *****************************************************************   CPM005
      /EJECT                                                              CPM005
      *****************************************************************   CPM005
      *                                                               *   CPM005
      *  NEWFLD   - New Field in PMHOLDPD PMHOLDQ0 PMHOLDQ1           *   CPM005
      *                                                               *   CPM005
      *  SUBROUTINE CALLS:                                            *   CPM005
      *                                                               *   CPM005
      *  SUBROUTINE CALLED FROM:                                      *   CPM005
      *  W01      -                                                   *   CPM005
      *                                                               *   CPM005
      *  ROUTINE USES VARIABLES:                                      *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
     C           NEWFLD    BEGSR                                          CPM005
      *                                                                   CPM005
     C                     MOVEL*BLANKS   WWPOSQ                          CPM005
     C                     MOVEL*BLANKS   WXPOSQ                          CPM005
      *                                                                   CPM005
     C           ISPT      IFEQ 2                                         CPM005
     C           ISPT      OREQ 5                                         CPM005
     C                     Z-ADD*ZEROS    WXDSEQ                          CPM005
     C                     Z-ADDSETD      WXDATE                          CPM005
     C                     MOVELISCY      WXCCY2                          CPM005
     C                     MOVELWXPOSQ    QFPOSQ                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVELISCY      WWCCY1                          CPM005
     C                     Z-ADDSETD      WWDATE                          CPM005
     C                     MOVELWWPOSQ    QFPOSQ                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     MOVEL'FO'      QFPOTY                          CPM005
     C                     MOVEL'FO'      QFPOST                          CPM005
      *                                                                   CPM005
     C           WWMVL1    IFGT *ZEROS                                    CPM005
     C                     Z-ADDWWMVL1    QFASVL                          CPM005
     C                     MOVEL'A'       QFASLI                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADD*ZEROS    QFASVL                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C           WWMVL1    IFLT *ZEROS                                    CPM005
     C                     Z-SUBWWMVL1    QFLIVL                          CPM005
     C                     MOVEL'L'       QFASLI                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADD*ZEROS    QFLIVL                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
     C*
      /EJECT
     C********************************************************************
     C*
     C*  ZFFFLN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR FUTURE & OPTIONS
     C*
     C*  FORMAT: XXX MMMYY X 9999.999
     C*          XXX = INSTRUMENT CURRENCY
     C*          MMMYY = MONTH/YEAR
     C*          X = PUT/CALL INDICATOR
     C*          999.9999 = STRIKE PRICE
     C*
     C*  INPUT  FIELDS
     C*       ZISCY   3A     INSTRUMENT CURRENCY
     C*       ZMTHN   20     MONTH NUMBER
     C*       ZYRNO   20     YEAR NUMBER
     C*       ZPCAL   1A     PUT/CALL INDICATOR
     C*       ZSTRP  117     STRIKE PRICE
     C*
     C*  OUTPUT  FIELDS
     C*       ZLIN   20A     LINE DESCRIPTION
     C*
     C*  ARRAY USED
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFFFLN    BEGSR                           *** ZFFFLN ***
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C** MOVE INTRUMENT CURRENCY TO LINE DESCRIPTION
     C                     MOVEAZISCY     ZLI,01
     C*                                                                   59581
     C** IF MARKET INSTRUMENT, RETRIEVE DATE                              59581
     C           ISTI      IFEQ 'N'                                       59581
     C*
     C** MOVE MONTH NAME TO LINE DESCRIPTION
     C                     Z-ADDZMTHN     ZC      30
     C           ZC        IFNE 0                                         61230
     C                     MOVEAZMNM,ZC   ZWRKA3
     C                     ELSE                                           61230
     C                     MOVE *BLANKS   ZWRKA3                          61230
     C                     END                                            61230
     C                     MOVEAZWRKA3    ZLI,05
     C*
     C** MOVE YEAR  NAME TO LINE DESCRIPTION
     C                     MOVE ZYRNO     ZWRKA2  2
     C                     MOVEAZWRKA2    ZLI,08
     C                     END                                            59581
     C*
     C** MOVE PUT/CALL INDICATOR TO LINE DESCRIPTION
     C                     MOVEAZPCAL     ZLI,11
     C*
     C** IF OPTION (STRIKE PRICE NOT ZERO) OUTPUT STRIKE PRICE IN ARRAY
     C** OTHERWISE LEAVE SECTION OF ARRAY BLANK
     C           ZSTRP     IFNE 0
     C*
     C*****************    Z-ADDZSTRP     ZWRKN   74                      61297
     C*****************    MOVELZWRKN     ZWRKA3  3                       61297
     C*****************    MOVELZWRKA3    ZWRKA2  2                       61297
     C                     Z-ADDZSTRP     ZWRKN   84                      61297
     C                     MOVELZWRKN     ZWRKA3  4                       61297
     C                     MOVELZWRKA3    ZWRKC2  3                       61297
     C                     MOVELZWRKC2    ZWRKB2  2                       61297
     C*
     C** SUPRESS LEADING ZEROES
     C***********ZWRKA2    IFEQ '00'                                      61297
     C***********          MOVEL'  '      ZWRKA3                          61297
     C           ZWRKC2    IFEQ '000'                                     61297
     C                     MOVEL'   '     ZWRKA3                          61297
     C                     END
     C           ZWRKB2    IFEQ '00'                                      61297
     C                     MOVEL'  '      ZWRKA3                          61297
     C                     END                                            61297
     C*
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C                     MOVE ZWRKN     ZWRKA4  4
     C******************** MOVEAZWRKA3    ZLI,13                          61297
     C                     MOVEAZWRKA3    ZLI,12                          61297
     C                     MOVEA'.'       ZLI,16
     C                     MOVEAZWRKA4    ZLI,17
     C                     END
     C*
     C** SET ALL   FIELDS TO BLANKS OR ZEROS
     C                     MOVE *BLANKS   ZISCY   3
     C                     Z-ADD*ZEROS    ZYRNO   20
     C                     Z-ADD*ZEROS    ZMTHN   20
     C                     MOVE *BLANKS   ZPCAL   1
     C***********          Z-ADD*ZEROS    ZSTRP  117                      CFF004
     C           *LIKE     DEFN STRP      ZSTRP                           CFF004
     C                     Z-ADD*ZEROS    ZSTRP                           CFF044
     C*
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN   26                                           CGL029
     C*
     C                     ENDSR
     C**************************************************************************
     C/EJECT
     C****************************************************************    CPM003
     C*************                                                  *    CPM003
     C****SR:FFPLCL***-*CALCULATES*PROFIT*OR*LOSS*(*AND*EQUIVALENT****    CPM003
     C******************NET*TRANSACTION*VALUE*)*FOR*A*GIVEN***********    CPM003
     C******************NUMBER*OF*CONTRACTS*DUE*TO*A*PRICE************    CPM003
     C******************DIFFERENCE*BETWEEN*ONE*PRICE******************    CPM003
     C******************(*PRICE*X*)*AND*ANOTHER*(*PRICE*Y*)***********    CPM003
     C*************                                                  *    CPM003
     C****CALLS*ST*S/R-*FFTVCL****************************************    CPM003
     C*************                                                  *    CPM003
     C****INPUTS******-*FFNOC***(5,0P)*NUMBER*OF*CONTRACTS************    CPM003
     C******************FFPRCX*(11,7P)*PRICE*X************************    CPM003
     C******************FFPRCY*(11,7P)*PRICE*Y************************    CPM003
     C******************FFTKDM**(3,0P)*TICKS*DENOMINATOR**************    CPM003
     C******************FFMNPF*(11,7P)*MINIMUM*PRICE*FLUCTUATION******    CPM003
     C******************FFTKVL*(14,5P)*TICK*VALUE*********************    CPM003
     C****OUTPUTS*****-*FFPOL**(13,0P)*PROFIT*OR*LOSS*(HALF*ADJUSTED)*    CPM003
     C******************FFNTVL*(13,0P)*NET*TRANSACTION*VALUE**********    CPM003
     C*************                                                  *    CPM003
     C****************************************************************    CPM003
     C*************                                                       CPM003
     C***********FFPLCL    BEGSR                                          CPM003
     C*************                                                       CPM003
     C*************        Z-ADDFFNOC     FFNOC   50                      CPM003
     C*************        Z-ADDFFPRCX    FFPRCX 117                      CPM003
     C*************        Z-ADDFFPRCY    FFPRCY 117                      CPM003
     C*************        Z-ADDFFTKDM    FFTKDM  30                      CPM003
     C*************        Z-ADDFFMNPF    FFMNPF 117                      CPM003
     C*************        Z-ADDFFTKVL    FFTKVL 145                      CPM003
     C*************                                                       CPM003
     C*************        Z-ADD0         FFPOL  130                      CPM003
     C*************        Z-ADD0         FFNTVL 130                      CPM003
     C*************                                                       CPM003
     C****Calculate*the*Transaction*Value*for*PRICE*X*****************    CPM003
     C*************                                                       CPM003
     C*************        Z-ADDFFPRCX    FFPRIC                          CPM003
     C*************        EXSR FFTVCL                                    CPM003
     C*************        Z-ADDFFTNVL    FFNTVL                          CPM003
     C*************                                                       CPM003
     C*************                                                       CPM003
     C****Calculate*the*Transaction*Value*for*PRICE*Y*and*************    CPM003
     C****subtract*it*from*the*Transaction*Value*for*PRICE*X**********    CPM003
     C****to*get*the*Net*Transaction*Value****************************    CPM003
     C*************                                                       CPM003
     C*************        Z-ADDFFPRCY    FFPRIC                          CPM003
     C*************        EXSR FFTVCL                                    CPM003
     C*************        SUB  FFTNVL    FFNTVL                          CPM003
     C*************                                                       CPM003
     C****Calculate*Profit*or*Loss*by*multiplying*the*****************    CPM003
     C****Net*Transaction*Value*by*the*Tick*Value*********************    CPM003
     C*************                                                       CPM003
     C***********FFNTVL    MULT FFTKVL    FFPOL     H                     CPM003
     C*************                                                       CPM003
     C*************        ENDSR                                          CPM003
     C*************                                                       CPM003
     C*****************************************************************   CPM003
     C***/EJECT*******                                                    CPM003
     C*****************************************************************   CPM003
     C*************                                                  *    CPM003
     C****SR:FFTVCL***-*CALCULATES*TRANSACTION*VALUE*FOR*A*************   CPM003
     C******************GIVEN*NUMBER*OF*CONTRACTS*AT*A*GIVEN***********   CPM003
     C******************PRICE*IN*UNITS*OF*THE*APPROPRIATE**************   CPM003
     C******************TICKS*DENOMINATOR*OR*MINIMUM*PRICE*************   CPM003
     C******************FLUCTUATION*(*DEPENDING*ON*WHETHER*THE*********   CPM003
     C******************TICKS*DENOMINATOR*IS*100*)*********************   CPM003
     C*************                                                  *    CPM003
     C****INPUTS******-*FFNOC***(5,0P)*NUMBER*OF*CONTRACTS*************   CPM003
     C******************FFPRIC*(11,7P)*PRICE***************************   CPM003
     C******************FFTKDM**(3,0P)*TICKS*DENOMINATOR***************   CPM003
     C******************FFMNPF*(11,7P)*MINIMUM*PRICE*FLUCTUATION*******   CPM003
     C****OUTPUTS*****-*FFTNVL*(13,0P)*TRANSACTION*VALUE***************   CPM003
     C*************                                                  *    CPM003
     C*****************************************************************   CPM003
     C***********                                                         CPM003
     C***********FFTVCL    BEGSR                                          CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFNOC     FFNOC   50                      CPM003
     C***********          Z-ADDFFPRIC    FFPRIC 117                      CPM003
     C***********          Z-ADDFFTKDM    FFTKDM  30                      CPM003
     C***********          Z-ADDFFMNPF    FFMNPF 117                      CPM003
     C***********                                                         CPM003
     C***********          Z-ADD0         FFTNVL 130                      CPM003
     C***********                                                         CPM003
     C****If*the*Ticks*Denominator*is*equal*to*100*********************   CPM003
     C***********                                                         CPM003
     C***********FFTKDM    IFEQ 100                                       CPM003
     C***********                                                         CPM003
     C****Divide*Price*by*Min*Price*Fluctuation************************   CPM003
     C***********                                                         CPM003
     C***********FFPRIC    DIV  FFMNPF    FFNOTK 110                      CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C****Multiply*integer*of*Price*by*the*Ticks*Denominator***********   CPM003
     C***********                                                         CPM003
     C***********FFINTG    MULT FFTKDM    FFNOTK                          CPM003
     C***********                                                         CPM003
     C****The*remaining*fraction*of*the*Price*should*be*added*to*the***   CPM003
     C****result*of*Price*integer*X*Ticks*Denominator******************   CPM003
     C***********                                                         CPM003
     C****If*Ticks*Denominator*is*between*1*&*10*use*1st*dec*place*****   CPM003
     C***********                                                         CPM003
     C***********FFTKDM    IFLE 10                                        CPM003
     C***********          ADD  FFDCN1    FFNOTK                          CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C****If*Ticks*Denominator*is*between*11*&*99*use*1-2nd*dec*places*   CPM003
     C***********                                                         CPM003
     C***********FFTKDM    IFLE 99                                        CPM003
     C***********          ADD  FFDCN2    FFNOTK                          CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C***If*Ticks*Denominator*is*between*101*&*999*use*1-3rd*dec*places   CPM003
     C***********                                                         CPM003
     C***********          ADD  FFDCN3    FFNOTK                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***Multiply*the*number*of*ticks*by*the*number*of*contracts*******   CPM003
     C***********                                                         CPM003
     C***********FFNOTK    MULT FFNOC     FFTNVL                          CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C********S71062 BEGIN *****************************************************
     C***/EJECT*******                                                    CPM003
     C*****************************************************************   CPM003
     C***********                                                    *    CPM003
     C****SR:FFPMCL***-*CALCULATES*PREMIUM*PAYABLE*********************   CPM003
     C******************ON*A*GIVEN*NUMBER*OF*CONTRACTS*****************   CPM003
     C******************AT*A*GIVEN*CONTRACT*PRICE**********************   CPM003
     C***********                                                    *    CPM003
     C****INPUTS******-*FFNOC***(5,0P)*NUMBER*OF*CONTRACTS*************   CPM003
     C******************FFPRIC*(11,7P)*PRICE***************************   CPM003
     C******************FFTKDM**(3,0P)*TICKS*DENOMINATOR***************   CPM003
     C******************FFMNPF*(11,7P)*MINIMUM*PRICE*FLUCTUATION*******   CPM003
     C******************FFTKVL*(14,5P)*TICK*VALUE**********************   CPM003
     C****OUTPUTS*****-*FFPREM*(13,0P)*PREMIUM*(HALF*ADJUSTED)*********   CPM003
     C***********                                                    *    CPM003
     C*****************************************************************   CPM003
     C***********                                                         CPM003
     C***********FFPMCL    BEGSR                                          CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFNOC     FFNOC   50                      CPM003
     C***********          Z-ADDFFPRIC    FFPRIC 117                      CPM003
     C***********          Z-ADDFFTKDM    FFTKDM  30                      CPM003
     C***********          Z-ADDFFMNPF    FFMNPF 117                      CPM003
     C***********          Z-ADDFFTKVL    FFTKVL 145                      CPM003
     C***********                                                         CPM003
     C***********          Z-ADD0         FFPREM 130                      CPM003
     C***********                                                         CPM003
     C****Calculate*the*Transaction*Value******************************   CPM003
     C***********                                                         CPM003
     C***********          EXSR FFTVCL                                    CPM003
     C***********                                                         CPM003
     C****Calculate*Premium*Payable*by*multiplying*********************   CPM003
     C****the*Transaction*Value*by*the*Tick*Value**********************   CPM003
     C***********                                                         CPM003
     C***********FFTNVL    MULT FFTKVL    FFPREM    H                     CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT*******                                                    CPM003
     C********************************************************************CPM003
     C***********                                                        *CPM003
     C***ZBAKRT*SR.*TO*DETERMINE*THE*FX*RATE*BETWEEN*TWO*CURRENCIES*******CPM003
     C***ON*A*DATE*IN*THE*PAST.*THE*RATE*RETURNED*IS*ALWAYS*A*MULTIPLY****CPM003
     C***RATE*BETWEEN*THE*FROM*CURRENCY*AND*THE*TO*CURRENCY.**************CPM003
     C***********                                                        *CPM003
     C***INPUT**FIELDS****************************************************CPM003
     C********ZCCYF***3A*****FROM*CURRENCY********************************CPM003
     C********ZCCYT***3A*****TO*CURRENCY**********************************CPM003
     C********ZSDATE**50*****PAST*DATE************************************CPM003
     C***********                                                        *CPM003
     C***OUTPUT**FIELDS***************************************************CPM003
     C********ZCRSRT*138*****PAST*FX*RATE*BETWEEN*FROM*AND*TO*CURRENCIES**CPM003
     C********ZERROR**1A*****DATABASE*ERROR*IN*SUBROUTINE*****************CPM003
     C***********                                                        *CPM003
     C***INPUT**FILE******************************************************CPM003
     C********LF/PMHSEXPP****HISTORIC*FX*RATES****************************CPM003
     C***********                                                        *CPM003
     C***********                                                        *CPM003
     C***CALLS:***********************************************************CPM003
     C********ZCCYCN******************************************************CPM003
     C***********                                                        *CPM003
     C***CALLED*BY:*******************************************************CPM003
     C***********                                                        *CPM003
     C********************************************************************CPM003
     C***********ZBAKRT    BEGSR                           *** ZBAKRT ****CPM003
     C***********                                                         CPM003
     C***DEFINE*ALL*FIELDS************************************************CPM003
     C***********          MOVE ZCCYF     ZCCYF   3                       CPM003
     C***********          MOVE ZCCYT     ZCCYT   3                       CPM003
     C***********          Z-ADDZSDATE    ZSDATE  50                      CPM003
     C***********          Z-ADDZCRSRT    ZCRSRT 138                      CPM003
     C***********          MOVE 'N'       ZERROR  1                       CPM003
     C***********                                                         CPM003
     C***********ZWKEY     KLIST                                          CPM003
     C***********          KFLD           ZWCCY   3                       CPM003
     C***********          KFLD           ZWDATE  50                      CPM003
     C***********                                                         CPM003
     C***GET*PAST*RATE*FOR*'FROM'*CURRENCY********************************CPM003
     C***********          MOVE ZCCYF     ZWCCY                           CPM003
     C***********          Z-ADDZSDATE    ZWDATE                          CPM003
     C***********ZWKEY     SETGTPMHSEXPP                                  CPM003
     C***********          READPPMHSEXPP                 90               CPM003
     C***********                                                         CPM003
     C************IN90     IFEQ '1'                                       CPM003
     C***********Q8CCY     ORNE ZCCYF                                     CPM003
     C***********          MOVE *LOVAL    ZWDATE                          CPM003
     C***********ZWKEY     SETLLPMHSEXPP                                  CPM003
     C***********          READ PMHSEXPP                 90               CPM003
     C************IN90     IFEQ '1'                                       CPM003
     C***********Q8CCY     ORNE ZCCYF                                     CPM003
     C***********          MOVE 'Y'       ZERROR                          CPM003
     C***********          END                                            CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          Z-ADDQ8SPOT    ZRATEF                          CPM003
     C***********          MOVE Q8MDV1    ZMDINF                          CPM003
     C***********          Z-ADDQ8CDP     ZCDPF                           CPM003
     C***********                                                         CPM003
     C***GET*PAST*RATE*FOR*'TO'*CURRENCY**********************************CPM003
     C***********          MOVE ZCCYT     ZWCCY                           CPM003
     C***********          Z-ADDZSDATE    ZWDATE                          CPM003
     C***********ZWKEY     SETGTPMHSEXPP                                  CPM003
     C***********          READPPMHSEXPP                 90               CPM003
     C***********                                                         CPM003
     C************IN90     IFEQ '1'                                       CPM003
     C***********Q8CCY     ORNE ZCCYT                                     CPM003
     C***********          MOVE *LOVAL    ZWDATE                          CPM003
     C***********ZWKEY     SETLLPMHSEXPP                                  CPM003
     C***********          READ PMHSEXPP                 90               CPM003
     C************IN90     IFEQ '1'                                       CPM003
     C***********Q8CCY     ORNE ZCCYT                                     CPM003
     C***********          MOVE 'Y'       ZERROR                          CPM003
     C***********          END                                            CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          Z-ADDQ8SPOT    ZRATET                          CPM003
     C***********          MOVE Q8MDV1    ZMDINT                          CPM003
     C***********          Z-ADDQ8CDP     ZCDPT                           CPM003
     C***********                                                         CPM003
     C***CALCULATE*CROSS*RATE*********************************************CPM003
     C***********          EXSR ZCCYCN                                    CPM003
     C***********                                                         CPM003
     C***********ZCRSMD    IFEQ 'D'                                       CPM003
     C***********1         DIV  ZCRSRT    ZCRSRT                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********BAKEND    ENDSR                                          CPM003
     C********************************************************************CPM003
     C***/EJECT*******                                                    CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C*****ZDATE1*SR.*TO*VALIDATE*DATES*SUBMITTED*AND*********************CPM003
     C****************CONVERT*TO*A*NUMBER*OF*DAYS.************************CPM003
     C***********                                                         CPM003
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********CPM003
     C***********                                                         CPM003
     C***********ZDATE1****BEGSR*******************************ZDATE1*****CPM003
     C***********                                                         CPM003
     C*****CLEAR*DAY*NUMBER.*RESET*ERROR*INDICATOR************************CPM003
     C***********          Z-ADD0         ZDAYNO  50                      CPM003
     C***********          SETOF                     99                   CPM003
     C***********                                                         CPM003
     C*****CALCULATION*TO*DEFINE*INPUT*DATE*FIELD.************************CPM003
     C***********          Z-ADDZDATE     ZDATE   60                      CPM003
     C***********                                                         CPM003
     C*****GET*INDIVIDUAL*DAY,*MONTH*AND*YEAR*FIELDS.*********************CPM003
     C***********          MOVE ZDATE     ZYEAR   20                      CPM003
     C**N98******          MOVELZDATE     ZDAY    20                      CPM003
     C***98******          MOVELZDATE     ZMTH    20                      CPM003
     C***********          MOVE ZDATE     ZWRK4   40                      CPM003
     C**N98******          MOVELZWRK4     ZMTH                            CPM003
     C***98******          MOVELZWRK4     ZDAY                            CPM003
     C***********                                                         CPM003
     C*****ENSURE*MONTH*IS*VALID.*BYPASS*IF*ERROR*************************CPM003
     C***********ZMTH      IFLE 0                                         CPM003
     C***********ZMTH      ORGT 12                                        CPM003
     C***********          SETON                     99                   CPM003
     C***********          GOTO ZDEND1                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****ENSURE*DAY*IS*VALID.*BYPASS*IF*ERROR***************************CPM003
     C***********ZDAY      IFLE 0                                         CPM003
     C***********          SETON                     99                   CPM003
     C***********          GOTO ZDEND1                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CHECK*FOR*30*DAY*MONTHS.*BYPASS*IF*ERROR***********************CPM003
     C***********ZMTH      IFEQ 4                                         CPM003
     C***********ZMTH      OREQ 6                                         CPM003
     C***********ZMTH      OREQ 9                                         CPM003
     C***********ZMTH      OREQ 11                                        CPM003
     C***********                                                         CPM003
     C***********ZDAY      IFGT 30                                        CPM003
     C***********          SETON                     99                   CPM003
     C***********          GOTO ZDEND1                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****CHECK*FOR*31*DAY*MONTHS*(ALL*OTHERS*BUT*FEB).*BYPASS*IF*ERROR**CPM003
     C***********ZDAY      IFGT 31                                        CPM003
     C***********ZMTH      ANDNE2                                         CPM003
     C***********          SETON                     99                   CPM003
     C***********          GOTO ZDEND1                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CHECK*FOR*LEAP*YEAR:*REMAINDER*WILL*BE*ZERO*IF*IT*IS*A*LEAP*YR*CPM003
     C***********ZYEAR     ADD  28        ZYEAR                           CPM003
     C***********ZYEAR     DIV  4         ZLYR    20                      CPM003
     C***********          MVR            ZLY     10                      CPM003
     C***********                                                         CPM003
     C*****IF*FEBUARY*FURTHER*VALIDATE*DAY.*******************************CPM003
     C***********ZMTH      IFEQ 2                                         CPM003
     C***********                                                         CPM003
     C*****INVALID*IF*GREATER*THAN*28*AND*NOT*A*LEAP*YEAR*****************CPM003
     C***********ZLY       IFGT 0                                         CPM003
     C***********ZDAY      ANDGT28                                        CPM003
     C***********          SETON                     99                   CPM003
     C***********          GOTO ZDEND1                     BYPASS IF ERRORCPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****INVALID*IF*GREATER*THAN*29*AND*A*LEAP*YEAR*-*BYPASS*IF*ERROR***CPM003
     C***********ZLY       IFEQ 0                                         CPM003
     C***********ZDAY      ANDGT29                                        CPM003
     C***********          SETON                     99                   CPM003
     C***********          GOTO ZDEND1                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****DETERMINE*NUMBER*OF*DAYS*FROM*31/12/1971.**********************CPM003
     C***********                                                         CPM003
     C*****MULTIPLY*NO.*OF*FOUR-YEAR*SPANS,*BY*NO.*OF*DAYS*IN*SPAN********CPM003
     C***********ZLYR      MULT 1461      ZDAYNO                          CPM003
     C***********                                                         CPM003
     C*****IF*NOT*A*LEAP*YEAR,*ADD*APPROPRIATE*NO.*OF*DAYS*FOR*EXTRA******CPM003
     C*****YEARS*USING*REMAINDER*FIELD*(IE.*1,*2*OR*3*X*356)**************CPM003
     C***********ZLY       IFGT 0                                         CPM003
     C***********ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****IF*IT*IS*A*LEAP*YEAR,*AND*LATER*THAN*FEBRUARY,*ADD*ONE*FOR*****CPM003
     C*****29TH*OF*FEB****************************************************CPM003
     C***********ZLY       IFEQ 0                                         CPM003
     C***********ZMTH      ANDGT2                                         CPM003
     C***********ZDAYNO    ADD  1         ZDAYNO                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****ADD*APPROPRIATE*NUMBER*OF*DAYS*FOR*THE*MONTH*NUMBER************CPM003
     C***********ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO                          CPM003
     C***********                                                         CPM003
     C*****ADD*NUMBER*OF*DAYS*IN*MONTH************************************CPM003
     C***********ZDAYNO    ADD  ZDAY      ZDAYNO                          CPM003
     C***********                                                         CPM003
     C***********ZDEND1    ENDSR                           * ZDEND1 ENDSR*CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT*******                                                    CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C*****ZDATE2*SR.*TO*CONVERT*A*DAY*NUMBER*TO*DATE*FORMATS.************CPM003
     C***********                                                         CPM003
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********CPM003
     C***********                                                         CPM003
     C***********ZDATE2    BEGSR                           *** ZDATE2 *** CPM003
     C***********                                                         CPM003
     C*****CLEAR*LEAP*YEAR*WORK*FIELD.************************************CPM003
     C***********          MOVE 'N'       ZLEAP   1                       CPM003
     C***********                                                         CPM003
     C*****CLEAR*DATE*FIELDS.*********************************************CPM003
     C***********          Z-ADD0         ZDATE   60                      CPM003
     C***********          MOVEL'       ' ZADATE  7                       CPM003
     C***********                                                         CPM003
     C*****CALCULATION*TO*DEFINE*INPUT*DAY*NUMBER.************************CPM003
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      CPM003
     C***********                                                         CPM003
     C*****DETERMINE*YEAR*NUMBER.*****************************************CPM003
     C***********                                                         CPM003
     C*****ADJUST*DAY*NUMBER*IN*CASE*LAST*DAY*OF*YEAR.********************CPM003
     C***********ZDAYNO    SUB  1         ZDAYN1  50                      CPM003
     C***********ZDAYN1    IFLT 0                                         CPM003
     C***********          GOTO ZDEND2                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CALCULATE*NUMBER*OF*4*YEAR*SPANS*SINCE*31/12/1971.*************CPM003
     C***********ZDAYN1    DIV  1461      ZLYR    20                      CPM003
     C***********          MVR            ZDAYN1           SAVE REMAINING CPM003
     C***********                                          DAYS           CPM003
     C*****CALCULATE*NUMBER*OF*REMAINING*YEARS.***************************CPM003
     C***********          Z-ADD1         ZWRK2   20                      CPM003
     C***********ZDTAG1    TAG                             ** ZDTAG1 TAG *CPM003
     C***********ZDAYN1    IFGE ZYDY,ZWRK2                                CPM003
     C***********ZWRK2     ADD  1         ZWRK2                           CPM003
     C***********          GOTO ZDTAG1                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********ZWRK2     SUB  1         ZWRK2                           CPM003
     C***********                                                         CPM003
     C*****DECREMENT*DAY*NO.*BY*DAYS*IN*REMAINING*YEARS.******************CPM003
     C***********ZWRK2     IFNE 0                                         CPM003
     C***********ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CALCULATE*ACTUAL*YEAR*NUMBER.**********************************CPM003
     C***********ZLYR      MULT 4         ZWRK3   30                      CPM003
     C***********ZWRK3     ADD  72        ZWRK3            BASE IS 1972   CPM003
     C***********          Z-ADDZWRK3     ZYEAR   20                      CPM003
     C***********ZYEAR     ADD  ZWRK2     ZYEAR            YEAR           CPM003
     C***********                                                         CPM003
     C*****DETERMINE*MONTH*NUMBER.****************************************CPM003
     C***********                                                         CPM003
     C*****ADJUST*DAY*NO.*IN*CASE*LAST*DAY*OF*LEAP*YEAR*FEBRUARY.*********CPM003
     C***********ZWRK2     IFEQ 0                                         CPM003
     C***********ZDAYN1    IFEQ 59                                        CPM003
     C***********          MOVE 'Y'       ZLEAP                           CPM003
     C***********          END                                            CPM003
     C***********ZDAYN1    IFGE 59                                        CPM003
     C***********ZDAYN1    SUB  1         ZDAYN1                          CPM003
     C***********          END                                            CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CALCULATE*MONTH*NUMBER.****************************************CPM003
     C***********          Z-ADD2         ZWRK2                           CPM003
     C***********ZDTAG2    TAG                             ** ZDTAG2 TAG *CPM003
     C***********ZDAYN1    IFGE ZMDY,ZWRK2                                CPM003
     C***********ZWRK2     ADD  1         ZWRK2                           CPM003
     C***********          GOTO ZDTAG2                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********ZWRK2     SUB  1         ZWRK2                           CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZWRK2     ZMTH    20       MONTH          CPM003
     C***********                                                         CPM003
     C*****DETERMINE*DAY*OF*MONTH.****************************************CPM003
     C***********                                                         CPM003
     C*****ADD*BACK*LAST*DAY*OF*YEAR*ADJUSTMENT.**************************CPM003
     C***********ZDAYN1    ADD  1         ZDAYN1                          CPM003
     C***********                                                         CPM003
     C*****CALCULATE*DAY*OF*MONTH.****************************************CPM003
     C***********ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY            CPM003
     C***********                                                         CPM003
     C*****ADD*BACK*LEAP*YEAR*29TH*FEBUARY*ADJUSTMENT,*IF*REQUIRED.*******CPM003
     C***********ZLEAP     IFEQ 'Y'                                       CPM003
     C***********ZDAY      ADD  1         ZDAY                            CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****FORMAT*DATE,*DDMMYY*OR*MMDDYY.*********************************CPM003
     C**N98******          MOVELZDAY      ZWRK4   40                      CPM003
     C***98******          MOVE ZDAY      ZWRK4                           CPM003
     C**N98******          MOVE ZMTH      ZWRK4                           CPM003
     C***98******          MOVELZMTH      ZWRK4                           CPM003
     C***********          MOVELZWRK4     ZDATE                           CPM003
     C***********          MOVE ZYEAR     ZDATE                           CPM003
     C***********                                                         CPM003
     C*****FORMAT*ALPHA*DATE,*DDMMMYY.************************************CPM003
     C***********          MOVELZDAY      ZWRK5   5                       CPM003
     C***********ZDAY      IFLT 10                                        CPM003
     C***********          MOVEL' '       ZWRK5                           CPM003
     C***********          END                                            CPM003
     C***********          MOVE ZMNM,ZMTH ZWRK5                           CPM003
     C***********          MOVELZWRK5     ZADATE                          CPM003
     C***********          MOVE ZYEAR     ZADATE                          CPM003
     C***********                                                         CPM003
     C***********ZDEND2    ENDSR                           * ZDEND2 ENDSR*CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
      /EJECT
      /COPY ZSRSRC,ZFWDT                                                  CPM003
      /EJECT                                                              CPM003
      /COPY ZSRSRC,ZACCH                                                  CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C*****ZDATE3*SR.*TO*CALCULATE*ANY*NUMBER*OF*WORKING******************CPM003
     C****************DAYS*FORWARD*IN*ANY*CURRENCY.***********************CPM003
     C****************HOLIDAYS*FILE*ACCESSED*BY*CHAIN.********************CPM003
     C***********                                                         CPM003
     C***********ZDATE3    BEGSR                           *** ZDATE3 *** CPM003
     C***********                                                         CPM003
     C*****CALCULATIONS*TO*DEFINE*INPUT*FIELDS.***************************CPM003
     C***********          Z-ADDZDAYNO    ZDAYNO  50       STARTING DATE  CPM003
     C***********          MOVE ZCCY      ZCCY    3        DATE CURRENCY  CPM003
     C***********          Z-ADDZNRDYS    ZNRDYS  20       NBR OF WORKING CPM003
     C***********                                          DAYS FORWARD   CPM003
     C*****CLEAR*COUNT*OF*NBR*OF*DAYS*ADDED,*&*DEFINE*ZDYNBR.*************CPM003
     C***********          Z-ADD0         ZDCNT   20                      CPM003
     C***********          Z-ADDZDAYNO    ZDYNBR  50                      CPM003
     C***********                                                         CPM003
     C*****LOOP*TO*INCREMENT*DAY*NUMBER*AND*CHECK*FOR*HOLIDAY.************CPM003
     C***********ZDCNT     DOWLTZNRDYS                                    CPM003
     C***********                                                         CPM003
     C***********          ADD  1         ZDYNBR                          CPM003
     C***********                                                         CPM003
     C*****CHAIN*FOR*HOLIDAY*RECORD*1*-*IF*NOT*FOUND,*NO*HOLIDAY**********CPM003
     C***********ZDYNBR    CHAINTABLETJF             90                   CPM003
     C************IN90     IFEQ '1'                                       CPM003
     C***********RECI      ORNE 'D'                                       CPM003
     C***********          ADD  1         ZDCNT                           CPM003
     C***********          GOTO ZDLOP1                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*DAY*IS*HOLIDAY*FOR*CURRENCY.**************************CPM003
     C***********ZCCY      LOKUPHCCY                     93               CPM003
     C***********                                                         CPM003
     C*****DETERMINE*TYPE*FOUND,*IF*INCLUDE*AND*NOT*IN*ARRAY/EXCLUDE*AND**CPM003
     C*****IN*ARRAY,*THEN*MUST*CHAIN*TO*RECORD*2*TO*SEE*IF*IT*IS*A*HOL.***CPM003
     C***********INEX      IFEQ 'E'                                       CPM003
     C************IN93     ANDEQ'1'                                       CPM003
     C***********INEX      OREQ 'I'                                       CPM003
     C************IN93     ANDEQ'0'                                       CPM003
     C***********                                                         CPM003
     C*****IF*BLANK*ENTRIES*IN*HCCY,*THEN*NO*RECORD*2*WILL*BE*PRESENT*****CPM003
     C***********'   '     LOKUPHCCY                     94ON IF NO RCD.2 CPM003
     C************IN94     IFEQ '1'                                       CPM003
     C***********          ADD  1         ZDCNT                           CPM003
     C***********          GOTO ZDLOP1                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CHAIN*FOR*HOLIDAY*RECORD,*RECORD*2*****************************CPM003
     C***********          READ TABLETJF                 90               CPM003
     C************IN90     IFEQ '1'                                       CPM003
     C***********RECI      ORNE 'D'                                       CPM003
     C***********HOL       ORNE ZDYNBR                                    CPM003
     C***********          ADD  1         ZDCNT                           CPM003
     C***********          GOTO ZDLOP1                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*DAY*IS*HOLIDAY*FOR*CURRENCY.**************************CPM003
     C***********ZCCY      LOKUPHCCY                     93               CPM003
     C***********                                                         CPM003
     C*****DETERMINE*TYPE*FOUND,*IF*INCLUDE*AND*NOT*IN*ARRAY/EXCLUDE*AND**CPM003
     C*****IN*ARRAY,*THEN*NOT*A*HOLIDAY***********************************CPM003
     C***********INEX      IFEQ 'E'                                       CPM003
     C************IN93     ANDEQ'1'                                       CPM003
     C***********INEX      OREQ 'I'                                       CPM003
     C************IN93     ANDEQ'0'                                       CPM003
     C***********ZDCNT     ADD  1         ZDCNT                           CPM003
     C***********          END                                            CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C****END*OF*DO*LOOP**************************************************CPM003
     C***********ZDLOP1    TAG                             *** ZDLOP1 *** CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
      /EJECT
     C********************************************************************CPM003
     C***********                                                    *    CPM003
     C****SR:ZDATE5***-*DETERMINES*IF*A*MIDAS*DAY*NUMBER*DATE*IS*A********CPM003
     C******************HOLIDAY*IN*A*GIVEN*CURRENCY,*AND*IF*IT*IS*********CPM003
     C******************DETERMINES*NEXT*WORKING*DAY*IF*REQUIRED.**********CPM003
     C***********                                                    *    CPM003
     C****INPUTS******-*ZDAYNO*(5,0P)*DAY*NO******************************CPM003
     C******************ZCCY***(3**A)*CURRENCY****************************CPM003
     C******************ZOPT***(1**A)*Y*OR*N******************************CPM003
     C****OUTPUTS*****-*ZDYNBR*(5,0P)*NEXT*WORKING*DAY*NO*****************CPM003
     C***********                                                    *    CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C***********ZDATE5    BEGSR                           ** ZDATE5 SR **CPM003
     C***********                                                         CPM003
     C*****Define*Input*fields.*******************************************CPM003
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      CPM003
     C***********          MOVE ZCCY      ZCCY    3                       CPM003
     C***********          MOVE ZOPT      ZOPT    1                       CPM003
     C***********                                                         CPM003
     C*****Define/Reset*Outputs.******************************************CPM003
     C***********          SETOF                     99                   CPM003
     C***********          Z-ADDZDAYNO    ZDYNBR  50                      CPM003
     C***********                                                         CPM003
     C*****DETERMINE*IF*HOLIDAY*******************************************CPM003
     C***********ZDHOL*    TAG                             ** ZDHOL TAG **CPM003
     C***********                                                         CPM003
     C*****CALCULATIONS*TO*DEFINE/CLEAR*WORKFIELDS.***********************CPM003
     C***********          SETOF                     90                   CPM003
     C***********          MOVE *BLANKS   ZHC                             CPM003
     C***********                                                         CPM003
     C*****SET*KEY*TO*CHAIN*TO*THE*FIRST*HOLIDAY*RECORD.******************CPM003
     C***********ZDYNBR    CHAINTABLETJF             90                   CPM003
     C***********                                                         CPM003
     C*****STORE*CURRENCIES*IF*RECORD*FOUND.******************************CPM003
     C************IN90     IFEQ '0'                                       CPM003
     C***********RECI      ANDEQ'D'                                       CPM003
     C***********          MOVEAHCCY      ZHC,1                           CPM003
     C***********          MOVE INEX      ZINEX   1                       CPM003
     C***********                                                         CPM003
     C*****SET*KEY*TO*CHAIN*TO*THE*FIRST*HOLIDAY*RECORD.******************CPM003
     C***********          READ TABLETJF                 90               CPM003
     C************IN90     IFEQ '0'                                       CPM003
     C***********RECI      ANDEQ'D'                                       CPM003
     C***********HOL       ANDEQZDYNBR                                    CPM003
     C***********          MOVEAHCCY      ZHC,26                          CPM003
     C***********          ELSE                                           CPM003
     C***********          MOVE ZINEX     INEX                            CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*CURRENCY*ON*HOLIDAY.**********************************CPM003
     C***********ZCCY      LOKUPZHC                      94               CPM003
     C************IN94     IFEQ '1'                                       CPM003
     C***********INEX      ANDEQ'I'                                       CPM003
     C************IN94*    OREQ '0'                                       CPM003
     C***********INEX      ANDEQ'E'                                       CPM003
     C***********          SETON                         99               CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*NEXT*WORKING*DAY*REQUIRED.****************************CPM003
     C***********ZOPT      IFEQ 'Y'                                       CPM003
     C***********ZDYNBR    ADD  1         ZDYNBR                          CPM003
     C***********          GOTO ZDHOL                                     CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
      /EJECT
      /COPY ZSRSRC,FFDATEZ3                                               CPM003
      /EJECT                                                              CPM003
      /COPY ZSRSRC,ZBKDT                                                  CPM003
      /EJECT                                                              CPM003
      /COPY ZSRSRC,ZCHKH                                                  CPM003
      /EJECT                                                              CPM003
     C********************************************************************CPM003
     C***********                                                     *  *CPM003
     C***FFDATE*SR.***TO*DETERMINE*THE*CORRECT*WORKING*DAY*AS*A*MIDAS*****CPM003
     C****************DAY*NUMBER*FOR*A*FORMULA*SPECIFIED*FOR*EACH*********CPM003
     C****************MARKET/INSTRUMENT*TYPE/YEAR/MONTH*******************CPM003
     C***********                                                     *   CPM003
     C****INPUT***:*FFDATC***DATE*FORMULA***********FORMAT*(7A)***********CPM003
     C**************FFMTH****MONTH*OF*REQD.*DATE****FORMAT*(2N)***********CPM003
     C**************FFYR*****YEAR*OF*REQD.*DATE*****FORMAT*(2N)***********CPM003
     C**************FFCCY1***MARKET*CURRENCY********FORMAT*(3A)***********CPM003
     C**************FFCCY2***INSTRUMENT*CURRENCY****FORMAT*(3A)***********CPM003
     C**************FFCCY3***OTHER*CURRENCY*********FORMAT*(3A)***********CPM003
     C***********                                                     *   CPM003
     C****OUTPUT**:*FFDAY****WORKING*DAY*DEFINED**************************CPM003
     C***********************BY*INPUT*FIELDS********FORMAT*(5N)***********CPM003
     C***********                                                     *   CPM003
     C****SUBROUTINES*USED:***********************************************CPM003
     C***********                                                     *   CPM003
     C**************FFDE31***CALC*LAST*WORKING*DAY*IN*MONTH***************CPM003
     C**************FFDN31***CALC*SPECIFIED*WORKING*DAY*IN*MONTH**********CPM003
     C**************FFDAAD***ADJUST*DAY*WITH*AN*ACTUAL*NO.*OF*DAYS********CPM003
     C**************FFDABD***ADJUST*DAY*WITH*NO.*OF*BUSINESS*DAYS*IN******CPM003
     C***********************MARKET*CENTRE*CCY****************************CPM003
     C**************FFDACD***ADJUST*DAY*WITH*NO.*OF*BUSINESS*DAYS*IN******CPM003
     C***********************MARKET*CENTRE*CCY*&*INST*CCY*&*OTHER*CCY*****CPM003
     C**************FFDAWD***ADJUST*DAY*WITH*BY*1*BUSINESS*DAY*IN*********CPM003
     C***********************MARKET*CENTRE*CCY*IF*NOT*A*WORKING*DAY*******CPM003
     C**************FFDCYH***DETERMINE*WHETHER*CCY*PASSED*IS*A*WORKING****CPM003
     C***********************DAY*FOR*THE*LAST*DAY*OUPUT*BY*ZDATE/5********CPM003
     C**************FFDAT3***CALCULATE*A*NO.*OF*WORKING*DAYS*BACK*********CPM003
     C***********************IN*A*GIVEN*CCY*******************************CPM003
     C**************FFDAT5***DETERMINE*WHETHER*A*DAY*IS*A*WORKING*DAY*****CPM003
     C***********************&*FIND*THE*PREV*WORKING*DAY*IF*IT*IS*NOT*****CPM003
     C********************************************************************CPM003
     C**************ZDATE1***CONVERT*A*DATE*TO*A*NO.*OF*DAYS**************CPM003
     C**************ZDATE3***CALCULATE*A*NO.*OF*WORKING*DAYS*FORWARDS*****CPM003
     C***********************IN*A*GIVEN*CCY*******************************CPM003
     C**************ZDATE5***DETERMINE*WHETHER*A*DAY*IS*A*WORKING*DAY*****CPM003
     C***********************&*FIND*THE*NEXT*WORKING*DAY*IF*IT*IS*NOT*****CPM003
     C***********                                                     *   CPM003
     C***********                                                     *   CPM003
     C***************IN85****USED/RESET*AS*WORK*INDICATOR*****************CPM003
     C***********                                                     *   CPM003
     C**NB.*THE*DATE*FORMULA*COMPRISES:*******ABCDEFG*******WHERE*********CPM003
     C****************************************-------*********************CPM003
     C***AB**=**BASE*DATE.***=**a)*DAY*NO.*IN*MONTH***********************CPM003
     C********************OR*=**b)*WEEK*NO.*AND*DAY*CODE******************CPM003
     C********************OR*=**c)*LAST*WORKING*DAY*IN*MONTH**("31")******CPM003
     C***********                                                     *   CPM003
     C***CDEFG*=*ADJUSTMENT***********************************************CPM003
     C***********                                                     *   CPM003
     C***********IF*NO*ADJUSTMENT*(DEFG*=**BLANKS)*AND*BASE*DATE*IS*******CPM003
     C***********a)*OR*b)*ABOVE,******************************************CPM003
     C***********                                                     *   CPM003
     C***C**=****"+"/"-"*FOR*NEXT/PREVIOUS*WORKING*DAY*IF*HOLIDAY*********CPM003
     C***********                                                     *   CPM003
     C***********OTHERWISE,*IF*ADJUSTMENT*SPECIFIED:**********************CPM003
     C***********                                                     *   CPM003
     C***C**=****"+"/"-"*NUMBER*OF*DAYS*FORWARDS/BACKWARDS****************CPM003
     C***********                                                     *   CPM003
     C***DE*=****NUMBER*OF*DAYS*******************************************CPM003
     C***********                                                     *   CPM003
     C***F**=****TYPE*OF*DAYS*TO*BE*COUNTED*******************************CPM003
     C**********************"A"*=*ACTUAL*DAYS*****************************CPM003
     C**********************"B"*=*BUSINESS*DAYS*IN*CCY1*******************CPM003
     C**********************"C"*=*BUSINESS*DAYS*IN*CCY1,CCY2*&*CCY3*******CPM003
     C***********                                                     *   CPM003
     C***G**=****"+"/"-"*FOR*NEXT/PREVIOUS*WORKING*DAY*IF*DAY*FROM********CPM003
     C***********F*IS*A*HOLIDAY**(*TYPE*"A"*ONLY*)************************CPM003
     C***********                                                     *   CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C***********FFDATE    BEGSR                           ***FFDATE****  CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****DEFINE/INITIALISE*FIELDS***************************************CPM003
     C***********                                                         CPM003
     C***********          MOVE FFDATC    FFDATC  7                       CPM003
     C***********          Z-ADDFFMTH     FFMTH   20                      CPM003
     C***********          Z-ADDFFYR      FFYR    20                      CPM003
     C***********          MOVE FFCCY1    FFCCY1  3                       CPM003
     C***********          MOVE FFCCY2    FFCCY2  3                       CPM003
     C***********          MOVE FFCCY3    FFCCY3  3                       CPM003
     C***********                                                         CPM003
     C***********          Z-ADD0         FFDAY   50                      CPM003
     C***********                                                         CPM003
     C************LIKE     DEFN FFMTH     FFTM                            CPM003
     C************LIKE     DEFN FFYR      FFYRW                           CPM003
     C************LIKE     DEFN FFDAY     DUMP                            CPM003
     C************LIKE     DEFN FFDAY     FFMDY                           CPM003
     C************LIKE     DEFN FFDAY     FFMDY1                          CPM003
     C************LIKE     DEFN FFDAY     FFMDY2                          CPM003
     C************LIKE     DEFN FFDAY     FFMDY3                          CPM003
     C************LIKE     DEFN FFCCY1    FFCCYX                          CPM003
     C***********                                                         CPM003
     C****FIND*DAY*IN*MONTH***********************************************CPM003
     C****IF*'31'*SPECIFIED,*FIND*LAST*WORKING*DAY*IN*MONTH***************CPM003
     C****OTHERWISE*FIND*THE*DAY*SPECIFIED*BY*THE*DAY*NO.*OR*DAY*CODE*****CPM003
     C***********                                                         CPM003
     C***********FFAB      CASEQ'31'      FFDE31                          CPM003
     C***********FFAB      CASNE'31'      FFDN31                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CALCULATE*ADJUSTMENTS*SPECIFIED*TO*DATE************************CPM003
     C***********                                                         CPM003
     C*****ADJUSTMENTS*TO*DATE*NEED*TO*BE*MADE*IF*************************CPM003
     C*****1.**A*DAY*NO.*OR*CODE*WAS*SPECIFIED*(*AS*THIS*DAY*MAY*BE*A*****CPM003
     C*********HOLIDAY*OR*AN*ADJUSTMENT*MAY*HAVE*BEEN*SPECIFIED*)*********CPM003
     C*****OR*************************************************************CPM003
     C*****2.**'*MONTH*END*'*WAS*SPECIFIED*(*WHICH*WILL*BE*A*WORKING******CPM003
     C*********DAY*)*AND*AN*ADJUSTMENT*HAS*BEEN*SPECIFIED*****************CPM003
     C***********                                                         CPM003
     C***********FFAB      IFNE '31'                                      CPM003
     C***********FFAB      OREQ '31'                                      CPM003
     C***********FFDEF     ANDNE*BLANKS                                   CPM003
     C***********                                                         CPM003
     C*****DETERMINE*NO.*OF*DAYS*FORWARDS/BACKWARDS*DEPENDING*ON*CODE*****CPM003
     C**************I.E.*'A'*=*ACTUAL*DAYS********************************CPM003
     C**************I.E.*'B'*=*BUSINESS*DAYS*-*MARKET*CENTRE*CCY**********CPM003
     C**************I.E.*'C'*=*BUSINESS*DAYS*-*MKT.*CENTRE*&*INST.*CCY****CPM003
     C**************I.E.*'*'*=*NO*ADJUSTMENT******************************CPM003
     C*****NB**RESULT*WILL*BE*A*WORKING*DAY*******************************CPM003
     C*********(*BEFORE/AFTER*DAY*GIVEN*IF*HOLIDAY*-*DEP.*IF*+/-*CODE*)***CPM003
     C***********                                                         CPM003
     C***********FFDEF     IFNE *BLANK                                    CPM003
     C***********          MOVE FFDEA     FFDE    20                      CPM003
     C***********          ELSE                                           CPM003
     C***********          Z-ADD*ZERO     FFDE                            CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********FFF       CASEQ'A'       FFDAAD                          CPM003
     C***********FFF       CASEQ'B'       FFDABD                          CPM003
     C***********FFF       CASEQ'C'       FFDACD                          CPM003
     C***********FFF       CASEQ' '       FFDAWD                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT******                                                     CPM003
     C********************************************************************CPM003
     C***********                                                     *   CPM003
     C***FFDE31*SR.***CALLED*FROM*STANDARD*SUBROUTINE*FFDATE**************CPM003
     C****************CALCULATE*LAST*WORKING*DAY*IN*MONTH*****************CPM003
     C***********                                                     *   CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C***********FFDE31    BEGSR                           ****FFDE31***  CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****DETERMINE*MONTH*NUMBER*FOR*NEXT*MONTH**************************CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****IF*NOT*DECEMBER*NUMBER*FOR*NEXT*MONTH**************************CPM003
     C***********                                                         CPM003
     C***********FFMTH     IFNE 12                                        CPM003
     C***********FFMTH     ADD  1         FFTM                            CPM003
     C***********          Z-ADDFFYR      FFYRW                           CPM003
     C***********                                                         CPM003
     C*****IF*DECEMBER****************************************************CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********          Z-ADD1         FFTM                            CPM003
     C***********FFYR      ADD  1         FFYRW                           CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****DETERMINE*MIDAS*DAY*NUMBER*FOR*1ST*OF*NEXT*MONTH***************CPM003
     C***********                                                         CPM003
     C************IN98     IFEQ '1'                                       CPM003
     C***********          MOVE '01'      FFWRK4  40                      CPM003
     C***********          MOVELFFTM      FFWRK4                          CPM003
     C***********          ELSE                                           CPM003
     C***********          MOVE FFTM      FFWRK4                          CPM003
     C***********          MOVEL'01'      FFWRK4                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          MOVE FFYRW     ZDATE                           CPM003
     C***********          MOVELFFWRK4    ZDATE                           CPM003
     C***********                                                         CPM003
     C***********          EXSR ZDATE1                                    CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDAYNO    FFDAY                           CPM003
     C***********                                                         CPM003
     C*****SUBTRACT*1*TO*GET*LAST*DAY*OF*MONTH*REQUIRED*******************CPM003
     C***********                                                         CPM003
     C***********          SUB  1         FFDAY                           CPM003
     C***********                                                         CPM003
     C*****IF*THIS*IS*NOT*A*WORKING*DAY,*FIND*LAST*WORKING*DAY*IN*MONTH***CPM003
     C*****IN*THE*MARKET*CURRENCY*****************************************CPM003
     C***********                                                         CPM003
     C***********          MOVE FFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          MOVE 'Y'       ZOPT                            CPM003
     C***********          EXSR FFDAT5                                    CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    FFDAY                           CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT*****                                                      CPM003
     C********************************************************************CPM003
     C***********                                                     *   CPM003
     C***FFDN31*SR.***CALLED*FROM*STANDARD*SUBROUTINE*FFDATE**************CPM003
     C****************CALCULATE*THE*SPECIFIED*DAY*IN*MONTH****************CPM003
     C***********                                                     *   CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C***********FFDN31    BEGSR                           ****FFDN31***  CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C****CONVERT*THE*FIRST*TWO*CHARACTERS********************************CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C****DETERMINE*MIDAS*DATE*FOR*1ST*OF*MONTH***************************CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C************IN98     IFEQ '1'                                       CPM003
     C***********          MOVELFFMTH     FFWRK4                          CPM003
     C***********          MOVE '01'      FFWRK4                          CPM003
     C***********          ELSE                                           CPM003
     C***********          MOVE FFMTH     FFWRK4                          CPM003
     C***********          MOVEL'01'      FFWRK4                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          MOVELFFWRK4    ZDATE                           CPM003
     C***********          MOVE FFYR      ZDATE                           CPM003
     C***********                                                         CPM003
     C***********          EXSR ZDATE1                                    CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDAYNO    FFDAY                           CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C******DETERMINE*WHETHER*FIRST*TWO*CHARACTERS*ARE*DAY*NO.OR**********CPM003
     C******DAY*CODE******************************************************CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C***********FFB       LOKUPTABDY     TABNO          81               CPM003
     C***********                                                         CPM003
     C******IF*FIRST*TWO*CHARACTERS*ARE*DAY*CODE**************************CPM003
     C***********                                                         CPM003
     C************IN81     IFEQ '1'                                       CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C****DETERMINE*DAY*IN*THE*WEEK*FOR*THE*1ST*OF*THE*MONTH*FOR*A********CPM003
     C****GIVEN*MIDAS*DATE.***********************************************CPM003
     C****(*THIS*METHOD*IS*BASED*ON*THE*FACT*THAT*THE*DAY*OF*MIDAS*DAY****CPM003
     C****1*-*01/01/72*-*IS*KNOWN.**SEE*SD1050*)**************************CPM003
     C***********                                                         CPM003
     C***********FFDAY     DIV  7         DUMP                            CPM003
     C***********          MVR            FFDAYY  10                      CPM003
     C***********                                                         CPM003
     C****DETERMINE*THE*NO.*OF*DAYS*AFTER*1ST*OF*MONTH*AND*IT'S***********CPM003
     C*******MIDAS*DATE***************************************************CPM003
     C***********                                                         CPM003
     C***********          Z-ADDTABNO     FFDAYW  10                      CPM003
     C***********FFDAYW    SUB  FFDAYY    FFDAYZ  10   82                 CPM003
     C***82******          ADD  7         FFDAYZ                          CPM003
     C***********          ADD  FFDAYZ    FFDAY                           CPM003
     C***********          MOVE FFAA      FFA     10                      CPM003
     C***********2         DO   FFA                                       CPM003
     C***********FFDAY     ADD  7         FFDAY                           CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C******IF*FIRST*TWO*CHARACTERS*ARE**NO.*OF*DAYS**********************CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C******ADD*NO.*OF*DAYS*TO*MIDAS*DAY*NO.*OF*FIRST*DAY*OF*MONTH********CPM003
     C***********                                                         CPM003
     C***********          MOVE FFAB      FFABN   20                      CPM003
     C***********          SUB  1         FFABN                           CPM003
     C***********          ADD  FFABN     FFDAY                           CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT*****                                                      CPM003
     C********************************************************************CPM003
     C***********                                                     *   CPM003
     C***FFDAAD*SR.***CALLED*FROM*STANDARD*SUBROUTINE*FFDATE**************CPM003
     C****************TO*ADJUST*DAY*WITH*SPECIFIED*NO.*OF*ACTUAL**********CPM003
     C****************DAYS************************************************CPM003
     C***********                                                     *   CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C***********FFDAAD    BEGSR                           ****FFDAAD***  CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****ADD/SUBTRACT*SPECIFIED*NO.*OF*DAYS*AS*REQUIRED*****************CPM003
     C***********                                                         CPM003
     C***********FFC       IFEQ '+'                                       CPM003
     C***********          ADD  FFDE      FFDAY                           CPM003
     C***********          ELSE                                           CPM003
     C***********          SUB  FFDE      FFDAY                           CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****IF*FFDAY*IS*HOLIDAY*DETERMINE*NEXT/PREVIOUS**WORKING*DAY*******CPM003
     C***********                                                         CPM003
     C***********FFG       IFEQ '+'                                       CPM003
     C***********                                                         CPM003
     C*****IF*HOLIDAY,*DETERMINE*NEXT*WORKING*DAY*************************CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          MOVE 'Y'       ZOPT                            CPM003
     C***********          EXSR ZDATE5                                    CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    FFDAY                           CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****IF*HOLIDAY,*DETERMINE*PREVIOUS*WORKING*DAY*********************CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          MOVE 'Y'       ZOPT                            CPM003
     C***********          EXSR FFDAT5                                    CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    FFDAY                           CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT*****                                                      CPM003
     C********************************************************************CPM003
     C***********                                                     *   CPM003
     C***FFDABD*SR.***CALLED*FROM*STANDARD*SUBROUTINE*FFDATE**************CPM003
     C****************TO*ADJUST*DAY*WITH*SPECIFIED*NO.*OF*BUSINESS********CPM003
     C****************DAYS*FOR*THE*MARKET*CENTRE**************************CPM003
     C***********                                                     *   CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C***********FFDABD    BEGSR                           ****FFDABD***  CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****ADD/SUBTRACT*SPECIFIED*NO.*OF*DAYS*AS*REQUIRED*****************CPM003
     C***********                                                         CPM003
     C***********FFC       IFEQ '+'                                       CPM003
     C***********                                                         CPM003
     C*****CALCULATE*LIMIT*FFDE*WORKING*DAYS*AFTER*DATE*******************CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          Z-ADDFFDE      ZNRDYS                          CPM003
     C***********          EXSR ZDATE3                                    CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    FFDAY                           CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****CALCULATE*LIMIT*FFDE*WORKING*DAYS*BEFORE*DATE******************CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          Z-ADDFFDE      ZNRDYS                          CPM003
     C***********          EXSR FFDAT3                                    CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    FFDAY                           CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT*****                                                      CPM003
     C********************************************************************CPM003
     C***********                                                     *   CPM003
     C***FFDACD*SR.***CALLED*FROM*STANDARD*SUBROUTINE*FFDATE**************CPM003
     C****************TO*ADJUST*DAY*WITH*SPECIFIED*NO.*OF*BUSINESS********CPM003
     C****************DAYS*IN*CCY*OF*MARKET*CENTRE*&*INSTRUMENT*&*********CPM003
     C****************ANY*OTHER*CCY***************************************CPM003
     C***********                                                     *   CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C***********FFDACD    BEGSR                           ****FFDACD***  CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****DETERMINE*SPECIFIED*NEXT/PREVIOUS*WORKING*DAYS*IN*ALL*CCYS*****CPM003
     C***********                                                         CPM003
     C***********FFC       IFEQ '+'                                       CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****DETERMINE*NEXT*FFDE*WORKING*DAYS*******************************CPM003
     C***********                                                         CPM003
     C*****CALCULATE*LIMIT*FFDE*WORKING*DAYS*AFTER*DATE,IN*CCY1***********CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          Z-ADDFFDE      ZNRDYS                          CPM003
     C***********          EXSR ZDATE3                                    CPM003
     C***********          Z-ADDZDYNBR    FFMDY1                          CPM003
     C***********                                                         CPM003
     C*****CALCULATE*LIMIT*FFDE*WORKING*DAYS*AFTER*DATE,IN*CCY2***********CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY2    ZCCY                            CPM003
     C***********          Z-ADDFFDE      ZNRDYS                          CPM003
     C***********          EXSR ZDATE3                                    CPM003
     C***********          Z-ADDZDYNBR    FFMDY2                          CPM003
     C***********                                                         CPM003
     C*****CALCULATE*LIMIT*FFDE*WORKING*DAYS*AFTER*DATE,IN*CCY3***********CPM003
     C*****IF*PRESENT*****************************************************CPM003
     C***********                                                         CPM003
     C***********FFCCY3    IFNE ' '                                       CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY3    ZCCY                            CPM003
     C***********          Z-ADDFFDE      ZNRDYS                          CPM003
     C***********          EXSR ZDATE3                                    CPM003
     C***********          Z-ADDZDYNBR    FFMDY3                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****TO*FIND*THE*EARLIEST*DAY*(*TODAY*OR*LATER*)*WHICH*IS*A*********CPM003
     C*****WORKING*DAY*IN*ALL*CURRENCIES,*FIRST*FIND*THE*LATEST*OF********CPM003
     C*****ALL*THE*DATES**************************************************CPM003
     C***********                                                         CPM003
     C***********FFMDY1    IFGT FFMDY2                                    CPM003
     C***********          Z-ADDFFMDY1    FFMDY                           CPM003
     C***********          ELSE                                           CPM003
     C***********          Z-ADDFFMDY2    FFMDY                           CPM003
     C***********          END                                            CPM003
     C***********FFCCY3    IFNE *BLANKS                                   CPM003
     C***********FFMDY3    ANDGTFFMDY                                     CPM003
     C***********          Z-ADDFFMDY3    FFMDY                           CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*FFMDY*IS*WORKING*DAY*IN*ALL*CURRENCIES****************CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFMDY     ZDYNBR                          CPM003
     C***********                                                         CPM003
     C***********          MOVE 'N'       HOLF    1                       CPM003
     C***********                                                         CPM003
     C*****CONTINUE*WHILE*THE*DATE*IS*A*HOLIDAY*IN*ANY*CCY****************CPM003
     C***********                                                         CPM003
     C***********HOLF      DOWEQ'N'                                       CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    ZDAYNO                          CPM003
     C***********                                                         CPM003
     C*****FIND*NEXT*WORKING*DAY*IN*CCY1**********************************CPM003
     C***********                                                         CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          MOVE 'Y'       ZOPT                            CPM003
     C***********          EXSR ZDATE5                                    CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*THIS*DATE*IS*A*HOLIDAY*IN*CCY2************************CPM003
     C***********                                                         CPM003
     C***********          MOVE FFCCY2    FFCCYX                          CPM003
     C***********                                                         CPM003
     C***********          EXSR FFDCYH                                    CPM003
     C***********                                                         CPM003
     C*****IF*CCY2*A*HOLIDAY,INCREMENT*DAY*AND*REPEAT*FROM*CCY1*CHECK*****CPM003
     C***********                                                         CPM003
     C************IN85     IFEQ '1'                                       CPM003
     C***********                                                         CPM003
     C***********          ADD  1         ZDYNBR                          CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****IF*CCY2*NOT*A*HOLIDAY,*CHECK*CCY3*IF*PRESENT*******************CPM003
     C*****IF*CCY3*NOT*PRESENT,*DAY*IS*NOT*A*HOLIDAY*IN*ANY*CCY***********CPM003
     C***********                                                         CPM003
     C***********FFCCY3    IFEQ *BLANK                                    CPM003
     C***********          MOVE 'Y'       HOLF                            CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*THIS*DATE*IS*A*HOLIDAY*IN*CCY3************************CPM003
     C***********                                                         CPM003
     C***********          MOVE FFCCY3    FFCCYX                          CPM003
     C***********                                                         CPM003
     C***********          EXSR FFDCYH                                    CPM003
     C***********                                                         CPM003
     C*****IF*CCY3*A*HOLIDAY,INCREMENT*DAY*AND*REPEAT*FROM*CCY1*CHECK*****CPM003
     C***********                                                         CPM003
     C************IN85     IFEQ '1'                                       CPM003
     C***********          ADD  1         ZDYNBR                          CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****IF*CCY3*NOT*A*HOLIDAY,*DAY*IS*NOT*A*HOLIDAY*IN*ANY*CCY*********CPM003
     C***********                                                         CPM003
     C***********          MOVE 'Y'       HOLF                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********          END                                            CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****ZDYNBR*IS*THE*NEXT*WORKING*DAY*NOT*A*HOLIDAY*IN*ANY*CCY********CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    FFDAY                           CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****DETERMINE*PREVIOUS*FFDE*WORKING*DAYS***************************CPM003
     C***********                                                         CPM003
     C*****CALCULATE*LIMIT*FFDE*WORKING*DAYS*BEFORE*DATE,IN*CCY1**********CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          Z-ADDFFDE      ZNRDYS                          CPM003
     C***********          EXSR FFDAT3                                    CPM003
     C***********          Z-ADDZDYNBR    FFMDY1                          CPM003
     C***********                                                         CPM003
     C*****CALCULATE*LIMIT*FFDE*WORKING*DAYS*BEFORE*DATE,IN*CCY2**********CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY2    ZCCY                            CPM003
     C***********          Z-ADDFFDE      ZNRDYS                          CPM003
     C***********          EXSR FFDAT3                                    CPM003
     C***********          Z-ADDZDYNBR    FFMDY2                          CPM003
     C***********                                                         CPM003
     C*****CALCULATE*LIMIT*FFDE*WORKING*DAYS*BEFORE*DATE,IN*CCY3**********CPM003
     C*****IF*PRESENT*****************************************************CPM003
     C***********                                                         CPM003
     C***********FFCCY3    IFNE ' '                                       CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY3    ZCCY                            CPM003
     C***********          Z-ADDFFDE      ZNRDYS                          CPM003
     C***********          EXSR FFDAT3                                    CPM003
     C***********          Z-ADDZDYNBR    FFMDY3                          CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****TO*FIND*THE*LATEST*DAY*(*TODAY*OR*EARLIER*)*WHICH*IS*A*********CPM003
     C*****WORKING*DAY*IN*ALL*CURRENCIES,*FIRST*FIND*THE*EARLIEST*OF******CPM003
     C*****ALL*THE*DATES**************************************************CPM003
     C***********                                                         CPM003
     C***********FFMDY1    IFLT FFMDY2                                    CPM003
     C***********          Z-ADDFFMDY1    FFMDY                           CPM003
     C***********          ELSE                                           CPM003
     C***********          Z-ADDFFMDY2    FFMDY                           CPM003
     C***********          END                                            CPM003
     C***********FFCCY3    IFNE *BLANKS                                   CPM003
     C***********FFMDY3    ANDLTFFMDY                                     CPM003
     C***********          Z-ADDFFMDY3    FFMDY                           CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*FFMDY*IS*WORKING*DAY*IN*ALL*CURRENCIES****************CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFMDY     ZDYNBR                          CPM003
     C***********                                                         CPM003
     C***********          MOVE 'N'       HOLF                            CPM003
     C***********                                                         CPM003
     C*****CONTINUE*WHILE*THE*DATE*IS*A*HOLIDAY*IN*ANY*CCY****************CPM003
     C***********                                                         CPM003
     C***********HOLF      DOWEQ'N'                                       CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    ZDAYNO                          CPM003
     C***********                                                         CPM003
     C*****FIND*PREVIOUS*WORKING*DAY*IN*CCY1******************************CPM003
     C***********                                                         CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          MOVE 'Y'       ZOPT                            CPM003
     C***********          EXSR FFDAT5                                    CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*THIS*DATE*IS*A*HOLIDAY*IN*CCY2************************CPM003
     C***********                                                         CPM003
     C***********          MOVE FFCCY2    FFCCYX                          CPM003
     C***********                                                         CPM003
     C***********          EXSR FFDCYH                                    CPM003
     C***********                                                         CPM003
     C*****IF*CCY2*A*HOLIDAY,INCREMENT*DAY*AND*REPEAT*FROM*CCY1*CHECK*****CPM003
     C***********                                                         CPM003
     C************IN85     IFEQ '1'                                       CPM003
     C***********                                                         CPM003
     C***********          SUB  1         ZDYNBR                          CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****IF*CCY2*NOT*A*HOLIDAY,*CHECK*CCY3*IF*PRESENT*******************CPM003
     C*****IF*CCY3*NOT*PRESENT,*DAY*IS*NOT*A*HOLIDAY*IN*ANY*CCY***********CPM003
     C***********                                                         CPM003
     C***********FFCCY3    IFEQ *BLANK                                    CPM003
     C***********          MOVE 'Y'       HOLF                            CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*THIS*DATE*IS*A*HOLIDAY*IN*CCY3************************CPM003
     C***********                                                         CPM003
     C***********          MOVE FFCCY3    FFCCYX                          CPM003
     C***********                                                         CPM003
     C***********          EXSR FFDCYH                                    CPM003
     C***********                                                         CPM003
     C*****IF*CCY3*A*HOLIDAY,INCREMENT*DAY*AND*REPEAT*FROM*CCY1*CHECK*****CPM003
     C***********                                                         CPM003
     C************IN85     IFEQ '1'                                       CPM003
     C***********          SUB  1         ZDYNBR                          CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****IF*CCY3*NOT*A*HOLIDAY,*DAY*IS*NOT*A*HOLIDAY*IN*ANY*CCY*********CPM003
     C***********                                                         CPM003
     C***********          MOVE 'Y'       HOLF                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********          END                                            CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****ZDYNBR*IS*THE*PREVIOUS*WORKING*DAY*NOT*A*HOLIDAY*IN*ANY*CCY****CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    FFDAY                           CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT*****                                                      CPM003
     C********************************************************************CPM003
     C***********                                                     *   CPM003
     C***FFDAWD*SR.***CALLED*FROM*STANDARD*SUBROUTINE*FFDATE**************CPM003
     C****************RETURN*DAY*PASSED*IF*IT*IS*A*WORKING*DAY,*ELSE******CPM003
     C****************RETURN*NEXT/PREVIOUS*WORKING*DAY*IN*MARKET**********CPM003
     C****************CENTRE*CURRENCY*AS*REQUIRED*************************CPM003
     C***********                                                     *   CPM003
     C********************************************************************CPM003
     C***********                                                     *   CPM003
     C***********FFDAWD    BEGSR                           ****FFDAWD***  CPM003
     C***********                                                         CPM003
     C***********FFC*      IFEQ '+'                                       CPM003
     C***********                                                         CPM003
     C*****IF*FFDAY*IS*HOLIDAY*DETERMINE*NEXT*WORKING*DAY*****************CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          MOVE 'Y'       ZOPT                            CPM003
     C***********          EXSR ZDATE5                                    CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C****IF*FFDAY*IS*HOLIDAY*DETERMINE*PREVIOUS*WORKING*DAY**************CPM003
     C***********                                                         CPM003
     C***********          Z-ADDFFDAY     ZDAYNO                          CPM003
     C***********          MOVE FFCCY1    ZCCY                            CPM003
     C***********          MOVE 'Y'       ZOPT                            CPM003
     C***********          EXSR FFDAT5                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          Z-ADDZDYNBR    FFDAY                           CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C********************************************************************CPM003
     C***/EJECT*****                                                      CPM003
     C********************************************************************CPM003
     C***********                                                     *   CPM003
     C***FFDCYH*SR.**CALLED*FROM*SUBROUTINE*FFDACD*(*CALLED*FROM**********CPM003
     C***************STANDARD*SUBROUTINE*FFDATE*)*************************CPM003
     C***************DETERMINE*WHETHER*CURRENCY*RECEIVED*IS*A*HOLIDAY*****CPM003
     C***********                                                     *   CPM003
     C**NB.*THIS*ROUTINE*CHECKS*FOR*THE*LAST*DAY*OUTPUT*BY*ZDATE5*********CPM003
     C***********                                                     *   CPM003
     C**RECEIVES*:**FFCCYX**CURRENCY*TO*BE*TESTED****(3A)*****************CPM003
     C**OUTPUTS**:***IN85***(*ON*IF*HOLIDAY*)*****************************CPM003
     C***********                                                     *   CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C***********FFDCYH    BEGSR                           ****FFDCYH***  CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****RESET*WORK*INDICATOR*******************************************CPM003
     C*****(**IN85*IS*SET*ON*IF*THE*DAY*LAST*OUTPUT*BY*ZDATE5*************CPM003
     C*****IS*A*HOLIDAY*IN*THE*CURRENCY*PASSED*TO*THIS*ROUTINE*)**********CPM003
     C***********                                                         CPM003
     C***********          MOVE '0'       *IN85                           CPM003
     C***********                                                         CPM003
     C*****FOLLOWING*THE*LAST*EXECUTION*OF*ZDATE5,**IN91*IS*ON*IF*AT******CPM003
     C*****LEAST*ONE*HOLIDAY*RECORD*FOR*THE*DAY*IS*FOUND******************CPM003
     C***********                                                         CPM003
     C*****IF**IN91*IS*ON,*THEN*THE*DAY*IS*NOT*A*HOLIDAY*IN*ANY***********CPM003
     C*****CURRENCY*AND*SO*NO*FURTHER*PROCESSING*IS*REQUIRED.*************CPM003
     C*****IF**IN91*IS*OFF,THEN*THE*ARRAY*SET*UP*IN*ZDATE5*CAN*BE*********CPM003
     C*****CHECKED*TO*SEE*IF*THE*CURRENCY*PASSED*TO*THIS*ROUTINE**********CPM003
     C*****IS*A*HOLIDAY.**************************************************CPM003
     C***********                                                         CPM003
     C************IN90     IFEQ '0'                                       CPM003
     C************IN91     OREQ '0'                                       CPM003
     C***********                                                         CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*CURRENCY*ON*HOLIDAY*ARRAY*****************************CPM003
     C***********                                                         CPM003
     C***********FFCCYX    LOKUPZHC                      85               CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*SEE*IF*CURRENCY*IS*TO*BE*INCLUDED*OR*EXCLUDED*********CPM003
     C*****(*INCLUDE*:*DATE*IS*A*HOLIDAY*IN*CURRENCY*IN*ARRAY*****)*******CPM003
     C*****(*EXCLUDE*:*DATE*IS*NOT*A*HOLIDAY*IN*CURRENCY*IN*ARRAY*)*******CPM003
     C***********                                                         CPM003
     C************IN85     IFEQ '1'                                       CPM003
     C***********                                                         CPM003
     C***********INEX      IFEQ 'I'                                       CPM003
     C***********          SETON                     85                   CPM003
     C***********          ELSE                                           CPM003
     C***********          SETOF                     85                   CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C***********INEX      IFEQ 'I'                                       CPM003
     C***********          SETOF                     85                   CPM003
     C***********          ELSE                                           CPM003
     C***********          SETON                     85                   CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT*****                                                      CPM003
     C********************************************************************CPM003
     C*****FFDAT3*SR.*TO*CALCULATE*ANY*NUMBER*OF*WORKING******************CPM003
     C****************DAYS*BACK*IN*ANY*CURRENCY.**************************CPM003
     C***********                                                        *CPM003
     C*********THIS*SR.*CAN*BE*USED*WHEN*THE*INPUT*CYCLE*IS*RUNNING*AS****CPM003
     C*********HOLIDAY*RECORDS*ARE*ACCESSED*BY*CHAIN.*THEREFORE*NEWLY*****CPM003
     C*********ADDED*RECORDS*IN*THE*OVERFLOW*AREA*CAN*ALSO*BE*ACCESSED.***CPM003
     C***********                                                        *CPM003
     C********************************************************************CPM003
     C***********FFDAT3    BEGSR                           *** FFDAT3 *** CPM003
     C***********                                                         CPM003
     C*****CALCULATIONS*TO*DEFINE*INPUT*FIELDS.***************************CPM003
     C***********          Z-ADDZDAYNO    ZDAYNO  50       STARTING DATE  CPM003
     C***********          MOVE ZCCY      ZCCY    3        DATE CURRENCY  CPM003
     C***********          Z-ADDZNRDYS    ZNRDYS  20       NBR OF WORKING CPM003
     C***********                                          DAYS BACK      CPM003
     C*****CLEAR*COUNT*OF*NBR*OF*DAYS*SUBTRACTED,*&*DEFINE*ZDYNBR.********CPM003
     C***********          Z-ADD0         ZDCNT   20                      CPM003
     C***********          Z-ADDZDAYNO    ZDYNBR  50                      CPM003
     C***********                                                         CPM003
     C*****LOOP*TO*DECREMENT*DAY*NUMBER*AND*CHECK*FOR*HOLIDAY.************CPM003
     C***********XDLOP1    TAG                             ** XDLOP1 TAG *CPM003
     C***********                                                         CPM003
     C***********          SETOF                     9596                 CPM003
     C***********ZDYNBR    SUB  1         ZDYNBR                          CPM003
     C***********                                                         CPM003
     C*****CHAIN*FOR*HOLIDAY*RECORD*1*************************************CPM003
     C***********XDHCHN    TAG                             ** XDHCHN TAG *CPM003
     C***********                                                         CPM003
     C***********ZDYNBR    CHAINTABLETJF             90    ON NOT THERE   CPM003
     C**N90******RECI      COMP 'D'                  9090  DELETED        CPM003
     C***********                                                         CPM003
     C*****NO*RECORD*1*FOUND,*IS*NOT*A*HOLIDAY****************************CPM003
     C***90******          GOTO XDOAGN                                    CPM003
     C***********                                                         CPM003
     C*****DETERMINE*TYPE*FOUND,*INCLUDE*OR*EXCLUDE***********************CPM003
     C***********INEX      COMP 'E'                  92  91               CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*DAY*IS*HOLIDAY*FOR*CURRENCY.**************************CPM003
     C***********ZCCY      LOKUPHCCY                     93               CPM003
     C***91*93***          GOTO XDOAGN                     EXCLUDE FOUND  CPM003
     C***92*93***          GOTO XDLOP1                     INCLUDE FOUND  CPM003
     C***********                                                         CPM003
     C*****IF*EXCLUDE*OR*INCLUDE*NOT*FOUND*CHECK**************************CPM003
     C*****FOR*SECOND*HOLIDAY*RECORD,*IF*REQUIRED.************************CPM003
     C***********'***'     LOKUPHCCY                     94ON IF NO RCD.2 CPM003
     C************IN94     IFEQ '0'                                       CPM003
     C************         READ TABLETJF                 90               CPM003
     C************                                                        CPM003
     C*****CHECK*IF*DAY*IS*HOLIDAY*FOR*CURRENCY.**************************CPM003
     C************IN90     IFEQ '0'                                       CPM003
     C***********RECI      ANDEQ'D'                                       CPM003
     C***********HOL       ANDEQZDYNBR                                    CPM003
     C***********ZCCY      LOKUPHCCY                     93               CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C***********          END                                            CPM003
     C***91*93***          GOTO XDOAGN                     EXCLUDE FOUND  CPM003
     C***92*93***          GOTO XDLOP1                     INCLUDE FOUND  CPM003
     C***********                                                         CPM003
     C***91******          GOTO XDLOP1                     EXC. NOT FOUND CPM003
     C***92******          GOTO XDOAGN                     INC. NOT FOUND CPM003
     C***********                                                         CPM003
     C*****INCREMENT*COUNT*AND*CHECK*IF*REQUIRED*NUMBER*OF*DAYS***********CPM003
     C*****HAS*BEEN*SUBTRACTED.*IF*NOT,*GO*THROUGH*LOOP1*AGAIN.***********CPM003
     C***********XDOAGN    TAG                             ** XDOAGN TAG *CPM003
     C***********                                                         CPM003
     C***********ZDCNT     ADD  1         ZDCNT                           CPM003
     C***********ZDCNT     COMP ZNRDYS                 97                 CPM003
     C***97******          GOTO XDLOP1                                    CPM003
     C***********                                                         CPM003
     C***********          ENDSR                                          CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***/EJECT*****                                                      CPM003
     C********************************************************************CPM003
     C***********                                                         CPM003
     C***FFDAT5*SR.*TO*DETERMINE*IF*A*DAY*NUMBER*DATE*IS*A*HOLIDAY********CPM003
     C*************IN*GIVEN*CURRENCY,*AND*IF*DAY*IS*A*HOLIDAY*AND*********CPM003
     C*************IF*REQUIRED,*DETERMINE*PREVIOUS*WORKING*DAY.***********CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C***********FFDAT5    BEGSR                           *** FFDAT5 *** CPM003
     C***********          SETOF                     89                   CPM003
     C***********                                                         CPM003
     C*****CALCULATIONS*TO*DEFINE*INPUT*FIELDS.***************************CPM003
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      CPM003
     C***********          MOVE ZCCY      ZCCY    3                       CPM003
     C***********          MOVE ZOPT      ZOPT    1                       CPM003
     C***********                                                         CPM003
     C*****CALCULATION*TO*DEFINE/SET*OUTPUT*FIELD.************************CPM003
     C***********          Z-ADDZDAYNO    ZDYNBR  50                      CPM003
     C***********                                                         CPM003
     C*****DETERMINE*IF*HOLIDAY*******************************************CPM003
     C***********ZDHOL6    TAG                             ** ZDHOL6 TAG**CPM003
     C***********                                                         CPM003
     C*****CALCULATIONS*TO*DEFINE/CLEAR*WORKFIELDS.***********************CPM003
     C***********          MOVE '   '     ZHC                             CPM003
     C***********                                                         CPM003
     C*****CHAIN*FOR*HOLIDAY*RECORD*1*************************************CPM003
     C***********ZDYNBR    CHAINTABLETJF             90    ON NOT THERE   CPM003
     C************IN90     IFEQ '0'                                       CPM003
     C***********RECI      ANDEQ'D'                                       CPM003
     C***********                                                         CPM003
     C*****STORE*CURRENCIES*IF*RECORD*FOUND.******************************CPM003
     C***********          MOVEAHCCY      ZHC,1                           CPM003
     C***********          MOVE INEX      ZINEX   1                B10278 CPM003
     C***********          ELSE                                           CPM003
     C***********                                                         CPM003
     C*****BYPASS*TO*END*IF*NO*FIRST*RECORD*FOUND.************************CPM003
     C***********          GOTO ZDEND6                                    CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****GET*SECOND*RECORD**********************************************CPM003
     C***********          READ TABLETJF                 90               CPM003
     C************IN90     IFEQ '0'                                       CPM003
     C***********RECI      ANDEQ'D'                                       CPM003
     C***********HOL       ANDEQZDYNBR                                    CPM003
     C***********          MOVEAHCCY      ZHC,26                          CPM003
     C***********          ELSE                                    B10278 CPM003
     C***********          MOVE ZINEX     INEX                     B10278 CPM003
     C***********          END                                            CPM003
     C***********                                                         CPM003
     C*****DETERMINE*HOLIDAY*RECORD*TYPE.*********************************CPM003
     C***********INEX      COMP 'E'                      92               CPM003
     C***********INEX      COMP 'I'                      93               CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*CURRENCY*ON*HOLIDAY.**********************************CPM003
     C***********ZCCY      LOKUPZHC                      94               CPM003
     C***********                                                         CPM003
     C*****BYPASS*TO*END*IF*NOT*HOLIDAY*FOR*CURRENCY.*********************CPM003
     C***92*94***                                                         CPM003
     C*OR*93N94***         GOTO ZDEND6                                    CPM003
     C***********                                                         CPM003
     C*****SET*INDICATOR*FOR*HOLIDAY*FOR*DAY*NUMBER.**********************CPM003
     C***********          SETON                     89                   CPM003
     C***********                                                         CPM003
     C*****CHECK*IF*NEXT*WORKING*DAY*REQUIRED.****************************CPM003
     C***********ZOPT      COMP 'Y'                      95               CPM003
     C***95******ZDYNBR    SUB  1         ZDYNBR                          CPM003
     C***95******          GOTO ZDHOL6                                    CPM003
     C***********                                                         CPM003
     C***********ZDEND6    ENDSR                           * ZDEND5 ENDSR*CPM003
     C***********                                                         CPM003
     C********************************************************************CPM003
     C******* S71062 END *******************************************************
     C*
      /EJECT                                                              CPM003
      /COPY ZSRSRC,FFPLCLZ1                                               CPM003
      /EJECT                                                              CPM003
      /COPY ZSRSRC,FFYTOPZ1                                               CPM003
      /EJECT                                                              CPM003
      /COPY ZSRSRC,FFTVCLZ2                                               CPM003
      /EJECT                                                              CPM003
      /COPY ZSRSRC,FFPMCLZ1                                               CPM003
      /EJECT                                                              CPM003
      /COPY ZSRSRC,ZBAKRT                                                 CPM003
      /EJECT                                                              CPM003
      /COPY ZSRSRC,ZDATE1Z2                                               CPM003
      /EJECT                                                              CPM003
      /COPY ZSRSRC,ZDATE2Z2                                               CPM003
      /EJECT
      /COPY ZSRSRC,ZCCYCN                                                  47719
      /EJECT                                                               47719
      /COPY ZSRSRC,ZCCYXR                                                  47719
     C********************************************************************
     C/EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * INIT     - INITIAL PROCESSING                                    *
      * VALX     - VALUATION EXTRACT                                     *
      * P01      - ACCESS INSTRUMENT DETAILS                             *
      * P03      - ACCESS CUSTOMER DETAILS                               *
      * P04      - ACCESS PORTFOLIO DETAILS                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*
     C           WWERRO    IFEQ ' '
     C                     MOVE 'Y'       WWERRO  1
     C*
     C           DBASE     IFNE 0
     C*
     C**  PRINT ERROR MESSAGE:
     C                     WRITEERRORAU
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     ELSE
     C                     Z-ADD999       DBASE
     C                     END
     C*
     C                     DUMP
     C                     END
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
     C*
**  CPY@
(c) Finastra International Limited 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   TABDY/TABNO - Shortnames & day numbers                               CPM003
F0S1X2M3U4W5T6                                                            CPM003
