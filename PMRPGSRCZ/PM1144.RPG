     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Portfolio holdings update')                   *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM1144 - DL Portfolio Holdings Update                        *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CGL165             Date 15Feb17               *
      *  Prev Amend No. CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE148             Date 23Jul12               *
      *                 CSW212             Date 03May12               *
      *                 CRE073             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG24989           Date 23Jul09               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23967           Date 15May09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CGL035             Date 01Mar05               *
      *                 237063             Date 20Nov05               *
      *                 CAS009             Date 16May05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 CAS008             Date 16Jun04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 217684             Date 12May03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      *                 182961             Date 21Apr01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      *                 176443             Date 18Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 09Jul99               *
     F*                 147727             Date 08Dec98               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 126017             Date 14Nov97               *
     F*                 121768             DATE 20FEB98               *
     F*                 S01408             DATE 21OCT97               *
     F*                 CPK008             DATE 07JUN97               *
     F*                 097885             DATE 03FEB97               *
     F*                 091194             DATE 14OCT96               *
     F*                 CPM005             DATE 01JUL96               *
     F*                 CFF004             DATE 02OCT96               *
     F*                 103086             DATE 25APR96               *
     F*                 S71062             DATE 24JAN96               *
     F*                 CPM004             DATE 04MAR96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 094529             DATE 13OCT95               *
     F*                 085870             DATE 16MAR95               *
     F*                 082763             DATE 06FEB95               *
     F*                 S01486             DATE 11AUG94               *
     F*                 049421             DATE 04NOV93               *
     F*                 062885             DATE 04NOV93               *
     F*                 062952             DATE 05NOV93               *
     F*                 060556             DATE 17SEP93               *
     F*                 059111             DATE 10AUG93               *
     F*                 058933             DATE 02AUG93               *
     F*                 057020             DATE 18JUN93               *
     F*                 057022             DATE 16JUN93               *
     F*                 053090     MF      DATE 08APR93               *
     F*                 062871     MF      DATE 09FEB93               *
     F*                 S01328     IS      DATE 15JAN93               *
     F*                 044902     SL      DATE 16OCT92               *
     F*                 042355     MF      DATE 16JUL92               *
     F*                 041644     MF      DATE 15JUL92               *
     F*                 037855     MF      DATE 07APR92               *
     F*                 036681     MF      DATE 09MAR92               *
     F*                 50343              DATE 07APR93               *
     F*                 47719              DATE 24NOV92               *
     F*                 47617              DATE 17NOV92               *
     F*                 46081              DATE 19OCT92               *
     F*                 S01313             DATE 28APR92               *
     F*                 R37474             DATE 23MAR92               *
     F*                 39440              DATE 08APR92               *
     F*                 38468              DATE 08APR92               *
     F*                 B08275             DATE 25OCT91               *
     F*                 B08253             DATE 10OCT91               *
     F*                 B08255             DATE 07OCT91               *
     F*                 B08251             DATE 10OCT91               *
     F*                 B08040             DATE 04JUL91               *
     F*                 B08072             DATE 25JUN91               *
     F*                 B05987             DATE 16MAY91               *
     F*                 R05763             DATE 27MAR91               *
     F*                 R05760             DATE 27MAR91               *
     F*                 R05736             DATE 25MAR91               *
     F*                 R05669             DATE 13MAR91               *
     F*                 R05586             DATE 04MAR91               *
     F*                 R0168              DATE 14FEB91               *
     F*                 R0138              DATE 12FEB91               *
     F*                 R0099              DATE 05FEB91               *
     F*                 R0091              DATE 04FEB91               *
     F*                 R0046_DC           DATE 28JAN91               *
     F*                 R0028_DW           DATE 23JAN91               *
     F*                 R00631             DATE 29OCT90               *
     F*                 R0585_LC           DATE 24OCT90               *
     F*                 R10038             DATE 16SEP90               *
     F*                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  AR996895 - Incorrect accrual interest calculation.           *
      *             (Child:AR996897) (Recompile)                      *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSW212 - SWIFT 2012 Changes (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG24989 - Limit Utilisation Enq - Decimal Data error        *
      *             (Recompile)                                       *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  BUG23967 - Add Local Industry Code Field.                    *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus (Recompile)                           *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CGL035 - EUSD Upgrade to Midasplus                           *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  CAS008 - IAS 39 Enhancements (Recompile)                     *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  182961 - Database error occurred due to a blank key field    *
      *           (Instrument Type).  The default Instrument type in  *
      *           PF/SDPORTPD is taken if a blank instrument type is  *
      *           encountered.                                        *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
     F*  176443 - Avoid MCH3601 to be sent.                           *
     F*           Pass correct parameter to AOCUSTR0.                 *
     F*  CPB001 -  'Private Banking' Module                           *
     F*  147727 - Review accrued interest calculation when 1st day    *
     F*           accrual (ACLD is 'N')                               *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  S01408 - Addition of Core Hooks manually (DBA2 only)         *
     F*           Addition of Core Hook PM1144CP15                    *
     F*           Addition of Core Hook PM1144CP14                    *
     F*           Addition of Core Hook PM1144CP11                    *
     F*           Addition of Core Hook PM1144CP10                    *
     F*           Addition of Core Hook PM1144CCP5                    *
     F*           Addition of Core Hook PM1144CCP4                    *
     F*  CPK008 - SR/MATCH renamed to MATCHS to avoid conflict with   *
     F*           new field on DEALSDB.                               *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  091194 - DB ERROR ON DEALS FILE FOR A MATURED DEAL ALREADY   *
     F*           FLAGGED AS HISTORIC (EOM PROCESSING)                *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/1 - CHANGE CUSTOMER/PORTFOLIO BASE CURRENCY    *
     F*           PBFG/2 - CALCULATE & REPORT PERF. FOR ALL CUST.PORT *
     F*           PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
     F*  103086 - Reverse P&L if Bank Portfolios                      *
     F*  S71062 - OUTPUT ADDITIONAL FIELDS NMDP & SPBS                *
     F*  CPM004 - Bank Portfolios                                     *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  094529 - Historic deals are now kept on DLBHISPD / DLCHISPD  *
     F*  085870 - Parameters inside GLINTC have changed               *
     F*  082763 - Valuation Stmt not produced (use ICD defaults for   *
     F*           Local Industry code and country code if blank on    *
     F*           customer)                                           *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  062885 - ADD SUBR ZCCYXR EXTERNALLY CALLED                   *
     F*  062952 - DEAL TYPE 'PL' UNKNOWN                              *
     F*  060556 - REMOVE SPECIAL CALCULATIONS OF FX P&L FOR TD        *
     F*  059111 - Output FX Book Price if value date is equal to      *
     F*           Last Extract Date                                   *
     F*  058933 - REMOVE FRA/IRS TRANSACTIONS FROM PROGRAM            *
     F*  057020 - OUTPUT DOUBLE PRECISION FX RATE TO FILE             *
     F*  057022 - FX HOLDINGS SHOULD ALWAYS BE VALUED                 *
     F*  053090 - BOOK PRICE, BOOK RATE AND UNREALISED P/L IS 0       *
     F*           FOR TD WHICH HAVE REACHED VALUE DATE                *
     F*  062871 - WWNODA APPEARS AS ATE AND UNREALISED P/L IS 0       *
     F*  S01328 - FRA/IRS Revaluation.                                *
     F*  044902 - REMOVE FIX 42355 AND COMPLETE FIX 42940             *
     F*  042355 - REMOVE FIX 36681                                    *
     F*  041644 - MARKET PRICE WRONG (DUE TO DIVISIONS). COMPLET 37855*
     F*  037855 - MARKET PRICE WRONG (DUE TO DIVISIONS).              *
     F*  036681 - THE MARKET FX RATE IS 1/MARKET FX RATE.             *
     F*  50343  - OUTPUT RECI OF 'M' FOR EXPIRED SWAPS                *
     F*  47719  - CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES    *
     F*  47617  - ONLY OUTPUT TVDA = 'V' FOR LOAN/DEPOSIT WITH        *
     F*           VALUE DATE *GT ECD                                  *
     F*  46081  - IF VALUE DATE POSITIONS OUTPUT MM DEPOSIT EVEN IF   *
     F*           DEPOSIT VALUE DATE NOT REACHED                      *
     F*           TOTALS DO NOT ADD UP FOR PORTFOLIO CUSTOMERS WITH   *
     F*           PORTFOLIOS IN DIFFERENT CURRENCIES                  *
     F*  S01313 - CHANGES FOR PORTFOLIO PERFORMANCE                   *
     F*  R37474 - ADD TOTALLING FIELDS TO PF/PMHOLDPP FOR MIDASQ      *
     F*  39440  - SUNDRY FIXES TO EXTRACT OF LOAN DETAILS             *
     F*  38468  - NUMBER OF DAYS ON FILE INCONSISTENT WITH NUMBER     *
     F*           OF DAYS OF GLINTC.                                  *
     F*  B08275 - REMOVE FILE DEALSPT AND SR/VALX & SR/CHRGXLE        *
     F*  B08253 - Changes to extract matured positions to             *
     F*           separate file.                                      *
     F*  B08255 - SPEED UP COB BY SPLITTING TOTALLING FILES           *
     F*  B08251 - FX DEALS BEING CLOSED OUT INCORRECTLY               *
     F*  B08072 - FX DEALS BEING CLOSED OUT INCORRECTLY               *
     F*  B08040 - SUNDRY FIXES TO SPEED UP COB                        *
     F*  B05987 - SET UP P/L CURRENCY CORRECTLY FOR MM DEALS          *
     F*  R05763 - MATURED POSITIONS SHOULD HAVE ZERO MARKET VALUE AND *
     F*           ACCRUED INTEREST                                    *
     F*  R05760 - MATURED FX DEALS SHOULD HAVE PROFIT/LOSS OF ZERO    *
     F*           AND FX P&L CCY OF HIGHER RANKING CURRENCY           *
     F*  R05736 - CLOSED FX P & L WRONGLY SIGNED                      *
     F*  R05669 - OUTPUT COUNTRY AND INDUSTRY TO PMHOLDPP             *
     F*  R05586 - OUTPUT P & L ON FX DEALS AS MARKET VALUE            *
     F*  R0168  - REMOVE FIX R0099                                    *
     F*  R0138  - USE FORWARD RATES TO CONVERT THE CALCULATED P/L     *
     F*           FROM DEAL CCY TO PORTFOLIO CCY                      *
     F*  R0099  - DO NOT REPORT FX P/L UNDER ACCRUED INTEREST         *
     F*  R0091  - PM are changed one file used by Lombard Credit.     *
     F*  R0046  - Related deal number is somtimes not updated.        *
     F*  R0028  - FX Closed Profit / loss is calculated the wrong way *
     F*           round.                                              *
     F*  R00631 - EXPRESS FX RATES ACCORDING TO THE RANK OF THE CCIES *
     F*  R0585  - ACCRUED INTEREST CALCULATED INCORRECTLY FOR CALL    *
     F*           INT NEGATIVE BECAUSE FDNIDT GT ECD                  *
     F*  R10038 - OUTPUT TEXT FOR FX DEAL IN DIFFERENT FORMAT         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FSDPORTPDIF  E                    DISK         KINFSR *PSSR          182961
     F***DEALSP2*IF  E           K        DISK                            S01486
     FPMDEALL2IF  E           K        DISK                               S01486
     F            DEALSDBF                          KRENAMEDEALSDB2
     F            DEALSDCF                          KRENAMEDEALSDC2
     F*********** DEALSDGF                          KRENAMEDEALSDG2       058933
     F                                              KINFSR *PSSR
     F****PREFIX OF PMCHRGQ1 IS 'PO'                                      B08275
     F*MCHRGQ1IF  E           K        DISK                               B08275
     F****        PMCHRGP0                          KRENAMEPMCHRGQF       B08275
     F****                                          KINFSR *PSSR          B08275
     F****PREFIX OF PMPORTQ2 IS 'PN'                                      B08275
     F**PORTQ2IF  E           K        DISK                               B08275
     F****        PMPORTP0                          KRENAMEPMPORTQF       B08275
     F****                                          KINFSR *PSSR          B08275
     F****PREFIX*OF*SDBANKL1*IS*'BJ'*****************************         S01486
     F***SDBANKL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDPORTPD*IS*'P9'*****************************  R05669 S01486
     F*DPORTPDIF**E*******    K        DISK                               B08040
     F***SDPORTPDIF**E                    DISK                     B08040 S01486
     F***********                                   KINFSR *PSSR   R05669 S01486
     F****PREFIX*OF*SDBRCHPD*IS*'A8'****************************   R05669 S01486
     F***SDBRCHL1IF**E           K        DISK                     R05669 S01486
     F***********                                   KINFSR *PSSR   R05669 S01486
     F**  PREFIX OF DEALSDBY IS 'Y'                                       R00631
     F**  TO AVOID CONFUSION WITH FIELDS FROM OTHER 'DEALS' FILES         R00631
     FDEALS   IF  E           K        DISK                               R00631
     F            DEALSDAF                          KIGNORE               R00631
     F            DEALSDBF                          KRENAMEYDEALSDB       R00631
     F            DEALSDCF                          KIGNORE               R00631
     F            DEALSDDF                          KIGNORE               R00631
     F            DEALSDEF                          KIGNORE               R00631
     F            DEALSDFF                          KIGNORE               R00631
     F            DEALSDGF                          KIGNORE               R00631
     F                                              KINFSR *PSSR          R00631
     F**  PREFIX OF XDEALSDB IS 'X'                                       R00631
     F**  TO AVOID CONFUSION WITH FIELDS FROM OTHER 'DEALS' FILES         R00631
     F**XDEALSL1IF  E           K        DISK                       R00631R0091
     F***DEALSL1*IF  E           K        DISK                     R0091  S01486
     FPMDEALL5IF  E           K        DISK                               S01486
     F            DEALSDBF                          KRENAMEXDEALSDB       R00631
     F                                              KINFSR *PSSR          R00631
     FDEALSH  UF  E           K        DISK                               B08253
     F            DEALSDBF                          KRENAMEHDEALSDB       B08253
     F            DEALSDCF                          KRENAMEHDEALSDC       B08253
     F            DEALSDDF                          KIGNORE               B08253
     F            DEALSDEF                          KIGNORE               B08253
     F            DEALSDGF                          KRENAMEHDEALSDG       B08253
     F            DLDHISD0                          KIGNORE               094529
     F            DLEHISD0                          KIGNORE               094529
     F            DLGHISD0                          KIGNORE               094529
     F                                              KINFSR *PSSR          B08253
     F****PREFIX*OF*SDCURRL0*IS*'A6'*****************************         S01486
     F***SDCURRL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F**  PREFIX OF SDDTSTPP IS 'P7'
     F***SDDTSTPPIF**E           K        DISK                            S01486
     FFDDTSTL0IF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDPLINPD*IS*'PD'*****************************         S01486
     F***SDPLINPDIF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F**  PREFIX OF PMDSPGPP IS 'PA'
     F***PMDSPGPPIF**E           K        DISK                            S01486
     FPMDSPGPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMVLGHPP IS 'PB'
     F***PMVLGHPPIF**E           K        DISK                            S01486
     FPMVLGHPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDPLCSL0*IS*'BB'*****************************         S01486
     F***SDPLCSL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDPLCSL0*IS*'BB'*****************************  R05669 S01486
     F***SDCUSTL0IF**E           K        DISK                     R05669 S01486
     F***********                                   KINFSR *PSSR   R05669 S01486
     F**  PREFIX OF PMPORTPP IS 'PN'
     F***PMPORTPPIF**E           K        DISK                            S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F            PMPORTP0                          KRENAMEPMPORTP1
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHSEXPP IS 'Q8'
     F**PMHSEXPPIF**E           K        DISK                             S01486
     FPMHSEXPDIF  E           K        DISK                               S01486
     F*
     FFWDRT   IF  E           K        DISK                               R00631
     F                                              KINFSR *PSSR          R00631
     F**  PREFIX OF PMHOLDZZ IS 'QF'
     F***PMHOLDZZUF**E           K        DISK                      A     S01486
     FPMHOLDPAUF  E           K        DISK                      A        S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDPP IS 'QF'
     F***PMHOLDPPO   E           K        DISK                            S01486
     FPMHOLDPDO   E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDPP IS 'QF'                                      B08040
     F***PMHOLDX0O***E           K        DISK                     B08040 S01486
     FPMHOLDQ0O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08040
     F**  PREFIX OF PMHOLDPP IS 'QF'                                      B08255
     F***PMHOLDX1O***E           K        DISK                     B08255 S01486
     FPMHOLDQ1O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08255
     FPM1144AUO   E                    PRINTER
      **  Prefix FM                                                       CPM005
     FPMPCBCL3IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     FPMEVCYPDO   E                    DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     FTABTB11 IF  E                    DISK                               147727
     E*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F*
     F*           01: INDENTIFICATION OF DEALSDBF FORMAT
     F*           02: INDENTIFICATION OF DEALSDCF FORMAT
     F*           03: INDENTIFICATION OF DEALSDGF FORMAT
     F*           71: INDICATOR FOR READ
     F*           72: INDICATOR FOR CHAIN
     F*           73: INDICATOR FOR READE
     F*           74: INDICATOR FOR LOKUP                                 R00631
     F**
     F**      ***************************************************
     F**      * ..   ..   ..   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * ..   ..   ..   64   65   66   67   68   69   70 *
     F**      * ..   ..   ..   ..   75   76   77   78   79   80 *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     E*****************************************************************
     E*                                                                   B08040
     E** TABLES/ARRAYS USED TO AVOID FILE ACCESS OPERATIONS               B08040
     E                    CYCD      200  3                                B08040
     E                    SPRT      200 13 8                              B08040
     E                    NBDP      200  1 0                              B08040
     E                    MDIN      200  1                                B08040
     E                    RKSQ      200  3 0                              B08040
     E                    DSPG      200  3                                B08040
     E                    DSPS      200  2 0                              B08040
     E                    VALG      200  3                                B08040
     E                    VLGS      200  2 0                              B08040
     E*
     E                    CPY@    1   1 80
     E*
     E** FORMAT SE DETAILS FOR OUTPUT  (SR/ZFRELN)
     E**********          ZLI        20  1                                                    CGL029
     E                    ZLI        26  1                                                    CGL029
     E*
      /COPY ZSRSRC,ZDATE2Z1
     E*
      /COPY ZSRSRC,ZPOWERZ1
     E*
     E* FORWARD DATES/RATES
     E                    DAT        26  5 0A
     E                    RAT        26 13 8
     E************        DFW        26  3 0
     E************        RFW        25 13 8
      *                                                                   R00631
      ** FORWARD DAYS ARRAY                                               R00631
     E************        DF         25  3 0                       R00631 S01328
     E                    DF         25  5 0                              S01328
      *                                                                   R00631
      ** FORWARD RATES ARRAY                                              R00631
     E                    RF         25 13 8                              R00631
      *                                                                   R00631
      ** FORWARD DATES ARRAY INCLUDING RUN DATE IN FIRST ELEMENT          R00631
     E                    DYF        26  5 0                              R00631
      *                                                                   R00631
      ** FORWARD RATES ARRAY INCLUDING CURRENCY SPOT RATE IN FIRST ELEMENTR00631
     E                    RAF        26 13 8                              R00631
     E*                                                                   R00631
     E* OPENING DEALS ARRAY                                               R00631
     E                    ODA       100  6 0                              R00631
     E*                                                                   R00631
     E* CLOSING DEALS ARRAY                                               R00631
     E                    CDA       100  6 0                              R00631
     E                    BRC1       20  3                                B08040
     E                    BICN       20  6                                B08040
     E                    COLC       20  2                                R05669
     E                    LICD       20  3                                R05669
     E*                                                                   S01486
     E/COPY ZSRSRC,ZDATE9Z1                                               S01486
     E*                                                                   S01486
     I*****************************************************************
     I* RECORD IDENTIFICATION
     I*****************************************************************
     I*EALSDBF****01                                                      B08275
     I****          DDAT                            XDDAT2                B08275
     I*EALSDCF****02                                                      B08275
     I*EALSDGF****03                                                      B08275
     I*
     IDEALSDB2    01
     I              DDAT                            XDDAT1                R00631
     IDEALSDC2    02
     I              COLC                            COLC2                                     CGL035
     I*DEALSDG2***03                                                      058933
     I*                                                                   R00631
     IYDEALSDB                                                            R00631
     I              RECI                            XRECI                 R00631
     I              DLNO                            XDLNO                 R00631
     I              CNUM                            XCNUM                 R00631
     I              DTYP                            XDTYP                 R00631
     I              DLST                            XDLST                 R00631
     I              DDAT                            XDDAT                 R00631
     I              VDAT                            XVDAT                 R00631
     I              OTDT                            XOTDT                 R00631
     I              PUCY                            XPUCY                 R00631
     I              PUAM                            XPUAM                 R00631
     I              EXRT                            XEXRT                 R00631
     I              SLCY                            XSLCY                 R00631
     I              SLAM                            XSLAM                 R00631
     I              PTFR                            XPTFR                 R00631
     I*                                                                   R00631
     IXDEALSDB                                                            R00631
     I              RECI                            XRECI                 R00631
     I              DLNO                            XDLNO                 R00631
     I              CNUM                            XCNUM                 R00631
     I              DTYP                            XDTYP                 R00631
     I              DLST                            XDLST                 R00631
     I              DDAT                            XDDAT3                R00631
     I              VDAT                            XVDAT                 R00631
     I              OTDT                            XOTDT                 R00631
     I              PUCY                            XPUCY                 R00631
     I              PUAM                            XPUAM                 R00631
     I              EXRT                            XEXRT                 R00631
     I              SLCY                            XSLCY                 R00631
     I              SLAM                            XSLAM                 R00631
     I              PTFR                            XPTFR                 R00631
     I*                                                                   B08253
     IHDEALSDB    61                                                      B08253
     I*                                                                   B08253
     IHDEALSDC    62                                                      B08253
     I              COLC                            COLC3                                     CGL035
     I*                                                                   B08253
     IHDEALSDG    63                                                      B08253
     IDLBHISD0    64                                                      094529
     IDLCHISD0    65                                                      094529
     I              COLC                            COLC4                                     CGL035
     I*****************************************************************   B08253
     I* DS DEFINITION
     I*****************************************************************
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     IPMSTAT    E DS
     I                                        1   50WWECD
     I                                        1 256 WWSTAT
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA********UDS                            256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*                                                                   CPM004
     I** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
     I** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
      *                                                                   R00631
      ** DATA STRUCTURE TO GET THE FORWARD DAYS FROM FILE LF/FWDRT        R00631
     IDFWDS       DS                                                      R00631
     I*********************************** P   1  500DF             R00631 S01328
     I                                    P   1  750DF                    S01328
      *                                                                   R00631
      ** DATA STRUCTURE TO GET THE FORWARD RATES FROM FILE LF/FWDRT       R00631
     IRFWDS       DS                                                      R00631
     I                                    P   1 1758RF                    R00631
      *                                                                   CPM005
      **  DS to write position sequencing for processing type 1,3,4,6     CPM005
      *                                                                   CPM005
     I            DS                                                      CPM005
     I                                        1  11 WYPOSQ                CPM005
     I                                        1   3 WYCCY1                CPM005
     I                                        4   80WYDATE                CPM005
      *                                                                   CPM005
      **  DS to write position sequencing for processing type 2,5         CPM005
      *                                                                   CPM005
     I            DS                                                      CPM005
     I                                        1  11 WXPOSQ                CPM005
     I                                        1   30WXDSEQ                CPM005
     I                                        4   80WXDATE                CPM005
     I                                        9  11 WXCCY2                CPM005
     I*
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Midas Bank details                                              S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I**  Midas SD Portfolio Management ICD details                       S01486
     I*                                                                   S01486
     ISDBRCH    E DSSDBRCHPD                                              S01486
     I**  Midas SD Branch details                                         S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Midas Currencies details                                        S01486
     I*                                                                   S01486
     ISDPLIN    E DSSDPLINPD                                              S01486
     I**  Midas Portfolio Lending Instrument Types details                S01486
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I**  Midas Portfolio Management Customer details                     S01486
     I*                                                                   S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I              QQDFAC                          CUDFAC                                    CGL029
     I**  Midas SD Customer details                                       S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure                                            S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I**  Long data structure                                             S01486
     I*                                                                   S01486
     IDSLDY     E DSDSLDY                                                 CPB001
     I**  Very Long data structure                                        CPB001
     I*                                                                   CPB001
     ISDMMOD    E DSSDMMODPD                                              CPB001
     I**  Module Details Accesses Via Access Program                      CPB001
     I*                                                                   CPB001
     I/COPY ZSRSRC,ZINTDYZ1                                               S01486
     I*                                                                   S01486
     I/COPY ZSRSRC,ZDATE9Z2                                               S01486
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I*                                                                   S01486
     I/COPY WNCPYSRC,PM1144I001
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * INIT     - INITIAL PROCESSING                                    *
      * FULX     - FULL EXTRACT                                          *
      * P01      - ACCESS INSTRUMENT DETAILS                             *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      * P03      - FORMAT FX DEAL DETAILS FOR OUTPUT TO PORTF.HOLDING    *
      * P04      - FORMAT MM DEAL DETAILS FOR OUT.TO PORTF. HOLDINGS     *
      * P05      - FORMAT FRA/IRS DEAL DETAILS FOR OUT.TO PORTF.HOLD.    *
      * P06      - DETERMINE INTEREST DETAILS                            *
      * P07      - AUDIT PROCESSING                                      *
      * W01      - WRITE TO PORTF. HOLDINGS                              *
      * W02      - WRITE TO PORTF. HOLDINGS AUDIT                        *
      * W03      - WRITE TO PORTF. HOLDINGS UPDATE (DL) AUDIT REPORT     *
      * W04      - Write to Portfolio Event Currency                  *   CPM005
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE SPOT RATES OF THE TWO CURRENCIES            *
      * ZCCYXR   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE EXCHANGE RATE BETWEEN THE TWO CURRENCIES    *
      * ZFDLLN   - FORMAT THE 20A PORTF. MANAGEMENT LINE DESCRIPTION     *
      * ZDATE2   - CONVERT A DAY NUMBER TO A DATE FORMAT                 *
      * GLINTC   - CALCULATE INTEREST BETWEEN ANY TWO DAY NUMBERS        *
      * PTFDET   - ACCESS PORTFOLIO DETAILS                              *
      * ZSAVE    - MEMORISE THE SETTING & TO SET OFF IND. 90-97          *
      * ZRSTOR   - RESTORE IND. 90-97 TO THE SETTINGS THEY HAD BEFORE    *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      *                                                                  *
      ********************************************************************
     C**************************************************************************
      /EJECT
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C*****************************************************************
     C** KEY DEFINITION
     C*****************************************************************
     C*
     C           KDEAL     KLIST
     C                     KFLD           DTYP
     C                     KFLD           DLST
     C****                                                                B08275
     C****       KCHRQ1    KLIST                                          B08275
     C****                 KFLD           POCNUM                          B08275
     C****                 KFLD           POPTFR                          B08275
     C*
     C           KPORQ2    KLIST
     C                     KFLD           PNCNUM
     C                     KFLD           PNPTFR
      *                                                                   CPM005
     C           KPORT     KLIST                                          CPM005
     C                     KFLD           WWCNUM                          CPM005
     C                     KFLD           QFPTFR                          CPM005
      *                                                                   CPM005
     C           KPORQ3    KLIST                                          CPM005
     C**********           KFLD           KWCNUM  60                                   CPM005 CSD027
     C                     KFLD           KWCNUM  6                                           CSD027
     C                     KFLD           KWPTFR  4                       CPM005
     C                     KFLD           KWCDAT  50                      CPM005
     C*
     C           KHSEX     KLIST
     C                     KFLD           WWCCYH  3
     C                     KFLD           WWDATE  50
     C*                                                                   R00631
     C** KLIST TO ACCESS LF/XDEALSL1                                      R00631
     C           KXDEAL    KLIST                                          R00631
     C                     KFLD           WWCNUM                          R00631
     C                     KFLD           WWVDAT                          R00631
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** MAIN PROCESSING
     C*****************************************************************
     C*
     C           *ENTRY    PLIST
     C                     PARM           MODE    1
     C                     PARM           WWTVPS  1
     C                     PARM           WWMTEX  1                       B08253
     C*
     C                     EXSR INIT
     C*
     C** IF MODE PARAMETER IS 'F' (FOR FULL EXTRACT) EXECUTE PROCESS
     C** FULX
     C           MODE      IFEQ 'F'
     C                     EXSR FULX
     C                     END
     C*
     C** EXECUTE PROCESS P07 - AUDIT PROCESSING
     C                     EXSR P07
     C                     SETON                     LR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INIT     - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWECD    - EVENT CONTROL DATE                                    *
      *                                                                  *
      ********************************************************************
     C           INIT      BEGSR                           ** INIT  BSR **
     C*                                                                   S01486
     C**  Define local data area                                          S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C*
     C** PREPARE LDA
     C*                                                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM1144'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C           *LIKE     DEFN A8BRCD    WWBRCA                          CPM004
     C*                                                                   S71062
     C                     Z-ADD0         QFNMDP                          S71062
     C                     MOVE 'U'       QFSPBS                          S71062
     C*                                                                   CPM004
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1******************         S01486
     C***********          READ SDBANKL1                 71               S01486
     C************IN71     IFEQ '1'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD1         DBASE            **DB ERROR 01**S01486
     C***********          MOVEL'SDBANKL1'DBFILE           ***************S01486
     C***********          MOVEL*BLANKS   DBKEY                           S01486
     C*                                                                   S01486
     C**  Access bank details                                             S01486
     C*                                                                   S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            ***************S01486
     C                     MOVE 'SDBANKPD'DBFILE           *DB ERROR 001 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C** TEST DATE FORMAT FOR SR/ZDATE2
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C                     END
     C*                                                                   CPB001
     C**  Access Module Details                                           CPB001
     C*                                                                   CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM *BLANKS   P@RTCD                          CPB001
     C                     PARM '*FIRST'  P@OPTN                          CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
     C*                                                                   CPB001
     C           P@RTCD    IFNE *BLANKS                                   CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD30        DBASE            ***************CPB001
     C                     MOVE 'SDMMODPD'DBFILE           *DB ERROR 030 *CPB001
     C                     MOVEL'*FIRST'  DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   R05669
     C***GET*PORTFOLIO*MANAGEMENT*INSTALLATION*CONTROL*DATA*RECORD R05669 S01486
     C****                 READ SDPORTPD                 71               B08040
     C***********1         SETLLSDPORTPD                           B08040 S01486
     C***********          READ SDPORTPD                 71        B08040 S01486
     C************IN71     IFEQ '1'                        ********R05669 S01486
     C***********          Z-ADD21        DBASE            **DB ERRR05669 S01486
     C***********          MOVEL'SDPORTPD'DBFILE           ********R05669 S01486
     C***********          MOVEL*BLANKS   DBKEY                    R05669 S01486
     C*                                                                   S01486
     C**  Access Portfolio Management ICD                                 S01486
     C*                                                                   S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD21        DBASE            ***************S01486
     C                     MOVE 'SDPORTPD'DBFILE           *DB ERROR 021 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     R05669
     C                     END                                            R05669
     C*
     C** DEFINE DATA AREA PMSTAT
     C           *NAMVAR   DEFN           PMSTAT
     C                     IN   PMSTAT
     C                     Z-ADDWWECD     QFDXTR                          S01313
     C*                                                                   B08040
     C***READ*THROUGH*SDCURRL0*SETTING*UP*ARRAY*OF*CURRENCIES****  B08040 S01486
     C***********          READ SDCURRL0                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the first Currency record                                  S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C                     PARM           P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD23        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 023 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set up array of currencies                                      S01486
     C*                                                                   S01486
     C                     Z-ADD1         B       30                      B08040
     C************IN72     DOWEQ'0'                                B08040 S01486
     C           P@RTCD    DOWNE'*EOF'                                    S01486
     C                     MOVE A6CYCD    CYCD,B                          B08040
     C                     Z-ADDA6SPRT    SPRT,B                          B08040
     C                     Z-ADDA6NBDP    NBDP,B                          B08040
     C                     MOVE A6MDIN    MDIN,B                          B08040
     C                     Z-ADDA6RKSQ    RKSQ,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ SDCURRL0                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the next record in currencies file                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*NEXT '  P@OPTN                          S01486
     C                     PARM           P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           P@RTCD    ANDNE'*EOF'                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD24        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 024 *S01486
     C                     MOVEL'*NEXT '  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C** READ THROUGH PMDSPGPP SETTING UP ARRAY OF DISPLAY GROUPS         B08040
     C***********          READ PMDSPGPP                 72        B08040 S01486
     C                     READ PMDSPGPD                 72               S01486
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PADSPG    DSPG,B                          B08040
     C                     Z-ADDPADSPS    DSPS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMDSPGPP                 72        B08040 S01486
     C                     READ PMDSPGPD                 72               S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C** READ THROUGH PMVLGHPP SETTING UP ARRAY OF VALUATION GROUPS       B08040
     C***********          READ PMVLGHPP                 72        B08040 S01486
     C                     READ PMVLGHPD                 72               S01486
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PBVALG    VALG,B                          B08040
     C                     Z-ADDPBVLGS    VLGS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMVLGHPP                 72        B08040 S01486
     C                     READ PMVLGHPD                 72               S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C***READ*THROUGH*SDBRCHL1*SETTING*UP*ARRAY*OF*BRANCH CODES**  B08040 S01486
     C***********          READ SDBRCHL1                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the first Branch record                                    S01486
     C*                                                                   S01486
     C**********           CALL 'AOBRCHR0'                                             S01486 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C                     PARM           P@BRCD  3                       S01486
     C           SDBRCH    PARM SDBRCH    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD25        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 025 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set up array of branches                                        S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               B08040
     C************IN72     DOWEQ'0'                                B08040 S01486
     C           P@RTCD    DOWNE'*EOF'                                    S01486
     C                     MOVE A8BRCD    BRC1,B                          B08040
     C                     MOVE A8BICN    BICN,B                          B08040
     C*                                                                   B08040
     C***********A8BICN    CHAINSDCUSTL0             71            B08040 S01486
     C***********                                                  B08040 S01486
     C************IN71     IFEQ '1'                        ********B08040 S01486
     C***********          Z-ADD86        DBASE            **DB ERRB08040 S01486
     C***********          MOVEL'SDCUSTL0'DBFILE           ********B08040 S01486
     C***********          MOVELA8BICN    DBKEY                    B08040 S01486
     C*                                                                   S01486
     C**  Access Customer details                                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM A8BICN    P@CUST 10                       S01486
     C                     PARM *BLANKS   P@KYST  7                       S01486
     C***********SDCUST    PARM SDCUST    DSFDY                     S01486176443
     C           SDCUST    PARM SDCUST    DSSDY                           176443
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD86        DBASE            ***************S01486
     C                     MOVE 'SDCUSTPD'DBFILE           *DB ERROR 086 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C                     MOVE BBCOLC    COLC,B                          B08040
     C                     MOVE BBLICD    LICD,B                          B08040
     C*                                                                   B08040
     C                     ADD  1         B                               B08040
     C***********          READ SDBRCHL1                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the next branch record                                     S01486
     C*                                                                   S01486
     C**********           CALL 'AOBRCHR0'                                             S01486 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*NEXT '  P@OPTN                          S01486
     C                     PARM           P@BRCD  3                       S01486
     C           SDBRCH    PARM SDBRCH    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           P@RTCD    ANDNE'*EOF'                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD24        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 026 *S01486
     C                     MOVEL'*NEXT '  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     END                                            B08040
     C*                                                                   147727
     C* Retrive accrued on last day indicator ACLD on TABTB11             147727
     C*                                                                   147727
     C           1         SETLLTABTB11                                   147727
     C                     READ TABTB11                  99               147727
     C           *IN99     IFEQ '1'                                       147727
     C                     SETON                     U7U8                 147727
     C                     ELSE                                           147727
     C           RECI      IFNE 'D'                                       147727
     C                     SETON                     U7U8                 147727
     C                     END                                            147727
     C                     END                                            147727
     C*
     C                     Z-ADD*HIVAL    QFOAMT                          B08040
     C/COPY WNCPYSRC,PM1144C001
     C*
     C           EINIT     ENDSR                           ** END INIT  **
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * P01      - ACCESS INSTRUMENT DETAILS                             *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      * P03      - FORMAT FX DEAL DETAILS FOR OUTPUT TO PORTF.HOLDING    *
      * P04      - FORMAT MM DEAL DETAILS FOR OUT.TO PORTF. HOLDINGS     *
      * P05      - FORMAT FRA/IRS DEAL DETAILS FOR OUT.TO PORTF.HOLD.    *
      * PTFDET   - ACCESS PORTFOLIO DETAILS                              *
      * W01      - WRITE TO PORTF. HOLDINGS                              *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWDTYP   - DEAL TYPE                                             *
      * WWDLST   - DEAL SUB-TYPE                                         *
      * WWCNUM   - CUSTOMER NUMBER                                       *
      * WWDLNO   - DEAL NUMBER                                           *
      * WWVDAT   - VALUE DATE                                            *
      * WWOTDT   - OPTION TO DATE                                        *R00631
      * WWRECI   - RECORD ID                                             *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      * WWPUCY   - PURCHASE CURRENCY                                     *
      * WWSLCY   - SELL CURRENCY                                         *
      * WWPUAM   - PURCHASE AMOUNT                                       *
      * WWSLAM   - SELL AMOUNT                                           *
      * WWCCY    - CURRENCY FROM DEALSDCF                                *
      * WWINTR   - INTEREST RATE                                         *
      * WWMDAT   - MATURITY DATE                                         *
      * WWNOTD   - NOTICE DAYS FROM THE DEALS FILE                       *
      * WWPCPL   - PRINCIPAL AMOUNT                                      *
      * WWIACD   - INTEREST ACCRUAL CONTROL DATE                         *
      * WWSLID   - START/LAST INTEREST DATE                              *
      * WWAITC   - ACCRUED INTEREST TO CONTROL DATE                      *
      * WWAIAN   - ACCRUED INTEREST ADJUSTED NOT POSTED                  *
      * WWAIAP   - ACCRUED INTEREST ADJUSTMENT POSTED                    *
      * WWIPRD   - INTEREST PAID/RECEIVED TO DATE                        *
      * WWICTD   - INTEREST CAPITALIZED TO DATE                          *
      * WWNIDT   - NEXT INTEREST PAYMENT DATE                            *
      * WWICBS   - INTEREST CALCULATION BASIS                            *
      *                                                                  *
      ********************************************************************
     C           FULX      BEGSR                           ** FULX  BSR **
     C*
     C** READ FROM LF/DEALSP2 (DEALS BY DEAL TYPE/SUB TYPE)
     C***********          READ DEALSP2                  71               S01486
     C                     READ PMDEALL2                 71               S01486
     C*                                                                   S01486
     C**  Check if main file is empty                                     S01486
     C*                                                                   S01486
     C           *IN71     IFEQ '1'                                       S01486
     C                     MOVE 'Y'       WEMPTY  1                       S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANK    WEMPTY                          S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Process each LF/PMDEALL2 record                                 S01486
     C*                                                                   S01486
     C           *IN71     DOWEQ'0'
     C*
     C** ON CHANGE OF DEAL TYPE OR DEAL SUB TYPE
     C** ACCESS INSTRUMENT DETAILS AS PER P01
     C           WWDTYP    IFNE DTYP
     C           WWDLST    ORNE DLST
     C           *IN01     OREQ '1'                                       R10038
     C                     EXSR P01
     C                     END
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C**                                                                  CPM004
     C** ON CHANGE OF BRANCH                                              CPM004
     C** ACCESS BRANCH DETAILS AS PER BRANCH                              CPM004
     C**                                                                  CPM004
     C           WWBRCA    IFNE BRCA                                      CPM004
     C                     EXSR BRANCH                                    CPM004
     C                     MOVE BRCA      WWBRCA                          CPM004
     C                     ENDIF                                          CPM004
     C                     MOVE O#BICN    CNUM                            CPM004
     C                     MOVELO#ACOF    WWACOC                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*
     C** ON CHANGE OF CUSTOMER
     C** ACCESS CUSTOMER DETAILS FOR THE CUSTOMER NUMBER ON LF/DEALSP2
     C** AS PER P02
     C           FCPORS    IFNE 'B'                                       CPM004
     C*                                                                   CPM004
     C           WWCNUM    IFNE CNUM
     C                     MOVE CNUM      WCNUM   6
     C                     EXSR P02
     C                     END
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*
     C** ON CHANGE OF CUSTOMER OR PORTFOLIO
     C** OBTAIN PORTFOLIO DETAILS
     C*
     C           WWCNUM    IFNE CNUM
     C           WWPTFR    ORNE PTFR
     C                     MOVE CNUM      PNCNUM
     C                     MOVE PTFR      PNPTFR
     C                     EXSR PTFDET
     C*                                                                   R00631
     C** CLEAR MATCHING FX DEALS ARRAYS                                   R00631
     C                     MOVEA*ZEROS    ODA                             R00631
     C                     MOVEA*ZEROS    CDA                             R00631
     C*******              Z-ADD0         J       30                B08072R00631
     C                     Z-ADD0         JK      30                      B08072
     C                     END
     C*
     C** SAVE SOME FIELDS FROM FILE DEALSP2
     C**********           Z-ADDCNUM      WWCNUM  60                                          CSD027
     C                     MOVE CNUM      WWCNUM  6                                           CSD027
     C                     Z-ADDDLNO      WWDLNO  60
     C                     Z-ADDVDAT      WWVDAT  50
     C                     MOVELRECI      WWRECI  1
     C                     MOVELPTFR      WWPTFR  4
     C                     MOVELDTYP      WWDTYP  2
     C                     MOVELDLST      WWDLST  2
     C*
     C           *IN01     IFEQ '1'                                       R10038
     C                     Z-ADDXDDAT1    WWDDAT  50                      R10038
     C                     ELSE                                           R10038
     C                     Z-ADD0         WWDDAT                          R10038
     C                     END                                            R10038
     C*
     C** IF THE RECORD READ FROM LF/DEALSP2 HAS THE FORMAT DEALSDBF
     C** => *IN01 IS ON
     C           *IN01     IFEQ '1'
     C*
     C** SAVE SOME FIELDS FROM FILE DEALSDBF
     C                     Z-ADDOTDT      WWOTDT  50                      R00631
     C                     MOVELPUCY      WWPUCY  3
     C                     MOVELSLCY      WWSLCY  3
     C                     Z-ADDPUAM      WWPUAM 130
     C                     Z-ADDSLAM      WWSLAM 130
     C                     Z-ADDEXRT      WWEXRT 138
     C*
     C** FORMAT FX DEALS DETAILS FOR OUTPUT TO THE PORTFOLIO HOLDINGS
     C** AS PER P03
     C                     EXSR P03
     C                     END
     C*
     C** IF THE RECORD READ FROM LF/DEALSP2 HAS THE FORMAT DEALSDCF
     C** => *IN02 IS ON
     C           *IN02     IFEQ '1'
     C*
     C** SAVE SOME FIELDS FROM FILE DEALSDCF
     C                     MOVELCCY       WWCCY   3
     C***********          MOVE BRCD      WWBRCD  3                R05669 S01486
     C                     MOVE BRCA      WWBRCD  3                       S01486
     C                     Z-ADDINTR      WWINTR 117
     C                     Z-ADDMDAT      WWMDAT  50
     C                     Z-ADDNOTD      WWNOTD  30
     C                     Z-ADDPCPL      WWPCPL 130
     C                     Z-ADDIACD      WWIACD  50
     C                     Z-ADDSLID      WWSLID  50
     C                     Z-ADDAITC      WWAITC 130
     C                     Z-ADDAIAN      WWAIAN 130
     C                     Z-ADDAIAP      WWAIAP 130
     C                     Z-ADDIPRD      WWIPRD 130
     C                     Z-ADDICTD      WWICTD 130
     C                     Z-ADDNIDT      WWNIDT  50
     C                     Z-ADDICBS      WWICBS  10
     C*
     C** FORMAT MM DEAL DETAILS FOR OUTPUT TO THE PORTFOLIO HOLDINGS
     C** AS PER P04
     C                     EXSR P04
     C                     END
     C*
     C** IF THE RECORD READ FROM LF/DEALSP2 HAS THE FORMAT DEALSDGF
     C** => *IN03 IS ON
     C           *IN03     IFEQ '1'
     C*
     C** SAVE SOME FIELDS FROM FILE DEALSDGF
     C                     MOVELUCUCY     WUCUCY  3
     C                     MOVELTCUCY     WTCUCY  3
     C                     Z-ADDUEINR     WUEINR 117
     C                     Z-ADDMDAT      WWMDAT  50
     C                     Z-ADDUPAMT     WUPAMT 130
     C                     Z-ADDTPAMT     WTPAMT 130
     C*
     C** FORMAT FRA/IRS DEALS DETAILS FOR OUTPUT TO THE PORTFOLIO HOLDINGS
     C** AS PER P05
     C                     EXSR P05
     C                     END
     C*
     C** WRITE A RECORD TO THE PORTFOLIO HOLDINGS FILE AS PER W01
     C** SET THE PORTF. REF. EQUAL TO THAT FROM LF/DEALSP2
     C** (PORTFOLIO RECORD)
     C                     MOVELWWPTFR    WPTFR   4
     C                     EXSR W01
     C*
     C** IF THE PORTFOLIO REFERENCE FROM LF/DEALSP2 IS NOT '9997',
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO '9998'
     C** (PORTFOLIO CONSOLIDATED RECORD)
     C*
     C** SET THE BOOK & MARKET FX RATES & P/L FX EQUAL TO ZERO
     C*
     C           *IN02     IFEQ '1'                                       R00631
     C           *IN03     OREQ '1'                                       R00631
     C                     Z-ADD0         WWBFXR 138
     C                     Z-ADD0         WWMFXR 138
     C                     END                                            R00631
     C*
     C           *IN01     IFEQ '1'                                       R05586
     C                     Z-ADDWWPLF1    WWPLFX                          R05586
     C                     ELSE                                           R05586
     C                     Z-ADD0         WWPLFX 150
     C                     END                                            R05586
     C           WWPTFR    IFNE '9997'
     C                     MOVEL'9998'    WPTFR
     C                     EXSR W01
     C                     END
     C*
     C** IF PRIVATE BANKING MODULE IS NOT SWITCH *ON                      CPB001
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO '9999'
     C** (CUSTOMER CONSOLIDATED RECORD)
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVEL'9999'    WPTFR
     C                     EXSR W01
     C                     ENDIF                                          CPB001
     C*
     C** ADD 1 TO A COUNT OF PORTFOLIO HOLDINGS CREATED
     C****                 ADD  1         PPHCRE                          B08040
     C*
     C** READ FROM LF/DEALSP2
     C                     MOVE '0'       *IN01
     C                     MOVE '0'       *IN02
     C                     MOVE '0'       *IN03
     C***********          READ DEALSP2                  71               S01486
     C                     READ PMDEALL2                 71               S01486
     C                     END
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P01      - ACCESS INSTRUMENT DETAILS                             *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINNR   - INSTRUMENT NARRATIVE                                  *
      * WWDTNR   - DEAL TYPE NARRATIVE                                   *
      * WWITDS   - INSTRUMENT DISPLAY SEQUENCE                           *
      * WWVLIS   - VALUATION GROUP INSTRUMENT SEQUENCE                   *
      * WWDSPG   - DISPLAY GROUP CODE                                    *
      * WWVALG   - VALUATION GROUP CODE                                  *
      * WWDSPS   - DISPLAY GROUP SEQUENCE                                *
      * WWVLGS   - VALUATION GROUP SEQUENCE                              *
      *                                                                  *
      ********************************************************************
     C           P01       BEGSR                           ** P01   BSR **
     C*
     C** ACCESS THE DEAL TYPES/SUB-TYPES FILE PF/SDDTSTPP USING THE
     C** DEAL TYPE AND DEAL SUB-TYPE FROM THE DEALS FILE
     C***********KDEAL     CHAINSDDTSTPP             72                   S01486
     C           KDEAL     CHAINFDDTSTL0             72                   S01486
     C           *IN72     IFEQ '1'
     C***********P7RECI    OREQ '*'                                       S01486
     C           RCID11    OREQ '*'                                       S01486
     C*                                                                   S01486
     C** ERROR
     C                     Z-ADD2         DBASE            **DB ERROR 02**
     C***********          MOVEL'SDDTSTPP'DBFILE           ***************S01486
     C                     MOVE 'FDDTSTPD'DBFILE                          S01486
     C                     MOVELDTYP      DBKY4   4
     C                     MOVE DLST      DBKY4
     C                     MOVELDBKY4     DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *                                                                   182961
      ** Instrument type is defaulted from PF/SDPORTPD if a blank         182961
      ** instrument type is found.                                        182961
      ** Indicator 35 was used as the operation's resulting indicator.    182961
      *                                                                   182961
     C           INNR      IFEQ *BLANKS                                   182961
     C           1         SETLLSDPORTPD                                  182961
     C                     READ SDPORTPD                 35               182961
     C                     MOVE FCDINR    INNR                            182961
     C                     ENDIF                                          182961
     C*
     C** SAME SOME FIELDS
     C** INSTRUMENT TYPE
     C***********          MOVELP7INNR    WWINNR  3                       S01486
     C                     MOVELINNR      WWINNR  3                       S01486
     C*                                                                   S01486
     C** DEAL TYPE NARRATIVE
     C           *IN01     IFEQ '1'                                       R10038
     C***********          MOVELP7DTNR    WWWK16 16                R10038 S01486
     C                     MOVELNARR11    WWWK16 16                       S01486
     C                     MOVE *BLANKS   WWDTNR 20                       R10038
     C                     MOVELSLCY      WWDTNR                          R10038
     C                     MOVE WWWK16    WWDTNR                          R10038
     C                     ELSE                                           R10038
     C***********          MOVELP7DTNR    WWDTNR                          S01486
     C                     MOVELNARR11    WWDTNR                          S01486
     C                     END                                            R10038
     C*
     C                     END
     C*
     C** ACCESS THE PM INSTRUMENT TYPES FILE PF/SDPLINPD USING THE
     C** INSTRUMENT TYPE FROM PF/SDDTSTPP
     C***********P7INNR    CHAINSDPLINPD             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***********PDRECI    OREQ '*'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD3         DBASE            **DB ERROR 03**S01486
     C***********          MOVEL'SDPLINPD'DBFILE           ***************S01486
     C***********          MOVELP7INNR    DBKEY                           S01486
     C*                                                                   S01486
     C**  Access Instrument types details                                 S01486
     C*                                                                   S01486
     C                     CALL 'AOPLINR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM INNR      P@INNR  3                       S01486
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD3         DBASE            ***************S01486
     C                     MOVE 'SDPLINPD'DBFILE           *DB ERROR 003 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@INNR    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C*
     C** SAVE SOME FIELDS
     C** INSTRUMENT DISPLAY SEQUENCE
     C                     Z-ADDPDITDS    WWITDS  20
     C** VALUATION GROUP INSTRUMENT SEQ.
     C                     Z-ADDPDVLIS    WWVLIS  20
     C** DISPLAY GROUP CODE
     C                     MOVELPDDSPG    WWDSPG  3
     C** VALUATION GROUP CODE
     C                     MOVELPDVALG    WWVALG  3
     C                     END
     C*
     C** ACCESS THE DISPLAY GROUP DETAILS FILE PF/PMDSPGPP USING
     C** THE DISPLAY GROUP FROM PF/SDPLINPD
     C****       PDDSPG    CHAINPMDSPGPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****       PARECI    OREQ '*'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD4         DBASE            **DB ERROR 04**B08040
     C****                 MOVEL'PMDSPGPP'DBFILE           ***************B08040
     C****                 MOVELPDDSPG    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****ISPLAY GROUP SEQ.                                               B08040
     C****                 Z-ADDPADSPS    WWDSPS  20                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PDDSPG    LOKUPDSPG,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD4         DBASE            **DB ERROR 04**B08040
     C***********          MOVEL'PMDSPGPP'DBFILE           ********B08040 S01486
     C                     MOVE 'PMDSPGPD'DBFILE                          S01486
     C                     MOVELPDDSPG    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDDSPS,B    PADSPS                          B08040
     C                     Z-ADDPADSPS    WWDSPS  20                      B08040
     C                     END                                            B08040
     C*
     C** ACCESS THE VALUATION GROUP HEADINGS FILE PF/PMVLGHPP
     C** USING THE VALUATION GROUP FROM PF/SDPLINPD
     C****       PDVALG    CHAINPMVLGHPP             72
     C****       *IN72     IFEQ '1'
     C****       PBRECI    OREQ '*'
     C****RROR
     C****                 Z-ADD5         DBASE            **DB ERROR 05**
     C****                 MOVEL'PMVLGHPP'DBFILE           ***************
     C****                 MOVELPDVALG    DBKEY
     C****                 EXSR *PSSR
     C****                 ELSE
     C****
     C****AVE SOME FIELDS
     C****ALUATION GROUP SEQ.
     C****                 Z-ADDPBVLGS    WWVLGS  20
     C****                 END
     C*
     C                     Z-ADD1         B
     C           PDVALG    LOKUPVALG,B                   72
     C*
     C           *IN72     IFEQ '0'
     C                     Z-ADD5         DBASE            **DB ERROR 05**
     C***********          MOVEL'PMVLGHPP'DBFILE           ***************S01486
     C                     MOVE 'PMVLGHPD'DBFILE                          S01486
     C                     MOVELPDVALG    DBKEY
     C                     EXSR *PSSR
     C                     ELSE
     C                     Z-ADDVLGS,B    PBVLGS
     C                     Z-ADDPBVLGS    WWVLGS  20
     C                     END
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT                                                              CPM004
      ********************************************************************CPM004
      *                                                                   CPM004
      * BRANCH   - RETRIEVE BRANCH'S CUSTOMER DETAILS                     CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLS:                                                 CPM004
      * *PSSR    - DB ERROR SUB-ROUTINE                                   CPM004
      * AOPLCSR1 - PORTFOLIO MANAGEMENT CUSTOMER DETAILS                  CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLED FROM:                                           CPM004
      * FULX     - FULL EXTRACT                                           CPM004
      *                                                                   CPM004
      * ROUTINE USES VARIABLES:                                           CPM004
      *                                                                   CPM004
      ********************************************************************CPM004
     C           BRANCH    BEGSR                                          CPM004
     C**                                                                  CPM004
     C                     MOVE 'B'       I#PORS                          CPM004
     C                     MOVE FCR997    I#R997                          CPM004
     C                     MOVE BRCA      I#BRCA                          CPM004
     C**                                                                  CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CPM004
     C                     PARM '*KEY   ' P@OPTN  7        I:Option       CPM004
     C                     PARM           I@PARM           I:Parameters   CPM004
     C                     PARM *BLANKS   O@PARM           O:Parameters   CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY            O:Format       CPM004
     C*                                                                   CPM004
     C** ERROR                                                            CPM004
     C           P@RTCD    IFNE *BLANK                                    CPM004
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD40        DBASE            ***************CPM004
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 40 *CPM004
     C                     MOVELI#BRCA    DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
      *                                                                   CPM004
     C                     ENDSR                                          CPM004
      ********************************************************************CPM004
      /EJECT
      ********************************************************************
      *                                                                  *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAVCD   - ACCOUNT OFFICER CODE FROM SDPLCSL0                    *
      *                                                                  *
      ********************************************************************
     C           P02       BEGSR                           *** P02    ***
     C*
     C** ACCESS CUSTOMER DETAILS FROM LF/SDPLCSL0 USING A KEY OF THE
     C** CUSTOMER NUMBER PASSED TO THIS PROCESS
     C***********WCNUM     CHAINSDPLCSL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD6         DBASE            **DB ERROR 06**S01486
     C***********          MOVEL'SDPLCSL0'DBFILE           ***************S01486
     C***********          MOVELWCNUM     DBKEY                           S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          ELSE                                           S01486
     C*                                                                   S01486
     C**  Access Portfolio Management Customer details                    S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM WCNUM     P@CUST                          S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD6         DBASE            ***************S01486
     C                     MOVE 'SDPLCSPD'DBFILE           *DB ERROR 006 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C**  Access Customer details                                         S01486
     C*                                                                   S01486
     C**********           CALL 'AOCUSTR0'                         S01486 CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C**********           PARM QBCUST    P@CUST                   S01486 CPB001
     C                     PARM WCNUM     P@CUST                          CPB001
     C                     PARM *BLANKS   P@KYST                          S01486
     C********** SDCUST    PARM SDCUST    DSFDY                    S01486 CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD29        DBASE            ***************S01486
     C                     MOVE 'SDCUSTPD'DBFILE           *DB ERROR 029 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*
     C** SAVE SOME FIELDS
     C** ACCOUNT OFFICER CODE
     C***********          MOVELBBACOC    WWACOC  2                B08040 S01486
     C                     MOVELBBACOC    WWACOC  3                       S01486
     C***********          END                                            S01486
     C*                                                                   CPB001
     C** Default Base Currency if Private banking Module is active        CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C**********           Z-ADDCNUM      PNCNUM                                       CPB001 CSD027
     C                     MOVE CNUM      PNCNUM                                              CSD027
     C                     MOVE PTFR      PNPTFR                          CPB001
     C           KPORQ2    CHAINPMPORTPD             72                   CPB001
     C*                                                                   CPB001
     C           *IN72     IFEQ *ON                                       CPB001
     C           PNRECI    OREQ '*'                                       CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD31        DBASE            **DB ERROR 31**CPB001
     C                     MOVE 'PMPORTPD'DBFILE                          CPB001
     C                     MOVELCNUM      DBKEY     P                     CPB001
     C                     MOVE PTFR      DBKEY                           CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C                     MOVELPNPTCY    QBCSBY                          CPB001
     C                     Z-ADDPNPCDP    QBBYDP                          CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P03      - FORMAT FX DEAL DETAILS FOR OUTPUT TO PORTF.HOLDING    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **MATCH****-*CHECK*FOR*MATCHING*DEALS                       *R00631 CPK008
      * MATCHS   - CHECK FOR MATCHING DEALS                              *CPK008
      * ZFDLLN   - FORMAT THE 20A PORTF. MANAGEMENT LINE DESCRIPTION     *
      * *PSSR    - ERROR SUBROUTINE                                      *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE SPOT RATES OF THE TWO CURRENCIES            *
      * ZCCYXR   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE EXCHANGE RATE BETWEEN THE TWO CURRENCIES    *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTXT1   - MIDAS INSTRUMENT NAME                                 *
      * WWPUCY   - PURCHASE CURRENCY                                     *
      * WWSLCY   - SELL CURRENCY                                         *
      * WWVDAT   - VALUE DATE                                            *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS NARRATIVE                  *
      * WWAMT1   - AMOUNT 1                                              *
      * WWAMT2   - AMOUNT 2                                              *
      * WWCCY1   - CURRENCY 1                                            *
      * WWCCY2   - CURRENCY 2                                            *
      * WWSPO1   - SPOT RATE 1                                           *R00631
      * WWSPO2   - SPOT RATE 2                                           *R00631
      * WWCDP1   - CURRENCY DEC. PLACES FOR CURRENCY 1                   *
      * WWCDP2   - CURRENCY DEC. PLACES FOR CURRENCY 2                   *
      * WWMDI1   - MULTIPLY/DIVIDE INDICATOR                             *R00631
      * WWMDI2   - MULTIPLY/DIVIDE INDICATOR                             *R00631
      * WWMVAL   - MARKET VALUE                                          *
      * WWINTK   - ACCRUED INTEREST                                      *
      * WWNIDT   - NEXT INTEREST PAYMENT DATE                            *
      * WWSLID   - START/LAST INTEREST DATE                              *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTEREST                       *
      * WWOCT    - OPENING/CLOSING TRANSACTION INDICATOR                 *R00631
      * WWRDLN   - RELATED DEAL NUMBER                                   *R00631
      * WWOTDT   - OPTION TO DATE                                        *R00631
      * WWRANK   - RANK                                                  *R00631
      * WWPLCY   - PROFIT/LOSS CURRENCY                                  *R00631
      * WWBOSF   - BUY OR SELL FIRST                                     *R00631
      * WWFDVL   - FORWARD DATE VALUE IN LOWER CURRENCY                  *R00631
      * WWPAOD   - PURCHASE AMOUNT OF OPENING DEAL                       *R00631
      * WWSAOD   - SALE AMOUNT OF OPENING DEAL                           *R00631
      * WWPACD   - PURCHASE AMOUNT OF CLOSING DEAL                       *R00631
      * WWSACD   - SALE AMOUNT OF CLOSING DEAL                           *R00631
      * WWSCOD   - SALE CURRENCY OF OPENING DEAL                         *R00631
      * WWPCCD   - PURCHASE CURRENCY OF CLOSING DEAL                     *R00631
      * WWPSPR   - PORTFOLIO CCY SPOT RATE                               *R00631
      * WWPCDP   - PORTFOLIO CCY NO OF DEC PLACES                        *R00631
      * WWPMDI   - PORTFOLIO CCY MULT/DIV IND                            *R00631
      *                                                                  *
      ********************************************************************
     C           P03       BEGSR                           *** P03    ***
     C*                                                                   R00631
     C** INITIALISE WORK FIELDS                                           R00631
     C                     MOVE *BLANK    WWOCT   1                       R00631
     C***********          MOVE *BLANK    WWBOSF  1                R00631 CPM005
     C                     MOVE 'B'       WWBOSF  1                       CPM005
     C           FCPORS    IFEQ 'B'                                       CPM005
     C                     MOVE 'S'       WWBOSF                          CPM005
     C                     END                                            CPM005
     C                     Z-ADD0         WWDSEQ  30                      R00631
     C                     Z-ADD0         WWRDLN  60                      R00631
     C                     MOVE *BLANKS   WWDLAM  1                       S01313
     C*
     C** MOVE THE DEAL TYPE NARRATIVE FROM PF/SDDTSTPP INTO THE MIDAS
     C** INSTRUMENT NAME
     C                     MOVELWWDTNR    WWTXT1 20
     C*                                                                   R00631
     C** IF THE DEAL IS MATURED OR, FOR OPTION DEAL, THE OPTION TO DATE   R00631
     C** IS < OR = TO RUN DATE, SET OPENING/CLOSING TRANSACTION TO 'M'    R00631
     C** AND RELATED DEAL NO TO 0                                         R00631
     C           WWVDAT    IFLE BJRDNB                     B1             R00631
     C           WWDTYP    OREQ 'OP'                                      R00631
     C           WWOTDT    ANDLEBJRDNB                                    R00631
     C                     MOVE 'M'       WWOCT                           R00631
     C                     Z-ADD0         WWRDLN                          R00631
     C                     END                             E1             R00631
     C*                                                                   R00631
     C** IF NOT AN OPTION DEAL AND NOT A TAKEDOWN DEAL AND                R00631
     C** OPENING/CLODING TRANSACTION IND NOT = 'M'                        R00631
     C           WWDTYP    IFNE 'OP'                       B1             R00631
     C           WWDTYP    ANDNE'OT'                                      R00631
     C           WWOCT     ANDNE'M'                                       R00631
     C                     EXSR MATCHS                                    R00631
     C                     END                             E1             R00631
     C*                                                                   R00631
     C** IF OPTION DEAL AND OPENING/CLOSING TRANSACTION IND NOT = 'M'     R00631
     C           WWDTYP    IFEQ 'OP'                       B1             R00631
     C           WWOCT     ANDNE'M'                                       R00631
     C*                                                                   R00631
     C** IF DEAL AMOUNT = 0 SET OPENING/CLOSING TRANSACTION IND TO 'C'    R00631
     C           WWPUAM    IFEQ 0                          B2             R00631
     C                     MOVE 'C'       WWOCT                           R00631
     C*                                                                   R00631
     C** OTHERWISE SET OPENING/CLOSING TRANSACTION IND TO 'L'             R00631
     C                     ELSE                            X2             R00631
     C                     MOVE 'L'       WWOCT                           R00631
     C                     END                             E2             R00631
     C*                                                                   R00631
     C** SET RELATED DEAL NUMBER TO 0                                     R00631
     C                     Z-ADD0         WWRDLN                          R00631
     C                     END                             E1             R00631
     C*                                                                   R00631
     C** IF TAKEDOWN DEAL AND OPENING/CLOSING TRANSACTION IND NOT = 'M'   R00631
     C           WWDTYP    IFEQ 'OT'                       B1             R00631
     C           WWOCT     ANDNE'M'                                       R00631
     C*                                                                   R00631
     C** SET OPENING/CLOSING TRANSACTION IND TO 'L'                       R00631
     C                     MOVE 'L'       WWOCT                           R00631
     C*                                                                   R00631
     C** SET RELATED DEAL NUMBER TO 0                                     R00631
     C                     Z-ADD0         WWRDLN                          R00631
     C*                                                                   R00631
     C** SET PROFIT/LOSS CCY TO *BLANK                                    R00631
     C                     MOVE *BLANK    WWPLCY  3                       R00631
     C                     END                             E1             R00631
     C*                                                                   R00631
     C** ACCESS LF/SDCURRL0 USING SELL CURRENCY AS KEY                    R00631
     C****       WWSLCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                        B1             B08040
     C****RROR                                                            B08040
     C****                 Z-ADD16        DBASE            **DB ERROR 16**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELWWSLCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                            X1             B08040
     C****                                                                B08040
     C****AVE SPOT RATE, CCY DEC PLACES AND MULT/DIV IND                  B08040
     C****ROM LF/SDCURRL0 FOR THE SELL CURRENCY                           B08040
     C****                 Z-ADDA6SPRT    WWSPO1 138                      B08040
     C****                 Z-ADDA6NBDP    WWCDP1  10                      B08040
     C****                 MOVE A6MDIN    WWMDI1  1                       B08040
     C****                 MOVE A6RKSQ    WWRANK  50                      B08040
     C****                 MOVE A6RKSQ    WWSLCR  30                      B08040
     C****                 END                             E1             B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWSLCY    LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                        B1             B08040
     C                     Z-ADD16        DBASE            **DB ERROR 16**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWSLCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                            X1             B08040
     C*                                                                   B08040
     C** SAVE SPOT RATE, CCY DEC PLACES AND MULT/DIV IND                  B08040
     C** FROM LF/SDCURRL0 FOR THE SELL CURRENCY                           B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWSPO1 138                      B08040
     C                     Z-ADDA6NBDP    WWCDP1  10                      B08040
     C                     Z-ADDA6NBDP    WWSAL1  10                      CPM005
     C                     MOVE A6MDIN    WWMDI1  1                       B08040
     C                     MOVE A6RKSQ    WWRANK  50                      B08040
     C                     MOVE A6RKSQ    WWSLCR  30                      B08040
     C                     END                             E1             B08040
     C*                                                                   R00631
     C** ACCESS LF/SDCURRL0 USING PURCHASE CURRENCY AS KEY                R00631
     C****       WWPUCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                        B1             B08040
     C****RROR                                                            B08040
     C****                 Z-ADD17        DBASE            **DB ERROR 17**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELWWPUCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                            X1             B08040
     C****                                                                B08040
     C****                 MOVE A6RKSQ    WWPUCR  30                      B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWPUCY    LOKUPCYCD,B                   72               B08040
     C** ERROR                                                            B08040
     C           *IN72     IFEQ '0'                        B1             B08040
     C                     Z-ADD17        DBASE            **DB ERROR 17**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWPUCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                            X1             B08040
     C*                                                                   B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     MOVE A6RKSQ    WWPUCR  30                      B08040
     C                     Z-ADDA6NBDP    WWPUD1  10                      CPM005
     C*                                                                   R00631
     C** SAVE SPOT RATE, CCY DEC PLACES AND MULT/DIV IND                  R00631
     C** FROM LF/SDCURRL0 FOR THE PURCHASE CURRENCY.                      R00631
     C** FIRST, DETERMINE WHICH CURRENCY MUST BE CONSIDERED AS            R00631
     C** THE HIGHER CURRENCY AND WHICH THE LOWER CURRENCY.                R00631
     C           WWRANK    IFLT A6RKSQ                     B2             R00631
     C*                                                                   R00631
     C** SELL CURRENCY IS THE HIGHER                                      R00631
     C                     Z-ADDA6SPRT    WWSPO2 138                      R00631
     C                     Z-ADDA6NBDP    WWCDP2  10                      R00631
     C                     MOVE A6MDIN    WWMDI2  1                       R00631
     C                     MOVE WWSLCY    WWCCY1  3                       R00631
     C                     MOVE WWPUCY    WWCCY2  3                       R00631
     C                     ELSE                            X2             R00631
     C*                                                                   R00631
     C** PURCHASE CURRENCY IS THE HIGHER                                  R00631
     C***********          Z-ADDWWSPO1    WWSPO2                   R00631 CPM005
     C                     Z-ADDWWSPO1    WWSPO2 138                      CPM005
     C***********          Z-ADDWWCDP1    WWCDP2                   R00631 CPM005
     C                     Z-ADDWWCDP1    WWCDP2  10                      CPM005
     C***********          MOVE WWMDI1    WWMDI2                   R00631 CPM005
     C                     MOVE WWMDI1    WWMDI2  1                       CPM005
     C                     Z-ADDA6SPRT    WWSPO1                          R00631
     C                     Z-ADDA6NBDP    WWCDP1                          R00631
     C                     MOVE A6MDIN    WWMDI1                          R00631
     C                     MOVE WWSLCY    WWCCY2  3                       R00631
     C                     MOVE WWPUCY    WWCCY1  3                       R00631
     C                     END                             E2             R00631
     C                     END                             E1             R00631
     C*                                                                   R05760
     C** FOR MATURED FX DEALS THE FX P&L SHOULD BE SET TO ZERO AND THE    R05760
     C** FX P&L CURRENCY SET TO THE HIGHER RANKING CURRENCY               R05760
     C           WWOCT     IFEQ 'M'                                       R05760
     C                     MOVE WWCCY1    WWPLCY                          R05760
     C                     Z-ADD0         WWPLFX                          R05760
     C                     END                                            R05760
     C*                                                                   R00631
     C** MOVE LEFT HIGHER CCY INTO THE MIDAS INSTRUMENT NAME              R00631
     C***********          MOVELWWCCY1    WWTXT1                   R00631 CPM005
     C                     MOVELWWSLCY    WWTXT1                          CPM005
     C*                                                                   R00631
     C** SET UP INPUT FIELDS FOR SR/ZFWDRT :                              R00631
     C** 'FROM' FIELDS FROM HIGHER CCY & 'TO' FIELDS FROM LOWER CCY       R00631
     C                     MOVE WWCCY1    ZCCYF                           R00631
     C                     Z-ADDWWCDP1    ZCDPF                           R00631
     C                     MOVE WWMDI1    ZMDINF                          R00631
     C                     Z-ADDWWSPO1    ZSPOTF                          R00631
     C                     MOVE WWCCY2    ZCCYT                           R00631
     C                     Z-ADDWWCDP2    ZCDPT                           R00631
     C                     MOVE WWMDI2    ZMDINT                          R00631
     C                     Z-ADDWWSPO2    ZSPOTT                          R00631
     C*
     C** DETERMINE THE INSTRUMENT ENQUIRY DETAILS NARRATIVE USING THE
     C** STANDARD SUBROUTINE ZFDLLN WITH THE FOLLOWING INPUT PARM.:
     C***ZPUCY:*PURCHASE*CURRENCY*FROM*THE*DEALS*FILE******************** R00631
     C** ZPUCY: LOWER CURRENCY FROM THE DEALS FILE                        R00631
     C***ZSLCY:*SELL*CURRENCY*FROM*THE*DEALS*FILE************************ R00631
     C** ZVDAT: VALUE DATE FROM THE DEALS FILE
     C** ZDDAT: DEAL DATE FROM THE DEALS FILE                             R00631
     C***********          MOVE WWCCY2    ZPUCY                    R00631 CPM005
     C                     MOVE WWPUCY    ZPUCY                           CPM005
     C******************** MOVELWWPUCY    ZPUCY                           R00631
     C*********            MOVELWWSLCY    ZSLCY                           R10038
     C                     Z-ADDWWVDAT    ZVDAT
     C                     Z-ADDWWDDAT    ZDDAT                           R10038
     C                     EXSR ZFDLLN
     C**********           MOVELZLIN      WWTXT2 20                                           CGL029
     C                     MOVELZLIN      WWTXT2 26                                           CGL029
     C*                                                                   R00631
     C                     Z-ADD0         WWBFXR                          R00631
     C                     Z-ADD0         WWMFXR                          R00631
     C                     Z-ADD0         WWPLFX                          R00631
     C*                                                                   R00631
     C** SET LINE 1 AMOUNT EQUAL TO THE HIGHER CURRENCY AMOUNT            R00631
     C** SET LINE 2 AMOUNT EQUAL TO THE LOWER CURRENCY AMOUNT             R00631
     C           WWCCY1    IFEQ WWSLCY                     B1             R00631
     C                     Z-ADDWWSLAM    WWAMT1 150                      R00631
     C                     Z-ADDWWPUAM    WWAMT2 150                      R00631
     C                     MOVE 'B'       WWBOSF                          R00631
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVE 'S'       WWBOSF                          CPM004
     C                     END                                            CPM004
     C*                                                                   R00631
     C** REMOVE IMPLIED DECIMAL PLACES FROM AMOUNTS AND CALCULATE         R00631
     C** BOOK FX RATE                                                     R00631
     C                     Z-ADDWWCDP1    K       30                      R00631
     C                     ADD  4         K                               R00631
     C           WWSLAM    DIV  POWER,K   WWSLM1 153H                     R00631
     C*                                                                   R00631
     C                     Z-ADDWWCDP2    K                               R00631
     C                     ADD  4         K                               R00631
     C           WWPUAM    DIV  POWER,K   WWPUM1 153H                     R00631
     C*                                                                   R00631
     C           WWPUM1    DIV  WWSLM1    WWBFXR    H                     R00631
     C                     ELSE                            X1             R00631
     C                     Z-ADDWWSLAM    WWAMT2                          R00631
     C                     Z-ADDWWPUAM    WWAMT1                          R00631
     C***********          MOVE 'S'       WWBOSF  1                R00631 CPM005
     C***********FCPORS    IFEQ 'B'                                CPM004 CPM005
     C***********          MOVE 'B'       WWBOSF                   CPM004 CPM005
     C***********          END                                     CPM004 CPM005
     C*                                                                   R00631
     C** REMOVE IMPLIED DECIMAL PLACES FROM AMOUNTS AND CALCULATE         R00631
     C** BOOK FX RATE                                                     R00631
     C                     Z-ADDWWCDP1    K                               R00631
     C                     ADD  4         K                               R00631
     C           WWPUAM    DIV  POWER,K   WWPUM1 153H                     R00631
     C*                                                                   R00631
     C                     Z-ADDWWCDP2    K                               R00631
     C                     ADD  4         K                               R00631
     C           WWSLAM    DIV  POWER,K   WWSLM1 153H                     R00631
     C*                                                                   R00631
     C           WWSLM1    DIV  WWPUM1    WWBFXR    H                     R00631
     C                     END                             E1             R00631
     C*
     C** SET THE MARKET VALUE EQUAL TO ZERO
     C                     Z-ADD0         WWMVAL 150
     C*
     C** SET THE ACCRUED INTEREST DATE EQUAL TO ZERO
     C                     Z-ADD0         WWINTK 150
     C*
     C** SET THE NEXT INTEREST DATE EQUAL TO ZERO
     C                     Z-ADD0         WWNIDT  50
     C*
     C** SET THE START/LAST INTEREST DATE EQUAL TO ZERO
     C                     Z-ADD0         WWSLID  50
     C*
     C** SET THE NUMBER OF DAYS ACCRUED INTEREST EQUAL TO ZERO
     C                     Z-ADD0         WWNODA  30
     C*                                                                   R00631
     C** OPENING/CLOSING TRANSACTION 'L' PROCESSING                       R00631
     C           WWDTYP    IFEQ 'OP'                       B1             R00631
     C                     Z-ADDWWOTDT    ZDATN                           R00631
     C                     ELSE                            X1             R00631
     C                     Z-ADDWWVDAT    ZDATN                           R00631
     C                     END                             E1             R00631
     C** PERFORM SR/ZFWDRT WITH 'FROM' AMOUNT = AMOUNT FROM HIGHER CCY    R00631
     C           WWOCT     IFNE 'M'                        B1             R00631
     C                     Z-ADDBJRDNB    ZRDATE                          R00631
     C                     Z-ADDWWAMT1    ZAMTF                           R00631
     C                     EXSR ZFWDRT                                    R00631
     C*                                                                   R00631
     C** SET THE MARKET FX RATE = TO THE CROSS RATE ZCRSRT                R00631
     C           ZCRSMD    IFEQ 'D'                        B2
     C           1         DIV  ZCRSRT    ZCRSRT
     C                     MOVE 'M'       ZCRSMD
     C                     END                             E2
     C*
     C                     MOVE ZCRSMD    QFMFMD                          R0631
     C                     Z-ADDZCRSRT    WWMFXR                          R00631
     C***                  Z-ADDZCRSRT    QFMFXR                   036681 044902
     C*                                                                   R00631
     C                     END                             E1             R00631
     C*                                                                   R00631
     C** SAVE ZAMTT AS FORWARD DATE VALUE IN LOWER CCY                    R00631
     C           WWOCT     IFEQ 'L'                        B1             R00631
     C                     Z-ADDZAMTT     WWFDVL 150                      R00631
     C*                                                                   R00631
     C** CALCULATE THE FX PROFIT AND LOSS                                 R00631
     C           FCPORS    IFNE 'B'                                       103086
     C           WWCCY2    IFEQ WWSLCY                     B2             R00631
     C           WWAMT2    SUB  WWFDVL    WWPLFX                          R00631
     C                     ELSE                            X2             R00631
     C           WWFDVL    SUB  WWAMT2    WWPLFX                          R00631
     C                     END                             E2             R00631
     C**                                                                  103086
     C** ..IF BANK PORTFOLIO, REVERSE SIGN                                103086
     C                     ELSE                                           103086
     C           WWCCY2    IFEQ WWSLCY                     B2             103086
     C           WWFDVL    SUB  WWAMT2    WWPLFX                          103086
     C                     ELSE                            X2             103086
     C           WWAMT2    SUB  WWFDVL    WWPLFX                          103086
     C                     END                             E2             103086
     C                     ENDIF                                          103086
     C*                                                                   R00631
     C** SET THE PARAMETERS TO BE USED IN SR/ZCCYCN                       R00631
     C                     MOVE WWCCY2    ZCCYF                           R00631
     C**                   Z-ADDWWSPO2    ZRATEF                    R00631R0138
     C****                 Z-ADDWWSPO2    ZSPOTF                    S01313R0138
     C                     Z-ADDWWSPO2    ZRATEF                          S01313
     C                     MOVE WWMDI2    ZMDINF                          R00631
     C                     Z-ADDWWCDP2    ZCDPF                           R00631
     C                     Z-ADDWWPLFX    ZAMTF                           R00631
     C*                                                                   R00631
     C** SET PROFIT AND LOSS CURRENCY TO THE LOWER CURRENCY               R00631
     C                     MOVE WWCCY2    WWPLCY                          R00631
     C*                                                                   R00631
     C** SET ACCRUED INTEREST TO FX PROFIT AND LOSS                       R00631
     C**                   Z-ADDWWPLFX    WWINTK                    R00631R0099
     C************         Z-ADDWWPLFX    WWINTK                    R05586R0168
     C                     Z-ADDWWPLFX    WWMVAL                          R05586
     C                     END                             E1             R00631
     C*                                                                   R00631
     C** OPENING/CLOSING TRANSACTION 'O' PROCESSING                       R00631
     C           WWOCT     IFEQ 'O'                        B1             R00631
     C*                                                                   R00631
     C** IF PURCHASE AMT OF OPENING DEAL = SALE AMT OF CLOSING DEAL       R00631
     C           WWPAOD    IFEQ WWSACD                     B2             R00631
     C*                                                                   R00631
     C** SUBTRACT SALE AMT OF OF OPENING DEAL FROM PURCHASE AMT           R00631
     C** OF CLOSING DEAL GIVING FX PROFIT AND LOSS                        R00631
     C***********WWPACD    SUB  WWSAOD    WWPLFX                          R05736
     C           WWSAOD    SUB  WWPACD    WWPLFX                          R05736
     C*                                                                   R00631
     C** SET PROFIT AND LOSS CCY TO THE SALE CCY OF OPENING DEAL          R00631
     C                     MOVE WWSCOD    WWPLCY                          R00631
     C                     END                             E2             R00631
     C*                                                                   R00631
     C** IF SALE AMT OF OPENING DEAL = PURCHASE AMT OF CLOSING DEAL       R00631
     C           WWSAOD    IFEQ WWPACD                     B2             R00631
     C*                                                                   R00631
     C** SUBTRACT PURCHASE AMT OF OF OPENING DEAL FROM SALE AMT           R00631
     C** OF CLOSING DEAL GIVING FX PROFIT AND LOSS                        R00631
     C           WWSACD    SUB  WWPAOD    WWPLFX                          R00631
     C*                                                                   R00631
     C** SET PROFIT AND LOSS CCY TO THE PURCHASE CCY OF OPENING DEAL      R00631
     C                     MOVE WWPCOD    WWPLCY                          R00631
     C                     END                             E2             R00631
     C*
     C**                   Z-ADDWWPLFX    WWINTK                    R00631R0099
     C************         Z-ADDWWPLFX    WWINTK                    R05586R0168
     C                     Z-ADDWWPLFX    WWMVAL                          R05586
     C*                                                                   R00631
     C** SET THE PARAMETERS TO BE USED IN SR/ZCCYCN                       R00631
     C                     MOVE WWPLCY    ZCCYF                           R00631
     C                     Z-ADDWWPLFX    ZAMTF                           R00631
     C           WWPLCY    IFEQ ZCCYT                      B2             R00631
     C**                   Z-ADDZSPOTT    ZRATEF                    R00631R0138
     C****                 Z-ADDZSPOTT    ZSPOTF                    S01313R0138
     C                     Z-ADDZSPOTT    ZRATEF                          S01313
     C                     Z-ADDZCDPT     ZCDPF                           R00631
     C                     MOVE ZMDINT    ZMDINF                          R00631
     C                     ELSE                            X2             R00631
     C                     Z-ADDZSPOTF    ZRATEF                          R00631
     C                     END                             E2             R00631
     C                     END                             E1             R00631
     C*                                                                   R00631
     C** OPENING/CLOSING TRANSACTION 'C' OR 'M' PROCESSING                R00631
     C           WWOCT     IFEQ 'C'                        B1             R00631
     C           WWOCT     OREQ 'M'                                       R00631
     C*                                                                   R00631
     C** SET FX PROFIT AND LOSS TO ZERO                                   R00631
     C                     MOVE WWCCY1    WWPLCY                          B08251
     C                     Z-ADD0         WWPLFX                          R00631
     C                     Z-ADD0         WWPLF1                          R05586
     C*                                                                   R00631
     C** OTHER OPENING/CLOSING TRANSACTIONS PROCESSING                    R00631
     C                     ELSE                            X1             R00631
     C*                                                                   R00631
     C** IF FX PROFIT AND LOSS NEGATIVE INVERSE INPUT AMNT FOR SR/ZCCYCN  R00631
     C                     MOVE 'N'       WWNEG   1                       R05586
     C                     Z-ADDZAMTF     WWPLF1                          R05586
     C           WWPLFX    IFLT 0                          B2             R00631
     C                     MOVE 'Y'       WWNEG                           R05586
     C                     Z-SUBZAMTF     ZAMTF                           R00631
     C                     Z-ADDZAMTF     WWPLF1                          R05586
     C                     END                             E2             R00631
     C*                                                                   R00631
     C** SET THE OTHER PARAMETERS TO BE USED IN SR/ZCCYCN                 R00631
     C                     MOVE PNPTCY    ZCCYT                           R00631
     C**                   Z-ADDWWPSPR    ZRATET                    R00631R0138
     C****                 Z-ADDWWPSPR    ZSPOTT                    S01313R0138
     C                     Z-ADDWWPSPR    ZRATET                          S01313
     C                     Z-ADDWWPCDP    ZCDPT                           R00631
     C                     MOVE WWPMDI    ZMDINT                          R00631
     C*                                                                   R00631
     C** CONVERT FX PROFIT AND LOSS IN AMOUNT IN PORTFOLIO CURRENCY       R00631
     C** USING FORWARD RATES                                              R0138
     C**                   EXSR ZCCYCN                              R00631R0138
     C****                 EXSR ZFWDRT                              S01313R0138
     C*                                                                   R00631
     C** CONVERT FX PROFIT AND LOSS IN AMOUNT IN PORTFOLIO CURRENCY       R00631
     C** USING FORWARD RATES                                              R0138
     C**                   EXSR ZCCYCN                              R00631R0138
     C****                 EXSR ZFWDRT                              46081 R0138
     C*                                                                   B08040
     C                     Z-ADD1         B                               46018
     C           WWPLCY    LOKUPCYCD,B                   72               46018
     C** ERROR                                                            46018
     C           *IN72     IFEQ '0'                        B1             46018
     C                     Z-ADD47        DBASE            **DB ERROR 17**46018
     C***********          MOVEL'SDCURRL0'DBFILE           ********46018  S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWPUCY    DBKEY                           46018
     C                     EXSR *PSSR                                     46018
     C                     ELSE                            X1             46018
     C*                                                                   46018
     C                     MOVE WWPLCY    ZCCYF                           46018
     C                     Z-ADDSPRT,B    ZRATEF                          46018
     C                     Z-ADDNBDP,B    ZCDPF                           46018
     C                     MOVE MDIN,B    ZMDINF                          46018
     C                     END                             E1             46018
     C                     EXSR ZCCYCN                                    S01313
     C*                                                                   R00631
     C** IF THE FX PROFIT AND LOSS WAS NEGATIVE INVERSE THE AMOUNT        R00631
     C** OBTAINED FROM SR/ZCCYCN IN PORTFOLIO CURRENCY                    R00631
     C           WWPLFX    IFLT 0                          B2             R00631
     C                     Z-SUBZAMTT     WWPLFX                          R00631
     C                     ELSE                            X2             R00631
     C                     Z-ADDZAMTT     WWPLFX                          R00631
     C                     END                             E2             R00631
     C*                                                                   R05586
     C** CONVERT FX PROFIT AND LOSS FROM PORTFOLIO CURRENCY TO CUSTOMER   R05586
     C** BASE CURRENCY FOR OUTPUT FOR '9998' AND '9999' PORTFOLIO         R05586
     C                     MOVE QBCSBY    ZCCYT                           R05586
     C****       QBCSBY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                        B2             B08040
     C****                 Z-ADD90        DBASE            **DB ERROR 20**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELQBCSBY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 END                             E2             B08040
     C****                 Z-ADDA6SPRT    ZSPOTT                          B08040
     C****                 Z-ADDA6NBDP    ZCDPT                           B08040
     C****                 MOVE A6MDIN    ZMDINT                          B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           QBCSBY    LOKUPCYCD,B                   72               B08040
     C           *IN72     IFEQ '0'                        B2             B08040
     C                     Z-ADD90        DBASE            **DB ERROR 20**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELQBCSBY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                             E2             B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C*****                Z-ADDA6SPRT    ZSPOTT                    S01313R05586
     C                     Z-ADDA6SPRT    ZRATET                          S01313
     C                     Z-ADDA6NBDP    ZCDPT                           R05586
     C                     MOVE QBCSBY    ZCCYT                           46166
     C                     MOVE A6MDIN    ZMDINT                          R05586
     C*                                                                   R05586
     C** CONVERT FX PROFIT AND LOSS IN AMOUNT IN PORTFOLIO CURRENCY       R05586
     C** USING FORWARD RATES                                              R05586
     C                     Z-ADDWWPLF1    ZAMTF                           R05586
     C****                 EXSR ZFWDRT                              S01313R05586
     C                     EXSR ZCCYCN                                    S01313
     C*                                                                   R05586
     C           WWNEG     IFEQ 'Y'                        B2             R05586
     C                     Z-SUBZAMTT     WWPLF1 150                      R05586
     C                     ELSE                            X2             R05586
     C                     Z-ADDZAMTT     WWPLF1                          R05586
     C                     END                             E2             R05586
     C*                                                                   R00631
     C                     END                             E1             R00631
     C*                                                                   R05669
     C***********          MOVE P9CNCD    WWCNTR  2                R05669 S01486
     C***********          MOVE P9LICD    WWLIND  3                R05669 S01486
     C                     MOVE FCCNCD    WWCNTR  2                       S01486
     C                     MOVE FCLICD    WWLIND  3                       S01486
      *                                                                   CPM005
      **  Inverse details so that customer buy amount always first        CPM005
      *                                                                   CPM005
     C                     MOVE WWPUCY    WWCCY2                          CPM005
     C                     MOVE WWSLCY    WWCCY1                          CPM005
     C                     Z-ADDWWPUAM    WWAMT2                          CPM005
     C                     Z-ADDWWSLAM    WWAMT1                          CPM005
     C                     Z-ADDWWPUD1    WWCDP2                          CPM005
     C                     Z-ADDWWSAL1    WWCDP1                          CPM005
     C*
     C                     ENDSR
      ********************************************************************
      /EJECT                                                              R00631
      ********************************************************************R00631
      *                                                                  *R00631
      **MATCH****-*CHECK*FOR*MATCHING*DEALS                       *R00631 CPK008
      * MATCHS   - CHECK FOR MATCHING DEALS                              *CPK008
      *                                                                  *R00631
      * SUBROUTINE CALLS:                                                *R00631
      *                                                                  *R00631
      * SUBROUTINE CALLED FROM:                                          *R00631
      * P03      - FORMAT FX DEAL DETAILS FOR OUTPUT TO PORTF.HOLDING    *R00631
      *                                                                  *R00631
      * ROUTINE USES VARIABLES:                                          *R00631
      * WWDLNO   -                                                       *R00631
      * WWOCT    -                                                       *R00631
      * WWRDLN   -                                                       *R00631
      * WWDSEQ   -                                                       *R00631
      * WWCNUM   -                                                       *R00631
      * WWPTFR   -                                                       *R00631
      * WWVDAT   -                                                       *R00631
      * WWSLCY   -                                                       *R00631
      * WWPUCY   -                                                       *R00631
      * WWSLAM   -                                                       *R00631
      * WWPUAM   -                                                       *R00631
      * WWPAOD   -                                                       *R00631
      * WWSAOD   -                                                       *R00631
      * WWPACD   -                                                       *R00631
      * WWSACD   -                                                       *R00631
      * WWPCOD   -                                                       *R00631
      * WWSCOD   -                                                       *R00631
      * WWRRNP   - RELATIVE RECORD NUMBER OF LF/DEALSP2 OR LF/DEALSPT    *R00631
      * WWRRNX   - RELATIVE RECORD NUMBER OF LF/XDEALSL1                 *R00631
      *                                                                  *R00631
      ********************************************************************R00631
     C***********MATCH     BEGSR                    *** MATCH  *** R00631 CPK008
     C           MATCHS    BEGSR                           *** MATCH  *** CPK008
     C*                                                                   R00631
     C** INIT OPENING/CLOSING TRANSACTION, RELATED DEAL NUMBER AND        R00631
     C** DEAL SEQUENCE                                                    R00631
     C                     MOVE 'L'       WWOCT                           R00631
     C                     Z-ADD0         WWRDLN                          R00631
     C****                 Z-ADD999       WWDSEQ                          S01313
     C                     Z-ADD0         WWDSEQ                          S01313
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     GOTO MATCHE                                    CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   R00631
     C** SCAN THE OPENING DEALS ARRAY WITH DEAL NUMBER TO CHECK           R00631
     C** IF THE DEAL HAS ALREADY BEEN DETECTED AS A MATCHING DEAL         R00631
     C                     Z-ADD1         I       30                      R00631
     C           WWDLNO    LOKUPODA,I                    74               R00631
     C*                                                                   R00631
     C** DEAL FOUND                                                       R00631
     C           *IN74     IFEQ '1'                        B1             R00631
     C                     MOVE 'O'       WWOCT                           R00631
     C                     Z-ADDCDA,I     WWRDLN                          R00631
     C           I         MULT 2         WWDSEQ                          R00631
     C*                                                                   R00631
     C** SET UP WORK FIELDS FOR OPENING DEAL                              R00631
     C                     Z-ADDWWPUAM    WWPAOD 150                      R00631
     C                     Z-ADDWWSLAM    WWSAOD 150                      R00631
     C                     MOVE WWPUCY    WWPCOD  3                       R00631
     C                     MOVE WWSLCY    WWSCOD  3                       R00631
     C*                                                                   R00631
     C** OTHERWISE SCAN THE CLOSING DEALS ARRAY WITH DEAL NUMBER TO CHECK R00631
     C** IF THE DEAL HAS ALREADY BEEN DETECTED AS A MATCHING DEAL         R00631
     C                     ELSE                            X1             R00631
     C                     Z-ADD1         I       30                      R00631
     C           WWDLNO    LOKUPCDA,I                    74               R00631
     C*                                                                   R00631
     C** DEAL FOUND                                                       R00631
     C           *IN74     IFEQ '1'                        B2             R00631
     C                     MOVE 'C'       WWOCT                           R00631
     C                     Z-ADDODA,I     WWRDLN                          R00631
     C           I         MULT 2         WWDSEQ                          R00631
     C                     ADD  1         WWDSEQ                          R00631
     C*                                                                   R00631
     C** SET UP WORK FIELDS FOR CLOSING DEAL                              R00631
     C                     Z-ADDWWPUAM    WWPACD 150                      R00631
     C                     Z-ADDWWSLAM    WWSACD 150                      R00631
     C                     END                             E2             R00631
     C                     END                             E1             R00631
     C*                                                                   R00631
     C** IF THE RELATED DEAL NUMBER NOT 0 ACCESS LF/DEALS                 R00631
     C           WWRDLN    IFNE 0                          B1             R00631
     C           WWRDLN    CHAINDEALS                72                   R00631
     C           *IN72     IFEQ '1'                        B2             091194
     C                     MOVE '0'       *IN72                           091194
     C           WWRDLN    CHAINDEALSH              N72                   091194
     C                     END                             E2             091194
     C           *IN72     IFEQ '1'                        B2             R00631
     C** ERROR                                                            R00631
     C                     Z-ADD19        DBASE            **DB ERROR 19**R00631
     C***********          MOVEL'DEALS   'DBFILE           ********R00631 S01486
     C                     MOVE 'DEALS   'DBFILE                          S01486
     C                     MOVELWWRDLN    DBKEY                           R00631
     C                     EXSR *PSSR                                     R00631
     C*                                                                   R00631
     C** SET UP THE REMAINDER OF THE WORK FIELDS FOR OPENING/CLOSING DEAL R00631
     C                     ELSE                            X2             R00631
     C           WWOCT     IFEQ 'O'                        B3             R00631
     C                     Z-ADDXPUAM     WWPACD                          R00631
     C                     Z-ADDXSLAM     WWSACD                          R00631
     C                     ELSE                            X3             R00631
     C                     Z-ADDXPUAM     WWPAOD                          R00631
     C                     Z-ADDXSLAM     WWSAOD                          R00631
     C                     MOVE XPUCY     WWPCOD                          R00631
     C                     MOVE XSLCY     WWSCOD                          R00631
     C                     END                             E3             R00631
     C*                                                                   R00631
     C                     END                             E2             R00631
     C                     END                             E1             R00631
     C*                                                                   R00631
     C** IF THE DEAL HAS NOT BEEN DETECTED YET AS A MATCHING DEAL         R00631
     C           WWRDLN    IFEQ 0                          B1             R00631
     C*                                                                   R00631
     C** TRY TO FOUND A MATCHING DEAL ON LF/XDEALSL1                      R00631
     C                     MOVE '0'       *IN80                           R00631
     C**         KXDEAL    SETLLXDEALSL1                            R00631R0091
     C**                   READ XDEALSL1                 71         R00631R0091
     C***********KXDEAL    SETLLDEALSL1                            R0091  S01486
     C***********          READ DEALSL1                  71        R0091  S01486
     C           KXDEAL    SETLLPMDEALL5                                  S01486
     C                     READ PMDEALL5                 71               S01486
     C*                                                                   R00631
     C           *IN71     DOWEQ'0'                        B2             R00631
     C           XCNUM     ANDEQWWCNUM                                    R00631
     C           XVDAT     ANDEQWWVDAT                                    R00631
     C           *IN80     ANDEQ'0'                                       R00631
     C*                                                                   R00631
     C** TEST IF DEAL MATCHES DEAL READ IN LF/XDEALSL1                    R00631
     C           XPTFR     IFEQ WWPTFR                     B3             R00631
     C           XSLCY     ANDEQWWPUCY                                    R00631
     C           XPUCY     ANDEQWWSLCY                                    R00631
     C           XSLAM     IFEQ WWPUAM                     B4             R00631
     C           XPUAM     OREQ WWSLAM                                    R00631
     C*
     C** CHECK WHETHER DEAL HAS ALREADY BEEN USED AS OPENING / CLOSING
     C** DEAL
     C                     Z-ADD1         I       30                      B08251
     C           XDLNO     LOKUPCDA,I                    74               R00631
     C           *IN74     IFEQ '0'                        B5             R00631
     C           XDLNO     LOKUPODA,I                    74               R00631
     C                     END                             E5             R00631
     C*
     C           *IN74     IFEQ '0'                        B5
     C                     MOVE '1'       *IN80                           R00631
     C                     END                             E5             R00631
     C                     END                             E4             R00631
     C                     END                             E3             R00631
     C*                                                                   R00631
     C           *IN80     IFNE '1'                        B3             R00631
     C**                   READ XDEALSL1                 71         R00631R0091
     C***********          READ DEALSL1                  71        R0091  S01486
     C                     READ PMDEALL5                 71               S01486
     C                     END                             E3             R00631
     C                     END                             E2             R00631
     C*                                                                   R00631
     C** IF A MATCHING DEAL IS FOUND                                      R00631
     C           *IN80     IFEQ '1'                        B2             R00631
     C****                                                                R00631
     C***DETERMINE WHICH DEAL IS THE OPENING ONE AND WHICH THE CLOSING ONER00631
     C****       *IN01     IFEQ '1'                                       R00631
     C****                 Z-ADDXDDAT1    WWRRNP  80                      R00631
     C****                 ELSE                                           R00631
     C****                 Z-ADDXDDAT2    WWRRNP                          R00631
     C****                 END                                            R00631
     C****                 Z-ADDXDDAT3    WWRRNX  80                      R00631
     C*                                                                   R00631
     C** DEAL FROM LF/DEALSP2 OR LF/DEALSPT IS THE OPENING DEAL           R00631
     C********   XDDAT3    IFLE XDDAT                      B3             R0028
     C********   XDDAT3    IFGT XDDAT                      B3             R05736
     C           XDDAT3    IFGT XDDAT1                     B3             R05736
     C*****                ADD  1         J                         B08072R00631
     C*****                Z-ADDWWDLNO    ODA,J                     B08072R00631
     C*****                Z-ADDXDLNO     CDA,J                     B08072R00631
     C                     ADD  1         JK                              B08072
     C                     Z-ADDWWDLNO    ODA,JK                          B08072
     C                     Z-ADDXDLNO     CDA,JK                          B08072
     C*                                                                   R00631
     C** SET UP WORK FIELDS FOR OPENING AND CLOSING DEALS                 R00631
     C                     Z-ADDWWPUAM    WWPAOD                          R00631
     C                     Z-ADDWWSLAM    WWSAOD                          R00631
     C                     MOVE WWPUCY    WWPCOD                          R00631
     C                     MOVE WWSLCY    WWSCOD                          R00631
     C                     Z-ADDXPUAM     WWPACD                          R00631
     C                     Z-ADDXSLAM     WWSACD                          R00631
     C*                                                                   R00631
     C** SET OPENING/CLOSING TRANSACTION TO 'O' AND SET UP DEAL SEQ NO    R00631
     C                     MOVE 'O'       WWOCT                           R00631
     C******     J         MULT 2         WWDSEQ                          B08072
     C           JK        MULT 2         WWDSEQ                          B08072
     C                     Z-ADDXDLNO     WWRDLN                          R0046
     C*                                                                   R00631
     C** DEAL FROM LF/DEALSP2 OR LF/DEALSPT IS THE OPENING DEAL           R00631
     C                     ELSE                            X3             R00631
     C*********            ADD  1         J                         B08072R00631
     C*********            Z-ADDWWDLNO    CDA,J                     B08072R00631
     C*********            Z-ADDXDLNO     ODA,J                     B08072R00631
     C                     ADD  1         JK                              B08072
     C                     Z-ADDWWDLNO    CDA,JK                          B08072
     C                     Z-ADDXDLNO     ODA,JK                          B08072
     C*                                                                   R00631
     C** SET UP WORK FIELDS FOR OPENING AND CLOSING DEALS                 R00631
     C                     Z-ADDWWPUAM    WWPACD                          R00631
     C                     Z-ADDWWSLAM    WWSACD                          R00631
     C                     MOVE XPUCY     WWPCOD                          R00631
     C                     MOVE XSLCY     WWSCOD                          R00631
     C                     Z-ADDXPUAM     WWPAOD                          R00631
     C                     Z-ADDXSLAM     WWSAOD                          R00631
     C*                                                                   R00631
     C** SET OPENING/CLOSING TRANSACTION TO 'O' AND SET UP DEAL SEQ NO    R00631
     C                     MOVE 'C'       WWOCT                           R00631
     C********   J         MULT 2         WWDSEQ                    B08072R00631
     C           JK        MULT 2         WWDSEQ                          B08072
     C                     ADD  1         WWDSEQ                          R00631
     C                     Z-ADDXDLNO     WWRDLN                          R00631
     C                     END                             E3             R00631
     C                     END                             E2             R00631
     C*                                                                   R00631
     C                     END                             E1             R00631
     C*                                                                   CPM004
     C           MATCHE    TAG                                            CPM004
     C*                                                                   R00631
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P04      - FORMAT MM DEAL DETAILS FOR OUT.TO PORTF. HOLDINGS     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZFDLLN   - FORMAT THE 20A PORTF. MANAGEMENT LINE DESCRIPTION     *
      * *PSSR    - ERROR SUBROUTINE                                      *
      * P06      - DETERMINE INTEREST DETAILS                            *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE SPOT RATES OF THE TWO CURRENCIES            *
      * ZCCYXR   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE EXCHANGE RATE BETWEEN THE TWO CURRENCIES    *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTXT1   - MIDAS INSTRUMENT NAME                                 *
      * WWCCY    - CURRENCY FROM DEALSDCF                                *
      * WWINTR   - INTEREST RATE                                         *
      * WWMDAT   - MATURITY DATE                                         *
      * WWNOTD   - NOTICE DAYS FROM THE DEALS FILE                       *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS NARRATIVE                  *
      * WWAMT1   - AMOUNT 1                                              *
      * WWAMT2   - AMOUNT 2                                              *
      * WWCCY1   - CURRENCY 1                                            *
      * WWCCY2   - CURRENCY 2                                            *
      * WWCDP1   - CURRENCY DEC. PLACES FOR CURRENCY 1                   *
      * WWCDP2   - CURRENCY DEC. PLACES FOR CURRENCY 2                   *
      * WWDTYP   - DEAL TYPE                                             *
      * WWMVAL   - MARKET VALUE                                          *
      * WWINTK   - ACCRUED INTEREST                                      *
      * WWDRNK   - DEAL CURRENCY RANK                                    *R00631
      * WWPRNK   - PORTFOLIO CCY RANK                                    *R00631
      * WWBOSF   - BUY OR SELL FIRST                                     *R00631
      *                                                                  *
      ********************************************************************
     C           P04       BEGSR                           *** P04    ***
     C*                                                                   S01313
     C                     MOVE *BLANKS   WWDLAM  1                       S01313
     C*
     C** MOVE THE DEAL TYPE NARRATIVE FROM PF/SDDTSTPP INTO THE MIDAS
     C** INSTRUMENT NAME
     C                     MOVELWWDTNR    WWTXT1
     C*
     C** DETERMINE THE INSTRUMENT ENQUIRY DETAILS NARRATIVE USING THE
     C** STANDARD SUBROUTINE ZFDLLN WITH THE FOLLOWING INPUT PARM.:
     C** ZCCY  : CURRENCY FROM THE DEALS FILE
     C** ZINRT : INTEREST RATE FROM THE DEALS FILE
     C** ZMDAT : MATURITY DATE FROM THE DEALS FILE
     C** ZNOTD : NOTICE DAYS FROM THE DEALS FILE
     C                     MOVELWWCCY     ZCCY
     C                     Z-ADDWWINTR    ZINRT
     C                     Z-ADDWWMDAT    ZMDAT
     C                     Z-ADDWWNOTD    ZNOTD
     C                     EXSR ZFDLLN
     C                     MOVELZLIN      WWTXT2
     C*
     C** SET LINE 1 AMOUNT EQUAL TO THE PRINCIPAL
     C                     Z-ADDWWPCPL    WWAMT1
     C*
     C** SET LINE 2 AMOUNT EQUAL TO ZERO
     C                     Z-ADD0         WWAMT2
     C*
     C** SET CURRENCY 1 EQUAL TO THE DEAL CURRENCY
     C                     MOVELWWCCY     WWCCY1
     C*
     C** SET CURRENCY 2 EQUAL TO BLANK
     C                     MOVEL*BLANK    WWCCY2
     C*                                                                   B05987
     C** SET P/L CURRENCY TO THE DEAL CURRENCY                            B05987
     C                     MOVELWWCCY     WWPLCY                          B05987
     C*
     C** ACCESS LF/SDCURRL0 - CURRENCIES FOR CURRENCY DECIMAL PLACES
     C** LF/SDCURRL0 USING DEAL CURRENCY AS KEY
     C****       WWCCY     CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD9         DBASE            **DB ERROR 09**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELWWCCY     DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****ET CURRENCY DEC. PLACES 1 EQUAL TO THE CURRENCY DECIMAL         B08040
     C****LACES FROM LF/SDCURRL0 FOR THE DEAL CURRENCY                    B08040
     C****ND SAVE DEAL CURRENCY RANK                                      B08040
     C****                 Z-ADDA6NBDP    WWCDP1                          B08040
     C****                 Z-ADDA6RKSQ    WWDRNK  30                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWCCY     LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD9         DBASE            **DB ERROR 09**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWCCY     DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C*                                                                   B08040
     C** SET CURRENCY DEC. PLACES 1 EQUAL TO THE CURRENCY DECIMAL         B08040
     C** PLACES FROM LF/SDCURRL0 FOR THE DEAL CURRENCY                    B08040
     C** AND SAVE DEAL CURRENCY RANK                                      B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWSPR1 138                      B08040
     C                     Z-ADDA6NBDP    WWCDP1                          B08040
     C                     MOVE A6MDIN    WWMDI1  1                       B08040
     C                     Z-ADDA6RKSQ    WWDRNK  30                      B08040
     C                     END                                            B08040
     C*
     C** SET CURRENCY DECIMAL PLACES 2 EQUAL TO ZERO
     C                     Z-ADD0         WWCDP2
     C*
     C** IF THE DEAL TYPE IS 'IP', 'TI', 'LN', 'CL' OR 'DL'
     C           WWDTYP    IFEQ 'IP'
     C           WWDTYP    OREQ 'TI'
     C           WWDTYP    OREQ 'LN'
     C           WWDTYP    OREQ 'CL'
     C           WWDTYP    OREQ 'DL'
     C*
     C** SET THE MARKET VALUE EQUAL TO THE - PRINCIPAL
     C                     Z-SUBWWPCPL    WWMVAL
     C                     ELSE
     C*
     C** SET THE MARKET VALUE EQUAL TO THE + PRINCIPAL
     C                     Z-ADDWWPCPL    WWMVAL
     C                     END
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     Z-SUBWWMVAL    WWMVAL                          CPM004
     C                     END                                            CPM004
     C*
     C** DETERMINE THE INTEREST DETAILS FOR THIS HOLDINGS AS PER P06
     C                     EXSR P06
     C*
     C** IF THE DEAL TYPE IS 'IP', 'TI', 'LN', 'CL' OR 'DL'
     C           WWDTYP    IFEQ 'IP'
     C           WWDTYP    OREQ 'TI'
     C           WWDTYP    OREQ 'LN'
     C           WWDTYP    OREQ 'CL'
     C           WWDTYP    OREQ 'DL'
     C*
     C** REVERSE THE SIGN OF THE ACCRUED INTEREST
     C                     Z-SUBWWINTK    WWINTK
     C                     END
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     Z-SUBWWINTK    WWINTK                          CPM004
     C                     END                                            CPM004
     C*
     C** SET THE BOOK & MARKET FX RATES & P/L FX EQUAL TO ZERO
     C*
     C                     Z-ADD0         WWBFXR
     C                     Z-ADD0         WWMFXR
     C                     Z-ADD0         WWPLFX
     C*
     C** IF DEAL HAS NOT MATURED,
     C** CALCULATE FX PROFIT AND LOSS
     C*
     C           MDAT      IFGT WWECD                      - B1
     C****       VDAT      ANDGTWWECD                               46081 47617
     C********** VDAT      ANDLTWWECD                               47617 059111
     C           VDAT      ANDLEWWECD                                     059111
     C           MDAT      OREQ 0
     C****       VDAT      ANDGTWWECD                               46081 47617
     C********** VDAT      ANDLTWWECD                               47617 059111
     C           VDAT      ANDLEWWECD                                     059111
     C                     Z-ADD1         WWFLAG  10
      *                                                                   CPM005
      **  Retrieve the spot rate on PF/PMHSEXPD with the change date      CPM005
      **  instead of deal date if a change occured in the past            CPM005
      *                                                                   CPM005
     C**********           Z-ADDWWCNUM    KWCNUM                                       CPM005 CSD027
     C                     MOVE WWCNUM    KWCNUM                                              CSD027
      *                                                                   CPM005
     C           WWPTFR    IFEQ '9997'                     - B3           CPM005
     C                     MOVE *BLANKS   KWPTFR                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE WWPTFR    KWPTFR                          CPM005
     C                     END                             - E3           CPM005
      *                                                                   CPM005
     C                     Z-ADD*HIVAL    KWCDAT                          CPM005
      *                                                                   CPM005
     C           KPORQ3    SETGTPMPCBCL3                                  CPM005
     C                     READPPMPCBCL3                 75               CPM005
      *                                                                   CPM005
      **  If a record found with same customer no. and same portfolio     CPM005
      *                                                                   CPM005
     C           *IN75     IFEQ '0'                        - B3           CPM005
     C           KWCNUM    IFNE FMCUST                     - B4           CPM005
     C           KWPTFR    ORNE FMPTFR                                    CPM005
     C                     MOVE '1'       *IN75                           CPM005
     C                     END                             - E4           CPM005
     C                     END                             - E3           CPM005
     C*
     C           WWFLAG    DOUEQ3                          - B2
     C                     MOVE CCY       WWCCYH
     C*
     C           WWFLAG    IFEQ 1                          - B3
     C*                                                                   CPM005
     C** IF A CHANGE OCCURED IN THE PAST, USE THE CHANGE CCY DATE         CPM005
     C           *IN75     IFEQ '0'                        - B4           CPM005
     C                     MOVE FMCDAT    WWDATE                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE DDAT      WWDATE
     C                     END                             - E4           CPM005
      *                                                                   CPM005
     C                     ELSE
     C                     MOVE WWECD     WWDATE
     C                     END                             - E3
     C*
     C** OBTAIN DETAILS FOR DEAL CURRENCY
     C***********KHSEX     SETGTPMHSEXPP                                  S01486
     C***********          READPPMHSEXPP                 71               S01486
     C           KHSEX     SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 71               S01486
     C*
     C** ERROR
     C*
     C           *IN71     IFEQ '1'                        - B3
     C           Q8CCY     ORNE CCY
     C                     MOVE *LOVAL    WWDATE
     C***********KHSEX     SETLLPMHSEXPP                                  S01486
     C***********          READ PMHSEXPP                 71               S01486
     C           KHSEX     SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 71               S01486
     C*
     C           *IN71     IFEQ '1'
     C           Q8CCY     ORNE CCY                        ***************
     C                     Z-ADD15        DBASE            **DB ERROR 15**
     C***********          MOVEL'PMHSEXPP'DBFILE           ***************S01486
     C                     MOVE 'PMHSEXPD'DBFILE                          S01486
     C                     MOVELWWCCYH    DBKY8   8
     C                     MOVE WWDATE    DBKY8
     C                     MOVELDBKY8     DBKEY
     C                     EXSR *PSSR
     C                     END
     C*
     C                     END                             - E3
     C*
     C                     Z-ADDPCPL      ZAMTF
     C                     MOVE CCY       ZCCYF
     C                     Z-ADDQ8SPOT    ZRATEF
     C                     MOVE Q8MDV1    ZMDINF
     C                     Z-ADDQ8CDP     ZCDPF
     C*
     C** OBTAIN DETAILS FOR PORTFOLIO CURRENCY
     C                     MOVE PNPTCY    WWCCYH
     C*
     C           WWFLAG    IFEQ 1                          - B3
      *                                                                   CPM005
      **  If a change occured in the past, use the change ccy date        CPM005
      *                                                                   CPM005
     C           *IN75     IFEQ '0'                        - B4           CPM005
     C                     MOVE FMCDAT    WWDATE                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE DDAT      WWDATE
     C                     END                             - E4           CPM005
      *                                                                   CPM005
     C                     ELSE
     C                     MOVE WWECD     WWDATE
     C                     END                             - E3
     C*
     C***********KHSEX     SETGTPMHSEXPP                                  S01486
     C***********          READPPMHSEXPP                 71               S01486
     C           KHSEX     SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 71               S01486
     C*
     C** ERROR
     C*
     C           *IN71     IFEQ '1'                        - B3
     C           Q8CCY     ORNE PNPTCY
     C                     MOVE *LOVAL    WWDATE
     C***********KHSEX     SETLLPMHSEXPP                                  S01486
     C***********          READ PMHSEXPP                 71               S01486
     C           KHSEX     SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 71               S01486
     C*
     C           *IN71     IFEQ '1'
     C           Q8CCY     ORNE PNPTCY                     ***************
     C                     Z-ADD15        DBASE            **DB ERROR 15**
     C***********          MOVEL'PMHSEXPP'DBFILE           ***************S01486
     C                     MOVE 'PMHSEXPD'DBFILE                          S01486
     C                     MOVELWWCCYH    DBKY8
     C                     MOVE WWDATE    DBKY8
     C                     MOVELDBKY8     DBKEY
     C                     EXSR *PSSR
     C                     END
     C*
     C                     END                             - E3
     C*
     C                     MOVE PNPTCY    ZCCYT
     C                     Z-ADDQ8SPOT    ZRATET
     C                     MOVE Q8MDV1    ZMDINT
     C                     Z-ADDQ8CDP     ZCDPT
     C                     EXSR ZCCYCN
     C*
     C** CONVERT RATE RETURNED FROM SR/ZCCYCN INTO A MULTIPLY RATE
     C           ZCRSMD    IFEQ 'D'
     C*****      WWDRNK    ANDLTWWPRNK                                    39440
     C********** WWDRNK    ANDGTWWPRNK                              39440 053090
     C           WWDRNK    ANDLTWWPRNK                                    053090
     C           ZCRSMD    OREQ 'M'                                       R00631
     C*****      WWDRNK    ANDGTWWPRNK                                    39440
     C********** WWDRNK    ANDLTWWPRNK                              39440 053090
     C           WWDRNK    ANDGTWWPRNK                                    053090
     C           1         DIV  ZCRSRT    ZCRSRT 138H
     C                     END
     C*
     C           WWFLAG    IFEQ 1                          - B3
     C                     Z-ADDZAMTT     WWSAV1 150
     C                     Z-ADDZCRSRT    WWBFXR
     C                     ELSE
     C                     Z-ADDZAMTT     WWSAV2 150
     C                     Z-ADDZCRSRT    WWMFXR
     C                     END                             - E3
     C*
     C                     ADD  1         WWFLAG
     C                     END                             - E2
     C*
     C           WWDTYP    IFEQ 'IP'                       - B2
     C           WWDTYP    OREQ 'TI'
     C           WWDTYP    OREQ 'LN'
     C           WWDTYP    OREQ 'CL'
     C           WWDTYP    OREQ 'DL'
     C           WWSAV1    SUB  WWSAV2    WWPLFX
     C                     ELSE
     C           WWSAV2    SUB  WWSAV1    WWPLFX
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*                                                                   R00631
     C** SET BUY OR SELL FIRST TO BLANK                                   R00631
     C                     MOVE *BLANK    WWBOSF                          R00631
     C****                                                          B08040R05669
     C****ETERMINE COUNTRY AND INDUSTRY CODE OF COUNTERPARTY TO LOANB08040R05669
     C****EPOSIT                                                    B08040R05669
     C****       WWBRCD    CHAINSDBRCHL1             71             B08040R05669
     C****                                                          B08040R05669
     C****       *IN71     IFEQ '1'                        *********B08040R05669
     C****                 Z-ADD85        DBASE            **DB ERROB08040R05669
     C****                 MOVEL'SDBRCHL1'DBFILE           *********B08040R05669
     C****                 MOVELWWBRCD    DBKEY                     B08040R05669
     C****                 EXSR *PSSR                               B08040R05669
     C****                 END                                      B08040R05669
     C****                                                          B08040R05669
     C****       A8BICN    CHAINSDCUSTL0             71             B08040R05669
     C****                                                          B08040R05669
     C****       *IN71     IFEQ '1'                        *********B08040R05669
     C****                 Z-ADD86        DBASE            **DB ERROB08040R05669
     C****                 MOVEL'SDCUSTL0'DBFILE           *********B08040R05669
     C****                 MOVELA8BICN    DBKEY                     B08040R05669
     C****                 EXSR *PSSR                               B08040R05669
     C****                 END                                      B08040R05669
     C****                                                          B08040R05669
     C****                 MOVE BBCOLC    WWCNTR                    B08040R05669
     C****                 MOVE BBLICD    WWLIND                    B08040R05669
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWBRCD    LOKUPBRC1,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD28        DBASE            **DB ERROR 20**B08040
     C***********          MOVEL'SDBRCHPD'DBFILE           ********B08040 S01486
     C                     MOVE 'SDBRCHPD'DBFILE                          S01486
     C                     MOVELWWBRCD    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** SAVE DETIALS FROM SDBRCHPD                                       B08040
     C                     MOVE BICN,B    A8BICN                          B08040
     C                     MOVE COLC,B    WWCNTR                    B08040R05669
     C                     MOVE LICD,B    WWLIND                    B08040R05669
     C*                                                                   082763
     C** Default Local Industry Code & Country of risk                    082763
     C** to ICD values if blank                                           082763
     C*                                                                   082763
     C           WWLIND    IFEQ *BLANKS                                   082763
     C                     MOVE FCLICD    WWLIND                          082763
     C                     END                                            082763
     C           WWCNTR    IFEQ *BLANKS                                   082763
     C                     MOVE FCCNCD    WWCNTR                          082763
     C                     END                                            082763
     C*                                                                   S01313
     C** SET DEAL AMENDMENTS PENDING INDICATOR                            S01313
     C           DAVD      IFNE 0                                         S01313
     C                     MOVE 'Y'       WWDLAM                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P05      - FORMAT FRA/IRS DEAL DETAILS FOR OUT.TO PORTF.HOLD.    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZFDLLN   - FORMAT THE 20A PORTF. MANAGEMENT LINE DESCRIPTION     *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTXT1   - MIDAS INSTRUMENT NAME                                 *
      * WWDTYP   - DEAL TYPE                                             *
      * WWMDAT   - MATURITY DATE                                         *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS NARRATIVE                  *
      * WWAMT1   - AMOUNT 1                                              *
      * WWAMT2   - AMOUNT 2                                              *
      * WWCCY1   - CURRENCY 1                                            *
      * WWCCY2   - CURRENCY 2                                            *
      * WWCDP1   - CURRENCY DEC. PLACES FOR CURRENCY 1                   *
      * WWCDP2   - CURRENCY DEC. PLACES FOR CURRENCY 2                   *
      * WWMVAL   - MARKET VALUE                                          *
      * WWINTK   - ACCRUED INTEREST                                      *
      * WWNIDT   - NEXT INTEREST PAYMENT DATE                            *
      * WWSLID   - START/LAST INTEREST DATE                              *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTEREST                       *
      * WWBOSF   - BUY OR SELL FIRST                                     *R00631
      *                                                                  *
      ********************************************************************
     C           P05       BEGSR                           *** P05    ***
     C*                                                                   S01313
     C                     MOVE *BLANKS   WWDLAM  1                       S01313
     C*
     C** MOVE THE DEAL TYPE NARRATIVE FROM PF/SDDTSTPP INTO THE MIDAS
     C** INSTRUMENT NAME
     C                     MOVELWWDTNR    WWTXT1
     C*
     C** IF THE DEAL TYPE IS 'FR' 'RS' OR 'RL'
     C           WWDTYP    IFEQ 'FR'
     C           WWDTYP    OREQ 'RS'
     C           WWDTYP    OREQ 'RL'
     C*
     C** DETERMINE THE INSTRUMENT ENQUIRY DETAILS NARRATIVE USING THE
     C** STANDARD SUBROUTINE ZFDLLN WITH THE FOLLOWING INPUT PARM.:
     C** ZUCUCY: OUR CURRENCY FROM THE DEALS FILE
     C** ZUEINR: INTEREST RATE FROM THE DEALS FILE
     C** ZMDAT: MATURITY DATE FROM THE DEALS FILE
     C                     MOVELWUCUCY    ZUCUCY
     C                     Z-ADDWUEINR    ZUEINR
     C                     Z-ADDWWMDAT    ZMDAT
     C                     EXSR ZFDLLN
     C                     MOVELZLIN      WWTXT2
     C*
     C** SET LINE 1 AMOUNT EQUAL TO THE OUR PRINCIPAL AMOUNT
     C                     Z-ADDWUPAMT    WWAMT1
     C*
     C** SET LINE 2 AMOUNT EQUAL TO ZERO
     C                     Z-ADD0         WWAMT2
     C*
     C** SET CURRENCY 1 EQUAL TO THE OUR CURRENCY
     C                     MOVELWUCUCY    WWCCY1
     C*
     C** SET CURRENCY 2 EQUAL TO BLANK
     C                     MOVEL*BLANK    WWCCY2
     C*
     C** ACCESS LF/SDCURRL0 - CURRENCIES FOR CURRENCY DECIMAL PLACES
     C** LF/SDCURRL0 USING OUR CURRENCY AS KEY
     C****       WUCUCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD10        DBASE            **DB ERROR 10**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELWUCUCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****ET CURRENCY DEC. PLACES 1 EQUAL TO THE CURRENCY DECIMAL         B08040
     C****LACES FROM LF/SDCURRL0 FOR THE OUR CURRENCY                     B08040
     C****                 Z-ADDA6NBDP    WWCDP1                          B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WUCUCY    LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD10        DBASE            **DB ERROR 10**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWUCUCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWSPR1 138                      B08040
     C                     Z-ADDA6NBDP    WWCDP1                          B08040
     C                     MOVE A6MDIN    WWMDI1  1                       B08040
     C                     Z-ADDA6RKSQ    WWDRNK  30                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** SET CURRENCY DEC. PLACES 2 EQUAL TO ZERO                         B08040
     C                     Z-ADD0         WWCDP2                          B08040
     C                     END                                            B08040
     C*
     C** IF THE DEAL TYPE IS 'RX'
     C           WWDTYP    IFEQ 'RX'
     C*
     C** DETERMINE THE INSTRUMENT ENQUIRY DETAILS NARRATIVE USING THE
     C** STANDARD SUBROUTINE ZFDLLN WITH THE FOLLOWING INPUT PARM.:
     C** ZUCUCY: OUR CURRENCY FROM THE DEALS FILE
     C** ZTCUCY: THEIR CURRENCY FROM THE DEALS FILE
     C** ZMDAT: MATURITY DATE FROM THE DEALS FILE
     C                     MOVELWUCUCY    ZUCUCY
     C                     MOVELWTCUCY    ZTCUCY
     C                     Z-ADDWWMDAT    ZMDAT
     C                     EXSR ZFDLLN
     C                     MOVELZLIN      WWTXT2
     C*
     C** SET LINE 1 AMOUNT EQUAL TO OUR PRINCIPAL AMOUNT
     C                     Z-ADDWUPAMT    WWAMT1
     C*
     C** SET LINE 2 AMOUNT EQUAL TO THEIR PRINCIPAL AMOUNT
     C                     Z-ADDWTPAMT    WWAMT2
     C*
     C** SET CURRENCY 1 EQUAL TO THE OUR CURRENCY
     C                     MOVELWUCUCY    WWCCY1
     C*
     C** SET CURRENCY 2 EQUAL TO THEIR CURRENCY
     C                     MOVELWTCUCY    WWCCY2
     C*
     C** ACCESS LF/SDCURRL0 - CURRENCIES FOR CURRENCY DECIMAL PLACES
     C** LF/SDCURRL0 USING OUR CURRENCY AS KEY
     C****       WUCUCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD11        DBASE            **DB ERROR 11**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELWUCUCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****ET CURRENCY DEC. PLACES 1 EQUAL TO THE CURRENCY DECIMAL         B08040
     C****LACES FROM LF/SDCURRL0 FOR THE OUR CURRENCY                     B08040
     C****                 Z-ADDA6NBDP    WWCDP1                          B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WUCUCY    LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD11        DBASE            **DB ERROR 11**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWUCUCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C*                                                                   B08040
     C** SET CURRENCY DEC. PLACES 1 EQUAL TO THE CURRENCY DECIMAL         B08040
     C** PLACES FROM LF/SDCURRL0 FOR THE OUR CURRENCY                     B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWSPR1 138                      B08040
     C                     Z-ADDA6NBDP    WWCDP1                          B08040
     C                     MOVE A6MDIN    WWMDI1  1                       B08040
     C                     Z-ADDA6RKSQ    WWDRNK  30                      B08040
     C                     END                                            B08040
     C*
     C** ACCESS LF/SDCURRL0 - CURRENCIES FOR CURRENCY DECIMAL PLACES
     C** LF/SDCURRL0 USING THEIR CURRENCY AS KEY
     C****       WTCUCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD12        DBASE            **DB ERROR 12**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELWTCUCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****ET CURRENCY DEC. PLACES 2 EQUAL TO THE CURRENCY DECIMAL         B08040
     C****LACES FROM LF/SDCURRL0 FOR THEIR CURRENCY                       B08040
     C****                 Z-ADDA6NBDP    WWCDP2                          B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WTCUCY    LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD12        DBASE            **DB ERROR 12**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWTCUCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C*                                                                   B08040
     C** SET CURRENCY DEC. PLACES 2 EQUAL TO THE CURRENCY DECIMAL         B08040
     C** PLACES FROM LF/SDCURRL0 FOR THEIR CURRENCY                       B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6NBDP    WWCDP2                          B08040
     C                     END                                            B08040
     C                     END
     C*
     C** SET THE MARKET VALUE EQUAL TO ZERO
     C                     Z-ADD0         WWMVAL
     C*
     C** SET THE ACCRUED INTEREST EQUAL TO ZERO
     C                     Z-ADD0         WWINTK
     C*
     C** SET THE NEXT INTEREST DATE EQUAL TO ZERO
     C                     Z-ADD0         WWNIDT
     C*
     C** SET THE START/LAST INTEREST DATE EQUAL TO ZERO
     C                     Z-ADD0         WWSLID
     C*
     C** SET THE NUMBER OF DAYS ACCRUED INTEREST EQUAL TO ZERO
     C                     Z-ADD0         WWNODA
     C*
     C** SET THE BOOK & MARKET FX RATES & P/L FX EQUAL TO ZERO
     C                     Z-ADD0         WWBFXR
     C                     Z-ADD0         WWMFXR
     C                     Z-ADD0         WWPLFX
     C*                                                                   R00631
     C** SET BUY OR SELL FIRST TO BLANK                                   R00631
     C                     MOVE *BLANK    WWBOSF                          R00631
     C*                                                                   R05669
     C***********          MOVE P9CNCD    WWCNTR                   R05669 S01486
     C***********          MOVE P9LICD    WWLIND                   R05669 S01486
     C                     MOVE FCCNCD    WWCNTR                          S01486
     C                     MOVE FCLICD    WWLIND                          S01486
     C*
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P06      - DETERMINE INTEREST DETAILS                            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * GLINTC   - CALCULATE INTEREST BETWEEN ANY TWO DAY NUMBERS        *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P04      - FORMAT MM DEAL DETAILS FOR OUT.TO PORTF. HOLDINGS     *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWSLID   - START/LAST INTEREST DATE                              *
      * WWSTRD   - START DATE                                            *
      * WWINIT   - INITIAL INTEREST                                      *
      * WWENDD   - END DATE                                              *
      * WWMDAT   - MATURITY DATE                                         *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTEREST                       *
      * WWPCPL   - PRINCIPAL AMOUNT                                      *
      * WWICBS   - INTEREST CALCULATION BASIS                            *
      * WWINTR   - INTEREST RATE                                         *
      * WWINTK   - ACCRUED INTEREST                                      *
      *                                                                  *
      ********************************************************************
     C           P06       BEGSR                           *** P06    ***
     C*
     C** THE FIELDS FROM PF/DEALSDC USED IN THIS PROCESS ARE AS FOLLOWS:
     C** IACD : INTEREST ACCRUAL CONTROL DATE (5,0)
     C** SLID : START/LAST INTEREST DATE (5,0)
     C** AITC : ACCRUED INTEREST TO CONTROL DATE (13,0)
     C** AIAN : ACCRUED INTEREST ADJUSTMENT NOT POSTED (13,0)
     C** AIAP : ACCRUED INTEREST ADJUSTMENT POSTED (13,0)
     C** IPRD : INTEREST PAID/RECEIVED TO DATE (13,0)
     C** ICTD : INTEREST CAPITALIZED TO DATE (13,0)
     C** MDAT : MATURITY DATE (5,0)
     C** NIDT : NEXT INTEREST PAYMENT DATE (5,0)
     C** ICBS : INTEREST CALCULATION BASIS (1,0)
     C** INTR : INTEREST RATE (11,7)
     C** PCPL : PRINCIPAL (13,0)
     C*
     C** THE WORK FIELDS USED IN THIS PROCESS ARE AS FOLLOWS:
     C** START DATE (5,0)
     C** END DATE (5,0)
     C*
     C** IF THE DEAL HAS NOT REACHED VALUE DATE YET,NO INTEREST IS EARNED
     C*
     C           WWVDAT    IFGT WWECD
     C                     Z-ADD*ZERO     WWINTK
     C                     Z-ADD*ZERO     WWNODA
     C                     GOTO ENDP06
     C                     END
     C*
     C** IF THE INTEREST ACCRUAL CONTROL DATE IS GREATER THAN THE
     C** START/LAST INTEREST DATE
     C           WWIACD    IFGT WWSLID
     C*
     C** INITIALIZE THE START DATE TO THE INTEREST ACCRUAL CONTROL
     C** DATE
     C                     Z-ADDWWIACD    WWSTRD  50
     C*
     C** THE INITIAL INTEREST WILL EQUAL TO:
     C**   ACCRUED INTEREST TO CONTROL DATE
     C** + ACCRUED INTEREST ADJUSTMENT NOT POSTED
     C** + ACCRUED INTEREST ADJUSTMENT POSTED
     C** - INTEREST PAID/RECEIVED TO DATE
     C** - INTEREST CAPITALIZED TO DATE
     C                     Z-ADDWWAITC    WWINIT 130
     C                     ADD  WWAIAN    WWINIT
     C                     ADD  WWAIAP    WWINIT
     C                     SUB  WWIPRD    WWINIT
     C                     SUB  WWICTD    WWINIT
     C                     END
     C*
     C** IF THE INTEREST ACCRUAL CONTROL DATE IS LESS THAN OR EQUAL
     C** TO THE START/LAST INTEREST DATE
     C           WWIACD    IFLE WWSLID
     C*
     C** INITIALIZE THE START DATE TO THE START/LAST INTEREST DATE
     C                     Z-ADDWWSLID    WWSTRD
     C*
     C** THE INITIAL INTEREST WILL EQUAL TO:
     C**   ACCRUED INTEREST ADJUSTMENT NOT POSTED
     C                     Z-ADDWWAIAN    WWINIT
     C                     END
     C*
     C** INITIALIZE THE END DATE TO THE EVENT CONTROL DATE FROM
     C** SR/INIT
     C                     Z-ADDWWECD     WWENDD  50
     C*
     C** IF THE END DATE IS GREATER THAN THE MATURITY DATE, AND THE MATURITY
     C** DATE IS NOT ZERO , SET THE END DATE TO THE MATURITY DATE
     C           WWENDD    IFGT WWMDAT
     C           WWMDAT    ANDGT*ZERO
     C                     Z-ADDWWMDAT    WWENDD
     C                     END
     C*                                                                  147727
     C** IF ACCRUED ON LAST DAY ACCRUAL IS NO, ADD 1 TO END DATE         147727
     C           ACLD      IFEQ 'N'                                      147727
     C                     ADD  1         WWENDD                         147727
     C                     END                                           147727
     C*
     C** CALCULATE THE NUMBER OF DAYS ACCRUED INTEREST:
     C** THE NUMBER OF DAYS ACCRUED INTEREST IS EQUAL TO
     C** END DATE - START/LAST INTEREST DATE
     C           WWENDD    SUB  WWSLID    WWNODA
     C*
     C** IF THE NEXT INTEREST PAYMENT DATE IS GREATER THAN THE END
     C** DATE AND THE NEXT INTEREST PAYMENT DATE IS GREATER THAN
     C** THE START DATE
     C*******    WWNIDT    IFGT WWENDD                                    R0585
     C*******    WWNIDT    ANDGTWWSTRD                                    R0585
     C*
     C** SET THE START DATE EQUAL TO THE NEXT INTEREST PAYMENT DATE
     C********             Z-ADDWWNIDT    WWSTRD                          R0585
     C*
     C** SET THE INITIAL INTEREST EQUAL TO ZERO
     C*******              Z-ADD0         WWINIT                          R0585
     C*
     C** THE NUMBER OF DAYS ACCRUED INTEREST EQUALS:
     C** END DATE - NEXT INTEREST PAYMENT DATE
     C*******    WWENDD    SUB  WWNIDT    WWNODA                          R0585
     C*******              END                                            R0585
     C*
     C** TO CALCULATE THE ACCRUED INTEREST SINCE LAST INTEREST PAYMENT
     C** OR CAPITALIZATION, USE SR/GLINTC WITH THE INPUT FIELDS AS FOL:
     C** ZIBEG : START DATE
     C** ZIEND : END DATE
     C** ZIAMT : PRINCIPAL
     C** ZICALC: INTEREST CALCULATION BASIS
     C** ZIRATE: INTEREST RATE
     C                     Z-ADDWWSTRD    ZIBEG
     C                     Z-ADDWWENDD    ZIEND
     C                     Z-ADDWWPCPL    ZIAMT
     C                     Z-ADDWWICBS    ZICALC
     C                     Z-ADDWWINTR    ZIRATE
     C/COPY WNCPYSRC,PM1144C010
     C                     EXSR GLINTC
     C***********          Z-ADDZDAYN1    WWNODA                     38468085870
     C                     Z-ADDZZINDY    WWNODA                          085870
     C*                                                                   062871
     C           WWNODA    IFLT 0                                         062871
     C                     Z-SUBWWNODA    WWNODA                          062871
     C                     Z-SUBZINTR     ZINTR                           062871
     C                     END                                            062871
     C*
     C** THE ACCRUED INTEREST EQUALS :
     C** INITIAL INTEREST + ZINTR
     C           WWINIT    ADD  ZINTR     WWINTK
     C*
     C** SET THE NEXT INTEREST DATE EQUAL TO THE NEXT INTEREST PAYMENT
     C** DATE
     C*
     C** SET THE START/LAST INTEREST DATE EQUAL TO THE START/LAST
     C** INTEREST DATE
     C*
     C           ENDP06    ENDSR
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P07      - AUDIT PROCESSING                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * W02      - WRITE TO PORTF. HOLDINGS AUDIT                        *
      * W03      - WRITE TO PORTF. HOLDINGS UPDATE (DL) AUDIT REPORT     *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           P07       BEGSR                           *** P07    ***
     C*
     C** ACCESS THE PORTFOLIO HOLDINGS AUDIT PF/PMHOLDZZ
     C***********          READ PMHOLDZZ                 72               S01486
     C                     READ PMHOLDPA                 72               S01486
     C           *IN72     IFEQ '1'
     C*
     C** SET NUMBER OF LIVE RECORDS EQUAL TO A COUNT OF PORTF. HOLDINGS
     C** CREATED
     C                     Z-ADDPPHCRE    QFNORE
     C*
     C** WRITE A RECORD TO PF/PMHOLDZZ AS PER W02
     C                     EXSR W02
     C                     ELSE
     C*
     C** ADD COUNT OF PORTF. HOLDINGS CREATED TO NUMBER OF LIVE RECORDS
     C** PN PF/PMHOLDZZ
     C                     ADD  PPHCRE    QFNORE
     C*
     C** UPDATE PF/PMHOLDZZ AS PER W02
     C                     EXSR W02
     C                     END
     C*
     C** PRODUCE PORTFOLIO HOLDINGS UPDATE (DL) AUDIT REPORT AS PER
     C** W03-WRITE PORTFOLIO HOLDINGS UPDATE (DL) AUDIT REPORT
     C                     EXSR W03
     C*
     C                     ENDSR                           *** EP07   ***
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W01      - WRITE TO PORTF. HOLDINGS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * W04      - Write on Portfolio Event Currency                  *   CPM005
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWRECI   - RECORD ID                                             *
      * WWAVCD   - ACCOUNT OFFICER CODE FROM SDPLCSL0                    *
      * WWCNUM   - CUSTOMER NUMBER                                       *
      * WWECD    - EVENT CONTROL DATE                                    *
      * WWDSPS   - DISPLAY GROUP SEQUENCE                                *
      * WWDSPG   - DISPLAY GROUP CODE                                    *
      * WWITDS   - INSTRUMENT DISPLAY SEQUENCE                           *
      * WWVLGS   - VALUATION GROUP SEQUENCE                              *
      * WWVALG   - VALUATION GROUP CODE                                  *
      * WWVLIS   - VALUATION GROUP INSTRUMENT SEQUENCE                   *
      * WWINNR   - INSTRUMENT NARRATIVE                                  *
      * WWDLNO   - DEAL NUMBER                                           *
      * WWDTYP   - DEAL TYPE                                             *
      * WWTXT1   - MIDAS INSTRUMENT NAME                                 *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS NARRATIVE                  *
      * WWAMT1   - AMOUNT 1                                              *
      * WWAMT2   - AMOUNT 2                                              *
      * WWCCY1   - CURRENCY 1                                            *
      * WWCCY2   - CURRENCY 2                                            *
      * WWCDP1   - CURRENCY DEC. PLACES FOR CURRENCY 1                   *
      * WWCDP2   - CURRENCY DEC. PLACES FOR CURRENCY 2                   *
      * WWMVAL   - MARKET VALUE                                          *
      * WWINTK   - ACCRUED INTEREST                                      *
      * WWNIDT   - NEXT INTEREST PAYMENT DATE                            *
      * WWSLID   - START/LAST INTEREST DATE                              *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTEREST                       *
      * WWOCT    - OPENING/CLOSING TRANSACTION                           *R00631
      * WWBOSF   - BUY OR SELL FIRST                                     *R00631
      * WWPLCY   - PROFIT AND LOSS CURRENCY                              *R00631
      * WWDSEQ   - DEAL SEQUENCE                                         *R00631
      * WWRDLN   - RELATED DEAL NUMBER                                   *R00631
      *                                                                  *
      ********************************************************************
     C           W01       BEGSR                           *** W01    ***
     C*
     C** LF/DEALSPT OR LF/DEALSP2
     C** IF EQUAL TO 'N', SET TO 'M'
     C           WWRECI    IFEQ 'N'
     C           WWRECI    OREQ 'E'                                       50343
     C                     MOVEL'M'       QFRECI
     C                     ELSE
     C                     MOVELWWRECI    QFRECI
     C                     END
     C*
     C** ACCOUNT OFFICER: FROM LF/SDPLCSL0
     C                     MOVELWWACOC    QFACOC
     C*
     C** CUSTOMER NUMBER: FROM LF/DEALSPT OR LF/DEALSP2
     C**********           Z-ADDWWCNUM    QFCNUM                                              CSD027
     C                     MOVE WWCNUM    QFCNUM                                              CSD027
     C*
     C** PORTFOLIO REFERENCE: SEE PROCESS FULX
     C                     MOVELWPTFR     QFPTFR
     C*
     C** TRADE/VALUE DATE INDICATOR:
     C** IF THE VALUE DATE OF THE DEAL IS LESS THAN OR EQUAL TO THE
     C** EVENT CONTROL DATE FROM SR/INIT, SET TO 'X' OTHERWISE SET
     C** TO 'T'
     C********** WWVDAT ** IFLE WWECD                                     R00631
     C           *IN01     IFNE '1'                                       R00631
     C*********  WWVDAT    ANDLEWWECD                         R0063146081 47617
     C****       WWVDAT    IFLT WWECD                               46081 47617
     C****                 MOVEL'V'       QFTVDA                          47617
     C****                 MOVEL'X'       QFTVDA                          47617
     C****                 ELSE                                           47617
     C****                 MOVEL'T'       QFTVDA                    46081 47617
     C****                 MOVEL'V'       QFTVDA                    46081 47617
     C****                 END                                            47617
     C           WWTVPS    IFEQ 'V'                                       47617
     C           WWVDAT    IFGT WWECD                                     47617
     C                     MOVE 'X'       QFTVDA                          47617
     C                     ELSE                                           47617
     C                     MOVE 'V'       QFTVDA                          47617
     C                     END                                            47617
     C                     ELSE                                           47617
     C           WWVDAT    IFGT WWECD                                     47617
     C                     MOVE 'T'       QFTVDA                          47617
     C                     ELSE                                           47617
     C                     MOVE 'X'       QFTVDA                          47617
     C                     END                                            47617
     C                     END                                            47617
     C                     END
     C           *IN01     IFEQ '1'                                       R00631
     C                     MOVEL'X'       QFTVDA                          R00631
     C                     END                                            R00631
     C****
     C***MODULE ID: 'DL'                                                  S01313
     C****                 MOVEL'DL'      QFMODI                          S01313
     C*                                                                   S01313
     C** FOR FX DEALS SET MODULE ID TO 'FX', FOR MM LOANS SET TO 'ML',    S01313
     C** FOR MM DEPOSITS SET TO 'MD' AND FOR FRA/IRS SET TO 'FR'          S01313
     C           *IN01     IFEQ '1'                                       S01313
     C                     MOVEL'FX'      QFMODI                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C           *IN02     IFEQ '1'                                       S01313
     C           WWDTYP    IFEQ 'IP'                                      S01313
     C           WWDTYP    OREQ 'TI'                                      S01313
     C           WWDTYP    OREQ 'CL'                                      S01313
     C           WWDTYP    OREQ 'LN'                                      S01313
     C           WWDTYP    OREQ 'DL'                                      S01313
     C********** WWDTYP    OREQ 'PL'                               S01313 062952
     C                     MOVEL'ML'      QFMODI                          S01313
     C                     ELSE                                           S01313
     C                     MOVEL'MD'      QFMODI                          S01313
     C                     END                                            S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C           *IN03     IFEQ '1'                                       S01313
     C                     MOVEL'FR'      QFMODI                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C** DISPLAY GROUP SEQUENCE: FROM PF/PMDSPGPP
     C                     Z-ADDWWDSPS    QFDSPS
     C*
     C** DISPLAY GROUP: FROM PF/SDPLINPD
     C                     MOVELWWDSPG    QFDSPG
     C*
     C** INSTRUMENT TYPE DISPLAY SEQUENCE: INST. TYPE DISP. SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWITDS    QFITDS
     C*
     C** VALUATION GROUP SEQUENCE: FROM PF/PMVLGHPP
     C                     Z-ADDWWVLGS    QFVLGS
     C*
     C** VALUATION GROUP: FROM PF/SDPLINPD
     C                     MOVELWWVALG    QFVALG
     C*
     C** INSTRUMENT TYPE VALUATION SEQUENCE: VALUATION GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWVLIS    QFVLIS
     C*
     C** INSTRUMENT TYPE: FROM PF/SDDTSTPP
     C                     MOVELWWINNR    QFINNR
     C*
     C** TRANSACTION NUMBER: DEAL NUMBER FROM LF/DEALSPT OR LF/DEALSP2
     C**********           Z-ADDWWDLNO    QFTRNB                                              CLE148
     C                     MOVELWWDLNO    QFTRNB                                              CLE148
     C*
     C** SECURITY SHORTNAME: *BLANK
     C                     MOVEL*BLANK    QFTDSS
     C*
     C** DEAL TYPE: FROM LF/DEALSPT OR LF/DEALSP2
     C                     MOVELWWDTYP    QFDTYP
     C*
     C** MIDAS INSTRUMENT NAME: SEE PROCESS P03-P04-P05
     C                     MOVELWWTXT1    QFTXT1
     C*
     C** INSTRUMENT ENQUIRY DETAILS: SEE PROCESS P03-P04-P05
     C                     MOVELWWTXT2    QFTXT2
     C*
     C** LINE 1 AMOUNT: SEE PROCESS P03-P04-P05
     C                     Z-ADDWWAMT1    QFAMT1
     C*
     C** LINE 2 AMOUNT: SEE PROCESS P03-P04-P05
     C                     Z-ADDWWAMT2    QFAMT2
     C*
     C** CURRENCY 1: SEE PROCESS P03-P04-P05
     C                     MOVELWWCCY1    QFCCY1
     C*
     C** CURRENCY 2: SEE P03-P04-P05
     C                     MOVELWWCCY2    QFCCY2
     C*
     C** CURRENCY DEC. PLACES 1: SEE P03-P04-P05
     C                     Z-ADDWWCDP1    QFCDP1
     C*
     C** CURRENCY DEC. PLACES 2: SEE P03-P04-P05
     C                     Z-ADDWWCDP2    QFCDP2
     C*
     C** MARKET PRICE: ZERO
     C                     Z-ADD0         QFMPRC
     C*
     C** BOOK PRICE: ZERO
     C                     Z-ADD0         QFBOPR
     C*
     C** BOOK FX RATE: SEE P03-P04-P05
     C                     Z-ADDWWBFXR    QFBFXR
     C*
     C** MARKET FX RATE: SEE P03-P04-P05
     C                     Z-ADDWWMFXR    QFMFXR
     C*
     C** MARKET VALUE: SEE P03-P04-P05
     C                     Z-ADDWWMVAL    QFMVAL
     C           *IN01     IFNE '1'                                       46081
     C           WWTVPS    ANDEQ'V'                                       46081
     C           QFTVDA    ANDEQ'X'                                       46081
     C           *IN01     ORNE '1'                                       47617
     C           WWTVPS    ANDEQ'T'                                       47617
     C           QFTVDA    ANDEQ'T'                                       47617
     C                     Z-ADD0         QFMVAL                          46081
     C                     END                                            46081
     C*
     C** PURCHASED INTEREST: ZERO
     C                     Z-ADD0         QFPUIT
     C*
     C** ACCRUED INTEREST: SEE PROCESS P03-P04-P05
     C                     Z-ADDWWINTK    QFACIS
     C*
     C** NEXT INTEREST DATE: SEE PROCESS P03-P04-P05
     C                     Z-ADDWWNIDT    QFNIDT
     C*
     C** START/LAST INTEREST DATE: SEE PROCESS P03-P04-P05
     C                     Z-ADDWWSLID    QFSLID
     C*
     C** NUMBER OF DAYS ACCRUED INTEREST: SEE PROCESS P03-P04-P05
     C                     Z-ADDWWNODA    QFNODA
     C*
     C** PROFIT/LOSS MARKET: ZERO
     C                     Z-ADD0         QFPLMK
     C*
     C** PROFIT/LOSS FX
     C                     Z-ADDWWPLFX    QFPLFX
     C*
     C** BOOK YIELD: ZERO
     C                     Z-ADD0         QFBKYD
     C*
     C** MARKET YIELD: ZERO
     C                     Z-ADD0         QFMKYD
     C*
     C** DIRECT YIELD: ZERO
     C                     Z-ADD0         QFDRYD
     C********                                                            R05669
     C***COUNTRY OF RISK: BLANK                                           R05669
     C********             MOVEL*BLANK    QFCNTR                          R05669
     C********                                                            R05669
     C***INDUSTRY: ZERO                                                   R05669
     C********             Z-ADD0         QFLIND                          R05669
     C                     MOVE WWCNTR    QFCNTR                          R05669
     C**********           MOVE WWLIND    QFLIND                                     R05669 BUG23967
     C                     MOVE WWLIND    QFLOIC                                            BUG23967
     C*
     C** SECURITY POSITION PLEDGED: 'N'
     C                     MOVE 'N'       QFSPLD
     C*                                                                   R00631
     C** TRANSACTION OPENED/CLOSED                                        R00631
     C                     MOVE WWOCT     QFOPCL                          R00631
     C*                                                                   R00631
     C** BUY OR SELL FIRST                                                R00631
     C                     MOVE WWBOSF    QFBYSF                          R00631
     C*                                                                   R00631
     C** PROFIT AND LOSS CURRENCY                                         R00631
     C                     MOVE WWPLCY    QFFPLC                          R00631
     C*                                                                   R00631
     C** DEAL SEQUENCE                                                    R00631
     C                     MOVE WWDSEQ    QFDLSQ                          R00631
     C*                                                                   R00631
     C** RELATED DEAL NUMBER                                              R00631
     C           QFBYSF    IFNE *BLANKS                                   47617
     C                     MOVE WWRDLN    QFRLDN                          R00631
     C                     ELSE                                           47617
     C                     Z-ADD0         QFRLDN                          47617
     C                     END                                            47617
     C*                                                                   R05763
     C** IF FIDUCIARY HAS MATURED MARKET VALUE AND ACCRUED INTEREST       R05763
     C** MUST BE ZERO                                                     R05763
     C           QFRECI    IFEQ 'M'                                       R05763
     C                     Z-ADD0         QFMVAL                          R05763
     C                     Z-ADD0         QFACIS                          R05763
     C                     Z-ADD0         QFPLMK                          R05763
     C                     Z-ADD0         QFPLFX                          R05763
     C                     END                                            R05763
     C*                                                                   B08040
     C** OBTAIN FX RATE FROM CURRENCY 1 TO PORTFOLIO CCY FROM ARRAY       B08040
     C           QFBYSF    IFEQ *BLANK
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           QFPTFR    IFNE '9997'                                    B08040
     C           QFPTFR    ANDNE'9998'                                    B08040
     C           QFPTFR    ANDNE'9999'                                    B08040
     C           PNPTCY    LOKUPCYCD,B                   72               B08040
     C                     ELSE                                           B08040
     C           QBCSBY    LOKUPCYCD,B                   72               B08040
     C                     END                                            B08040
     C** ERROR                                                            B08040
     C           *IN72     IFEQ '0'                        ***************B08040
     C                     Z-ADD22        DBASE            **DB ERROR 02**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELQBCSBY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    WWSPC1 138                      B08040
     C                     MOVE MDIN,B    WWMDC1  1                       B08040
     C                     Z-ADDNBDP,B    WWDPC1  10                      B08040
     C                     Z-ADDRKSQ,B    WWRKC1  30                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CALCULATE MARKET FX RATE FROM NOMINAL CCY TO PORTFOLIO CURRENCY  B08040
     C                     Z-ADD1         ZAMTF                           B08040
     C                     MOVE QFCCY1    ZCCYF                           B08040
     C                     MOVE CYCD,B    ZCCYT                           B08040
     C                     Z-ADDWWSPR1    ZRATEF                          B08040
     C                     Z-ADDWWSPC1    ZRATET                          B08040
     C                     MOVE WWMDI1    ZMDINF                          B08040
     C                     MOVE WWMDC1    ZMDINT                          B08040
     C                     Z-ADDWWCDP1    ZCDPF                           B08040
     C                     Z-ADDWWDPC1    ZCDPT                           B08040
     C*********************EXSR ZCCYCN                             B08040 037855
     C                     EXSR ZCCYCN                                    057020
     C                     Z-ADDZCRSRN    QFMFXD                          057020
     C*                                                                   037855
     C*                                                                   37855*
     C*  ZCCYCN SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER       37855*
     C*  CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES             37855*
     C*                                                                   37855*
     C*  INPUT  FIELDS                                                    37855*
     C*       ZAMTF  150     AMOUNT IN 'FROM' CURRENCY                    37855*
     C*       ZCCYF   3A     FROM CURRENCY                                37855*
     C*       ZCCYT   3A     TO CURRENCY                                  37855*
     C*       ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY                37855*
     C*       ZRATET 138     SPOT RATE FOR 'TO' CURRENCY                  37855*
     C*       ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CURRENCY37855*
     C*       ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURRENCY  37855*
     C*       ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY  37855*
     C*       ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY    37855*
     C*                                                                   37855*
     C*  OUTPUT  FIELDS                                                   37855*
     C*       ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT)    *
     C*       ZCRSRT 138     CROSS EXCHANGE RATE                          37855*
     C*       ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR         37855*
     C*                                                                   37855*
     C*                                                                   37855*
     C*  CALLS:                                                           37855*
     C*       ZCCYXR                                                      37855*
     C*                                                                   37855*
     C*  CALLED BY:                                                       37855*
     C*                                                                   37855*
     C**************************************************************************
     C*                                                                   037855
     C*                                                                   037855
     C** DEFINE ALL FIELDS                                                037855
     C                     Z-ADDZAMTF     ZAMTF  150                      037855
     C                     MOVE ZCCYF     ZCCYF   3                       037855
     C                     MOVE ZCCYT     ZCCYT   3                       037855
     C                     Z-ADDZRATEF    ZRATEF 138                      037855
     C                     Z-ADDZRATET    ZRATET 138                      037855
     C                     MOVE ZMDINF    ZMDINF  1                       037855
     C                     MOVE ZMDINT    ZMDINT  1                       037855
     C                     Z-ADDZCDPF     ZCDPF   10                      037855
     C                     Z-ADDZCDPT     ZCDPT   10                      037855
     C                     Z-ADDZAMTT     ZAMTT  150                      037855
     C                     Z-ADDZCRSRT    ZCRSRT 138                      037855
     C                     MOVE ZCRSMD    ZCRSMD  1                       037855
     C*                                                                   037855
     C** IF 'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TO' CURRENCY
     C** EQUAL TO AMOUNT IN 'FROM' CURRENCY
     C           ZCCYF     IFEQ ZCCYT                                     037855
     C                     Z-ADDZAMTF     ZAMTT                           037855
     C                     Z-ADD1         ZCRSRT                          037855
     C                     MOVE 'M'       ZCRSMD                          037855
     C                     ELSE                                           037855
     C*                                                                   037855
     C** INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO                 037855
     C                     Z-ADD*ZEROS    ZCRSRT                          037855
     C                     MOVE ZMDINF    ZCRSMD                          041644
     C*                                                                   037855
     C** IF MULT/DIV INDIC. FOR 'FROM' IS = MULT/DIV INDIC FOR 'TO' INDIC 037855
     C**   AND SPOT RATE FOR 'TO' CURRENCY (ZRATET) IS NOT = ZERO         037855
     C           ZMDINF    IFEQ ZMDINT                                    037855
     C           ZRATET    ANDNE*ZEROS                                    037855
     C           ZRATEF    IFGT ZRATET                                    037855
     C           ZRATEF    DIV  ZRATET    ZCRSRT                          037855
     C                     ELSE                                           037855
     C           ZRATET    DIV  ZRATEF    ZCRSRT                          037855
     C           ZMDINF    IFEQ 'D'                                       041644
     C*********************MOVE 'M'       ZMDINF                   037855 041644
     C                     MOVE 'M'       ZCRSMD                          041644
     C                     ELSE                                           041644
     C                     MOVE 'D'       ZCRSMD                          041644
     C                     END                                            041644
     C                     END                                            037855
     C*                                                                   037855
     C** IF MULT/DIV INDIC FOR 'FROM' IS NOT= MULT/DIV INDIC FOR 'TO' INDIC
     C** OR  SPOT RATE FOR 'TO' CURRENCY (ZRATET) IS  = ZERO
     C                     ELSE                                           037855
     C           ZRATEF    MULT ZRATET    ZCRSRT                          037855
     C                     END                                            037855
     C*                                                                   037855
     C** MOVE MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULT/DIV   037855
     C** INDICATOR (ZCRSMD)                                               037855
     C*********************MOVE ZMDINF    ZCRSMD                          041644
     C*                                                                   037855
     C** EXECUTE   SR ZCCYXR                                              037855
     C                     EXSR ZCCYXR                                    037855
     C                     END                                            037855
     C********************************************************************
     C*                                                                        *
     C*                                                                   B08040
     C** CONVERT RATE INTO MULTIPLY RATE                                  B08040
     C           ZCRSMD    IFEQ 'D'                                       B08040
     C           1         DIV  ZCRSRT    WWMFXR 138H                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDZCRSRT    WWMFXR 138                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CONVERT MARKET FX RATE TO FORMAT DEFINED BY RANKING SEQUENCE     B08040
     C***********WWDRNK    IFLT WWRKC1                             B08040 037855
     C           WWRKC1    IFLT WWDRNK                                    037855
     C********** 1         DIV  WWMFXR    QFMFXR 138H              B08040 037855
     C           ZCRSMD    IFEQ 'D'                                       037855
     C                     Z-ADDZCRSRT    QFMFXR 138H                     037855
     C                     ELSE                                           044902
     C           1         DIV  WWMFXR    QFMFXR 138H                     044902
     C                     END                                            037855
     C                     MOVE 'D'       QFMFMD                          B08040
     C                     ELSE                                        67 B08040
     C                     Z-ADDWWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'M'       QFMFMD                          B08040
     C                     END                                         67 B08040
     C                     END                                         67 B08040
     C*                                                                   S01313
     C** IF FORWARD TRADE SET 'HOLDING VALUED' TO 'N'                     S01313
     C                     MOVE 'Y'       QFHLDV                          S01313
     C           QFTVDA    IFEQ 'T'                                       S01313
     C           WWTVPS    OREQ 'V'                                       47617
     C           QFTVDA    ANDEQ'X'                                       47617
     C           QFMODI    ANDEQ'ML'                                      057022
     C           WWTVPS    OREQ 'V'                                       057022
     C           QFTVDA    ANDEQ'X'                                       057022
     C           QFMODI    ANDEQ'MD'                                      057022
     C                     MOVE 'N'       QFHLDV                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C** IF RECORD FOR DEFINED PORTFOLIO AND PERFORMANCE START DATE *LE   S01313
     C** DNWD SET 'PERFORMANCE FIGURES REQUIRED' TO 'Y'                   S01313
     C** OTHERWISE SET TO 'N'                                             S01313
     C                     MOVE 'N'       QFPFMR                          S01313
     C           QFPTFR    IFNE '9997'                                    S01313
     C           QFPTFR    ANDNE'9998'                                    S01313
     C           QFPTFR    ANDNE'9999'                                    S01313
     C***********PNPSDT    ANDLEBJDNWD                             S01313 CPM005
     C           PNPSDT    IFLE BJDNWD                                    CPM005
     C           PNPSDT    ANDNE*ZEROS                                    CPM005
     C                     MOVE 'Y'       QFPFMR                          S01313
     C                     END                                            CPM005
      *                                                                   CPM005
      **  If 9997, 9998 or 9999 portfolios, check flags in PF/SDPLCSPD    CPM005
      *                                                                   CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9997'                                    CPM005
     C           QBPFM7    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9998'                                    CPM005
     C           QBPFM8    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9999'                                    CPM005
     C           QBPFM9    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     END                                            S01313
     C*
     C                     MOVE WWDLAM    QFDLAM
     C*
     C           QFMODI    IFNE 'FX'
     C                     MOVE *ZEROS    QFDLSQ
     C                     END
     C*
     C** WRITE TRADE/VALUE DATE RECORD TO PF/PMHOLDPP IF REQUIRED         B08040
     C           QFTVDA    IFEQ 'X'                                       B08040
     C***********QFTVDA    OREQ P9TVPS                             B08040 S01486
     C           QFTVDA    OREQ FCTVPS                                    S01486
     C***********QFMFXR    IFGT 0                                  036681 042355
     C***********DTYP      ANDEQ'CX'                               036681 042355
     C***********1         DIV  QFMFXR    QFMFXR 138H              036681 042355
     C***********          END                                     036681 042355
     C*                                                                   R37474
     C** OUTPUT TOTALLING INFORMATION                                     R37401
     C           WWMTEX    IFEQ 'L'                                       R37474
     C                     EXSR #HLDX0                                    R37474
     C                     ELSE                                           CPM005
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD                              CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C                     END                                            R37474
     C*                                                                   R37474
     C********** WWDTYP    IFEQ 'TD'                       - B2    053090 060556
     C********** QFBFXR    ANDNE*ZERO                              053090 060556
     C********** WWSAV1    DIV  QFBFXR    WWSAV2                   053090 060556
     C********** WWSAV2    MULT QFMFXR    WWSAV2                   053090 060556
     C********** WWSAV2    SUB  WWSAV1    QFPLFX                   053090 060556
     C******************** END                             - E2    053090 060556
      *                                                                   CPM005
      **  If FX profit loss ccy *EQ CCY2 this deal is the 'notional'      CPM005
      **  FX deal                                                         CPM005
      *                                                                   CPM005
     C           QFMODI    IFEQ 'FX'                                      CPM005
     C           WWMTEX    ANDEQ'L'                                       CPM005
     C           QFFPLC    ANDEQQFCCY2                                    CPM005
      *                                                                   CPM005
      **  Save detail fields                                              CPM005
      *                                                                   CPM005
     C                     Z-ADDQFMVAL    WFMVAL 150                      CPM005
     C                     Z-ADDQFACIS    WFACIS 150                      CPM005
     C                     Z-ADDQFPLFX    WFPLFX 150                      CPM005
     C                     MOVE QFFPLC    WFFPLC  3                       CPM005
     C                     Z-ADDQFMVPC    WFMVPC 150                      CPM005
     C                     Z-ADDQFAIPC    WFAIPC 150                      CPM005
     C                     MOVE QFHLDV    WFHLDV  1                       CPM005
     C                     MOVE QFPFMR    WFPFMR  1                       CPM005
      *                                                                   CPM005
      **  Setup fields for write of second deal                           CPM005
      *                                                                   CPM005
     C                     Z-ADD0         QFMVAL                          CPM005
     C                     Z-ADD0         QFACIS                          CPM005
     C                     Z-ADD0         QFPLFX                          CPM005
     C                     MOVE *BLANKS   QFFPLC                          CPM005
     C                     Z-ADD0         QFMVPC                          CPM005
     C                     Z-ADD0         QFAIPC                          CPM005
     C                     MOVE 'N'       QFHLDV                          CPM005
     C                     MOVE 'N'       QFPFMR                          CPM005
     C                     MOVE 'Y'       QFNOPO                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C/COPY WNCPYSRC,PM1144C002
     C                     WRITEPMHOLDP0
     C                     ADD  1         PPHCRE                          B08040
     C/COPY WNCPYSRC,PM1144C003
      *                                                                   CPM005
      **  Restore detail fields if notional deal                          CPM005
      *                                                                   CPM005
     C           QFNOPO    IFEQ 'Y'                                       CPM005
     C                     Z-ADDWFMVAL    QFMVAL                          CPM005
     C                     Z-ADDWFACIS    QFACIS                          CPM005
     C                     Z-ADDWFPLFX    QFPLFX                          CPM005
     C                     MOVE WFBYSF    QFBYSF                          CPM005
     C                     MOVE WFFPLC    QFFPLC                          CPM005
     C                     Z-ADDWFMVPC    QFMVPC                          CPM005
     C                     Z-ADDWFAIPC    QFAIPC                          CPM005
     C                     MOVE WFHLDV    QFHLDV                          CPM005
     C                     MOVE WFPFMR    QFPFMR                          CPM005
     C                     MOVE 'N'       QFNOPO                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  Write a second FX deal record for display with the currencies   CPM005
      **  reversed                                                        CPM005
      *                                                                   CPM005
     C           QFMODI    IFEQ 'FX'                                      CPM005
     C           WWMTEX    ANDEQ'L'                                       CPM005
      *                                                                   CPM005
     C                     MOVE QFHLDV    WFHLDV  1                       CPM005
     C                     MOVE QFPFMR    WFPFMR  1                       CPM005
     C                     Z-ADDQFMVAL    WFMVAL 150                      CPM005
     C                     Z-ADDQFACIS    WFACIS 150                      CPM005
     C                     Z-ADDQFPLFX    WFPLFX 150                      CPM005
     C                     MOVE QFFPLC    WFFPLC  3                       CPM005
     C                     Z-ADDQFMVPC    WFMVPC 150                      CPM005
     C                     Z-ADDQFAIPC    WFAIPC 150                      CPM005
      *                                                                   CPM005
     C           QFCCY2    IFNE QFFPLC                                    CPM005
     C                     MOVE 'N'       QFHLDV                          CPM005
     C                     MOVE 'N'       QFPFMR                          CPM005
     C                     MOVE 'Y'       QFNOPO                          CPM005
     C                     Z-ADD0         QFMVAL                          CPM005
     C                     Z-ADD0         QFACIS                          CPM005
     C                     Z-ADD0         QFPLFX                          CPM005
     C                     MOVE *BLANKS   QFFPLC                          CPM005
     C                     Z-ADD0         QFMVPC                          CPM005
     C                     Z-ADD0         QFAIPC                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  Save detail fields                                              CPM005
      *                                                                   CPM005
     C                     Z-ADDQFAMT1    WFAMT1 150                      CPM005
     C                     Z-ADDQFAMT2    WFAMT2 150                      CPM005
     C                     MOVE QFCCY1    WFCCY1  3                       CPM005
     C                     MOVE QFCCY2    WFCCY2  3                       CPM005
     C                     Z-ADDQFCDP1    WFCDP1 150                      CPM005
     C                     Z-ADDQFCDP2    WFCDP2 150                      CPM005
     C                     MOVE QFBYSF    WFBYSF  1                       CPM005
      *                                                                   CPM005
      **  Setup fields for write of second deal                           CPM005
      *                                                                   CPM005
     C                     Z-ADDWFAMT2    QFAMT1                          CPM005
     C                     Z-ADDWFAMT1    QFAMT2                          CPM005
     C                     MOVE WFCCY2    QFCCY1                          CPM005
     C                     MOVE WFCCY1    QFCCY2                          CPM005
     C                     Z-ADDWFCDP2    QFCDP1                          CPM005
     C                     Z-ADDWFCDP1    QFCDP2                          CPM005
     C                     MOVE 'S'       QFBYSF                          CPM005
     C           FCPORS    IFEQ 'B'                                       CPM005
     C                     MOVE 'B'       QFBYSF                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C/COPY WNCPYSRC,PM1144CCP4                                           S01408
     C                     WRITEPMHOLDP0                                  CPM005
     C                     ADD  1         PPHCRE                          CPM005
     C/COPY WNCPYSRC,PM1144CCP5                                           S01408
      *                                                                   CPM005
      **  Restore detail fields                                           CPM005
      *                                                                   CPM005
     C                     Z-ADDWFAMT1    QFAMT1                          CPM005
     C                     Z-ADDWFAMT2    QFAMT2                          CPM005
     C                     MOVE WFCCY1    QFCCY1                          CPM005
     C                     MOVE WFCCY2    QFCCY2                          CPM005
     C                     Z-ADDWFCDP1    QFCDP1                          CPM005
     C                     Z-ADDWFCDP2    QFCDP2                          CPM005
     C                     Z-ADDWFMVAL    QFMVAL                          CPM005
     C                     Z-ADDWFACIS    QFACIS                          CPM005
     C                     Z-ADDWFPLFX    QFPLFX                          CPM005
     C                     MOVE WFBYSF    QFBYSF                          CPM005
     C                     MOVE WFFPLC    QFFPLC                          CPM005
     C                     Z-ADDWFMVPC    QFMVPC                          CPM005
     C                     Z-ADDWFAIPC    QFAIPC                          CPM005
     C                     MOVE WFHLDV    QFHLDV                          CPM005
     C                     MOVE WFPFMR    QFPFMR                          CPM005
     C                     MOVE 'N'       QFNOPO                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  Write on PMEVCYPD only for forward FX                           CPM005
      *                                                                   CPM005
     C           QFMODI    IFEQ 'FX'                                      CPM005
     C           QFPTFR    ANDNE'9998'                                    CPM005
     C           QFPTFR    ANDNE'9999'                                    CPM005
     C           WWMTEX    ANDEQ'L'                                       CPM005
     C                     EXSR W04                                       CPM005
     C                     END                                            CPM005
     C*                                                                   B08253
     C** IF MATURITY RUN, UPDATE EXTRACTED INDICATOR ON FIDEPOPD          B08253
     C           WWMTEX    IFEQ 'M'                                       B08253
     C           QFPTFR    ANDNE'9998'                                    B08253
     C           QFPTFR    ANDNE'9999'                                    B08253
     C                     MOVE '0'       *IN61                           B08253
     C                     MOVE '0'       *IN62                           B08253
     C                     MOVE '0'       *IN63                           B08253
     C                     SETOF                     6465                 094529
     C           WWDLNO    CHAINDEALSH               70                   B08253
     C*                                                                   B08253
     C** IF RECORD FOUND UPDATE INDICATOR                                 B08253
     C           *IN70     IFEQ '0'                                       B08253
     C                     MOVE 'Y'       HLEX                            B08253
     C*                                                                   B08253
     C           *IN61     IFEQ '1'                                       B08253
     C                     UPDATHDEALSDB                                  B08253
     C                     END                                            B08253
     C*                                                                   B08253
     C           *IN62     IFEQ '1'                                       B08253
     C                     UPDATHDEALSDC                                  B08253
     C                     END                                            B08253
     C*                                                                   B08253
     C           *IN63     IFEQ '1'                                       B08253
     C                     UPDATHDEALSDG                                  B08253
     C                     END                                            B08253
     C*                                                                   094529
     C           *IN64     IFEQ '1'                                       094529
     C                     UPDATDLBHISD0                                  094529
     C                     END                                            094529
     C*                                                                   094529
     C           *IN65     IFEQ '1'                                       094529
     C                     UPDATDLCHISD0                                  094529
     C                     END                                            094529
     C*                                                                   B08253
     C** ..... OTHERWISE TERMINATE PROGRAM WITH DATABASE ERROR            B08253
     C                     ELSE                            ***************B08253
     C                     Z-ADD11        DBASE            * DB ERROR 01 *B08253
     C                     MOVE 'DEALSH  'DBFILE           ***************B08253
     C                     MOVE WWDLNO    DBKEY                           B08253
     C                     EXSR *PSSR                                     B08253
     C                     END                                            B08253
     C                     END                                            B08253
     C****                                                          R37474B08040
     C****UTPUT TOTALLING INFORMATION                               R37474B08040
     C****       WWMTEX    IFEQ 'L'                                 R37474B08253
     C****                 EXSR #HLDX0                              R37474B08040
     C****                 END                                      R37474B08253
     C*
     C                     END                                            B08040
      *
     C                     ENDSR                           *** EW01   ***
      *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W02      - WRITE TO PORTF. HOLDINGS AUDIT                        *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P07      - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           W02       BEGSR                           *** W02    ***
     C                     MOVEL'D'       QFRECI
     C/COPY WNCPYSRC,PM1144C004
     C           *IN72     IFEQ '1'
     C                     WRITEPMHOLDZ0
     C                     ELSE
     C                     UPDATPMHOLDZ0
     C                     END
     C/COPY WNCPYSRC,PM1144C005
     C                     ENDSR                           *** EW02   ***
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W03      - WRITE TO PORTF. HOLDINGS UPDATE (DL) AUDIT REPORT     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P07      - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           W03       BEGSR                           *** W03    ***
     C*                                                                   S01486
     C/COPY WNCPYSRC,PM1144C006
     C                     WRITEPM1144PP
     C/COPY WNCPYSRC,PM1144C007
     C*                                                                   S01486
     C           WEMPTY    IFEQ 'Y'                                       S01486
     C                     WRITENODTLS                                    S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     ENDSR                           *** EW03   ***
      *****************************************************************   CPM005
      /EJECT                                                              CPM005
      *****************************************************************   CPM005
      *                                                               *   CPM005
      * W04      - Write on Portfolio Event Currency                  *   CPM005
      *                                                               *   CPM005
      * Subroutine Calls:                                             *   CPM005
      *                                                               *   CPM005
      * Subroutine Called From:                                       *   CPM005
      * W01      - Write to Portfolio Holdings                        *   CPM005
      *                                                               *   CPM005
      * Routine Uses Variables:                                       *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
     C           W04       BEGSR                           *** W04    *** CPM005
      *                                                                   CPM005
     C                     MOVEL'D'       FGRECI           Record Id      CPM005
     C**********           Z-ADDQFCNUM    FGCNUM           Cust Nbr                    CPM005 CSD027
     C                     MOVE QFCNUM    FGCNUM           Cust Nbr                           CSD027
     C                     MOVELQFPTFR    FGPTFR           Portfolio Ref  CPM005
     C                     Z-ADDWWVDAT    FGEVDT           Event Date     CPM005
     C                     MOVEL'FO'      FGEVFX           Event Type FX  CPM005
     C                     Z-ADDQFDSPS    FGDGRS           Group Seq      CPM005
     C                     MOVELQFINNR    FGINSC           Instrument CodeCPM005
     C                     Z-ADDQFITDS    FGINDS           Instrument Seq CPM005
     C                     MOVEL'FX'      FGEVTY           Event Type     CPM005
      *                                                                   CPM005
      **  Access to retrieve base ccy details                             CPM005
      *                                                                   CPM005
     C                     Z-ADD1         B                               CPM005
     C           QBCSBY    LOKUPCYCD,B                   72               CPM005
     C           *IN72     IFEQ '0'                        B1             CPM005
     C                     Z-ADD23        DBASE            ***************CPM005
     C                     MOVEL'SDCURRL0'DBFILE           * DB ERROR 23 *CPM005
     C                     MOVELQBCSBY    DBKEY            ***************CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                           *E1            CPM005
      *                                                                   CPM005
      **  Save spot rate, ccy dec places and mult/div ind                 CPM005
      **  from LF/SDCURRL0 for the sell currency                          CPM005
      *                                                                   CPM005
     C                     Z-ADDSPRT,B    A6SPRT                          CPM005
     C                     Z-ADDNBDP,B    A6NBDP                          CPM005
     C                     MOVE MDIN,B    A6MDIN                          CPM005
     C                     Z-ADDRKSQ,B    A6RKSQ                          CPM005
      *                                                                   CPM005
     C                     MOVELQBCSBY    BCCYT   3                       CPM005
     C                     Z-ADDSPRT,B    BRATET 138                      CPM005
     C                     MOVE MDIN,B    BMDINT  1                       CPM005
     C                     Z-ADDNBDP,B    BCDPT   10                      CPM005
      *                                                                   CPM005
      **  Write 2 records each time                                       CPM005
      *                                                                   CPM005
     C                     Z-ADD1         X       10                      CPM005
     C           X         DOWLT3                          *B1            CPM005
      *                                                                   CPM005
      **  First time                                                      CPM005
      *                                                                   CPM005
     C           X         IFEQ 1                          *B2            CPM005
     C                     Z-ADDPUAM      WWXAMT 150                      CPM005
     C                     MOVELPUCY      WWXCCY  3                       CPM005
     C                     ELSE                            *X2            CPM005
     C                     Z-ADDSLAM      WWXAMT                          CPM005
     C                     MOVELSLCY      WWXCCY  3                       CPM005
     C                     ENDIF                           *E2            CPM005
      *                                                                   CPM005
      **  Access with sett or nominal ccy to retrieve details             CPM005
      *                                                                   CPM005
     C                     Z-ADD1         B                               CPM005
     C           WWXCCY    LOKUPCYCD,B                   72               CPM005
      *                                                                   CPM005
      **  If record not found:                                            CPM005
      *                                                                   CPM005
     C           *IN72     IFEQ '0'                        *B2            CPM005
     C                     Z-ADD24        DBASE            ***************CPM005
     C                     MOVEL'SDCURRL0'DBFILE           * DB ERROR 24 *CPM005
     C                     MOVELWWXCCY    DBKEY            ***************CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                           *E2            CPM005
      *                                                                   CPM005
     C                     MOVELWWXCCY    ZCCYF                           CPM005
     C                     Z-ADDSPRT,B    ZRATEF                          CPM005
     C                     MOVE MDIN,B    ZMDINF                          CPM005
     C                     Z-ADDNBDP,B    ZCDPF                           CPM005
      *                                                                   CPM005
      **  Convert amount into portfolio currency                          CPM005
      *                                                                   CPM005
     C                     MOVELPNPTCY    ZCCYT                           CPM005
     C                     Z-ADDWWPSPR    ZRATET                          CPM005
     C                     MOVELWWPMDI    ZMDINT                          CPM005
     C                     Z-ADDWWPCDP    ZCDPT                           CPM005
      *                                                                   CPM005
     C                     Z-ADDWWXAMT    ZAMTF                           CPM005
     C                     EXSR ZCCYCN                                    CPM005
     C                     Z-ADDZAMTT     WW1AMT 150                      CPM005
      *                                                                   CPM005
     C                     MOVELBCCYT     ZCCYT                           CPM005
     C                     Z-ADDBRATET    ZRATET                          CPM005
     C                     MOVELBMDINT    ZMDINT                          CPM005
     C                     Z-ADDBCDPT     ZCDPT                           CPM005
      *                                                                   CPM005
     C                     EXSR ZCCYCN                                    CPM005
     C                     Z-ADDZAMTT     WW2AMT 150                      CPM005
      *                                                                   CPM005
     C           X         IFEQ 1                          **B2           CPM005
     C                     Z-SUBWW1AMT    FGMNT1                          CPM005
     C                     Z-SUBWW2AMT    FGMNT2                          CPM005
     C                     ELSE                            **X2           CPM005
     C                     Z-ADDWW1AMT    FGMNT1                          CPM005
     C                     Z-ADDWW2AMT    FGMNT2                          CPM005
     C                     ENDIF                           **E2           CPM005
      *                                                                   CPM005
     C                     MOVELWWXCCY    FGCURR                          CPM005
      *                                                                   CPM005
     C/COPY WNCPYSRC,PM1144CP10                                           S01408
     C                     WRITEPMEVCYD0                                  CPM005
     C/COPY WNCPYSRC,PM1144CP11                                           S01408
      *                                                                   CPM005
     C                     ADD  1         X                               CPM005
     C                     ENDDO                           *EW1           CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
     C*
      ********************************************************************
      /EJECT
     C********************************************************************
      *                                                                  *
      * PTFDET   - ACCESS PORTFOLIO DETAILS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
     C********************************************************************
     C           PTFDET    BEGSR                           ***  PTFDET ***
     C*
     C** IF HOLDING IS IN THE 'UNASSIGNED' PORTFOLIO
     C*
     C           PNPTFR    IFEQ '9997'
     C*
     C** USE THE CUSTOMER DETAILS FROM LF/SDPLCSL0 AS THE 'PORTFOLIO' DETAILS
     C*
     C                     MOVELQBCSBY    PNPTCY
     C                     Z-ADDQBBYDP    PNPCDP
     C*
     C                     ELSE
     C*
     C** ACCESS THE PORTFOLIO DEFINITION DETAILS FROM PF/PMPORTPP USING A
     C** KEY OF THE CUSTOMER & PORTFOLIO REFERENCE PASSED TO THIS PROCESS
     C*
     C***********KPORQ2    CHAINPMPORTPP             72                   S01486
     C           KPORQ2    CHAINPMPORTPD             72                   S01486
     C*
     C** ERROR
     C*
     C           *IN72     IFEQ '1'                        ***************
     C                     Z-ADD13        DBASE            **DB ERROR 13**
     C***********          MOVEL'PMPORTPP'DBFILE           ***************S01486
     C                     MOVE 'PMPORTPD'DBFILE                          S01486
     C                     MOVELPNCNUM    DBKY10 10
     C                     MOVE PNPTFR    DBKY10
     C                     MOVELDBKY10    DBKEY
     C                     EXSR *PSSR
     C                     END
     C                     END
     C*                                                                   R00631
     C** ACCESS LF/SDCURRL0 USING PORTFOLIO CURRENCY AS KEY               R00631
     C****       PNPTCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD18        DBASE            **DB ERROR 18**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELWWPUCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 END                                            B08040
     C****                                                                B08040
     C****AVE SPOT RATE, NO OF DECIMAL PLACES, MULT/DIV IND AND RANK      B08040
     C****                 Z-ADDA6SPRT    WWPSPR 138                      B08040
     C****                 Z-ADDA6NBDP    WWPCDP  10                      B08040
     C****                 MOVE A6MDIN    WWPMDI  1                       B08040
     C****                 Z-ADDA6RKSQ    WWPRNK  50                      B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PNPTCY    LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD18        DBASE            **DB ERROR 18**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWPUCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** SAVE SPOT RATE, NO OF DECIMAL PLACES, MULT/DIV IND AND RANK      B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     Z-ADDA6SPRT    WWPSPR 138                      B08040
     C                     Z-ADDA6NBDP    WWPCDP  10                      B08040
     C                     MOVE A6MDIN    WWPMDI  1                       B08040
     C                     Z-ADDA6RKSQ    WWPRNK  50                      B08040
     C*                                                                   B08040
     C                     ENDSR
     C********************************************************************B08040
      /EJECT                                                              B08040
      ********************************************************************B08040
      *                                                                  *B08040
      * #HLDX0   - CALCULATE DETAILS TO BE OUTPUT TO PMHOLDX0            *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLS:                                                *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLED FROM:                                          *B08040
      * W01      - WRITE TO PMHOLDPP                                     *B08040
      *                                                                  *B08040
      * ROUTINE USES VARIABLES:                                          *B08040
      *                                                                  *B08040
      ********************************************************************B08040
     C           #HLDX0    BEGSR                           * W03    BSR * B08040
     C*                                                                   B08255
     C****       QFPTFR    IFNE '9998'                              R37474B08255
     C****       QFPTFR    ANDNE'9999'                              R37474B08255
     C****       QBAPBC    OREQ 'N'                                 R37474B08255
     C*                                                                   B08040
     C** SET ALL TOTAL FIELDS TO ZERO                                     B08040
     C                     Z-ADD0         QFPTPA                          B08040
     C                     Z-ADD0         QFPTNA                          B08040
     C                     Z-ADD0         QFPTMV                          B08040
     C                     Z-ADD0         QFPVPA                          B08040
     C                     Z-ADD0         QFPVNA                          B08040
     C                     Z-ADD0         QFPVMV                          B08040
     C                     Z-ADD0         QFPTAI                          B08040
     C                     Z-ADD0         QFPTNI                          B08040
     C                     Z-ADD0         QFMVPC                          R37474
     C                     Z-ADD0         QFAIPC                          R37474
     C*                                                                   B08040
     C           QFTVDA    CABEQ'T'       BLKREC                          B08040
     C*                                                                   46081
     C           QFTVDA    IFEQ 'X'                                       46081
     C           *IN01     ANDEQ'0'                                       46081
     C           WWTVPS    ANDEQ'V'                                       47617
     C                     GOTO BLKREC                                    46081
     C                     END                                            46081
     C*                                                                   B08040
     C** DETERMINE PORTFOLIO VALUATION CURRENCY                           B08040
     C           QFPTFR    IFNE '9997'                                    B08040
     C           QFPTFR    ANDNE'9998'                                    B08040
     C           QFPTFR    ANDNE'9999'                                    B08040
     C                     MOVE PNPTCY    WWVLCY  3                       B08040
     C                     ELSE                                           B08040
     C                     MOVE QBCSBY    WWVLCY                          B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** IF VALUATION CURRENCY DIFFERENT TO CURRENCY 1 SET UP PARAMETER   B08040
     C** TO BE USED IN SR/ZCCYCN                                          B08040
     C           QFBYSF    IFEQ *BLANKS                                   B08040
     C           WWVLCY    ANDNEQFCCY1                                    B08040
     C                     Z-ADD1         B                               B08040
     C           QFCCY1    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        ***************B08040
     C                     Z-ADD17        DBASE            * DB ERROR 16 *B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELQFCCY1    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C                     MOVE QFCCY1    ZCCYF                           B08040
     C                     Z-ADDSPRT,B    ZRATEF                          B08040
     C                     MOVE MDIN,B    ZMDINF                          B08040
     C                     Z-ADDNBDP,B    ZCDPF                           B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWVLCY    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        ***************B08040
     C                     Z-ADD18        DBASE            * DB ERROR 16 *B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWVLCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C                     MOVE WWVLCY    ZCCYT                           B08040
     C                     Z-ADDSPRT,B    ZRATET                          B08040
     C                     MOVE MDIN,B    ZMDINT                          B08040
     C                     Z-ADDNBDP,B    ZCDPT                           B08040
     C*                                                                   B08040
     C** CONVERT MARKET VALUE TO PORTFOLIO CURRENCY                       B08040
     C                     Z-ADDQFMVAL    ZAMTF                           B08040
     C                     EXSR ZCCYCN                                    B08040
     C                     Z-ADDZAMTT     WWMVL1 150                      B08040
     C*                                                                   B08040
     C** CONVERT ACCRUED INTEREST TO PORTFOLIO CURRENCY                   B08040
     C                     Z-ADDQFACIS    ZAMTF                           B08040
     C                     EXSR ZCCYCN                                    B08040
     C                     Z-ADDZAMTT     WWACI1 150                      B08040
     C*                                                                   B08040
     C** ... OTHERWISE USE VALUES WRITTEN TO PMHOLDPP                     B08040
     C                     ELSE                                           B08040
     C*                                                                   B08040
     C           QFBYSF    IFEQ *BLANKS                                   B08040
     C                     Z-ADDQFMVAL    WWMVL1                          B08040
     C                     Z-ADDQFACIS    WWACI1                          B08040
     C                     ELSE                                           B08040
     C                     Z-ADDQFPLFX    WWMVL1                          B08040
     C                     Z-ADD0         WWACI1                          B08040
     C                     END                                            B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** SET ON INDICATOR FOR MM LOAN (IE LIABILITY)                      B08040
     C                     MOVE 'N'       WWLIAB  1                       B08040
     C           *IN02     IFEQ '1'                                       B08040
     C           QFMVAL    ANDLT0                                         B08040
     C                     MOVE 'Y'       WWLIAB  1                       B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** ADD MARKET VALUE AND ACCRUED INTEREST TO TOTALLING FIELDS        B08040
     C           WWLIAB    IFEQ 'N'                        B1             B08040
     C           WWTVPS    IFEQ 'T'                        B2             B08040
     C           WWMVL1    IFGT 0                          B3             B08040
     C                     Z-ADDWWMVL1    QFPTPA                          B08040
     C                     ELSE                            X3             B08040
     C                     Z-SUBWWMVL1    QFPTNA                          B08040
     C                     END                             E3             B08040
     C                     Z-ADDWWACI1    QFPTAI                          B08040
     C*                                                                   B08040
     C                     ELSE                            X2             B08040
     C           WWMVL1    IFGT 0                          B3             B08040
     C                     Z-ADDWWMVL1    QFPVPA                          B08040
     C                     ELSE                            X3             B08040
     C                     Z-SUBWWMVL1    QFPVNA                          B08040
     C                     END                             E3             B08040
     C                     Z-ADDWWACI1    QFPTAI                          B08040
     C                     END                             E2             B08040
     C*
     C** OTHERWISE SET UP LIABILITY DETAILS FOR A MM LOAN
     C                     ELSE                            X1
     C           WWTVPS    IFEQ 'T'                        B2
     C                     Z-SUBWWMVL1    QFPTMV
     C                     ELSE                            X2
     C                     Z-SUBWWMVL1    QFPVMV
     C                     END                             E2
     C*
     C****                 Z-SUBWWACI1    QFPTAI                    39440 B08040
     C****                 Z-ADDWWACI1    QFPTNI                    39440 B08040
     C                     Z-ADDWWACI1    QFPTAI                          39440
     C                     Z-SUBWWACI1    QFPTNI                          39440
     C                     END                             E1
     C*                                                                   B08040
     C** IF ANY OF TOTALS NON-ZERO OUTPUT RECORD TO EXTENSION FILE        B08040
     C           BLKREC    TAG                                            B08040
     C*                                                                   B08040
     C           *IN01     IFEQ '0'                                       B08040
     C                     MOVE QFCCY1    QFCCY                           B08040
     C                     ELSE                                           B08040
     C                     MOVE QFFPLC    QFCCY                           B08040
     C                     END                                            B08040
     C*                                                                   R37474
     C** CALCULATE EXTRA FIELDS TO BE OUTPUT TO PMHOLDPP FOR MIDASQ       R37474
     C           QFPTPA    IFNE 0                          B1             R37474
     C           QFPVPA    ORNE 0                                         R37474
     C                     Z-ADDQFPTPA    QFMVPC                          R37474
     C                     ADD  QFPVPA    QFMVPC                          R37474
     C                     MOVE '+'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTNA    IFNE 0                          B1             R37474
     C           QFPVNA    ORNE 0                                         R37474
     C                     Z-SUBQFPTNA    QFMVPC                          R37474
     C                     SUB  QFPVNA    QFMVPC                          R37474
     C                     MOVE '-'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTMV    IFNE 0                          B1             R37474
     C           QFPVMV    ORNE 0                                         R37474
     C                     Z-SUBQFPTMV    QFMVPC                          R37474
     C                     SUB  QFPVMV    QFMVPC                          R37474
     C                     MOVE 'L'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFMVPC    IFEQ 0                          B1             R37474
     C                     MOVE 'N'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C                     Z-ADDQFPTAI    QFAIPC                          R37474
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD PMHOLDQ0 PMHOLDQ1            CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C*                                                                   B08040
     C           QFPTFR    IFNE '9998'                                    R37474
     C           QFPTFR    ANDNE'9999'                                    R37474
     C           QBAPBC    OREQ 'N'                                       R37474
     C*                                                                   B08040
     C/COPY WNCPYSRC,PM1144C008
     C           QBAPBC    IFEQ 'N'                                       B08255
     C                     WRITEPMHOLDD1                                  B08040
     C                     ELSE                                           B08255
     C                     WRITEPMHOLDD0                                  B08040
     C                     END                                            B08255
     C/COPY WNCPYSRC,PM1144C009
     C                     END                                            B08255
      *                                                                   CPM005
      **  If outputting an FX deal write a totalling record for the       CPM005
      **  other currency                                                  CPM005
      *                                                                   CPM005
     C           *IN01     IFEQ '1'                        B1             CPM005
      *                                                                   CPM005
     C                     MOVE QFCCY     WLCCY   3                       CPM005
     C           WLCCY     IFEQ QFCCY1                     B2             CPM005
     C                     MOVE QFCCY2    QFCCY                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE QFCCY1    QFCCY                           CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     Z-ADD0         QFPTPA                          CPM005
     C                     Z-ADD0         QFPTNA                          CPM005
     C                     Z-ADD0         QFPTMV                          CPM005
     C                     Z-ADD0         QFPVPA                          CPM005
     C                     Z-ADD0         QFPVNA                          CPM005
     C                     Z-ADD0         QFPVMV                          CPM005
     C                     Z-ADD0         QFPTAI                          CPM005
     C                     Z-ADD0         QFPTNI                          CPM005
     C                     Z-ADD0         QFASVL                          CPM005
     C                     Z-ADD0         QFLIVL                          CPM005
      *                                                                   CPM005
     C           QFPTFR    IFNE '9998'                     B2             CPM005
     C           QFPTFR    ANDNE'9999'                                    CPM005
     C           QBAPBC    OREQ 'N'                                       CPM005
      *                                                                   CPM005
     C/COPY WNCPYSRC,PM1144CP14                                           S01408
     C           QBAPBC    IFEQ 'N'                        B3             CPM005
     C                     WRITEPMHOLDD1                                  CPM005
     C                     ELSE                            X3             CPM005
     C                     WRITEPMHOLDD0                                  CPM005
     C                     END                             E3             CPM005
     C/COPY WNCPYSRC,PM1144CP15                                           S01408
     C                     END                             E2             CPM005
     C                     END                             E1             CPM005
     C*                                                                   B08040
     C                     ENDSR                           * W03    ESR * B08040
      *****************************************************************   CPM005
      /EJECT                                                              CPM005
      *****************************************************************   CPM005
      *                                                               *   CPM005
      * NEWFLD   - New Field in PMHOLDPD PMHOLDQ0 PMHOLDQ1            *   CPM005
      *                                                               *   CPM005
      * Subroutine Calls:                                             *   CPM005
      *                                                               *   CPM005
      * Subroutine Called From:                                       *   CPM005
      * W01      -                                                    *   CPM005
      *                                                               *   CPM005
      * Routine Uses Variables:                                       *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
     C           NEWFLD    BEGSR                                          CPM005
      *                                                                   CPM005
     C                     MOVEL*BLANKS   WYPOSQ                          CPM005
     C                     MOVEL*BLANKS   WXPOSQ                          CPM005
      *                                                                   CPM005
     C           QFMODI    IFEQ 'MD'                       B1             CPM005
     C           QFMODI    OREQ 'ML'                                      CPM005
      *                                                                   CPM005
      **  If value date greater than event control date                   CPM005
      *                                                                   CPM005
     C           WWVDAT    IFGT WWECD                      B2             CPM005
     C                     MOVEL'FO'      QFPOST                          CPM005
     C                     MOVEL'FO'      QFPOTY                          CPM005
     C                     ELSE                            X2             CPM005
     C                     MOVEL'C '      QFPOST                          CPM005
     C                     MOVEL'C '      QFPOTY                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     ELSE                            X1             CPM005
      *                                                                   CPM005
     C           WWOCT     IFEQ 'L'                        B2             CPM005
     C                     MOVEL'FO'      QFPOST                          CPM005
     C                     MOVEL'FO'      QFPOTY                          CPM005
     C                     ELSE                            X2             CPM005
     C                     MOVEL'FC'      QFPOST                          CPM005
     C                     MOVEL'FC'      QFPOTY                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     END                             E1             CPM005
      *                                                                   CPM005
     C           WWMVL1    IFGT *ZEROS                                    CPM005
     C           WWMVL1    ADD  WWACI1    QFASVL                          CPM005
     C                     MOVEL'A'       QFASLI                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADD*ZEROS    QFASVL                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C           WWMVL1    IFLT *ZEROS                                    CPM005
     C                     Z-SUBWWMVL1    WWMVL1                          CPM005
     C           WWMVL1    SUB  WWACI1    QFLIVL                          CPM005
     C                     MOVEL'L'       QFASLI                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADD*ZEROS    QFLIVL                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  For forward loans & deposits, value asset/liability must be 0   CPM005
      *                                                                   CPM005
     C           QFMODI    IFNE 'FX'                                      CPM005
     C           QFPOST    ANDEQ'FO'                                      CPM005
     C                     Z-ADD*ZEROS    QFASVL                          CPM005
     C                     Z-ADD*ZEROS    QFLIVL                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  If FX *IN01 is on                                               CPM005
      *                                                                   CPM005
     C           *IN01     IFEQ '1'                                       CPM005
     C                     Z-ADDWWDSEQ    WXDSEQ                          CPM005
     C                     Z-ADDWWVDAT    WXDATE                          CPM005
     C                     MOVELWWPUCY    WXCCY2                          CPM005
     C                     MOVELWXPOSQ    QFPOSQ                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVELWWCCY1    WYCCY1                          CPM005
     C                     Z-ADDWWMDAT    WYDATE                          CPM005
     C                     MOVELWYPOSQ    QFPOSQ                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
      ********************************************************************
      /EJECT
     C********************************************************************
     C*
     C*  ZFDLLN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR DEALING
     C*
     C*  CASE 1 FX DEALS (DEALSDB)        FORMAT: YYY VVVVVVV(DDDDDDD)
     C*          YYY = CUSTOMER SELL CURRENCY (IE BANK BUY CURRENCY)
     C*          VVVVVVV = VALUE DATE IN DDMMMYY FORMAT
     C*          DDDDDDD = DEAL DATE IN DDMMMYY FORMAT
     C*
     C*  CASE 2 MM DEALS (DEALSDC)        FORMAT: XXX 999.9999 DDMMMYY
     C*                                        OR: XXX 999.9999 999
     C*          XXX = CURRENCY
     C*          999.9999 = INTEREST RATE
     C*          DDMMMYY = MATURITY DATE (IF MATURITY DATE NOT = 0)
     C*          999 = NOTICE DAYS       (IF MATURITY DATE = 0 )
     C*
     C*  CASE 3 FRA/IRS DEALS (DEALSDG) DEAL TYPES FR, RS AND RL
     C*                                    FORMAT: XXX 999.9999 DDMMMYY
     C*          XXX = CURRENCY
     C*          999.9999 = INTEREST RATE
     C*          DDMMMYY = MATURITY DATE
     C*
     C*  CASE 4 FRA/IRS DEALS (DEALSDG) DEAL TYPE  RX
     C*                                    FORMAT: XXX XXX DDMMMYY
     C*          XXX = OUR AND THEIR CURRENCY
     C*          DDMMMYY = MATURITY DATE
     C*
     C*
     C*  INPUT  FIELDS
     C*       ZPUCY   3A     PURCHASE CURRENCY
     C*       ZDDAT   50     DEAL DATE
     C*       ZVDAT   50     VALUE DATE
     C*       ZCCY    3A     CURRENCY
     C*       ZINRT  117     INTEREST RATE
     C*       ZMDAT   50     MATURITY DATE
     C*       ZNOTD   30     NOTICE DAYS
     C*       ZUCUCY  3A     FRA/IRS OUR CURRENCY
     C*       ZUEINR 117     FRA/IRS OUR INTEREST RATE
     C*       ZTCUCY  3A     FRA/IRS THEIR CURRENCY
     C*
     C*  OUTPUT  FIELDS
     C*       ZLIN   20A     LINE DESCRIPTION
     C*
     C*  ARRAY USED
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFDLLN    BEGSR                           *** ZFDLLN ***
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C** FORMAT DETAIL OUTPUT FOR DEAL TYPE CASE 1
     C           ZDDAT     IFNE 0
     C                     MOVEAZPUCY     ZLI,01
     C                     Z-ADDZVDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C*
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,05
     C                     MOVEA'('       ZLI,12
     C*
     C                     Z-ADDZDDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C*
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,13
     C                     MOVEA')'       ZLI,20
     C                     END
     C*
     C** FORMAT DETAIL OUTPUT FOR DEAL TYPE CASE 2
     C           ZCCY      IFNE *BLANKS
     C                     MOVEAZCCY      ZLI,01
     C                     Z-ADDZINRT     ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C*
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C*
     C                     MOVE ZWRKN     ZWRKA4  4
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C** IF MATURITY DATE ZERO OUTPUT NOTICE DAYS TO FORMATTED LINE
     C           ZMDAT     IFEQ *ZERO
     C                     MOVE ZNOTD     ZWRKA3  3
     C                     MOVEAZWRKA3    ZLI,14
     C                     ELSE
     C*
     C** OTHERWISE OUTPUT MATURITY DATE
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C                     END
     C*
     C                     END
     C*
     C** FORMAT DETAIL OUTPUT FOR DEAL TYPE CASE 3
     C           ZUCUCY    IFNE *BLANKS
     C           ZTCUCY    ANDEQ*BLANKS
     C                     MOVEAZUCUCY    ZLI,01
     C                     Z-ADDZUEINR    ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C*
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C*
     C                     MOVE ZWRKN     ZWRKA4  4
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C*
     C                     END
     C*
     C** FORMAT DETAIL OUTPUT FOR DEAL TYPE CASE 4
     C           ZUCUCY    IFNE *BLANKS
     C           ZTCUCY    ANDNE*BLANKS
     C                     MOVEAZUCUCY    ZLI,01
     C                     MOVEAZTCUCY    ZLI,05
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,09
     C*
     C                     END
     C*
     C** SET ALL  FIELDS TO BLANK OR ZERO
     C                     MOVE *BLANKS   ZCCY    3
     C                     MOVE *BLANKS   ZSLCY   3
     C                     Z-ADD*ZEROS    ZVDAT   50
     C                     MOVE *BLANKS   ZPUCY   3
     C                     Z-ADD*ZEROS    ZINRT  117
     C                     Z-ADD*ZEROS    ZDDAT   50
     C                     Z-ADD*ZEROS    ZMDAT   50
     C                     Z-ADD*ZEROS    ZNOTD   30
     C                     MOVE *BLANKS   ZUCUCY  3
     C                     Z-ADD*ZEROS    ZUEINR 117
     C                     MOVE *BLANKS   ZTCUCY  3
     C*
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN   26                                           CGL029
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE1Z2
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      *                                                                   R00631
      ** /* R00631  START */                                              R00631
      **************************************************************************
      *                                                                        *
      *  ZFWDRT - SR. TO CALCULATE THE FORWARD FX RATE BETWEEN TWO CURRENCIES. *
      *                                                                        *
      *  INPUT  FIELDS                                                         *
      *       ZAMTF  150     'FROM' AMOUNT                                     *
      *       ZCCYF   3A     'FROM' CURRENCY                                   *
      *       ZCCYT   3A     'TO' CURRENCY                                     *
      *       ZMDINF  1A     'FROM' CURRENCY MULTIPLY/DIVIDE INDICATOR         *
      *       ZMDINT  1A     'TO' CURRENCY MULTIPLY/DIVIDE INDICATOR           *
      *       ZCDPF   10     'FROM' CURRENCY NUMBER OF DECIMAL PLACES          *
      *       ZCDPT   10     'TO' CURRENCY NUMBER OF DECIMAL PLACES            *
      *       ZSPOTF 138     'FROM' CURRENCY SPOT RATE                         *
      *       ZSPOTT 138     'TO' CURRENCY SPOT RATE                           *
      *       ZDATN   50     FORWARD DATE (MIDAS DAY NUMBER FORMAT)            *
      *       ZRDATE  50     RUN DATE, SDBANKPD (MIDAS DAY NUMBER FORMAT)      *
      *                                                                        *
      *  OUTPUT  FIELDS                                                        *
      *       ZAMTT  150     ZAMTF CONVERTED INTO 'TO' CURRENCY                *
      *                      USING FORWARD RATES                               *
      *       ZCRSRT 138     FORWARD FX RATE BETWEEN 'FROM' & 'TO' CURRENCIES  *
      *                      (ALWAYS A MULTIPLY RATE)                          *
      *                                                                        *
      *   WORK FIELDS                                                          *
      ******* DFWDS ******** DATA STRUCTURE (50 = 25 X 2P)                S01328
      *       DFWDS          DATA STRUCTURE (75 = 25 X 3P)                S01328
      *       RFWDS          DATA STRUCTURE (175 = 25 X 7P)                    *
      *       DF             FORWARD DAYS ARRAY (25 X 3 0)                     *
      *       RF             FORWARD RATES ARRAY (25 X 13 8)                   *
      *       DYF            FORWARD DATES ARRAY (26 X 3 0)                    *
      *       RAF            FORWARD RATES ARRAY (26 X 13 8)                   *
      *       ZWCCY   3A     CURRENCY                                          *
      *       ZWSPOT 138     SPOT RATE                                         *
      *       I       10     INDEX TO PROCESS 'FROM' AND 'TO' CURRENCIES       *
      *       J       20     INDEX TO ACCESS ELEMENTS OF ARRAYS                *
      *       K       20     INDEX TO ACCESS ELEMENTS OF ARRAYS                *
      *       ZWRATE 138     FORWARD RATE                                      *
      *       ZRATEF 138     'FROM' CURRENCY FORWARD RATE (INPUT FOR ZCCYCN)   *
      *       ZRATET 138     'TO' CURRENCY FORWARD RATE (INPUT FOR ZCCYCN)     *
      *       ZWDAT1  50     DATE (MIDAS DAY NUMBER FORMAT)                    *
      *       ZWDAT2  50     DATE (MIDAS DAY NUMBER FORMAT)                    *
      *       ZWDDT1  50     DATE (MIDAS DAY NUMBER FORMAT)                    *
      *       ZWDDT2  50     DATE (MIDAS DAY NUMBER FORMAT)                    *
      *       ZWRAT1 138     RATE                                              *
      *       ZWRAT2 138     RATE                                              *
      *       ZWRDIF 158     RATE                                              *
      *                                                                        *
      *   INDICATORS USED                                                      *
      *       *IN91,92,93,*  USED ON SEARCH FOR ZDATN ON FORWARD DATES ARRAY   *
      *       *IN99          USED ON CHAIN TO LF/FWDRT                         *
      *                                                                        *
      *   ALSO REQUIRED                                                        *
      *       DATA STRUCTURE FOR FORWARD DAYS FROM FILE FWDRT (CHAR)           *
      *       DATA STRUCTURE FOR FORWARD RATES FROM FILE FWDRT (CHAR)          *
      *       ARRAY FOR FORWARD DAYS FROM FILE FWDRT (NUM)                     *
      *       ARRAY FOR FORWARD RATES FROM FILE FWDRT (NUM)                    *
      *       ARRAY FOR ALL FORWARD DATES (RUN DATE AND R.D.+DAYS FROM FILE)   *
      *       ARRAY FOR ALL FORWARD RATES (SPOT RATE AND RATES FROM FILE)      *
      *                                                                        *
      *  CALLS:                                                                *
      *       ZCCYCN                                                           *
      *                                                                        *
      *  CALLED BY:                                                            *
      *                                                                        *
      **************************************************************************
      *
     C           ZFWDRT    BEGSR                           ** ZFWDRT BSR**
      *
      ** DEFINE INPUT AND OUTPUT FIELDS
     C                     Z-ADDZAMTF     ZAMTF  150
     C                     MOVE ZCCYF     ZCCYF   3
     C                     MOVE ZCCYT     ZCCYT   3
     C                     MOVE ZMDINF    ZMDINF  1
     C                     MOVE ZMDINT    ZMDINT  1
     C                     Z-ADDZCDPF     ZCDPF   10
     C                     Z-ADDZCDPT     ZCDPT   10
     C                     Z-ADDZSPOTF    ZSPOTF 138
     C                     Z-ADDZSPOTT    ZSPOTT 138
     C                     Z-ADDZDATN     ZDATN   50
     C                     Z-ADDZRDATE    ZRDATE  50
     C                     Z-ADD0         ZAMTT  150
     C                     Z-ADD0         ZCRSRT 138
      *
      ** CALCULATE THE FORWARD RATE FIRST FOR THE 'FROM' CURRENCY
      ** AND THEN FOR THE 'TO' CURRENCY BY USING THE SAME PROCESSING
     C                     Z-ADD1         I       30
     C           I         DOUEQ3                          B1
      *
      ** I = 1 : 'FROM' CURRENCY, I = 2 : 'TO' CURRENCY
     C           I         IFEQ 1                          B2
     C                     MOVE ZCCYF     ZWCCY   3
     C                     Z-ADDZSPOTF    ZWSPOT 138
     C                     ELSE                            X2
     C                     MOVE ZCCYT     ZWCCY
     C                     Z-ADDZSPOTT    ZWSPOT
     C                     END                             E2
      *
      ** INITIALISE FORWARD DATES AND FORWARD RATES ARRAYS
     C                     MOVEA*ZERO     DYF
     C                     MOVEA*ZERO     RAF
     C                     Z-ADDZRDATE    DYF,1
     C                     Z-ADDZWSPOT    RAF,1
      *
      ** ACCESS LF/FWDRT AND SET UP FURTHER ELEMENTS OF THE TWO ARRAYS
     C           ZWCCY     CHAINFWDRT                99
      *
     C           *IN99     IFEQ '0'                        B2
     C           RECI      ANDEQ'D'
     C                     MOVE DFW       DFWDS
     C                     MOVE RFW       RFWDS
     C                     Z-ADD1         J       30
     C                     Z-ADD2         K       30
      *
      ** SET UP EACH ELEMENT OF FORWAD DATES ARRAY
     C           J         DOWLT26                         B3
     C           DF,J      IFNE 0                          B4
     C           ZRDATE    ADD  DF,J      DYF,K
     C                     ADD  1         J
     C                     ADD  1         K
     C                     ELSE                            X4
     C                     Z-ADD90        J
     C                     END                             E4
     C                     END                             E3
      *
      ** SET UP ELEMENTS OF FORWAD RATES ARRAY
     C                     MOVEARF        RAF,2
      *
     C                     END                             E2
      *
      ** DETERMINE IF ZDATN IS EQUAL TO AN ELEMENT OF FORWARD DATES ARRAY
     C                     Z-ADD1         J
     C           ZDATN     LOKUPDYF,J                    91
     C           *IN91     IFEQ '1'                        B2
      *
      ** ZDATN IS EQUAL TO A FORWARD DATE IN THE ARRAY
     C                     Z-ADDRAF,J     ZWRATE 138
      *
      ** DETERMINE IF ZDATN IS GREATER THAN LAST DATE OF ARRAY
      ** OR IF ZDATN FALLS BETWEEN TWO DATES IN ARRAY
     C                     ELSE                            X2
     C                     MOVE '0'       *IN92
     C                     MOVE '0'       *IN93
      *
     C           J         DOUGT26                         B3
     C           *IN92     OREQ '1'
     C           *IN93     OREQ '1'
     C           ZDATN     IFLT DYF,J                      B4
     C                     MOVE '1'       *IN92
     C                     ELSE                            X4
     C           DYF,J     IFEQ 0                          B5
     C                     MOVE '1'       *IN93
     C                     ELSE                            X5
     C                     ADD  1         J
     C                     END                             E5
     C                     END                             E4
     C                     END                             E3
      *
      ** ZDATN IS GREATER THAN THE LAST FORWARD DATE IN THE ARRAY
     C           *IN92     IFEQ '0'                        B3
     C                     SUB  1         J
     C                     Z-ADDRAF,J     ZWRATE
      *
      ** ZDATN IS BETWEEN TWO FORWARD DATES IN THE ARRAY
     C                     ELSE                            X3
     C                     Z-ADDDYF,J     ZWDAT2  50
     C                     Z-ADDRAF,J     ZWRAT2 138
     C                     SUB  1         J
     C                     Z-ADDDYF,J     ZWDAT1  50
     C                     Z-ADDRAF,J     ZWRAT1 138
     C           ZDATN     SUB  ZWDAT1    ZWDDT1  50
     C           ZWDAT2    SUB  ZWDAT1    ZWDDT2  50
     C           ZWRAT2    SUB  ZWRAT1    ZWRDIF 158
     C                     MULT ZWDDT1    ZWRDIF
     C                     DIV  ZWDDT2    ZWRDIF    H
     C           ZWRAT1    ADD  ZWRDIF    ZWRATE
     C                     END                             E3
      *
     C                     END                             E2
      *
     C           I         IFEQ 1                          B2
     C                     Z-ADDZWRATE    ZRATEF 138
     C                     ELSE                            X2
     C                     Z-ADDZWRATE    ZRATET 138
     C                     END                             E2
      *
     C                     ADD  1         I
     C                     END                             E1
      *
      ** CALL SR/ZCCYCN TO CALCULATE THE FORWARD FX RATE
      ** USING THE CALCULATED FORWARD RATES
     C                     EXSR ZCCYCN
      *
      ** IF THE CROSS RATE MULT/DIV IND IS 'D', INVERSE FORWARD FX RATE
     C           ZCRSMD    IFEQ 'D'                        B1
     C           1         DIV  ZCRSRT    ZCRSRT    H
     C                     END                             E1
      *
     C                     ENDSR                           ** ZFWDRT ESR**
      *
      ********************************************************************
     C**************************************************************************
      /EJECT
      /COPY ZSRSRC,GLINTCZ1
      /EJECT
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
      /COPY ZSRSRC,ZRSTORZ1
      /EJECT
      /COPY ZSRSRC,ZSAVEZ1
      /EJECT
      /COPY ZSRSRC,ZCCYCN
      ****/EJECT                                                          47719
      ****/COPY ZSRSRC,ZCCYXR                                             47719
      /EJECT
      /COPY ZSRSRC,ZCCYXR                                                 062885
      /EJECT                                                              062885
     C/COPY ZSRSRC,ZINTDYZ2                                               S01486
     C/EJECT                                                              S01486
     C/COPY ZSRSRC,ZDATE9Z3                                               S01486
     C/EJECT                                                              S01486
      **************************************************************************
      *                                                                        *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * INIT     - INITIAL PROCESSING                                    *
      * P01      - ACCESS INSTRUMENT DETAILS                             *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      * P03      - FORMAT FX DEAL DETAILS FOR OUTPUT TO PORTF.HOLDING    *
      * P04      - FORMAT MM DEAL DETAILS FOR OUT.TO PORTF. HOLDINGS     *
      * P05      - FORMAT FRA/IRS DEAL DETAILS FOR OUT.TO PORTF.HOLD.    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*
     C           WWERRO    IFEQ ' '
     C                     MOVE 'Y'       WWERRO  1
     C*
     C           DBASE     IFNE 0
     C*
     C**  PRINT ERROR MESSAGE:
     C                     WRITEERRORAU
     C                     ELSE
     C                     Z-ADD999       DBASE
     C                     END
     C*
     C                     DUMP
     C                     END
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
     C*
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
