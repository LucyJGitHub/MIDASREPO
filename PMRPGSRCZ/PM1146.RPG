     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM LE portfolio holdings update')                *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                      *
     F*                                                               *
     F*  PM1146 - LE Portfolio Holdings Update                        *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD053295           Date 13Apr19               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CLE141             Date 08Feb16               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE143             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23967           Date 15May09               *
      *                 CER016A            Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CAS009             Date 16May05               *
      *                 CSW037A            Date 02May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CAP074             Date 08Aug02               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 185344             Date 28Dec01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      *                 176443             Date 18Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 09Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 144915             Date 28Oct98               *
      *                 126017             Date 14Nov97               *
      *                 121768             Date 20Feb98               *
     F*                 097885             DATE 03FEB97               *
     F*                 CPM005             DATE 01JUL96               *
     F*                 CFF004             DATE 02OCT96               *
     F*                 S71062             DATE 24JAN96               *
     F*                 CPM004             DATE 04MAR96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 094712             DATE 17OCT95               *
     F*                 094746             DATE 15OCT95               *
     F*                 082763             DATE 06FEB95               *
     F*                 S01486             DATE 11AUG94               *
     F*                 049421             DATE 04NOV93               *
     F*                 059111             DATE 10AUG93               *
     F*                 057020             DATE 18JUN93               *
     F*                 036437     DT      DATE 26FEB92               *
     F*                 036141     DT      DATE 20FEB92               *
     F*                 47719              DATE 24NOV92               *
     F*                 47617              DATE 17NOV92               *
     F*                 46081              DATE 19OCT92               *
     F*                 S01313             DATE 28APR92               *
     F*                 R37474             DATE 23MAR92               *
     F*                 B08253             DATE 10OCT91               *
     F*                 B08255             DATE 07OCT91               *
     F*                 B08194             DATE 28AUG91               *
     F*                 B08040             DATE 04JUL91               *
     F*                 B07816             DATE 22/05/91              *
     F*                 R05763             DATE 27/03/91              *
     F*                 R05669             DATE 13MAR91               *
     F*                 000078             DATE 31JAN91               *
     F*                 R00631             DATE 24OCT90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  AR996895 - Incorrect accrual interest calculation.           *
      *             (Child:AR996897) (Recompile)                      *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate (Recompile)                                    *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23967 - Add Local Industry Code Field.                    *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus (Recompile)                           *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *           (Recompile)                                         *
      *  185344 - Take into consideration last or first day accrual   *
      *           for the accruals calculation.                       *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
     F*  176443 - Avoid MCH3601 to be sent.                           *
     F*           Pass correct parameter to AOCUSTR0.                 *
     F*  CPB001 -  'Private Banking' Module                           *
      *  144915 - Recompiled due to changes in PF/CLOANCK.            *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/1 - CHANGE CUSTOMER/PORTFOLIO BASE CURRENCY    *
     F*           PBFG/2 - CALCULATE & REPORT PERF. FOR ALL CUST.PORT *
     F*           PBFG/5 - INSTRUMENT ASSET/LIABILITY SPLIT           *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
     F*  S71062 - OUTPUT ADDITIONAL FIELDS SPBS AND NMDP              *
     F*  CPM004 - Bank Portfolios                                     *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  094712 - CL override uses matured loans files resulting in   *
     F*           incorrect buffer positions and database error 08.   *
     F*           Include PMCLONL4 and MLOAN in RPG code and use      *
     F*           conditioning statements to access the correct files.*
     F*  094746 - Loans on PMHOLDPD have no default country/industry  *
     F*  082763 - Valuation Stmt not produced (use ICD defaults for   *
     F*           Local Industry code and country code if blank on    *
     F*           customer)                                           *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  059111 - Output FX Book Price if value date is equal to      *
     F*           Last Extract Date.                                  *
     F*  057020 - OUTPUT DOUBLE PRECISION FX RATE TO FILE             *
     F*  036437 - USE DEFAULT INSTRUMENT TYPE WHEN DBTE 03            *
     F*  036141 - AVOID DATABASE ERROR WHEN CLOSED PORTFOLIO CUSTOMER *
     F*  47719  - CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES    *
     F*  47617  - ONLY OUTPUT TVDA = 'V' FOR LOAN WITH VALUE DATE     *
     F*           *GT ECD                                             *
     F*  46081  - IF VALUE DATE POSITIONS OUTPUT LOAN EVEN IF LOAN    *
     F*           VALUE DATE NOT REACHED                              *
     F*  S01313 - CHANGES FOR PORTFOLIO PERFORMANCE                   *
     F*  R37474 - ADD TOTALLING FIELDS TO PF/PMHOLDPP FOR MIDASQ      *
     F*  B08253 - Changes to extract matured positions to             *
     F*           separate file.                                      *
     F*  B08255 - SPEED UP COB BY SPLITTING TOTALLING FILES           *
     F*  B08194 - FOR MATURED LOAN NOMINAL AMOUNT1 IS ORIGINAL PCPL   *
     F*  B08040 - SUNDRY FIXES TO SPEED UP COB                        *
     F*  B07816 - CHECK LOAN TYPE / SUB-TYPE DEFINITION TO DETERMINE  *
     F*           WHETHER LOAN SHOULD BE GIVEN A MARKET VALUE         *
     F*  R05763 - MATURED POSITIONS SHOULD HAVE ZERO MARKET VALUE AND *
     F*           ACCRUED INTEREST                                    *
     F*  R05669 - OUTPUT COUNTRY AND INDUSTRY TO PMHOLDPP             *
     F*  000078 - GUARANTEES SHOULD NOT AFFECT THE PORTFOLIO POSITION *
     F*  R00631 - EXPRESS FX RATES ACCORDING TO THE RANK OF THE CCIES *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F***CLOANP2*IF  E           K        DISK                            S01486
     FPMCLONL2IF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     FPMCLONL4IF  E           K        DISK                               094712
     F            CLOANCLF                          KRENAMECLOANCL4       094712
     F                                              KINFSR *PSSR          094712
     FLOAMS   IF  E           K        DISK                               S01313
     F                                              KINFSR *PSSR          S01313
     F****PREFIX OF PMCHRGQ1 IS 'PO'                                      B08275
     F*MCHRGQ1IF  E           K        DISK                               B08275
     F****                                          KINFSR *PSSR          B08275
     F****PREFIX OF PMPORTQ2 IS 'PN'                                      B08275
     F*MPORTQ2IF  E           K        DISK                               B08275
     F****                                          KINFSR *PSSR          B08275
     F****PREFIX*OF*SDBANKL1*IS*'BJ'*****************************         S01486
     F***SDBANKL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDCURRL0*IS*'A6'*****************************         S01486
     F***SDCURRL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F*LOAN***IF  E           K        DISK                         B08253B08194
     F****        CLOANCLF                          KIGNORE         B08253B08194
     F****                                          KINFSR *PSSR    B08253B08194
     FCLOAN   UF  E           K        DISK                               B08253
     F            CLOANCLF                          KRENAMECLOANCLX       B08253
     F                                              KINFSR *PSSR          B08253
     FMLOAN   UF  E           K        DISK                               094712
     F            CLOANHHF                          KIGNORE               094712
     F            CLOANCLF                          KRENAMECLOANCLM       094712
     F            CLOANCKF                          KRENAMECLOANCKM       094712
     F            CLOANZ1F                          KIGNORE               094712
     F                                              KINFSR *PSSR          094712
     F****PREFIX*OF*SDLOANL1*IS*'AY'*****************************         S01486
     F***SDLOANL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDPLCSL0*IS*'BB'*****************************         S01486
     F****PREFIX*OF*SDPLCSL0*IS*'QB'*****************************  036141 S01486
     F***SDPLCSL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDPORTPD*IS*'P9'*****************************  036437 S01486
     F***SDPORTPDIF**E                    DISK         KINFSR *PSSR036437 S01486
     F****PREFIX*OF*SDPLCSL0*IS*'BB'*****************************  R05669 S01486
     F****PREFIX*OF*SDPLCSL0*IS*'QB'*****************************  036141 S01486
     F***SDCUSTL0IF**E           K        DISK                     R05669 S01486
     F***********                                   KINFSR *PSSR   R05669 S01486
     F****PREFIX*OF*SDPLINPD*IS*'PD'*****************************         S01486
     F***SDPLINPDIF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F**  PREFIX OF PMDSPGPP IS 'PA'
     F***PMDSPGPPIF**E           K        DISK                            S01486
     FPMDSPGPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMVLGHPP IS 'PB'
     F***PMVLGHPPIF**E           K        DISK                            S01486
     FPMVLGHPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDBRCHPD*IS*'A8'*****************************  R05669 S01486
     F***SDBRCHL1IF**E           K        DISK                     R05669 S01486
     F***********                                   KINFSR *PSSR   R05669 S01486
     F**  PREFIX OF PMPORTPP IS 'PN'
     F***PMPORTPPIF**E           K        DISK                            S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F            PMPORTP0                          KRENAMEPMPORTP1
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHSEXPP IS 'Q8'
     F***PMHSEXPPIF**E           K        DISK                            S01486
     FPMHSEXPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDZZ IS 'QF'
     F**PMHOLDZZUF**E           K        DISK                      A      S01486
     FPMHOLDPAUF  E           K        DISK                      A        S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDPP IS 'QF'
     F***PMHOLDPPO***E           K        DISK                            S01486
     FPMHOLDPDO   E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDPP IS 'QF'                                      B08040
     F***PMHOLDX0O   E           K        DISK                     B08040 S01486
     FPMHOLDQ0O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08040
     F**  PREFIX OF PMHOLDPP IS 'QF'                                      B08255
     F***PMHOLDX1O   E           K        DISK                     B08255 S01486
     FPMHOLDQ1O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08255
     F**  Prefix of PMPCBCL3 is 'FM'                                      CPM005
     FPMPCBCL3IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     FPM1146AUO   E                    PRINTER
     E*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*           61: INDICATOR FOR CHAIN (LOAMS)                         094712
     F*           62: INDICATOR FOR MATURED LOANS FILE                    094712
     F*           70: INDICATOR FOR CHAIN                                 094712
     F*           71: INDICATOR FOR READ
     F*           72: INDICATOR FOR READ-CHAIN
     F*           73: INDICATOR FOR READE
     F*           75: INDICATOR FOR TESTB
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * ..   ..   63   64   65   66   67   68   69   70 *
     F**      * ..   ..   ..   74   ..   76   77   78   79   80 *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     E*****************************************************************
     E*
     E*                                                                   B08040
     E** TABLES/ARRAYS USED TO AVOID FILE ACCESS OPERATIONS               B08040
     E                    CYCD      200  3                                B08040
     E                    SPRT      200 13 8                              B08040
     E                    NBDP      200  1 0                              B08040
     E                    MDIN      200  1                                B08040
     E                    RKSQ      200  3 0                              B08040
     E                    DSPG      200  3                                B08040
     E                    DSPS      200  2 0                              B08040
     E                    VALG      200  3                                B08040
     E                    VLGS      200  2 0                              B08040
     E                    BRC1       20  3                                B08040
     E                    BICN       20  6                                B08040
     E                    COLC       20  2                                R05669
     E                    LICD       20  3                                R05669
     E*                                                                   B08040
     E                    CPY@    1   1 80
     E*
     E** FORMAT SE DETAILS FOR OUTPUT  (SR/ZFRELN)
     E**********          ZLI        20  1                                                    CGL029
     E                    ZLI        26  1                                                    CGL029
     E*
      /COPY ZSRSRC,ZDATE2Z1
     E*
      /COPY ZSRSRC,ZPOWERZ1
     E*                                                                   S01486
     E/COPY ZSRSRC,ZDATE9Z1                                               S01486
     E*
     I*****************************************************************
      ** Rename NLRA field in CLOANCK to distinuish it from similarly     126017
      ** named field defined in LOAMSZ1                                   126017
      *                                                                   126017
     ICLOANCKF                                                            126017
     I              NLRA                            NLRACK                126017
      *                                                                   126017
      ** Rename NLRA field in MLOAN to distinuish it from similarly       126017
      ** named field defined in LOAMSZ1                                   126017
      *                                                                   126017
     ICLOANCKM                                                            126017
     I              NLRA                            NLRACM                126017
      *                                                                   126017
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     IPMSTAT    E DS
     I                                        1   50WWECD
     I                                        1 256 WWSTAT
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA********UDS                            256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *                                                                   CPM005
      **  DS to write position sequencing                                 CPM005
      *                                                                   CPM005
     I            DS                                                      CPM005
     I                                        1  11 QFPOSQ                CPM005
     I                                        1   3 WWCCY                 CPM005
     I                                        4   80WWMDAT                CPM005
     I*
     I** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
     I** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
     I*                                                                   CPM004
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Midas  Bank details                                          S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Midas  Currencies details                                    S01486
     I*                                                                   S01486
     ISDLOAN    E DSSDLOANPD                                              S01486
     I**  Midas  Loan Types/Sub-types details                          S01486
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I**  Midas  Portfolio Management Customer details                 S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I**  Midas  SD Portfolio Management ICD details                   S01486
     I*                                                                   S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I**  Midas  SD Customer details                                   S01486
     I*                                                                   S01486
     ISDPLIN    E DSSDPLINPD                                              S01486
     I**  Midas  Portfolio Lending Instrument Types details            S01486
     I*                                                                   S01486
     ISDBRCH    E DSSDBRCHPD                                              S01486
     I              QQDFAC                          BRDFAC                                    CGL029
     I**  Midas  SD Branch details                                     S01486
     I*                                                                   S01486
     ISDRETL    E DSSDRETLPD                                              185344
      **  Midas Structure for Retails IC                                  185344
      *                                                                   185344
     I/COPY WNCPYSRC,PM1146I001
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure                                            S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I**  Long data structure                                             S01486
     I*                                                                   S01486
     IDSLDY     E DSDSLDY                                                 CPB001
     I**  Very Long data structure                                        CPB001
     I*                                                                   CPB001
     ISDMMOD    E DSSDMMODPD                                              CPB001
     I**  Module Details Accesses Via Access Program                      CPB001
     I*                                                                   CPB001
     I/COPY ZSRSRC,ZINTDYZ1                                               S01486
     I*                                                                   S01486
     I/COPY ZSRSRC,ZDATE9Z2                                               S01486
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I*                                                                   S01486
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * INIT     - INITIAL PROCESSING                                    *
      * FULX     - FULL EXTRACT                                          *
      * P01      - ACCESS LOAN TYPE/SUB TYPE DETAILS                     *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      * P03      - ACCESS CURRENCY DETAILS                               *
      * P04      - FORMAT & OUTPUT DETAILS TO PORTF. HOLDINGS FILE       *
      * P05      - DETERMINE INTEREST DETAILS                            *
      * P06      - AUDIT PROCESSING                                      *
      * W01      - WRITE TO PORTFOLIO HOLDINGS FILE                      *
      * W02      - WRITE TO PORTFOLIO HOLDINGS AUDIT                     *
      * W03      - WRITE TO PORTF. HOLDINGS UPDATE (LE) AUDIT REPORT     *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE SPOT RATES OF THE TWO CURRENCIES            *
      * ZCCYXR   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE EXCHANGE RATE BETWEEN THE TWO CURRENCIES    *
      * ZFLELN   - FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION   *
      *            FOR LENDING                                           *
      * ZDATE2   - CONVERT A DAY NUMBER TO A DATE FORMAT                 *
      * GLINTC   - CALCULATE INTEREST BETWEEN ANY TWO DAY NUMBERS        *
      * PTFDET   - ACCESS PORTFOLIO DETAILS                              *
      * ZSAVE    - MEMORISE THE SETTINGS AND TO SET OFF INDICATORS       *
      *            90-97 BEFORE EXECUTION OF A Z-SUBROUTINE              *
      * ZRSTOR   - RESTORE INDICATORS 90-97 TO THE SETTINGS THEY HAD     *
      *            BEFORE THE EXECUTION OF SR/ZSAVE                      *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
     C*****************************************************************
      /EJECT
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C*****************************************************************
     C** KEY DEFINITION
     C*****************************************************************
     C*
     C***********KSDLO*****KLIST                                                              CLE042
     C*********************KFLD           LTYP                                                CLE042
     C*********************KFLD           SUTP                                                CLE042
     C****                                                                B08275
     C****       KCHRQ1    KLIST                                          B08275
     C****                 KFLD           POCNUM                          B08275
     C****                 KFLD           POPTFR                          B08275
     C*
     C           KPORQ2    KLIST
     C                     KFLD           PNCNUM
     C                     KFLD           PNPTFR
     C*
     C           KHSEX     KLIST
     C                     KFLD           WWCCYH  3
     C                     KFLD           WWDATE  50
     C*                                                                   B08194
     C           KCLOAN    KLIST                                          B08194
     C**********           KFLD           WWLNRF  60                                   B08194 CLE148
     C                     KFLD           WWLNRF  6                                           CLE148
     C                     KFLD           WWRCDT  1                       B08194
     C*                                                                   S01313
     C           KLOAM     KLIST                                          S01313
     C                     KFLD           LNRF                            S01313
      *                                                                   CPM005
     C           KPORT     KLIST                                          CPM005
     C                     KFLD           WWCNUM                          CPM005
     C                     KFLD           QFPTFR                          CPM005
      *                                                                   CPM005
     C           KPORQ3    KLIST                                          CPM005
     C**********           KFLD           KWCNUM  60                                   CPM005 CSD027
     C                     KFLD           KWCNUM  6                                           CSD027
     C                     KFLD           KWPTFR  4                       CPM005
     C                     KFLD           KWCDAT  50                      CPM005
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** MAIN PROCESSING
     C*****************************************************************
     C*
     C           *ENTRY    PLIST
     C                     PARM           MODE    1
     C                     PARM           WWTVPS  1                       B08040
     C                     PARM           WWMTEX  1                       B08253
     C                     PARM           WWMATI  1                       094712
     C*
     C                     EXSR INIT
     C*                                                                   094712
     C** IF 'MATURED LOANS' PARAMETER IS 'M' SET ON *IND 62 TO USE        094712
     C** PMCLONL4 INSTEAD OF PMCLONL2 AND TO USE MLOAN INSTEAD OF CLOAN   094712
     C           WWMATI    IFEQ 'M'                                       094712
     C                     MOVE '1'       *IN62                           094712
     C                     END                                            094712
     C*
     C** IF MODE PARAMETER IS 'F' (FOR FULL EXTRACT) EXECUTE PROCESS
     C** FULX
     C           MODE      IFEQ 'F'
     C                     EXSR FULX
     C                     END
     C*
     C** EXECUTE PROCESS P06 - AUDIT PROCESSING
     C                     EXSR P06
     C                     SETON                     LR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
      * INIT     - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWECD    - EVENT CONTROL DATE                                    *
      *                                                                  *
      ********************************************************************
     C           INIT      BEGSR                           ** INIT  BSR **
     C*                                                                   S01486
     C**  Define local data area                                          S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C*
     C** PREPARE LDA
     C*                                                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM1146'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C           *LIKE     DEFN A8BRCD    WWBRCA                          CPM004
     C*                                                                   S71062
     C                     Z-ADD0         QFNMDP                          S71062
     C                     MOVE 'U'       QFSPBS                          S71062
     C*                                                                   CPM004
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1******************         S01486
     C***********          READ SDBANKL1                 71               S01486
     C************IN71     IFEQ '1'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD1         DBASE            **DB ERROR 01**S01486
     C***********          MOVEL'SDBANKL1'DBFILE           ***************S01486
     C***********          MOVEL*BLANKS   DBKEY                           S01486
     C*                                                                   S01486
     C**  Access bank details                                             S01486
     C*                                                                   S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            ***************S01486
     C                     MOVE 'SDBANKPD'DBFILE           *DB ERROR 001 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C** TEST DATE FORMAT FOR SR/ZDATE2
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C                     END
     C*                                                                   CPB001
     C**  Access Module Details                                           CPB001
     C*                                                                   CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM *BLANKS   P@RTCD                          CPB001
     C                     PARM '*FIRST'  P@OPTN                          CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
     C*                                                                   CPB001
     C           P@RTCD    IFNE *BLANKS                                   CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD30        DBASE            ***************CPB001
     C                     MOVE 'SDMMODPD'DBFILE           *DB ERROR 030 *CPB001
     C                     MOVEL'*FIRST'  DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C*
     C** DEFINE DATA AREA PMSTAT
     C           *NAMVAR   DEFN           PMSTAT
     C                     IN   PMSTAT
     C                     Z-ADDWWECD     QFDXTR                          S01313
     C*                                                                   B08040
     C***READ*THROUGH*SDCURRL0*SETTING*UP*ARRAY*OF*CURRENCIES      B08040 S01486
     C***********          READ SDCURRL0                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the first Currency record                                  S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C                     PARM           P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD23        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 023 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set up array of currencies                                      S01486
     C*                                                                   S01486
     C                     Z-ADD1         B       30                      B08040
     C************IN72     DOWEQ'0'                                B08040 S01486
     C           P@RTCD    DOWNE'*EOF'                                    S01486
     C                     MOVE A6CYCD    CYCD,B                          B08040
     C                     Z-ADDA6SPRT    SPRT,B                          B08040
     C                     Z-ADDA6NBDP    NBDP,B                          B08040
     C                     MOVE A6MDIN    MDIN,B                          B08040
     C                     Z-ADDA6RKSQ    RKSQ,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ SDCURRL0                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the next record in currencies file                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*NEXT '  P@OPTN                          S01486
     C                     PARM           P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           P@RTCD    ANDNE'*EOF'                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD24        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 024 *S01486
     C                     MOVEL'*NEXT '  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C** READ THROUGH PMDSPGPP SETTING UP ARRAY OF DISPLAY GROUPS         B08040
     C***********          READ PMDSPGPP                 72        B08040 S01486
     C                     READ PMDSPGPD                 72               S01486
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PADSPG    DSPG,B                          B08040
     C                     Z-ADDPADSPS    DSPS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMDSPGPP                 72        B08040 S01486
     C                     READ PMDSPGPD                 72               S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C** READ THROUGH PMVLGHPP SETTING UP ARRAY OF VALUATION GROUPS       B08040
     C***********          READ PMVLGHPP                 72        B08040 S01486
     C                     READ PMVLGHPD                 72               S01486
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PBVALG    VALG,B                          B08040
     C                     Z-ADDPBVLGS    VLGS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMVLGHPP                 72        B08040 S01486
     C                     READ PMVLGHPD                 72               S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C***READ*THROUGH*SDBRCHL1*SETTING*UP*ARRAY*OF*BRANCH*CODES**  B08040 S01486
     C***********          READ SDBRCHL1                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the first Branch record                                    S01486
     C*                                                                   S01486
     C**********           CALL 'AOBRCHR0'                                S01486              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C                     PARM           P@BRCD  3                       S01486
     C           SDBRCH    PARM SDBRCH    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD25        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 025 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set up array of branches                                        S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               B08040
     C************IN72     DOWEQ'0'                                B08040 S01486
     C           P@RTCD    DOWNE'*EOF'                                    S01486
     C                     MOVE A8BRCD    BRC1,B                          B08040
     C                     MOVE A8BICN    BICN,B                          B08040
     C*                                                                   B08040
     C***********A8BICN    CHAINSDCUSTL0             71                   B08040
     C***********                                                         B08040
     C************IN71     IFEQ '1'                        ***************B08040
     C***********          Z-ADD86        DBASE            **DB ERROR 86**B08040
     C***********          MOVEL'SDCUSTL0'DBFILE           ***************B08040
     C***********          MOVELA8BICN    DBKEY                           B08040
     C*                                                                   S01486
     C**  Access Customer details                                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM A8BICN    P@CUST 10                       S01486
     C                     PARM *BLANKS   P@KYST  7                       S01486
     C***********SDCUST    PARM SDCUST    DSFDY                     S01486176443
     C           SDCUST    PARM SDCUST    DSSDY                           176443
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD86        DBASE            ***************S01486
     C                     MOVE 'SDCUSTPD'DBFILE           *DB ERROR 086 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C                     MOVE BBCOLC    COLC,B                          B08040
     C                     MOVE BBLICD    LICD,B                          B08040
     C*                                                                   B08040
     C                     ADD  1         B                               B08040
     C***********          READ SDBRCHL1                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the next branch record                                     S01486
     C*                                                                   S01486
     C**********           CALL 'AOBRCHR0'                                S01486              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*NEXT '  P@OPTN                          S01486
     C                     PARM           P@BRCD  3                       S01486
     C           SDBRCH    PARM SDBRCH    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           P@RTCD    ANDNE'*EOF'                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD26        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 026 *S01486
     C                     MOVEL'*NEXT '  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     END                                            B08040
     C*                                                                   094746
     C** Access PM ICD for defaults                                       094746
     C*                                                                   094746
     C                     CALL 'AOPORTR0'                                094746
     C                     PARM *BLANKS   P@RTCD                          094746
     C                     PARM '*FIRST'  P@OPTN                          094746
     C           SDPORT    PARM SDPORT    DSFDY                           094746
     C*                                                                   094746
     C           P@RTCD    IFNE *BLANKS                                   094746
     C           *LOCK     IN   LDA                                       094746
     C                     Z-ADD50        DBASE            ***************094746
     C                     MOVE 'SDPORTPD'DBFILE           *DB ERROR 050 *094746
     C                     MOVEL'*FIRST'  DBKEY            ***************094746
     C                     OUT  LDA                                       094746
     C                     EXSR *PSSR                                     094746
     C                     ENDIF                                          094746
     C*
     C                     Z-ADD*HIVAL    QFOAMT                          B08040
     C/COPY WNCPYSRC,PM1146C001
     C*
     C           EINIT     ENDSR                           ** END INIT  **
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * P01      - ACCESS LOAN TYPE/SUB TYPE DETAILS                     *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      * P03      - ACCESS CURRENCY DETAILS                               *
      * P04      - FORMAT & OUTPUT DETAILS TO PORTF. HOLDINGS FILE       *
      * PTFDET   - ACCESS PORTFOLIO DETAILS                              *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWLTYP   - LOAN TYPE FROM CLOANP2                                *
      * WWSUTP   - LOAN SUB-TYPE FROM CLOANP2                            *
      * WWCNUM   - CUSTOMER NUMBER FROM CLOANP2                          *
      * WWCCY    - CURRENCY CODE FROM CLOANP2                            *
      * WWNIDT   - NEXT INTEREST PAYMENT DATE FROM CLOANP2               *
      * WWLNRF   - LOAN NUMBER FROM CLOANP2                              *
      * WWPTFR   - PORTFOLIO REFERENCE FROM CLOANP2                      *
      * WWINTR   - INTEREST RATE FROM CLOANP2                            *
      * WWMDAT   - MATURITY DATE FROM CLOANP2                            *
      * WWVDAT   - VALUE DATE FROM CLOANP2                               *
      * WWLONI   - LOAN INDICATOR FROM CLOANP2                           *
      * WWCPAM   - CURRENT PRINCIPAL AMOUNT FROM CLOANP2                 *
      * WWIACD   - INTEREST ACCRUAL CONTROL DATE FROM CLOANP2            *
      * WWICBS   - INTEREST CALCULATION BASIS                            *
      * WWAITC   - ACCRUED INTEREST TO CONTROL DATE FROM CLOANP2         *
      * WWAIMN   - ACCRUED INTEREST MANUAL ADJUSTMENT POSTED             *
      * WWAIAP   - ACCRUED INTEREST ADJUSTMENT POSTED FROM CLOANP2       *
      * WWIPRD   - INTEREST PAID/RECEIVED TO DATE FROM CLOANP2           *
      * WWICTD   - INTEREST CAPITALIZED TO DATE                          *
      * WWIWOD   - WRITTEN OFF INTEREST TO DATE FROM CLOANP2             *
      * WWPDIN   - PAST DUE INTEREST AMOUNT                              *
      *                                                                  *
      ********************************************************************
     C           FULX      BEGSR                           ** FULX  BSR **
     C*
     C***READ*FROM*LF/CLOANP2*(LOANS*BY*LOAN*TYPE/SUB-TYPE)***************094712
     C** READ FROM LF/PMCLONL4 OR PMCLONL2 (LOANS BY LOAN TYPE/SUBTYPE)   094712
     C           *IN62     IFEQ '1'                                       094712
     C                     READ PMCLONL4                 71               094712
     C                     ELSE                                           094712
     C***********          READ CLOANP2                  71               S01486
     C                     READ PMCLONL2                 71               S01486
     C                     ENDIF                                          094712
     C*                                                                   S01486
     C**  Check if main file is empty                                     S01486
     C*                                                                   S01486
     C           *IN71     IFEQ '1'                                       S01486
     C                     MOVE 'Y'       WEMPTY  1                       S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANK    WEMPTY                          S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Process each LF/PMCLONL2 record                                 S01486
     C*                                                                   S01486
     C           *IN71     DOWEQ'0'
     C*
     C** ON CHANGE OF LOAN TYPE OR LOAN SUB-TYPE
     C** ACCESS LOAN TYPE/SUB TYPE DETAILS AS PER P01
     C           WWLTYP    IFNE LTYP
     C           WWSUTP    ORNE SUTP
     C           WWCLAS    ORNE CLAS                                                          CLE042
     C                     EXSR P01
     C                     END
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C**                                                                  CPM004
     C** ON CHANGE OF BRANCH                                              CPM004
     C** ACCESS BRANCH DETAILS AS PER BRANCH                              CPM004
     C**                                                                  CPM004
     C           WWBRCA    IFNE BRCA                                      CPM004
     C                     EXSR BRANCH                                    CPM004
     C                     MOVE BRCA      WWBRCA                          CPM004
     C                     ENDIF                                          CPM004
     C                     MOVE O#BICN    CNUM                            CPM004
     C                     MOVE O#ACOF    WWACOC                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*
     C** ON CHANGE OF CUSTOMER
     C** ACCESS CUSTOMER DETAILS FOR THE CUSTOMER NUMBER ON LF/CLOANP2
     C** AS PER P02
     C           FCPORS    IFNE 'B'                                       CPM004
      *                                                                   CPM004
     C           WWCNUM    IFNE CNUM
     C                     MOVE CNUM      WCNUM   6
     C                     EXSR P02
     C                     END
     C**                                                                  CPM004
     C                     ENDIF                                          CPM004
     C*
     C** ON CHANGE OF CUSTOMER OR PORTFOLIO
     C** OBTAIN PORTFOLIO DETAILS
     C*
     C           WWCNUM    IFNE CNUM
     C           WWPTFR    ORNE PTFR
     C                     MOVE CNUM      PNCNUM
     C                     MOVE PTFR      PNPTFR
     C                     EXSR PTFDET
     C                     END
     C*                                                                   R00631
     C** ACCESS LF/SDCURRL0 - CURRENCIES FOR PORTFOLIO CURRENCY RANK      R00631
     C** USING A KEY OF THE CURRENCY CODE FROM THE PORTFOLIOS FILE        R00631
     C****       PNPTCY    CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD10        DBASE            **DB ERROR 10**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELPNPTCY    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                 Z-ADDA6RKSQ    WWPRNK  30                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PNPTCY    LOKUPCYCD,B                   72               B08040
     C** ERROR                                                            B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD10        DBASE            **DB ERROR 10**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELPNPTCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDA6RKSQ    WWPRNK  30                      B08040
     C                     END                                            B08040
     C*
     C** ON CHANGE OF CURRENCY CODE
     C** ACCESS CURRENCY DETAILS FOR THE CURRENCY ON LF/CLOANP2
     C** AS PER P03
     C           WWCCY     IFNE CCY
     C                     EXSR P03
     C                     END
     C*
     C** SAVE SOME FIELDS FROM FILE CLOANP2
     C                     Z-ADDNIDT      WWNIDT  50
     C**********           Z-ADDLNRF      WWLNRF  60                                          CLE148
     C                     MOVELLNRF      WWLNRF  6                                           CLE148
     C                     MOVELPTFR      WWPTFR  4
     C                     MOVELLTYP      WWLTYP  2
     C                     MOVELSUTP      WWSUTP  2
     C                     MOVELCLAS      WWCLAS  4                                           CLE042
     C**********           Z-ADDCNUM      WWCNUM  60                                          CSD027
     C                     MOVE CNUM      WWCNUM  6                                           CSD027
     C                     MOVELCCY       WWCCY   3
     C                     Z-ADDINTR      WWINTR 117
     C                     Z-ADDMDAT      WWMDAT  50
     C                     Z-ADDVDAT      WWVDAT  50
     C                     MOVELLONI      WWLONI  1
     C                     Z-ADDCPAM      WWCPAM 130
     C                     Z-ADDIACD      WWIACD  50
     C                     Z-ADDICBS      WWICBS  10
     C                     Z-ADDAITC      WWAITC 130
     C                     Z-ADDAIMN      WWAIMN 130
     C                     Z-ADDAIAP      WWAIAP 130
     C                     Z-ADDIPRD      WWIPRD 130
     C                     Z-ADDICTD      WWICTD 130
     C                     Z-ADDIWOD      WWIWOD 130
     C                     Z-ADDPDIN      WWPDIN 130
     C*
     C** FORMAT DETAILS FOR OUTPUT TO THE PORTFOLIO HOLDINGS FILE
     C** AS PER P04
     C                     EXSR P04
     C*
     C***READ*FROM*LF/CLOANP2********                                     094712
     C** READ FROM LF/PMCLONL4 OR PMCLONL2 (LOANS BY LOAN TYPE/SUBTYPE)   094712
     C           *IN62     IFEQ '1'                                       094712
     C                     READ PMCLONL4                 71               094712
     C                     ELSE                                           094712
     C***********          READ CLOANP2                  71               S01486
     C                     READ PMCLONL2                 71               S01486
     C                     ENDIF                                          094712
     C*                                                                   094712
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P01      - ACCESS LOAN TYPE/SUB TYPE DETAILS                     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINNR   - NARRATIVE FROM SDLOANL1                               *
      * WWITDS   - DISPLAY GROUP SEQUENCE FROM CLOANP2                   *
      * WWDSPG   - DISPLAY GROUP FROM SDPLINPD                           *
      * WWVALG   - VALUATION GROUP FROM SDPLINPD                         *
      * WWDSPS   - DISPLAY GROUP SEQUENCE FROM PMDSPGPP                  *
      * WWVLGS   - VALUATION GROUP SEQUENCE FROM CLOANP2                 *
      *                                                                  *
      ********************************************************************
     C           P01       BEGSR                           ** P01   BSR **
     C*
     C** ACCESS LF/SDLOANL1 - SD CUSTOMER LENDING LOAN TYPES/LOAN
     C** SUB-TYPES FOR PM INSTRUMENT TYPE AND LOAN TYPE/SUB-TYPE
     C** NARRATIVE USING LOAN TYPE AND LOAN SUB-TYPE, BOTH FROM
     C** THE LOANS FILE AS KEY
     C***********KSDLO     CHAINSDLOANL1             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD2         DBASE            **DB ERROR 02**S01486
     C***********          MOVEL'SDLOANL1'DBFILE           ***************S01486
     C***********          MOVELLTYP      DBKY4   4                       S01486
     C***********          MOVE SUTP      DBKY4                           S01486
     C*                                                                   S01486
     C                     CALL 'AOLOANR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM LTYP      P@LNTY  2                       S01486
     C                     PARM SUTP      P@LNST  2                       S01486
     C                     PARM CLAS      P@LNCL  4                                           CLE042
     C           SDLOAN    PARM SDLOAN    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD2         DBASE            ***************S01486
     C                     MOVE 'SDLOANPD'DBFILE           *DB ERROR 002 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@LNTY    DBKEY                                               CLE042
     C                     CAT  P@LNST:1  DBKEY                                               CLE042
     C                     CAT  P@LNCL:1  DBKEY                                               CLE042
     C*********************MOVELP@LNTY    DBKY4   4                                    S01486 CLE042
     C*********************MOVE P@LNST    DBKY4                                        S01486 CLE042
     C*********************MOVELDBKY4     DBKEY                                               CLE042
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C*
     C** SAME SOME FIELDS
     C           AYINNR    IFEQ *BLANKS                                   094746
     C                     MOVE FCDINR    AYINNR                          094746
     C                     END                                            094746
     C                     MOVELAYINNR    WWINNR  3
     C                     MOVELAYLVLD    WWLVLD  1                       B07816
     C                     END
     C*
     C** ACCESS PF/SDPLINPD - INSTRUMENT TYPES FOR INSTRUMENT TYPE
     C** SEQUENCE, DISPLAY GROUP AND VALUATION GROUP USING
     C** PM INSTRUMENT TYPE FROM LF/SDLOANL1 AS KEY
     C*                                                                   036437
     C***********AYINNR    IFEQ *BLANKS                            036437 094746
     C***********1         SETLLSDPORTPD                           036437 S01486
     C***********          READ SDPORTPD                 72        036437 S01486
     C*                                                                   S01486
     C***********          CALL 'AOPORTR0'                         S01486 094746
     C***********          PARM *BLANKS   P@RTCD                   S01486 094746
     C***********          PARM '*FIRST'  P@OPTN                   S01486 094746
     C***********SDPORT    PARM SDPORT    DSFDY                    S01486 094746
     C***********                                                  S01486 094746
     C***********P@RTCD    IFNE *BLANKS                            S01486 094746
     C************LOCK     IN   LDA                                S01486 094746
     C***********          Z-ADD15        DBASE            ********S01486 094746
     C***********          MOVE 'SDPORTPD'DBFILE           *DB ERROS01486 094746
     C***********          MOVEL'*FIRST'  DBKEY            ********S01486 094746
     C***********          OUT  LDA                                S01486 094746
     C***********          EXSR *PSSR                              S01486 094746
     C***********          ENDIF                                   S01486 094746
     C*                                                                   S01486
     C***********          MOVE P9DINR    AYINNR                   036437 S01486
     C***********          MOVE FCDINR    AYINNR                   S01486 094746
     C***********          END                                     036437 094746
     C*                                                                   036437
     C***********AYINNR    CHAINSDPLINPD             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***********PDRECI    OREQ '*'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD3         DBASE            **DB ERROR 03**S01486
     C***********          MOVEL'SDPLINPD'DBFILE           ***************S01486
     C***********          MOVELAYINNR    DBKEY                           S01486
     C*                                                                   S01486
     C**  Access Instrument types details                                 S01486
     C*                                                                   S01486
     C                     CALL 'AOPLINR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM AYINNR    P@INNR  3                       S01486
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD3         DBASE            ***************S01486
     C                     MOVE 'SDPLINPD'DBFILE           *DB ERROR 003 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@INNR    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C*
     C** SAVE SOME FIELDS
     C                     Z-ADDPDITDS    WWITDS  20
     C                     Z-ADDPDVLIS    WWVLIS  20
     C                     MOVELPDDSPG    WWDSPG  3
     C                     MOVELPDVALG    WWVALG  3
     C                     END
     C*
     C** ACCESS THE DISPLAY GROUP DETAILS FILE PF/PMDSPGPP USING
     C** THE DISPLAY GROUP FROM PF/SDPLINPD
     C****       PDDSPG    CHAINPMDSPGPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****       PARECI    OREQ '*'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD4         DBASE            **DB ERROR 04**B08040
     C****                 MOVEL'PMDSPGPP'DBFILE           ***************B08040
     C****                 MOVELPDDSPG    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****                 Z-ADDPADSPS    WWDSPS  20                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PDDSPG    LOKUPDSPG,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD4         DBASE            **DB ERROR 04**B08040
     C***********          MOVEL'PMDSPGPP'DBFILE           ********B08040 S01486
     C                     MOVE 'PMDSPGPD'DBFILE                          S01486
     C                     MOVELPDDSPG    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDDSPS,B    PADSPS                          B08040
     C                     Z-ADDPADSPS    WWDSPS  20                      B08040
     C                     END                                            B08040
     C*
     C** ACCESS THE VALUATION GROUP HEADINGS FILE PF/PMVLGHPP
     C** USING THE VALUATION GROUP FROM PF/SDPLINPD
     C****       PDVALG    CHAINPMVLGHPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****       PBRECI    OREQ '*'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD5         DBASE            **DB ERROR 05**B08040
     C****                 MOVEL'PMVLGHPP'DBFILE           ***************B08040
     C****                 MOVELPDVALG    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****                 Z-ADDPBVLGS    WWVLGS  20                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PDVALG    LOKUPVALG,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD5         DBASE            **DB ERROR 05**B08040
     C***********          MOVEL'PMVLGHPP'DBFILE           ********B08040 S01486
     C                     MOVE 'PMVLGHPD'DBFILE                          S01486
     C                     MOVELPDVALG    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDVLGS,B    PBVLGS                          B08040
     C                     Z-ADDPBVLGS    WWVLGS  20                      B08040
     C                     END                                            B08040
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT                                                              CPM004
      ********************************************************************CPM004
      *                                                                   CPM004
      * BRANCH   - RETRIEVE BRANCH'S CUSTOMER DETAILS                     CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLS:                                                 CPM004
      * *PSSR    - DB ERROR SUB-ROUTINE                                   CPM004
      * AOPLCSR1 - PORTFOLIO MANAGEMENT CUSTOMER DETAILS                  CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLED FROM:                                           CPM004
      * FULX     - FULL EXTRACT                                           CPM004
      *                                                                   CPM004
      * ROUTINE USES VARIABLES:                                           CPM004
      *                                                                   CPM004
      ********************************************************************CPM004
     C           BRANCH    BEGSR                                          CPM004
     C**                                                                  CPM004
     C                     MOVE 'B'       I#PORS                          CPM004
     C                     MOVE FCR997    I#R997                          CPM004
     C                     MOVE BRCA      I#BRCA                          CPM004
     C**                                                                  CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CPM004
     C                     PARM '*KEY   ' P@OPTN  7        I:Option       CPM004
     C                     PARM           I@PARM           I:Parameters   CPM004
     C                     PARM *BLANKS   O@PARM           O:Parameters   CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY            O:Format       CPM004
     C*                                                                   CPM004
     C** ERROR                                                            CPM004
     C           P@RTCD    IFNE *BLANK                                    CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD40        DBASE            ***************CPM004
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 40 *CPM004
     C                     MOVELI#BRCA    DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
      *                                                                   CPM004
     C                     ENDSR                                          CPM004
      ********************************************************************CPM004
      /EJECT
      ********************************************************************
      *                                                                  *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAVCD   - ACCOUNT OFFICER CODE FROM LF/SDPLCSL0                 *
      *                                                                  *
      ********************************************************************
     C           P02       BEGSR                           *** P02    ***
     C*
     C** ACCESS CUSTOMER DETAILS FROM LF/SDPLCSL0 USING A KEY OF THE
     C** CUSTOMER NUMBER PASSED TO THIS PROCESS
     C***********WCNUM     CHAINSDPLCSL0             72                   036141
     C***********WCNUM     CHAINSDPLCSL0             76            036141 S01486
     C***********          MOVE '0'       *IN72                    036141 S01486
     C************IN76     IFEQ '1'                                036141 S01486
     C***********WCNUM     CHAINSDCUSTL0             72            036141 S01486
     C***********          END                                     036141 S01486
     C************IN72     IFEQ '1'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD6         DBASE            **DB ERROR 06**S01486
     C***********          MOVEL'SDPLCSL0'DBFILE           ***************S01486
     C***********          MOVELWCNUM     DBKEY                           S01486
     C*                                                                   S01486
     C**  Access Portfolio Management Customer details                    S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM WCNUM     P@CUST                          S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD6         DBASE            ***************S01486
     C                     MOVE 'SDPLCSPD'DBFILE           *DB ERROR 006 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C**  Access Customer details                                         S01486
     C*                                                                   S01486
     C**********           CALL 'AOCUSTR0'                         S01486 CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C**********           PARM QBCUST    P@CUST                   S01486 CPB001
     C                     PARM WCNUM     P@CUST                          CPB001
     C                     PARM *BLANKS   P@KYST                          S01486
     C********** SDCUST    PARM SDCUST    DSSDY                    S01486 CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD29        DBASE            ***************S01486
     C                     MOVE 'SDCUSTPD'DBFILE           *DB ERROR 029 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C*
     C** SAVE SOME FIELDS
     C                     MOVELBBACOC    WWACOC  2
     C                     END
     C*                                                                   CPB001
     C** Default Base Currency if Private banking Module is active        CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C**********           Z-ADDCNUM      PNCNUM                                       CPB001 CSD027
     C                     MOVE CNUM      PNCNUM                                              CSD027
     C                     MOVE PTFR      PNPTFR                          CPB001
     C           KPORQ2    CHAINPMPORTPD             72                   CPB001
     C*                                                                   CPB001
     C           *IN72     IFEQ *ON                                       CPB001
     C           PNRECI    OREQ '*'                                       CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD31        DBASE            **DB ERROR 31**CPB001
     C                     MOVE 'PMPORTPD'DBFILE                          CPB001
     C                     MOVELCNUM      DBKEY     P                     CPB001
     C                     MOVE PTFR      DBKEY                           CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C                     MOVELPNPTCY    QBCSBY                          CPB001
     C                     Z-ADDPNPCDP    QBBYDP                          CPB001
     C                     ENDIF                                          CPB001
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P03      - ACCESS CURRENCY DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWC9NL   - SPOT RATE FROM SDCURRL0                               *
      * WWA8SL   - MULT/DIV. INDICATOR FROM SDCURRL0                     *
      * WWDANL   - NUMBER OF DECIMAL PLACES FROM SDCURRL0                *
      *                                                                  *
      ********************************************************************
     C           P03       BEGSR                           *** P03    ***
     C*
     C** ACCESS LF/SDCURRL0 - CURRENCIES FOR CURRENCY DECIMAL PLACES
     C** AND LOAN CURRENCY RANK                                           R00631
     C** USING A KEY OF THE CURRENCY CODE FROM THE LOANS FILE
     C****       CCY       CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD7         DBASE            **DB ERROR 07**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELCCY       DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                 Z-ADDA6SPRT    WWC9NL 138                      B08040
     C****                 MOVELA6MDIN    WWA8SL  1                       B08040
     C****                 Z-ADDA6NBDP    WWDANL  10                      B08040
     C****                 Z-ADDA6RKSQ    WWLRNK  30                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           CCY       LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD7         DBASE            **DB ERROR 07**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELCCY       DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDRKSQ,B    A6RKSQ                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     Z-ADDA6SPRT    WWC9NL 138                      B08040
     C                     MOVELA6MDIN    WWA8SL  1                       B08040
     C                     Z-ADDA6NBDP    WWDANL  10                      B08040
     C                     Z-ADDA6RKSQ    WWLRNK  30                      B08040
     C                     END                                            B08040
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P04      - FORMAT & OUTPUT DETAILS TO PORTF. HOLDINGS FILE       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZFLELN   - FORMAT THE 20A PORTFOLIO MANAGEMENT LINE              *
      * P05      - DETERMINE INTEREST DETAILS                            *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE SPOT RATES OF THE TWO CURRENCIES            *
      * ZCCYXR   - CONVERT AN AMOUNT FROM ONE CCY TO ANOTHER CCY         *
      *            USING THE EXCHANGE RATE BETWEEN THE TWO CURRENCIES    *
      * W01      - WRITE TO PORTFOLIO HOLDINGS FILE                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCCY    - CURRENCY CODE FROM CLOANP2                            *
      * WWINTR   - INTEREST RATE FROM CLOANP2                            *
      * WWMDAT   - MATURITY DATE FROM CLOANP2                            *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS                            *
      * WWPTFR   - PORTFOLIO REFERENCE FROM CLOANP2                      *
      *                                                                  *
      ********************************************************************
     C           P04       BEGSR                           *** P04    ***
     C*
     C** MOVE THE LOAN TYPE DESCRIPTION FROM LF/SDLOANL1 INTO THE MIDAS
     C** INSTRUMENT NAME
     C                     MOVELAYLNTD    WWTXT1 20
     C*
     C** DETERMINE THE INSTRUMENT ENQUIRY DETAILS NARRATIVE USING THE
     C** STANDARD SUBROUTINE ZFLELN WITH THE FOLLOWING INPUT PARM.:
     C** ZCCY : CURRENCY CODE
     C** ZINRT: INTEREST RATE
     C** ZMDAT: MATURITY DATE ,ALL FROM THE LOANS FILE
     C                     MOVELWWCCY     ZCCY
     C                     Z-ADDWWINTR    ZINRT
     C                     Z-ADDWWMDAT    ZMDAT
     C                     EXSR ZFLELN
     C**********           MOVELZLIN      WWTXT2 20                                           CGL029
     C                     MOVELZLIN      WWTXT2 26                                           CGL029
     C*
     C** EXECUTE P05 - DETERMINE INTEREST DETAILS
     C                     EXSR P05
     C*
     C** IF LOAN IS STILL ACTIVE,
     C** CALCULATE FX PROFIT AND LOSS
     C*
     C                     Z-ADD0         WWBFXR
     C                     Z-ADD0         WWMFXR
     C                     Z-ADD0         WWPLFX
     C*
     C           RECI      IFEQ 'D'
     C****       VDAT      ANDGTWWECD                               46081 47617
     C****       VDAT      ANDLTWWECD                               47617 059111
     C           VDAT      ANDLEWWECD                                     059111
     C                     Z-ADD1         WWFLAG  10
      *                                                                   CPM005
      **  Retrieve the spot rate on PF/PMHSEXPD with the change date      CPM005
      **  instead of deal date if a change occured in the past            CPM005
      *                                                                   CPM005
     C**********           Z-ADDWWCNUM    KWCNUM                                       CPM005 CSD027
     C                     MOVE WWCNUM    KWCNUM                                              CSD027
      *                                                                   CPM005
     C           WWPTFR    IFEQ '9997'                     - B3           CPM005
     C                     MOVE *BLANKS   KWPTFR                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE WWPTFR    KWPTFR                          CPM005
     C                     END                             - E3           CPM005
      *                                                                   CPM005
     C                     Z-ADD*HIVAL    KWCDAT                          CPM005
      *                                                                   CPM005
     C           KPORQ3    SETGTPMPCBCL3                                  CPM005
     C                     READPPMPCBCL3                 76               CPM005
      *                                                                   CPM005
      **  If a record found with same customer no. and same portfolio     CPM005
      *                                                                   CPM005
     C           *IN76     IFEQ '0'                        - B3           CPM005
     C           KWCNUM    IFNE FMCUST                     - B4           CPM005
     C           KWPTFR    ORNE FMPTFR                                    CPM005
     C                     MOVE '1'       *IN76                           CPM005
     C                     END                             - E4           CPM005
     C                     END                             - E3           CPM005
     C*
     C           WWFLAG    DOUEQ3
     C                     MOVE CCY       WWCCYH
     C*
     C           WWFLAG    IFEQ 1
      *                                                                   CPM005
      **  If a change occured in the past, use the change ccy date        CPM005
      *                                                                   CPM005
     C           *IN76     IFEQ '0'                        - B4           CPM005
     C                     MOVE FMCDAT    WWDATE                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE DDAT      WWDATE
     C                     END                             - E4           CPM005
      *                                                                   CPM005
     C                     ELSE
     C                     MOVE WWECD     WWDATE
     C                     END
     C*
     C***********KHSEX     SETGTPMHSEXPP                                  S01486
     C***********          READPPMHSEXPP                 71               S01486
     C           KHSEX     SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 71               S01486
     C*
     C** ERROR
     C*
     C           *IN71     IFEQ '1'
     C           Q8CCY     ORNE CCY
     C                     MOVE *LOVAL    WWDATE
     C***********KHSEX     SETLLPMHSEXPP                                  S01486
     C***********          READ PMHSEXPP                 71               S01486
     C           KHSEX     SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 71               S01486
     C*
     C           *IN71     IFEQ '1'
     C           Q8CCY     ORNE CCY                        ***************
     C                     Z-ADD9         DBASE            **DB ERROR 09**
     C***********          MOVEL'PMHSEXPP'DBFILE           ***************S01486
     C                     MOVE 'PMHSEXPD'DBFILE                          S01486
     C                     MOVELWWCCYH    DBKY8   8
     C                     MOVE WWDATE    DBKY8
     C                     MOVELDBKY8     DBKEY
     C                     EXSR *PSSR
     C                     END
     C*
     C                     END
     C*
     C                     Z-ADDCPAM      ZAMTF
     C                     MOVE CCY       ZCCYF
     C                     Z-ADDQ8SPOT    ZRATEF
     C                     MOVE Q8MDV1    ZMDINF
     C                     Z-ADDQ8CDP     ZCDPF
     C                     MOVE PNPTCY    WWCCYH
     C*
     C           WWFLAG    IFEQ 1
      *                                                                   CPM005
      **  If a change occured in the past, use the change ccy date        CPM005
      *                                                                   CPM005
     C           *IN76     IFEQ '0'                        - B4           CPM005
     C                     MOVE FMCDAT    WWDATE                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE DDAT      WWDATE
     C                     END                             - E4           CPM005
      *                                                                   CPM005
     C                     ELSE
     C                     MOVE WWECD     WWDATE
     C                     END
     C*
     C***********KHSEX     SETGTPMHSEXPP                                  S01486
     C***********          READPPMHSEXPP                 71               S01486
     C           KHSEX     SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 71               S01486
     C*
     C** ERROR
     C*
     C           *IN71     IFEQ '1'
     C           Q8CCY     ORNE PNPTCY
     C                     MOVE *LOVAL    WWDATE
     C***********KHSEX     SETLLPMHSEXPP                                  S01486
     C***********          READ PMHSEXPP                 71               S01486
     C           KHSEX     SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 71               S01486
     C*
     C           *IN71     IFEQ '1'
     C           Q8CCY     ORNE PNPTCY                     ***************
     C                     Z-ADD9         DBASE            **DB ERROR 09**
     C***********          MOVEL'PMHSEXPP'DBFILE           ***************S01486
     C                     MOVE 'PMHSEXPD'DBFILE                          S01486
     C                     MOVELWWCCYH    DBKY8   8
     C                     MOVE WWDATE    DBKY8
     C                     MOVELDBKY8     DBKEY
     C                     EXSR *PSSR
     C                     END
     C*
     C                     END
     C*
     C                     MOVE PNPTCY    ZCCYT
     C                     Z-ADDQ8SPOT    ZRATET
     C                     MOVE Q8MDV1    ZMDINT
     C                     Z-ADDQ8CDP     ZCDPT
     C                     EXSR ZCCYCN
     C*
     C***CONVERT RATE RETURNED FROM SR/ZCCYCN INTO A MULTIPLY RATE********R00631
     C** CONVERT RATE RETURNED FROM SR/ZCCYCN BY TAKING INVERSE OF RATE   R00631
     C           ZCRSMD    IFEQ 'D'
     C           WWLRNK    ANDLTWWPRNK                                    R00631
     C           ZCRSMD    OREQ 'M'                                       R00631
     C           WWLRNK    ANDGTWWPRNK                                    R00631
     C           1         DIV  ZCRSRT    ZCRSRT 138H
     C                     END
     C*
     C           WWFLAG    IFEQ 1
     C                     Z-ADDZAMTT     WWSAV1 150
     C                     Z-ADDZCRSRT    WWBFXR 138
     C                     ELSE
     C                     Z-ADDZAMTT     WWSAV2 150
     C                     Z-ADDZCRSRT    WWMFXR 138
     C                     END
     C*
     C                     ADD  1         WWFLAG
     C                     END
     C*
     C           WWSAV1    SUB  WWSAV2    WWPLFX 150
     C                     END
     C*                                                                   R05669
     C** DETERMINE COUNTRY AND INDUSTRY CODE OF COUNTERPARTY TO LOAN /    R05669
     C** DEPOSIT                                                          R05669
     C***********          MOVE BRCD      WWBRCD  3                R05669 S01486
     C                     MOVE BRCA      WWBRCD  3                       S01486
     C****       WWBRCD    CHAINSDBRCHL1             71                   B08040
     C****                                                                B08040
     C****       *IN71     IFEQ '1'                        ***************B08040
     C****                 Z-ADD85        DBASE            **DB ERROR 85**B08040
     C****                 MOVEL'SDBRCHL1'DBFILE           ***************B08040
     C****                 MOVELBRCD      DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 END                                            B08040
     C****                                                          B08040R05669
     C****       A8BICN    CHAINSDCUSTL0             71             B08040R05669
     C****                                                          B08040R05669
     C****       *IN71     IFEQ '1'                        *********B08040R05669
     C****                 Z-ADD86        DBASE            **DB ERROB08040R05669
     C****                 MOVEL'SDCUSTL0'DBFILE           *********B08040R05669
     C****                 MOVELA8BICN    DBKEY                     B08040R05669
     C****                 EXSR *PSSR                               B08040R05669
     C****                 END                                      B08040R05669
     C****                                                          B08040R05669
     C****                 MOVE BBCOLC    WWCNTR  2                 B08040R05669
     C****                 MOVE BBLICD    WWLIND  3                 B08040R05669
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWBRCD    LOKUPBRC1,B                   71               B08040
     C*                                                                   B08040
     C           *IN71     IFEQ '0'                        ***************B08040
     C                     Z-ADD85        DBASE            **DB ERROR 85**B08040
     C***********          MOVEL'SDBRCHL1'DBFILE           ********B08040 S01486
     C***********          MOVELBRCD      DBKEY                    B08040 S01486
     C                     MOVE 'SDBRCHL1'DBFILE                          S01486
     C                     MOVELBRCA      DBKEY                           S01486
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     MOVE BRC1,B    A8BRCD                          B08040
     C                     MOVE BICN,B    A8BICN                          B08040
     C                     MOVE COLC,B    WWCNTR  2                       B08040
     C                     MOVE LICD,B    WWLIND  3                       B08040
     C                     END                                            B08040
     C*                                                                   082763
     C** Default Local Industry Code & Country of risk                    082763
     C** to ICD values if blank                                           082763
     C*                                                                   082763
     C           WWLIND    IFEQ *BLANKS                                   082763
     C                     MOVE FCLICD    WWLIND                          082763
     C                     END                                            082763
     C           WWCNTR    IFEQ *BLANKS                                   082763
     C                     MOVE FCCNCD    WWCNTR                          082763
     C                     END                                            082763
     C*                                                                   S01313
     C** CHECK WHETHER LOAN AMENDMENTS OUTSTANDING                        S01313
     C           KLOAM     CHAINLOAMS                61                   S01313
     C           *IN61     IFEQ '0'                                       S01313
     C                     MOVE 'Y'       QFDLAM                          S01313
     C                     ELSE                                           S01313
     C                     MOVE 'N'       QFDLAM                          S01313
     C                     END                                            S01313
     C*
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO THAT FROM
     C** PF/CLOANCL (PORTFOLIO RECORDS)
     C                     MOVELWWPTFR    WPTFR   4
     C                     EXSR W01
     C*
     C** IF THE PORTFOLIO REFERENCE FROM PF/CLOANCL IS NOT '9997'
     C*
     C** SET THE BOOK & MARKET FX RATES & P/L FX EQUAL TO ZERO
     C*
     C                     Z-ADD0         WWBFXR
     C                     Z-ADD0         WWMFXR
     C                     Z-ADD0         WWPLFX
     C           WWPTFR    IFNE '9997'
     C*
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO '9998'
     C** (PORTFOLIO CONSOLIDATED)
     C                     MOVEL'9998'    WPTFR
     C                     EXSR W01
     C                     END
     C*
     C** IF PRIVATE BANKING MODULE IS NOT SWITCH *ON                      CPB001
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO '9999'
     C** (CUSTOMER CONSOLIDATED)
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVEL'9999'    WPTFR
     C                     EXSR W01
     C                     ENDIF                                          CPB001
     C*
     C** ADD 1 TO A COUNT OF PORTFOLIO HOLDINGS CREATED
     C****                 ADD  1         PPHCRE                          B08040
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P05      - DETERMINE INTEREST DETAILS                            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * GLINTC   - CALCULATE INTEREST BETWEEN ANY TWO DAY NUMBERS        *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P04      - FORMAT & OUTPUT DETAILS TO PORTF. HOLDINGS FILE       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWLONI   - LOAN INDICATOR FROM CLOANP2                           *
      * WWCPAM   - CURRENT PRINCIPAL AMOUNT FROM CLOANP2                 *
      * WWMDAT   - MATURITY DATE FROM CLOANP2                            *
      * WWECD    - EVENT CONTROL DATE                                    *
      * WWENDD   - END DATE                                              *
      * WWIACD   - INTEREST ACCRUAL CONTROL DATE FROM CLOANP2            *
      * WWICBS   - INTEREST CALCULATION BASIS                            *
      * WWINTR   - INTEREST RATE FROM CLOANP2                            *
      * WWOUIT   - OUTSTANDING INTEREST                                  *
      * WWINTK   - ACCRUED INTEREST                                      *
      * WWPDIN   - PAST DUE INTEREST AMOUNT                              *
      * WWSLID   - START/LAST INTEREST DATE                              *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTEREST                       *
      *                                                                  *
      ********************************************************************
     C           P05       BEGSR                           *** P05    ***
     C*
     C** THE FIELDS FROM PF/CLOANCL USED IN THIS PROCESS ARE AS FOLLOWS:
     C** LONI : LOAN INDICATORS (1A)
     C** CPAM : CURRENT PRINCIPAL AMOUNT (13,0)
     C** IACD : INTEREST ACCRUAL CONTROL DATE (5,0)
     C** MDAT : MATURITY DATE (5,0)
     C** INTR : INTEREST RATE (11,7)
     C** ICBS : INTEREST CALCULATION BASIS (1,0)
     C** AITC : ACCRUED INTEREST TO CONTROL DATE (13,0)
     C** AIMN : ACCRUED INTEREST MANUAL ADJUSTMENTS POSTED (13,0)
     C** AIAP : ACCRUED INTEREST ADJUSTMENT POSTED (13,0)
     C** IPRD : INTEREST PAID/RECEIVED TO DATE (13,0)
     C** ICTD : INTEREST CAPITALIZED TO DATE (13,0)
     C** IWOD : WRITTEN OFF INTEREST TO DATE (13,0)
     C** PDIN : PAST DUE INTEREST AMOUNT (13,0)
     C** SLID : START/LAST INTEREST DATE (5,0)
     C*
     C** THE WORK FIELDS USED IN THIS PROCESS ARE AS FOLLOWS:
     C** END DATE (5,0)
     C** ACCRUED INTEREST FROM CONTROL DATE (13,0)
     C*
     C                     Z-ADD0         WWINTK
     C                     Z-ADD0         WWSLID
     C                     Z-ADD0         WWNODA
     C*
     C** INITIALIZE ACCRUED INTEREST FROM CONTROL DATE TO ZERO
     C                     Z-ADD0         ZINTR
     C*
     C** IF THE STOP ACCRUALS INDICATOR IS OFF (IE. BIT '3' OF LOAN
     C** INDICATORS IS OFF)
     C** AND THE CURRENT PRINCIPAL AMOUNT IS GREATER THAN ZERO
     C** AND THE LOAN VALUE DATE IS LESS THAN OR EQUAL
     C** TO THE EVENT CONTROL DATE
     C** AND THE INTEREST ACCRUAL CONTROL DATE IS LESS THAN THE
     C** MATURITY DATE
     C                     TESTB'3'       WWLONI     75
     C           *IN75     IFEQ '1'
     C           WWCPAM    ANDGT0
     C           WWVDAT    ANDLEWWECD
     C           WWIACD    ANDLTWWMDAT
     C*
     C** IF THE MATURITY DATE IS LESS THAN THE EVENT CONTROL DATE
     C** (AS DETERMINED IN SR/INIT)
     C           WWMDAT    IFLT WWECD
     C*
     C** SET END DATE EQUAL TO THE MATURITY DATE
     C                     Z-ADDWWMDAT    WWENDD  50
     C                     ELSE
     C*
     C** SET END DATE EQUAL TO THE EVENT CONTROL DATE
     C                     Z-ADDWWECD     WWENDD
     C                     END
     C*
     C** CALCULATE ACCRUED INTEREST FROM CONTROL DATE ; USE STANDARD
     C** SR/GLINTC WITH THE FOLLOWING INPUT PARAMETERS:
     C** ZIBEG : INTEREST ACCRUAL CONTROL DATE
     C** ZIEND : END DATE
     C** ZIAMT : CURRENT PRINCIPAL AMOUNT
     C** ZICALC: INTEREST CALCULATION BASIS
     C** ZIRATE: INTEREST RATE
     C                     Z-ADDWWIACD    ZIBEG
      *                                                                   185344
     C                     CALL 'AORETLR0'                                185344
     C                     PARM *BLANKS   P@RTCD  7                       185344
     C                     PARM '*FIRST'  P@OPTN  7                       185344
     C           SDRETL    PARM SDRETL    DSFDY                           185344
      *                                                                   185344
     C           P@RTCD    IFEQ *BLANK                                    185344
     C           BMLDAI    IFEQ 'N'                                       185344
     C           ZIBEG     SUB  1         ZIBEG                           185344
     C                     ENDIF                                          185344
     C                     ENDIF                                          185344
      *                                                                   185344
     C                     Z-ADDWWENDD    ZIEND
     C                     Z-ADDWWCPAM    ZIAMT
     C                     Z-ADDWWICBS    ZICALC
     C                     Z-ADDWWINTR    ZIRATE
     C                     EXSR GLINTC
     C                     END
     C*
     C** CALCULATE OUTSTANDING INTEREST AS EQUAL TO:
     C**   ACCRUED INTEREST TO CONTROL DATE
     C** + ACCRUED INTEREST FROM CONTROL DATE (EITHER ZERO OR ZINTR
     C**   OUTPUT FROM SR/GLINTC)
     C** + MANUAL ADJUSTMENTS POSTED
     C** + ACCRUED INTEREST ADJUSTMENT POSTED
     C** - INTEREST PAID/RECEIVED TO DATE
     C** - INTEREST CAPITALIZED TO DATE
     C** - WRITTEN OFF INTEREST TO DATE
     C                     Z-ADDWWAITC    WWOUIT 130
     C                     ADD  ZINTR     WWOUIT
     C                     ADD  WWAIMN    WWOUIT
     C                     ADD  WWAIAP    WWOUIT
     C                     SUB  WWIPRD    WWOUIT
     C                     SUB  WWICTD    WWOUIT
     C                     SUB  WWIWOD    WWOUIT
     C*
     C** SET ACCRUED INTEREST ON PF/PMHOLDPP EQUAL TO - OUTSTANDING
     C** INTEREST (CALCULATED ABOVE, WITH ITS SIGN REVERSED)
     C           WWOUIT    MULT -1        WWINTK 130
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     Z-SUBWWINTK    WWINTK                          CPM004
     C                     END                                            CPM004
     C*
     C** IF PAST DUE INTEREST AMOUNT IS NOT EQUAL TO ZERO
     C           WWPDIN    IFNE 0
     C*
     C** SET START/LAST INTEREST DATE ON PF/PMHOLDPP EQUAL TO ZERO
     C                     Z-ADD0         WWSLID  50
     C*
     C** SET NUMBER OF DAYS ACCRUED INTEREST ON PF/PMHOLDPP EQUAL
     C** TO ZERO
     C                     Z-ADD0         WWNODA  30
     C                     ELSE
     C*
     C** PAST DUE INTEREST AMOUNT IS ZERO
     C** SET START/LAST INTEREST DATE ON PF/PMHOLDPP EQUAL TO
     C** START/LAST INTEREST DATE FROM PF/CLOANCL
     C                     Z-ADDSLID      WWSLID
     C*
     C** SET NUMBER OF DAYS ACCRUED INTEREST ON PF/PMHOLDPP EQUAL
     C** TO THE END DATE (ABOVE) MINUS THE START/LAST INTEREST DATE
     C           WWENDD    SUB  SLID      WWNODA
     C                     END
     C*
     C                     ENDSR
      **************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P06      - AUDIT PROCESSING                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * W02      - WRITE TO PORTFOLIO HOLDINGS AUDIT                     *
      * W03      - WRITE TO PORTF. HOLDINGS UPDATE (LE) AUDIT REPORT     *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           P06       BEGSR                           *** P06    ***
     C*
     C** ACCESS THE PORTFOLIO HOLDINGS AUDIT PF/PMHOLDZZ
     C***********          READ PMHOLDZZ                 72               S01486
     C                     READ PMHOLDPA                 72               S01486
     C           *IN72     IFEQ '1'
     C*
     C** SET NUMBER OF LIVE RECORDS EQUAL TO A COUNT OF PORTFOLIO
     C** HOLDINGS CREATED
     C                     Z-ADDPPHCRE    QFNORE
     C** WRITE A RECORD TO PF/PMHOLDZZ AS PER W02
     C                     EXSR W02
     C                     ELSE
     C*
     C** ADD COUNT OF PORTFOLIO CREATED TO NUMBER OF LIVE RECORDS
     C** ON PF/PMHOLDZZ
     C                     ADD  PPHCRE    QFNORE
     C** UPDATE PF/PMHOLDZZ AS PER W02
     C                     EXSR W02
     C                     END
     C*
     C** PRODUCE PORTFOLIO HOLDINGS UPDATE (LE) AUDIT REPORT AS PER
     C** W03-WRITE PORTFOLIO HOLDINGS UPDATE (LE) AUDIT REPORT
     C                     EXSR W03
     C*
     C                     ENDSR                           *** EP06   ***
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W01      - WRITE TO PORTFOLIO HOLDINGS FILE                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P04      - FORMAT & OUTPUT DETAILS TO PORTF. HOLDINGS FILE       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAVCD   - ACCOUNT OFFICER CODE FROM LF/SDPLCSL0                 *
      * WWCNUM   - CUSTOMER NUMBER FROM CLOANP2                          *
      * WWECD    - EVENT CONTROL DATE                                    *
      * WWINNR   - NARRATIVE FROM SDLOANL1                               *
      * WWITDS   - DISPLAY GROUP SEQUENCE FROM CLOANP2                   *
      * WWDSPG   - DISPLAY GROUP FROM SDPLINPD                           *
      * WWDSPS   - DISPLAY GROUP SEQUENCE FROM PMDSPGPP                  *
      * WWVALG   - VALUATION GROUP FROM SDPLINPD                         *
      * WWVLGS   - VALUATION GROUP SEQUENCE FROM CLOANP2                 *
      * WWLNRF   - LOAN NUMBER FROM CLOANP2                              *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS                            *
      * WWCPAM   - CURRENT PRINCIPAL AMOUNT FROM CLOANP2                 *
      * WWCCY    - CURRENCY CODE FROM CLOANP2                            *
      * WWDANL   - NUMBER OF DECIMAL PLACES FROM SDCURRL0                *
      * WWINTK   - ACCRUED INTEREST                                      *
      * WWNIDT   - NEXT INTEREST PAYMENT DATE FROM CLOANP2               *
      * WWSLID   - START/LAST INTEREST DATE                              *
      * WWNODA   - NUMBER OF DAYS ACCRUED INTEREST                       *
      *                                                                  *
      ********************************************************************
     C           W01       BEGSR                           *** W01    ***
     C*
     C********             MOVEL'D'       QFRECI                          B07816
     C                     MOVELRECI      QFRECI                          B07816
     C*
     C** ACCOUNT OFFICER: FROM LF/SDPLCSL0
     C                     MOVELWWACOC    QFACOC
     C*
     C** CUSTOMER NUMBER: FROM PF/CLOANCL
     C**********           Z-ADDWWCNUM    QFCNUM                                              CSD027
     C                     MOVE WWCNUM    QFCNUM                                              CSD027
     C*
     C** PORTFOLIO REFERENCE: AS DEFINED IN FULX
     C                     MOVELWPTFR     QFPTFR
     C*
     C** TRADE/VALUE DATE INDICATOR
     C** IF THE VALUE DATE OF THE LOAN IS LESS THAN OR EQUAL TO THE
     C** EVENT CONTROL DATE FROM SR/INIT, SET TO 'X'
     C****       WWVDAT    IFLE WWECD                                     46081
     C****                 MOVEL'X'       QFTVDA                          46081
     C****                 ELSE                                           46081
     C****                 MOVEL'T'       QFTVDA                          46081
     C****                 END                                            46081
     C*
     C****       WWVDAT    IFGE WWECD                               46081 47617
     C****                 MOVEL'X'       QFTVDA                    46081 47617
     C****                 ELSE                                     46081 47617
     C****                 MOVEL'V'       QFTVDA                    46081 47617
     C****                 END                                      46081 47617
     C           WWTVPS    IFEQ 'V'                                       47617
     C           WWVDAT    IFGT WWECD                                     47617
     C                     MOVE 'X'       QFTVDA                          47617
     C                     ELSE                                           47617
     C                     MOVE 'V'       QFTVDA                          47617
     C                     END                                            47617
     C                     ELSE                                           47617
     C           WWVDAT    IFGT WWECD                                     47617
     C                     MOVE 'T'       QFTVDA                          47617
     C                     ELSE                                           47617
     C                     MOVE 'X'       QFTVDA                          47617
     C                     END                                            47617
     C                     END                                            47617
     C*
     C** MODULE ID: 'LE'
     C                     MOVEL'LE'      QFMODI
     C*
     C** INSTRUMENT TYPE: FROM LF/SDLOANL1
     C                     MOVELWWINNR    QFINNR
     C*
     C** INSTRUMENT TYPE DISPLAY SEQUENCE: DISPLAY GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWITDS    QFITDS
     C*
     C** INSTRUMENT TYPE VALUATION SEQUENCE: VALUATION GROUP SEQUENCE
     C** FROM PF/SDPLINPD
     C                     Z-ADDWWVLIS    QFVLIS
     C*
     C** DISPLAY GROUP: FROM PF/SDPLINPD
     C                     MOVELWWDSPG    QFDSPG
     C*
     C** DISPLAY GROUP SEQUENCE: FROM PF/PMDSPGPP
     C                     Z-ADDWWDSPS    QFDSPS
     C*
     C** VALUATION GROUP: FROM PF/SDPLINPD
     C                     MOVELWWVALG    QFVALG
     C*
     C** VALUATION GROUP SEQUENCE: FROM PF/PMVLGHPP
     C                     Z-ADDWWVLGS    QFVLGS
     C*
     C** TRANSACTION NUMBER: EQUAL TO LOAN NUMBER FROM PF/CLOANCL
     C**********           Z-ADDWWLNRF    QFTRNB                                              CLE148
     C                     MOVELWWLNRF    QFTRNB                                              CLE148
     C*
     C** SECURITY SHORTNAME: BLANK
     C                     MOVEL*BLANKS   QFTDSS
     C*
     C** DEAL TYPE: BLANK
     C                     MOVEL*BLANKS   QFDTYP
     C*
     C** MIDAS INSTRUMENT NAME: SEE PROCESS P04
     C                     MOVELWWTXT1    QFTXT1
     C*
     C** INSTRUMENT ENQUIRY DETAILS: SEE PROCESS P04
     C                     MOVELWWTXT2    QFTXT2
     C*
     C** LINE 1 AMOUNT: CURRENT PRINCIPAL AMOUNT FROM PF/CLOANCL
     C                     Z-ADDWWCPAM    QFAMT1
     C*
     C** LINE 2 AMOUNT: ZERO
     C                     Z-ADD0         QFAMT2
     C*
     C** CURRENCY 1: CURRENCY FROM LF/CLOANCL
     C                     MOVELWWCCY     QFCCY1
     C*
     C** CURRENCY 2: BLANK
     C                     MOVEL*BLANKS   QFCCY2
     C*
     C** CURRENCY DEC. PLACES 1: CUR. DEC. PLACES FROM LF/SDCURRL0
     C                     Z-ADDWWDANL    QFCDP1
     C*
     C** CURRENCY DEC. PLACES 2: ZERO
     C                     Z-ADD0         QFCDP2
     C*
     C** MARKET PRICE: ZERO
     C                     Z-ADD0         QFMPRC
     C*
     C** BOOK PRICE: ZERO
     C                     Z-ADD0         QFBOPR
     C*
     C** BOOK FX RATE: ZERO
     C                     Z-ADD0         QFBFXR
     C*
     C** MARKET VALUE: - CURRENT PRINCIPAL AMOUNT (IE. SIGN REVERSED)
     C***********PTYP      IFEQ 70                                        B07816
     C***********          Z-ADD0         QFMVAL                          B07816
     C***********          ELSE                                           B07816
     C           WWCPAM    MULT -1        QFMVAL
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     Z-SUBQFMVAL    QFMVAL                          CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C***********          END                                            B07816
     C           WWTVPS    IFEQ 'V'                                       46081
     C           QFTVDA    ANDEQ'X'                                       46081
     C           QFTVDA    OREQ 'T'                                       47617
     C                     Z-ADD0         QFMVAL                          46081
     C                     END                                            46081
     C*
     C** PURCHASED INTEREST: ZERO
     C                     Z-ADD0         QFPUIT
     C*
     C** ACCRUED INTEREST: SEE PROCESS P05
     C***********PTYP      IFEQ 70                                        B07816
     C***********          Z-ADD0         QFACIS                          B07816
     C***********          ELSE                                           B07816
     C                     Z-ADDWWINTK    QFACIS
     C***********          END                                            B07816
     C*
     C** NEXT INTEREST DATE: FROM PF/CLOANCL
     C                     Z-ADDWWNIDT    QFNIDT
     C*
     C** START/LAST INTEREST DATE: SEE PROCESS P05
     C                     Z-ADDWWSLID    QFSLID
     C*
     C** NUMBER OF DAYS ACCRUED INTEREST: SEE PROCESS P05
     C                     Z-ADDWWNODA    QFNODA
     C*
     C** PROFIT/LOSS MARKET: ZERO
     C                     Z-ADD0         QFPLMK
     C*
     C** PROFIT/LOSS FX
     C***********PTYP      IFEQ 70                                        B07816
     C***********          Z-ADD0         QFPLFX                          B07816
     C***********          ELSE                                           B07816
     C                     Z-ADDWWPLFX    QFPLFX
     C***********          END                                            B07816
     C*
     C** BOOK FX RATE
     C*****      PTYP      IFEQ 70                                        B07816
     C*****                Z-ADD0         QFBFXR                          B07816
     C*****                ELSE                                           B07816
     C                     Z-ADDWWBFXR    QFBFXR
     C******               END                                            B07816
     C*
     C** MARKET FX RATE
     C******     PTYP      IFEQ 70                                        B07816
     C******               Z-ADD0         QFMFXR                          B07816
     C******               ELSE                                           B07816
     C                     Z-ADDWWMFXR    QFMFXR
     C******               END                                            B07816
     C*
     C** BOOK YIELD: ZERO
     C                     Z-ADD0         QFBKYD
     C*
     C** MARKET YIELD: ZERO
     C                     Z-ADD0         QFMKYD
     C*
     C***DIRECT YIELD: ZERO                                               R05669
     C*********            Z-ADD0         QFDRYD                          R05669
     C*********                                                           R05669
     C***COUNTRY OF RISK: BLANK                                           R05669
     C*********            MOVEL*BLANK    QFCNTR                          R05669
     C*********                                                           R05669
     C***INDUSTRY: ZERO                                                   R05669
     C*********            Z-ADD0         QFLIND                          R05669
     C                     MOVE WWCNTR    QFCNTR                          R05669
     C**********           MOVE WWLIND    QFLIND                                     R05669 BUG23967
     C                     MOVE WWLIND    QFLOIC                                            BUG23967
     C*
     C** SECURITY POSITION PLEDGED: 'N'
     C                     MOVE 'N'       QFSPLD
     C*                                                                   R00631
     C** TRANSACTION OPENED/CLOSED                                        R00631
     C                     MOVE *BLANK    QFOPCL                          R00631
     C*                                                                   R00631
     C** BUY OR SELL FIRST                                                R00631
     C                     MOVE *BLANK    QFBYSF                          R00631
     C*                                                                   R00631
     C** RELATED DEAL NUMBER                                              R00631
     C                     Z-ADD0         QFRLDN                          R00631
     C*                                                                   R05763
     C** IF LOAN HAS MATURED MARKET VALUE AND ACCRUED INTEREST            R05763
     C** MUST BE ZERO                                                     R05763
     C           QFRECI    IFEQ 'M'                                       R05763
     C                     Z-ADD0         QFMVAL                          R05763
     C                     Z-ADD0         QFACIS                          R05763
     C                     Z-ADD0         QFPLMK                          R05763
     C                     Z-ADD0         QFPLFX                          R05763
     C*                                                                   B08194
     C** ACCESS CLOANCK TO OBTAIN ORIGINAL PRINCIPAL AMOUNT FOR ENQUIRY   B08194
     C** (ACCESS MLOAN IF USING MATURED LOANS FILE {*IN62} )              094712
     C*                                                                   094712
     C                     MOVE 'B'       WWRCDT                          B08194
     C*                                                                   094712
     C           *IN62     IFEQ '1'                                       094712
     C           KCLOAN    CHAINMLOAN                72                   094712
     C                     UPDATCLOANCKM                                  094712
     C                     ELSE                                           094712
     C           KCLOAN    CHAINCLOAN                72                   B08194
     C                     UPDATCLOANCKF                                  B08253
     C                     ENDIF                                          094712
     C*                                                                   094712
     C** ERROR                                                            B08194
     C           *IN72     IFEQ '1'                                       B08194
     C                     Z-ADD81        DBASE            **DB ERROR 10**B08194
     C           *IN62     IFEQ '1'                        ***************094712
     C                     MOVE 'MLOAN   'DBFILE                          094712
     C                     ELSE                                           094712
     C***********          MOVEL'CLOAN   'DBFILE           *B08194 S01486 094712
     C                     MOVE 'CLOAN   'DBFILE                          S01486
     C                     ENDIF                                          094712
     C                     MOVELWWLNRF    DBKEY                           B08194
     C                     EXSR *PSSR                                     B08194
     C                     END                                            B08194
     C*                                                                   B08194
     C                     Z-ADDOPAM      QFAMT1                          B08194
     C*                                                                   B08194
     C                     END
     C*                                                                   B07816
     C** IF LOAN IS NOT TO BE VALUED (INDICATOR FROM SDLOANPD) SET        B07816
     C** MARKET VALUE AND PROFIT AND LOSS TO ZERO                         B07816
     C           WWLVLD    IFEQ 'N'                                       B07816
     C                     Z-ADD0         QFMVAL                          B07816
     C                     Z-ADD0         QFACIS                          B07816
     C                     Z-ADD0         QFPLMK                          B07816
     C                     Z-ADD0         QFPLFX                          B07816
     C                     Z-ADD0         QFMFXR                          B07816
     C                     Z-ADD0         QFBFXR                          B07816
     C                     END                                            B07816
     C*                                                                   B08040
     C** OBTAIN FX RATE FROM CURRENCY 1 TO PORTFOLIO CCY FROM ARRAY       B08040
     C                     Z-ADD1         B                               B08040
     C           QFPTFR    IFNE '9997'                                    B08040
     C           QFPTFR    ANDNE'9998'                                    B08040
     C           QFPTFR    ANDNE'9999'                                    B08040
     C           PNPTCY    LOKUPCYCD,B                   72               B08040
     C                     ELSE                                           B08040
     C           QBCSBY    LOKUPCYCD,B                   72               B08040
     C                     END                                            B08040
     C** ERROR                                                            B08040
     C           *IN72     IFEQ '0'                        ***************B08040
     C                     Z-ADD22        DBASE            **DB ERROR 02**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELQBCSBY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    WWSPC1 138                      B08040
     C                     MOVE MDIN,B    WWMDC1  1                       B08040
     C                     Z-ADDNBDP,B    WWDPC1  10                      B08040
     C                     Z-ADDRKSQ,B    WWRKC1  30                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CALCULATE MARKET FX RATE FROM NOMINAL CCY TO PORTFOLIO CURRENCY  B08040
     C                     Z-ADD1         ZAMTF                           B08040
     C                     MOVE QFCCY1    ZCCYF                           B08040
     C                     MOVE CYCD,B    ZCCYT                           B08040
     C                     Z-ADDWWC9NL    ZRATEF                          B08040
     C                     Z-ADDWWSPC1    ZRATET                          B08040
     C                     MOVE WWA8SL    ZMDINF                          B08040
     C                     MOVE WWMDC1    ZMDINT                          B08040
     C                     Z-ADDWWDANL    ZCDPF                           B08040
     C                     Z-ADDWWDPC1    ZCDPT                           B08040
     C                     EXSR ZCCYCN                                    B08040
     C                     Z-ADDZCRSRN    QFMFXD                          057020
     C*                                                                   B08040
     C** CONVERT RATE INTO MULTIPLY RATE                                  B08040
     C           ZCRSMD    IFEQ 'D'                                       B08040
     C           1         DIV  ZCRSRT    WWMFXR 138H                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDZCRSRT    WWMFXR 138                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CONVERT MARKET FX RATE TO FORMAT DEFINED BY RANKING SEQUENCE     B08040
     C           WWRKC1    IFLT WWLRNK                                    B08040
     C           1         DIV  WWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'D'       QFMFMD                          B08040
     C                     ELSE                                        67 B08040
     C                     Z-ADDWWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'M'       QFMFMD                          B08040
     C                     END                                         67 B08040
     C*                                                                   S01313
     C** IF FORWARD TRADE SET 'HOLDING VALUED' TO 'N'                     S01313
     C                     MOVE 'Y'       QFHLDV                          S01313
     C           QFTVDA    IFEQ 'T'                                       S01313
     C           QFTVDA    OREQ 'X'                                       47617
     C           WWTVPS    ANDEQ'V'                                       47617
     C           AYLVLD    OREQ 'N'                                       S01313
     C                     MOVE 'N'       QFHLDV                          S01313
     C                     END                                            S01313
     C*                                                                   S01313
     C** IF RECORD FOR DEFINED PORTFOLIO AND PERFORMANCE START DATE *LE   S01313
     C** DNWD SET 'PERFORMANCE FIGURES REQUIRED' TO 'Y'                   S01313
     C** OTHERWISE SET TO 'N'                                             S01313
     C                     MOVE 'N'       QFPFMR                          S01313
     C           QFPTFR    IFNE '9997'                                    S01313
     C           QFPTFR    ANDNE'9998'                                    S01313
     C           QFPTFR    ANDNE'9999'                                    S01313
     C***********PNPSDT    ANDLEBJDNWD                             S01313 CPM005
     C           PNPSDT    IFLE BJDNWD                                    CPM005
     C           PNPSDT    ANDNE*ZEROS                                    CPM005
     C                     MOVE 'Y'       QFPFMR                          S01313
     C                     END                                            CPM005
      *                                                                   CPM005
      **  If 9997, 9998 or 9999 portfolios, check flags in PF/SDPLCSPD    CPM005
      *                                                                   CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9997'                                    CPM005
     C           QBPFM7    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9998'                                    CPM005
     C           QBPFM8    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9999'                                    CPM005
     C           QBPFM9    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     END                                            S01313
     C*
     C                     MOVE *ZEROS    QFDLSQ                          S01313
     C*
     C** WRITE TRADE/VALUE DATE RECORD TO PF/PMHOLDPP IF REQUIRED         B08040
     C           QFTVDA    IFEQ 'X'                                       B08040
     C           QFTVDA    OREQ WWTVPS                                    B08040
     C*                                                                   R37474
     C** OUTPUT TOTALS INFORMATION                                        R37474
     C           WWMTEX    IFEQ 'L'                                       R37474
     C                     EXSR #HLDX0                                    R37474
     C                     ELSE                                           CPM005
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD                              CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C                     END                                            R37474
     C*                                                                   R37474
     C/COPY WNCPYSRC,PM1146C002
     C                     WRITEPMHOLDP0
     C                     ADD  1         PPHCRE                          B08040
     C/COPY WNCPYSRC,PM1146C003
     C*                                                                   B08253
     C** IF MATURITY RUN, UPDATE EXTRACTED INDICATOR ON FIDEPOPD          B08253
     C           WWMTEX    IFEQ 'M'                                       B08253
     C           QFPTFR    ANDNE'9998'                                    B08253
     C           QFPTFR    ANDNE'9999'                                    B08253
     C*                                                                   094712
     C** IF USING MATURED LOANS FILE {*IN62} ACCESS MLOAN.                094712
     C**   OTHERWISE ACCESS CLOAN                                         094712
     C*                                                                   094712
     C                     MOVE 'A'       WWRCDT                          B08253
     C*                                                                   094712
     C           *IN62     IFEQ '1'                                       094712
     C           KCLOAN    CHAINMLOAN                70                   094712
     C                     ELSE                                           094712
     C           KCLOAN    CHAINCLOAN                70                   B08253
     C                     ENDIF                                          094712
     C*                                                                   B08253
     C** IF RECORD FOUND UPDATE INDICATOR                                 B08253
     C           *IN70     IFEQ '0'                                       B08253
     C                     MOVE 'Y'       HLEX                            B08253
     C*                                                                   094712
     C           *IN62     IFEQ '1'                                       094712
     C                     UPDATCLOANCLM                                  094712
     C                     ELSE                                           094712
     C                     UPDATCLOANCLX                                  B08253
     C                     ENDIF                                          094712
     C*                                                                   B08253
     C** ..... OTHERWISE TERMINATE PROGRAM WITH DATABASE ERROR            B08253
     C                     ELSE                            ***************B08253
     C                     Z-ADD11        DBASE            * DB ERROR 01 *B08253
     C*                                                                   094712
     C           *IN62     IFEQ '1'                        ***************094712
     C                     MOVE 'MCLONCL 'DBFILE                          094712
     C                     ELSE                                           094712
     C                     MOVE 'CLOANCL 'DBFILE           ***************B08253
     C                     ENDIF                                          094712
     C*                                                                   094712
     C                     MOVE WWLNRF    DBKEY                           B08253
     C                     EXSR *PSSR                                     B08253
     C                     END                                            B08253
     C                     END                                            B08253
     C****                                                          R37474B08040
     C****UTPUT TOTALS INFORMATION                                  R37474B08040
     C****       WWMTEX    IFEQ 'L'                                 R37474B08253
     C****                 EXSR #HLDX0                              R37474B08040
     C****                 END                                      R37474B08253
      *
     C                     END                                            B08040
      *
     C                     ENDSR                           *** EW01   ***
      *
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W02      - WRITE TO PORTFOLIO HOLDINGS AUDIT                     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P06      - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           W02       BEGSR                           *** W02    ***
     C                     MOVEL'D'       QFRECI
     C/COPY WNCPYSRC,PM1146C004
     C           *IN72     IFEQ '1'
     C                     WRITEPMHOLDZ0
     C                     ELSE
     C                     UPDATPMHOLDZ0
     C                     END
     C/COPY WNCPYSRC,PM1146C005
     C                     ENDSR                           *** EW02   ***
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W03      - WRITE TO PORTF. HOLDINGS UPDATE (LE) AUDIT REPORT     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P06      - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           W03       BEGSR                           *** W03    ***
     C*                                                                   S01486
     C/COPY WNCPYSRC,PM1146C006
     C                     WRITEPM1146PP
     C/COPY WNCPYSRC,PM1146C007
     C*                                                                   S01486
     C           WEMPTY    IFEQ 'Y'                                       S01486
     C                     WRITENODTLS                                    S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     ENDSR                           *** EW03   ***
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * PTFDET   - ACCESS PORTFOLIO DETAILS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
     C********************************************************************
     C           PTFDET    BEGSR                           ***  PTFDET ***
     C*
     C** IF HOLDING IS IN THE 'UNASSIGNED' PORTFOLIO
     C*
     C           PNPTFR    IFEQ '9997'
     C*
     C** USE THE CUSTOMER DETAILS FROM LF/SDPLCSL0 AS THE 'PORTFOLIO' DETAILS
     C*
     C************IN76     IFEQ '0'                                036141 S01486
     C                     MOVELQBCSBY    PNPTCY
     C                     Z-ADDQBBYDP    PNPCDP
     C***********          END                                     036141 S01486
     C*
     C                     ELSE
     C*
     C** ACCESS THE PORTFOLIO DEFINITION DETAILS FROM PF/PMPORTPP USING A
     C** KEY OF THE CUSTOMER & PORTFOLIO REFERENCE PASSED TO THIS PROCESS
     C*
     C***********KPORQ2    CHAINPMPORTPP             72                   S01486
     C           KPORQ2    CHAINPMPORTPD             72                   S01486
     C*
     C** ERROR
     C*
     C           *IN72     IFEQ '1'                        ***************
     C                     Z-ADD8         DBASE            **DB ERROR 08**
     C***********          MOVEL'PMPORTPP'DBFILE           ***************S01486
     C                     MOVE 'PMPORTPD'DBFILE                          S01486
     C                     MOVELPNCNUM    DBKY10 10
     C                     MOVE PNPTFR    DBKY10
     C                     MOVELDBKY10    DBKEY
     C                     EXSR *PSSR
     C                     END
     C                     END
     C*
     C                     ENDSR
     C********************************************************************B08040
      /EJECT                                                              B08040
      ********************************************************************B08040
      *                                                                  *B08040
      * #HLDX0   - CALCULATE DETAILS TO BE OUTPUT TO PMHOLDX0            *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLS:                                                *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLED FROM:                                          *B08040
      * W01      - WRITE TO PMHOLDPP                                     *B08040
      *                                                                  *B08040
      * ROUTINE USES VARIABLES:                                          *B08040
      *                                                                  *B08040
      ********************************************************************B08040
     C           #HLDX0    BEGSR                           * W03    BSR * B08040
     C*                                                                   B08255
     C****       QFPTFR    IFNE '9998'                              R37474B08255
     C****       QFPTFR    ANDNE'9999'                              R37474B08255
     C****       QBAPBC    OREQ 'N'                                 R37474B08255
     C*                                                                   B08040
     C** SET ALL TOTAL FIELDS TO ZERO                                     B08040
     C                     Z-ADD0         QFPTPA                          B08040
     C                     Z-ADD0         QFPTNA                          B08040
     C                     Z-ADD0         QFPTMV                          B08040
     C                     Z-ADD0         QFPVPA                          B08040
     C                     Z-ADD0         QFPVNA                          B08040
     C                     Z-ADD0         QFPVMV                          B08040
     C                     Z-ADD0         QFPTAI                          B08040
     C                     Z-ADD0         QFPTNI                          B08040
     C                     Z-ADD0         QFMVPC                          R37474
     C                     Z-ADD0         QFAIPC                          R37474
     C*                                                                   B08040
     C           QFTVDA    CABEQ'T'       BLKREC                          B08040
     C****       QFTVDA    CABEQ'X'       BLKREC                    46081 47617
     C*                                                                   47617
     C           QFTVDA    IFEQ 'X'                                       47617
     C           WWTVPS    ANDEQ'V'                                       47617
     C                     GOTO BLKREC                                    47617
     C                     END                                            47617%
     C*                                                                   B08040
     C** DETERMINE PORTFOLIO VALUATION CURRENCY                           B08040
     C           QFPTFR    IFNE '9997'                     B1             B08040
     C           QFPTFR    ANDNE'9998'                                    B08040
     C           QFPTFR    ANDNE'9999'                                    B08040
     C                     MOVE PNPTCY    WWVLCY  3                       B08040
     C                     ELSE                            X1             B08040
     C                     MOVE QBCSBY    WWVLCY                          B08040
     C                     END                             E1             B08040
     C*                                                                   B08040
     C** IF VALUATION CURRENCY DIFFERENT TO CURRENCY 1 SET UP PARAMETER   B08040
     C** TO BE USED IN SR/ZCCYCN                                          B08040
     C           WWVLCY    IFNE QFCCY1                     B1             B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           QFCCY1    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        B2*************B08040
     C                     Z-ADD27        DBASE            * DB ERROR 16 *B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELQFCCY1    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     MOVE QFCCY1    ZCCYF                           B08040
     C                     Z-ADDSPRT,B    ZRATEF                          B08040
     C                     MOVE MDIN,B    ZMDINF                          B08040
     C                     Z-ADDNBDP,B    ZCDPF                           B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWVLCY    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        B2 ************B08040
     C                     Z-ADD28        DBASE            * DB ERROR 16 *B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWVLCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     MOVE WWVLCY    ZCCYT                           B08040
     C                     Z-ADDSPRT,B    ZRATET                          B08040
     C                     MOVE MDIN,B    ZMDINT                          B08040
     C                     Z-ADDNBDP,B    ZCDPT                           B08040
     C*                                                                   B08040
     C** CONVERT MARKET VALUE TO PORTFOLIO CURRENCY                       B08040
     C                     Z-ADDQFMVAL    ZAMTF                           B08040
     C                     EXSR ZCCYCN                                    B08040
     C                     Z-ADDZAMTT     WWMVL1 150                      B08040
     C*                                                                   B08040
     C** CONVERT ACCRUED INTEREST TO PORTFOLIO CURRENCY                   B08040
     C                     Z-ADDQFACIS    ZAMTF                           B08040
     C                     EXSR ZCCYCN                                    B08040
     C                     Z-ADDZAMTT     WWACI1 150                      B08040
     C*                                                                   B08040
     C** ... OTHERWISE USE VALUES WRITTEN TO PMHOLDPP                     B08040
     C                     ELSE                            X1             B08040
     C                     Z-ADDQFMVAL    WWMVL1                          B08040
     C                     Z-ADDQFACIS    WWACI1                          B08040
     C                     END                             E1             B08040
     C*
     C** ADD MARKET VALUE AND ACCRUED INTEREST TO TOTALLING FIELDS
     C           WWTVPS    IFEQ 'T'                        B1
     C                     Z-SUBWWMVL1    QFPTMV                          B08040
     C                     ELSE                            X1             B08040
     C                     Z-SUBWWMVL1    QFPVMV                          B08040
     C                     END                             E1             B08040
     C*                                                                   B08040
     C                     Z-ADDWWACI1    QFPTAI                          B08040
     C                     Z-SUBWWACI1    QFPTNI                          B08040
     C*                                                                   B08040
     C** OUPUT TOTALS INFORMATION                                         B08040
     C           BLKREC    TAG                                            B08040
     C                     MOVE QFCCY1    QFCCY                           B08040
     C*                                                                   R37474
     C** CALCULATE EXTRA FIELDS TO BE OUTPUT TO PMHOLDPP FOR MIDASQ       R37474
     C           QFPTPA    IFNE 0                          B1             R37474
     C           QFPVPA    ORNE 0                                         R37474
     C                     Z-ADDQFPTPA    QFMVPC                          R37474
     C                     ADD  QFPVPA    QFMVPC                          R37474
     C                     MOVE '+'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTNA    IFNE 0                          B1             R37474
     C           QFPVNA    ORNE 0                                         R37474
     C                     Z-SUBQFPTNA    QFMVPC                          R37474
     C                     SUB  QFPVNA    QFMVPC                          R37474
     C                     MOVE '-'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTMV    IFNE 0                          B1             R37474
     C           QFPVMV    ORNE 0                                         R37474
     C                     Z-SUBQFPTMV    QFMVPC                          R37474
     C                     SUB  QFPVMV    QFMVPC                          R37474
     C                     MOVE 'L'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFMVPC    IFEQ 0                          B1             R37474
     C                     MOVE 'N'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C                     Z-ADDQFPTAI    QFAIPC                          R37474
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD PMHOLDQ0 PMHOLDQ1            CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C*                                                                   B08040
     C           QFPTFR    IFNE '9998'                                    R37474
     C           QFPTFR    ANDNE'9999'                                    R37474
     C           QBAPBC    OREQ 'N'                                       R37474
     C*                                                                   B08040
     C/COPY WNCPYSRC,PM1146C008
     C           QBAPBC    IFEQ 'N'                                       B08255
     C                     WRITEPMHOLDD1                                  B08040
     C                     ELSE                                           B08255
     C                     WRITEPMHOLDD0                                  B08040
     C                     END                                            B08255
     C/COPY WNCPYSRC,PM1146C009
     C                     END                                            B08255
     C*                                                                   B08040
     C                     ENDSR                           * W03    ESR * B08040
      **************************************************************************
      /EJECT                                                              CPM005
      *****************************************************************   CPM005
      *                                                               *   CPM005
      * NEWFLD   - New Field in PMHOLDPD PMHOLDQ0 PMHOLDQ1            *   CPM005
      *                                                               *   CPM005
      * Subroutine Calls:                                             *   CPM005
      *                                                               *   CPM005
      * Subroutine Called From:                                       *   CPM005
      * W01      -                                                    *   CPM005
      *                                                               *   CPM005
      * Routine Uses Variables:                                       *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
     C           NEWFLD    BEGSR                                          CPM005
      *                                                                   CPM005
      **  If "Loan to be valued indicator" is equal to 'N'                CPM005
      *                                                                   CPM005
     C           AYLVLD    IFEQ 'N'                        B1             CPM005
     C                     MOVEL'UV'      QFPOST                          CPM005
     C                     MOVEL'UV'      QFPOTY                          CPM005
     C                     MOVEL*BLANKS   QFASLI                          CPM005
     C                     Z-ADD*ZEROS    QFASVL                          CPM005
     C                     Z-ADD*ZEROS    QFLIVL                          CPM005
     C                     ELSE                            X1             CPM005
      *                                                                   CPM005
      **  If value date greater than event control date                   CPM005
      *                                                                   CPM005
     C           WWVDAT    IFGT WWECD                      B2             CPM005
     C                     MOVEL'FO'      QFPOST                          CPM005
     C                     MOVEL'FO'      QFPOTY                          CPM005
     C                     ELSE                            X2             CPM005
     C                     MOVEL'C '      QFPOST                          CPM005
     C                     MOVEL'C '      QFPOTY                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     Z-ADD*ZEROS    QFASVL                          CPM005
      *                                                                   CPM005
     C                     MOVEL'L'       QFASLI                          CPM005
      *                                                                   CPM005
     C           QFPOST    IFNE 'FO'                       B2             CPM005
     C                     Z-SUBWWMVL1    WWMVL1                          CPM005
     C           WWMVL1    SUB  WWACI1    QFLIVL                          CPM005
     C                     ELSE                            X2             CPM005
     C                     Z-ADD*ZEROS    QFLIVL                          CPM005
     C                     END                             E2             CPM005
     C                     END                             E1             CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
     C********************************************************************CPM005
      /EJECT
     C********************************************************************
     C*
     C*  ZFLELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR LENDING
     C*
     C*  FORMAT: XXX 999.9999 DDMMMYY
     C*          XXX =  LOAN CURRENCY
     C*          999.9999 = INTEREST RATE
     C*          DDMMMYY = MATURITY DATE
     C*
     C*  INPUT  FIELDS
     C*       ZCCY    3A     LOAN CURRENCY
     C*       ZINRT  117     INTEREST RATE
     C*       ZMDAT   50     MATURITY DATE
     C*
     C*  OUTPUT  FIELDS
     C*       ZLIN   20A     LINE DESCRIPTION
     C*
     C*  ARRAY USED
     C*       ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFLELN    BEGSR
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C**   BUILD FORMAT
     C*
     C** MOVE LOAN CURRENCY TO LINE DESCRIPTION
     C                     MOVEAZCCY      ZLI,01
     C*
     C** MOVE INTEREST RATE TO LINE DESCRIPTION
     C                     Z-ADDZINRT     ZWRKN   74
     C                     MOVELZWRKN     ZWRKA3  3
     C                     MOVELZWRKA3    ZWRKA2  2
     C*
     C** SUPRESS LEADING ZEROES
     C           ZWRKA2    IFEQ '00'
     C                     MOVEL'  '      ZWRKA3
     C                     END
     C*
     C                     MOVELZWRKA3    ZWRKA1  1
     C           ZWRKA1    IFEQ '0'
     C                     MOVEL' '       ZWRKA3
     C                     END
     C*
     C** MOVE INTEREST DETAILS INTO OUTPUT ARRAY
     C                     MOVE ZWRKN     ZWRKA4  4
     C                     MOVEAZWRKA3    ZLI,05
     C                     MOVEA'.'       ZLI,08
     C                     MOVEAZWRKA4    ZLI,09
     C*
     C** MOVE MATURITY DATE TO LINE DESCRIPTION
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    ZWRKA1  1
     C*
     C           ZWRKA1    IFEQ ' '
     C                     MOVEL'0'       ZADATE
     C                     END
     C                     MOVEAZADATE    ZLI,14
     C**
     C** SET ALL   FIELDS TO BLANKS OR ZEROS
     C                     MOVE *BLANKS   ZCCY    3
     C                     Z-ADD*ZEROS    ZINRT  117
     C                     Z-ADD*ZEROS    ZMDAT   50
     C**
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN   26                                           CGL029
     C**
     C                     ENDSR
     C*******************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE1Z2
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZCCYCN
      ****/EJECT                                                          47719
      ****/COPY ZSRSRC,ZCCYXR                                             47719
      /EJECT
      /COPY ZSRSRC,GLINTCZ1
      /EJECT
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
      /COPY ZSRSRC,ZRSTORZ1
      /EJECT
      /COPY ZSRSRC,ZSAVEZ1
      /EJECT
     C/COPY ZSRSRC,ZINTDYZ2                                               S01486
     C/EJECT                                                              S01486
     C/COPY ZSRSRC,ZDATE9Z3                                               S01486
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * INIT     - INITIAL PROCESSING                                    *
      * P01      - ACCESS LOAN TYPE/SUB TYPE DETAILS                     *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      * P03      - ACCESS CURRENCY DETAILS                               *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*
     C           WWERRO    IFEQ ' '
     C                     MOVE 'Y'       WWERRO  1
     C*
     C           DBASE     IFNE 0
     C*
     C**  PRINT ERROR MESSAGE:
     C                     WRITEERRORAU
     C                     ELSE
     C                     Z-ADD999       DBASE
     C                     END
     C*
     C                     DUMP
     C                     END
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
     C*
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
