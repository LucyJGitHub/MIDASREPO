     H        1                                                           CPM004
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Portfolio holdings update')                   *
     H**********                                                          CPM004
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM1148 - RE Portfolio Holdings Extract                       *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD055146           Date 04Feb20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CLE148             Date 23Jul12               *
      *                 CRE073             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23967           Date 14May09               *
      *                 CER047             Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 182961             Date 21Apr01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 176443             Date 18Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 09Jul99               *
     F*                 138238             Date 14Dec98               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 02Mar99               *
      *                 CTI002 Exposure Management / TI Interface     *
     F*                 091703             DATE 14OCT96               *
     F*                 CPM005             DATE 02JUL96               *
     F*                 CFF004             DATE 02OCT96               *
     F*                 083014             DATE 24JUN96               *
     F*                 S71062             DATE 14DEC95               *
     F*                 CPM004             DATE 27FEB96               *
     F*                 085862             DATE 15MAR95               *
     F*                 082763             DATE 06FEB95               *
     F*                 S01946             DATE 11AUG94               *
     F*                 049421             DATE 04NOV93               *
     F*                 058889             DATE 11AUG93               *
     F*                 062885             DATE 05NOV93               *
     F*                 057020             DATE 18JUN93               *
     F*                 053541     MF      DATE 16APR93               *
     F*                 050207     MF      DATE 10MAR93               *
     F*                 048022     LJ      DATE 11DEC92               *
     F*                 044313     SL      DATE 09SEP92               *
     F*                 037854     MF      DATE 31MAR92               *
     F*                 047719             DATE 24NOV92               *
     F*                 SA9108             DATE 26AUG92               *
     F*                 S01313             DATE 28APR92               *
     F*                 R37474             DATE 23MAR92               *
     F*                 B08255             DATE 07OCT91               *
     F*                 B08115             DATE 22JUL91               *
     F*                 B08040             DATE 04JUL91               *
     F*                 R05860             DATE 22APR91               *
     F*                 R05669             DATE 13MAR91               *
     F*                 R05624             DATE 07/03/91              *
     F*                 R01172_DW          DATE 21/01/91              *
     F*                 R01115             DATE 28/11/90              *
     F*                 R0753              DATE 18/11/90              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD055146 - Failed MXC004802 seq. 00001 and others            *
      *             Increase Branches to 900.                         *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23967 - Add Local Industry Code Field.                    *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  182961 - Database error occurred due to a blank key field    *
      *           (Instrument Type).  The default Instrument type in  *
      *           PF/SDPORTPD is taken if a blank instrument type is  *
      *           encountered.                                        *
     F*  176443 - Avoid MCH3601 to be sent.                           *
     F*           Pass correct parameter to AOCUSTR0.                 *
      *  CPB001 -  'Private Banking' Module                           *
     F*  138238 - On the day after capitalisation, the capitalised    *
     F*           interest is still shown as accrued interest in PM   *
     F*           enquiry. This is due to fix 048022. This is only    *
     F*           relevent if the interest is booked with a future    *
     F*           value date and therefore not included in the balance*
      *  CGL007 - Account Postings Enquiry (Recompile)                *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  091703 - WHEN THE EXCHANGE RATE IS VERY SMALL (0,00000009),  *
     F*           THE CONVERSION CALCULATION BETWEEN THE 2 CURRENCIES *
     F*           (DEM-ZAL IE.) GIVE 0                                *
     F*           AVOID THE DIVISION BY 0                             *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/2 - CALCULATE & REPORT PERF. FOR ALL CUST.PORT *
     F*           PBFG/5 - INSTRUMENT ASSET/LIABILITY SPLIT           *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
     F*  083014 - SET FLAG 'HLEX' TO 'Y'                              *
     F*  S71062 - OUTPUT ADDITIONAL FIELDS NMDP & SPBS                *
     F*  CPM004 - Bank Portfolios                                     *
     F*  085862 - INCLUDE BRANCH IN ACCOUNT IDENTIFIER                *
     F*  082763 - Valuation Stmt not produced (use ICD defaults for   *
     F*           Local Industry code and country code if blank on    *
     F*           customer)                                           *
     F*  S01946 - Portfolio Management Upgrade to Release 10.         *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  058889 - UPDATE HOLDING EXTRACTED INDICATOR                  *
     F*  062885 - ADD SUBR ZCCYXR EXTERNALLY CALLED                   *
     F*  057020 - OUTPUT DOUBLE PRECISION FX RATE TO FILE             *
     F*  053541 - ACCRUED INTEREST ARE ALWAYS CREDIT AT CAPITALISATION*
     F*           (COMPLETE FIX 48022)                                *
     F*  050207 - USE FIX 37854 FOR ALL SUBROUTINE                    *
     F*  048022 - Accrued interest is 0 if retail account has been    *
     F*           capitalised. Check file GEICS to produce accrued    *
     F*           interest for the portfolio valuation report.        *
     F*  044313 - MARKET RATE WRONG. COMPLETE 41644                   *
     F*  037854 - MARKET PRICE WRONG (DUE TO DIVISIONS).              *
     F*  SA9108 - POOL SECURITIES TRANSACTIONS                        *
     F*  S01313 - CHANGES FOR PORTFOLIO PERFORMANCE                   *
     F*  R37474 - ADD TOTALLING FIELDS TO PF/PMHOLDPP FOR MIDASQ      *
     F*  B08255 - SPEED UP COB BY SPLITTING TOTALLING FILES           *
     F*  B08115 - OUTPUT CLOSED ACCOUNTS TO PMHOLDPP                  *
     F*  B08040 - SUNDRY FIXES TO SPEED UP COB                        *
     F*  R05860 - EXTRACT LEDGER BALANCE FROM PF/ACCNTAB RATHER THAN  *
     F*           MEMOS                                               *
     F*  R05669 - OUTPUT COUNTRY AND INDUSTRY TO PMHOLDPP             *
     F*  R05624 - REMOVE ERROR FIX R011115                            *
     F*  R01172 - ACCRUED INTEREST ON RETAIL ACCOUNT INTERACTIVLY     *
     F*           CALCULATED.                                         *
     F*  R01115 - OUTPUT RECI OF 'F' FOR ACCOUNTS WITH 0 BALANCE      *
     F*  R0753  - OUTPUT ACCOUNT NAME TO ENQUIRY SCREENS              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FSDPORTPDIF  E                    DISK         KINFSR *PSSR          182961
     F*ACCNTP2*IF**E           K        DISK                              058889
     F***ACCNTP2*UF  E           K        DISK                     058889 S01486
     FPMACCNL3UF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F****PREFIX OF PMCHRGQ1 IS 'PO'                                      B08275
     F*MCHRGQ1IF  E           K        DISK                               B08275
     F****        PMCHRGP0                          KRENAMEPMCHRGQF       B08275
     F****                                          KINFSR *PSSR          B08275
     F****PREFIX OF PMPORTQ2 IS 'PN'                                      B08275
     F*MPORTQ2IF  E           K        DISK                               B08275
     F****        PMPORTP0                          KRENAMEPMPORTQF       B08275
     F****                                          KINFSR *PSSR          B08275
     F****PREFIX*OF*SDBANKL1*IS*'BJ'*****************************         S01486
     F***SDBANKL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDCURRL0*IS*'A6'*****************************         S01486
     F***SDCURRL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDPLCSL0*IS*'BB'*****************************         S01486
     F***SDPLCSL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDPLCSL0*IS*'BB'*****************************  R05669 S01486
     F***SDCUSTL0IF**E           K        DISK                     R05669 S01486
     F***********                                   KINFSR *PSSR   R05669 S01486
     F**  PREFIX OF PMPORTPP IS 'PN'
     F***PMPORTPPIF**E           K        DISK                     B08040 S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F            PMPORTP0                          KRENAMEPMPORTP1       B08040
     F                                              KINFSR *PSSR          B08040
     FREACR   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F*EMOS***IF**E*****               DISK                               R05860
     F******************                            KINFSR *PSSR          R05860
     F****PREFIX*OF*SDBRCHPD*IS*'A8'*****************************  R05669 S01486
     F***SDBRCHL1IF**E           K        DISK                     R05669 S01486
     F***********                                   KINFSR *PSSR   R05669 S01486
     F****PREFIX*OF*SDACODL0*IS*'A5'*****************************         S01486
     F***SDACODL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDPLINPD*IS*'PD'*****************************         S01486
     F***SDPLINPDIF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F**  PREFIX OF PMDSPGPP IS 'PA'
     F***PMDSPGPPIF**E           K        DISK                            S01486
     FPMDSPGPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMVLGHPP IS 'PB'
     F***PMVLGHPPIF**E           K        DISK                            S01486
     FPMVLGHPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDZZ IS 'QF'
     F***PMHOLDZZUF**E           K        DISK                      A     S01486
     FPMHOLDPAUF  E           K        DISK                      A        S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDPP IS 'QF'
     F***PMHOLDPPO***E           K        DISK                            S01486
     FPMHOLDPDO   E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMHOLDPP IS 'QF'                                      B08040
     F***PMHOLDX0O***E           K        DISK                     B08040 S01486
     FPMHOLDQ0O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08040
     F**  PREFIX OF PMHOLDPP IS 'QF'                                      B08255
     F***PMHOLDX1O***E           K        DISK                     B08255 S01486
     FPMHOLDQ1O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR          B08255
     F**   GENERATE INTEREST AND CAPITALISATION FILE                      048022
     FGEICS   IF  E           K        DISK                               048022
     F            APOSTHHF                          KIGNORE               048022
     F            APOSTZZF                          KIGNORE               048022
     FPM1148AUO   E                    PRINTER
     E*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      71: INDICATOR FOR READ
     F**      72: INDICATOR FOR READ-CHAIN
     F**      73: INDICATOR FOR READE-CHAIN
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   70 *
     F**      * ..   ..   ..   74   75   76   77   78   79   80 *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     E*****************************************************************
     E*                                                                   B08040
     E** TABLES/ARRAYS USED TO AVOID FILE ACCESS OPERATIONS               B08040
     E                    CYCD      200  3                                B08040
     E                    SPRT      200 13 8                              B08040
     E                    NBDP      200  1 0                              B08040
     E                    MDIN      200  1                                B08040
     E                    RKSQ      200  3 0                              B08040
     E                    DSPG      200  3                                B08040
     E                    DSPS      200  2 0                              B08040
     E                    VALG      200  3                                B08040
     E                    VLGS      200  2 0                              B08040
     E**********          BRC1       20  3                                           B08040 MD055146
     E**********          BICN       20  6                                           B08040 MD055146
     E**********          COLC       20  2                                           R05669 MD055146
     E**********          LICD       20  3                                           R05669 MD055146
      *                                                                                     MD055146
     E                    BRC1      999  3                                                  MD055146
     E                    BICN      999  6                                                  MD055146
     E                    COLC      999  2                                                  MD055146
     E                    LICD      999  3                                                  MD055146
     E*
     E                    CPY@    1   1 80
     E*
     E** FORMAT SE DETAILS FOR OUTPUT  (SR/ZFRELN)
     E**********          ZLI        20  1                                                    CGL029
     E                    ZLI        26  1                                                    CGL029
      /COPY ZSRSRC,ZPOWERZ1
     E*
     I*****************************************************************
     IACCNTABF                                                            B08115
     I              RECI                            ACRECI                B08115
     I*CCNTABT                                                            B08275
     I****          RECI                            ACRECI                B08275
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I** DATA STRUCTURE FOR RE HOLDINGS INSTRUMENT DESCRIPTION 3          048022
     IWWDTSR      DS                                                      048022
     I**********                              1  20 QFTXT2                             048022 CGL029
     I                                        1  26 QFTXT2                                    CGL029
     I                                        1   6 DDNUM                 048022
     I***********                             1  11 DDDTS1          048022085862
     I***********                             8  10 DDCCY           048022085862
     I***********                            12  15 DDACCD          048022085862
     I***********                            16  16 DDDTS2          048022085862
     I***********                            17  18 DDACQU          048022085862
     I***********                            19  20 DDDTS3          048022085862
     I                                        7   9 DDCCY                 085862
     I**********                             10  13 DDACCD                             085862 CGL029
     I**********                             14  15 DDACQU                             085862 CGL029
     I**********                             16  18 DDBRCA                             085862 CGL029
     I                                       10  19 DDACCD                                    CGL029
     I                                       20  21 DDACQU                                    CGL029
     I                                       22  24 DDBRCA                                    CGL029
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA********UDS                            256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*                                                                   S01313
     IPMSTAT    E DS                                                      S01313
     I                                        1   50WWECD                 S01313
     I                                        1 256 WWSTAT                S01313
      *                                                                   CPM005
      **  DS to write position sequencing                                 CPM005
     I            DS                                                      CPM005
     I                                        1  11 QFPOSQ                CPM005
     I                                        1   3 WWCCY                 CPM005
     I I            99999                     4   80WWDEFT                CPM005
     I*                                                                   CPM004
     I** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
     I** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
     I*
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Midas Bank details                                              S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Midas Currencies details                                        S01486
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I**  Midas Portfolio Management Customer details                     S01486
     I*                                                                   S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I**  Midas SD Customer details                                       S01486
     I*                                                                   S01486
     ISDBRCH    E DSSDBRCHPD                                              S01486
     I              QQDFAC                          BRDFAC                                    CGL029
     I**  Midas SD Branch details                                         S01486
     I*                                                                   S01486
     ISDACOD    E DSSDACODPD                                              S01486
     I**  Midas SD Account Codes details                                  S01486
     I*                                                                   S01486
     ISDPLIN    E DSSDPLINPD                                              S01486
     I**  Midas Portfolio Lending Instrument Types details                S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              082763
     I**  Midas SD Portfolio Management ICD details                       082763
     I*                                                                   082763
     I/COPY WNCPYSRC,PM1148I001
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure                                            S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I**  Long data structure                                             S01486
     I*                                                                   S01486
     IDSLDY     E DSDSLDY                                                 CPB001
     I**  Very Long data structure                                        CPB001
     I*                                                                   CPB001
     ISDMMOD    E DSSDMMODPD                                              CPB001
     I**  Module Details Accesses Via Access Program                      CPB001
     I*                                                                   CPB001
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * INIT     - INITIAL PROCESSING                                    *
      * FULX     - FULL EXTRACT                                          *
      * P01      - ACCESS ACCOUNT CODE DETAILS                           *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      * P03      - ACCESS CURRENCY DETAILS                               *
      * P04      - FORMAT & OUTPUT DETAILS TO THE PORTF.HOLDINGS FILE    *
      * P05      - AUDIT PROCESSING                                      *
      * W01      - WRITE TO PORTFOLIO HOLDINGS                           *
      * W02      - WRITE TO PORTFOLIO HOLDINGS AUDIT                     *
      * W03      - WRITE TO PORTFOLIO HOLDINGS UPDATE (RE) AUDIT REP.    *
      * ZFRELN   - FORMAT RE LINE                                        *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      *                                                                  *
      ********************************************************************
     C           *LIKE     DEFN CNUM      WWACNM                          CPM004
     C**************************************************************************
      /EJECT
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C*****************************************************************
     C** KEY DEFINITION
     C*****************************************************************
     C****                                                                B08275
     C****       KCHRQ1    KLIST                                          B08275
     C****                 KFLD           POCNUM                          B08275
     C****                 KFLD           POPTFR                          B08275
     C*
     C           KPORQ2    KLIST
     C                     KFLD           PNCNUM
     C                     KFLD           PNPTFR
     C*
     C           KREA      KLIST
     C***********          KFLD           WWCNUM                          CPM004
     C                     KFLD           WWACNM                          CPM004
     C                     KFLD           WWCCY
     C                     KFLD           WWACOD
     C                     KFLD           WWACSQ
     C                     KFLD           WWBRCA                          085862
     C*                                                               *   048022
     C**   KEY LIST FOR 'GEICS'                                       *   048022
     C           WWKEY3    KLIST                                      *   048022
     C                     KFLD           GGRECI  1                   *   048022
     C                     KFLD           GGBRCA  3                       S01486
     C**********           KFLD           GGCNUM  60                  *                048022 CSD027
     C                     KFLD           GGCNUM  6                   *                       CSD027
     C                     KFLD           GGCCY   3                   *   048022
     C**********           KFLD           GGACOD  40                                   048022 CGL029
     C                     KFLD           GGACOD 100                                          CGL029
     C                     KFLD           GGACSQ  20                  *   048022
      *                                                                   CPM005
     C           KPORT     KLIST                                          CPM005
     C                     KFLD           WWCNUM                          CPM005
     C                     KFLD           QFPTFR                          CPM005
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** MAIN PROCESSING
     C*****************************************************************
     C*
     C           *ENTRY    PLIST
     C                     PARM           MODE    1
     C                     PARM           WWTVPS  1                       B08040
     C                     PARM           WWMFEX  1                       058889
     C*
     C                     EXSR INIT
     C*
     C** IF MODE PARAMETER IS 'F' (FOR FULL EXTRACT) EXECUTE PROCESS
     C** FULX
     C           MODE      IFEQ 'F'
     C                     EXSR FULX
     C                     END
     C*
     C** EXECUTE PROCESS P05 - AUDIT PROCESSING
     C                     EXSR P05
     C                     SETON                     LR
     C*
     C*****************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INIT     - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           INIT      BEGSR                           ** INIT  BSR **
     C*                                                                   S01486
     C**  Define local data area                                          S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C*
     C** PREPARE LDA
     C*                                                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM1148'  DBPGM
     C                     OUT  LDA                                       S01486
     C*                                                                   S71062
     C                     Z-ADD0         QFNMDP                          S71062
     C                     MOVE 'U'       QFSPBS                          S71062
     C*                                                                   S01313
     C** DEFINE DATA AREA PMSTAT                                          S01313
     C           *NAMVAR   DEFN           PMSTAT                          S01313
     C                     IN   PMSTAT                                    S01313
     C                     Z-ADDWWECD     QFDXTR                          S01313
     C*
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1******************         S01486
     C***********          READ SDBANKL1                 71               S01486
     C************IN71     IFEQ '1'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD1         DBASE            **DB ERROR 01**S01486
     C***********          MOVEL'SDBANKL1'DBFILE           ***************S01486
     C***********          MOVEL*BLANKS   DBKEY                           S01486
     C*                                                                   S01486
     C**  Access bank details                                             S01486
     C*                                                                   S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            ***************S01486
     C                     MOVE 'SDBANKPD'DBFILE           *DB ERROR 001 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CPB001
     C**  Access Module Details                                           CPB001
     C*                                                                   CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM *BLANKS   P@RTCD                          CPB001
     C                     PARM '*FIRST'  P@OPTN                          CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
     C*                                                                   CPB001
     C           P@RTCD    IFNE *BLANKS                                   CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD31        DBASE            ***************CPB001
     C                     MOVE 'SDMMODPD'DBFILE           *DB ERROR 031 *CPB001
     C                     MOVEL'*FIRST'  DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   B08040
     C***READ*THROUGH*SDCURRL0*SETTING*UP*ARRAY*OF*CURRENCIES****  B08040 S01486
     C***********          READ SDCURRL0                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the first Currency record                                  S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C                     PARM           P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD23        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 023 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set up array of currencies                                      S01486
     C*                                                                   S01486
     C                     Z-ADD1         B       30                      B08040
     C************IN72     DOWEQ'0'                                B08040 S01486
     C           P@RTCD    DOWNE'*EOF'                                    S01486
     C                     MOVE A6CYCD    CYCD,B                          B08040
     C                     Z-ADDA6SPRT    SPRT,B                          B08040
     C                     Z-ADDA6NBDP    NBDP,B                          B08040
     C                     MOVE A6MDIN    MDIN,B                          B08040
     C                     Z-ADDA6RKSQ    RKSQ,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ SDCURRL0                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the next record in currencies file                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*NEXT '  P@OPTN                          S01486
     C                     PARM           P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           P@RTCD    ANDNE'*EOF'                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD24        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 024 *S01486
     C                     MOVEL'*NEXT '  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C** READ THROUGH PMDSPGPP SETTING UP ARRAY OF DISPLAY GROUPS         B08040
     C***********          READ PMDSPGPP                 72        B08040 S01486
     C                     READ PMDSPGPD                 72               S01486
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PADSPG    DSPG,B                          B08040
     C                     Z-ADDPADSPS    DSPS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMDSPGPP                 72        B08040 S01486
     C                     READ PMDSPGPD                 72               S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C** READ THROUGH PMVLGHPP SETTING UP ARRAY OF VALUATION GROUPS       B08040
     C***********          READ PMVLGHPP                 72        B08040 S01486
     C                     READ PMVLGHPD                 72               S01486
     C                     Z-ADD1         B                               B08040
     C           *IN72     DOWEQ'0'                                       B08040
     C                     MOVE PBVALG    VALG,B                          B08040
     C                     Z-ADDPBVLGS    VLGS,B                          B08040
     C                     ADD  1         B                               B08040
     C***********          READ PMVLGHPP                 72        B08040 S01486
     C                     READ PMVLGHPD                 72               S01486
     C                     END                                            B08040
     C*                                                                   B08040
     C***READ*THROUGH*SDBRCHL1*SETTING*UP*ARRAY*OF*BRANCH CODES**  B08040 S01486
     C***********          READ SDBRCHL1                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the first Branch record                                    S01486
     C*                                                                   S01486
     C**********           CALL 'AOBRCHR0'                                S01486              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C                     PARM           P@BRCD  3                       S01486
     C           SDBRCH    PARM SDBRCH    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD25        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 025 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set up array of branches                                        S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               B08040
     C************IN72     DOWEQ'0'                                B08040 S01486
     C           P@RTCD    DOWNE'*EOF'                                    S01486
     C                     MOVE A8BRCD    BRC1,B                          B08040
     C                     MOVE A8BICN    BICN,B                          B08040
     C*                                                                   B08040
     C***********A8BICN    CHAINSDCUSTL0             71            B08040 S01486
     C***********                                                  B08040 S01486
     C************IN71     IFEQ '1'                        ********B08040 S01486
     C***********          Z-ADD86        DBASE            **DB ERRB08040 S01486
     C***********          MOVEL'SDCUSTL0'DBFILE           ********B08040 S01486
     C***********          MOVELA8BICN    DBKEY                    B08040 S01486
     C*                                                                   S01486
     C**  Access Customer details                                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM A8BICN    P@CUST 10                       S01486
     C                     PARM *BLANKS   P@KYST  7                       S01486
     C***********SDCUST    PARM SDCUST    DSFDY                     S01486176443
     C           SDCUST    PARM SDCUST    DSSDY                           176443
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD86        DBASE            ***************S01486
     C                     MOVE 'SDCUSTPD'DBFILE           *DB ERROR 086 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C                     MOVE BBCOLC    COLC,B                          B08040
     C                     MOVE BBLICD    LICD,B                          B08040
     C*                                                                   B08040
     C                     ADD  1         B                               B08040
     C***********          READ SDBRCHL1                 72        B08040 S01486
     C*                                                                   S01486
     C**  Read the next branch record                                     S01486
     C*                                                                   S01486
     C**********           CALL 'AOBRCHR0'                                S01486              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*NEXT '  P@OPTN                          S01486
     C                     PARM           P@BRCD  3                       S01486
     C           SDBRCH    PARM SDBRCH    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           P@RTCD    ANDNE'*EOF'                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD26        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 026 *S01486
     C                     MOVEL'*NEXT '  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     END                                            B08040
     C*                                                                   082763
     C**  Access Portfolio Management ICD                                 082763
     C*                                                                   082763
     C                     CALL 'AOPORTR0'                                082763
     C                     PARM *BLANKS   P@RTCD                          082763
     C                     PARM '*FIRST'  P@OPTN                          082763
     C           SDPORT    PARM SDPORT    DSFDY                           082763
     C*                                                                   082763
     C           P@RTCD    IFNE *BLANKS                                   082763
     C           *LOCK     IN   LDA                                       082763
     C                     Z-ADD30        DBASE            ***************082763
     C                     MOVE 'SDPORTPD'DBFILE           *DB ERROR 021 *082763
     C                     MOVEL'*FIRST'  DBKEY            ***************082763
     C                     OUT  LDA                                       082763
     C                     EXSR *PSSR                                     082763
     C                     END                                            082763
     C/COPY WNCPYSRC,PM1148C001
     C*
     C           EINIT     ENDSR                           ** END INIT  **
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * P01      - ACCESS ACCOUNT CODE DETAILS                           *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      * P03      - ACCESS CURRENCY DETAILS                               *
      * P04      - FORMAT & OUTPUT DETAILS TO THE PORTF.HOLDINGS FILE    *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWACOD   - ACCOUNT CODE FROM ACCNTAB                             *
      * WWCNUM   - CUSTOMER FROM ACCNTAB                                 *
      * WWCCY    - CURRENCY CODE FROM ACCNTAB                            *
      * WWPTFR   - PORTFOLIO REF. FROM ACCNTAB                           *
      * WWACSQ   - ACCOUNT SEQ. FROM ACCNTAB                             *
      * WWRRNM   - RELATIVE RECORD NUMBER FROM ACCNTAB                   *
      *                                                                  *
      ********************************************************************
     C           FULX      BEGSR                           ** FULX  BSR **
     C*
     C** READ FROM LF/ACCNTP2 - RE ACCOUNTS BY ACCOUNT CODE
     C***********          READ ACCNTP2                  71               S01486
     C                     READ PMACCNL3                 71               S01486
     C*                                                                   S01486
     C**  Check if main file is empty                                     S01486
     C*                                                                   S01486
     C           *IN71     IFEQ '1'                                       S01486
     C                     MOVE 'Y'       WEMPTY  1                       S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANK    WEMPTY                          S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Process each LF/PMACCNL3 record                                 S01486
     C*                                                                   S01486
     C           *IN71     DOWEQ'0'
     C*
     C** ON CHANGE OF ACCOUNT CODE
     C** ACCESS ACCOUNT CODE DETAILS AS PER P01
     C           WWACOD    IFNE ACOD
     C                     EXSR P01
     C                     END
     C*                                                                   CPM004
     C** ACCOUNT CUSTOMER                                                 CPM004
     C*                                                                   CPM004
     C                     MOVE CNUM      WWACNM                          CPM004
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C**                                                                  CPM004
     C** ON CHANGE OF BRANCH                                              CPM004
     C** ACCESS BRANCH DETAILS AS PER BRANCH                              CPM004
     C**                                                                  CPM004
     C           WWBRCA    IFNE BRCA                                      CPM004
     C                     EXSR BRANCH                                    CPM004
     C                     MOVE BRCA      WWBRCA                          CPM004
     C                     ENDIF                                          CPM004
     C                     MOVE O#BICN    CNUM                            CPM004
     C                     MOVE O#ACOF    WWACOC                          CPM004
      *                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*
     C** ON CHANGE OF CUSTOMER
     C** ACCESS CUSTOMER DETAILS FOR THE CUSTOMER NUMBER ON LF/ACCNTP2
     C** AS PER P02
     C           FCPORS    IFNE 'B'                                       CPM004
     C*                                                                   CPM004
     C           WWCNUM    IFNE CNUM
     C                     MOVE CNUM      WCNUM   6
     C                     EXSR P02
     C                     END
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   B08040
     C** ON CHANGE OF CUSTOMER OR PORTFOLIO                               B08040
     C** OBTAIN PORTFOLIO DETAILS                                         B08040
     C*                                                                   B08040
     C           WWCNUM    IFNE CNUM                                      B08040
     C           WWPTFR    ORNE PTFR                                      B08040
     C                     MOVE CNUM      PNCNUM                          B08040
     C                     MOVE PTFR      PNPTFR                          B08040
     C                     EXSR PTFDET                                    B08040
     C                     END                                            B08040
     C*
     C** ON CHANGE OF CURRENCY CODE, ACCESS CURRENCY DETAILS FOR THE
     C** CURRENCY ON LF/ACCNTP2 AS PER P03
     C           WWCCY     IFNE CCY
     C                     EXSR P03
     C                     END
     C*
     C** SAVE SOME FIELDS FROM FILE ACCNTP2
     C**********           Z-ADDCNUM      WWCNUM  60                                          CSD027
     C                     MOVE CNUM      WWCNUM  6                                           CSD027
     C                     MOVELPTFR      WWPTFR  4
     C                     MOVELCCY       WWCCY   3
     C**********           Z-ADDACOD      WWACOD  40                                          CGL029
     C                     Z-ADDACOD      WWACOD 100                                          CGL029
     C                     Z-ADDACSQ      WWACSQ  20
     C                     MOVE BRCA      WWBRCA  3                       085862
     C                     Z-ADDRRNM      WWRRNM  50
     C                     MOVELANAM      WWACCN 20                       R0753
     C                     MOVE BRCA      GGBRCA                          S01486
     C*
     C** FORMAT DETAILS FOR OUTPUT TO THE PORTFOLIO HOLDINGS FILE
     C** AS PER P04
     C                     EXSR P04
     C*                                                                   058889
     C** IF EXTRACTING MATURE/FLAT POSITIONS UPDATE HOLDING EXTRACTED     058889
     C** INDICATOR ON ACCNTAB                                             058889
     C***********WWMFEX    IFEQ 'Y'                                058889 CPM004
     C           WWMFEX    IFEQ 'M'                                       CPM004
     C                     MOVE 'Y'       HLEX                            083014
     C                     EXCPTACNUPD                                    058889
     C                     END                                            058889
     C*
     C** READ FROM LF/ACCNTP2
     C***********          READ ACCNTP2                  71               S01486
     C                     READ PMACCNL3                 71               S01486
     C                     END
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P01      - ACCESS ACCOUNT CODE DETAILS                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINNR   - NARRATIVE FROM SDACODL0                               *
      * WWBDTX   - ACCOUNT CODE NAME FROM SDACODL0                       *
      * WWITDS   - INSTRUMENT TYPE DISPLAY SEQ. FROM SDPLINPD            *
      * WWDSPG   - DISPLAY GROUP FROM SDPLINPD                           *
      * WWVALG   - VALUATION GROUP FROM SDPLINPD                         *
      * WWVLIS   - INSTRUMENT TYPE VALUATION SEQ. FROM SDPLINPD          *
      * WWDSPS   - DISPLAY GROUP SEQ. FROM PMDSPGPP                      *
      * WWVLGS   - VALUATION GROUP SEQ. FROM PMVLGHPP                    *
      *                                                                  *
      ********************************************************************
     C           P01       BEGSR                           ** P01   BSR **
     C*
     C** ACCESS LF/SDACODL0 - ACCOUNT CODES FOR PM INSTRUMENT AND
     C** ACCOUNT CODE NAME USING ACCOUNT CODE FROM PF/ACCNTAB AS KEY
     C***********          MOVE ACOD      WACOD   4                       S01486
     C***********WACOD     CHAINSDACODL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD2         DBASE            **DB ERROR 02**S01486
     C***********          MOVEL'SDACODL0'DBFILE           ***************S01486
     C***********          MOVELWACOD     DBKEY                           S01486
     C*                                                                   S01486
     C**  Access Account codes details                                    S01486
     C*                                                                   S01486
     C**********           MOVE ACOD      P@ACCD  4                                    S01486 CGL029
     C                     MOVE ACOD      P@ACCD 10                                           CGL029
     C                     CALL 'AOACODR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C                     PARM           P@ACCD                          S01486
     C           SDACOD    PARM SDACOD    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD2         DBASE            ***************S01486
     C                     MOVE 'SDACODPD'DBFILE           *DB ERROR 002 *S01486
     C                     MOVELP@ACCD    DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
      *                                                                   182961
      ** Instrument type is defaulted from PF/SDPORTPD if a blank         182961
      ** instrument type is found.                                        182961
      ** Indicator 35 was used as the operation's resulting indicator.    182961
      *                                                                   182961
     C           A5INNR    IFEQ *BLANKS                                   182961
     C           1         SETLLSDPORTPD                                  182961
     C                     READ SDPORTPD                 35               182961
     C                     MOVE FCDINR    A5INNR                          182961
     C                     ENDIF                                          182961
     C*
     C** SAME SOME FIELDS
     C                     MOVELA5INNR    WWINNR  3
     C**********           MOVELA5ACCN    WWACCN 25                       R0753
     C                     END
     C*
     C** ACCESS PF/SDPLINPD - INSTRUMENT TYPES FOR INSTRUMENT TYPE
     C** SEQUENCE, DISPLAY GROUP AND VALUATION GROUP USING
     C** PM INSTRUMENT TYPE FROM LF/SDACODL0 AS KEY
     C***********A5INNR    CHAINSDPLINPD             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***********PDRECI    OREQ '*'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD3         DBASE            **DB ERROR 03**S01486
     C***********          MOVEL'SDPLINPD'DBFILE           ***************S01486
     C***********          MOVELA5INNR    DBKEY                           S01486
     C*                                                                   S01486
     C**  Access Instrument types details                                 S01486
     C*                                                                   S01486
     C                     CALL 'AOPLINR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM A5INNR    P@INNR  3                       S01486
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD3         DBASE            ***************S01486
     C                     MOVE 'SDPLINPD'DBFILE           *DB ERROR 003 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@INNR    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C* SAVE SOME FIELDS
     C                     Z-ADDPDITDS    WWITDS  20
     C                     MOVELPDDSPG    WWDSPG  3
     C                     MOVELPDVALG    WWVALG  3
     C                     Z-ADDPDVLIS    WWVLIS  20
     C                     END
     C*
     C** ACCESS THE DISPLAY GROUP DETAILS FILE PF/PMDSPGPP USING
     C** THE DISPLAY GROUP FROM PF/SDPLINPD
     C****       PDDSPG    CHAINPMDSPGPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****       PARECI    OREQ '*'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD4         DBASE            **DB ERROR 04**B08040
     C****                 MOVEL'PMDSPGPP'DBFILE           ***************B08040
     C****                 MOVELPDDSPG    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****                 Z-ADDPADSPS    WWDSPS  20                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PDDSPG    LOKUPDSPG,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD4         DBASE            **DB ERROR 04**B08040
     C***********          MOVEL'PMDSPGPP'DBFILE           ********B08040 S01486
     C                     MOVE 'PMDSPGPD'DBFILE                          S01486
     C                     MOVELPDDSPG    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDDSPS,B    PADSPS                          B08040
     C                     Z-ADDPADSPS    WWDSPS  20                      B08040
     C                     END                                            B08040
     C*
     C** ACCESS THE VALUATION GROUP HEADINGS FILE PF/PMVLGHPP
     C** USING THE VALUATION GROUP FROM PF/SDPLINPD
     C****       PDVALG    CHAINPMVLGHPP             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****       PBRECI    OREQ '*'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD5         DBASE            **DB ERROR 05**B08040
     C****                 MOVEL'PMVLGHPP'DBFILE           ***************B08040
     C****                 MOVELPDVALG    DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                                                                B08040
     C****AVE SOME FIELDS                                                 B08040
     C****                 Z-ADDPBVLGS    WWVLGS  20                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           PDVALG    LOKUPVALG,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD5         DBASE            **DB ERROR 05**B08040
     C***********          MOVEL'PMVLGHPP'DBFILE           ********B08040 S01486
     C                     MOVE 'PMVLGHPD'DBFILE                          S01486
     C                     MOVELPDVALG    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDVLGS,B    PBVLGS                          B08040
     C                     Z-ADDPBVLGS    WWVLGS  20                      B08040
     C                     END                                            B08040
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT                                                              CPM004
      ********************************************************************CPM004
      *                                                                   CPM004
      * BRANCH   - RETRIEVE BRANCH'S CUSTOMER DETAILS                     CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLS:                                                 CPM004
      * *PSSR    - DB ERROR SUB-ROUTINE                                   CPM004
      * AOPLCSR1 - PORTFOLIO MANAGEMENT CUSTOMER DETAILS                  CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLED FROM:                                           CPM004
      * FULX     - FULL EXTRACT                                           CPM004
      *                                                                   CPM004
      * ROUTINE USES VARIABLES:                                           CPM004
      *                                                                   CPM004
      ********************************************************************CPM004
     C           BRANCH    BEGSR                                          CPM004
     C**                                                                  CPM004
     C                     MOVE 'B'       I#PORS                          CPM004
     C                     MOVE FCR997    I#R997                          CPM004
     C                     MOVE BRCA      I#BRCA                          CPM004
     C**                                                                  CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CPM004
     C                     PARM '*KEY   ' P@OPTN  7        I:Option       CPM004
     C                     PARM           I@PARM           I:Parameters   CPM004
     C                     PARM *BLANKS   O@PARM           O:Parameters   CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY            O:Format       CPM004
     C*                                                                   CPM004
     C** ERROR                                                            CPM004
     C           P@RTCD    IFNE *BLANK                                    CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD40        DBASE            ***************CPM004
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 40 *CPM004
     C                     MOVELI#BRCA    DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
      *                                                                   CPM004
     C                     ENDSR                                          CPM004
      ********************************************************************CPM004
      /EJECT
      ********************************************************************
      *                                                                  *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAVCD   - ACCOUNT OFFICER FROM SDPLCSL0                         *
      *                                                                  *
      ********************************************************************
     C           P02       BEGSR                           *** P02    ***
     C*
     C** ACCESS CUSTOMER DETAILS FROM LF/SDPLCSL0 USING A KEY OF THE
     C** CUSTOMER NUMBER PASSED TO THIS PROCESS
     C***********WCNUM     CHAINSDPLCSL0             72                   S01486
     C************IN72     IFEQ '1'                                       S01486
     C***ERROR***************************************************         S01486
     C***********          Z-ADD6         DBASE            **DB ERROR 06**S01486
     C***********          MOVEL'SDPLCSL0'DBFILE           ***************S01486
     C***********          MOVELWCNUM     DBKEY                           S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          ELSE                                           S01486
     C*                                                                   S01486
     C**  Access Portfolio Management Customer details                    S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM WCNUM     P@CUST                          S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD6         DBASE            ***************S01486
     C                     MOVE 'SDPLCSPD'DBFILE           *DB ERROR 006 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C**  Access Customer details                                         S01486
     C*                                                                   S01486
     C**********           CALL 'AOCUSTR0'                         S01486 CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C**********           PARM QBCUST    P@CUST                   S01486 CPB001
     C                     PARM WCNUM     P@CUST                          CPB001
     C                     PARM *BLANKS   P@KYST                          S01486
     C********** SDCUST    PARM SDCUST    DSFDY                    S01486 CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD29        DBASE            ***************S01486
     C                     MOVE 'SDCUSTPD'DBFILE           *DB ERROR 029 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*
     C** SAVE SOME FIELDS
     C                     MOVELBBACOC    WWACOC  2
     C***********          END                                            S01486
     C*                                                                   CPB001
     C** Default Base Currency if Private banking Module is active        CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C**********           Z-ADDCNUM      PNCNUM                                       CPB001 CSD027
     C                     MOVE CNUM      PNCNUM                                              CSD027
     C                     MOVE PTFR      PNPTFR                          CPB001
     C           KPORQ2    CHAINPMPORTPD             72                   CPB001
     C*                                                                   CPB001
     C           *IN72     IFEQ *ON                                       CPB001
     C           PNRECI    OREQ '*'                                       CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD31        DBASE            **DB ERROR 31**CPB001
     C                     MOVE 'PMPORTPD'DBFILE                          CPB001
     C                     MOVELCNUM      DBKEY     P                     CPB001
     C                     MOVE PTFR      DBKEY                           CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C                     MOVELPNPTCY    QBCSBY                          CPB001
     C                     Z-ADDPNPCDP    QBBYDP                          CPB001
     C                     ENDIF                                          CPB001
     C*
     C                     ENDSR
     C********************************************************************B08040
      /EJECT                                                              B08040
      ********************************************************************B08040
      *                                                                  *B08040
      * PTFDET   - ACCESS PORTFOLIO DETAILS                              *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLS:                                                *B08040
      * *PSSR    - ERROR SUBROUTINE                                      *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLED FROM:                                          *B08040
      * FULX     - FULL EXTRACT                                          *B08040
      *                                                                  *B08040
      * ROUTINE USES VARIABLES:                                          *B08040
      *                                                                  *B08040
     C********************************************************************B08040
     C           PTFDET    BEGSR                           ***  PTFDET ***B08040
     C*                                                                   B08040
     C*                                                                   B08040
     C** ACCESS THE PORTFOLIO DEFINITION DETAILS FROM PF/PMPORTPP USING A B08040
     C** KEY OF THE CUSTOMER & PORTFOLIO REFERENCE PASSED TO THIS PROCESS B08040
     C*                                                                   B08040
     C           PNPTFR    IFNE '9997'                                    B08040
     C***********KPORQ2    CHAINPMPORTPP             72            B08040 S01486
     C           KPORQ2    CHAINPMPORTPD             72                   S01486
     C*                                                                   B08040
     C** ERROR                                                            B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '1'                        ***************B08040
     C                     Z-ADD8         DBASE            **DB ERROR 08**B08040
     C***********          MOVEL'PMPORTPP'DBFILE           ********B08040 S01486
     C                     MOVE 'PMPORTPD'DBFILE                          S01486
     C                     MOVELPNCNUM    DBKY10 10                       B08040
     C                     MOVE PNPTFR    DBKY10                          B08040
     C                     MOVELDBKY10    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C                     ENDSR                                          B08040
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P03      - ACCESS CURRENCY DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWDANA   - CURRENCY DEC. PLACES FROM SDCURRL0                    *
      *                                                                  *
      ********************************************************************
     C           P03       BEGSR                           *** P03    ***
     C*
     C** ACCESS LF/SDCURRL0 - CURRENCIES FOR CURRENCY DECIMAL PLACES
     C** LF/SDCURRL0 USING CURRENCY CODE FROM THE ACCOUNTS FILE AS KEY
     C****       CCY       CHAINSDCURRL0             72                   B08040
     C****       *IN72     IFEQ '1'                                       B08040
     C****RROR                                                            B08040
     C****                 Z-ADD7         DBASE            **DB ERROR 07**B08040
     C****                 MOVEL'SDCURRL0'DBFILE           ***************B08040
     C****                 MOVELCCY       DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 ELSE                                           B08040
     C****                 Z-ADDA6NBDP    WWDANA  10                      B08040
     C****                 END                                            B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           CCY       LOKUPCYCD,B                   72               B08040
     C*                                                                   B08040
     C           *IN72     IFEQ '0'                                       B08040
     C                     Z-ADD7         DBASE            **DB ERROR 07**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELCCY       DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     Z-ADDA6NBDP    WWDANA  10                      B08040
     C                     Z-ADDSPRT,B    WWC9NL 138                      B08040
     C                     MOVELMDIN,B    WWA8SL  1                       B08040
     C                     Z-ADDRKSQ,B    WWLRNK  30                      B08040
     C                     END                                            B08040
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P04      - FORMAT & OUTPUT DETAILS TO THE PORTF.HOLDINGS FILE    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZFRELN   - FORMAT RE LINE                                        *
      * *PSSR    - ERROR SUBROUTINE                                      *
      * W01      - WRITE TO PORTFOLIO HOLDINGS                           *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * FULX     - FULL EXTRACT                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCNUM   - CUSTOMER FROM ACCNTAB                                 *
      * WWCCY    - CURRENCY CODE FROM ACCNTAB                            *
      * WWACOD   - ACCOUNT CODE FROM ACCNTAB                             *
      * WWACSQ   - ACCOUNT SEQ. FROM ACCNTAB                             *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS                            *
      * WWACIS   - ACCRUED INTEREST                                      *
      * WWRRNM   - RELATIVE RECORD NUMBER FROM ACCNTAB                   *
      * WWTVDA   - TRADE/VALUE DATE FROM ACCNTAB                         *
      * WWAMT1   - AMOUNT 1 FROM MEMOS                                   *
      * WWMVAL   - MARKET VALUE FROM MEMOS                               *
      * WWPTFR   - PORTFOLIO REF. FROM ACCNTAB                           *
      *                                                                  *
      ********************************************************************
     C           P04       BEGSR                           *** P04    ***
     C*
     C** DETERMINE THE INSTRUMENT ENQUIRY DETAILS NARRATIVE USING THE
     C** STANDARD SUBROUTINE ZFRELN WITH THE FOLLOWING INPUT PARM.:
     C** ZCNUM: CUSTOMER NUMBER
     C** ZCCY : CURRENCY
     C** ZACOD: ACCOUNT CODE
     C** ZACSQ: ACCOUNT SEQUENCE , ALL FROM PF/ACCNTAB
     C***********          Z-ADDWWCNUM    ZCNUM                           CPM004
     C**********           Z-ADDWWACNM    ZCNUM                                        CPM004 CSD027
     C                     MOVE WWACNM    ZCNUM                                               CSD027
     C                     MOVELWWCCY     ZCCY
     C                     MOVELWWACOD    ZACOD
     C                     MOVELWWACSQ    ZACSQ
     C                     MOVELWWBRCA    ZBRCA   3                       085862
     C                     EXSR ZFRELN
     C**********           MOVELZLIN      WWTXT2 20                                           CGL029
     C                     MOVELZLIN      WWTXT2 26                                           CGL029
     C*
     C** ACCESS LF/REACR - RETAIL ACCRUED INTEREST TO DATE FOR DEBIT
     C** AND CREDIT ACCRUED INTEREST USING CUSTOMER NUMBER, CURRENCY,
     C** ACCOUNT CODE AND ACCOUNT SEQUENCE FROM PF/ACCNTAB AS KEY
     C           KREA      CHAINREACR                73
     C           *IN73     IFEQ '1'
     C           RECI      OREQ '*'
     C           RECI      OREQ 'C'                                       B08115
     C*
     C** SET ACCRUED INTEREST ON PF/PMHOLDPP EQUAL TO ZERO
     C                     Z-ADD0         WWACIS 150
     C                     ELSE
     C*
     C** SET ACCRUED INTEREST ON PF/PMHOLDPP EQUAL TO THE SUM OF
     C** DEBIT AND CREDIT ACCRUED INTEREST, BOTH FROM LF/REACR
     C**         DAIC1     ADD  CAIC1     WWACIS                          R01172
     C                     Z-ADDCAIC1     WWACCR 150                      R01172
     C           WWACCR    ADD  MACI      WWACCR                          R01172
     C           WWACCR    ADD  GACI      WWACCR                          R01172
     C                     Z-ADDDAIC1     WWACDR 150                      R01172
     C           WWACDR    ADD  MADI      WWACDR                          R01172
     C           WWACDR    ADD  GADI      WWACDR                          R01172
     C                     Z-ADD0         WWACIS                          R01172
     C           WWACCR    SUB  WWACDR    WWACIS                          R01172
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     Z-SUBWWACIS    WWACIS                          CPM004
     C                     END                                            CPM004
     C                     END
     C****                                                                R05860
     C***ACCESS PF/MEMOS - SHADOW BALANCES FOR LEDGER/CLEARED BALANCE     R05860
     C***USING RELATIVE RECORD NO. OF MEMOS RECORD FROM PF/ACCNTAB        R05860
     C****       WWRRNM    CHAINMEMOS                73                   R05860
     C****       *IN73     IFEQ '1'                                       R05860
     C****       RECI      OREQ '*'                                       R05860
     C***ERROR                                                            R05860
     C****                 Z-ADD8         DBASE            **DB ERROR 08**R05860
     C****                 MOVEL'MEMOS'   DBFILE           ***************R05860
     C****                 MOVELWWRRNM    DBKEY                           R05860
     C****                 EXSR *PSSR                                     R05860
     C****                 END                                            R05860
     C*
     C** WRITE A TRADE DATE HOLDING TO PF/PMHOLDPP
     C*
     C** MOVE 'T' TO TRADE/VALUE DATE INDICATOR ON PF/PMHOLDPP
     C                     MOVEL'T'       WWTVDA  1
     C*
     C** SET LINE 1 AMOUNT ON PF/PMHOLDPP EQUAL TO LEDGER BALANCE FROM
     C** PF/MEMOS
     C********             Z-ADDLDBLN     WWAMT1 150                      R05860
     C                     Z-ADDLDBL      WWAMT1 150                      R05860
     C****       CLBL      IFNE LDBL                                SA9108B08040
     C                     Z-ADDCLBL      WWOAMT 150                SA9108B08040
     C****                 ELSE
     C****                 Z-ADD*HIVAL    WWOAMT                    SA9108B08040
     C****                 END                                      SA9108B08040
     C*
     C** SET MARKET VALUE ON PF/PMHOLDPP EQUAL TO - LEDGER BALANCE FROM
     C** PF/MEMOS (MINUS AS A CR BALANCE IS AN ASSET TO THE CUSTOMER)
     C*********            Z-SUBLDBLN     WWMVAL 150                      R05860
     C                     Z-SUBLDBL      WWMVAL 150                      R05860
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     Z-ADDLDBL      WWMVAL                          CPM004
     C                     END                                            CPM004
     C*                                                                   R05669
     C** DETERMINE COUNTRY AND INDUSTRY CODE OF COUNTERPARTY TO LOAN /    R05669
     C** DEPOSIT                                                          R05669
     C***********          MOVE BRCD      WWBRCD  3                R05669 S01486
     C                     MOVE BRCA      WWBRCD  3                       S01486
     C****       WWBRCD    CHAINSDBRCHL1             71                   B08040
     C****                                                                B08040
     C****       *IN71     IFEQ '1'                        ***************B08040
     C****                 Z-ADD85        DBASE            **DB ERROR 85**B08040
     C****                 MOVEL'SDBRCHL1'DBFILE           ***************B08040
     C****                 MOVELBRCD      DBKEY                           B08040
     C****                 EXSR *PSSR                                     B08040
     C****                 END                                            B08040
     C****                                                                R05669
     C****       A8BICN    CHAINSDCUSTL0             71                   R05669
     C****                                                                R05669
     C****       *IN71     IFEQ '1'                        ***************R05669
     C****                 Z-ADD86        DBASE            **DB ERROR 86**R05669
     C****                 MOVEL'SDCUSTL0'DBFILE           ***************R05669
     C****                 MOVELA8BICN    DBKEY                           R05669
     C****                 EXSR *PSSR                                     R05669
     C****                 END                                            R05669
     C****                                                                R05669
     C****                 MOVE BBCOLC    WWCNTR  2                       R05669
     C****                 MOVE BBLICD    WWLIND  3                       R05669
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWBRCD    LOKUPBRC1,B                   71               B08040
     C*                                                                   B08040
     C           *IN71     IFEQ '0'                        ***************B08040
     C                     Z-ADD85        DBASE            **DB ERROR 85**B08040
     C***********          MOVEL'SDBRCHL1'DBFILE           ********B08040 S01486
     C***********          MOVELBRCD      DBKEY                    B08040 S01486
     C                     MOVE 'SDBRCHL1'DBFILE                          S01486
     C                     MOVELBRCA      DBKEY                           S01486
     C                     EXSR *PSSR                                     B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** SAVE DETAILS FROM SDBRCHPD                                       B08040
     C                     MOVE BICN,B    A8BICN                          B08040
     C                     MOVE COLC,B    WWCNTR  2                       B08040
     C                     MOVE LICD,B    WWLIND  3                       B08040
     C*                                                                   082763
     C** Default Local Industry Code & Country of risk                    082763
     C** to ICD values if blank                                           082763
     C*                                                                   082763
     C           WWLIND    IFEQ *BLANKS                                   082763
     C                     MOVE FCLICD    WWLIND                          082763
     C                     END                                            082763
     C           WWCNTR    IFEQ *BLANKS                                   082763
     C                     MOVE FCCNCD    WWCNTR                          082763
     C                     END                                            082763
     C*
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO THAT FROM PF/ACCNTAB
     C** (PORTFOLIO RECORD)
     C                     MOVELWWPTFR    WPTFR   4
     C           WWTVPS    IFEQ 'T'                                       B08040
     C                     EXSR W01
     C*
     C** IF THE PORTFOLIO REFERENCE FROM PF/ACCNTAB IS NOT '9997',
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO '9998'
     C** (PORTFOLIO CONSOLIDATED RECORD)
     C           WWPTFR    IFNE '9997'
     C                     MOVEL'9998'    WPTFR
     C                     EXSR W01
     C                     END
     C*
     C** IF PRIVATE BANKING MODULE IS NOT SWITCH *ON                      CPB001
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO '9999'
     C** (CUSTOMER CONSOLIDATED RECORD)
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVEL'9999'    WPTFR
     C                     EXSR W01
     C                     ENDIF                                          CPB001
     C                     ELSE                                           B08040
     C*
     C** WRITE A VALUE DATE HOLDING TO PF/PMHOLDPP
     C*
     C** MOVE 'V' TO TRADE/VALUE DATE INDICATOR ON PF/PMHOLDPP
     C                     MOVEL'V'       WWTVDA
     C*
     C** SET LINE 1 AMOUNT ON PF/PMHOLDPP EQUAL TO CLEARED BALANCE FROM
     C** PF/MEMOS
     C********             Z-ADDCLBLN     WWAMT1                          R05860
     C                     Z-ADDCLBL      WWAMT1                          R05860
     C****       CLBL      IFNE LDBL                                SA9108B08040
     C                     Z-ADDLDBL      WWOAMT 150                      B08040
     C****                 ELSE                                     SA9108
     C****                 Z-ADD*HIVAL    WWOAMT                    SA9108B08040
     C****                 END                                      SA9108B08040
     C*
     C** SET MARKET VALUE ON PF/PMHOLDPP EQUAL TO - CLEARED BALANCE FROM
     C** PF/MEMOS (MINUS AS A CR BALANCE IS AN ASSET TO THE CUSTOMER)
     C********             Z-SUBCLBLN     WWMVAL                          R05860
     C                     Z-SUBCLBL      WWMVAL                          R05860
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     Z-ADDCLBL      WWMVAL                          CPM004
     C                     END                                            CPM004
     C*
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO THAT FROM PF/ACCNTAB
     C** (PORTFOLIO RECORD)
     C                     MOVELWWPTFR    WPTFR
     C                     EXSR W01
     C*
     C** IF THE PORTFOLIO REFERENCE FROM PF/ACCNTAB IS NOT '9997',
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO '9998'
     C** (PORTFOLIO CONSOLIDATED RECORD)
     C           WWPTFR    IFNE '9997'
     C                     MOVEL'9998'    WPTFR
     C                     EXSR W01
     C                     END
     C*
     C** IF PRIVATE BANKING MODULE IS NOT SWITCH *ON                      CPB001
     C** WRITE A RECORD AS PER W01 - WRITE TO PORTFOLIO HOLDINGS,
     C** SETTING THE PORTFOLIO REFERENCE EQUAL TO '9999'
     C** (CUSTOMER CONSOLIDATED RECORD)
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVEL'9999'    WPTFR
     C                     EXSR W01
     C                     ENDIF                                          CPB001
     C                     END                                            B08040
     C*
     C** ADD 2 TO A COUNT OF PORTFOLIO HOLDINGS CREATED
     C****                 ADD  2         PPHCRE                          B08040
     C                     ADD  1         PPHCRE                          B08040
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * P05      - AUDIT PROCESSING                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * W02      - WRITE TO PORTFOLIO HOLDINGS AUDIT                     *
      * W03      - WRITE TO PORTFOLIO HOLDINGS UPDATE (RE) AUDIT REP.    *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           P05       BEGSR                           *** P05    ***
     C*
     C** ACCESS THE PORTFOLIO HOLDINGS AUDIT PF/PMHOLDZZ
     C***********          READ PMHOLDZZ                 72               S01486
     C                     READ PMHOLDPA                 72
     C           *IN72     IFEQ '1'
     C*
     C** SET NUMBER OF LIVE RECORDS EQUAL TO COUNT OF PORTFOLIO
     C** HOLDINGS CREATED
     C                     Z-ADDPPHCRE    QFNORE
     C*
     C** WRITE A RECORD TO PF/PMHOLDZZ AS PER W02
     C                     EXSR W02
     C                     ELSE
     C*
     C** ADD COUNT OF PORTFOLIO HOLDINGS CREATED TO NUMBER OF LIVE
     C** RECORDS ON PF/PMHOLDPP
     C                     ADD  PPHCRE    QFNORE
     C*
     C** UPDATE PF/PMHOLDZZ AS PER W02
     C                     EXSR W02
     C                     END
     C*
     C** PRODUCE PORTFOLIO HOLDINGS UPDATE (RE) AUDIT REPORT AS PER
     C** W03-WRITE PORTFOLIO HOLDINGS UPDATE (RE) AUDIT REPORT
     C                     EXSR W03
     C*
     C                     ENDSR                           *** EP05   ***
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W01      - WRITE TO PORTFOLIO HOLDINGS                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P04      - FORMAT & OUTPUT DETAILS TO THE PORTF.HOLDINGS FILE    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWAVCD   - ACCOUNT OFFICER FROM SDPLCSL0                         *
      * WWCNUM   - CUSTOMER FROM ACCNTAB                                 *
      * WWTVDA   - TRADE/VALUE DATE FROM ACCNTAB                         *
      * WWDSPS   - DISPLAY GROUP SEQ. FROM PMDSPGPP                      *
      * WWDSPG   - DISPLAY GROUP FROM SDPLINPD                           *
      * WWITDS   - INSTRUMENT TYPE DISPLAY SEQ. FROM SDPLINPD            *
      * WWVLGS   - VALUATION GROUP SEQ. FROM PMVLGHPP                    *
      * WWVALG   - VALUATION GROUP FROM SDPLINPD                         *
      * WWVLIS   - INSTRUMENT TYPE VALUATION SEQ. FROM SDPLINPD          *
      * WWINNR   - NARRATIVE FROM SDACODL0                               *
      * WWBDTX   - ACCOUNT CODE NAME FROM SDACODL0                       *
      * WWTXT2   - INSTRUMENT ENQUIRY DETAILS                            *
      * WWAMT1   - AMOUNT 1 FROM MEMOS                                   *
      * WWCCY    - CURRENCY CODE FROM ACCNTAB                            *
      * WWDANA   - CURRENCY DEC. PLACES FROM SDCURRL0                    *
      * WWMVAL   - MARKET VALUE FROM MEMOS                               *
      * WWACIS   - ACCRUED INTEREST                                      *
      *                                                                  *
      ********************************************************************
     C           W01       BEGSR                           *** W01    ***
     C*
     C** IF ACCOUNT BALANCE SET TO ZERO OUTPUT RECORD ID OF 'F'
     C***********WWAMT1    IFEQ 0                                   R05624R01115
     C***********          MOVEL'F'       QFRECI                    R05624R01115
     C***********          ELSE                                     R05624R01115
     C***********          MOVEL'D'       QFRECI                    B08115R01115
     C***********          END                                      R05624R01115
     C           ACRECI    IFEQ 'C'                                       B08115
     C                     MOVE 'M'       QFRECI                          B08115
     C                     ELSE                                           B08115
     C                     MOVE 'D'       QFRECI                          B08115
     C                     END                                            B08115
     C*
     C** ACCOUNT OFFICER: FROM LF/SDPLCSL0
     C                     MOVELWWACOC    QFACOC
     C*
     C** CUSTOMER NUMBER: FROM PF/ACCNTAB
     C**********           Z-ADDWWCNUM    QFCNUM                                              CSD027
     C                     MOVE WWCNUM    QFCNUM                                              CSD027
     C*
     C** PORTFOLIO REFERENCE
     C                     MOVELWPTFR     QFPTFR
     C*
     C** TRADE/VALUE DATE INDICATOR: SEE P04
     C                     MOVELWWTVDA    QFTVDA
     C*
     C** MODULE ID: 'RE'
     C                     MOVEL'RE'      QFMODI
     C*
     C** DISPLAY GROUP SEQUENCE: FROM PF/PMDSPGPP
     C                     Z-ADDWWDSPS    QFDSPS
     C*
     C** DISPLAY GROUP: FROM PF/SDPLINPD
     C                     MOVELWWDSPG    QFDSPG
     C*
     C** INSTRUMENT TYPE DISPLAY SEQUENCE: DISPLAY GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWITDS    QFITDS
     C*
     C** VALUATION GROUP SEQUENCE: FROM PF/PMVLGHPP
     C                     Z-ADDWWVLGS    QFVLGS
     C*
     C** VALUATION GROUP: FROM PF/SDPLINPD
     C                     MOVELWWVALG    QFVALG
     C*
     C** INSTRUMENT TYPE VALUATION SEQUENCE: VALUATION GROUP SEQ. FROM
     C** PF/SDPLINPD
     C                     Z-ADDWWVLIS    QFVLIS
     C*
     C** INSTRUMENT TYPE: FROM LF/SDACODL0
     C                     MOVELWWINNR    QFINNR
     C*
     C** TRANSACTION NUMBER: ZERO
     C**********           Z-ADD0         QFTRNB                                              CLE148
     C                     MOVEL*BLANKS   QFTRNB                                              CLE148
     C*
     C** SECURITY SHORTNAME: BLANK
     C                     MOVEL*BLANKS   QFTDSS
     C*
     C** DEAL TYPE : BLANK
     C                     MOVEL*BLANKS   QFDTYP
     C*
     C** MIDAS INSTRUMENT NAME: ACCOUNT CODE NAME FROM LF/SDACODL0
     C                     MOVELWWACCN    QFTXT1
     C*
     C** INSTRUMENT ENQUIRY DETAILS: SEE PROCESS P04
     C                     MOVELWWTXT2    QFTXT2
     C*
     C** LINE 1 AMOUNT: SEE P04
     C                     Z-ADDWWAMT1    QFAMT1
     C*
     C** LINE 2 AMOUNT: ZERO
     C                     Z-ADD0         QFAMT2
     C                     Z-ADDWWOAMT    QFOAMT                          B08040
     C*
     C** CURRENCY 1: FROM PF/ACCNTAB
     C                     MOVELWWCCY     QFCCY1
     C*
     C** CURRENCY 2: BLANK
     C                     MOVEL*BLANKS   QFCCY2
     C*
     C** CURRENCY DEC. PLACES 1: DEC. PLACES FROM LF/SDCURRL0
     C                     Z-ADDWWDANA    QFCDP1
     C*
     C** CURRENCY DEC. PLACES 2: ZERO
     C                     Z-ADD0         QFCDP2
     C*
     C** MARKET PRICE: ZERO
     C                     Z-ADD0         QFMPRC
     C*
     C** BOOK PRICE: ZERO
     C                     Z-ADD0         QFBOPR
     C*
     C** BOOK FX RATE: ZERO
     C                     Z-ADD0         QFBFXR
     C*
     C** MARKET VALUE: SEE P04
     C                     Z-ADDWWMVAL    QFMVAL
     C*
     C** PURCHASED INTEREST: ZERO
     C                     Z-ADD0         QFPUIT
     C*
     C** ACCRUED INTEREST: SEE PROCESS P04
     C           WWACIS    IFEQ *ZEROS                                    048022
     C                     MOVE 'P'       GGRECI                          048022
     C                     MOVE DDNUM     GGCNUM                          048022
     C                     MOVE DDCCY     GGCCY                           048022
     C                     MOVE DDACCD    GGACOD                          048022
     C                     MOVE DDACQU    GGACSQ                          048022
     C                     MOVE DDBRCA    GGBRCA                          085862
      *                                                                   048022
     C                     SETOF                     40                   048022
     C           WWKEY3    CHAINAPOSTPDF             40                   048022
     C           *IN40     IFEQ '0'                                       048022
     C                     MOVELPNAR      GGNAR   8                       048022
     C           GGNAR     IFEQ 'Interest'                                048022
     C*                                                                   053541
     C* ONLY ADD IN CAPITALISED INTEREST IF IT IS FUTURE VALUED           138238
     C           VALD      IFGT WWECD                                     138238
     C           DRCR      IFEQ 1                                         053541
     C                     Z-ADDPSTA      WWACIS                          048022
     C                     ELSE                                           053541
     C                     Z-SUBPSTA      WWACIS                          053541
     C                     END                                            053541
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     Z-SUBWWACIS    WWACIS                          CPM004
     C                     END                                            CPM004
     C                     END                                            138238
     C*                                                                   053341
     C                     END                                            048022
     C                     END                                            048022
     C                     END                                            048022
     C                     Z-ADDWWACIS    QFACIS
     C*
     C** NEXT INTEREST DATE: ZERO
     C                     Z-ADD0         QFNIDT
     C*
     C** START/LAST INTEREST DATE: ZERO
     C                     Z-ADD0         QFSLID
     C*
     C** NUMBER OF DAYS ACCRUED INTEREST: ZERO
     C                     Z-ADD0         QFNODA
     C*
     C** PROFIT/LOSS MARKET: ZERO
     C                     Z-ADD0         QFPLMK
     C*
     C** PROFIT/LOSS FX: ZERO
     C                     Z-ADD0         QFPLFX
     C*
     C** BOOK YIELD: ZERO
     C                     Z-ADD0         QFBKYD
     C*
     C** MARKET YIELD: ZERO
     C                     Z-ADD0         QFMKYD
     C*
     C** DIRECT YIELD: ZERO
     C                     Z-ADD0         QFDRYD
     C**********                                                          R05669
     C***COUNTRY OF RISK: BLANK                                           R05669
     C**********           MOVEL*BLANKS   QFCNTR                          R05669
     C**********                                                          R05669
     C***INDUSTRY: ZERO                                                   R05669
     C**********           Z-ADD0         QFLIND                          R05669
     C                     MOVE WWCNTR    QFCNTR                          R05669
     C**********           MOVE WWLIND    QFLIND                                     R05669 BUG23967
     C                     MOVE WWLIND    QFLOIC                                            BUG23967
     C*
     C** SECURITY POSITION PLEDGED: 'N'
     C                     MOVE 'N'       QFSPLD
     C*                                                                   B08040
     C** OBTAIN FX RATE FROM CURRENCY 1 TO PORTFOLIO CCY FROM ARRAY       B08040
     C                     Z-ADD1         B                               B08040
     C           QFPTFR    IFNE '9997'                                    B08040
     C           QFPTFR    ANDNE'9998'                                    B08040
     C           QFPTFR    ANDNE'9999'                                    B08040
     C           PNPTCY    LOKUPCYCD,B                   72               B08040
     C                     ELSE                                           B08040
     C           QBCSBY    LOKUPCYCD,B                   72               B08040
     C                     END                                            B08040
     C** ERROR                                                            B08040
     C           *IN72     IFEQ '0'                        ***************B08040
     C                     Z-ADD22        DBASE            **DB ERROR 02**B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELQBCSBY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    WWSPC1 138                      B08040
     C                     MOVE MDIN,B    WWMDC1  1                       B08040
     C                     Z-ADDNBDP,B    WWDPC1  10                      B08040
     C                     Z-ADDRKSQ,B    WWRKC1  30                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CALCULATE MARKET FX RATE FROM NOMINAL CCY TO PORTFOLIO CURRENCY  B08040
     C                     Z-ADD1         ZAMTF                           B08040
     C                     MOVE QFCCY1    ZCCYF                           B08040
     C                     MOVE CYCD,B    ZCCYT                           B08040
     C                     Z-ADDWWC9NL    ZRATEF                          B08040
     C                     Z-ADDWWSPC1    ZRATET                          B08040
     C                     MOVE WWA8SL    ZMDINF                          B08040
     C                     MOVE WWMDC1    ZMDINT                          B08040
     C                     Z-ADDWWDANA    ZCDPF                           B08040
     C                     Z-ADDWWDPC1    ZCDPT                           B08040
     C******************** EXSR ZCCYCN                             B08040 037854
     C                     EXSR ZCCYCN                                    057020
     C                     Z-ADDZCRSRN    QFMFXD                          057020
     C                     EXSR CONVN                                     050207
     C*                                                                   B08040
     C** CONVERT RATE INTO MULTIPLY RATE                                  B08040
     C           ZCRSMD    IFEQ 'D'                                       B08040
     C           ZCRSRT    ANDNE0                                         091703
     C           1         DIV  ZCRSRT    WWMFXR 138H                     B08040
     C                     ELSE                                           B08040
     C                     Z-ADDZCRSRT    WWMFXR 138                      B08040
     C                     END                                            B08040
     C*                                                                   B08040
     C** CONVERT MARKET FX RATE TO FORMAT DEFINED BY RANKING SEQUENCE     B08040
     C           WWRKC1    IFLT WWLRNK                                    B08040
     C***********1******** DIV  WWMFXR    QFMFXR 138H              B08040 037854
     C           ZCRSMD    IFEQ 'D'                                       037854
     C           WWMFXR    OREQ 0                                         091703
     C                     Z-ADDZCRSRT    QFMFXR 138H                     037854
     C                     ELSE                                           044313
     C           1         DIV  WWMFXR    QFMFXR 138H                     044313
     C                     END                                            037854
     C                     MOVE 'D'       QFMFMD                          B08040
     C                     ELSE                                        67 B08040
     C                     Z-ADDWWMFXR    QFMFXR 138H                     B08040
     C                     MOVE 'M'       QFMFMD                          B08040
     C                     END                                         67 B08040
     C*                                                                   S01313
     C** IF EITHER NOMINAL OR ACCRUED INTEREST NOT ZERO SET HOLDING
     C** VALUED TO 'Y'
     C****                 MOVE 'N'       QFHLDV                    S01313057020
     C****       QFAMT1    IFNE 0                                         057020
     C****       QFACIS    ORNE 0                                         057020
     C                     MOVE 'Y'       QFHLDV                          S01313
     C****                 END                                            057020
     C*                                                                   S01313
     C** IF RECORD FOR DEFINED PORTFOLIO AND PERFORMANCE START DATE *LE   S01313
     C** DNWD SET 'PERFORMANCE FIGURES REQUIRED' TO 'Y'                   S01313
     C** OTHERWISE SET TO 'N'                                             S01313
     C                     MOVE 'N'       QFPFMR                          S01313
     C           QFPTFR    IFNE '9997'                                    S01313
     C           QFPTFR    ANDNE'9998'                                    S01313
     C           QFPTFR    ANDNE'9999'                                    S01313
     C***********PNPSDT    ANDLEBJDNWD                             S01313 CPM005
     C           PNPSDT    IFLE BJDNWD                                    CPM005
     C           PNPSDT    ANDNE*ZEROS                                    CPM005
     C                     MOVE 'Y'       QFPFMR                          S01313
     C                     END                                            CPM005
      *                                                                   CPM005
      **  If 9997, 9998 or 9999 portfolios, check flags in PF/SDPLCSPD    CPM005
      *                                                                   CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9997'                                    CPM005
     C           QBPFM7    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9998'                                    CPM005
     C           QBPFM8    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     ELSE                                           CPM005
     C           QFPTFR    IFEQ '9999'                                    CPM005
     C           QBPFM9    ANDEQ'Y'                                       CPM005
     C                     MOVE 'Y'       QFPFMR                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C                     END                                            S01313
     C*                                                                   R37474
     C                     MOVE *ZEROS    QFDLSQ                          S01313
     C*                                                                   R37474
     C** FORMAT TOTALS INFORMATION FOR OURPUT                             R37474
     C                     EXSR #HLDX0                                    R37474
     C*
     C** WRITE A RECORD IN FILE PMHOLDPP
     C/COPY WNCPYSRC,PM1148C002
     C                     WRITEPMHOLDP0
     C/COPY WNCPYSRC,PM1148C003
     C****                                                          R37474B08040
     C****ORMAT TOTALS INFORMATION FOR OURPUT                       R37474B08040
     C****                 EXSR #HLDX0                              R37474B08040
     C*                                                                   B08040
     C                     ENDSR                           *** EW01   ***
      *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W02      - WRITE TO PORTFOLIO HOLDINGS AUDIT                     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P05      - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           W02       BEGSR                           *** W02    ***
     C****                 MOVEL'D'       QFRECI                          B08115
     C           ACRECI    IFEQ 'C'                                       B08115
     C                     MOVE 'M'       QFRECI                          B08115
     C                     ELSE                                           B08115
     C                     MOVE 'D'       QFRECI                          B08115
     C                     END                                            B08115
     C/COPY WNCPYSRC,PM1148C004
     C           *IN72     IFEQ '1'
     C                     WRITEPMHOLDZ0
     C                     ELSE
     C                     UPDATPMHOLDZ0
     C                     END
     C/COPY WNCPYSRC,PM1148C005
     C                     ENDSR                           *** EW02   ***
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * W03      - WRITE TO PORTFOLIO HOLDINGS UPDATE (RE) AUDIT REP.    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * P05      - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           W03       BEGSR                           *** W03    ***
     C*                                                                   S01486
     C/COPY WNCPYSRC,PM1148C006
     C                     WRITEPM1148PP
     C/COPY WNCPYSRC,PM1148C007
     C*                                                                   S01486
     C           WEMPTY    IFEQ 'Y'                                       S01486
     C                     WRITENODTLS                                    S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     ENDSR                           *** EW03   ***
     C*
     C********************************************************************B08040
      /EJECT                                                              B08040
      ********************************************************************B08040
      *                                                                  *B08040
      * #HLDX0   - CALCULATE DETAILS TO BE OUTPUT TO PMHOLDX0            *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLS:                                                *B08040
      *                                                                  *B08040
      * SUBROUTINE CALLED FROM:                                          *B08040
      * W01      - WRITE TO PMHOLDPP                                     *B08040
      *                                                                  *B08040
      * ROUTINE USES VARIABLES:                                          *B08040
      *                                                                  *B08040
      ********************************************************************B08040
     C           #HLDX0    BEGSR                           * W03    BSR * B08040
     C*                                                                   B08255
     C****       QFPTFR    IFNE '9998'                              R37474B08255
     C****       QFPTFR    ANDNE'9999'                              R37474B08255
     C****       QBAPBC    OREQ 'N'                                 R37474B08255
     C*                                                                   B08040
     C** DETERMINE PORTFOLIO VALUATION CURRENCY                           B08040
     C           QFPTFR    IFNE '9997'                     B1             B08040
     C           QFPTFR    ANDNE'9998'                                    B08040
     C           QFPTFR    ANDNE'9999'                                    B08040
     C                     MOVE PNPTCY    WWVLCY  3                       B08040
     C                     ELSE                            X1             B08040
     C                     MOVE QBCSBY    WWVLCY                          B08040
     C                     END                             E1             B08040
     C*                                                                   B08040
     C** IF VALUATION CURRENCY DIFFERENT TO CURRENCY 1 SET UP PARAMETER   B08040
     C** TO BE USED IN SR/ZCCYCN                                          B08040
     C           WWVLCY    IFNE QFCCY1                     B1             B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           QFCCY1    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        B2*************B08040
     C                     Z-ADD27        DBASE            * DB ERROR 16 *B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELQFCCY1    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     MOVE QFCCY1    ZCCYF                           B08040
     C                     Z-ADDSPRT,B    ZRATEF                          B08040
     C                     MOVE MDIN,B    ZMDINF                          B08040
     C                     Z-ADDNBDP,B    ZCDPF                           B08040
     C*                                                                   B08040
     C                     Z-ADD1         B                               B08040
     C           WWVLCY    LOKUPCYCD,B                   73               B08040
     C*                                                                   B08040
     C           *IN73     IFEQ '0'                        B2 ************B08040
     C                     Z-ADD28        DBASE            * DB ERROR 16 *B08040
     C***********          MOVEL'SDCURRL0'DBFILE           ********B08040 S01486
     C                     MOVE 'SDCURRL0'DBFILE                          S01486
     C                     MOVELWWVLCY    DBKEY                           B08040
     C                     EXSR *PSSR                                     B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     MOVE WWVLCY    ZCCYT                           B08040
     C                     Z-ADDSPRT,B    ZRATET                          B08040
     C                     MOVE MDIN,B    ZMDINT                          B08040
     C                     Z-ADDNBDP,B    ZCDPT                           B08040
     C*                                                                   B08040
     C** CONVERT MARKET VALUE TO PORTFOLIO CURRENCY                       B08040
     C                     Z-ADDQFMVAL    ZAMTF                           B08040
     C                     EXSR ZCCYCN                                    B08040
     C                     Z-ADDZAMTT     WWMVL1 150                      B08040
     C*                                                                   B08040
     C** CONVERT ACCRUED INTEREST TO PORTFOLIO CURRENCY                   B08040
     C                     Z-ADDQFACIS    ZAMTF                           B08040
     C                     EXSR ZCCYCN                                    B08040
     C                     Z-ADDZAMTT     WWACI1 150                      B08040
     C*                                                                   B08040
     C** ... OTHERWISE USE VALUES WRITTEN TO PMHOLDPP                     B08040
     C                     ELSE                            X1             B08040
     C                     Z-ADDQFMVAL    WWMVL1                          B08040
     C                     Z-ADDQFACIS    WWACI1                          B08040
     C                     END                             E1             B08040
     C*                                                                   B08040
     C** SET ALL TOTAL FIELDS TO ZERO                                     B08040
     C                     Z-ADD0         QFPTPA                          B08040
     C                     Z-ADD0         QFPTNA                          B08040
     C                     Z-ADD0         QFPTMV                          B08040
     C                     Z-ADD0         QFPVPA                          B08040
     C                     Z-ADD0         QFPVNA                          B08040
     C                     Z-ADD0         QFPVMV                          B08040
     C                     Z-ADD0         QFPTAI                          B08040
     C                     Z-ADD0         QFPTNI                          B08040
     C                     Z-ADD0         QFMVPC                          R37474
     C                     Z-ADD0         QFAIPC                          R37474
     C*
     C** ADD MARKET VALUE AND ACCRUED INTEREST TO TOTALLING FIELDS
     C           WWTVPS    IFEQ 'T'                        B1
     C           QFTVDA    IFEQ 'T'                        B2
     C           WWMVL1    IFGT 0                          B3             B08040
     C                     Z-ADDWWMVL1    QFPTPA                          B08040
     C                     ELSE                            X3             B08040
     C                     Z-SUBWWMVL1    QFPTNA                          B08040
     C                     END                             E3             B08040
     C                     Z-ADDWWACI1    QFPTAI                          B08040
     C                     END                             E2             B08040
     C*                                                                   B08040
     C                     ELSE                            X1             B08040
     C*                                                                   B08040
     C           QFTVDA    IFEQ 'V'                        B2
     C           WWMVL1    IFGT 0                          B3             B08040
     C                     Z-ADDWWMVL1    QFPVPA                          B08040
     C                     ELSE                            X3             B08040
     C                     Z-SUBWWMVL1    QFPVNA                          B08040
     C                     END                             E3             B08040
     C                     Z-ADDWWACI1    QFPTAI                          B08040
     C                     END                             E2             B08040
     C                     END                             E1             B08040
     C*                                                                   B08040
     C** WRITE OUT TOTALS INFORMATION                                     B08040
     C                     MOVE QFCCY1    QFCCY                           B08040
     C*                                                                   R37474
     C** CALCULATE EXTRA FIELDS TO BE OUTPUT TO PMHOLDPP FOR MIDASQ       R37474
     C           QFPTPA    IFNE 0                          B1             R37474
     C           QFPVPA    ORNE 0                                         R37474
     C                     Z-ADDQFPTPA    QFMVPC                          R37474
     C                     ADD  QFPVPA    QFMVPC                          R37474
     C                     MOVE '+'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTNA    IFNE 0                          B1             R37474
     C           QFPVNA    ORNE 0                                         R37474
     C                     Z-SUBQFPTNA    QFMVPC                          R37474
     C                     SUB  QFPVNA    QFMVPC                          R37474
     C                     MOVE '-'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFPTMV    IFNE 0                          B1             R37474
     C           QFPVMV    ORNE 0                                         R37474
     C                     Z-SUBQFPTMV    QFMVPC                          R37474
     C                     SUB  QFPVMV    QFMVPC                          R37474
     C                     MOVE 'L'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C           QFMVPC    IFEQ 0                          B1             R37474
     C                     MOVE 'N'       QFINTC                          R37474
     C                     END                             E1             R37474
     C*                                                                   R37474
     C                     Z-ADDQFPTAI    QFAIPC                          R37474
      *                                                                   CPM005
      **  Call sr for new fields in PMHOLDPD PMHOLDQ0 PMHOLDQ1            CPM005
      *                                                                   CPM005
     C                     EXSR NEWFLD                                    CPM005
     C*                                                                   B08040
     C           QFPTFR    IFNE '9998'                                    R37474
     C           QFPTFR    ANDNE'9999'                                    R37474
     C           QBAPBC    OREQ 'N'                                       R37474
     C*                                                                   B08040
     C/COPY WNCPYSRC,PM1148C008
     C           QBAPBC    IFEQ 'N'                                       B08255
     C                     WRITEPMHOLDD1                                  B08040
     C                     ELSE                                           B08255
     C                     WRITEPMHOLDD0                                  B08040
     C                     END                                            B08255
     C/COPY WNCPYSRC,PM1148C009
     C                     END                                            B08255
     C*                                                                   B08040
     C                     ENDSR                           * W03    ESR * B08040
     C********************************************************************
      /EJECT                                                              CPM005
      *****************************************************************   CPM005
      *                                                               *   CPM005
      * NEWFLD   - New Field in PMHOLDPD PMHOLDQ0 PMHOLDQ1            *   CPM005
      *                                                               *   CPM005
      * Subroutine Calls:                                             *   CPM005
      *                                                               *   CPM005
      * Subroutine Called From:                                       *   CPM005
      * W01      -                                                    *   CPM005
      *                                                               *   CPM005
      * Routine Uses Variables:                                       *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
     C           NEWFLD    BEGSR                                          CPM005
      *                                                                   CPM005
     C                     MOVEL'C '      QFPOST                          CPM005
     C                     MOVEL'C '      QFPOTY                          CPM005
      *                                                                   CPM005
     C           WWMVL1    ADD  WWACI1    WWORK1 150                      CPM005
     C           WWORK1    IFGT *ZEROS                                    CPM005
     C                     Z-ADD*ZEROS    QFASVL                          CPM005
     C           WWMVL1    ADD  WWACI1    QFASVL                          CPM005
     C                     MOVEL'A'       QFASLI                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADD*ZEROS    QFASVL                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C           WWORK1    IFLT *ZEROS                                    CPM005
     C                     Z-SUBWWMVL1    WWMVL1                          CPM005
     C           WWMVL1    SUB  WWACI1    QFLIVL                          CPM005
     C                     MOVEL'L'       QFASLI                          CPM005
     C                     ELSE                                           CPM005
     C                     Z-ADD*ZEROS    QFLIVL                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
     C*    ZFRELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR RETAIL
     C*
     C*  FORMAT: 999999 XXX 9999 99
     C*
     C*          999999 CUSTOMER NUMBER
     C*          XXX = CURRENCY
     C*          9999 = ACCOUNT CODE
     C*          99 = ACCOUNT SEQUENCE
     C*
     C*  INPUT  FIELDS
     C*       ZCNUM   60     CUSTOMER NUMBER
     C*       ZCCY    3A     CURRENCY
     C********ZACOD   40     ACCOUNT CODE                                                     CGL029
     C*       ZACOD  100     ACCOUNT CODE                                                     CGL029
     C*       ZACSQ   20     ACCOUNT SEQUENCE
     C*
     C*  OUTPUT  FIELDS
     C********ZLIN   20A     LINE DESCRIPTION                                                 CGL029
     C*       ZLIN   26A     LINE DESCRIPTION                                                 CGL029
     C*
     C*  ARRAY USED
     C*******ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG                                        CGL029
     C*      ZLI    26 ELEMENTS, EACH 1 CHARACTER LONG                                        CGL029
     C*
     C********************************************************************
     C           ZFRELN    BEGSR                           *** ZFRELN ***
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C** MOVE CUSTOMER NUMBER TO LINE DESCRIPTION
     C                     MOVE ZCNUM     ZWRKA6  6
     C                     MOVEAZWRKA6    ZLI,01
     C*
     C** MOVE CURRENCY TO LINE DESCRIPTION
     C***********          MOVEAZCCY      ZLI,08                          085862
     C                     MOVEAZCCY      ZLI,07                          085862
     C*
     C** MOVE ACCUONT CODE TO LINE DESCRIPTION
     C**********           MOVE ZACOD     ZWRKA4  4                                           CGL029
     C                     MOVE ZACOD     ZWRK10 10                                           CGL029
     C***********          MOVEAZWRKA4    ZLI,12                          085862
     C**********           MOVEAZWRKA4    ZLI,10                                       085862 CGL029
     C                     MOVEAZWRK10    ZLI,10                                              CGL029
     C*
     C** MOVE ACCUONT SEQUENCE TO LINE DESCRIPTION
     C                     MOVE ZACSQ     ZWRKA2  2
     C***********          MOVEAZWRKA2    ZLI,17                          085862
     C**********           MOVEAZWRKA2    ZLI,14                                       085862 CGL029
     C**********           MOVEAZBRCA     ZLI,16                                       085862 CGL029
     C                     MOVEAZWRKA2    ZLI,20                                              CGL029
     C                     MOVEAZBRCA     ZLI,22                                              CGL029
     C**
     C**  SET ALL   FIELDS TO BLANKS OR ZEROS
     C**********           Z-ADD*ZEROS    ZCNUM   60                                          CSD027
     C                     MOVE *BLANKS   ZCNUM   6                                           CSD027
     C                     MOVE *BLANKS   ZCCY    3
     C**********           Z-ADD*ZEROS    ZACOD   40                                          CGL029
     C                     Z-ADD*ZEROS    ZACOD  100                                          CGL029
     C                     Z-ADD*ZEROS    ZACSQ   20
     C                     MOVE *BLANKS   ZBRCA                           085862
     C**
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN   26                                           CGL029
     C**
     C                     ENDSR
     C**************************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - ERROR SUBROUTINE                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * INIT     - INITIAL PROCESSING                                    *
      * P01      - ACCESS ACCOUNT CODE DETAILS                           *
      * P02      - ACCESS CUSTOMER DETAILS                               *
      * P03      - ACCESS CURRENCY DETAILS                               *
      * P04      - FORMAT & OUTPUT DETAILS TO THE PORTF.HOLDINGS FILE    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*
     C           WWERRO    IFEQ ' '
     C                     MOVE 'Y'       WWERRO  1
     C*
     C           DBASE     IFNE 0
     C*
     C**  PRINT ERROR MESSAGE:
     C                     WRITEERRORAU
     C                     ELSE
     C                     Z-ADD999       DBASE
     C                     END
     C*
     C                     DUMP
     C                     END
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
     C*  SUBROUTINE INTEGRATED  37854                                     37854*
     C*                                                                   37854
     C*                                                                   37854*
     C*  ZCCYCN SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER       37854*
     C*  CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES             37854*
     C*                                                                   37854*
     C*  INPUT  FIELDS                                                    37854*
     C*       ZAMTF  150     AMOUNT IN 'FROM' CURRENCY                    37854*
     C*       ZCCYF   3A     FROM CURRENCY                                37854*
     C*       ZCCYT   3A     TO CURRENCY                                  37854*
     C*       ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY                37854*
     C*       ZRATET 138     SPOT RATE FOR 'TO' CURRENCY                  37854*
     C*       ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CURRENCY37854*
     C*       ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURRENCY  37854*
     C*       ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY  37854*
     C*       ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY    37854*
     C*                                                                   37854*
     C*  OUTPUT  FIELDS                                                   37854*
     C*       ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT)    *
     C*       ZCRSRT 138     CROSS EXCHANGE RATE                          37854*
     C*       ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR         37854*
     C*                                                                   37854*
     C*                                                                   37854*
     C*  CALLS:                                                           37854*
     C*       ZCCYXR                                                      37854*
     C*                                                                   37854*
     C*  CALLED BY:                                                       37854*
     C*                                                                   37854*
     C**************************************************************************
     C*                                                                   037854
     C           CONVN     BEGSR                                          037854
     C*                                                                   037854
     C** DEFINE ALL FIELDS                                                037854
     C                     Z-ADDZAMTF     ZAMTF  150                      037854
     C                     MOVE ZCCYF     ZCCYF   3                       037854
     C                     MOVE ZCCYT     ZCCYT   3                       037854
     C                     Z-ADDZRATEF    ZRATEF 138                      037854
     C                     Z-ADDZRATET    ZRATET 138                      037854
     C                     MOVE ZMDINF    ZMDINF  1                       037854
     C                     MOVE ZMDINT    ZMDINT  1                       037854
     C                     Z-ADDZCDPF     ZCDPF   10                      037854
     C                     Z-ADDZCDPT     ZCDPT   10                      037854
     C                     Z-ADDZAMTT     ZAMTT  150                      037854
     C                     Z-ADDZCRSRT    ZCRSRT 138                      037854
     C                     MOVE ZCRSMD    ZCRSMD  1                       037854
     C*                                                                   037854
     C** IF 'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TO' CURRENCY
     C** EQUAL TO AMOUNT IN 'FROM' CURRENCY
     C           ZCCYF     IFEQ ZCCYT                                     037854
     C                     Z-ADDZAMTF     ZAMTT                           037854
     C                     Z-ADD1         ZCRSRT                          037854
     C                     MOVE 'M'       ZCRSMD                          037854
     C                     ELSE                                           037854
     C*                                                                   037854
     C** INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO                 037854
     C                     Z-ADD*ZEROS    ZCRSRT                          037854
     C                     MOVE ZMDINF    ZCRSMD                          041644
     C*                                                                   037854
     C** IF MULT/DIV INDIC. FOR 'FROM' IS = MULT/DIV INDIC FOR 'TO' INDIC 037854
     C**   AND SPOT RATE FOR 'TO' CURRENCY (ZRATET) IS NOT = ZERO         037854
     C           ZMDINF    IFEQ ZMDINT                                    037854
     C           ZRATET    ANDNE*ZEROS                                    037854
     C           ZRATEF    IFGT ZRATET                                    037854
     C           ZRATEF    DIV  ZRATET    ZCRSRT                          037854
     C                     ELSE                                           037854
     C           ZRATET    DIV  ZRATEF    ZCRSRT                          037854
     C           ZMDINF    IFEQ 'D'                                       041644
     C                     MOVE 'M'       ZCRSMD                          037854
     C                     ELSE                                           041644
     C                     MOVE 'D'       ZCRSMD                          041644
     C                     END                                            041644
     C                     END                                            037854
     C*                                                                   037854
     C** IF MULT/DIV INDIC FOR 'FROM' IS NOT= MULT/DIV INDIC FOR 'TO' INDIC
     C** OR  SPOT RATE FOR 'TO' CURRENCY (ZRATET) IS  = ZERO
     C                     ELSE                                           037854
     C           ZRATEF    MULT ZRATET    ZCRSRT                          037854
     C                     END                                            037854
     C*                                                                   037854
     C** MOVE MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULT/DIV   037854
     C** INDICATOR (ZCRSMD)                                               037854
     C*                                                                   037854
     C** EXECUTE   SR ZCCYXR                                              037854
     C                     EXSR ZCCYXR                                    037854
     C                     END                                            037854
     C                     ENDSR                                          037854
     C********************************************************************037854
      /COPY ZSRSRC,ZCCYCN
      ****/COPY ZSRSRC,ZCCYXR                                             47719
      /COPY ZSRSRC,ZCCYXR                                                 062885
     C*
     O**                                                                  058889
     O** HOLDING EXTRACTED INDICATOR                                      058889
     O**                                                                  058889
     OACCNTABFE                ACNUPD                                     058889
     O                         HLEX                                       058889
**  CPY@
(c) Finastra International Limited 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
