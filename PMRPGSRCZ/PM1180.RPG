     H        1                                                           S01486
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas Copy Records To Totalling Workfiles')            *
/*OVRF*: OVRDBF FILE(PMUNQVP1) TOFILE(PMUNQVPD) SHARE(*NO)          : *   S01486
     H***********                                                         S01486
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM1180 - Copy Records To Totalling Workfiles                 *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CER059             Date 19Jul10               *
      *  Prev Amend No. BUG23967           Date 14May09               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 091899             Date 13AUG95               *
     F*                 085819             Date 13MAR95               *
     F*                 S01486             DATE 11AUG94               *
     F*                 S01313             DATE 30APR92               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23967 - Add Local Industry Code Field. (Recompile)        *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
     F*  091899 - Reinstate PMHOLDL7/PMHOLDL8 in form PMHOLQL0/L1     *
     F*  085819 - Remove PMHOLDL7 and PMHOLDL8 and use only PMHOLDL5  *
     F*  S01486 - Portfolio Management Upgrade to Release 10          *
     F*  S01313 - PROGRAM WRITTEN FOR PORTFOLIO PERFORMANCE           *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F***PREFIX*:*BJ***************************************************   S01486
     F***SDBANKL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F***PREFIX*:*QN***************************************************   S01486
     F** PREFIX : GH                                                      S01486
     FPMUNQVP1IF  E           K        DISK
     F                                              KINFSR *PSSR
     F** PREFIX : QF
     F***PMHOLLX0IF**E           K        DISK                            S01486
     F***PMHOLDL7IF**E           K        DISK                      S01486085819
     F***********                                   KINFSR *PSSR          085819
     F***PREFIX*:*QF******************************************************085819
     F***PMHOLLX1IF**E           K        DISK                            S01486
     F***PMHOLDL8IF**E           K        DISK                      S01486085819
     F***********                                   KINFSR *PSSR          085819
     F***PMHOLDL5IF**E**       K        DISK                       085819 091899
     F****************                              KINFSR *PSSR   085819 091899
     F** RECORD ID QF
     F***PMHOLDX2O***E           K        DISK                            S01486
     FPMHOLQL0IF  E           K        DISK                               091899
     F                                              KINFSR *PSSR          091899
     FPMHOLQL1IF  E           K        DISK                               091899
     F                                              KINFSR *PSSR          091899
     FPMHOLDQ2O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** RECORD ID QF
     F***PMHOLDX3O***E           K        DISK                            S01486
     FPMHOLDQ3O   E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** RECORD ID RR
     FPM1180AUO   E                    PRINTER
     F                                              KINFSR *PSSR
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*
     F*                Unused indicators
     F*                -----------------
     F*       01  02  03  04  05  06  07  08  09  10
     F*       11  12  13  14  15  16  17  18  19  20
     F*       21  22  23  24  25  26  27  28  29  30
     F*       31  32  33  34  35  36  37  38  39  40
     F*       41  42  43  44  45  46  47  48  49  50
     F*       51  52  53  54  55  56  57  58  59  ..
     F*       ..  62  63  64  65  66  67  68  69  70
     F*       71  72  73  74  75  76  77  78  79  80
     F*       81  82  83  84  85  86  87  88  89  90
     F*       91  92  93  94  95  96  97  98  99
     F*
     F*       60         EOF ON QRYF/PMUNQVP1
     F********61*********EOF*ON*LF/PMHOLLX0****************************   S01486
     F********61*********EOF*ON*LF/PMHOLDL7*************************S01486085819
     F********62*********EOF*ON*LF/PMHOLLX1****************************   S01486
     F********62*********EOF*ON*LF/PMHOLDL8*************************S01486085819
     F********61*********EOF ON LF/PMHOLDL5                        085819 091899
     F*       61         EOF ON LF/PMHOLQL0                               091899
     F*       62         EOF ON LF/PMHOLQL1                               091899
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     E*
     E** ARRAY FOR COPYRIGHT
     E*
     E                    CPY@    1   1 80
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA********UDS                            256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Data structure for bank details                                 S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure for access objects                         S01486
     I*                                                                   S01486
      /EJECT                                                              S01486
     C*
     C                     EXSR #INIT
     C***********                                                         091899
     C***********WHILE RECORDS EXIST ON QRYF/PMUNQVP1                     091899
     C***********          READ PMUNQVP1                 60               091899
     C************IN60     DOWEQ'0'                        B1             091899
     C***********                                                         091899
     C***READ*ALL*RECORDS*ON*LF/PMHOLLX0*AND*OUTPUT*TO*PF/PMHOLDX2*****   S01486
     C***READ*ALL*RECORDS*ON*LF/PMHOLDL7*AND*OUTPUT*TO*PF/PMHOLDQ2**S01486085819
     C*********** RECORDS ON LF/PMHOLDL5 AND OUTPUT TO PF/PMHOLDQ2  085819091899
     C***********KHOLD0    SETLLPMHOLLX0                                  S01486
     C***********KHOLD0    SETLLPMHOLDL7                            S01486085819
     C***********KHOLD0    READEPMHOLLX0                 61               S01486
     C***********KHOLD0    READEPMHOLDL7                 61         S01486085819
     C***********KHOLD0    SETLLPMHOLDL5                            085819091899
     C***********KHOLD0    READEPMHOLDL5                 61         085819091899
     C***********                                                         091899
     C************IN61     DOWEQ'0'                        B2             091899
     C***********          WRITEPMHOLDD2                                  091899
     C***********          ADD  1         RRNORE                          091899
     C***********KHOLD0    READEPMHOLLX0                 61               S01486
     C***********KHOLD0    READEPMHOLDL7                 61         S01486085819
     C***********KHOLD0    READEPMHOLDL5                 61         085819091899
     C***********          END                             E2             091899
     C***********                                                         091899
     C***READ*ALL*RECORDS*ON*LF/PMHOLLX1*AND*OUTPUT*TO*PF/PMHOLDX3*****   S01486
     C***READ*ALL*RECORDS*ON*LF/PMHOLDL8*AND*OUTPUT*TO*PF/PMHOLDQ3**S01486085819
     C*********** RECORDS ON LF/PMHOLDL5 AND OUTPUT TO PF/PMHOLDQ3  085819091899
     C***********KHOLD1    SETLLPMHOLLX1                                  S01486
     C***********KHOLD1    SETLLPMHOLDL8                            S01486085819
     C***********KHOLD1    READEPMHOLLX1                 62               S01486
     C***********KHOLD1    READEPMHOLDL8                 62         S01486085819
     C***********KHOLD1    SETLLPMHOLDL5                            085819091899
     C***********KHOLD1    READEPMHOLDL5                 61         085819091899
     C***********                                                         091899
     C***********          MOVE 'Y'       WWAPBC  1                       091899
     C************IN62     DOWEQ'0'                        B2             085819
     C************IN61     DOWEQ'0'                        B2       085819091899
     C***********          WRITEPMHOLDD3                                  091899
     C***********          ADD  1         RRNOR1                          091899
     C***********KHOLD1    READEPMHOLLX1                 62               S01486
     C***********KHOLD1    READEPMHOLDL8                 62         S01486085819
     C***********KHOLD1    READEPMHOLDL5                 61         085819091899
     C***********          MOVE 'N'       WWAPBC  1                       091899
     C***********          END                             E2             091899
     C***********                                                         091899
     C***********RDS FOR CUSTOMER SELECTED IN FIRST PASS IF ALL           091899
     C***********OS ARE NOT IN BASE CURRENCY. HENCE SET FILE POINTER      091899
     C***********ST RECORD FOR CUSTOMER                                   091899
     C***********WWAPBC    IFEQ 'N'                                       091899
     C***********          MOVE *HIVAL    QNPTFR                          S01486
     C***********          MOVE *HIVAL    GHPTFR                    S01486091899
     C***********KHOLD0    SETGTPMUNQVP1                                  091899
     C***********          END                                            091899
     C***********                                                         091899
     C***********          READ PMUNQVP1                 60               091899
     C***********          END                             E1             091899
     C*                                                                   091899
     C** PERFORM WHILE RECORDS EXIST ON QRYF/PMUNQVP1                     091899
     C*                                                                   091899
     C                     READ PMUNQVP1                 60               091899
     C           *IN60     DOWEQ'0'                        B1             091899
     C*                                                                   091899
     C** READ ALL RECORDS ON LF/PMHOLQL0 AND OUTPUT TO PF/PMHOLDQ2        091899
     C*                                                                   091899
     C           KHOLD0    SETLLPMHOLQL0                                  091899
     C           KHOLD0    READEPMHOLQL0                 61               091899
     C*                                                                   091899
     C           *IN61     DOWEQ'0'                        B2             091899
     C                     WRITEPMHOLDD2                                  091899
     C                     ADD  1         RRNORE                          091899
     C           KHOLD0    READEPMHOLQL0                 61               091899
     C                     END                             E2             091899
     C*                                                                   091899
     C** READ ALL RECORDS ON LF/PMHOLQL1 AND OUTPUT TO PF/PMHOLDQ3        091899
     C*                                                                   091899
     C           KHOLD1    SETLLPMHOLQL1                                  091899
     C           KHOLD1    READEPMHOLQL1                 62               091899
     C*                                                                   091899
     C                     MOVE 'Y'       WWAPBC  1                       091899
     C           *IN62     DOWEQ'0'                        B2             091899
     C                     WRITEPMHOLDD3                                  091899
     C                     ADD  1         RRNOR1                          091899
     C           KHOLD1    READEPMHOLQL1                 62               091899
     C                     MOVE 'N'       WWAPBC  1                       091899
     C                     END                             E2             091899
     C*                                                                   091899
     C** ALL RECORDS FOR CUSTOMER SELECTED IN FIRST PASS IF ALL           091899
     C** PORTFOLIOS ARE NOT IN BASE CURRENCY. HENCE SET FILE POINTER      091899
     C** AFTER LAST RECORD FOR CUSTOMER                                   091899
     C*                                                                   091899
     C           WWAPBC    IFEQ 'N'                                       091899
     C                     MOVE *HIVAL    GHPTFR                          091899
     C           KHOLD0    SETGTPMUNQVP1                                  091899
     C                     END                                            091899
     C*                                                                   091899
     C                     READ PMUNQVP1                 60               091899
     C                     END                             E1             091899
      *
      ** WRITE AUDIT REPORT
      *
     C                     WRITEPM1180PP
     C                     WRITECONTROL                                   S01486
     C           RRNORE    IFEQ 0                                         S01486
     C           RRNOR1    ANDEQ0                                         S01486
     C                     WRITENODTLS                                    S01486
     C                     END                                            S01486
     C*
     C                     SETON                     LR
     C                     RETRN
     C           #INIT     BEGSR                           **#INIT BSR**
     C*
     C** SET UP REQUIRED KLISTS
     C           KHOLD0    KLIST
     C***********          KFLD           QNCNUM                          S01486
     C                     KFLD           GHCNUM                          S01486
     C***********          KFLD           QNPTFR                          S01486
     C                     KFLD           GHPTFR                          S01486
     C*
     C           KHOLD1    KLIST
     C***********          KFLD           QNCNUM                          S01486
     C                     KFLD           GHCNUM                          S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
      *
      ** PREPARE LDA
     C                     MOVE *BLANKS   DBFILE                          S01486
     C                     MOVE *BLANKS   DBKEY                           S01486
     C                     Z-ADD*ZEROS    DBASE                           S01486
     C                     MOVEL'PM1180'  DBPGM
     C                     OUT  LDA                                       S01486
     C***********          MOVEACPY@      BIS@   80                       S01486
     C                     MOVEACPY@      ACT@   80                       S01486
      *
      ** GET INSTALLATION CONTROL DATA RECORD 1
      *
     C************LOVAL    SETLLSDBANKL1                                  S01486
     C***********          READ SDBANKL1                 61               S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
      *
     C************IN61     IFEQ '1'                        - B1           S01486
     C           P@RTCD    IFNE *BLANK                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            ***************
     C***********          MOVEL'SDBANKL1'DBFILE           **DB ERROR 01**S01486
     C                     MOVE 'SDBANKPD'DBFILE           **DB ERROR 01**S01486
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
      *
     C                     ENDSR                           **#INIT ESR**
     C           *PSSR     BEGSR
     C*                                                                   S01486
     C** Output header and database error record format                   S01486
     C*                                                                   S01486
     C                     WRITEPM1180PP                                  S01486
     C                     WRITEDBERROR                                   S01486
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C**
     C                     DUMP
     C**
     C                     RETRN
     C**
     C                     ENDSR
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
