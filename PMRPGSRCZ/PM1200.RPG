     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Portfolio charges accruals')                  *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                      *
     F*                                                               *
     F*  PM1200 - PM Portfolio Charges Accruals                       *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. AR1049865          Date 11Nov12               *
      *  Prev Amend No. MD055146           Date 04Feb20               *
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 CLE064             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG8884            Date 05Oct05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG1818            Date 13Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 142689             Date 15Oct98               *
      *                 116572             Date 09Apr97               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 02Mar99               *
      *                 CTI002             Date 07Feb99               *
      *                 102506             Date 18Oct98               *
      *                 140698             date 13Aug98               *
      *                 CAC003             Date 25Feb97               *
     F*                 CPM005             Date 01OCT96               *
     F*                 092961             DATE 04OCT95               *
     F*                 S01486             DATE 11AUG94               *
     F*                 056841             DATE 15JUN93               *
     F*                 047719             DATE 19JAN93               *
     F*                 S01313             DATE 16JUN92               *
     F*                 B10662             DATE 09DEC91               *
     F*                 B08040             DATE 10JUL91               *
     F*                 SA9001             DATE 28JUN91               *
     F*                 B07806             DATE 21MAY91               *
     F*                 R05867             DATE 22APR91               *
     F*                 R00142             DATE 11FEB91               *
     F*                 033619             DATE 21AUG90               *
     F*                 R10011             DATE 16AUG90               *
     F*                 R00411             DATE 15AUG90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  AR1049865 - Applied fixes 184926, 181298 (Child:AR1049866)   *
      *  184926 - For inter-branch settlement, amount is posted to the*
      *           wrong customer. Fix is patterned after 178003.      *
      *  181298 - If trade equivalent account code blank use spot a/c *
      *  MD055146 - Failed MXC004802 seq. 00001 and others            *
      *             Increase Branches to 900.                         *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG8884- CSE071 holidays currencies not defined (recompile)  *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
     F*  BUG1818- Missing 10 digit changes                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL020 - Compliance Watch - Additional A/C Postings          *
      *           Information                                         *
     F*  142689 - Incorrect customer number on internal postings.     *
     F*  116572 - Apply some modifications due to SR/ZDYYR which was  *
     F*           amended by 100228 (See /COPY/ZDYYRZ3).              *
     F*           (Call ZLCD and ZNCD instead of ZD5DYS for coupon    *
     F*            calculation to ensure 29FEB is considered valid)   *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  102506 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  140698 - Recompiled over amended ZNCDZ3 /COPY.               *
     F*  CAC003 - Profit Centre Accounting Development Phase 3.       *
     F*  CPM005 - Private Banking Phase II                            *
     F*           Focus Group Changes Upgraded to DBA                 *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  S01486 - Portfolio Management Upgrade to Release 10          *
     F*  056841 - INCORRECT CALCULATION OF CHARGE ACCRUALS FOR        *
     F*           TIERED CHARGING METHOD                              *
     F*  062594 - USE EXTERNAL SUBROUTINES ZCCYCN AND ZCCYXR INSTEAD  *
     F*           OF INCORRECT ONCE INTERNALLY DESCRIBED.             *
     F*  047719 - CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES    *
     F*  S01313 - PROGRAM RENAMED FOR PERFORMANCE                     *
     F*  B10662 - Change retail transaction type.                     *
     F*  B08040 - SUNDRY FIXES TO MAKE COB FASTER                     *
     F*  SA9001 - CUSTOMER CORRESPONDANCE                             *
     F*  B07806 - INCLUDE ACCRUED INTERESR IN CALCULATION OF NET      *
     F*           ASSET VALUE OF PORTFOLIO                            *
     F*  R05867 - CALCULATION OF CHARGES SHOULD BE BASED ON THE NET   *
     F*           ASSET VALUE OF THE PORTFOLIO                        *
     F*  R00142 - CHANGE NARRATIVE IN MULTILANGUAGE                   *
     F*  033619 - CROSS-CURRENCY ACCOUNTING INCORRECT                 *
     F*  R00411 - INCORRECT CONDITIONING FOR CHARGE ACCRUALS          *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*PREFIX:*BJ************************************************         S01486
     F***SDBANKL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F*PREFIX:*BK************************************************         S01486
     F***SDGELRL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F*PREFIX:*BL************************************************  033619 S01486
     F***SDTRADL1IF**E           K        DISK                     033619 S01486
     F***********                                   KINFSR *PSSR   033619 S01486
     F*PREFIX:*P9************************************************         S01486
     F***SDPORTL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F*PREFIX:*A8************************************************         S01486
     F***SDBRCHL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F*PREFIX:*A5************************************************         S01486
     F***SDACODL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F*PREFIX:*A6************************************************         S01486
     F***SDCURRL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F*PREFIX:*BB*AND*QB*****************************************         S01486
     F***SDPLCSL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F***SDNARRL0IF**E           K        DISK                     R00142 S01486
      *                                                                   R00142
     F*PREFIX: PN
     F***PMPORTPPIF**E           K        DISK                            S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F*PREFIX: P5
     F***PMCGCDPPIF**E           K        DISK                            S01486
     FPMCGCDPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F*PREFIX: QC
     F***PMPOTTPPIF**E           K        DISK                            S01486
     FPMPOTTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F*PREFIX:
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F                                              KINFSR *PSSR
     F*PREFIX:***************************************************         S01486
     F***TABLETJ*IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F*PREFIX:
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMF
     F                                              KINFSR *PSSR
     F*PREFIX: PO
     F***PMCHRGPPUF**E                    DISK                            S01486
     FPMCHRGPDUF  E                    DISK                               S01486
     F                                              KINFSR *PSSR
     F*PREFIX:
     FGEPMPD  O   E                    DISK
     F                                              KINFSR *PSSR
     F*PREFIX:
     F***GEPMZZ**O***E                    DISK                            S01486
     FGEPMPA  O   E                    DISK                               S01486
     F                                              KINFSR *PSSR
     FPM1200AUO   E                    PRINTER
     F/COPY WNCPYSRC,PM1200F001
      /EJECT
     F*
     F* ID F  C  H  L    Function of indicators
      *
      *   INDICATOR USAGE
      *   ---------------
      *
      *   20      PROFIT CENTRE ACCOUNTING INDICATOR                      CAC003
      *   71      ACCESS LF/ACCNT
      *   72      ACCESS LF/ACNUM
      ****73******ACCESS*PF/PMCGCDPP*****************************         S01486
      ****75******ACCESS*PF/PMPORTPP*****************************         S01486
      ****76******ACCESS*PF/PMPOTTPP*****************************         S01486
      *   73      ACCESS PF/PMCGCDPD                                      S01486
      *   75      ACCESS PF/PMPORTPD                                      S01486
      *   76      ACCESS PF/PMPOTTPD                                      S01486
      ****77******ACCESS*LF/SDACODL1*****************************         S01486
      ****78******ACCESS*LF/SDBANKL1*****************************         S01486
      ****79******ACCESS*LF/SDBCRHL1*****************************         S01486
      ****80******ACCESS*LF/SDCURRL0*****************************         S01486
      ****81******ACCESS*LF/SDGELRL1*****************************         S01486
      ****82******ACCESS*LF/SDPLCSL0*****************************         S01486
      ****83******ACCESS*LF/SDPORTL0*****************************         S01486
      ****84******ACCESS*LF*SDNARRL0*****************************  R00142 S01486
      *   98      DATE FORMAT
      *   90-99   STANDARD SUBROUTINES
      ****LR******END*OF*FILE*PF/PMCHRGPP************************         S01486
      *   LR      END OF FILE PF/PMCHRGPD                                 S01486
      *
     F*
     F*                Unused indicators
     F*                -----------------
     F*       01  02  03  04  05  06  07  08  09  10
     F********11**12**13**14**15**16**17**18**19**20*************         CAC003
     F*       11  12  13  14  15  16  17  18  19  ..                      CAC003
     F*       21  22  23  24  25  26  27  28  29  30
     F*       31  32  33  34  35  36  37  38  39  40
     F*       41  42  43  44  45  46  47  48  49  50
     F*       51  52  53  54  55  56  57  58  59  60
     F*       61  62  63  64  65  66  67  68  69  70
     F*       ..  ..  ..  74  ..  ..  77  78  79  80
     F*       81  82  83  84  85  86  87  88  89  ..
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..
     F*
      *      DB ERROR NUMBER MAXIMUM 27 (INCLUDE)
      *
      /EJECT
     E                    NAR        30  1
     E**********          CUS        12  1                                                    CGL029
     E                    CUS        18  1                                                    CGL029
      ** ARRAY FOR FORMATTING DL DETAILS FOR OUTPUT SR/ZFDLLN
     E                    ZLI        20  1
     E*                                                                   S01486
     E**  Array for Branch code details                                   S01486
     E*                                                                   S01486
     E**********          BRCD       20  3                                S01486
     E**********          DFAC       20  4                                    S01486 CGL029 MD055146
     E**********          DTAC       20  4                                             S01486 CGL029
     E**********          DFAC       20 10                                           CGL029 MD055146
     E**********          DTAC       20 10                                           CGL029 MD055146
     E**********          BICN       20  6                                           S01486 MD055146
      *                                                                                     MD055146
     E                    BRCD      999  3                                                  MD055146
     E                    DFAC      999 10                                                  MD055146
     E                    DTAC      999 10                                                  MD055146
     E                    BICN      999  6                                                  MD055146
     E*                                                                   S01486
      *
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,ZPOWERZ1
      /COPY ZSRSRC,ZFRQAZ1
      /COPY ZSRSRC,ZDAYSZ1
      /COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZHOLE                                                  S01486
      * ARRAY FOR CHARGE CODE FILE
     E                    ZRA        14 15 0
     E                    ZRB        15 15 0
     E                    ZPC        15 11 7
     E                    ZCG        15 15 0
     E                    CPY@    1   1 80
     E/COPY WNCPYSRC,PM1200E001
      /EJECT
     IACCNTABF                                                            CAC003
     I              PRFC                            APRFC                 CAC003
      *
      ** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
      *
     I***LDA********UDS                            256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     ICKEY        DS
     I                                        1   3 PNBCGY
     I                                        4   5 WWCGCO
     I*
     I** LKEY TO FILL DBKEY IF DATA BASE ERROR ON LF/ACCNT
     I*
     ILKEY        DS
     I**********                              1   60CNUM                                      CSD027
     I                                        1   6 CNUM                                      CSD027
     I                                        7   9 CCY
     I**********                             10  130ACOD                                      CGL029
     I**********                             14  150ACSQ                                      CGL029
     I                                       10  190ACOD                                      CGL029
     I                                       20  210ACSQ                                      CGL029
     I*
     I***NKEY*TO*FILL*DBKEY*IF*DATA*BASE*ERROR*ON*PF/PMPORTPP****         S01486
     I** NKEY TO FILL DBKEY IF DATA BASE ERROR ON PF/PMPORTPD             S01486
     I*
     INKEY        DS
     I**********                              1   60WWCNUN                                    CSD027
     I                                        1   6 WWCNUN                                    CSD027
     I                                        7  10 WWPTF2
      /COPY ZSRSRC,ZNCDZ2
     I*
     I**  DATA STRUCTURE TO FILL TABLE
     I*
     I***DSTR******E*DSPMCGCDPP                                           S01486
     IDSTR      E DSPMCGCDPD                                              S01486
     I                                    P  52 1630ZRA
     I                                    P 164 2537ZPC
     I                                    P 254 3730ZCG
     I*
     I* Data structure for compilation - copyright insertion.
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                   S01486
     IRUNDAT    E DS                                                      S01486
     I**  Standard Data Area Layout for System flags and Run Date         S01486
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Midas  Bank details                                          S01486
     I*                                                                   S01486
     ISDGELR    E DSSDGELRPD                                              S01486
     I**  Midas  SD General Ledger details                             S01486
     I*                                                                   S01486
     ISDTRAD    E DSSDTRADPD                                              S01486
     I              QQACCD                          TRACCD                                    CGL029
     I**  Midas  SD Trading ICD details                                S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I**  Midas  SD Portfolio Management ICD details                   S01486
     I*                                                                   S01486
     ISDBRCH    E DSSDBRCHPD                                              S01486
     I              QQDFAC                          BRDFAC                                    CGL029
     I**  Midas  SD Branch details                                     S01486
     I*                                                                   S01486
     ISDACOD    E DSSDACODPD                                              S01486
     I              QQACCD                          ACACCD                                    CGL029
     I**  Midas  SD Account Codes details                              S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Midas  Currencies details                                    S01486
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I**  Midas  SD Portfolio Management Customer details              S01486
     I*                                                                   S01486
     ISDNARR    E DSSDNARRPD                                              S01486
     I**  Midas  SD Narrative Codes details                            S01486
     I*                                                                   S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I**  Midas  SD Customer details                                   S01486
     I*                                                                   S01486
     ISDMMOD    E DSSDMMODPD                                              CAC003
     I**  External DS for Modules                                         CAC003
     I*                                                                   CAC003
     ISDPCAC    E DSSDPCACPD                                              CAC003
     I              QQFNAA                          PCFNAA                                    CGL029
     I              QQFNIC                          PCFNIC                                    CGL029
     I** External DS for Profit Center Accounting ICD                     CAC003
     I*                                                                   CAC003
     ISDPRFC    E DSSDPRFCPD                                              CAC003
     I** External DS for Profit Center Details                            CAC003
     I*                                                                   CAC003
     ISCSARD    E DSSCSARDPD                                                                  CGL020
      ** External data structures for SAR Details                                             CGL020
      *                                                                                       CGL020
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure                                            S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I**  Long data structure                                             S01486
     I*                                                                   S01486
     I/COPY ZSRSRC,ZHOLI                                                  S01486
     I*                                                                   S01486
     I/COPY WNCPYSRC,PM1200I001
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P01     - ACCESS CUSTOMER DETAILS                               *
      * #P02     - ACCESS PORTFOLIO DETAILS AND TOTALS                   *
      * #P03     - FORMAT CUSTOMER SETTLEMENT ACCOUNT DETAILS            *
      * #P04     - DETERMINE EFFECTIVE CHARGE DETAILS                    *
      * #P05     - PROCESS CHARGE ADJUSTEMENTS                           *
      * #P06     - PROCESS CHARGE ACCRUALS                               *
      * #P07     - PROCESS CHARGE SETTLEMENTS                            *
      * #P08     - DETERMINE TOTAL CHARGE                                *
      * #P09     - GENERATE CHARGE ACCRUAL ENTRIES                       *
      * #P10     - GENERATE STANDARD SETTLEMENT ENTRIES                  *
      * #P11     - GENERATE INTER-BRANCH SETTLEMENT ENTRIES              *
      * #P12     - GENERATE CROSS-CURRENCY SETTLEMENT ENTRIES            *
      * #P13     - GENERATE BASE CURRENCY SETTLEMENT ENTRIES             *
      * #P15     - AUDIT PROCESSING                                      *
      **#U01*****-*UPDATE*PF/PMCHRGPP*************************************S01486
      * #U01     - UPDATE PF/PMCHRGPD                                    *S01486
      * #W01     - WRITE SUSPENSE ENTRIES TO PF/GEPMPD                   *
      * #W02     - WRITE NON-SUSPENSE ENTRIES TO PF/GEPMPD               *
      **#W03*****-*WRITE*TO*PF/GEPMZZ*************************************S01486
      * #W03     - WRITE TO PF/GEPMPA                                    *S01486
      * #W04     - WRITE PORTFOLIO CHARGES ACCRUALS AUDIT REPORT         *
      * DEVCD    - DETERMINE EVENT CONTROL DATE                          *
      * ZCCYCN   - CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER          *
      * ZCCYXR   - CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER          *
      * ZDATE2   - CONVERT A DAY NUMBER TO DATE FORMAT                   *
      * ZFRQA    - INCREMENT A DAY NUMBER DATE BY A PERIOD VALUE         *
      * ZPMCRG   - CALCULATE PORTFOLIO MANAGEMENT CHARGES                *
      * ZDAYS    - CALCULATE NO. OF DAYS BETWEEN TWO DATES               *
      * ZDYYR    - CALCULATE NO. OF DAYS IN INTEREST YEAR                *
      * ZDATE1   - VALIDATE DATES SUBMIT AND CONVERT TO A NO OF DAYS     *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      *                                                                  *
      ********************************************************************
      *
      *  KLIST NLIST TO ACCESS PF/SDDTSTPP
      *
     C           NLIST     KLIST
     C                     KFLD           WWCNUN
     C                     KFLD           WWPTFR
      *
      ***KLIST*ALIST*TO*ACCESS*PF/PMPORTPP***********************         S01486
      *  KLIST ALIST TO ACCESS PF/PMPORTPD                                S01486
      *
     C           ALIST     KLIST
     C                     KFLD           WWCNUA
     C                     KFLD           WWPTFR
      *
      *  KLIST LLIST TO ACCESS LF/ACCNT
      *
     C           LLIST     KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCA                            S01486
      *
      ***KLIST*CLIST*TO*ACCESS*PF/PMCGCDPP***********************         S01486
      *  KLIST CLIST TO ACCESS PF/PMCGCDPD                                S01486
      *
     C           CLIST     KLIST
     C                     KFLD           PNBCGY
     C                     KFLD           WWCGCO
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  P R O G R A M   S T A R T                                    *
      *                                                               *
      *****************************************************************
      *
      * PERFORM INITIAL PROCESSING
      *
     C                     EXSR #INIT
      *
     C***********          READ PMCHRGPP                 LR               S01486
     C                     READ PMCHRGPD                 LR               S01486
      *
     C           *INLR     DOWEQ'0'                        - B1
      *
     C                     Z-ADDPOCGAD    WWCGAD
      *
      * ON CHANGE OF CUSTOMER ACCESS CUSTOMER DETAILS AND SAVE PREVIOUS
      * CUSTOMER NUMBER
      *
     C           WWCNUM    CASNEPOCNUM    #P01             - B2
     C                     END                             - E2
      *
      * ON CHANGE OF CUSTOMER OR PORTFOLIO REFERENCE ACCESS PORTFOLIO
      * DETAILS AND TOTALS, AND SAVE PREVIOUS DETAILS
      *
     C           WWCNUM    CASNEPOCNUM    #P02             - B2
     C           WWPTF1    CASNEPOPTFR    #P02
     C                     END                             - E2
      *
      * THE PORTFOLIO IS CLOSING TODAY SET THE NEXT SETTLEMENT DATE (POCSND)
      * EQUAL TO THE DATE PORTFOLIO CLOSED (PNDPCL)
      *
     C           PORECI    IFEQ 'C'                        - B2
     C                     Z-ADDPNDPCL    POCSND
     C                     END                             - E2
      *
      **IF*DATE*LESS*THEN*EVENT*CONTROL*DATE*,*DETERMINE*EFFECTIVE        R00411
      **IF DATE < OR = TO EVENT CONTROL DATE , DETERMINE EFFECTIVE        R00411
      * CHARGE DETAILS
      *
     C***********POCGND****IFLT ECD                        - B2           R00411
     C***********POCSND****ORLT ECD                                       R00411
     C           POCGND    IFLE ECD                        - B2           R00411
     C           POCSND    ORLE ECD                                       R00411
     C                     EXSR #P04
      *
      * IF THE CHARGE ADJUSTEMENT AMOUNT IS NOT ZERO, PROCESS CHARGE
      * ADJUSTMENT
      *
     C           POCGAJ    CASNE*ZEROS    #P05             - B3
     C                     END                             - E3
      *
     C                     END                             - E2
      *
      * IF NEXT ACCRUAL DATE IS LESS THAN EVENT CONTROL DATE  AND
      * CHARGE STOP INDICATOR IS NOT Y, PROCESS CHARGE ACCRUALS
      *
     C***********POCGND****IFLT ECD                        - B2           R00411
     C           POCGND    IFLE ECD                        - B2           R00411
     C           POCSIS    CASNE'Y'       #P06             - B3
     C                     END                             - E3
      *
      * DETERMINE THE NEXT ACCRUAL DATE
      *
     C                     MOVE POCGFQ    ZFREQ
     C                     MOVE BJLCCY    ZCCY
     C                     Z-ADDPOCGND    ZDAYNO
     C                     Z-ADDPOCGDY    ZMDAY
     C                     EXSR ZFRQA
     C                     Z-ADDZDAYNO    WWCGND
     C                     END                             - E2
      *
      * IF NEXT SETTLEMENT DATE IS LESS THAN EVENT CONTROL DATE,
      * PROCESS CHARGE SETTLEMENT
      *
     C***********POCSND****IFLT ECD                        - B2           R00411
     C           POCSND    IFLE ECD                        - B2           R00411
     C                     EXSR #P07
      *
      * DETERMINE THE NEXT SETTLEMENT DATE
      *
     C                     MOVE POCSFQ    ZFREQ
     C                     MOVE BJLCCY    ZCCY
     C                     Z-ADDPOCSND    ZDAYNO
     C                     Z-ADDPOCSDY    ZMDAY
     C                     EXSR ZFRQA
     C                     Z-ADDZDAYNO    WWCSND
     C                     END                             - E2
      *
     C                     EXSR #U01
      *
     C                     UPDATPMCHRGP0
      * INITIALIZE WORK FIELDS
     C                     Z-ADD*ZEROS    WWTCTP
     C                     Z-ADD*ZEROS    WWTCHA
     C                     Z-ADD*ZEROS    WWTCSC
     C***********          READ PMCHRGPP                 LR               S01486
     C                     READ PMCHRGPD                 LR               S01486
      *
     C                     END                             - E1
      *
      * PRINT AUDIT REPORT
      *
     C                     EXSR #P15
      *
     C                     RETRN
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P01     - ACCESS CUSTOMER DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCNUA   - CUSTOMER NUMBER ALPHANUMERIC TO ACCESS LF/SDPLCSL0    *
      * WWC9N1   - SPOT RATE OF CUSTOMER BASE CURRENCY                   *
      * WWDAN1   - NUMBER OF DECIMAL PLACE OF CUSTOMER BASE CURRENCY     *
      * WWA8S1   - MULTIPLY/DIVIDE IND OF CUSTOMER BASE CURRENCY         *
      * WWDTNB   - BRANCH INTERNAL CUSTOMER NUMBER                       *
      * WWACSQ   - BRANCH START ACCOUNT SEQUENCE                         *
      * WWFRNB   - INTERBRANCH BRANCH ACCOUNT CODE                       *
      *                                                                  *
      ********************************************************************
     C           #P01      BEGSR                           **#P01 BEGSR **
      *
      * SAVE PREVIOUS CUSTOMER NUMBER
      *
     C*******              MOVE POCNUM    WWCNUM                          R10011
      ***********                                                         S01486
      **ACCESS*LF/SDPLCSL0***************************************         S01486
      ***********                                                         S01486
     C***********          MOVE POCNUM    WWCNUA                          S01486
     C***********WWCNUA    CHAINSDPLCSL0             82                   S01486
      ***********                                                         S01486
     C************IN82     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD07        DBASE            ***************S01486
     C***********          MOVEL'SDPLCSL0'DBFILE           **DB ERROR 07**S01486
     C***********          MOVELWWCNUA    DBKEY            ***************S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          END                             - E1           S01486
      ***********                                                  R00142 S01486
      *****Retreive*the*posting*narrative*in*file*SDNARRL0*******  R00142 S01486
     C***********KEYNAR    CHAINSDNARRL0             84            R00142 S01486
      ***********                                                  R00142 S01486
     C************IN84     IFEQ '1'                                R00142 S01486
     C***********          MOVEL'27'      DBASE            ********R00142 S01486
     C***********          MOVEL'SDNARRL0'DBFILE           *  DB ERR00142 S01486
     C***********          MOVEL'  C6'    DBKEY            ********R00142 S01486
     C***********          MOVELBBLANG    DBKEY                    R00142 S01486
     C***********          EXSR *PSSR                              R00142 S01486
     C***********          END                                     R00142 S01486
      ***********                                                         S01486
      **ACCESS*LF/SDCURRL0*USING*CUSTOMER*BASE*CURRENCY**********         S01486
      ***********                                                         S01486
     C***********QBCSBY    CHAINSDCURRL0             80                   S01486
      ***********                                                         S01486
     C************IN80     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD08        DBASE            ***************S01486
     C***********          MOVEL'SDCURRL0'DBFILE           **DB ERROR 08**S01486
     C***********          MOVELQBCSBY    DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access Portfolio Management Customer details                    S01486
     C*                                                                   S01486
     C                     MOVE POCNUM    WWCNUA                          S01486
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C                     PARM WWCNUA    P@CUST                          S01486
     C           SDPLCS    PARM SDPLCS    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD7         DBASE            ***************S01486
     C                     MOVE 'SDPLCSPD'DBFILE           *DB ERROR 007 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@BRCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**  Access Customer details                                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM QBCUST    P@CUST 10                       S01486
     C                     PARM *BLANKS   P@KYST  7                       S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD25        DBASE            ***************S01486
     C                     MOVE 'SDCUSTPD'DBFILE           *DB ERROR 025 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CUST    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**  Access Narrative Code details                                   S01486
     C*                                                                   S01486
     C                     CALL 'AONARRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C                     PARM 'C6'      P@NVCD  2                       S01486
     C           SDNARR    PARM SDNARR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD27        DBASE            ***************S01486
     C                     MOVE 'SDNARRPD'DBFILE           *DB ERROR 027 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@NVCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**  Access Customer base currency details                           S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM QBCSBY    P@CYCD                          S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD8         DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 008 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CYCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
      *
     C                     Z-ADDA6SPRT    WWC9N1
     C                     Z-ADDA6NBDP    WWDAN1
     C                     MOVE A6MDIN    WWA8S1
      *
      **ACCESS*LF/SDBRCHL1*USING*CUSTOMER*BRANCH*TO*GET*BRANCH*DETAILS    S01486
      ***********                                                         S01486
     C***********BBBRCD    CHAINSDBRCHL1             79                   S01486
      ***********                                                         S01486
     C************IN79     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD09        DBASE            ***************S01486
     C***********          MOVEL'SDBRCHL1'DBFILE           **DB ERROR 09**S01486
     C***********          MOVELBBBRCD    DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access Customer branch details                                  S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               S01486
     C           BBBRCD    LOKUPBRCD,B                   79               S01486
     C*                                                                   S01486
     C           *IN79     IFEQ '0'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD9         DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 009 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELBBBRCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
      *
     C***********          MOVE A8BICN    WWBICN                          142689
     C                     MOVE BICN,B    WWBICN                          142689
      *
      **MULTIBRANCH*DEALING*INDICATOR*FROM*LF/SDBANKL1*IS*'Y'****         S01486
      ***********                                                         S01486
     C***********BJMBDI    IFEQ 'Y'                        - B1           S01486
     C***********          MOVE A8SACS    ACSQ                            S01486
     C***********          ELSE                            - X1           S01486
     C***********          MOVE '01'      ACSQ                            S01486
     C***********          END                             - E1           S01486
      *
     C                     MOVE '01'      ACSQ                            S01486
     C                     MOVE ACSQ      WWACSQ
     C***********          MOVE A8IBAC    WWIBAC                          S01486
      *
     C                     ENDSR                           **#P01 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P02     - ACCESS PORTFOLIO DETAILS AND TOTALS                   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      * ZCCYCN   - CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER          *
      * #P03     - FORMAT CUSTOMER SETTLEMENT ACCOUNT DETAILS            *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      **WWCNUN***-*CUSTOMER*NUMBER*NUMERIC*TO*ACCESS*PF/PMPORTPP**********S01486
      * WWCNUN   - CUSTOMER NUMBER NUMERIC TO ACCESS PF/PMPORTPD         *S01486
      * WWC9N2   - SPOT RATE OF BANK CHARGING CURRENCY                   *
      * WWDAN2   - NUMBER OF DECIMAL PLACE OF BANK CHARGING CURRENCY     *
      * WWA8S2   - MULTIPLY/DIVIDE IND OF BANK CHARGING CURRENCY         *
      * WWFYN2   - SPOT TRADE ACCOUNT EQUIVALENT OF BANK CHARGING CCY    *
      * WWC9N3   - SPOT RATE OF CUSTOMER SETTLEMENT CURRENCY             *
      * WWDAN3   - NUMBER OF DECIMAL PLACE IN CUSTOMER SETTLEMENT CCY    *
      * WWA8S3   - MULTIPLY/DIVIDE IND OF CUSTOMER SETTLEMENT CCY        *
      * WWFYN3   - SPOT TRADE ACCOUNT EQUIVALENT OF CUST SETTLEMENT C    *
      * WWMVAL   - MARKET VALUE                                          *
      *                                                                  *
      ********************************************************************
     C           #P02      BEGSR                           **#P02 BEGSR **
      *
      * SAVE PREVIOUS RECORD DETAILS
      *
     C                     MOVE POCNUM    WWCNUM
     C                     MOVE POPTFR    WWPTFR
     C                     MOVE POPTFR    WWPTF1
      *
      **ACCESS*PF/PMPORTPP*USING*CUSTOMER*NUMBER*AND*PORTFOLIO*REFERENCE  S01486
      **FROM*PF/PMCHRGPP*TO*GET*THE*BANK*CHARGING*CURRENCY*(PNBCGY),      S01486
      * ACCESS PF/PMPORTPD USING CUSTOMER NUMBER AND PORTFOLIO REFERENCE  S01486
      * FROM PF/PMCHRGPD TO GET THE BANK CHARGING CURRENCY (PNBCGY),      S01486
      * THE CUSTOMER SETTLEMENT CURRENCY (PNCSCY), THE PORTFOLIO
      * CURRENCY (PNPTCY) AND THE CUSTOMER SETTLEMENT ACCOUNT (PNCUSA)
      *
     C                     MOVE POCNUM    WWCNUN
     C***********NLIST     CHAINPMPORTPP             75                   S01486
     C           NLIST     CHAINPMPORTPD             75                   S01486
      *
     C           *IN75     IFEQ '1'                        - B1
     C                     MOVE WWPTFR    WWPTF2
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD10        DBASE            ***************
     C***********          MOVEL'PMPORTPP'DBFILE           **DB ERROR 10**S01486
     C                     MOVE 'PMPORTPD'DBFILE           **DB ERROR 10**S01486
     C                     MOVELNKEY      DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
      *
     C**                   Z-ADDPNCNUM    WWOTR1
     C**                   MOVE PNPTFR    WWOTR2
      *
      **ACCESS*LF/SDCURRL0*USING*THE*BANK*CHARGING*CURRENCY******         S01486
      **TO*GET*SPOT*RATE,*NO*OF*DEC*PLACES*AND*******************         S01486
      **THE*SPOT*TRADE*EQUIVALENT*ACCOUNT*FOR*THE*BANK*CHARGING**         S01486
      **CURRENCY*************************************************         S01486
      ***********                                                         S01486
     C***********PNBCGY    CHAINSDCURRL0             80                   S01486
      ***********                                                         S01486
     C************IN80     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD11        DBASE            ***************S01486
     C***********          MOVEL'SDCURRL0'DBFILE           **DB ERROR 11**S01486
     C***********          MOVELPNBCGY    DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access Bank Charging currency details                           S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM PNBCGY    P@CYCD                          S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD11        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 011 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CYCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
      *
     C                     Z-ADDA6SPRT    WWC9N2
     C                     Z-ADDA6NBDP    WWDAN2
     C                     MOVE A6MDIN    WWA8S2
     C                     MOVE A6SPAE    WWFYN2
      *                                                                                       181298
      ** If WWFYN2 blank then fill with Spot trade account code                               181298
      *                                                                                       181298
     C           WWFYN2    IFEQ *BLANKS                                                       181298
     C                     MOVELBLSPTA    WWFYN2                                              181298
     C                     ENDIF                                                              181298
      *
      **ACCESS*LF/SDCURRL0*USING*THE*CUSTOMER*SETTLEMENT*CURRENCY         S01486
      **TO*GET*SPOT*RATE,*NO*OF*DEC*PLACES*AND*******************         S01486
      **THE*SPOT*TRADE*EQUIVALENT*ACCOUNT*FOR*THE*CUSTOMER*SETTLEMENT     S01486
      **CURRENCY*************************************************         S01486
      ***********                                                         S01486
     C***********PNCSCY    CHAINSDCURRL0             80                   S01486
      ***********                                                         S01486
     C************IN80     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD12        DBASE            ***************S01486
     C***********          MOVEL'SDCURRL0'DBFILE           **DB ERROR 12**S01486
     C***********          MOVELPNCSCY    DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access Customer Settlement currency details                     S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM PNCSCY    P@CYCD                          S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD11        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 011 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CYCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
      *
     C                     Z-ADDA6SPRT    WWC9N3
     C                     Z-ADDA6NBDP    WWDAN3
     C                     MOVE A6MDIN    WWA8S3
     C                     MOVE A6SPAE    WWFYN3
      *                                                                                       181298
      ** If WWFYN3 blank then fill with Spot trade account code                               181298
      *                                                                                       181298
     C           WWFYN3    IFEQ *BLANKS                                                       181298
     C                     MOVELBLSPTA    WWFYN3                                              181298
     C                     ENDIF                                                              181298
      *
      **ACCESS*PF/PMPOTTPP*USING*CUSTOMER*NUMBER*AND*PORTFOLIO*REFERENCE  S01486
      **FROM*PF/PMCHRGPP*TO*GET*THE*TRADE*DATE*POSITIVE*ASSETS*(QCPTPA)   S01486
      * ACCESS PF/PMPOTTPD USING CUSTOMER NUMBER AND PORTFOLIO REFERENCE  S01486
      * FROM PF/PMCHRGPD TO GET THE TRADE DATE POSITIVE ASSETS (QCPTPA)   S01486
      * AND THE TRADE DATE NEGATIVE ASSETS (QCPTNA)
      *
     C***********NLIST     CHAINPMPOTTPP             76                   S01486
     C           NLIST     CHAINPMPOTTPD             76                   S01486
      *
     C           *IN76     IFEQ '1'                        - B1
     C                     Z-ADD*ZEROS    WWMVAL
     C                     ELSE                            - X1
     C*
     C** USE TRADE OR VALUE DATE TOTALS AS APPROPRIATE
     C***********P9TVPS    IFEQ 'T'                                B08040 S01486
     C           FCTVPS    IFEQ 'T'                                       S01486
     C                     Z-ADDQCPTPA    WWMVAL
     C****                 ADD  QCPTNA    WWMVAL                          R05867
     C           WWMVAL    SUB  QCPTNA    WWMVAL                          R05867
     C           WWMVAL    ADD  QCPTAI    WWMVAL                          B07806
     C           WWMVAL    ADD  QCPTNI    WWMVAL                          B07806
     C                     ELSE                                           B08040
     C                     Z-ADDQCPVPA    WWMVAL                          B08040
     C           WWMVAL    SUB  QCPVNA    WWMVAL                          B08040
     C****       WWMVAL    ADD  QCPVAI    WWMVAL                          B08040
     C****       WWMVAL    SUB  QCPVNI    WWMVAL                          B08040
     C           WWMVAL    ADD  QCPTAI    WWMVAL                          B08040
     C           WWMVAL    ADD  QCPTNI    WWMVAL                          B08040
     C                     END                                            B08040
      *                                                                   R05867
     C           WWMVAL    IFLT 0                                         R05867
     C                     Z-ADD0         WWMVAL                          R05867
     C                     END                                            R05867
      *
      **ACCESS*LF/SDCURRL0*USING*PORTFOLIO*CURRENCY**************         S01486
      ***********                                                         S01486
     C***********PNPTCY    CHAINSDCURRL0             80                   S01486
      ***********                                                         S01486
     C************IN80     IFEQ '1'                        - B2           S01486
     C***********          Z-ADD13        DBASE            ***************S01486
     C***********          MOVEL'SDCURRL0'DBFILE           **DB ERROR 13**S01486
     C***********          MOVELPNPTCY    DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access Portfolio currency details                               S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM PNPTCY    P@CYCD                          S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD11        DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 011 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CYCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E2
      *
      * CONVERT MARKET VALUE IN PORTFOLIO CURRENCY INTO MARKET VALUE
      * IN BANK CHARGING CURRENCY
      *
     C                     Z-ADDA6SPRT    ZRATEF
     C                     Z-ADDA6NBDP    ZCDPF
     C                     MOVE A6MDIN    ZMDINF
     C                     Z-ADDWWC9N2    ZRATET
     C                     Z-ADDWWDAN2    ZCDPT
     C                     MOVE WWA8S2    ZMDINT
     C                     MOVE PNPTCY    ZCCYF
     C                     MOVE PNBCGY    ZCCYT
     C                     Z-ADDWWMVAL    ZAMTF
     C/COPY WNCPYSRC,PM1200C001
     C                     EXSR ZCCYCN
     C/COPY WNCPYSRC,PM1200C002
     C                     Z-ADDZAMTT     WWMVAL
     C                     END                             - E1
      *
      * FORMAT THE CUSTOMER SETTLEMENT ACCOUNT DETAILS
      *
     C                     EXSR #P03
      *
     C                     ENDSR                           **#P02 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P03     - FORMAT CUSTOMER SETTLEMENT ACCOUNT DETAILS            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P02     - ACCESS PORTFOLIO DETAILS AND TOTALS                   *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCUSA   - RETAIL CUSTOMER NUMBER FROM PNCUSA                    *
      * WWACNO   - RETAIL ACCOUNT NUMBER                                 *
      * WWCNU3   - CUSTOMER NUMBER OF THE CUSTOMER SETTLEMENT ACCOUNT    *
      * WWACO3   - ACCOUNT CODE OF THE CUSTOMER SETTLEMENT ACCOUNT       *
      * WWACS3   - ACCOUNT SEQUENCE OF THE CUSTOMER SETTLEMENT ACCOUN    *
      *                                                                  *
      ********************************************************************
     C           #P03      BEGSR                           **#P03 BEGSR **
      *
     C                     MOVEAPNCUSA    CUS
      *
      * CHECK IF IT IS A RETAIL NUMBER OR A FULL MIDAS KEY
      *
     C********** CUS,11    IFEQ *ZEROS                     - B1                             BUG1818
     C********** CUS,12    ANDEQ*ZEROS                                                      BUG1818
     C********** CUS,11    OREQ *BLANKS                                                     BUG1818
     C********** CUS,12    ANDEQ*BLANKS                                                     BUG1818
     C           CUS,17    IFEQ *ZEROS                     - B1                             BUG1818
     C           CUS,18    ANDEQ*ZEROS                                                      BUG1818
     C           CUS,17    OREQ *BLANKS                                                     BUG1818
     C           CUS,18    ANDEQ*BLANKS                                                     BUG1818
      *
      * PROCESS RETAIL NUMBER
      *
     C                     MOVEACUS,1     WWCUSA
     C                     MOVE WWCUSA    WWACNO
      *
      * CHECK IF THIS RETAIL NUMBER EXISTS
      *
     C           WWACNO    CHAINACNUM                72
     C           *IN72     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD14        DBASE            ***************
     C***********          MOVEL'ACNUM   'DBFILE           **DB ERROR 14**S01486
     C                     MOVE 'ACNUM   'DBFILE           **DB ERROR 14**S01486
     C                     MOVELWWACNO    DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E2
      *
      * GET THE FULL MIDAS KEY FROM LF/ACNUM
      *
     C                     MOVE CNUM      WWCNU3
     C                     MOVE ACOD      WWACO3
     C                     MOVE ACSQ      WWACS3
     C                     MOVE BRCA      WWBRC3                          S01486
      *
     C                     ELSE                            - X1
      *
      **GET*THE*FULL*MIDAS*KEY*FROM*PF/PMPORTPP******************         S01486
      * GET THE FULL MIDAS KEY FROM PF/PMPORTPD                           S01486
      *
     C                     MOVEACUS,1     WWCNU3
     C                     MOVEACUS,7     WWACO3
     C**********           MOVEACUS,11    WWACS3                                              CGL029
     C                     MOVEACUS,17    WWACS3                                              CGL029
     C                     MOVE PNCUSB    WWBRC3                          S01486
      *
     C                     END                             - E1
      *
     C                     ENDSR                           **#P03 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P04     - DETERMINE EFFECTIVE CHARGE DETAILS                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCGCO   - EFFECTIVE CHARGE CODE                                 *
      * WWCGSP   - EFFECTIVE CHARGE SPREAD                               *
      * WWCGSI   - EFFECTIVE CHARGE SPREAD INDICATOR                     *
      *                                                                  *
      ********************************************************************
     C           #P04      BEGSR                           **#P04 BEGSR **
      *
      * SET EFFECTIVE CHARGE DETAILS ACCORDING TO THE EFFECTIVE CHARGE
      * INDICATOR
      *
     C           POCGEI    IFEQ 'C'                        - B1
     C                     MOVE POCGCO    WWCGCO
     C                     Z-ADDPOCGSP    WWCGSP
     C                     MOVE POCGSI    WWCGSI
     C                     END                             - E1
      *
     C           POCGEI    IFEQ 'N'                        - B1
     C                     MOVE POCCSP    WWCGCO
     C                     Z-ADDPOCSSP    WWCGSP
     C                     MOVE POCISP    WWCGSI
     C                     END                             - E1
      *
      **IF*THE*EFFECTIVE*CHARGE*CODE*IS*NOT*BLANK,*ACCESS*PF/PMCGCDPP     S01486
      * IF THE EFFECTIVE CHARGE CODE IS NOT BLANK, ACCESS PF/PMCGCDPD     S01486
      *
     C           WWCGCO    IFNE *BLANKS                    - B1
      *
     C***********CLIST     CHAINPMCGCDPP             73                   S01486
     C           CLIST     CHAINPMCGCDPD             73                   S01486
      *
     C           *IN73     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD15        DBASE            ***************
     C***********          MOVEL'PMCGCDPP'DBFILE           **DB ERROR 15**S01486
     C                     MOVE 'PMCGCDPD'DBFILE           **DB ERROR 15**S01486
     C                     MOVELCKEY      DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E2
      *
     C                     END                             - E1
      *
     C**                   MOVE PNBCGY    WWOTT1
     C**                   MOVE WWCGCO    WWOTT2
      *
     C                     ENDSR                           **#P04 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P05     - PROCESS CHARGE ADJUSTEMENTS                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P09     - GENERATE CHARGE ACCRUAL ENTRIES                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTCTP   - TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY       *
      * WWCGAD   - CHARGES ACCRUED TODAY                                 *
      *                                                                  *
      ********************************************************************
     C           #P05      BEGSR                           **#P05 BEGSR **
      *
      * IF CHARGE ADJUSTEMENT SIGN IS +, GENERATE ACCRUAL ENTRIES AND
      * ADD CHARGE ADJUSTEMENT AMOUNT TO THE CHARGES ACCRUED TO DATE   ED
      * OTHERWISE SUBTRACT THE AMOUNTS
      *
     C           POCGND    IFLE POCSND
     C                     Z-ADDPOCGND    WWVALD
     C                     ELSE
     C                     Z-ADDPOCSND    WWVALD
     C                     END
      *
     C           POCGAS    IFEQ '+'                        - B1
     C                     Z-ADDPOCGAJ    WWTCTP
     C                     EXSR #P09
     C                     ADD  POCGAJ    WWCGAD
      *
     C                     ELSE                            - X1
      *
     C                     Z-SUBPOCGAJ    WWTCTP
     C                     EXSR #P09
     C                     SUB  POCGAJ    WWCGAD
     C                     END                             - E1
      *
      * ZEROISE THE CHARGE ADJUSTEMENT AMOUNT AND BLANK OUT THE CHARGE
      * ADJUSTEMENT SIGN
      *
     C                     Z-ADD*ZEROS    POCGAJ
     C                     MOVE *BLANKS   POCGAS
      *
     C                     ENDSR                           **#P05 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P06     - PROCESS CHARGE ACCRUALS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P08     - DETERMINE TOTAL CHARGE                                *
      * #P09     - GENERATE CHARGE ACCRUAL ENTRIES                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTCTP   - TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY       *
      * WWCGAD   - CHARGES ACCRUED TODAY                                 *
      *                                                                  *
      ********************************************************************
     C           #P06      BEGSR                           **#P06 BEGSR **
      *
      * DETERMINE THE TOTAL CHARGE FOR THIS PERIOD IN BANK CHARGING
      * CURRENCY
      *
     C                     EXSR #P08
     C/COPY WNCPYSRC,PM1200C011
      *
      * IF THE TOTAL CHARGE FOR THIS PERIOD IS NOT ZERO, GENERATE
      * ACCRUAL ENTRIES WITH TOTAL CHARGE FOR THIS PERIOD IN BANK
      * CHARGING CURRENCY
      *
     C                     Z-ADDPOCGND    WWVALD
     C           WWTCTP    CASNE*ZEROS    #P09             - B1
     C                     END                             - E1
      *
      * SET THE CHARGES ACCRUED TODAY (POCGAT) EQUAL TO THE TOTAL CHARGE
      * FOR THIS PERIOD IN BANK CHARGING CURRENCY
      *
     C                     Z-ADDWWTCTP    POCGAT
      *
      * ADD THE TOTAL CHARGE FOR THIS PERIOD IN BANK CHARGING CURRENCY
      * TO THE CHARGES ACCRUED TODAY
      *
     C                     ADD  WWTCTP    WWCGAD
      *
     C                     ENDSR                           **#P06 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P07     - PROCESS CHARGE SETTLEMENTS                            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZCCYCN   - CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER          *
      * #P10     - GENERATE STANDARD SETTLEMENT ENTRIES                  *
      * #P11     - GENERATE INTER-BRANCH SETTLEMENT ENTRIES              *
      * #P12     - GENERATE CROSS-CURRENCY SETTLEMENT ENTRIES            *
      * #P13     - GENERATE BASE CURRENCY SETTLEMENT ENTRIES             *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTCTP   - TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY       *
      * WWC9N2   - SPOT RATE OF BANK CHARGING CURRENCY                   *
      * WWDAN2   - NUMBER OF DECIMAL PLACE OF BANK CHARGING CURRENCY     *
      * WWA8S2   - MULTIPLY/DIVIDE IND OF BANK CHARGING CURRENCY         *
      * WWC9N3   - SPOT RATE OF CUSTOMER SETTLEMENT CURRENCY             *
      * WWDAN3   - NUMBER OF DECIMAL PLACE IN CUSTOMER SETTLEMENT CCY    *
      * WWA8S3   - MULTIPLY/DIVIDE IND OF CUSTOMER SETTLEMENT CCY        *
      * WWTCHA   - TOTAL CHARGES ACCRUED IN CUSTOMER SETTLEMENT CCY      *
      * WWDSNB   - CUSTOMER BRANCH CODE                                  *
      * WWC9N0   - SPOT RATE OF BASE CURRENCY                            *
      * WWDAN0   - NUMBER OF DECIMAL PLACE OF BASE CURRENCY0             *
      * WWA8S0   - MULTIPLY/DIVIDE IND OF BASE CURRENCY                  *
      * WWTCSC   - TOTAL CHARGES ACCRUED IN BASE CURRENCY                *
      *                                                                  *
      ********************************************************************
     C           #P07      BEGSR                           **#P07 BEGSR **
      *
      * SET THE TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY        O
      *
     C                     Z-ADDWWCGAD    WWTCTP
      *
      * SET THE CHARGES ACCRUED TO DATE TO ZERO                        O
      *
     C                     Z-ADD*ZEROS    WWCGAD
     C/COPY WNCPYSRC,PM1200C007
      *
      * CONVERT THE TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY
      * INTO CUSTOMER SETTLEMENT CURRENCY
      *
     C                     Z-ADDWWC9N2    ZRATEF
     C                     Z-ADDWWDAN2    ZCDPF
     C                     MOVE WWA8S2    ZMDINF
     C                     Z-ADDWWC9N3    ZRATET
     C                     Z-ADDWWDAN3    ZCDPT
     C                     MOVE WWA8S3    ZMDINT
     C                     MOVE PNBCGY    ZCCYF
     C                     MOVE PNCSCY    ZCCYT
     C                     Z-ADDWWTCTP    ZAMTF
     C/COPY WNCPYSRC,PM1200C008
     C                     EXSR ZCCYCN
     C/COPY WNCPYSRC,PM1200C005
     C                     Z-ADDZAMTT     WWTCHA
      *
      * SET CHARGES SETTLED TODAY
     C                     Z-ADDWWTCHA    POCSTT
      *
      * GENERATE STANDARD SETTLEMENT ENTRIES
     C           WWTCHA    IFNE *ZEROS                     - B1
     C                     EXSR #P10
      *
      * GENERATE INTER-BRANCH SETTLEMENT ENTRIES
     C                     MOVE BBBRCD    WWDSNB
     C***********WWBRCD    CASNEWWDSNB    #P11             - B2           S01486
     C           WWBRC3    CASNEWWDSNB    #P11             - B2           S01486
     C                     END                             - E2
      *
      * IF BANK CHARGING CURRENCY IS NOT EQUAL TO CUSTOMER SETTLEMENT
      * CURRENCY, GENERATE CROSS-CURRENCY SETTLEMENTS ENTRIES
      *
     C           PNBCGY    IFNE PNCSCY                     - B2
     C                     EXSR #P12
      *
      * CONVERT THE TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY
      * INTO AN AMOUNT IN BASE CURRENCY
      *
     C**         BJCYCD    IFNE PNBCGY                     - B3           33619
     C**         BJCYCD    ANDNEPNCSCY                     - B3           33619
     C                     Z-ADDWWC9N2    ZRATEF
     C                     Z-ADDWWDAN2    ZCDPF
     C                     MOVE WWA8S2    ZMDINF
     C                     Z-ADDWWC9N0    ZRATET
     C                     Z-ADDWWDAN0    ZCDPT
     C                     MOVE WWA8S0    ZMDINT
     C                     MOVE PNBCGY    ZCCYF
     C                     MOVE BJCYCD    ZCCYT
     C                     Z-ADDWWTCTP    ZAMTF
     C/COPY WNCPYSRC,PM1200C006
     C                     EXSR ZCCYCN
     C/COPY WNCPYSRC,PM1200C003
     C                     Z-ADDZAMTT     WWTCSC
      *
      * GENERATE BASE CURRENCY SETTLEMENT ENTRIES
      *
     C                     EXSR #P13
     C**                   END                             - E3           33619
      *
     C                     END                             - E2
      *
     C                     END                             - E1
      *
      * SET THE CHARGES SETTLED TODAY EQUAL TO THE TOTAL CHARGES ACCRUED
      * IN CUSTOMER SETTLEMENT CURRENCY
      *
     C                     Z-ADDWWTCHA    POCSTT
      *
     C                     ENDSR                           **#P07 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P08     - DETERMINE TOTAL CHARGE                                *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZPMCRG   - CALCULATE PORTFOLIO MANAGEMENT CHARGES                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P06     - PROCESS CHARGE ACCRUALS                               *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCGCO   - EFFECTIVE CHARGE CODE                                 *
      * WWMVAL   - MARKET VALUE                                          *
      * WWCGSP   - EFFECTIVE CHARGE SPREAD                               *
      * WWCGSI   - EFFECTIVE CHARGE SPREAD INDICATOR                     *
      * WWTCTP   - TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY       *
      *                                                                  *
      ********************************************************************
     C           #P08      BEGSR                           **#P08 BEGSR **
      *
      * CALCULATE THE CHARGE FOR THIS PERIOD IN BANK CHARGING CURRENCY
      *
     C           POCGLD    IFEQ *ZEROS
     C                     Z-ADDPNDPOP    POCGLD
     C                     END
     C           WWCGCO    IFNE *BLANKS                    - B1
      *
     C           POCGLD    IFEQ *ZEROS                     - B2
     C                     Z-ADDPNDPOP    POCGLD
     C                     END                             - E2
      *
     C                     Z-ADDWWMVAL    ZAMT
     C***********          Z-ADDP9CDYB    ZDYBS                           S01486
     C***********          Z-ADDP9CDVB    ZDVBS                           S01486
     C                     Z-ADDFCCDYB    ZDYBS                           S01486
     C                     Z-ADDFCCDVB    ZDVBS                           S01486
     C                     Z-ADDPOCGLD    ZFMDAT
     C                     Z-ADDPOCGND    ZTODAT
     C                     Z-ADDWWCGSP    ZSPRD
     C                     MOVE WWCGSI    ZSPRI
     C                     MOVE P5CGBS    ZCGBS
     C                     MOVE P5CGMT    ZCGMT
     C                     Z-ADDP5MINC    ZMINC
     C                     EXSR ZPMCRG
     C                     Z-ADDZCHGA     WWTCTP
     C                     ELSE                            - X1
     C                     Z-ADD*ZEROS    WWTCTP
     C                     END                             - E1
      *
     C                     ENDSR                           **#P08 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P09     - GENERATE CHARGE ACCRUAL ENTRIES                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      * #W01     - WRITE SUSPENSE ENTRIES TO PF/GEPMPD                   *
      * #W02     - WRITE NON-SUSPENSE ENTRIES TO PF/GEPMPD               *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P05     - PROCESS CHARGE ADJUSTEMENTS                           *
      * #P06     - PROCESS CHARGE ACCRUALS                               *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWDTNB   - BRANCH INTERNAL CUSTOMER NUMBER                       *
      * WWACSQ   - BRANCH START ACCOUNT SEQUENCE                         *
      * WWCNUB   - CUSTOMER NUMBER ALPHANUMERIC TO SET POSTING NARR      *
      * WWTCTP   - TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY       *
      * WWACOD   - ACCOUNT CODE TO ACCESS LF/SDACODL1                    *
      *                                                                  *
      ********************************************************************
     C           #P09      BEGSR                           **#P09 BEGSR **
      *
     C                     MOVE WWBICN    CNUM
     C                     MOVE PNBCGY    CCY
     C                     MOVE P5ACAC    ACOD
     C**                   MOVE WWACSQ    ACSQ                            33619
     C                     MOVE '01'      ACSQ                            33619
     C                     MOVE BBBRCD    BRCA                            S01486
     C                     Z-ADDWWVALD    VALD
     C                     MOVEA*BLANKS   NAR
     C                     MOVE POCNUM    WWCNUB
     C                     MOVEAWWCNUB    NAR,1
     C                     MOVEAPOPTFR    NAR,8
     C                     MOVEAWWCGCO    NAR,13
     C                     MOVEAP5CNAR    NAR,16
     C                     MOVEANAR       PNAR
     C                     Z-ADDWWTCTP    PSTA
      *
      * SET DR/CR INDICATOR ACCORDING TO THE SIGN OF THE AMOUNT
     C           PSTA      IFGT *ZEROS                     - B1
     C                     Z-ADD*ZEROS    DRCR
     C                     ELSE                            - X1
     C                     Z-ADD1         DRCR
     C                     Z-SUBPSTA      PSTA
     C                     END                             - E1
      *
      * ACCESS LF/SDACODL1 TO GET THE ACCOUNT TYPE
     C                     MOVE ACOD      WWACOD
     C                     EXSR #ACOD
      *
      * ACCESS ACCOUNT DETAILS
     C                     MOVE *BLANKS   RECI
     C           LLIST     CHAINACCNT                71
      *
     C***********          MOVE BBBRCD    BRCD                            S01486
     C                     MOVE A5ACTY    ATYP
      *
      * NO LIVE RECORD FOUND, GENERATE ENTRY TO SUSPENSE
     C           A5ACTY    IFEQ 'R'                        - B1
     C           RECI      ANDNE'D'
     C                     EXSR #W01
      *
     C                     ELSE                            - X1
     C           A5ACTY    IFEQ 'R'                        - B2
     C*                    Z-ADD94050     TRAT                            SA9001
     C*                    Z-ADD97090     TRAT                      SA9001B10662
     C                     Z-ADD94050     TRAT                            B10662
     C                     Z-ADD1         RIND
     C                     ELSE                            - X2
      *
      * OTHERWISE SET ALL AT ZERO
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C                     Z-ADD*ZEROS    ACNO
     C                     END                             - E2
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** determine the Profit Centre.                                     CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     EXSR #P16                                      CAC003
     C                     ENDIF                                          CAC003
      *
      * WRITE A RECORD TO PF/GEPMPD
     C                     EXSR #W02
     C                     END                             - E1
      *----------------------------------------------------------------
      *
      **IN*COME*ACCOUNT*CODE*FROM*PF/PMCGCDPP********************         S01486
      * IN COME ACCOUNT CODE FROM PF/PMCGCDPD                             S01486
     C                     MOVE P5INCA    ACOD
      *
      * REVERSE THE DRCR INDICATOR
     C           DRCR      IFEQ *ZEROS                     - B1
     C                     Z-ADD1         DRCR
     C                     ELSE                            - X1
     C                     Z-ADD*ZEROS    DRCR
     C                     END                             - E1
      *
      * ACCESS LF/SDACODL1 TO GET THE ACCOUNT TYPE
     C                     MOVE ACOD      WWACOD
     C                     EXSR #ACOD
      *
      * ACCESS ACCOUNT DETAILS
     C                     MOVE *BLANKS   RECI
     C           LLIST     CHAINACCNT                71
      *
     C                     MOVE A5ACTY    ATYP
     C***********          MOVE BBBRCD    BRCD                            S01486
     C                     MOVE BBBRCD    BRCA                            S01486
      *
      * NO LIVE RECORD FOUND, GENERATE ENTRY TO SUSPENSE
     C           A5ACTY    IFEQ 'R'                        - B1
     C           RECI      ANDNE'D'
     C                     EXSR #W01
      *
     C                     ELSE                            - X1
     C           A5ACTY    IFEQ 'R'                        - B2
     C                     Z-ADD94050     TRAT
     C                     Z-ADD1         RIND
     C                     ELSE                            - X2
      *
      * OTHERWISE SET ALL AT ZERO
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C                     Z-ADD*ZEROS    ACNO
     C                     END                             - E2
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** determine the Profit Centre.                                     CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     EXSR #P16                                      CAC003
     C                     ENDIF                                          CAC003
      *
      * WRITE A RECORD TO PF/GEPMPD
     C                     EXSR #W02
     C                     END                             - E1
      *
     C                     ENDSR                           **#P09 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P10     - GENERATE STANDARD SETTLEMENT ENTRIES                  *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      * #W01     - WRITE SUSPENSE ENTRIES TO PF/GEPMPD                   *
      * #W02     - WRITE NON-SUSPENSE ENTRIES TO PF/GEPMPD               *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P07     - PROCESS CHARGE SETTLEMENTS                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCNU3   - CUSTOMER NUMBER OF THE CUSTOMER SETTLEMENT ACCOUNT    *
      * WWACO3   - ACCOUNT CODE OF THE CUSTOMER SETTLEMENT ACCOUNT       *
      * WWACS3   - ACCOUNT SEQUENCE OF THE CUSTOMER SETTLEMENT ACCOUN    *
      * WWTCHA   - TOTAL CHARGES ACCRUED IN CUSTOMER SETTLEMENT CCY      *
      * WWACOD   - ACCOUNT CODE TO ACCESS LF/SDACODL1                    *
      * WWDSNB   - CUSTOMER SETTLEMENT BRANCH                            *
      * WWDTNB   - BRANCH INTERNAL CUSTOMER NUMBER                       *
      * WWACSQ   - BRANCH START ACCOUNT SEQUENCE                         *
      * WWCNUB   - CUSTOMER NUMBER ALPHANUMERIC TO SET POSTING NARR      *
      * WWTCTP   - TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY       *
      *                                                                  *
      ********************************************************************
     C           #P10      BEGSR                           **#P10 BEGSR**
      *                                                                  *
     C                     MOVE WWCNU3    CNUM
     C                     MOVE PNCSCY    CCY
     C                     MOVE WWACO3    ACOD
     C                     MOVE WWACS3    ACSQ
     C                     MOVE WWBRC3    BRCA                            S01486
     C                     Z-ADDPOCSND    VALD
     C                     MOVEA*BLANKS   NAR
     C                     MOVEAP5CNAR    NAR,1
     C                     MOVEA'ON'      NAR,17
     C                     MOVEAPOPTFR    NAR,20
     C                     MOVEANAR       PNAR
     C                     Z-ADDWWTCHA    PSTA
     C/COPY WNCPYSRC,PM1200C012
      *                                                                  *
      * SET DR/CR INDICATOR ACCORDING TO THE SIGN OF THE AMOUNT
     C           PSTA      IFGT *ZEROS                     - B1
     C                     Z-ADD*ZEROS    DRCR
     C                     ELSE                            - X1
     C                     Z-ADD1         DRCR
     C                     Z-SUBPSTA      PSTA
     C                     END                             - E1
      *                                                                  *
      * ACCESS LF/SDACODL1
     C                     MOVE ACOD      WWACOD
     C                     EXSR #ACOD
      *                                                                  *
      * ACCESS ACCOUNT DETAILS
     C                     MOVE *BLANKS   RECI
     C           LLIST     CHAINACCNT                71
      *                                                                  *
     C           *IN71     IFEQ '1'
     C***********          MOVE PNCUSB    BRCD                            S01486
     C                     MOVE PNCUSB    BRCA                            S01486
     C                     END                             - E1
      *                                                                  *
     C***********          MOVE BRCD      WWBRCD                          S01486
     C                     MOVE BRCA      WWBRCD                          S01486
     C                     MOVE A5ACTY    ATYP
      *                                                                  *
      * NO LIVE RECORD FOUND, GENERATE ENTRY TO SUSPENSE
     C           A5ACTY    IFEQ 'R'                        - B1
     C           RECI      ANDNE'D'
     C                     EXSR #W01
     C                     ELSE                            - X1
      *                                                                  *
     C           A5ACTY    IFEQ 'R'                        - B2
     C                     Z-ADD94050     TRAT
     C                     Z-ADD1         RIND
     C                     ELSE                            - X2
      *                                                                  *
      * OTHERWISE SET ALL AT ZERO
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C                     Z-ADD*ZEROS    ACNO
     C                     END                             - E2
      **   show a narrative without customer detail                       R00142
     C                     MOVE *BLANKS   PNAR                            R00142
     C                     MOVELALDON     PNAR                            R00142
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** determine the Profit Centre.                                     CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     EXSR #P16                                      CAC003
     C                     ENDIF                                          CAC003
      *                                                                  *
      * WRITE A RECORD TO PF/GEPMPD
     C                     EXSR #W02
      *                                                                   R00142
      **   Reset narratives for internal account                          R00142
     C                     MOVEANAR       PNAR                            R00142
      *                                                                   R00142
     C                     END                             - E1
      *----------------------------------------------------------------
      *                                                                  *
     C                     MOVE WWBICN    CNUM
     C                     MOVE PNBCGY    CCY
     C                     MOVE P5ACAC    ACOD
     C**                   MOVE WWACSQ    ACSQ                            33619
     C                     MOVE '01'      ACSQ                            33619
     C                     MOVE BBBRCD    BRCA                            S01486
     C                     MOVEA*BLANKS   NAR
     C                     MOVE POCNUM    WWCNUB
     C                     MOVEAWWCNUB    NAR,1
     C                     MOVEAPOPTFR    NAR,8
     C                     MOVEAWWCGCO    NAR,13
     C                     MOVEAP5CNAR    NAR,16
     C                     MOVEANAR       PNAR
     C                     Z-ADDWWTCTP    PSTA
      *                                                                  *
      * SET DR/CR INDICATOR, ACCORDING TO THE SIGN OF THE AMOUNT
     C           PSTA      IFGT *ZEROS                     - B1
     C                     Z-ADD1         DRCR
     C                     ELSE                            - X1
     C                     Z-ADD*ZEROS    DRCR
     C                     Z-SUBPSTA      PSTA
     C                     END                             - E1
      *                                                                  *
      * ACCESS LF/SDACODL1 WITH ACCRUAL ACCOUNT CODE
     C                     MOVE ACOD      WWACOD
     C                     EXSR #ACOD
      *                                                                  *
      * ACCESS ACCOUNT DETAILS
     C                     MOVE *BLANKS   RECI
     C           LLIST     CHAINACCNT                71
      *                                                                  *
     C***********          MOVE BBBRCD    BRCD                            S01486
     C                     MOVE A5ACTY    ATYP
      *                                                                  *
     C           A5ACTY    IFEQ 'R'                        - B1
     C           RECI      ANDNE'D'
      *                                                                  *
      * NO LIVE RECORD FOUND, GENERATE ENTRY TO SUSPENSE
     C                     EXSR #W01
     C                     ELSE                            - X1
      *                                                                  *
     C           A5ACTY    IFEQ 'R'                        - B2
     C                     Z-ADD94050     TRAT
     C                     Z-ADD1         RIND
     C                     ELSE                            - X2
      *                                                                  *
      * OTHERWISE SET ALL AT ZERO
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C                     Z-ADD*ZEROS    ACNO
     C                     END                             - E2
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** determine the Profit Centre.                                     CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     EXSR #P16                                      CAC003
     C                     ENDIF                                          CAC003
      *                                                                  *
      * WRITE A RECORD TO PF/GEPMPD
     C                     EXSR #W02
     C                     END                             - E1
     C/COPY WNCPYSRC,PM1200C009
      *
     C                     ENDSR                           **#P10 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P11     - GENERATE INTER-BRANCH SETTLEMENT ENTRIES              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      * #W01     - WRITE SUSPENSE ENTRIES TO PF/GEPMPD                   *
      * #W02     - WRITE NON-SUSPENSE ENTRIES TO PF/GEPMPD               *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P07     - PROCESS CHARGE SETTLEMENTS                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWBRCA   - BRANCH CODE ALPHANUMERIC TO ACCESS LF/SDBRCHL1        *
      * WWCNUB   - CUSTOMER NUMBER ALPHANUMERIC TO SET POSTING NARR      *
      * WWTCHA   - TOTAL CHARGES ACCRUED IN CUSTOMER SETTLEMENT CCY      *
      * WWDSNB   - CUSTOMER SETTLEMENT BRANCH                            *
      * WWACOD   - ACCOUNT CODE TO ACCESS LF/SDACODL1                    *
      * WWDTNB   - BRANCH INTERNAL CUSTOMER NUMBER                       *
      * WWFRNB   - INTERBRANCH BRANCH ACCOUNT CODE                       *
      * WWACSQ   - BRANCH START ACCOUNT SEQUENCE                         *
      * WWTCTP   - TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY       *
      *                                                                  *
      ********************************************************************
     C           #P11      BEGSR                           **#P11 BEGSR**
     C*                                                                   S01486
     C**  Create Interbranch entry for settlement branch                  S01486
     C*                                                                   S01486
     C                     MOVE PNCSCY    CCY                             S01486
     C                     MOVE POCSND    VALD                            S01486
     C                     MOVEA*BLANKS   NAR                             S01486
     C                     MOVE POCNUM    WWCNUB                          S01486
     C                     MOVE WWCNUB    NAR,1                           S01486
     C                     MOVE POPTFR    NAR,8                           S01486
     C                     MOVE WWCGCO    NAR,13                          S01486
     C                     MOVE P5CNAR    NAR,16                          S01486
     C                     MOVEAPNAR      NAR                             S01486
     C                     MOVE WWTCHA    PSTA                            S01486
     C                     MOVE WWBRC3    BRCA                            S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               S01486
     C           WWBRC3    LOKUPBRCD,B                   79               S01486
     C*                                                                   S01486
     C           *IN79     IFEQ '0'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD30        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 030 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELWWBRC3    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set DR/CR indicator according to the sign of the amount         S01486
     C*                                                                   S01486
     C           PSTA      IFGT *ZERO                                     S01486
     C                     Z-ADD1         DRCR                            S01486
     C                     MOVE A8DTAC    ACOD                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C                     Z-ADD*ZERO     DRCR                            S01486
     C                     MOVE A8DFAC    ACOD                            S01486
     C                     Z-SUBPSTA      PSTA                            S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     MOVE '01'      ACSQ                            S01486
     C*                                                                   S01486
     C**  Access Account code details                                     S01486
     C*                                                                   S01486
     C                     MOVE ACOD      WWACOD                          S01486
     C                     EXSR #ACOD                                     S01486
     C*                                                                   S01486
     C                     MOVE A5ACTY    ATYP                            S01486
     C*                                                                   S01486
     C**  Access branch details (Customer or Main branch)                 S01486
     C*                                                                   S01486
     C           BKIEMB    IFEQ 'N'                                       S01486
     C           BKMABR    OREQ BBBRCD                                    S01486
     C           BKMABR    OREQ WWBRC3                                    S01486
     C*                    MOVE BBBRCD    P@BRCD                          S01486
     C                     MOVE BBBRCD    P@BRCD                          CAC003
     C                     ELSE                                           S01486
     C                     MOVE BKMABR    P@BRCD                          S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               S01486
     C           P@BRCD    LOKUPBRCD,B                   79               S01486
     C*                                                                   S01486
     C           *IN79     IFEQ '0'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD31        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 031 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@BRCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Access Account details                                          S01486
     C*                                                                   S01486
     C**********           MOVE A8BICN    CNUM                                         S01486 184926
     C                     MOVE BICN,B    CNUM                                                184926
     C                     MOVE *BLANKS   RECI                            S01486
     C           LLIST     CHAINACCNT                71                   S01486
     C*                                                                   S01486
     C**  Generate an entry to Suspense if no live record found           S01486
     C*                                                                   S01486
     C           A5ACTY    IFEQ 'R'                        - B1           S01486
     C           RECI      ANDNE'D'                                       S01486
     C                     EXSR #W01                                      S01486
     C*                                                                   S01486
     C                     ELSE                            - X1           S01486
     C           A5ACTY    IFEQ 'R'                        - B2           S01486
     C                     Z-ADD94050     TRAT                            S01486
     C                     Z-ADD1         RIND                            S01486
     C*                                                                   S01486
     C**  Otherwise set all to zero                                       S01486
     C*                                                                   S01486
     C                     ELSE                            - X2           S01486
     C                     Z-ADD*ZEROS    TRAT                            S01486
     C                     Z-ADD*ZEROS    RIND                            S01486
     C                     Z-ADD*ZEROS    ACNO                            S01486
     C                     ENDIF                           - E2           S01486
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** move the Primary Funding Profit Centre.                          CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     MOVE FTPRFP    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   S01486
     C**  Write a record to PF/GEPMPD                                     S01486
     C*                                                                   S01486
     C                     EXSR #W02                                      S01486
     C                     ENDIF                           - E1           S01486
     C*                                                                   S01486
     C*---------------------------------------------------------------*   S01486
     C*                                                                   S01486
     C**  Create Interbranch entry for Customer/Main branch               S01486
     C*                                                                   S01486
     C                     MOVE P@BRCD    BRCA                            S01486
     C                     Z-ADDWWTCHA    PSTA                            S01486
     C*                                                                   S01486
     C**  Set DR/CR indicator according to the sign of the amount         S01486
     C*                                                                   S01486
     C           PSTA      IFGT *ZERO                                     S01486
     C                     Z-ADD*ZERO     DRCR                            S01486
     C                     MOVE A8DFAC    ACOD                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C                     Z-ADD1         DRCR                            S01486
     C                     MOVE A8DTAC    ACOD                            S01486
     C                     Z-SUBPSTA      PSTA                            S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Access Account code details                                     S01486
     C*                                                                   S01486
     C                     MOVE ACOD      WWACOD                          S01486
     C                     EXSR #ACOD                                     S01486
     C*                                                                   S01486
     C**  Access branch details                                           S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               S01486
     C           WWBRC3    LOKUPBRCD,B                   79               S01486
     C*                                                                   S01486
     C           *IN79     IFEQ '0'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD32        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 032 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELWWBRC3    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Access Account details                                          S01486
     C*                                                                   S01486
     C**********           MOVE A8BICN    CNUM                                         S01486 184926
     C                     MOVE BICN,B    CNUM                                                184926
     C                     MOVE *BLANKS   RECI                            S01486
     C           LLIST     CHAINACCNT                71                   S01486
     C*                                                                   S01486
     C**  Generate an entry to Suspense if no live record found           S01486
     C*                                                                   S01486
     C           A5ACTY    IFEQ 'R'                        - B1           S01486
     C           RECI      ANDNE'D'                                       S01486
     C                     EXSR #W01                                      S01486
     C*                                                                   S01486
     C                     ELSE                            - X1           S01486
     C           A5ACTY    IFEQ 'R'                        - B2           S01486
     C                     Z-ADD94050     TRAT                            S01486
     C                     Z-ADD1         RIND                            S01486
     C*                                                                   S01486
     C**  Otherwise set all to zero                                       S01486
     C*                                                                   S01486
     C                     ELSE                            - X2           S01486
     C                     Z-ADD*ZEROS    TRAT                            S01486
     C                     Z-ADD*ZEROS    RIND                            S01486
     C                     Z-ADD*ZEROS    ACNO                            S01486
     C                     ENDIF                           - E2           S01486
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** move the Primary Funding Profit Centre.                          CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     MOVE FTPRFP    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   S01486
     C**  Write a record to PF/GEPMPD                                     S01486
     C*                                                                   S01486
     C                     EXSR #W02                                      S01486
     C                     ENDIF                           - E1           S01486
     C*                                                                   S01486
     C           BKIEMB    IFEQ 'N'                                       S01486
     C           BKMABR    OREQ BBBRCD                                    S01486
     C           BKMABR    OREQ WWBRC3                                    S01486
     C*                    GOTO #P119                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C*---------------------------------------------------------------*   S01486
     C*                                                                   S01486
     C**  Create Interbranch entry for Main branch                        S01486
     C*                                                                   S01486
     C                     MOVE BKMABR    BRCA                            S01486
     C                     Z-ADDWWTCHA    PSTA                            S01486
     C*                                                                   S01486
     C**  Access Main branch details                                      S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               S01486
     C           BKMABR    LOKUPBRCD,B                   79               S01486
     C*                                                                   S01486
     C           *IN79     IFEQ '0'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD20        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 020 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELBKMABR    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set DR/CR indicator according to the sign of the amount         S01486
     C*                                                                   S01486
     C           PSTA      IFGT *ZERO                                     S01486
     C                     Z-ADD1         DRCR                            S01486
     C                     MOVE A8DTAC    ACOD                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C                     Z-ADD*ZERO     DRCR                            S01486
     C                     MOVE A8DFAC    ACOD                            S01486
     C                     Z-SUBPSTA      PSTA                            S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     MOVE '01'      ACSQ                            S01486
     C*                                                                   S01486
     C**  Access Account code details                                     S01486
     C*                                                                   S01486
     C                     MOVE ACOD      WWACOD                          S01486
     C                     EXSR #ACOD                                     S01486
     C*                                                                   S01486
     C                     MOVE A5ACTY    ATYP                            S01486
     C*                                                                   S01486
     C**  Access Customer branch details                                  S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               S01486
     C           BBBRCD    LOKUPBRCD,B                   79               S01486
     C*                                                                   S01486
     C           *IN79     IFEQ '0'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD33        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 033 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELBBBRCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Access Account details                                          S01486
     C*                                                                   S01486
     C**********           MOVE A8BICN    CNUM                                         S01486 184926
     C                     MOVE BICN,B    CNUM                                                184926
     C                     MOVE *BLANKS   RECI                            S01486
     C           LLIST     CHAINACCNT                71                   S01486
     C*                                                                   S01486
     C**  Generate an entry to Suspense if no live record found           S01486
     C*                                                                   S01486
     C           A5ACTY    IFEQ 'R'                        - B1           S01486
     C           RECI      ANDNE'D'                                       S01486
     C                     EXSR #W01                                      S01486
     C*                                                                   S01486
     C                     ELSE                            - X1           S01486
     C           A5ACTY    IFEQ 'R'                        - B2           S01486
     C                     Z-ADD94050     TRAT                            S01486
     C                     Z-ADD1         RIND                            S01486
     C*                                                                   S01486
     C**  Otherwise set all to zero                                       S01486
     C*                                                                   S01486
     C                     ELSE                            - X2           S01486
     C                     Z-ADD*ZEROS    TRAT                            S01486
     C                     Z-ADD*ZEROS    RIND                            S01486
     C                     Z-ADD*ZEROS    ACNO                            S01486
     C                     ENDIF                           - E2           S01486
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** move the Primary Funding Profit Centre.                          CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     MOVE FTPRFP    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   S01486
     C**  Write a record to PF/GEPMPD                                     S01486
     C*                                                                   S01486
     C                     EXSR #W02                                      S01486
     C                     ENDIF                           - E1           S01486
     C*                                                                   S01486
     C*---------------------------------------------------------------*   S01486
     C*                                                                   S01486
     C**  Create Interbranch entry for Customer branch                    S01486
     C*                                                                   S01486
     C                     MOVE BBBRCD    BRCA                            S01486
     C                     Z-ADDWWTCHA    PSTA                            S01486
     C*                                                                   S01486
     C**  Set DR/CR indicator according to the sign of the amount         S01486
     C*                                                                   S01486
     C           PSTA      IFGT *ZERO                                     S01486
     C                     Z-ADD*ZERO     DRCR                            S01486
     C                     MOVE A8DFAC    ACOD                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C                     Z-ADD1         DRCR                            S01486
     C                     MOVE A8DTAC    ACOD                            S01486
     C                     Z-SUBPSTA      PSTA                            S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Access Account code details                                     S01486
     C*                                                                   S01486
     C                     MOVE ACOD      WWACOD                          S01486
     C                     EXSR #ACOD                                     S01486
     C*                                                                   S01486
     C**  Access branch details                                           S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               S01486
     C           BKMABR    LOKUPBRCD,B                   79               S01486
     C*                                                                   S01486
     C           *IN79     IFEQ '0'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD34        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 034 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELBKMABR    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Access Account details                                          S01486
     C*                                                                   S01486
     C**********           MOVE A8BICN    CNUM                                         S01486 184926
     C                     MOVE BICN,B    CNUM                                                184926
     C                     MOVE *BLANKS   RECI                            S01486
     C           LLIST     CHAINACCNT                71                   S01486
     C*                                                                   S01486
     C**  Generate an entry to Suspense if no live record found           S01486
     C*                                                                   S01486
     C           A5ACTY    IFEQ 'R'                        - B1           S01486
     C           RECI      ANDNE'D'                                       S01486
     C                     EXSR #W01                                      S01486
     C*                                                                   S01486
     C                     ELSE                            - X1           S01486
     C           A5ACTY    IFEQ 'R'                        - B2           S01486
     C                     Z-ADD94050     TRAT                            S01486
     C                     Z-ADD1         RIND                            S01486
     C*                                                                   S01486
     C**  Otherwise set all to zero                                       S01486
     C*                                                                   S01486
     C                     ELSE                            - X2           S01486
     C                     Z-ADD*ZEROS    TRAT                            S01486
     C                     Z-ADD*ZEROS    RIND                            S01486
     C                     Z-ADD*ZEROS    ACNO                            S01486
     C                     ENDIF                           - E2           S01486
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** move the Primary Funding Profit Centre.                          CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     MOVE FTPRFP    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   S01486
     C**  Write a record to PF/GEPMPD                                     S01486
     C*                                                                   S01486
     C                     EXSR #W02                                      S01486
     C                     ENDIF                           - E1           S01486
     C*                                                                   S01486
     C           #P119     ENDSR                           **#P11 ENDSR** S01486
      *                                                                  *
      **ACCESS*LF/SDBRCHL1*TO*GET*BRANCH*DETAILS*****************         S01486
     C***********          MOVE WWBRCD    WWBRCA                          S01486
     C***********WWBRCA    CHAINSDBRCHL1             77                   S01486
      ***********                                                        *S01486
     C************IN77     IFEQ '1'                        - B2           S01486
     C***********          Z-ADD20        DBASE            ***************S01486
     C***********          MOVEL'SDBRCHL1'DBFILE           **DB ERROR 20**S01486
     C***********          MOVELWWBRCA    DBKEY            ***************S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          END                             - E2           S01486
      ***********                                                        *S01486
     C***********          MOVE A8BICN    CNUM                            S01486
     C***********          MOVE PNCSCY    CCY                             S01486
     C***********          MOVE A8IHOA    ACOD                            S01486
     C***********          MOVE A8SACS    ACSQ                     33619  S01486
     C***********          MOVE '01'      ACSQ                     33619  S01486
     C***********          Z-ADDPOCSND    VALD                            S01486
     C***********          MOVEA*BLANKS   NAR                             S01486
     C***********          MOVE POCNUM    WWCNUB                          S01486
     C***********          MOVEAWWCNUB    NAR,1                           S01486
     C***********          MOVEAPOPTFR    NAR,8                           S01486
     C***********          MOVEAWWCGCO    NAR,13                          S01486
     C***********          MOVEAP5CNAR    NAR,16                          S01486
     C***********          MOVEANAR       PNAR                            S01486
     C***********          Z-ADDWWTCHA    PSTA                            S01486
      ***********                                                        *S01486
      **SET*DR/CR*INDICATOR*ACCORDING*TO*THE*SIGN*OF*THE*AMOUNT**         S01486
     C***********PSTA      IFGT *ZEROS                     - B1           S01486
     C***********          Z-ADD1         DRCR                            S01486
     C***********          ELSE                            - X1           S01486
     C***********          Z-ADD*ZEROS    DRCR                            S01486
     C***********          Z-SUBPSTA      PSTA                            S01486
     C***********          END                             - E1           S01486
      ***********                                                        *S01486
      **ACCESS*LF/SDACODL1***************************************         S01486
     C***********          MOVE ACOD      WWACOD                          S01486
     C***********          EXSR #ACOD                                     S01486
      ***********                                                        *S01486
      **ACCESS*ACCOUNT*DETAILS***********************************         S01486
     C***********          MOVE *BLANKS   RECI                            S01486
     C***********LLIST     CHAINACCNT                71                   S01486
      ***********                                                        *S01486
     C***********          MOVE WWBRCD    BRCD                            S01486
     C***********          MOVE A5ACTY    ATYP                            S01486
      ***********                                                        *S01486
      **NO*LIVE*RECORD*FOUND,*GENERATE*AN*ENTRY*TO*SUSPENSE******         S01486
     C***********A5ACTY    IFEQ 'R'                        - B1           S01486
     C***********RECI      ANDNE'D'                                       S01486
     C***********          EXSR #W01                                      S01486
      ***********                                                        *S01486
     C***********          ELSE                            - X1           S01486
     C***********A5ACTY    IFEQ 'R'                        - B2           S01486
     C***********          Z-ADD94050     TRAT                            S01486
     C***********          Z-ADD1         RIND                            S01486
      ***********                                                        *S01486
      **OTHERWISE*SET*ALL*AT*ZERO********************************         S01486
     C***********          ELSE                            - X2           S01486
     C***********          Z-ADD*ZEROS    TRAT                            S01486
     C***********          Z-ADD*ZEROS    RIND                            S01486
     C***********          Z-ADD*ZEROS    ACNO                            S01486
     C***********          END                             - E2           S01486
      ***********                                                        *S01486
      **WRITE*A*RECORD*TO*PF/GEPMPD******************************         S01486
     C***********          EXSR #W02                                      S01486
     C***********          END                             - E1           S01486
      *----------------------------------------------------------------
      ***********                                                        *S01486
     C***********          MOVE WWBICN    CNUM                            S01486
     C***********          MOVE PNBCGY    CCY                             S01486
     C***********          MOVE WWIBAC    ACOD                            S01486
     C***********          MOVE WWACSQ    ACSQ                     33619  S01486
     C***********          MOVE '01'      ACSQ                     33619  S01486
     C***********          Z-ADDWWTCTP    PSTA                            S01486
      ***********                                                        *S01486
      **INVERSE*DR/CR*INDICATOR**********************************         S01486
     C***********DRCR      IFEQ 1                          - B1           S01486
     C***********          Z-ADD*ZEROS    DRCR                            S01486
     C***********          ELSE                            - X1           S01486
     C***********          Z-ADD1         DRCR                            S01486
     C***********          END                             - E1           S01486
      ***********                                                        *S01486
      **ACCESS*LF/SDACODL1***************************************         S01486
     C***********          MOVE ACOD      WWACOD                          S01486
     C***********          EXSR #ACOD                                     S01486
      ***********                                                        *S01486
      **ACCESS*ACCOUNT*DETAILS***********************************         S01486
     C***********          MOVE *BLANKS   RECI                            S01486
     C***********LLIST     CHAINACCNT                71                   S01486
      ***********                                                        *S01486
     C***********          MOVE BBBRCD    BRCD                            S01486
     C***********          MOVE A5ACTY    ATYP                            S01486
      ***********                                                        *S01486
      **NO*LIVE*RECORD*FOUND,*GENERATE*AN*ENTRY*TO*SUSPENSE******         S01486
     C***********A5ACTY    IFEQ 'R'                        - B1           S01486
     C***********RECI      ANDNE'D'                                       S01486
     C***********          EXSR #W01                                      S01486
      ***********                                                        *S01486
     C***********          ELSE                            - X1           S01486
     C***********A5ACTY    IFEQ 'R'                        - B2           S01486
     C***********          Z-ADD94050     TRAT                            S01486
     C***********          Z-ADD1         RIND                            S01486
      ***********                                                        *S01486
      **OTHERWISE*SET*ALL*AT*ZERO********************************         S01486
     C***********          ELSE                            - X2           S01486
     C***********          Z-ADD*ZEROS    TRAT                            S01486
     C***********          Z-ADD*ZEROS    RIND                            S01486
     C***********          Z-ADD*ZEROS    ACNO                            S01486
     C***********          END                             - E2           S01486
      ***********                                                        *S01486
      **WRITE*A*RECORD*TO*PF/GEPMPD******************************         S01486
     C***********          EXSR #W02                                      S01486
     C***********          END                             - E1           S01486
      ***********                                                         S01486
     C***********          ENDSR                           **#P11 ENDSR** S01486
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P12     - GENERATE CROSS-CURRENCY SETTLEMENT ENTRIES            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      * #W01     - WRITE SUSPENSE ENTRIES TO PF/GEPMPD                   *
      * #W02     - WRITE NON-SUSPENSE ENTRIES TO PF/GEPMPD               *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P07     - PROCESS CHARGE SETTLEMENTS                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * BLSPTA   - SPOT TRADE ACCOUNT CODE                               *33619
      * WWDTNB   - BRANCH INTERNAL CUSTOMER NUMBER                       *
      *********  - SPOT TRADE ACCOUNT EQUIVALENT OF CUST SETTLEMENT C    *33619
      * WWACSQ   - BRANCH START ACCOUNT SEQUENCE                         *
      * WWCNUB   - CUSTOMER NUMBER ALPHANUMERIC TO SET POSTING NARR      *
      * WWTCHA   - TOTAL CHARGES ACCRUED IN CUSTOMER SETTLEMENT CCY      *
      * WWACOD   - ACCOUNT CODE TO ACCESS LF/SDACODL1                    *
      ********   - SPOT TRADE ACCOUNT EQUIVALENT OF BANK CHARGING CCY    *33619
      * WWTCTP   - TOTAL CHARGES ACCRUED IN BANK CHARGING CURRENCY       *
      *                                                                  *
      ********************************************************************
     C           #P12      BEGSR                           **#P12 BEGSR**
      *                                                                  *
     C                     MOVE WWBICN    CNUM
     C                     MOVE PNCSCY    CCY
     C**                   MOVE WWFYN3    ACOD                            33619
     C                     MOVE BLSPTA    ACOD                            33619
     C**                   MOVE WWACSQ    ACSQ                            33619
     C                     MOVE '01'      ACSQ                            33619
     C                     MOVE BBBRCD    BRCA                            S01486
     C                     Z-ADDPOCSND    VALD
     C                     MOVEA*BLANKS   NAR
     C                     MOVE POCNUM    WWCNUB
     C                     MOVEAWWCNUB    NAR,1
     C                     MOVEAPOPTFR    NAR,8
     C                     MOVEAWWCGCO    NAR,13
     C                     MOVEAP5CNAR    NAR,16
     C                     MOVEANAR       PNAR
     C                     Z-ADDWWTCHA    PSTA
      *                                                                  *
      * SET DR/CR INDICATOR ACCORDING TO THE SIGN OF THE AMOUNT
     C           PSTA      IFGT *ZEROS                     - B1
     C                     Z-ADD1         DRCR
     C                     ELSE                            - X1
     C                     Z-ADD*ZEROS    DRCR
     C                     Z-SUBPSTA      PSTA
     C                     END                             - E1
      *                                                                  *
      * ACCESS LF/SDACODL1
     C                     MOVE ACOD      WWACOD
     C                     EXSR #ACOD
      *                                                                  *
      * ACCESS ACCOUNT DETAILS
     C                     MOVE *BLANKS   RECI
     C           LLIST     CHAINACCNT                71
      *                                                                  *
     C***********          MOVE BBBRCD    BRCD                            S01486
     C                     MOVE A5ACTY    ATYP
      *                                                                  *
      * NO LIVE RECORD FOUND, GENERATE AN ENTRY TO SUSPENSE
     C           A5ACTY    IFEQ 'R'                        - B1
     C           RECI      ANDNE'D'
     C                     EXSR #W01
      *                                                                  *
     C                     ELSE                            - X1
     C           A5ACTY    IFEQ 'R'                        - B2
     C                     Z-ADD94050     TRAT
     C                     Z-ADD1         RIND
      *                                                                  *
      * OTHERWISE SET ALL AT ZERO
     C                     ELSE                            - X2
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C                     Z-ADD*ZEROS    ACNO
     C                     END                             - E2
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** determine the Profit Centre.                                     CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     EXSR #P17                                      CAC003
     C                     ENDIF                                          CAC003
      *                                                                  *
      * WRITE A RECORD TO PF/GEPMPD
     C                     EXSR #W02
     C                     END                             - E1
      *----------------------------------------------------------------
      *                                                                  *
     C                     MOVE PNBCGY    CCY
     C**                   MOVE WWFYN2    ACOD                            33619
     C                     Z-ADDWWTCTP    PSTA
      *
      * SET DR/CR INDICATOR ACCORDING TO THE SIGN OF THE AMOUNT
     C           PSTA      IFGT *ZEROS                     - B1
     C                     Z-ADD*ZEROS    DRCR
     C                     ELSE                            - X1
     C                     Z-ADD1         DRCR
     C                     Z-SUBPSTA      PSTA
     C                     END                             - E1
      *                                                                  *
      * ACCESS LF/SDACODL1
     C                     MOVE ACOD      WWACOD
     C                     EXSR #ACOD
      *                                                                  *
      * ACCESS ACCOUNT DETAILS
     C                     MOVE *BLANKS   RECI
     C                     MOVE BBBRCD    BRCA                            S01486
     C           LLIST     CHAINACCNT                71
      *                                                                  *
     C                     MOVE A5ACTY    ATYP
     C***********          MOVE BBBRCD    BRCD                            S01486
      *                                                                  *
      * NO LIVE RECORD FOUND, GENERATE AN ENTRY TO SUSPENSE
     C           A5ACTY    IFEQ 'R'                        - B1
     C           RECI      ANDNE'D'
     C                     EXSR #W01
      *                                                                  *
     C                     ELSE                            - X1
     C           A5ACTY    IFEQ 'R'                        - B2
     C                     Z-ADD94050     TRAT
     C                     Z-ADD1         RIND
      *                                                                  *
      * OTHERWISE SET ALL AT ZERO
     C                     ELSE                            - X2
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C                     Z-ADD*ZEROS    ACNO
     C                     END                             - E2
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** determine the Profit Centre.                                     CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     EXSR #P17                                      CAC003
     C                     ENDIF                                          CAC003
      *                                                                  *
      * WRITE A RECORD TO PF/GEPMPD
     C                     EXSR #W02
     C                     END                             - E1
      *
     C                     ENDSR                           **#P12 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P13     - GENERATE BASE CURRENCY SETTLEMENT ENTRIES             *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      * #W01     - WRITE SUSPENSE ENTRIES TO PF/GEPMPD                   *
      * #W02     - WRITE NON-SUSPENSE ENTRIES TO PF/GEPMPD               *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P07     - PROCESS CHARGE SETTLEMENTS                            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWDTNB   - BRANCH INTERNAL CUSTOMER NUMBER                       *
      * WWFYN3   - SPOT TRADE ACCOUNT EQUIVALENT OF CUST SETTLEMENT C    *
      * WWACSQ   - BRANCH START ACCOUNT SEQUENCE                         *
      * WWCNUB   - CUSTOMER NUMBER ALPHANUMERIC TO SET POSTING NARR      *
      * WWTCSC   - TOTAL CHARGES ACCRUED IN BASE CURRENCY                *
      * WWACOD   - ACCOUNT CODE TO ACCESS LF/SDACODL1                    *
      * WWFYN2   - SPOT TRADE ACCOUNT EQUIVALENT OF BANK CHARGING CCY    *
      *                                                                  *
      ********************************************************************
     C           #P13      BEGSR                           **#P13 BEGSR**
      *                                                                  *
     C                     MOVE WWBICN    CNUM
     C                     MOVE BJCYCD    CCY
     C                     MOVE WWFYN3    ACOD
     C**                   MOVE WWACSQ    ACSQ                            33619
     C                     MOVE '01'      ACSQ                            33619
     C                     Z-ADDPOCSND    VALD
     C                     MOVEA*BLANKS   NAR
     C                     MOVE POCNUM    WWCNUB
     C                     MOVEAWWCNUB    NAR,1
     C                     MOVEAPOPTFR    NAR,8
     C                     MOVEAWWCGCO    NAR,13
     C                     MOVEAP5CNAR    NAR,16
     C                     MOVEANAR       PNAR
     C                     Z-ADDWWTCSC    PSTA
      *                                                                  *
      * SET DR/CR INDICATOR ACCORDING TO THE SIGN OF THE AMOUNT          *
     C           PSTA      IFGT *ZEROS                     - B1
     C                     Z-ADD*ZEROS    DRCR
     C                     ELSE                            - X1
     C                     Z-ADD1         DRCR
     C                     Z-SUBPSTA      PSTA
     C                     END                             - E1
      *                                                                  *
      * ACCESS LF/SDACODL1
     C                     MOVE ACOD      WWACOD
     C                     EXSR #ACOD
      *                                                                  *
      * ACCESS ACCNT WITH CNUM, CCY, ACOD, ACSQ DETERMINE AS ABOVE
     C                     MOVE *BLANKS   RECI
     C           LLIST     CHAINACCNT                71
      *                                                                  *
     C***********          MOVE BBBRCD    BRCD                            S01486
     C                     MOVE BBBRCD    BRCA                            S01486
     C                     MOVE A5ACTY    ATYP
      *                                                                  *
      * NO LIVE RECORD FOUND, GENERATE AN ENTRY TO SUSPENSE
     C           A5ACTY    IFEQ 'R'                        - B1
     C           RECI      ANDNE'D'
     C                     EXSR #W01
      *                                                                  *
     C                     ELSE                            - X1
     C           A5ACTY    IFEQ 'R'                        - B2
     C                     Z-ADD94050     TRAT
     C                     Z-ADD1         RIND
      *                                                                  *
      * OTHERWISE SET ALL AT ZERO
     C                     ELSE                            - X2
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C                     Z-ADD*ZEROS    ACNO
     C                     END                             - E2
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** determine the Profit Centre.                                     CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     EXSR #P17                                      CAC003
     C                     ENDIF                                          CAC003
      *                                                                  *
      * WRITE A RECORD TO PF/GEPMPD
     C                     EXSR #W02
     C                     END                             - E1
      *----------------------------------------------------------------
      *                                                                  *
      * SPOT TRADE EQUIVALENT ACCOUNT CODE FOR THE BANK CHARGING CURRENCY
     C                     MOVE WWFYN2    ACOD
      *                                                                  *
      * INVERSE DR/CR INDICATOR                                        CY
     C           DRCR      IFEQ *ZEROS                     - B1
     C                     Z-ADD1         DRCR
     C                     ELSE                            - X1
     C                     Z-ADD*ZEROS    DRCR
     C                     END                             - E1
      *                                                                  *
      * ACCESS LF/SDACODL1
     C                     MOVE ACOD      WWACOD
     C                     EXSR #ACOD
      *                                                                  *
      * ACCESS ACCOUNT DETAILS
     C                     MOVE *BLANKS   RECI
     C           LLIST     CHAINACCNT                71
      *                                                                  *
     C                     MOVE A5ACTY    ATYP
     C***********          MOVE BBBRCD    BRCD                            S01486
     C                     MOVE BBBRCD    BRCA                            S01486
      *                                                                  *
      * NO LIVE RECORD FOUND, GENERATE AN ENTRY TO SUSPENSE
     C           A5ACTY    IFEQ 'R'                        - B1
     C           RECI      ANDNE'D'
     C                     EXSR #W01
      *                                                                  *
     C                     ELSE                            - X1
     C           A5ACTY    IFEQ 'R'                        - B2
     C                     Z-ADD94050     TRAT
     C                     Z-ADD1         RIND
      *                                                                  *
      * OTHERWISE SET ALL AT ZERO
     C                     ELSE                            - X2
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C                     Z-ADD*ZEROS    ACNO
     C                     END                             - E2
     C*                                                                   CAC003
     C** If Analytical Accounting and CAC003 are available,               CAC003
     C** determine the Profit Centre.                                     CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     EXSR #P17                                      CAC003
     C                     ENDIF                                          CAC003
      *                                                                  *
      * WRITE A RECORD TO PF/GEPMPD
     C                     EXSR #W02
     C                     END                             - E1
      *
     C                     ENDSR                           **#P13 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P15     - AUDIT PROCESSING                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **#W03*****-*WRITE*TO*PF/GEPMZZ****************************        *S01486
      * #W03     - WRITE TO PF/GEPMPA                                    *S01486
      * #W04     - WRITE PORTFOLIO CHARGES ACCRUALS AUDIT REPORT         *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P15      BEGSR                           **#P15 BEGSR**
      *
     C                     EXSR #W03
      *
      **WRITE*A*RECORD*TO*TRAILER*PF/GEPMZZ**********************         S01486
      * WRITE A RECORD TO TRAILER PF/GEPMPA                               S01486
      *
     C                     WRITEAPOSTZZF
      *
      * PRODUCE PORTFOLIO CHARGES ACCRUALS AUDIT REPORT
      *
     C                     EXSR #W04
      *
     C                     ENDSR                           **#P15 ENDSR**
      ********************************************************************CAC003
      /EJECT                                                              CAC003
      ********************************************************************CAC003
      *                                                                  *CAC003
      * #P16     - Subroutine to Determine Profit Centre                 *CAC003
      *                                                                  *CAC003
      * SUBROUTINE CALLS:                                                *CAC003
      * SUBROUTINE CALLED FROM:                                          *CAC003
      * #P09     - Generate Charge Accrual Entries                       *CAC003
      * #P10     - Generate Standard Settlement Entries                  *CAC003
      ********************************************************************CAC003
     C           #P16      BEGSR                                          CAC003
     C*                                                                   CAC003
     C           ATYP      IFEQ 'R'                                       CAC003
     C           ATYP      OREQ 'N'                                       CAC003
     C                     MOVE APRFC     PRFC                            CAC003
     C                     ELSE                                           CAC003
     C*                                                                   CAC003
     C** Else, move Profit Centre from the Portfolio Charge Detls         CAC003
     C** file.                                                            CAC003
     C           POPFRC    IFNE *BLANK                                    CAC003
     C                     MOVE POPFRC    PRFC                            CAC003
     C                     ELSE                                           CAC003
     C*                                                                   CAC003
     C** else, move Profit Centre from the Portfolio Detls file.          CAC003
     C                     MOVE PNPRFC    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     ENDSR                           **#P16 ENDSR** CAC003
      ********************************************************************CAC003
      /EJECT                                                              CAC003
      ********************************************************************CAC003
      *                                                                  *CAC003
      * #P17     - Subroutine to Determine Profit Centre                 *CAC003
      *                                                                  *CAC003
      * SUBROUTINE CALLS:                                                *CAC003
      *                                                                  *CAC003
      * SUBROUTINE CALLED FROM:                                          *CAC003
      * #P12     - Generate Charge Accrual Entries                       *CAC003
      * #P13     - Generate Standard Settlement Entries                  *CAC003
      ********************************************************************CAC003
     C           #P17      BEGSR                                          CAC003
     C*                                                                   CAC003
     C** Move Profit Centre from the Portfolio Charge Detls file.         CAC003
     C*                                                                   CAC003
     C           POPFRC    IFNE *BLANK                                    CAC003
     C                     MOVE POPFRC    PRFC                            CAC003
     C*                                                                   CAC003
     C                     ELSE                                           CAC003
     C** else, move Profit Centre from the Portfolio Detls file.          CAC003
     C                     MOVE PNPRFC    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C** Determine if profit centre can hold an FX position in posting    CAC003
     C** to the spot trade account.                                       CAC003
     C*                                                                   CAC003
     C                     CALL 'AOPRFCR0'                                CAC003
     C                     PARM *BLANKS   P@RTCD                          CAC003
     C                     PARM '*KEY   ' P@OPTN                          CAC003
     C                     PARM PRFC      WPRFC   4                       CAC003
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC003
     C*                                                                   CAC003
     C           P@RTCD    IFNE *BLANKS                                   CAC003
     C           *LOCK     IN   LDA                                       CAC003
     C                     Z-ADD38        DBASE            ***************CAC003
     C                     MOVEL'SDPRFCPD'DBFILE           *DB ERROR 038 *CAC003
     C                     MOVELPRFC      DBKEY            ***************CAC003
     C                     OUT  LDA                                       CAC003
     C                     EXSR *PSSR                                     CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C           DSFPPC    IFNE *BLANKS                                   CAC003
     C                     MOVE DSFPPC    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     ENDSR                           **#P17 ENDSR** CAC003
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      **#U01*****-*UPDATE*PF/PMCHRGPP****************************        *S01486
      * #U01     - UPDATE PF/PMCHRGPD                                    *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCGND   - NEXT ACCRUAL DATE                                     *
      * WWCSND   - NEXT SETTLEMENT DATE                                  *
      * WWCGAD   - CHARGES ACCRUED TODAY                                 *
      *                                                                  *
      ********************************************************************
     C           #U01      BEGSR                           **#U01 BEGSR **
      *
      * IF CURRENT RECORD ID IS 'C' SET IT TO '*'
      *
     C           PORECI    IFEQ 'C'                        - B1
     C                     MOVE '*'       PORECI
     C                     END                             - E1
      *
      * IF NEXT ACCRUAL DATE IS LESS OR EQUAL THAN EVENT CONTROL DATE,
      * SET LAST ACCRUAL DATE EQUAL TO NEXT ACCRUAL DATE
      * SET NEXT ACCRUAL DATE EQUAL TO THE DATE CALCULATED IN MAIN
      * SET CHARGE ACCRUAL PROCESSING TO 'Y'
      *
     C           POCGND    IFLE ECD                        - B1
     C                     Z-ADDPOCGND    POCGLD
     C                     Z-ADDWWCGND    POCGND
     C                     MOVE 'Y'       POCGAP
     C                     MOVE 'C'       POCGEI
     C                     END                             - E1
      *
      * NEXT SETTLEMENT DATE IS LESS OR EQUAL THAN EVENT CONTROL DATE
      * SET LAST SETTLEMENT DATE EQUAL TO THE NEXT SETTLEMENT DATE
      * SET NEXT SETTLEMENT DATE TO THE DATE CALCULATED IN MAIN
      * SET CHARGE SETTLEMENT PROCESSING TO 'Y'
      *
     C           POCSND    IFLE ECD                        - B1
     C                     Z-ADDPOCSND    POCGLS
     C                     Z-ADDWWCSND    POCSND
     C                     MOVE 'Y'       POCSPR
     C                     END
      *
      * SET CHARGES ACCRUED TO DATE AS CALCULATED IN #P05, #P06 AND #P07
     C                     Z-ADDWWCGAD    POCGAD
      *
      * SET CHARGE STOPPED AT START OF PERIOD EQUAL TO CHARGE STOPPED IND
     C                     MOVE POCGST    POCSIS
      *
      * SET CHARGE CODE AT START OF PERIOD EQUAL TO CHARGE CODE
     C                     MOVE POCGCO    POCCSP
      *
      * SET CHARGE SPREAD AT START OF PERIOD EQUAL TO CHARGE SPREAD
     C                     MOVE POCGSP    POCSSP
      *
      * SET CHARGE SPREAD IND AT START OF PERIOD EQUAL TO CHARGE SPREAD IND
     C                     MOVE POCGSI    POCISP
      *
     C                     ENDSR                           **#U01 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #W01     - WRITE SUSPENSE ENTRIES TO PF/GEPMPD                   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P09     - GENERATE CHARGE ACCRUAL ENTRIES                       *
      * #P10     - GENERATE STANDARD SETTLEMENT ENTRIES                  *
      * #P11     - GENERATE INTER-BRANCH SETTLEMENT ENTRIES              *
      * #P12     - GENERATE CROSS-CURRENCY SETTLEMENT ENTRIES            *
      * #P13     - GENERATE BASE CURRENCY SETTLEMENT ENTRIES             *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWDTNB   - BRANCH INTERNAL CUSTOMER NUMBER                       *
      * WWACSQ   - BRANCH START ACCOUNT SEQUENCE                         *
      * WWAFST   - ACCOUNT TYPE                                          *
      *                                                                  *
      ********************************************************************
     C           #W01      BEGSR                           **#W01 BEGSR**
      *
     C                     MOVE 'P'       RECI
     C*                                                                   S01486
     C**  Initialise new fields (Rel. 10)                                 S01486
     C*                                                                   S01486
     C                     Z-ADD*ZERO     VOIN                            S01486
     C                     Z-ADD235959    PTIM                            S01486
     C                     MOVE A5ACSC    ACSC                            S01486
      *
      * BRANCH INTERNAL CUSTOMER NUMBER OF THE CUSTOMER BRANCH (SEE #P01)
     C                     MOVE WWBICN    CNUM
      *
      * COMPUTER SUSPENSE ACCOUNT CODE
     C**                   MOVE BLAFNB    ACOD
     C                     MOVE BKACCD    ACOD
      *
      * CUSTOMER BRANCH ACCOUNT SEQUENCE #P01
     C**                   MOVE WWACSQ    ACSQ                            33619
     C                     MOVE '01'      ACSQ                            33619
      *
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADD*ZEROS    TRAT
      *
      **CUSTOMER*NUMBER*FROM*PF/PMCHRGPP*************************         S01486
      * CUSTOMER NUMBER FROM PF/PMCHRGPD                                  S01486
     C                     MOVE POCNUM    ASOC
     C                     Z-ADD*ZEROS    CHQN
     C                     MOVE '  GE-PM' SPOS
      *
      * BRANCH OF CUSTOMER
     C***********          MOVE BBBRCD    BRCD                            S01486
     C                     MOVE BBBRCD    BRCA                            S01486
      *
      * IF ACCOUNT TYPE IS 'R' THAN RETAIL INDICATOR IS 1
      * OHTERWISE RETAIL INDICATOR IS ZERO
     C           WWACTY    IFEQ 'R'                        - B1
     C                     Z-ADD1         RIND
     C                     ELSE                            - X1
     C                     Z-ADD*ZEROS    RIND
     C                     END                             - E1
      *
     C                     Z-ADD*ZEROS    REJC
     C                     MOVE *BLANKS   DPMT
     C                     Z-ADD*ZEROS    RRNM
      *
      * ACCOUNT TYPE OF COMPUTER SUSPENSE ACCOUNT CODE
     C                     MOVE WWACTY    ATYP
     C                     MOVE *BLANKS   EXIN
     C                     MOVE *LOVAL    PRIN
     C                     MOVE 'S'       GETP
     C                     Z-ADD*ZEROS    ACUM
      *
      * ADD 1 TO THE COUNTER OF RECORDS ON PF/GEPMPD
      *
     C                     ADD  1         RRCNT
      *
      * ADD POSTING AMOUNT TO THE TOTAL FOR HASH CONTROL
      *
     C                     ADD  PSTA      TOTAL
     C*                                                                   CAC003
     C**  If Analytical Accounting and CAC003 are available,              CAC003
     C*   move the Primary Funding Profit Centre for output.              CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     MOVE FTPRFP    PRFC                            CAC003
     C                     ENDIF                                          CAC003
      *                                                                                       CGL020
      ** If Compliance Watch - Additional A/c Postings (CGL020) is installed,                 CGL020
      ** set Fee Flag = 'F', Fee Value = Posting Amount and Fee Percent = 100                 CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       FEEFLG                                              CGL020
     C                     Z-ADDPSTA      FEEVAL                                              CGL020
     C                     Z-ADD100       FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
      * WRITE A RECORD ON PF/GEPMPD
      *
     C                     WRITEAPOSTPDF
      *                                                                                       CGL020
      ** If Compliance Watch - Additional A/c Postings (CGL020) is installed,                 CGL020
      ** reset Fee Flag, Fee Value and Fee Percent.                                           CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE *BLANK    FEEFLG                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
     C                     ENDSR                           **#W01 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #W02     - WRITE NON-SUSPENSE ENTRIES TO PF/GEPMPD               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P09     - GENERATE CHARGE ACCRUAL ENTRIES                       *
      * #P10     - GENERATE STANDARD SETTLEMENT ENTRIES                  *
      * #P11     - GENERATE INTER-BRANCH SETTLEMENT ENTRIES              *
      * #P12     - GENERATE CROSS-CURRENCY SETTLEMENT ENTRIES            *
      * #P13     - GENERATE BASE CURRENCY SETTLEMENT ENTRIES             *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #W02      BEGSR                           **#W02 BEGSR**
      *
     C                     MOVE 'P'       RECI
     C                     Z-ADDBJRDNB    PSTD
     C*                                                                   S01486
     C**  Initialise new fields (Rel. 10)                                 S01486
     C*                                                                   S01486
     C                     Z-ADD*ZERO     VOIN                            S01486
     C                     Z-ADD235959    PTIM                            S01486
     C                     MOVE A5ACSC    ACSC                            S01486
      *
      **CUSTOMER*NUMBER*FROM*PF/PMCHRGPP*************************         S01486
      * CUSTOMER NUMBER FROM PF/PMCHRGPD                                  S01486
     C                     MOVE POCNUM    ASOC
     C                     Z-ADD*ZEROS    CHQN
     C                     MOVE '  GE-PM' SPOS
     C                     Z-ADD*ZEROS    REJC
     C                     MOVE *BLANKS   DPMT
     C                     Z-ADD*ZEROS    RRNM
     C                     MOVE *BLANKS   EXIN
     C                     MOVE *LOVAL    PRIN
     C                     MOVE *BLANKS   GETP
     C                     Z-ADD*ZEROS    ACUM
      *
      * ADD 1 TO THE COUNTER OF RECORDS ON PF/GEPMPD
      *
     C                     ADD  1         RRCNT
      *
      * ADD POSTING AMOUNT TO THE TOTAL FOR HASH CONTROL
      *
     C                     ADD  PSTA      TOTAL
      *                                                                                       CGL020
      ** If Compliance Watch - Additional A/c Postings (CGL020) is installed,                 CGL020
      ** set Fee Flag = 'F', Fee Value = Posting Amount and Fee Percent = 100                 CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       FEEFLG                                              CGL020
     C                     Z-ADDPSTA      FEEVAL                                              CGL020
     C                     Z-ADD100       FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
      * WRITE A RECORD ON PF/GEPMPD
      *
     C                     WRITEAPOSTPDF
      *                                                                                       CGL020
      ** If Compliance Watch - Additional A/c Postings (CGL020) is installed,                 CGL020
      ** reset Fee Flag, Fee Value and Fee Percent.                                           CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE *BLANK    FEEFLG                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
     C                     ENDSR                           **#W02 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #ACOD    - TO ACCESS ACCOUNT CODE DETAILS                        *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P09     - GENERATE CHARGE ACCRUAL ENTRIES                       *
      * #P10     - GENERATE STANDARD SETTLEMENT ENTRIES                  *
      * #P11     - GENERATE INTER-BRANCH SETTLEMENT ENTRIES              *
      * #P12     - GENERATE CROSS-CURRENCY SETTLEMENT ENTRIES            *
      * #P13     - GENERATE BASE CURRENCY SETTLEMENT ENTRIES             *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #ACOD     BEGSR                           *#ACOD BEGSR**
      *
     C***********WWACOD    CHAINSDACODL1             77                   S01486
      ***********                                                         S01486
     C************IN77     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD16        DBASE            ***************S01486
     C***********          MOVEL'SDACODL1'DBFILE           **DB ERROR 16**S01486
     C***********          MOVELWWACOD    DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access account codes details                                    S01486
     C*                                                                   S01486
     C                     CALL 'AOACODR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C**********           PARM WWACOD    P@ACCD  4                                    S01486 CGL029
     C                     PARM WWACOD    P@ACCD 10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD16        DBASE            ***************S01486
     C                     MOVE 'SDACODPD'DBFILE           *DB ERROR 016 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@ACCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
      *
     C                     ENDSR                           **#ACOD ENDSR**
     C**************************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE1Z2
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZFRQAZ2
      /EJECT
      /COPY ZSRSRC,ZCCYCN                                                 062594
      /EJECT                                                              062594
      /COPY ZSRSRC,ZCCYXR                                                 062594
      /EJECT                                                              062594
     C/EJECT                                                              S01486
     C/COPY ZSRSRC,ZACCH                                                  S01486
     C/EJECT                                                              S01486
     C/COPY ZSRSRC,ZCHKH                                                  S01486
     C/EJECT                                                              S01486
     C**************************************************************************
     C*                                                                        *
     C*  ZPMCRG SR. TO CALCULATE PORTFOLIO MANAGEMENT CHARGES                  *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C*       ZAMT   150     PRINCIPAL AMOUNT                                  *
     C*       ZDYBS   10     DAY BASIS                                         *
     C*       ZDVBS   10     DIVISOR BASIS                                     *
     C*       ZFMDAT  50     FROM DATE                                         *
     C*       ZTODAT  50     TO DATE                                           *
     C*       ZSPRD  130     EFFECTIVE CHARGE SPREAD                           *
     C*       ZSPRI   1      EFFECTIVE CHARGE SPREAD INDICATOR                 *
     C*       ZCGBS   1      CHARGE BASIS                                      *
     C*       ZCGMT   1      CHARGING METHOD                                   *
     C*       ZMINC  150     MINIMUM CHARGE AMOUNT                             *
     C*       ZRA    150x14  RANGE UPPER LIMITS                                *
     C*       ZPC    117x15  PERCENTAGES                                       *
     C*       ZCG    150x15  FLAT CHARGE AMOUNTS                               *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZCHGA  150     TOTAL CHARGE AMOUNT                               *
     C*                                                                        *
     C*  CALLS: ZDYYR                                                          *
     C*         ZDAYS                                                          *
     C**************************************************************************
     C*
     C           ZPMCRG    BEGSR                           *** ZPMCRG ***
     C*
     C** DEFINE ALL FIELDS
     C                     Z-ADD0         CPNR   117                      102506
     C                     Z-ADD*ZEROS    FCPN    50                      CPM005
     C                     Z-ADD*ZEROS    ISSD    50                      CPM005
     C                     Z-ADD*ZEROS    NCD     50
     C                     MOVE *BLANKS   DVBS    1
     C                     MOVE *BLANKS   DYBS    1
     C                     Z-ADD*ZEROS    MATY    50
     C                     Z-ADD*ZEROS    LCPN    50
     C                     Z-ADD*ZEROS    ITLD    50
     C                     Z-ADD*ZEROS    IADJ    50
     C                     Z-ADDZAMT      ZAMT   150
     C                     Z-ADDZDYBS     ZDYBS   10
     C                     Z-ADDZDVBS     ZDVBS   10
     C                     Z-ADDZFMDAT    ZFMDAT  50
     C                     Z-ADDZTODAT    ZTODAT  50
     C                     Z-ADDZSPRD     ZSPRD  130
     C                     MOVE ZSPRI     ZSPRI   1
     C                     MOVE ZCGBS     ZCGBS   1
     C                     MOVE ZCGMT     ZCGMT   1
     C                     Z-ADDZMINC     ZMINC  150
     C                     Z-ADD*ZEROS    ZCHGA  150
     C                     Z-ADD*ZEROS    ZZ      20
     C                     MOVEAZRA       ZRB
     C                     Z-ADD*HIVAL    ZRB,15
     C                     MOVE *BLANKS   ZFLAG   1
     C                     Z-ADD0         FCPN    50                      116572
     C                     Z-ADD0         ISSD    50                      116572
     C*
     C** DETERMINE THE NUMBER OF CHARGE DAYS
     C*
     C                     Z-ADDZFMDAT    ZSDATE
     C                     Z-ADDZTODAT    ZEDATE
     C                     MOVE ZDYBS     DYBS
     C** PROCESS SUB-ROUTINE
     C                     EXSR ZDAYS
     C*
     C                     Z-ADDZDDAYS    ZNOCD   50
     C*
     C** DETERMINE THE NUMBER OF DAYS IN THE CHARGE YEAR
     C*
     C                     Z-ADDZFMDAT    NCD
     C                     MOVE ZDVBS     DVBS
     C                     Z-ADDZTODAT    MATY
     C                     Z-ADD*ZEROS    LCPN
     C                     Z-ADD*ZEROS    ITLD
     C                     MOVE *BLANKS   CR
     C** PROCESS SUB-ROUTINE
     C                     EXSR ZDYYR
     C*
     C                     Z-ADDZINTDD    ZNOCY   50
     C*
     C** CHECK IF CHARGE BASIS (ZCGBS) IS 'F' (FLAT)
     C*
     C           ZCGBS     IFEQ 'F'                        - B1
     C*
     C** DO UNTIL FLAG IS 'Y'
     C*
     C           ZFLAG     DOUEQ'Y'                        - B2
     C                     ADD  1         ZZ
     C*
     C** CHECK INDEX
     C*
     C           ZZ        IFEQ 15                         - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF PRINCIPAL AMOUNT IS LESS EQUAL THAN RANGE UPPER LIMITS
     C*
     C           ZAMT      IFLE ZRB,ZZ                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF RANGE UPPER LIMITS IS ZERO
     C*
     C           ZRB,ZZ    IFEQ *ZEROS                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C** SET THE TOTAL CHARGE AMOUNT (ZCHGA) TO FLAT CHARGE AMOUNTS
     C*
     C                     Z-ADDZCG,ZZ    ZCHGA
     C*
     C** CHECK IF THE CHARGE SPREAD INDICATOR IS '+' OR '-'
     C*
     C           ZSPRI     IFEQ '+'                        - B2
     C                     ADD  ZSPRD     ZCHGA
     C                     ELSE                            - X2
     C                     SUB  ZSPRD     ZCHGA
     C                     END                             - E2
     C*
     C** MULTIPLY TOTAL CHARGE AMOUNT BY NUMBER OF CHARGE DAYS
     C*
     C           ZCHGA     MULT ZNOCD     ZCHGA
     C*
     C** DIVIDE TOTAL CHARGE AMOUNT BY NUMBER OF DAYS IN THE CHARGE YEAR
     C*
     C           ZCHGA     DIV  ZNOCY     ZCHGA     H
     C*
     C                     END                             - E1
     C*
     C** CHECK IF CHARGE BASIS (ZCGBS) IS 'P' (PERCENTAGE) AND THE CHARGING
     C** METHOD IS 'T' (THRESHOLD)
     C*
     C           ZCGBS     IFEQ 'P'                        - B1
     C           ZCGMT     ANDEQ'T'
     C*
     C** DO UNTIL FLAG IS 'Y'
     C*
     C           ZFLAG     DOUEQ'Y'                        - B2
     C                     ADD  1         ZZ
     C*
     C** CHECK INDEX
     C*
     C           ZZ        IFEQ 15                         - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF PRINCIPAL AMOUNT IS LESS EQUAL THAN RANGE UPPER LIMITS
     C*
     C           ZAMT      IFLE ZRB,ZZ                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF RANGE UPPER LIMITS IS ZERO
     C*
     C           ZRB,ZZ    IFEQ *ZEROS                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C** SET THE CHARGE RATE (ZCGRT) EQUAL TO PERCENTAGE
     C*
     C                     Z-ADDZPC,ZZ    ZCGRT  117
     C*
     C** MOVE THE EFFECTIVE CHARGE SPREAD (ZSPRD) INTO THE ADJUSTED
     C** CHARGE SPREAD (ZACSD)
     C*
     C                     MOVE ZSPRD     ZACSD  117
     C*
     C** CHECK IF THE CHARGE SPREAD INDICATOR IS '+' OR '-'
     C*
     C           ZSPRI     IFEQ '+'                        - B2
     C                     ADD  ZACSD     ZCGRT
     C                     ELSE                            - X2
     C                     SUB  ZACSD     ZCGRT
     C                     END                             - E2
     C*
     C** DIVIDE THE PRINCIPAL AMOUNT BY 100 AND PUT THE RESULT IN A WORK
     C** FIELD (ZZ152)
     C*
     C           ZAMT      DIV  100       ZZ152  152H
     C*
     C** MULTIPLY THIS WORK FIELD BY NUMBER OF CHARGE DAYS AND PUT THE
     C** RESULT IN A WORK FIELD (ZZ154)
     C*
     C           ZZ152     MULT ZNOCD     ZZ154  154
     C*
     C** DIVIDE TOTAL CHARGE AMOUNT BY NUMBER OF DAYS IN THE CHARGE YEAR
     C*
     C           ZZ154     DIV  ZNOCY     ZZ154     H
     C*
     C** MULTIPLY THIS WORK FIELD BY THE CHARGE RATE (ZCGRT)
     C*
     C           ZZ154     MULT ZCGRT     ZCHGA
     C*
     C           ZMINC     MULT ZNOCD     ZMINC
     C           ZMINC     DIV  ZNOCY     ZMINC     H
     C*
     C           ZCHGA     IFLT ZMINC
     C                     Z-ADDZMINC     ZCHGA
     C                     END
     C*
     C                     END                             - E1
     C*
     C** CHECK IF CHARGE BASIS (ZCGBS) IS 'P' (PERCENTAGE) AND THE CHARGING
     C** METHOD IS 'X' (TIERED)
     C*
     C           ZCGBS     IFEQ 'P'                        - B1
     C           ZCGMT     ANDEQ'X'
     C*
     C** DO UNTIL FLAG IS 'Y'
     C*
     C           ZFLAG     DOUEQ'Y'                        - B2
     C                     ADD  1         ZZ
     C*
     C** CHECK INDEX
     C*
     C           ZZ        IFEQ 15                         - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF PRINCIPAL AMOUNT IS LESS EQUAL THAN RANGE UPPER LIMITS
     C*
     C           ZAMT      IFLE ZRB,ZZ                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF RANGE UPPER LIMITS IS ZERO
     C*
     C           ZRB,ZZ    IFEQ *ZEROS                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** SET THE CHARGE RATE (ZCGRT) EQUAL TO PERCENTAGE
     C*
     C                     Z-ADDZPC,ZZ    ZCGRT
     C*
     C** MOVE THE EFFECTIVE CHARGE SPREAD (ZSPRD) INTO THE ADJUSTED
     C** CHARGE SPREAD (ZACSD)
     C*
     C                     MOVE ZSPRD     ZACSD
     C*
     C** CHECK IF THE CHARGE SPREAD INDICATOR IS '+' OR '-'
     C*
     C           ZSPRI     IFEQ '+'                        - B3
     C                     ADD  ZACSD     ZCGRT
     C                     ELSE                            - X3
     C                     SUB  ZACSD     ZCGRT
     C                     END                             - E3
     C*
     C** IF THE PRINCIPAL AMOUNT IS GREATER THAN RANGE UPPER LIMITS
     C*
     C           ZAMT      IFGT ZRB,ZZ                     - B3
     C           ZRB,ZZ    ANDNE*ZEROS
     C*
     C** CHECK THE INDEX
     C*
     C           ZZ        IFEQ 1                          - B4
     C*
     C** IF INDEX IS 1 PUT THE RANGE UPPER LIMITS IN A WORK FIELD ZZ152
     C*
     C                     Z-ADDZRB,ZZ    ZZ152  152
     C*
     C                     ELSE                            - X4
     C*
     C** OTHERWISE CALCULATE THE DIFFERENCE BETWEEN THE TWO LIMITS
     C*
     C           ZZ        SUB  1         Z2      20
     C           ZRB,ZZ    SUB  ZRB,Z2    ZZ152
     C                     END                             - E4
     C*
     C                     ELSE                            - X3
     C*
     C** IF THE PRINCIPAL AMOUNT IS LESS OR EQUAL THAN RANGE UPPER LIMITS
     C*
     C*
     C** CHECK THE INDEX
     C*
     C           ZZ        IFEQ 1                          - B4
     C*
     C** IF INDEX IS 1 PUT THE RANGE UPPER LIMITS IN A WORK FIELD ZZ152
     C*
     C                     Z-ADDZAMT      ZZ152
     C*
     C                     ELSE                            - X4
     C*
     C** OTHERWISE CALCULATE THE DIFFERENCE BETWEEN THE TWO LIMITS
     C*
     C           ZZ        SUB  1         Z2      20
     C           ZAMT      SUB  ZRB,Z2    ZZ152
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C** DIVIDE ZZ152 BY 100
     C*
     C           ZZ152     DIV  100       ZZ152     H
     C*
     C** MULTIPLY ZZ152 BY THE NUMBER OF CHARGE DAYS AND PUT THE RESULT
     C** IN A WORK FIELD (ZZ154)
     C*
     C           ZZ152     MULT ZNOCD     ZZ154  154
     C*
     C** DIVIDE THIS WORK FIELD (ZZ154) BY THE NUMBER OF DAYS IN THE
     C** CHARGE YEAR (ZNOCY)
     C*
     C           ZZ154     DIV  ZNOCY     ZZ154     H
     C*
     C**MULTIPLY THIS WORK FIELD ZZ154 BY THE CHARGE RATE (ZCGRT)
     C*
     C           ZZ154     MULT ZCGRT     ZZ154
     C*
     C** ADD THIS WORK FIELD ZZ154 TO THE TOTAL CHARGE AMOUNT (ZCHGA)
     C*
     C                     ADD  ZZ154     ZCHGA
     C****                                                                56841
     C****       ZMINC     MULT ZNOCD     ZMINC                           56841
     C****       ZMINC     DIV  ZNOCY     ZMINC     H                     56841
     C****                                                                56841
     C****       ZCHGA     IFLT ZMINC                                     56841
     C****                 Z-ADDZMINC     ZCHGA                           56841
     C****                 END                                            56841
     C*
     C                     END                             - E2
     C*                                                                   56841
     C           ZMINC     MULT ZNOCD     ZMINC                           56841
     C           ZMINC     DIV  ZNOCY     ZMINC     H                     56841
     C*                                                                   56841
     C           ZCHGA     IFLT ZMINC                                     56841
     C                     Z-ADDZMINC     ZCHGA                           56841
     C                     END                                            56841
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           ** ZPMCRG ESR**
     C********************************************************************
      /EJECT
      /COPY ZSRSRC,ZDAYSZ2
      /EJECT
      /COPY ZSRSRC,ZDYYRZ3
      /EJECT
      /COPY ZSRSRC,ZNCDZ3                                                 CPM005
      /EJECT                                                              CPM005
      /COPY ZSRSRC,ZLCDZ1                                                 CPM005
      /EJECT                                                              CPM005
      ********************************************************************
      *                                                                  *
      **#W03*****-*WRITE*TO*PF/GEPMZZ*************************************S01486
      * #W03     - WRITE TO PF/GEPMPA                                    *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P15     - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #W03      BEGSR                           **#W03 BEGSR**
     C                     MOVE 'T'       RECI
     C           TOTAL     DIV  1000      HRWN
     C                     MVR            HRDC
     C                     Z-ADDRRCNT     NORE1
     C*                                                                   CPM005
     C** Add 2 to Number of records as GL4114 expects to remove 2         CPM005
     C*                                                                   CPM005
     C                     ADD  2         NORE1                           CPM005
     C                     ENDSR                           **#W03 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #W04     - WRITE PORTFOLIO CHARGES ACCRUALS AUDIT REPORT         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P15     - AUDIT PROCESSING                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #W04      BEGSR                           **#W04 BEGSR**
      *
     C                     WRITEHEADAU
     C                     WRITETOTAU
     C***********          WRITEENDAU                                     S01486
     C*                                                                   S01486
     C           RRCNT     IFEQ *ZERO                                     S01486
     C                     WRITENODTLS                                    S01486
     C                     END                                            S01486
      *
     C                     ENDSR                           **#W04 ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * DEVCD    - DETERMINE EVENT CONTROL DATE                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           DEVCD     BEGSR                           *** DEVCD  ***
     C*
      * EVENT CONTROL DATE IS ECD
      * IF ACCRUALS/PROFIT DATE GE DATE OF NEXT WORKING DAY
     C           BKAPDT    IFGE BJDNWD
     C           BJDNWD    SUB  1         ECD
     C*
      *  ECD = DATE OF NEXT WORKING DAY - 1
      * OTHERWISE ECD = ACCRUALS/PROFIT DATE
     C                     ELSE
     C                     Z-ADDBKAPDT    ECD     50
     C                     END
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      * DEVCD    - DETERMINE EVENT CONTROL DATE                          *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWC9N0   - SPOT RATE OF BASE CURRENCY                            *
      * WWDAN0   - NUMBER OF DECIMAL PLACE OF BASE CURRENCY0             *
      * WWA8S0   - MULTIPLY/DIVIDE IND OF BASE CURRENCY                  *
      * WWAFST   - ACCOUNT TYPE                                          *
      * WWACOD   - ACCOUNT CODE TO ACCESS LF/SDACODL1                    *
      **WWCNUM***-*CUSTOMER*NUMBER*NUMERIC*TO*KEEP*THIS*FROM*PMCHRGPP*****S01486
      **WWPTFR***-*FROM*PMCHRGPP*ACCESS*PF/PMPORTPP*AND*PF/PMPOTTPP*******S01486
      * WWCNUM   - CUSTOMER NUMBER NUMERIC TO KEEP THIS FROM PMCHRGPD    *S01486
      * WWPTFR   - FROM PMCHRGPD ACCESS PF/PMPORTPD AND PF/PMPOTTPD      *S01486
      *                                                                  *
      ********************************************************************
     C           #INIT     BEGSR                           *#INIT BEGSR**
      *
      * DEFINE WORK FIELDS
      *
     C           *LIKE     DEFN PNCUSA    WWCUSA- 2
     C           *LIKE     DEFN ACNO      WWACNO
     C           *LIKE     DEFN A5ACTY    WWACTY
     C           *LIKE     DEFN ZDAYNO    WWCGND
     C           *LIKE     DEFN ZDAYNO    WWCSND
     C************LIKE     DEFN BRCD      WWDSNB                          S01486
     C           *LIKE     DEFN BRCA      WWDSNB                          S01486
     C           *LIKE     DEFN BBBRCD    WWBRC3                          S01486
     C           *LIKE     DEFN BBBRCD    WWBRCA
     C           *LIKE     DEFN BJCUST    WWCNUA
     C           *LIKE     DEFN BJCUST    WWCNUB
     C           *LIKE     DEFN PTFR      WWPTF1
     C************LIKE     DEFN A8IBAC    WWACOD                          S01486
     C           *LIKE     DEFN A5ACCD    WWACOD                          S01486
     C           *LIKE     DEFN BBCUST    WWCNU3
     C           *LIKE     DEFN BBBFIC    WWACO3
     C           *LIKE     DEFN BBACOC    WWACS3
     C           *LIKE     DEFN POCNUM    WWCNUM
     C           *LIKE     DEFN ZCHGA     WWTCTP
     C           *LIKE     DEFN A8BICN    WWBICN
     C           *LIKE     DEFN A6SPRT    WWC9N0
     C           *LIKE     DEFN A6NBDP    WWDAN0
     C           *LIKE     DEFN A6MDIN    WWA8S0
     C           *LIKE     DEFN A6SPRT    WWC9N1
     C           *LIKE     DEFN A6NBDP    WWDAN1
     C           *LIKE     DEFN A6MDIN    WWA8S1
     C           *LIKE     DEFN A6SPRT    WWC9N2
     C           *LIKE     DEFN A6NBDP    WWDAN2
     C           *LIKE     DEFN A6MDIN    WWA8S2
     C           *LIKE     DEFN A6SPAE    WWFYN2
     C           *LIKE     DEFN A6SPRT    WWC9N3
     C           *LIKE     DEFN A6NBDP    WWDAN3
     C           *LIKE     DEFN A6MDIN    WWA8S3
     C           *LIKE     DEFN A6SPAE    WWFYN3
     C           *LIKE     DEFN PTFR      WWPTFR
     C           *LIKE     DEFN POCGAD    WWMVAL
     C           *LIKE     DEFN POCGSP    WWCGSP
     C           *LIKE     DEFN POCGSI    WWCGSI
     C           *LIKE     DEFN POCGAD    WWTCHA
     C           *LIKE     DEFN ACSQ      WWACSQ
     C           *LIKE     DEFN POCGAD    WWTCSC
     C************LIKE     DEFN BRCD      WWBRCD                          S01486
     C           *LIKE     DEFN BRCA      WWBRCD                          S01486
     C************LIKE     DEFN A8IBAC    WWIBAC                          S01486
     C           *LIKE     DEFN POCGAD    WWCGAD
     C           *LIKE     DEFN VALD      WWVALD
     C           *LIKE     DEFN POCGAD    TOTAL + 3
      *                                                                   R00142
      *****Write*the*narrative*code*to*chain*in*sdnarrl0*********  R00142 S01486
     C***********          MOVE 'C6'      C6VAR   2                R00142 S01486
      ***********                                                  R00142 S01486
      *****Key*definition*for*the*narrative*code*in*multilanguage  R00142 S01486
     C***********KEYNAR    KLIST                                   R00142 S01486
     C***********          KFLD           BBLANG                   R00142 S01486
     C***********          KFLD           C6VAR                    R00142 S01486
     C*                                                                   S01486
     C**  Define local data area                                          S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           LDA                             S01486
      *
      *  SETUP DATA BASE ERROR FIELDS
      *
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE 'PM1200  'DBPGM
     C                     OUT  LDA                                       S01486
      *
      *  INITIALIZE WORK FIELDS
      *
     C                     Z-ADD*ZEROS    RRCNT
     C                     Z-ADD*ZEROS    TOTAL
     C**                   Z-ADD*ZEROS    SDCB
     C**                   Z-ADD*ZEROS    SDLB
     C**                   MOVE *BLANKS   OTST
     C**                   MOVE *BLANKS   BOKC
      *
      ***READ*ICD1*FROM*LF/SDBANKL1******************************         S01486
      ***********                                                         S01486
     C***********          READ SDBANKL1                 78               S01486
     C************IN78     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD01        DBASE            ***************S01486
     C***********          MOVE 'SDBANKL1'DBFILE           **DB ERROR 01**S01486
     C*                                                                   S01486
     C**  Access bank details                                             S01486
     C*                                                                   S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            ***************S01486
     C                     MOVE 'SDBANKPD'DBFILE           *DB ERROR 001 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                      ***************
     C                     END                             - E1
      *
      *  CHECK THE FORMAT OF THE DATE
      *
     C           BJDFIN    IFEQ 'M'                        - B1
     C                     MOVE '1'       *IN98
     C                     END                             - E1
     C***********BJCYCD    CHAINSDCURRL0             80                   S01486
     C************IN80     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD02        DBASE            ***************S01486
     C***********          MOVEL'SDCURRL0'DBFILE           **DB ERROR 02**S01486
     C***********          MOVELBJCYCD    DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access bank currency details                                    S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM BJCYCD    P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD2         DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 002 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CYCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
     C                     Z-ADDA6SPRT    WWC9N0
     C                     Z-ADDA6NBDP    WWDAN0
     C                     MOVE A6MDIN    WWA8S0
      *
      ***READ*LF/SDGELRL1*TO*GET*GENERAL*LEDGER*DETAILS*(COMPUTER         S01486
      ***SUSPENSE*ACCOUNT*CODE)**********************************         S01486
      ***********                                                         S01486
     C***********          READ SDGELRL1                 81               S01486
     C************IN81     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD03        DBASE            ***************S01486
     C***********          MOVEL'SDGELRL1'DBFILE           **DB ERROR 03**S01486
     C***********          MOVEL*BLANKS   DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access General Ledger details                                   S01486
     C**  (Computer Suspense Account code)                                S01486
     C*                                                                   S01486
     C**********           CALL 'AOGELRR0'                                S01486              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C********** SDGELR    PARM SDGELR    DSFDY                           S01486              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD3         DBASE            ***************S01486
     C                     MOVE 'SDGELRPD'DBFILE           *DB ERROR 003 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C** SET THE ACCRUAL PROFIT DATE FOR ZFRQA
     C*
     C                     Z-ADDBKAPDT    APDA    50
      *
     C                     MOVE BKACCD    WWACOD
     C***********WWACOD    CHAINSDACODL1             77                   S01486
     C************IN77     IFEQ '1'                        - B2           S01486
     C***********          Z-ADD06        DBASE            ***************S01486
     C***********          MOVEL'SDACODL1'DBFILE           **DB ERROR 06**S01486
     C***********          MOVELWWACOD    DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access account codes details                                    S01486
     C*                                                                   S01486
     C                     CALL 'AOACODR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C                     PARM WWACOD    P@ACCD                          S01486
     C           SDACOD    PARM SDACOD    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD6         DBASE            ***************S01486
     C                     MOVE 'SDACODPD'DBFILE           *DB ERROR 006 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@ACCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E2
     C                     MOVE A5ACTY    WWACTY
      *
      *  DETERMINE THE EVENT CONTROL DATE
      *
     C                     EXSR DEVCD
      *                                                                  33619
      ***READ*LF/SDTRADL1*TO*GET*TRADING*DATA*DETAILS*(SPOT*TRADE  3619   S01486
      ***ACCOUNT*CODE)*******************************************  3619   S01486
      ***********                                                  3619   S01486
     C***********          READ SDTRADL1                 81        3619   S01486
     C************IN81     IFEQ '1'                        - B1    3619   S01486
     C***********          Z-ADD21        DBASE            ********3619   S01486
     C***********          MOVEL'SDTRADL1'DBFILE           **DB ERR3619   S01486
     C***********          MOVEL*BLANKS   DBKEY            ********3619   S01486
     C***********          EXSR *PSSR                              3619   S01486
     C***********          END                             - E1    3619   S01486
     C***********                                                  3619   S01486
      ***********                                                         S01486
      ***READ*LF/SDPORTL0*TO*GET*THE*PORTFOLIO*MANAGEMENT*ICD****         S01486
      ***********                                                         S01486
     C***********          READ SDPORTL0                 83               S01486
     C************IN83     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD04        DBASE            ***************S01486
     C***********          MOVEL'SDPORTL0'DBFILE           **DB ERROR 04**S01486
     C***********          MOVEL*BLANKS   DBKEY            ***************S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          END                             - E1           S01486
     C*                                                                   S01486
     C**  Access Trading Data details                                     S01486
     C*                                                                   S01486
     C                     CALL 'AOTRADR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD21        DBASE            ***************S01486
     C                     MOVE 'SDTRADPD'DBFILE           *DB ERROR 021 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**  Access Portfolio Management ICD details                         S01486
     C*                                                                   S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD4         DBASE            ***************S01486
     C                     MOVE 'SDPORTPD'DBFILE           *DB ERROR 004 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Read the first Branch record                                    S01486
     C*                                                                   S01486
     C**********           CALL 'AOBRCHR0'                                S01486              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST'  P@OPTN                          S01486
     C                     PARM           P@BRCD  3                       S01486
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01486              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD17        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 017 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Set up array of branches                                        S01486
     C*                                                                   S01486
     C                     Z-ADD1         B                               S01486
     C*                                                                   S01486
     C           P@RTCD    DOWNE'*EOF'                                    S01486
     C*                                                                   S01486
     C                     MOVE A8BRCD    BRCD,B                          S01486
     C                     MOVE A8DFAC    DFAC,B                          S01486
     C                     MOVE A8DTAC    DTAC,B                          S01486
     C                     MOVE A8BICN    BICN,B                          S01486
     C                     ADD  1         B                               S01486
     C*                                                                   S01486
     C**  Read the next branch record                                     S01486
     C*                                                                   S01486
     C**********           CALL 'AOBRCHR0'                                S01486              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*NEXT '  P@OPTN                          S01486
     C                     PARM           P@BRCD                          S01486
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01486              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           P@RTCD    ANDNE'*EOF'                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD18        DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 018 *S01486
     C                     MOVEL'*NEXT '  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     ENDDO                                          S01486
     C*                                                                   CAC003
     C** Check if Analytical Accounting and Switchable Feature            CAC003
     C** CAC003 are switched on.                                          CAC003
     C                     MOVE '0'       *IN20                           CAC003
     C                     CALL 'AOMMODR0'                                CAC003
     C                     PARM *BLANKS   P@RTCD                          CAC003
     C                     PARM '*FIRST ' P@OPTN                          CAC003
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC003
     C*                                                                   CAC003
     C           P@RTCD    IFNE *BLANKS                                   CAC003
     C           *LOCK     IN   LDA                                       CAC003
     C                     Z-ADD35        DBASE            ***************CAC003
     C                     MOVE 'SDMMODPD'DBFILE           *DB ERROR 035 *CAC003
     C                     MOVE *BLANKS   DBKEY            ***************CAC003
     C                     OUT  LDA                                       CAC003
     C                     EXSR *PSSR                                     CAC003
     C                     END                                            CAC003
     C*                                                                   CAC003
     C                     CALL 'AOSARDR0'                                CAC003
     C                     PARM           P@RTCD                          CAC003
     C                     PARM '*VERIFY' P@OPTN                          CAC003
     C                     PARM 'CAC003'  P@SARD  6                       CAC003
     C                     PARM *BLANK    DSFDY                           CAC003
      *                                                                   CAC003
     C           P@RTCD    IFEQ *BLANK                                    CAC003
     C           BGN0ST    ANDEQ'Y'                                       CAC003
     C                     MOVE '1'       *IN20                           CAC003
     C*                                                                   CAC003
     C**  Retrieve Primary Funding Profit Centre.                         CAC003
     C                     CALL 'AOPCACR0'                                CAC003
     C                     PARM           P@RTCD                          CAC003
     C                     PARM '*FIRST ' P@OPTN                          CAC003
     C           SDPCAC    PARM SDPCAC    DSFDY                           CAC003
     C*                                                                   CAC003
     C           P@RTCD    IFNE *BLANKS                                   CAC003
     C           *LOCK     IN   LDA                                       CAC003
     C                     Z-ADD36        DBASE            ***************CAC003
     C                     MOVE 'SDPCACPD'DBFILE           *DB ERROR 036 *CAC003
     C                     MOVE *BLANKS   DBKEY            ***************CAC003
     C                     OUT  LDA                                       CAC003
     C                     EXSR *PSSR                                     CAC003
     C                     END                                            CAC003
     C*                                                                   CAC003
     C                     ENDIF                                          CAC003
      *                                                                                       CGL020
      ** Determine if Midas Compliance Watch is installed                                     CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM '       ' PRTCD   7                                           CGL020
     C                     PARM '*VERIFY' POPTN   7                                           CGL020
     C                     PARM 'CGL020'  PSARD   6                                           CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           PRTCD     IFNE *BLANK                                                        CGL020
     C           PRTCD     ANDNE'*NRF   '                                                     CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'PM1200  'DBPGM                                               CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     MOVEL'040'     DBASE                                               CGL020
     C                     MOVELPSARD     DBKEY                                               CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR *PSSR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           PRTCD     IFEQ *BLANK                                                        CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *
      *
      *  INITIALIZE THE COUNTER FIELD FOR AUDIT PRINT
      *
     C                     Z-ADD*ZEROS    RRCNT
     C                     MOVE *LOVAL    WWCNUM
     C                     MOVE *LOVAL    WWPTFR
     C/COPY WNCPYSRC,PM1200C010
      *
     C                     ENDSR                           *#INIT ENDSR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P01     - ACCESS CUSTOMER DETAILS                               *
      * #P02     - ACCESS PORTFOLIO DETAILS AND TOTALS                   *
      * #P03     - FORMAT CUSTOMER SETTLEMENT ACCOUNT DETAILS            *
      * #P04     - DETERMINE EFFECTIVE CHARGE DETAILS                    *
      * #P09     - GENERATE CHARGE ACCRUAL ENTRIES                       *
      * #P10     - GENERATE STANDARD SETTLEMENT ENTRIES                  *
      * #P11     - GENERATE INTER-BRANCH SETTLEMENT ENTRIES              *
      * #P12     - GENERATE CROSS-CURRENCY SETTLEMENT ENTRIES            *
      * #P13     - GENERATE BASE CURRENCY SETTLEMENT ENTRIES             *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR                           ** *PSRR BSR**
     C**
     C** DUMP AND RETURN TO THE CALLING PROGRAM
     C**
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     WRITEHEADAU
     C                     WRITEERRORAU
     C***********          WRITEENDAU                                     S01486
     C                     DUMP
     C                     RETRN
     C**
     C                     ENDSR                            ** *PSRR ESR**
     C*=========================================================================
     C/COPY WNCPYSRC,PM1200C004
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**  CPY@
(c) Finastra International Limited 2001
