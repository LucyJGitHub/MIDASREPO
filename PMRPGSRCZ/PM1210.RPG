     H
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Generated entries report')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                      *
     F*                                                               *
     F*  PM1210 - Generated Entries Report                            *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM005             Date 03Oct96               *
      *                 094397             Date 25Oct95               *
     F*                 081377             DATE 13DEC94               *
     F*                 S01486             DATE 11AUG94               *
     F*                 S01313             DATE 16JUN92               *
     F*                 R00955             DATE 14/11/90              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
     F*  CPM005 - Private Banking Phase II                            *
     F*           Focus Group Changes Upgraded to DBA                 *
     F*  094397 - Should call ZSFILE once have spool file number      *
     F*  081377 - ZSFILE should be called when printer file opened    *
     F*           to avoid spooled file name to be blank.             *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*  S01313 - PROGRAM RENAMED FOR PERFORMANCE                     *
     F*  R00955 - AMOUNTS EDITED WITH INCORRECT DECIMAL PLACES        *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FPMGEPML1IF  E           K        DISK
     F** PREFIX :
     F                                              KINFSR *PSSR
     F***SDBANKL1IF**E           K        DISK                            S01486
     F***PREFIX*:*BJ*********************************************         S01486
     F***********                                   KINFSR *PSSR          S01486
     F***SDCURRL0IF**E           K        DISK                            S01486
     F***PREFIX*:*A6*********************************************         S01486
     F***********                                   KINFSR *PSSR          S01486
     F***GEPMZZ**IF**E           K        DISK                            S01486
     FGEPMPA  IF  E           K        DISK                               S01486
     F** PREFIX :
     F                                              KINFSR *PSSR
     F***PM1210P1O** E             70     PRINTER                     UC  S01486
     FPM1210P1O   E             70     PRINTER      KINFDS SPOOL      UC  S01486
     F                                              KINFSR *PSSR          S01486
     F** PREFIX : RR
     FPM1210AUO   E                    PRINTER      KINFDS SPOOLU         S01486
     F                                              KINFSR *PSSR          S01486
     F** PREFIX : RR
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       70         OVERFLOW ON PM1210P1
     F********71*********ACCESS*ON*LF/SDBANKL1*******************         S01486
     F********72*********ACCESS*ON*LF/SDCURRL0*******************         S01486
     F*       73         ACCESS ON PF/GEPMZZ
     F*       74         ACCESS ON LF/PMGEPML1
     F*       81         FIRST RECORD READ ON LF/PMGEPML1
     F*       82         FILE OUT OF BALANCE
     F*
     F*       98         DATE IN FORMAT MMDDYY
     F*       99         WORK
     F*
     F*                Unused indicators
     F*                -----------------
     F*       01  02  03  04  05  06  07  08  09  10
     F*       11  12  13  14  15  16  17  18  19  20
     F*       21  22  23  24  25  26  27  28  29  30
     F*       31  32  33  34  35  36  37  38  39  40
     F*       41  42  43  44  45  46  47  48  49  50
     F*       51  52  53  54  55  56  57  58  59  60
     F*       61  62  63  64  65  66  67  68  69  ..
     F*       ..  ..  ..  ..  75  76  77  78  79  80
     F*       ..  ..  83  84  85  86  87  88  89  90
     F*       91  92  93  94  95  96  97  ..  ..
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     E*=========================================================================
     E*
     E** ARRAY FOR COPYRIGHT
     E*
     E                    CPY@    1   1 80
     E*
     E** ARRAY FOR QCMDEXC - IBM COMMAND
     E*
     E                    CMD     1   1 39
      /COPY ZSRSRC,ZDATE2Z1
     E*
      /COPY ZSRSRC,ZSEDITZ1
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA         DS                            256
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*                                                                   S01486
     ISPOOL       DS                                                      S01486
     I                                       83  92 SFILE                 S01486
     I**********                            123 1240SFNUM           S01486094397
     I                                    B 123 1240SFNUM                 094397
     I*                                                                   S01486
     ISPOOLU      DS                                                      S01486
     I                                       83  92 SFILEU                S01486
     I***********                           123 1240SFNUMU          S01486094397
     I                                    B 123 1240SFNUMU                094397
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Midas  Bank details                                          S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Midas  Currencies details                                    S01486
     I*                                                                   S01486
     ISDBRCH    E DSSDBRCHPD                                              S01486
     I**  Midas  SD Branch details                                     S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure                                            S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I**  Long data structure                                             S01486
     I*                                                                   S01486
      /COPY ZSRSRC,ZSEDITZ2
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * #INIT    - INITIAL PROCESSING                                    *
      * #P01     - PRINT HEADER DETAILS                                  *
      * #W02     - WRITE GENERATED ENTRY DETAIL LINE                     *
      * #W04     - WRITE PM GENERATED ENTRIES RUN CONTROL REPORT         *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      * ZDATE2   - CONVERT MIDAS DAY NUMBER TO DDMMMYY                   *
      * ZSEDIT   - INSERT A DECIMAL POINT AND SIGN INTO A NUMERIC FIE    *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      * QCMDEXC  - COMMAND OVERRIDE PRINTER FILE                         *
      *                                                                  *
      ********************************************************************
     C*================================================================
     C*
     C           *LIKE     DEFN PNAR      WWCMD +13
     C           *LIKE     DEFN CCY       WWCMDP+ 1
     C           *LIKE     DEFN CCY       WWCCY
     C************LIKE     DEFN BRCD      WWBRCD                          S01486
     C           *LIKE     DEFN BRCA      WWBRCD                          S01486
     C*                                                                   S01486
      /EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
      *
      ** PERFORM SETUP OF STANDARD FIELDS
      *
     C                     EXSR #INIT
      *
      ** ACCESS LF/PMGEPML1
      *
     C           *LOVAL    SETLLPMGEPML1                                  S01486
     C                     READ PMGEPML1                 74
      *
     C************IN74     IFEQ '1'                        - B1           S01486
      ***********                                                         S01486
      ***WRITE*HEADER********************************************         S01486
      ***********                                                         S01486
     C***********          EXSR #P01                                      S01486
      ***********                                                         S01486
     C***WRITE*NO*DETAILS*TO*PRINT*******************************         S01486
      ***********                                                         S01486
     C***********          WRITEPM1210F3                                  S01486
      ***********                                                         S01486
     C***********          END                             - E1           S01486
     C*                                                                   S01486
     C**  Check if main file is empty                                     S01486
     C*                                                                   S01486
     C           *IN74     IFEQ '1'                                       S01486
     C                     MOVE 'Y'       WEMPTY  1                       S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANK    WEMPTY                          S01486
     C***********                                                  S01486 081377
     C****Ensure*Report Spool File recorded by RCF                 S01486 081377
     C***********                                                  S01486 081377
     C***********          Z-ADDSFNUM     ZSNUM1  60               S01486 081377
     C***********          CALL 'ZSFILE'                           S01486 081377
     C***********          PARM           SEQ     5                S01486 081377
     C***********          PARM *BLANKS   SENTY   3                S01486 081377
     C***********          PARM           SFILE                    S01486 081377
     C***********          PARM           ZSNUM1                   S01486 081377
     C***********          PARM           ZSERR   1                S01486 081377
     C***********                                                  S01486 081377
     C***If*an*error occurred during ZSFILE processing,            S01486 081377
     C***return*to the calling program.                            S01486 081377
     C************                                                 S01486 081377
     C***********ZSERR     IFEQ 'Y'                                S01486 081377
     C***********          SETON                     U7U8LR        S01486 081377
     C***********          RETRN                                   S01486 081377
     C***********          ENDIF                                   S01486 081377
     C*                                                                   S01486
     C                     ENDIF                                          S01486
      *
      ** *IN81 SET TO '1' TO SHOW IT IS THE FIRST RECORD READ
      *
     C                     MOVE '1'       *IN81
      *
      ** SAVE BRANCH CODE
      *
     C***********          MOVE BRCD      WWBRCD                          S01486
     C                     MOVE BRCA      WWBRCD                          S01486
      *
      ** SAVE CURRENCY CODE
      *
     C                     MOVE CCY       WWCCY
      *
      ** PROCESS UNTIL END OF FILE LF/PMGEPML1
      *
     C           *IN74     DOWEQ'0'                        - B1
      *
      ** FIRST RECORD READ OR BRANCH CODE HAS CHANGED OR NEW PAGE
      *
     C***********BRCD      IFNE WWBRCD                     - B2           S01486
     C           BRCA      IFNE WWBRCD                     - B2           S01486
     C           *IN81     OREQ '1'
      *
      ** WRITE HEADER
      *
     C                     EXSR #P01
      *
     C                     END                             - E2
      *
      ** FIRST RECORD READ OR CURRENCY HAS CHANGED
      *
     C           *IN81     IFEQ '1'                        - B2
     C           CCY       ORNE WWCCY
      *
      ** ACCESS LF/SDCURRL0 WITH CURRENCY CODE TO GET NUMBER OF
      ** DECIMAL PLACES
      *
     C***********CCY       CHAINSDCURRL0             72                   S01486
      ***********                                                         S01486
     C************IN72     IFEQ '1'                        - B3           S01486
     C***********          Z-ADD2         DBASE            ***************S01486
     C***********          MOVEL'SDCURRL0'DBFILE           **DB ERROR 02**S01486
     C***********          MOVE CCY       DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access Currency details                                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM CCY       P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD2         DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           *DB ERROR 002 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@CYCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E3
      *
     C                     MOVE CCY       WWCCY            - E2           R00955
      *
     C                     END                             - E2
      *
      ** ADD 1 TO COUNTER OF RECORD
      *
     C                     ADD  1         RRCNT
      *
      ** CHECK OVERFLOW ON PM1210P1
      *
     C           *IN70     IFEQ '1'                        - B2
      *
     C                     WRITEPM1210F1
      *
     C                     MOVE '0'       *IN70
      *
     C                     END                             - E2
      *
      ** WRITE GENERATED ENTRIES
      *
     C                     EXSR #W02
      *
     C                     READ PMGEPML1                 74
      *
      ** RESET INDICATOR OF FIRST RECORD READ
      *
     C                     MOVE '0'       *IN81
      *
     C                     END                             - E1
      *
      ** ACCESS PF/GEPMZZ
      *
     C***********          READ GEPMZZ                   73               S01486
     C                     READ GEPMPA                   73               S01486
      *
     C           *IN73     IFEQ '1'                        - B1
     C                     Z-ADD3         DBASE            ***************
     C***********          MOVEL'GEPMZZ  'DBFILE           **DB ERROR 03**S01486
     C                     MOVE 'GEPMPA  'DBFILE           ***************S01486
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E3
      *
      ** WRITE GENERATED ENTRIES RUN CONTROL REPORT
      *
     C                     EXSR #W04
      *
      ** TERMINATE PROGRAM
      *
     C                     MOVE '1'       *INLR
     C*================================================================
     C*  P R O G R A M     E N D
     C*================================================================
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCMD    - COMMAND LINE                                          *
      * WWCMDP   - END COMMAND LINE                                      *
      *                                                                  *
      ********************************************************************
     C           #INIT     BEGSR                           **#INIT BSR**
      *
     C                     MOVEACPY@      BIS@   80
     C*                                                                   S01486
     C**  Define local data area                                          S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           LDA                             S01486
      *
      ** PREPARE LDA
      *
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE *BLANKS   DBPGM                           S01486
     C                     MOVEL'PM1210'  DBPGM
     C                     OUT  LDA                                       S01486
     C*                                                                   S01486
     C**  Ensure Audit Spool File recorded by RCF                         S01486
     C*                                                                   S01486
     C                     Z-ADDSFNUMU    ZSNUM2  60                      S01486
     C                     CALL 'ZSFILE'                                  S01486
     C                     PARM           SEQ                             S01486
     C                     PARM *BLANKS   SENTY                           S01486
     C                     PARM           SFILEU                          S01486
     C                     PARM           ZSNUM2                          S01486
     C                     PARM           ZSERR                           S01486
     C*                                                                   S01486
     C**  If an error occurred during ZSFILE processing,                  S01486
     C**  return to the calling program.                                  S01486
     C*                                                                   S01486
     C           ZSERR     IFEQ 'Y'                                       S01486
     C                     SETON                     U7U8LR               S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
      *
      ** SET EDIT CODE FOR ZSEDIT
      *
     C                     MOVE 'J'       ZECODE
      *
      ***GET*INSTALLATION*CONTROL*DATA*RECORD*1******************         S01486
      ***********                                                         S01486
     C************LOVAL    SETLLSDBANKL1                                  S01486
     C***********          READ SDBANKL1                 75               S01486
      ***********                                                         S01486
     C************IN75     IFEQ '1'                        - B1           S01486
     C***********          Z-ADD1         DBASE            ***************S01486
     C***********          MOVEL'SDBANKL1'DBFILE           **DB ERROR 01**S01486
     C***********          MOVE *BLANKS   DBKEY            ***************S01486
     C*                                                                   S01486
     C**  Access bank details                                             S01486
     C*                                                                   S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            ***************S01486
     C                     MOVE 'SDBANKPD'DBFILE           *DB ERROR 001 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             - E1
      *
      *  CHECK THE FORMAT OF THE DATE
      *
     C           BJDFIN    IFEQ 'M'                        - B1
     C                     MOVE '1'       *IN98
     C                     END                             - E1
      *
      ** BUILD COMMAND EXPRESSION FOR QCMDEXC
      *
     C                     MOVELCMD,1     WWCMD
     C                     MOVE ')'       WWCMDP
      *
      ** INITIALIZE COUNTER
      *
     C                     Z-ADD*ZEROS    RRCNT
      *
     C                     ENDSR                           **#INIT ESR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P01     - PRINT HEADER DETAILS                                  *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * QCMDEXC  - COMMAND OVERRIDE PRINTER FILE                         *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCMDP   - END COMMAND LINE                                      *
      * WWCMD    - COMMAND LINE                                          *
      * WWBRCD   - BRANCH CODE                                           *
      *                                                                  *
      ********************************************************************
     C           #P01      BEGSR                           **#P01  BSR**
      *
      ** CHECK IF FIRST RECORD READ
      *
     C           *IN81     IFEQ '1'                        - B1
      *
      ***SET*THE*PARAMETER*FOR*QCMDEXC*COMMAND*(BRANCH*CODE)*****         S01486
      ***********                                                         S01486
     C***********          MOVELBRCD      WWCMDP                          S01486
     C***********          MOVE WWCMDP    WWCMD                           S01486
      ***********                                                         S01486
      ***EXEC*QCMDEXC*COMMAND*(OVERRIDE*THE*PRINTER*FILE*WITH*THE*BRANCH  S01486
      ***CODE)***************************************************         S01486
      ***********                                                         S01486
     C***********          CALL 'QCMDEXC'                                 S01486
     C***********          PARM WWCMD     QCAA   43                       S01486
     C***********          PARM 43        QCAN   155                      S01486
      *
      ** OPEN THE PRINTER FILE
      *
     C                     OPEN PM1210P1
     C                     MOVE 'Y'       WOPEN   1                       S01486
     C*                                                                   081377
     C**  Ensure Report Spool File recorded by RCF                        081377
     C*                                                                   081377
     C                     Z-ADDSFNUM     ZSNUM1  60                      081377
     C                     CALL 'ZSFILE'                                  081377
     C                     PARM           SEQ     5                       081377
     C                     PARM *BLANKS   SENTY   3                       081377
     C                     PARM           SFILE                           081377
     C                     PARM           ZSNUM1                          081377
     C                     PARM           ZSERR   1                       081377
     C*                                                                   081377
     C** If an error occurred during ZSFILE processing,                   081377
     C** return to the calling program.                                   081377
     C*                                                                   081377
     C           ZSERR     IFEQ 'Y'                                       081377
     C                     SETON                     U7U8LR               081377
     C                     RETRN                                          081377
     C                     ENDIF                                          081377
      *
     C                     ELSE                            - X1
      *
      ** OTHERWISE, IF THE BRANCH CODE HAS CHANGED
      *
     C*                                                                   S01486
     C                     WRITEENDRPT                                    S01486
     C*                                                                   S01486
     C                     CLOSEPM1210P1
      *
      ***SET*THE*PARAMETER*FOR*QCMDEXC*COMMAND*(BRANCH*CODE)*****         S01486
      ***********                                                         S01486
     C***********          MOVELBRCD      WWCMDP                          S01486
     C***********          MOVE WWCMDP    WWCMD                           S01486
      ***********                                                         S01486
      ***EXEC*QCMDEXC*COMMAND*(OVERRIDE*THE*PRINTER*FILE*WITH*THE*BRANCH  S01486
      ***CODE)***************************************************         S01486
      ***********                                                         S01486
     C***********          CALL 'QCMDEXC'                                 S01486
     C***********          PARM WWCMD     QCAA                            S01486
     C***********          PARM 43        QCAN                            S01486
      *
      ** OPEN THE PRINTER FILE
      *
     C                     OPEN PM1210P1
     C*                                                                   081377
     C**  Ensure Report Spool File recorded by RCF                        081377
     C*                                                                   081377
     C                     Z-ADDSFNUM     ZSNUM1  60                      081377
     C                     CALL 'ZSFILE'                                  081377
     C                     PARM           SEQ     5                       081377
     C                     PARM *BLANKS   SENTY   3                       081377
     C                     PARM           SFILE                           081377
     C                     PARM           ZSNUM1                          081377
     C                     PARM           ZSERR   1                       081377
     C*                                                                   081377
     C** If an error occurred during ZSFILE processing,                   081377
     C** return to the calling program.                                   081377
     C*                                                                   081377
     C           ZSERR     IFEQ 'Y'                                       081377
     C                     SETON                     U7U8LR               081377
     C                     RETRN                                          081377
     C                     ENDIF                                          081377
      *
     C                     END                             - E1
      *
      ** WRITE THE HEADINGS OF THE REPORT
      *
     C***********          MOVE BRCD      RRBRCD                          S01486
     C***********          MOVE BRCD      WWBRCD                          S01486
     C                     MOVE BRCA      RRBRCD                          S01486
     C                     MOVE BRCA      WWBRCD                          S01486
     C*                                                                   S01486
     C**  Access branch details                                           S01486
     C*                                                                   S01486
     C**********           CALL 'AOBRCHR0'                                S01486              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY'    P@OPTN                          S01486
     C                     PARM BRCA      P@BRCD  3                       S01486
     C           SDBRCH    PARM SDBRCH    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD5         DBASE            ***************S01486
     C                     MOVE 'SDBRCHPD'DBFILE           *DB ERROR 005 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     MOVELP@BRCD    DBKEY                           S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     MOVE A8BRNM    RRBRNM                          S01486
     C*                                                                   S01486
      *
     C                     WRITEPM1210F1
      *
     C                     ENDSR                           **#P01  ESR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #W02     - WRITE GENERATED ENTRY DETAIL LINE                     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZDATE2   - CONVERT MIDAS DAY NUMBER TO DDMMMYY                   *
      * ZSEDIT   - INSERT A DECIMAL POINT AND SIGN INTO A NUMERIC FIE    *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #W02      BEGSR                           **#W02  BSR**
      ** SET CUSTOMER NUMBER
     C                     MOVE CNUM      RRCNUM
      ** SET CURRENCY CODE
     C                     MOVE CCY       RRCCY
      ** SET ACCOUNT CODE
     C                     MOVE ACOD      RRACOD
      ** SET ACCOUNT SEQUENCE
     C                     MOVE ACSQ      RRACSQ
      ** SET RETAIL NUMBER
     C           ACNO      IFEQ *ZEROS                     - B1
     C                     MOVE *BLANKS   RRACNO
     C                     ELSE                            - X1
     C                     MOVE ACNO      RRACNO
     C                     END                             - E1
      ** CONVERT POSTING DATE
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
      ** SET THE POSTING DATE ON REPORT
     C                     MOVE ZADATE    RRPSTD
      ** CONVERT VALUE DATE
     C                     Z-ADDVALD      ZDAYNO
     C                     EXSR ZDATE2
      ** SET THE POSTING DATE ON REPORT
     C                     MOVE ZADATE    RRVALD
      ** SET POSTING NARRATIVE
     C                     MOVE PNAR      RRPNAR
      ** SET POSTING AMOUNT USING ZSEDIT
     C                     Z-ADDPSTA      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     EXSR ZSEDIT
      *
     C                     MOVE ZOUT21    RRPSTA
      ** SET DEBIT/CREDIT INDICATOR
     C           DRCR      IFEQ *ZEROS                     - B1
     C                     MOVE 'DR'      RRDRCR
     C                     ELSE                            - X1
     C                     MOVE 'CR'      RRDRCR
     C                     END                             - E1
      *
     C                     WRITEPM1210F2
      *
     C                     ENDSR                           **#W02  ESR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #W04     - WRITE PM GENERATED ENTRIES RUN CONTROL REPORT         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #W04      BEGSR                           **#W04  BSR**
      *
      ** WRITE REPORT HEADING
      *
     C                     WRITEHEADAU
     C*                                                                   CPM005
     C** REMOVE THE 2 RECORDS ADDED IN PM1200 FOR GL4114                  CPM005
     C*                                                                   CPM005
     C                     SUB  2         NORE1                           CPM005
      *
      **CHECK IF DIFFERENCE BETWEEN RECORD ON FILE AND RECORD IN FILE
      *
     C           RRCNT     IFNE NORE1                      - B1
      *
      ** SETON U8 AND *IN82
      *
     C                     MOVE '1'       *IN82
     C                     MOVE '1'       *INU8
      *
     C                     END                             - E1
      *
      ** WRITE RUN CONTROL
      *
     C                     Z-ADDNORE1     RRNORE
     C                     WRITECONTROL
      *
      ***WRITE*END*OF*REPORT*************************************         S01486
      ***********                                                         S01486
     C***********          WRITEENDAU                                     S01486
     C*                                                                   S01486
     C**  Write No details to report if main file is empty                S01486
     C*                                                                   S01486
     C           WEMPTY    IFEQ 'Y'                                       S01486
     C                     WRITENODTLS                                    S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C**  Write end of report                                             S01486
     C*                                                                   S01486
     C           WOPEN     IFEQ 'Y'                                       S01486
     C                     WRITEENDRPT                                    S01486
     C                     CLOSEPM1210P1                                  S01486
     C                     ENDIF                                          S01486
      *
     C                     ENDSR                           **#W04  ESR**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - DATA BASE ERROR PROCESSING                            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      * MAIN     - MAIN PROCESSING                                       *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR                           ***PSRR BSR**
      *
      ** ROLL BACK CHANGES , DUMP AND RETURN TO THE CALLING PROGRAM
      *
     C                     SETON                     LRU7U8
     C                     WRITEHEADAU
     C                     WRITEERRORAU
     C***********          WRITEENDAU                                     S01486
     C*                                                                   S01486
     C           WOPEN     IFEQ 'Y'                                       S01486
     C                     WRITEDBERROR                                   S01486
     C                     CLOSEPM1210P1                                  S01486
     C                     MOVE *BLANK    WOPEN                           S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR                            ***PSRR ESR**
      ********************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZSEDITZ3
      /EJECT
**  CPY@
(c) Finastra International Limited 2001
**  CMD  - QCMDEXC ARRAY
OVRPRTF FILE(PM1210P1) SPLFNAME(PM1210P
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
