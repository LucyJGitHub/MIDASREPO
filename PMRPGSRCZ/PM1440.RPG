     H        1                                                           S01486
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM RE events extract')                           *
     H***********                                                         S01486
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                                 *
     F*                                                               *
     F*  PM1440  - PM RE EVENTS EXTRACT                               *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CLE064             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CDL049             Date 11Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2304            Date 30Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CPB002             Date 13Dec99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 21Feb00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 02MAR99               *
      *                 CTI002 Exposure Management / TI Interface     *
     F*                 CPM005             DATE 10JUL96               *
     F*                 CPM004             DATE 28MAR96               *
     F*                 085862             DATE 16MAR95               *
     F*                 S01486             DATE 05AUG94               *
     F*                 47719              DATE 24/11/92              *
     F*                 R08268             DATE 24/10/91              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2304 - Various file layout changes. Recompile.            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  CPB002 - Meridian DBA Middleware Replication Customization.  *
     F*  CPB001 -  'Private Banking' Module                           *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*  CPM004 - Bank Portfolios                                     *
     F*  085862 - INCLUDE BRANCH IN ACCOUNT IDENTIFIER                *
     F*  S01486 - Private Banking upgrade to Release 10               *
     F*  47719  - CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES    *
     F*  R08268 - SUNDRY FIXES TO SPEED UP GENERATION OF CASHFLOWS    *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FSTANDSB IF  E                    DISK
     F                                              KINFSR *PSSR
     FCUSEXCE IF  E                    DISK
     F                                              KINFSR *PSSR
     FACCNT   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDBANKL1*IS*'BJ'**************************************S01486
     F***SDBANKL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDGELRL0*IS*'BK'**************************************S01486
     F***SDGELRL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F***TABLETJ*IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDPLCSL0*IS*'BB'**************************************S01486
     F***SDPLCSL0IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*PMPORTPP*IS*'PN'**************************************S01486
     F***PMPORTPPIF**E           K        DISK                            S01486
     F**  PREFIX OF PMPORTPD IS 'PN'                                      S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDCURRL0*IS*'A6'**************************************S01486
     F***SDCURRL0IF  E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*SDACODL0*IS*'A5'**************************************S01486
     F***SDACODL0IF  E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F****PREFIX*OF*PMEVNTPP*IS*'Q9'**************************************S01486
     F***PMEVNTPPO   E                    DISK                            S01486
     F**  PREFIX OF PMEVNTPD IS 'Q9'                                      S01486
     FPMEVNTPDO   E                    DISK                               S01486
     F                                              KINFSR *PSSR
      **  Prefix of PMEVCYPD is 'FG'                                      CPM005
     FPMEVCYPDO   E                    DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     FPM1440AUO   E                    PRINTER
     E*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*     71  -  READ INDICATOR
     F*     72  -  CHAIN INDICATOR
     F*     75  -  '0' => DEBIT CASE
     F*            '1' => CREDIT CASE
     F*     80  -  READ INDICATOR
     F*     81  -  CHAIN INDICATOR
     E*****************************************************************
     E*
     E                    CPY@    1   1 80
     E*
     E** FORMAT SE DETAILS FOR OUTPUT  (SR/ZFRELN)
     E**********          ZLI        20  1                                                    CGL029
     E                    ZLI        26  1                                                    CGL029
     E*                                                                   B08268
     E** TABLES/ARRAYS USED TO AVOID FILE ACCESS OPERATIONS               B08268
     E                    CYCD      200  3                                B08268
     E                    SPRT      200 13 8                              B08268
     E                    NBDP      200  1 0                              B08268
     E                    MDIN      200  1                                B08268
     E*
     E** ARRAY FOR PF/PMEVNTPP UPDATE
     E                    MSG     1   8 30
     E*
      /COPY ZSRSRC,ZPOWERZ1
      /COPY ZSRSRC,ZFRQAZ1
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,ZHOLE                                                  S01486
     I*****************************************************************
     I*                                                                   B08268
     IPMSTAT      DS                                                      B08268
     I                                        1   50WWECD                 B08268
     I                                        1 256 WWSTAT                B08268
     I**   MIDAS 'Next Available Transaction No.' Data Area  MNATN .
     IDNATN       DS                              5
     I                                        1   50FNATN
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     IPSDS       SDS
     I                                      244 246 WSID
     I                                      254 263 USIDXX
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA********UDS                            256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*                                                                   CPM004
     I** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
     I** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
     I*
     ISDACOD    E DSSDACODPD                                              S01486
     I** DUMMY RECORD FORMAT FOR ACCOUNT CODE DETAILS                     S01486
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I** DUMMY RECORD FORMAT FOR BANK DETAILS                             S01486
     I*                                                                   CPB001
     ISDMMOD    E DSSDMMODPD                                              CPB001
     I** Midas   Module details                                           CPB001
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I** DUMMY RECORD FORMAT FOR CURRENCY DETAILS                         S01486
     I*                                                                   S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I** DUMMY RECORD FORMAT FOR CUSTOMER DETAILS                         S01486
     I*                                                                   S01486
     ISDGELR    E DSSDGELRPD                                              S01486
     I              QQACCD                          GEACCD                                    CGL029
     I** DUMMY RECORD FORMAT FOR GENERAL LEDGER DETAILS                   S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              CPM004
     I**  SD Portfolio Management ICD details                             CPM004
     I*                                                                   CPM004
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I** DUMMY RECORD FORMAT FOR PORTFOLIO MANAGEMENT CUSTOMER DETAILS    S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01486
     I*                                                                   S01486
     IDSLDY     E DSDSLDY                                                 CPB001
     I* THIRD DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE            CPB001
      /COPY ZSRSRC,ZHOLI                                                  S01486
      **************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * INDEX OF SUBROUTINES                                                   *
      * MAIN     - MAIN PROCESSING                                             *
      * INIT     - INITIALISATION OF STANDARD FIELDS - ACCESS STAN.DT          *
      * P01      - PROCESS STANDING ORDERS                                     *
      * P02      - PROCESS CUSTOMER EXCHANGES                                  *
      * P03      - PROCESS STANDING ORDER MULTIPLE RECORD                      *
      * P04      - OBTAIN EXCHANGE RATES                                       *
      * W0101    - WRITE PORTFOLIO EVENTS CREDIT RECORDS                       *
      * W0102    - WRITE PORTFOLIO EVENTS DEBIT RECORDS                        *
      * W0103    - WRITE PORTFOLIO EVENTS DEBIT RECORDS                        *
      * W0104    - WRITE PORTFOLIO EVENTS CREDIT RECORDS                       *
      * W0105    - WRITE PORTFOLIO EVENTS CHARGES RECORDS                      *
      * W02      - WRITE RUN CONTROL REPORT                                    *
      * ZFRELN   - FORMAT SECOND LINE OF NARRATIVE FOR RETAIL                  *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      * ZCCYXR   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      * ZFRQA    - INCREMENT DAY NUMBER DATE BY A PERIOD VALUE                 *
      * ZDATE1   - TO VALIDATE DATE SUBMITTED-CONVERT TO A NUM.OF DAY          *
      * ZDATE2   - TO CONVERT A DAY NUMBER TO A DATE FORMAT                    *
      * *PSSR    - ERROR SUBROUTINE                                            *
      *                                                                        *
      * EXTERNAL ROUTINES CALLED                                               *
      *                                                                        *
      **************************************************************************
     C** KEY DEFINITION
     C           KACC      KLIST
     C**********           KFLD           WWCUS   60                                          CSD027
     C                     KFLD           WWCUS   6                                           CSD027
     C                     KFLD           WWCCY   3
     C**********           KFLD           WWACD   40                                          CGL029
     C                     KFLD           WWACD  100                                          CGL029
     C                     KFLD           WWACS   20
     C                     KFLD           WWBRC   3                       S01486
     C*
     C           KPORT     KLIST
     C                     KFLD           WWCUS
     C                     KFLD           WWPTFR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** MAIN PROCESSING
     C*****************************************************************
     C*
     C                     EXSR INIT
     C*
     C** PERFORM PROCESS P01 - PROCESS STANDING ORDERS
     C                     EXSR P01
     C*
     C** PERFORM PROCESS P02 - PROCESS CUSTOMER EXCHANGES
     C                     EXSR P02
     C*
     C** PRODUCE AUDIT REPORT AS PER W02 TO SHOW HOW MANY RECORDS
     C** WRITTEN TO FILE
     C                     EXSR W02
     C*
     C                     SETON                     LR
     C*
     C*****************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * INIT     - INITIALISATION OF STANDARD FIELDS - ACCESS STAN.DT          *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWAJCD   - BASE CURRENCY                                               *
      * WWECD    - EVENT CONTROL DATE                                          *
      * WWECPX   - EVENT CONTROL DATE + 365 DAYS                               *
      *                                                                        *
      **************************************************************************
     C           INIT      BEGSR                           ** INIT  BSR **
      *                                                                   CPM005
      **  Setup field to count record written in PMEVCYPD                 CPM005
      *                                                                   CPM005
     C                     Z-ADD*ZEROS    RRNORE                          CPM005
     C*
     C** PREPARE LDA
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM1440'  DBPGM
     C                     OUT  LDA                                       S01486
     C*                                                                   B08268
     C** DEFINE DATA AREA PMSTAT                                          B08268
     C           *NAMVAR   DEFN           PMSTAT                          B08268
     C                     IN   PMSTAT                                    B08268
     C*                                                                   CPB001
     C**   Access module details                                          CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM *BLANKS   @RTCD   7                       CPB001
     C                     PARM '*FIRST ' @OPTN   7                       CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
     C*
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1***************************S01486
     C** ACCESS BANK ICD DETAILS                                          S01486
     C***********          READ SDBANKL1                 71               S01486
     C************IN71     IFEQ '1'                                       S01486
     C***ERROR************************************************************S01486
     C***********          Z-ADD1         DBASE            **DB ERROR 01**S01486
     C***********          MOVEL'SDBANK'  DBFILE           ***************S01486
     C***********          MOVEL*BLANKS   DBKEY                           S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          END                                            S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM '*DBERR'  RTCD    7                       S01486
     C                     PARM '*FIRST'  OPTN    7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*
     C** SAVE VALUE FOR BASE CURRENCY FOR ACCOUNTING
     C*
     C                     MOVELBJCYCD    WWCYCD  3
     C*
     C** TEST DATE FORMAT FOR SR/ZDATE2
     C*
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C*
     C** GET GENERAL LEDGER DETAILS FOR ACCRUAL/PROFIT DATE
     C*
     C***********          READ SDGELRL1                 71               S01486
     C************IN71     IFEQ '1'                                       S01486
     C***ERROR************************************************************S01486
     C***********          Z-ADD4         DBASE            **DB ERROR 04**S01486
     C***********          MOVEL'SDGELR'  DBFILE           ***************S01486
     C***********          MOVEL*BLANKS   DBKEY                           S01486
     C***********          EXSR *PSSR                                     S01486
     C***********          END                                            S01486
     C**********           CALL 'AOGELRR0'                                S01486              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR'  RTCD                            S01486
     C                     PARM '*FIRST'  OPTN                            S01486
     C********** SDGELR    PARM SDGELR    DSFDY                           S01486              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   CPM004
     C** ACCESS PM ICD                                                    CPM004
     C*                                                                   CPM004
     C                     CALL 'AOPORTR0'                                CPM004
     C                     PARM *BLANKS   P@RTCD                          CPM004
     C                     PARM '*FIRST'  P@OPTN                          CPM004
     C           SDPORT    PARM SDPORT    DSFDY                           CPM004
     C*                                                                   CPM004
     C           P@RTCD    IFNE *BLANKS                                   CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD22        DBASE            ***************CPM004
     C                     MOVE 'SDPORTPD'DBFILE           * DB ERROR 02 *CPM004
     C                     MOVEL'*FIRST'  DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C*                                                                   B08268
     C** READ THROUGH SDCURRL0 SETTING UP ARRAY OF CURRENCIES             B08268
     C***********          READ SDCURRL0                 72         B08268S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*FIRST'  OPTN                            S01486
     C                     PARM *BLANKS   KEYCY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C                     Z-ADD1         B       30                      B08268
     C************IN72     DOWEQ'0'                                 B08268S01486
     C           RTCD      DOWEQ*BLANKS                                   S01486
     C                     MOVE A6CYCD    CYCD,B                          B08268
     C                     Z-ADDA6SPRT    SPRT,B                          B08268
     C                     MOVE A6MDIN    MDIN,B                          B08268
     C                     Z-ADDA6NBDP    NBDP,B                          B08268
     C                     ADD  1         B                               B08268
     C***********          READ SDCURRL0                 72         B08268S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*NEXT'   OPTN                            S01486
     C                     PARM *BLANKS   KEYCY                           S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C                     END                                            B08268
     C****                                                                B08268
     C****CCESS LF/SDCURRL0 WITH KEY OF BASE CURRENCY FOR ACCOUNTING TO   B08268
     C****BTAIN FX EXCHANGE RATE INFORMATION                              B08268
     C****       WWCYCD    CHAINSDCURRL0             71                   B08268
     C****       *IN71     IFEQ '1'                                       B08268
     C****RROR                                             ***************B08268
     C****                 Z-ADD2         DBASE            **DB ERROR 02**B08268
     C****                 MOVEL'SDCURR'  DBFILE           ***************B08268
     C****                 MOVEL*BLANKS   DBKEY                           B08268
     C****                 MOVELWWCYCD    DBKEY                           B08268
     C****                 EXSR *PSSR                                     B08268
     C****                 END                                            B08268
     C****                                                                B08268
     C****AVE VALUE FOR FX EXCHANGE RATE INFORMATION                      B08268
     C****POT RATE                                                        B08268
     C****                                                                B08268
     C****                 Z-ADDA6SPRT    WC9NBB 138                      B08268
     C****ULTIPLY/DIVIDE INDICATOR                                        B08268
     C****                 MOVELA6MDIN    WA8STB  1                       B08268
     C****URRENCY DECIMAL PLACES                                          B08268
     C****                 Z-ADDA6NBDP    WDANBB  10                      B08268
     C*                                                                   B08268
     C** ACCESS LF/SDCURRL0 USING THE BASE CURRENCY FROM LF/SDBANKL1      B08268
     C** FOR THE SPOT RATE AND NUMBER OF DECIMAL PLACES                   B08268
     C                     Z-ADD1         B                               B08268
     C           WWCYCD    LOKUPCYCD,B                   72               B08268
     C** ERROR                                                            B08268
     C           *IN72     IFEQ '0'                        ***************B08268
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD2         DBASE            **DB ERROR 02**B08268
     C                     MOVEL'SDCURRL0'DBFILE           ***************B08268
     C                     MOVELWWCYCD    DBKEY                           B08268
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     B08268
     C                     ELSE                                           B08040
     C                     Z-ADDSPRT,B    A6SPRT                          B08040
     C                     MOVE MDIN,B    A6MDIN                          B08040
     C                     Z-ADDNBDP,B    A6NBDP                          B08040
     C                     Z-ADDA6SPRT    WC9NBB 138                      B08268
     C                     MOVELA6MDIN    WA8STB  1                       B08268
     C                     Z-ADDA6NBDP    WDANBB  10                      B08268
     C                     END                                            B08040
     C*
     C** SET THE ACCRUAL PROFIT DATE FOR ZFRQA
     C*
     C                     Z-ADDBKAPDT    APDA    50
     C****                                                                B08268
     C****ET THE EVENT CONTROL DATE TO BE USED BY THIS PROGRAM AS THE     B08268
     C****ESSER OF (DATE OF NEXT WORKING DAY - 1) FROM LF/SDBANKL1        B08268
     C****ND THE ACCRUALS/PROFIT DATE FROM LF/SDGELRL1                    B08268
     C****                                                                B08268
     C****       BJDNWD    SUB  1         WWDNWD  50                      B08268
     C****       WWDNWD    IFLT BKAPDT                                    B08268
     C****                 Z-ADDWWDNWD    WWECD   50                      B08268
     C****                 ELSE                                           B08268
     C****                 Z-ADDBKAPDT    WWECD                           B08268
     C****                 END                                            B08268
     C*
     C** EVENT CONTROL DATE + 365 DAYS
     C*
     C           WWECD     ADD  365       WWECPX  50
     C*
     C           EINIT     ENDSR                           ** END INIT  **
     C*
      **************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P01      - PROCESS STANDING ORDERS                                     *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * P04      - OBTAIN EXCHANGE RATES                                       *
      * P03      - PROCESS STANDING ORDER MULTIPLE RECORD                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWPAYF   - PAYMENT FREQUENCY                                           *
      * WWDYTP   - DAY IN MONTH                                                *
      **WWPCUS***-*PORTFOLIO*CUSTOMER*INDICATOR***************************S01486
      * WWCSBY   - CUSTOMER BASE CURRENCY                                      *
      * WWBYDP   - CUSTOMER BASE CURRENCY DECIMAL PLACES                       *
      * WWAVCD   - ACCOUNT OFFICER CODE                                        *
      * WWCUS    - CUSTOMER NUMBER                                             *
      * WWCCY    - CURRENCY                                                    *
      * WWACD    - ACCOUNT CODE                                                *
      * WWACS    - ACCOUNT SEQUENCE NUMBER                                     *
      * WWBRC    - BRANCH                                                 S01486
      * WWPTFR   - PORTFOLIO NUMBER                                            *
      *                                                                        *
      **************************************************************************
     C           P01       BEGSR                           ** P01   BSR **
     C*
     C** READ A RECORD FROM PF/STANDSB
     C           *IN80     DOWEQ'0'
     C                     READ STANDSB                  80
     C           *IN80     IFEQ '0'
     C*
     C** IF RECORD ID IS NOT EQUAL TO 'D' READ THE NEXT RECORD
     C           RECI      IFNE 'D'
     C                     GOTO E80
     C                     END
     C*
     C** SAVE PAYMENT FREQUENCY + DAY IN MONTH FOR LATER USE
     C                     MOVELPAYF      WWPAYF  1
     C                     Z-ADDDYTP      WWDYTP  20
     C*
     C** FIRST CASE : DEBIT INFORMATION
     C                     MOVE '0'       *IN75
     C***********          MOVE DCUS      WCUS    6                       S01486
     C***********WCUS      CHAINSDPLCSL0             72                   S01486
     C                     MOVELDCUS      KEYCN                           S01486
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C*                                                                   CPM004
     C           *LIKE     DEFN DRBR      ##BRCA                          CPM004
     C           ##BRCA    IFNE DRBR                                      CPM004
     C                     MOVELDRBR      ##BRCA                          CPM004
     C                     EXSR BRANCH                                    CPM004
     C           P@RTCD    IFNE *BLANKS                                   CPM004
     C                     MOVEL*BLANKS   ##BRCA                          CPM004
     C                     GOTO E70                                       CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C                     MOVE O#ACOF    BBACOC                          CPM004
     C                     MOVEL*BLANKS   RTCD                            CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency                                      CPM004
     C                     MOVELQBCSBY    WWCSBY  3                       CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency Decimal Places                       CPM004
     C                     Z-ADDQBBYDP    WWBYDP  10                      CPM004
      *                                                                   CPM004
      ** Save Account Officer Code                                        CPM004
     C                     MOVELBBACOC    WWACOC  2                       CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
      *                                                                   CPM004
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN  10                       S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C************IN72     IFEQ '1'                                       S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     GOTO E70
     C                     ELSE
     C*****                CALL 'AOCUSTR0'                          S01486CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN  10                       S01486
     C                     PARM *BLANKS   KEYST   7                       S01486
     C*****      SDCUST    PARM SDCUST    DSSDY                     S01486CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     GOTO E70                                       S01486
     C                     ELSE                                           S01486
     C*                                                                   CPB001
     C           BBPRBA    IFEQ 'Y'                                       CPB001
     C**********           Z-ADDDCUS      WWCUS                                        CPB002 CSD027
     C                     MOVE DCUS      WWCUS                                               CSD027
     C                     MOVELCCY       WWCCY                           CPB002
     C                     Z-ADDDACD      WWACD                           CPB002
     C                     Z-ADDDACS      WWACS                           CPB002
     C                     MOVELDRBR      WWBRC                           CPB002
     C           KACC      CHAINACCNT                72                   CPB002
     C                     MOVELPTFR      WWPTFR                          CPB002
     C           KPORT     CHAINPMPORTPD             72                   CPB001
     C           *IN72     IFEQ '1'                                       CPB001
     C           *LOCK     IN   LDA                        ***************CPB001
     C                     Z-ADD10        DBASE            **DB ERROR 10**CPB001
     C                     MOVEL'PMPORT'  DBFILE           ***************CPB001
     C                     MOVEL*BLANKS   DBKEY                           CPB001
     C                     MOVELWWCUS     DBKEY                           CPB001
     C                     MOVE WWPTFR    DBKEY                           CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ELSE                                           CPB001
     C                     MOVELPNPTCY    QBCSBY                          CPB001
     C                     Z-ADDPNPCDP    QBBYDP                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C** SAVE PORTFOLIO CUSTOMER INDICATOR
     C***********          MOVELQBPCUS    WWPCUS  1                       S01486
     C** SAVE CUSTOMER BASE CURRENCY
     C                     MOVELQBCSBY    WWCSBY  3
     C** SAVE CUSTOMER BASE CURRENCY DECIMAL PLACES
     C                     Z-ADDQBBYDP    WWBYDP  10
     C** SAVE ACCOUNT OFFICER CODE
     C                     MOVELBBACOC    WWACOC  2
     C                     END                                            S01486
     C                     END
      *                                                                   CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C*
     C** USE DEBIT DETAILS FROM PF/STANDSB TO CHAIN TO LF/ACCNT
     C**********           Z-ADDDCUS      WWCUS                                               CSD027
     C                     MOVE DCUS      WWCUS                                               CSD027
     C                     MOVELCCY       WWCCY
     C                     Z-ADDDACD      WWACD
     C                     Z-ADDDACS      WWACS
     C                     MOVELDRBR      WWBRC                           S01486
     C           KACC      CHAINACCNT                72
     C           *IN72     IFEQ '1'
     C*
     C** IF PORTFOLIO CUSTOMER INDICATOR IS EQUAL TO 'Y', SET PORTFOLIO
     C** REFERENCE TO '9997', ELSE SET PORTFOLIO REFERENCE TO BLANK
     C***********WWPCUS    IFEQ 'Y'                                       S01486
     C                     MOVEL'9997'    WWPTFR  4
     C***********          ELSE                                           S01486
     C***********          MOVEL*BLANKS   WWPTFR                          S01486
     C***********          END                                            S01486
     C                     END
     C*
     C           *IN72     IFEQ '0'
      *                                                                   CPM005
      **  If account not live, do not output standing order records       CPM005
      *                                                                   CPM005
     C           RECI      IFNE 'D'                                       CPM005
     C                     MOVEL*BLANKS   WWPTFR                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVELPTFR      WWPTFR
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     END
     C*
     C           WWPTFR    IFNE *BLANKS
     C                     EXSR P04
     C*
     C** PROCESS P03 - STANDING ORDER MULTIPLE RECORD (GENERATE DEBIT
     C** EVENT)
     C                     EXSR P03
     C                     END
     C           E70       TAG
     C*
     C***********************************
     C** SECOND CASE : CREDIT INFORMATION
     C***********************************
     C                     MOVE '1'       *IN75
     C***********          MOVEL*BLANKS   WCUS                            S01486
     C***********          MOVE CCUS      WCUS                            S01486
     C***********WCUS      CHAINSDPLCSL0             72                   S01486
     C                     MOVEL*BLANKS   KEYCN                           S01486
     C                     MOVELCCUS      KEYCN                           S01486
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C*                                                                   CPM004
     C           ##BRCA    IFNE CBRC                                      CPM004
     C                     MOVELCBRC      ##BRCA                          CPM004
     C                     EXSR BRANCH                                    CPM004
     C           P@RTCD    IFNE *BLANKS                                   CPM004
     C                     MOVEL*BLANKS   ##BRCA                          CPM004
     C                     GOTO E80                                       CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     MOVE O#ACOF    BBACOC                          CPM004
     C                     MOVEL*BLANKS   RTCD                            CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency                                      CPM004
     C                     MOVELQBCSBY    WWCSBY  3                       CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency Decimal Places                       CPM004
     C                     Z-ADDQBBYDP    WWBYDP  10                      CPM004
      *                                                                   CPM004
      ** Save Account Officer Code                                        CPM004
     C                     MOVELBBACOC    WWACOC  2                       CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
      *                                                                   CPM004
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C************IN72     IFEQ '1'                                       S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     GOTO E80
     C                     ELSE
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C                     PARM *BLANKS   KEYST                           S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     GOTO E80                                       S01486
     C                     ELSE                                           S01486
     C** SAVE PORTFOLIO CUSTOMER INDICATOR
     C***********          MOVELQBPCUS    WWPCUS                          S01486
     C** SAVE CUSTOMER BASE CURRENCY
     C                     MOVELQBCSBY    WWCSBY
     C** SAVE CUSTOMER BASE CURRENCY DECIMAL PLACES
     C                     Z-ADDQBBYDP    WWBYDP
     C** SAVE ACCOUNT OFFICER CODE
     C                     MOVELBBACOC    WWACOC
     C                     END                                            S01486
     C                     END
      *                                                                   CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C*
     C** USE CREDIT DETAILS FROM PF/STANDSB TO CHAIN TO LF/ACCNT
     C**********           Z-ADDCCUS      WWCUS                                               CSD027
     C                     MOVE CCUS      WWCUS                                               CSD027
     C                     MOVELCCY       WWCCY
     C                     Z-ADDCSCA      WWACD
     C                     Z-ADDCACD      WWACS
     C                     MOVELCBRC      WWBRC                           S01486
     C           KACC      CHAINACCNT                72
     C           *IN72     IFEQ '1'
     C*
     C** IF PORTFOLIO CUSTOMER INDICATOR IS EQUAL TO 'Y', SET PORTFOLIO
     C** REFERENCE TO '9997', ELSE SET PORTFOLIO REFERENCE TO BLANK
     C***********WWPCUS    IFEQ 'Y'                                       S01486
     C                     MOVEL'9997'    WWPTFR  4
     C***********          ELSE                                           S01486
     C***********          MOVEL*BLANKS   WWPTFR                          S01486
     C***********          END                                            S01486
     C                     END
     C*
     C           *IN72     IFEQ '0'
      *                                                                   CPM005
      **  If account not live, do not output standing order records       CPM005
      *                                                                   CPM005
     C           RECI      IFNE 'D'                                       CPM005
     C                     MOVEL*BLANKS   WWPTFR                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVELPTFR      WWPTFR
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     END
     C*
     C           WWPTFR    IFNE *BLANKS
     C                     EXSR P04
     C*
     C** PROCESS P03 - STANDING ORDER MULTIPLE RECORD (GENERATE CREDIT
     C** EVENT)
     C                     EXSR P03
     C                     END
     C*
     C           E80       TAG
     C                     END
     C                     END
     C*
     C           EP01      ENDSR                           ** END P01   **
      **************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P02      - PROCESS CUSTOMER EXCHANGES                                  *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * P04      - OBTAIN EXCHANGE RATES                                       *
      * W0103    - WRITE PORTFOLIO EVENTS DEBIT RECORDS                        *
      * W0104    - WRITE PORTFOLIO EVENTS CREDIT RECORDS                       *
      * W0105    - WRITE PORTFOLIO EVENTS CHARGES RECORDS                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      **WWPCUS***-*PORTFOLIO*CUSTOMER*INDICATOR***************************S01486
      * WWCSBY   - CUSTOMER BASE CURRENCY                                      *
      * WWBYDP   - CUSTOMER BASE CURRENCY DECIMAL PLACES                       *
      * WWAVCD   - ACCOUNT OFFICER CODE                                        *
      * WWCUS    - CUSTOMER NUMBER                                             *
      * WWCCY    - CURRENCY                                                    *
      * WWACD    - ACCOUNT CODE                                                *
      * WWACS    - ACCOUNT SEQUENCE NUMBER                                     *
      * WWBRC    - BRANCH                                                 S01486
      * WWPTFR   - PORTFOLIO NUMBER                                            *
      * WWECPX   - EVENT CONTROL DATE + 365 DAYS                               *
      * WWHSGN   - CHARGE SIGN                                                 *
      * WWDAT    - CHARGES VALUE DATE                                          *
      *                                                                        *
      **************************************************************************
     C           P02       BEGSR                           ** P02   BSR **
     C*
     C** READ A RECORD FROM PF/CUSEXCE
     C           *IN81     DOWEQ'0'
     C                     READ CUSEXCE                  81
     C           *IN81     IFEQ '0'
     C*
     C** IF RECORD ID IS NOT EQUAL TO 'D' READ THE NEXT RECORD
     C           RECI      IFNE 'D'
     C                     GOTO E81
     C                     END
     C*********************************
     C** FIRST CASE : DEBIT INFORMATION
     C*********************************
     C***********          MOVE DCUS      WCUS    6                       S01486
     C***********WCUS      CHAINSDPLCSL0             72                   S01486
     C                     MOVELDCUS      KEYCN                           S01486
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C*                                                                   CPM004
     C           ##BRCA    IFNE DRBR                                      CPM004
     C                     MOVELDRBR      ##BRCA                          CPM004
     C                     EXSR BRANCH                                    CPM004
     C           P@RTCD    IFNE *BLANKS                                   CPM004
     C                     MOVEL*BLANKS   ##BRCA                          CPM004
     C                     GOTO E71                                       CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     MOVE O#ACOF    BBACOC                          CPM004
     C                     MOVEL*BLANKS   RTCD                            CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency                                      CPM004
     C                     MOVELQBCSBY    WWCSBY  3                       CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency Decimal Places                       CPM004
     C                     Z-ADDQBBYDP    WWBYDP  10                      CPM004
      *                                                                   CPM004
      ** Save Account Officer Code                                        CPM004
     C                     MOVELBBACOC    WWACOC  2                       CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
      *                                                                   CPM004
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C************IN72     IFEQ '1'                                       S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     GOTO E71
     C                     ELSE
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C                     PARM *BLANKS   KEYST                           S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     GOTO E71                                       S01486
     C                     ELSE                                           S01486
     C** SAVE PORTFOLIO CUSTOMER INDICATOR
     C***********          MOVELQBPCUS    WWPCUS                          S01486
     C** SAVE CUSTOMER BASE CURRENCY
     C                     MOVELQBCSBY    WWCSBY
     C** SAVE CUSTOMER BASE CURRENCY DECIMAL PLACES
     C                     Z-ADDQBBYDP    WWBYDP
     C** SAVE ACCOUNT OFFICER CODE
     C                     MOVELBBACOC    WWACOC
     C                     END                                            S01486
     C                     END
      *                                                                   CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C*
     C** USE DEBIT DETAILS FROM PF/CUSEXCE TO CHAIN TO LF/ACCNT
     C**********           Z-ADDDCUS      WWCUS                                               CSD027
     C                     MOVE DCUS      WWCUS                                               CSD027
     C                     MOVELDRCY      WWCCY
     C                     Z-ADDDCOD      WWACD
     C                     Z-ADDDACS      WWACS
     C                     MOVELDRBR      WWBRC                           S01486
     C           KACC      CHAINACCNT                72
     C           *IN72     IFEQ '1'
     C*
     C** IF PORTFOLIO CUSTOMER INDICATOR IS EQUAL TO 'Y', SET PORTFOLIO
     C** REFERENCE TO '9997', ELSE SET PORTFOLIO REFERENCE TO BLANK
     C***********WWPCUS    IFEQ 'Y'                                       S01486
     C                     MOVEL'9997'    WWPTFR
     C***********          ELSE                                           S01486
     C***********          MOVEL*BLANKS   WWPTFR                          S01486
     C***********          END                                            S01486
     C                     END
     C*
     C           *IN72     IFEQ '0'
     C                     MOVELPTFR      WWPTFR
     C                     END
     C*
     C** IF PORTFOLIO REFERENCE IS NOT BLANK AND DEBIT VALUE DATE <=
     C** EVENT CONTROL DATE + 365 DAYS
     C           WWPTFR    IFNE *BLANKS
     C           DRVD      ANDLEWWECPX
     C                     EXSR P04
     C*
     C** PROCESS W0103- WRITE PORTFOLIO CASHFLOW EVENTS RECORD
     C                     EXSR W0103
     C*
     C** ADD 1 TO COUNT (NUMBER OF RECORDS WRITTEN TO PF/PMEVNTPP) FOR
     C** AUDIT REPORT
     C                     ADD  1         COUNT   50
     C                     END
     C           E71       TAG
     C*
     C***********************************
     C** SECOND CASE : CREDIT INFORMATION
     C***********************************
     C***********          MOVE CCUS      WCUS                            S01486
     C***********WCUS      CHAINSDPLCSL0             72                   S01486
     C                     MOVEL*BLANKS   KEYCN                           S01486
     C                     MOVELCCUS      KEYCN                           S01486
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C*                                                                   CPM004
     C           ##BRCA    IFNE CBRC                                      CPM004
     C                     MOVELCBRC      ##BRCA                          CPM004
     C                     EXSR BRANCH                                    CPM004
     C           P@RTCD    IFNE *BLANKS                                   CPM004
     C                     MOVEL*BLANKS   ##BRCA                          CPM004
     C                     GOTO E72                                       CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     MOVE O#ACOF    BBACOC                          CPM004
     C                     MOVEL*BLANKS   RTCD                            CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency                                      CPM004
     C                     MOVELQBCSBY    WWCSBY  3                       CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency Decimal Places                       CPM004
     C                     Z-ADDQBBYDP    WWBYDP  10                      CPM004
      *                                                                   CPM004
      ** Save Account Officer Code                                        CPM004
     C                     MOVELBBACOC    WWACOC  2                       CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
      *                                                                   CPM004
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C************IN72     IFEQ '1'                                       S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     GOTO E72
     C                     ELSE
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C                     PARM *BLANKS   KEYST                           S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     GOTO E72                                       S01486
     C                     ELSE                                           S01486
     C** SAVE PORTFOLIO CUSTOMER INDICATOR
     C***********          MOVELQBPCUS    WWPCUS                          S01486
     C** SAVE CUSTOMER BASE CURRENCY
     C                     MOVELQBCSBY    WWCSBY
     C** SAVE CUSTOMER BASE CURRENCY DECIMAL PLACES
     C                     Z-ADDQBBYDP    WWBYDP
     C** SAVE ACCOUNT OFFICER CODE
     C                     MOVELBBACOC    WWACOC
     C                     END                                            S01486
     C                     END
      *                                                                   CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C*
     C** USE CREDIT DETAILS FROM PF/CUSEXCE TO CHAIN TO LF/ACCNT
     C**********           Z-ADDCCUS      WWCUS                                               CSD027
     C                     MOVE CCUS      WWCUS                                               CSD027
     C                     MOVELCRCY      WWCCY
     C                     Z-ADDCCOD      WWACD
     C                     Z-ADDCACS      WWACS
     C                     MOVELCBRC      WWBRC                           S01486
     C           KACC      CHAINACCNT                72
     C           *IN72     IFEQ '1'
     C*
     C** IF PORTFOLIO CUSTOMER INDICATOR IS EQUAL TO 'Y', SET PORTFOLIO
     C** REFERENCE TO '9997', ELSE SET PORTFOLIO REFERENCE TO BLANK
     C***********WWPCUS    IFEQ 'Y'                                       S01486
     C                     MOVEL'9997'    WWPTFR
     C***********          ELSE                                           S01486
     C***********          MOVEL*BLANKS   WWPTFR                          S01486
     C***********          END                                            S01486
     C                     END
     C*
     C           *IN72     IFEQ '0'
     C                     MOVELPTFR      WWPTFR
     C                     END
     C*
     C** IF PORTFOLIO REFERENCE IS NOT BLANK AND CREDIT VALUE DATE <=
     C** EVENT CONTROL DATE + 365 DAYS
     C           WWPTFR    IFNE *BLANKS
     C           CRVD      ANDLEWWECPX
     C                     EXSR P04
     C*
     C** PROCESS W0104- WRITE PORTFOLIO CASHFLOW EVENTS RECORD
     C                     EXSR W0104
     C*
     C** ADD 1 TO COUNT (NUMBER OF RECORDS WRITTEN TO PF/PMEVNTPP) FOR
     C** AUDIT REPORT
     C                     ADD  1         COUNT   50
     C                     END
     C           E72       TAG
     C*
     C***********************************
     C** THIRD CASE : CHARGES INFORMATION
     C***********************************
     C                     MOVELHSGN      WWHSGN  1
     C*
     C** IF CHARGES SIGN IS EQUAL TO '-', MOVE CREDIT CURRENCY TO CCY
     C** CODE AND CREDIT VALUE DATE TO VALUE DATE.
     C** IF CHARGES SIGN IS EQUAL TO '+', MOVE DEBIT CURRENCY TO CCY
     C** CODE AND DEBIT VALUE DATE TO VALUE DATE.
     C           WWHSGN    IFEQ '-'
     C                     Z-ADDCRVD      WWDAT   50
     C                     MOVELCRCY      WWCCY
     C                     MOVELCBRC      WWBRC                           S01486
     C                     ELSE
     C                     Z-ADDDRVD      WWDAT
     C                     MOVELDRCY      WWCCY
     C                     MOVELDRBR      WWBRC                           S01486
     C                     END
     C*
     C***********          MOVE HCUS      WCUS                            S01486
     C***********WCUS      CHAINSDPLCSL0             72                   S01486
     C                     MOVEL*BLANKS   KEYCN                           S01486
     C                     MOVELHCUS      KEYCN                           S01486
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C*                                                                   CPM004
     C* If no charge account exit                                         CPM004
     C*                                                                   CPM004
     C********** HCUS      IFEQ 0                                                      CPM004 CSD027
     C           HCUS      IFEQ *BLANKS                                                       CSD027
     C                     GOTO E81                                       CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C           ##BRCA    IFNE BRCA                                      CPM004
     C                     MOVELBRCA      ##BRCA                          CPM004
     C                     EXSR BRANCH                                    CPM004
     C           P@RTCD    IFNE *BLANKS                                   CPM004
     C                     MOVEL*BLANKS   ##BRCA                          CPM004
     C                     GOTO E81                                       CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     MOVE O#ACOF    BBACOC                          CPM004
     C                     MOVEL*BLANKS   RTCD                            CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency                                      CPM004
     C                     MOVELQBCSBY    WWCSBY  3                       CPM004
      *                                                                   CPM004
      ** Save Customer Base Currency Decimal Places                       CPM004
     C                     Z-ADDQBBYDP    WWBYDP  10                      CPM004
      *                                                                   CPM004
      ** Save Account Officer Code                                        CPM004
     C                     MOVELBBACOC    WWACOC  2                       CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
      *                                                                   CPM004
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C************IN72     IFEQ '1'                                       S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     GOTO E81
     C                     ELSE
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C                     PARM *BLANKS   KEYST                           S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     GOTO E81                                       S01486
     C                     ELSE                                           S01486
     C** SAVE PORTFOLIO CUSTOMER INDICATOR
     C***********          MOVELQBPCUS    WWPCUS                          S01486
     C** SAVE CUSTOMER BASE CURRENCY
     C                     MOVELQBCSBY    WWCSBY
     C** SAVE CUSTOMER BASE CURRENCY DECIMAL PLACES
     C                     Z-ADDQBBYDP    WWBYDP
     C** SAVE ACCOUNT OFFICER CODE
     C                     MOVELBBACOC    WWACOC
     C                     END                                            S01486
     C                     END
      *                                                                   CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C*
     C** USE CHARGES DETAILS FROM PF/CUSEXCE TO CHAIN TO LF/ACCNT
     C**********           Z-ADDHCUS      WWCUS                                               CSD027
     C                     MOVE HCUS      WWCUS                                               CSD027
     C                     Z-ADDHACD      WWACD
     C                     Z-ADDHASQ      WWACS
     C                     MOVE BRCA      WWBRC                           085862
     C           KACC      CHAINACCNT                72
     C           *IN72     IFEQ '1'
     C*
     C** IF PORTFOLIO CUSTOMER INDICATOR IS EQUAL TO 'Y', SET PORTFOLIO
     C** REFERENCE TO '9997', ELSE SET PORTFOLIO REFERENCE TO BLANK
     C***********WWPCUS    IFEQ 'Y'                                       S01486
     C                     MOVEL'9997'    WWPTFR
     C***********          ELSE                                           S01486
     C***********          MOVEL*BLANKS   WWPTFR                          S01486
     C***********          END                                            S01486
     C                     END
     C*
     C           *IN72     IFEQ '0'
     C                     MOVELPTFR      WWPTFR
     C                     END
     C*
     C** IF PORTFOLIO REFERENCE IS NOT BLANK AND CHARGES VALUE DATE <=
     C** EVENT CONTROL DATE DATE + 365 DAYS
     C           WWPTFR    IFNE *BLANKS
     C           WWDAT     ANDLEWWECPX
     C                     EXSR P04
     C*
     C** PROCESS W0105- WRITE PORTFOLIO CASHFLOW EVENTS RECORD
     C                     EXSR W0105
     C*
     C** ADD 1 TO COUNT (NUMBER OF RECORDS WRITTEN TO PF/PMEVNTPP) FOR
     C** AUDIT REPORT
     C                     ADD  1         COUNT   50
     C                     END
     C*
     C           E81       TAG
     C                     END
     C                     END
     C*
     C           EP02      ENDSR                           ** END P02   **
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P03      - PROCESS STANDING ORDER MULTIPLE RECORD                      *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * W0101    - WRITE PORTFOLIO EVENTS CREDIT RECORDS                       *
      * W0102    - WRITE PORTFOLIO EVENTS DEBIT RECORDS                        *
      * ZFRQA    - INCREMENT DAY NUMBER DATE BY A PERIOD VALUE                 *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P01      - PROCESS STANDING ORDERS                                     *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWECPX   - EVENT CONTROL DATE + 365 DAYS                               *
      * WWEVTD   - EVENT DATE                                                  *
      * WWETAM 1 -                                                             *
      * WWETAM   - EVENT AMOUNT                                                *
      * WWPAYF   - PAYMENT FREQUENCY                                           *
      * WWDYTP   - DAY IN MONTH                                                *
      * WWCCY    - CURRENCY                                                    *
      *                                                                        *
      **************************************************************************
     C           P03       BEGSR                           ** P03   BSR **
     C*
     C** IF FIRST PAYMENT DATE (PF/STANDSB) IS GREATER THAN EVENT CONTROL DATE
     C** AND FIRST PAYMENT DATE <= EVENT CONTROL DATE + 365 DAYS
     C           DFPY      IFGT WWECD
     C           DFPY      ANDLEWWECPX
     C*
     C** SET EVENT DATE TO FIRST PAYMENT DATE AND SET EVENT AMOUNT TO
     C** FIRST PAYMENT AMOUNT
     C                     Z-ADDDFPY      WWEVTD  50
     C                     Z-ADDAFPY      WWETAM 150
     C*
     C** IF IT'S A CREDIT RECORD PROCESS W0101-WRITE PORTFOLIO CREDIT
     C** CASHFLOW EVENTS RECORD
     C           *IN75     IFEQ '1'
     C                     EXSR W0101
     C                     ADD  1         COUNT
     C                     ELSE
     C*
     C** IF IT'S A DEBIT RECORD PROCESS W0102-WRITE PORTFOLIO DEBIT
     C** CASHFLOW EVENTS RECORD
     C                     EXSR W0102
     C                     ADD  1         COUNT
     C                     END
     C*
     C                     END
     C*
     C** IF SECOND PAYMENT DATE (PF/STANDSB) IS GREATER THAN EVENT CONTROL DATE
     C** AND SECOND PAYMENT DATE <= EVENT CONTROL DATE + 365 DAYS
     C           DSPY      IFGT WWECD
     C           DSPY      ANDLEWWECPX
     C*
     C** SET EVENT DATE TO SECOND PAYMENT DATE
     C                     Z-ADDDSPY      WWEVTD
     C*
     C** IF SECOND PAYMENT AMOUNT NOT ZERO, SET EVENT AMOUNT TO SECOND
     C** PAYMENT AMOUNT.OTHERWISE (IF ZERO) SET TO FIRST PAYMENT AMOUNT
     C           ASPY      IFNE 0
     C                     Z-ADDASPY      WWETAM
     C                     ELSE
     C                     Z-ADDAFPY      WWETAM
     C                     END
     C*
     C** IF IT'S A CREDIT RECORD PROCESS W0101-WRITE PORTFOLIO CREDIT
     C** CASHFLOW EVENTS RECORD
     C           *IN75     IFEQ '1'
     C                     EXSR W0101
     C                     ADD  1         COUNT
     C                     ELSE
     C*
     C** IF IT'S A DEBIT RECORD PROCESS W0102-WRITE PORTFOLIO DEBIT
     C** CASHFLOW EVENTS RECORD
     C                     EXSR W0102
     C                     ADD  1         COUNT
     C                     END
     C*
     C                     END
     C*
     C** IF LAST PAYMENT DATE (PF/STANDSB) IS EQUAL TO ZERO, SET LAST
     C** PAYMENT DATE TO 99999
     C           DLPY      IFEQ 0
     C                     Z-ADD99999     DLPY
     C                     END
     C*
     C** IF SECOND PAYMENT DATE (PF/STANDSB) IS NOT EQUAL TO ZERO
     C           DSPY      IFNE 0
     C** SET EVENT DATE TO SECOND PAYMENT DATE
     C                     Z-ADDDSPY      WWEVTD
     C*
     C** IF SECOND PAYMENT AMOUNT NOT ZERO
     C           ASPY      IFNE 0
     C*
     C** SET EVENT AMOUNT TO SECOND PAYMENT AMOUNT
     C                     Z-ADDASPY      WWETAM
     C                     ELSE
     C*
     C** SET EVENT AMOUNT TO FIRST PAYMENT AMOUNT
     C                     Z-ADDAFPY      WWETAM
     C                     END
     C*
     C                     ELSE
     C*
     C** SECOND PAYMENT DATE IS EQUAL TO ZERO
     C** SET EVENT AMOUNT TO FIRST PAYMENT AMOUNT, AND EVENT DATE TO
     C** FIRST PAYMENT DATE
     C                     Z-ADDDFPY      WWEVTD
     C                     Z-ADDAFPY      WWETAM
     C                     END
     C*
     C** EXSR ZFRQA TO OBTAIN NEXT PAYMENT DATE PARAMETERS
     C*  ZFREQ=PAYMENT FREQUENCY (STANDSB)
     C*  ZDAYNO=EVENT DATE (FROM ABOVE)
     C*  ZMDAY=DAY IN MONTH (STANDSB)
     C*  ZCCY=CURRENCY CODE
     C                     MOVELWWPAYF    ZFREQ
     C                     Z-ADDWWEVTD    ZDAYNO
     C                     Z-ADDWWDYTP    ZMDAY
     C                     MOVELWWCCY     ZCCY
     C                     EXSR ZFRQA
     C                     Z-ADDZDAYNO    WWEVTD
     C*
     C** DO WHILE EVENT DATE LESS THAN LAST PAYMENT DATE AND WHILE
     C** EVENT DATE <= EVENT CONTROL DATE + 365 DAYS
     C*
     C           WWEVTD    DOWLTDLPY
     C           WWEVTD    ANDLEWWECPX
     C*
     C           *IN75     IFEQ '1'
     C*
     C** IF IT'S A CREDIT RECORD PROCESS W0101-WRITE PORTFOLIO CREDIT
     C** CASHFLOW EVENTS RECORD
     C                     EXSR W0101
     C                     ADD  1         COUNT
     C                     ELSE
     C*
     C** IF IT'S A DEBIT RECORD PROCESS W0102-WRITE PORTFOLIO DEBIT
     C** CASHFLOW EVENTS RECORD
     C                     EXSR W0102
     C                     ADD  1         COUNT
     C                     END
     C*
     C** EXSR ZFRQA TO OBTAIN NEXT PAYMENT DATE PARAMETERS
     C** ZFREQ=PAYMENT FREQUENCY (STANDSB)
     C** ZDAYNO=EVENT DATE (FROM ABOVE)
     C** ZMDAY=DAY IN MONTH (STANDSB)
     C** ZCCY=CURRENCY CODE
     C                     MOVELWWPAYF    ZFREQ
     C                     Z-ADDWWEVTD    ZDAYNO
     C                     Z-ADDWWDYTP    ZMDAY
     C                     MOVELWWCCY     ZCCY
     C                     EXSR ZFRQA
     C                     Z-ADDZDAYNO    WWEVTD
     C                     END
     C*
     C** IF LAST PAYMENT DATE IS GREATER THAN EVENT CONTROL DATE AND LAST
     C** PAYMENT DATE <= EVENT CONTROL DATE + 365 DAYS
     C           DLPY      IFGT WWECD
     C           DLPY      ANDLEWWECPX
     C*
     C** SET EVENT DATE TO LAST PAYMENT DATE
     C                     Z-ADDDLPY      WWEVTD
     C*
     C** IF LAST PAYMENT AMOUNT NOT EQUAL TO ZERO
     C           ALPY      IFNE 0
     C*
     C** SET EVENT AMOUNT TO LAST PAYMENT AMOUNT
     C                     Z-ADDALPY      WWETAM
     C                     END
     C*
     C** IF IT'S A CREDIT RECORD PROCESS W0101-WRITE PORTFOLIO CREDIT
     C** CASHFLOW EVENTS RECORD
     C           *IN75     IFEQ '1'
     C                     EXSR W0101
     C                     ADD  1         COUNT
     C                     ELSE
     C*
     C** IF IT'S A DEBIT RECORD PROCESS W0102-WRITE PORTFOLIO DEBIT
     C** CASHFLOW EVENTS RECORD
     C                     EXSR W0102
     C                     ADD  1         COUNT
     C                     END
     C*
     C                     END
     C*
     C           EP03      ENDSR                           ** END P03   **
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * P04      - OBTAIN EXCHANGE RATES                                       *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P01      - PROCESS STANDING ORDERS                                     *
      * P02      - PROCESS CUSTOMER EXCHANGES                                  *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWCCY    - CURRENCY                                                    *
      * WWCSBY   - CUSTOMER BASE CURRENCY                                      *
      * WWPTFR   - PORTFOLIO NUMBER                                            *
      * WWCUS    - CUSTOMER NUMBER                                             *
      * WWPTCY   - PORTFOLIO CURRENCY                                          *
      * WWPCDP   - PORTFOLIO CURRENCY DECIMAL PLACES                           *
      *                                                                        *
      **************************************************************************
     C           P04       BEGSR                           ** P04   BSR **
      *                                                                   CPM004
      *  If Bank Portfolios supported then use BICN                       CPM004
      *                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           *LIKE     DEFN WWCUS     ##CUS                           CPM004
     C                     MOVELWWCUS     ##CUS                           CPM004
     C                     MOVELO#BICN    WWCUS                           CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C****                                                                B08268
     C****CCESS LF/SDCURRL0 WITH KEY OF EVENT CURRENCY                    B08268
     C****       WWCCY     CHAINSDCURRL0             72                   B08268
     C****       *IN72     IFEQ '1'                                       B08268
     C****RROR                                             ***************B08268
     C****                 Z-ADD8         DBASE            **DB ERROR 08**B08268
     C****                 MOVEL'SDCURR'  DBFILE           ***************B08268
     C****                 MOVEL*BLANKS   DBKEY                           B08268
     C****                 MOVELWWCCY     DBKEY                           B08268
     C****                 EXSR *PSSR                                     B08268
     C****                 ELSE                                           B08268
     C****AVE SOME VALUES                                                 B08268
     C****POT RATE                                                        B08268
     C****                 Z-ADDA6SPRT    WC9NBF 138                      B08268
     C****ULTIPLY/DIVIDE INDICATOR                                        B08268
     C****                 MOVELA6MDIN    WA8STF  1                       B08268
     C****URRENCY DECIMAL PLACES                                          B08268
     C****                 Z-ADDA6NBDP    WDANBF  10                      B08268
     C****                 END                                            B08268
     C*                                                                   B08268
     C** ACCESS LF/SDCURRL0 WITH KEY OF EVENT CURRENCY                    B08268
     C                     Z-ADD1         B                               B08268
     C           WWCCY     LOKUPCYCD,B                   72               B08268
     C** ERROR                                                            B08268
     C           *IN72     IFEQ '0'                        ***************B08268
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD8         DBASE            **DB ERROR 02**B08268
     C                     MOVEL'SDCURRL0'DBFILE           ***************B08268
     C                     MOVELWWCCY     DBKEY                           B08268
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     B08268
     C                     ELSE                                           B08268
     C                     Z-ADDSPRT,B    A6SPRT                          B08268
     C                     MOVE MDIN,B    A6MDIN                          B08268
     C                     Z-ADDNBDP,B    A6NBDP                          B08268
     C                     Z-ADDA6SPRT    WC9NBF 138                      B08268
     C                     MOVELA6MDIN    WA8STF  1                       B08268
     C                     Z-ADDA6NBDP    WDANBF  10                      B08268
     C                     END                                            B08268
     C****                                                                B08268
     C****CCESS LF/SDCURRL0 WITH KEY OF CUSTOMER CURRENCY                 B08268
     C****       WWCSBY    CHAINSDCURRL0             72                   B08268
     C****       *IN72     IFEQ '1'                                       B08268
     C****RROR                                             ***************B08268
     C****                 Z-ADD9         DBASE            **DB ERROR 09**B08268
     C****                 MOVEL'SDCURR'  DBFILE           ***************B08268
     C****                 MOVEL*BLANKS   DBKEY                           B08268
     C****                 MOVELWWCSBY    DBKEY                           B08268
     C****                 EXSR *PSSR                                     B08268
     C****                 ELSE                                           B08268
     C****AVE SOME VALUES                                                 B08268
     C****POT RATE                                                        B08268
     C****                 Z-ADDA6SPRT    WC9NBC 138                      B08268
     C****ULTIPLY/DIVIDE INDICATOR                                        B08268
     C****                 MOVELA6MDIN    WA8STC  1                       B08268
     C****URRENCY DECIMAL PLACES                                          B08268
     C****                 Z-ADDA6NBDP    WDANBC  10                      B08268
     C*                                                                   B08268
     C** ACCESS LF/SDCURRL0 WITH KEY OF CUSTOMER CURRENCY                 B08268
     C                     Z-ADD1         B                               B08268
     C           WWCSBY    LOKUPCYCD,B                   72               B08268
     C** ERROR                                                            B08268
     C           *IN72     IFEQ '0'                        ***************B08268
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD9         DBASE            **DB ERROR 02**B08268
     C                     MOVEL'SDCURRL0'DBFILE           ***************B08268
     C                     MOVELWWCSBY    DBKEY                           B08268
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     B08268
     C                     ELSE                                           B08268
     C                     Z-ADDSPRT,B    A6SPRT                          B08268
     C                     MOVE MDIN,B    A6MDIN                          B08268
     C                     Z-ADDNBDP,B    A6NBDP                          B08268
     C                     Z-ADDA6SPRT    WC9NBC 138
     C                     MOVELA6MDIN    WA8STC  1
     C                     Z-ADDA6NBDP    WDANBC  10
     C*
     C           WWPTFR    IFNE '9997'
     C*
     C***ACCESS*PF/PMPORTPP*TO*GET*PORTFOLIO*DETAILS**********************S01486
     C***********KPORT     CHAINPMPORTPP             72                   S01486
     C** ACCESS PF/PMPORTPD TO GET PORTFOLIO DETAILS                      S01486
     C           KPORT     CHAINPMPORTPD             72                   S01486
     C           *IN72     IFEQ '1'
     C** ERROR                                             ***************
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD10        DBASE            **DB ERROR 10**
     C                     MOVEL'PMPORT'  DBFILE           ***************
     C                     MOVEL*BLANKS   DBKEY
     C                     MOVELWWCUS     DBKEY
     C                     MOVE WWPTFR    DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C****                                                                B08268
     C****F PORTFOLIO CURRENCY NOT EQUAL TO CUSTOMER CURRENCY             B08268
     C****       WWCSBY    IFNE PNPTCY                                    B08268
     C****                                                                B08268
     C****CCESS LF/SDCURRL0 WITH PORTFOLIO CURRENCY (PF/PMPORTPP)         B08268
     C****       PNPTCY    CHAINSDCURRL0             72                   B08268
     C****       *IN72     IFEQ '1'                                       B08268
     C****RROR                                             ***************B08268
     C****                 Z-ADD11        DBASE            **DB ERROR 11**B08268
     C****                 MOVEL'SDCURR'  DBFILE           ***************B08268
     C****                 MOVEL*BLANKS   DBKEY                           B08268
     C****                 MOVELPNPTCY    DBKEY                           B08268
     C****                 EXSR *PSSR                                     B08268
     C****                 ELSE                                           B08268
     C****                                                                B08268
     C****AVE SOME VALUES                                                 B08268
     C****ORTFOLIO CURRENCY                                               B08268
     C****                 MOVELPNPTCY    WWPTCY  3                       B08268
     C****ORTFOLIO CURRENCY DECIMAL PLACES                                B08268
     C****                 Z-ADDPNPCDP    WWPCDP  10                      B08268
     C****POT RATE                                                        B08268
     C****                 Z-ADDA6SPRT    WC9NBT 138                      B08268
     C****ULTIPLY/DIVIDE INDICATOR                                        B08268
     C****                 MOVELA6MDIN    WA8STT  1                       B08268
     C****URRENCY DECIMAL PLACES                                          B08268
     C****                 Z-ADDA6NBDP    WDANBT  10                      B08268
     C****                 END                                            B08268
     C*                                                                   B08268
     C***ACCESS*LF/SDCURRL0*WITH*PORTFOLIO*CURRENCY*(PF/PMPORTPP)***B08268S01486
     C** ACCESS LF/SDCURRL0 WITH PORTFOLIO CURRENCY (PF/PMPORTPD)         S01486
     C                     Z-ADD1         B                               B08268
     C           PNPTCY    LOKUPCYCD,B                   72               B08268
     C** ERROR                                                            B08268
     C           *IN72     IFEQ '0'                        ***************B08268
     C                     Z-ADD11        DBASE            **DB ERROR 02**B08268
     C                     MOVEL'SDCURRL0'DBFILE           ***************B08268
     C                     MOVELPNPTCY    DBKEY                           B08268
     C                     EXSR *PSSR                                     B08268
     C                     ELSE                                           B08268
     C                     Z-ADDSPRT,B    A6SPRT                          B08268
     C                     MOVE MDIN,B    A6MDIN                          B08268
     C                     Z-ADDNBDP,B    A6NBDP                          B08268
     C                     MOVELPNPTCY    WWPTCY  3                       B08268
     C                     Z-ADDPNPCDP    WWPCDP  10                      B08268
     C                     Z-ADDA6SPRT    WC9NBT 138                      B08268
     C                     MOVELA6MDIN    WA8STT  1                       B08268
     C                     Z-ADDA6NBDP    WDANBT  10                      B08268
     C                     END                                            B08268
     C                     END
     C                     END
     C                     END
     C*
     C** IF PORTFOLIO REFERENCE SET TO '9997' OR CUSTOMER CURRENCY
     C** EQUAL TO PORTFOLIO CURRENCY
     C           WWPTFR    IFEQ '9997'
     C           WWCSBY    OREQ PNPTCY
     C*
     C** SET PORTFOLIO CURRENCY DETAILS TO CUSTOMER DETAILS
     C** PORTFOLIO CURRENCY = CUSTOMER CURRENCY
     C                     MOVELWWCSBY    WWPTCY
     C** PORTFOLIO CURRENCY DECIMAL PLACES
     C                     Z-ADDWWBYDP    WWPCDP
     C** SPOT RATE
     C                     Z-ADDWC9NBC    WC9NBT
     C** MULTIPLY/DIVIDE INDICATOR
     C                     MOVELWA8STC    WA8STT
     C** CURRENCY DECIMAL PLACES
     C                     Z-ADDWDANBC    WDANBT
     C                     END
     C*
     C           EP04      ENDSR                           ** END P04   **
     C*
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W0101    - WRITE PORTFOLIO EVENTS CREDIT RECORDS                       *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * ZFRELN   - FORMAT SECOND LINE OF NARRATIVE FOR RETAIL                  *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P03      - PROCESS STANDING ORDER MULTIPLE RECORD                      *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWCUS    - CUSTOMER NUMBER                                             *
      * WWAVCD   - ACCOUNT OFFICER CODE                                        *
      * WWPTFR   - PORTFOLIO NUMBER                                            *
      * WWCSBY   - CUSTOMER BASE CURRENCY                                      *
      * WWBYDP   - CUSTOMER BASE CURRENCY DECIMAL PLACES                       *
      * WWPTCY   - PORTFOLIO CURRENCY                                          *
      * WWPCDP   - PORTFOLIO CURRENCY DECIMAL PLACES                           *
      * WWACD    - ACCOUNT CODE                                                *
      * WWCCY    - CURRENCY                                                    *
      * WWACS    - ACCOUNT SEQUENCE NUMBER                                     *
      * WWEVTD   - EVENT DATE                                                  *
      * WWETAM   - EVENT AMOUNT                                                *
      * WWAJCD   - BASE CURRENCY                                               *
      *                                                                        *
      **************************************************************************
     C           W0101     BEGSR
     C*
     C                     MOVEL'D'       Q9RECI
     C**********           Z-ADDWWCUS     Q9CNUM                                              CSD027
     C                     MOVE WWCUS     Q9CNUM                                              CSD027
     C                     MOVELWWACOC    Q9ACOC
     C                     MOVELWWPTFR    Q9PTFR
     C                     MOVELSTOR      Q9TTRF
     C                     MOVEL*BLANKS   Q9SEPR
     C                     MOVEL'RE'      Q9MODI
     C                     MOVELWWCSBY    Q9CSBY
     C                     Z-ADDWWBYDP    Q9BYDP
     C           WWPTFR    IFNE '9997'
     C                     MOVELWWPTCY    Q9PTCY
     C                     Z-ADDWWPCDP    Q9PCDP
     C                     ELSE
     C                     MOVELWWCSBY    Q9PTCY
     C                     Z-ADDWWBYDP    Q9PCDP
     C                     END
     C*
     C** ACCESS LF/SDACODL0 WITH KEY OF CREDIT ACCOUNT CODE (STANDSB)
     C** TO GET INSTRUMENT TYPE
     C***********          MOVE WWACD     WACD    4                       S01486
     C***********WACD      CHAINSDACODL0             72                   S01486
     C                     MOVE WWACD     KEYAC                           S01486
     C                     CALL 'AOACODR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C**********           PARM           KEYAC   4                                    S01486 CGL029
     C                     PARM           KEYAC  10                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01486 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C************IN72     IFEQ '1'                        ***************S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD12        DBASE            **DB ERROR 12**
     C                     MOVEL'SDACOD'  DBFILE           ***************
     C                     MOVEL*BLANKS   DBKEY
     C                     MOVELWWACD     DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA5INNR    Q9INNR
     C                     END
     C*
     C                     MOVELMSG,1     Q9T1XT
     C*
     C** EXECUTE STANDARD SR/ZFRELN WITH ZCNUM=CREDIT CUSTOMER (STANDSB
     C** ZCCY=CURRENCY (STANDSB), ZACOD=CREDIT ACCOUNT CODE (STANDSB)
     C** ZACSQ=CREDIT ACCOUNT SEQUENCE (STANDSB)
     C**********           Z-ADDWWCUS     ZCNUM                                               CSD027
     C                     MOVE WWCUS     ZCNUM                                               CSD027
      *                                                                   CPM004
      *  If Bank Portfolios supported then use BICN                       CPM004
      *                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVEL##CUS     ZCNUM                           CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C                     MOVELWWCCY     ZCCY
     C                     Z-ADDWWACD     ZACOD
     C                     Z-ADDWWACS     ZACSQ
     C                     MOVELWWBRC     ZBRCA   3                       085862
     C                     EXSR ZFRELN
     C                     MOVELZLIN      Q9T2XT
     C*
     C                     Z-ADDWWEVTD    Q9EVTD
     C                     MOVELMSG,2     Q9ENAR
     C                     MOVELWWCCY     Q9ECCY
     C                     Z-ADDWWETAM    Q9ETAM
     C                     MOVEL'R'       Q9AMTR
     C*
     C** CALCULATE EVENT AMOUNT PORTFOLIO CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=EVENT AMOUNT FROM ABOVE
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR STANDING ORDER CURRENCY
     C** USE ZRATET, ZMDINT AND ZCDPT FOR PORTFOLIO CURRENCY (CF SR/P04
     C                     Z-ADDWWETAM    ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWPTCY    ZCCYT
     C                     Z-ADDWC9NBT    ZRATET
     C                     MOVELWA8STT    ZMDINT
     C                     Z-ADDWDANBT    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9PTFA
     C*
     C** CALCULATE EVENT AMOUNT CUSTOMER CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=EVENT AMOUNT FROM ABOVE
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR STANDING ORDER CURRENCY
     C** USE ZRATET, ZMDINT AND ZCDPT FOR CUSTOMER CURRENCY (CF SR/P04)
     C                     Z-ADDWWETAM    ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCSBY    ZCCYT
     C                     Z-ADDWC9NBC    ZRATET
     C                     MOVELWA8STC    ZMDINT
     C                     Z-ADDWDANBC    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9CUCA
     C*
     C** CALCULATE EVENT AMOUNT BASE CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=EVENT AMOUNT FROM ABOVE
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR STANDING ORDER CURRENCY
     C** USE ZRATET, ZMDINT AND ZCDPT FOR BASE CURRENCY (CF SR/INIT)
     C                     Z-ADDWWETAM    ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCYCD    ZCCYT
     C                     Z-ADDWC9NBB    ZRATET
     C                     MOVELWA8STB    ZMDINT
     C                     Z-ADDWDANBB    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9BCYA
     C*
     C                     WRITEPMEVNTP0
      *                                                                   CPM005
      **  Write on PMEVCYPD                                               CPM005
      *                                                                   CPM005
     C                     Z-ADD1         WWDRCR  10                      CPM005
     C                     EXSR W0106                                     CPM005
     C*
     C           EW0101    ENDSR                           * END EW0101 **
     C*******************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W0102    - WRITE PORTFOLIO EVENTS DEBIT RECORDS                        *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * ZFRELN   - FORMAT SECOND LINE OF NARRATIVE FOR RETAIL                  *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P03      - PROCESS STANDING ORDER MULTIPLE RECORD                      *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWCUS    - CUSTOMER NUMBER                                             *
      * WWAVCD   - ACCOUNT OFFICER CODE                                        *
      * WWPTFR   - PORTFOLIO NUMBER                                            *
      * WWCSBY   - CUSTOMER BASE CURRENCY                                      *
      * WWBYDP   - CUSTOMER BASE CURRENCY DECIMAL PLACES                       *
      * WWPTCY   - PORTFOLIO CURRENCY                                          *
      * WWPCDP   - PORTFOLIO CURRENCY DECIMAL PLACES                           *
      * WWACD    - ACCOUNT CODE                                                *
      * WWCCY    - CURRENCY                                                    *
      * WWACS    - ACCOUNT SEQUENCE NUMBER                                     *
      * WWEVTD   - EVENT DATE                                                  *
      * WWETAM   - EVENT AMOUNT                                                *
      * WWAJCD   - BASE CURRENCY                                               *
      *                                                                        *
      **************************************************************************
     C           W0102     BEGSR
     C*
     C                     MOVEL'D'       Q9RECI
     C**********           Z-ADDWWCUS     Q9CNUM                                              CSD027
     C                     MOVE WWCUS     Q9CNUM                                              CSD027
     C                     MOVELWWACOC    Q9ACOC
     C                     MOVELWWPTFR    Q9PTFR
     C                     MOVELSTOR      Q9TTRF
     C                     MOVEL*BLANKS   Q9SEPR
     C                     MOVEL'RE'      Q9MODI
     C                     MOVELWWCSBY    Q9CSBY
     C                     Z-ADDWWBYDP    Q9BYDP
     C           WWPTFR    IFNE '9997'
     C                     MOVELWWPTCY    Q9PTCY
     C                     Z-ADDWWPCDP    Q9PCDP
     C                     ELSE
     C                     MOVELWWCSBY    Q9PTCY
     C                     Z-ADDWWBYDP    Q9PCDP
     C                     END
     C*
     C** ACCESS LF/SDACODL0 WITH KEY OF DEBIT ACCOUNT CODE (STANDSB)
     C** TO GET INSTRUMENT TYPE
     C***********          MOVE WWACD     WACD                            S01486
     C***********WACD      CHAINSDACODL0             72                   S01486
     C                     MOVE WWACD     KEYAC                           S01486
     C                     CALL 'AOACODR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYAC                           S01486
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01486 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C************IN72     IFEQ '1'                        ***************S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD13        DBASE            **DB ERROR 13**
     C                     MOVEL'SDACOD'  DBFILE           ***************
     C                     MOVEL*BLANKS   DBKEY
     C                     MOVELWWACD     DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA5INNR    Q9INNR
     C                     END
     C*
     C                     MOVELMSG,1     Q9T1XT
     C*
     C** EXECUTE STANDARD SR/ZFRELN WITH ZCNUM=DEBIT CUSTOMER (STANDSB
     C** ZCCY=CURRENCY (STANDSB), ZACOD=DEBIT ACCOUNT CODE (STANDSB)
     C** ZACSQ=DEBIT ACCOUNT SEQUENCE (STANDSB)
     C**********           Z-ADDWWCUS     ZCNUM                                               CSD027
     C                     MOVE WWCUS     ZCNUM                                               CSD027
      *                                                                   CPM004
      *  If Bank Portfolios supported then use BICN                       CPM004
      *                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVEL##CUS     ZCNUM                           CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C                     MOVELWWCCY     ZCCY
     C                     Z-ADDWWACD     ZACOD
     C                     Z-ADDWWACS     ZACSQ
     C                     MOVELWWBRC     ZBRCA                           085862
     C                     EXSR ZFRELN
     C                     MOVELZLIN      Q9T2XT
     C*
     C                     Z-ADDWWEVTD    Q9EVTD
     C                     MOVELMSG,3     Q9ENAR
     C                     MOVELWWCCY     Q9ECCY
     C                     Z-ADDWWETAM    Q9ETAM
     C                     MOVEL'P'       Q9AMTR
     C*
     C** CALCULATE EVENT AMOUNT PORTFOLIO CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=EVENT AMOUNT FROM ABOVE
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR STANDING ORDER CURRENCY
     C** USE ZRATET, ZMDINT AND ZCDPT FOR PORTFOLIO CURRENCY (CF SR/P04
     C                     Z-ADDWWETAM    ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWPTCY    ZCCYT
     C                     Z-ADDWC9NBT    ZRATET
     C                     MOVELWA8STT    ZMDINT
     C                     Z-ADDWDANBT    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9PTFA
     C*
     C** CALCULATE EVENT AMOUNT CUSTOMER CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=EVENT AMOUNT FROM ABOVE
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR STANDING ORDER CURRENCY
     C** USE ZRATET, ZMDINT AND ZCDPT FOR CUSTOMER CURRENCY (CF SR/P04)
     C                     Z-ADDWWETAM    ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCSBY    ZCCYT
     C                     Z-ADDWC9NBC    ZRATET
     C                     MOVELWA8STC    ZMDINT
     C                     Z-ADDWDANBC    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9CUCA
     C*
     C** CALCULATE EVENT AMOUNT BASE CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=EVENT AMOUNT FROM ABOVE
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR STANDING ORDER CURRENCY
     C** USE ZRATET, ZMDINT AND ZCDPT FOR BASE CURRENCY (CF SR/INIT)
     C                     Z-ADDWWETAM    ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCYCD    ZCCYT
     C                     Z-ADDWC9NBB    ZRATET
     C                     MOVELWA8STB    ZMDINT
     C                     Z-ADDWDANBB    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9BCYA
     C*
     C                     WRITEPMEVNTP0
      *                                                                   CPM005
      **  Write on PMEVCYPD                                               CPM005
      *                                                                   CPM005
     C                     Z-ADD*ZEROS    WWDRCR                          CPM005
     C                     EXSR W0106                                     CPM005
     C*
     C           EW0102    ENDSR                           * END EW0102 **
      *******************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W0103    - WRITE PORTFOLIO EVENTS DEBIT RECORDS                        *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * ZFRELN   - FORMAT SECOND LINE OF NARRATIVE FOR RETAIL                  *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P02      - PROCESS CUSTOMER EXCHANGES                                  *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWCUS    - CUSTOMER NUMBER                                             *
      * WWAVCD   - ACCOUNT OFFICER CODE                                        *
      * WWPTFR   - PORTFOLIO NUMBER                                            *
      * WWCSBY   - CUSTOMER BASE CURRENCY                                      *
      * WWBYDP   - CUSTOMER BASE CURRENCY DECIMAL PLACES                       *
      * WWPTCY   - PORTFOLIO CURRENCY                                          *
      * WWPCDP   - PORTFOLIO CURRENCY DECIMAL PLACES                           *
      * WWACD    - ACCOUNT CODE                                                *
      * WWCCY    - CURRENCY                                                    *
      * WWACS    - ACCOUNT SEQUENCE NUMBER                                     *
      * WWAJCD   - BASE CURRENCY                                               *
      *                                                                        *
      **************************************************************************
     C           W0103     BEGSR
     C*
     C                     MOVEL'D'       Q9RECI
     C**********           Z-ADDWWCUS     Q9CNUM                                              CSD027
     C                     MOVE WWCUS     Q9CNUM                                              CSD027
     C                     MOVELWWACOC    Q9ACOC
     C                     MOVELWWPTFR    Q9PTFR
     C                     MOVELIPDN      Q9TTRF
     C                     MOVEL*BLANKS   Q9SEPR
     C                     MOVEL'RE'      Q9MODI
     C                     MOVELWWCSBY    Q9CSBY
     C                     Z-ADDWWBYDP    Q9BYDP
     C           WWPTFR    IFNE '9997'
     C                     MOVELWWPTCY    Q9PTCY
     C                     Z-ADDWWPCDP    Q9PCDP
     C                     ELSE
     C                     MOVELWWCSBY    Q9PTCY
     C                     Z-ADDWWBYDP    Q9PCDP
     C                     END
     C*
     C** ACCESS LF/SDACODL0 WITH KEY OF DEBIT ACCOUNT CODE (CUSEXCE)
     C** TO GET INSTRUMENT TYPE
     C***********          MOVE WWACD     WACD                            S01486
     C***********WACD      CHAINSDACODL0             72                   S01486
     C                     MOVE WWACD     KEYAC                           S01486
     C                     CALL 'AOACODR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYAC                           S01486
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01486 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C************IN72     IFEQ '1'                        ***************S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD14        DBASE            **DB ERROR 14**
     C                     MOVEL'SDACOD'  DBFILE           ***************
     C                     MOVEL*BLANKS   DBKEY
     C                     MOVELWWACD     DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA5INNR    Q9INNR
     C                     END
     C*
     C                     MOVELMSG,4     Q9T1XT
     C*
     C** EXECUTE STANDARD SR/ZFRELN WITH ZCNUM=DEBIT CUSTOMER (CUSEXCE)
     C** ZCCY=DEBIT CURRENCY (CUSEXCE)
     C** ZACOD=DEBIT ACCOUNT CODE (CUSEXCE)
     C** ZACSQ=DEBIT ACCOUNT SEQUENCE (CUSEXCE)
     C**********           Z-ADDWWCUS     ZCNUM                                               CSD027
     C                     MOVE WWCUS     ZCNUM                                               CSD027
      *                                                                   CPM004
      *  If Bank Portfolios supported then use BICN                       CPM004
      *                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVEL##CUS     ZCNUM                           CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C                     MOVELWWCCY     ZCCY
     C                     Z-ADDWWACD     ZACOD
     C                     Z-ADDWWACS     ZACSQ
     C                     MOVELWWBRC     ZBRCA                           085862
     C                     EXSR ZFRELN
     C                     MOVELZLIN      Q9T2XT
     C*
     C                     Z-ADDDRVD      Q9EVTD
     C                     MOVELMSG,5     Q9ENAR
     C                     MOVELWWCCY     Q9ECCY
     C                     Z-ADDDRAM      Q9ETAM
     C                     MOVEL'P'       Q9AMTR
     C*
     C** CALCULATE EVENT AMOUNT PORTFOLIO CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=DEBIT AMOUNT (CUSEXCE)
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR PF/CUSEXCE
     C** USE ZRATET, ZMDINT AND ZCDPT FOR PORTFOLIO CURRENCY (CF SR/P04
     C                     Z-ADDDRAM      ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWPTCY    ZCCYT
     C                     Z-ADDWC9NBT    ZRATET
     C                     MOVELWA8STT    ZMDINT
     C                     Z-ADDWDANBT    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9PTFA
     C*
     C** CALCULATE EVENT AMOUNT CUSTOMER CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=DEBIT AMOUNT FROM CUSEXCE
     C** USE ZRATEF, ZMDINF AND ZCDPF FROM CUSEXCE
     C** USE ZRATET, ZMDINT AND ZCDPT FOR CUSTOMER CURRENCY (CF SR/P04)
     C                     Z-ADDDRAM      ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCSBY    ZCCYT
     C                     Z-ADDWC9NBC    ZRATET
     C                     MOVELWA8STC    ZMDINT
     C                     Z-ADDWDANBC    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9CUCA
     C*
     C** CALCULATE EVENT AMOUNT BASE CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=DEBIT AMOUNT FROM PF/CUSEXCE
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR CUSEXCE
     C** USE ZRATET, ZMDINT AND ZCDPT FOR BASE CURRENCY (CF SR/INIT)
     C                     Z-ADDDRAM      ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCYCD    ZCCYT
     C                     Z-ADDWC9NBB    ZRATET
     C                     MOVELWA8STB    ZMDINT
     C                     Z-ADDWDANBB    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9BCYA
     C*
     C                     WRITEPMEVNTP0
     C*
     C           EW0103    ENDSR                           * END EW0103 **
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W0104    - WRITE PORTFOLIO EVENTS CREDIT RECORDS                       *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * ZFRELN   - FORMAT SECOND LINE OF NARRATIVE FOR RETAIL                  *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P02      - PROCESS CUSTOMER EXCHANGES                                  *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWCUS    - CUSTOMER NUMBER                                             *
      * WWAVCD   - ACCOUNT OFFICER CODE                                        *
      * WWPTFR   - PORTFOLIO NUMBER                                            *
      * WWCSBY   - CUSTOMER BASE CURRENCY                                      *
      * WWBYDP   - CUSTOMER BASE CURRENCY DECIMAL PLACES                       *
      * WWPTCY   - PORTFOLIO CURRENCY                                          *
      * WWPCDP   - PORTFOLIO CURRENCY DECIMAL PLACES                           *
      * WWACD    - ACCOUNT CODE                                                *
      * WWCCY    - CURRENCY                                                    *
      * WWACS    - ACCOUNT SEQUENCE NUMBER                                     *
      * WWAJCD   - BASE CURRENCY                                               *
      *                                                                        *
      **************************************************************************
     C           W0104     BEGSR
     C*
     C                     MOVEL'D'       Q9RECI
     C**********           Z-ADDWWCUS     Q9CNUM                                              CSD027
     C                     MOVE WWCUS     Q9CNUM                                              CSD027
     C                     MOVELWWACOC    Q9ACOC
     C                     MOVELWWPTFR    Q9PTFR
     C                     MOVELIPDN      Q9TTRF
     C                     MOVEL*BLANKS   Q9SEPR
     C                     MOVEL'RE'      Q9MODI
     C                     MOVELWWCSBY    Q9CSBY
     C                     Z-ADDWWBYDP    Q9BYDP
     C           WWPTFR    IFNE '9997'
     C                     MOVELWWPTCY    Q9PTCY
     C                     Z-ADDWWPCDP    Q9PCDP
     C                     ELSE
     C                     MOVELWWCSBY    Q9PTCY
     C                     Z-ADDWWBYDP    Q9PCDP
     C                     END
     C*
     C** ACCESS LF/SDACODL0 WITH KEY OF CREDIT ACCOUNT CODE (CUSEXCE)
     C** TO GET INSTRUMENT TYPE
     C***********          MOVE WWACD     WACD                            S01486
     C***********WACD      CHAINSDACODL0             72                   S01486
     C                     MOVE WWACD     KEYAC                           S01486
     C                     CALL 'AOACODR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYAC                           S01486
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01486 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C************IN72     IFEQ '1'                        ***************S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD15        DBASE            **DB ERROR 15**
     C                     MOVEL'SDACOD'  DBFILE
     C                     MOVEL*BLANKS   DBKEY
     C                     MOVELWWACD     DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA5INNR    Q9INNR
     C                     END
     C*
     C                     MOVELMSG,4     Q9T1XT
     C*
     C** EXECUTE STANDARD SR/ZFRELN WITH ZCNUM=CREDIT CUSTOMER(CUSEXCE)
     C** ZCCY=CREDIT CURRENCY (CUSEXCE)
     C** ZACOD=CREDIT ACCOUNT CODE (CUSEXCE)
     C** ZACSQ=CREDIT ACCOUNT SEQUENCE (CUSEXCE)
     C**********           Z-ADDWWCUS     ZCNUM                                               CSD027
     C                     MOVE WWCUS     ZCNUM                                               CSD027
      *                                                                   CPM004
      *  If Bank Portfolios supported then use BICN                       CPM004
      *                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVEL##CUS     ZCNUM                           CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C                     MOVELWWCCY     ZCCY
     C                     Z-ADDWWACD     ZACOD
     C                     Z-ADDWWACS     ZACSQ
     C                     MOVELWWBRC     ZBRCA                           085862
     C                     EXSR ZFRELN
     C                     MOVELZLIN      Q9T2XT
     C*
     C                     Z-ADDCRVD      Q9EVTD
     C                     MOVELMSG,6     Q9ENAR
     C                     MOVELWWCCY     Q9ECCY
     C                     Z-ADDCRAM      Q9ETAM
     C                     MOVEL'R'       Q9AMTR
     C*
     C** CALCULATE EVENT AMOUNT PORTFOLIO CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=CREDIT AMOUNT (CUSEXCE)
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR PF/CUSEXCE
     C** USE ZRATET, ZMDINT AND ZCDPT FOR PORTFOLIO CURRENCY (CF SR/P04
     C                     Z-ADDCRAM      ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWPTCY    ZCCYT
     C                     Z-ADDWC9NBT    ZRATET
     C                     MOVELWA8STT    ZMDINT
     C                     Z-ADDWDANBT    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9PTFA
     C*
     C** CALCULATE EVENT AMOUNT CUSTOMER CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=CREDIT AMOUNT FROM CUSEXCE
     C** USE ZRATEF, ZMDINF AND ZCDPF FROM CUSEXCE
     C** USE ZRATET, ZMDINT AND ZCDPT FOR CUSTOMER CURRENCY (CF SR/P04)
     C                     Z-ADDCRAM      ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCSBY    ZCCYT
     C                     Z-ADDWC9NBC    ZRATET
     C                     MOVELWA8STC    ZMDINT
     C                     Z-ADDWDANBC    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9CUCA
     C*
     C** CALCULATE EVENT AMOUNT BASE CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=CREDIT AMOUNT FROM PF/CUSEXCE
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR CUSEXCE
     C** USE ZRATET, ZMDINT AND ZCDPT FOR BASE CURRENCY (CF SR/INIT)
     C                     Z-ADDCRAM      ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCYCD    ZCCYT
     C                     Z-ADDWC9NBB    ZRATET
     C                     MOVELWA8STB    ZMDINT
     C                     Z-ADDWDANBB    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9BCYA
     C*
     C                     WRITEPMEVNTP0
     C*
     C           EW0104    ENDSR                           * END EW0104 **
      **************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W0105    - WRITE PORTFOLIO EVENTS CHARGES RECORDS                      *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      * *PSSR    - ERROR SUBROUTINE                                            *
      * ZFRELN   - FORMAT SECOND LINE OF NARRATIVE FOR RETAIL                  *
      * ZCCYCN   - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER              *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * P02      - PROCESS CUSTOMER EXCHANGES                                  *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      * WWCUS    - CUSTOMER NUMBER                                             *
      * WWAVCD   - ACCOUNT OFFICER CODE                                        *
      * WWPTFR   - PORTFOLIO NUMBER                                            *
      * WWCSBY   - CUSTOMER BASE CURRENCY                                      *
      * WWBYDP   - CUSTOMER BASE CURRENCY DECIMAL PLACES                       *
      * WWPTCY   - PORTFOLIO CURRENCY                                          *
      * WWPCDP   - PORTFOLIO CURRENCY DECIMAL PLACES                           *
      * WWACD    - ACCOUNT CODE                                                *
      * WWCCY    - CURRENCY                                                    *
      * WWACS    - ACCOUNT SEQUENCE NUMBER                                     *
      * WWDAT    - CHARGES VALUE DATE                                          *
      * WWHSGN   - CHARGE SIGN                                                 *
      * WWAJCD   - BASE CURRENCY                                               *
      *                                                                        *
      **************************************************************************
     C           W0105     BEGSR
     C*
     C                     MOVEL'D'       Q9RECI
     C**********           Z-ADDWWCUS     Q9CNUM                                              CSD027
     C                     MOVE WWCUS     Q9CNUM                                              CSD027
     C                     MOVELWWACOC    Q9ACOC
     C                     MOVELWWPTFR    Q9PTFR
     C                     MOVELIPDN      Q9TTRF
     C                     MOVEL*BLANKS   Q9SEPR
     C                     MOVEL'RE'      Q9MODI
     C                     MOVELWWCSBY    Q9CSBY
     C                     Z-ADDWWBYDP    Q9BYDP
     C           WWPTFR    IFNE '9997'
     C                     MOVELWWPTCY    Q9PTCY
     C                     Z-ADDWWPCDP    Q9PCDP
     C                     ELSE
     C                     MOVELWWCSBY    Q9PTCY
     C                     Z-ADDWWBYDP    Q9PCDP
     C                     END
     C*
     C** ACCESS LF/SDACODL0 WITH KEY OF CHARGE ACCOUNT CODE (CUSEXCE)
     C** TO GET INSTRUMENT TYPE
     C***********          MOVE WWACD     WACD                            S01486
     C***********WACD      CHAINSDACODL0             72                   S01486
     C                     MOVE WWACD     KEYAC                           S01486
     C                     CALL 'AOACODR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYAC                           S01486
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01486 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C************IN72     IFEQ '1'                        ***************S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD16        DBASE            **DB ERROR 16**
     C                     MOVEL'SDACOD'  DBFILE           ***************
     C                     MOVEL*BLANKS   DBKEY
     C                     MOVELWWACD     DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA5INNR    Q9INNR
     C                     END
     C*
     C                     MOVELMSG,4     Q9T1XT
     C*
     C** EXECUTE STANDARD SR/ZFRELN WITH ZCNUM=CHARGE CUSTOMER(CUSEXCE)
     C** ZCCY=CHARGE CURRENCY (CUSEXCE)
     C** ZACOD=CHARGE ACCOUNT CODE (CUSEXCE)
     C** ZACSQ=CHARGE ACCOUNT SEQUENCE (CUSEXCE)
     C**********           Z-ADDWWCUS     ZCNUM                                               CSD027
     C                     MOVE WWCUS     ZCNUM                                               CSD027
      *                                                                   CPM004
      *  If Bank Portfolios supported then use BICN                       CPM004
      *                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVEL##CUS     ZCNUM                           CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
     C                     MOVELWWCCY     ZCCY
     C                     Z-ADDWWACD     ZACOD
     C                     Z-ADDWWACS     ZACSQ
     C                     MOVELWWBRC     ZBRCA                           085862
     C                     EXSR ZFRELN
     C                     MOVELZLIN      Q9T2XT
     C*
     C                     Z-ADDWWDAT     Q9EVTD
     C*
     C           WWHSGN    IFEQ '-'
     C                     MOVELMSG,7     Q9ENAR
     C                     END
     C           WWHSGN    IFEQ '+'
     C                     MOVELMSG,8     Q9ENAR
     C                     END
     C*
     C                     MOVELWWCCY     Q9ECCY
     C                     Z-ADDHAMT      Q9ETAM
     C*
     C           WWHSGN    IFEQ '-'
     C                     MOVEL'R'       Q9AMTR
     C                     END
     C           WWHSGN    IFEQ '+'
     C                     MOVEL'P'       Q9AMTR
     C                     END
     C*
     C** CALCULATE EVENT AMOUNT PORTFOLIO CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=CHARGE AMOUNT (CUSEXCE)
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR PF/CUSEXCE
     C** USE ZRATET, ZMDINT AND ZCDPT FOR PORTFOLIO CURRENCY (CF SR/P04
     C                     Z-ADDHAMT      ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWPTCY    ZCCYT
     C                     Z-ADDWC9NBT    ZRATET
     C                     MOVELWA8STT    ZMDINT
     C                     Z-ADDWDANBT    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9PTFA
     C*
     C** CALCULATE EVENT AMOUNT CUSTOMER CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=CHARGE AMOUNT FROM CUSEXCE
     C** USE ZRATEF, ZMDINF AND ZCDPF FROM CUSEXCE
     C** USE ZRATET, ZMDINT AND ZCDPT FOR CUSTOMER CURRENCY (CF SR/P04)
     C                     Z-ADDHAMT      ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCSBY    ZCCYT
     C                     Z-ADDWC9NBC    ZRATET
     C                     MOVELWA8STC    ZMDINT
     C                     Z-ADDWDANBC    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9CUCA
     C*
     C** CALCULATE EVENT AMOUNT BASE CURRENCY VIA SR/ZCCYCN
     C** WITH PARAMETERS ZAMTF=CHARGE AMOUNT FROM PF/CUSEXCE
     C** USE ZRATEF, ZMDINF AND ZCDPF FOR CUSEXCE
     C** USE ZRATET, ZMDINT AND ZCDPT FOR BASE CURRENCY (CF SR/INIT)
     C                     Z-ADDHAMT      ZAMTF
     C                     MOVELWWCCY     ZCCYF
     C                     Z-ADDWC9NBF    ZRATEF
     C                     MOVELWA8STF    ZMDINF
     C                     Z-ADDWDANBF    ZCDPF
     C                     MOVELWWCYCD    ZCCYT
     C                     Z-ADDWC9NBB    ZRATET
     C                     MOVELWA8STB    ZMDINT
     C                     Z-ADDWDANBB    ZCDPT
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     Q9BCYA
     C*
     C                     WRITEPMEVNTP0
     C*
     C           EW0105    ENDSR                           * END EW0105 **
      *****************************************************************   CPM005
      /EJECT                                                              CPM005
      *****************************************************************   CPM005
      *                                                               *   CPM005
      *  W0106    - Write Portfolio Events on PMEVCYPD                *   CPM005
      *                                                               *   CPM005
      *  Subroutine Calls:                                            *   CPM005
      *                                                               *   CPM005
      *  Subroutine Called From:                                      *   CPM005
      *  W0101    - Write Portfolio Events Credit Records             *   CPM005
      *  W0102    - Write Portfolio Events Debit Records              *   CPM005
      *                                                               *   CPM005
      *  Routine Uses Variables:                                      *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
     C           W0106     BEGSR                                          CPM005
      *                                                                   CPM005
     C                     MOVEL'D'       FGRECI           Record Id      CPM005
     C**********           Z-ADDWWCUS     FGCNUM           Cust Nbr                    CPM005 CSD027
     C                     MOVE WWCUS     FGCNUM           Cust Nbr                           CSD027
     C                     MOVELWWPTFR    FGPTFR           Portfolio Ref  CPM005
     C                     Z-ADDWWEVTD    FGEVDT           Event Date     CPM005
     C                     MOVEL*BLANKS   FGEVFX           Event Type FX  CPM005
     C                     Z-ADD*ZEROS    FGDGRS           Group Seq      CPM005
     C                     MOVEL*BLANKS   FGINSC           Instrument CodeCPM005
     C                     Z-ADD*ZEROS    FGINDS           Instrument Seq CPM005
     C                     MOVEL'CC'      FGEVTY           Event Type     CPM005
     C                     MOVELWWCCY     FGCURR           Currency       CPM005
      *                                                                   CPM005
      **  If Credit                                                       CPM005
      *                                                                   CPM005
     C           WWDRCR    IFEQ 1                          *B1            CPM005
     C                     Z-ADDQ9PTFA    FGMNT1           Amount Port CcyCPM005
     C                     Z-ADDQ9CUCA    FGMNT2           Amount Cust CcyCPM005
     C                     ELSE                            *X1            CPM005
     C                     Z-SUBQ9PTFA    FGMNT1           Amount Port CcyCPM005
     C                     Z-SUBQ9CUCA    FGMNT2           Amount Cust CcyCPM005
     C                     ENDIF                           *E1            CPM005
      *                                                                   CPM005
     C                     WRITEPMEVCYD0                                  CPM005
      *                                                                   CPM005
     C                     ADD  1         RRNORE           Nbr of records CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
     C**************************************************************************
      /EJECT
      **************************************************************************
      *                                                                        *
      * W02      - WRITE RUN CONTROL REPORT                                    *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * MAIN     - MAIN PROCESSING                                             *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           W02       BEGSR                           *** W02   ****
     C                     WRITEPM1440W
     C                     WRITEPM1440T                                   S01486
     C           EW02      ENDSR                           * END EW02   **
     C*
     C*******************************************************************
      /EJECT
     C********************************************************************
     C*
     C*    ZFRELN SR. TO FORMAT THE 20A PORTFOLIO MANAGMENT LINE DESCRIPTION
     C*                                 FOR RETAIL
     C*
     C*  FORMAT: 999999 XXX 9999 99
     C*
     C*          999999 CUSTOMER NUMBER
     C*          XXX = CURRENCY
     C*          9999 = ACCOUNT CODE
     C*          99 = ACCOUNT SEQUENCE
     C*
     C*  INPUT  FIELDS
     C*       ZCNUM   60     CUSTOMER NUMBER
     C*       ZCCY    3A     CURRENCY
     C*       ZACOD   40     ACCOUNT CODE
     C*       ZACSQ   20     ACCOUNT SEQUENCE
     C*
     C*  OUTPUT  FIELDS
     C*       ZLIN   20A     LINE DESCRIPTION
     C*
     C*  ARRAY USED
     C*      ZLI    20 ELEMENTS, EACH 1 CHARACTER LONG
     C*
     C********************************************************************
     C           ZFRELN    BEGSR                           *** ZFRELN ***
     C*
     C** CLEAR LINE DESCRIPTION .
     C                     MOVEA*BLANKS   ZLI
     C*
     C** MOVE CUSTOMER NUMBER TO LINE DESCRIPTION
     C                     MOVE ZCNUM     ZWRKA6  6
     C                     MOVEAZWRKA6    ZLI,01
     C*
     C** MOVE CURRENCY TO LINE DESCRIPTION
     C***********          MOVEAZCCY      ZLI,08                          085862
     C                     MOVEAZCCY      ZLI,07                          085862
     C*
     C** MOVE ACCUONT CODE TO LINE DESCRIPTION
     C**********           MOVE ZACOD     ZWRKA4  4                                           CGL029
     C                     MOVE ZACOD     ZWRKA4 10                                           CGL029
     C***********          MOVEAZWRKA4    ZLI,12                          085862
     C                     MOVEAZWRKA4    ZLI,10                          085862
     C*
     C** MOVE ACCUONT SEQUENCE TO LINE DESCRIPTION
     C                     MOVE ZACSQ     ZWRKA2  2
     C***********          MOVEAZWRKA2    ZLI,17                          085862
     C**********           MOVEAZWRKA2    ZLI,14                                       085862 CGL029
     C**********           MOVEAZBRCA     ZLI,16                                       085862 CGL029
     C                     MOVEAZWRKA2    ZLI,20                                              CGL029
     C                     MOVEAZBRCA     ZLI,22                                              CGL029
     C**
     C**  SET ALL   FIELDS TO BLANKS OR ZEROS
     C**********           Z-ADD*ZEROS    ZCNUM   60                                          CSD027
     C                     MOVE *BLANKS   ZCNUM   6                                           CSD027
     C                     MOVE *BLANKS   ZCCY    3
     C**********           Z-ADD*ZEROS    ZACOD   40                                          CGL029
     C                     Z-ADD*ZEROS    ZACOD  100                                          CGL029
     C                     Z-ADD*ZEROS    ZACSQ   20
     C                     MOVE *BLANKS   ZBRCA                           085862
     C**
     C**********           MOVEAZLI       ZLIN   20                                           CGL029
     C                     MOVEAZLI       ZLIN   26                                           CGL029
     C**
     C                     ENDSR
     C**************************************************************************
      /EJECT
      /COPY ZSRSRC,ZDATE1Z2
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZFRQAZ2
      /EJECT
      /COPY ZSRSRC,ZCCYCN
      ****/EJECT                                                          47719
      ****/COPY ZSRSRC,ZCCYXR                                             47719
      /EJECT                                                              S01486
      /COPY ZSRSRC,ZACCH                                                  S01486
      /COPY ZSRSRC,ZCCYXR                                                 S01486
      /COPY ZSRSRC,ZCHKH                                                  S01486
      /EJECT
      **************************************************************************
      *                                                                        *
      * *PSSR    - ERROR SUBROUTINE                                            *
      *                                                                        *
      * SUBROUTINE CALLS:                                                      *
      *                                                                        *
      * SUBROUTINE CALLED FROM:                                                *
      * INIT     - INITIALISATION OF STANDARD FIELDS - ACCESS STAN.DT          *
      * P01      - PROCESS STANDING ORDERS                                     *
      * P02      - PROCESS CUSTOMER EXCHANGES                                  *
      * P04      - OBTAIN EXCHANGE RATES                                       *
      * W0101    - WRITE PORTFOLIO EVENTS CREDIT RECORDS                       *
      * W0102    - WRITE PORTFOLIO EVENTS DEBIT RECORDS                        *
      * W0103    - WRITE PORTFOLIO EVENTS DEBIT RECORDS                        *
      * W0104    - WRITE PORTFOLIO EVENTS CREDIT RECORDS                       *
      * W0105    - WRITE PORTFOLIO EVENTS CHARGES RECORDS                      *
      *                                                                        *
      * ROUTINE USES VARIABLES:                                                *
      *                                                                        *
      **************************************************************************
     C           *PSSR     BEGSR
     C*
     C                     WRITEPM1440W                                   S01486
     C                     WRITEPM1440E                                   S01486
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT                                                              CPM004
      ********************************************************************CPM004
      *                                                                   CPM004
      * BRANCH   - RETRIEVE BRANCH'S CUSTOMER DETAILS                     CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLS:                                                 CPM004
      * *PSSR    - DB ERROR SUB-ROUTINE                                   CPM004
      * AOPLCSR1 - PORTFOLIO MANAGEMENT CUSTOMER DETAILS                  CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLED FROM:                                           CPM004
      * P01      - PROCESS EVENTS RECORDS                                 CPM004
      *                                                                   CPM004
      * ROUTINE USES VARIABLES:                                           CPM004
      *                                                                   CPM004
      ********************************************************************CPM004
     CSR         BRANCH    BEGSR                                          CPM004
     C**                                                                  CPM004
     C                     MOVE 'B'       I#PORS                          CPM004
     C                     MOVE FCR997    I#R997                          CPM004
     C                     MOVE ##BRCA    I#BRCA                          CPM004
     C**                                                                  CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CPM004
     C                     PARM '*KEY   ' P@OPTN  7        I:Option       CPM004
     C                     PARM           I@PARM           I:Parameters   CPM004
     C                     PARM *BLANKS   O@PARM           O:Parameters   CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY            O:Format       CPM004
      *                                                                   CPM004
     CSR                   ENDSR                                          CPM004
     C*
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** MSG
STANDING ORDER
STANDING ORDER CR
STANDING ORDER DR
CUSTOMER EXCHANGE
CUST EXCHANGE DEBIT
CUST EXCHANGE CREDIT
CUST EXCHANGE CHG CR
CUST EXCHANGE CHG DR
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
