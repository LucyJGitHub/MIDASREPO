     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Performance cash analysis update')            *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                                 *
     F*                                                               *
     F*  PM1500 - Performance Cash Analysis Update                    *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. CER050             Date 16Jun19               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 CGL154             Date 13Oct14               *
      *                 CLE141             Date 08Feb16               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 11Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CDL038             Date 10May05               *
      *                 237063             Date 20Nov05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CRE008             Date 19Feb02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
     F*                 156721             Date 09Mar99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 02Mar99               *
      *                 CTI002             Date 07Feb99               *
      *                 102506             Date 18Oct98               *
     F*                 134306             Date 29Apr98               *
     F*                 129927             Date 03Feb98               *
     F*                 109440             DATE 18OCT96               *
     F*                 101216             DATE 26MAR96               *
     F*                 090503             DATE 15JUL96               *
     F*                 CPM005             DATE 15JUL96               *
     F*                 CFF004             DATE 12SEP96               *
     F*                 CPM003             DATE 02MAY96               *
     F*                 078956             DATE 20DEC95               *
     F*                 075998             DATE 20DEC95               *
     F*                 099814             DATE 15FEB96               *
     F*                 CPM004             DATE 04MAR96               *
     F*                 094693             DATE 18OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 093914             DATE 29SEP95               *
     F*                 085862             DATE 15MAR95               *
     F*                 085810             DATE 10MAR95               *
     F*                 081378             DATE 14DEC94               *
     F*                 53103  MD          DATE 30NOV94               *
     F*                 S01486             DATE 11AUG94               *
     F*                 057784             DATE 14/07/93              *
     F*                 059474             DATE 11/08/93              *
     F*                 056460             DATE 02/06/93              *
     F*                 050406             DATE 01/02/93              *
     F*                 050138             DATE 27/01/93              *
     F*                 049584             DATE 14/01/93              *
     F*                 047719             DATE 19JAN93               *
     F*                 046386             DATE 28/10/92              *
     F*                 046910             DATE 11/11/92              *
     F*                 046580             DATE 03/11/92              *
     F*                 046922             DATE  10/11/92             *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL154 - FATCA Reporting (Recompile)                         *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CRE008 - Cash Management. Recompiled.                        *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
      *  CDL006 - Dealing Fiduciary (Recompile)                       *
     F*  156721 - Avoid undefined record type for file DEALSH with NS *
     F*           sequence.                                           *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  102506 - Recompiled over ZSRSRC/ZDAYSZ2 changes.             *
     F*  134306 - Undefined record type is found in DEALS file        *
     F*         - Do not process FRA/IRS, NA purchased/sold deals.    *
     F*  129927 - Recompiled over renamed formats in PMACPOL0.        *
     F*  109440 - Recompiled over changed PMACPOL0                    *
     F*  101216 - Amend fix 90503, if the forex settlement retail     *
     F*           account is closed at forex value date, the event    *
     F*           must be written in PMPCAAPD                         *
     F*  090503 - Ignore closing accounts.                            *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/2 - CALCULATE & REPORT PERF. FOR ALL CUST.PORT *
     F*  CFF004 - Increase in size of Price Fields                    *
     F*  CPM003 - FF/PM Interface upgrade to Release 10               *
     F*  078956 - Change in /COPY ZFFOLN3                             *
     F*  075998 - Portfolio/Future & Options performance              *
     F*  099814 - Pool Trades should use CQQ001 feature               *
     F*  CPM004 - Bank Portfolios                                     *
     F*  094693 - ACCNT's key is now split due to branch so use       *
     F*           external file description                           *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  093914 - Generated entries for facility fees should not be   *
     F*           processed - set on a flag to exclude these.         *
     F*  085862 - INCLUDE BRANCH IN ACCOUNT CODE                      *
     F*  085810 - ACCESS LF/DEALSH FOR DETAILS OF MATURED DEALS       *
     F*  081378 - Deal Type/Sub Type changes.                         *
     F*  53103  - PORTFOLIO PERFORMANCE RECONCILIATION                *
     F*  S01486 - Portfolio Management Upgrade to Release 10          *
     F*  057784 - FIX TO HANDLE REVERSED FX DEALS                     *
     F*  059474 - IF SETTLEMENT NOT IN RETAIL ACCOUNT TREAT AS CROSS  *
     F*           PORTFOLIO SETTLEMENT                                *
     F*  056460 - OUTPUT DUPLICATE RECORDS FOR POOL PORTFOLIO         *
     F*  050406 - OUTPUT DOUBLE PRECISION FX RATE ON FILE             *
     F*  050138 - CPTC SHOULD BE SET TO 'N' FOR FI COMMISSIONS RCVD   *
     F*  049584 - PROCESSING FOR FI COMMISSIONS PAID TO CUSTOMER      *
     F*  047719 - USE EXTERNAL SUBROUTINES ZCCYCN AND ZCCYXR INSTEAD  *
     F*           OF INCORRECT ONCE INTERNALLY DESCRIBED.             *
     F*  046910 - SET CASH DATE TO RUN DATE RATHER THAN ECD           *
     F*  046922 - FOR BATCH POSTINGS ENTERED TO CORRECT INCORRECT     *
     F*           MIDAS POSTINGS FX RATE NOMINAL TO PORTFOLIO CCY     *
     F*           SHOULD BE FX RATE AT POSTING DATE                   *
     F*  046580 - OBTAIN LOAN / DEPOSIT REVERSALS FROM BACKUP FILE    *
     F*  046386 - FIX TO HANDLE CROSS PORTFOLIO SETTLEMENTS           *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F*
     F*       FILE DEFINITIONS
     F*      ------------------
     F*
     F* RE Accounts by Portfolio Reference.
     F*
     F***ACCNTPT**F  E                    DISK         KINFSR *PSSR       S01486
     F***PMACCNL1IF  E                    DISK         KINFSR *PSSRS01486 53103
     FPMACCNL1IF  E           K        DISK         KINFSR *PSSR          53103
     F*
     F**Bank*Details*File.*********************************************   S01486
     F*
     F***SDBANKL1IF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F**Portfolio*Management*ICD.**************************************   S01486
     F*
     F***SDPORTL1IF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F* Account Postings.
     F*
     F***ACPOPT**IF  E           K        DISK         KINFSR *PSSR       S01486
     FPMACPOL0IF  E           K        DISK         KINFSR *PSSR          S01486
     F*
     F* Portfolio Definitions File.
     F*
     F***PMPORTPPIF**E           K        DISK         KINFSR *PSSR       S01486
     FPMPORTPDIF  E           K        DISK         KINFSR *PSSR          S01486
     F*
     F**Currency*Codes*File.*******************************************   S01486
     F*
     F***SDCURRL0IF**E           K        DISK         KINFSR *PSSR       S01486
     F*                                                                    46922
     F* HISTORIC FX RATES                                                  46922
     F***PMHSEXPPIF**E           K        DISK         KINFSR *PSSR 46922 S01486
     FPMHSEXPDIF  E           K        DISK         KINFSR *PSSR          S01486
     F*
     F**Account*Codes*File.********************************************   S01486
     F*
     F***SDACODL0IF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F**TRANSACTION*TYPES**********************************************   S01486
     F*
     F***SDRETRL0IF**E           K        DISK         KINFSR *PSSR       S01486
     F*                                                                   46386
     F** ACCOUNT DETAILS BY 15A ACCOUNT CODE. NO PREFIX                   46386
     F***ACCNT***IF  F     416 15AI     2 DISK         KINFSR *PSSR 46386 S01486
     F***ACCNT***IF**F     416 18AI     2 DISK         KINFSR *PSSR S01486085862
     F***ACCNT***IF**F     437 18AI     2 DISK         KINFSR *PSSR 085862094693
     FACCNT   IF  E           K        DISK         KINFSR *PSSR          094693
     F            ACCNTAAF                          KIGNORE               094693
     F            ACCNTABF                          KRENAMEACCNTB1F       094693
     F            ACCNTACF                          KIGNORE               094693
     F*                                                                   46386
     F** ACCOUNT DETAILS BY 15N ACCOUNT NUMBER. NO PREFIX                 46386
     F***ACNUM***IF**F      47 10AI     2 DISK         KINFSR *PSSR  46386094693
     FACNUM   IF  E           K        DISK         KINFSR *PSSR          094693
     F            ACCNTABF                          KRENAMEACCNTB2F       094693
     F*                                                                   46386
     F** LOAN DETAILS BY LOAN REFERENCE. NO PREFIX                        46386
     F***CLOAN***IF**F     437  7AI     2 DISK                       46386085862
     FCLOAN   IF  F    1092  7AI     2 DISK                               085862
     F*                                                                   46386
     F** LOAN DETAILS BY LOAN REFERENCE. NO PREFIX                        46386
     F***MLOAN***IF**F     437  7AI     2 DISK                       46386085862
     F*MLOAN***IF**F    1094  7AI     2 DISK                       085862 CLE011
     FMLOAN   IF  F    1310  7AI     2 DISK                               CLE011
     F*                                                                   46386
     F** LOAN DETAILS BY LOAN REFERENCE. NO PREFIX                        46580
     F***RLOAN***IF  F     437  6AI     2 DISK                      46580 S01486
     F***PMLOANPDIF**F     437  6AI     2 DISK                      S01486085862
     FPMLOANPDIF  F    1092  6AI     2 DISK                               085862
     F*                                                                   093914
     F** Facility details                                                 093914
     FFCLTY   IF  E           K        DISK                               093914
     F            FCLTYHHF                          KIGNORE               093914
     F            FCLTYFNF                          KIGNORE               093914
     F            FCLTYZZF                          KIGNORE               093914
     F*                                                                   46386
     F** TRADE DETAILS BY TRADE REFERENCE                                 46386
     F***TRADS***IF**F     514  6AI     2 DISK                       46386085862
     FTRADS   IF  F     528  6AI     2 DISK                               085862
     F*                                                                   46386
     F** DEPOT MOVEMENT DETAILS REFERENCE                                 46386
     F***DPTMV***IF**F     143 16AI     2 DISK                       46386085862
     FDPTMV   IF  F     182 16AI     2 DISK                               085862
     F*                                                                   46386
     F** DEAL DETAILS                                                     46386
     F***DEALS***IF**F    1069  6AI     2 DISK                       46386085862
     F***DEALSH**IF**F    1069  6AI     2 DISK                      085810085862
     F***DEALS   IF  F    1154  6AI     2 DISK                                         085862 CGL029
     F***DEALSH  IF  F    1154  6AI     2 DISK                                         085862 CGL029
     FDEALS   IF  F    1363  6AI     2 DISK                                                   CGL029
     FDEALSH  IF  F    1363  6AI     2 DISK                                                   CGL029
     F*                                                                   46386
     F** REVERSED DEAL DETAILS                                            46580
     F***RDEALSDCIF**F    1069  6AI     2 DISK                      46580 S01486
     F***PMDEACPDIF**F    1069  6AI     2 DISK                      S01486085862
     FPMDEACPDIF  F    1154  6AI     2 DISK                               085862
     F*                                                                   57784
     F** REVERSED DEAL DETAILS                                            57784
     F***RDEALSDBIF**F    1042  6AI     2 DISK                      57784 S01486
     F***PMDEABPDIF**F    1042  6AI     2 DISK                      S01486085862
     F***PMDEABPDIF  F    1154  6AI     2 DISK                                         085862 CGL029
     FPMDEABPDIF  F    1363  6AI     2 DISK                                                   CGL029
     F*                                                                   46386
     F***RETAIL*ICD*-**PREFIX*BM************************************46386 S01486
     F***SDRETLL0IF**E           K        DISK         KINFSR *PSSR 46386 S01486
     F*                                                                   46386
     F***SD*CUSTOMER*DETAILS*-**PREFIX*BB***************************46386 S01486
     F***SDCUSTL0IF**E           K        DISK         KINFSR *PSSR 46386 S01486
     F*                                                                   46386
     F***SE*CUSTOMER*DETAILS*-**PREFIX*BF***************************46386 S01486
     F***SDSECSL0IF**E           K        DISK         KINFSR *PSSR 46386 S01486
     F*                                                                   46386
     F***FIDUCIARY*DEPOSIT*DETAILS*-**PREFIX*FD*********************46386 S01486
     F***FIDEPOL0IF**E           K        DISK         KINFSR *PSSR 46386 S01486
     F*                                                                   46386
     F***REVERSED*FIDUCIARY*DEPOSIT*DETAILS*-**PREFIX*FD************46580 S01486
     F***RFIDEPO**F  E           K        DISK         KINFSR *PSSR 46580 S01486
     F*********** FIDEPOD0                          KRENAMEFIDEPOD1 46580 S01486
     F*                                                                   46386
     F***BRANCH*CODES*-**PREFIX*A8**********************************46386 S01486
     F***SDBRCHL0IF**E           K        DISK         KINFSR *PSSR 46386 S01486
     F*                                                                   53103
     F**PM*Deal*Types/subtypes*- prefix P7 (by DealType+Subtype)    53103 081378
     F***SDDTSTPPIF**E           K        DISK         KINFSR *PSSR 53103 081378
     FFDDTSTL1IF  E           K        DISK                               081378
     F                                              KINFSR *PSSR          081378
     F*                                                                   53103
     F* Perf. Cash Analysis - prefix QS (by Cust+Port+FXdeal+I/O+FXact)   53103
     FPMPCAAL2IF  E           K        DISK         KINFSR *PSSR          53103
     F            PMPCAAP0                          KRENAMEPMPCAAP2       53103
      *                                                                   CPM005
      **  Prefix of PMCNSDLL is 'PN'                                      CPM005
     FPMCNSDLLIF  E           K        DISK         KINFSR *PSSR          CPM005
     F*
     F* Performance Cash Analysis File.
     F*
     F***PMPCAAPPO***E           K        DISK         KINFSR *PSSR       S01486
     FPMPCAAPDO   E           K        DISK         KINFSR *PSSR          S01486
     F*                                                                   56460
     F* POOL PORTFOLIO MEMBERS - PREFIX OS                                56460
     FPMPPTML1IF  E           K        DISK         KINFSR *PSSR          56460
     F*                                                                   075998
     F** FF TRANSACTION DETAILS - NO  PREFIX                              075998
     FTRANS2  IF  F     171  6AI     2 DISK                               075998
     F*                                                                   075998
     F** FF INSTRUMENT DETAILS - NO  PREFIX                               075998
     FINTYP   IF  F     192  5AI     2 DISK                               075998
     F*
     F* Printer File.
     F*
     FPM1500AUO   E                    PRINTER
     F*
     F********************************************************************
     F*                                                                  *
     F/EJECT
     F********************************************************************
     F*                                                                  *
     F*  ID F  C  H  L    FUNCTION OF INDICATORS                         *
     F*                  ------------------------                        *
     F*                                                                  *
     F*        69 -  TESTB                                               *
     F*********70*-**Reading*SDBANKL1**********************************  *S01486
     F*        71 -  Reading Portfolio Ref. File                         *
     F*********72*-**Reading*SDGELRL1**********************************  *S01486
     F*********73*-**Reading*SDPORTL1**********************************  *S01486
     F*********75*-**Chaining*to*PMPORTPP*********************************S01486
     F*        75 -  Chaining to PMPORTPD                                *S01486
     F*********76*-**Chaining*to*SDCURRL0******************************  *S01486
     F*********77*-**Chaining*to*SDACODL0******************************  *S01486
     F*        78 -  Read Equals on Account Postings File                *
     F*        79 -  Chaining to TRADS                                   *
     F*        80 -  Chaining to PMPCAAL2                                *53103
     F*********81 -  Chaining to SDDTSTPD                          *53103 081378
     F*        81 -  Chaining to FDDTSTL1                                *081378
     F*                                                                  *
     F********************************************************************
     F*                                                                  *
     F/EJECT
     E********************************************************************
     E*
     E*    ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E                    POWER   1   7  7 3             POWER ARRAY
     E*
      /COPY PMCPYSRC,ZFFOLN1                                              075998
      /COPY ZSRSRC,FFPRCSZ2                                               075998
     E********************************************************************
     E*
     E/EJECT
     I********************************************************************
     I*                                                                   46386
     I***ACCNT***NS**                                                46386094693
     I***********                             2   70ZRCNUM           46386094693
     I***********                             8  10 ZRCCY            46386094693
     I***********                            11  140ZRACOD           46386094693
     I***********                            15  160ZRACSQ           46386094693
     I***********                           401 404 ZRPTFR           46386085862
     I***********                            23  25 ZRBRCA          085862094693
     I***********                           433 436 ZRPTFR          085862094693
     I***********                                                    46386094693
     I***ACNUM***NS*                                                 46386094693
     I***********                            12  170ZRCNUM           46386094693
     I***********                            18  20 ZRCCY            46386094693
     I***********                            21  240ZRACOD           46386094693
     I***********                            25  260ZRACSQ           46386094693
     I***********                            41  44 ZRPTFR           46386094693
     I***********                            29  31 ZRBRCA          081378094693
     I*                                                                   46386
     ICLOAN   NS                                                          46386
     I**********                             12  170TPCNUM                              56460 CSD027
     I                                       12  17 TPCNUM                                    CSD027
     I***********                           401 404 LEPTFR           46386085862
     I                                     10881091 LEPTFR                085862
     I*                                                                   46386
     IMLOAN   NS                                                          46386
     I**********                             12  170TPCNUM                              56460 CSD027
     I                                       12  17 TPCNUM                                    CSD027
     I***********                           401 404 LEPTFR           46386085862
     I                                     10901093 LEPTFR                085862
     I*                                                                   46386
     I***RLOAN***NS                                                 46580 S01486
     IPMLOANPDNS                                                          S01486
     I**********                             12  170TPCNUM                              56460 CSD027
     I                                       12  17 TPCNUM                                    CSD027
     I***********                           401 404 LEPTFR           46580085862
     I                                     10881091 LEPTFR                085862
     I*                                                                   46386
     ITRADS   NS                                                          46386
     I**********                             19  240TPCNUM                              56460 CSD027
     I                                       19  24 TPCNUM                                    CSD027
     I***********                           503 506 TDPTFR           46386085862
     I                                      517 520 TDPTFR                085862
     I*                                                                   46386
     IDPTMV   NS                                                          46386
     I**********                             44  490TPCNUM                              56460 CSD027
     I                                       44  49 TPCNUM                                    CSD027
     I***********                           123 126 DPPTFR           46386085862
     I                                      172 175 DPPTFR                085862
     I*                                                                   46386
     I*    DEALS FILE - DETAIL RECORD - FX SWAPS/OUTRIGHTS.               46386
     IDEALS   NS       1 CD   8 CB                                        46386
     I       OR        1 CE   8 CB                                        46386
     I       OR        1 CM   8 CB                                        46386
     I       OR        1 CR   8 CB                                        46386
     I                                        9  100DLRCDC                46386
     I**********                             11  160TPCNUM                              56460 CSD027
     I                                       11  16 TPCNUM                                    CSD027
     I                                       46  48 DLPUCY                46386
     I                                       86  88 DLSLCY                46386
     I                                      138 1390DLPCST                46386
     I**********                            140 151 DLOPCA                              46386 CGL029
     I                                      162 1630DLSCST                46386
     I**********                            164 175 DLOSCA                              46386 CGL029
     I***********                          10381041 DLPTFR           46386085862
     I                                     10441046 DLROBR                085862
     I                                     10471049 DLPOBR                085862
     I                                     10501053 DLPTFR                085862
     I                                     12921309 DLOPCA                                    CGL029
     I                                     13101327 DLOSCA                                    CGL029
     I*                                                                   46386
     I*    DEALS FILE - DETAIL - TAKINGS/PLACINGS/TIME DEPOSITS/LOANS.    46386
     I        NS  03   1 CD   8 CC                                        46386
     I       OR   03   1 CE   8 CC                                        46386
     I       OR   03   1 CM   8 CC                                        46386
     I       OR   03   1 CR   8 CC                                        46386
     I                                        9  100DLRCDC                46386
     I**********                             11  160TPCNUM                              56460 CSD027
     I                                       11  16 TPCNUM                                    CSD027
     I***********                          10581061 DLPTFR           46386085862
     I                                     11431146 DLPTFR                085862
     I        NS                                                          156721
     I*                                                                   085810
     I**   DEALS FILE - DETAIL RECORD - FX SWAPS/OUTRIGHTS.               085810
     I*                                                                   085810
     IDEALSH  NS       1 CD   8 CB                                        085810
     I       OR        1 CE   8 CB                                        085810
     I       OR        1 CM   8 CB                                        085810
     I       OR        1 CR   8 CB                                        085810
     I                                        9  100DLRCDC                085810
     I**********                             11  160TPCNUM                             085810 CSD027
     I                                       11  16 TPCNUM                                    CSD027
     I                                       46  48 DLPUCY                085810
     I                                       86  88 DLSLCY                085810
     I                                      138 1390DLPCST                085810
     I**********                            140 151 DLOPCA                             085810 CGL029
     I                                      162 1630DLSCST                085810
     I**********                            164 175 DLOSCA                             085810 CGL029
     I***********                          10381041 DLPTFR          085810085862
     I                                     10441046 DLROBR                085862
     I                                     10471049 DLPOBR                085862
     I                                     10501053 DLPTFR                085862
     I                                     12921309 DLOPCA                                    CGL029
     I                                     13101327 DLOSCA                                    CGL029
     I*                                                                   085810
     I*    DEALS FILE - DETAIL - TAKINGS/PLACINGS/TIME DEPOSITS/LOANS.    085810
     I        NS  03   1 CD   8 CC                                        085810
     I       OR   03   1 CE   8 CC                                        085810
     I       OR   03   1 CM   8 CC                                        085810
     I       OR   03   1 CR   8 CC                                        085810
     I                                        9  100DLRCDC                085810
     I**********                             11  160TPCNUM                             085810 CSD027
     I                                       11  16 TPCNUM                                    CSD027
     I***********                          10581061 DLPTFR          085810085862
     I                                     11431146 DLPTFR                085862
     I*                                                                   46580
     I*    DEALS FILE - DETAIL - TAKINGS/PLACINGS/TIME DEPOSITS/LOANS.    46580
     I***RDEALSDCNS**03   1 CD   8 CC                               46580 S01486
     IPMDEACPDNS  03   1 CD   8 CC                                        S01486
     I       OR   03   1 CE   8 CC                                        46580
     I       OR   03   1 CM   8 CC                                        46580
     I       OR   03   1 CR   8 CC                                        46580
     I                                        9  100DLRCDC                46580
     I**********                             11  160TPCNUM                              56460 CSD027
     I                                       11  16 TPCNUM                                    CSD027
     I***********                          10581061 DLPTFR           46580085862
     I                                     11431146 DLPTFR                085862
     I*                                                                   57784
     I*    DEALS FILE - DETAIL RECORD - FX SWAPS/OUTRIGHTS.               57784
     I***RDEALSDBNS*******1 CR   8 CB                               57784 S01486
     IPMDEABPDNS       1 CR   8 CB                                        S01486
     I                                        1   1 DLRECI                57784
     I                                        9  100DLRCDC                57784
     I**********                             11  160TPCNUM                              57784 CSD027
     I                                       11  16 TPCNUM                                    CSD027
     I                                       46  48 DLPUCY                57784
     I                                       86  88 DLSLCY                57784
     I                                      138 1390DLPCST                57784
     I**********                            140 151 DLOPCA                              57784 CGL029
     I                                      162 1630DLSCST                57784
     I**********                            164 175 DLOSCA                              57784 CGL029
     I***********                          10381041 DLPTFR           57784085862
     I                                     10441046 DLROBR                085862
     I                                     10471049 DLPOBR                085862
     I                                     10501053 DLPTFR                085862
     I                                     12921309 DLOPCA                                    CGL029
     I                                     13101327 DLOSCA                                    CGL029
     IACCNTB1F                                                            094693
     I              CNUM                            ZRCNUM                094693
     I              CCY                             ZRCCY                 094693
     I              ACOD                            ZRACOD                094693
     I              ACSQ                            ZRACSQ                094693
     I              BRCA                            ZRBRCA                094693
     I              PTFR                            ZRPTFR                094693
     I*                                                                   094693
     IACCNTB2F                                                            094693
     I              CNUM                            ZRCNUM                094693
     I              CCY                             ZRCCY                 094693
     I              ACOD                            ZRACOD                094693
     I              ACSQ                            ZRACSQ                094693
     I              BRCA                            ZRBRCA                094693
     I              PTFR                            ZRPTFR                094693
     I*                                                                   075998
     ITRANS2  NS                                                          075998
     I**********                             17  220FFCNUM                             075998 CSD027
     I                                       17  22 FFCNUM                                    CSD027
     I                                       25  29 FFISTT                075998
     I                                       30  310FFYRNO                075998
     I                                       32  330FFMTHN                075998
     I                                       34  34 FFPCAL                075998
     I***********                         P  35  407FFSTRP          075998CFF004
     I***********                           131 134 FFPTFR          075998CFF004
     I                                    P  35  428FFSTRP                CFF004
     I                                      135 138 FFPTFR                CFF004
     I*                                                                   075998
     IINTYP   NS                                                          075998
     I                                        2   6 FFISTT                075998
     I                                        7   7 FFISTI                075998
     I                                       28  280FFISPT                075998
     I                                    P  33  340FFTKDM                075998
     I***********                         P  35  407FFMNPF          075998CFF004
     I***********                           113 113 FFPUPF          075998CFF004
     I                                    P  35  428FFMNPF                CFF004
     I                                      115 115 FFPUPF                CFF004
     I*                                                                   46386
     I* 15 A SETTLEMENT ACCOUNT RETURNED                                  46386
     I            DS                            256                       46386
     I**********                              1   60ZWCNUM                              46386 CSD027
     I                                        1   6 ZWCNUM                                    CSD027
     I                                        7   9 ZWCCY                 46386
     I**********                             10  130ZWACOD                              46386 CGL029
     I**********                             14  150ZWACSQ                              46386 CGL029
     I**********                             16  18 ZWBRCA                             S01486 CGL029
     I                                       10  190ZWACOD                                    CGL029
     I                                       20  210ZWACSQ                                    CGL029
     I                                       22  24 ZWBRCA                                    CGL029
     I***********                             1  15 ZWACCN          46386 S01486
     I***********                             1  18 ZWACCN          S01486094693
     I**********                              1  18 ZKACCN                             S01486 CGL029
     I                                        1  24 ZKACCN                                    CGL029
     I*
     I* DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
     I*
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I* LOCAL DATA AREA FOR DATA BASE ERRORS
     I*
     I***LDA********UDS                            256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I* Data Structure for Transaction Reference.
     I*
     I            DS
     I**********                              1  15 OTRF                                      CGL029
     I                                        1  21 OTRF                                      CGL029
     I                                        1   6 WWTRFA
     I                                        2   40KFACT                 093914
     I                                        5   60KFCNO                 093914
     I*
     I* Data Structure for Transaction Type.
     I*
     I            DS
     I                                        1  10 OTTP
     I                                        1   2 WWOTTA
     I*
     I**Data*Structure*for*PMPORTPP*Key.*******************************   S01486
     I* Data Structure for PMPORTPD Key.                                  S01486
     I*
     I            DS
     I                                        1  10 WWPRKY
     I****************************************1   60CNUM                  CPM004
     I**********                              1   60CUST                               CPM004 CSD027
     I                                        1   6 CUST                                      CSD027
     I                                        7  10 PTFR
     I*                                                                   CPM004
     I** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
     I** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
      /COPY PMCPYSRC,ZFFOLN2                                              075998
      /COPY ZSRSRC,FFPRCSZ3                                               075998
      /COPY ZSRSRC,FFSRDSZ1                                               075998
     I*
     IPMSTAT    E DS
     I                                        1   50WWECD
     I*************                          35  35 WWPPRQ          56460 099814
     I                                        1 256 WWSTAT
     I* Constants                                                         53103
     I              '00000010000000000000-C         C#15                  53103
     I              '0000000000'                                          53103
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Data structure for bank details                                 S01486
     I*                                                                   S01486
     ISDMMOD    E DSSDMMODPD                                              CPM004
     I**  Data structure for modules                                      CPM004
     I*                                                                   CPM004
     ISDACOD    E DSSDACODPD                                              S01486
     I**  Data structure for Account Codes details                        S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Data structure for currency details                             S01486
     I*                                                                   S01486
     ISDRETL    E DSSDRETLPD                                              S01486
     I              QQACCD                          REACCD                                    CGL029
     I**  Data structure for Retail ICD                                   S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I**  Data structure for Porfolio Management ICD                      S01486
     I*                                                                   S01486
     ISDSECS    E DSSDSECSPD                                              S01486
     I              QQACCD                          SEACCD                                    CGL029
     I**  Data structure for Security Customer details                    S01486
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              CPM004
     I**  Portfolio Management Customer details                           CPM004
     I*                                                                   CPM004
     ISDNOST    E DSSDNOSTPD                                              CPM004
     I              QQACCD                          NOACCD                                    CGL029
     I**  Data structure for nostro details                               CPM004
     I*                                                                   CPM004
     ISDRETR    E DSSDRETRPD                                              S01486
     I**  Data structure for Retail Transactions details                  S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure for access objects                         S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I**  Long data structure for access programs                         S01486
     I*                                                                   S01486
     I/COPY WNCPYSRC,PMH00001
     I*
     I********************************************************************
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      * #A       - INITIAL PROCESSING                                    *
      * #B       - READ THROUGH ACCOUNTS ASSIGNED TO PORTFOLIOS          *
      **#BA******-*OBTAIN*ACCOUNT*INFORMATION*AND*READ*THROUGH*ACPOPT*****S01486
      * #BA      - OBTAIN ACCOUNT INFORMATION AND READ THROUGH PMACPOL0  *S01486
      * #BAA     - CONTROL SETTING UP OF DETAILS TO BE OUTPUT            *
      * #BAAA    - DETERMINE FX RATES TO BE OUTPUT                       *
      * #SPOT    - OBTAIN FX RATE APPLYING ON DATE IN PAST               *
      * #BAAB    - SET UP DETAILS TO BE OUTPUT                           *
      * #BAABA   - SET UP RELATED REFERENCE AND MODULE ID                *53103
      **#BAAC****-*WRITE*SECOND*RECORD*TO*PMPCAAPP*IF*REQUIRED************S01486
      * #BAAC    - WRITE SECOND RECORD TO PMPCAAPD IF REQUIRED           *S01486
      * #BAAD    - WRITE FIDUCIARY CIMMISSION RECEIVED RECORD            *53103
      * #BAAE    - SET PERFORMANCE EVENT REFERENCE & LCD FIELDS          *53103
      * #C       - WRITE AUDIT REPORT                                    *
      * *PSSR    - PROCESS PROGRAM ERROR                                 *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      *                                                                  *
      ********************************************************************
     C*
     C* Initial Processing.
     C                     EXSR #A
     C* Account processing.
     C                     EXSR #B
     C* Output Report.
     C                     EXSR #C
     C* End program.
     C                     MOVE '1'       *INLR
     C                     RETRN
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #A       - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - PROCESS PROGRAM ERROR                                 *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTRFA   -                                                       *
      * WWCCYP   -                                                       *
      * WWDATP   -                                                       *
      * WWEVCD   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #A        BEGSR
     C*
     C**Key*List*for*File*PMPORTPP.************************************   S01486
     C* Key List for File PMPORTPD.                                       S01486
     C*
     C           PORTKY    KLIST
     C*********************KFLD           CNUM                            CPM004
     C                     KFLD           CUST                            CPM004
     C                     KFLD           PTFR
      *                                                                   CPM005
     C           PORTKZ    KLIST                                          CPM005
     C                     KFLD           CNUM                            CPM005
     C                     KFLD           KPTFR   4                       CPM005
     C*                                                                   46922
     C**   Key to access portfolio historic exchange rates                46922
     C           PMHSEX    KLIST                                          46922
     C                     KFLD           WWCCYH  3                       46922
     C                     KFLD           WWPDAT  50                      46922
     C*
     C**Key*List*for*File*ACPOPT.*****************************************S01486
     C* Key List for File PMACPOL0.                                       S01486
     C*
     C           POSTKY    KLIST
     C                     KFLD           BRCA                            081378
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C*                                                                   53103
     C*  Klist for PMPCAAL2                                               53103
     C           KAAL2     KLIST                                          53103
     C                     KFLD           QSCNUM                          53103
     C***********          KFLD           QSPTFR                    53103 CPM005
     C                     KFLD           QSDLNO                          53103
     C                     KFLD           QSINIO                          53103
     C                     KFLD           QSFXAT                          53103
     C*                                                                   53103
     C***Klist*for*SDDTSTPD                                         53103 081378
     C*  Klist for FDDTSTL1                                               081378
     C           KSTPP     KLIST                                          53103
     C                     KFLD           WWDTYP  2                       53103
     C                     KFLD           WWDSTY  2                       53103
     C*                                                                   094693
     C** Klist for ACCNT                                                  094693
     C           ZWACCN    KLIST                                          094693
     C                     KFLD           ZWCNUM                          094693
     C                     KFLD           ZWCCY                           094693
     C                     KFLD           ZWACOD                          094693
     C                     KFLD           ZWACSQ                          094693
     C                     KFLD           ZWBRCA                          094693
     C*                                                                   S01486
     C                     MOVEACPY@      CPY2@  80
     C*
     C** DEFINE DATA AREA PMSTAT
     C           *NAMVAR   DEFN           PMSTAT
     C                     IN   PMSTAT
     C*                                                                   S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
     C*
     C* INITIALISE DB ERROR FIELDS ETC, AND STORE PROGRAM NAME FOR
     C* DB ERROR FIELD.
     C*
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     MOVEL'PM1500'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C* Access ICD File SDBANKL1.
     C*
     C************LOVAL    SETLLSDBANKL1                                  S01486
     C***********          READ SDBANKL1                 70               S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*
     C* If Record not found - Database Error.
     C*
     C************IN70     IFEQ '1'                                       S01486
     C           P@RTCD    IFNE *BLANK                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE
     C                     MOVE *BLANKS   DBFILE           ***************
     C***********          MOVEL'SDBANKL1'DBFILE           * DBERROR 001 *S01486
     C                     MOVE 'SDBANKPD'DBFILE           * DBERROR 001 *S01486
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C* Access PM Installation Control Data.
     C*
     C************LOVAL    SETLLSDPORTL1                                  S01486
     C***********          READ SDPORTL1                 73               S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C*
     C* If Record not found - Database Error.
     C*
     C************IN73     IFEQ '1'                                       S01486
     C           P@RTCD    IFNE *BLANK                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD3         DBASE
     C                     MOVE *BLANKS   DBFILE           ***************
     C***********          MOVEL'SDPORTL1'DBFILE           * DBERROR 003 *S01486
     C                     MOVE 'SDPORTPD'DBFILE           * DBERROR 003 *S01486
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CPM004
     C* Access Modules                                                    CPM004
     C*                                                                   CPM004
     C                     CALL 'AOMMODR0'                                CPM004
     C                     PARM *BLANKS   P@RTCD                          CPM004
     C                     PARM '*FIRST ' P@OPTN                          CPM004
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPM004
     C           P@RTCD    IFNE *BLANK                                    CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD50        DBASE                           CPM004
     C                     MOVE *BLANKS   DBFILE           ***************CPM004
     C                     MOVE 'SDMMODPD'DBFILE           * DBERROR 050 *CPM004
     C                     MOVE *BLANKS   DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C* If retail installed                                               CPM004
     C*                                                                   CPM004
     C           BGNXST    IFEQ 'Y'                                       CPM004
     C* Access ICD File SDRETLL0.                                         46386
     C*                                                                   46386
     C************LOVAL    SETLLSDRETLL0                            46386 S01486
     C***********          READ SDRETLL0                 70         46386 S01486
     C                     CALL 'AORETLR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDRETL    PARM SDRETL    DSFDY                           S01486
     C*                                                                   46386
     C* If Record not found - Database Error.                             46386
     C*                                                                   46386
     C************IN99     IFEQ '1'                                 46386 S01486
     C           P@RTCD    IFNE *BLANK                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE                           46386
     C                     MOVE *BLANKS   DBFILE           ***************46386
     C***********          MOVEL'SDRETLL0'DBFILE     * DBERROR 001 *46386 S01486
     C                     MOVE 'SDRETLPD'DBFILE           * DBERROR 001 *S01486
     C                     MOVE *BLANKS   DBKEY            ***************46386
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     46386
     C                     END                                            46386
     C                     END                                            CPM004
     C*                                                                   099814
     C* Access Switchable features for Pool portfolios                    099814
     C*                                                                   099814
     C                     CALL 'AOSARDR0'                                099814
     C                     PARM *BLANKS   P@RTCD                          099814
     C                     PARM '*VERIFY' P@OPTN                          099814
     C                     PARM 'CQQ001'  P@SARD  6                       099814
     C                     PARM           DSFDY                           099814
     C*                                                                   099814
     C           P@RTCD    IFEQ *BLANK                                    099814
     C                     MOVEL'Y'       WWPPRQ  1                       099814
     C                     END                                            099814
     C/COPY WNCPYSRC,PMH00002
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #B       - READ THROUGH ACCOUNTS ASSIGNED TO PORTFOLIOS          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **#BA******-*OBTAIN*ACCOUNT*INFORMATION*AND*READ*THROUGH*ACPOPT*****S01486
      * #BA      - OBTAIN ACCOUNT INFORMATION AND READ THROUGH PMACPOL0  *S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWACCC   -                                                       *
      * WWPOSC   -                                                       *
      * WWPERC   -                                                       *
      * WWCUST   -                                                       *
      * WWPTFR   -                                                       *
      * WWACOD   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #B        BEGSR
     C*
     C* Initialize Counters.
     C*
     C* Portfolio Accounts Read.
     C*
     C                     Z-ADD0         WWACCC  50
     C*
     C* Portfolio Postings Read.
     C*
     C                     Z-ADD0         WWPOSC  50
     C*
     C* Performance Records Written.
     C*
     C                     Z-ADD0         WWPERC  50
     C*
     C* Read RE Accounts by Portfolio Ref. File.
     C*
     C***********          READ ACCNTPT                  71               S01486
     C                     READ PMACCNL1                 71               S01486
     C*
     C* Store customer number portfolio reference currency and account
     C* Code.
     C**********           Z-ADD0         WWCUST  60                                          CSD027
     C                     MOVE *BLANKS   WWCUST  6                                           CSD027
     C                     MOVE *BLANKS   WWPTFR  4
     C**********           Z-ADD0         WWACOD  40                                          CGL029
     C                     Z-ADD0         WWACOD 100                                          CGL029
     C*
     C* Write records to report until no more records on file.
     C*
     C           *IN71     DOWEQ'0'
     C*                                                                   46386
     C* Add 1 to to the count of Portfolio Accounts read.                 46386
     C*                                                                   46386
     C                     ADD  1         WWACCC                          46386
     C*
     C* Do Account processing.
     C*
     C***********PTFR      IFNE '9997'                                    CPM005
     C           ACST      IFNE 'C'                                       090503
     C           ACST      OREQ 'C'                                       101216
     C           DACC      ANDEQBJRDNB                                    101216
     C                     EXSR #BA
     C*
     C* Store customer number portfolio reference currency and account
     C* Code.
     C*********************MOVE CNUM      WWCUST  60                      CPM004
     C**********           MOVE CUST      WWCUST  60                                   CPM004 CSD027
     C                     MOVE CUST      WWCUST  6                                           CSD027
     C                     MOVE PTFR      WWPTFR  4
     C                     END
     C*
     C* Read RE Accounts by Portfolio Ref. File.
     C*
     C***********          READ ACCNTPT                  71               S01486
     C                     READ PMACCNL1                 71               S01486
     C                     END
     C*
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      **#BA******-*OBTAIN*ACCOUNT*INFORMATION*AND*READ*THROUGH*ACPOPT*****S01486
      * #BA      - OBTAIN ACCOUNT INFORMATION AND READ THROUGH PMACPOL0  *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - PROCESS PROGRAM ERROR                                 *
      * #BAA     - CONTROL SETTING UP OF DETAILS TO BE OUTPUT            *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #B       - READ THROUGH ACCOUNTS ASSIGNED TO PORTFOLIOS          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCUST   -                                                       *
      * WWPTFR   -                                                       *
      * WWPRKY   -                                                       *
      * WWCSBY   -                                                       *
      * WWBYDP   -                                                       *
      * WWECD    -                                                       *
      * WWACOD   -                                                       *
      * WWACCC   -                                                       *
      * WWPOSC   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BA       BEGSR
      *                                                                   CPM004
      *  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
      *                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           BRCA      IFNE WWBRCA                                    CPM004
     C                     EXSR BRANCH                                    CPM004
     C                     MOVE BRCA      WWBRCA  3                       CPM004
     C                     ENDIF                                          CPM004
     C                     MOVE O#BICN    CUST                            CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
      *  IF CUSTOMER PORTFOLIOS SUPPORTED                                 CPM004
      *                                                                   CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
     C                     MOVE CNUM      CUST                            CPM004
     C                     ENDIF                                          CPM004
     C*
     C* On Change of customer number or Portfolio reference.
     C*
     C***********CNUM******IFNE WWCUST                                    CPM004
     C           CUST      IFNE WWCUST                                    CPM004
     C           PTFR      ORNE WWPTFR
      *                                                                   CPM005
     C                     MOVEL'N'       WWPORT  1                       CPM005
     C                     MOVEL'N'       WW9998  1                       CPM005
     C                     MOVEL'N'       WW9999  1                       CPM005
     C           PTFR      IFEQ '9997'                     B1             CPM005
      *                                                                   CPM005
     C           PORTKY    CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                        B2             CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WWPORT                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     MOVELPNPTCY    WYCSBY  3                       CPM005
     C                     Z-ADDPNPCDP    WYBYDP  10                      CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    KPTFR                           CPM005
     C           PORTKZ    CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                        B2             CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WW9999                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     MOVELPNPTCY    WWCSB1  3                       CPM005
     C                     Z-ADDPNPCDP    WWBYD1  10                      CPM005
     C                     ELSE                            X1             CPM005
     C*
     C* Access Portfolio Definition details.
     C*
     C***********PORTKY    CHAINPMPORTPP             75                   S01486
     C           PORTKY    CHAINPMPORTPD             75                   S01486
     C*
     C           *IN75     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD4         DBASE
     C                     MOVE *BLANKS   DBFILE           ***************
     C***********          MOVEL'PMPORTPP'DBFILE           * DBERROR 004 *S01486
     C                     MOVE 'PMPORTPD'DBFILE           * DBERROR 004 *S01486
     C                     MOVELWWPRKY    DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C*
     C                     ELSE
     C***********          MOVE PNPTCY    WWCSBY  3                       CPM005
     C***********          MOVE PNPCDP    WWBYDP  10                      CPM005
     C                     MOVELPNPTCY    WYCSBY  3                       CPM005
     C                     Z-ADDPNPCDP    WYBYDP  10                      CPM005
     C                     END
     C****                                                                56460
     C***IF PERFORMANCE CALCULATIONS HAVE NOT BEEN STARTED FOR            56460
     C***PORTFOLIO NO FURTHER PROCESSING FOR ACCOUNT                      56460
     C****       PNPSDT    CABGTWWECD     #BA9                            56460
     C*                                                                   56460
     C** SET ON FLAG INDICATING WHETHER PERFORMANCE CALCULATIONS          56460
     C** STRATED FOR PORTFOLIO                                            56460
     C                     MOVE 'N'       WWPORT  1                       56460
     C***********PNPSDT    IFLE WWECD                               56460 CPM005
     C           PNPSDT    IFLT WWECD                                     CPM005
     C                     MOVE 'Y'       WWPORT  1                       56460
     C                     END                                            56460
      *                                                                   CPM005
     C                     MOVEL'9998'    KPTFR                           CPM005
     C           PORTKZ    CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                                       CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WW9998                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    KPTFR                           CPM005
     C           PORTKZ    CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                                       CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WW9999                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     MOVELPNPTCY    WWCSB1  3                       CPM005
     C                     Z-ADDPNPCDP    WWBYD1  10                      CPM005
     C                     END                             E1             CPM005
     C*                                                                   56460
     C** CHECK WHETHER PORTFOLIO IS MEMBER OF POOL                        56460
     C                     MOVE 'N'       WWPOOL  1                       56460
     C**********           Z-ADD0         WSPCNU                                        56460 CSD027
     C                     MOVE *BLANKS   WSPCNU                                              CSD027
     C                     MOVE *BLANKS   WSPPTF                          56460
     C           WWPPRQ    IFEQ 'Y'                                       56460
     C           PORTKY    CHAINPMPPTML1             75                   56460
     C*                                                                   56460
     C** IF THE PORTFOLIO IS A POOL MEMBER CHECK WHETHER PERFORMANCE ON   56460
     C** THE POOL                                                         56460
     C           *IN75     IFEQ '0'                                       56460
     C*                                                                   56460
     C**********           Z-ADDOSPCNU    WSPCNU  60                                    56460 CSD027
     C                     MOVE OSPCNU    WSPCNU  6                                           CSD027
     C                     MOVE OSPPTF    WSPPTF  4                       56460
     C*                                                                   56460
     C* Access POOL Portfolio Definition details.                         56460
     C           POOLKY    KLIST                                          56460
     C                     KFLD           OSPCNU                          56460
     C                     KFLD           OSPPTF                          56460
     C*                                                                   56460
     C***********POOLKY    CHAINPMPORTPP             75             56460 S01486
     C           POOLKY    CHAINPMPORTPD             75                   S01486
     C*                                                                   56460
     C           *IN75     IFEQ '1'                                       56460
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD44        DBASE                           56460
     C                     MOVE *BLANKS   DBFILE           ***************56460
     C***********          MOVEL'PMPORTPP'DBFILE     * DBERROR 044 *56460 S01486
     C                     MOVE 'PMPORTPD'DBFILE           * DBERROR 044 *S01486
     C                     MOVELOSPCNU    DBKEY            ***************56460
     C                     MOVE OSPPTF    DBKEY                           56460
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     56460
     C                     END                                            56460
     C*                                                                   56460
     C** SET ON FLAG INDICATING PERFORMANCE CALCULATIONS REQUIRED FOR     56460
     C** POOL                                                             56460
     C***********PNPSDT    IFLE WWECD                               56460 CPM005
     C           PNPSDT    IFLT WWECD                                     CPM005
     C                     MOVE 'Y'       WWPOOL  1                       56460
     C                     END                                            56460
     C                     END                                            56460
     C                     END                                            56460
     C                     END
     C*                                                                   56460
     C** IF NEITHER PERFORMANCE FOR PORTFOLIO NOR POOL TERMINATE          56460
     C** ROUTINE                                                          56460
     C           WWPORT    IFEQ 'N'                                       56460
     C           WWPOOL    ANDEQ'N'                                       56460
     C           WW9998    ANDEQ'N'                                       CPM005
     C           WW9999    ANDEQ'N'                                       CPM005
     C                     GOTO #BA9                                      56460
     C                     END                                            56460
     C*
     C* On change of account code.
     C*
     C           ACOD      IFNE WWACOD
     C*
     C* Access Currency Codes File.
     C*
     C**********           MOVE ACOD      WKACOD  4                                           CGL029
     C                     MOVE ACOD      WKACOD 10                                           CGL029
     C***********WKACOD    CHAINSDACODL0             77                   S01486
     C                     CALL 'AOACODR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C**********           PARM WKACOD    P@ACOD  4                                    S01486 CGL029
     C                     PARM WKACOD    P@ACOD 10                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01486 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*
     C************IN77     IFEQ '1'                                       S01486
     C           P@RTCD    IFNE *BLANK                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD5         DBASE
     C                     MOVE *BLANKS   DBFILE           ***************
     C***********          MOVEL'SDACODL0'DBFILE           * DBERROR 005 *S01486
     C                     MOVE 'SDACODPD'DBFILE           * DBERROR 005 *S01486
     C                     MOVELWKACOD    DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C**********           MOVE ACOD      WWACOD  40                                          CGL029
     C                     MOVE ACOD      WWACOD 100                                          CGL029
     C                     END
     C*
     C* Read Account Postings File.
     C*
     C***********POSTKY    SETLLACPOPT                                    S01486
     C***********POSTKY    SETLLPMACPOL0                           S01486 53103
     C***********POSTKY    READEACPOPT                   78               S01486
     C***********POSTKY    READEPMACPOL0                 78        S01486 53103
     C           POSTKY    CHAINPMACPOL0             78                   53103
     C*
     C           *IN78     DOWEQ'0'
     C*                                                                   134306
     C** Do not process FRA/IRS and NA purchased/sold deals.              134306
     C*                                                                   134306
     C           OTTP      IFNE 'FR'                                      134306
     C           OTTP      ANDNE'RS'                                      134306
     C           OTTP      ANDNE'RX'                                      134306
     C           OTTP      ANDNE'RP'                                      134306
     C           OTTP      ANDNE'RR'                                      134306
     C           OTTP      ANDNE'RF'                                      134306
     C*                                                                   134306
     C           OTTP      ANDNE'C1'                                      134306
     C           OTTP      ANDNE'C2'                                      134306
     C           OTTP      ANDNE'BD'                                      134306
     C           OTTP      ANDNE'BP'                                      134306
     C           OTTP      ANDNE'TB'                                      134306
     C           OTTP      ANDNE'TA'                                      134306
     C           OTTP      ANDNE'DA'                                      134306
     C*                                                                   134306
     C           OTTP      ANDNE'CS'                                      134306
     C           OTTP      ANDNE'BR'                                      134306
     C           OTTP      ANDNE'BS'                                      134306
     C           OTTP      ANDNE'TS'                                      134306
     C           OTTP      ANDNE'RA'                                      134306
     C           OTTP      ANDNE'TR'                                      134306
     C*
     C* Add 1 to Count of Portfolio Postings read.
     C*
     C                     ADD  1         WWPOSC
     C*
     C* Extract Performance Data.
     C*
     C                     EXSR #BAA
     C*                                                                   134306
     C                     ENDIF                                          134306
     C*
     C***********POSTKY    READEACPOPT                   78               S01486
     C           POSTKY    READEPMACPOL0                 78               S01486
     C*
     C                     END
     C*
     C*
     C           #BA9      ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BAA     - CONTROL SETTING UP OF DETAILS TO BE OUTPUT            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #BAAA    - DETERMINE FX RATES TO BE OUTPUT                       *
      * #BAAB    - SET UP DETAILS TO BE OUTPUT                           *
      **#BAAC****-*WRITE*SECOND*RECORD*TO*PMPCAAPP*IF*REQUIRED************S01486
      * #BAAC    - WRITE SECOND RECORD TO PMPCAAPD IF REQUIRED           *S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      **#BA******-*OBTAIN*ACCOUNT*INFORMATION*AND*READ*THROUGH*ACPOPT*****S01486
      * #BA      - OBTAIN ACCOUNT INFORMATION AND READ THROUGH PMACPOL0  *S01486
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWEVCD   -                                                       *
      * WWPERC   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BAA      BEGSR
     C*
     C* If Trade Value Date positions indicator = 'T' and
     C* Posting record indicator = 'C'.
     C*
     C***********P9TVPS    IFEQ 'T'                                       S01486
     C           FCTVPS    IFEQ 'T'                                       S01486
     C           PRIN      ANDEQ'C'
     C                     GOTO #BAA1
     C                     END
     C*
     C* If Trade Value Date positions indicator = 'V' and the Value
     C* Date is greater than the Event Control Date skip to end of
     C* subroutine.
     C*
     C***********P9TVPS    IFEQ 'V'                                       S01486
     C           FCTVPS    IFEQ 'V'                                       S01486
     C           VALD      ANDGTWWECD
     C                     GOTO #BAA1
     C                     END
     C*
     C* PERFORM SR/#BAAA TO CALCULATE FX RATES
     C                     MOVE WYCSBY    WWCSBY  3                       CPM005
     C                     Z-ADDWYBYDP    WWBYDP  10                      CPM005
     C                     EXSR #BAAA
     C*
     C* If Debit/Credit indicator = '1' set Incoming/Outgoing indicator
     C* equal to 'I' for incoming.
     C*
     C           DRCR      IFEQ 1
     C*
     C                     MOVE 'I'       QSINIO
     C*
     C                     ELSE
     C*
     C* Set it to equal to 'O' for outgoing.
     C*
     C                     MOVE 'O'       QSINIO
     C                     END
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           DRCR      IFEQ 1                                         CPM004
     C                     MOVE 'O'       QSINIO                          CPM004
     C                     ELSE                                           CPM004
     C                     MOVE 'I'       QSINIO                          CPM004
     C                     END                                            CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C                     MOVE QSINIO    WWINIO  1                       53103
     C*
     C* Set up Data before writing record.
     C*
     C                     EXSR #BAAB
     C*
     C** Process only if not a facility fee record                        093914
     C*                                                                   093914
     C           CONTIN    IFEQ 'Y'                                       093914
     C                     MOVE 'Y'       QSAPRA
     C*
     C** IF PORTFOLIO HAS PERFORMANCE WRITE RECORD TO CASH ANALYSIS FILE
     C*
     C           WWPORT    IFEQ 'Y'                                       56460
     C                     EXSR #BAAE                                     53103
     C                     WRITEPMPCAAP0
     C*
     C* Add 1 to Count of Performance records written.
     C*
     C                     ADD  1         WWPERC
     C                     END                                            56460
      *                                                                   CPM005
     C                     Z-ADD*ZEROS    WMFXR8 308                      CPM005
     C                     Z-ADD*ZEROS    WMFXR9 308                      CPM005
      *                                                                   CPM005
      **  Write record for "9998" portfolio                               CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B1             CPM005
     C                     MOVELQSPTFR    WXPTFR                          CPM005
     C                     Z-ADDQSMFXR    WXMFXR 308                      CPM005
     C                     MOVE QSCPTC    WXCPTC  1                       CPM005
      *                                                                   CPM005
     C                     MOVELWWCSB1    WWCSBY                          CPM005
     C                     Z-ADDWWBYD1    WWBYDP                          CPM005
     C                     EXSR #BAAA                                     CPM005
      *                                                                   CPM005
      **  For non-FX trans., if the transaction is not in the '9997'      CPM005
      **  portfolio, set the change to portfolio capital ind to 'N'       CPM005
      *                                                                   CPM005
     C           QSCPTC    IFEQ 'Y'                        B2             CPM005
     C           SPOS      IFEQ '  GE-LE'                  B3             CPM005
     C           SPOS      OREQ '  GE-ST'                                 CPM005
     C           SPOS      OREQ '  GE-FI'                                 CPM005
     C           SPOS      OREQ '  GE-DL'                                 CPM005
     C           QSREMI    ANDEQ'MM'                                      CPM005
     C           SPOS      OREQ '  GE-DL'                                 CPM005
     C           QSREMI    ANDEQ'MD'                                      CPM005
      *                                                                   CPM005
     C           CNUM      IFEQ TPCNUM                     B4             CPM005
     C           TPPTFR    ANDNE'9997'                                    CPM005
     C                     MOVEL'N'       QSCPTC                          CPM005
     C                     END                             E4             CPM005
      *                                                                   CPM005
     C                     END                             E3             CPM005
      *                                                                   CPM005
      **  For postings from FX deals, check that both sett accounts       CPM005
      **  are in defined portfolios                                       CPM005
      *                                                                   CPM005
     C           SPOS      IFEQ '  GE-DL'                  B3             CPM005
     C           QSREMI    ANDEQ'FX'                                      CPM005
      *                                                                   CPM005
     C           WBCNUN    IFEQ WSCNUN                     B4             CPM005
     C           WBPTFR    ANDNE'9997'                                    CPM005
     C           WSPTFR    ANDNE'9997'                                    CPM005
     C                     MOVE 'N'       QSCPTC                          CPM005
     C                     END                             E4             CPM005
      *                                                                   CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  Check whether posting due to batch input (last 6 char num)      CPM005
      *                                                                   CPM005
     C                     MOVE SPOS      WWSPOS  6                       CPM005
     C                     TESTN          WWSPOS     61                   CPM005
     C/COPY WNCPYSRC,PMH00003
      *                                                                   CPM005
     C           *IN61     IFEQ '1'                        B2             CPM005
      *                                                                   CPM005
      ****************************************************************    CPM005
      * Change to capital *    N    *     P    *     C    *     Y    *    CPM005
      ****************************************************************    CPM005
      * Total portf 9998  *    N    *     N    *     Y    *     Y    *    CPM005
      ****************************************************************    CPM005
      *                                                                   CPM005
     C           A1CPTC    IFEQ 'C'                        B3             CPM005
     C           A1CPTC    OREQ 'Y'                                       CPM005
     C                     MOVE 'Y'       QSCPTC                          CPM005
     C                     ELSE                            X3             CPM005
     C                     MOVE 'N'       QSCPTC                          CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     MOVEL'9998'    QSPTFR                          CPM005
     C                     EXSR #BAAE                                     CPM005
     C                     WRITEPMPCAAP0                                  CPM005
     C                     Z-ADDQSMFXR    WMFXR8                          CPM005
     C                     MOVELWXPTFR    QSPTFR                          CPM005
     C                     Z-ADDWXMFXR    QSMFXR                          CPM005
     C                     MOVE WXCPTC    QSCPTC                          CPM005
     C                     ADD  1         WWPERC                          CPM005
     C                     END                             E1             CPM005
      *                                                                   CPM005
      **  Write record for "9999" portfolio                               CPM005
      *                                                                   CPM005
     C           WW9999    IFEQ 'Y'                        B1             CPM005
     C                     MOVELQSPTFR    WXPTFR                          CPM005
     C                     Z-ADDQSMFXR    WXMFXR                          CPM005
     C                     MOVELQSCPTC    WXCPTC                          CPM005
      *                                                                   CPM005
      **  Determine rate to "9999" portfolio currency                     CPM005
      *                                                                   CPM005
     C           PTFR      IFNE '9997'                     B2             CPM005
     C                     MOVELWWCSB1    WWCSBY                          CPM005
     C                     Z-ADDWWBYD1    WWBYDP                          CPM005
     C                     EXSR #BAAA                                     CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  Reset change to portfolio capital to "N" for non-FX deals       CPM005
      **  transactions if customer on transaction is same as customer     CPM005
      **  of settlement account                                           CPM005
      *                                                                   CPM005
     C           SPOS      IFEQ '  GE-LE'                  B2             CPM005
     C           SPOS      OREQ '  GE-DL'                                 CPM005
     C           QSREMI    ANDEQ'MD'                                      CPM005
     C           SPOS      OREQ '  GE-DL'                                 CPM005
     C           QSREMI    ANDEQ'ML'                                      CPM005
     C           SPOS      OREQ '  GE-ST'                                 CPM005
     C           SPOS      OREQ '  GE-FI'                                 CPM005
      *                                                                   CPM005
     C           CNUM      IFEQ TPCNUM                     B3             CPM005
     C                     MOVEL'N'       QSCPTC                          CPM005
     C                     END                             E3             CPM005
      *                                                                   CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  Reset change to portfolio capital to "N" for FX deal            CPM005
      **  postings if both accounts for same customer                     CPM005
      *                                                                   CPM005
     C           SPOS      IFEQ '  GE-DL'                  B2             CPM005
     C           QSREMI    ANDEQ'FX'                                      CPM005
      *                                                                   CPM005
     C           WSCNUN    IFEQ WBCNUN                     B3             CPM005
     C                     MOVEL'N'       QSCPTC                          CPM005
     C                     END                             E3             CPM005
      *                                                                   CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  Check whether posting due to batch input (last 6 char num)      CPM005
      *                                                                   CPM005
     C                     MOVE SPOS      WWSPOS  6                       CPM005
     C                     TESTN          WWSPOS     61                   CPM005
     C/COPY WNCPYSRC,PMH00004
      *                                                                   CPM005
     C           *IN61     IFEQ '1'                        B2             CPM005
      *                                                                   CPM005
      ****************************************************************    CPM005
      * Change to capital *    N    *     P    *     C    *     Y    *    CPM005
      ****************************************************************    CPM005
      * Consolidated 9999 *    N    *     N    *     N    *     Y    *    CPM005
      ****************************************************************    CPM005
      *                                                                   CPM005
     C           A1CPTC    IFEQ 'N'                        B3             CPM005
     C           A1CPTC    OREQ 'P'                                       CPM005
     C           A1CPTC    OREQ 'C'                                       CPM005
     C                     MOVE 'N'       QSCPTC                          CPM005
     C                     ELSE                            X3             CPM005
     C                     MOVE 'Y'       QSCPTC                          CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  Prepare details for output                                      CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    QSPTFR                          CPM005
     C                     EXSR #BAAE                                     CPM005
     C                     WRITEPMPCAAP0                                  CPM005
     C                     Z-ADDQSMFXR    WMFXR9                          CPM005
     C                     MOVELWXPTFR    QSPTFR                          CPM005
     C                     Z-ADDWXMFXR    QSMFXR                          CPM005
     C                     MOVE WXCPTC    QSCPTC                          CPM005
     C                     ADD  1         WWPERC                          CPM005
     C                     END                             E1             CPM005
     C*                                                                   56460
     C** IF POOL HAS PERFORMANCE WRITE RECORD TO CASH ANALYSIS FILE       56460
     C           WWPOOL    IFEQ 'Y'                        B1             56460
     C**********           Z-ADDQSCNUM    WSCNUM  60                                    56460 CSD027
     C                     MOVE QSCNUM    WSCNUM  6                                           CSD027
     C                     MOVE QSPTFR    WXPTFR  4                       56460
     C                     MOVE QSCPTC    WSCPTC  1                       56460
     C**********           Z-ADDQSACOD    WNACOD  40                                    56460 CGL029
     C                     Z-ADDQSACOD    WNACOD 100                                          CGL029
     C                     Z-ADDQSACSQ    WNACSQ  20                      56460
     C                     MOVE QSBRCA    WNBRCA  3                       085862
     C**********           Z-ADDQSACCU    WNACCU  60                                   CPM004 CSD027
     C                     MOVE QSACCU    WNACCU  6                                           CSD027
     C                     Z-ADDQSDLNO    WSDLNO  60                      56460
     C**********           MOVE QSREPS    WSREPS 20                                    CPM005 CGL029
     C                     MOVE QSREPS    WSREPS 26                                           CGL029
     C**********           Z-ADDWSPCNU    QSCNUM                                        56460 CSD027
     C                     MOVE WSPCNU    QSCNUM                                              CSD027
     C                     MOVE WSPPTF    QSPTFR                          56460
     C                     Z-ADD0         QSACOD                          56460
     C                     Z-ADD0         QSACSQ                          56460
     C                     MOVE *BLANKS   QSBRCA                          085862
     C**********           Z-ADD*ZERO     QSACCU                                       CPM004 CSD027
     C                     MOVE *BLANKS   QSACCU                                              CSD027
     C*
     C** IF POSTING COMING FROM TRANSACTION MODULE AND SETTLEMENT         56460
     C** ACROSS PORTFOLIOS CHECK WHETHER DIFFERENT PORTFOLIOS IN SAME     56460
     C** POOL                                                             56460
     C           QSCPTC    IFEQ 'Y'                        B2             56460
     C           FCPORS    ANDNE'B'                                       CPM004
     C           QSDLNO    ORNE 0                                         56460
     C           FCPORS    ANDNE'B'                                       CPM004
     C*                                                                   56460
     C           SPOS      IFEQ '  GE-FI'                  B3             56460
     C           SPOS      OREQ '  GE-LE'                                 56460
     C           SPOS      OREQ '  GE-ST'                                 56460
     C           SPOS      OREQ '  GE-DL'                                 56460
     C           SPOS      OREQ '  GE-FF'                                 075998
     C           BGFUOP    ANDEQ'Y'                                       075998
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C*                                                                   56460
     C           TPPOOL    KLIST                                          56460
     C                     KFLD           TPCNUM                          56460
     C***********          KFLD           TPPTFR                    56460 S01486
     C                     KFLD           TPPTFR  4                       S01486
     C*                                                                   56460
     C** OBTAIN POOL PORTFOLIO REFERENCE FOR SETTLEMENT PORTFOLIO         56460
     C           TPPOOL    CHAINPMPPTML1             75                   56460
     C*                                                                   56460
     C** CHECK WHETHER SETTLEMENT PORTFOLIO AND TRANSACTION IN SAME       56460
     C** POOL PORTFOLIO (ALL CASES OTHER THAN FX DEAL WITH SETTLEMENT     56460
     C** ACCOUNTS IN DIFFERENT PORTFOLIOS)                                56460
     C           SPOS      IFEQ '  GE-FI'                  B4             56460
     C           SPOS      OREQ '  GE-LE'                                 56460
     C           SPOS      OREQ '  GE-ST'                                 56460
     C           SPOS      OREQ '  GE-DL'                                 56460
     C           DLRCDC    ANDNE11                                        56460
     C           DLRCDC    ANDNE12                                        56460
     C           DLRCDC    ANDNE13                                        56460
     C           DLRCDC    ANDNE14                                        56460
     C           SPOS      OREQ '  GE-DL'                                 56460
     C           DLRCDC    ANDNE15                                        56460
     C           DLRCDC    ANDNE16                                        56460
     C           DLRCDC    ANDNE17                                        56460
     C           DLRCDC    ANDNE18                                        56460
     C***********QSDLNO    ANDNE0                                   56460 53103
     C***********QSCPTC    ANDEQ'N'                                 56460 53103
     C           QSCPTC    ANDEQ'Y'                                       53103
     C           SPOS      OREQ '  GE-FF'                                 075998
     C           BGFUOP    ANDEQ'Y'                                       075998
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C*                                                                   56460
     C** IF TRANSACTION AND ACCOUNT IN SAME POOL RESET CPTC TO N          56460
     C           *IN75     IFEQ '0'                        B5             56460
     C           OSRECI    ANDEQ'D'                                       56460
     C           WSPCNU    ANDEQOSPCNU                                    56460
     C           WSPPTF    ANDEQOSPPTF                                    56460
     C                     MOVE 'N'       QSCPTC                          56460
     C***********          Z-ADD0         QSDLNO                    56460 53103
     C                     END                             E5             56460
     C                     END                             E4             56460
     C*                                                                   56460
     C** FOR AN FX DEAL CHECK FOR BOTH SETTLEMENT ACCOUNTS IN SAME        56460
     C** PORTFOLIO                                                        56460
     C           SPOS      IFEQ '  GE-DL'                  B4             56460
     C           DLRCDC    ANDNE15                                        56460
     C           DLRCDC    ANDNE16                                        56460
     C           DLRCDC    ANDNE17                                        56460
     C           DLRCDC    ANDNE18                                        56460
     C           WBRETL    ANDEQ'Y'                                       59474
     C           WSRETL    ANDEQ'Y'                                       59474
     C*                                                                   56460
     C** DETERMINE POOL FOR BUY SIDE                                      56460
     C                     MOVE WBPTFR    TPPTFR                          56460
     C           TPPOOL    CHAINPMPPTML1             75                   56460
     C*                                                                   56460
     C** SAVE POOL PORTFOLIO FOR SETTLEMENT OF BOUGHT SIDE                56460
     C                     MOVE 'N'       WBPOOL  1                       56460
     C           *IN75     IFEQ '0'                        B5             56460
     C           OSRECI    ANDEQ'D'                                       56460
     C**********           MOVE OSPCNU    WBPCNU  60                                    56460 CSD027
     C                     MOVE OSPCNU    WBPCNU  6                                           CSD027
     C                     MOVE OSPPTF    WBPPTF  4                       56460
     C                     MOVE 'Y'       WBPOOL  1                       56460
     C                     END                             E5             56460
     C*                                                                   56460
     C** DETERMINE POOL FOR SELL SIDE                                     56460
     C                     MOVE WSPTFR    TPPTFR                          56460
     C           TPPOOL    CHAINPMPPTML1             75                   56460
     C*                                                                   56460
     C** IF TRANSACTION AND ACCOUNT IN SAME POOL RESET CPTC TO N          56460
     C           *IN75     IFEQ '0'                        B5             56460
     C           OSRECI    ANDEQ'D'                                       56460
     C           WBPOOL    ANDEQ'Y'                                       56460
     C           WBPCNU    ANDEQOSPCNU                                    56460
     C           WBPPTF    ANDEQOSPPTF                                    56460
     C                     MOVE 'N'       QSCPTC                          56460
     C                     END                             E5             56460
     C                     END                             E4             56460
     C                     END                             E3             56460
     C                     END                             E2             56460
      *                                                                   CPM005
      **  Check whether posting due to batch input (last 6 char num)      CPM005
      *                                                                   CPM005
     C                     MOVE SPOS      WWSPOS  6                       CPM005
     C                     TESTN          WWSPOS     61                   CPM005
     C/COPY WNCPYSRC,PMH00005
      *                                                                   CPM005
     C           *IN61     IFEQ '1'                        B2             CPM005
      *                                                                   CPM005
      ****************************************************************    CPM005
      * Change to capital *    N    *     P    *     C    *     Y    *    CPM005
      ****************************************************************    CPM005
      * Consolidated pool *    N    *     Y    *     Y    *     Y    *    CPM005
      ****************************************************************    CPM005
      *                                                                   CPM005
     C           A1CPTC    IFEQ 'N'                        B3             CPM005
     C                     MOVE 'N'       QSCPTC                          CPM005
     C                     ELSE                            X3             CPM005
     C                     MOVE 'Y'       QSCPTC                          CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
     C***********                                                   57784 53103
     C***IF*DEAL*REVERSED*AND*QSDLNO=0*CHECK*FOR*BOTH*SETTLEMENT****57784 53103
     C***ACCOUNTS*IN*SAME*POOL.*IF*THIS*IS*CASE*OUTPUT*DEAL*NUMBER**57784 53103
     C***********DLRECI    IFEQ 'R'                        B2       57784 53103
     C***********CCY       ANDEQDLPUCY                              57784 53103
     C***********QSDLNO    ANDEQ0                                   57784 53103
     C***********WBRETL    ANDEQ'Y'                                 57784 53103
     C***********WSRETL    ANDEQ'Y'                                 57784 53103
     C***********                                                   57784 53103
     C***DETERMINE*POOL*FOR*BUY*SIDE********************************57784 53103
     C***********          MOVE WBPTFR    TPPTFR                    57784 53103
     C***********TPPOOL    CHAINPMPPTML1             75             57784 53103
     C***********                                                   57784 53103
     C***SAVE*POOL*PORTFOLIO*FOR*SETTLEMENT*OF*BOUGHT*SIDE**********57784 53103
     C***********          MOVE 'N'       WBPOOL  1                 57784 53103
     C************IN75     IFEQ '0'                        B3       57784 53103
     C***********OSRECI    ANDEQ'D'                                 57784 53103
     C***********          MOVE OSPCNU    WBPCNU  60                57784 53103
     C***********          MOVE OSPPTF    WBPPTF  4                 57784 53103
     C***********          MOVE 'Y'       WBPOOL  1                 57784 53103
     C***********          END                             E3       57784 53103
     C***********                                                   57784 53103
     C***DETERMINE*POOL*FOR*SELL*SIDE*******************************57784 53103
     C***********          MOVE WSPTFR    TPPTFR                    57784 53103
     C***********TPPOOL    CHAINPMPPTML1             75             57784 53103
     C***********                                                   57784 53103
     C***IF*BOTH*ACCOUNTS*IN*SAME*POOL*RESET*CPTC*TO*N**************57784 53103
     C************IN75     IFEQ '0'                        B3       57784 53103
     C***********OSRECI    ANDEQ'D'                                 57784 53103
     C***********WBPOOL    ANDEQ'Y'                                 57784 53103
     C***********WBPCNU    ANDEQOSPCNU                              57784 53103
     C***********WBPPTF    ANDEQOSPPTF                              57784 53103
     C***********          MOVE WKOTRF    QSDLNO                    57784 53103
     C***********          END                             E3       57784 53103
     C***********          END                             E2       57784 53103
     C*                                                                   56460
      **  For pool portfolio, set account code and sequence to zero       CPM005
      *                                                                   CPM005
     C           QSREMI    IFEQ 'FX'                                      CPM005
     C**********           MOVEL' 0000 00'WDRK10 10                                    CPM005 CGL029
     C**********           MOVE WDRK10    QSREPS                                       CPM005 CGL029
     C                     MOVEL' 0000000'WDRK16 16                                           CGL029
     C                     MOVE '000 00'  WDRK16                                              CGL029
     C                     MOVE WDRK16    QSREPS                                              CGL029
     C                     MOVELQSCNUM    QSREPS                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     EXSR #BAAE                                     53103
     C                     WRITEPMPCAAP0                                  56460
     C**********           Z-ADDWSCNUM    QSCNUM                                        56460 CSD027
     C                     MOVE WSCNUM    QSCNUM                                              CSD027
     C                     MOVE WXPTFR    QSPTFR                          56460
     C                     MOVE WSCPTC    QSCPTC                          56460
     C                     MOVE WSREPS    QSREPS                          CPM005
     C                     MOVE WSDLNO    QSDLNO                          56460
     C                     Z-ADDWNACOD    QSACOD                          56460
     C                     Z-ADDWNACSQ    QSACSQ                          56460
     C                     MOVE WNBRCA    QSBRCA                          085862
     C**********           Z-ADDWNACCU    QSACCU                                       CPM004 CSD027
     C                     MOVE WNACCU    QSACCU                                              CSD027
     C*                                                                   56460
     C* Add 1 to Count of Performance records written.                    56460
     C*                                                                   56460
     C                     ADD  1         WWPERC                          56460
     C                     END                             E1             56460
     C*
     C* IF PERFORMANCE SUB CATEGORY IS NOT ZERO PERFORMS SR/#BAAC TO
     C**SET*UP*DETAILS*AND*WRITE*SECOND*RECORD*TO*PMPCAAPP*************   S01486
     C* SET UP DETAILS AND WRITE SECOND RECORD TO PMPCAAPD                S01486
     C           A1PFMC    IFNE *BLANKS
     C                     EXSR #BAAC
     C*                                                                   56460
     C** OUTPUT RECORD IF PORTFOLIO HAS PERFORMANCE                       56460
     C           WWPORT    IFEQ 'Y'                                       56460
     C                     EXSR #BAAE                                     53103
     C                     WRITEPMPCAAP0
     C*
     C* Add 1 to Count of Performance records written.
     C*
     C                     ADD  1         WWPERC
     C                     END                                            56460
      *                                                                   CPM005
      **  Write record for "9998" portfolio                               CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B1             CPM005
     C                     MOVELQSPTFR    WXPTFR                          CPM005
     C                     Z-ADDQSMFXR    WXMFXR 308                      CPM005
     C                     MOVE QSCPTC    WXCPTC  1                       CPM005
      *                                                                   CPM005
     C                     MOVELWWCSB1    WWCSBY                          CPM005
     C                     Z-ADDWWBYD1    WWBYDP                          CPM005
     C                     EXSR #BAAA                                     CPM005
      *                                                                   CPM005
      **  Prepare details for output                                      CPM005
      *                                                                   CPM005
     C                     MOVEL'9998'    QSPTFR                          CPM005
     C                     EXSR #BAAE                                     CPM005
     C                     WRITEPMPCAAP0                                  CPM005
     C                     MOVELWXPTFR    QSPTFR                          CPM005
     C                     Z-ADDWXMFXR    QSMFXR                          CPM005
     C                     MOVE WXCPTC    QSCPTC                          CPM005
     C                     ADD  1         WWPERC                          CPM005
     C                     END                             E1             CPM005
      *                                                                   CPM005
      **  Write record for "9999" portfolio                               CPM005
      *                                                                   CPM005
     C           WW9999    IFEQ 'Y'                        B1             CPM005
     C                     MOVELQSPTFR    WXPTFR                          CPM005
     C                     Z-ADDQSMFXR    WXMFXR 308                      CPM005
     C                     MOVE QSCPTC    WXCPTC  1                       CPM005
      *                                                                   CPM005
     C                     MOVELWWCSB1    WWCSBY                          CPM005
     C                     Z-ADDWWBYD1    WWBYDP                          CPM005
     C                     EXSR #BAAA                                     CPM005
      *                                                                   CPM005
      **  Prepare details for output                                      CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    QSPTFR                          CPM005
     C                     EXSR #BAAE                                     CPM005
     C                     WRITEPMPCAAP0                                  CPM005
     C                     MOVELWXPTFR    QSPTFR                          CPM005
     C                     Z-ADDWXMFXR    QSMFXR                          CPM005
     C                     MOVE WXCPTC    QSCPTC                          CPM005
     C                     ADD  1         WWPERC                          CPM005
     C                     END                             E1             CPM005
     C*                                                                   56460
     C** IF POOL HAS PERFORMANCE WRITE RECORD TO CASH ANALYSIS FILE       56460
     C           WWPOOL    IFEQ 'Y'                                       56460
     C**********           Z-ADDQSCNUM    WSCNUM  60                                    56460 CSD027
     C                     MOVE QSCNUM    WSCNUM  6                                           CSD027
     C                     MOVE QSPTFR    WSPTFR  4                       56460
     C**********           Z-ADDQSACOD    WNACOD  40                                    56460 CGL029
     C                     Z-ADDQSACOD    WNACOD 100                                          CGL029
     C                     Z-ADDQSACSQ    WNACSQ  20                      56460
     C                     MOVE QSBRCA    WNBRCA  3                       085862
     C**********           Z-ADDQSACCU    WNACCU                                       CPM004 CSD027
     C**********           Z-ADDOSPCNU    QSCNUM                                        56460 CSD027
     C                     MOVE QSACCU    WNACCU                                              CSD027
     C                     MOVE OSPCNU    QSCNUM                                              CSD027
     C                     MOVE OSPPTF    QSPTFR                          56460
     C                     Z-ADD0         QSACOD                          56460
     C                     Z-ADD0         QSACSQ                          56460
     C                     MOVE *BLANKS   QSBRCA                          085862
     C**********           Z-ADD*ZERO     QSACCU                                       CPM004 CSD027
     C                     MOVE *BLANKS   QSACCU                                              CSD027
     C                     EXSR #BAAE                                     53103
     C                     WRITEPMPCAAP0                                  56460
     C**********           Z-ADDWSCNUM    QSCNUM                                        56460 CSD027
     C                     MOVE WSCNUM    QSCNUM                                              CSD027
     C                     MOVE WSPTFR    QSPTFR                          56460
     C                     Z-ADDWNACOD    QSACOD                          56460
     C                     Z-ADDWNACSQ    QSACSQ                          56460
     C                     MOVE WNBRCA    QSBRCA                          085862
     C**********           Z-ADDWNACCU    QSACCU                                       CPM004 CSD027
     C                     MOVE WNACCU    QSACCU                                              CSD027
     C*                                                                   56460
     C* Add 1 to Count of Performance records written.                    56460
     C*                                                                   56460
     C                     ADD  1         WWPERC                          56460
     C                     END                                            56460
     C                     END
     C*                                                                   49584
     C* IF CUSTOMER ACTING AS FIDUCIARY ADVISER OUTPUT COMMISSION RECORD  49584
     C           WWFICO    IFEQ 'Y'                                       49584
     C                     EXSR #BAAD                                     49584
     C                     MOVE 'N'       WWFICO                          49584
     C                     EXSR #BAAE                                     53103
     C                     WRITEPMPCAAP0                                  49584
     C*                                                                   49584
     C* Add 1 to Count of Performance records written.                    49584
     C*                                                                   49584
     C                     ADD  1         WWPERC                          49584
      *                                                                   CPM005
      **  Write record for "9998" portfolio                               CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B2             CPM005
     C                     MOVELQSPTFR    WXPTFR                          CPM005
     C                     Z-ADDQSMFXR    WXMFXR 308                      CPM005
     C                     MOVE QSCPTC    WXCPTC  1                       CPM005
      *                                                                   CPM005
     C                     MOVELWWCSB1    WWCSBY                          CPM005
     C                     Z-ADDWWBYD1    WWBYDP                          CPM005
     C                     EXSR #BAAA                                     CPM005
      *                                                                   CPM005
      **  Prepare details for output                                      CPM005
      *                                                                   CPM005
     C                     MOVEL'9998'    QSPTFR                          CPM005
     C                     EXSR #BAAE                                     CPM005
     C                     WRITEPMPCAAP0                                  CPM005
     C                     MOVELWXPTFR    QSPTFR                          CPM005
     C                     Z-ADDWXMFXR    QSMFXR                          CPM005
     C                     MOVE WXCPTC    QSCPTC                          CPM005
     C                     ADD  1         WWPERC                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  Write record for "9999" portfolio                               CPM005
      *                                                                   CPM005
     C           WW9999    IFEQ 'Y'                        B2             CPM005
     C                     MOVELQSPTFR    WXPTFR                          CPM005
     C                     Z-ADDQSMFXR    WXMFXR 308                      CPM005
     C                     MOVE QSCPTC    WXCPTC  1                       CPM005
      *                                                                   CPM005
     C                     MOVELWWCSB1    WWCSBY                          CPM005
     C                     Z-ADDWWBYD1    WWBYDP                          CPM005
     C                     EXSR #BAAA                                     CPM005
      *                                                                   CPM005
      **  Prepare details for output                                      CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    QSPTFR                          CPM005
     C                     EXSR #BAAE                                     CPM005
     C                     WRITEPMPCAAP0                                  CPM005
     C                     MOVELWXPTFR    QSPTFR                          CPM005
     C                     Z-ADDWXMFXR    QSMFXR                          CPM005
     C                     MOVE WXCPTC    QSCPTC                          CPM005
     C                     ADD  1         WWPERC                          CPM005
     C                     END                             E2             CPM005
     C*                                                                   53103
     C* IF FIDUCIATY ADVISER AND POOL PERF. EVENT, OUTPUT ANOTHER         53103
     C* COMMISSION RECORD FOR POOL                                        53103
     C*                                                                   53103
     C           WWPOOL    IFEQ 'Y'                                       53103
     C**********           Z-ADDQSCNUM    WSCNUM                                        53103 CSD027
     C                     MOVE QSCNUM    WSCNUM                                              CSD027
     C                     MOVE QSPTFR    WSPTFR                          53103
     C                     Z-ADDQSACOD    WNACOD                          53103
     C                     Z-ADDQSACSQ    WNACSQ                          53103
     C                     MOVE QSBRCA    WNBRCA                          085862
     C**********           Z-ADDQSACCU    WNACCU                                       CPM004 CSD027
     C**********           Z-ADDOSPCNU    QSCNUM                                        53103 CSD027
     C                     MOVE QSACCU    WNACCU                                              CSD027
     C                     MOVE OSPCNU    QSCNUM                                              CSD027
     C                     MOVE OSPPTF    QSPTFR                          53103
     C                     Z-ADD0         QSACOD                          53103
     C                     Z-ADD0         QSACSQ                          53103
     C                     MOVE *BLANKS   QSBRCA                          085862
     C**********           Z-ADD*ZERO     QSACCU                                       CPM004 CSD027
     C                     MOVE *BLANKS   QSACCU                                              CSD027
     C                     EXSR #BAAE                                     53103
     C                     WRITEPMPCAAP0                                  53103
     C**********           Z-ADDWSCNUM    QSCNUM                                        53103 CSD027
     C                     MOVE WSCNUM    QSCNUM                                              CSD027
     C                     MOVE WSPTFR    QSPTFR                          53103
     C                     Z-ADDWNACOD    QSACOD                          53103
     C                     Z-ADDWNACSQ    QSACSQ                          53103
     C                     MOVE WNBRCA    QSBRCA                          085862
     C**********           Z-ADDWNACCU    QSACCU                                       CPM004 CSD027
     C                     MOVE WNACCU    QSACCU                                              CSD027
     C                     ADD  1         WWPERC                          53103
     C                     ENDIF                                          53103
     C*                                                                   53103
     C                     END                                            49584
     C*                                                                   53103
     C*  PRODUCE REALISED P&L RECORD(S)                                   53103
     C*                                                                   53103
     C           QSREMI    IFEQ 'FX'                                      53103
     C***********QSCPTC    ANDEQ'N'                                 53103 CPM005
     C           FCPORS    ANDNE'B'                                       CPM004
     C*                                                                   53103
     C*    - Save details of prev. record                                 53103
     C                     Z-ADDQSCSHD    WWCSHD  50                      53103
     C                     Z-ADDQSTRAT    WWTRAT  50                      53103
     C                     Z-ADDQSDLNO    WWDLNO  60                      53103
     C                     MOVE QSFXAT    WWFXAT  1                       53103
     C**********           MOVE QSREPS    WWREPS 20                                     53103 CGL029
     C                     MOVE QSREPS    WWREPS 26                                           CGL029
     C                     MOVE QSCCY     WWCCY   3                       53103
     C                     MOVE QSCSHA    WWCSHA 130                      53103
     C                     MOVE QSMFXR    WWMFXR 308                      53103
     C                     MOVE QSCPTC    WWCPTC  1                       CPM005
     C*********************MOVE QSBRCA    WWBRCA  3                085862 CPM004
     C*                                                                   53103
     C*    - Try to find other side, if found, write P&L record(s)        53103
     C           WWINIO    IFEQ 'I'                                       53103
     C                     MOVE 'O'       QSINIO                          53103
     C                     ELSE                                           53103
     C                     MOVE 'I'       QSINIO                          53103
     C                     ENDIF                                          53103
     C*                                                                   53103
     C           KAAL2     CHAINPMPCAAL2             80                   53103
     C           *IN80     IFEQ *OFF                                      53103
     C*                                                                   53103
     C**********Access SDDTSTPD for instrument type                 53103 081378
     C*      -- Access FDDTSTL1 for instrument type                       081378
     C                     MOVELOTTP      WWDTYP                          53103
     C                     MOVELOTST      WWDSTY                          53103
     C***********KSTPP     CHAINSDDTSTPD             81             53103 081378
     C           KSTPP     CHAINFDDTSTL1             81                   081378
     C*                                                                   53103
     C           *IN81     IFEQ *ON                                       53103
     C           *LOCK     IN   LDA                                       53103
     C                     Z-ADD6         DBASE                           53103
     C                     MOVE *BLANKS   DBFILE           ***************53103
     C************         MOVE 'SDDTSTPD'DBFILE           * DB06 *53103  081378
     C                     MOVE 'FDDTSTPD'DBFILE           * DBERROR 006 *081378
     C                     MOVELWWDTYP    DBKEY            ***************53103
     C                     MOVE WWDSTY    DBKEY                           53103
     C                     OUT  LDA                                       53103
     C                     EXSR *PSSR                                     53103
     C                     ENDIF                                          53103
     C*                                                                   53103
     C*      -- Calculate In and Out Amounts                              53103
     C*                                                                   53103
     C*        --- Set common fields (incl. base ccy decimal places)      53103
     C                     MOVE 'M'       ZCRSMD                          53103
     C                     CALL 'AOCURRR0'                                53103
     C                     PARM *BLANKS   P@RTCD                          53103
     C                     PARM '*KEY   ' P@OPTN                          53103
     C***********          PARM WWCSBY    P@CCY   3                 53103 CPM005
     C                     PARM WYCSBY    P@CCY   3                       CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           53103
     C*                                                                   53103
     C           P@RTCD    IFNE *BLANKS                                   53103
     C           *LOCK     IN   LDA                                       53103
     C                     Z-ADD10        DBASE                           53103
     C                     MOVE *BLANKS   DBFILE           ***************53103
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR 010 *53103
     C                     MOVE WWCSBY    DBKEY            ***************53103
     C                     OUT  LDA                                       53103
     C                     EXSR *PSSR                                     53103
     C                     END                                            53103
     C                     Z-ADDA6NBDP    ZCDPT                           53103
     C*                                                                   53103
     C*        --- Calculate first Amount equivalent in base ccy          53103
     C*                                                                   53103
     C                     CALL 'AOCURRR0'                                53103
     C                     PARM *BLANKS   P@RTCD                          53103
     C                     PARM '*KEY   ' P@OPTN                          53103
     C                     PARM WWCCY     P@CCY   3                       53103
     C           SDCURR    PARM SDCURR    DSSDY                           53103
     C*                                                                   53103
     C           P@RTCD    IFNE *BLANKS                                   53103
     C           *LOCK     IN   LDA                                       53103
     C                     Z-ADD12        DBASE                           53103
     C                     MOVE *BLANKS   DBFILE           ***************53103
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR 012 *53103
     C                     MOVE WWCCY     DBKEY            ***************53103
     C                     OUT  LDA                                       53103
     C                     EXSR *PSSR                                     53103
     C                     END                                            53103
     C                     Z-ADDA6NBDP    ZCDPF                           53103
     C*                                                                   53103
     C                     Z-ADDWWCSHA    ZAMTF                           53103
     C                     Z-ADDWWMFXR    ZCRSRD                          53103
     C                     EXSR ZCCYXD                                    53103
     C*                                                                   53103
     C           WWINIO    IFEQ 'I'                                       53103
     C                     Z-ADDZAMTT     WWINAM 150                      53103
     C                     ELSE                                           53103
     C                     Z-ADDZAMTT     WWOUAM 150                      53103
     C                     END                                            53103
     C*                                                                   53103
     C*        --- Calculate second Amount equivalent in base ccy         53103
     C                     CALL 'AOCURRR0'                                53103
     C                     PARM *BLANKS   P@RTCD                          53103
     C                     PARM '*KEY   ' P@OPTN                          53103
     C                     PARM QSCCY     P@CCY   3                       53103
     C           SDCURR    PARM SDCURR    DSSDY                           53103
     C*                                                                   53103
     C           P@RTCD    IFNE *BLANKS                                   53103
     C           *LOCK     IN   LDA                                       53103
     C                     Z-ADD13        DBASE                           53103
     C                     MOVE *BLANKS   DBFILE           ***************53103
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR 013 *53103
     C                     MOVE QSCCY     DBKEY            ***************53103
     C                     OUT  LDA                                       53103
     C                     EXSR *PSSR                                     53103
     C                     END                                            53103
     C                     Z-ADDA6NBDP    ZCDPF                           53103
     C*                                                                   53103
     C                     Z-ADDQSCSHA    ZAMTF                           53103
     C                     Z-ADDQSMFXR    ZCRSRD                          53103
     C                     EXSR ZCCYXD                                    53103
     C*                                                                   53103
     C           QSINIO    IFEQ 'I'                                       53103
     C                     Z-ADDZAMTT     WWINAM 150                      53103
     C                     ELSE                                           53103
     C                     Z-ADDZAMTT     WWOUAM 150                      53103
     C                     END                                            53103
     C*                                                                   53103
     C*      -- Calculate In - Out Amount                                 53103
     C                     Z-ADDQSCSHA    WYCSHA 150                      CPM005
     C           WWINAM    SUB  WWOUAM    QSCSHA                          53103
      *                                                                   CPM005
      **  If performance required for either 9998 or 9999 portfolio       CPM005
      **  calculate FX P/L in customer base currency                      CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B3             CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
      *                                                                   CPM005
      **  If currency of 9998 / 9999 portfolio different to portfolio     CPM005
      **  currency convert amounts to 9998 / 9999 currency                CPM005
      *                                                                   CPM005
     C           WYCSBY    IFNE WWCSB1                     B4             CPM005
      *                                                                   CPM005
      **  Convert currency of first settlement posting to base currency   CPM005
      *                                                                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM WWCCY     P@CCY                           CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                    B5             CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD10        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR 010 *CPM005
     C                     MOVELWWCCY     DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E5             CPM005
      *                                                                   CPM005
     C                     Z-ADDWWCSHA    ZAMTF                           CPM005
     C                     Z-ADDA6NBDP    ZCDPF                           CPM005
     C                     Z-ADDA6SPRT    ZRATEF                          CPM005
     C                     MOVE A6MDIN    ZMDINF                          CPM005
     C                     MOVE WWCCY     ZCCYF                           CPM005
      *                                                                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM WWCSB1    P@CCY                           CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                    B5             CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD10        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR 010 *CPM005
     C                     MOVELWWCSB1    DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E5             CPM005
      *                                                                   CPM005
     C                     Z-ADDA6NBDP    ZCDPT                           CPM005
     C                     Z-ADDA6SPRT    ZRATET                          CPM005
     C                     MOVE A6MDIN    ZMDINT                          CPM005
     C                     MOVE WWCSB1    ZCCYT                           CPM005
     C                     EXSR ZCCYCD                                    CPM005
      *                                                                   CPM005
     C           WWINIO    IFEQ 'I'                        B5             CPM005
     C                     Z-ADDZAMTT     WWINAB 150                      CPM005
     C                     ELSE                            X5             CPM005
     C                     Z-ADDZAMTT     WWOUAB 150                      CPM005
     C                     END                             E5             CPM005
      *                                                                   CPM005
      **  Convert currency of second sett posting to base currency        CPM005
      *                                                                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM QSCCY     P@CCY                           CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                    B5             CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD10        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR 010 *CPM005
     C                     MOVELQSCCY     DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E5             CPM005
      *                                                                   CPM005
     C                     Z-ADDWYCSHA    ZAMTF                           CPM005
     C                     Z-ADDA6NBDP    ZCDPF                           CPM005
     C                     Z-ADDA6SPRT    ZRATEF                          CPM005
     C                     MOVE A6MDIN    ZMDINF                          CPM005
     C                     MOVE QSCCY     ZCCYF                           CPM005
      *                                                                   CPM005
     C                     EXSR ZCCYCD                                    CPM005
      *                                                                   CPM005
     C           QSINIO    IFEQ 'I'                        B5             CPM005
     C                     Z-ADDZAMTT     WWINAB 150                      CPM005
     C                     ELSE                            X5             CPM005
     C                     Z-ADDZAMTT     WWOUAB 150                      CPM005
     C                     END                             E5             CPM005
      *                                                                   CPM005
      **     -- Calculate In - Out Amount                                 CPM005
      *                                                                   CPM005
     C           WWINAB    SUB  WWOUAB    WW999A 150                      CPM005
      *                                                                   CPM005
      **  Otherwise if customer and portfolio currency are the same set   CPM005
      **  to the amount calculated for the portfolio                      CPM005
      *                                                                   CPM005
     C                     ELSE                            X4             CPM005
     C                     Z-ADDQSCSHA    WW999A                          CPM005
     C                     END                             E4             CPM005
      *                                                                   CPM005
     C                     END                             E3             CPM005
     C*                                                                   53103
     C*      -- Prepare record contents                                   53103
     C************         MOVE P7INNR    QSINNR                  53103   081378
     C                     MOVE INNR      QSINNR                          081378
     C**********           MOVE WWCSBY    QSCCY                     53103 CPM005
     C                     MOVE WYCSBY    QSCCY                           CPM005
     C                     MOVE 'XT'      QSPFMC                          53103
     C                     MOVE *BLANKS   QSPFMS                          53103
     C           WWCSHD    IFGT QSCSHD                                    53103
     C                     Z-ADDWWCSHD    QSCSHD                          53103
     C                     ENDIF                                          53103
     C                     MOVE C#15      QSMFXR                          53103
     C                     MOVE 'O'       QSINIO                          53103
     C                     Z-ADD0         QSACOD                          53103
     C                     Z-ADD0         QSACSQ                          53103
     C                     MOVE *BLANKS   QSBRCA                          085862
     C**********           Z-ADD*ZERO     QSACCU                                       CPM004 CSD027
     C                     MOVE *BLANKS   QSACCU                                              CSD027
     C                     MOVE 'N'       QSCPTC                          53103
     C                     MOVE 'N'       QSAPRA                          53103
     C                     Z-ADDWWTRAT    QSTRAT                          53103
     C                     Z-ADDWWDLNO    QSDLNO                          53103
     C                     MOVE WWFXAT    QSFXAT                          53103
     C           WWINIO    IFEQ 'O'                                       53103
     C                     MOVE WWREPS    QSREPS                          53103
     C                     ENDIF                                          53103
     C                     MOVE 'RE'      QSREMI                          53103
     C*                                                                   53103
     C*      -- Portfolio performance record                              53103
     C           WWPORT    IFEQ 'Y'                                       53103
     C           WWCPTC    ANDEQ'N'                                       CPM005
     C                     EXSR #BAAE                                     53103
     C                     WRITEPMPCAAP0                                  53103
     C                     ADD  1         WWPERC                          53103
     C                     ENDIF                                          53103
      *                                                                   CPM005
      **  Save port reference, currency and amount for later restore      CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                                       CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
     C                     MOVE QSCPTC    WXCPTC  1                       CPM005
     C                     MOVE QSCCY     WXCCY   3                       CPM005
     C                     MOVE QSPTFR    WXPTFR  4                       CPM005
     C                     Z-ADDQSCSHA    WXCSHA 150                      CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  Record for '9998' portfolio                                     CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                                       CPM005
      *                                                                   CPM005
     C           WBCNUN    IFEQ WSCNUN                                    CPM005
     C           WBPTFR    ANDNE'9997'                                    CPM005
     C           WSPTFR    ANDNE'9997'                                    CPM005
     C                     MOVE 'N'       QSCPTC                          CPM005
     C                     MOVE WWCSB1    QSCCY                           CPM005
     C                     MOVE '9998'    QSPTFR                          CPM005
     C                     Z-ADDWW999A    QSCSHA                          CPM005
     C                     EXSR #BAAE                                     CPM005
     C                     WRITEPMPCAAP0                                  CPM005
     C                     ADD  1         WWPERC                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  Record for '9999' portfolio                                     CPM005
      *                                                                   CPM005
     C           WW9999    IFEQ 'Y'                                       CPM005
      *                                                                   CPM005
     C           WBCNUN    IFEQ WSCNUN                                    CPM005
     C                     MOVE 'N'       QSCPTC                          CPM005
     C                     MOVE WWCSB1    QSCCY                           CPM005
     C                     MOVE '9999'    QSPTFR                          CPM005
     C                     Z-ADDWW999A    QSCSHA                          CPM005
     C                     EXSR #BAAE                                     CPM005
     C                     WRITEPMPCAAP0                                  CPM005
     C                     ADD  1         WWPERC                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  Restore saved fields                                            CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                                       CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
     C                     MOVE WXCPTC    QSCPTC  1                       CPM005
     C                     MOVE WXCCY     QSCCY   3                       CPM005
     C                     MOVE WXPTFR    QSPTFR  4                       CPM005
     C                     Z-ADDWXCSHA    QSCSHA                          CPM005
     C                     END                                            CPM005
     C*                                                                   53103
     C*      -- Pool  performance record                                  53103
     C           WWPOOL    IFEQ 'Y'                                       53103
     C**********           Z-ADDQSCNUM    WSCNUM                                        53103 CSD027
     C                     MOVE QSCNUM    WSCNUM                                              CSD027
     C                     MOVE QSPTFR    WSPTFR                          53103
     C**********           MOVE QSREPS    WSREPS 20                                    CPM005 CGL029
     C                     MOVE QSREPS    WSREPS 26                                           CGL029
     C**********           Z-ADDOSPCNU    QSCNUM                                        53103 CSD027
     C                     MOVE OSPCNU    QSCNUM                                              CSD027
     C                     MOVE OSPPTF    QSPTFR                          53103
      *                                                                   CPM005
      **  For pool portfolio set account code and sequence to zero        CPM005
      *                                                                   CPM005
     C**********           MOVEL' 0000 00'WDRK10 10                                    CPM005 CGL029
     C**********           MOVE WDRK10    QSREPS                                       CPM005 CGL029
     C                     MOVEL' 0000000'WDRK16 16                                           CGL029
     C                     MOVE '000 00'  WDRK16                                              CGL029
     C                     MOVE WDRK16    QSREPS                                              CGL029
     C                     MOVELQSCNUM    QSREPS                          CPM005
      *                                                                   CPM005
     C                     EXSR #BAAE                                     53103
     C                     WRITEPMPCAAP0                                  53103
     C**********           Z-ADDWSCNUM    QSCNUM                                        53103 CSD027
     C                     MOVE WSCNUM    QSCNUM                                              CSD027
     C                     MOVE WSPTFR    QSPTFR                          53103
     C                     MOVE WSREPS    QSREPS                          CPM005
     C                     ADD  1         WWPERC                          53103
     C                     ENDIF                                          53103
     C*      --                                                           53103
     C                     ENDIF                                          53103
     C*   -                                                               53103
     C                     ENDIF                                          53103
     C*                                                                   53103
     C                     END                                            093914
     C*
     C           #BAA1     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BAAA    - DETERMINE FX RATES TO BE OUTPUT                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #SPOT    - OBTAIN FX RATE APPLYING ON DATE IN PAST               *
      * ZCCYCN   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BAA     - CONTROL SETTING UP OF DETAILS TO BE OUTPUT            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCSBY   -                                                       *
      * WWDATP   -                                                       *
      * WWCCYP   -                                                       *
      * WWSPOT   -                                                       *
      * WWMDIN   -                                                       *
      * WWDANB   -                                                       *
      * WWBYDP   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BAAA     BEGSR
     C*                                                                   46922
     C** CHECK WHETHER POSTING DUE TO BATCH INPUT (LAST 6 CHARACTERS NUMER46922
     C                     MOVE SPOS      WWSPOS  6                       46922
     C                     TESTN          WWSPOS     61                   46922
     C/COPY WNCPYSRC,PMH00006
     C*                                                                   46922
     C** IF POSTING ENTERED BY BATCH INPUT TO CORRECT INCORRECT MIDAS     46922
     C** POSTING (VALUE DATE BEFORE RUN DATE) USE FX RATES ON VALUE DAET  46922
     C           *IN61     IFEQ '1'                        B1             46922
     C           VALD      ANDLTBJRDNB                                    46922
     C*                                                                   46922
     C** PERFORM SR/#BAAAA TO OBTAIN SPOT RATES FOR NOMINAL CURRENCY      46922
     C                     Z-ADD1         ZAMTF                           46922
     C                     Z-ADDVALD      WWPDAT                          46922
     C                     MOVE CCY       WWCCYH                          46922
     C                     EXSR #BAAAA                                    46922
     C                     MOVE CCY       ZCCYF                           46922
     C                     Z-ADDWWSPOT    ZRATEF                          46922
     C                     MOVELWWMDIN    ZMDINF                          46922
     C                     Z-ADDQ8CDP     ZCDPF                           46922
     C*                                                                   46922
     C** Perform S/R #P09 for Customer Base Currency                      46922
     C                     MOVELWWCSBY    WWCCYH                          46922
     C                     EXSR #BAAAA                                    46922
     C                     MOVE WWCSBY    ZCCYT                           46922
     C                     Z-ADDWWSPOT    ZRATET                          46922
     C                     MOVELWWMDIN    ZMDINT                          46922
     C                     Z-ADDQ8CDP     ZCDPT                           46922
     C*                                                                   46922
     C** Obtain Cross FX Rate                                             46922
     C****                 EXSR ZCCYCN                              46922 50406
     C                     EXSR ZCCYCD                                    50406
     C           ZCRSMD    IFEQ 'M'                        B2             46922
     C****                 Z-ADDZCRSRT    QSMFXR                    50406 46922
     C                     Z-ADDZCRSRN    QSMFXR                    50406 46922
     C                     ELSE                            X2             46922
     C           1         DIV  ZCRSRT    QSMFXR                          46922
     C                     END                             E2             46922
     C*                                                                   46922
     C** OTHERWISE CALCULATE FX RATES USING SPOT RATES                    46922
     C                     ELSE                            X1             46922
     C*
     C* SET UP FROM CURRENCY DETAILS
     C                     Z-ADD*ZEROS    ZAMTF
     C                     MOVE CCY       ZCCYF
     C*
     C** OBTAIN CURRENCY DETAILS FROM SDCURRP
     C***********CCY       CHAINSDCURRL0             70                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C                     PARM CCY       P@CCY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*
     C* If Record not found - Database Error.
     C*
     C************IN70     IFEQ '1'                                       S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD3         DBASE
     C                     MOVE *BLANKS   DBFILE           ***************
     C***********          MOVEL'SDCURRL0'DBFILE           * DBERROR 003 *S01486
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR 003 *S01486
     C                     MOVE CCY       DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVE A6MDIN    ZMDINF
     C                     Z-ADDA6NBDP    ZCDPF
     C*
     C* SET UP TO CURRENCY DETAILS
     C                     Z-ADD*ZEROS    ZAMTF
     C                     MOVE WWCSBY    ZCCYT
     C*
     C** OBTAIN CURRENCY DETAILS FROM SDCURRP
     C***********WWCSBY    CHAINSDCURRL0             70                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C                     PARM WWCSBY    P@CCY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*
     C* If Record not found - Database Error.
     C*
     C************IN70     IFEQ '1'                                       S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD4         DBASE
     C                     MOVE *BLANKS   DBFILE           ***************
     C***********          MOVEL'SDCURRL0'DBFILE           * DBERROR 003 *S01486
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR 003 *S01486
     C                     MOVE WWCSBY    DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C                     Z-ADDA6SPRT    ZRATET
     C                     MOVE A6MDIN    ZMDINT
     C                     Z-ADDA6NBDP    ZCDPT
     C*
     C* Calculate the Cross Rate.
     C*
     C****                 EXSR ZCCYCN                                    50406
     C                     EXSR ZCCYCD                                    50406
     C*
     C* If the Multiply /Divide indicator is 'M' set Exchange Rate
     C* equal to the Cross Exchange Rate.
     C*
     C           ZCRSMD    IFEQ 'M'
     C****                 Z-ADDZCRSRT    QSMFXR                          50406
     C                     Z-ADDZCRSRN    QSMFXR                          50406
     C                     ELSE
     C*
     C           ZCRSRT    IFEQ *ZEROS
     C                     Z-ADD0         QSMFXR
     C                     ELSE
     C*
     C* Else set Exchange Rate equal to 1 divided by the Cross Exchange
     C* Rate.
     C*
     C           1         DIV  ZCRSRT    QSMFXR
     C                     END
     C                     END
     C                     END                             E1             46922
     C*
     C                     ENDSR
     C********************************************************************46922
      /EJECT                                                              46922
     C********************************************************************46922
     C**                                                                  46922
     C**   #BAAAA    - DETERMINE SPOT RATE IN PAST                        46922
     C**                                                                  46922
     C**   CALLED BY -                                                    46922
     C**                                                                  46922
     C**   CALLS     -                                                    46922
     C**                                                                  46922
     C*===================================================================46922
     C*                                                                   46922
     C           #BAAAA    BEGSR                           * #BAAAA BEGSR 46922
     C**                                                                  46922
     C***********PMHSEX    SETGTPMHSEXPP                           46922  S01486
     C           PMHSEX    SETGTPMHSEXPD                                  S01486
     C**                                                                  46922
     C** READ PREVIOUS ON PF/PMHSEXPP                                     46922
     C**                                                                  46922
     C***********          READPPMHSEXPP                 75         46922 S01486
     C                     READPPMHSEXPD                 75               S01486
     C**                                                                  46922
     C           *IN75     IFEQ '0'                                       46922
     C           WWCCYH    ANDEQQ8CCY                                     46922
     C**                                                                  46922
     C***SET*SPOT*RATE*EQUAL*TO*SPOT*RATE*FROM*PF/PMHSEXPP********* 46922 S01486
     C***&*MUL/DIV*INDICATOR*EQUAL*TO*MULT/DIV*INDICATOR*FROM*PF/PM 46922 S01486
     C** SET SPOT RATE EQUAL TO SPOT RATE FROM PF/PMHSEXPD                S01486
     C** & MUL/DIV INDICATOR EQUAL TO MULT/DIV INDICATOR FROM PF/PMHSEXPD S01486
     C**                                                                  46922
     C                     Z-ADDQ8SPOT    WWSPOT 138                      46922
     C                     MOVE Q8MDV1    WWMDIN  1                       46922
     C                     Z-ADDQ8CDP     WWCDP   10                      46922
     C**                                                                  46922
     C** OTHERWISE IF RECORD NOT FOUND GET NEXT AVAILABLE RATE            46922
     C**                                                                  46922
     C                     ELSE                                           46922
     C***********PMHSEX    SETLLPMHSEXPP                            46922 S01486
     C           PMHSEX    SETLLPMHSEXPD                                  S01486
     C**                                                                  46922
     C***READ*FROM*PF/PMHSEXPP************************************* 46922 S01486
     C** READ FROM PF/PMHSEXPD                                            S01486
     C**                                                                  46922
     C***********          READ PMHSEXPP                 75         46922 S01486
     C                     READ PMHSEXPD                 75               S01486
     C**                                                                  46922
     C           *IN75     IFEQ '0'                                       46922
     C           WWCCYH    ANDEQQ8CCY                                     46922
     C**                                                                  46922
     C***SET*SPOT*RATE*EQUAL*TO*SPOT*RATE*FROM*PF/PMHSEXPP********* 46922 S01486
     C***&*MUL/DIV*INDICATOR*EQUAL*TO*MULT/DIV*INDICATOR*FROM*PF/PM 46922 S01486
     C** SET SPOT RATE EQUAL TO SPOT RATE FROM PF/PMHSEXPD                S01486
     C** & MUL/DIV INDICATOR EQUAL TO MULT/DIV INDICATOR FROM PF/PMHSEXPD S01486
     C**                                                                  46922
     C                     Z-ADDQ8SPOT    WWSPOT                          46922
     C                     MOVE Q8MDV1    WWMDIN                          46922
     C                     Z-ADDQ8CDP     WWCDP   10                      46922
     C**                                                                  46922
     C** OTHERWISE IF RECORD NOT FOUND ACCESS SDCURRL0                    46922
     C**                                                                  46922
     C                     ELSE                                           46922
     C**                                                                  46922
     C***********WWCCYH    CHAINSDCURRL0             76             46922 S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C                     PARM WWCCYH    P@CCY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**                                                                  46922
     C************IN76     IFEQ '1'                        *********46922 S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD11        DBASE            **DB ERROR 11**46922
     C***********          MOVEL'SDCURRL0'DBFILE           *********46922 S01486
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01486
     C                     MOVELWWCCYH    DBKEY                           46922
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     46922
     C                     END                                            46922
     C**                                                                  46922
     C** SET SPOT RATE EQUAL TO SPOT RATE FROM SDCURRL0                   46922
     C** AND MULT/DIV INDICATOR EQUAL TO MULT/DIV                         46922
     C** INDICATOR FROM SDCURRL0                                          46922
     C**                                                                  46922
     C                     Z-ADDA6SPRT    WWSPOT                          46922
     C                     MOVELA6MDIN    WWMDIN                          46922
     C                     Z-ADDA6NBDP    WWCDP   10                      46922
     C**                                                                  46922
     C                     END                                            46922
     C**                                                                  46922
     C                     END                                            46922
     C                     ENDSR                           * #P09 ENDSR * 46922
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BAAB    - SET UP DETAILS TO BE OUTPUT                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #BAABA   - SET UP RELATED REFERENCE AND MODULE ID                *53103
      * *PSSR    - PROCESS PROGRAM ERROR                                 *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BAA     - CONTROL SETTING UP OF DETAILS TO BE OUTPUT            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWRTTY   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BAAB     BEGSR
     C*
     C* Move values to File Fields.
     C*
     C*********************MOVE CNUM      QSCNUM                          CPM004
     C                     MOVE CUST      QSCNUM                          CPM004
     C                     MOVE PTFR      QSPTFR
     C*
     C                     MOVE A5INNR    QSINNR
     C                     MOVE CCY       QSCCY
     C*
     C****                 Z-ADDWWECD     QSCSHD                          46910
     C                     Z-ADDBJRDNB    QSCSHD                          46910
     C                     MOVE *BLANKS   QSFXAT                          53103
     C*
     C                     MOVE PSTA      QSCSHA
     C                     MOVE ACOD      QSACOD
     C                     MOVE ACSQ      QSACSQ
     C                     MOVE BRCA      QSBRCA                          085862
     C**********           Z-ADDCNUM      QSACCU                                       CPM004 CSD027
     C                     MOVE CNUM      QSACCU                                              CSD027
     C                     MOVE 'Y'       CONTIN  1                       093914
     C*
     C** ACCESS TRANSACTION TYPE DETAILS TO DETERMINE WHETHER
     C** POSTING REPRESENTS CHANGE TO PORTFOLIO CAPITAL
     C                     MOVE SPOS      WWSPOS  6                       CPM004
     C                     TESTN          WWSPOS     61                   CPM004
     C/COPY WNCPYSRC,PMH00007
     C           *IN61     IFEQ '0'                                       CPM004
     C           ATYP      OREQ 'R'                                       CPM004
     C                     MOVE TRAT      WWRTTY  5
     C                     ELSE                                           CPM004
     C                     MOVELOTTP      WWRTTY                          CPM004
     C                     END                                            CPM004
     C                     MOVE 'Y'       A1CPTC                          CPM004
     C           WWRTTY    IFNE '00000'                                   CPM004
     C           WWRTTY    ANDNE'     '                                   CPM004
     C***********WWRTTY    CHAINSDRETRL0             72                   S01486
     C                     CALL 'AORETRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C                     PARM WWRTTY    P@RTTY  5                       S01486
     C           SDRETR    PARM SDRETR    DSFDY                           S01486
     C*
     C************IN72     IFEQ '1'                                       S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD7         DBASE
     C                     MOVE *BLANKS   DBFILE           ***************
     C***********          MOVEL'SDRETRL0'DBFILE           * DBERROR 007 *S01486
     C                     MOVE 'SDRETRPD'DBFILE           * DBERROR 007 *S01486
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C                     END                                            CPM004
     C*
     C                     MOVE A1CPTC    QSCPTC
     C                     MOVE ' N'      QSPFMC
     C                     MOVE *BLANKS   QSPFMS
     C*
     C                     Z-ADDTRAT      QSTRAT
     C*                                                                   46386
     C                     Z-ADD0         QSDLNO                          46386
     C*                                                                   49584
     C                     MOVE 'N'       WWFICO  1                       49584
     C*                                                                   46386
     C** CHECK WHETHER TRANSACTION SETTLED IN DIFFERENT PORTFOLIO TO      46386
     C** ACCOUNT FOR POSTINGS GENERATED FROM MODULES FI, LE, SE AND DL    46386
     C           SPOS      IFEQ '  GE-FI'                  B1             46386
     C           SPOS      OREQ '  GE-LE'                                 46386
     C           SPOS      OREQ '  GE-ST'                                 46386
     C           SPOS      OREQ '  GE-DL'                                 46386
     C           SPOS      OREQ '  GE-FF'                                 075998
     C           BGFUOP    ANDEQ'Y'                                       075998
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C                     MOVE 'N'       QSCPTC                          46386
     C*
     C***IF*POSTING*GENERATED*FROM*FI*MODULE*OBTAIN*FI*DEPOSIT*DETAI46386 S01486
     C***FROM*LF/FIDEPOL0*******************************************46386 S01486
     C***********SPOS      IFEQ '  GE-FI'                  B2       46386 S01486
     C***********          MOVELOTRF      WWDENR  60                46386 S01486
     C***********                                                   46386 S01486
     C***********WWDENR    CHAINFIDEPOL0             72             46386 S01486
     C***********                                                   46580 S01486
     C***IF*DEPOSIT*NOT*FOUND*ACCESS*FILE*OF*REVERSALS**************46580 S01486
     C************IN72     IFEQ '1'                        B3       46580 S01486
     C***********WWDENR    CHAINRFIDEPO              72             46580 S01486
     C***********                                                   46386 S01486
     C************IN72     IFEQ '1'                        B3       46386 S01486
     C***********          Z-ADD8         DBASE                     46386 S01486
     C***********          MOVE *BLANKS   DBFILE           *********46386 S01486
     C***********          MOVEL'FIDEPOL0'DBFILE     * DBERROR 007 *46386 S01486
     C***********          MOVE WWDENR    DBKEY            *********46386 S01486
     C***********          EXSR *PSSR                               46386 S01486
     C***********          END                             E3       46386 S01486
     C***********          END                             E3       46580 S01486
     C***********                                                   46386 S01486
     C***********PTFR      IFNE FDPTFR                     B3       46386 S01486
     C***********CNUM      ANDEQFDCNUM                              50138 S01486
     C***********          MOVE 'Y'       QSCPTC                    46386 S01486
     C***********          END                             E3       46386 S01486
     C***********                                                   56460 S01486
     C***********          Z-ADDFDCNUM    TPCNUM  60                56460 S01486
     C***********          MOVE FDPTFR    TPPTFR  4                 56460 S01486
     C***********                                                   49584 S01486
     C***CUSTOMER*NUMBER*MAY*ONLY*BE*DIFFERENT*IF*CUSTOMER*ACTING*AS49584 S01486
     C***FIDUCIARY*ADVISER*TO*ANOTHER*CUSTOMER**********************49584 S01486
     C***********                                                   49584 S01486
     C***********CNUM      IFNE FDCNUM                     B3       49584 S01486
     C***********          MOVE 'Y'       WWFICO                     49584085862
     C***********          END                             E3       49584 S01486
     C***********          END                             E2       46386 S01486
     C*                                                                   46386
     C** IF POSTING GENERATED FROM LE MODULE OBTAIN LE DETAILS            46386
     C           SPOS      IFEQ '  GE-LE'                  B2             46386
     C                     MOVELOTRF      WWLNR1  6                       46386
     C**********           MOVELOTRF      WWLNRN  60                                    46580 CLE148
     C                     MOVELWWLNR1    WWLNRF  7                       46386
     C                     MOVE 'A'       WWLNRF                          46386
     C*                                                                   46386
     C           WWLNRF    CHAINCLOAN                72                   46386
     C*                                                                   46386
     C** LOAN DETAILS NOT FOUND ON LF/CLOAN OBTAIN DETAILS FROM MLOAN     46386
     C           *IN72     IFEQ '1'                        B3             46386
     C           WWLNRF    CHAINMLOAN                72                   46386
     C*                                                                   46580
     C** LOAN DETAILS STILL NOT FOUND ACCESS REVERSED LOANS FILE          46580
     C           *IN72     IFEQ '1'                        B4             46580
     C***********WWLNRN    CHAINRLOAN                72             46580 S01486
     C********** WWLNRN    CHAINPMLOANPD             72                                S01486 CLE148
     C           WWLNR1    CHAINPMLOANPD             72                                       CLE148
     C*                                                                   46386
     C** Could also be a facility fee so check the facility file          093914
     C*                                                                   093914
     C           *IN72     IFEQ '1'                                       093914
     C           FACKEY    KLIST                                          093914
     C                     KFLD           CNUM                            093914
     C                     KFLD           KFACT                           093914
     C                     KFLD           KFCNO                           093914
     C           FACKEY    CHAINFCLTY                72                   093914
     C           *IN72     IFEQ '0'                                       093914
     C*                                                                   093914
     C** If a facility set on flag to stop processing this record         093914
     C*                                                                   093914
     C                     MOVE 'N'       CONTIN                          093914
     C                     END                                            093914
     C*                                                                   093914
     C           *IN72     IFEQ '1'                        B4             46386
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD9         DBASE                           46386
     C                     MOVE *BLANKS   DBFILE           ***************46386
     C***********          MOVEL'CLOAN   'DBFILE     * DBERROR 007 *46386 S01486
     C                     MOVE 'CLOAN   'DBFILE           * DBERROR 007 *S01486
     C                     MOVE WWLNRF    DBKEY            ***************46386
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     46386
     C                     END                             E4             46386
     C                     END                                            093914
     C                     END                             E4             46580
     C                     END                             E3             46386
     C*                                                                   46386
     C           PTFR      IFNE LEPTFR                     B3             46386
     C                     MOVE 'Y'       QSCPTC                          46386
     C                     END                             E3             46386
     C*                                                                   56460
     C                     MOVE LEPTFR    TPPTFR                          56460
     C                     END                             E2             46386
     C*                                                                   075998
     C** IF POSTING GENERATED FROM FF MODULE OBTAIN TRANSACTION DETAILS   075998
     C** FROM LF/TRANS2                                                   075998
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           SPOS      IFEQ '  GE-FF'                  B2             075998
     C           BGFUOP    ANDEQ'Y'                                       075998
     C           FCPORS    ANDNE'B'                                       CPM003
     C                     MOVELOTRF      WWDENR  60                      075998
     C*                                                                   075998
     C           WWDENR    CHAINTRANS2               72                   075998
     C*                                                                   075998
     C** IF TRANSACTION NOT FOUND TERMINATE WITH DATABASE ERROR           075998
     C           *IN72     IFEQ '1'                        B3             075998
     C           *LOCK     IN   LDA                                       075998
     C                     Z-ADD82        DBASE                           075998
     C                     MOVE *BLANKS   DBFILE           ***************075998
     C                     MOVE 'TRANS2  'DBFILE           * DBERROR 082 *075998
     C                     MOVE WWDENR    DBKEY            ***************075998
     C                     OUT  LDA                                       075998
     C                     EXSR *PSSR                                     075998
     C                     END                             E3             075998
     C*                                                                   075998
     C           PTFR      IFNE FFPTFR                     B3             075998
     C           CNUM      ORNE FFCNUM                                    075998
     C                     MOVE 'Y'       QSCPTC                          075998
     C                     END                             E3             075998
     C                     MOVE FFPTFR    TPPTFR                          075998
     C                     MOVE FFPTFR    TPCNUM                          075998
     C                     END                             E2             075998
     C*                                                                   46386
     C** CHECK FOR CROSS PORTFOLIO SETTLEMENTS FOR POSTINGS GENERATED     46386
     C** BY SE MODULE                                                     46386
     C           SPOS      IFEQ '  GE-ST'                  B2             46386
     C                     MOVELOTRF      WWOTR1  6                       46386
     C                     MOVE OTRF      WWOTR3  4                       46386
     C*                                                                   46386
     C** IF BYTES 1 - 6 OF OTRF '000000' PROCESSING POSITION SETTLEMENT   46386
     C           WWOTR1    IFEQ '000000'                   B3             46386
     C*                                                                   46386
     C           PTFR      IFNE WWOTR3                     B4             46386
     C                     MOVE 'Y'       QSCPTC                          46386
     C                     END                             E4             46386
      *                                                                   CPM005
     C**********           Z-ADDCNUM      TPCNUM                                       CPM005 CSD027
     C                     MOVE CNUM      TPCNUM                                              CSD027
     C                     MOVE WWOTR3    TPPTFR                          CPM005
     C                     END                             E3             46386
     C*                                                                   46386
     C** IF BYTES 9 & 10 EQUAL TO 'TP' OR 'TS' PROCESSING TRADE POSTING   46386
     C                     MOVE OTTP      WWOTTP  2                       46386
     C           WWOTTP    IFEQ 'TP'                       B3             46386
     C           WWOTTP    OREQ 'TS'                                      46386
     C*                                                                   46386
     C                     MOVELOTRF      WKOTRF  6                       46386
     C           WKOTRF    CHAINTRADS                72                   46386
     C*                                                                   46386
     C           *IN72     IFEQ '1'                        B4             46386
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD29        DBASE                           46386
     C                     MOVE *BLANKS   DBFILE           ***************46386
     C***********          MOVEL'TRADS   'DBFILE     * DBERROR 007 *46386 S01486
     C                     MOVE 'TRADS   'DBFILE           * DBERROR 007 *S01486
     C                     MOVE WKOTRF    DBKEY            ***************46386
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     46386
     C                     END                             E4             46386
     C*                                                                   46386
     C           PTFR      IFNE TDPTFR                     B4             46386
     C                     MOVE 'Y'       QSCPTC                          46386
     C                     END                             E4             46386
     C*                                                                   56460
     C                     MOVE TDPTFR    TPPTFR                          56460
     C                     END                             E3             46386
     C*                                                                   46386
     C** IF POSTING DUE TO DEPOT MOVEMENT (BYTES 5 & 6 OF OTRF NOT        46386
     C** BLANK AND BYTES 9 & 10 BLANK) PERFORM FOLLOWING PROCESSING       46386
     C           WWOTR1    IFNE '000000'                   B3             46386
     C           WWOTTP    ANDNE'TP'                                      46386
     C           WWOTTP    ANDNE'TS'                                      46386
     C*                                                                   46386
     C                     MOVELOTRF      WKOTRF                          46386
     C                     MOVELOTST      WKDPMV 16                       46386
     C                     MOVE WKOTRF    WKDPMV                          46386
     C           WKDPMV    CHAINDPTMV                72                   46386
     C*                                                                   46386
     C           *IN72     IFEQ '1'                        B4             46386
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD30        DBASE                           46386
     C                     MOVE *BLANKS   DBFILE           ***************46386
     C***********          MOVEL'DPTMV   'DBFILE     * DBERROR 007 *46386 S01486
     C                     MOVE 'DPTMV   'DBFILE           * DBERROR 007 *S01486
     C                     MOVE WKDPMV    DBKEY            ***************46386
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     46386
     C                     END                             E4             46386
     C*                                                                   46386
     C           PTFR      IFNE DPPTFR                     B4             46386
     C                     MOVE 'Y'       QSCPTC                          46386
     C                     END                             E4             46386
     C*                                                                   56460
     C                     MOVE DPPTFR    TPPTFR                          56460
     C                     END                             E3             46386
     C                     END                             E2             46386
     C*                                                                   46386
     C** CHECK FOR CROSS PORTFOLIO SETTLEMENTS FOR POSTINGS GENERATED     46386
     C** BY DL MODULE                                                     46386
     C           SPOS      IFEQ '  GE-DL'                  B2             46386
     C                     MOVELOTRF      WKOTRF                          46386
     C           WKOTRF    CHAINDEALS                72                   46386
     C*                                                                   085810
     C** IF DEAL NOT FOUND ACCESS HISTORIC DEALS FILE                     085810
     C*                                                                   085810
     C           *IN72     IFEQ '1'                                       085810
     C           WKOTRF    CHAINDEALSH               72                   085810
     C*                                                                   46580
     C** IF DEAL NOT FOUND ACCESS REVERSED DEALS FILE                     46580
     C           *IN72     IFEQ '1'                        B3             46580
     C***********WKOTRF    CHAINRDEALSDC             72             46580 S01486
     C           WKOTRF    CHAINPMDEACPD             72                   S01486
     C*                                                                   57784
     C** IF DEAL NOT FOUND ACCESS REVERSED FX DEALS FILE                  57784
     C           *IN72     IFEQ '1'                        B4             57784
     C***********WKOTRF    CHAINRDEALSDB             72             57784 S01486
     C           WKOTRF    CHAINPMDEABPD             72                   S01486
     C*                                                                   46386
     C           *IN72     IFEQ '1'                        B5             46386
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD40        DBASE                           46386
     C                     MOVE *BLANKS   DBFILE           ***************46386
     C***********          MOVEL'DEALS   'DBFILE     * DBERROR 007 *46386 S01486
     C                     MOVE 'DEALS   'DBFILE           * DBERROR 007 *S01486
     C                     MOVE WKOTRF    DBKEY            ***************46386
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     46386
     C                     END                             E5             46386
     C                     END                             E4             57784
     C                     END                             E3             46580
     C                     END                                            085810
     C*                                                                   46386
     C** IF RECORD FOR MM DEPOSIT CHECK FOR SETTLEMENT IN A DIFFERENT     46386
     C** PORTFOLIO                                                        46386
     C           DLRCDC    IFEQ 15                         B3             46386
     C           DLRCDC    OREQ 16                                        46386
     C           DLRCDC    OREQ 17                                        46386
     C           DLRCDC    OREQ 18                                        46386
     C*                                                                   46386
     C           PTFR      IFNE DLPTFR                     B4             46386
     C                     MOVE 'Y'       QSCPTC                          46386
     C                     END                             E4             46386
     C*                                                                   56460
     C                     MOVE DLPTFR    TPPTFR                          56460
     C*                                                                   46386
     C                     END                             E3             46386
     C*                                                                   46386
     C** PROCESSING FOR FX DEALS                                          46386
     C           DLRCDC    IFEQ 11                         B3             46386
     C           DLRCDC    OREQ 12                                        46386
     C           DLRCDC    OREQ 13                                        46386
     C           DLRCDC    OREQ 14                                        46386
     C*                                                                   46386
     C** DETERMINE PORTFOLIO OF SETTLEMENT ACCOUNT FOR BANK BUY CCY       46386
     C                     MOVE *BLANKS   WBPTFR                          46386
     C                     MOVE 'N'       WBRETL  1                       59474
     C           DLPCST    IFEQ 4                                         59474
     C           DLPCST    OREQ 5                                         59474
     C           DLPCST    OREQ 14                                        59474
     C           DLPCST    OREQ 15                                        59474
     C                     Z-ADDDLPCST    ZMETH                           46386
     C                     MOVE DLOPCA    ZSETI                           46386
     C                     MOVE DLROBR    ZBRCA                           085862
     C****                 Z-ADDCNUM      ZCNUM                     46386 57784
     C**********           Z-ADDTPCNUM    ZCNUM                                         57784 CSD027
     C                     MOVE TPCNUM    ZCNUM                                               CSD027
     C                     MOVE DLPUCY    ZCCY                            46386
     C                     EXSR ZSETAC                                    46386
     C                     MOVELZSETO     WBCNUN  6                       CPM005
     C                     MOVE ZPTFR     WBPTFR  4                       46386
     C                     MOVE 'Y'       WBRETL                          59474
     C                     END                                            59474
     C*                                                                   56460
     C                     MOVE DLPTFR    TPPTFR                          56460
     C*                                                                   46386
     C** DETERMINE PORTFOLIO OF SETTLEMENT ACCOUNT FOR BANK SELL CCY      46386
     C                     MOVE *BLANKS   WSPTFR                          46386
     C                     MOVE 'N'       WSRETL  1                       59474
     C           DLSCST    IFEQ 4                                         59474
     C           DLSCST    OREQ 5                                         59474
     C           DLSCST    OREQ 14                                        59474
     C           DLSCST    OREQ 15                                        59474
     C                     Z-ADDDLSCST    ZMETH                           46386
     C                     MOVE DLOSCA    ZSETI                           46386
     C                     MOVE DLPOBR    ZBRCA                           085862
     C****                 Z-ADDCNUM      ZCNUM                     46386 57784
     C**********           Z-ADDTPCNUM    ZCNUM                                         57784 CSD027
     C                     MOVE TPCNUM    ZCNUM                                               CSD027
     C                     MOVE DLSLCY    ZCCY                            46386
     C                     EXSR ZSETAC                                    46386
     C                     MOVELZSETO     WSCNUN  6                       CPM005
     C                     MOVE ZPTFR     WSPTFR  4                       46386
     C                     MOVE 'Y'       WSRETL                          59474
     C                     END                                            59474
     C*                                                                   46386
     C** IF ACCOUNTS IN DIFFERENT PORTFOLIOS FOR BUY & SELL SIDE          46386
     C** SET 'CHANGE TO PORTFOLIO CAPITAL IND' TO 'Y'                     46386
     C           WBPTFR    IFNE WSPTFR                     B4             46386
     C           WBRETL    OREQ 'N'                                       59474
     C           WSRETL    OREQ 'N'                                       59474
     C                     MOVE 'Y'       QSCPTC                          46386
     C                     END                             E4             46386
     C*                                                                   53103
     C*  SET FX DEAL NO. AND ACTION TYPE                                  53103
     C*                                                                   53103
     C                     MOVE WKOTRF    QSDLNO                          53103
     C           DLPUCY    IFEQ QSCCY                                     53103
     C           QSINIO    ANDEQ'O'                                       53103
     C           DLSLCY    OREQ QSCCY                                     53103
     C           QSINIO    ANDEQ'I'                                       53103
     C                     MOVE 'M'       QSFXAT                          53103
     C                     ELSE                                           53103
     C                     MOVE 'R'       QSFXAT                          53103
     C                     ENDIF                                          53103
     C***********                                                   46386 53103
     C***IF*BOTH*SETTLEMENT*ACCOUNTS*IN*SAME*PORTFOLIO*AND*THIS*IS**46386 53103
     C***DIFFERENT*TO*PORTFOLIO*ON*FX*DEAL*FX*P&L*TO*BE*REALISED*IN*      53103
     C***PORTFOLIO*OF*ACCOUNTS.*ON*CASH*PERFORMANCE*EVENT*SET*UP*DEAL6    53103
     C***NUMBER.*USED*AS*TRIGGER*CONDITIONING*P&L*PROCESSING*IN*PM1630    53103
     C***********CCY       IFEQ DLPUCY                     B4       46386 53103
     C***********WBPTFR    ANDEQWSPTFR                              46386 53103
     C***********WBPTFR    ANDNEDLPTFR                              46386 53103
     C***********WBRETL    ANDEQ'Y'                                 59474 53103
     C***********WSRETL    ANDEQ'Y'                                 59474 53103
     C***********          MOVE WKOTRF    QSDLNO                    46386 53103
     C***********          END                             E4       46386 53103
     C***********                                                   57784 53103
     C***IF*BOTH*SETTLEMENT*ACCOUNTS*IN*SAME*PORTFOLIO*AND*DEAL*IS**57784 53103
     C***REVERSED*OUTPUT*DEAL*NUMBER*ON*CASH*RECORD.*THIS*THEN*CAUSES**** 53103
     C***REALISED*FX*P&L*ON*DEAL*TO*BE*REVERSED*IN*PM1630***********57784 53103
     C***********CCY       IFEQ DLPUCY                     B4       57784 53103
     C***********WBPTFR    ANDEQWSPTFR                              57784 53103
     C***********WBRETL    ANDEQ'Y'                                 57784 53103
     C***********WSRETL    ANDEQ'Y'                                 57784 53103
     C***********DLRECI    ANDEQ'R'                                 57784 53103
     C***********          MOVE WKOTRF    QSDLNO                    57784 53103
     C***********          END                             E4       57784 53103
     C                     END                             E3             46386
     C                     END                             E2             46386
     C                     END                             E1             46386
      *                                                                   CPM005
      **  Check whether posting due to batch input (last 6 char num)      CPM005
      *                                                                   CPM005
     C                     MOVE SPOS      WWSPOS  6                       CPM005
     C                     TESTN          WWSPOS     61                   CPM005
     C/COPY WNCPYSRC,PMH00008
      *                                                                   CPM005
     C           *IN61     IFEQ '1'                        B1             CPM005
      *                                                                   CPM005
      ****************************************************************    CPM005
      * Change to capital *    N    *     P    *     C    *     Y    *    CPM005
      ****************************************************************    CPM005
      * Defined portfolio *    N    *     Y    *     Y    *     Y    *    CPM005
      * Non portfolio 9997*    N    *     Y    *     Y    *     Y    *    CPM005
      ****************************************************************    CPM005
      *                                                                   CPM005
     C           A1CPTC    IFEQ 'P'                        B2             CPM005
     C           A1CPTC    OREQ 'C'                                       CPM005
     C           A1CPTC    OREQ 'Y'                                       CPM005
     C                     MOVE 'Y'       QSCPTC                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE A1CPTC    QSCPTC                          CPM005
     C                     END                             E2             CPM005
     C                     END                             E1             CPM005
      *                                                                   CPM005
     C*                                                                   53103
     C*  SET RELATED REFERENCE AND MODULE ID                              53103
     C*                                                                   53103
     C           CONTIN    IFEQ 'Y'                                       093914
     C                     EXSR #BAABA                                    53103
     C                     END                                            093914
     C*                                                                   46386
     C                     ENDSR
      ********************************************************************
      /EJECT                                                              53103
      ********************************************************************53103
      *                                                                  *53103
      * #BAABA   - SET UP RELATED REFERENCE AND MODULE ID                *53103
      *                                                                  *53103
      * SUBROUTINE CALLS:                                                *53103
      *                                                                  *53103
      * SUBROUTINE CALLED FROM:                                          *53103
      * #BAAB    - SET UP DETAILS TO BE OUTPUT                           *53103
      *                                                                  *53103
      * ROUTINE USES VARIABLES:                                          *53103
      *                                                                  *53103
      ********************************************************************53103
     C           #BAABA    BEGSR                                          53103
     C*                                                                   53103
     C                     MOVE *BLANKS   QSREPS                          53103
     C                     MOVELOTRF      WKOTRF                          53103
     C*                                                                   53103
     C                     SELEC                                          53103
     C***********                                                    53103085862
     C***Fidiciary***************************************************53103085862
     C***********SPOS      WHEQ '  GE-FI'                            53103085862
     C***********          MOVE 'FI'      QSREMI                     53103085862
     C***********WWFICO    IFNE 'Y'                                  53103085862
     C***********          MOVELWKOTRF    QSREPS                     53103085862
     C***********          ENDIF                                     53103085862
     C*                                                                   53103
     C*  Securities                                                       53103
     C           SPOS      WHEQ '  GE-ST'                                 53103
     C                     MOVE 'SE'      QSREMI                          53103
     C                     MOVE OTTP      WWOTTP                          53103
     C                     MOVELOTST      QSREPS                          53103
     C                     MOVE *BLANKS   WYORK3  3                       53103
     C                     MOVE WWOTTP    WYORK3  3                       53103
     C                     MOVELWYORK3    WYRK10 10                       53103
     C*                                                                   53103
     C*    - Position settlement                                          53103
     C           WWOTR1    IFEQ '000000'                                  53103
     C****       5         SUBSTOTRF:7    WW5     5                       53103
     C****                 MOVE WW5       ZDAYNO                          53103
     C****                 CALL 'ZDATE2'                                  53103
     C****                 PARM           ZDAYNO  50                      53103
     C****                 PARM 'D'       ZDATFM  1                       53103
     C****                 PARM           ZDATE   60                      53103
     C****                 PARM           ZADATE  7                       53103
     C****                 MOVE ZDATE     WQORK9  9                       53103
     C                     MOVE OTTP      WQORK2  2                       53103
     C           WQORK2    IFEQ 'CP'                                      53103
     C           WQORK2    OREQ 'MT'                                      53103
     C                     MOVE 'CM'      WQORK2                          53103
     C                     END                                            53103
     C*                                                                   53103
     C                     MOVELWQORK2    WQORK9  9                       53103
     C                     MOVE WQORK9    QSREPS                          53103
     C                     ELSE                                           53103
     C                     MOVE WKOTRF    WYRK10                          53103
     C                     MOVE WYRK10    QSREPS                          53103
     C                     ENDIF                                          53103
     C*                                                                   53103
     C*  Futures and Options                                              53103
     C** If Bank Portfolios are supported, treat as if FF off             CPM003
     C           SPOS      WHEQ '  GE-FF'                                 53103
     C           BGFUOP    IFEQ 'Y'                                       075998
     C           FCPORS    ANDNE'B'                                       CPM003
     C***********          MOVE 'FF'      QSREMI                    53103 075998
     C***********          MOVELWKOTRF    QSREPS                    53103 075998
     C           FFISTT    CHAININTYP                72                   075998
     C*                                                                   075998
     C** IF TRANSACTION NOT FOUND TERMINATE WITH DATABASE ERROR           075998
     C           *IN72     IFEQ '1'                                       075998
     C           *LOCK     IN   LDA                                       075998
     C                     Z-ADD83        DBASE                           075998
     C                     MOVE *BLANKS   DBFILE           ***************075998
     C                     MOVE 'INTYP   'DBFILE           * DBERROR 083 *075998
     C                     MOVE FFISTT    DBKEY            ***************075998
     C                     OUT  LDA                                       075998
     C                     EXSR *PSSR                                     075998
     C                     END                                            075998
     C*                                                                   075998
     C** SETUP MODULE ID TO SHOW WHETHER INTRUMENT IS A 'MARGIN' OR       075998
     C** PREMIUM INSTRUMENT                                               075998
     C           FFISPT    IFLE 3                                         075998
     C           FFISPT    OREQ 7                                         075998
     C           FFISPT    ORGE 4                                         075998
     C           FFPUPF    ANDEQ'N'                                       075998
     C                     MOVE 'FM'      QSREMI                          075998
     C                     ELSE                                           075998
     C                     MOVE 'FO'      QSREMI                          075998
     C                     END                                            075998
     C*                                                                   075998
     C** SET UP RELATED POSITION ID VIA SR/ZFFOLN                         075998
     C                     EXSR ZFFOLN                                    075998
     C                     MOVE FFISDT    QSREPS                          075998
     C                     END                                            075998
     C*                                                                   53103
     C*  Dealing                                                          53103
     C           SPOS      WHEQ '  GE-DL'                                 53103
     C                     MOVELOTTP      WWOTTP                          53103
     C*                                                                   53103
     C*    - MM                                                           53103
     C           DLRCDC    IFEQ 15                                        53103
     C           DLRCDC    OREQ 16                                        53103
     C           DLRCDC    OREQ 17                                        53103
     C           DLRCDC    OREQ 18                                        53103
     C                     MOVELWKOTRF    QSREPS                          53103
     C*                                                                   53103
     C*      -- MM loans                                                  53103
     C           WWOTTP    IFEQ 'IP'                                      53103
     C           WWOTTP    OREQ 'TI'                                      53103
     C           WWOTTP    OREQ 'CL'                                      53103
     C           WWOTTP    OREQ 'LN'                                      53103
     C           WWOTTP    OREQ 'DL'                                      53103
     C                     MOVE 'ML'      QSREMI                          53103
     C                     ELSE                                           53103
     C*                                                                   53103
     C*      -- MM Deposits                                               53103
     C                     MOVE 'MD'      QSREMI                          53103
     C                     ENDIF                                          53103
     C*                                                                   53103
     C*    - FX                                                           53103
     C                     ELSE                                           53103
     C                     MOVE 'FX'      QSREMI                          53103
     C*                                                                   53103
     C*      -- Find other settlement a/c using ZSETAC                    53103
     C                     MOVE QSCNUM    ZCNUM                           53103
     C           QSINIO    IFEQ 'I'                                       53103
     C           QSFXAT    ANDEQ'R'                                       53103
     C           QSINIO    OREQ 'O'                                       53103
     C           QSFXAT    ANDEQ'M'                                       53103
     C                     MOVE DLSCST    ZMETH                           53103
     C                     MOVE DLOSCA    ZSETI                           53103
     C                     MOVE DLPOBR    ZBRCA                           085862
     C                     MOVE DLSLCY    ZCCY                            53103
     C                     ELSE                                           53103
     C                     MOVE DLPCST    ZMETH                           53103
     C                     MOVE DLOPCA    ZSETI                           53103
     C                     MOVE DLROBR    ZBRCA                           085862
     C                     MOVE DLPUCY    ZCCY                            53103
     C                     ENDIF                                          53103
     C                     EXSR ZSETAC                                    53103
     C*                                                                   53103
     C*      -- Reformat a/c no. from ZSETO to QSREPS                     53103
     C***********          MOVELZSETO     WW6     6                  53103085862
     C***********3         SUBSTZSETO:7   WW3     3                  53103085862
     C***********4         SUBSTZSETO:10  WW4     4                  53103085862
     C***********          MOVE ZSETO     WW2     2                  53103085862
     C***********          MOVELWW6       QSREPS                     53103085862
     C***********QSREPS    CAT  WW3:1     QSREPS                     53103085862
     C***********QSREPS    CAT  WW4:1     QSREPS                     53103085862
     C***********QSREPS    CAT  WW2:1     QSREPS                     53103085862
     C                     MOVE *BLANKS   QSREPS                          085862
     C                     MOVELZSETO     QSREPS                          085862
     C*                                                                   53103
     C                     ENDIF                                          53103
     C*                                                                   53103
     C*  Lending                                                          53103
     C           SPOS      WHEQ '  GE-LE'                                 53103
     C                     MOVE 'LE'      QSREMI                          53103
     C                     MOVELWKOTRF    QSREPS                          53103
     C*                                                                   53103
     C*  Else Retail                                                      53103
     C                     OTHER                                          53103
     C                     MOVE 'RE'      QSREMI                          53103
     C*                                                                   53103
     C                     ENDSL                                          53103
     C*                                                                   53103
     C*  If no related reference yet, use current a/c code                53103
     C           QSREPS    IFEQ *BLANKS                                   53103
     C***********          MOVE QSACOD    WW4                        53103085862
     C***********          MOVE QSACSQ    WW2                        53103085862
     C**********           MOVE QSACOD    WW4     4                                    085862 CGL029
     C                     MOVE QSACOD    WW10   10                                           CGL029
     C                     MOVE QSACSQ    WW2     2                       085862
     C*********************MOVELQSCNUM    QSREPS                     53103CPM004
     C                     MOVELCNUM      QSREPS                          CPM004
     C***********QSREPS    CAT  QSCCY:1   QSREPS                     53103085862
     C***********QSREPS    CAT  WW4:1     QSREPS                     53103085862
     C***********QSREPS    CAT  WW2:1     QSREPS                     53103085862
     C           QSREPS    CAT  QSCCY:0   QSREPS                          085862
     C********** QSREPS    CAT  WW4:0     QSREPS                                       085862 CGL029
     C           QSREPS    CAT  WW10:0    QSREPS                                              CGL029
     C           QSREPS    CAT  WW2:0     QSREPS                          085862
     C           QSREPS    CAT  QSBRCA:0  QSREPS                          085862
     C                     ENDIF                                          53103
     C*                                                                   53103
     C                     ENDSR                                          53103
      /EJECT
      ********************************************************************
      *                                                                  *
      **#BAAC****-*WRITE*SECOND*RECORD*TO*PMPCAAPP*IF*REQUIRED************S01486
      * #BAAC    - WRITE SECOND RECORD TO PMPCAAPD IF REQUIRED           *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BAA     - CONTROL SETTING UP OF DETAILS TO BE OUTPUT            *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #BAAC     BEGSR
     C*
     C* PERFORMANCE CATEGORY SET TO CATEGORY FROM SDRETRPD
     C                     MOVE A1PFMC    QSPFMC
     C***********          MOVE A1APRA    QSAPRA                          S01486
     C                     MOVE A1ATRA    QSAPRA                          S01486
     C*
     C** SUB-CATEGORY ALWAYS BLANK OTHER THAN FOR FEES & CHARGES
     C           A1PFMC    IFEQ 'C '
     C           A1PFMC    OREQ 'F '
     C                     MOVE 'TR'      QSPFMS
     C                     ELSE
     C                     MOVE *BLANKS   QSPFMS
     C                     END
     C*
     C** REVERSE SIGN OF INCOMING/OUTGOING INDICATOR
     C           QSINIO    IFEQ 'I'
     C                     MOVE 'O'       QSINIO
     C                     ELSE
     C                     MOVE 'I'       QSINIO
     C                     END
     C*
     C                     MOVE 'N'       QSCPTC
     C*                                                                   46386
     C                     Z-ADD0         QSDLNO                          46386
     C*
     C                     ENDSR
      ********************************************************************49584
      /EJECT                                                              49584
      ********************************************************************49584
      *                                                                  *49584
      * #BAAD    - WRITE FIDUCIARY COMMISSIONS RECEIVED RECORD           *49584
      *                                                                  *49584
      * SUBROUTINE CALLS:                                                *49584
      *                                                                  *49584
      * SUBROUTINE CALLED FROM:                                          *49584
      * #BAA     - CONTROL SETTING UP OF DETAILS TO BE OUTPUT            *49584
      *                                                                  *49584
      * ROUTINE USES VARIABLES:                                          *49584
      *                                                                  *49584
      ********************************************************************49584
     C           #BAAD     BEGSR                                          49584
     C*                                                                   49584
     C* PERFORMANCE CATEGORY SET TO CATEGORY FROM SDRETRPD                49584
     C                     MOVEL'F '      QSPFMC                          49584
     C                     MOVE 'N'       QSAPRA                          49584
     C                     MOVE 'TR'      QSPFMS                          49584
     C*                                                                   49584
     C                     MOVE QSINIO    WXINIO  1                       49584
     C           WXINIO    IFEQ 'I'                                       49584
     C                     MOVE 'O'       QSINIO                          49584
     C                     ELSE                                           49584
     C                     MOVE 'I'       QSINIO                          49584
     C                     END                                            49584
     C                     MOVE 'N'       QSCPTC                          49584
     C*                                                                   49584
     C                     Z-ADD0         QSDLNO                          49584
     C*                                                                   49584
     C                     ENDSR                                          49584
      ********************************************************************
      /EJECT                                                              53103
      ********************************************************************53103
      *                                                                  *53103
      * #BAAE    - SET PERFORMANCE EVENT REFERENCE                       *53103
      *                                                                  *53103
      * SUBROUTINE CALLS:                                                *53103
      *                                                                  *53103
      * SUBROUTINE CALLED FROM:                                          *53103
      * #BAA     - CONTROL SETTING UP OF DETAILS TO BE OUTPUT            *53103
      *                                                                  *53103
      ********************************************************************53103
     C           #BAAE     BEGSR                                          53103
     C*                                                                   53103
     C           *LOCK     IN   PMSTAT                                    53103
     C                     MOVE DAEVRF    ZZEVRF  70                      53103
     C                     Z-ADDZZEVRF    QSEVRF                          53103
     C                     ADD  1         ZZEVRF                          53103
     C                     MOVE ZZEVRF    DAEVRF                          53103
     C                     OUT  PMSTAT                                    53103
     C*                                                                   53103
     C                     MOVE *BLANKS   QSCHTP                          53103
     C                     Z-ADD0         QSLCD                           53103
     C                     MOVE *BLANKS   QSUSER                          53103
     C*                                                                   53103
     C                     ENDSR                                          53103
      ********************************************************************53103
      /EJECT
      ********************************************************************
      *                                                                  *
      * #C       - WRITE AUDIT REPORT                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWACCC   -                                                       *
      * WWPOSC   -                                                       *
      * WWPERC   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #C        BEGSR
     C*
     C* Move totals to Report fields.
     C*
     C                     Z-ADDWWACCC    RRNOAC
     C                     Z-ADDWWPOSC    RRNOPT
     C                     Z-ADDWWPERC    RRNORD
     C*
     C* Write headings and Totals.
     C*
     C                     WRITEHEADAU
     C                     WRITECONTROL
     C*
     C**Write*footings.************************************************   S01486
     C***********          WRITEENDAU                                     S01486
     C*                                                                   S01486
     C** Write No details format                                          S01486
     C*                                                                   S01486
     C           RRNORD    IFEQ 0                                         S01486
     C                     WRITENODTLS                                    S01486
     C                     END                                            S01486
     C*
     C                     ENDSR
      ********************************************************************CPM004
      *                                                                   CPM004
      * BRANCH   - RETRIEVE BRANCH'S CUSTOMER DETAILS                     CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLS:                                                 CPM004
      * *PSSR    - DB ERROR SUB-ROUTINE                                   CPM004
      * AOPLCSR1 - PORTFOLIO MANAGEMENT CUSTOMER DETAILS                  CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLED FROM:                                           CPM004
      * #BA      - OBTAIN ACCOUNT INFORMATION AND READ THROUGH PMACPOL0   CPM004
      *                                                                   CPM004
      * ROUTINE USES VARIABLES:                                           CPM004
      *                                                                   CPM004
      ********************************************************************CPM004
     C           BRANCH    BEGSR                                          CPM004
     C**                                                                  CPM004
     C                     MOVE 'B'       I#PORS                          CPM004
     C                     MOVE FCR997    I#R997                          CPM004
     C                     MOVE BRCA      I#BRCA                          CPM004
     C**                                                                  CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CPM004
     C                     PARM '*KEY   ' P@OPTN  7        I:Option       CPM004
     C                     PARM           I@PARM           I:Parameters   CPM004
     C                     PARM *BLANKS   O@PARM           O:Parameters   CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY            O:Format       CPM004
     C*                                                                   CPM004
     C** ERROR                                                            CPM004
     C           P@RTCD    IFNE *BLANK                                    CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD40        DBASE            ***************CPM004
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 40 *CPM004
     C                     MOVELI#BRCA    DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
      *                                                                   CPM004
     C                     ENDSR                                          CPM004
     C********************************************************************50406
     C*                                                                   50406
     C*  ZCCYCN SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER       50406
     C*  CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES             50406
     C*                                                                   50406
     C*  INPUT  FIELDS                                                    50406
     C*       ZAMTF  150     AMOUNT IN 'FROM' CURRENCY                    50406
     C*       ZCCYF   3A     FROM CURRENCY                                50406
     C*       ZCCYT   3A     TO CURRENCY                                  50406
     C*       ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY                50406
     C*       ZRATET 138     SPOT RATE FOR 'TO' CURRENCY                  50406
     C*       ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CURRENCY50406
     C*       ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURRENCY  50406
     C*       ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY  50406
     C*       ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY    50406
     C*                                                                   50406
     C*  OUTPUT  FIELDS                                                   50406
     C*       ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT50406
     C*       ZCRSRT 138     CROSS EXCHANGE RATE                          50406
     C*       ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR         50406
     C*                                                                   50406
     C*                                                                   50406
     C*  CALLS:                                                           50406
     C*       ZCCYCA - CONVERT AMOUNT                                     50406
     C********************************************************************50406
     C*                                                                   50406
     C           ZCCYCD    BEGSR                           *** ZCCYCN *** 50406
     C*                                                                   50406
     C** DEFINE ALL FIELDS                                                50406
     C                     Z-ADDZAMTF     ZAMTF  150                      50406
     C                     MOVE ZCCYF     ZCCYF   3                       50406
     C                     MOVE ZCCYT     ZCCYT   3                       50406
     C                     Z-ADDZRATEF    ZRATEF 138                      50406
     C                     Z-ADDZRATET    ZRATET 138                      50406
     C                     MOVE ZMDINF    ZMDINF  1                       50406
     C                     MOVE ZMDINT    ZMDINT  1                       50406
     C                     Z-ADDZCDPF     ZCDPF   10                      50406
     C                     Z-ADDZCDPT     ZCDPT   10                      50406
     C                     Z-ADDZAMTT     ZAMTT  150                      50406
     C                     Z-ADDZCRSRT    ZCRSRT 138                      50406
     C                     MOVE ZCRSMD    ZCRSMD  1                       50406
     C*                                                                   50406
     C** IF 'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TO' CURR50406
     C** EQUAL TO AMOUNT IN 'FROM' CURRENCY                               50406
     C           ZCCYF     IFEQ ZCCYT                                     50406
     C                     Z-ADDZAMTF     ZAMTT                           50406
     C                     Z-ADD1         ZCRSRT                          50406
     C                     MOVE 'M'       ZCRSMD                          50406
     C           1000000000MULT 1000000   ZCRSRN                          50406
     C                     GOTO CCYEN1                                    50406
     C                     END                                            50406
     C*                                                                   50406
     C** INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO                 50406
     C                     Z-ADD*ZEROS    ZCRSRT                          50406
     C*                                                                   50406
     C** CONVERT 'FROM' RATE TO MULTIPLY RATE                             50406
     C           ZMDINF    IFEQ 'M'                                       50406
     C                     Z-ADDZRATEF    ZRATF1 138                      50406
     C           1000000000MULT ZRATEF    ZRATF2 308                      50406
     C           10        MULT ZRATF2    ZRATF2                          50406
     C                     ELSE                                           50406
     C           1         DIV  ZRATEF    ZRATF1                          50406
     C           1000000000MULT 10        ZRWORK 200                      50406
     C           ZRWORK    DIV  ZRATEF    ZRATF2    H                     50406
     C                     END                                            50406
     C*                                                                   50406
     C** CONVERT 'TO' RATE TO MULTIPLY RATE                               50406
     C           ZMDINT    IFEQ 'M'                                       50406
     C                     Z-ADDZRATET    ZRATT1 138                      50406
     C           1000000000MULT ZRATET    ZRATT2 308                      50406
     C           10        MULT ZRATT2    ZRATT2                          50406
     C                     ELSE                                           50406
     C           1         DIV  ZRATET    ZRATT1                          50406
     C           1000000000MULT 10        ZRWORK                          50406
     C           ZRWORK    DIV  ZRATET    ZRATT2    H                     50406
     C                     END                                            50406
     C*                                                                   50406
     C** NOW CALCULATE CROSS RATE                                         50406
     C           ZRATT1    IFNE *ZEROS                                    50406
     C           ZRATF1    DIV  ZRATT1    ZCRSRT                          50406
     C*                                                                   50406
     C** CALCULATE DOUBLE PRECISION FX RATE                               50406
     C** FIRST SPLIT FIGURE INTO TWO PARTS                                50406
     C           1000000000MULT 1000000   ZRWORK                          50406
     C           ZRATF2    MULT ZRWORK    ZRATBF 300                      50406
     C                     Z-ADDZRATF2    ZRATSF 158                      50406
     C*                                                                   50406
     C** DIVIDE BOTH BIG AND SMALL PARTS BY TO FX RATE AND ADD TO CROSS RA50406
     C** TO BE USED IN CALCULATIONS                                       50406
     C           ZRATBF    DIV  ZRATT2    ZCRSRN 309H                     50406
     C           ZRATSF    DIV  ZRATT2    ZCRSR1 309H                     50406
     C                     ADD  ZCRSR1    ZCRSRN                          50406
     C                     END                                            50406
     C*                                                                   50406
     C** MOVE MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULT/DIV   50406
     C** INDICATOR (ZCRSMD)                                               50406
     C                     MOVE 'M'       ZCRSMD                          50406
     C*                                                                   50406
     C** IF CROSS EXCHANGE RATE IS EQUAL TO ZERO                          50406
     C** SET ZAMTT  TO *ZERO  & EXIT                                      50406
     C           ZCRSRN    IFEQ 0                                         50406
     C                     Z-ADD*ZEROS    ZAMTT                           50406
     C                     GOTO CCYEN1                                    50406
     C                     END                                            50406
     C*                                                                   50406
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF) EQUALS DECIMAL    50406
     C** DECIMAL PLACES  FOR 'TO' CURRENCY CONVERT AMOUNT BY SIMPLE       50406
     C** MULTIPLICATION                                                   50406
     C           ZCDPF     IFEQ ZCDPT                      B1             50406
     C           ZAMTF     MULT ZCRSRN    ZAMTO  300H                     50406
     C                     END                             E1             50406
     C*                                                                   50406
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF)  NOT EQUALS DECIMA50406
     C** DECIMAL PLACES  FOR 'TO' CURRENCY ADJUST AMOUNT FOR DIFFERENT DP 50406
     C           ZCDPF     IFNE ZCDPT                      B1             50406
     C*                                                                   50406
     C** SUBTRACT DECIMAL PLACES 'FROM' FROM DECIMAL PLACES 'TO' IN POWER 50406
     C           ZCDPT     SUB  ZCDPF     ZWKPX   10                      50406
     C           ZWKPX     ADD  4         B       30                      50406
     C*                                                                   50406
     C** IF POWER ELEMENT (8,4) LESS THAN 1                               50406
     C           POWER,B   IFLT 1                          B2             50406
     C*                                                                   50406
     C** MULTIPLY AMOUNT IN FROM CURRENCY BY ELEMENT IN POWER ARRAY       50406
     C           POWER,B   MULT ZAMTF     ZWK153 153                      50406
     C*                                                                   50406
     C           ZWK153    MULT ZCRSRN    ZAMTO     H                     50406
     C                     END                             E2             50406
     C*                                                                   50406
     C** IF POWER ELEMENT (8,4) GREATER OR EQUAL TO 1                     50406
     C           POWER,B   IFGE 1                          B2             50406
     C           ZAMTF     MULT POWER,B   ZAMTO                           50406
     C           ZAMTO     MULT ZCRSRN    ZAMTO     H                     50406
     C                     END                             E2             50406
     C                     END                             E1             50406
     C*                                                                   50406
     C           ZAMTO     DIV  ZRWORK    ZAMTT     H                     50406
     C*                                                                   50406
     C           CCYEN1    ENDSR                                          50406
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*    *PSSR     - Program error handling routine                 *
     C*                                                               *
     C*****************************************************************
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - PROCESS PROGRAM ERROR                                 *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #A       - INITIAL PROCESSING                                    *
      **#BA******-*OBTAIN*ACCOUNT*INFORMATION*AND*READ*THROUGH*ACPOPT*****S01486
      * #BA      - OBTAIN ACCOUNT INFORMATION AND READ THROUGH PMACPOL0  *S01486
      * #SPOT    - OBTAIN FX RATE APPLYING ON DATE IN PAST               *
      * #BAAB    - SET UP DETAILS TO BE OUTPUT                           *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*                                                                   S01486
     C** Output header and database error record format                   S01486
     C*                                                                   S01486
     C                     WRITEHEADAU                                    S01486
     C                     WRITEFCDBERR                                   S01486
     C*                                                                   S01486
     C                     DUMP
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
      /EJECT
      ****/COPY ZSRSRC,ZCCYCN                                       47719 50406
      ****/EJECT                                                    47719 50406
      /COPY ZSRSRC,ZCCYXR                                                 47719
      /EJECT                                                              46386
      /COPY ZSRSRC,ZSETAC                                                 46386
      /EJECT                                                              075998
      /COPY PMCPYSRC,ZFFOLN3                                              075998
      /EJECT                                                              075998
      /COPY ZSRSRC,FFPRCSZ4                                               075998
      /EJECT                                                              53103
     C********************************************************************53103
     C*                                                                   53103
     C*  ZCCYXD SR. TO CONVERT AN AMOUNT USING DOUBLE PRECISION FX        53103
     C*  RATES                                                            53103
     C*                                                                   53103
     C*  INPUT  FIELDS                                                    53103
     C*       ZAMTF  150     AMOUNT IN 'FROM' CURRENCY                    53103
     C*       ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY  53103
     C*       ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY    53103
     C*       ZCRSRD 308     DOUBLE PRECISION FX RATE                     53103
     C*       ZCRSMD  1      MULTIPLY / DIVIDE INDICATOR                  53103
     C*                                                                   53103
     C*  OUTPUT  FIELDS                                                   53103
     C*       ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT53103
     C*                                                                   53103
     C*                                                                   53103
     C********************************************************************53103
     C*                                                                   53103
     C           ZCCYXD    BEGSR                                       ** 53103
     C*                                                                   53103
     C** DEFINE ALL FIELDS                                                53103
     C                     Z-ADDZAMTF     ZAMTF  150                      53103
     C                     Z-ADDZCRSRD    ZCRSRD 308                      53103
     C                     Z-ADDZCDPF     ZCDPF   10                      53103
     C                     Z-ADDZCDPT     ZCDPT   10                      53103
     C                     Z-ADDZAMTT     ZAMTT  150                      53103
     C*                                                                   53103
     C** IF CROSS EXCHANGE RATE IS EQUAL TO ZERO                          53103
     C** SET ZAMTT  TO *ZERO  & EXIT                                      53103
     C           ZCRSRD    IFEQ 0                                         53103
     C                     Z-ADD*ZEROS    ZAMTT                           53103
     C                     GOTO CCYXD                                     53103
     C                     END                                            53103
     C*                                                                   53103
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF) EQUALS DECIMAL    53103
     C** DECIMAL PLACES  FOR 'TO' CURRENCY CONVERT AMOUNT BY SIMPLE       53103
     C** MULTIPLICATION                                                   53103
     C           ZCDPF     IFEQ ZCDPT                      B1             53103
     C           ZAMTF     MULT ZCRSRD    ZAMTO  300H                     53103
     C                     END                             E1             53103
     C*                                                                   53103
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF)  NOT EQUALS DECIMA53103
     C** DECIMAL PLACES  FOR 'TO' CURRENCY ADJUST AMOUNT FOR DIFFERENT DP 53103
     C           ZCDPF     IFNE ZCDPT                      B1             53103
     C*                                                                   53103
     C** SUBTRACT DECIMAL PLACES 'FROM' FROM DECIMAL PLACES 'TO' IN POWER 53103
     C           ZCDPT     SUB  ZCDPF     ZWKPX   10                      53103
     C           ZWKPX     ADD  4         B       30                      53103
     C*                                                                   53103
     C** IF POWER ELEMENT (8,4) LESS THAN 1                               53103
     C           POWER,B   IFLT 1                          B2             53103
     C*                                                                   53103
     C** MULTIPLY AMOUNT IN FROM CURRENCY BY ELEMENT IN POWER ARRAY       53103
     C           POWER,B   MULT ZAMTF     ZWK153 153                      53103
     C*                                                                   53103
     C           ZWK153    MULT ZCRSRD    ZAMTO     H                     53103
     C                     END                             E2             53103
     C*                                                                   53103
     C** IF POWER ELEMENT (8,4) GREATER OR EQUAL TO 1                     53103
     C           POWER,B   IFGE 1                          B2             53103
     C           ZAMTF     MULT POWER,B   ZAMTO                           53103
     C           ZAMTO     MULT ZCRSRD    ZAMTO     H                     53103
     C                     END                             E2             53103
     C                     END                             E1             53103
     C*                                                                   53103
     C           1000000000MULT 1000000   WW1015 160                      53103
     C           ZAMTO     DIV  WW1015    ZAMTT     H                     53103
     C*                                                                   53103
     C           CCYXD     ENDSR                                          53103
     C********************************************************************53103
** CPY@
(c) Finastra International Limited 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
