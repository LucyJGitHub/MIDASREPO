     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM SE performance analysis update')              *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM1510 - SE Performance Analysis Update                      *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. 215959             Date 21Mar16               *
      *  Prev Amend No. 226449             Date 24Jun15               *
      *                 CGL165             Date 17Feb15               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
     F*                 171874             Date 26Jun01               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 130862             Date 18Oct98               *
      *                 104301             Date 15Oct96               *
     F*                 CPM005             Date 15Jul96               *
     F*                 107078             DATE 31JUL96               *
     F*                 097159             DATE 25JUN96               *
     F*                 053103(2ND PART)   DATE 24JUN96               *
     F*                 073300             DATE 24JUN96               *
     F*                 097492             DATE 24JUN96               *
     F*                 103087             DATE 25APR96               *
     F*                 099814             DATE 15FEB96               *
     F*                 CPM004             DATE 04MAR96               *
     F*                 094693             DATE 18OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 085862             DATE 15MAR95               *
     F*                 081348             DATE 21DEC94               *
     F*                 S01496             DATE 01DEC94               *
     F*                 53103              DATE 30NOV94               *
     F*                 S01486             DATE 11AUG94               *
     F*                 060971             DATE 27SEP93               *
     F*                 059474             DATE 11AUG93               *
     F*                 056990             DATE 21JUN93               *
     F*                 056460             DATE 07JUN93               *
     F*                 E60511             DATE 21SEP93               *
     F*                 53551              DATE 13APR93               *
     F*                 52998              DATE 31MAR93               *
     F*                 51969      AA      DATE 08MAR93               *
     F*                 50406              DATE 10FEB93               *
     F*                 S01355             DATE 21JAN93               *
     F*                 49753              DATE 19JAN93               *
     F*                 49213              DATE 05JAN93               *
     F*                 48449              DATE 11NOV92               *
     F*                 46910              DATE 11NOV92               *
     F*                 46386              DATE 28OCT92               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  215959 - Truncation error on event amount in SE2450P3.       *
      *           Recompiled due to changes in PF/SEKEYD.             *
      *         - Applied for MD-37439.                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  171874 - ZAINSH changes - only recompile                     *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  104301 - Exchange rates must be calculated the same way      *
     F*           for all Portfolios                                  *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/2 - CALCULATE & REPORT PERF. FOR ALL CUST.PORT *
     F*  107078 - SET UP FIELDS FOR OUTPUT OF FEES & COMMISION,       *
     F*           CHARGES, TAX TO FILE 'PMPTRAPD'                     *
     F** 097159 - Field 'ITRA' already signed; do not sub it in       *
     F**          output processing (ACIN = 'X')                      *
     F*  053103 - COMPLETE FIX 53103. CODING MISSING IN R10 VERSION   *
     F*  073300 - FOR DEPOT MOVEMENT CHARGES THE EVENT CURRENCY IS    *
     F*           THE CURRENCY OF THE SETTLEMENT A/C (NOT NOMINAL CCY)*
     F*  097492 - WRONG NOMINAL DECIMAL PLACES PRINTED IN PM1630P1    *
     F*           USE NMDP FROM SECTYD TO UPDATE PMPTRAPP AND PMPCAAPP*
     F*  103087 - COB crashes with blank portfolio reference on SE    *
     F*           Position file -  being overwritten on read of       *
     F*           POSET file.  Rename field PTFR on file POSEB1.      *
     F*  099814 - Pool Trades should use CQQ001 feature               *
     F*  CPM004 - Bank Portfolios                                     *
     F*  094693 - ACCNT's key is now split due to branch so use       *
     F*           external file description                           *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  085862 - ALTER TO IDENTIFY ACCOUNTS BY BRANCH CODE           *
     F*  081348 - Amend for ZSETAC subroutine changes                 *
     F*  S01496 - Incorporation of Jyske Enhancements (S10978)        *
     F*  53103  - ADD PERF. EVENT REFERENCE AND RELATED REFERENCE     *
     F*           MODULE                                              *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*  060971 - CALCULATE LAST COUPON DATE RATHER THAN USING AMT    *
     F*           FROM FILE                                           *
     F*  059474 - IF SETTLEMENT NOT IN RETAIL ACCOUNT TREAT AS CROSS  *
     F*           PORTFOLIO SETTLEMENT                                *
     F*  056990 - FOR DEPOT MOVEMENTS USE NEW INDICATOR 'CWDI' FROM   *
     F*           PF/DPTMVD TO DETERMINE WHETHER CHANGE TO CAPITAL    *
     F*  056460 - OUTPUT DUPLICATE RECORDS FOR POOL PORTFOLIO         *
     F*  E60511 - EXTERNALLY-DESCRIBED-FILE - TO OBTAIN CORRECT       *
     F*           RECORD-SIZE.                                        *
     F*  53551  - SUPPRESS S01355                                     *
     F*  52998  - IF ACIN 'F' AND ITRA NON ZERO RESET ACIN TO 'C'     *
     F*  51969  - EMERGENCY FIX :WRONG ACCESS TO INVTP==>DB ERROR 10  *
     F*  50406  - OUTPUT DOUBLE PRECISION FX RATE                     *
     F*  S01355 - RELEASE 3 INCORPORATION                             *
     F*  49753  - ALTER PROGRAM TO HANDLE CUM COUPON -VE INTEREST     *
     F*  49213  - RECOMPILED OVER NEW VERSION OF SR/ZFXAVP            *
     F*  48449  - ONLY PROCESS 'SA' MATURITY EVENTS                   *
     F*  46910  - EVENT DATE SHOULD BE RUN DATE NOT EVENT CONT. DATE  *
     F*  46386  - ALLOW SYSTEM TO HANDLE CROSS PORTFOLIO SETTLEMENTS  *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F/EJECT
     F*****************************************************************
     F**
     F**      FILE DEFINITIONS
     F**     ------------------
     F*
     F**   PORTFOLIO MANAGEMENT SE GENERATED ACCOUNT - Prefix RC
     F**   KEYS
     F***PMSEKEY*IF**E           K        DISK         KINFSR *PSSR       S01486
     FPMSEKYL0IF  E           K        DISK         KINFSR *PSSR          S01486
     F*
     F*****BANK*DETAILS*FILE************************-*Prefix*BJ********   S01486
     F***SDBANKL1IF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F*****PORTFOLIO*ICD****************************-*Prefix*P9********   S01486
     F***SDPORTPDIF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F*****CURRENCY*CODES*FILE**********************-*Prefix*A6********   S01486
     F***SDCURRL0IF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F**   INVESTMENT TYPES FILE
     FINVTP   IF  E           K        DISK         KINFSR *PSSR
     F*
     F**   PORTFOLIO DEFINITION DETAILS             - Prefix PN
     F***PMPORTPPIF**E           K        DISK         KINFSR *PSSR       S01486
     FPMPORTPDIF  E           K        DISK         KINFSR *PSSR          S01486
     F*
     F*                                                                   056460
     F* POOL PORTFOLIO MEMBERS - PREFIX OS                                056460
     FPMPPTML1IF  E           K        DISK         KINFSR *PSSR          056460
     F**   SECURITIES FILE
     FSECTY   IF  E           K        DISK         KINFSR *PSSR
     F***SEEVNT  IF  E           K        DISK                      S01355 53551
     F***                                           KINFSR *PSSR    S01355 53551
     FSECET   IF  E           K        DISK                               B05982
     F            SEDEVDF                           KRENAMESEDEVD1
     F                                              KINFSR *PSSR
     F*
     F**   START OF BUSINESS TRADES
     FSOBTR   IF  E           K        DISK         KINFSR *PSSR
     F            TRADSDF                           KRENAMETRADSDF1
     F*
     F**   TRADES FILE
     FTRADS   IF  E           K        DISK         KINFSR *PSSR
     F*
     F**   DEPOT MOVEMENTS FILE
     FDPTMV   IF  E           K        DISK         KINFSR *PSSR
     F*
     F*****DEPOT*MOVEMENTS*EXTENSION*FILE******************************   S01486
     F***DPTMVDX0IF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F**   POSITION SETTLEMENTS FILE
     F***PMPOSET*IF**E           K        DISK         KINFSR *PSSR       S01486
     FPMPOSDL2IF  E           K        DISK         KINFSR *PSSR          S01486
     FPOSEB1  IF  E           K        DISK         KINFSR *PSSR          CPM004
     F            POSETDF                           KRENAMEPOSEB1F        CPM004
     F*
     F*****POSITION*SETTLEMENTS*EXTENSION*FILE*************************   S01486
     F***PMPOSETXIF**E           K        DISK         KINFSR *PSSR       S01486
     F*                                                                   46386
     F** ACCOUNT DETAILS BY 15A ACCOUNT CODE. NO PREFIX                   46386
     F***ACCNT***IF**F     416 15AI     2 DISK         KINFSR *PSSR46386  S01486
     F***ACCNT***IF**F     416 18AI     2 DISK         KINFSR *PSSR S01486085862
     F***ACCNT***IF**F     437 18AI     2 DISK         KINFSR *PSSR 085862094693
     FACCNT   IF  E           K        DISK         KINFSR *PSSR          094693
     F            ACCNTAAF                          KIGNORE               094693
     F            ACCNTABF                          KRENAMEACCNTB1F       094693
     F            ACCNTACF                          KIGNORE               094693
     F*                                                                   46386
     F** ACCOUNT DETAILS BY 15N ACCOUNT NUMBER. NO PREFIX                 46386
     F*ACNUM   IF  F      47 10AI     2 DISK         KINFSR *PSSR    46386E60511
     F***ACNUM***IF**E           K        DISK         KINFSR *PSSR E60511085862
     F***ACNUM***IF**F      47 10AI     2 DISK         KINFSR *PSSR 085862094693
     FACNUM   IF  E           K        DISK         KINFSR *PSSR          094693
     F            ACCNTABF                          KRENAMEACCNTB2F       094693
     F*                                                                   46386
     F***RETAIL*ICD*-**PREFIX*BM***********************************46386  S01486
     F***SDRETLL0IF**E           K        DISK         KINFSR *PSSR46386  S01486
     F*                                                                   46386
     F***SD*CUSTOMER*DETAILS*-**PREFIX*BB**************************46386  S01486
     F***SDCUSTL0IF**E           K        DISK         KINFSR *PSSR46386  S01486
     F*                                                                   46386
     F***SE*CUSTOMER*DETAILS*-**PREFIX*BF**************************46386  S01486
     F***SDSECSL0IF**E           K        DISK         KINFSR *PSSR46386  S01486
     F*                                                                   46386
     F***BRANCH CODES*-**PREFIX*A8*********************************46386  S01486
     F***SDBRCHL0IF**E           K        DISK         KINFSR *PSSR46386  S01486
      *                                                                   CPM005
      **  Prefix of PMCNSDLL is 'PN'                                      CPM005
     FPMCNSDLLIF  E           K        DISK         KINFSR *PSSR          CPM005
     F*
     F**   PERFORMANCE MID-MONTH POSITIONS FILE     - Prefix RB
     F***PMPTRAPPO***E           K        DISK         KINFSR *PSSR       S01486
     FPMPTRAPDO   E           K        DISK         KINFSR *PSSR          S01486
     F*
     F**   MID-MONTH FLAT POSITIONS UPDATE REPORT
     FPM1510AUO   E             22     PRINTER      KINFDS ERF2DS
     F                                              KINFSR *PSSR
     F/COPY WNCPYSRC,PM1510F001
     F*
     F/EJECT
     F*****************************************************************
     F**                                                              *
     F** ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F**                 ------------------------                     *
     F**                                                              *
     F**                                                              *
     F**       50      - CHAIN TO SDCURRL0                            *
     F**                          INVTP                               *
     F****************************PMPORTPP*****************************   S01486
     F**                          PMPORTPD                            *   S01486
     F**                          TRADS                               *
     F**                          DPTMV                               *
     F**                          SOBTR                               *
     F**       70      - FILE ERROR                                   *
     F**                                                              *
     F*****************************************************************
     F/EJECT
     E*
     E**   ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E**   ARRAY TO EXTRACT PERFORMANCE DATA
     E****                WWARRY  1  10  5                                46386
     E****                WWARRY  1  11  5                          48449 46386
     E                    WWARRY  1  12  5                                48449
     E                    WWARRZ  1   5  5                                CPM004
     E*
     E**   ARRAYS USED IN CURRENCY AMOUNT CONVERSION
      /COPY ZSRSRC,ZPOWERZ1
      /COPY ZSRSRC,ZPOWER8Z1
      /COPY ZSRSRC,ZDAYSZ1
      /COPY ZSRSRC,ZACCRZ0
      /COPY ZSRSRC,ZNCDZ1
      /COPY ZSRSRC,ZDATE2Z1
     E*****************************************************************
     E/EJECT
     I************                                                 S01355 53551
     I*  RENAME FIELDS FROM SECEF-FORMAT SNDEVDF (FOR ZAINSH/ZAISCH)01355 53551
     I*****SNDEVDF                                                 S01355 53551
     I*****         SNSN                            SDSN           S01355 53551
     I*****         SNDT                            SDED           S01355 53551
     I*****         SNET                            SDET           S01355 53551
     I*
     I*  RENAME FIELDS FROM SEKEY
     ISEKEYDF
     I              TNLU                            WWTNLU
     I*                                                                   46386
     I***ACCNT***NS**                                                46386094693
     I***********                             2   70ZRCNUM           46386094693
     I***********                             8  10 ZRCCY            46386094693
     I***********                            11  140ZRACOD           46386094693
     I***********                            15  160ZRACSQ           46386094693
     I***********                            23  25 ZRBRCA          085862094693
     I***********                           433 436 ZRPTFR          085862094693
     I***********                           401 404 ZRPTFR           46386085862
     I*                                                                   46386
     I*ACNUM   NS                                                         E60511
     I*..                                    12  170ZRCNUM                E60511
     I*..                                    18  20 ZRCCY                 E60511
     I*..                                    21  240ZRACOD                E60511
     I*..                                    25  260ZRACSQ                E60511
     I*..                                    41  44 ZRPTFR                E60511
     I*..RENAME FIELDS FROM ACNUM                                         E60511
     I***ACCNTABF***                                                E60511085862
     I***********   CNUM                            ZRCNUM          E60511085862
     I***********   CCY                             ZRCCY           E60511085862
     I***********   ACOD                            ZRACOD          E60511085862
     I***********   ACSQ                            ZRACSQ          E60511085862
     I***********   PTFR                            ZRPTFR          E60511085862
     I***********   BRCA                            ZRBRCA          081348085862
     I***ACNUM***NS*                                                085862094693
     I***********                            12  170ZRCNUM          085862094693
     I***********                            18  20 ZRCCY           085862094693
     I***********                            21  240ZRACOD          085862094693
     I***********                            25  260ZRACSQ          085862094693
     I***********                            29  31 WRBRCA          085862094693
     I***********                            41  44 ZRPTFR          085862094693
     I*                                                                   094693
     IACCNTB1F                                                            094693
     I              CNUM                            ZRCNUM                094693
     I              CCY                             ZRCCY                 094693
     I              ACOD                            ZRACOD                094693
     I              ACSQ                            ZRACSQ                094693
     I              BRCA                            ZRBRCA                094693
     I              PTFR                            ZRPTFR                094693
     I*                                                                   094693
     IACCNTB2F                                                            094693
     I              CNUM                            ZRCNUM                094693
     I              CCY                             ZRCCY                 094693
     I              ACOD                            ZRACOD                094693
     I              ACSQ                            ZRACSQ                094693
     I              BRCA                            ZRBRCA                094693
     I              PTFR                            ZRPTFR                094693
     IPOSEB1F                                                             103087
     I              PTFR                            ZXPTFR                103087
      *                                                                   E60511
      /COPY ZSRSRC,ZNCDZ2
     I*
     I**   DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I**   PROGRAM STATUS DATA STRUCTURE
     IPSDS       SDS
     I                                      244 253 JOB
     I                                      254 263 USER
     I*
     IERF2DS      DS
     I*
     I**   FOR OVERFLOW - PRINT
     I                                    B 367 3680LINE1
     I*
     I**   PERFORMANCE DATA STRUCTURE
     IPERDS       DS
     I                                        1  20 ACKY
     I                                        4   4 ACKY1
     I                                        5   5 ACKY2
     I                                        6   6 ACKY3
     I                                       19  20 ACKY4
     I*
     ICKYDS       DS
     I                                        1   5 WWCKY
     I                                        1   1 WWKY1
     I                                        2   2 WWKY2
     I                                        3   3 WWKY3
     I                                        4   5 WWKY4
     I*                                                                   46386
     I* 15 A SETTLEMENT ACCOUNT RETURNED                                  46386
     I            DS                            256                       46386
     I**********                              1   60ZWCNUM                              46386 CSD027
     I                                        1   6 ZWCNUM                                    CSD027
     I                                        7   9 ZWCCY                 46386
     I**********                             10  130ZWACOD                              46386 CGL029
     I**********                             14  150ZWACSQ                              46386 CGL029
     I**********                             16  18 ZWBRCA                             S01486 CGL029
     I                                       10  190ZWACOD                                    CGL029
     I                                       20  210ZWACSQ                                    CGL029
     I                                       22  24 ZWBRCA                                    CGL029
     I***********                             1  15 ZWACCN         46386  S01486
     I***********                             1  18 ZWACCN          S01486094693
     I**********                              1  18 ZKACCN                             081348 CGL029
     I                                        1  24 ZKACCN                                    CGL029
     I*
     IPMSTAT      DS
     I                                        1   50WWECD
     I*************                          35  35 WWPPRQ         056460 099814
     I                                       47  53 DAEVRF                S01496
     I                                        1 256 WWSTAT
     I*
     I***LDA********UDS***********************     256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*                                                                   CPM004
     I** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
     I** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Data structure for Bank details                                 S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I**  Data structure for Portfolio Management ICD                     S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Data structure for Currency details                             S01486
     I*                                                                   S01486
     ISDMMOD    E DSSDMMODPD                                              CPM004
     I**  Data structure for modules                                      CPM004
     I*                                                                   CPM004
     ISDRETL    E DSSDRETLPD                                              S01486
     I**  Data structure for Retail ICD                                   S01486
     I*                                                                   S01486
     ISDSECS    E DSSDSECSPD                                              S01486
     I              QQACCD                          SEACCD                                    CGL029
     I**  Data structure for Security Client details                      S01486
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              CPM004
     I**  Portfolio Management Customer details                           CPM004
     I*                                                                   CPM004
     ISDNOST    E DSSDNOSTPD                                              CPM004
     I              QQACCD                          NOACCD                                    CGL029
     I**  Data structure for nostro details                               CPM004
     I*                                                                   CPM004
     ISCSARD    E DSSCSARDPD                                              S01496
     I**  Data structure for switchable features file                     S01496
     I*                                                                   S01496
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure for access objects                         S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I**  Long data structure for access programs                         S01486
     I*                                                                   S01486
     I/COPY WNCPYSRC,PM1510I001
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      * #A       - INTITIAL PROCESSING                                   *
      **#B*******-*READ*PMSEKEY*&*SELECT*ACCOUNT*KEYS*FOR*PROCESSING***  *S01486
      * #B       - READ PMSEKYL0 & SELECT ACCOUNT KEYS FOR PROCESSING    *S01486
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      * #BFAA    - GENERATE TRADE PERFORMANCE EVENTS                     *
      * #BFAB    - GENERATE DEPOT MOVEMENT PERFORMANCE EVENTS            *
      * #BFAC    - GENERATE POSITION SETTLEMENT PERFORMANCE EVENTS       *
      * #BFAD    - SET UP RELATED REFERENCE AND MODULE ID.               *53103
      * #BA      - OBTAIN NOMINAL CURRENCY DETAILS                       *
      * #BB      - OBTAIN INVESTMENT POLICY DETAILS                      *
      * #BC      - OBTAIN SECURITY DETAILS                               *
      * #BD      - OBTAIN PORTFOLIO DETAILS                              *
      **#ZB******-*WRITE*PERFORMANCE*EVENT*TO*PF/PMPTRAPP**************  *S01486
      * #ZB      - WRITE PERFORMANCE EVENT TO PF/PMPTRAPD                *S01486
      * #ZD      - CONVERT POSITION SETTLEMENT AMOUNTS TO NOMINAL CCY    *
      * #C       - OUTPUT FILE CONTROL REPORT                            *
      * ZEVRF    - SET PERFORMANCE EVENT REFERENCE                       *53103
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      *                                                                  *
      ********************************************************************
     C                     EXSR #A
     C*
     C**   MAIN PROCESSING
     C                     EXSR #B
     C*
     C**   WRITE REPORT
     C                     EXSR #C
     C*
     C**   END PROGRAM
     C*
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #A       - INTITIAL PROCESSING                                   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINT2   -                                                       *
      * WWCCY    -                                                       *
      * WWTRFR   -                                                       *
      * WWPBCH   -                                                       *
      * WWPTFR   -                                                       *
      * WWPEVT   -                                                       *
      * WWTNLU   -                                                       *
      * WWPDUD   -                                                       *
      * WWINT1   -                                                       *
      * WWECD    -                                                       *
      * WWDANB   -                                                       *
      * WWKCCY   -                                                       *
      * WWCSTN   -                                                       *
      * WWPTCY   -                                                       *
      * WWPCDP   -                                                       *
      * WWTRNB   -                                                       *
      * WWTTYP   -                                                       *
      * WWMFXR   -                                                       *
      * WWINIO   -                                                       *
      * WWPFMC   -                                                       *
      * WWMPRC   -                                                       *
      * WWSPOT   -                                                       *
      * WWTAMT   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #A        BEGSR
     C*
     C** KEY LIST TO ACCESS FILE INVTP
     C*
     C           KL1       KLIST
     C******************** KFLD           KCCY                            51969
     C                     KFLD           MKCCY                           51969
     C                     KFLD           WWINT2
     C*
     C***KEY*LIST*TO*ACCESS*FILE*PMPORTPP******************************   S01486
     C** KEY LIST TO ACCESS FILE PMPORTPD                                 S01486
     C*
     C           KL2       KLIST
     C*********************KFLD           CSTN                            CPM004
     C**********           KFLD           #CSTN   60                                   CPM004 CSD027
     C                     KFLD           #CSTN   6                                           CSD027
     C                     KFLD           PTFR
      *                                                                   CPM005
      **  Key list to access file PMCNSDPD                                CPM005
      *                                                                   CPM005
     C           KL3       KLIST                                          CPM005
     C                     KFLD           CSTN                            CPM005
     C                     KFLD           KPTFR   4                       CPM005
     C*
     C** KEY LIST TO ACCESS FILE PMHSEXPP
     C*
     C           KL4       KLIST
     C                     KFLD           WWCCY   3
     C                     KFLD           EVDT
     C*
     C** KEY LIST TO ACCESS FILE DPTMVD
     C           KL5       KLIST
     C                     KFLD           SESH
     C                     KFLD           WWTRFR  6
     C*
     C** KEY LIST TO ACCESS FILE POSETD
     C           KL6       KLIST
     C***********          KFLD           WWPBCH  30                      S01486
     C                     KFLD           WWPBCH  3                       S01486
     C                     KFLD           W1SESH 10
     C**********           KFLD           W1CSTN  60                                          CSD027
     C                     KFLD           W1CSTN  6                                           CSD027
     C                     KFLD           WWPTFR  4
     C                     KFLD           WWPEVT  2
     C                     KFLD           WWTNLU
     C*                                                                   CPM004
     C           KL6BNK    KLIST                                          CPM004
     C                     KFLD           WWPBCH  3                       CPM004
     C                     KFLD           W1SESH 10                       CPM004
     C                     KFLD           WWPEVT  2                       CPM004
     C*
     C** KEY LIST TO ACCESS FILE SECET
     C           KL7       KLIST
     C                     KFLD           W1SESH 10
     C                     KFLD           WWPEVT
     C                     KFLD           WWPDUD  50
     C*                                                                   094693
     C** Klist for ACCNT                                                  094693
     C*                                                                   094693
     C           ZWACCN    KLIST                                          094693
     C                     KFLD           ZWCNUM                          094693
     C                     KFLD           ZWCCY                           094693
     C                     KFLD           ZWACOD                          094693
     C                     KFLD           ZWACSQ                          094693
     C                     KFLD           ZWBRCA                          094693
     C*                                                                   S01486
     C**  Copyright statement                                             S01486
     C*                                                                   S01486
     C                     MOVEACPY@      CPY2@  80
     C*
     C                     MOVE *BLANKS   WWINT1  3
     C*
     C** INITIALISE DB ERROR FIELDS AND STORE PROGRAM NAME FOR DB
     C** ERROR FIELD
     C*
     C           *NAMVAR   DEFN           LDA                             S01486
     C*                                                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     MOVEL'PM1510'  DBPGM
     C                     OUT  LDA                                       S01486
     C****                 MOVE '1'       *IN98                           060971
     C*
     C** DEFINE DATA AREA PMSTAT
     C           *NAMVAR   DEFN           PMSTAT
     C                     IN   PMSTAT
      *                                                                   CPM005
     C                     MOVE 'N'       WWIND                           CPM005
     C***********                                                         S01486
     C***ACCESS*BANK*DETAILS*******************************************   S01486
     C***********          READ SDBANKL1                 70               S01486
     C***********                                                         S01486
     C***IF*RECORD*NOT*FOUND*OR*LAST*CHANGE*TYPE*=*'D'*(DELETED)*******   S01486
     C************IN70     IFEQ '1'                                       S01486
     C*                                                                   S01486
     C** Get bank details using access object                             S01486
     C*                                                                   S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST ' P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*                                                                   S01486
     C** Check if an error occurred                                       S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            ****************
     C***********          MOVEL'SDBANKL1'DBFILE           * DBERROR  001 S01486
     C                     MOVE 'SDBANKPD'DBFILE           * DBERROR  001 S01486
     C                     MOVE *BLANKS   DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                  060971
     C** SET UP DATE FORMAT INDICATOR                                    060971
     C           BJDFIN    IFEQ 'M'                                      060971
     C                     MOVE '1'       *IN98                          060971
     C                     ELSE                                          060971
     C                     MOVE '0'       *IN98                          060971
     C                     END                                           060971
     C***********                                                         S01486
     C***ACCESS*PORTFOLIO*INSTALLATION*CONTROL*DATA********************   S01486
     C***********          READ SDPORTPD                 70               S01486
     C***********                                                         S01486
     C***IF*RECORD*NOT*FOUND*OR*LAST*CHANGE*TYPE*=*'D'*(DELETED)*******   S01486
     C************IN70     IFEQ '1'                                       S01486
     C***********          Z-ADD1         DBASE            ***************S01486
     C***********          MOVEL'SDPORTPD'DBFILE           * DBERROR  001 S01486
     C*                                                                   S01486
     C** Get Portfolio Management ICD details using access object         S01486
     C*                                                                   S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST ' P@OPTN                          S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C*                                                                   S01486
     C** Check if an error occurred                                       S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD2         DBASE            ***************S01486
     C                     MOVE 'SDPORTPD'DBFILE           * DBERROR  002 S01486
     C                     MOVE *BLANKS   DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C***********                                                  46386  S01486
     C**Access*ICD*File*SDRETLL0.**********************************46386  S01486
     C***********                                                  46386  S01486
     C************LOVAL    SETLLSDRETLL0                           46386  S01486
     C***********          READ SDRETLL0                 70        46386  S01486
     C***********                                                  46386  S01486
     C**If*Record*not*found*-*Database*Error.**********************46386  S01486
     C***********                                                  46386  S01486
     C************IN99     IFEQ '1'                                46386  S01486
     C*                                                                   CPM004
     C* Access Modules                                                    CPM004
     C*                                                                   CPM004
     C                     CALL 'AOMMODR0'                                CPM004
     C                     PARM *BLANKS   P@RTCD                          CPM004
     C                     PARM '*FIRST ' P@OPTN                          CPM004
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPM004
     C           P@RTCD    IFNE *BLANK                                    CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD50        DBASE                           CPM004
     C                     MOVE *BLANKS   DBFILE           ***************CPM004
     C                     MOVE 'SDMMODPD'DBFILE           * DBERROR 050 *CPM004
     C                     MOVE *BLANKS   DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C* If retail installed                                               CPM004
     C*                                                                   CPM004
     C           BGNXST    IFEQ 'Y'                                       CPM004
     C*                                                                   S01486
     C** Get Retail ICD details using access object                       S01486
     C*                                                                   S01486
     C                     CALL 'AORETLR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*FIRST ' P@OPTN                          S01486
     C           SDRETL    PARM SDRETL    DSFDY                           S01486
     C*                                                                   S01486
     C** Check if an error occurred                                       S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C***********          Z-ADD1         DBASE                    46386  S01486
     C                     Z-ADD13        DBASE                           S01486
     C                     MOVE *BLANKS   DBFILE           ***************46386
     C***********          MOVEL'SDRETLL0'DBFILE           * DBERR 46386  S01486
     C                     MOVE 'SDRETLPD'DBFILE           * DBERROR 013 *S01486
     C                     MOVE *BLANKS   DBKEY            ***************46386
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     46386
     C                     END                                            46386
     C                     END                                            CPM004
     C*                                                                   S01496
     C**  Check if Jyske Enhancements feature is installed                S01496
     C*                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   P@RTCD                          S01496
     C                     PARM '*VERIFY' P@OPTN                          S01496
     C                     PARM 'S01496'  P@SARD  6                       S01496
     C           SCSARD    PARM SCSARD    DSSDY                           S01496
     C*                                                                   S01496
     C           P@RTCD    IFEQ *BLANK                                    S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C                     ELSE                                           S01496
     C                     MOVE 'N'       S01496                          S01496
     C                     END                                            S01496
     C*                                                                   099814
     C* Access Switchable features for Pool portfolios                    099814
     C*                                                                   099814
     C                     CALL 'AOSARDR0'                                099814
     C                     PARM *BLANKS   P@RTCD                          099814
     C                     PARM '*KEY   ' P@OPTN                          099814
     C                     PARM 'CQQ001'  P@SARD                          099814
     C                     PARM           DSFDY                           099814
     C*                                                                   099814
     C           P@RTCD    IFEQ *BLANK                                    099814
     C                     MOVE 'Y'       WWPPRQ  1                       099814
     C                     END                                            099814
     C/COPY WNCPYSRC,PM1510C001
     C*
     C                     Z-ADDWWECD     ECD     50
     C                     MOVE 'SE'      QUMODI
     C*
     C** DEFINE WORK FIELDS
     C           *LIKE     DEFN A6NBDP    WWDANB
     C           *LIKE     DEFN KCCY      WWKCCY
     C           *LIKE     DEFN WWINT1    WWINT2
     C           *LIKE     DEFN CSTN      WWCSTN
     C           *LIKE     DEFN PNPTCY    WWPTCY
     C           *LIKE     DEFN PNPCDP    WWPCDP
     C           *LIKE     DEFN QUTRNB    WWTRNB
     C           *LIKE     DEFN QUTTYP    WWTTYP
     C           *LIKE     DEFN QUMFXR    WWMFXR
     C           *LIKE     DEFN QUINIO    WWINIO
     C           *LIKE     DEFN QUPFMC    WWPFMC
     C           *LIKE     DEFN QUMPRC    WWMPRC
     C           *LIKE     DEFN A6SPRT    WWSPOT
     C           *LIKE     DEFN QUTAMT    WWTAMT
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      **#B*******-*READ*PMSEKEY*&*SELECT*ACCOUNT*KEYS*FOR*PROCESSING***  *S01486
      * #B       - READ PMSEKYL0 & SELECT ACCOUNT KEYS FOR PROCESSING    *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCT2    -                                                       *
      * WWKY1    -                                                       *
      * WWKY2    -                                                       *
      * WWKY3    -                                                       *
      * WWKY4    -                                                       *
      * WWARRY   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #B        BEGSR
     C*
     C*  READ FROM PORTFOLIO MANAGEMENT SE GENERATED ACCOUNT KEYS
     C***********          READ PMSEKEY                  70               S01486
     C                     READ PMSEKYL0                 70               S01486
     C*
     C** WHILE NOT END OF FILE
     C           *IN70     DOWEQ'0'                        B1
     C*
     C                     ADD  1         WWCT2   60
     C*
     C** CHECK IF TRADE PURCHASE OR SALE
     C***********ACKY1     IFEQ P9TVPS                     B2             S01486
     C           ACKY1     IFEQ FCTVPS                     B2             S01486
     C           ACKY2     IFEQ 'P'                        B3
     C           ACKY2     OREQ 'S'
     C           ACKY3     IFEQ 'S'                        B4
     C           FCPORS    ANDNE'B'                                       CPM004
     C           ACKY3     OREQ 'D'
     C           FCPORS    ANDNE'B'                                       CPM004
     C           ACKY3     OREQ ' '                                       CPM004
     C           FCPORS    ANDEQ'B'                                       CPM004
     C           ACKY3     OREQ 'X'                                       CPM004
     C           FCPORS    ANDEQ'B'                                       CPM004
     C           ACKY4     IFEQ 'CV'                       B5
     C                     EXSR #BFA
     C                     END                             E5
     C                     END                             E4
     C                     END                             E3
     C                     END                             E2
     C*
     C** CHECK FOR WALK I/O, COUPON, DIVIDEND, MATURITY OR PART PAYMENT
     C                     MOVE ACKY1     WWKY1
     C                     MOVE ACKY2     WWKY2
     C                     MOVE ACKY3     WWKY3
     C                     MOVE ACKY4     WWKY4
     C           FCPORS    IFNE 'B'                                       CPM004
     C           WWCKY     LOKUPWWARRY                   71
     C                     END                                            CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           WWCKY     LOKUPWWARRZ                   71               CPM004
     C                     END                                            CPM004
     C           *IN71     IFEQ '1'                        B2
     C                     EXSR #BFA
     C                     END                             E2
     C*
     C***********          READ PMSEKEY                  70               S01486
     C                     READ PMSEKYL0                 70               S01486
     C                     END                             E1
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #BD      - OBTAIN PORTFOLIO DETAILS                              *
      * #BC      - OBTAIN SECURITY DETAILS                               *
      * #BA      - OBTAIN NOMINAL CURRENCY DETAILS                       *
      * #BB      - OBTAIN INVESTMENT POLICY DETAILS                      *
      * #BFAA    - GENERATE TRADE PERFORMANCE EVENTS                     *
      * #BFAB    - GENERATE DEPOT MOVEMENT PERFORMANCE EVENTS            *
      * #BFAC    - GENERATE POSITION SETTLEMENT PERFORMANCE EVENTS       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      **#B*******-*READ*PMSEKEY*&*SELECT*ACCOUNT*KEYS*FOR*PROCESSING***  *S01486
      * #B       - READ PMSEKYL0 & SELECT ACCOUNT KEYS FOR PROCESSING    *S01486
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCSTN   -                                                       *
      * WWPTFR   -                                                       *
      * WWPTCY   -                                                       *
      * WWPCDP   -                                                       *
      * WWECD    -                                                       *
      * WWSESH   -                                                       *
      * WWKCCY   -                                                       *
      * WWDANB   -                                                       *
      * WWSPRT   -                                                       *
      * WWMDIN   -                                                       *
      * WWINT2   -                                                       *
      * WWKCC1   -                                                       *
      * WWINT1   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BFA      BEGSR
      *                                                                   CPM004
      *  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
      *                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           BRHA      IFNE WWBRHA                                    CPM004
     C                     EXSR BRANCH                                    CPM004
     C                     MOVE BRHA      WWBRHA  3                       CPM004
     C                     ENDIF                                          CPM004
     C                     MOVE O#BICN    #CSTN                           CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
      *  IF CUSTOMER PORTFOLIOS SUPPORTED                                 CPM004
      *                                                                   CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
     C                     MOVE CSTN      #CSTN                           CPM004
     C                     ENDIF                                          CPM004
     C*
     C** ON CHANGE OF CUSTOMER OR PORTFOLIO REFERENCE
     C***********CSTN      IFNE WWCSTN                                    CPM004
     C           #CSTN     IFNE WWCSTN                                    CPM004
     C           PTFR      ORNE WWPTFR
     C                     EXSR #BD
     C                     MOVE PNPTCY    WWPTCY
     C                     MOVE PNPCDP    WWPCDP
     C                     END
     C****                                                                056460
     C***IF PERFORMANCE START DATE IS *GT EVENT CONTROL DATE DO NOT       056460
     C***EXTRACT DETAILS FOR ACCOUNT KEY                                  056460
     C****       PNPSDT    IFGT WWECD                                     056460
     C****       PNRECI    OREQ '*'                                       056460
     C****                 GOTO #BFA1                                     056460
     C****                 END                                            056460
     C*                                                                   056460
     C** TERMINATE PROCESSING IF PORTFOLIO PERFORMANCE REQUIRED FOR       056460
     C** FOR NEITHER OF PORTFOLIO AND POOL PORTFOLIO                      056460
     C           WWPORT    IFEQ 'N'                                       056460
     C           WWPOOL    ANDEQ'N'                                       056460
     C           WW9998    ANDEQ'N'                                       CPM005
     C           WW9999    ANDEQ'N'                                       CPM005
     C                     GOTO #BFA1                                     056460
     C                     END                                            056460
     C*
     C** ON CHANGE OF SECURITY OBTAIN NEW DETAILS
     C           SESH      IFNE WWSESH
     C                     EXSR #BC
     C                     MOVE NMCY      KCCY
     C                     MOVE NMCY      MKCCY   3                       51969
     C                     END
     C*
     C***********KCCY      IFNE WWKCCY                                    51969
     C           MKCCY     IFNE WWKCCY                                    51969
     C*
     C***ACCESS*CURRENCY*DETAILS*FOR*NOMINAL*CURRENCY*ON*PMSEKEY*******   S01486
     C** ACCESS CURRENCY DETAILS FOR NOMINAL CURRENCY ON PMSEKYL0         S01486
     C                     EXSR #BA
     C*
     C** SET UP NOMINAL CURRENCY DECIMAL PLACES
     C                     Z-ADDA6NBDP    WWDANB
     C                     Z-ADDA6SPRT    WWSPRT 138
     C                     MOVE A6MDIN    WWMDIN  1
     C                     END
     C*
     C***SET*UP*INVESTMENT*TYPE*FROM*ACCOUNT*KEY*ON*FILE*PMSEKEY*******   S01486
     C*  SET UP INVESTMENT TYPE FROM ACCOUNT KEY ON FILE PMSEKYL0         S01486
     C                     MOVELACKY      WWINT2
     C*
     C********** KCCY      IFNE WWKCC1                                    51969
     C           MKCCY     IFNE WWKCC1                                    51969
     C           WWINT2    ORNE WWINT1
     C*
     C** ACCESS INVESTMENT TYPE DETAILS FROM FILE INVTP
     C                     EXSR #BB
     C                     END
     C*
     C** PERFORM APPROPRIATE SUBROUTINE TO GENERATE EVENTS FOR TRADES,
     C** DEPOT MOVEMENTS AND POSITION SETTLEMENTS
     C***********ACKY1     IFEQ P9TVPS                                    S01486
     C           ACKY1     IFEQ FCTVPS                                    S01486
     C           ACKY2     IFEQ 'P'
     C           ACKY2     OREQ 'S'
     C           ACKY4     IFEQ 'CV'
     C                     EXSR #BFAA
     C                     GOTO #BFA1
     C                     END
     C                     END
     C                     END
     C*
     C           ACKY1     IFEQ 'L'                                       46386
     C                     EXSR #BFAB                                     46386
     C                     GOTO #BFA1                                     46386
     C                     END
     C*                                                                   46386
     C                     EXSR #BFAC                                     46386
     C*
     C           #BFA1     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BFAA    - GENERATE TRADE PERFORMANCE EVENTS                     *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      * ZCCYCN   -                                                       *
      * ZFXAVP   -                                                       *
      **#ZB******-*WRITE*PERFORMANCE*EVENT*TO*PF/PMPTRAPP**************  *S01486
      * #ZB      - WRITE PERFORMANCE EVENT TO PF/PMPTRAPD                *S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTRFR   -                                                       *
      * WWTRNB   -                                                       *
      * WWTTYP   -                                                       *
      * WWCPTC   -                                                       *
      * WWCCY    -                                                       *
      * WWACIN   -                                                       *
      * WWPPYT   -                                                       *
      * WWRAMT   -                                                       *
      * WWCVPC   -                                                       *
      * WWDANB   -                                                       *
      * WWPCDP   -                                                       *
      * WWMFXR   -                                                       *
      * WWREVI   -                                                       *
      * WWPFMC   -                                                       *
      * WWPFMS   -                                                       *
      * WWTAMT   -                                                       *
      * WWMPRC   -                                                       *
      * WWINIO   -                                                       *
      * WWCT1    -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BFAA     BEGSR
     C*
     C** MOVE NUMERIC FIELD INTO CHAR FIELD FOR CHAIN
     C                     MOVE TRFR      WWTRFR  6
     C                     ADD  1         QUSEQN
     C*
     C           RVRS      IFEQ '1'                        B1
     C           WWTRFR    CHAINSOBTR                50
     C           *IN50     IFEQ '1'                        B2
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD3         DBASE            ****************
     C***********          MOVEL'SOBTR   'DBFILE           * DBERROR  003 S01486
     C                     MOVE 'SOBTR   'DBFILE           * DBERROR  003 S01486
     C                     MOVELTRFR      DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E2
     C*
     C                     ELSE                            X1
     C           WWTRFR    CHAINTRADS                50
     C           *IN50     IFEQ '1'                        B2
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD4         DBASE            ****************
     C***********          MOVEL'TRADS   'DBFILE           * DBERROR  004 S01486
     C                     MOVE 'TRADS   'DBFILE           * DBERROR  004 S01486
     C                     MOVELTRFR      DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E2
     C                     END                             E1
     C*
     C                     MOVE TRFR      WWTRNB
     C                     MOVE TDTP      WWTTYP
     C                     MOVE 'N'       WWCPTC  1
     C******************** MOVE KCCY      WWCCY                           51969
     C                     MOVE MKCCY     WWCCY                           51969
     C*
     C           ACIN      IFNE *BLANKS
     C                     MOVE ACIN      WWACIN  1
     C*                                                                   52998
     C** FOR FLAT TRADES FOR WHITCH PURCHASED INTEREST HAS BEEN INPUT     52998
     C** OVERRIDE ACIN TO 'C'                                             52998
     C           ACIN      IFEQ 'F'                                       52998
     C           ITRA      ANDNE0                                         52998
     C                     MOVE 'C'       WWACIN                          52998
     C                     END                                            52998
     C*                                                                   52998
     C                     ELSE
     C                     MOVE EXDV      WWACIN
     C                     END
     C*
     C                     MOVE 'N'       WWPPYT  1
     C                     Z-ADDNOML      WWRAMT 150
     C****                                                                107078
     C****ONVERT FX RATE NOMINAL TO SETTLEMENT CURRENCY TO MULTIPLY       107078
     C***RATE                                                             107078
     C****       TMDI      IFEQ 'M'                                       107078
     C***********          Z-ADDTDER      WWMFX1 138                       50406
     C****                 Z-ADDTDER      WWMFX1 308                50406 107078
     C****                 ELSE                                           107078
     C****       1         DIV  TDER      WWMFX1                          107078
     C****                 END                                            107078
     C*
     C** DETERMINE FX RATE SETTLEMENT TO PORTFOLIO CURRENCY
     C***********SETC      CHAINSDCURRL0             50                   S01486
     C************IN50     IFEQ '1'                        B3             S01486
     C***********          Z-ADD6         DBASE            ***************S01486
     C***********          MOVEL'SDCURRL0'DBFILE           * DBERROR  006 S01486
     C*                                                                   S01486
     C** Get currency details using access object                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C                     PARM SETC      P@CCY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C** Check if an error occurred                                       S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD5         DBASE            ***************S01486
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  005 S01486
     C                     MOVELSETC      DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E3
     C*
     C                     MOVE SETC      ZCCYF
     C                     Z-ADDA6NBDP    ZCDPF
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVE A6MDIN    ZMDINF
     C*
     C                     MOVE WSPTCY    ZCCYT
     C                     Z-ADDASNBDP    ZCDPT
     C                     Z-ADDASSPRT    ZRATET
     C                     MOVE ASMDIN    ZMDINT
     C****                 EXSR ZCCYCN                                    50406
     C                     EXSR ZCCYCD                                    50406
     C*
     C*******    ZCRSMD    IFEQ 'D'                        B3            107078
     C*******    1         DIV  ZCRSRT    WWMFX2 138                50406107078
     C*******    1         DIV  ZCRSRN    WWMFX2 308                50406107078
     C*******              ELSE                            X3            107078
     C*******              Z-ADDZCRSRT    WWMFX2                    50406107078
     C*******              Z-ADDZCRSRN    WWMFX2                    50406107078
     C*******              END                             E3            107078
     C*
     C** FX RATE NOMINAL TO PORTFOLIO CURRENCY = FX RATE NOMINAL TO
     C** SETTLEMENT CURRNCY X FX RATE SETTLEMENT TO PORTFOLIO CURRENCY
     C****       WWMFX1    MULT WWMFX2    WWMFXR                          107078
     C           TMDI      IFEQ 'M'                                       107078
     C           ZCRSRN    MULT TDER      WWMFXR                          107078
     C                     ELSE                                           107078
     C           ZCRSRN    DIV  TDER      WWMFXR                          107078
     C                     END                                            107078
      *                                                                   CPM005
      **  Determine FX rate nominal to customer base currency             CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B1             CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
     C                     MOVE WBPTCY    ZCCYT                           CPM005
     C                     Z-ADDWBNBDP    ZCDPT                           CPM005
     C                     Z-ADDWBSPRT    ZRATET                          CPM005
     C                     MOVE WBMDIN    ZMDINT                          CPM005
     C                     EXSR ZCCYCD                                    CPM005
      *                                                                   CPM005
     C           TMDI      IFEQ 'M'                        B2             CPM005
     C           ZCRSRN    MULT TDER      WMFXR9 308                      CPM005
     C                     ELSE                            X2             CPM005
     C           ZCRSRN    DIV  TDER      WMFXR9                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     END                             E1             CPM005
     C*
     C** SET UP REVERSAL INDICATOR
     C                     MOVE 'N'       WWREVI  1
     C           RVRS      IFEQ '1'                        B1
     C                     MOVE 'Y'       WWREVI
     C                     END                             E1
     C*
     C***SET*UP*FIELDS*FOR*OUTPUT*OF*A*NOMINAL*RECORD*TO*PMPTRAPP******   S01486
     C** SET UP FIELDS FOR OUTPUT OF A NOMINAL RECORD TO PMPTRAPD         S01486
     C                     MOVE ' N'      WWPFMC
     C                     MOVE *BLANKS   WWPFMS  2
     C                     Z-ADDNOML      WWTAMT
     C                     Z-ADDNOML      WWRAMT
     C                     Z-ADDPRIC      WWMPRC
     C                     ADD  RALL      WWMPRC
     C*
     C** CONVERT INTO UNIT PRICE
     C           SPBS      IFEQ 'P'
     C           WWMPRC    DIV  100       WWMPRC
     C                     END
     C*
     C** SET INCOMING/OUTGOING INDICATOR
     C                     MOVE 'I'       WWINIO
     C           WWTTYP    IFEQ 'TP'                       B1
     C                     MOVE 'O'       WWINIO
     C                     END                             E1
     C*                                                                   CPM004
     C                     EXSR SWINIO                                    CPM004
     C*                                                                   46386
     C** CHECK WHETHER SETTLEMENT ACCOUNT IN SAME PORTFOLIO AS TRADE      46386
     C                     Z-ADDSMTH      ZMETH                           46386
     C           TDTP      IFEQ 'TP'                                      46386
     C                     MOVE PYFM      ZSETI                           46386
     C                     ELSE                                           46386
     C                     MOVE PAYT      ZSETI                           46386
     C                     END                                            46386
     C**********           Z-ADDTCNR      ZCNUM                                         46386 CSD027
     C                     MOVE TCNR      ZCNUM                                               CSD027
     C                     MOVE SETC      ZCCY                            46386
     C                     MOVE SEBR      ZBRCA   3                       085862
     C                     EXSR ZSETAC                                    46386
     C                     EXSR #BFAD                                     53103
     C*                                                                   CPM004
     C* IF BANK PORTFOLIOS SUPPORTED                                      CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           PTFR      IFNE ZPTFR                                     CPM004
     C                     MOVE 'Y'       WWCPTC                          CPM004
     C                     END                                            CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C* IF CUSTOMER PORTFOLIOS SUPPORTED                                  CPM004
     C*                                                                   CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
     C*                                                                   46386
     C           ZMETH     IFEQ 4                                         059474
     C           ZMETH     OREQ 5                                         059474
     C           ZMETH     OREQ 14                                        059474
     C           ZMETH     OREQ 15                                        059474
     C                     MOVE 'Y'       WSRETL  1                       059474
     C                     ELSE                                           059474
     C                     MOVE 'N'       WSRETL                          059474
     C                     END                                            059474
     C           PTFR      IFNE ZPTFR                                     46386
     C           WSRETL    OREQ 'N'                                       059474
     C                     MOVE 'Y'       WWCPTC                          46386
     C                     END                                            46386
     C                     END                                            CPM004
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B1
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1   60                      056460
     C                     END                             E1
     C*
     C***SET*UP*FIELDS*FOR*OUTPUT*OF*AN*INTEREST*RECORD*TO*PMPTRAPP****   S01486
     C** SET UP FIELDS FOR OUTPUT OF AN INTEREST RECORD TO PMPTRAPD       S01486
     C           ITRA      IFNE 0                          B1
     C           ITRA      OREQ 0                                         107078
     C           TDCR      ANDNE0                                         107078
     C           TINA      ANDNE0                                         107078
     C                     MOVE 'IP'      WWPFMC
     C                     MOVE *BLANKS   WWPFMS
     C                     Z-ADD1         WWMPRC
     C*
     C********   ITRA      IFLT 0                          B2            097159
     C********   WWACIN    ANDEQ'X'                                 49753097159
     C********             Z-SUBITRA      WWTAMT                         097159
     C********             ELSE                            X2            097159
     C                     Z-ADDITRA      WWTAMT
     C********             END                             E2            097159
     C*
     C** SET INCOMING/OUTGOING INDICATOR
     C           WWTTYP    IFEQ 'TP'                       B2
     C                     MOVE 'O'       WWINIO
     C                     ELSE                            X2
     C                     MOVE 'I'       WWINIO
     C                     END                             E2
     C*                                                                   CPM004
     C                     EXSR SWINIO                                    CPM004
     C*
     C****       WWTAMT    IFNE 0                          B2       46386 107078
     C*
     C***WRITE*AN*INTEREST*RECORD*TO*PMPTRAPP**************************   S01486
     C** WRITE AN INTEREST RECORD TO PMPTRAPD                             S01486
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1   60                      056460
     C****                 END                             E2             107078
     C                     END                             E1
     C*
     C***SET*UP*FIELDS*FOR*OUTPUT*OF*FEE/COMMISSION*RECORD*TO*PMPTRAPP*   S01486
     C** SET UP FIELDS FOR OUTPUT OF FEE/COMMISSION RECORD TO PMPTRAPD    S01486
     C           TBCA      IFNE 0                          B1
     C           TCCA      ORNE 0
     C*
     C                     MOVE 'F '      WWPFMC
     C                     MOVE 'TR'      WWPFMS
     C                     Z-ADDTBCA      WWTAMT
     C                     ADD  TCCA      WWTAMT
     C*                                                                   107078
     C                     MOVE 'I'       WWINIO                          107078
     C           TDTP      IFEQ 'TS'                                      107078
     C           WWTAMT    ANDLT0                                         107078
     C           TDTP      OREQ 'TP'                                      107078
     C           WWTAMT    ANDGT0                                         107078
     C                     MOVE 'O'       WWINIO                          107078
     C                     END                                            107078
     C*
     C** USE ABSOLUTE VALUE OF CHARGES
     C           WWTAMT    IFLT 0
     C                     Z-SUBWWTAMT    WWTAMT
     C                     END
     C*
     C                     Z-ADD1         WWMPRC
     C****                 MOVE 'I'       WWINIO                          107078
     C*
     C           WWTAMT    IFNE 0                          B2
     C*
     C***WRITE*A*FEE*AND*COMMISSION*RECORD*TO*PMPTRAPP*****************   S01486
     C** WRITE A FEE AND COMMISSION RECORD TO PMPTRAPD                    S01486
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1                           056460
     C                     END                             E2
     C                     END                             E1
     C*
     C***SET*UP*FIELDS*FOR*OUTPUT*OF*CHARGE*RECORD*TO*PMPTRAPP*********   S01486
     C** SET UP FIELDS FOR OUTPUT OF CHARGE RECORD TO PMPTRAPD            S01486
     C           TCA1      IFNE 0                          B1
     C           TCA2      ORNE 0
     C           TCA3      ORNE 0
     C           TCA4      ORNE 0
     C/COPY WNCPYSRC,PM1510C002
     C*
     C                     MOVE 'C '      WWPFMC
     C                     MOVE 'TR'      WWPFMS
     C                     Z-ADDTCA1      WWTAMT
     C                     ADD  TCA2      WWTAMT
     C                     ADD  TCA3      WWTAMT
     C                     ADD  TCA4      WWTAMT
     C/COPY WNCPYSRC,PM1510C003
     C*                                                                   107078
     C                     MOVE 'I'       WWINIO                          107078
     C           TDTP      IFEQ 'TS'                                      107078
     C           WWTAMT    ANDLT0                                         107078
     C           TDTP      OREQ 'TP'                                      107078
     C           WWTAMT    ANDGT0                                         107078
     C                     MOVE 'O'       WWINIO                          107078
     C                     END                                            107078
     C*
     C** USE ABSOLUTE VALUE OF CHARGES
     C           WWTAMT    IFLT 0
     C                     Z-SUBWWTAMT    WWTAMT
     C                     END
     C*
     C                     Z-ADD1         WWMPRC
     C****                 MOVE 'I'       WWINIO                          107078
     C*
     C           WWTAMT    IFNE 0                          B2
     C*
     C***WRITE*A*CHARGE*RECORD*TO*PMPTRAPP*****************************   S01486
     C** WRITE A CHARGE RECORD TO PMPTRAPD                                S01486
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1                           056460
     C                     END                             E2
     C                     END                             E1
     C*
     C***SET*UP*FIELDS*FOR*OUTPUT*OF*TAX*RECORD*TO*PMPTRAPP************   S01486
     C** SET UP FIELDS FOR OUTPUT OF TAX RECORD TO PMPTRAPD               S01486
     C           TCA5      IFNE 0                          B1
     C           TCA6      ORNE 0
     C           TCA7      ORNE 0
     C           TAXA      ORNE 0
     C/COPY WNCPYSRC,PM1510C004
     C                     MOVE 'OT'      WWPFMC
     C                     MOVE *BLANKS   WWPFMS
     C                     Z-ADDTCA5      WWTAMT
     C                     ADD  TCA6      WWTAMT
     C                     ADD  TCA7      WWTAMT
     C/COPY WNCPYSRC,PM1510C005
     C                     ADD  TAXA      WWTAMT
     C/COPY WNCPYSRC,PM1510C006
     C*                                                                   107078
     C                     MOVE 'I'       WWINIO                          107078
     C           TDTP      IFEQ 'TS'                                      107078
     C           WWTAMT    ANDLT0                                         107078
     C           TDTP      OREQ 'TP'                                      107078
     C           WWTAMT    ANDGT0                                         107078
     C                     MOVE 'O'       WWINIO                          107078
     C                     END                                            107078
     C*
     C** USE ABSOLUTE VALUE OF CHARGES
     C           WWTAMT    IFLT 0
     C                     Z-SUBWWTAMT    WWTAMT
     C                     END
     C*
     C                     Z-ADD1         WWMPRC
     C****                 MOVE 'I'       WWINIO                          107078
     C           WWTAMT    IFNE 0                          B2
     C*
     C***WRITE*A*TAX*AND*CHARGE*RECORD*TO*PMPTRAPP*********************   S01486
     C** WRITE A TAX AND CHARGE RECORD TO PMPTRAPD                        S01486
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1                           056460
     C                     END                             E2
     C                     END                             E1
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BFAB    - GENERATE DEPOT MOVEMENT PERFORMANCE EVENTS            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      **#ZB******-*WRITE*PERFORMANCE*EVENT*TO*PF/PMPTRAPP**************  *S01486
      * #ZB      - WRITE PERFORMANCE EVENT TO PF/PMPTRAPD                *S01486
      * ZNCD     -                                                       *
      * ZAINSH   -                                                       *
      * ZCCYCN   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTRFR   -                                                       *
      * WWTRNB   -                                                       *
      * WWTTYP   -                                                       *
      * WWCCY    -                                                       *
      * WWMFXR   -                                                       *
      * WWACIN   -                                                       *
      * WWPPYT   -                                                       *
      * WWRAMT   -                                                       *
      * WWREVI   -                                                       *
      * WWPFMC   -                                                       *
      * WWPFMS   -                                                       *
      * WWTAMT   -                                                       *
      * WWMPRC   -                                                       *
      * WWINIO   -                                                       *
      * WWCPTC   -                                                       *
      * WWCT1    -                                                       *
      * WWECD    -                                                       *
      * WWDANB   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BFAB     BEGSR
     C*
     C                     MOVE 'Y'       WWDPMV  1                       056460
     C                     MOVE TRFR      WWTRFR
     C                     ADD  1         QUSEQN
     C                     MOVE *BLANKS   QUREPS                          073300
     C                     MOVE *BLANKS   QUREMI                          073300
     C           KL5       CHAINDPTMV                50
     C           *IN50     IFEQ '1'                        B1
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD6         DBASE            ****************
     C***********          MOVEL'DPTMV   'DBFILE           * DBERROR  006 S01486
     C                     MOVE 'DPTMV   'DBFILE           * DBERROR  006 S01486
     C                     MOVE *BLANKS   DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E1
     C*
     C***OBTAIN*ANY*CHARGES*ON*DEPOT*MOVEMENT**************************   S01486
     C***********KL5       CHAINDPTMVDX0             50                   S01486
     C/COPY WNCPYSRC,PM1510C007
     C*
     C** SET UP FIELDS OUTPUT FOR ALL DEPOT MOVEMENT EVENTS
     C           DPMV      IFEQ 'WI'                       B1
     C           DPMV      OREQ 'WO'
     C**********           Z-ADDTRFR      WWTRNB                                              CLE148
     C                     MOVELTRFR      WWTRNB                                              CLE148
     C                     MOVE DPMV      WWTTYP
     C******************** MOVE KCCY      WWCCY                           51969
     C                     MOVE MKCCY     WWCCY                           51969
     C***********SPMD      IFEQ 'M'                        B2             104301
     C***********          Z-ADDSPXR      WWMFXR                          104301
     C***********          END                             E2             104301
     C***********SPMD      IFNE 'M'                        B2             104301
     C***********SPXR      IFEQ 0                          B3             104301
     C***********          Z-ADD0         WWMFXR                          104301
     C***********          ELSE                            X3             104301
     C***********1         DIV  SPXR      WWMFXR                          104301
     C***********          END                             E3             104301
     C***********          END                             E2             104301
     C***********                                                         104301
     C***********WWMFXR    MULT 1000000000WWMFXR                    50406 104301
     C***********WWMFXR    MULT 1000000   WWMFXR                    50406 104301
     C*                                                                   104301
     C                     CALL 'AOCURRR0'                                104301
     C                     PARM *BLANKS   P@RTCD                          104301
     C                     PARM '*KEY'    P@OPTN                          104301
     C                     PARM WWCCY     P@CCY                           104301
     C           SDCURR    PARM SDCURR    DSSDY                           104301
      *                                                                   104301
     C           P@RTCD    IFNE *BLANKS                                   104301
     C           *LOCK     IN   LDA                                       104301
     C                     Z-ADD67        DBASE            ***************104301
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  067 104301
     C                     MOVELWWCCY     DBKEY            ***************104301
     C                     OUT  LDA                                       104301
     C                     EXSR *PSSR                                     104301
     C                     END                                            104301
     C*                                                                   104301
     C                     MOVE WWCCY     ZCCYF                           104301
     C                     Z-ADDA6NBDP    ZCDPF                           104301
     C                     Z-ADDA6SPRT    ZRATEF                          104301
     C                     MOVE A6MDIN    ZMDINF                          104301
      *                                                                   104301
     C                     MOVE WSPTCY    ZCCYT                           104301
     C                     Z-ADDASNBDP    ZCDPT                           104301
     C                     Z-ADDASSPRT    ZRATET                          104301
     C                     MOVE ASMDIN    ZMDINT                          104301
     C*                                                                   104301
     C                     EXSR ZCCYCD                                    104301
     C                     Z-ADDZCRSRN    WWMFXR                          104301
      *                                                                   CPM005
      **  Determine FX rate nominal to customer base currency if          CPM005
      **  record to be output for '9998' or '9999' portfolio              CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B2             CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
      *                                                                   CPM005
      **  Determine FX rate settlement to portfolio currency              CPM005
      *                                                                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM NMCY      P@CCY                           CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                    B3             CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD66        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  066 CPM005
     C                     MOVELNMCY      DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E3             CPM005
      *                                                                   CPM005
     C                     MOVE NMCY      ZCCYF                           CPM005
     C                     Z-ADDA6NBDP    ZCDPF                           CPM005
     C                     Z-ADDA6SPRT    ZRATEF                          CPM005
     C                     MOVE A6MDIN    ZMDINF                          CPM005
      *                                                                   CPM005
     C                     MOVE WBPTCY    ZCCYT                           CPM005
     C                     Z-ADDWBNBDP    ZCDPT                           CPM005
     C                     Z-ADDWBSPRT    ZRATET                          CPM005
     C                     MOVE WBMDIN    ZMDINT                          CPM005
      *                                                                   CPM005
     C                     EXSR ZCCYCD                                    CPM005
     C                     Z-ADDZCRSRN    WMFXR9 308                      CPM005
     C                     END                             E2             CPM005
     C*
     C                     MOVE 'C'       WWACIN
     C                     MOVE 'N'       WWPPYT
     C                     Z-ADDDPNA      WWRAMT
     C                     MOVE 'N'       WWREVI
     C*
     C***SET*UP*FIELDS*FOR*OUTPUT*OF*A*NOMINAL*RECORD*TP*PMPTRAPP******   S01486
     C** SET UP FIELDS FOR OUTPUT OF A NOMINAL RECORD TP PMPTRAPD         S01486
     C                     MOVE ' N'      WWPFMC
     C                     MOVE *BLANKS   WWPFMS
     C                     Z-ADDDPNA      WWTAMT
     C                     Z-ADDMKTP      WWMPRC
     C*
     C** CONVERT INTO UNIT PRICE
     C           SPBS      IFEQ 'P'
     C           WWMPRC    DIV  100       WWMPRC
     C                     END
     C*
     C           DPMV      IFEQ 'WI'                       B2
     C                     MOVE 'I'       WWINIO
     C                     ELSE                            X2
     C                     MOVE 'O'       WWINIO
     C                     END                             E2
     C*
     C****                 MOVE 'Y'       WWCPTC                          056990
     C                     MOVE CWDI      WWCPTC                          056990
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B2
     C                     MOVE 'Y'       WWIND   1                       CPM005
     C                     EXSR #ZB
     C                     MOVE 'N'       WWIND                           CPM005
     C****                 ADD  1         WWCT1                           056460
     C                     END                             E2
     C*
     C** IF SECURITY IS INTEREST BEARING CALCULATE AMOUNT OF INTEREST
     C** ADDED TO PORTFOLIO
     C           PROT      IFNE '2'                        B2
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C           PROT      ANDNE'6'
     C*
     C** PERFORM ROUTINE TO OUTPUT 'IP' RECORD
     C           CD01      IFNE 0                          B3
     C****       LCPN      ANDLTWWECD                            B08040   060971
     C****       FCPN      ANDLTBJRDNB                           060971   53103
     C           ITLD      ANDLTBJRDNB                                    53103
     C*
     C** DETERMINE NEXT COUPON DATE
     C                     Z-ADDWWECD     ECD     50
     C                     EXSR ZNCD
     C*                                                                   060971
     C** DETERMINE LAST COUPON DATE                                       060971
     C                     Z-ADDWWECD     ZECD                            060971
     C                     EXSR ZLCD                                      060971
     C*
     C** SET UP DETAILS FOR OUTPUT ON INTEREST RECORD
     C                     MOVE 'IP'      WWPFMC
     C                     MOVE *BLANKS   WWPFMS
     C                     Z-ADDDPNA      ZAMTP
     C****                 Z-ADDLCPN      ZFMDAT                          060971
     C                     Z-ADDZZLCD     ZFMDAT                          060971
     C                     Z-ADDWWECD     ZTODAT
     C                     MOVELSESH      ZSSNM
     C                     Z-ADDWWDANB    A6NBDP
     C                     EXSR ZAINSH
     C*
     C** SET TRANSACTION AMOUNT TO AMOUNT OUTPUT FROM SR/ZAINSH
     C                     Z-ADDZTOAI     WWTAMT
     C                     Z-ADD1         WWMPRC
     C*
     C           WWTTYP    IFEQ 'WI'                       B4
     C                     MOVE 'I'       WWINIO
     C                     ELSE                            X4
     C                     MOVE 'O'       WWINIO
     C                     END                             E4
     C*
     C****                 MOVE 'Y'       WWCPTC                          056990
     C                     MOVE CWDI      WWCPTC                          056990
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B4
     C                     MOVE 'Y'       WWIND                           CPM005
     C                     EXSR #ZB
     C                     MOVE 'N'       WWIND                           CPM005
     C****                 ADD  1         WWCT1   60                      056460
     C                     END                             E4
     C                     END                             E3
     C                     END                             E2
     C*
     C***OUTPUT*CHARGE*RECORD*TO*PF/PMPTRAPP***************************   S01486
     C** OUTPUT CHARGE RECORD TO PF/PMPTRAPD                              S01486
     C                     MOVE 'N'       WWDPMV                          059474
     C***********DPCHAM    IFNE 0                          B2             S01486
     C           DCHA      IFNE 0                          B2             S01486
     C                     MOVE 'C '      WWPFMC
     C*
     C           WWTTYP    IFEQ 'WI'                       B3
     C                     MOVE 'CI'      WWPFMS
     C                     ELSE                            X3
     C                     MOVE 'CO'      WWPFMS
     C                     END                             E3
     C*
     C***********          Z-ADDDPCHAM    WWTAMT                          S01486
     C                     Z-ADDDCHA      WWTAMT                          S01486
     C/COPY WNCPYSRC,PM1510C008
     C                     Z-ADD1         WWMPRC
     C                     MOVE 'I'       WWINIO
     C                     MOVE 'N'       WWCPTC
     C*
     C** FX RATE TO BE OUTPUT IS CURRENT FX RATE FROM CHARGE CURRENCY
     C** TO PORTFOLIO CURRENCY
     C***********DPCHCY    CHAINSDCURRL0             50                   S01486
     C************IN50     IFEQ '1'                        B3             S01486
     C*                                                                   S01486
     C** Get currency details using access object                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C                     PARM DCCE      P@CCY                           S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C** Check if an error occurred                                       S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD5         DBASE            ****************
     C***********          MOVEL'SDCURRL0'DBFILE           * DBERROR  005 S01486
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  005 S01486
     C***********          MOVELDPCHCY    DBKEY            ***************S01486
     C                     MOVELDCCE      DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E3
     C*
     C                     MOVE A6CYCD    ZCCYF
     C                     Z-ADDA6NBDP    ZCDPF
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVE A6MDIN    ZMDINF
     C*
     C                     MOVE WSPTCY    ZCCYT
     C                     Z-ADDASNBDP    ZCDPT
     C                     Z-ADDASSPRT    ZRATET
     C                     MOVE ASMDIN    ZMDINT
     C****                 EXSR ZCCYCN                                    50406
     C                     EXSR ZCCYCD                                    50406
     C*
     C           ZCRSMD    IFEQ 'D'                        B3
     C***********1         DIV  ZCRSRT    WWMFXR                          50406
     C           1         DIV  ZCRSRN    WWMFXR                          50406
     C                     ELSE                            X3
     C****                 Z-ADDZCRSRT    WWMFXR                          50406
     C                     Z-ADDZCRSRN    WWMFXR                          50406
     C                     END                             E3
      *                                                                   CPM005
      **  If record to be output for '9998' or '9999' portfolio           CPM005
      **  calculate FX rate to base currency                              CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B3             CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
     C                     MOVE WBPTCY    ZCCYT                           CPM005
     C                     Z-ADDWBNBDP    ZCDPT                           CPM005
     C                     Z-ADDWBSPRT    ZRATET                          CPM005
     C                     MOVE WBMDIN    ZMDINT                          CPM005
     C                     EXSR ZCCYCD                                    CPM005
     C                     Z-ADDZCRSRN    WMFXR9                          CPM005
     C                     END                             E3             CPM005
     C*                                                                   46386
     C** CHECK WHETHER SETTLEMENT ACCOUNT IN SAME PORTFOLIO AS DEPOT      46386
     C** MOVEMENT FOR WI                                                  46386
     C                     MOVE 'N'       WWCPTC                          46386
     C           DPMV      IFEQ 'WI'                       B3             46386
     C           DPMV      OREQ 'WO'                                      073300
     C***********          Z-ADDDPSTTP    ZMETH                    46386  S01486
     C***********          MOVE DPSTAC    ZSETI                    46386  S01486
     C                     Z-ADDDCSE      ZMETH                           S01486
     C                     MOVE DCAT      ZSETI                           S01486
     C**********           Z-ADDDPBN      ZCNUM                                         46386 CSD027
     C                     MOVE DPBN      ZCNUM                                               CSD027
     C***********          MOVE DPCHCY    ZCCY                     46386  S01486
     C                     MOVE DCCE      ZCCY                            S01486
     C                     MOVE DCAB      ZBRCA                           085862
     C                     EXSR ZSETAC                                    46386
     C                     EXSR #BFAD                                     53103
     C*                                                                   46386
     C***********DPSTTP    IFEQ 4                                  059474 S01486
     C***********DPSTTP    OREQ 5                                  059474 S01486
     C***********DPSTTP    OREQ 14                                 059474 S01486
     C***********DPSTTP    OREQ 15                                 059474 S01486
     C           DCSE      IFEQ 4                                         S01486
     C           DCSE      OREQ 5                                         S01486
     C           DCSE      OREQ 14                                        S01486
     C           DCSE      OREQ 15                                        S01486
     C                     MOVE 'Y'       WSRETL  1                       059474
     C                     ELSE                                           059474
     C                     MOVE 'N'       WSRETL                          059474
     C                     END                                            059474
     C           PTFR      IFNE ZPTFR                      B4             46386
     C           WSRETL    OREQ 'N'                                       059474
     C                     MOVE 'Y'       WWCPTC                          46386
     C                     END                             E4             46386
     C                     END                             E3             46386
     C*
     C***WRITE*A*CHARGE*RECORD*TO*PMPTRAPP*****************************   S0148%
     C** WRITE A CHARGE RECORD TO PMPTRAPD                                S01486
     C           WWTAMT    IFNE 0                          B3
     C                     MOVE WWCCY     WRCCY   1                       073300
     C                     MOVE DCCE      WWCCY                           073300
     C                     MOVE 'Y'       WWIND                           CPM005
     C                     EXSR #ZB
     C                     MOVE 'N'       WWIND                           CPM005
     C****                 ADD  1         WWCT1                           056460
     C                     MOVE WRCCY     WWCCY                           073300
     C                     END                             E3
     C                     END                             E2
     C                     END                             E1
     C*
     C                     MOVE 'N'       WWDPMV  1                       056460
     C*                                                                   056460
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BFAC    - GENERATE POSITION SETTLEMENT PERFORMANCE EVENTS       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      * ZCCYCN   -                                                       *
      * #ZD      - CONVERT POSITION SETTLEMENT AMOUNTS TO NOMINAL CCY    *
      **#ZB******-*WRITE*PERFORMANCE*EVENT*TO*PF/PMPTRAPP**************  *S01486
      * #ZB      - WRITE PERFORMANCE EVENT TO PF/PMPTRAPD                *S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWPBCH   -                                                       *
      * WWPTFR   -                                                       *
      * WWCCY    -                                                       *
      * WWTRNB   -                                                       *
      * WWCPTC   -                                                       *
      * WWACIN   -                                                       *
      * WWPPYT   -                                                       *
      * WWRAMT   -                                                       *
      * WWREVI   -                                                       *
      * WWPEVT   -                                                       *
      * WWTTYP   -                                                       *
      * WWPSCD   -                                                       *
      * WWFXSP   -                                                       *
      * WWNMVL   -                                                       *
      * WWPSXR   -                                                       *
      * WWMFXR   -                                                       *
      * WWSEXR   -                                                       *
      * WWPFMC   -                                                       *
      * WWPFMS   -                                                       *
      * WWTAMT   -                                                       *
      * WWINAM   -                                                       *
      * WWMPRC   -                                                       *
      * WWINIO   -                                                       *
      * WWCT1    -                                                       *
      * WWPDUD   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BFAC     BEGSR
     C*                                                                   46386
     C** IF 'SA' ACCOUNT KEY AND EVENT AMOUNT NON-ZERO TERMINATE ROUTINE  46386
     C           ACKY4     IFEQ 'SA'                                      46386
     C           EVAM      ANDNE0                                         46386
     C           ACKY4     OREQ 'SA'                                      48449
     C           PEV1      ANDNE'MT'                                      48449
     C           S01496    ANDNE'Y'                                       S01496
     C           ACKY4     OREQ 'SA'                                      S01496
     C           PEV1      ANDNE'MT'                                      S01496
     C           PEV1      ANDNE'RC'                                      S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C                     GOTO #BFAC1                                    46386
     C                     END                                            46386
     C*
     C** SET UP KEY TO ACCESS POSITION SETTLEMENT DETAILS
     C***********          Z-ADDBRCH      WWPBCH                          S01486
     C                     MOVE BRHA      WWPBCH                          S01486
     C                     MOVE SESH      W1SESH
     C**********           Z-ADDCSTN      W1CSTN                                              CSD027
     C                     MOVE CSTN      W1CSTN                                              CSD027
     C                     MOVE PTFR      WWPTFR
     C                     MOVE NMCY      WWCCY
     C                     ADD  1         QUSEQN
     C*
     C** SET UP FIELDS COMMON TO ALL POSITION SETTTLEMENTS
     C**********           Z-ADD0         WWTRNB                                              CLE148
     C                     MOVEL*BLANKS   WWTRNB                                              CLE148
     C                     MOVE 'N'       WWCPTC
     C                     MOVE 'C'       WWACIN
     C                     MOVE 'N'       WWPPYT
     C                     Z-ADD0         WWRAMT
     C                     MOVE 'N'       WWREVI
     C*
     C           ACKY4     IFEQ 'DI'                       B1
     C*
     C           PROT      IFEQ '4'                        B2
     C           PROT      OREQ '7'
     C                     MOVE 'DV'      WWPEVT
     C                     MOVE 'DV'      WWTTYP
     C                     ELSE                            X2
     C                     MOVE 'CP'      WWPEVT
     C                     MOVE 'CP'      WWTTYP
     C                     END                             E2
     C                     END                             E1
     C*
     C           ACKY4     IFEQ 'PP'
     C                     MOVE 'PP'      WWPEVT
     C                     MOVE 'PP'      WWTTYP
     C                     END
     C*
     C           ACKY4     IFEQ 'CV'
     C           ACKY4     OREQ 'SA'                                      46386
     C           EVAM      ANDEQ0                                         46386
     C                     MOVE 'MT'      WWPEVT
     C                     MOVE 'MT'      WWTTYP
     C                     END
     C*
     C** OBTAIN POSITION SETTLEMENT DETAILS
     C           S01496    IFEQ 'Y'                                       S01496
     C                     MOVE WWPEVT    WWRC    2                       S01496
     C                     END                                            S01496
     C           FCPORS    IFNE 'B'                                       CPM004
     C***********KL6       CHAINPMPOSET              50                   S01486
     C***********KL6       CHAINPMPOSDL2             50            S01486 107078
     C           KL6       SETGTPMPOSDL2             50                   107078
     C           KL6       REDPEPMPOSDL2                 50               107078
     C*                                                                   S01496
     C           *IN50     IFEQ '1'                                       S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C                     MOVE 'RC'      WWPEVT                          S01496
     C***********KL6       CHAINPMPOSDL2             50            S01486 107078
     C           KL6       SETGTPMPOSDL2             50                   107078
     C           KL6       REDPEPMPOSDL2                 50               107078
     C                     END                                            S01496
     C                     END                                            CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           KL6BNK    CHAINPOSEB1F              50                   CPM004
     C                     END                                            CPM004
     C*                                                                   S01496
     C           *IN50     IFEQ '1'                        B1
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD7         DBASE            ****************
     C***********          MOVEL'PMPOSET 'DBFILE           * DBERROR  007 S01486
     C                     MOVE 'PMPOSDL2'DBFILE           * DBERROR  007 S01486
     C                     MOVE *BLANKS   DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E1
     C*
     C***OBTAIN*ANY*CHARGES*ON*DEPOT*MOVEMENT**************************   S01486
     C***********KL6       CHAINPMPOSETX             50                   S01486
     C/COPY WNCPYSRC,PM1510C009
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C                     MOVE WWRC      WWPEVT                          S01496
     C                     END                                            S01496
     C*
     C** OBTAIN FX RATE FROM SETTLEMENT CURRENCY TO PORTFOLIO CURRENCY
     C***********PSCU      CHAINSDCURRL0             50                   S01486
     C************IN50     IFEQ '1'                        B3             S01486
     C*                                                                   S01486
     C** Get currency details using access object                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C                     PARM PSCU      P@CCY                           S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C** Check if an error occurred                                       S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD5         DBASE            ****************
     C***********          MOVEL'SDCURRL0'DBFILE           * DBERROR  005 S01486
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  005 S01486
     C                     MOVELPSCU      DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E3
     C*
     C                     MOVE A6CYCD    ZCCYF
     C                     Z-ADDA6NBDP    ZCDPF
     C                     Z-ADDA6NBDP    WWPSCD  10
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVE A6MDIN    ZMDINF
     C*
     C                     MOVE WSPTCY    ZCCYT
     C                     Z-ADDASNBDP    ZCDPT
     C                     Z-ADDASSPRT    ZRATET
     C                     MOVE ASMDIN    ZMDINT
     C****                 EXSR ZCCYCN                                    50406
     C                     EXSR ZCCYCD                                    50406
     C*
     C** SAVE RATE FROM SETTLEMENT TO PORTFOLIO CURRENCY
     C           ZCRSMD    IFEQ 'M'
     C****                 Z-ADDZCRSRT    WWFXSP 138                      50406
     C                     Z-ADDZCRSRN    WWFXSP 308                      50406
     C                     ELSE
     C           1         DIV  ZCRSRT    WWFXSP
     C                     END
      *                                                                   CPM005
      **  If record required for 9998 or 9999 portfolio, calculate rate   CPM005
      **  settlement to base currency                                     CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                                       CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
     C                     MOVE WBPTCY    ZCCYT                           CPM005
     C                     Z-ADDWBNBDP    ZCDPT                           CPM005
     C                     Z-ADDWBSPRT    ZRATET                          CPM005
     C                     MOVE WBMDIN    ZMDINT                          CPM005
     C                     EXSR ZCCYCD                                    CPM005
     C                     Z-ADDZCRSRN    WFXSP9 308                      CPM005
     C                     END                                            CPM005
     C*
     C** DETERMINE FX RATE FROM NOMINAL TO PORTFOLIO CURRENCY.
     C** NOTE: FOR EVENTS TYPE 'PP' AND 'MT' CURRENCY ON POSETD IS
     C** NOMINAL CURRENCY. FOR EVENTS TYPE 'CP' AND 'DV' CURRENCY IS
     C** ON POSETD IS VALUE CURRENCY WHICH MAY BE DIFFERENT TO THE
     C** NOMINAL CURRENCY
     C                     MOVE 'N'       WWNMVL  1
     C           PEVT      IFEQ 'MT'                       B1
     C           PEVT      OREQ 'RC'                                      S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C           PEVT      OREQ 'PP'
     C           PEVT      OREQ 'DV'
     C           PNCY      ANDEQNMCY
     C           PEVT      OREQ 'CP'
     C           PNCY      ANDEQNMCY
     C*
     C                     MOVE 'Y'       WWNMVL
     C*
     C** IF NOMINAL CURRENCY EQUAL TO EVENT CURRENCY FX RATE TO OUTPUT
     C** IS RATE NOMINAL TO PORTFOLIO CURRENCY VIA SETTLEMENT CURRENCY
     C** THIS IS OBTAINED BY MULTIPLYING THE SETTLEMENT EXCHANGE RATE
     C** FROM THE POSITION SETTLEMENT BY THE THE CURRENT FX RATE FROM
     C** SETTLEMENT CURRENCY TO PORTFOLIO CURRENCY
     C           PMDI      IFEQ 'D'                        B2
     C****       1         DIV  PSXR      WWPSXR 138                      107078
     C           WWFXSP    DIV  PSXR      WWMFXR                          107078
     C                     ELSE                            X2
     C****                 Z-ADDPSXR      WWPSXR                          107078
     C           WWFXSP    MULT PSXR      WWMFXR                          107078
     C                     END                             E2
     C****       WWPSXR    MULT WWFXSP    WWMFXR                          107078
      *                                                                   CPM005
      **  If performance required for 9998 or 9999 portfolios calculate   CPM005
      **  rate nominal to customer base ccy via settlement currency       CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                                       CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
      *                                                                   CPM005
     C           PMDI      IFEQ 'D'                                       CPM005
     C           WFXSP9    DIV  PSXR      WMFXR9                          CPM005
     C                     ELSE                                           CPM005
     C           WFXSP9    MULT PSXR      WMFXR9                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     END                                            CPM005
     C*
     C                     ELSE                            X1
     C*
     C** AS THE NOMINAL CURRENCY IS NOT EQUAL TO THE VALUE CURRENCY THE
     C** FX RATE IS THE PRODUCT OF:
     C** 1  FX RATE FROM NOMINAL CURRENCY TO VALUE CURRENCY, SECTYD
     C** 2  FX RATE VALUE CURRENCY TO SETTLEMENT CURRENCY
     C** 3  FX RATE SETTLEMENT CURRENCY TO PORTFOLIO CURRENCY
     C           SMDI      IFEQ 'D'                        B2
     C           1         DIV  SEXR      WWSEXR 138
     C                     ELSE                            X2
     C                     Z-ADDSEXR      WWSEXR
     C                     END                             E2
     C*
     C           PMDI      IFEQ 'D'                        B2
     C********   1         DIV  PSXR      WWPSXR                          107078
     C           1         DIV  PSXR      WWPSXR 138                      107078
     C                     ELSE                            X2
     C                     Z-ADDPSXR      WWPSXR
     C                     END                             E2
     C*
     C           WWPSXR    MULT WWSEXR    WWPSXR
     C           WWPSXR    MULT WWFXSP    WWMFXR
      *                                                                   CPM005
      **  If performance required for 9998 or 9999 portfolio              CPM005
      **  determine rate nominal currency to customer currency            CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B2             CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
     C           WWPSXR    MULT WWSEXR    WWPSXR                          CPM005
     C           WWPSXR    MULT WFXSP9    WMFXR9                          CPM005
     C                     END                             E2             CPM005
     C                     END                             E1
     C*                                                                   46386
     C** CHECK WHETHER SETTLEMENT ACCOUNT IN SAME PORTFOLIO AS POSITION   46386
     C** SETTLEMENT                                                       46386
     C                     MOVE 'N'       WWCPTC                          46386
     C                     Z-ADDPSMT      ZMETH                           46386
     C                     MOVE PSEA      ZSETI                           46386
     C**********           Z-ADDPCPY      ZCNUM                                         46386 CSD027
     C                     MOVE PCPY      ZCNUM                                               CSD027
     C                     MOVE PSCU      ZCCY                            46386
     C                     MOVE SEBR      ZBRCA                           085862
     C                     EXSR ZSETAC                                    46386
     C                     EXSR #BFAD                                     53103
     C*                                                                   CPM004
     C* IF BANK PORTFOLIOS SUPPORTED                                      CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           PTFR      IFNE ZPTFR                                     CPM004
     C                     MOVE 'Y'       WWCPTC                          CPM004
     C                     END                                            CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C* IF CUSTOMER PORTFOLIOS SUPPORTED                                  CPM004
     C*                                                                   CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
     C*                                                                   46386
     C           PSMT      IFEQ 4                                         059474
     C           PSMT      OREQ 5                                         059474
     C           PSMT      OREQ 14                                        059474
     C           PSMT      OREQ 15                                        059474
     C                     MOVE 'Y'       WSRETL  1                       059474
     C                     ELSE                                           059474
     C                     MOVE 'N'       WSRETL                          059474
     C                     END                                            059474
     C           PTFR      IFNE ZPTFR                      B1             46386
     C           WSRETL    OREQ 'N'                                       059474
     C                     MOVE 'Y'       WWCPTC                          46386
     C                     END                             E1             46386
     C                     END                                            CPM004
     C*
     C** SET UP FIELDS FOR OUTPUT OF A COUPON PAYMENT RECORD
     C           WWTTYP    IFEQ 'CP'                       B1
     C                     MOVE 'IR'      WWPFMC
     C                     MOVE *BLANKS   WWPFMS
     C*
     C** IF NOMINAL AND VALUE CURRENCY ARE THE SAME SET TO AMOUNT DUE
     C           WWNMVL    IFEQ 'Y'                        B2
     C                     Z-ADDPAMD      WWTAMT
     C                     ELSE                            X2
     C*
     C** CONVERT AMOUNT DUE FROM VALUE CURRENCY TO NOMINAL CURRENCY
     C** VIA SR/#ZD
     C                     Z-ADDPAMD      WWINAM 150
     C                     EXSR #ZD
     C                     Z-ADDWWTAM1    WWTAMT
     C                     END                             E2
     C*
     C                     Z-ADD1         WWMPRC
     C*
     C           PNMP      IFGT 0                          B2
     C                     MOVE 'O'       WWINIO
     C                     ELSE                            X2
     C                     MOVE 'I'       WWINIO
     C                     END                             E2
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B2
     C           WWTAMT    OREQ 0                                         46386
     C           ACKY4     ANDEQ'SA'                                      46386
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1                           056460
     C                     END                             E2
     C                     END                             E1
     C*
     C** SET UP FIELDS FOR OUTPUT OF A DIVIDEND RECORD
     C           WWTTYP    IFEQ 'DV'                       B1
     C                     MOVE 'DV'      WWPFMC
     C                     MOVE *BLANKS   WWPFMS
     C*
     C** IF NOMINAL AND VALUE CURRENCY ARE THE SAME SET TO AMOUNT DUE
     C           WWNMVL    IFEQ 'Y'                        B2
     C                     Z-ADDPAMD      WWTAMT
     C                     ELSE                            X2
     C*
     C** CONVERT AMOUNT DUE FROM VALUE CURRENCY TO NOMINAL CURRENCY
     C** VIA SR/#ZD
     C                     Z-ADDPAMD      WWINAM
     C                     EXSR #ZD
     C                     Z-ADDWWTAM1    WWTAMT
     C                     END                             E2
     C*
     C                     Z-ADD1         WWMPRC
     C*
     C           PNMP      IFGT 0                          B2
     C                     MOVE 'O'       WWINIO
     C                     ELSE                            X2
     C                     MOVE 'I'       WWINIO
     C                     END                             E2
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B2
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1   60                      056460
     C                     END                             E2
     C                     END                             E1
     C*
     C** SET UP FIELDS FOR OUTPUT OF A PART PAYMENT RECORD
     C           WWTTYP    IFEQ 'PP'                       B1
     C                     MOVE ' N'      WWPFMC
     C                     MOVE *BLANKS   WWPFMS
     C*
     C** TRANSACTION AMOUNT IS ABSOLUTE VALUE OF NOMINAL POSITION
     C           PNMP      IFGT 0                          B2
     C                     Z-ADDPNMP      WWTAMT
     C                     MOVE 'I'       WWINIO
     C                     ELSE                            X2
     C                     Z-SUBPNMP      WWTAMT
     C                     MOVE 'O'       WWINIO
     C                     END                             E2
     C*
     C** OBTAIN PART PAYMENT PRICE FROM LF/SECET
     C                     Z-ADDPDUD      WWPDUD
     C           KL7       CHAINSECET                50
     C           *IN50     IFEQ '1'                        B2
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD8         DBASE            ****************
     C***********          MOVEL'SECET   'DBFILE           * DBERROR  008 S01486
     C                     MOVE 'SECET   'DBFILE           * DBERROR  008 S01486
     C                     MOVE *BLANKS   DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E2
     C*
     C** CONVERT PERCENTAGE PRICE TO A UNIT PRICE
     C           SPBS      IFEQ 'P'                        B2
     C           SDPC      DIV  100       WWMPRC
     C                     ELSE                            X2
     C                     Z-ADDSDPP      WWMPRC
     C                     END                             E2
     C*
     C                     MOVE 'Y'       WWPPYT
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B2
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1                           056460
     C                     END                             E2
     C                     MOVE 'N'       WWPPYT
     C                     END                             E1
     C*
     C** SET UP FIELDS FOR OUTPUT OF A MATURITY RECORD
     C           WWTTYP    IFEQ 'MT'                       B1
     C           WWTTYP    OREQ 'RC'                                      S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C                     MOVE ' N'      WWPFMC
     C                     MOVE *BLANKS   WWPFMS
     C*
     C** TRANSACTION AMOUNT IS ABSOLUTE VALUE OF NOMINAL POSITION
     C           PNMP      IFGT 0                          B2
     C                     Z-ADDPNMP      WWTAMT
     C                     MOVE 'O'       WWINIO
     C                     ELSE                            X2
     C                     Z-SUBPNMP      WWTAMT
     C                     MOVE 'I'       WWINIO
     C                     END                             E2
     C*
     C** OBTAIN PART PAYMENT PRICE FROM LF/SECET
     C                     Z-ADDPDUD      WWPDUD
     C                     MOVE 'RC'      WWPEVT
     C           KL7       CHAINSECET                50
     C*
     C** IF REDEMPTION CALL FOUND USE PRICE FROM RECORD
     C           *IN50     IFEQ '1'                        B2
     C                     MOVE 'RP'      WWPEVT
     C           KL7       CHAINSECET                50
     C                     END                             E2
     C*
     C** CONVERT PERCENTAGE PRICE TO A UNIT PRICE
     C           *IN50     IFEQ '0'                        B2
     C           SPBS      IFEQ 'P'                        B3
     C           SDRP      DIV  100       WWMPRC
     C                     ELSE                            X3
     C                     Z-ADDSDRP      WWMPRC
     C                     END                             E3
     C*
     C** OTHERWISE IF NO MATURITY PRICE FOUND ASSUME PRICE OF 100% OTHER  46386
     C** THAN FOR AN OPTION EXPIRING WITHOUT BEING EXERCISED              46386
     C                     ELSE                            X2
     C           EVAM      IFEQ 0                          B3             46386
     C                     Z-ADD0         WWMPRC                          46386
     C                     ELSE                            X3             46386
     C                     Z-ADD1         WWMPRC
     C                     END                             E3             46386
     C                     END                             E2
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B2
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1   60                      056460
     C                     END                             E2
     C                     END                             E1
     C*
     C** SET UP FIELDS FOR OUTPUT OF A CHARGES RECORD
     C           PCHA      IFNE 0                          B1
     C                     MOVE 'C '      WWPFMC
     C*
     C           WWTTYP    IFEQ 'CP'                       B2
     C                     MOVE 'IR'      WWPFMS
     C                     END                             E2
     C*
     C           WWTTYP    IFEQ 'DV'                       B2
     C                     MOVE 'DV'      WWPFMS
     C                     END                             E2
     C*
     C           WWTTYP    IFEQ 'PP'                       B2
     C           WWTTYP    OREQ 'MT'
     C           WWTTYP    OREQ 'RC'                                      S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C                     MOVE 'TR'      WWPFMS
     C                     END                             E2
     C*
     C** IF NOMINAL AND VALUE CURRENCY ARE THE SAME SET TO AMOUNT DUE
     C           WWNMVL    IFEQ 'Y'                        B2
     C                     Z-ADDPCHA      WWTAMT
     C/COPY WNCPYSRC,PM1510C010
     C                     ELSE                            X2
     C*
     C** CONVERT AMOUNT DUE FROM VALUE CURRENCY TO NOMINAL CURRENCY
     C** VIA SR/#ZD
     C                     Z-ADDPCHA      WWINAM
     C/COPY WNCPYSRC,PM1510C011
     C                     EXSR #ZD
     C                     Z-ADDWWTAM1    WWTAMT
     C                     END                             E2
     C*
     C                     Z-ADD1         WWMPRC
     C*
     C                     MOVE 'I'       WWINIO
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B2
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1                           056460
     C                     END                             E2
     C                     END                             E1
     C*
     C** SET UP FIELDS FOR OUTPUT OF A FEES & COMMISSIONS RECORD
     C           PCAM      IFNE 0                          B1
     C                     MOVE 'F '      WWPFMC
     C*
     C           WWTTYP    IFEQ 'CP'                       B2
     C                     MOVE 'IR'      WWPFMS
     C                     END                             E2
     C*
     C           WWTTYP    IFEQ 'DV'                       B2
     C                     MOVE 'DV'      WWPFMS
     C                     END                             E2
     C*
     C           WWTTYP    IFEQ 'PP'                       B2
     C           WWTTYP    OREQ 'MT'
     C           WWTTYP    OREQ 'RC'                                      S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C                     MOVE 'TR'      WWPFMS
     C                     END                             E2
     C*
     C** IF NOMINAL AND VALUE CURRENCY ARE THE SAME SET TO AMOUNT DUE
     C           WWNMVL    IFEQ 'Y'                        B2
     C                     Z-ADDPCAM      WWTAMT
     C/COPY WNCPYSRC,PM1510C012
     C                     ELSE                            X2
     C*
     C** CONVERT AMOUNT DUE FROM VALUE CURRENCY TO NOMINAL CURRENCY
     C** VIA SR/#ZD
     C                     Z-ADDPCAM      WWINAM
     C/COPY WNCPYSRC,PM1510C013
     C                     EXSR #ZD
     C                     Z-ADDWWTAM1    WWTAMT
     C                     END                             E2
     C*
     C                     Z-ADD1         WWMPRC
     C*
     C                     MOVE 'I'       WWINIO
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B2
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1   60                      056460
     C                     END                             E2
     C                     END                             E1
     C*
     C** SET UP FIELDS FOR OUTPUT OF A WITHHOLDING TAX RECORD
     C***********POTASO    IFNE 0                          B1             S01486
     C***********POTAUS    ORNE 0                                         S01486
     C           TASO      IFNE 0                          B1             S01486
     C           TAUS      ORNE 0                                         S01486
     C                     MOVE 'T '      WWPFMC
     C                     MOVE *BLANKS   WWPFMS
     C*
     C** IF NOMINAL AND VALUE CURRENCY ARE THE SAME SET TO AMOUNT DUE
     C           WWNMVL    IFEQ 'Y'                        B2
     C***********          Z-ADDPOTASO    WWTAMT                          S01486
     C***********          ADD  POTAUS    WWTAMT                          S01486
     C                     Z-ADDTASO      WWTAMT                          S01486
     C                     ADD  TAUS      WWTAMT                          S01486
     C                     ELSE                            X2
     C*
     C** CONVERT AMOUNT DUE FROM VALUE CURRENCY TO NOMINAL CURRENCY
     C** VIA SR/#ZD
     C***********          Z-ADDPOTASO    WWINAM                          S01486
     C***********          ADD  POTAUS    WWINAM                          S01486
     C                     Z-ADDTASO      WWINAM                          S01486
     C                     ADD  TAUS      WWINAM                          S01486
     C                     EXSR #ZD
     C                     Z-ADDWWTAM1    WWTAMT
     C                     END                             E2
     C*
     C                     Z-ADD1         WWMPRC
     C*
     C                     MOVE 'I'       WWINIO
     C*
     C***WRITE*A*NOMINAL*RECORD*TO*PMPTRAPP****************************   S01486
     C** WRITE A NOMINAL RECORD TO PMPTRAPD                               S01486
     C           WWTAMT    IFNE 0                          B2
     C                     EXSR #ZB
     C****                 ADD  1         WWCT1   60                      056460
     C                     END                             E2
     C                     END                             E1
     C*
     C****                 ENDSR                                          46386
     C           #BFAC1    ENDSR                                          46386
     C*
      ********************************************************************
      /EJECT                                                              53103
      ********************************************************************53103
      *                                                                  *53103
      * #BFAD    - SET UP RELATED REFERENCE AND MODULE ID.               *53103
      *                                                                  *53103
      * SUBROUTINE CALLS:                                                *53103
      *                                                                  *53103
      * SUBROUTINE CALLED FROM:                                          *53103
      * #BFAA    - GENERATE TRADE PERFORMANCE EVENTS                     *53103
      * #BFAB    - GENERATE DEPOT MOVEMENT PERFORMANCE EVENTS            *53103
      * #BFAC    - GENERATE POSITION SETTLEMENT PERFORMANCE EVENTS       *53103
      *                                                                  *53103
      *                                                                  *53103
      ********************************************************************53103
     C           #BFAD     BEGSR                                          53103
     C*                                                                   53103
     C***If*Settl**methode 4,5,14,15 then reformat ZSETO            53103 CPM004
     C***********ZMETH     IFEQ 4                                   53103 CPM004
     C***********ZMETH     OREQ 5                                   53103 CPM004
     C***********ZMETH     OREQ 14                                  53103 CPM004
     C***********ZMETH     OREQ 15                                  53103 CPM004
     C*  If Settl. methods 1, 2, 4, 5, 7, 8, 12, 14, 15 reformat ZSETO    CPM004
     C           ZMETH     IFEQ 01                         B1             CPM004
     C           ZMETH     OREQ 02                                        CPM004
     C           ZMETH     OREQ 04                                        CPM004
     C           ZMETH     OREQ 05                                        CPM004
     C           ZMETH     OREQ 07                                        CPM004
     C           ZMETH     OREQ 08                                        CPM004
     C           ZMETH     OREQ 12                                        CPM004
     C           ZMETH     OREQ 14                                        CPM004
     C           ZMETH     OREQ 15                                        CPM004
     C*                                                                   53103
     C*    - Reformat Customer and Ccy from ZSETO to QUREPS               53103
     C                     MOVELZSETO     WW6     6                       53103
     C           3         SUBSTZSETO:7   WW3     3                       53103
     C                     MOVELWW6       QUREPS    P                     53103
     C           QUREPS    CAT  WW3:1     QUREPS                          53103
     C*                                                                   53103
     C*    - For non pool customer add A/c code & seq.                    53103
     C***********WWPOOL    IFNE 'Y'                                 53103 CPM005
     C***********4         SUBSTZSETO:10  WW4     4                  53103085862
     C***********          MOVE ZSETO     WW2     2                  53103085862
     C***********QUREPS    CAT  WW4:1     QUREPS                     53103085862
     C***********QUREPS    CAT  WW2:1     QUREPS                     53103085862
     C                     MOVE *BLANKS   QUREPS                          085862
     C                     MOVELZSETO     QUREPS                          085862
     C***********          ENDIF                                    53103 CPM005
     C*    -                                                              53103
     C                     MOVE 'RE'      QUREMI                          53103
     C*                                                                   53103
     C*  Else blanks                                                      53103
     C                     ELSE                                           53103
     C                     MOVE *BLANKS   QUREPS                          53103
     C                     MOVE *BLANKS   QUREMI                          53103
     C                     ENDIF                                          53103
     C*                                                                   53103
     C                     ENDSR                                          53103
      ********************************************************************53103
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BA      - OBTAIN NOMINAL CURRENCY DETAILS                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWKCCY   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BA       BEGSR
     C*
     C***********KCCY      CHAINSDCURRL0             50                   S01486
     C************IN50     IFEQ '1'                                       S01486
     C*                                                                   S01486
     C** Get currency details using access object                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C                     PARM KCCY      P@CCY                           S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C** Check if an error occurred                                       S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD9         DBASE            ****************
     C***********          MOVEL'SDCURRL0'DBFILE           * DBERROR  009 S01486
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  009 S01486
     C******************** MOVELKCCY      DBKEY            ****************
     C                     MOVELMKCCY     DBKEY            ***************51969
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C******************** MOVE KCCY      WWKCCY                          51969
     C                     MOVE MKCCY     WWKCCY                          51969
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BB      - OBTAIN INVESTMENT POLICY DETAILS                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINT1   -                                                       *
      * WWKCC1   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BB       BEGSR
     C*
     C           KL1       CHAININVTP                50
     C           *IN50     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD10        DBASE            ****************
     C***********          MOVEL'INVTP   'DBFILE           * DBERROR  010 S01486
     C                     MOVE 'INVTP   'DBFILE           * DBERROR  010 S01486
     C                     MOVE *BLANKS   DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C                     MOVE WWINT2    WWINT1
     C******************** MOVE KCCY      WWKCC1  3                       51969
     C                     MOVE MKCCY     WWKCC1  3                       51969
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BC      - OBTAIN SECURITY DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWSESH   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BC       BEGSR
     C*
     C** ACCESS SECTY TO OBTAIN SECURITY DETAILS
     C           SESH      CHAINSECTY                50
     C           *IN50     IFEQ '1'                        B4
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD11        DBASE            ****************
     C***********          MOVEL'SECTY   'DBFILE           * DBERROR  011 S01486
     C                     MOVE 'SECTY   'DBFILE           * DBERROR  011 S01486
     C                     MOVELSESH      DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E4
     C                     MOVE SESH      WWSESH 10
     C                     Z-ADDNMDP      QUNMDP                          097492
     C                     MOVE SPBS      QUSPBS                          097492
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #BD      - OBTAIN PORTFOLIO DETAILS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S     *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWPTFR   -                                                       *
      * WWCSTN   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #BD       BEGSR
     C*
     C                     MOVEL'N'       WWPORT                          CPM005
     C                     MOVEL'N'       WW9998  1                       CPM005
     C                     MOVEL'N'       WW9999  1                       CPM005
     C           PTFR      IFEQ '9997'                     B1             CPM005
      *                                                                   CPM005
     C           KL2       CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                        B2             CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WWPORT                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    KPTFR                           CPM005
     C           KL3       CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                        B2             CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WW9999                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  If change of portfolio currency access SDCURRL0 and save        CPM005
      **  details                                                         CPM005
      *                                                                   CPM005
     C           WWPORT    IFEQ 'Y'                        B2             CPM005
      *                                                                   CPM005
     C           PNPTCY    IFNE WSPTCY                     B3             CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM PNPTCY    P@CCY                           CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                    B4             CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD53        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  053 CPM005
     C                     MOVELWSPTCY    DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E4             CPM005
      *                                                                   CPM005
     C                     MOVE PNPTCY    WSPTCY                          CPM005
     C                     Z-ADDA6NBDP    ASNBDP  10                      CPM005
     C                     Z-ADDA6SPRT    ASSPRT 138                      CPM005
     C                     MOVE A6MDIN    ASMDIN  1                       CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  If change of consolidate currency access SDCURRL0 and save      CPM005
      **  details                                                         CPM005
      *                                                                   CPM005
     C           WW9999    IFEQ 'Y'                        B2             CPM005
      *                                                                   CPM005
     C           PNPTCY    IFNE WBPTCY                     B3             CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM PNPTCY    P@CCY                           CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                    B4             CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD54        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  054 CPM005
     C                     MOVELWBPTCY    DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E4             CPM005
      *                                                                   CPM005
     C                     MOVE PNPTCY    WBPTCY  3                       CPM005
     C                     Z-ADDA6NBDP    WBNBDP  10                      CPM005
     C                     Z-ADDA6SPRT    WBSPRT 138                      CPM005
     C                     MOVE A6MDIN    WBMDIN  1                       CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     ELSE                            X1             CPM005
      *                                                                   CPM005
     C***********KL2       CHAINPMPORTPP             50                   S01486
     C           KL2       CHAINPMPORTPD             50                   S01486
     C           *IN50     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD12        DBASE            ****************
     C***********          MOVEL'PMPORTPP'DBFILE           * DBERROR  012 S01486
     C                     MOVE 'PMPORTPD'DBFILE           * DBERROR  012 S01486
     C                     MOVE *BLANKS   DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C                     MOVE PTFR      WWPTFR
     C*********************Z-ADDCSTN      WWCSTN                          CPM004
     C**********           Z-ADD#CSTN     WWCSTN                                       CPM004 CSD027
     C                     MOVE #CSTN     WWCSTN                                              CSD027
     C*
     C** ACCESS SDCURRL0 USING PORTFOLIO CURRENCY
     C           PNPTCY    IFNE WSPTCY                     B1
     C***********PNPTCY    CHAINSDCURRL0             50                   S01486
     C************IN50     IFEQ '1'                        B2             S01486
     C*                                                                   S01486
     C** Get currency details using access object                         S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY   ' P@OPTN                          S01486
     C                     PARM PNPTCY    P@CCY                           S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C** Check if an error occurred                                       S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD5         DBASE            ****************
     C***********          MOVEL'SDCURRL0'DBFILE           * DBERROR  005 S01486
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  005 S01486
     C                     MOVELPNPTCY    DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E2
     C*
     C                     MOVE PNPTCY    WSPTCY  4
     C                     Z-ADDA6NBDP    ASNBDP  10
     C                     Z-ADDA6SPRT    ASSPRT 138
     C                     MOVE A6MDIN    ASMDIN  1
     C                     END
     C*                                                                   056460
     C** SET ON FLAG INDICATING WHETHER PERFORMANCE CALCULATIONS          056460
     C** STARTED FOR PORTFOLIO                                            056460
     C                     MOVE 'N'       WWPORT  1                       056460
     C***********PNPSDT    IFLE WWECD                              056460 CPM005
     C           PNPSDT    IFLT WWECD                      B2             CPM005
     C           PNRECI    ANDEQ'D'                                       056460
     C                     MOVE 'Y'       WWPORT                          056460
     C                     END                                            056460
      *                                                                   CPM005
     C                     MOVEL'9998'    KPTFR                           CPM005
     C           KL3       CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                        B2             CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WW9998                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    KPTFR                           CPM005
     C           KL3       CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                        B2             CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WW9999                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  If change of consolidate currency access SDCURRL0 and save      CPM005
      **  details                                                         CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B2             CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
      *                                                                   CPM005
     C           PNPTCY    IFNE WBPTCY                     B3             CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY'    P@OPTN                          CPM005
     C                     PARM PNPTCY    P@CCY                           CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
     C           P@RTCD    IFNE *BLANKS                    B4             CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD54        DBASE            ***************CPM005
     C                     MOVEL'SDCURRL0'DBFILE           * DBERROR  054 CPM005
     C                     MOVELWBPTCY    DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                             E4             CPM005
      *                                                                   CPM005
     C                     MOVE PNPTCY    WBPTCY  3                       CPM005
     C                     Z-ADDA6NBDP    WBNBDP  10                      CPM005
     C                     Z-ADDA6SPRT    WBSPRT 138                      CPM005
     C                     MOVE A6MDIN    WBMDIN  1                       CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
     C                     END                             E1             CPM005
     C*                                                                   056460
     C** CHECK WHETHER PORTFOLIO IS MEMBER OF POOL                        056460
     C                     MOVE 'N'       WWPOOL  1                       056460
     C**********           Z-ADD0         WSPCNU  60                                   056460 CSD027
     C                     MOVE *BLANKS   WSPCNU  6                                           CSD027
     C                     MOVE *BLANKS   WSPPTF  4                       056460
     C                     MOVE 'N'       WWPOOL  1                       056460
     C           WWPPRQ    IFEQ 'Y'                                       056460
     C           KL2       CHAINPMPPTML1             75                   056460
     C*                                                                   056460
     C**********           Z-ADDOSPCNU    WSPCNU  60                                   056460 CSD027
     C                     MOVE OSPCNU    WSPCNU  6                                           CSD027
     C                     MOVE OSPPTF    WSPPTF  4                       056460
     C*                                                                   056460
     C** IF THE PORTFOLIO IS A POOL MEMBER CHECK WHETHER PERFORMANCE ON   056460
     C** THE POOL                                                         056460
     C           *IN75     IFEQ '0'                                       056460
     C*                                                                   056460
     C* Access POOL Portfolio Definition details.                         056460
     C           POOLKY    KLIST                                          056460
     C                     KFLD           OSPCNU                          056460
     C                     KFLD           OSPPTF                          056460
     C*                                                                   056460
     C***********POOLKY    CHAINPMPORTPP             75            056460 S01486
     C           POOLKY    CHAINPMPORTPD             75            056460 S01486
     C*                                                                   056460
     C           *IN75     IFEQ '1'                                       056460
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD44        DBASE                           056460
     C                     MOVE *BLANKS   DBFILE           ***************056460
     C***********          MOVEL'PMPORTPP'DBFILE           * DBER *056460 S01486
     C                     MOVE 'PMPORTPD'DBFILE           * DBERROR 044 *S01486
     C                     MOVELOSPCNU    DBKEY            ***************056460
     C                     MOVE OSPPTF    DBKEY                           056460
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     056460
     C                     END                                            056460
     C*                                                                   056460
     C** SET ON FLAG INDICATING PERFORMANCE CALCULATIONS REQUIRED FOR     056460
     C** POOL                                                             056460
     C***********PNPSDT    IFLE WWECD                              056460 CPM005
     C           PNPSDT    IFLT WWECD                                     CPM005
     C           PNRECI    ANDEQ'D'                                       056460
     C                     MOVE 'Y'       WWPOOL                          056460
     C                     END                                            056460
     C                     END                                            056460
     C                     END                                            056460
     C*
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      **#ZB******-*WRITE*PERFORMANCE*EVENT*TO*PF/PMPTRAPP**************  *S01486
      * #ZB      - WRITE PERFORMANCE EVENT TO PF/PMPTRAPD                *S01486
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BFAA    - GENERATE TRADE PERFORMANCE EVENTS                     *
      * #BFAB    - GENERATE DEPOT MOVEMENT PERFORMANCE EVENTS            *
      * #BFAC    - GENERATE POSITION SETTLEMENT PERFORMANCE EVENTS       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCCY    -                                                       *
      * WWTRNB   -                                                       *
      * WWTTYP   -                                                       *
      * WWPFMC   -                                                       *
      * WWPFMS   -                                                       *
      * WWTAMT   -                                                       *
      * WWMFXR   -                                                       *
      * WWMPRC   -                                                       *
      * WWINIO   -                                                       *
      * WWRAMT   -                                                       *
      * WWCPTC   -                                                       *
      * WWREVI   -                                                       *
      * WWACIN   -                                                       *
      * WWPPYT   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #ZB       BEGSR
     C*
     C***SET*UP*FIELDS*TO*WRITE*TO*PMPTRAPP****************************   S01486
     C** SET UP FIELDS TO WRITE TO PMPTRAPD                               S01486
     C*
     C*********************Z-ADDCSTN      QUCNUM                          CPM004
     C**********           Z-ADD#CSTN     QUCNUM                                       CPM004 CSD027
     C                     MOVE #CSTN     QUCNUM                                              CSD027
     C                     MOVE PTFR      QUPTFR
     C                     MOVE INNR      QUINNR
     C                     MOVE WWCCY     QUCCY
     C                     MOVE SESH      QUTDSS
     C****                 Z-ADDWWECD     QUPDAT                          46910
     C                     Z-ADDBJRDNB    QUPDAT                          46910
     C**********           Z-ADDWWTRNB    QUTRNB                                              CLE148
     C                     MOVELWWTRNB    QUTRNB                                              CLE148
     C                     MOVE WWTTYP    QUTTYP
     C                     MOVE WWPFMC    QUPFMC
     C                     MOVE WWPFMS    QUPFMS
     C                     Z-ADDWWTAMT    QUTAMT
     C                     Z-ADDWWMFXR    QUMFXR
     C                     Z-ADDWWMPRC    QUMPRC
     C                     MOVE WWINIO    QUINIO
     C                     MOVE WWRAMT    QURAMT
      *                                                                   CPM005
     C           WWIND     IFEQ 'Y'                                       CPM005
      *                                                                   CPM005
      ****************************************************************    CPM005
      * Change to capital *    N    *     P    *     C    *     Y    *    CPM005
      ****************************************************************    CPM005
      * Defined portfolio *    N    *     Y    *     Y    *     Y    *    CPM005
      * Non portfolio 9997*    N    *     Y    *     Y    *     Y    *    CPM005
      ****************************************************************    CPM005
      *                                                                   CPM005
     C           WWCPTC    IFEQ 'N'                                       CPM005
     C           WWCPTC    OREQ 'Y'                                       CPM005
     C                     MOVE WWCPTC    QUCPTC                          CPM005
     C                     ELSE                                           CPM005
     C           WWCPTC    IFEQ 'P'                                       CPM005
     C           WWCPTC    OREQ 'C'                                       CPM005
     C                     MOVE 'Y'       QUCPTC                          CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     ELSE                                           CPM005
     C                     MOVE WWCPTC    QUCPTC
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     MOVE WWREVI    QUREVI
     C                     MOVE WWACIN    QUACIN
     C                     MOVE WWPPYT    QUPPYT
     C                     MOVE SPBS      QUSPBS                          094693
     C*                                                                   056460
     C** IF PORTFOLIO HAS PERFORMANCE WRITE RECORD FOR PORTFOLIO          056460
     C           WWPORT    IFEQ 'Y'                                       056460
     C*
     C                     EXSR ZEVRF                                     053103
     C                     Z-ADDZZEVRF    QUEVRF                          053103
     C                     WRITEPMPTRAP0
     C                     ADD  1         WWCT1   60                      056460
     C                     END                                            056460
      *                                                                   CPM005
      **  Write record to PMPTRAPD for '9998' portfolio if required       CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                        B1             CPM005
     C                     MOVELQUPTFR    WSPTFR                          CPM005
     C                     Z-ADDQUMFXR    WSMFXR 308                      CPM005
     C                     MOVELQUCPTC    WSCPTC  1                       CPM005
      *                                                                   CPM005
     C                     MOVEL'9998'    QUPTFR                          CPM005
     C                     Z-ADDWMFXR9    QUMFXR                          CPM005
      *                                                                   CPM005
     C                     EXSR ZEVRF                                     CPM005
     C                     Z-ADDZZEVRF    QUEVRF                          CPM005
      *                                                                   CPM005
     C           WWIND     IFNE 'Y'                        B11            CPM005
     C           QUCPTC    IFEQ 'Y'                        B2             CPM005
      *                                                                   CPM005
     C           WSRETL    IFEQ 'Y'                        B3             CPM005
     C           ZPTFR     ANDNE'9997'                                    CPM005
     C           PTFR      ANDNE'9997'                                    CPM005
     C           ZRCNUM    ANDEQCSTN                                      CPM005
     C                     MOVEL'N'       QUCPTC                          CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     ELSE                            X11            CPM005
      *                                                                   CPM005
      ****************************************************************    CPM005
      * Change to capital *    N    *     P    *     C    *     Y    *    CPM005
      ****************************************************************    CPM005
      * Total portf 9998  *    N    *     N    *     Y    *     Y    *    CPM005
      ****************************************************************    CPM005
      *                                                                   CPM005
     C           WWCPTC    IFEQ 'P'                        B2             CPM005
     C                     MOVE 'N'       QUCPTC                          CPM005
     C                     ELSE                            X2             CPM005
     C           WWCPTC    IFEQ 'C'                        B3             CPM005
     C                     MOVE 'Y'       QUCPTC                          CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
     C                     END                             E11            CPM005
      *                                                                   CPM005
     C                     WRITEPMPTRAP0                                  CPM005
      *                                                                   CPM005
     C                     MOVELWSPTFR    QUPTFR                          CPM005
     C                     Z-ADDWSMFXR    QUMFXR                          CPM005
     C                     MOVELWSCPTC    QUCPTC                          CPM005
     C                     ADD  1         WWCT1                           CPM005
     C                     END                             E1             CPM005
      *                                                                   CPM005
      **  Write record to PMPTRAPD for '9999' portfolio if required       CPM005
      *                                                                   CPM005
     C           WW9999    IFEQ 'Y'                                       CPM005
     C                     MOVELQUPTFR    WSPTFR                          CPM005
     C                     Z-ADDQUMFXR    WSMFXR 308                      CPM005
     C                     MOVELQUCPTC    WSCPTC  1                       CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    QUPTFR                          CPM005
     C                     Z-ADDWMFXR9    QUMFXR                          CPM005
      *                                                                   CPM005
     C                     EXSR ZEVRF                                     CPM005
     C                     Z-ADDZZEVRF    QUEVRF                          CPM005
      *                                                                   CPM005
     C           WWIND     IFNE 'Y'                        B11            CPM005
     C           QUCPTC    IFEQ 'Y'                        B2             CPM005
      *                                                                   CPM005
     C           WSRETL    IFEQ 'Y'                        B3             CPM005
     C           ZRCNUM    ANDEQCSTN                                      CPM005
     C                     MOVEL'N'       QUCPTC                          CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     ELSE                            X11            CPM005
      *                                                                   CPM005
      ****************************************************************    CPM005
      * Change to capital *    N    *     P    *     C    *     Y    *    CPM005
      ****************************************************************    CPM005
      * Consolidated 9999 *    N    *     N    *     N    *     Y    *    CPM005
      ****************************************************************    CPM005
      *                                                                   CPM005
     C           WWCPTC    IFEQ 'P'                        B2             CPM005
     C           WWCPTC    OREQ 'C'                                       CPM005
     C                     MOVE 'N'       QUCPTC                          CPM005
     C                     END                             E2             CPM005
     C                     END                             E11            CPM005
      *                                                                   CPM005
     C                     WRITEPMPTRAP0                                  CPM005
      *                                                                   CPM005
     C                     MOVELWSPTFR    QUPTFR                          CPM005
     C                     Z-ADDWSMFXR    QUMFXR                          CPM005
     C                     MOVELWSCPTC    QUCPTC                          CPM005
     C                     ADD  1         WWCT1                           CPM005
     C                     END                                            CPM005
     C*                                                                   056460
     C** IF POOL HAS PERFORMANCE WRITE RECORD TO CASH ANALYSIS FILE       056460
     C           WWPOOL    IFEQ 'Y'                                       056460
     C**********           Z-ADDQUCNUM    WSCNUM  60                                   056460 CSD027
     C                     MOVE QUCNUM    WSCNUM  6                                           CSD027
     C                     MOVE QUPTFR    WSPTFR  4                       056460
     C                     MOVE QUCPTC    WSCPTC  1                       056460
     C                     MOVE QUREPS    WSREPS 20                       CPM005
     C**********           Z-ADDWSPCNU    QUCNUM                                       056460 CSD027
     C                     MOVE WSPCNU    QUCNUM                                              CSD027
     C                     MOVE WSPPTF    QUPTFR                          056460
      *                                                                   CPM005
      **  For pool portfolio, set account code and sequence to zero       CPM005
      *                                                                   CPM005
     C                     MOVEL' 0000 00'WDRK10 10                       CPM005
     C                     MOVE WDRK10    QUREPS                          CPM005
     C                     MOVELWSPCNU    QUREPS                          CPM005
     C*                                                                   056460
     C** IF CHANGE TO PORTFOLIO CAPITAL IS YES AND THE POSTING IS NOT     056460
     C** DUE TO A DEPOT MOVEMENT RESET CHANGE INDICATOR                   056460
     C           QUCPTC    IFEQ 'Y'                                       056460
     C           WWDPMV    ANDNE'Y'                                       056460
     C           WSRETL    ANDEQ'Y'                                       059474
     C           FCPORS    ANDNE'B'                                       CPM004
     C*                                                                   056460
     C           TPPOOL    KLIST                                          056460
     C                     KFLD           ZCNUM                           056460
     C                     KFLD           ZPTFR                           056460
     C*                                                                   056460
     C** OBTAIN POOL PORTFOLIO REFERENCE FOR SETTLEMENT PORTFOLIO         056460
     C           TPPOOL    CHAINPMPPTML1             75                   056460
     C*                                                                   056460
     C** IF WHETHER SETTLEMENT ACCOUNT AND TRADE IN SAME POOL RESET       056460
     C** CHANGE TO PORTFOLIO CAPITAL INDICATOR                            056460
     C           *IN75     IFEQ '0'                                       056460
     C           OSRECI    ANDEQ'D'                                       056460
     C           WSPCNU    ANDEQOSPCNU                                    056460
     C           WSPPTF    ANDEQOSPPTF                                    056460
     C                     MOVE 'N'       QUCPTC                          056460
     C                     END                                            056460
     C                     END                                            056460
      *                                                                   CPM005
      **  Setup indicator for cross portfolio movement for depot movts    CPM005
      *                                                                   CPM005
     C           WWIND     IFEQ 'Y'                        B2             CPM005
      *                                                                   CPM005
      ****************************************************************    CPM005
      * Change to capital *    N    *     P    *     C    *     Y    *    CPM005
      ****************************************************************    CPM005
      * Consolidated pool *    N    *     Y    *     Y    *     Y    *    CPM005
      ****************************************************************    CPM005
      *                                                                   CPM005
     C           CWDI      IFEQ 'N'                        B3             CPM005
     C                     MOVE 'N'       QUCPTC                          CPM005
     C                     ELSE                            X3             CPM005
     C                     MOVE 'Y'       QUCPTC                          CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
     C*                                                                   056460
     C                     EXSR ZEVRF                                     053103
     C                     Z-ADDZZEVRF    QUEVRF                          053103
     C                     WRITEPMPTRAP0                                  056460
     C**********           Z-ADDWSCNUM    QUCNUM                                       056460 CSD027
     C                     MOVE WSCNUM    QUCNUM                                              CSD027
     C                     MOVE WSPTFR    QUPTFR                          056460
     C                     MOVE WSCPTC    QUCPTC                          056460
     C                     MOVE WSREPS    QUREPS                          CPM005
     C                     ADD  1         WWCT1                           056460
     C                     END                                            056460
     C*                                                                   056460
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #ZD      - CONVERT POSITION SETTLEMENT AMOUNTS TO NOMINAL CCY    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZCCYXR   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #BFAC    - GENERATE POSITION SETTLEMENT PERFORMANCE EVENTS       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWINSX   -                                                       *
      * WWINAM   -                                                       *
      * WWPSCD   -                                                       *
      * WWDANB   -                                                       *
      * WWTAM1   -                                                       *
      *                                                                  *
      ********************************************************************
     C           #ZD       BEGSR
     C*
     C** AS CONVERTING FROM VALUE CURRENCY TO NOMINAL CURRENCY SHOULD
     C** USE INVERSE OF FX RATE FROM SECTYD
     C           1         DIV  WWSEXR    WWINSX 138
     C*
     C** CONVERT USING SR/ZCCYXR
     C                     Z-ADDWWINAM    ZAMTF
     C                     Z-ADDWWINSX    ZCRSRT
     C                     MOVE 'M'       ZCRSMD
     C                     Z-ADDWWPSCD    ZCDPF
     C                     Z-ADDWWDANB    ZCDPT
     C                     EXSR ZCCYXR
     C                     Z-ADDZAMTT     WWTAM1 150
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #C       - OUTPUT FILE CONTROL REPORT                            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN CONTROLLING ROUTINE                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCT1    -                                                       *
      * WWCT2    -                                                       *
      *                                                                  *
      ********************************************************************
     C           #C        BEGSR
     C*
     C** SET UP OUTPUT FIELDS FOR REPORT
     C                     MOVE WWCT1     RRCT1
     C                     MOVE WWCT2     RRCT2
     C*
     C                     WRITEHEADER
     C                     WRITEDETAIL
     C***********          WRITEFOOTING                                   S01486
     C*                                                                   S01486
     C** Check if no details to report                                    S01486
     C*                                                                   S01486
     C           WWCT2     IFEQ *ZERO                                     S01486
     C                     WRITENODTLS                                    S01486
     C                     END                                            S01486
     C*
     C                     ENDSR
     C********************************************************************50406
      *                                                                   CPM004
      * BRANCH   - RETRIEVE BRANCH'S CUSTOMER DETAILS                     CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLS:                                                 CPM004
      * *PSSR    - DB ERROR SUB-ROUTINE                                   CPM004
      * AOPLCSR1 - PORTFOLIO MANAGEMENT CUSTOMER DETAILS                  CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLED FROM:                                           CPM004
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S      CPM004
      *                                                                   CPM004
      * ROUTINE USES VARIABLES:                                           CPM004
      *                                                                   CPM004
      ********************************************************************CPM004
     C           BRANCH    BEGSR                                          CPM004
     C**                                                                  CPM004
     C                     MOVE 'B'       I#PORS                          CPM004
     C                     MOVE FCR997    I#R997                          CPM004
     C                     MOVE BRHA      I#BRCA                          CPM004
     C**                                                                  CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CPM004
     C                     PARM '*KEY   ' P@OPTN  7        I:Option       CPM004
     C                     PARM           I@PARM           I:Parameters   CPM004
     C                     PARM *BLANKS   O@PARM           O:Parameters   CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY            O:Format       CPM004
     C*                                                                   CPM004
     C** ERROR                                                            CPM004
     C           P@RTCD    IFNE *BLANK                                    CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD40        DBASE            ***************CPM004
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 40 *CPM004
     C                     MOVELI#BRCA    DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
      *                                                                   CPM004
     C                     ENDSR                                          CPM004
      ********************************************************************CPM004
     C           SWINIO    BEGSR                                          CPM004
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           WWINIO    IFEQ 'I'                                       CPM004
     C                     MOVE 'O'       WWINIO                          CPM004
     C                     ELSE                                           CPM004
     C                     MOVE 'I'       WWINIO                          CPM004
     C                     END                                            CPM004
     C                     END                                            CPM004
     C                     ENDSR                                          CPM004
     C********************************************************************CPM004
     C*                                                                   50406
     C*  ZCCYCN SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER       50406
     C*  CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES             50406
     C*                                                                   50406
     C*  INPUT  FIELDS                                                    50406
     C*       ZAMTF  150     AMOUNT IN 'FROM' CURRENCY                    50406
     C*       ZCCYF   3A     FROM CURRENCY                                50406
     C*       ZCCYT   3A     TO CURRENCY                                  50406
     C*       ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY                50406
     C*       ZRATET 138     SPOT RATE FOR 'TO' CURRENCY                  50406
     C*       ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CURRENCY50406
     C*       ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURRENCY  50406
     C*       ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY  50406
     C*       ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY    50406
     C*                                                                   50406
     C*  OUTPUT  FIELDS                                                   50406
     C*       ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT50406
     C*       ZCRSRT 138     CROSS EXCHANGE RATE                          50406
     C*       ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR         50406
     C*                                                                   50406
     C*                                                                   50406
     C*  CALLS:                                                           50406
     C*       ZCCYCA - CONVERT AMOUNT                                     50406
     C********************************************************************50406
     C*                                                                   50406
     C           ZCCYCD    BEGSR                           *** ZCCYCN *** 50406
     C*                                                                   50406
     C** DEFINE ALL FIELDS                                                50406
     C                     Z-ADDZAMTF     ZAMTF  150                      50406
     C                     MOVE ZCCYF     ZCCYF   3                       50406
     C                     MOVE ZCCYT     ZCCYT   3                       50406
     C                     Z-ADDZRATEF    ZRATEF 138                      50406
     C                     Z-ADDZRATET    ZRATET 138                      50406
     C                     MOVE ZMDINF    ZMDINF  1                       50406
     C                     MOVE ZMDINT    ZMDINT  1                       50406
     C                     Z-ADDZCDPF     ZCDPF   10                      50406
     C                     Z-ADDZCDPT     ZCDPT   10                      50406
     C                     Z-ADDZAMTT     ZAMTT  150                      50406
     C                     Z-ADDZCRSRT    ZCRSRT 138                      50406
     C                     MOVE ZCRSMD    ZCRSMD  1                       50406
     C*                                                                   50406
     C** IF 'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TO' CURR50406
     C** EQUAL TO AMOUNT IN 'FROM' CURRENCY                               50406
     C           ZCCYF     IFEQ ZCCYT                                     50406
     C                     Z-ADDZAMTF     ZAMTT                           50406
     C                     Z-ADD1         ZCRSRT                          50406
     C                     MOVE 'M'       ZCRSMD                          50406
     C           1000000000MULT 1000000   ZCRSRN                          50406
     C                     GOTO CCYEN1                                    50406
     C                     END                                            50406
     C*                                                                   50406
     C** INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO                 50406
     C                     Z-ADD*ZEROS    ZCRSRT                          50406
     C*                                                                   50406
     C** CONVERT 'FROM' RATE TO MULTIPLY RATE                             50406
     C           ZMDINF    IFEQ 'M'                                       50406
     C                     Z-ADDZRATEF    ZRATF1 138                      50406
     C           1000000000MULT ZRATEF    ZRATF2 308                      50406
     C           10        MULT ZRATF2    ZRATF2                          50406
     C                     ELSE                                           50406
     C           1         DIV  ZRATEF    ZRATF1                          50406
     C           1000000000MULT 10        ZRWORK 200                      50406
     C           ZRWORK    DIV  ZRATEF    ZRATF2    H                     50406
     C                     END                                            50406
     C*                                                                   50406
     C** CONVERT 'TO' RATE TO MULTIPLY RATE                               50406
     C           ZMDINT    IFEQ 'M'                                       50406
     C                     Z-ADDZRATET    ZRATT1 138                      50406
     C           1000000000MULT ZRATET    ZRATT2 308                      50406
     C           10        MULT ZRATT2    ZRATT2                          50406
     C                     ELSE                                           50406
     C           1         DIV  ZRATET    ZRATT1                          50406
     C           1000000000MULT 10        ZRWORK                          50406
     C           ZRWORK    DIV  ZRATET    ZRATT2    H                     50406
     C                     END                                            50406
     C*                                                                   50406
     C** NOW CALCULATE CROSS RATE                                         50406
     C           ZRATT1    IFNE *ZEROS                                    50406
     C           ZRATF1    DIV  ZRATT1    ZCRSRT                          50406
     C*                                                                   50406
     C** CALCULATE DOUBLE PRECISION FX RATE                               50406
     C** FIRST SPLIT FIGURE INTO TWO PARTS                                50406
     C           1000000000MULT 1000000   ZRWORK                          50406
     C           ZRATF2    MULT ZRWORK    ZRATBF 300                      50406
     C                     Z-ADDZRATF2    ZRATSF 158                      50406
     C*                                                                   50406
     C** DIVIDE BOTH BIG AND SMALL PARTS BY TO FX RATE AND ADD TO CROSS RA50406
     C** TO BE USED IN CALCULATIONS                                       50406
     C           ZRATBF    DIV  ZRATT2    ZCRSRN 309H                     50406
     C           ZRATSF    DIV  ZRATT2    ZCRSR1 309H                     50406
     C                     ADD  ZCRSR1    ZCRSRN                          50406
     C                     END                                            50406
     C*                                                                   50406
     C** MOVE MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULT/DIV   50406
     C** INDICATOR (ZCRSMD)                                               50406
     C                     MOVE 'M'       ZCRSMD                          50406
     C*                                                                   50406
     C** IF CROSS EXCHANGE RATE IS EQUAL TO ZERO                          50406
     C** SET ZAMTT  TO *ZERO  & EXIT                                      50406
     C           ZCRSRN    IFEQ 0                                         50406
     C                     Z-ADD*ZEROS    ZAMTT                           50406
     C                     GOTO CCYEN1                                    50406
     C                     END                                            50406
     C*                                                                   50406
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF) EQUALS DECIMAL    50406
     C** DECIMAL PLACES  FOR 'TO' CURRENCY CONVERT AMOUNT BY SIMPLE       50406
     C** MULTIPLICATION                                                   50406
     C           ZCDPF     IFEQ ZCDPT                      B1             50406
     C           ZAMTF     MULT ZCRSRN    ZAMTO  300H                     50406
     C                     END                             E1             50406
     C*                                                                   50406
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF)  NOT EQUALS DECIMA50406
     C** DECIMAL PLACES  FOR 'TO' CURRENCY ADJUST AMOUNT FOR DIFFERENT DP 50406
     C           ZCDPF     IFNE ZCDPT                      B1             50406
     C*                                                                   50406
     C** SUBTRACT DECIMAL PLACES 'FROM' FROM DECIMAL PLACES 'TO' IN POWER 50406
     C           ZCDPT     SUB  ZCDPF     ZWKPX   10                      50406
     C           ZWKPX     ADD  4         B       30                      50406
     C*                                                                   50406
     C** IF POWER ELEMENT (8,4) LESS THAN 1                               50406
     C           POWER,B   IFLT 1                          B2             50406
     C*                                                                   50406
     C** MULTIPLY AMOUNT IN FROM CURRENCY BY ELEMENT IN POWER ARRAY       50406
     C           POWER,B   MULT ZAMTF     ZWK153 153                      50406
     C*                                                                   50406
     C           ZWK153    MULT ZCRSRN    ZAMTO     H                     50406
     C                     END                             E2             50406
     C*                                                                   50406
     C** IF POWER ELEMENT (8,4) GREATER OR EQUAL TO 1                     50406
     C           POWER,B   IFGE 1                          B2             50406
     C           ZAMTF     MULT POWER,B   ZAMTO                           50406
     C           ZAMTO     MULT ZCRSRN    ZAMTO     H                     50406
     C                     END                             E2             50406
     C                     END                             E1             50406
     C*                                                                   50406
     C           ZAMTO     DIV  ZRWORK    ZAMTT     H                     50406
     C*                                                                   50406
     C           CCYEN1    ENDSR                                          50406
     C*****************************************************************
      /EJECT                                                              53103
      ********************************************************************53103
      *                                                                  *53103
      * ZEVRF    - SET PERFORMANCE EVENT REFERENCE                       *53103
      *                                                                  *53103
      *   out : ZZEVRF                                                   *53103
      ********************************************************************53103
     C           ZEVRF     BEGSR                                          53103
     C*                                                                   53103
     C           *LOCK     IN   PMSTAT                                    53103
     C                     MOVE DAEVRF    WWEVRF  70                      53103
     C                     Z-ADDWWEVRF    ZZEVRF  70                      53103
     C                     ADD  1         WWEVRF                          53103
     C                     MOVE WWEVRF    DAEVRF                          53103
     C                     OUT  PMSTAT                                    53103
     C*                                                                   53103
     C                     ENDSR                                          53103
      ********************************************************************53103
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*    *PSSR     - Program error handling routine                 *
     C*                                                               *
     C*****************************************************************
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - TERMINATE WITH PROGRAM ERROR                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #A       - INTITIAL PROCESSING                                   *
      * #BFAA    - GENERATE TRADE PERFORMANCE EVENTS                     *
      * #BFAB    - GENERATE DEPOT MOVEMENT PERFORMANCE EVENTS            *
      * #BFAC    - GENERATE POSITION SETTLEMENT PERFORMANCE EVENTS       *
      * #BA      - OBTAIN NOMINAL CURRENCY DETAILS                       *
      * #BB      - OBTAIN INVESTMENT POLICY DETAILS                      *
      * #BC      - OBTAIN SECURITY DETAILS                               *
      * #BD      - OBTAIN PORTFOLIO DETAILS                              *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*                                                                   S01486
     C                     WRITEHEADER                                    S01486
     C                     WRITEDBERROR                                   S01486
     C*
     C                     DUMP
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
      ****/COPY ZSRSRC,ZCCYCN                                             50406
      /COPY ZSRSRC,ZCCYXR
      /COPY ZSRSRC,ZFXAVP
      /COPY ZSRSRC,ZRATEZ1
      /COPY ZSRSRC,ZACCRZ1
      /COPY ZSRSRC,ZDYYRZ3
      /COPY ZSRSRC,ZDAYSZ2
      /COPY ZSRSRC,ZDATE1Z2
      /COPY ZSRSRC,ZDATE2Z2
      /COPY ZSRSRC,ZAINSH
      /COPY ZSRSRC,ZNCDZ3
      /COPY ZSRSRC,ZLCDZ1                                                 060971
      /COPY ZSRSRC,ZSETAC                                                 46386
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  WWARRY
L SFV
L DFV
S SDI
S DDI
S SDI
S DDI
S SPP
S DPP
S SCV
S DCV
S SSA                                                                     46386
S DSA                                                                     48449
**  WWARRZ                                                                CPM004
P  PP                                                                     CPM004
R  CO                                                                     CPM004
C  DI                                                                     CPM004
H  DI                                                                     CPM004
M  CV                                                                     CPM004
** ARRAY OF POWERS OF 10 FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
