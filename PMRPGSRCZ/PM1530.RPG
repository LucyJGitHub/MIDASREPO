     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Performance Analysis Update')                 *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM1530 - LE Performance Analysis Update                      *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. AR1056323          Date 14Nov12               *
      *  Prev Amend No. CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 102506             Date 18Oct98               *
      *                 CPM005             Date 16Jul96               *
     F*                 083014             Date 24Jun96               *
     F*                 099814             DATE 15FEB96               *
     F*                 CPM004             DATE 04MAR96               *
     F*                 094693             DATE 18OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 085862             DATE 15MAR95               *
     F*                 081348             DATE 21DEC94               *
     F*                 072242             DATE 25NOV94               *
     F*                 053103             DATE 25NOV94               *
     F*                 S01486             DATE 11AUG94               *
     F*                 059474             DATE 11/08/93              *
     F*                 056460             DATE 07JUN93               *
     F*                  50406             DATE 01/02/93              *
     F*                  47719             DATE 19JAN93               *
     F*                  46910             DATE 11/11/92              *
     F*                  46386             DATE 28/10/92              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  AR1056323 - Revert back changes of CLE134 for LKEY1DP and    *
      *              LKEYFED (Recompile)                              *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  102506 - Recompiled over ZSRSRC/ZDAYSZ2 changes.             *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/2 - CALCULATE & REPORT PERF. FOR ALL CUST.PORT *
     F*  083014 - Correct problem of performance with event type 'IR' *
     F*  099814 - Pool Trades should use CQQ001 feature               *
     F*  CPM004 - Bank Portfolios                                     *
     F*  094693 - ACCNT's key is now split due to branch so use       *
     F*           external file description                           *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  085862 - INCLUDE BRANCH IN ACCOUNT CODE                      *
     F*  081348 - Amend for ZSETAC subroutine changes                 *
     F*  072242 - Do not extract records for unvalued loans.          *
     F*  053103 - Add perf. event reference and related reference     *
     F*           + module                                            *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*  059474 - IF SETTLEMENT NOT IN RETAIL ACCOUNT TREAT AS CROSS  *
     F*           PORTFOLIO SETTLEMENT                                *
     F*  056460 - OUTPUT DUPLICATE RECORDS FOR POOL PORTFOLIO         *
     F*   50406 - OUTPUT DOUBLE PRECISION FX RATES                    *
     F*   47719 - USE EXTERNAL SUBROUTINES ZCCYCN AND ZCCYXR INSTEAD  *
     F*           OF INCORRECT ONCE INTERNALLY DESCRIBED.             *
     F*   46910 - EVENT DATE SHOULD BE RUN DATE RATHER THAN ECD       *
     F*   46386 - ALLOW CROSS PORTFOLIO SETTLEMENTS                   *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F**
     F**      FILE DEFINITIONS
     F**     ------------------
     F*
     F**   PORTFOLIO MANAGEMENT LE GENERATED ACCOUNT KEYS
     F***PMLKEYS*IF**E           K        DISK         KINFSR *PSSR       S01486
     FPMLKEYL0IF  E           K        DISK         KINFSR *PSSR          S01486
     F*
     F*****BANK*DETAILS*FILE************************-*Prefix*BJ***********S01486
     F***SDBANKL1IF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F*****CURRENCY*CODES*FILE**********************-*Prefix*A6***********S01486
     F***SDCURRL0IF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F*****LOAN *YPE/SUB-TYPES**********************-*Prefix*AY***********S01486
     F***SDLOANL1IF**E           K        DISK         KINFSR *PSSR       S01486
     F*
     F**   PORTFOLIO DEFINITION DETAILS             - Prefix PN
     F***PMPORTPPIF**E           K        DISK         KINFSR *PSSR       S01486
     FPMPORTPDIF  E           K        DISK         KINFSR *PSSR          S01486
     F*                                                                   056460
     F* POOL PORTFOLIO MEMBERS - PREFIX OS                                056460
     FPMPPTML1IF  E           K        DISK         KINFSR *PSSR          056460
     F*                                                                   46386
     F***ACCOUNT*DETAILS*BY*15A*ACCOUNT*CODE.*NO PREFIX*************46386 S01486
     F***ACCNT***IF**F     416 15AI     2 DISK         KINFSR *PSSR 46386 S01486
     F** ACCOUNT DETAILS BY 18A ACCOUNT CODE. NO PREFIX                   S01486
     F***ACCNT***IF**F     416 18AI     2 DISK         KINFSR *PSSR S01486085862
     F***ACCNT***IF**F     437 18AI     2 DISK         KINFSR *PSSR 085862094693
     FACCNT   IF  E           K        DISK         KINFSR *PSSR          094693
     F            ACCNTAAF                          KIGNORE               094693
     F            ACCNTABF                          KRENAMEACCNTB1F       094693
     F            ACCNTACF                          KIGNORE               094693
     F*                                                                   46386
     F** ACCOUNT DETAILS BY 15N ACCOUNT NUMBER. NO PREFIX                 46386
     F***ACNUM***IF**F      47 10AI     2 DISK         KINFSR *PSSR  46386094693
     FACNUM   IF  E           K        DISK         KINFSR *PSSR          094693
     F            ACCNTABF                          KRENAMEACCNTB2F       094693
     F*                                                                   46386
     F***RETAIL*ICD*-**PREFIX*BM************************************46386 S01486
     F***SDRETLL0IF**E           K        DISK         KINFSR *PSSR 46386 S01486
     F*                                                                   46386
     F***SD*CUSTOMER*DETAILS*-**PREFIX*BB***************************46386 S01486
     F***SDCUSTL0IF**E           K        DISK         KINFSR *PSSR 46386 S01486
     F*                                                                   46386
     F***SE*CUSTOMER*DETAILS*-**PREFIX*BF***************************46386 S01486
     F***SDSECSL0IF**E           K        DISK         KINFSR *PSSR 46386 S01486
     F*                                                                   46386
     F***BRANCH*CODES*-**PREFIX*A8**********************************46386 S01486
     F***SDBRCHL0IF**E           K        DISK         KINFSR *PSSR 46386 S01486
      *                                                                   CPM005
      **  Prefix of PMCNSDLL is 'PN'                                      CPM005
     FPMCNSDLLIF  E           K        DISK         KINFSR *PSSR          CPM005
     F*
     F**   PERFORMANCE TRANSACTION ANALYSIS         - Prefix RB
     F***PMPTRAPPO***E           K        DISK         KINFSR *PSSR A     S01486
     FPMPTRAPDO   E           K        DISK         KINFSR *PSSR A        S01486
     F*
     F**   LE PERFORMANCE ANALYSIS UPDATE REPORT
     FPM1530AUO   E             21     PRINTER      KINFSR *PSSR
     F*
     F/EJECT
     F*****************************************************************
     F**                                                              *
     F** ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F**                 ------------------------                     *
     F**                                                              *
     F**    21         - OVERFLOW ON PRINTER FILE PM1530AU.           *
     F**       70      - EOF ON READ OF FILE SDBANKL1.                *
     F**       72      - EOF ON READ OF FILE PMLKEYS.                 *
     F**       73      - EOF ON READ OF FILE SDCURRL0.                *
     F**       74      - EOF ON READ OF FILE SDLOANL1.                *
     F**       76      - EOF ON READ OF FILE PMPORTPP.                *
     F**                                                              *
     F*****************************************************************
     F/EJECT
     E*****************************************************************
     E*
     E**   ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E** array for powers of 10
     E                    POWER   1   7  7 3
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     I***********                                                    46386094693
     I***ACCNT***NS**                                                46386094693
     I***********                             2   70ZRCNUM           46386094693
     I***********                             8  10 ZRCCY            46386094693
     I***********                            11  140ZRACOD           46386094693
     I***********                            15  160ZRACSQ           46386094693
     I***********                            23  25 ZRBRCA          085862094693
     I***********                           433 436 ZRPTFR          085862094693
     I***********                           401 404 ZRPTFR           46386085862
     I***********                                                    46386094693
     I***ACNUM***NS*                                                 46386094693
     I***********                            12  170ZRCNUM           46386094693
     I***********                            18  20 ZRCCY            46386094693
     I***********                            21  240ZRACOD           46386094693
     I***********                            25  260ZRACSQ           46386094693
     I***********                            29  31 ZRBRCA          081348094693
     I***********                            41  44 ZRPTFR           46386094693
     I*                                                                   094693
     IACCNTB1F                                                            094693
     I              CNUM                            ZRCNUM                094693
     I              CCY                             ZRCCY                 094693
     I              ACOD                            ZRACOD                094693
     I              ACSQ                            ZRACSQ                094693
     I              BRCA                            ZRBRCA                094693
     I              PTFR                            ZRPTFR                094693
     I*                                                                   094693
     IACCNTB2F                                                            094693
     I              CNUM                            ZRCNUM                094693
     I              CCY                             ZRCCY                 094693
     I              ACOD                            ZRACOD                094693
     I              ACSQ                            ZRACSQ                094693
     I              BRCA                            ZRBRCA                094693
     I              PTFR                            ZRPTFR                094693
      *                                                                   CPM005
     IPMCNSDD0                                                            CPM005
     I              PNPTCY                          RNPTCY                CPM005
     I              PNPCDP                          RNPCDP                CPM005
     I*                                                                   46386
     I* 15 A SETTLEMENT ACCOUNT RETURNED                                  46386
     I            DS                            256                       46386
     I**********                              1   60ZWCNUM                              46386 CSD027
     I                                        1   6 ZWCNUM                                    CSD027
     I                                        7   9 ZWCCY                 46386
     I**********                             10  130ZWACOD                              46386 CGL029
     I**********                             14  150ZWACSQ                              46386 CGL029
     I**********                             16  18 ZWBRCA                             S01486 CGL029
     I                                       10  190ZWACOD                                    CGL029
     I                                       20  210ZWACSQ                                    CGL029
     I                                       22  24 ZWBRCA                                    CGL029
     I***********                             1  15 ZWACCN          46386 S01486
     I***********                             1  18 ZWACCN          S01486094693
     I**********                              1  18 ZKACCN                             081348 CGL029
     I                                        1  24 ZKACCN                                    CGL029
     I*
     I**   DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I**   PROGRAM STATUS DATA STRUCTURE
     IPSDS       SDS
     I                                      244 253 JOB
     I                                      254 263 USER
     I*
     IPMSTAT    E DS
     I                                        1   50WWECD
     I*************                          35  35 WWPPRQ         056460 099814
     I                                        1 256 WWSTAT
     I*
     I**   LOCAL DATA AREA
     I*LDA*******UDS                            256                       S01486
     ILDA         DS                            256                       S01486
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*                                                                   CPM004
     I** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
     I** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I** Bank details                                                     S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I** Currency codes                                                   S01486
     I*                                                                   S01486
     ISDLOAN    E DSSDLOANPD                                              S01486
     I** Loan type/sub-types                                              S01486
     I*                                                                   S01486
     ISDMMOD    E DSSDMMODPD                                              CPM004
     I**  Data structure for modules                                      CPM004
     I*                                                                   CPM004
     ISDRETL    E DSSDRETLPD                                              S01486
     I** Retail ICD                                                       S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              CPM004
     I**  Data structure for Portfolio Management ICD                     CPM004
     I*                                                                   CPM004
     ISDSECS    E DSSDSECSPD                                              S01486
     I              QQACCD                          QQACC1                                    CGL029
     I** SE Customer details                                              S01486
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              CPM004
     I**  Portfolio Management Customer details                           CPM004
     I*                                                                   CPM004
     ISDNOST    E DSSDNOSTPD                                              CPM004
     I              QQACCD                          QQACC2                                    CGL029
     I**  Data structure for nostro details                               CPM004
     I*                                                                   CPM004
     IDSFDY     E DSDSFDY                                                 S01486
     I** First DS for access programs                                     S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I** Second DS for access programs, long data structure               S01486
     I*
     I** Work field to extract loan type & loan subtype
     I            DS
     I****************************************1  10 AKEY                                      CLE042
     I                                        1  14 AKEY                                      CLE042
     I                                        1   2 WWLTY2
     I                                        3   3 WWCHR3
     I                                        4   5 WWSUB2
     I                                        8   8 WWCPTY
     I                                       10  10 WWCOD2
     I                                       11  14 WWCLS2                                    CLE042
     I*
     I** Work field to report database error on PMPORTPP
     I            DS
     I                                        1  10 WWKDB6
     I                                        1   6 WWKCUS
     I                                        7  10 WWKPRF
     I*
     I** Work field to report database error on SDLOANL1
     I            DS
     I****************************************1***4*WWKDB4                                    CLE042
     I                                        1   8 WWKDB8                                    CLE042
     I                                        1   2 WWKLTY
     I                                        3   4 WWKSUB
     I                                        5   8 WWKCLS                                    CLE042
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**              START MAINLINE
     C**             ----------------
     C*
     C**   INITIAL PROCESSING
     C                     EXSR #A
     C*
     C**   ACCOUNT KEY PROCESSING
     C                     EXSR #B
     C*
     C**   PRODUCE LE PERFORMANCE ANALYSIS UPDATE REPORT
     C                     WRITEHEADER
     C                     WRITEDETAIL
     C***********          WRITEFOOTING                                   S01486
     C           RRACKR    IFEQ 0                                         S01486
     C                     WRITENODTLS                                    S01486
     C                     END                                            S01486
     C*
     C**   END PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**    INDEX TO SUBROUTINES                                      *
     C**   ----------------------                                     *
     C**                                                              *
     C**   #A      - INITIAL PROCESSING                               *
     C**   #B      - ACCOUNT KEY PROCESSING                           *
     C**   #BA     - ACCESS CURRENCY DETAILS                          *
     C**   #BB     - EXTRACT PERFORMANCE DATA                         *
     C**   #BC     - ACCESS LOAN TYPE/SUB-TYPE DETAILS                *
     C**   #BE     - ACCESS PORTFOLIO DETAILS                         *
     C**   #BBA    - CALCULATE EXCHANGE RATE                          *
     C**   #BBB    - WRITE PRINCIPAL PERFORMANCE DATA                 *
     C**   #BBC    - WRITE INTEREST PERFORMANCE DATA                  *
     C**   #BBD    - WRITE FEE/COMMISSION PERFORMANCE DATA            *
     C**   #BBE    - WRITE TAX/CHARGE PERFORMANCE DATA                *
     C**   #BBF    - SET UP RELATED REFERENCE AND MODULE ID.          *   53103
     C**   *PSSR   - PROGRAM ERROR HANDLING SUBROUINE                 *
     C**   ZCCYCN  - DETERMINE EXCHANGE RATE                          *
     C**   ZEVRF   - SET PERFORMANCE EVENT REFERENCE                  *   53103
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #A        - INITIAL PROCESSING                             *
     C**                                                              *
     C**   CALLS     - *PSSR                                          *
     C**                                                              *
     C**   CALLED BY - MAINLINE                                       *
     C**                                                              *
     C*****************************************************************
     C*
     C           #A        BEGSR
     C*                                                                   S01486
     C***  Copyright Statement                                            S01486
     C                     MOVEACPY@      CPY2@  80                       S01486
     C********************************************************************S01486
     C***key*for*SDLOANL1*************************************************S01486
     C********************************************************************S01486
     C***********WWSDKY    KLIST                                          S01486
     C***********          KFLD           WWLTY2  2                       S01486
     C***********          KFLD           WWSUB2  2                       S01486
     C*
     C***key*for*PMPORTPP*************************************************S01486
     C** key for PMPORTPD                                                 S01486
     C*
     C           WWPPKY    KLIST
     C*********************KFLD           CNUM                            CPM004
     C**********           KFLD           #CNUM   60                                   CPM004 CSD027
     C                     KFLD           #CNUM   6                                           CSD027
     C                     KFLD           PTFR
      *                                                                   CPM005
      **  Key for PMCNSDPD                                                CPM005
      *                                                                   CPM005
     C           WWPPKZ    KLIST                                          CPM005
     C                     KFLD           CNUM                            CPM005
     C                     KFLD           KPTFR   4                       CPM005
     C*                                                                   094693
     C** Klist for ACCNT                                                  094693
     C*                                                                   094693
     C           ZWACCN    KLIST                                          094693
     C                     KFLD           ZWCNUM                          094693
     C                     KFLD           ZWCCY                           094693
     C                     KFLD           ZWACOD                          094693
     C                     KFLD           ZWACSQ                          094693
     C                     KFLD           ZWBRCA                          094693
     C*
     C** INITIALISE DB ERROR FIELDS AND STORE PROGRAM NAME FOR DB
     C** ERROR FIELD
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     MOVEL'PM1530'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C** DEFINE DATA AREA PMSTAT
     C           *NAMVAR   DEFN           PMSTAT
     C                     IN   PMSTAT
     C*
     C** ACCESS LF/SDBANKL1 TO OBTAIN BANK DETAILS
     C***********          READ SDBANKL1                 70               S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C************IN70     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            ****************
     C***********          MOVEL'SDBANKL1'DBFILE          * DBERROR  001 *S01486
     C                     MOVE 'SDBANKPD'DBFILE                          S01486
     C                     MOVE *BLANKS   DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CPM004
     C* Access Modules                                                    CPM004
     C*                                                                   CPM004
     C                     CALL 'AOMMODR0'                                CPM004
     C                     PARM *BLANKS   P@RTCD                          CPM004
     C                     PARM '*FIRST ' P@OPTN                          CPM004
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPM004
     C           P@RTCD    IFNE *BLANK                                    CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD50        DBASE                           CPM004
     C                     MOVE *BLANKS   DBFILE           ***************CPM004
     C                     MOVE 'SDMMODPD'DBFILE           * DBERROR 050 *CPM004
     C                     MOVE *BLANKS   DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C* If retail installed                                               CPM004
     C*                                                                   CPM004
     C           BGNXST    IFEQ 'Y'                                       CPM004
     C*                                                                   46386
     C*                                                                   099814
     C* Access ICD File SDRETLL0.                                         46386
     C*                                                                   46386
     C************LOVAL    SETLLSDRETLL0                            46386 S01486
     C***********          READ SDRETLL0                 70         46386 S01486
     C                     CALL 'AORETLR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDRETL    PARM SDRETL    DSFDY                           S01486
     C*                                                                   46386
     C* If Record not found - Database Error.                             46386
     C*                                                                   46386
     C************IN99     IFEQ '1'                                 46386 S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C***********          Z-ADD1         DBASE                     46386 S01486
     C                     Z-ADD2         DBASE                           S01486
     C                     MOVE *BLANKS   DBFILE           ***************46386
     C***********          MOVEL'SDRETLL0'DBFILE     * DBERROR 001 *46386 S01486
     C                     MOVE 'SDRETLPD'DBFILE           * DBERROR 002 *S01486
     C                     MOVE *BLANKS   DBKEY            ***************46386
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     46386
     C                     END                                            46386
     C                     END                                            CPM004
     C*                                                                   CPM004
     C** Get Portfolio Management ICD details using access object         CPM004
     C*                                                                   CPM004
     C                     CALL 'AOPORTR0'                                CPM004
     C                     PARM *BLANKS   P@RTCD                          CPM004
     C                     PARM '*FIRST ' P@OPTN                          CPM004
     C           SDPORT    PARM SDPORT    DSFDY                           CPM004
     C*                                                                   CPM004
     C** Check if an error occurred                                       CPM004
     C*                                                                   CPM004
     C           P@RTCD    IFNE *BLANKS                                   CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD51        DBASE            ***************CPM004
     C                     MOVE 'SDPORTPD'DBFILE           * DBERROR  051 CPM004
     C                     MOVE *BLANKS   DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C*                                                                   099814
     C* Access Switchable features for Pool portfolios                    099814
     C*                                                                   099814
     C                     CALL 'AOSARDR0'                                099814
     C                     PARM *BLANKS   P@RTCD  7                       099814
     C                     PARM '*VERIFY' P@OPTN  7                       099814
     C                     PARM 'CQQ001'  P@SARD  6                       099814
     C*                                                                   099814
     C           P@RTCD    IFEQ *BLANK                                    099814
     C                     MOVE 'Y'       WWPPRQ  1                       099814
     C                     END                                            099814
     C*
     C** SET UP FIELDS NOT CHANGING
     C                     MOVE 'LE'      QUTTYP
     C                     MOVE 'LE'      QUMODI
     C                     MOVE *BLANKS   QUTDSS
     C                     MOVE 'N'       QUCPTC
     C                     MOVE 'C'       QUACIN
     C                     MOVE 'N'       QUPPYT
     C****                 Z-ADDWWECD     QUPDAT                          46910
     C                     Z-ADDBJRDNB    QUPDAT                          46910
     C                     Z-ADD1         QUMPRC
     C*
     C           *LIKE     DEFN ECCY      WWECCY
     C           *LIKE     DEFN CNUM      WWCNUM
     C           *LIKE     DEFN PTFR      WWPTFR
     C                     MOVE *BLANKS   WWECCY
     C                     MOVE *BLANKS   WWCNUM
     C                     MOVE *BLANKS   WWPTFR
     C                     MOVE *BLANKS   WWLTY1  2
     C                     MOVE *BLANKS   WWSUB1  2
     C                     MOVE *BLANKS   WWCLS1  4                                           CLE042
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #B        - ACCOUNT KEY PROCESSING                         *
     C**                                                              *
     C**   CALLS     - #BA, #BB, #BC, #BE                             *
     C**                                                              *
     C**   CALLED BY - MAINLINE                                       *
     C**                                                              *
     C*****************************************************************
     C*
     C           #B        BEGSR
     C*
     C***********          READ PMLKEYS                  72               S01486
     C                     READ PMLKEYL0                 72               S01486
     C*
     C           *IN72     DOWEQ'0'
     C*
     C** INCREMENT COUNT OF ACCOUNT KEYS READ
     C                     ADD  1         RRACKR
     C*
     C** EXTRACT PERFORMANCE DATA
     C                     EXSR #BB
     C*
     C***********          READ PMLKEYS                  72               S01486
     C                     READ PMLKEYL0                 72               S01486
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BA       - ACCESS CURRENCY DETAILS                        *
     C**                                                              *
     C**   CALLS     - *PSSR                                          *
     C**                                                              *
     C**   CALLED BY - #B                                             *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BA       BEGSR
     C*
     C***********ECCY      CHAINSDCURRL0             73                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM ECCY      @CYCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C************IN73     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD3         DBASE            ****************
     C***********          MOVEL'SDCURRL0'DBFILE          ** DBERROR 03 **S01486
     C                     MOVE 'SDCURRPD'DBFILE                          S01486
     C                     MOVELECCY      DBKEY            **            **
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                      ****************
     C                     ELSE
     C                     Z-ADDA6SPRT    WWESPR 138
     C                     Z-ADDA6NBDP    WWENBD  10
     C                     MOVE A6MDIN    WWEMDI  1
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BC       - ACCESS LOAN TYPE/SUB-TYPE DETAILS              *
     C**                                                              *
     C**   CALLS     - *PSSR                                          *
     C**                                                              *
     C**   CALLED BY - #B                                             *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BC       BEGSR
     C*
     C***********WWSDKY    CHAINSDLOANL1             74                   S01486
     C                     CALL 'AOLOANR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM WWLTY2    @LNTY   2                       S01486
     C                     PARM WWSUB2    @LNST   2                       S01486
     C                     PARM WWCLS2    @LNCL   4                                           CLE042
     C           SDLOAN    PARM SDLOAN    DSFDY                           S01486
     C************IN74     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVELWWLTY2    WWKLTY
     C                     MOVELWWSUB2    WWKSUB
     C                     MOVELWWCLS2    WWKCLS                                              CLE042
     C                     Z-ADD4         DBASE            ****************
     C***********          MOVEL'SDLOANL1'DBFILE          ** DBERROR 04 **S01486
     C                     MOVE 'SDLOANPD'DBFILE                          S01486
     C                     MOVELWWKDB8    DBKEY            ****************                   CLE042
     C*********************MOVELWWKDB4    DBKEY            ****************                   CLE042
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BE       - ACCESS PORTFOLIO DEFINITION DETAILS            *
     C**                                                              *
     C**   CALLS     - *PSSR                                          *
     C**                                                              *
     C**   CALLED BY - #B                                             *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BE       BEGSR
      *                                                                   CPM005
     C                     MOVEL'N'       WW9998  1                       CPM005
     C                     MOVEL'N'       WW9999  1                       CPM005
     C                     MOVEL'N'       WWPORT  1                       CPM005
      *                                                                   CPM005
     C           PTFR      IFEQ '9997'                     B1             CPM005
      *                                                                   CPM005
     C           WWPPKY    CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                        B2             CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WWPORT                          CPM005
     C                     MOVE RNPTCY    PNPTCY                          CPM005
     C                     Z-ADDRNPCDP    PNPCDP                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    KPTFR                           CPM005
     C           WWPPKZ    CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                        B2             CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WW9999                          CPM005
     C                     MOVE RNPTCY    PNPTCY                          CPM005
     C                     Z-ADDRNPCDP    PNPCDP                          CPM005
     C                     END                             E2             CPM005
     C                     ELSE                            X1             CPM005
     C*
     C***********WWPPKY    CHAINPMPORTPP             76                   S01486
     C           WWPPKY    CHAINPMPORTPD             76                   S01486
     C           *IN76     IFEQ '1'
     C*********************MOVELCNUM      WWKCUS                          CPM004
     C                     MOVEL#CNUM     WWKCUS                          CPM004
     C                     MOVELPTFR      WWKPRF
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD5         DBASE            ****************
     C***********          MOVEL'PMPORTPP'DBFILE          ** DBERROR 05 **S01486
     C                     MOVE 'PMPORTPD'DBFILE                          S01486
     C                     MOVELWWKDB6    DBKEY            ****************
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END
     C*                                                                   056460
     C** SET ON FLAG INDICATING WHETHER PERFORMANCE CALCULATIONS          056460
     C** STARTED FOR PORTFOLIO                                            056460
     C                     MOVE 'N'       WWPORT  1                       056460
     C***********PNPSDT    IFLE WWECD                              056460 CPM005
     C           PNPSDT    IFLT WWECD                                     CPM005
     C           PNRECI    ANDEQ'D'                                       056460
     C                     MOVE 'Y'       WWPORT                          056460
     C                     END                                            056460
      *                                                                   CPM005
     C                     MOVEL'9998'    KPTFR                           CPM005
     C           WWPPKZ    CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                                       CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WW9998                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     MOVEL'9999'    KPTFR                           CPM005
     C           WWPPKZ    CHAINPMCNSDLL             80                   CPM005
      *                                                                   CPM005
     C           *IN80     IFEQ '0'                                       CPM005
     C           PNPSDT    ANDLTWWECD                                     CPM005
     C                     MOVEL'Y'       WW9999                          CPM005
     C                     END                                            CPM005
     C                     END                             E1             CPM005
     C*                                                                   056460
     C** CHECK WHETHER PORTFOLIO IS MEMBER OF POOL                        056460
     C                     MOVE 'N'       WWPOOL  1                       056460
     C**********           Z-ADD0         WSPCNU  60                                   056460 CSD027
     C                     MOVE *BLANKS   WSPCNU  6                                           CSD027
     C                     MOVE *BLANKS   WSPPTF  4                       056460
     C           WWPPRQ    IFEQ 'Y'                                       056460
     C           WWPPKY    CHAINPMPPTML1             75                   056460
     C*                                                                   056460
     C** IF THE PORTFOLIO IS A POOL MEMBER CHECK WHETHER PERFORMANCE ON   056460
     C** THE POOL                                                         056460
     C           *IN75     IFEQ '0'                                       056460
     C*                                                                   056460
     C**********           Z-ADDOSPCNU    WSPCNU  60                                   056460 CSD027
     C                     MOVE OSPCNU    WSPCNU                                              CSD027
     C                     MOVE OSPPTF    WSPPTF  4                       056460
     C*                                                                   056460
     C* Access POOL Portfolio Definition details.                         056460
     C           POOLKY    KLIST                                          056460
     C                     KFLD           OSPCNU                          056460
     C                     KFLD           OSPPTF                          056460
     C*                                                                   056460
     C***********POOLKY    CHAINPMPORTPP             75             056460S01486
     C           POOLKY    CHAINPMPORTPD             75                   S01486
     C*                                                                   056460
     C           *IN75     IFEQ '1'                                       056460
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD44        DBASE                           056460
     C                     MOVE *BLANKS   DBFILE           ***************056460
     C***********          MOVEL'PMPORTPP'DBFILE     * DBERROR 044 *056460S01486
     C                     MOVE 'PMPORTPD'DBFILE                          S01486
     C                     MOVELOSPCNU    DBKEY            ***************056460
     C                     MOVE OSPPTF    DBKEY                           056460
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     056460
     C                     END                                            056460
     C*                                                                   056460
     C** SET ON FLAG INDICATING PERFORMANCE CALCULATIONS REQUIRED FOR     056460
     C** POOL                                                             056460
     C           PNPSDT    IFLE WWECD                                     056460
     C           PNRECI    ANDEQ'D'                                       056460
     C                     MOVE 'Y'       WWPOOL                          056460
     C                     END                                            056460
     C                     END                                            056460
     C                     END                                            056460
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BB       - EXTRACT PERFORMANCE DATA                       *
     C**                                                              *
     C**   CALLS     - #BBA, #BBB, #BBC, #BBD, #BBE                   *
     C**                                                              *
     C**   CALLED BY - #B                                             *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BB       BEGSR
     C*
     C           WWCPTY    IFNE *BLANKS
     C                     GOTO #BB01
     C                     END
     C*
     C           WWCHR3    IFEQ 'V'                                       46386
     C           WWCOD2    ANDEQ'A'                                       46386
     C                     GOTO #BB00
     C                     END
     C*
     C           WWCHR3    IFEQ 'V'
     C           WWCOD2    IFEQ 'D'
     C           WWCOD2    OREQ 'P'
     C                     GOTO #BB00
     C                     END
     C                     END
     C*
     C           WWCHR3    IFEQ 'R'
     C           WWCOD2    IFEQ 'C'
     C           WWCOD2    OREQ 'A'
     C           WWCOD2    OREQ 'I'
     C           WWCOD2    OREQ 'F'
     C           WWCOD2    OREQ 'W'
     C                     GOTO #BB00
     C                     END
     C                     END
     C*
     C                     GOTO #BB01
     C*
     C           #BB00     TAG
      *                                                                   CPM004
      *  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
      *                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           BRCA      IFNE WWBRCA                                    CPM004
     C                     EXSR BRANCH                                    CPM004
     C                     MOVE BRCA      WWBRCA  3                       CPM004
     C                     ENDIF                                          CPM004
     C                     MOVE O#BICN    #CNUM                           CPM004
     C                     ENDIF                                          CPM004
      *                                                                   CPM004
      *  IF CUSTOMER PORTFOLIOS SUPPORTED                                 CPM004
      *                                                                   CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
     C                     MOVE CNUM      #CNUM                           CPM004
     C                     ENDIF                                          CPM004
     C*
     C** ON CHANGE OF CUSTOMER OR PORTFOLIO REFERENCE
     C***********CNUM      IFNE WWCNUM                                    CPM004
     C           #CNUM     IFNE WWCNUM                                    CPM004
     C           PTFR      ORNE WWPTFR
     C*********************Z-ADDCNUM      WWCNUM                          CPM004
     C**********           Z-ADD#CNUM     WWCNUM                                       CPM004 CSD027
     C                     MOVE #CNUM     WWCNUM                                              CSD027
     C                     MOVE PTFR      WWPTFR
     C                     EXSR #BE
     C                     END
     C****                                                                056460
     C***IF PERFORMANCE START DATE IS *GT EVENT CONTROL DATE DO NOT       056460
     C***EXTRACT DETAILS FOR ACCOUNT KEY                                  056460
     C****       PNPSDT    CABGTWWECD     #BB01                           056460
     C*                                                                   056460
     C** TERMINATE PROCESSING IF PORTFOLIO PERFORMANCE REQUIRED FOR       056460
     C** FOR NEITHER OF PORTFOLIO AND POOL PORTFOLIO                      056460
     C           WWPORT    IFEQ 'N'                                       056460
     C           WWPOOL    ANDEQ'N'                                       056460
     C           WW9998    ANDEQ'N'                                       CPM005
     C           WW9999    ANDEQ'N'                                       CPM005
     C                     GOTO #BB01                                     056460
     C                     END                                            056460
     C*
     C** ON CHANGE OF EVENT CURRENCY
     C           ECCY      IFNE WWECCY
     C                     MOVE ECCY      WWECCY
     C*
     C** ACCESS CURRENCY DETAILS
     C                     EXSR #BA
     C                     END
     C*
     C** ON CHANGE OF LOAN TYPE OR LOAN SUB-TYPE
     C           WWLTY2    IFNE WWLTY1
     C           WWSUB2    ORNE WWSUB1
     C           WWCLS2    ORNE WWCLS1                                                        CLE042
     C                     MOVE WWLTY2    WWLTY1
     C                     MOVE WWSUB2    WWSUB1
     C                     MOVE WWCLS2    WWCLS1                                              CLE042
     C*
     C** ACCESS LOAN TYPE/SUB-TYPE DETAILS
     C                     EXSR #BC
     C*
     C                     END
     C*                                                                   72242
     C** IF LOAN IS NOT VALUED DO NOT EXTRACT PERFORMANCE EVENT           72242
     C           AYLVLD    CABEQ'N'       #BB01                           72242
     C*
     C                     MOVE LNNO      QUTRNB
     C*
     C*** CALCULATE EXCHANGE RATE
     C                     EXSR #BBA
     C*
     C*********************Z-ADDCNUM      QUCNUM                          CPM004
     C**********           Z-ADD#CNUM     QUCNUM                                       CPM004 CSD027
     C                     MOVE #CNUM     QUCNUM                                              CSD027
     C                     MOVE PTFR      QUPTFR
     C                     MOVE AYINNR    QUINNR
     C                     MOVE ECCY      QUCCY
     C*                                                                   46386
     C** CHECK THAT SETTLEMENT ACCOUNT IN SAME PORTFOLIO AS DEAL          46386
     C                     MOVE 'N'       QUCPTC                          46386
     C                     Z-ADDSETP      ZMETH                           46386
     C                     MOVE OSAC      ZSETI                           46386
     C**********           Z-ADDCNUM      ZCNUM                                         46386 CSD027
     C                     MOVE CNUM      ZCNUM                                               CSD027
     C                     MOVE ECCY      ZCCY                            46386
     C                     MOVE OSBR      ZBRCA                           085862
     C                     EXSR ZSETAC                                    46386
     C                     EXSR #BBF                                      53103
     C*                                                                   CPM004
     C* IF BANK PORTFOLIOS SUPPORTED                                      CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           ZRPTFR    IFNE PTFR                                      CPM004
     C                     MOVE 'Y'       QUCPTC                          CPM004
     C                     END                                            CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C* IF CUSTOMER PORTFOLIOS SUPPORTED                                  CPM004
     C*                                                                   CPM004
     C           FCPORS    IFNE 'B'                                       CPM004
     C*                                                                   46386
     C           ZMETH     IFEQ 4                                         059474
     C           ZMETH     OREQ 5                                         059474
     C           ZMETH     OREQ 14                                        059474
     C           ZMETH     OREQ 15                                        059474
     C                     MOVE 'Y'       WSRETL  1                       059474
     C                     ELSE                                           059474
     C                     MOVE 'N'       WSRETL                          059474
     C                     END                                            059474
     C*                                                                   46386
     C           ZRPTFR    IFNE PTFR                                      46386
     C           WSRETL    OREQ 'N'                                       059474
     C                     MOVE 'Y'       QUCPTC                          46386
     C                     END                                            46386
     C                     END                                            CPM004
     C*
     C           WWCOD2    IFEQ 'A'
     C                     EXSR #BBB
     C                     ELSE
     C           WWCOD2    IFEQ 'D'
     C           WWCOD2    OREQ 'P'
     C           WWCOD2    OREQ 'I'
     C           WWCOD2    OREQ 'C'
     C                     EXSR #BBC
     C                     ELSE
     C           WWCOD2    IFEQ 'F'
     C                     EXSR #BBD
     C                     ELSE
     C           WWCOD2    IFEQ 'W'
     C                     EXSR #BBE
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C           #BB01     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BBB      - WRITE PRINCIPAL PERFORMANCE DATA               *
     C**                                                              *
     C**   CALLS     - NONE                                           *
     C**                                                              *
     C**   CALLED BY - #BB                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BBB      BEGSR
     C*
     C                     MOVE ' N'      QUPFMC
     C                     MOVE '  '      QUPFMS
     C                     Z-ADDEAMT      QUTAMT
     C                     Z-ADDEAMT      QURAMT
     C*
     C                     MOVE 'I'       QUINIO
     C           WWCHR3    IFEQ 'D'
     C           WWCHR3    OREQ 'V'
     C                     MOVE 'O'       QUINIO
     C                     END
     C*                                                                   CPM004
     C                     EXSR SWINIO                                    CPM004
     C*
     C           REVI      IFEQ 1
     C                     MOVE 'Y'       QUREVI
     C                     ELSE
     C                     MOVE 'N'       QUREVI
     C                     END
     C*                                                                   083014
     C** FOR INTEREST CAPITALISATION EVENT THE 'CHANGE TO PORTFOLIO       083014
     C** CAPITAL INDICATOR MUST BE 'N'                                    083014
     C           WWCOD2    IFEQ 'C'                                       083014
     C                     MOVE 'N'       QUCPTC                          083014
     C                     END                                            083014
     C*
     C****                 WRITEPMPTRAP0
     C****                 ADD  1         RRPERW                          056460
     C                     EXSR #ZA                                       056460
     C*                                                                   083014
     C** WRITE NOMINAL INFLOW RECORD FOR INTEREST CAPITALISATION EVENT    083014
     C           WWCHR3    IFEQ 'R'                                       083014
     C           WWCOD2    ANDEQ'C'                                       083014
     C                     MOVE ' N'      QUPFMC                          083014
     C                     MOVE *BLANKS   QUPFMS                          083014
     C                     MOVE 'O'       QUINIO                          083014
     C                     EXSR #ZA                                       083014
     C                     END                                            083014
     C*
     C           #BBB0     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BBC      - WRITE INTEREST PERFORMANCE DATA                *
     C**                                                              *
     C**   CALLS     - NONE                                           *
     C**                                                              *
     C**   CALLED BY - #BB                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BBC      BEGSR
     C*
     C                     MOVE 'IR'      QUPFMC
     C                     MOVE *BLANKS   QUPFMS
     C*
     C                     Z-ADDEAMT      QUTAMT
     C                     Z-ADDEAMT      QURAMT
     C*
     C           WWCOD2    IFEQ 'I'
     C           WWCOD2    OREQ 'D'
     C           WWCOD2    OREQ 'C'
     C                     MOVE 'I'       QUINIO
     C                     ELSE
     C                     MOVE 'O'       QUINIO
     C                     END
     C*                                                                   CPM004
     C                     EXSR SWINIO                                    CPM004
     C*
     C           REVI      IFEQ 1
     C                     MOVE 'Y'       QUREVI
     C                     ELSE
     C                     MOVE 'N'       QUREVI
     C                     END
     C*
     C****                 WRITEPMPTRAP0
     C****                 ADD  1         RRPERW                          056460
     C                     EXSR #ZA                                       056460
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BBD      - WRITE FEE/COMMISSION PERFORMANCE DATA          *
     C**                                                              *
     C**   CALLS     - NONE                                           *
     C**                                                              *
     C**   CALLED BY - #BB                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BBD      BEGSR
     C*
     C                     MOVE 'F '      QUPFMC
     C                     MOVE 'IR'      QUPFMS
     C                     Z-ADDEAMT      QUTAMT
     C                     Z-ADDEAMT      QURAMT
     C*
     C                     MOVE 'I'       QUINIO
     C*                                                                   CPM004
     C                     EXSR SWINIO                                    CPM004
     C*
     C           REVI      IFEQ 1
     C                     MOVE 'Y'       QUREVI
     C                     ELSE
     C                     MOVE 'N'       QUREVI
     C                     END
     C*
     C****                 WRITEPMPTRAP0
     C****                 ADD  1         RRPERW                          056460
     C                     EXSR #ZA                                       056460
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BBE      - WRITE TAX/CHARGE PERFORMANCE DATA              *
     C**                                                              *
     C**   CALLS     - NONE                                           *
     C**                                                              *
     C**   CALLED BY - #BB                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BBE      BEGSR
     C*
     C                     MOVE 'T '      QUPFMC
     C                     MOVE *BLANKS   QUPFMS
     C                     Z-ADDEAMT      QUTAMT
     C                     Z-ADDEAMT      QURAMT
     C                     MOVE 'I'       QUINIO
     C*                                                                   CPM004
     C                     EXSR SWINIO                                    CPM004
     C*
     C           REVI      IFEQ 1
     C                     MOVE 'Y'       QUREVI
     C                     ELSE
     C                     MOVE 'N'       QUREVI
     C                     END
     C*
     C****                 WRITEPMPTRAP0
     C****                 ADD  1         RRPERW                          056460
     C                     EXSR #ZA                                       56460%
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BBA      - CALCULATE EXCHANGE RATE                        *
     C**                                                              *
     C**   CALLS     - ZCCYCN                                         *
     C**                                                              *
     C**   CALLED BY - #BB                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BBA      BEGSR
     C*
     C                     Z-ADD0         ZAMTF
     C                     MOVE ECCY      ZCCYF
     C                     Z-ADDWWESPR    ZRATEF
     C                     Z-ADDWWENBD    ZCDPF
     C                     MOVE WWEMDI    ZMDINF
     C*
     C***********PNPTCY    CHAINSDCURRL0             73                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM PNPTCY    @CYCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C************IN73     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD6         DBASE            ****************
     C***********          MOVEL'SDCURRL0'DBFILE          ** DBERROR 06 **S01486
     C                     MOVE 'SDCURRPD'DBFILE                          S01486
     C                     MOVELPNPTCY    DBKEY            **            **
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                      ****************
     C                     END
     C*
     C                     MOVE PNPTCY    ZCCYT
     C                     Z-ADDA6SPRT    ZRATET
     C                     Z-ADDA6NBDP    ZCDPT
     C                     MOVE A6MDIN    ZMDINT
     C*
     C** CALCULATE THE CROSS RATE FROM EVENT (INSTRUMENT) CURRENCY
     C** TO PORTFOLIO CURRENCY
     C*
     C****                 EXSR ZCCYCN                                    50406
     C                     EXSR ZCCYCD                                    50406
     C*
     C           ZCRSMD    IFEQ 'M'
     C****                 Z-ADDZCRSRT    QUMFXR                          50406
     C                     Z-ADDZCRSRN    QUMFXR                          50406
     C                     ELSE
     C           ZCRSRT    IFEQ 0
     C                     Z-ADD0         QUMFXR
     C                     ELSE
     C           1         DIV  ZCRSRT    QUMFXR
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************   056460
      /EJECT                                                              53103
      ********************************************************************53103
      *                                                                  *53103
      * #BBF     - SET UP RELATED REFERENCE AND MODULE ID.               *53103
      *                                                                  *53103
      * SUBROUTINE CALLS:                                                *53103
      *                                                                  *53103
      * SUBROUTINE CALLED FROM:                                          *53103
      * #BB      -                                                       *53103
      *                                                                  *53103
      *                                                                  *53103
      ********************************************************************53103
     C           #BBF      BEGSR                                          53103
     C*                                                                   53103
     C*  If Settl. methode 4,5,14,15 then reformat ZSETO                  53103
     C           ZMETH     IFEQ 4                                         53103
     C           ZMETH     OREQ 5                                         53103
     C           ZMETH     OREQ 14                                        53103
     C           ZMETH     OREQ 15                                        53103
     C*                                                                   53103
     C*    - Reformat Customer and Ccy from ZSETO to QUREPS               53103
     C                     MOVELZSETO     WW6     6                       53103
     C           3         SUBSTZSETO:7   WW3     3                       53103
     C                     MOVELWW6       QUREPS    P                     53103
     C           QUREPS    CAT  WW3:1     QUREPS                          53103
     C*                                                                   53103
     C*    - For non pool customer add A/c code & seq.                    53103
     C***********WWPOOL    IFNE 'Y'                                 53103 CPM005
     C***********4         SUBSTZSETO:10  WW4     4                  53103085862
     C***********          MOVE ZSETO     WW2     2                  53103085862
     C***********QUREPS    CAT  WW4:1     QUREPS                     53103085862
     C***********QUREPS    CAT  WW2:1     QUREPS                     53103085862
     C                     MOVE *BLANKS   QUREPS                          085862
     C                     MOVELZSETO     QUREPS                          085862
     C***********          ENDIF                                    53103 CPM005
     C*    -                                                              53103
     C                     MOVE 'RE'      QUREMI                          53103
     C*                                                                   53103
     C*  Else blanks                                                      53103
     C                     ELSE                                           53103
     C                     MOVE *BLANKS   QUREPS                          53103
     C                     MOVE *BLANKS   QUREMI                          53103
     C                     ENDIF                                          53103
     C*                                                                   53103
     C                     ENDSR                                          53103
      ********************************************************************53103
     C/EJECT                                                              56460%
     C*****************************************************************   056460
     C**                                                              *   056460
     C*****#ZA*******-*WRITE*RECORDS*TO*PMPTRAPP********************056460S01486
     C**   #ZA       - WRITE RECORDS TO PMPTRAPD                      *   S01486
     C**                                                              *   056460
     C**   CALLS     -                                                *   56460%
     C**                                                              *   56460%
     C**   CALLED BY - #BBB WRITE PRINCIPAL PERFORMANCE RECORD        *   056460
     C**               #BBC WRITE INTEREST PERFORMANCE RECORD         *   056460
     C**               #BBD WRITE FEE/COMMISSION PERFORMANCE RECORD   *   56460%
     C**               #BBC WRITE TAX/CHARGES PERFORMANCE RECORD      *   056460
     C**                                                              *   056460
     C*****************************************************************   056460
     C*                                                                   056460
     C           #ZA       BEGSR                                          056460
     C*                                                                   056460
     C** IF PORTFOLIO HAS PERFORMANCE WRITE RECORD FOR PORTFOLIO          056460
     C           WWPORT    IFEQ 'Y'                                       056460
     C                     EXSR ZEVRF                                     53103
     C                     Z-ADDZZEVRF    QUEVRF                          53103
     C                     WRITEPMPTRAP0                                  056460
     C                     ADD  1         RRPERW                          056460
     C                     END                                            056460
      *                                                                   CPM005
      **  If record required for '9998' or '9999' portfolio, calculate    CPM005
      **  FX cross rate                                                   CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                                       CPM005
     C           WW9999    OREQ 'Y'                                       CPM005
      *                                                                   CPM005
      **  Access PF/SDCURRPD using currency of 9998 / 9999 portfolio      CPM005
      *                                                                   CPM005
     C                     CALL 'AOCURRR0'                                CPM005
     C                     PARM *BLANKS   @RTCD                           CPM005
     C                     PARM '*KEY'    @OPTN                           CPM005
     C                     PARM RNPTCY    @CYCD                           CPM005
     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
      *                                                                   CPM005
      **  If record with required key is not found then DB error          CPM005
      *                                                                   CPM005
     C           @RTCD     IFNE *BLANKS                                   CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD23        DBASE            ***************CPM005
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR  023 CPM005
     C                     MOVELRNPTCY    DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  Calculate rate from event currency to portfolio currency        CPM005
      *                                                                   CPM005
     C                     Z-ADD1         ZAMTF                           CPM005
     C                     Z-ADDWWESPR    ZRATEF                          CPM005
     C                     Z-ADDWWENBD    ZCDPF                           CPM005
     C                     MOVE WWEMDI    ZMDINF                          CPM005
     C                     MOVE WWECCY    ZCCYF                           CPM005
     C                     Z-ADDA6SPRT    ZRATET                          CPM005
     C                     Z-ADDA6NBDP    ZCDPT                           CPM005
     C                     MOVE A6MDIN    ZMDINT                          CPM005
     C                     MOVE RNPTCY    ZCCYT                           CPM005
     C                     EXSR ZCCYCD                                    CPM005
     C                     Z-ADDZCRSRN    WWMFX9 308                      CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C           WW9998    IFEQ 'Y'                                       CPM005
     C                     MOVELQUPTFR    WSPTFR  4                       CPM005
     C                     MOVELQUCPTC    WSCPTC  1                       CPM005
     C                     MOVELQUMFXR    WSMFX9 308                      CPM005
     C                     MOVEL'9998'    QUPTFR                          CPM005
     C                     Z-ADDWWMFX9    QUMFXR                          CPM005
     C                     EXSR ZEVRF                                     CPM005
     C                     Z-ADDZZEVRF    QUEVRF                          CPM005
      *                                                                   CPM005
      **  Check whether settlement is within '9998' portfolio             CPM005
      *                                                                   CPM005
     C           QUCPTC    IFEQ 'Y'                                       CPM005
     C           WSRETL    ANDEQ'Y'                                       CPM005
     C           ZRCNUM    ANDEQCNUM                                      CPM005
     C           ZRPTFR    ANDNE'9997'                                    CPM005
     C                     MOVE 'N'       QUCPTC                          CPM005
     C                     END                                            CPM005
     C                     WRITEPMPTRAP0                                  CPM005
     C                     MOVELWSPTFR    QUPTFR                          CPM005
     C                     MOVELWSCPTC    QUCPTC                          CPM005
     C                     Z-ADDWSMFX9    QUMFXR                          CPM005
     C                     ADD  1         RRPERW                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C           WW9999    IFEQ 'Y'                                       CPM005
     C                     MOVELQUPTFR    WSPTFR                          CPM005
     C                     MOVELQUCPTC    WSCPTC  1                       CPM005
     C                     Z-ADDQUMFXR    WSMFX9 308                      CPM005
     C                     MOVEL'9999'    QUPTFR                          CPM005
     C                     Z-ADDWWMFX9    QUMFXR                          CPM005
     C                     EXSR ZEVRF                                     CPM005
     C                     Z-ADDZZEVRF    QUEVRF                          CPM005
      *                                                                   CPM005
      **  Check whether settlement is within customer                     CPM005
      *                                                                   CPM005
     C           QUCPTC    IFEQ 'Y'                                       CPM005
     C           WSRETL    ANDEQ'Y'                                       CPM005
     C           ZRCNUM    ANDEQCNUM                                      CPM005
     C                     MOVE 'N'       QUCPTC                          CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     WRITEPMPTRAP0                                  CPM005
     C                     MOVELWSPTFR    QUPTFR                          CPM005
     C                     MOVELWSCPTC    QUCPTC                          CPM005
     C                     Z-ADDWSMFX9    QUMFXR                          CPM005
     C                     ADD  1         RRPERW                          CPM005
     C                     END                                            CPM005
     C*                                                                   056460
     C** IF POOL HAS PERFORMANCE WRITE RECORD TO CASH ANALYSIS FILE       056460
     C           WWPOOL    IFEQ 'Y'                                       056460
     C**********           Z-ADDQUCNUM    WSCNUM  60                                   056460 CSD027
     C                     MOVE QUCNUM    WSCNUM  6                                           CSD027
     C                     MOVE QUPTFR    WSPTFR  4                       056460
     C                     MOVE QUCPTC    WSCPTC  1                       056460
     C                     MOVE QUREPS    WSREPS 20                       CPM005
     C**********           Z-ADDWSPCNU    QUCNUM                                       056460 CSD027
     C                     MOVE WSPCNU    QUCNUM                                              CSD027
     C                     MOVE WSPPTF    QUPTFR                          056460
      *                                                                   CPM005
      **  For pool portfolio, set account code and sequence to zero       CPM005
      *                                                                   CPM005
     C                     MOVEL' 0000 00'WDRK10 10                       CPM005
     C                     MOVE WDRK10    QUREPS                          CPM005
     C                     MOVELWSPCNU    QUREPS                          CPM005
     C*                                                                   056460
     C** IF CHANGE TO PORTFOLIO CAPITAL IS YES, IF THE TRANSACTION        056460
     C** AND SETTLEMENT ACCOUNT ARE IN THE SAME POOL RESET CPTC TO 'N'    056460
     C           QUCPTC    IFEQ 'Y'                                       056460
     C           WSRETL    ANDEQ'Y'                                       059474
     C           FCPORS    ANDNE'B'                                       CPM004
     C*                                                                   056460
     C           TPPOOL    KLIST                                          056460
     C                     KFLD           ZCNUM                           056460
     C                     KFLD           ZPTFR                           056460
     C*                                                                   056460
     C** OBTAIN POOL PORTFOLIO REFERENCE FOR SETTLEMENT PORTFOLIO         056460
     C           TPPOOL    CHAINPMPPTML1             75                   056460
     C*                                                                   056460
     C** IF WHETHER SETTLEMENT ACCOUNT AND TRADE IN SAME POOL RESET       056460
     C** CHANGE TO PORTFOLIO CAPITAL INDICATOR                            056460
     C           *IN75     IFEQ '0'                                       056460
     C           OSRECI    ANDEQ'D'                                       056460
     C           WSPCNU    ANDEQOSPCNU                                    056460
     C           WSPPTF    ANDEQOSPPTF                                    056460
     C                     MOVE 'N'       QUCPTC                          056460
     C                     END                                            056460
     C                     END                                            056460
     C*                                                                   056460
     C                     EXSR ZEVRF                                     53103
     C                     Z-ADDZZEVRF    QUEVRF                          53103
     C                     WRITEPMPTRAP0                                  056460
     C**********           Z-ADDWSCNUM    QUCNUM                                       056460 CSD027
     C                     MOVE WSCNUM    QUCNUM                                              CSD027
     C                     MOVE WSPTFR    QUPTFR                          056460
     C                     MOVE WSCPTC    QUCPTC                          056460
     C                     MOVE WSREPS    QUREPS                          CPM005
     C                     ADD  1         RRPERW                          056460
     C                     END                                            056460
     C*                                                                   056460
     C                     ENDSR                                          056460
     C********************************************************************CPM004
      *                                                                   CPM004
      * BRANCH   - RETRIEVE BRANCH'S CUSTOMER DETAILS                     CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLS:                                                 CPM004
      * *PSSR    - DB ERROR SUB-ROUTINE                                   CPM004
      * AOPLCSR1 - PORTFOLIO MANAGEMENT CUSTOMER DETAILS                  CPM004
      *                                                                   CPM004
      * SUBROUTINE CALLED FROM:                                           CPM004
      * #BFA     - OBTAIN STANDING DATA & PROCEED TO FORMATTING SR'S      CPM004
      *                                                                   CPM004
      * ROUTINE USES VARIABLES:                                           CPM004
      *                                                                   CPM004
      ********************************************************************CPM004
     C           BRANCH    BEGSR                                          CPM004
     C**                                                                  CPM004
     C                     MOVE 'B'       I#PORS                          CPM004
     C                     MOVE FCR997    I#R997                          CPM004
     C                     MOVE BRCA      I#BRCA                          CPM004
     C**                                                                  CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CPM004
     C                     PARM '*KEY   ' P@OPTN  7        I:Option       CPM004
     C                     PARM           I@PARM           I:Parameters   CPM004
     C                     PARM *BLANKS   O@PARM           O:Parameters   CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY            O:Format       CPM004
     C*                                                                   CPM004
     C** ERROR                                                            CPM004
     C           P@RTCD    IFNE *BLANK                                    CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     Z-ADD40        DBASE            ***************CPM004
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 40 *CPM004
     C                     MOVELI#BRCA    DBKEY            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
      *                                                                   CPM004
     C                     ENDSR                                          CPM004
      ********************************************************************CPM004
     C           SWINIO    BEGSR                                          CPM004
     C*                                                                   CPM004
     C*  IF BANK PORTFOLIOS SUPPORTED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C           QUINIO    IFEQ 'I'                                       CPM004
     C                     MOVE 'O'       QUINIO                          CPM004
     C                     ELSE                                           CPM004
     C                     MOVE 'I'       QUINIO                          CPM004
     C                     END                                            CPM004
     C                     END                                            CPM004
     C                     ENDSR                                          CPM004
     C********************************************************************50406
     C*                                                                   50406
     C*  ZCCYCN SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER       50406
     C*  CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES             50406
     C*                                                                   50406
     C*  INPUT  FIELDS                                                    50406
     C*       ZAMTF  150     AMOUNT IN 'FROM' CURRENCY                    50406
     C*       ZCCYF   3A     FROM CURRENCY                                50406
     C*       ZCCYT   3A     TO CURRENCY                                  50406
     C*       ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY                50406
     C*       ZRATET 138     SPOT RATE FOR 'TO' CURRENCY                  50406
     C*       ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CURRENCY50406
     C*       ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURRENCY  50406
     C*       ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY  50406
     C*       ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY    50406
     C*                                                                   50406
     C*  OUTPUT  FIELDS                                                   50406
     C*       ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT50406
     C*       ZCRSRT 138     CROSS EXCHANGE RATE                          50406
     C*       ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR         50406
     C*                                                                   50406
     C*                                                                   50406
     C*  CALLS:                                                           50406
     C*       ZCCYCA - CONVERT AMOUNT                                     50406
     C********************************************************************50406
     C*                                                                   50406
     C           ZCCYCD    BEGSR                           *** ZCCYCN *** 50406
     C*                                                                   50406
     C** DEFINE ALL FIELDS                                                50406
     C                     Z-ADDZAMTF     ZAMTF  150                      50406
     C                     MOVE ZCCYF     ZCCYF   3                       50406
     C                     MOVE ZCCYT     ZCCYT   3                       50406
     C                     Z-ADDZRATEF    ZRATEF 138                      50406
     C                     Z-ADDZRATET    ZRATET 138                      50406
     C                     MOVE ZMDINF    ZMDINF  1                       50406
     C                     MOVE ZMDINT    ZMDINT  1                       50406
     C                     Z-ADDZCDPF     ZCDPF   10                      50406
     C                     Z-ADDZCDPT     ZCDPT   10                      50406
     C                     Z-ADDZAMTT     ZAMTT  150                      50406
     C                     Z-ADDZCRSRT    ZCRSRT 138                      50406
     C                     MOVE ZCRSMD    ZCRSMD  1                       50406
     C*                                                                   50406
     C*50406'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TO' CURR50406
     C** EQUAL TO AMOUNT IN 'FROM' CURRENCY                               50406
     C           ZCCYF     IFEQ ZCCYT                                     50406
     C                     Z-ADDZAMTF     ZAMTT                           50406
     C                     Z-ADD1         ZCRSRT                          50406
     C                     MOVE 'M'       ZCRSMD                          50406
     C           1000000000MULT 1000000   ZCRSRN                          50406
     C                     GOTO CCYEN1                                    50406
     C                     END                                            50406
     C*                                                                   50406
     C** INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO                 50406
     C                     Z-ADD*ZEROS    ZCRSRT                          50406
     C*                                                                   50406
     C** CONVERT 'FROM' RATE TO MULTIPLY RATE                             50406
     C           ZMDINF    IFEQ 'M'                                       50406
     C                     Z-ADDZRATEF    ZRATF1 138                      50406
     C           1000000000MULT ZRATEF    ZRATF2 308                      50406
     C           10        MULT ZRATF2    ZRATF2                          50406
     C                     ELSE                                           50406
     C           1         DIV  ZRATEF    ZRATF1                          50406
     C           1000000000MULT 10        ZRWORK 200                      50406
     C           ZRWORK    DIV  ZRATEF    ZRATF2    H                     50406
     C                     END                                            50406
     C*                                                                   50406
     C** CONVERT 'TO' RATE TO MULTIPLY RATE                               50406
     C           ZMDINT    IFEQ 'M'                                       50406
     C                     Z-ADDZRATET    ZRATT1 138                      50406
     C           1000000000MULT ZRATET    ZRATT2 308                      50406
     C           10        MULT ZRATT2    ZRATT2                          50406
     C                     ELSE                                           50406
     C           1         DIV  ZRATET    ZRATT1                          50406
     C           1000000000MULT 10        ZRWORK                          50406
     C           ZRWORK    DIV  ZRATET    ZRATT2    H                     50406
     C                     END                                            50406
     C*                                                                   50406
     C** NOW CALCULATE CROSS RATE                                         50406
     C           ZRATT1    IFNE *ZEROS                                    50406
     C           ZRATF1    DIV  ZRATT1    ZCRSRT                          50406
     C*                                                                   50406
     C** CALCULATE DOUBLE PRECISION FX RATE                               50406
     C** FIRST SPLIT FIGURE INTO TWO PARTS                                50406
     C           1000000000MULT 1000000   ZRWORK                          50406
     C           ZRATF2    MULT ZRWORK    ZRATBF 300                      50406
     C                     Z-ADDZRATF2    ZRATSF 158                      50406
     C*                                                                   50406
     C** DIVIDE BOTH BIG AND SMALL PARTS BY TO FX RATE AND ADD TO CROSS RA50406
     C** TO BE USED IN CALCULATIONS                                       50406
     C           ZRATBF    DIV  ZRATT2    ZCRSRN 309H                     50406
     C           ZRATSF    DIV  ZRATT2    ZCRSR1 309H                     50406
     C                     ADD  ZCRSR1    ZCRSRN                          50406
     C                     END                                            50406
     C*                                                                   50406
     C** MOVE MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULT/DIV   50406
     C** INDICATOR (ZCRSMD)                                               50406
     C                     MOVE 'M'       ZCRSMD                          50406
     C*                                                                   50406
     C** IF CROSS EXCHANGE RATE IS EQUAL TO ZERO                          50406
     C** SET ZAMTT  TO *ZERO  & EXIT                                      50406
     C           ZCRSRN    IFEQ 0                                         50406
     C                     Z-ADD*ZEROS    ZAMTT                           50406
     C                     GOTO CCYEN1                                    50406
     C                     END                                            50406
     C*                                                                   50406
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF) EQUALS DECIMAL    50406
     C** DECIMAL PLACES  FOR 'TO' CURRENCY CONVERT AMOUNT BY SIMPLE       50406
     C** MULTIPLICATION                                                   50406
     C           ZCDPF     IFEQ ZCDPT                      B1             50406
     C           ZAMTF     MULT ZCRSRN    ZAMTO  300H                     50406
     C                     END                             E1             50406
     C*                                                                   50406
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF)  NOT EQUALS DECIMA50406
     C** DECIMAL PLACES  FOR 'TO' CURRENCY ADJUST AMOUNT FOR DIFFERENT DP 50406
     C           ZCDPF     IFNE ZCDPT                      B1             50406
     C*                                                                   50406
     C** SUBTRACT DECIMAL PLACES 'FROM' FROM DECIMAL PLACES 'TO' IN POWER 50406
     C           ZCDPT     SUB  ZCDPF     ZWKPX   10                      50406
     C           ZWKPX     ADD  4         B       30                      50406
     C*                                                                   50406
     C** IF POWER ELEMENT (8,4) LESS THAN 1                               50406
     C           POWER,B   IFLT 1                          B2             50406
     C*                                                                   50406
     C** MULTIPLY AMOUNT IN FROM CURRENCY BY ELEMENT IN POWER ARRAY       50406
     C           POWER,B   MULT ZAMTF     ZWK153 153                      50406
     C*                                                                   50406
     C           ZWK153    MULT ZCRSRN    ZAMTO     H                     50406
     C                     END                             E2             50406
     C*                                                                   50406
     C** IF POWER ELEMENT (8,4) GREATER OR EQUAL TO 1                     50406
     C           POWER,B   IFGE 1                          B2             50406
     C           ZAMTF     MULT POWER,B   ZAMTO                           50406
     C           ZAMTO     MULT ZCRSRN    ZAMTO     H                     50406
     C                     END                             E2             50406
     C                     END                             E1             50406
     C*                                                                   50406
     C           ZAMTO     DIV  ZRWORK    ZAMTT     H                     50406
     C*                                                                   50406
     C           CCYEN1    ENDSR                                          50406
     C*****************************************************************
      /EJECT                                                              53103
      ********************************************************************53103
      *                                                                  *53103
      * ZEVRF    - SET PERFORMANCE EVENT REFERENCE                       *53103
      *                                                                  *53103
      *   out : ZZEVRF                                                   *53103
      ********************************************************************53103
     C           ZEVRF     BEGSR                                          53103
     C*                                                                   53103
     C           *LOCK     IN   PMSTAT                                    53103
     C                     MOVE DAEVRF    WWEVRF  70                      53103
     C                     Z-ADDWWEVRF    ZZEVRF  70                      53103
     C                     ADD  1         WWEVRF                          53103
     C                     MOVE WWEVRF    DAEVRF                          53103
     C                     OUT  PMSTAT                                    53103
     C*                                                                   53103
     C                     ENDSR                                          53103
      ********************************************************************53103
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   *PSSR     - Program error handling routine                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*                                                                   S01486
     C                     WRITEHEADER                                    S01486
     C                     WRITEDBERROR                                   S01486
     C*                                                                   S01486
     C                     DUMP
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C/EJECT
     *****/COPY ZSRSRC,ZCCYCN                                        47719 50406
      /COPY ZSRSRC,ZCCYXR                                                  47719
      /COPY ZSRSRC,ZSETAC                                                  46386
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** Array of powers of 10 for currency conversion
0000001
0000010
0000100
0001000
0010000
0100000
1000000
