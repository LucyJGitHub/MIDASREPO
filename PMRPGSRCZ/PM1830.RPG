     H        1                                                           CPM003
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Extract FF positions - part II')              *
     H********1   Y                                                       CPM003
     F*****************************************************************
     F*                                                               *
     F*  Midas  - Portfolio Management                                *
     F*                                                               *
     F*  PM1830 - PM Extract FF positions - Part II                   *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. 250228             Date 22May20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CLE148             Date 23Jul12               *
      *                 AR746662           Date 03May11               *
      *                 CER059             Date 19Jul10               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247517             Date 09May07               *
      *                 CPK027             Date 17Apr07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 241147A            Date 07Nov06               *
      *                 241147             Date 26Oct06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE025             Date 20Oct03               *
      *                 215528             Date 21Mar03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun02               *
      *                 182961             Date 21Apr01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM005             Date 29Jul96               *
      *                 CFF004             Date 11Sep96               *
     F*                 CPM003             DATE 06DEC95               *
     F*                 083338             DATE 15FEB95               *
     F*                 078956             DATE 13DEC94               *
     F*                 075998             DATE 20SEP94               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  250228 - Modify the field names as per PMPSTMQ0 changes.     *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR746662 - Discrepancy in premium amount in Currency OTC     *
      *             screen and Projected Available Balance Enquiry    *
      *             Applied fix 249171. (Recompile)                   *
      *             (Child: Artf746663)                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus                                          *
      *  247517 - Reversed fix 241147.                                *
      *  CPK027 - Errors in compiling MP1_3_TTTS - recompile over     *
      *           changed FFTVCLZ2.                                   *
      *  241147A - Recompile.                                         *
      *  241147 - Recompile.                                          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  215528 - System is associating a wrong premium amount.       *
      *           Recompiled only.                                    *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed FFYTOPZ1.                    *
      *  182961 - Database error occurred due to a blank key field    *
      *           (Instrument Type).  The default Instrument type in  *
      *           PF/SDPORTPD is taken if a blank instrument type is  *
      *           encountered.                                        *
     F*  CPM005 - Private Banking Phase II                            *
     F*           Focus Group Changes Upgraded to DBA                 *
     F*           Just Recompiled because of PM File(s) changes       *
     F*  CFF004 - Increase in size of Price Fields                    *
     F*  CPM003 - FF PM Interface Upgrade to R10.                     *
     F*  083338 - CORRECT DECIMAL PLACES IN MARKET PRICES             *
     F*  078956 - SUNDRY FIXES TO PERFORMANCE                         *
     F*  075998 - WRITTEN TO ALLOW PERFORMANCE FOR FUTURES & OPTIONS  *
      *                                                               *
     F*****************************************************************
     FPMPPTDPDIF  E           K        DISK
     F                                              KINFSR *PSSR
     F* PM Pool Portfolio Definition file - Prefix OR
     F*
     FPMPPTML0IF  E           K        DISK
     F                                              KINFSR *PSSR
     F* PM Pool Portfolio Members file - Prefix OS
     F*
     F***SDPLINL4IF**E           K        DISK                            CPM003
     F***********                                      KINFSR *PSSR       CPM003
     F****SD*Portfolio*Instrument*****************************************CPM003
     F*
     F***PMPSTMPPO***E                    DISK                      A     CPM003
     FPMPSTMQ0O   E                    DISK                      A        CPM003
     F                                              KINFSR *PSSR
     F* PM Performance Start of Month Position
     F*
     F***PMPMIMPPO***E           K        DISK                      A     CPM003
     FPMPMIMPDO   E           K        DISK                      A        CPM003
     F                                              KINFSR *PSSR
     F* PM Performance Mid Month Position
     F*
     F***PMFOPSPPUF**E           K        DISK                      A     CPM003
     FPMFOPSPDUF  E           K        DISK                      A        CPM003
     F                                              KINFSR *PSSR
     F**PM*Pool*Portfolio*Future*&*Option*Position*-*Prefix*WW************CPM003
     F* PM Pool Portfolio Future & Option Position - Prefix GJ            CPM003
     F*
     FINTYP   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F* FF Instrument Types
     F*
     F***TRANSP2*IF**E           K        DISK                            CPM003
     FPMTRANL0IF  E           K        DISK                               CPM003
     F                                              KINFSR *PSSR
     F* FF Transactions by Portfolio
     F*
     FPRICS   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F* FF Price details
     F*
     FSDPORTPDIF  E                    DISK         KINFSR *PSSR          182961
     F***SDCURRL1IF**E           K        DISK                            CPM003
     F***********                                      KINFSR *PSSR       CPM003
     F****SD*Currency*Details*-*Prefix*A6*********************************CPM003
     F***********                                                         CPM003
     F***SDPORTL1IF**E           K        DISK                            CPM003
     F***********                                      KINFSR *PSSR       CPM003
     F**PM*I.C.D.*-*Prefix*P9*********************************************CPM003
     F***********                                                         CPM003
     F***SDBANKL1IF**E           K        DISK                            CPM003
     F***********                                      KINFSR *PSSR       CPM003
     F**Bank*Details*file*************************************************CPM003
     FPM1830AUO   E                    PRINTER                        UC  CPM003
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   70 *
     F**      * 71   72   73   74   75   76   77   78   79   .. *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     F**      ***************************************************
     E*
     E***/COPY*ZSRSRC,ZFFOLN1                                             CPM003
     E/COPY PMCPYSRC,ZFFOLN1                                              CPM003
      /COPY ZSRSRC,FFPRCSZ2
     E*
     E** ARRAY FOR POWER
     E                    POWER   1   7  7 3             POWER ARRAY
     E*
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E**************************************************************************
     IINTYPDF                                                             CPM003
     I*                                                                   CPM003
     I**   Selected Instrument Type details                               CPM003
     I*                                                                   CPM003
     I              CTAM                            FFCTAM                CPM003
     I              CNTT                            FFCNTT                CPM003
     IPRICSDF
     I              ISTT                            PISTT
     I              YRNO                            PYRNO
     I              MTHN                            PMTHN
     I              PCAL                            PPCAL
     I              STRP                            PSTRP
     I*
      /COPY ZSRSRC,FFSRDSZ1
     I***/COPY*ZSRSRC,ZFFOLN2                                             CPM003
     I/COPY PMCPYSRC,ZFFOLN2                                              CPM003
      /COPY ZSRSRC,FFPRCSZ3
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     I***LDA********UDS                            256                    CPM003
     I***********                           132 183 DBLOT                 CPM003
     I***********                           132 141 DBFILE                CPM003
     I***********                           142 170 DBKEY                 CPM003
     I***********                           171 180 DBPGM                 CPM003
     I***********                           181 1830DBASE                 CPM003
     ILDA         DS                            256                       CPM003
     I                                      134 183 DBLOT                 CPM003
     I                                      134 141 DBFILE                CPM003
     I                                      142 170 DBKEY                 CPM003
     I                                      171 180 DBPGM                 CPM003
     I                                      181 1830DBASE                 CPM003
      /COPY ZSRSRC,ZYLDZ1                                                 CPM003
     ISDBANK    E DSSDBANKPD                                              CPM003
     I**  Midas  Bank details                                             CPM003
     ISDCURR    E DSSDCURRPD                                              CPM003
     I**  Midas  Currencies details                                       CPM003
     ISDPLIN    E DSSDPLINPD                                              CPM003
     I**  Midas  Instrument details                                       CPM003
     ISDPORT    E DSSDPORTPD                                              CPM003
     I**  Midas  Portfolio ICD                                            CPM003
     IDSFDY     E DSDSFDY                                                 CPM003
     I**  Short data structure                                            CPM003
     I*                                                                   CPM003
     IDSSDY     E DSDSSDY                                                 CPM003
     I**  Long data structure                                             CPM003
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
      /EJECT
     C*****************************************************************
     C*  P R O G R A M     S T A R T
     C*****************************************************************
     C*
     C** RECEIVE START MONTH NUMBER
     C           *ENTRY    PLIST
     C**********           PARM           PACNUM  60                                          CSD027
     C                     PARM           PACNUM  6                                           CSD027
     C                     PARM           PAPTFR  4
     C                     PARM           PAPTCY  3
     C                     PARM           PASTMN  2
     C                     PARM           PAMODE  1
     C*****************************************************************
     C** DEFINE KEY
     C           KPOOL     KLIST
     C                     KFLD           PACNUM
     C                     KFLD           PAPTFR
     C*
     C** DEFINE KEY
     C           KTRAN     KLIST
     C                     KFLD           POCNUM
     C                     KFLD           POPTFR
     C*
     C***DEFINE*KEY*TO*ACCESS*PF/PMFOPSPP*WITH*POOL*AND*POSITIONS*DETAILS*CPM003
     C** DEFINE KEY TO ACCESS PF/PMFOPSPD WITH POOL AND POSITIONS DETAILS CPM003
     C           KPOOL2    KLIST
     C                     KFLD           PACNUM
     C                     KFLD           PAPTFR
     C                     KFLD           XXISTT
     C                     KFLD           XXYRNO
     C                     KFLD           XXMTHN
     C                     KFLD           XXPCAL
     C                     KFLD           XXSTRP
     C*
     C***DEFINE*KEY*TO*ACCESS*PF/TRANSP2*WITH*CUSTOMER,*PORTFOLIO*AND*POSNCPM003
     C** DEFINE KEY TO ACCESS PF/PMTRANL0 WITH CUSTOMER, PORTFOLIO        CPM003
     C** AND POSITION                                                     CPM003
     C           KTRAN2    KLIST
     C                     KFLD           POCNUM
     C                     KFLD           POPTFR
     C                     KFLD           XPISTT
     C                     KFLD           XPYRNO
     C                     KFLD           XPMTHN
     C                     KFLD           XPPCAL
     C                     KFLD           XPSTRP
     C*
     C** DEFINE KEY TO ACCESS PRICE
     C           KPRICS    KLIST
     C                     KFLD           ISTT
     C                     KFLD           YRNO
     C                     KFLD           MTHN
     C                     KFLD           PCAL
     C                     KFLD           STRP
     C*****************************************************************
      ***  Copyright Statement.                                           CPM003
     C                     MOVEACPY@      ACT@   80                       CPM003
     C** PREPARE LDA                                                      CPM003
     C           *NAMVAR   DEFN           LDA                             CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     MOVEL*BLANK    DBLOT                           CPM003
     C                     MOVEL'PM1830'  DBPGM                           CPM003
     C                     OUT  LDA                                       CPM003
     C*
     C** INITIAL PROCESSING
     C           WWFRST    IFNE 'Y'
     C                     EXSR INIT
     C                     END
     C*
     C** ACCESS POOL PORTFOLIO
     C           KPOOL     CHAINPMPPTDPD             81
     C*
     C           *IN81     IFEQ '0'                        - B1
     C           ORRECI    ANDEQ'D'
     C*
     C           KPOOL     SETLLPMPPTML0
     C           KPOOL     READEPMPPTML0                 82
     C*
     C           *IN82     DOWEQ'0'                        - B2
     C*
     C** PERFORM ROUTINE WITH POOL MEMBER CUSTOMER AND POOL MEMBER PORTFOLIO
     C**********           Z-ADDOSCNUM    POCNUM  60                                          CSD027
     C                     MOVE OSCNUM    POCNUM  6                                           CSD027
     C                     MOVE OSPTFR    POPTFR  4
     C                     MOVE 'Y'       POOL
     C*
     C                     EXSR POSITN
     C*
     C           KPOOL     READEPMPPTML0                 82
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C**********           Z-ADDPACNUM    POCNUM                                              CSD027
     C                     MOVE PACNUM    POCNUM                                              CSD027
     C                     MOVE PAPTFR    POPTFR
     C                     MOVE 'N'       POOL
     C*
     C                     EXSR POSITN
     C*
     C                     END                             - E1
     C*
     C** IF POOL PORTFOLIO
     C           POOL      IFEQ 'Y'                        - B1
     C*
     C***********KPOOL     SETLLPMFOPSPP                                  CPM003
     C***********KPOOL     READEPMFOPSPP                 83               CPM003
     C           KPOOL     SETLLPMFOPSPD                                  CPM003
     C           KPOOL     READEPMFOPSPD                 83               CPM003
     C*
     C** DO WHILE POOL
     C           *IN83     DOWEQ'0'                        - B2
     C*
     C** SAVE POSITION DETAILS 'XX....' FOR THIS PROCESSING
     C***********          MOVE WWISTT    XXISTT  5                       CPM003
     C***********          Z-ADDWWYRNO    XXYRNO  20                      CPM003
     C***********          Z-ADDWWMTHN    XXMTHN  20                      CPM003
     C***********          MOVE WWPCAL    XXPCAL  1                       CPM003
     C***********          Z-ADDWWSTRP    XXSTRP 117                      CPM003
     C                     MOVE GJISTT    XXISTT  5                       CPM003
     C                     Z-ADDGJYRNO    XXYRNO  20                      CPM003
     C                     Z-ADDGJMTHN    XXMTHN  20                      CPM003
     C                     MOVE GJPCAL    XXPCAL  1                       CPM003
     C***********          Z-ADDGJSTRP    XXSTRP 117                CPM003CFF004
     C           *LIKE     DEFN STRP      XXSTRP                          CFF004
     C                     Z-ADDGJSTRP    XXSTRP                          CFF004
     C                     MOVE '0'       *IN84
     C*
     C** SET TOTALS TO 0
     C                     Z-ADD0         WKOPN
     C                     Z-ADD0         WKTIC
     C*
     C** DO WHILE SAME POOL AND SAME POSITION DETAILS
     C           *IN84     DOWEQ'0'                        - B3
     C*
     C***********          ADD  WWPNCO    WKOPN                           CPM003
     C***********          ADD  WWPOST    WKTIC                           CPM003
     C                     ADD  GJPNCO    WKOPN                           CPM003
     C                     ADD  GJPOST    WKTIC                           CPM003
     C*
     C***********KPOOL2    READEPMFOPSPP                 84               CPM003
     C           KPOOL2    READEPMFOPSPD                 84               CPM003
     C                     END                             - E3
     C*
     C** RETRIEVE INTRUMENT DETAILS
     C           XXISTT    CHAININTYP                88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       CPM003
     C***********          MOVEL'003'     DBASE            ***************CPM003
     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 03 CPM003
     C                     Z-ADD3         DBASE            ***************CPM003
     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 03 CPM003
     C                     MOVELXXISTT    DBKEY            *****************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C           ISTI      IFEQ 'N'                        - B3
     C           FTRF      ANDNE*BLANKS
     C** RETRIEVE INTRUMENT DETAILS WITH MARKET CENTER AND FUTURE TYPE REFERENCE
     C                     MOVELISTT      KMKT    5
     C                     MOVE FTRF      KMKT
     C           KMKT      CHAININTYP                88
     C           *IN88     IFEQ '1'                        - B4
     C           *LOCK     IN   LDA                                       CPM003
     C***********          MOVEL'004'     DBASE            ***************CPM003
     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 04 CPM003
     C                     Z-ADD4         DBASE            ***************CPM003
     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 04 CPM003
     C                     MOVELKMKT      DBKEY            *****************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E4
     C*
     C** SAVE FIELDS
     C***********          Z-ADDMNPF      XXMNPF 117                      CFF004
     C           *LIKE     DEFN MNPF      XXMNPF                          CFF004
     C                     Z-ADDMNPF      XXMNPF                          CFF004
     C                     Z-ADDTKVL      XXTKVL 145
     C                     Z-ADDTKDM      XXTKDM  30
     C*
     C** REACCESS INTRUMENT TYPE
     C           XXISTT    CHAININTYP                88
     C           *IN88     IFEQ '1'                        - B4
     C           *LOCK     IN   LDA                                       CPM003
     C***********          MOVEL'005'     DBASE            ***************CPM003
     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 05 CPM003
     C                     Z-ADD5         DBASE            ***************CPM003
     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 05 CPM003
     C                     MOVELXXISTT    DBKEY            *****************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E4
     C*
     C** RESTORE SAVED FIELDS
     C                     Z-ADDXXMNPF    MNPF
     C                     Z-ADDXXTKVL    TKVL
     C                     Z-ADDXXTKDM    TKDM
     C                     END                             - E3
     C*
     C** EXECUTE OUTPUT SUBROUTINE
     C***********          Z-ADDWWYRNO    YRNO                            CPM003
     C***********          Z-ADDWWMTHN    MTHN                            CPM003
     C***********          MOVE WWPCAL    PCAL                            CPM003
     C***********          Z-ADDWWSTRP    STRP                            CPM003
     C***********          Z-ADDWWCOPR    COPR                            CPM003
     C                     Z-ADDGJYRNO    YRNO                            CPM003
     C                     Z-ADDGJMTHN    MTHN                            CPM003
     C                     MOVE GJPCAL    PCAL                            CPM003
     C                     Z-ADDGJSTRP    STRP                            CPM003
     C                     Z-ADDGJCOPR    COPR                            CPM003
     C                     EXSR OUTPUT
     C*
     C** READ NEXT RECORD FOR SAME POOL PORTFOLIO
     C***********KPOOL2    SETGTPMFOPSPP                                  CPM003
     C***********KPOOL     READEPMFOPSPP                 83               CPM003
     C           KPOOL2    SETGTPMFOPSPD                                  CPM003
     C           KPOOL     READEPMFOPSPD                 83               CPM003
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C** TERMINATION PROCESSING
     C           PAMODE    IFNE 'S'                                       078956
     C                     SETON                     LR                   078956
     C                     END                                            078956
     C*
     C                     RETRN
     C*
     C/EJECT
     C**************************************************************************
     C* SR/POSITN - CALCULATE CUSTOMER POSITIONS
     C**************************************************************************
     C*
     C           POSITN    BEGSR
     C*
     C***********KTRAN     SETLLTRANSP2                                   CPM003
     C***********KTRAN     READETRANSP2                  85               CPM003
     C           KTRAN     SETLLPMTRANL0                                  CPM003
     C           KTRAN     READEPMTRANL0                 85               CPM003
     C*
     C           *IN85     DOWEQ'0'                        - B1
     C*
     C** SAVE POSITION DETAILS 'XP....' FOR THIS ROUTINE
     C                     MOVE ISTT      XPISTT  5
     C                     Z-ADDYRNO      XPYRNO  20
     C                     Z-ADDMTHN      XPMTHN  20
     C                     MOVE PCAL      XPPCAL  1
     C***********          Z-ADDSTRP      XPSTRP 117                      CFF004
     C           *LIKE     DEFN STRP      XPSTRP                          CFF004
     C                     Z-ADDSTRP      XPSTRP                          CFF004
     C                     MOVE '0'       *IN86
     C*
     C** RETRIEVE INTRUMENT DETAILS
     C           XPISTT    CHAININTYP                88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       CPM003
     C***********          MOVEL'006'     DBASE            ***************CPM003
     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 06 CPM003
     C                     Z-ADD6         DBASE            ***************CPM003
     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 06 CPM003
     C                     MOVELXPISTT    DBKEY            *****************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C           ISTI      IFEQ 'N'                        - B2
     C           FTRF      ANDNE*BLANKS
     C** RETRIEVE INTRUMENT DETAILS WITH MARKET CENTER AND FUTURE TYPE REFERENCE
     C                     MOVELISTT      KMKT    5
     C                     MOVE FTRF      KMKT
     C           KMKT      CHAININTYP                88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       CPM003
     C***********          MOVEL'007'     DBASE            ***************CPM003
     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 07 CPM003
     C                     Z-ADD7         DBASE            ***************CPM003
     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 07 CPM003
     C                     MOVELKMKT      DBKEY            *****************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** SAVE FIELDS
     C***********          Z-ADDMNPF      XPMNPF 117                      CFF004
     C           *LIKE     DEFN MNPF      XPMNPF                          CFF004
     C                     Z-ADDMNPF      XPMNPF                          CFF004
     C                     Z-ADDTKVL      XPTKVL 145
     C                     Z-ADDTKDM      XPTKDM  30
     C*
     C** REACCESS INTRUMENT TYPE
     C           XPISTT    CHAININTYP                88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       CPM003
     C***********          MOVEL'008'     DBASE            ***************CPM003
     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 08 CPM003
     C                     Z-ADD8         DBASE            ***************CPM003
     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 08 CPM003
     C                     MOVELXPISTT    DBKEY            *****************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** SETUP FIELDS WITH SAVED VALUES
     C                     Z-ADDXPMNPF    MNPF
     C                     Z-ADDXPTKVL    TKVL
     C                     Z-ADDXPTKDM    TKDM
     C*
     C                     END                             - E2
     C*
     C** SET WORKFIELDS TO 0
     C                     Z-ADD0         WKOPN  150
     C                     Z-ADD0         WKTIC  150
     C***********          Z-ADDCOPR      WWCOPR                          CPM003
     C                     Z-ADDCOPR      GJCOPR                          CPM003
     C*
     C** DO WHILE SAME POOL AND SAME POSITION
     C           *IN86     DOWEQ'0'                        - B2
     C*
     C** DETERMINE IF INCREASE OR DECREASE
     C** 1.TRADE PURCHASE
     C           TRTY      IFEQ 'P'                        - B3
     C*
     C********** BOCO      IFEQ 0                          - B4                               CSD027
     C           BOCO      IFEQ *BLANKS                    - B4                               CSD027
     C                     MOVE 'D'       ICDC    1
     C                     ELSE                            - X4
     C                     MOVE 'I'       ICDC
     C                     END                             - E4
     C*
     C                     ELSE                            - X3
     C*
     C** 2.TRADE SALE
     C********** BOCO      IFEQ 0                          - B4                               CSD027
     C           BOCO      IFEQ *BLANKS                    - B4                               CSD027
     C                     MOVE 'I'       ICDC
     C                     ELSE                            - X4
     C                     MOVE 'D'       ICDC
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C           ICDC      IFEQ 'I'                        - B3
     C                     ADD  NOCO      WKOPN
     C                     ELSE                            - X3
     C                     SUB  NOCO      WKOPN
     C                     END                             - E3
     C*
     C** SETUP MODULE ID
     C***********          MOVE *BLANKS   WWMODI                          CPM003
     C                     MOVE *BLANKS   GJMODI                          CPM003
     C           ISPT      IFEQ 1                          - B3
     C           ISPT      OREQ 2
     C           ISPT      OREQ 3
     C           ISPT      OREQ 7                                         CPM003
     C***********          MOVE 'FM'      WWMODI                          CPM003
     C                     MOVE 'FM'      GJMODI                          CPM003
     C                     END                             - E3
     C*
     C           ISPT      IFEQ 4                          - B3
     C           ISPT      OREQ 5
     C           ISPT      OREQ 6
     C           ISPT      OREQ 8                                         CPM003
     C*
     C           PUPF      IFEQ 'N'                        - B4
     C***********          MOVE 'FM'      WWMODI                          CPM003
     C                     MOVE 'FM'      GJMODI                          CPM003
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C***********WWMODI    IFEQ *BLANKS                    - B3           CPM003
     C***********          MOVE 'FO'      WWMODI                          CPM003
     C           GJMODI    IFEQ *BLANKS                    - B3           CPM003
     C                     MOVE 'FO'      GJMODI                          CPM003
     C                     END                             - E3
     C*
     C** CALCULATE CONTRACT TICKS
     C***********WWMODI    IFEQ 'FM'                       - B3           CPM003
     C           GJMODI    IFEQ 'FM'                       - B3           CPM003
     C                     Z-ADDNOCO      FFNOC
     C                     Z-ADDCOPR      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C*
     C           ISPT      IFLE 6                                         CPM003
     C                     EXSR FFTVCL
     C                     ELSE                                           CPM003
     C           100       SUB  FFPRIC    FFYLD                           CPM003
     C                     EXSR FFYTOP                                    CPM003
     C           PRICEC    MULT FFCTAM    W309   309                      CPM003
     C                     MULT 100       W309                            CPM003
     C                     MULT FFNOC     FFTNVL    H                     CPM003
     C                     END                                            CPM003
     C*
     C           ICDC      IFEQ 'I'                        - B4
     C****                 SUB  FFNOTK    WKTIC                           078956
     C                     SUB  FFTNVL    WKTIC                           078956
     C                     ELSE                            - X4
     C****                 ADD  FFNOTK    WKTIC                           078956
     C                     ADD  FFTNVL    WKTIC                           078956
     C                     END                             - E4
     C                     END                             - E3
     C*
     C** READ NEXT RECORD WITH CUSTOMER, PORTFOLIO AND POSITION DETAILS
     C***********KTRAN2    READETRANSP2                  86               CPM003
     C           KTRAN2    READEPMTRANL0                 86               CPM003
     C*
     C                     END                             - E2
     C*
     C** POOL PROCESSING
     C           POOL      IFEQ 'Y'                        - B2
     C                     EXSR W001
     C                     ELSE                            - X2
     C                     EXSR OUTPUT
     C                     END                             - E2
     C*
     C** READ NEXT RECORD FOR CUSTOMER AND PORTFOLIO
     C***********KTRAN2    SETGTTRANSP2                                   CPM003
     C***********KTRAN     READETRANSP2                  85               CPM003
     C           KTRAN2    SETGTPMTRANL0                                  CPM003
     C           KTRAN     READEPMTRANL0                 85               CPM003
     C*
     C                     END                             - E1
     C*
     C                     ENDSR
     C**************************************************************************
     C**SR/W001**-**OUTPUT*DETAILS*TO*PF/PMFOPSPP****                     CPM003
     C* SR/W001  -  OUTPUT DETAILS TO PF/PMFOPSPD                         CPM003
     C**************************************************************************
     C*
     C           W001      BEGSR
     C*
     C***********          Z-ADDPACNUM    WWCNUM                          CPM003
     C***********          MOVE PAPTFR    WWPTFR                          CPM003
     C***********          MOVE XPISTT    WWISTT                          CPM003
     C***********          Z-ADDXPYRNO    WWYRNO                          CPM003
     C***********          Z-ADDXPMTHN    WWMTHN                          CPM003
     C***********          MOVE XPPCAL    WWPCAL                          CPM003
     C***********          Z-ADDXPSTRP    WWSTRP                          CPM003
     C***********          Z-ADDWKOPN     WWPNCO                          CPM003
     C***********          Z-ADDWKTIC     WWPOST                          CPM003
     C**********           Z-ADDPACNUM    GJCNUM                                       CPM003 CSD027
     C                     MOVE PACNUM    GJCNUM                                              CSD027
     C                     MOVE PAPTFR    GJPTFR                          CPM003
     C                     MOVE XPISTT    GJISTT                          CPM003
     C                     Z-ADDXPYRNO    GJYRNO                          CPM003
     C                     Z-ADDXPMTHN    GJMTHN                          CPM003
     C                     MOVE XPPCAL    GJPCAL                          CPM003
     C                     Z-ADDXPSTRP    GJSTRP                          CPM003
     C                     Z-ADDWKOPN     GJPNCO                          CPM003
     C                     Z-ADDWKTIC     GJPOST                          CPM003
     C*
     C                     WRITEPMFOPSP0
     C*
     C                     ENDSR
     C**************************************************************************
     C**SR/OUTPUT**-**FORMAT*DETAILS*TO*PF/PMFOPSPP***********************CPM003
     C* SR/OUTPUT  -  FORMAT DETAILS TO PF/PMFOPSPD                       CPM003
     C**************************************************************************
     C*
     C           OUTPUT    BEGSR
     C*
     C**********           Z-ADDPACNUM    QFCNUM                                              CSD027
     C                     MOVE PACNUM    QFCNUM                                              CSD027
     C                     MOVE PAPTFR    QFPTFR
     C                     MOVE INNR      QFINNR
      *                                                                   182961
      ** Instrument type is defaulted from PF/SDPORTPD if a blank         182961
      ** instrument type is found.                                        182961
      ** Indicator 35 was used as the operation's resulting indicator.    182961
      *                                                                   182961
     C           QFINNR    IFEQ *BLANKS                                   182961
     C           1         SETLLSDPORTPD                                  182961
     C                     READ SDPORTPD                 35               182961
     C                     MOVE FCDINR    QFINNR                          182961
     C                     ENDIF                                          182961
     C*
     C***********QFINNR    CHAINSDPLINL4             88                   CPM003
     C************IN88     IFEQ '0'                        - B1           CPM003
     C                     CALL 'AOPLINR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*KEY  '  P@OPTN                          CPM003
     C                     PARM QFINNR    P@INNR  3                       CPM003
     C           SDPLIN    PARM SDPLIN    DSFDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFEQ *BLANKS                                   CPM003
     C                     MOVE PDVALG    QFVALG
     C                     ELSE                            - X1
     C                     MOVE *BLANKS   QFVALG
     C                     END                             - E1
     C*
     C                     MOVE ISCY      QFCCY1
     C***********QFCCY1    CHAINSDCURRL1             88                   CPM003
     C************IN88     IFEQ '1'                        - B1           CPM003
     C*                                                                   CPM003
     C                     CALL 'AOCURRR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*FIRST'  P@OPTN                          CPM003
     C                     PARM QFCCY1    P@CYCD  3                       CPM003
     C           SDCURR    PARM SDCURR    DSSDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                                   CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C***********          MOVEL'008'     DBASE            ***************CPM003
     C***********          MOVEL'SDCURRL1'DBFILE           ** DB ERROR 08 CPM003
     C                     Z-ADD8         DBASE            ***************CPM003
     C                     MOVE 'SDCURRPD'DBFILE           ** DB ERROR 08 CPM003
     C                     MOVELQFCCY1    DBKEY            *****************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E1
     C                     Z-ADDA6NBDP    QFCDP1
     C*
     C** SETUP 'FROM' PARAMETERS
     C                     MOVELA6CYCD    ZCCYF
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVELA6MDIN    ZMDINF
     C                     Z-ADDA6NBDP    ZCDPF
     C*
     C***********          MOVE P9CNCD    QFCNTR                          CPM003
     C***********          MOVE P9LICD    QFLIND                          CPM003
     C                     MOVE FCCNCD    QFCNTR                          CPM003
     C**********           MOVE FCLICD    QFLIND                                       CPM003 CER020
     C                     MOVE FCLICD    QFLOIC                                              CER020
     C                     MOVE *BLANKS   QFTDSS
     C                     Z-ADDWKOPN     QFAMT1
     C                     Z-ADDWKTIC     QFACIS
     C                     Z-ADD0         QFPLFX
     C*
     C***********PAPTCY    CHAINSDCURRL1             88                   CPM003
     C************IN88     IFEQ '1'                        - B1           CPM003
     C*                                                                   CPM003
     C                     CALL 'AOCURRR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*FIRST'  P@OPTN                          CPM003
     C                     PARM PAPTCY    P@CYCD  3                       CPM003
     C           SDCURR    PARM SDCURR    DSSDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                                   CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C***********          MOVEL'009'     DBASE            ***************CPM003
     C***********          MOVEL'SDCURRL1'DBFILE           ** DB ERROR 09 CPM003
     C                     Z-ADD9         DBASE            ***************CPM003
     C                     MOVE 'SDCURRPD'DBFILE           ** DB ERROR 09 CPM003
     C                     MOVELPAPTCY    DBKEY            *****************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C** SETUP 'TO' PARAMETERS
     C                     MOVELA6CYCD    ZCCYT
     C                     Z-ADDA6SPRT    ZRATET
     C                     MOVELA6MDIN    ZMDINT
     C                     Z-ADDA6NBDP    ZCDPT
     C                     Z-ADD1         ZAMTF
     C                     EXSR ZCCYCN
     C*
     C** MARKET FX RATE
     C                     Z-ADDZCRSRT    QFMFXR
     C*
     C                     EXSR ZCCYCD
     C                     Z-ADDZCRSRN    QFMFXD
     C*
     C                     MOVE 'M'       QFMFMD
     C*
     C** SETUP MARKET PRICE
     C****                 Z-ADDCOPR      WKMKPR 117                      078956
     C***********          Z-ADD0         WKMKPR 117                078956CFF004
     C           *LIKE     DEFN PLEC      WKMKPR                          CFF004
     C                     Z-ADD0         WKMKPR                          CFF004
     C****       ISTI      IFEQ 'N'                        - B1           078956
     C           KPRICS    CHAINPRICS                88
     C           *IN88     IFEQ '0'                        - B1
     C****                 Z-ADDNEWP      WKMKPR                          078956
     C                     Z-ADDPLEC      WKMKPR                          078956
     C****                 END                             - E2           078956
     C****                 END                             - E1           078956
     C*
     C***********WWMODI    IFEQ 'FM'                       - B1           CPM003
     C           GJMODI    IFEQ 'FM'                       - B1           CPM003
     C                     Z-ADDWKMKPR    QFMPRC
     C                     ELSE                            - X1
     C                     Z-ADD1         FFNOC
     C                     Z-ADDWKMKPR    FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     Z-ADDTKVL      FFTKVL
     C                     EXSR FFPMCL
     C*                                                                   083338
     C** REMOVE IMPLIED DECIMAL PLACES FROM MARKET PRICE                  083338
     C           1         DO   QFCDP1                                    083338
     C           FFPREM    DIV  10        FFPREM                          083338
     C                     END                                            083338
     C*                                                                   083338
     C                     Z-ADDFFPREM    QFMPRC
     C                     END                             - E1
     C*                                                                   078956
     C** IF MARKET PRICE NOT FOUND SET TO *LOVAL. NO VALUATION CALCULATED 078956
     C** CALCULATED FOR POSITION IN PGM/PM1630                            078956
     C                     ELSE                                           078956
     C                     Z-ADD0         QFMPRC                          078956
     C                     END                             - E1           078956
     C*
     C                     MOVE *BLANKS   QFBYSF
     C**********           Z-ADD0         QFTRNB                                              CLE148
     C                     MOVEL*BLANKS   QFTRNB                                              CLE148
     C************         MOVE WWMODI    QFMODI                          CPM003
     C                     MOVE GJMODI    QFMODI                          CPM003
     C***********          MOVE *BLANKS   QFFOIS                          CPM003
     C                     MOVE ISTT      QFFOIS                          CPM003
     C**********           MOVE *BLANKS   QFTXT2                                              250228
     C                     MOVE *BLANKS   QQTXT2                                              250228
     C                     MOVE PASTMN    QFSTMN
     C                     MOVE 'N'       QFPPRC
     C                     Z-ADD0         QFNMDP
     C                     MOVE 'U'       QFSPBS
     C*
     C** SETUP FF POSITION ID
     C                     MOVE ISTT      FFISTT
     C                     Z-ADDMTHN      FFMTHN
     C                     Z-ADDYRNO      FFYRNO
     C                     MOVE PCAL      FFPCAL
     C                     Z-ADDSTRP      FFSTRP
     C                     Z-ADDMNPF      FFMNPF
     C                     Z-ADDTKDM      FFTKDM
     C                     MOVE ISTI      FFISTI
     C                     Z-ADDISPT      FFISPT
     C                     EXSR ZFFOLN
     C                     MOVELFFISDT    QFFPSI
     C*
     C                     Z-ADDTKDM      QFTKDM
     C                     Z-ADDMNPF      QFMNPF
     C                     Z-ADDTKVL      QFTKVL
     C*
     C** WRITE OUTPUT RECORD
     C           PAMODE    IFEQ 'S'                        - B1
     C                     WRITEPMPSTMP0
     C                     ELSE                            - X1
     C***********          MOVE 'D'       QFRECI                          CPM003
     C                     MOVE 'D'       GERECI                          CPM003
     C**********           Z-ADDQFCNUM    GECNUM                                       CPM003 CSD027
     C                     MOVE QFCNUM    GECNUM                                              CSD027
     C***********          MOVE PAPTFR    QFPTFR                          CPM003
     C                     MOVE PAPTFR    GEPTFR                          CPM003
     C                     MOVE QFINNR    GEINNR                          CPM003
     C                     MOVE QFVALG    GEVALG                          CPM003
     C                     MOVE QFCCY1    GECCY1                          CPM003
     C                     Z-ADDQFCDP1    GECDP1                          CPM003
     C                     MOVE QFCNTR    GECNTR                          CPM003
     C**********           Z-ADDQFLIND    GELIND                                       CPM003 CER020
     C                     MOVELQFLOIC    GELOIC                                              CER020
     C                     MOVE QFTDSS    GETDSS                          CPM003
     C                     Z-ADDQFAMT1    GEAMT1                          CPM003
     C                     Z-ADDQFACIS    GEACIS                          CPM003
     C                     Z-ADDQFPLFX    GEPLFX                          CPM003
     C                     Z-ADDQFMFXR    GEMFXR                          CPM003
     C                     MOVE QFMFMD    GEMFMD                          CPM003
     C                     Z-ADDQFMPRC    GEMPRC                          CPM003
     C**********           Z-ADDQFTRNB    GETRNB                                       CPM003 CLE148
     C                     MOVELQFTRNB    GETRNB                                              CLE148
     C                     MOVE QFMODI    GEMODI                          CPM003
     C                     MOVE QFBYSF    GEBYSF                          CPM003
     C                     MOVE QFFOIS    GEFOIS                          CPM003
     C**********           MOVE QFTXT2    GETXT2                                       CPM003 250228
     C                     MOVE QQTXT2    GETXT2                                              250228
     C***********          Z-ADDBJRDNB    QFDXTR                          CPM003
     C                     Z-ADDBJRDNB    GEDXTR                          CPM003
     C                     Z-ADDQFMFXD    GEMFXD                          CPM003
     C***********          MOVELFFISDT    QFRESH                          CPM003
     C                     MOVELFFISDT    GERESH                          CPM003
     C                     Z-ADDQFNMDP    GENMDP                          CPM003
     C                     MOVE QFSPBS    GESPBS                          CPM003
     C                     Z-ADDQFTKDM    GETKDM                          CPM003
     C                     Z-ADDQFMNPF    GEMNPF                          CPM003
     C                     Z-ADDQFTKVL    GETKVL                          CPM003
     C                     WRITEPMPMIMP0
     C                     END                             - E1
     C*
     C*
     C                     ENDSR
     C********************************************************************
     C*
     C*  ZCCYCD SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER
     C*  CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES
     C*
     C*  INPUT  FIELDS
     C*       ZAMTF  150     AMOUNT IN 'FROM' CURRENCY
     C*       ZCCYF   3A     FROM CURRENCY
     C*       ZCCYT   3A     TO CURRENCY
     C*       ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY
     C*       ZRATET 138     SPOT RATE FOR 'TO' CURRENCY
     C*       ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CURRENCY
     C*       ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURRENCY
     C*       ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY
     C*       ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY
     C*
     C*  OUTPUT  FIELDS
     C*       ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT
     C*       ZCRSRT 138     CROSS EXCHANGE RATE
     C*       ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR
     C*
     C*
     C*  CALLS:
     C*       ZCCYCA - CONVERT AMOUNT
     C********************************************************************
     C*
     C           ZCCYCD    BEGSR                           *** ZCCYCN ***
     C*
     C** DEFINE ALL FIELDS
     C                     Z-ADDZAMTF     ZAMTF  150
     C                     MOVE ZCCYF     ZCCYF   3
     C                     MOVE ZCCYT     ZCCYT   3
     C                     Z-ADDZRATEF    ZRATEF 138
     C                     Z-ADDZRATET    ZRATET 138
     C                     MOVE ZMDINF    ZMDINF  1
     C                     MOVE ZMDINT    ZMDINT  1
     C                     Z-ADDZCDPF     ZCDPF   10
     C                     Z-ADDZCDPT     ZCDPT   10
     C                     Z-ADDZAMTT     ZAMTT  150
     C                     Z-ADDZCRSRT    ZCRSRT 138
     C                     MOVE ZCRSMD    ZCRSMD  1
     C*
     C** IF 'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TO' CURR
     C** EQUAL TO AMOUNT IN 'FROM' CURRENCY
     C           ZCCYF     IFEQ ZCCYT
     C                     Z-ADDZAMTF     ZAMTT
     C                     Z-ADD1         ZCRSRT
     C                     MOVE 'M'       ZCRSMD
     C           1000000000MULT 1000000   ZCRSRN
     C                     GOTO CCYEN1
     C                     END
     C*
     C** INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO
     C                     Z-ADD*ZEROS    ZCRSRT
     C*
     C** CONVERT 'FROM' RATE TO MULTIPLY RATE
     C           ZMDINF    IFEQ 'M'
     C                     Z-ADDZRATEF    ZRATF1 138
     C           1000000000MULT ZRATEF    ZRATF2 308
     C           10        MULT ZRATF2    ZRATF2
     C                     ELSE
     C           1         DIV  ZRATEF    ZRATF1
     C           1000000000MULT 10        ZRWORK 200
     C           ZRWORK    DIV  ZRATEF    ZRATF2    H
     C                     END
     C*
     C** CONVERT 'TO' RATE TO MULTIPLY RATE
     C           ZMDINT    IFEQ 'M'
     C                     Z-ADDZRATET    ZRATT1 138
     C           1000000000MULT ZRATET    ZRATT2 308
     C           10        MULT ZRATT2    ZRATT2
     C                     ELSE
     C           1         DIV  ZRATET    ZRATT1
     C           1000000000MULT 10        ZRWORK
     C           ZRWORK    DIV  ZRATET    ZRATT2    H
     C                     END
     C*
     C** NOW CALCULATE CROSS RATE
     C           ZRATT1    IFNE *ZEROS
     C           ZRATF1    DIV  ZRATT1    ZCRSRT
     C*
     C** CALCULATE DOUBLE PRECISION FX RATE
     C** FIRST SPLIT FIGURE INTO TWO PARTS
     C           1000000000MULT 1000000   ZRWORK
     C           ZRATF2    MULT ZRWORK    ZRATBF 300
     C                     Z-ADDZRATF2    ZRATSF 158
     C*
     C** DIVIDE BOTH BIG AND SMALL PARTS BY TO FX RATE AND ADD TO CROSS RA
     C** TO BE USED IN CALCULATIONS
     C           ZRATBF    DIV  ZRATT2    ZCRSRN 309H
     C           ZRATSF    DIV  ZRATT2    ZCRSR1 309H
     C                     ADD  ZCRSR1    ZCRSRN
     C                     END
     C*
     C** MOVE MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULT/DIV
     C** INDICATOR (ZCRSMD)
     C                     MOVE 'M'       ZCRSMD
     C*
     C** IF CROSS EXCHANGE RATE IS EQUAL TO ZERO
     C** SET ZAMTT  TO *ZERO  & EXIT
     C           ZCRSRN    IFEQ 0
     C                     Z-ADD*ZEROS    ZAMTT
     C                     GOTO CCYEN1
     C                     END
     C*
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF) EQUALS DECIMAL
     C** DECIMAL PLACES  FOR 'TO' CURRENCY CONVERT AMOUNT BY SIMPLE
     C** MULTIPLICATION
     C           ZCDPF     IFEQ ZCDPT                      B1
     C           ZAMTF     MULT ZCRSRN    ZAMTO  300H
     C                     END                             E1
     C*
     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF)  NOT EQUALS DECIMA
     C** DECIMAL PLACES  FOR 'TO' CURRENCY ADJUST AMOUNT FOR DIFFERENT DP
     C           ZCDPF     IFNE ZCDPT                      B1
     C*
     C** SUBTRACT DECIMAL PLACES 'FROM' FROM DECIMAL PLACES 'TO' IN POWER
     C           ZCDPT     SUB  ZCDPF     ZWKPX   10
     C           ZWKPX     ADD  4         B       30
     C*
     C** IF POWER ELEMENT (8,4) LESS THAN 1
     C           POWER,B   IFLT 1                          B2
     C*
     C** MULTIPLY AMOUNT IN FROM CURRENCY BY ELEMENT IN POWER ARRAY
     C           POWER,B   MULT ZAMTF     ZWK153 153
     C*
     C           ZWK153    MULT ZCRSRN    ZAMTO     H
     C                     END                             E2
     C*
     C** IF POWER ELEMENT (8,4) GREATER OR EQUAL TO 1
     C           POWER,B   IFGE 1                          B2
     C           ZAMTF     MULT POWER,B   ZAMTO
     C           ZAMTO     MULT ZCRSRN    ZAMTO     H
     C                     END                             E2
     C                     END                             E1
     C*
     C           ZAMTO     DIV  ZRWORK    ZAMTT     H
     C*
     C           CCYEN1    ENDSR
     C**************************************************************************
     C**
     C**   INIT       SUBROUTINE TO INITIALIZE STATIC FIELDS AND ACCESS STANDING
     C**              DATA CALLED ONCE AT START OF PROGRAM FROM MAIN LINE.
     C**
     C**     CALLED BY PROGRAM
     C**     CALLS     *PSSR
     C**
     C**************************************************************************
     C*                                                    *****************
     C           INIT      BEGSR                           ** #INIT BEGSR **
     C*                                                    *****************
     C**  PREPARE LDA:
     C*
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM1830'  DBPGM
     C*
     C                     MOVE *BLANKS   POOL    1
     C                     MOVE 'Y'       WWFRST  1
     C*
     C**  INITIALIZE INDICATORS:
     C                     MOVE '0'       *IN
     C*
     C**  GET INSTALLATION CONTROL DATA RECORD 1:
     C************LOVAL    SETLLSDBANKL1                                  CPM003
     C************         READ SDBANKL1                 81               CPM003
     C************                                                        CPM003
     C****IF*RECORD*NOT*FOUND:********************************************CPM003
     C************IN81     IFEQ '1'                        - B1           CPM003
     C*                                                                   CPM003
     C                     CALL 'AOBANKR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD  7                       CPM003
     C                     PARM '*FIRST'  P@OPTN  7                       CPM003
     C           SDBANK    PARM SDBANK    DSFDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                                   CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C***********          MOVEL'001'     DBASE            ***************CPM003
     C***********          MOVEL'SDBANKL1'DBFILE           ** DB ERROR 01 CPM003
     C                     Z-ADD1         DBASE            ***************CPM003
     C                     MOVE 'SDBANKPD'DBFILE           ** DB ERROR 01 CPM003
     C                     MOVEL' NONE '  DBKEY            ***************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C**  GET PORTFOLIO INSTALLATION CONTROL DATA RECORD 1:
     C************LOVAL    SETLLSDPORTL1                                  CPM003
     C***********          READ SDPORTL1                 81               CPM003
     C***********                                                         CPM003
     C****IF*RECORD*NOT*FOUND:********************************************CPM003
     C************IN81     IFEQ '1'                        - B1           CPM003
     C***********          MOVEL'002'     DBASE            ***************CPM003
     C***********          MOVEL'SDPORTL1'DBFILE           ** DB ERROR 02 CPM003
     C                     CALL 'AOPORTR0'                                CPM003
     C                     PARM *BLANKS   P@RTCD                          CPM003
     C                     PARM '*FIRST'  P@OPTN                          CPM003
     C           SDPORT    PARM SDPORT    DSFDY                           CPM003
     C*                                                                   CPM003
     C           P@RTCD    IFNE *BLANKS                                   CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD2         DBASE            ***************CPM003
     C                     MOVE 'SDPORTPD'DBFILE           ** DB ERROR 02 CPM003
     C                     MOVEL' NONE '  DBKEY            *****************
     C                     OUT  LDA                                       CPM003
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C                     ENDSR
     C********************************************************************
     C** *PSSR  S/R
     C********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     DUMP
     C                     OPEN PM1830AU                                  CPM003
     C                     WRITEHEADAU                                    CPM003
     C                     WRITEERRORAU                                   CPM003
     C                     RETRN
     C*
     C                     ENDSR
     C**************************************************************************
      /COPY ZSRSRC,FFTVCLZ2
      /COPY ZSRSRC,FFPMCLZ1
      /COPY ZSRSRC,ZCCYCN
      /COPY ZSRSRC,ZCCYXR
     C***/COPY*ZSRSRC,ZFFOLN3                                             CPM003
     C/COPY PMCPYSRC,ZFFOLN3                                              CPM003
      /COPY ZSRSRC,FFPRCSZ4
      /COPY ZSRSRC,FFYTOPZ1                                               CPM003
     C**************************************************************************
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  CPY@
(c) Finastra International Limited 2001
