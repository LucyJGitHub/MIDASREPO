000100200529     H        1                                                           CPM003
000200200529      *****************************************************************
000300200529/*STD *  RPGBASE                                                      *
000400200529/*EXI *  TEXT('Midas PM Extract FF positions - part II')              *
000500200529     H********1   Y                                                       CPM003
000600200529     F*****************************************************************
000700200529     F*                                                               *
000800200529     F*  Midas  - Portfolio Management                                *
000900200529     F*                                                               *
001000200529     F*  PM1830 - PM Extract FF positions - Part II                   *
001100200529     F*                                                               *
001200200529      *  (c) Finastra International Limited 2001                      *
001300200529      *                                                               *
001400200604      *  Last Amend No. 250228             Date 22May20               *
001500200529      *  Prev Amend No. MD046248           Date 27Oct17               *
001600200529      *                 CLE148             Date 23Jul12               *
001700200529      *                 AR746662           Date 03May11               *
001800200529      *                 CER059             Date 19Jul10               *
001900200529      *                 CER020             Date 19May08               *
002000200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
002100200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
002200200529      *                 247517             Date 09May07               *
002300200529      *                 CPK027             Date 17Apr07               *
002400200529      * Midas Plus 1.4 Base ------------------------------------------*
002500200529      *                 241147A            Date 07Nov06               *
002600200529      *                 241147             Date 26Oct06               *
002700200529      * Midas Plus 1.3 ----------- Base ------------------------------*
002800200529      *                 CSD031             Date 10Apr06               *
002900200529      *                 CSD027             Date 09Dec05               *
003000200529      *                 CLE025             Date 20Oct03               *
003100200529      *                 215528             Date 21Mar03               *
003200200529      * Midas Release 4.01 -------------------------------------------*
003300200529      *                 CPK015             Date 17Jun02               *
003400200529      *                 182961             Date 21Apr01               *
003500200529      * Midas Release 4 --------------- Base -------------------------*
003600200529      * Midas DBA 3.00 ---------------- Base -------------------------*
003700200529      *                 CPM005             Date 29Jul96               *
003800200529      *                 CFF004             Date 11Sep96               *
003900200529     F*                 CPM003             DATE 06DEC95               *
004000200529     F*                 083338             DATE 15FEB95               *
004100200529     F*                 078956             DATE 13DEC94               *
004200200529     F*                 075998             DATE 20SEP94               *
004300200529     F*                                                               *
004400200529     F*---------------------------------------------------------------*
004500200529      *                                                               *
004600200529      *  250228 - Modify the field names as per PMPSTMQ0 changes.     *
004700200529      *  MD046248 - Finastra Rebranding                               *
004800200529      *  CLE148 - Alpha Loan Reference                                *
004900200529      *  AR746662 - Discrepancy in premium amount in Currency OTC     *
005000200529      *             screen and Projected Available Balance Enquiry    *
005100200529      *             Applied fix 249171. (Recompile)                   *
005200200529      *             (Child: Artf746663)                               *
005300200529      *  CER059 - German Feature Upgrade to Delhi                     *
005400200529      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
005500200529      *           Midas Plus                                          *
005600200529      *  247517 - Reversed fix 241147.                                *
005700200529      *  CPK027 - Errors in compiling MP1_3_TTTS - recompile over     *
005800200529      *           changed FFTVCLZ2.                                   *
005900200529      *  241147A - Recompile.                                         *
006000200529      *  241147 - Recompile.                                          *
006100200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
006200200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
006300200529      *  CLE025 - Credit Lines (Recompile)                            *
006400200529      *  215528 - System is associating a wrong premium amount.       *
006500200529      *           Recompiled only.                                    *
006600200529      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
006700200529      *           Recompile over changed FFYTOPZ1.                    *
006800200529      *  182961 - Database error occurred due to a blank key field    *
006900200529      *           (Instrument Type).  The default Instrument type in  *
007000200529      *           PF/SDPORTPD is taken if a blank instrument type is  *
007100200529      *           encountered.                                        *
007200200529     F*  CPM005 - Private Banking Phase II                            *
007300200529     F*           Focus Group Changes Upgraded to DBA                 *
007400200529     F*           Just Recompiled because of PM File(s) changes       *
007500200529     F*  CFF004 - Increase in size of Price Fields                    *
007600200529     F*  CPM003 - FF PM Interface Upgrade to R10.                     *
007700200529     F*  083338 - CORRECT DECIMAL PLACES IN MARKET PRICES             *
007800200529     F*  078956 - SUNDRY FIXES TO PERFORMANCE                         *
007900200529     F*  075998 - WRITTEN TO ALLOW PERFORMANCE FOR FUTURES & OPTIONS  *
008000200529      *                                                               *
008100200529     F*****************************************************************
008200200529     FPMPPTDPDIF  E           K        DISK
008300200529     F                                              KINFSR *PSSR
008400200529     F* PM Pool Portfolio Definition file - Prefix OR
008500200529     F*
008600200529     FPMPPTML0IF  E           K        DISK
008700200529     F                                              KINFSR *PSSR
008800200529     F* PM Pool Portfolio Members file - Prefix OS
008900200529     F*
009000200529     F***SDPLINL4IF**E           K        DISK                            CPM003
009100200529     F***********                                      KINFSR *PSSR       CPM003
009200200529     F****SD*Portfolio*Instrument*****************************************CPM003
009300200529     F*
009400200529     F***PMPSTMPPO***E                    DISK                      A     CPM003
009500200529     FPMPSTMQ0O   E                    DISK                      A        CPM003
009600200529     F                                              KINFSR *PSSR
009700200529     F* PM Performance Start of Month Position
009800200529     F*
009900200529     F***PMPMIMPPO***E           K        DISK                      A     CPM003
010000200529     FPMPMIMPDO   E           K        DISK                      A        CPM003
010100200529     F                                              KINFSR *PSSR
010200200529     F* PM Performance Mid Month Position
010300200529     F*
010400200529     F***PMFOPSPPUF**E           K        DISK                      A     CPM003
010500200529     FPMFOPSPDUF  E           K        DISK                      A        CPM003
010600200529     F                                              KINFSR *PSSR
010700200529     F**PM*Pool*Portfolio*Future*&*Option*Position*-*Prefix*WW************CPM003
010800200529     F* PM Pool Portfolio Future & Option Position - Prefix GJ            CPM003
010900200529     F*
011000200529     FINTYP   IF  E           K        DISK
011100200529     F                                              KINFSR *PSSR
011200200529     F* FF Instrument Types
011300200529     F*
011400200529     F***TRANSP2*IF**E           K        DISK                            CPM003
011500200529     FPMTRANL0IF  E           K        DISK                               CPM003
011600200529     F                                              KINFSR *PSSR
011700200529     F* FF Transactions by Portfolio
011800200529     F*
011900200529     FPRICS   IF  E           K        DISK
012000200529     F                                              KINFSR *PSSR
012100200529     F* FF Price details
012200200529     F*
012300200529     FSDPORTPDIF  E                    DISK         KINFSR *PSSR          182961
012400200529     F***SDCURRL1IF**E           K        DISK                            CPM003
012500200529     F***********                                      KINFSR *PSSR       CPM003
012600200529     F****SD*Currency*Details*-*Prefix*A6*********************************CPM003
012700200529     F***********                                                         CPM003
012800200529     F***SDPORTL1IF**E           K        DISK                            CPM003
012900200529     F***********                                      KINFSR *PSSR       CPM003
013000200529     F**PM*I.C.D.*-*Prefix*P9*********************************************CPM003
013100200529     F***********                                                         CPM003
013200200529     F***SDBANKL1IF**E           K        DISK                            CPM003
013300200529     F***********                                      KINFSR *PSSR       CPM003
013400200529     F**Bank*Details*file*************************************************CPM003
013500200529     FPM1830AUO   E                    PRINTER                        UC  CPM003
013600200529     F*
013700200529     F* ID F  C  H  L    FUNCTION OF INDICATORS
013800200529     F*
013900200529     F*
014000200529     F*
014100200529     F*       U7         DATABASE ERROR
014200200529     F*       U8         PROGRAM  ERROR
014300200529     F*
014400200529     F**             *************************
014500200529     F**             ** INDICATORS NOT USED **
014600200529     F**             ** ------------------- **
014700200529     F**             *************************
014800200529     F**
014900200529     F**      ***************************************************
015000200529     F**      * 01   02   03   04   05   06   07   08   09   10 *
015100200529     F**      * 11   12   13   14   15   16   17   18   19   20 *
015200200529     F**      * 21   22   23   24   25   26   27   28   29   30 *
015300200529     F**      * 31   32   33   34   35   36   37   38   39   40 *
015400200529     F**      * 41   42   43   44   45   46   47   48   49   50 *
015500200529     F**      * 51   52   53   54   55   56   57   58   59   60 *
015600200529     F**      * 61   62   63   64   65   66   67   68   69   70 *
015700200529     F**      * 71   72   73   74   75   76   77   78   79   .. *
015800200529     F**      * 81   82   83   84   85   86   87   88   89   90 *
015900200529     F**      * 91   92   93   94   95   96   97   98   99      *
016000200529     F**      ***************************************************
016100200529     E*
016200200529     E***/COPY*ZSRSRC,ZFFOLN1                                             CPM003
016300200529     E/COPY PMCPYSRC,ZFFOLN1                                              CPM003
016400200529      /COPY ZSRSRC,FFPRCSZ2
016500200529     E*
016600200529     E** ARRAY FOR POWER
016700200529     E                    POWER   1   7  7 3             POWER ARRAY
016800200529     E*
016900200529     E** ARRAY FOR COPYRIGHT
017000200529     E                    CPY@    1   1 80
017100200529     E**************************************************************************
017200200529     IINTYPDF                                                             CPM003
017300200529     I*                                                                   CPM003
017400200529     I**   Selected Instrument Type details                               CPM003
017500200529     I*                                                                   CPM003
017600200529     I              CTAM                            FFCTAM                CPM003
017700200529     I              CNTT                            FFCNTT                CPM003
017800200529     IPRICSDF
017900200529     I              ISTT                            PISTT
018000200529     I              YRNO                            PYRNO
018100200529     I              MTHN                            PMTHN
018200200529     I              PCAL                            PPCAL
018300200529     I              STRP                            PSTRP
018400200529     I*
018500200529      /COPY ZSRSRC,FFSRDSZ1
018600200529     I***/COPY*ZSRSRC,ZFFOLN2                                             CPM003
018700200529     I/COPY PMCPYSRC,ZFFOLN2                                              CPM003
018800200529      /COPY ZSRSRC,FFPRCSZ3
018900200529     I*
019000200529     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
019100200529     I*
019200200529     I***LDA********UDS                            256                    CPM003
019300200529     I***********                           132 183 DBLOT                 CPM003
019400200529     I***********                           132 141 DBFILE                CPM003
019500200529     I***********                           142 170 DBKEY                 CPM003
019600200529     I***********                           171 180 DBPGM                 CPM003
019700200529     I***********                           181 1830DBASE                 CPM003
019800200529     ILDA         DS                            256                       CPM003
019900200529     I                                      134 183 DBLOT                 CPM003
020000200529     I                                      134 141 DBFILE                CPM003
020100200529     I                                      142 170 DBKEY                 CPM003
020200200529     I                                      171 180 DBPGM                 CPM003
020300200529     I                                      181 1830DBASE                 CPM003
020400200529      /COPY ZSRSRC,ZYLDZ1                                                 CPM003
020500200529     ISDBANK    E DSSDBANKPD                                              CPM003
020600200529     I**  Midas  Bank details                                             CPM003
020700200529     ISDCURR    E DSSDCURRPD                                              CPM003
020800200529     I**  Midas  Currencies details                                       CPM003
020900200529     ISDPLIN    E DSSDPLINPD                                              CPM003
021000200529     I**  Midas  Instrument details                                       CPM003
021100200529     ISDPORT    E DSSDPORTPD                                              CPM003
021200200529     I**  Midas  Portfolio ICD                                            CPM003
021300200529     IDSFDY     E DSDSFDY                                                 CPM003
021400200529     I**  Short data structure                                            CPM003
021500200529     I*                                                                   CPM003
021600200529     IDSSDY     E DSDSSDY                                                 CPM003
021700200529     I**  Long data structure                                             CPM003
021800200529     I*
021900200529     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
022000200529     I*
022100200529     ICPYR@#      DS
022200200529     I                                        1  80 CPY@
022300200529     I                                        1  20 CPY@##
022400200529     I*
022500200529      /EJECT
022600200529     C*****************************************************************
022700200529     C*  P R O G R A M     S T A R T
022800200529     C*****************************************************************
022900200529     C*
023000200529     C** RECEIVE START MONTH NUMBER
023100200529     C           *ENTRY    PLIST
023200200529     C**********           PARM           PACNUM  60                                          CSD027
023300200529     C                     PARM           PACNUM  6                                           CSD027
023400200529     C                     PARM           PAPTFR  4
023500200529     C                     PARM           PAPTCY  3
023600200529     C                     PARM           PASTMN  2
023700200529     C                     PARM           PAMODE  1
023800200529     C*****************************************************************
023900200529     C** DEFINE KEY
024000200529     C           KPOOL     KLIST
024100200529     C                     KFLD           PACNUM
024200200529     C                     KFLD           PAPTFR
024300200529     C*
024400200529     C** DEFINE KEY
024500200529     C           KTRAN     KLIST
024600200529     C                     KFLD           POCNUM
024700200529     C                     KFLD           POPTFR
024800200529     C*
024900200529     C***DEFINE*KEY*TO*ACCESS*PF/PMFOPSPP*WITH*POOL*AND*POSITIONS*DETAILS*CPM003
025000200529     C** DEFINE KEY TO ACCESS PF/PMFOPSPD WITH POOL AND POSITIONS DETAILS CPM003
025100200529     C           KPOOL2    KLIST
025200200529     C                     KFLD           PACNUM
025300200529     C                     KFLD           PAPTFR
025400200529     C                     KFLD           XXISTT
025500200529     C                     KFLD           XXYRNO
025600200529     C                     KFLD           XXMTHN
025700200529     C                     KFLD           XXPCAL
025800200529     C                     KFLD           XXSTRP
025900200529     C*
026000200529     C***DEFINE*KEY*TO*ACCESS*PF/TRANSP2*WITH*CUSTOMER,*PORTFOLIO*AND*POSNCPM003
026100200529     C** DEFINE KEY TO ACCESS PF/PMTRANL0 WITH CUSTOMER, PORTFOLIO        CPM003
026200200529     C** AND POSITION                                                     CPM003
026300200529     C           KTRAN2    KLIST
026400200529     C                     KFLD           POCNUM
026500200529     C                     KFLD           POPTFR
026600200529     C                     KFLD           XPISTT
026700200529     C                     KFLD           XPYRNO
026800200529     C                     KFLD           XPMTHN
026900200529     C                     KFLD           XPPCAL
027000200529     C                     KFLD           XPSTRP
027100200529     C*
027200200529     C** DEFINE KEY TO ACCESS PRICE
027300200529     C           KPRICS    KLIST
027400200529     C                     KFLD           ISTT
027500200529     C                     KFLD           YRNO
027600200529     C                     KFLD           MTHN
027700200529     C                     KFLD           PCAL
027800200529     C                     KFLD           STRP
027900200529     C*****************************************************************
028000200529      ***  Copyright Statement.                                           CPM003
028100200529     C                     MOVEACPY@      ACT@   80                       CPM003
028200200529     C** PREPARE LDA                                                      CPM003
028300200529     C           *NAMVAR   DEFN           LDA                             CPM003
028400200529     C           *LOCK     IN   LDA                                       CPM003
028500200529     C                     MOVEL*BLANK    DBLOT                           CPM003
028600200529     C                     MOVEL'PM1830'  DBPGM                           CPM003
028700200529     C                     OUT  LDA                                       CPM003
028800200529     C*
028900200529     C** INITIAL PROCESSING
029000200529     C           WWFRST    IFNE 'Y'
029100200529     C                     EXSR INIT
029200200529     C                     END
029300200529     C*
029400200529     C** ACCESS POOL PORTFOLIO
029500200529     C           KPOOL     CHAINPMPPTDPD             81
029600200529     C*
029700200529     C           *IN81     IFEQ '0'                        - B1
029800200529     C           ORRECI    ANDEQ'D'
029900200529     C*
030000200529     C           KPOOL     SETLLPMPPTML0
030100200529     C           KPOOL     READEPMPPTML0                 82
030200200529     C*
030300200529     C           *IN82     DOWEQ'0'                        - B2
030400200529     C*
030500200529     C** PERFORM ROUTINE WITH POOL MEMBER CUSTOMER AND POOL MEMBER PORTFOLIO
030600200529     C**********           Z-ADDOSCNUM    POCNUM  60                                          CSD027
030700200529     C                     MOVE OSCNUM    POCNUM  6                                           CSD027
030800200529     C                     MOVE OSPTFR    POPTFR  4
030900200529     C                     MOVE 'Y'       POOL
031000200529     C*
031100200529     C                     EXSR POSITN
031200200529     C*
031300200529     C           KPOOL     READEPMPPTML0                 82
031400200529     C                     END                             - E2
031500200529     C*
031600200529     C                     ELSE                            - X1
031700200529     C*
031800200529     C**********           Z-ADDPACNUM    POCNUM                                              CSD027
031900200529     C                     MOVE PACNUM    POCNUM                                              CSD027
032000200529     C                     MOVE PAPTFR    POPTFR
032100200529     C                     MOVE 'N'       POOL
032200200529     C*
032300200529     C                     EXSR POSITN
032400200529     C*
032500200529     C                     END                             - E1
032600200529     C*
032700200529     C** IF POOL PORTFOLIO
032800200529     C           POOL      IFEQ 'Y'                        - B1
032900200529     C*
033000200529     C***********KPOOL     SETLLPMFOPSPP                                  CPM003
033100200529     C***********KPOOL     READEPMFOPSPP                 83               CPM003
033200200529     C           KPOOL     SETLLPMFOPSPD                                  CPM003
033300200529     C           KPOOL     READEPMFOPSPD                 83               CPM003
033400200529     C*
033500200529     C** DO WHILE POOL
033600200529     C           *IN83     DOWEQ'0'                        - B2
033700200529     C*
033800200529     C** SAVE POSITION DETAILS 'XX....' FOR THIS PROCESSING
033900200529     C***********          MOVE WWISTT    XXISTT  5                       CPM003
034000200529     C***********          Z-ADDWWYRNO    XXYRNO  20                      CPM003
034100200529     C***********          Z-ADDWWMTHN    XXMTHN  20                      CPM003
034200200529     C***********          MOVE WWPCAL    XXPCAL  1                       CPM003
034300200529     C***********          Z-ADDWWSTRP    XXSTRP 117                      CPM003
034400200529     C                     MOVE GJISTT    XXISTT  5                       CPM003
034500200529     C                     Z-ADDGJYRNO    XXYRNO  20                      CPM003
034600200529     C                     Z-ADDGJMTHN    XXMTHN  20                      CPM003
034700200529     C                     MOVE GJPCAL    XXPCAL  1                       CPM003
034800200529     C***********          Z-ADDGJSTRP    XXSTRP 117                CPM003CFF004
034900200529     C           *LIKE     DEFN STRP      XXSTRP                          CFF004
035000200529     C                     Z-ADDGJSTRP    XXSTRP                          CFF004
035100200529     C                     MOVE '0'       *IN84
035200200529     C*
035300200529     C** SET TOTALS TO 0
035400200529     C                     Z-ADD0         WKOPN
035500200529     C                     Z-ADD0         WKTIC
035600200529     C*
035700200529     C** DO WHILE SAME POOL AND SAME POSITION DETAILS
035800200529     C           *IN84     DOWEQ'0'                        - B3
035900200529     C*
036000200529     C***********          ADD  WWPNCO    WKOPN                           CPM003
036100200529     C***********          ADD  WWPOST    WKTIC                           CPM003
036200200529     C                     ADD  GJPNCO    WKOPN                           CPM003
036300200529     C                     ADD  GJPOST    WKTIC                           CPM003
036400200529     C*
036500200529     C***********KPOOL2    READEPMFOPSPP                 84               CPM003
036600200529     C           KPOOL2    READEPMFOPSPD                 84               CPM003
036700200529     C                     END                             - E3
036800200529     C*
036900200529     C** RETRIEVE INTRUMENT DETAILS
037000200529     C           XXISTT    CHAININTYP                88
037100200529     C           *IN88     IFEQ '1'                        - B3
037200200529     C           *LOCK     IN   LDA                                       CPM003
037300200529     C***********          MOVEL'003'     DBASE            ***************CPM003
037400200529     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 03 CPM003
037500200529     C                     Z-ADD3         DBASE            ***************CPM003
037600200529     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 03 CPM003
037700200529     C                     MOVELXXISTT    DBKEY            *****************
037800200529     C                     OUT  LDA                                       CPM003
037900200529     C                     EXSR *PSSR
038000200529     C                     END                             - E3
038100200529     C*
038200200529     C           ISTI      IFEQ 'N'                        - B3
038300200529     C           FTRF      ANDNE*BLANKS
038400200529     C** RETRIEVE INTRUMENT DETAILS WITH MARKET CENTER AND FUTURE TYPE REFERENCE
038500200529     C                     MOVELISTT      KMKT    5
038600200529     C                     MOVE FTRF      KMKT
038700200529     C           KMKT      CHAININTYP                88
038800200529     C           *IN88     IFEQ '1'                        - B4
038900200529     C           *LOCK     IN   LDA                                       CPM003
039000200529     C***********          MOVEL'004'     DBASE            ***************CPM003
039100200529     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 04 CPM003
039200200529     C                     Z-ADD4         DBASE            ***************CPM003
039300200529     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 04 CPM003
039400200529     C                     MOVELKMKT      DBKEY            *****************
039500200529     C                     OUT  LDA                                       CPM003
039600200529     C                     EXSR *PSSR
039700200529     C                     END                             - E4
039800200529     C*
039900200529     C** SAVE FIELDS
040000200529     C***********          Z-ADDMNPF      XXMNPF 117                      CFF004
040100200529     C           *LIKE     DEFN MNPF      XXMNPF                          CFF004
040200200529     C                     Z-ADDMNPF      XXMNPF                          CFF004
040300200529     C                     Z-ADDTKVL      XXTKVL 145
040400200529     C                     Z-ADDTKDM      XXTKDM  30
040500200529     C*
040600200529     C** REACCESS INTRUMENT TYPE
040700200529     C           XXISTT    CHAININTYP                88
040800200529     C           *IN88     IFEQ '1'                        - B4
040900200529     C           *LOCK     IN   LDA                                       CPM003
041000200529     C***********          MOVEL'005'     DBASE            ***************CPM003
041100200529     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 05 CPM003
041200200529     C                     Z-ADD5         DBASE            ***************CPM003
041300200529     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 05 CPM003
041400200529     C                     MOVELXXISTT    DBKEY            *****************
041500200529     C                     OUT  LDA                                       CPM003
041600200529     C                     EXSR *PSSR
041700200529     C                     END                             - E4
041800200529     C*
041900200529     C** RESTORE SAVED FIELDS
042000200529     C                     Z-ADDXXMNPF    MNPF
042100200529     C                     Z-ADDXXTKVL    TKVL
042200200529     C                     Z-ADDXXTKDM    TKDM
042300200529     C                     END                             - E3
042400200529     C*
042500200529     C** EXECUTE OUTPUT SUBROUTINE
042600200529     C***********          Z-ADDWWYRNO    YRNO                            CPM003
042700200529     C***********          Z-ADDWWMTHN    MTHN                            CPM003
042800200529     C***********          MOVE WWPCAL    PCAL                            CPM003
042900200529     C***********          Z-ADDWWSTRP    STRP                            CPM003
043000200529     C***********          Z-ADDWWCOPR    COPR                            CPM003
043100200529     C                     Z-ADDGJYRNO    YRNO                            CPM003
043200200529     C                     Z-ADDGJMTHN    MTHN                            CPM003
043300200529     C                     MOVE GJPCAL    PCAL                            CPM003
043400200529     C                     Z-ADDGJSTRP    STRP                            CPM003
043500200529     C                     Z-ADDGJCOPR    COPR                            CPM003
043600200529     C                     EXSR OUTPUT
043700200529     C*
043800200529     C** READ NEXT RECORD FOR SAME POOL PORTFOLIO
043900200529     C***********KPOOL2    SETGTPMFOPSPP                                  CPM003
044000200529     C***********KPOOL     READEPMFOPSPP                 83               CPM003
044100200529     C           KPOOL2    SETGTPMFOPSPD                                  CPM003
044200200529     C           KPOOL     READEPMFOPSPD                 83               CPM003
044300200529     C*
044400200529     C                     END                             - E2
044500200529     C*
044600200529     C                     END                             - E1
044700200529     C*
044800200529     C** TERMINATION PROCESSING
044900200529     C           PAMODE    IFNE 'S'                                       078956
045000200529     C                     SETON                     LR                   078956
045100200529     C                     END                                            078956
045200200529     C*
045300200529     C                     RETRN
045400200529     C*
045500200529     C/EJECT
045600200529     C**************************************************************************
045700200529     C* SR/POSITN - CALCULATE CUSTOMER POSITIONS
045800200529     C**************************************************************************
045900200529     C*
046000200529     C           POSITN    BEGSR
046100200529     C*
046200200529     C***********KTRAN     SETLLTRANSP2                                   CPM003
046300200529     C***********KTRAN     READETRANSP2                  85               CPM003
046400200529     C           KTRAN     SETLLPMTRANL0                                  CPM003
046500200529     C           KTRAN     READEPMTRANL0                 85               CPM003
046600200529     C*
046700200529     C           *IN85     DOWEQ'0'                        - B1
046800200529     C*
046900200529     C** SAVE POSITION DETAILS 'XP....' FOR THIS ROUTINE
047000200529     C                     MOVE ISTT      XPISTT  5
047100200529     C                     Z-ADDYRNO      XPYRNO  20
047200200529     C                     Z-ADDMTHN      XPMTHN  20
047300200529     C                     MOVE PCAL      XPPCAL  1
047400200529     C***********          Z-ADDSTRP      XPSTRP 117                      CFF004
047500200529     C           *LIKE     DEFN STRP      XPSTRP                          CFF004
047600200529     C                     Z-ADDSTRP      XPSTRP                          CFF004
047700200529     C                     MOVE '0'       *IN86
047800200529     C*
047900200529     C** RETRIEVE INTRUMENT DETAILS
048000200529     C           XPISTT    CHAININTYP                88
048100200529     C           *IN88     IFEQ '1'                        - B2
048200200529     C           *LOCK     IN   LDA                                       CPM003
048300200529     C***********          MOVEL'006'     DBASE            ***************CPM003
048400200529     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 06 CPM003
048500200529     C                     Z-ADD6         DBASE            ***************CPM003
048600200529     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 06 CPM003
048700200529     C                     MOVELXPISTT    DBKEY            *****************
048800200529     C                     OUT  LDA                                       CPM003
048900200529     C                     EXSR *PSSR
049000200529     C                     END                             - E2
049100200529     C*
049200200529     C           ISTI      IFEQ 'N'                        - B2
049300200529     C           FTRF      ANDNE*BLANKS
049400200529     C** RETRIEVE INTRUMENT DETAILS WITH MARKET CENTER AND FUTURE TYPE REFERENCE
049500200529     C                     MOVELISTT      KMKT    5
049600200529     C                     MOVE FTRF      KMKT
049700200529     C           KMKT      CHAININTYP                88
049800200529     C           *IN88     IFEQ '1'                        - B3
049900200529     C           *LOCK     IN   LDA                                       CPM003
050000200529     C***********          MOVEL'007'     DBASE            ***************CPM003
050100200529     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 07 CPM003
050200200529     C                     Z-ADD7         DBASE            ***************CPM003
050300200529     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 07 CPM003
050400200529     C                     MOVELKMKT      DBKEY            *****************
050500200529     C                     OUT  LDA                                       CPM003
050600200529     C                     EXSR *PSSR
050700200529     C                     END                             - E3
050800200529     C*
050900200529     C** SAVE FIELDS
051000200529     C***********          Z-ADDMNPF      XPMNPF 117                      CFF004
051100200529     C           *LIKE     DEFN MNPF      XPMNPF                          CFF004
051200200529     C                     Z-ADDMNPF      XPMNPF                          CFF004
051300200529     C                     Z-ADDTKVL      XPTKVL 145
051400200529     C                     Z-ADDTKDM      XPTKDM  30
051500200529     C*
051600200529     C** REACCESS INTRUMENT TYPE
051700200529     C           XPISTT    CHAININTYP                88
051800200529     C           *IN88     IFEQ '1'                        - B3
051900200529     C           *LOCK     IN   LDA                                       CPM003
052000200529     C***********          MOVEL'008'     DBASE            ***************CPM003
052100200529     C***********          MOVEL'INTYP   'DBFILE           ** DB ERROR 08 CPM003
052200200529     C                     Z-ADD8         DBASE            ***************CPM003
052300200529     C                     MOVE 'INTYP   'DBFILE           ** DB ERROR 08 CPM003
052400200529     C                     MOVELXPISTT    DBKEY            *****************
052500200529     C                     OUT  LDA                                       CPM003
052600200529     C                     EXSR *PSSR
052700200529     C                     END                             - E3
052800200529     C*
052900200529     C** SETUP FIELDS WITH SAVED VALUES
053000200529     C                     Z-ADDXPMNPF    MNPF
053100200529     C                     Z-ADDXPTKVL    TKVL
053200200529     C                     Z-ADDXPTKDM    TKDM
053300200529     C*
053400200529     C                     END                             - E2
053500200529     C*
053600200529     C** SET WORKFIELDS TO 0
053700200529     C                     Z-ADD0         WKOPN  150
053800200529     C                     Z-ADD0         WKTIC  150
053900200529     C***********          Z-ADDCOPR      WWCOPR                          CPM003
054000200529     C                     Z-ADDCOPR      GJCOPR                          CPM003
054100200529     C*
054200200529     C** DO WHILE SAME POOL AND SAME POSITION
054300200529     C           *IN86     DOWEQ'0'                        - B2
054400200529     C*
054500200529     C** DETERMINE IF INCREASE OR DECREASE
054600200529     C** 1.TRADE PURCHASE
054700200529     C           TRTY      IFEQ 'P'                        - B3
054800200529     C*
054900200529     C********** BOCO      IFEQ 0                          - B4                               CSD027
055000200529     C           BOCO      IFEQ *BLANKS                    - B4                               CSD027
055100200529     C                     MOVE 'D'       ICDC    1
055200200529     C                     ELSE                            - X4
055300200529     C                     MOVE 'I'       ICDC
055400200529     C                     END                             - E4
055500200529     C*
055600200529     C                     ELSE                            - X3
055700200529     C*
055800200529     C** 2.TRADE SALE
055900200529     C********** BOCO      IFEQ 0                          - B4                               CSD027
056000200529     C           BOCO      IFEQ *BLANKS                    - B4                               CSD027
056100200529     C                     MOVE 'I'       ICDC
056200200529     C                     ELSE                            - X4
056300200529     C                     MOVE 'D'       ICDC
056400200529     C                     END                             - E4
056500200529     C*
056600200529     C                     END                             - E3
056700200529     C*
056800200529     C           ICDC      IFEQ 'I'                        - B3
056900200529     C                     ADD  NOCO      WKOPN
057000200529     C                     ELSE                            - X3
057100200529     C                     SUB  NOCO      WKOPN
057200200529     C                     END                             - E3
057300200529     C*
057400200529     C** SETUP MODULE ID
057500200529     C***********          MOVE *BLANKS   WWMODI                          CPM003
057600200529     C                     MOVE *BLANKS   GJMODI                          CPM003
057700200529     C           ISPT      IFEQ 1                          - B3
057800200529     C           ISPT      OREQ 2
057900200529     C           ISPT      OREQ 3
058000200529     C           ISPT      OREQ 7                                         CPM003
058100200529     C***********          MOVE 'FM'      WWMODI                          CPM003
058200200529     C                     MOVE 'FM'      GJMODI                          CPM003
058300200529     C                     END                             - E3
058400200529     C*
058500200529     C           ISPT      IFEQ 4                          - B3
058600200529     C           ISPT      OREQ 5
058700200529     C           ISPT      OREQ 6
058800200529     C           ISPT      OREQ 8                                         CPM003
058900200529     C*
059000200529     C           PUPF      IFEQ 'N'                        - B4
059100200529     C***********          MOVE 'FM'      WWMODI                          CPM003
059200200529     C                     MOVE 'FM'      GJMODI                          CPM003
059300200529     C                     END                             - E4
059400200529     C*
059500200529     C                     END                             - E3
059600200529     C*
059700200529     C***********WWMODI    IFEQ *BLANKS                    - B3           CPM003
059800200529     C***********          MOVE 'FO'      WWMODI                          CPM003
059900200529     C           GJMODI    IFEQ *BLANKS                    - B3           CPM003
060000200529     C                     MOVE 'FO'      GJMODI                          CPM003
060100200529     C                     END                             - E3
060200200529     C*
060300200529     C** CALCULATE CONTRACT TICKS
060400200529     C***********WWMODI    IFEQ 'FM'                       - B3           CPM003
060500200529     C           GJMODI    IFEQ 'FM'                       - B3           CPM003
060600200529     C                     Z-ADDNOCO      FFNOC
060700200529     C                     Z-ADDCOPR      FFPRIC
060800200529     C                     Z-ADDTKDM      FFTKDM
060900200529     C                     Z-ADDMNPF      FFMNPF
061000200529     C*
061100200529     C           ISPT      IFLE 6                                         CPM003
061200200529     C                     EXSR FFTVCL
061300200529     C                     ELSE                                           CPM003
061400200529     C           100       SUB  FFPRIC    FFYLD                           CPM003
061500200529     C                     EXSR FFYTOP                                    CPM003
061600200529     C           PRICEC    MULT FFCTAM    W309   309                      CPM003
061700200529     C                     MULT 100       W309                            CPM003
061800200529     C                     MULT FFNOC     FFTNVL    H                     CPM003
061900200529     C                     END                                            CPM003
062000200529     C*
062100200529     C           ICDC      IFEQ 'I'                        - B4
062200200529     C****                 SUB  FFNOTK    WKTIC                           078956
062300200529     C                     SUB  FFTNVL    WKTIC                           078956
062400200529     C                     ELSE                            - X4
062500200529     C****                 ADD  FFNOTK    WKTIC                           078956
062600200529     C                     ADD  FFTNVL    WKTIC                           078956
062700200529     C                     END                             - E4
062800200529     C                     END                             - E3
062900200529     C*
063000200529     C** READ NEXT RECORD WITH CUSTOMER, PORTFOLIO AND POSITION DETAILS
063100200529     C***********KTRAN2    READETRANSP2                  86               CPM003
063200200529     C           KTRAN2    READEPMTRANL0                 86               CPM003
063300200529     C*
063400200529     C                     END                             - E2
063500200529     C*
063600200529     C** POOL PROCESSING
063700200529     C           POOL      IFEQ 'Y'                        - B2
063800200529     C                     EXSR W001
063900200529     C                     ELSE                            - X2
064000200529     C                     EXSR OUTPUT
064100200529     C                     END                             - E2
064200200529     C*
064300200529     C** READ NEXT RECORD FOR CUSTOMER AND PORTFOLIO
064400200529     C***********KTRAN2    SETGTTRANSP2                                   CPM003
064500200529     C***********KTRAN     READETRANSP2                  85               CPM003
064600200529     C           KTRAN2    SETGTPMTRANL0                                  CPM003
064700200529     C           KTRAN     READEPMTRANL0                 85               CPM003
064800200529     C*
064900200529     C                     END                             - E1
065000200529     C*
065100200529     C                     ENDSR
065200200529     C**************************************************************************
065300200529     C**SR/W001**-**OUTPUT*DETAILS*TO*PF/PMFOPSPP****                     CPM003
065400200529     C* SR/W001  -  OUTPUT DETAILS TO PF/PMFOPSPD                         CPM003
065500200529     C**************************************************************************
065600200529     C*
065700200529     C           W001      BEGSR
065800200529     C*
065900200529     C***********          Z-ADDPACNUM    WWCNUM                          CPM003
066000200529     C***********          MOVE PAPTFR    WWPTFR                          CPM003
066100200529     C***********          MOVE XPISTT    WWISTT                          CPM003
066200200529     C***********          Z-ADDXPYRNO    WWYRNO                          CPM003
066300200529     C***********          Z-ADDXPMTHN    WWMTHN                          CPM003
066400200529     C***********          MOVE XPPCAL    WWPCAL                          CPM003
066500200529     C***********          Z-ADDXPSTRP    WWSTRP                          CPM003
066600200529     C***********          Z-ADDWKOPN     WWPNCO                          CPM003
066700200529     C***********          Z-ADDWKTIC     WWPOST                          CPM003
066800200529     C**********           Z-ADDPACNUM    GJCNUM                                       CPM003 CSD027
066900200529     C                     MOVE PACNUM    GJCNUM                                              CSD027
067000200529     C                     MOVE PAPTFR    GJPTFR                          CPM003
067100200529     C                     MOVE XPISTT    GJISTT                          CPM003
067200200529     C                     Z-ADDXPYRNO    GJYRNO                          CPM003
067300200529     C                     Z-ADDXPMTHN    GJMTHN                          CPM003
067400200529     C                     MOVE XPPCAL    GJPCAL                          CPM003
067500200529     C                     Z-ADDXPSTRP    GJSTRP                          CPM003
067600200529     C                     Z-ADDWKOPN     GJPNCO                          CPM003
067700200529     C                     Z-ADDWKTIC     GJPOST                          CPM003
067800200529     C*
067900200529     C                     WRITEPMFOPSP0
068000200529     C*
068100200529     C                     ENDSR
068200200529     C**************************************************************************
068300200529     C**SR/OUTPUT**-**FORMAT*DETAILS*TO*PF/PMFOPSPP***********************CPM003
068400200529     C* SR/OUTPUT  -  FORMAT DETAILS TO PF/PMFOPSPD                       CPM003
068500200529     C**************************************************************************
068600200529     C*
068700200529     C           OUTPUT    BEGSR
068800200529     C*
068900200529     C**********           Z-ADDPACNUM    QFCNUM                                              CSD027
069000200529     C                     MOVE PACNUM    QFCNUM                                              CSD027
069100200529     C                     MOVE PAPTFR    QFPTFR
069200200529     C                     MOVE INNR      QFINNR
069300200529      *                                                                   182961
069400200529      ** Instrument type is defaulted from PF/SDPORTPD if a blank         182961
069500200529      ** instrument type is found.                                        182961
069600200529      ** Indicator 35 was used as the operation's resulting indicator.    182961
069700200529      *                                                                   182961
069800200529     C           QFINNR    IFEQ *BLANKS                                   182961
069900200529     C           1         SETLLSDPORTPD                                  182961
070000200529     C                     READ SDPORTPD                 35               182961
070100200529     C                     MOVE FCDINR    QFINNR                          182961
070200200529     C                     ENDIF                                          182961
070300200529     C*
070400200529     C***********QFINNR    CHAINSDPLINL4             88                   CPM003
070500200529     C************IN88     IFEQ '0'                        - B1           CPM003
070600200529     C                     CALL 'AOPLINR0'                                CPM003
070700200529     C                     PARM *BLANKS   P@RTCD                          CPM003
070800200529     C                     PARM '*KEY  '  P@OPTN                          CPM003
070900200529     C                     PARM QFINNR    P@INNR  3                       CPM003
071000200529     C           SDPLIN    PARM SDPLIN    DSFDY                           CPM003
071100200529     C*                                                                   CPM003
071200200529     C           P@RTCD    IFEQ *BLANKS                                   CPM003
071300200529     C                     MOVE PDVALG    QFVALG
071400200529     C                     ELSE                            - X1
071500200529     C                     MOVE *BLANKS   QFVALG
071600200529     C                     END                             - E1
071700200529     C*
071800200529     C                     MOVE ISCY      QFCCY1
071900200529     C***********QFCCY1    CHAINSDCURRL1             88                   CPM003
072000200529     C************IN88     IFEQ '1'                        - B1           CPM003
072100200529     C*                                                                   CPM003
072200200529     C                     CALL 'AOCURRR0'                                CPM003
072300200529     C                     PARM *BLANKS   P@RTCD                          CPM003
072400200529     C                     PARM '*FIRST'  P@OPTN                          CPM003
072500200529     C                     PARM QFCCY1    P@CYCD  3                       CPM003
072600200529     C           SDCURR    PARM SDCURR    DSSDY                           CPM003
072700200529     C*                                                                   CPM003
072800200529     C           P@RTCD    IFNE *BLANKS                                   CPM003
072900200529     C           *LOCK     IN   LDA                                       CPM003
073000200529     C***********          MOVEL'008'     DBASE            ***************CPM003
073100200529     C***********          MOVEL'SDCURRL1'DBFILE           ** DB ERROR 08 CPM003
073200200529     C                     Z-ADD8         DBASE            ***************CPM003
073300200529     C                     MOVE 'SDCURRPD'DBFILE           ** DB ERROR 08 CPM003
073400200529     C                     MOVELQFCCY1    DBKEY            *****************
073500200529     C                     OUT  LDA                                       CPM003
073600200529     C                     EXSR *PSSR
073700200529     C                     END                             - E1
073800200529     C                     Z-ADDA6NBDP    QFCDP1
073900200529     C*
074000200529     C** SETUP 'FROM' PARAMETERS
074100200529     C                     MOVELA6CYCD    ZCCYF
074200200529     C                     Z-ADDA6SPRT    ZRATEF
074300200529     C                     MOVELA6MDIN    ZMDINF
074400200529     C                     Z-ADDA6NBDP    ZCDPF
074500200529     C*
074600200529     C***********          MOVE P9CNCD    QFCNTR                          CPM003
074700200529     C***********          MOVE P9LICD    QFLIND                          CPM003
074800200529     C                     MOVE FCCNCD    QFCNTR                          CPM003
074900200529     C**********           MOVE FCLICD    QFLIND                                       CPM003 CER020
075000200529     C                     MOVE FCLICD    QFLOIC                                              CER020
075100200529     C                     MOVE *BLANKS   QFTDSS
075200200529     C                     Z-ADDWKOPN     QFAMT1
075300200529     C                     Z-ADDWKTIC     QFACIS
075400200529     C                     Z-ADD0         QFPLFX
075500200529     C*
075600200529     C***********PAPTCY    CHAINSDCURRL1             88                   CPM003
075700200529     C************IN88     IFEQ '1'                        - B1           CPM003
075800200529     C*                                                                   CPM003
075900200529     C                     CALL 'AOCURRR0'                                CPM003
076000200529     C                     PARM *BLANKS   P@RTCD                          CPM003
076100200529     C                     PARM '*FIRST'  P@OPTN                          CPM003
076200200529     C                     PARM PAPTCY    P@CYCD  3                       CPM003
076300200529     C           SDCURR    PARM SDCURR    DSSDY                           CPM003
076400200529     C*                                                                   CPM003
076500200529     C           P@RTCD    IFNE *BLANKS                                   CPM003
076600200529     C           *LOCK     IN   LDA                                       CPM003
076700200529     C***********          MOVEL'009'     DBASE            ***************CPM003
076800200529     C***********          MOVEL'SDCURRL1'DBFILE           ** DB ERROR 09 CPM003
076900200529     C                     Z-ADD9         DBASE            ***************CPM003
077000200529     C                     MOVE 'SDCURRPD'DBFILE           ** DB ERROR 09 CPM003
077100200529     C                     MOVELPAPTCY    DBKEY            *****************
077200200529     C                     OUT  LDA                                       CPM003
077300200529     C                     EXSR *PSSR
077400200529     C                     END                             - E1
077500200529     C*
077600200529     C** SETUP 'TO' PARAMETERS
077700200529     C                     MOVELA6CYCD    ZCCYT
077800200529     C                     Z-ADDA6SPRT    ZRATET
077900200529     C                     MOVELA6MDIN    ZMDINT
078000200529     C                     Z-ADDA6NBDP    ZCDPT
078100200529     C                     Z-ADD1         ZAMTF
078200200529     C                     EXSR ZCCYCN
078300200529     C*
078400200529     C** MARKET FX RATE
078500200529     C                     Z-ADDZCRSRT    QFMFXR
078600200529     C*
078700200529     C                     EXSR ZCCYCD
078800200529     C                     Z-ADDZCRSRN    QFMFXD
078900200529     C*
079000200529     C                     MOVE 'M'       QFMFMD
079100200529     C*
079200200529     C** SETUP MARKET PRICE
079300200529     C****                 Z-ADDCOPR      WKMKPR 117                      078956
079400200529     C***********          Z-ADD0         WKMKPR 117                078956CFF004
079500200529     C           *LIKE     DEFN PLEC      WKMKPR                          CFF004
079600200529     C                     Z-ADD0         WKMKPR                          CFF004
079700200529     C****       ISTI      IFEQ 'N'                        - B1           078956
079800200529     C           KPRICS    CHAINPRICS                88
079900200529     C           *IN88     IFEQ '0'                        - B1
080000200529     C****                 Z-ADDNEWP      WKMKPR                          078956
080100200529     C                     Z-ADDPLEC      WKMKPR                          078956
080200200529     C****                 END                             - E2           078956
080300200529     C****                 END                             - E1           078956
080400200529     C*
080500200529     C***********WWMODI    IFEQ 'FM'                       - B1           CPM003
080600200529     C           GJMODI    IFEQ 'FM'                       - B1           CPM003
080700200529     C                     Z-ADDWKMKPR    QFMPRC
080800200529     C                     ELSE                            - X1
080900200529     C                     Z-ADD1         FFNOC
081000200529     C                     Z-ADDWKMKPR    FFPRIC
081100200529     C                     Z-ADDTKDM      FFTKDM
081200200529     C                     Z-ADDMNPF      FFMNPF
081300200529     C                     Z-ADDTKVL      FFTKVL
081400200529     C                     EXSR FFPMCL
081500200529     C*                                                                   083338
081600200529     C** REMOVE IMPLIED DECIMAL PLACES FROM MARKET PRICE                  083338
081700200529     C           1         DO   QFCDP1                                    083338
081800200529     C           FFPREM    DIV  10        FFPREM                          083338
081900200529     C                     END                                            083338
082000200529     C*                                                                   083338
082100200529     C                     Z-ADDFFPREM    QFMPRC
082200200529     C                     END                             - E1
082300200529     C*                                                                   078956
082400200529     C** IF MARKET PRICE NOT FOUND SET TO *LOVAL. NO VALUATION CALCULATED 078956
082500200529     C** CALCULATED FOR POSITION IN PGM/PM1630                            078956
082600200529     C                     ELSE                                           078956
082700200529     C                     Z-ADD0         QFMPRC                          078956
082800200529     C                     END                             - E1           078956
082900200529     C*
083000200529     C                     MOVE *BLANKS   QFBYSF
083100200529     C**********           Z-ADD0         QFTRNB                                              CLE148
083200200529     C                     MOVEL*BLANKS   QFTRNB                                              CLE148
083300200529     C************         MOVE WWMODI    QFMODI                          CPM003
083400200529     C                     MOVE GJMODI    QFMODI                          CPM003
083500200529     C***********          MOVE *BLANKS   QFFOIS                          CPM003
083600200529     C                     MOVE ISTT      QFFOIS                          CPM003
083700200529     C**********           MOVE *BLANKS   QFTXT2                                              250228
083800200529     C                     MOVE *BLANKS   QQTXT2                                              250228
083900200529     C                     MOVE PASTMN    QFSTMN
084000200529     C                     MOVE 'N'       QFPPRC
084100200529     C                     Z-ADD0         QFNMDP
084200200529     C                     MOVE 'U'       QFSPBS
084300200529     C*
084400200529     C** SETUP FF POSITION ID
084500200529     C                     MOVE ISTT      FFISTT
084600200529     C                     Z-ADDMTHN      FFMTHN
084700200529     C                     Z-ADDYRNO      FFYRNO
084800200529     C                     MOVE PCAL      FFPCAL
084900200529     C                     Z-ADDSTRP      FFSTRP
085000200529     C                     Z-ADDMNPF      FFMNPF
085100200529     C                     Z-ADDTKDM      FFTKDM
085200200529     C                     MOVE ISTI      FFISTI
085300200529     C                     Z-ADDISPT      FFISPT
085400200529     C                     EXSR ZFFOLN
085500200529     C                     MOVELFFISDT    QFFPSI
085600200529     C*
085700200529     C                     Z-ADDTKDM      QFTKDM
085800200529     C                     Z-ADDMNPF      QFMNPF
085900200529     C                     Z-ADDTKVL      QFTKVL
086000200529     C*
086100200529     C** WRITE OUTPUT RECORD
086200200529     C           PAMODE    IFEQ 'S'                        - B1
086300200529     C                     WRITEPMPSTMP0
086400200529     C                     ELSE                            - X1
086500200529     C***********          MOVE 'D'       QFRECI                          CPM003
086600200529     C                     MOVE 'D'       GERECI                          CPM003
086700200529     C**********           Z-ADDQFCNUM    GECNUM                                       CPM003 CSD027
086800200529     C                     MOVE QFCNUM    GECNUM                                              CSD027
086900200529     C***********          MOVE PAPTFR    QFPTFR                          CPM003
087000200529     C                     MOVE PAPTFR    GEPTFR                          CPM003
087100200529     C                     MOVE QFINNR    GEINNR                          CPM003
087200200529     C                     MOVE QFVALG    GEVALG                          CPM003
087300200529     C                     MOVE QFCCY1    GECCY1                          CPM003
087400200529     C                     Z-ADDQFCDP1    GECDP1                          CPM003
087500200529     C                     MOVE QFCNTR    GECNTR                          CPM003
087600200529     C**********           Z-ADDQFLIND    GELIND                                       CPM003 CER020
087700200529     C                     MOVELQFLOIC    GELOIC                                              CER020
087800200529     C                     MOVE QFTDSS    GETDSS                          CPM003
087900200529     C                     Z-ADDQFAMT1    GEAMT1                          CPM003
088000200529     C                     Z-ADDQFACIS    GEACIS                          CPM003
088100200529     C                     Z-ADDQFPLFX    GEPLFX                          CPM003
088200200529     C                     Z-ADDQFMFXR    GEMFXR                          CPM003
088300200529     C                     MOVE QFMFMD    GEMFMD                          CPM003
088400200529     C                     Z-ADDQFMPRC    GEMPRC                          CPM003
088500200529     C**********           Z-ADDQFTRNB    GETRNB                                       CPM003 CLE148
088600200529     C                     MOVELQFTRNB    GETRNB                                              CLE148
088700200529     C                     MOVE QFMODI    GEMODI                          CPM003
088800200529     C                     MOVE QFBYSF    GEBYSF                          CPM003
088900200529     C                     MOVE QFFOIS    GEFOIS                          CPM003
089000200529     C**********           MOVE QFTXT2    GETXT2                                       CPM003 250228
089100200529     C                     MOVE QQTXT2    GETXT2                                              250228
089200200529     C***********          Z-ADDBJRDNB    QFDXTR                          CPM003
089300200529     C                     Z-ADDBJRDNB    GEDXTR                          CPM003
089400200529     C                     Z-ADDQFMFXD    GEMFXD                          CPM003
089500200529     C***********          MOVELFFISDT    QFRESH                          CPM003
089600200529     C                     MOVELFFISDT    GERESH                          CPM003
089700200529     C                     Z-ADDQFNMDP    GENMDP                          CPM003
089800200529     C                     MOVE QFSPBS    GESPBS                          CPM003
089900200529     C                     Z-ADDQFTKDM    GETKDM                          CPM003
090000200529     C                     Z-ADDQFMNPF    GEMNPF                          CPM003
090100200529     C                     Z-ADDQFTKVL    GETKVL                          CPM003
090200200529     C                     WRITEPMPMIMP0
090300200529     C                     END                             - E1
090400200529     C*
090500200529     C*
090600200529     C                     ENDSR
090700200529     C********************************************************************
090800200529     C*
090900200529     C*  ZCCYCD SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER
091000200529     C*  CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES
091100200529     C*
091200200529     C*  INPUT  FIELDS
091300200529     C*       ZAMTF  150     AMOUNT IN 'FROM' CURRENCY
091400200529     C*       ZCCYF   3A     FROM CURRENCY
091500200529     C*       ZCCYT   3A     TO CURRENCY
091600200529     C*       ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY
091700200529     C*       ZRATET 138     SPOT RATE FOR 'TO' CURRENCY
091800200529     C*       ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CURRENCY
091900200529     C*       ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURRENCY
092000200529     C*       ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY
092100200529     C*       ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY
092200200529     C*
092300200529     C*  OUTPUT  FIELDS
092400200529     C*       ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT
092500200529     C*       ZCRSRT 138     CROSS EXCHANGE RATE
092600200529     C*       ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR
092700200529     C*
092800200529     C*
092900200529     C*  CALLS:
093000200529     C*       ZCCYCA - CONVERT AMOUNT
093100200529     C********************************************************************
093200200529     C*
093300200529     C           ZCCYCD    BEGSR                           *** ZCCYCN ***
093400200529     C*
093500200529     C** DEFINE ALL FIELDS
093600200529     C                     Z-ADDZAMTF     ZAMTF  150
093700200529     C                     MOVE ZCCYF     ZCCYF   3
093800200529     C                     MOVE ZCCYT     ZCCYT   3
093900200529     C                     Z-ADDZRATEF    ZRATEF 138
094000200529     C                     Z-ADDZRATET    ZRATET 138
094100200529     C                     MOVE ZMDINF    ZMDINF  1
094200200529     C                     MOVE ZMDINT    ZMDINT  1
094300200529     C                     Z-ADDZCDPF     ZCDPF   10
094400200529     C                     Z-ADDZCDPT     ZCDPT   10
094500200529     C                     Z-ADDZAMTT     ZAMTT  150
094600200529     C                     Z-ADDZCRSRT    ZCRSRT 138
094700200529     C                     MOVE ZCRSMD    ZCRSMD  1
094800200529     C*
094900200529     C** IF 'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TO' CURR
095000200529     C** EQUAL TO AMOUNT IN 'FROM' CURRENCY
095100200529     C           ZCCYF     IFEQ ZCCYT
095200200529     C                     Z-ADDZAMTF     ZAMTT
095300200529     C                     Z-ADD1         ZCRSRT
095400200529     C                     MOVE 'M'       ZCRSMD
095500200529     C           1000000000MULT 1000000   ZCRSRN
095600200529     C                     GOTO CCYEN1
095700200529     C                     END
095800200529     C*
095900200529     C** INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO
096000200529     C                     Z-ADD*ZEROS    ZCRSRT
096100200529     C*
096200200529     C** CONVERT 'FROM' RATE TO MULTIPLY RATE
096300200529     C           ZMDINF    IFEQ 'M'
096400200529     C                     Z-ADDZRATEF    ZRATF1 138
096500200529     C           1000000000MULT ZRATEF    ZRATF2 308
096600200529     C           10        MULT ZRATF2    ZRATF2
096700200529     C                     ELSE
096800200529     C           1         DIV  ZRATEF    ZRATF1
096900200529     C           1000000000MULT 10        ZRWORK 200
097000200529     C           ZRWORK    DIV  ZRATEF    ZRATF2    H
097100200529     C                     END
097200200529     C*
097300200529     C** CONVERT 'TO' RATE TO MULTIPLY RATE
097400200529     C           ZMDINT    IFEQ 'M'
097500200529     C                     Z-ADDZRATET    ZRATT1 138
097600200529     C           1000000000MULT ZRATET    ZRATT2 308
097700200529     C           10        MULT ZRATT2    ZRATT2
097800200529     C                     ELSE
097900200529     C           1         DIV  ZRATET    ZRATT1
098000200529     C           1000000000MULT 10        ZRWORK
098100200529     C           ZRWORK    DIV  ZRATET    ZRATT2    H
098200200529     C                     END
098300200529     C*
098400200529     C** NOW CALCULATE CROSS RATE
098500200529     C           ZRATT1    IFNE *ZEROS
098600200529     C           ZRATF1    DIV  ZRATT1    ZCRSRT
098700200529     C*
098800200529     C** CALCULATE DOUBLE PRECISION FX RATE
098900200529     C** FIRST SPLIT FIGURE INTO TWO PARTS
099000200529     C           1000000000MULT 1000000   ZRWORK
099100200529     C           ZRATF2    MULT ZRWORK    ZRATBF 300
099200200529     C                     Z-ADDZRATF2    ZRATSF 158
099300200529     C*
099400200529     C** DIVIDE BOTH BIG AND SMALL PARTS BY TO FX RATE AND ADD TO CROSS RA
099500200529     C** TO BE USED IN CALCULATIONS
099600200529     C           ZRATBF    DIV  ZRATT2    ZCRSRN 309H
099700200529     C           ZRATSF    DIV  ZRATT2    ZCRSR1 309H
099800200529     C                     ADD  ZCRSR1    ZCRSRN
099900200529     C                     END
100000200529     C*
100100200529     C** MOVE MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULT/DIV
100200200529     C** INDICATOR (ZCRSMD)
100300200529     C                     MOVE 'M'       ZCRSMD
100400200529     C*
100500200529     C** IF CROSS EXCHANGE RATE IS EQUAL TO ZERO
100600200529     C** SET ZAMTT  TO *ZERO  & EXIT
100700200529     C           ZCRSRN    IFEQ 0
100800200529     C                     Z-ADD*ZEROS    ZAMTT
100900200529     C                     GOTO CCYEN1
101000200529     C                     END
101100200529     C*
101200200529     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF) EQUALS DECIMAL
101300200529     C** DECIMAL PLACES  FOR 'TO' CURRENCY CONVERT AMOUNT BY SIMPLE
101400200529     C** MULTIPLICATION
101500200529     C           ZCDPF     IFEQ ZCDPT                      B1
101600200529     C           ZAMTF     MULT ZCRSRN    ZAMTO  300H
101700200529     C                     END                             E1
101800200529     C*
101900200529     C** IF DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF)  NOT EQUALS DECIMA
102000200529     C** DECIMAL PLACES  FOR 'TO' CURRENCY ADJUST AMOUNT FOR DIFFERENT DP
102100200529     C           ZCDPF     IFNE ZCDPT                      B1
102200200529     C*
102300200529     C** SUBTRACT DECIMAL PLACES 'FROM' FROM DECIMAL PLACES 'TO' IN POWER
102400200529     C           ZCDPT     SUB  ZCDPF     ZWKPX   10
102500200529     C           ZWKPX     ADD  4         B       30
102600200529     C*
102700200529     C** IF POWER ELEMENT (8,4) LESS THAN 1
102800200529     C           POWER,B   IFLT 1                          B2
102900200529     C*
103000200529     C** MULTIPLY AMOUNT IN FROM CURRENCY BY ELEMENT IN POWER ARRAY
103100200529     C           POWER,B   MULT ZAMTF     ZWK153 153
103200200529     C*
103300200529     C           ZWK153    MULT ZCRSRN    ZAMTO     H
103400200529     C                     END                             E2
103500200529     C*
103600200529     C** IF POWER ELEMENT (8,4) GREATER OR EQUAL TO 1
103700200529     C           POWER,B   IFGE 1                          B2
103800200529     C           ZAMTF     MULT POWER,B   ZAMTO
103900200529     C           ZAMTO     MULT ZCRSRN    ZAMTO     H
104000200529     C                     END                             E2
104100200529     C                     END                             E1
104200200529     C*
104300200529     C           ZAMTO     DIV  ZRWORK    ZAMTT     H
104400200529     C*
104500200529     C           CCYEN1    ENDSR
104600200529     C**************************************************************************
104700200529     C**
104800200529     C**   INIT       SUBROUTINE TO INITIALIZE STATIC FIELDS AND ACCESS STANDING
104900200529     C**              DATA CALLED ONCE AT START OF PROGRAM FROM MAIN LINE.
105000200529     C**
105100200529     C**     CALLED BY PROGRAM
105200200529     C**     CALLS     *PSSR
105300200529     C**
105400200529     C**************************************************************************
105500200529     C*                                                    *****************
105600200529     C           INIT      BEGSR                           ** #INIT BEGSR **
105700200529     C*                                                    *****************
105800200529     C**  PREPARE LDA:
105900200529     C*
106000200529     C                     MOVEL*BLANK    DBLOT
106100200529     C                     MOVEL'PM1830'  DBPGM
106200200529     C*
106300200529     C                     MOVE *BLANKS   POOL    1
106400200529     C                     MOVE 'Y'       WWFRST  1
106500200529     C*
106600200529     C**  INITIALIZE INDICATORS:
106700200529     C                     MOVE '0'       *IN
106800200529     C*
106900200529     C**  GET INSTALLATION CONTROL DATA RECORD 1:
107000200529     C************LOVAL    SETLLSDBANKL1                                  CPM003
107100200529     C************         READ SDBANKL1                 81               CPM003
107200200529     C************                                                        CPM003
107300200529     C****IF*RECORD*NOT*FOUND:********************************************CPM003
107400200529     C************IN81     IFEQ '1'                        - B1           CPM003
107500200529     C*                                                                   CPM003
107600200529     C                     CALL 'AOBANKR0'                                CPM003
107700200529     C                     PARM *BLANKS   P@RTCD  7                       CPM003
107800200529     C                     PARM '*FIRST'  P@OPTN  7                       CPM003
107900200529     C           SDBANK    PARM SDBANK    DSFDY                           CPM003
108000200529     C*                                                                   CPM003
108100200529     C           P@RTCD    IFNE *BLANKS                                   CPM003
108200200529     C           *LOCK     IN   LDA                                       CPM003
108300200529     C***********          MOVEL'001'     DBASE            ***************CPM003
108400200529     C***********          MOVEL'SDBANKL1'DBFILE           ** DB ERROR 01 CPM003
108500200529     C                     Z-ADD1         DBASE            ***************CPM003
108600200529     C                     MOVE 'SDBANKPD'DBFILE           ** DB ERROR 01 CPM003
108700200529     C                     MOVEL' NONE '  DBKEY            ***************
108800200529     C                     OUT  LDA                                       CPM003
108900200529     C                     EXSR *PSSR
109000200529     C                     END                             - E1
109100200529     C*
109200200529     C**  GET PORTFOLIO INSTALLATION CONTROL DATA RECORD 1:
109300200529     C************LOVAL    SETLLSDPORTL1                                  CPM003
109400200529     C***********          READ SDPORTL1                 81               CPM003
109500200529     C***********                                                         CPM003
109600200529     C****IF*RECORD*NOT*FOUND:********************************************CPM003
109700200529     C************IN81     IFEQ '1'                        - B1           CPM003
109800200529     C***********          MOVEL'002'     DBASE            ***************CPM003
109900200529     C***********          MOVEL'SDPORTL1'DBFILE           ** DB ERROR 02 CPM003
110000200529     C                     CALL 'AOPORTR0'                                CPM003
110100200529     C                     PARM *BLANKS   P@RTCD                          CPM003
110200200529     C                     PARM '*FIRST'  P@OPTN                          CPM003
110300200529     C           SDPORT    PARM SDPORT    DSFDY                           CPM003
110400200529     C*                                                                   CPM003
110500200529     C           P@RTCD    IFNE *BLANKS                                   CPM003
110600200529     C           *LOCK     IN   LDA                                       CPM003
110700200529     C                     Z-ADD2         DBASE            ***************CPM003
110800200529     C                     MOVE 'SDPORTPD'DBFILE           ** DB ERROR 02 CPM003
110900200529     C                     MOVEL' NONE '  DBKEY            *****************
111000200529     C                     OUT  LDA                                       CPM003
111100200529     C                     EXSR *PSSR
111200200529     C                     END                             - E1
111300200529     C*
111400200529     C                     ENDSR
111500200529     C********************************************************************
111600200529     C** *PSSR  S/R
111700200529     C********************************************************************
111800200529     C           *PSSR     BEGSR
111900200529     C*
112000200529     C                     MOVE '1'       *INU7
112100200529     C                     MOVE '1'       *INU8
112200200529     C                     MOVE '1'       *INLR
112300200529     C                     DUMP
112400200529     C                     OPEN PM1830AU                                  CPM003
112500200529     C                     WRITEHEADAU                                    CPM003
112600200529     C                     WRITEERRORAU                                   CPM003
112700200529     C                     RETRN
112800200529     C*
112900200529     C                     ENDSR
113000200529     C**************************************************************************
113100200529      /COPY ZSRSRC,FFTVCLZ2
113200200529      /COPY ZSRSRC,FFPMCLZ1
113300200529      /COPY ZSRSRC,ZCCYCN
113400200529      /COPY ZSRSRC,ZCCYXR
113500200529     C***/COPY*ZSRSRC,ZFFOLN3                                             CPM003
113600200529     C/COPY PMCPYSRC,ZFFOLN3                                              CPM003
113700200529      /COPY ZSRSRC,FFPRCSZ4
113800200529      /COPY ZSRSRC,FFYTOPZ1                                               CPM003
113900200529     C**************************************************************************
114000200529**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
1141002005290000001
1142002005290000010
1143002005290000100
1144002005290001000
1145002005290010000
1146002005290100000
1147002005291000000
114800200529**  CPY@
114900200529(c) Finastra International Limited 2001
