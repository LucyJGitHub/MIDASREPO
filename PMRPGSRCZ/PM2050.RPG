     H        1                                                           S01486
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Portfolio movements enquiry')                 *
     H***********                                                         S01486
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM2050 - Customer Portfolio Position History Enquiry         *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. 234300             Date 29Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE031             Date 06Dec01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 153127             Date 13Jan99               *
      *                 150624             Date 19Dec98               *
      *                 158429             Date 30Apr99               *
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 130862             Date 18Oct98               *
      *                 CSE005             Date 04Feb97               *
     F*                 CPM005             Date 11Jul96               *
     F*                 CPM004             DATE 03MAR96               *
     F*                 095722             DATE 10NOV95               *
     F*                 094842             DATE 27OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 085817             DATE 13MAR95               *
     F*                 081239             DATE 01FEB95               *
     F*                 S01496             DATE 14NOV94               *
     F*                 S01486             DATE 12JUL94               *
     F*                 059983 DW          DATE 27SEP93               *
     F*                 058881 LJ          DATE 21JUL93               *
     F*                 058880             DATE 09JUL93               *
     F*                 056549 LJ          DATE 11JUN93               *
     F*                 051983 MF          DATE 14JUN93               *
     F*                 S01313             DATE 06NOV92               *
     F*                 036421  MF         DATE 27FEB92               *
     F*                 SA9108             DATE 06NOV91               *
     F*                 S10978             DATE 19APR93               *
     F*                 50593              DATE 05FEB93               *
     F*                 49213              DATE 15JAN93               *
     F*                 37824      DHW     DATE 16OCT91               *
     F*                 R05857             DATE 21APR91               *
     F*                 R05750             DATE 26MAR91               *
     F*                 R0140              DATE 12FEB91               *
     F*                 R0875              DATE 04DEC90               *
     F*                 R01119             DATE 04DEC90               *
     F*                 R10035             DATE 16SEP90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
     F*  CSE031 - Coupon Fixing for Floating Rate Notes.              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  180707 - No Position Settlements generated. Recompile over   *
     F*           changes in /COPY ZNCDZ3.                            *
     F*  153127 - Another problem of division by zero.                *
     F*  150624 - Prevent division by zero error.                     *
     F*  158429 - Recompile over changes to DSPF/PM2050DF.            *
     F*         - Applied fix 132002.                                 *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  CPM005 - Private Banking Phase II                            *
     F*           Focus Group Changes Upgraded to DBA                 *
     F*           PBFG/5 - INSTRUMENT ASSET/LIABILITY SPLIT           *
     F*           PBFG/6 - ADDITIONAL CUSTOMER DETAILS                *
     F*           PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*  CPM004 - Bank Portfolios (RECOMPILED)                        *
     F*  095722 - Should check all portfolios not just ones with      *
     F*           performance                                         *
     F*  094842 - Display FX rates in currency ranking order          *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  085817 - Recompile due to changes in PMLDAPD                 *
     F*  081239 - R10 Private Banking Rework.                         *
     F*  S01496 - Incorporation of Jyske Enhancements (S10978)        *
     F*  S01486 - Portfolio Management Incorporation                  *
     F*  059983 - REMOVE PROCESSING FOR '9998' &'9999' PORTFOLIOS     *
     F*           DISPLAY PRICE CHANGES ON ENQUIRY                    *
     F*  058881 - TRADE PRICE RECALCULATION                           *
     F*           (PRICE X REALLO.) X NOMINAL + CHARGES + COMMISSION  *
     F*  058880 - ALIGN PRICE AND FX RATE AND DISPLAY RATE INDICAT    *
     F*  056549 - VALUE DATE POSITION ENQUIRY WRONG :                 *
     F*           1) NO C/F BALANCE IF TRANSACTION ALREADY DROPPED    *
     F*           2) C/F DATE WRONG IF FORWARD VALUE DATE IS A HOLIDAY*
     F*  051983 - ERROR MESSAGE IF NO DETAILS FOR SUBFILE VALUATION   *
     F*           PORTFOLIO SUMMARY (SEE ALSO PM2050DD)               *
     F*  S01313 - RECOMPILED DUE TO PORTFOLIO PERFORMANCE             *
     F*  036421 - DUMP IF 'SPMD' *BLANK (TRY TO DIVIDE BY 0).         *
     F*  50593  - RECOMPILED OVER NEW VERSION OF SR/ZAVPRC            *
     F*  49213  - RECOMPILED OVER NEW VERSION OF SR/ZFXAVP            *
     F*  37824  - PROGRAM SHOULD NOT END IN ERROR IF NO               *
     F*           TRANSACTIONS FOUND FOR POSITION. THIS MAY OCCUR     *
     F*           WHEN ALL TRANSACTIONS TRANSFERRED TO ANOTHER        *
     F*           PORTFOLIO VIA PORTFOLIO TRANSFER FUNCTION           *
     F*           ONLY SELECT TRANSACTIONS INPUT BEFORE TODAY         *
     F*  R05857 - INCOMPLETE TRADES AND TRADES ONLY COMPLETED         *
     F*           TODAY SHOULD NOT BE SHOWN IN ENQUIRY. ALSO          *
     F*           ON RETURN FROM TRADE DETAILS ENQUIRY TRADE          *
     F*           SELECTION PROMPT SHOULD NOT BE PROTECTED            *
     F*  R05750 - FX RATE SHOWN SHOULD BE NOMINAL TO PORTFOLIO        *
     F*  R0140  - DO NOT SHOW THE DELETED TRADE                       *
     F*  R0875  - CORRECT DISPLAY OF '9998' AND '9999' PORTFOLIOS     *
     F*  R01119 - ONLY DISPLAY AVERAGE PRICES TO FIVE DECIMALS TO     *
     F*           AVOID ROUNDING ERRORS                               *
     F*  R10035 - PROTECT INPUT OPTION FOR DEPOT MOVEMENTS AND        *
     F*           PRICE CHANGES                                       *
     F*                                                               *
     F*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       02         CHAIN FAIL ON SECTY MASTER
     F*       03         CHAIN FAIL ON PORTMV DETAIL / END OF PORTMV FILE
     F********04*********CHAIN FAIL ON SDCURRL0************************** S01486
     F*       31         RECORD READ FROM PORTMV
     F*       32         RECORD READ FROM DPTMVD (WI)
     F*       33         RECORD READ FROM DPTMVT (WO)
     F*       58         REQUESTED PORTFOLIO IS '9998' OR '9999'          R0875
     F*       61         CLEAR SUBFILEIF ON, DISPLAY SUBFILE IF OFF
     F*       62         SUBFILE END
     F*       86         CURRENT TRANSACTION GENERATED BY EARLY REDEMP.   S01496
     F*       U7         DATABASE ERROR (JOB SWITCH).
     F*       U8         DATABASE ERROR (JOB SWITCH).
     F*
     F***PM2050DDCF**E*                   WORKSTN                         S01486
     FPM2050DFCF  E                    WORKSTN                            S01486
     F                                        RRN   KSFILE PM2050S1
     FSECTY   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F***PMPORTL1IF**E           K        DISK         KINFSR *PSSR 094842095722
     FPMPORTLLIF  E           K        DISK         KINFSR *PSSR          095722
     F***PORTMV**IF**E*          K        DISK                            S01486
     FPMTRMVL1IF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F***PORTMT**I***E*          K        DISK                            S01486
     FPMTRMVL0IF  E           K        DISK                               S01486
     F            TRADSDF                           KRENAMETRADSDTF
     F            DPTMVDF                           KRENAMEDPTMVDTF
     F            DPTMVTF                           KRENAMEDPTMVTTF
     F            HSTTRDF                           KRENAMEHSTTRDTF
     F            CAPRHDF                           KRENAMECAPRHDTF       059983
     F                                              KINFSR *PSSR
     F*PORTV2**IF  E           K        DISK                        R0875 059983
     F****        TRADSDF                           KRENAMETRADSD2  R0875 059983
     F****        DPTMVDF                           KRENAMEDPTMVD2  R0875 059983
     F****        DPTMVTF                           KRENAMEDPTMVT2  R0875 059983
     F****        HSTTRDF                           KRENAMEHSTTRD2  R0875 059983
     F****                                          KINFSR *PSSR    R0875 059983
     F*PORTT2**IF  E           K        DISK                        R0875 059983
     F****        TRADSDF                           KRENAMETRADSDT2 R0875 059983
     F****        DPTMVDF                           KRENAMEDPTMVDT2 R0875 059983
     F****        DPTMVTF                           KRENAMEDPTMVTT2 R0875 059983
     F****        HSTTRDF                           KRENAMEHSTTRDT2 R0875 059983
     F****                                          KINFSR *PSSR    R0875 059983
     F*CAPRALT IF  E           K        DISK                              R0875
     F************                                   KINFSR *PSSR         R0875
     F*CAPRALV IF  E           K        DISK                              R0875
     F************                                   KINFSR *PSSR         R0875
     F************ CAPRHDF                           KRENAMECAPRHDXF      R0875
     F***SDCURRL0IF**E*          K        DISK                            S01486
     F************                                  KINFSR *PSSR          S01486
     FPMAPOSLLIF  E           K        DISK
     F                                              KINFSR *PSSR
     FSEERALL2IF  E           K        DISK                           UC  S01496
     F                                              KINFSR *PSSR          S01496
     FSEERALL5IF  E           K        DISK                           UC  S01496
     F                                              KINFSR *PSSR          S01496
     F***SDSTRDL0IF**E*          K        DISK                     058881 S01486
     F***********                                   KINFSR *PSSR   058881 S01486
     F***TABSE***IF**E*          K        DISK                     058881 S01486
     F*********** TABLETAF                          KIGNORE        058881 S01486
     F*********** TABTB36F                          KIGNORE        058881 S01486
     F*********** TABTB40F                          KIGNORE        058881 S01486
     F*********** TABTE10F                          KIGNORE        058881 S01486
     F*********** TABTE20F                          KIGNORE        058881 S01486
     F*********** TABTG10F                          KIGNORE        058881 S01486
     F*********** TABTG20F                          KIGNORE        058881 S01486
     F*********** TABLETHF                          KIGNORE        058881 S01486
     F*********** TABLETJF                          KIGNORE        058881 S01486
     F*********** TABLETKF                          KIGNORE        058881 S01486
     F*********** TABLETLF                          KIGNORE        058881 S01486
     F*********** TABLETNF                          KIGNORE        058881 S01486
     F*********** TABLETPF                          KIGNORE        058881 S01486
     F*********** TABLETRF                          KIGNORE        058881 S01486
     F*********** TABLETXF                          KIGNORE        058881 S01486
     F*********** TABLET2F                          KIGNORE        058881 S01486
     F*********** TABLET3F                          KIGNORE        058881 S01486
     F*********** TABLET5F                          KIGNORE        058881 S01486
     F***********                                   KINFSR *PSSR   058881 S01486
     E*********************************************************************
     E*  TABLES AND ARRAYS
     E*    ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E*****ARRAY*TO*ENABLE*ATTENTION*KEY********************************* S01486
     E***********         ATN     1   1 22                                S01486
     E*
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,ZSEDITZ1
      /COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZDAYSZ1                                                058881
     E/COPY ZSRSRC,ZNCDZ1                                                 058881
     E/EJECT
     I*
     ITRADSDF     31
     I              TOED                            WWORED                37824
     IDPTMVDF     32
     I              ORED                            WWORED                37824
     IDPTMVTF     33
     I              ORED                            WWORED                37824
     IHSTTRDF     34
     I              TOED                            WWORED                37824
     ICAPRHDF     36                                                      059983
     ITRADSDTF    31
     I              TOED                            WWORED                37824
     IDPTMVDTF    32
     I              ORED                            WWORED                37824
     IDPTMVTTF    33
     I              ORED                            WWORED                37824
     IHSTTRDTF    34
     I              TOED                            WWORED                37824
     ICAPRHDTF    36                                                      059983
     I*TRADSD2***  31                                               R0875 059983
     I****          TOED                            WWORED          37824 059983
     I*DPTMVD2***  32                                               R0875 059983
     I****          ORED                            WWORED          37824 059983
     I*DPTMVT2***  33                                               R0875 059983
     I****          ORED                            WWORED          37824 059983
     I*HSTTRD2***  34                                               R0875 059983
     I****          TOED                            WWORED          37824 059983
     I*TRADSDT2*** 31                                               R0875 059983
     I****          TOED                            WWORED          37824 059983
     I*DPTMVDT2*** 32                                               R0875 059983
     I****          ORED                            WWORED          37824 059983
     I*DPTMVTT2*** 33                                               R0875 059983
     I****          ORED                            WWORED          37824 059983
     I*HSTTRDT2*** 34                                               R0875 059983
     I****          TOED                            WWORED          37824 059983
     I*
     I*****GROUP*DATA*AREA********************************************    S01486
     I***WWGDA*****E*DSPMGRDAPP                                           S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I** DUMMY RECORD FORMATS FOR ACCESS TO CURRENCIES DETAILS            S01486
     ISDPLCS    E DSSDPLCSPD                                              094842
     I** Portfolio Management Customer details                            094842
     ISDSTRD    E DSSDSTRDPD                                              S01486
     I** Securities Trading ICD                                           S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I** Bank details                                                     S01486
     ISDGELR    E DSSDGELRPD                                              S01486
     I** General ledger details                                           S01486
     ISCSARD    E DSSCSARDPD                                              S01496
     I** Switchable features details                                      S01496
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short DS for access programs                                    S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I* Second DS For Access Programs, Long Data Structure                S01486
     IRUNDAT      DS                                                      S01486
     I                                       13  13 @MBIN                 S01486
     I*
     I***WWLDA     E DSPMLDAPP                                            S01486
     IWWLDA     E DSPMLDAPD                                               S01486
     I*
     I*    PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     IPSDS       SDS
     I                                      244 253 WSID
     I                                      254 263 USID
     I**
     I** DATA STRUCTURE FOR SUBROUTINE ZSEDIT
     I**
     I            DS
     I                                        1  150ZFLD15
     I                                        1  15 ZFLDA
      /COPY ZSRSRC,ZSEDITZ2
      /COPY ZSRSRC,ZNCDZ2                                                 058881
     I*
     I*    DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I            DS                                                      56549
     I                                        1 256 DLDATE                56549
     I                                       29  330DALXTR                56549
     I*    L.D.A. DATA AREA TO HOLD INFORMATION ON DATABASE ERROR.
     I           UDS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I** DATA STRUCTURE FOR SUBFILE
     I** MOVEMENT LINE
     I            DS
     I*****************                       1  70 WWMOVT                R0875
     I                                        1  74 WWMOVT                R0875
     I                                        5  11 WWDAT1
     I                                       13  18 WWREF
     I                                       20  22 WWTYPE
     I                                       24  39 WWNOM1
     I*****************                      41  56 WWAVR1                R01119
     I*****************                      57  70 WWAVX1                R01119
     I*****************                      42  54 WWAVR1                R0875
     I*****************                      60  70 WWAVX1                R0875
     I*****************                      40  51 WWAVR1           R0875058880
     I                                       42  53 WWAVR1                058880
     I                                       56  66 WWAVX1                R0875
     I                                       68  68 WWFXMD                R0875
     I                                       70  74 WWPTFR                R0875
     I** BROUGHT FORWARD AND CARRIED FORWARD LINES, POSITION LINE
     I            DS
     I                                        1  70 WWPOST
     I                                        1   3 WWTITL
     I                                        5  11 WWDAT2
     I                                       24  39 WWNOM2
     I**************                         41  56 WWAVR2                R01119
     I**************                         57  70 WWAVX2                R01119
     I                                       42  53 WWAVR2                R01119
     I**************                         60  70 WWAVX2          R01119058880
     I                                       56  66 WWAVX2                058880
     I                                       68  68 WWFXM2                058880
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * #INIT    - INITIAL PROCESSING                                    *
      * SECACS   - ACCESS SECURITY DETAILS                               *
      * ACCESS   - ACCESS MOVEMENTS                                      *
      * LOADSF   - LOAD SUBFILE                                          *
      * ZDATE2   - CONVERSION ROUTINE (DAY NUMBER TO DATE)               *
      * ZSEDIT   - EDITION SUBROUTINE TO NUMERIC FIELDS                  *
      * *PSSR    - PROCESS DATABASE ERROR                                *
      * P001     - CHANGE TRANSACTIONS TYPES                             *S01496
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      * PM2060   - TRADE DETAILS ENQUIRY                                 *
      **PMC1000**-*UPDATE*GROUP*JOB*DATA*AREA*****************************S01486
      **PMC1020**-*TERMINATE*GROUP*JOB*IF*DATABASE*ERROR******************S01486
      **PMC1010**-*READ*GROUP*JOB*DATA*AREA*******************************S01486
      **QCMDEXC**-*EXEC*AS/400*COMMAND************************************S01486
      * PMC1003  - TO RETRIEVE DATA AREA *LDA                            *S01486
      * PMC1001  - TO UPDATE DATA AREA *LDA                              *S01486
      * DBERRCTL - DATABASE ERROR PROCESSING                             *S01486
      *                                                                  *
      ********************************************************************
     C/EJECT
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C*   Initial processing.
     C                     EXSR #INIT
     C*
     C*   Access Security details
     C                     EXSR SECACS
     C*
     C*   Movement access processing
     C                     EXSR ACCESS
     C*
     C*   Termination processing
     C                     RETRN
     C*
     C*****************************************************************
     C/EJECT
      ********************************************************************
      *                                                                  *
      * SECACS   - ACCESS SECURITY DETAILS                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - PROCESS DATABASE ERROR                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWSESN   - SECURITY SHORTNAME PARAMETER PASSED TO PROGRAM        *
      *                                                                  *
      ********************************************************************
     C           SECACS    BEGSR
     C*
     C*   ACCESS SECURITY DETAILS
     C*
     C           WWSESN    CHAINSECTY                02
     C           *IN02     IFEQ '1'
     C                     Z-ADD2         QMERRN
     C***********          MOVEL'SECTY'   QMFILE                          S01486
     C                     MOVE 'SECTY'   QMFILE                          S01486
     C                     MOVELWWSESN    QMKEY
     C                     EXSR *PSSR
     C                     END
     C*
     C****ACCESS*NOMINAL*CURRENCY*DETAILS******************************** S01486
     C*   READ CURRENCY CODES DETAILS VIA ACCESS PROGRAM          R10036  S01486
     C*
     C***********NMCY      CHAINSDCURRL0             04                   S01486
     C************IN04     IFEQ '1'                                       S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM NMCY      @K101   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C                     Z-ADD3         QMERRN
     C***********          MOVEL'SDCURRL0'QMFILE                          S01486
     C                     MOVE 'SDCURRL0'QMFILE                          S01486
     C                     MOVELNMCY      QMKEY
     C                     EXSR *PSSR
     C                     END
     C                     Z-ADDA6RKSQ    WWRKNM                          094842
     C           *LIKE     DEFN A6RKSQ    WWRKNM                          094842
     C           *LIKE     DEFN A6RKSQ    WWRKSQ                          094842
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * ACCESS   - ACCESS MOVEMENTS                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - PROCESS DATABASE ERROR                                *
      * LOADSF   - LOAD SUBFILE                                          *
      * PM2060   - TRADE DETAILS ENQUIRY                                 *
      **PMC1000**-*UPDATE*GROUP*JOB*DATA*AREA*****************************S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWSESN   - SECURITY SHORTNAME PARAMETER PASSED TO PROGRAM        *
      * WWRF1P   - FIRST PAGE MOVEMENT REFERENCE                         *
      * WWDT1P   - FIRST PAGE MOVEMENT DATE                              *
      * WWRFSV   - CURRENT PAGE MOVEMENT REFERENCE                       *
      * WWDTSV   - CURRENT PAGE MOVEMENT DATE                            *
      * WWRETC   - RETURN CODE FROM PM2060                               *
      **WWPARM***-*GROUP*JOB*DATA*STRUCTURE*******************************S01486
      *                                                                  *
      ********************************************************************
     C           ACCESS    BEGSR
     C*
     C*    LOAD SUBFILE
     C                     EXSR LOADSF
     C*
     C*    INITIALISE HEADER DISPLAY ZONES
     C*
     C                     MOVELQMCNUM    DDCNUM           CUSTOMER NUMBER
     C                     MOVELQMCRNM    DDCRNM           CUSTOMER NAME
     C                     MOVELQMPTF2    DDPTFR           PORTFOLIO REF
     C                     MOVELQMPTFN    DDPTFN              "      NARR
     C                     MOVELWWSESN    DDSECU           SECURITY SHORTNAME
     C                     MOVELSFN1      DDSFN1           SECURITY FULL NAME -1
     C                     MOVELNMCY      DDNMCY           NOMINAL CURRENCY
     C*
     C*   LOOP UNTIL QUIT REQUESTED
     C*
     C************INKC     DOUEQ'1'                        B1             081239
     C************INKL     OREQ '1'                                       081239
     C************INKV     OREQ '1'                                 S01486081239
     C           QMENQT    DOUEQ'Y'                                       081239
     C           QMENQT    OREQ 'C'                                       081239
     C           QMENQT    OREQ 'P'                                       081239
     C           QMENQT    OREQ 'D'                                       081239
     C           *INKL     OREQ '1'                                       081239
     C           RRN       COMP 1                    60                   R0140
     C*
     C*   DISPLAY DETAILS SCREEN
     C                     WRITEPM2050F1
     C                     WRITEPM2050F2
     C* IF NO DETAILS READ, INIT SUBFILE TO PROCESS IT WITH NO DETAILS    051983
     C*                                                                   051983
     C           RRN       IFLE 1                                         051983
     C                     SETON                     62                   051983
     C                     MOVE '1'       *IN59                           058880
     C                     MOVE '1'       *IN60                           058880
     C                     MOVE *BLANKS   DDDATA                          058880
     C                     WRITEPM2050S1                                  058880
     C                     ADD  1         RRN                             058880
     C                     MOVE '0'       *IN62                           058880
     C                     ELSE                                           051983
     C                     SETOF                     62                   051983
     C                     END                                            051983
     C*                                                                   051983
     C                     EXFMTPM2050C1
     C*                                                                   081239
     C** If F3  pressed, exit program                                     081239
     C*                                                                   081239
     C           *INKC     IFEQ '1'                                       081239
     C                     MOVE 'Y'       QMENQT                          081239
     C                     CALL 'PMC1001'                                 081239
     C                     PARM           WWLDA                           081239
     C                     END                                            081239
     C**********                                                    081239CPM005
     C***If*F22 pressed, access Enquiry selection screen            081239CPM005
     C**********                                                    081239CPM005
     C********** *INKW     IFEQ '1'                                 081239CPM005
     C**********           CALL 'PMC0610'                           081239CPM005
     C**********                                                    081239CPM005
     C***Retrieve *LDA values                                       081239CPM005
     C**********                                                    081239CPM005
     C**********           CALL 'PMC1003'                           081239CPM005
     C**********           PARM           WWLDA                     081239CPM005
     C**********           END                                      081239CPM005
     C*                                                                   37824
     C** IF F9 TAKEN RELOAD SUBFILE WITH TRADE / VALUE DATE POSITIONS     37824
     C** AS APPROPRIATE                                                   37824
     C           *INKI     IFEQ '1'                        B2             37824
     C*                                                                   37824
     C           WWTVPS    IFEQ 'T'                        B3             37824
     C                     MOVE 'V'       WWTVPS  1                       37824
     C                     MOVE '0'       *IN63                           37824
     C                     ELSE                            X3             37824
     C                     MOVE 'T'       WWTVPS                          37824
     C                     MOVE '1'       *IN63                           37824
     C                     END                             E3             37824
     C*                                                                   37824
     C                     EXSR LOADSF                                    37824
     C                     END                             E2             37824
     C*
     C*    ACCESS TRADE DETAILS IF REQUESTED
     C           RRN       IFGT 1                          B2             37824
     C*
     C                     READCPM2050S1                 11
     C           *IN11     IFEQ '0'                        B3
     C*                                                                   R10035
     C** PROTECT SELECTION OPTION                                         R10035
     C                     MOVELDDDATA    WWMOVT                          R05857
     C           WWTYPE    IFEQ 'PUR'                      B4             R10035
     C           WWTYPE    OREQ 'SAL'                                     R10035
     C           S01496    OREQ 'Y'                                       S01496
     C           WWTYPE    ANDEQ'TRI'                                     S01496
     C           S01496    OREQ 'Y'                                       S01496
     C           WWTYPE    ANDEQ'TRO'                                     S01496
     C                     MOVE '0'       *IN59                           R10035
     C                     ELSE                            X4             R10035
     C                     MOVE '1'       *IN59                           R10035
     C                     END                             E4             R10035
     C                     MOVE *BLANKS   DDACTN                          R05857
     C*                                                                   R10035
     C                     UPDATPM2050S1
     C                     MOVE '0'       *IN59                           R10035
     C                     WRITEPM2050C1
     C********             MOVELDDDATA    WWMOVT                          R05857
     C           WWTYPE    IFNE 'WI'                       B4
     C           WWTYPE    ANDNE'WO'
     C           S01496    ANDNE'Y'                                       S01496
     C*                                                                   S01496
     C           S01496    OREQ 'Y'                                       S01496
     C           WWTYPE    ANDNE'WI'                                      S01496
     C           WWTYPE    ANDNE'WO'                                      S01496
     C           WWTYPE    ANDNE'DRI'                                     S01496
     C           WWTYPE    ANDNE'DRO'                                     S01496
     C                     CALL 'PM2060'
     C                     PARM           WWRETC  1
     C                     PARM           WWREF
     C                     CALL 'PMC1003'                                 081239
     C                     PARM           WWLDA                           081239
     C***********WWRETC    IFEQ '1'                        B5             081239
     C***********WWRETC    OREQ '9'                                       081239
     C***********          MOVE '1'       *INKC                           081239
     C***********          END                             E5             081239
     C                     END                             E4
     C                     END                             E3
     C                     END                             E2
     C                     END                             E1
     C***********                                                         081239
     C****EXIT*PROGRAM****************************************************081239
     C************INKC     IFEQ '1'                        B1             081239
     C***********          MOVE 'Y'       QMENQT                          081239
     C***********          CALL 'PMC1002'                                 S01486
     C***********          PARM           WWGDA                           S01486
     C***********          CALL 'PMC1001'                           S01486081239
     C***********          PARM           WWLDA                     S01486081239
     C***********          END                             E1             081239
     C*
     C                     ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * LOASDF   - LOAD SUBFILE                                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZDATE2   - CONVERSION ROUTINE (DAY NUMBER TO DATE)               *
      * ZSEDIT   - EDITION SUBROUTINE TO NUMERIC FIELDS                  *
      * *PSSR    - PROCESS DATABASE ERROR                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * ACCESS   - ACCESS MOVEMENTS                                      *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWRFSV   - CURRENT PAGE MOVEMENT REFERENCE                       *
      * WWDTSV   - CURRENT PAGE MOVEMENT DATE                            *
      *                                                                  *
      ********************************************************************
     C           LOADSF    BEGSR
     C*
     C*    CLEAR SUBFILE
     C                     MOVE '1'       *IN61
     C                     WRITEPM2050C1
     C                     MOVE '0'       *IN61
     C                     Z-ADD1         RRN     30
     C*
     C*   POSITION POINTER TO START OF FILE
     C*
     C                     Z-ADD0         LASTD   50
     C                     Z-ADD0         WWDATE  50
     C*
     C           WWTVPS    IFEQ 'T'                        B1
     C*                                                                   R0875
     C****       QMPTF1    IFEQ '9998'                     B2       R0875 059983
     C****       QMPTF1    OREQ '9999'                              R0875 059983
     C****                 MOVE '1'       *IN58                     R0875 059983
     C****       MOVK2Y    SETLLPORTT2                              R0875 059983
     C****                 ELSE                            X2       R0875 059983
     C****                 ELSE                            X2       R0875 059983
     C***********MOVKEY    SETLLPORTMT                                    S01486
     C           MOVKEY    SETLLPMTRMVL0                                  S01486
     C****                 END                             E2       R0875 059983
     C*                                                                   R0875
     C                     ELSE                            X1
     C****                                                          R0875 059983
     C****       QMPTF1    IFEQ '9998'                     B2       R0875 059983
     C****       QMPTF1    OREQ '9999'                              R0875 059983
     C****                 MOVE '1'       *IN58                     R0875 059983
     C****       MOVK2Y    SETLLPORTV2                              R0875 059983
     C****                 ELSE                            X2       R0875 059983
     C***********MOVKEY    SETLLPORTMV                                    S01486
     C           MOVKEY    SETLLPMTRMVL1                                  S01486
     C****                 END                             E2       R0875 059983
     C*                                                                   R0875
     C                     END                             E1
     C*
     C*   READ FROM PORTFOLIO MOVEMENTS FILE
     C*
     C                     EXSR READPM
     C**********                                                    R05857CPM005
     C***READ*RECORD UNTIL A TRADE COMPLETED BEFORE TODAY IS FOUND  R05857CPM005
     C********** TINC      DOWEQ'I'                                 R05857CPM005
     C********** TDMC      OREQ QMRDNB                              R05857CPM005
     C**********           EXSR READPM                              R05857CPM005
     C**********           END                                      R05857CPM005
     C*                                                                   R0875
     C** DON'T DISPLAY MOVEMENTS IF PORTFOLIO IS '9998' OR '9999'         R0875
     C           QMPTF1    IFNE '9998'                     B1             R0875
     C           QMPTF1    ANDNE'9999'                                    R0875
     C                     MOVEL'B/F'     WWTITL
     C                     END                             E1             R0875
     C*
     C***DO*WHILE*NOT*EOF*ON*PORTMT/PORTMV******************************* S01486
     C*  DO WHILE NOT EOF ON PMTRMVL0/PMTRMVL1                            S01486
     C*
     C           *IN03     DOWEQ'0'
     C*
     C*
     C*  IF A TRADE HAS BEEN READ,FORMAT THE DETAILS FOR SUBFILE OUTPUT
     C*
     C           *IN31     IFEQ '1'
     C           *IN34     OREQ '1'
     C*                                                                   R05857
     C           TINC      IFEQ 'C'                                       R05857
     C********** TDMC      ANDNEQMRDNB                              R05857CPM005
     C                     EXSR FMTTRD
     C                     ELSE
     C                     GOTO NEXTRD
     C                     END                                            R05857
     C*                                                                   R05857
     C                     ELSE
     C*
     C*  IF A DEPOT MOVEMENT HAS BEEN READ,FORMAT THE DETAILS FOR SUBFILE OUTPUT
     C*
     C           *IN32     IFEQ '1'                                       059983
     C           *IN33     OREQ '1'                                       059983
     C                     EXSR FMTDPM
     C*                                                                   059983
     C** OTHERWISE FORMAT A PRICE CHANGE RECORD                           059983
     C                     ELSE                                           059983
     C                     EXSR FMTPRC                                    059983
     C                     END                                            059983
     C                     END
     C*
     C*   IF DATE HAS CHANGED GET PREVIOUS POSITION & WRITE TO SUBFILE
     C*   (ONLY IF LAST DATE PROCESSED WAS LESS THAN RUN DATE)
     C*
     C           WWDATE    IFNE LASTD
     C***********WWDATE    ANDLTQMRDNB                                    R05750
     C****       *IN34     ANDEQ'0'
     C*                                                                   R0875
     C** DON'T DISPLAY MOVEMENTS IF PORTFOLIO IS '9998' OR '9999'         R0875
     C           QMPTF1    ANDNE'9998'                                    R0875
     C           QMPTF1    ANDNE'9999'                                    R0875
     C           LASTD     IFLT QMRDNB                                    R05750
     C           WWDATE    ANDGEQMRDNB                                    R05750
     C           WWDATE    ORLT QMRDNB                                    R05750
     C                     MOVE 'N'       WWCFWD  1                       37824
     C                     EXSR POSWRT
     C                     Z-ADDWWDATE    LASTD
     C                     MOVEL'C/F'     WWTITL                          R05750
     C                     END                                            R05750
     C                     END                                            R05750
     C*                                                                   S01496
     C**  If Jyske Enhancements feature is on                             S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C                     EXSR P001                                      S01496
     C                     END                                            S01496
     C*
     C                     MOVE ' '       DDACTN           ACTION
     C                     MOVELWWMOVT    DDDATA
     C*
     C*                                                                   R10035
     C** PROTECT SELECTION OPTION                                         R10035
     C           WWTYPE    IFEQ 'PUR'                                     R10035
     C           WWTYPE    OREQ 'SAL'                                     R10035
     C                     MOVE '0'       *IN59                           R10035
     C                     ELSE                                           R10035
     C                     MOVE '1'       *IN59                           R10035
     C                     END                                            R10035
     C           RECI      IFNE '*'                                       R0140
     C                     WRITEPM2050S1
     C                     ADD  1         RRN
     C                     END                                            R0140
     C                     MOVE '0'       *IN59                           R10035
     C*
     C*   READ FROM PORTFOLIO MOVEMENTS FILE
     C*
     C           NEXTRD    TAG                                            R05857
     C                     EXSR READPM
     C*
     C                     END                             ENDDOW
     C*
     C* IF NO RECORDS READ SET C/F DATE TO RUN DATE,OTHERWISE LAST POSITION DATE
     C* ( DATE USED BY POSWRT )
     C*
     C           LASTD     IFEQ 0
     C                     Z-ADDQMRDNB    WWDATE
     C                     ELSE
     C                     Z-ADD*HIVAL    WWDATE
     C                     END
     C*
     C*   IF LAST DATE PROCESSED WAS LESS THAN RUN DATE
     C*   WRITE C/F POSITION TO SUBFILE
     C*
     C           LASTD     IFLT QMRDNB
     C           WWDTSV    ANDLTQMRDNB                                    R05750
     C***        WWDTSV    ANDGT0                                  R05750 056549
     C*                                                                   R0875
     C** DON'T DISPLAY MOVEMENTS IF PORTFOLIO IS '9998' OR '9999'         R0875
     C           QMPTF1    ANDNE'9998'                                    R0875
     C           QMPTF1    ANDNE'9999'                                    R0875
     C                     MOVEL'C/F'     WWTITL
     C                     MOVE 'Y'       WWCFWD  1                       37824
     C                     EXSR POSWRT
     C                     END
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * READPM   - READ FROM PORTFOLIO MOVEMENTS FILE                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * LOASDF   - LOAD SUBFILE                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           READPM    BEGSR
     C                     SETOF                     313233
     C                     SETOF                     34
     C                     SETOF                     36                   CPM005
     C                     MOVE *BLANKS   TINC                            R05857
     C                     Z-ADD0         TDMC                            R05857
     C                     MOVE 'N'       WWFND   1                       37824
     C*                                                                   37824
     C** ONLY SELECT RECORDS INPUT BEFORE TODAY FOR DISPLAY               37824
     C           WWFND     DOUEQ'Y'                        B1             37824
     C*
     C* ACCESS TRADE DATE MOVEMENTS
     C*
     C           WWTVPS    IFEQ 'T'                        B2
     C****                                                          R0875 059983
     C****       QMPTF1    IFEQ '9998'                              R0875 059983
     C****       QMPTF1    OREQ '9999'                              R0875 059983
     C****       MOVK2P    READEPORTT2                   03         R0875 059983
     C****                 ELSE                                     R0875 059983
     C***********MOVKYP    READEPORTMT                   03               S01486
     C           MOVKYP    READEPMTRMVL0                 03               S01486
     C****                 END                                      R0875 059983
     C*                                                                   R0875
     C                     ELSE                            X2
     C*
     C* ACCESS VALUE DATE MOVEMENTS
     C*
     C****       QMPTF1    IFEQ '9998'                              R0875 059983
     C****       QMPTF1    OREQ '9999'                              R0875 059983
     C****       MOVK2P    READEPORTV2                   03         R0875 059983
     C****                 ELSE                                     R0875 059983
     C***********MOVKYP    READEPORTMV                   03               S01486
     C           MOVKYP    READEPMTRMVL1                 03               S01486
     C****                 END                                      R0875 059983
     C*                                                                   R0875
     C                     END                             E2
     C*                                                                   37824
     C********** WWORED    IFLT QMRDNB                               37824CPM005
     C********** *IN03     OREQ '1'                                  37824CPM005
     C           TINC      IFEQ 'C'                                       CPM005
     C           *IN31     ANDEQ'1'                                       CPM005
     C           TDMC      ANDLTQMRDNB                                    CPM005
     C           TINC      OREQ 'C'                                       CPM005
     C           *IN34     ANDEQ'1'                                       CPM005
     C           TDMC      ANDLTQMRDNB                                    CPM005
     C           *IN32     OREQ '1'                                       CPM005
     C           *IN33     OREQ '1'                                       CPM005
     C           *IN36     OREQ '1'                                       CPM005
     C           *IN03     OREQ '1'                                       CPM005
     C                     MOVE 'Y'       WWFND                           37824
     C                     END                                            37824
     C*                                                                   37824
     C                     END                             E1             37824
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * FMTTRD   - FORMAT TRADE DETAILS FOR OUTPUT TO SUBFILE            *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZDATE2   - CONVERSION ROUTINE (DAY NUMBER TO DATE)               *
      * ZSEDIT   - EDITION SUBROUTINE TO NUMERIC FIELDS                  *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * LOASDF   - LOAD SUBFILE                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           FMTTRD    BEGSR
     C*
     C*   IF TRADE DATE DETAILS REQUIRED CONVERT TRADE DATE
     C*
     C           WWTVPS    IFEQ 'T'
     C                     Z-ADDTDDT      WWDATE  50
     C                     Z-ADDTDDT      WWDTSV  50                      R05750
     C                     Z-ADDTDDT      ZDAYNO           TRADE DATE
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WWDAT1
     C*
     C*   IF VALUE DATE DETAILS REQUIRED CONVERT VALUE DATE
     C*
     C                     ELSE
     C                     Z-ADDTDVD      WWDATE
     C                     Z-ADDTDVD      WWDTSV                          R05750
     C                     Z-ADDTDVD      ZDAYNO           VALUE DATE
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WWDAT1
     C                     END
     C*
     C*   TRADE REFERENCE
     C*
     C                     MOVELTDRF      WWREF
     C*
     C*   TRADE TYPE
     C*
     C           TDTP      IFEQ 'TP'
     C                     MOVEL'SAL'     WWTYPE
     C                     ELSE
     C                     MOVEL'PUR'     WWTYPE
     C                     END
     C*
     C*   EDIT NOMINAL
     C*
     C                     MOVE *BLANK    ZFLD15
     C                     MOVE NOML      ZFLD15           NOMINAL AMOUNT
     C                     Z-ADDNMDP      ZDECS
     C                     MOVEL'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
     C*
     C*   EDIT TRADE PRICE
     C*
     C                     EXSR APNUM                                     58881
     C*                                                                   58881
     C                     MOVE *BLANK    ZFLD15
     C****************     MOVE PRIC      ZFLD15           % PRICE        R01119
     C****************     Z-ADD8         ZDECS                           R01119
     C***                  Z-ADDPRIC      WWORK5 154H              R01119 058881
     C                     Z-ADDZAVPR     WWORK5 154H                     058881
     C                     MOVE WWORK5    ZFLD15                          R01119
     C                     Z-ADD4         ZDECS                           R01119
     C                     MOVEL' '       ZECODE
     C                     EXSR ZSEDIT
     C           SPBS      IFEQ 'P'
     C                     MOVE '%'       ZOUT21
     C                     END
     C                     MOVE ZOUT21    WWAVR1
     C*
     C****ACCESS*FX*RATE*OF*TRADE                                         R0875
     C*
     C******************** MOVEL'1'       WWCSSE                          R0875
     C********** WWTVPS ** IFEQ 'T'                                       R0875
     C********** CAPRLK ** CHAINCAPRALT              71                   R0875
     C** 71 ************** Z-ADD0         CFXR                            R0875
     C******************** ELSE                                           R0875
     C********** CAPRLK ** CHAINCAPRALV              71                   R0875
     C** 71 ************** Z-ADD0         CFXR                            R0875
     C******************** END                                            R0875
     C*
     C*   EDIT TRADE FX RATE
     C*
     C********** CFXR **** IFNE 0                                         R0875
     C***********SPXR      IFNE 0                                         R05750
     C                     MOVE *BLANK    ZFLD15
     C****************     MOVE CFXR      ZFLD15                          R01119
     C****************     Z-ADD8         ZDECS                           R01119
     C                     Z-ADD4         ZDECS                           R01119
     C******************** Z-ADDCFXR      WWORK5                   R01119 R0875
     C****************     Z-ADDSPXR      WWORK5                          R05750
     C*                                                                   R05750
     C** ENSURE EXCHANGE RATE NOMINAL TO SETTLEMENT CURRENCY IS A         R05750
     C** MULTIPLY RATE                                                    R05750
     C           TMDI      IFEQ 'M'                                       R05750
     C                     Z-ADDTDER      WWTDER 138                      R05750
     C                     ELSE                                           R05750
     C           1         DIV  TDER      WWTDER                          R05750
     C                     END                                            R05750
     C*                                                                   R05750
     C** ENSURE EXCHANGE RATE PORTFOLIO TO SETTLEMENT CURRENCY IS A       R05750
     C** MULTIPLY RATE                                                    R05750
     C           SPMD      IFEQ 'M'                                       R05750
     C           SPMD      OREQ ' '                                       036421
     C           SPXR      OREQ 0                                         153127
     C                     Z-ADDSPXR      WWSPXR 138                      R05750
     C                     ELSE                                           R05750
     C           1         DIV  SPXR      WWSPXR                          R05750
     C                     END                                            R05750
     C*                                                                   R05750
     C** FX RATE TO BE OUTPUT IS PRODUCT OF FX RATE BETWEEN NOMINAL       R05750
     C** CURRENCY AND SETTLEMENT CURRENCY AND FX RATE SETTLEMENT          R05750
     C** CURRENCY TO PORTFOLIO CURRENCY                                   R05750
     C***********WWTDER    MULT WWSPXR    WWORK5    H               R05750094842
     C           WWTDER    MULT WWSPXR    WWORK8 198                      094842
     C*                                                                   R05750
     C           WWRKSQ    IFLT WWRKNM                                    094842
     C           WWORK8    ANDNE0                                         150624
     C           1         DIV  WWORK8    WWORK5    H                     094842
     C                     MOVE 'D'       WWFXMD                          094842
     C                     ELSE                                           094842
     C                     Z-ADDWWORK8    WWORK5    H                     094842
     C                     MOVE 'M'       WWFXMD                          094842
     C                     END                                            094842
     C*                                                                   094842
     C                     MOVE WWORK5    ZFLD15                          R01119
     C                     MOVEL' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWAVX1
     C*****************    ELSE                                           R05750
     C*****************    MOVE *BLANK    WWAVX1                          R05750
     C*****************    END                                            R05750
     C*                                                                   R0875
     C*****************    MOVE SPMD      WWFXMD                          R05750
     C***********          MOVE 'M'       WWFXMD                    R05750094842
     C***********          MOVE 'M'       WWFXM2                    058880094842
     C*                                                                   R0875
     C** DISPLAY PORTFOLIOS IF REQUESTED PORTFOLIO IS '9998' OR '9999'    R0875
     C           *IN58     IFEQ '1'                                       R0875
     C           PTFR      IFEQ '9997'                                    R0875
     C                     MOVE WWR997    WWPTFR                          R0875
     C                     ELSE                                           R0875
     C                     MOVE PTFR      WWPTFR                          R0875
     C                     END                                            R0875
     C                     ELSE                                           R0875
     C                     MOVE *BLANK    WWPTFR                          R0875
     C                     END                                            R0875
     C*                                                                   R0875
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * FMTDPM   - FORMAT DEPOT MOVEMENT DETAILS FOR OUTPUT TO SUBFILE   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZDATE2   - CONVERSION ROUTINE (DAY NUMBER TO DATE)               *
      * ZSEDIT   - EDITION SUBROUTINE TO NUMERIC FIELDS                  *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * LOASDF   - LOAD SUBFILE                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           FMTDPM    BEGSR
     C*
     C*   CONVERT MOVEMENT DATE ACCORDING TO MOVEMENT TYPE
     C*
     C           *IN32     IFEQ '1'
     C                     Z-ADDDPMD      WWDATE
     C                     Z-ADDDPMD      WWDTSV                          R05750
     C                     Z-ADDDPMD      ZDAYNO           IN DATE
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WWDAT1
     C                     ELSE
     C                     Z-ADDDPDO      WWDATE
     C                     Z-ADDDPDO      WWDTSV                          R05750
     C                     Z-ADDDPDO      ZDAYNO           OUT DATE
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WWDAT1
     C                     END
     C*
     C*   MOVEMENT REFERENCE
     C*
     C                     MOVELDPRN      WWREF            DPTMV REFERENCE
     C*
     C*   DEPOT MOVEMENT TYPE
     C*
     C                     MOVE *BLANK    WWTYPE
     C                     MOVELDPMV      WWTYPE           DEPOT MOVEMENT TYPE
     C*
     C*   NOMINAL AMOUNT
     C*
     C                     MOVE *BLANK    ZFLD15
     C                     MOVE DPNA      ZFLD15           NOMINAL AMOUNT
     C                     Z-ADDNMDP      ZDECS
     C                     MOVEL'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM1
     C*
     C*  MOVEMENT PRICE
     C*
     C                     MOVE *BLANK    ZFLD15
     C****************     MOVE MKTP      ZFLD15           % PRICE        R01119
     C****************     Z-ADD8         ZDECS                           R01119
     C                     Z-ADD4         ZDECS                           R01119
     C                     Z-ADDMKTP      WWORK5    H                     R01119
     C                     MOVE WWORK5    ZFLD15                          R01119
     C                     MOVEL' '       ZECODE
     C                     EXSR ZSEDIT
     C           SPBS      IFEQ 'P'
     C                     MOVE '%'       ZOUT21
     C                     END
     C                     MOVE ZOUT21    WWAVR1
     C                     MOVE *BLANK    WWAVX1
     C*
     C****ACCESS*FX*RATE*OF*DEPOT*MOVEMENT
     C*
     C******************** MOVEL'3'       WWCSSE                          R0875
     C********** WWTVPS ** IFEQ 'T'                                       R0875
     C********** CAPRLK ** CHAINCAPRALT              71                   R0875
     C** 71 ************** Z-ADD0         CFXR                            R0875
     C******************** ELSE                                           R0875
     C********** CAPRLK ** CHAINCAPRALV              71                   R0875
     C** 71 ************** Z-ADD0         CFXR                            R0875
     C******************** END                                            R0875
     C*
     C*   EDIT FX RATE
     C*
     C********** CFXR **** IFNE 0                                         R0875
     C           SPXR      IFNE 0                                         R0875
     C                     MOVE *BLANK    ZFLD15
     C****************     MOVE CFXR      ZFLD15                          R01119
     C****************     Z-ADD8         ZDECS                           R01119
     C                     Z-ADD4         ZDECS                           R01119
     C******************** Z-ADDCFXR      WWORK5                   R01119 R0875
     C           WWRKSQ    IFLT WWRKNM                                    094842
     C           1         DIV  SPXR      WWORK5    H                     094842
     C                     MOVE 'D'       WWFXMD                          094842
     C                     ELSE                                           094842
     C                     Z-ADDSPXR      WWORK5    H                     R0875
     C                     MOVE 'M'       WWFXMD                          094842
     C                     END                                            094842
     C                     MOVE WWORK5    ZFLD15                          R01119
     C                     MOVEL' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWAVX1
     C                     ELSE
     C                     MOVE *BLANK    WWAVX1
     C                     END
     C*                                                                   R0875
     C***********          MOVE SPMD      WWFXMD                     R0875094842
     C*                                                                   R0875
     C** DISPLAY PORTFOLIOS IF REQUESTED PORTFOLIO IS '9998' OR '9999'    R0875
     C           *IN58     IFEQ '1'                                       R0875
     C           PTFR      IFEQ '9997'                                    R0875
     C                     MOVE WWR997    WWPTFR                          R0875
     C                     ELSE                                           R0875
     C                     MOVE PTFR      WWPTFR                          R0875
     C                     END                                            R0875
     C                     ELSE                                           R0875
     C                     MOVE *BLANK    WWPTFR                          R0875
     C                     END                                            R0875
     C*                                                                   R0875
     C                     ENDSR
      ********************************************************************059983
      /EJECT                                                              059983
      ********************************************************************059983
      *                                                                  *059983
      * FMTPRC   - FORMAT PRICE CHANGE DETAILS FOR OUTPUT TO SUBFILE     *059983
      *                                                                  *059983
      * SUBROUTINE CALLS:                                                *059983
      * ZDATE2   - CONVERSION ROUTINE (DAY NUMBER TO DATE)               *059983
      * ZSEDIT   - EDITION SUBROUTINE TO NUMERIC FIELDS                  *059983
      *                                                                  *059983
      * SUBROUTINE CALLED FROM:                                          *059983
      * LOASDF   - LOAD SUBFILE                                          *059983
      *                                                                  *059983
      * ROUTINE USES VARIABLES:                                          *059983
      *                                                                  *059983
      ********************************************************************059983
     C           FMTPRC    BEGSR                                          059983
     C*                                                                   059983
     C** FORMAT PRICE CHANGE DATE                                         059983
     C                     Z-ADDCSDA      WWDATE                          059983
     C                     Z-ADDCSDA      WWDTSV                          059983
     C                     Z-ADDCSDA      ZDAYNO                          059983
     C                     EXSR ZDATE2                                    059983
     C                     MOVE ZADATE    WWDAT1                          059983
     C*                                                                   059983
     C** SET UP TEXT FOR OUTPUT                                           059983
     C                     MOVEL'CHANGE'  WWREF                           059983
     C                     MOVEL'PRC'     WWTYPE                          059983
     C*                                                                   059983
     C** NOMINAL AMOUNT                                                   59983
     C                     MOVE *BLANKS   WWNOM1                          059983
     C*                                                                   059983
     C** MOVEMENT PRICE                                                   059983
     C                     MOVE *BLANKS   WWAVR1                          059983
     C           CSAP      IFNE 0                                         059983
     C                     MOVE *BLANK    ZFLD15                          059983
     C                     Z-ADD4         ZDECS                           059983
     C                     Z-ADDCSAP      WWORK5    H                     059983
     C                     MOVE WWORK5    ZFLD15                          059983
     C                     MOVEL' '       ZECODE                          059983
     C                     EXSR ZSEDIT                                    059983
     C           SPBS      IFEQ 'P'                                       059983
     C                     MOVE '%'       ZOUT21                          059983
     C                     END                                            059983
     C                     MOVE ZOUT21    WWAVR1                          059983
     C                     END                                            059983
     C*                                                                   059983
     C** EDIT FX RATE                                                     059983
     C                     MOVE *BLANKS   WWAVX1                          059983
     C                     MOVE *BLANKS   WWFXMD                          059983
     C           CAVR      IFNE 0                                         059983
     C                     MOVE *BLANK    ZFLD15                          059983
     C                     Z-ADD4         ZDECS                           059983
     C           WWRKSQ    IFLT WWRKNM                                    094842
     C           1         DIV  CAVR      WWORK5    H                     094842
     C                     MOVE 'D'       WWFXMD                          094842
     C                     ELSE                                           094842
     C                     Z-ADDCAVR      WWORK5    H                     059983
     C                     MOVE 'M'       WWFXMD                          094842
     C                     END                                            094842
     C                     MOVE WWORK5    ZFLD15                          059983
     C                     MOVEL' '       ZECODE                          059983
     C                     EXSR ZSEDIT                                    059983
     C                     MOVE ZOUT21    WWAVX1                          059983
     C***********          MOVE 'M'       WWFXMD                    059983094842
     C                     END                                            059983
     C*                                                                   059983
     C** DISPLAY PORTFOLIOS IF REQUESTED PORTFOLIO IS '9998               059983
     C           *IN58     IFEQ '1'                                       059983
     C           PTFR      IFEQ '9997'                                    059983
     C                     MOVE WWR997    WWPTFR                          059983
     C                     ELSE                                           059983
     C                     MOVE PTFR      WWPTFR                          059983
     C                     END                                            059983
     C                     ELSE                                           059983
     C                     MOVE *BLANK    WWPTFR                          059983
     C                     END                                            059983
     C*                                                                   059983
     C                     ENDSR                                          059983
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * POSWRT   - GET PREVIOUS POSITION & WRITE TO SUBFILE              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           POSWRT    BEGSR
     C*
     C                     MOVE 'Y'       WWPSFN  1                       37824
     C*
     C           POSKEY    SETLLPMAPOSLL
     C                     READPPMAPOSLL                 70
     C*
     C*  IF NO POSITION FOUND INITIALIZE ALL THE FIELDS FROM PMAPOSLL
     C*
     C           *IN70     IFEQ '1'
     C           QACNUM    ORNE QMCNUM
     C           QAPTFR    ORNE QMPTF1
     C           QATDSS    ORNE WWSESN
     C           QATVDA    ORNE WWTVPS
     C*
     C           WWDATE    IFNE 99999                                     37824
     C           WWDATE    SUB  1         QAPDAT
     C                     Z-ADD*ZERO     QANOML
     C                     Z-ADD*ZERO     QAAPNM
     C                     Z-ADD*ZERO     QAFXAP
     C                     END                                            37824
     C                     MOVE 'N'       WWPSFN  1                       37824
     C                     END
     C*
     C* FORMAT DETAILS FROM LF/PMAPOSLL FOR OUTPUT TO SUBFILE
     C*
     C* FORMAT POSITION DATE
     C*
     C                     Z-ADDQAPDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    WWDAT2
     C*
     C* FORMAT POSITION NOMINAL
     C*
     C                     MOVE *BLANK    ZFLD15
     C                     MOVE QANOML    ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     MOVEL'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWNOM2
     C*
     C* CALCULATE POSITION AVERAGE PRICE
     C*
     C                     Z-ADDQANOML    ZNOML
     C                     Z-ADDQAAPNM    ZVALU
     C                     Z-ADDA6NBDP    ZNMCD
     C                     Z-ADDNMDP      ZNMDP
     C                     MOVELSPBS      ZPRCB
     C                     EXSR ZAVPRC
     C                     MOVE *BLANK    ZFLD15
     C****************     MOVE ZAVPR     ZFLD15                          R01119
     C****************     Z-ADD8         ZDECS                           R01119
     C                     Z-ADD4         ZDECS                           R01119
     C                     Z-ADDZAVPR     WWORK5    H                     R01119
     C                     MOVE WWORK5    ZFLD15                          R01119
     C                     MOVEL' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWAVR2
     C*
     C**  AVERAGE FX RATE
     C                     Z-ADDQAAPNM    ZAPNM
     C                     Z-ADDQAFXAP    ZFXAP
     C                     Z-ADDA6NBDP    ZNMCD
     C                     Z-ADDQMPCDP    ZPTCD
     C                     EXSR ZFXAVP
     C           ZAVFX     IFNE 0
     C                     MOVE *BLANKS   ZFLD15
     C****************     MOVE ZAVFX     ZFLD15                          R01119
     C****************     Z-ADD8         ZDECS                           R01119
     C           WWRKSQ    IFLT WWRKNM                                    094842
     C           1         DIV  ZAVFX     WWORK5    H                     094842
     C                     MOVE 'D'       WWFXM2                          094842
     C                     ELSE                                           094842
     C                     Z-ADDZAVFX     WWORK5    H                     R01119
     C                     MOVE 'M'       WWFXM2                          094842
     C                     END                                            094842
     C                     MOVE WWORK5    ZFLD15                          R01119
     C                     Z-ADD4         ZDECS                           R01119
     C                     MOVEL' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWAVX2
     C                     ELSE
     C                     MOVE *BLANK    WWAVX2
     C                     MOVE '0.0000 ' WWAVX2                         058880
     C                     END
     C*
     C* OUTPUT TO SUBFILE
     C*
     C           WWTITL    IFEQ 'C/F'                                    056549
     C           WWCFWD    ANDEQ'Y'                                      056549
     C           WWDTSV    IFGT DALXTR                                   056549
     C                     MOVE *BLANKS   WWPOST                         056549
     C                     Z-ADD0         WWDTSV                         056549
     C                     END                                           056549
     C                     END                                           056549
     C*
     C           WWPSFN    IFEQ 'Y'                                       37824
     C           WWCFWD    OREQ 'N'                                       37824
     C                     MOVELWWPOST    DDDATA
     C                     MOVE '1'       *IN59
     C                     WRITEPM2050S1
     C                     MOVE '0'       *IN59
     C                     ADD  1         RRN                             058881
     C                     END                                            37824
     C*
     C****                 ADD  1         RRN                             058881
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **PMC1010**-*READ*GROUP*JOB*DATA*AREA*******************************S01486
      **QCMDEXC**-*EXEC*AS/400*COMMAND************************************S01486
      * PMC1003  - TO RETRIEVE DATA AREA *LDA                            *S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWSESN   - SECURITY SHORTNAME PARAMETER PASSED TO PROGRAM        *
      * WWRETC   - RETURN CODE FROM PM2060                               *
      * WWPARM   - GROUP JOB DATA STRUCTURE                              *
      **WWFLD****-*COMMAND*PART*OF*QCMDEXEC*PARAMETER*********************S01486
      **WWNUMB***-*LENGHT*PART*OF*QCMDEXEC*PARAMETER**********************S01486
      * WWDTSV   - CURRENT PAGE MOVEMENT DATE                            *
      * WWRFSV   - CURRENT PAGE MOVEMENT REFERENCE                       *
      *                                                                  *
      ********************************************************************
     C           #INIT     BEGSR
     C*
     C           *ENTRY    PLIST
     C                     PARM           WWSESN 10
     C***********          PARM           WWTVPS  1                       37824
     C                     PARM           WWTVP1  1                       37824
     C                     PARM           WWR997  4                       R0875
     C*
     C                     MOVE WWTVP1    WWTVPS                          37824
     C           WWTVPS    IFEQ 'T'                                       37824
     C                     MOVE '1'       *IN63                           37824
     C                     ELSE                                           37824
     C                     MOVE '0'       *IN63                           37824
     C                     END                                            37824
     C**                                                                  058880
     C** CLEAR SUBFILE                                                    058880
     C**                                                                  058880
     C           WWFRST    IFEQ 'Y'                                       058880
     C                     MOVE '1'       *IN61                           058880
     C                     WRITEPM2050C1                                  058880
     C                     END                                            058880
     C*
     C**ACCESS*ICD****TABTB10************************************* 058881 S01486
     C*   READ BANK DETAILS VIA ACCESS PROGRAM                            S01486
     C*                                                                   058881
     C           WWFRST    IFEQ *BLANKS                    B1             058881
     C                     MOVE 'Y'       WWFRST  1                       058881
     C***********          EXSR ZSYSTM                             058881 S01486
     C************IN99     IFEQ '1'                        B2      058881 S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANK    @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C                     MOVE '1'       *INU7                           058881
     C                     MOVE '1'       *INU8                           058881
     C***********          MOVE 'TABLE'   QMFILE    ***************058881 S01486
     C***********          MOVELZTABKY    QMKEY     ** DB ERROR 01 058881 S01486
     C                     MOVE 'SDBANKPD'QMFILE           ***************S01486
     C                     MOVEL@OPTN     QMKEY            ** DB ERROR 01 S01486
     C                     Z-ADD19        QMERRN           ***************058881
     C                     EXSR *PSSR                                     058881
     C                     ELSE                            X2             058881
     C*                                                                   058881
0664 C**                                                                  S01486
0665 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01486
0666 C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON  S01486
0664 C**                                                                  S01486
     C**ACCESS*ICD****TABTB11************************************* 058881 S01486
     C*   READ GENERAL LEDGER DETAILS VIA ACCESS PROGRAM                  S01486
     C*                                                                   058881
     C***********          EXSR ZICD2                              058881 S01486
     C************INU7     IFEQ '1'                        B3      058881 S01486
     C**********           CALL 'AOGELRR0'                                             S01486 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANK    @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01486 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                    S01486
     C                     MOVE '1'       *IN99                           058881
     C***********          MOVE 'TABLE'   QMFILE    ***************058881 S01486
     C***********          MOVELZTABKY    QMKEY     ** DB ERROR 01 058881 S01486
     C                     MOVE 'SDGELRPD'QMFILE           ***************S01486
     C                     MOVEL@OPTN     QMKEY            ** DB ERROR 01 S01486
     C                     Z-ADD20        QMERRN           ***************058881
     C                     EXSR *PSSR                                     S01486
     C                     END                             E3             058881
     C                     END                             E2             058881
     C*                                                                   058881
     C***OBTAIN*SE*STANDING*DATA********************************** 058881 S01486
     C***********          READ SDSTRDL0                 05        058881 S01486
     C************IN05     IFEQ '1'                        B2      058881 S01486
     C*   READ SECURITIES TRADING DETAILS VIA ACCESS PROGRAM              S01486
     C                     CALL 'AOSTRDR0'                                S01486
     C                     PARM *BLANK    @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C                     Z-ADD4         QMERRN                          058881
     C***********          MOVEL'SDSTRDL0'QMFILE                   058881 S01486
     C***********          MOVEL'STRD'    QMKEY                    058881 S01486
     C                     MOVE 'SDSTRDPD'QMFILE                          S01486
     C                     MOVEL@OPTN     QMKEY                           S01486
     C                     EXSR *PSSR                                     058881
     C                     END                             E2             058881
     C*                                                                   S01496
     C**  Check if feature "Jyske Enhancements" is on                     S01496
     C*                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   WLRTCD  7                       S01496
     C                     PARM '*VERIFY' WLOPTN  7                       S01496
     C                     PARM 'S01496'  WLSARD  6                       S01496
     C           SCSARD    PARM SCSARD    DSSDY                           S01496
     C                     MOVE 'N'       S01496  1                       S01496
     C*                                                                   S01496
     C           WLRTCD    IFEQ *BLANKS                                   S01496
     C*                                                                   S01496
     C**  If S01496 is installed, open appropriate files                  S01496
     C*                                                                   S01496
     C                     MOVE 'Y'       S01496                          S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C**  Return code other than *NRF                                     S01496
     C*                                                                   S01496
     C           WLRTCD    IFNE '*NRF'                                    S01496
     C                     Z-ADD15        QMERRN           ***************S01496
     C                     MOVE 'SCSARDPD'QMFILE           * DB ERROR 15 *S01496
     C                     MOVELWLOPTN    QMKEY            ***************S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                             E1             058881
     C*                                                                   058881
     C**                                                                  S01486
     C**  GET RUNDAT to access MULTI-BRANCHING flag.                      S01486
     C**                                                                  S01486
     C           *NAMVAR   DEFN           RUNDAT                          S01486
     C                     IN   RUNDAT                                    S01486
     C           @MBIN     IFEQ 'Y'                                       S01486
     C                     MOVE '1'       *IN20                           S01486
     C                     END                                            S01486
     C*
     C** OBTAIN LAST PORTFOLIO EXTRACT DATE                               056549
     C*                                                                   056549
     C           *NAMVAR   DEFN           PMSTAT256                       056549
     C                     IN   PMSTAT                                    056549
     C                     MOVE PMSTAT    DLDATE                          056549
     C                     MOVEL*BLANKS   WWMOVT
     C                     MOVEL*BLANKS   WWPOST
     C*
     C                     MOVE '0'       *IN
     C                     MOVE '0'       *INKC
     C                     MOVE '0'       *INKL
     C                     MOVE '0'       *INKV                           S01486
     C                     MOVE '0'       WWRETC  1
     C*
     C*****RECEIVE*PARAMETERS*FROM*DATA*AREA**GDA************************ S01486
     C*    RECEIVE PARAMETERS FROM DATA AREA *LDA                         S01486
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
     C                     MOVELQMRUNA    DDRUNA
     C                     MOVELUSID      SUSER                           081239
     C                     EXSR PORTSR                                    094842
     C*
     C*****IF*ATTENTION*KEY*ENABLED*SET*THE*ATTENTION*PROGRAM*TO********* S01486
     C*****PMC0610******************************************************* S01486
     C***********QMATTN    IFEQ 'Y'                                       S01486
     C***********          MOVEAATN       WWFLD  22                       S01486
     C***********          Z-ADD22        WWNUMB 155                      S01486
     C***********          CALL 'QCMDEXC'                                 S01486
     C***********          PARM           WWFLD                           S01486
     C***********          PARM           WWNUMB                          S01486
     C***********          END                                            S01486
     C*                                                                   37824
     C** SET UP TRADE / VALUE DATE POSITIONS INDICATOR                    37824
     C           WWTVPS    IFEQ 'T'                                       37824
     C                     MOVE '1'       *IN63                           37824
     C                     ELSE                                           37824
     C                     MOVE '0'       *IN63                           37824
     C                     END                                            37824
     C*
     C*    KEY LISTS
     C*
     C           MOVKEY    KLIST                           MOVEMENT KEY
     C                     KFLD           QMCNUM
     C                     KFLD           QMPTF1
     C                     KFLD           WWSESN
     C                     KFLD           WWDATE
     C           MOVKYP    KLIST                           MOVEMENT KEY
     C                     KFLD           QMCNUM
     C                     KFLD           QMPTF1
     C                     KFLD           WWSESN
     C           MOVK2Y    KLIST                           MOVEMENT KEY   R0875
     C                     KFLD           QMCNUM                          R0875
     C                     KFLD           WWSESN                          R0875
     C                     KFLD           WWDATE                          R0875
     C           MOVK2P    KLIST                           MOVEMENT KEY   R0875
     C                     KFLD           QMCNUM                          R0875
     C                     KFLD           WWSESN                          R0875
     C           POSKEY    KLIST                           POSITION KEY
     C                     KFLD           QMCNUM
     C                     KFLD           QMPTF1
     C                     KFLD           WWSESN
     C                     KFLD           WWTVPS
     C                     KFLD           WWDATE
     C           KPORT     KLIST                                          094842
     C                     KFLD           QMCNUM                          094842
     C                     KFLD           QMPTF1                          094842
     C********** CAPRLK ** KLIST                                          R0875
     C******************** KFLD           QMCNUM                          R0875
     C******************** KFLD           QMPTF1                          R0875
     C******************** KFLD           WWSESN                          R0875
     C******************** KFLD           WWDATE                          R0875
     C******************** KFLD           WWCSSE  1                       R0875
     C******************** KFLD           WWREF                           R0875
     C*
     C                     ENDSR
      ********************************************************************
     C/EJECT                                                              094842
     C*****************************************************************   094842
     C*                                                               *   094842
     C* PORTSR   - ACCESS PORTFOLIO DETAILS                           *   094842
     C*                                                               *   094842
     C* SUBROUTINE CALLS:                                             *   094842
     C* *PSSR    - PROCESS DATABASE ERROR                             *   094842
     C*                                                               *   094842
     C* SUBROUTINE CALLED FROM:                                       *   094842
     C* #INIT    - INITIAL PROCESSING                                 *   094842
     C*                                                               *   094842
     C*****************************************************************   094842
     C           PORTSR    BEGSR                                          094842
     C*                                                                   094842
     C**  ACCESS PORTFOLIO DETAILS                                        094842
     C*                                                                   094842
     C           QMPTF1    IFNE '9997'                                    094842
     C           QMPTF1    ANDNE'9998'                                    094842
     C           QMPTF1    ANDNE'9999'                                    094842
     C***********KPORT     CHAINPMPORTL1             50             094842095722
     C           KPORT     CHAINPMPORTLL             50                   095722
     C           *IN50     IFEQ '1'                                       094842
     C                     Z-ADD5         QMERRN                          094842
     C***********          MOVE 'PMPORTL1'QMFILE                    094842095722
     C                     MOVE 'PMPORTLL'QMFILE                          095722
     C                     MOVELQMCNUM    QMKEY                           094842
     C                     MOVE QMPTF1    QMKEY                           094842
     C                     EXSR *PSSR                                     094842
     C                     END                                            094842
     C                     MOVE PNPTCY    KYCCY                           094842
     C                     ELSE                                           094842
     C                     MOVELQMCNUM    KYCNUM 10                       094842
     C                     CALL 'AOPLCSR0'                                094842
     C                     PARM *BLANKS   @RTCD   7                       094842
     C                     PARM '*KEY   ' @OPTN   7                       094842
     C                     PARM           KYCNUM                          094842
     C           SDPLCS    PARM SDPLCS    DSFDY                           094842
     C           @RTCD     IFNE *BLANKS                                   094842
     C                     Z-ADD7         QMERRN                          094842
     C                     MOVE 'SDPLCSPD'QMFILE                          094842
     C                     MOVELQMCNUM    QMKEY                           094842
     C                     EXSR *PSSR                                     094842
     C                     END                                            094842
     C                     MOVE QBCSBY    KYCCY                           094842
     C                     END                                            094842
     C*                                                                   094842
     C*   READ CURRENCY CODES DETAILS VIA ACCESS PROGRAM                  094842
     C*                                                                   094842
     C                     CALL 'AOCURRR0'                                094842
     C                     PARM *BLANKS   @RTCD   7                       094842
     C                     PARM '*KEY   ' @OPTN   7                       094842
     C                     PARM           KYCCY   3                       094842
     C           SDCURR    PARM SDCURR    DSSDY                           094842
     C           @RTCD     IFNE *BLANK                                    094842
     C                     Z-ADD6         QMERRN                          094842
     C                     MOVE 'SDCURRL0'QMFILE                          094842
     C                     MOVELKYCCY     QMKEY                           094842
     C                     EXSR *PSSR                                     094842
     C                     END                                            094842
     C                     Z-ADDA6RKSQ    WWRKSQ                          094842
     C                     ENDSR                                          094842
     C*****************************************************************   094842
     C/EJECT                                                              S01496
     C*****************************************************************   S01496
     C**                                                              *   S01496
     C**   P001 SR - Change transactions types                        *   S01496
     C**                                                              *   S01496
     C**   Called by - LOADSF                                         *   S01496
     C**                                                              *   S01496
     C**   Calls                                                      *   S01496
     C**                                                              *   S01496
     C*****************************************************************   S01496
     C           P001      BEGSR                                          S01496
     C*                                                                   S01496
     C**  Open appropriate files                                          S01496
     C*                                                                   S01496
     C                     OPEN SEERALL2                                  S01496
     C                     OPEN SEERALL5                                  S01496
     C*                                                                   S01496
     C           WWTYPE    IFEQ 'PUR'                                     S01496
     C           WWTYPE    OREQ 'SAL'                                     S01496
     C           WWREF     SETLLSEERALL2                 86               S01496
     C*                                                                   S01496
     C           *IN86     IFEQ '1'                                       S01496
     C*                                                                   S01496
     C           WWTYPE    IFEQ 'PUR'                                     S01496
     C                     MOVEL'TRI'     WWTYPE                          S01496
     C                     END                                            S01496
     C           WWTYPE    IFEQ 'SAL'                                     S01496
     C                     MOVEL'TRO'     WWTYPE                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           WWTYPE    IFEQ 'WI '                                     S01496
     C           WWTYPE    OREQ 'WO '                                     S01496
     C*                                                                   S01496
     C           KEY1      KLIST                                          S01496
     C                     KFLD           WWSESN                          S01496
     C                     KFLD           WWREF                           S01496
     C*                                                                   S01496
     C           KEY1      SETLLSEERALL5                 86               S01496
     C*                                                                   S01496
     C           *IN86     IFEQ '1'                                       S01496
     C*                                                                   S01496
     C           WWTYPE    IFEQ 'WI '                                     S01496
     C                     MOVEL'DRI'     WWTYPE                          S01496
     C                     END                                            S01496
     C           WWTYPE    IFEQ 'WO '                                     S01496
     C                     MOVEL'DRO'     WWTYPE                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Close files used                                                S01496
     C*                                                                   S01496
     C                     CLOSESEERALL2                                  S01496
     C                     CLOSESEERALL5                                  S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C*****************************************************************   S01496
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - PROCESS DATABASE ERROR                                *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **PMC1000**-*UPDATE*GROUP*JOB*DATA*AREA*****************************S01486
      **PMC1020**-*TERMINATE*GROUP*JOB*IF*DATABASE*ERROR******************S01486
      * PMC1001  - TO UPDATE DATA AREA *LDA                              *S01486
      * DBERRCTL - DATABASE ERROR PROCESSING                             *S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * ACCESS   - ACCESS SECURITY AND MOVEMENT DETAILS                  *
      * LOADSF   - LOAD SUBFILE                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      **WWPARM***-*GROUP*JOB*DATA*STRUCTURE*******************************S01486
      **WWEND****-*GROUP*JOB*TERMINATION*VALUE****************************S01486
      **WWGRPJ***-*GROUP*JOB*VALUE****************************************S01486
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C*
     C*****UPDATE**GDA*************************************************** S01486
     C***********          CALL 'PMC1002'                                 S01486
     C***********          PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C*
     C                     DUMP
     C*
     C***********          CALL 'PMC1020'                                 S01486
     C                     CALL 'DBERRCTL'                                S01486
     C                     RETRN                                          S01486
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
     C**************************************************************************
     C*                                                                        *
     C*  ZAVPRC  CALCULATE AVERAGE PRICE                                       *
     C*                                                                        *
     C*  PURPOSE : TO CALCULATE AN AVERAGE PRICE (BY DIVIDING THE              *
     C*            VALUE OF A HOLDING BY THE NOMINAL)                          *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C*       ZNOML  11 0     NOMINAL                                          *
     C*       ZVALU  15 0     VALUE                                            *
     C*       ZNMDP   1 0     NOMINAL DECIMAL PLACES (0-4)                     *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3 )           *
     C*       ZPRCB   1 A     PRICE BASIS (P/U)                                *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZAVPR  15 8     AVERAGE PRICE                                    *
     C*                                                                        *
     C*  ALSO REQUIRED                                                         *
     C*       POWER8 ARRAY                                                     *
     C*                                                                        *
     C*  WORK FIELDS:                                                          *
     C*       ZI      1 0 - INDEX TO POWER ARRAY                               *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                        *
     C**************************************************************************
     C********** ZAVPRC    BEGSR                           *** ZAVP       49213
     C*
     C** DEFINE ALL FIELDS
     C*
     C**********           Z-ADDZNOML     ZNOML  110                      49213
     C**********           Z-ADDZVALU     ZVALU  150                      49213
     C**********           Z-ADDZNMDP     ZNMDP   10                      49213
     C**********           Z-ADDZNMCD     ZNMCD   10                      49213
     C**********           MOVE ZPRCB     ZPRCB   1                       49213
     C**********           Z-ADDZAVPR     ZAVPR  158                      49213
     C*
     C** IF NOMINAL = 0   END PROCESS
     C********** ZNOML     IFEQ 0                                         49213
     C**********           Z-ADD0         ZAVPR                           49213
     C*
     C** IF NOMINAL NOT = ZEROS
     C**********           ELSE                                           49213
     C*
     C** DIVIDE VALUE BY NOMINAL   IN ZAVPR
     C********** ZVALU     DIV  ZNOML     ZAVPR                           49213
     C*
     C** IF PRICE BASIS IS PERCENTAGE
     C********** ZPRCB     IFEQ 'P'                                       49213
     C********** 100       MULT ZAVPR     ZAVPR                           49213
     C**********           END                                            49213
     C*
     C** SET POWER8 INDEX TO 5 - NBR NOMINAL DEC. PLACES + NBR CURRENCY DEC. PL.
     C********** 5         SUB  ZNMDP     ZI      10                      49213
     C**********           ADD  ZNMCD     ZI                              49213
     C*
     C** DIVIDE AVERAGE PRICE BY POWER
     C********** ZAVPR     DIV  POWER8,ZI ZAVPR     H                     49213
     C*
     C** SET AVERAGE PRICE POSITIVE
     C********** ZAVPR     IFLE 0                                         49213
     C**********           Z-SUBZAVPR     ZAVPR                           49213
     C**********           END                                            49213
     C*
     C** END CONDITION NOMINAL = ZERO
     C**********           END                                            49213
     C*
     C**
     C**********           ENDSR                                          49213
     C**************************************************************************
      /EJECT
     C*************************************************************************
     C*                                                                       *
     C*  ZFXAVP - CALCULATE AVERAGE FX RATE                                   *
     C*                                                                       *
     C*  PURPOSE : TO CALCULATE AN AVERAGE FX RATE (VALUE OF HOLDING IN       *
     C*            PORTFOLIO CURRENCY DIVIDED BY VALUE IN NOMINAL CURRENCY)   *
     C*                                                                       *
     C*  INPUT  FIELDS                                                        *
     C*       ZAPNM  15 0     AVERAGE PRICE NUMERATOR                         *
     C*       ZFXAP  15 0     FX AVERAGE PRICE NUMERATOR                      *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3)           *
     C*       ZPTCD   1 0     PORTFOLIO CURRENCY DECIMAL PLACES (0-3)         *
     C*                                                                       *
     C*  OUTPUT  FIELDS                                                       *
     C*       ZAVFX  13 8     AVERAGE FX RATE                                 *
     C*                                                                       *
     C*  ALSO REQUIRED                                                        *
     C*       POWER8 ARRAY    ARRAY FOR CURRENCY CONVERSIONS                  *
     C*                                                                       *
     C*  WORK FIELDS:                                                          *
     C*       ZI      1 0     INDEX TO POWER ARRAY                            *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                       *
     C*************************************************************************
     C********** ZFXAVP    BEGSR                           *** ZFXA       49213
     C**********                                                          49213
     C** DEFINE ALL FIELDS
     C*
     C**********           Z-ADDZAPNM     ZAPNM  150                      49213
     C**********           Z-ADDZFXAP     ZFXAP  150                      49213
     C**********           Z-ADDZNMCD     ZNMCD   10                      49213
     C**********           Z-ADDZPTCD     ZPTCD   10                      49213
     C**********           Z-ADDZAVFX     ZAVFX  138                      49213
     C*
     C** IF AP NUMERATOR = 0   END PROCESS
     C********** ZAPNM     IFEQ 0                                         49213
     C**********           Z-ADD0         ZAVFX                           49213
     C*
     C** IF AP NUMERATOR NOT = ZEROS
     C**********           ELSE                                           49213
     C*
     C** DIVIDE FX AP NUMERATOR BY AP NUMERATOR
     C********** ZFXAP     DIV  ZAPNM     ZAVFX     H                     49213
     C*
     C** SET POWER8 INDEX TO 5 - NBR NOM CCY DEC. PLACES + NBR PORT CCY DEC. PL.
     C********** 5         SUB  ZNMCD     ZI      10                      49213
     C**********           ADD  ZPTCD     ZI                              49213
     C*
     C** DIVIDE AVERAGE PRICE BY POWER
     C********** ZAVFX     DIV  POWER8,ZI ZAVFX     H                     49213
     C*
     C** SET AVERAGE PRICE POSITIVE
     C********** ZAVFX     IFLE 0                                         49213
     C**********           Z-SUBZAVFX     ZAVFX                           49213
     C**********           END                                            49213
     C*
     C** END CONDITION NOMINAL = ZERO
     C**********           END                                            49213
     C*
     C********** ZXAVP9    ENDSR                                          49213
      **************************************************************************
      /EJECT
     C**********************************************************************
     C*                                                                   058881
     C* APNUM - CALCULATE AVERAGE PRICE NUMERATOR                         058881
     C**                                                                  058881
     C           APNUM     BEGSR                           ** APNUM  **   058881
     C*          ******                                                   058881
     C*                                                                   058881
     C** DETERMINE REALLOWANCE AS PERCENTAGE PRICE                        058881
     C                     Z-ADD0         WDRALL                          058881
     C                     Z-ADD0         ZFDATE  50                      058881
     C           BVRCAP    IFEQ 'Y'                        B1             058881
     C                     Z-ADDRALL      WDRALL 158                      058881
     C                     Z-ADDRALL      ZPRICE 158                      058881
     C*   . if Discount                                                   058881
     C*                                                                   058881
     C           STBS      IFEQ 'D'                        B2             058881
     C           RALL      ANDNE0                                         058881
     C*                                                                   S01486
     C                     Z-ADDBJDNWD    ZZDNWD                          S01486
     C                     Z-ADDBKAPDT    ZZAPDT                          S01486
     C*                                                                   S01486
     C                     EXSR ZEVCD                                     058881
     C                     EXSR ZNCD                                      058881
     C                     Z-ADDQMRDNB    ZSDATE                          058881
     C                     Z-ADDMATY      ZEDATE                          058881
     C                     EXSR ZDAYS                                     058881
     C                     Z-ADDZDDAYS    #DDAYS  50                      058881
     C                     EXSR ZDYYR                                     058881
     C           ZINTDD    IFNE 0                          B3             058881
     C           RALL      MULT #DDAYS    WRKPRC 158                      058881
     C           WRKPRC    DIV  ZINTDD    WCRALL    H                     058881
     C*                                                                   058881
     C           WCRALL    IFGE 0                          B4             058881
     C           1         SUB  WCRALL    WDRALL 158                      058881
     C                     ELSE                            X4             058881
     C                     Z-SUBWCRALL    WCRALL 158                      058881
     C           1         SUB  WCRALL    WDRALL                          058881
     C                     Z-SUBWDRALL    WDRALL                          058881
     C                     END                             E4             058881
     C*                                                                   058881
     C                     ELSE                            X3             058881
     C                     Z-ADD*ZEROS    WDRALL                          058881
     C                     END                             E3             058881
     C                     END                             E2             058881
     C                     END                             E1             058881
     C*                                                                   058881
     C                     Z-ADDNOML      ZNOML                           058881
     C           PRIC      ADD  WDRALL    ZAVPR                           058881
     C                     Z-ADDNMDP      ZNMDP                           058881
     C                     Z-ADDA6NBDP    ZNMCD                           058881
     C                     MOVE SPBS      ZPRCB                           058881
     C                     EXSR ZAPNUM                                    058881
     C*                                                                   058881
     C** IF CHARGES ARE INCLUDED IN AVERAGE PRICE ADD TO TOTAL COST OF    058881
     C** TRADE                                                            058881
     C           BVCCAP    IFEQ 'Y'                        B1             058881
     C                     ADD  TCA1      ZVALU                           058881
     C                     ADD  TCA2      ZVALU                           058881
     C                     ADD  TCA3      ZVALU                           058881
     C                     ADD  TCA4      ZVALU                           058881
     C                     ADD  TCA5      ZVALU                           058881
     C                     ADD  TCA6      ZVALU                           058881
     C                     ADD  TCA7      ZVALU                           058881
     C                     ADD  TAXA      ZVALU                           058881
     C                     END                              E1            058881
     C*                                                                   058881
     C           BVCMCP    IFEQ 'Y'                         B1            058881
     C                     ADD  TBCA      ZVALU                           058881
     C                     ADD  TCCA      ZVALU                           058881
     C                     END                              E1            058881
     C*                                                                   058881
     C** PERFORM SR/ZAVPRC TO CALCULATE AVERAGE PRICE                     058881
     C                     Z-ADDNOML      ZNOML                           058881
     C                     Z-ADDNMDP      ZNMDP                           058881
     C                     Z-ADDA6NBDP    ZNMCD                           058881
     C                     MOVE SPBS      ZPRCB                           058881
     C                     EXSR ZAVPRC                                    058881
     C*                                                                   058881
     C                     ENDSR                                          058881
     C********************************************************************058881
      /EJECT                                                              058881
     C**************************************************************058881S01486
     C*****ZSYSTM*SR.*TO*CHAIN*TO*THE*INSTALLATION*CONTROL*DATA*REC 058881S01486
     C************************************************************* 058881S01486
     C***/COPY*ZSRSRC,ZSYSTMZ1                                      058881S01486
     C**************************************************************058881S01486
     C********************************************************************058881
      /EJECT                                                              058881
     C********************************************************************058881
     C*                                                                   058881
     C/EJECT
     C***/COPY*ZSRSRC,ZICD2Z1                                      058881 S01486
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZSEDITZ3
     C/COPY ZSRSRC,ZDAYSZ2                                                058881
     C*                                                                   058881
     C/COPY ZSRSRC,ZDYYRZ3                                                058881
     C*                                                                   058881
     C/COPY ZSRSRC,ZDATE1Z2                                               058881
     C*                                                                   058881
     C/COPY ZSRSRC,ZNCDZ3                                                 058881
     C*                                                                   058881
     C/COPY ZSRSRC,ZEVCDZ1                                                058881
     C*                                                                   058881
     C/COPY ZSRSRC,ZLCDZ1                                                 058881
     C*                                                                   058881
     C/COPY ZSRSRC,ZAPNUM                                                 058881
     C*                                                                   058881
      /COPY ZSRSRC,ZAVPRC                                                 49213
      /COPY ZSRSRC,ZFXAVP                                                 49213
      /EJECT
     C** THE FOLLOWING ARRAY HAS BEEN REMOVED                             S01486
     C** **  ATN - ARRAY TO ENABLE ATTN KEY****************************** S01486
     C** SETATNPGM PGM(PMC0610) ***************************************** S01486
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**  ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**  ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
