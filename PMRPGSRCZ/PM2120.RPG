     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Retail account movements enquiry')            *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM2120 - Account Movements Enquiry                           *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 176940             Date 30Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 167494             Date 31May01               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 150964             Date 21Dec98               *
      *                 150419             Date 16Dec98               *
     F*                 132262             Date 30Mar98               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 111398             Date 20Nov96               *
      *                 CPM005             Date 11Jul96               *
     F*                 099271             DATE 24JUN96               *
     F*                 CPM004             DATE 19FEB96               *
     F*                 092517             DATE 15AUG95               *
     F*                 086665             DATE 20MAR95               *
     F*                 085862             DATE 16MAR95               *
     F*                 085817             DATE 13MAR95               *
     F*                 081239             DATE 01FEB95               *
     F*                 S01486             DATE 11AUG94               *
     F*                 064752             DATE 17DEC93               *
     F*                 049421             DATE 25NOV93               *
     F*                 059191             DATE 08AUG93               *
     F*                 S01313             DATE 06NOV92               *
     F*                 038516             DATE 19MAY92               *
     F*                 SA9108             DATE 06NOV91               *
     F*                 33625              DATE 25SEP91               *
     F*                 33624              DATE 25SEP91               *
     F*                 33615              DATE 25SEP91               *
     F*                 B9899              DATE 18SEP91               *
     F*                 R05739             DATE 25MAR91               *
     F*                 R05661             DATE 11/03/91              *
     F*                 R0111              DATE 06FEB91               *
     F*                 000063             DATE 30JAN91               *
     F*                 R01149             DATE 19DEC90               *
     F*                 R0821              DATE 02NOV90               *
     F*                 R0645              DATE 26OCT90               *
     F*                 R10055             DATE 04/10/90              *
     F*                 R10048             DATE 25/09/90              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  176940 - Database error on enquiry option caused by          *
     F*           more than 9999 subfile records.                     *
      *  167494 - Incorrect RRN is stored when no posting exists for  *
      *           that account.                                       *
     F*  150964 - Brough forward Amount doesn' t change               *
     F*           TB1/TB0 for RRN are 3.0 But RRN are 4.0             *
      *  150419 - Increase size of subfile to cope with 999 dates     *
     F*  132262 - FOR VALUE DATE AND POSTING DATE (PM2120S0 AND S1)   *
     F*           FOR FIRST RECORD OF SUBFILES (WWRRN0 AND 1=0) DO NOT*
     F*           STORE VALUE/POSTING DATE BUT THIS DATE-1.           *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
     F*  111398 - Increase size of subfile to cope with 150 dates     *
     F*  CPM005 - Private Banking Phase II                            *
     F*           Focus Group Changes Upgraded to DBA                 *
     F*  099271 - COMPLETE 059191 : PROBLEM FOR BALANCES              *
     F*  CPM004 - Bank Portfolios                                     *
     F*  092517 - Should check branch of account not user's branch    *
     F*  086665 - Command F3 produce an incorrect data base error     *
     F*  085862 - INCLUDE BRANCH CODE IN ACCOUNT IDENTIFIER           *
     F*  085817 - Recompile due to changes in PMLDAPD                 *
     F*  081239 - R10 Private Banking Rework                          *
     F*  S01486 - Portfolio Management Upgrade to Release 10          *
     F*  064752 - SORTING BY VALUE DATE DOES NOT WORK.                *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  059191 - INCORRECT BALANCES OUTPUT                           *
     F*  S01313 - RECOMPILED DUE TO PORTFOLIO PERFORMANCE             *
     F*  038516 - BROUGHT FORWARD BALANCE WRONGLY CALCULATED FOR      *
     F*           VALUE DATE ACCOUNT MOVEMENT ENQUIRY                 *
     F*  SA9108 - POOL SECURITIES TRANSACTIONS (ONLY RECOMPILED       *
     F*           FOR DTAARA/LDA)                                     *
     F*  33625  - !                                                   *
     F*  33624  - !--> COMMENTS IN A BANK IN SWITZERLAND (SECRET)     *
     F*  33615  - !                                                   *
     F*  B9899  - POSITION SUBFILE TO FIRST RECORD                    *
     F*  R05739 - TIDY UP ENQUIRY SCREEN TO SHOW INFORMATION CORRECTLY*
     F*  R05661 - IF 9998 OR 9999 PORTFOLIO DISPLAYED OUTPUT THE      *
     F*           POSITION PORTFOLIO IN BRACKETS                      *
     F*  R0111  - SUPPRESS TEMPORARILY DISPLAY OF ON LINE             *
     F*           MOVEMENTS UNTIL ONLINE SYSTEM IS REQUESTED.         *
     F*  000063 - FINAL BROUGHT FORWARD BALANCE DISPLAYED TWICE       *
     F*  R01149 - REDESIGN SCREEN AND REORDER SUBFILE                 *
     F*           IN ASCENDING SEQUENCE                               *
     F*  R0821  - ABORT FIX R0645. (Cannot find some explanation      *
     F*           about it)                                           *
     F*  R0645  -                                                     *
     F*  R10055 - DISPLAY ALSO ACCOUNT MOVEMENTS FROM RSACMTPD        *
     F*           AND GIVE THE POSSIBILITY TO DISPLAY MOVEMENTS       *
     F*           IN POSTING DATE OR VALUE DATE SEQUENCE              *
     F*  R10048 - ACCOUNT MOVEMENTS NOT BEING DISPLAYED               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     FACCNT   IF  E           K        DISK
     F** PREFIX: -
     F                                              KINFSR *PSSR
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F*APOST**IF**E***********K        DISK                               R10055
     F** PREFIX: - ***********                                            R10055
     F************************                      KINFSR *PSSR          R10055
     F*HPOSTL1*IF**E********** K        DISK                       R10055 R01149
     F******HPOSTL6 IF  E           K        DISK                  R01149 R0111
     F***HPOSTL8*IF**E           K        DISK                     R0111  S01486
     FAPOSTL1 IF  E           K        DISK                               S01486
     F** PREFIX: -                                                        R10055
     F                                              KINFSR *PSSR          R10055
     F******HPOSTL5 IF  E           K        DISK                  R01055 R0111
     F***HPOSTL7*IF**E           K        DISK                     R0111  S01486
     FPMHPOSL1IF  E           K        DISK                               S01486
     F** PREFIX: -                                                        R10055
     F************RSACMTPO                          KRENAMERSACMTPP       R10055
     F*********** HPOSTPDF                          KRENAMEHPOSTPDGR10055 S01486
     F            APOSTPDF                          KRENAMEAPOSTPDG       S01486
     F            GLACPHPF                          KRENAMEGLACPHPG       S01486
     F                                              KINFSR *PSSR          R10055
     F***SDCURRL0IF**E           K        DISK                            S01486
     F***PREFIX:*A6****************************************************   S01486
     F***********                                   KINFSR *PSSR          S01486
     F***PM2120DDCF**E                    WORKSTN                         S01486
     FPM2120DFCF  E                    WORKSTN                            S01486
     F** PREFIX: DD
     F                                              KINFSR *PSSR
     F************************                WWRRN KSFILE PM2120S0       R10055
     F                                        WWRRN0KSFILE PM2120S0       R10055
     F                                        WWRRN1KSFILE PM2120S1       R10055
     F*                                                                   R05897
     F*****HOLIDAY*TABLE*FILE.*PREFIX*-*NO*PREFIX***************** R05897 S01486
     F***TABLETJ*IF**E           K        DISK         KINFSR *PSS R05897 S01486
     F***SDBANKL0IF**E                    DISK                     R05897 S01486
     F***********                                   KINFSR *PSSR   R05897 S01486
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       03         EXIT
     F*       09         CHANGE POSTING DATE <==> VALUE DATE              R10055
     F*       12         PREVIOUS SCREEN
     F*                                                                   S01486
     F*       35         MULTI-BRANCH INDICATOR                           S01486
     F*
     F*       45         VLDCMDKY INDICATOR FOR DISPLAY FILE
     F*
     F*       51         SFLDSP (PM2120S0)
     F*       52         SFLEND (PM2120S0)
     F*       53         SFLDSP (PM2120S1)                                R10055
     F*       54         SFLEND (PM2120S1)                                R10055
     F*
     F*       98         DATE FORMAT
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   ..   04   05   06   07   08   09   10 *
     F**      * 11   ..   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   ..   36   37   38   39   40 *
     F**      * 41   42   43   44   ..   46   47   48   49   50 *
     F**      * ..   ..   ..   ..   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   70 *
     F**      * 71   72   73   74   75   76   77   78   79   80 *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   ..   99      *
     F**      ***************************************************
     F*********************************************************************
     E*
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E** ARRAYS FOR S/R ZDATE2
     E/COPY ZSRSRC,ZDATE2Z1                                               S01486
     E*                                                                   S01486
     E***********         ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYS01486
     E***********         ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYS01486
     E***********         ZMNM   12  12  3               ZDATE2 SR. ARRAY S01486
     E*
     E** ARRAYS FOR S/R ZSEDIT
     E/COPY ZSRSRC,ZSEDITZ1                                               S01486
     E*                                                                   S01486
     E***********         ZS1        15  1 0                              S01486
     E***********         ZS2        21  1                                S01486
     E*
     E***ARRAY*TO*ENABLE*ATTENTION*KEY*********************************   S01486
     E***********         ATN     1   1 22                                S01486
     E*
     E** ARRAY FOR BROUGHT FORWARD BALANCE TEXT
     E******************* TXT     1   1 23                                R10055
     E                    TXT     1   1 15                                R10055
     E*                                                                   R01149
     E** ARRAYS TO SAVE THE RRN'S                                         R01149
     E***********         TB0        99  3 0                        R01149111398
     E***********         TB1        99  3 0                        R01149111398
     E***********         TB0       149  3 0                       111398 150419
     E***********         TB1       149  3 0                       111398 150419
     E                    TB0       999  4 0                              150964
     E                    TB1       999  4 0                              150964
     E                    ZHC        50  3                                R05897
     E*                                                                   S01486
     E/COPY ZSRSRC,ZHOLE                                                  S01486
     E*                                                                   S01486
     I*
     I** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I** DATA STRUCTURE FOR S/R ZSEDIT
     I/COPY ZSRSRC,ZSEDITZ2                                               S01486
     I************DS                                                      S01486
     I****************************************1  150WORK15                S01486
     I****************************************1  150ZS1                   S01486
     I*
     I** DATA STRUCTURE FOR DATABASE ERROR, KEY KACCN
     IKACCDS      DS
     I**********                              1   60CNUM                                      CSD027
     I                                        1   6 CNUM                                      CSD027
     I                                        7   9 CCY
     I                                       10  190ACOD                                      CGL029
     I                                       20  210ACSQ                                      CGL029
     I                                       22  24 BRCA                                      CGL029
     I**********                             10  130ACOD                                      CGL029
     I**********                             14  150ACSQ                                      CGL029
     I**********                             16  18 BRCA                               085862 CGL029
     I*                                                                   R10055
     I** DATA STRUCTURE FOR BROUGHT FORWARD + DATE NARRATIVE              R10055
     IDSNARR      DS                                                      R10055
     I                                        1  16 DSNAR1                R10055
     I                                       17  23 DSNAR2                R10055
     I                                       24  30 DSNAR3                R10055
     I*                                                                   R01149
     I** DATA STRUCTURE FOR ACCOUNT CODE                                  R01149
     I            DS                                                      R01149
     I**********                              1  18 DDCODE                             R01149 CGL029
     I                                        1  24 DDCODE                                    CGL029
     I***********                             1   6 DDCNUM          R01149CPM004
     I                                        1   6 DDACCU                CPM004
     I***********                             7   7 DDSEP1          R01149085862
     I***********                             8  10 DDCCY           R01149085862
     I***********                            11  11 DDSEP2          R01149085862
     I***********                            12  15 DDACOD          R01149085862
     I***********                            16  16 DDSEP3          R01149085862
     I***********                            17  18 DDACSQ          R01149085862
     I                                        7   9 DDCCY                 085862
     I                                       10  19 DDACOD                                    CGL029
     I                                       20  21 DDACSQ                                    CGL029
     I                                       22  24 DDBRCA                                    CGL029
     I**********                             10  13 DDACOD                             085862 CGL029
     I**********                             14  15 DDACSQ                             085862 CGL029
     I**********                             16  18 DDBRCA                             085862 CGL029
     I*                                                                   059191
     IPMSTAT    E DS                                                      059191
     I                                       29  330WWLXTR                059191
     I                                        1 256 WWSTAT                059191
     I*                                                                   R01149
     I** DATA STRUCTURE FOR AMOUNT                                        R01149
     I            DS                                                      R01149
     I****************************************1  30 DDPSTA          R0114933625
     I                                        1  31 DDPSTA                33625
     I                                        1  15 WWDEBT                R01149
     I                                       16  30 WWCRDT                R01149
     I                                       31  31 DDCRSS                33625
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     IPSDS       SDS
     I***********                           247 249 WSID                  S01486
     I                                      244 253 WSID                  S01486
     I                                      254 263 USID                  S01486
     I*
     I***EXTERNAL*FORMATS*FOR*GROUP*DATA*AREA**************************   S01486
     I***WWGDA*****E*DSPMGRDAPP                                           S01486
     I*
     I***WWLDA*****E*DSPMLDAPP                                            S01486
     IWWLDA     E DSPMLDAPD                                               S01486
     I*                                                                   S01486
     IZMUSER      DS                             17                       S01486
     I**  Data Area of menu user                                          S01486
     I                                       11  13 USRBCH                S01486
     I*                                                                   S01486
     IRUNDAT    E DS                                                      S01486
     I**  Standard Data Area Layout for System flags and Run Date         S01486
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I**  Midas Bank details                                              S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I**  Midas Currencies details                                        S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I**  Short data structure                                            S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I**  Long data structure                                             S01486
     I*                                                                   S01486
     I/COPY ZSRSRC,ZHOLI                                                  S01486
     I*                                                                   S01486
     C*****************************************************************
      /EJECT
     C*****************************************************************
      ** INDEX OF SUBROUTINES
      *
      ** INIT   - INITIAL PROCESSING
      ** P01    - ACCESS ACCOUNT MOVEMENTS
      ***LSUBF**- LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         R10055
      ** LSUBFP - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         R10055
      **          IN POSTING DATE DESCENDING SEQUENCE                     R10055
      ** LSUBFV - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         R10055
      **          IN VALUE DATE DESCENDING SEQUENCE                       R10055
      ** WACMD  - FORMAT FIELDS FOR ACCOUNT MOVEMENT 'DETAIL' RECORD      R10055
      ** CCYDET - ACCESS CURRENCY DETAILS
      ***ENDPRC*-*UPDATE*GDA,*TERMINATE*PROCESS************************   S01486
      ** ENDPRC - UPDATE *LDA, TERMINATE PROCESS                          S01486
      ** ZDATE2 - STANDARD SUBROUTINE TO FORMAT DATE
      ** ZSEDIT - STANDARD SUBROUTINE TO FORMAT AMOUNT
      ** *PSSR  - STANDARD ERROR SUBROUTINE
      *                                                                  *
      ** EXTERNAL ROUTINES CALLED                                        *
      ***PMC1002**-*UPDATE*GROUP*JOB*DATA*AREA*************************   S01486
      ***PMC1003**-*READ*GROUP*JOB*DATA*AREA***************************   S01486
      ***QCMDEXC**-*EXEC*AS/400*COMMAND********************************   S01486
      ***PMC1020**-*TERMINATE*GROUP*JOB********************************   S01486
      ** PMC1001  - UPDATE DATA AREA *LDA                                 S01486
      ** PMC1003  - READ DATA AREA *LDA                                   S01486
      **                                                                  S01486
     C*****************************************************************
      /EJECT
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C*****************************************************************
     C*  WORK FIELDS
     C*****************************************************************
     C*****************************************************************
     C*  ACCESS KEYS
     C*****************************************************************
     C           KACCN     KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCA                            085862
     C*
     C***KEY*TO*ACCESS*HPOSTL1*****                                R10055 R01149
     C***KEY*TO*ACCESS*HPOSTL6*****                                R01149 R0111
     C***KEY*TO*ACCESS*HPOSTL8************************************* R0111 S01486
     C********** KAPOS *** KLIST                                          R10055
     C           KHPOS1    KLIST                                          R10055
     C                     KFLD           BRCA                            S01486
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C********             KFLD           LSTD                            R10048
     C                     KFLD           PSTD                            R10048
     C*********************KFLD           PSTA                     R10055 R0645
     C                     KFLD           PSTA                      R0645 R0821
     C                     KFLD           DRCR                            R10048
     C*
     C***KEY*TO*ACCESS*HPOSTL5*****                                R10055 R0111
     C***KEY*TO*ACCESS*HPOSTL7************************************* R0111 S01486
     C           KHPOS5    KLIST                                          R10055
     C                     KFLD           BRCA                            S01486
     C                     KFLD           CNUM                            R10055
     C                     KFLD           CCY                             R10055
     C                     KFLD           ACOD                            R10055
     C                     KFLD           ACSQ                            R10055
     C                     KFLD           VALD                            R10055
     C                     KFLD           PSTA                            R10055
     C                     KFLD           DRCR                            R10055
     C*****************************************************************
     C*  P R O G R A M     S T A R T
     C*****************************************************************
     C*
     C                     EXSR INIT
     C                     EXSR P01
     C                     RETRN
     C*
     C*****************************************************************
     C*  P R O G R A M     E N D
     C*****************************************************************
      /EJECT
     C*****************************************************************
      *
      ** INIT   - INITIAL PROCESSING
      *
      ** CALLED FROM:
      ** MAIN   -
      *
      ** CALLS:
      *
     C*****************************************************************
     C           INIT      BEGSR                           * INIT   BSR *
     C*
     C** RECEIVE PARAMETERS FROM CALLING PROGRAM
     C           *ENTRY    PLIST
     C******************** PARM           DDCCY                           R01149
     C******************** PARM           DDACOD                          R01149
     C******************** PARM           DDACSQ                          R01149
     C                     PARM           WWACCU  6                       CPM004
     C                     PARM           WWCCYP  3                       R01149
     C**********           PARM           WWCODP  4                                    R01149 CGL029
     C                     PARM           WWCODP 10                                           CGL029
     C                     PARM           WWSEQP  2                       R01149
     C                     PARM           WWBRCA  3                       085862
     C*
     C***RECEIVE*PARAMETERS*FROM*GROUP*DATA*AREA***********************   S01486
     C**  Receive parameters from data area  *LDA                         S01486
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
     C*
     C***IF*ATTENTION*KEY*ENABLED*SET*THE*ATTENTION*PROGRAM*TO*PMC0610*   S01486
     C***********QMATTN    IFEQ 'Y'                                       S01486
     C***********          MOVEAATN       WWFLD  22                       S01486
     C***********          Z-ADD22        WWNUMB 155                      S01486
     C***********          CALL 'QCMDEXC'                                 S01486
     C***********          PARM           WWFLD                           S01486
     C***********          PARM           WWNUMB                          S01486
     C***********          END                                            S01486
     C*
     C** SET INDICATOR TO FORMAT DATES IN DDMMMYY
     C                     MOVE '0'       *IN98                           PMC162
     C*                                                                   R01149
     C** PREPARE FORMAT OF ACCOUNT CODE TO BE DISPLAYED                   R01149
     C***********          MOVE '-'       DDSEP1                    R01149085862
     C                     MOVE WWACCU    DDACCU                          CPM004
     C                     MOVE WWCCYP    DDCCY                           R01149
     C***********          MOVE '-'       DDSEP2                    R01149085862
     C                     MOVE WWCODP    DDACOD                          R01149
     C***********          MOVE '-'       DDSEP3                    R01149085862
     C                     MOVE WWSEQP    DDACSQ                          R01149
     C                     MOVE WWBRCA    DDBRCA                          085862
     C*                                                                   R05897
     C** CALCULATE DATE OF LAST WORKING DAY                               R05897
     C***********1         SETLLSDBANKL0                           R05897 S01486
     C***********          READ SDBANKL0                 66        R05897 S01486
     C*                                                                   S01486
     C**  Access bank details.                                            S01486
     C*                                                                   S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST'  P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD1         QMERRN           ***************S01486
     C                     MOVE 'SDBANKPD'QMFILE           *DB ERROR 001 *S01486
     C                     MOVEL'*FIRST'  QMKEY            ***************S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     Z-ADD1         ZNRDYS                          R05897
     C                     MOVE BJLCCY    ZCCY                            R05897
     C                     Z-ADDQMRDNB    ZDAYNO                          R05897
     C***********          EXSR ZBACK                              R05897 S01486
     C                     MOVE *BLANKS   ZLOC                            S01486
     C                     EXSR ZBKDT                                     S01486
     C                     Z-ADDZDYNBR    WWLRUN  50                      R05897
     C*                                                                   059191
     C** DEFINE DATA AREA PMSTAT                                          059191
     C           *NAMVAR   DEFN           PMSTAT                          059191
     C                     IN   PMSTAT                                    059191
     C*                                                                   S01486
     C**  Read in DTAARA/RUNDAT to get multibranching indicator           S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           RUNDAT                          S01486
     C                     IN   RUNDAT                                    S01486
     C*                                                                   S01486
     C**   Read in ZMUSER                                                 S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           ZMUSER                          S01486
     C                     IN   ZMUSER                                    S01486
     C*                                                                   S01486
     C**  Set up parameter to retrieve message from message file          S01486
     C*                                                                   S01486
     C           PLLANG    PLIST                                          S01486
     C                     PARM           MSMBR4  7                       S01486
     C                     PARM           MSGER  10                       S01486
     C                     PARM           MSGTXT 80                       S01486
     C                     MOVEL'PMUSRMSG'MSGER                           S01486
     C*                                                                   S01486
     C**  Check if multi-branch indicator is ON                           S01486
     C*                                                                   S01486
     C           AGMBIN    IFEQ 'Y'                                       S01486
     C                     MOVE '1'       *IN35                           S01486
     C***********          MOVELUSRBCH    DDBRCA                    S01486092517
     C*                                                                   S01486
     C**  Validate user's default booking branch                          S01486
     C*                                                                   S01486
     C                     CALL 'ZVBBU'                                   S01486
     C***********          PARM USRBCH    P@BRCH  3                 S01486092517
     C                     PARM DDBRCA    P@BRCH  3                       092517
     C                     PARM *ZEROS    P@ERCD  10                      S01486
     C*                                                                   S01486
     C           P@ERCD    IFNE 0                                         S01486
     C*                                                                   S01486
     C           P@ERCD    IFEQ 1                                         S01486
     C                     MOVEL'PM00307' MSMBR4                          S01486
     C                     CALL 'SDRTVTXT'PLLANG                          S01486
     C                     MOVELMSGTXT    DDMSG                           S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C           P@ERCD    IFEQ 2                                         S01486
     C                     MOVEL'PM00308' MSMBR4                          S01486
     C                     CALL 'SDRTVTXT'PLLANG                          S01486
     C                     MOVELMSGTXT    DDMSG                           S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C           *IN03     DOUEQ'1'                                       S01486
     C           *IN12     OREQ '1'                                       S01486
     C                     EXFMTPM2120F1                                  S01486
     C                     ENDDO                                          S01486
     C*                                                                   S01486
     C           *IN03     IFEQ '1'                                       S01486
     C                     EXSR ENDPRC                                    S01486
     C                     ENDIF                                          S01486
     C*
     C           *IN12     IFEQ '1'                                       S01486
     C                     RETRN                                          S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C                     ENDIF                                          S01486
     C                     ENDIF                                          S01486
      *                                                                   064752
     C                     SETON                     53                   064752
     C*
     C                     ENDSR                           * INIT   ESR *
     C*****************************************************************
      /EJECT
     C*****************************************************************
      *
      ** P01    - ACCESS ACCOUNT MOVEMENTS
      *
      ** CALLED FROM:
      ** MAIN   -
      *
      ** CALLS:
      ** *PSSR  - STANDARD ERROR SUBROUTINE
      ***LSUBF**- LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         R10055
      ** LSUBFP - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         R10055
      **          IN POSTING DATE DESCENDING SEQUENCE                     R10055
      ** LSUBFV - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         R10055
      **          IN VALUE DATE DESCENDING SEQUENCE                       R10055
      ** CCYDET - ACCESS CURRENCY DETAILS
      ***ENDPRC*-*UPDATE*GDA,*TERMINATE*PROCESS************************   S01486
      ** ENDPRC - UPDATE *LDA, TERMINATE PROCESS                          S01486
      *
     C*****************************************************************
     C           P01       BEGSR                           * P01    BSR *
     C*
     C***********          MOVE QMCNUM    CNUM                            CPM004
     C                     MOVE WWACCU    CNUM                            CPM004
     C                     MOVE DDCCY     CCY
     C                     MOVE DDACOD    ACOD
     C                     MOVE DDACSQ    ACSQ
     C                     MOVE DDBRCA    BRCA                            085862
     C**********           Z-ADDCNUM      WWCNUM  60                                   R10055 CSD027
     C                     MOVE CNUM      WWCNUM  6                                           CSD027
     C                     MOVE CCY       WWCCY   3                       R10055
     C**********           Z-ADDACOD      WWACOD  40                                   R10055 CGL029
     C                     Z-ADDACOD      WWACOD 100                                          CGL029
     C                     Z-ADDACSQ      WWACSQ  20                      R10055
     C                     MOVE BRCA      WWBRCA  3                       085862
     C           KACCN     SETLLACCNT
     C           KACCN     READEACCNT                    70
     C*
     C           *IN70     IFEQ '1'                        ***************
     C                     Z-ADD1         QMERRN           * DB ERROR 01 *
     C                     MOVE 'ACCNT  ' QMFILE           ***************
     C                     MOVE KACCDS    QMKEY
     C                     EXSR *PSSR
     C                     END
     C*                                                                   R05661
     C** FOR 9998 AND 9999 PORTFOLIOS OUTPUT ADDITIONAL REFERENCE         R05661
     C           QMPTF1    IFEQ '9998'                                    R05661
     C           QMPTF1    OREQ '9999'                                    R05661
     C                     MOVE '1'       *IN17                           R05661
     C                     MOVEL'('       WWWRK5  5                       R05661
     C           PTFR      IFEQ '9997'                                    R05661
     C                     MOVE QMR997    WWWRK5                          R05661
     C                     ELSE                                           R05661
     C                     MOVE PTFR      WWWRK5                          R05661
     C                     END                                            R05661
     C                     MOVELWWWRK5    DDPTF1                          R05661
     C                     MOVE ')'       DDPTF1                          R05661
     C                     ELSE                                           R05661
     C                     MOVE '0'       *IN17                           R05661
     C                     MOVE *BLANKS   DDPTF1                          R05661
     C                     END                                            R05661
     C*
     C                     EXSR CCYDET
     C                     Z-ADDA6NBDP    ZDECS                           R10055
     C                     MOVE 'J'       ZECODE                          R10055
     C*
     C******************** EXSR LSUBF                                     R10055
     C*
     C                     MOVE '0'       WWSBFP  1                       R10055
     C                     MOVE '0'       WWSBFV  1                       R10055
     C*                                                                   R01149
     C** RESET TABLES                                                     R01149
     C                     Z-ADD0         TB0                             R01149
     C                     Z-ADD0         TB1                             R01149
     C*
     C** FILL IN SCREEN FIELDS, DISPLAY HEADER
     C******************** MOVE BRCD      DDBRCD                   R01149 S01486
     C                     MOVE BRCA      DDBRCA                          S01486
     C                     MOVE ANAM      DDANAM
     C                     MOVE QMCNUM    DDCNUM
     C                     MOVELQMCRNM    DDCRNM
     C                     MOVE QMPTF2    DDPTFR
     C                     MOVELQMPTFN    DDPTFN
     C                     MOVE QMRUNA    DDRUNA                          PMC162
     C******************** WRITETITLE                                     R10055
     C*
     C** TEST TRADE/VALUE DATE POSTINGS INDICATOR FROM DTAARA/*LDA        R10055
     C** IF 'T' THEN LOAD SUBFILE IN POSTING DATE SEQUENCE                R10055
     C** IF 'V' THEN LOAD SUBFILE IN VALUE DATE SEQUENCE                  R10055
     C           QMTVPS    IFEQ 'T'                                       R10055
     C                     EXSR LSUBFP                                    R10055
     C                     MOVE 'P'       WWDISP  1                       R10055
     C                     Z-ADD1         WWRRN0  40
     C                     ELSE                                           R10055
     C                     EXSR LSUBFV                                    R10055
     C                     MOVE 'V'       WWDISP                          R10055
     C                     Z-ADD1         WWRRN1  40
     C                     END                                            R10055
     C*
     C************IN03     DOUEQ'1'                                       081239
     C************IN12     OREQ '1'                                       081239
     C           QMENQT    DOUEQ'Y'                                       081239
     C           QMENQT    OREQ 'C'                                       081239
     C           QMENQT    OREQ 'P'                                       081239
     C           QMENQT    OREQ 'D'                                       081239
     C           *INKL     OREQ '1'                                       081239
     C*
     C***********WWSAVE****IFGT 14                                        33615
     C*********************MOVE '1'       *IN13                           33615
     C*********************ELSE                                           33615
     C*********************MOVE '0'       *IN13                           33615
     C*********************END                                            33615
     C*                                                                   33615
     C** READ THROUGH SUBFILE AND OUTPUT '+' WHEN POSTING DEATILS         33615
     C** EXIST ON PREVIOUS OR LATER SCREENS                               33615
     C           WWSAVE    IFGT 0                          B2             33615
     C*                                                                   33615
     C** CALCULATE NUMBER OF PAGES TO BE DISPLAYED AND NUMBER OF LINES    33615
     C** ON LAST PAGE OF ENQUIRY                                          33615
     C***********WWSAVE    DIV  14        WWPAGE  30               33615  S01486
     C           WWSAVE    DIV  12        WWPAGE  30                      S01486
     C                     MVR            WWRMDR  30                      33615
     C*                                                                   33615
     C           WWRMDR    IFEQ 0                                         33624
     C           WWPAGE    SUB  1         WWPAGF  30                      33624
     C                     ELSE                                           33624
     C                     Z-ADDWWPAGE    WWPAGF                          33624
     C                     END                                            33624
     C*                                                                   33624
     C                     Z-ADD1         WWINDX  30                      33615
     C*
     C           WWINDX    DOWLEWWPAGE                     B3             33615
     C*                                                                   33615
     C** IF NOT FIRST PAGE OF SCREEN OUTPUT A '+' ON THE FIRST LINE OF    33615
     C** THE SCREEN TO INDICATE THAT POSTINGS EXIST ON PREVIOUS SCREENS   33615
     C           WWINDX    IFLE WWPAGF                                    33624
     C***********WWINDX    MULT 14        WWCALC  50               33615  S01486
     C           WWINDX    MULT 12        WWCALC  50                      S01486
     C           WWCALC    ADD  1         WWCALC                          33615
     C*                                                                   33615
     C           WWDISP    IFEQ 'P'                        B4             33625
     C           WWCALC    CHAINPM2120S0             13                   33625
     C                     MOVE DDIN50    *IN50                           33625
     C                     MOVE '+'       DDCRSS                          33625
     C                     UPDATPM2120S0                                  33625
     C                     ELSE                            X4             33625
     C           WWCALC    CHAINPM2120S1             13                   33625
     C                     MOVE DDIN50    *IN50                           33625
     C                     MOVE '+'       DDCRSS                          33625
     C                     UPDATPM2120S1                                  33625
     C                     END                             E4             33625
     C                     END                             E4             33624
     C*                                                                   33615
     C** OUTPUT A '+' AT THE END OF THE PAGE                              33615
     C           WWINDX    IFLT WWPAGE                     B4             33625
     C           WWRMDR    ORNE 0                                         33625
     C***********WWINDX    MULT 14        WWCALC                   33615  S01486
     C           WWINDX    MULT 12        WWCALC                          S01486
     C           WWDISP    IFEQ 'P'                        B5             33625
     C           WWCALC    CHAINPM2120S0             13                   33625
     C                     MOVE DDIN50    *IN50                           33625
     C                     MOVE '+'       DDCRSS                          33625
     C                     UPDATPM2120S0                                  33625
     C                     ELSE                            X5             33625
     C           WWCALC    CHAINPM2120S1             13                   33625
     C                     MOVE DDIN50    *IN50                           33625
     C                     MOVE '+'       DDCRSS                          33625
     C                     UPDATPM2120S1                                  33625
     C                     END                             E5             33625
     C                     END                             E4             33625
     C                     ADD  1         WWINDX  30                      33615
     C                     END                             E3             33625
     C*                                                                   33625
     C                     END                             E2             33625
     C                     MOVE ' '       DDCRSS                          33625
     C                     Z-ADD0         WWSAVE                          33625
     C*                                                                   R10055
     C** DISPLAY ACCOUNT MOVEMENTS IN POSTING DATE SEQUENCE               R10055
     C           WWDISP    IFEQ 'P'                                       R10055
     C*                                                                   R10055
     C** INITIALISE TITLE                                                 R10055
     C                     MOVE 'POSTING' DDPVDT                          R10055
     C                     WRITETITLE                                     R10055
     C*                                                                   B9899
     C****                 Z-ADD1         WWRRNA                    B9899 059191
     C*                                                                   B9899
     C                     EXFMTPM2120C0
     C*                                                                   R10055
     C           *IN09     IFEQ '1'                                       R10055
     C           WWSBFV    IFEQ '0'                                       R10055
     C                     EXSR LSUBFV                                    R10055
     C                     END                                            R10055
     C                     MOVE 'V'       WWDISP                          R10055
     C                     Z-ADD1         WWRRN1
     C                     END                                            R10055
     C*                                                                   R10055
     C** DISPLAY ACCOUNT MOVEMENTS IN VALUE DATE SEQUENCE                 R10055
     C                     ELSE                                           R10055
     C*                                                                   R10055
     C** INITIALISE TITLE                                                 R10055
     C                     MOVE '  VALUE' DDPVDT                          R10055
     C                     WRITETITLE                                     R10055
     C*                                                                   B9899
     C****                 Z-ADD1         WWRRNB                    B9899 059191
     C*                                                                   B9899
     C           WWRRNB    IFGT 0                                         064752
     C                     SETON                     55                   064752
     C                     ELSE                                           064752
     C                     SETOF                     55                   064752
     C                     END                                            064752
     C*                                                                   064752
     C                     EXFMTPM2120C1                                  R10055
     C*
     C           *IN09     IFEQ '1'                                       R10055
     C           WWSBFP    IFEQ '0'                                       R10055
     C                     EXSR LSUBFP                                    R10055
     C                     END                                            R10055
     C                     MOVE 'P'       WWDISP                          R10055
     C                     Z-ADD1         WWRRN0
     C                     END                                            R10055
     C*
     C                     END                                            R10055
     C**********                                                    S01486CPM005
     C****If*F22 is pressed, access Enquiry Selection Screen        S01486CPM005
     C**********                                                    S01486CPM005
     C********** *INKW     IFEQ '1'                                 S01486CPM005
     C**********           CALL 'PMC0610'                           S01486CPM005
     C**********                                                    081239CPM005
     C***Retrieve *LDA values                                       081239CPM005
     C**********                                                    081239CPM005
     C**********           CALL 'PMC1003'                           081239CPM005
     C**********           PARM           WWLDA                     081239CPM005
     C**********           ENDIF                                    S01486CPM005
     C*
     C           *IN03     IFEQ '1'
     C                     MOVEL'Y'       QMENQT                          081239
     C                     EXSR ENDPRC
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           * P01    ESR *
     C*****************************************************************
      /EJECT
     C*****************************************************************
      *
      ** CCYDET - ACCESS CURRENCY DETAILS
      *
      ** CALLED FROM:
      ** P01    - ACCESS ACCOUNT MOVEMENTS
      *
      ** CALLS:
      ** *PSSR  - STANDARD ERROR SUBROUTINE
      *
     C*****************************************************************
     C           CCYDET    BEGSR                           * CCYDET BSR *
     C*
     C***********DDCCY     CHAINSDCURRL0             70                   S01486
     C***********                                                         S01486
     C************IN70     IFEQ '1'                        ***************S01486
     C***********          Z-ADD2         QMERRN           * DB ERROR 02 *S01486
     C***********          MOVE 'SDCURRL0'QMFILE           ***************S01486
     C***********          MOVE DDCCY     QMKEY                           S01486
     C*                                                                   S01486
     C**  Access currency details.                                        S01486
     C*                                                                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   P@RTCD                          S01486
     C                     PARM '*KEY  '  P@OPTN                          S01486
     C                     PARM DDCCY     P@CYCD  3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C                     Z-ADD2         QMERRN           ***************S01486
     C                     MOVE 'SDCURRPD'QMFILE           *DB ERROR 002 *S01486
     C                     MOVELP@CYCD    QMKEY            ***************S01486
     C                     EXSR *PSSR
     C                     END
     C*
     C                     ENDSR                           * CCYDET ESR *
     C*****************************************************************
      /EJECT
     C*                                                                   R10055
     C** SR/LSUBF SUPPRESSED AND REPLACED BY SR/LSUBFP AND SR/LSUBFV      R10055
     C*                                                                   R10055
     C*****************************************************************
      *
      ** LSUBF  - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT
      *
      ** CALLED FROM:
      ** P01    - ACCESS ACCOUNT MOVEMENTS
      *
      ** CALLS:
      ** ZDATE2 -
      ** ZSEDIT -
      *
     C*****************************************************************
     C********** LSUBF *** BEGSR                           * LSUBF  BSR * R10055
     C*
     C** INITIALIZE SUBFILE
     C*
     C********             Z-ADD1         WWRRN   30                      R10048
     C******************** Z-ADD0         WWRRN   30               R10048 R10055
     C******************** MOVE '0'       *IN51                    R10048 R10055
     C******************** WRITEPM2120C0                                  R10055
     C******************** MOVE '1'       *IN51                           R10055
     C*
     C** FIRST RECORD DISPLAYS THE BROUGHT FORWARD BALANCE
     C********** CFSB **** IFLT 0                                  R10048 R10055
     C******************** Z-SUBCFSB      ZFLD15                   R10048 R10055
     C******************** ELSE                                    R10048 R10055
     C******************** Z-ADDCFSB      ZFLD15                   R10048 R10055
     C******************** END                                     R10048 R10055
     C*                                                                   R10048
     C******************** Z-ADDA6NBDP    ZDECS                           R10055
     C******************** MOVE 'J'       ZECODE                          R10055
     C******************** EXSR ZSEDIT                                    R10055
     C******************** MOVELZOUT21    DDPSTA                          R10055
     C*
     C********** CFSB **** IFGT 0                                         R10055
     C******************** MOVE 'DR'      DDPSTA                          R10055
     C******************** ELSE                                           R10055
     C******************** MOVE 'CR'      DDPSTA                          R10055
     C******************** END                                            R10055
     C*
     C******************** MOVELTXT,1     DDPNAR                          R10055
     C*
     C******************** Z-ADD1         WWRRN   30               R10048 R10055
     C******************** WRITEPM2120S0                                  R10055
     C******************** ADD  1         WWRRN                           R10055
     C*
     C******************** Z-ADD0         DRCR                            R10055
     C******************** Z-ADD0         PSTD                     R10048 R10055
     C******************** Z-ADDCNUM      WWCNUM  60               R10048 R10055
     C******************** MOVE CCY       WWCCY   3                R10048 R10055
     C******************** Z-ADDACOD      WWACOD  40               R10048 R10055
     C******************** Z-ADDACSQ      WWACSQ  20               R10048 R10055
     C********** KAPOS *** SETLLAPOST                                     R10055
     C******     KACCN     READEAPOST                    70               R10048
     C******************** READ APOST                    70        R10048 R10055
     C*
     C********** *IN70 *** DOWEQ'0'
     C********** CNUM **** ANDEQWWCNUM                             R10048 R10055
     C********** CCY ***** ANDEQWWCCY                              R10048 R10055
     C********** ACOD **** ANDEQWWACOD                             R10048 R10055
     C********** ACSQ **** ANDEQWWACSQ                             R10048 R10055
     C*
     C** FORMAT POSTING DATE
     C******************** Z-ADDPSTD      ZDAYNO                          R10055
     C******************** EXSR ZDATE2                                    R10055
     C******************** MOVELZADATE    DDPSTD                          R10055
     C*
     C** FORMAT VALUE DATE
     C******************** Z-ADDVALD      ZDAYNO                          R10055
     C******************** EXSR ZDATE2                                    R10055
     C******************** MOVELZADATE    DDVALD                          R10055
     C*
     C** FORMAT POSTING AMOUNT
     C******************** Z-ADDPSTA      ZFLD15                          R10055
     C******************** EXSR ZSEDIT                                    R10055
     C******************** MOVELZOUT21    DDPSTA                          R10055
     C*
     C********** DRCR **** IFEQ 0                                         R10055
     C******************** MOVE 'DR'      DDPSTA                          R10055
     C******************** ELSE                                           R10055
     C******************** MOVE 'CR'      DDPSTA                          R10055
     C******************** END                                            R10055
     C*
     C******************** MOVE PNAR      DDPNAR                          R10055
     C*
     C** ADD RECORD TO SUBFILE, READ NEXT RECORD IN FILE
     C******************** WRITEPM2120S0                                  R10055
     C******************** ADD  1         WWRRN                           R10055
     C********   KACCN     READEAPOST                    70               R10048
     C******************** READ APOST                    70        R10048 R10055
     C******************** END                                            R10055
     C*
     C** SUBFILE END INDICATOR
     C******************** MOVE '1'       *IN52                           R10055
     C*
     C******************** ENDSR                           * LSUBF  ESR * R10055
     C*****************************************************************   059191
      ****CT                                                              059191
     C*****************************************************************   059191
      ****                                                                059191
      ****SUBFP - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         059191
      ****        IN POSTING DATE DESCENDING SEQUENCE                     059191
      ****                                                                059191
      ****ALLED FROM:                                                     059191
      ****01    - ACCESS ACCOUNT MOVEMENTS                                059191
      ****                                                                059191
      ****ALLS:                                                           059191
      ****ACMD  - FORMAT FIELDS FOR ACCOUNT MOVEMENT 'DETAIL' RECORD      059191
      ****                                                                059191
     C*****************************************************************   059191
     C****       LSUBFP    BEGSR                           * LSUBFP BSR * 059191
     C****                                                                059191
     C****                 MOVE 'N'       WWLAST                          059191
     C****                 MOVE 'N'       WWBALT  1                       059191
     C****                 MOVE 'T'       WWTVDA  1                       059191
     C****                                                                059191
     C****NITIALISE SUBFILE                                               059191
     C****                 Z-ADD0         WWRRN0                          059191
     C****                 MOVE '0'       *IN51                           059191
     C****                 WRITEPM2120C0                                  059191
     C****                 MOVE '1'       *IN51                           059191
     C****                                                                059191
     C****                 Z-ADD0         WWPDAT  50                      059191
     C****                 Z-ADD0         WWBAL  180                      059191
     C****                                                                059191
     C****ET LOWER LIMITS ON LF/HPOSTL8                                   059191
     C****                 Z-ADDWWCNUM    CNUM                            059191
     C****                 MOVE WWCCY     CCY                             059191
     C****                 Z-ADDWWACOD    ACOD                            059191
     C****                 Z-ADDWWACSQ    ACSQ                            059191
     C****                 Z-ADD0         PSTD                            059191
     C****                 Z-ADD0         PSTA                            059191
     C****                 Z-ADD0         DRCR                            059191
     C****       KHPOS1    SETLLHPOSTL8                                   059191
     C****                                                                059191
     C****IRST READ OF LF/HPOSTL6                                         059191
     C****                 READ HPOSTL8                  70               059191
     C****                                                                059191
     C****O WHILE NOT END OF FILE AND SAME CUSTOMER, SAME CURRENCY,       059191
     C****AME ACCOUNT CODE & SAME ACCOUNT SEQUENCE ARE BEING PROCESSED    059191
     C****       *IN70     DOWEQ'0'                        B1             059191
     C****       CNUM      ANDEQWWCNUM                                    059191
     C****       CCY       ANDEQWWCCY                                     059191
     C****       ACOD      ANDEQWWACOD                                    059191
     C****       ACSQ      ANDEQWWACSQ                                    059191
     C****                                                                059191
     C****IRST RECORD:                                                    059191
     C****RITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = 0            059191
     C****ND POSTING DATE = POSTING DATE FROM HPOSTL6 - 1                 059191
     C****       WWRRN0    IFEQ 0                          B2             059191
     C****                 MOVE *BLANKS   DDPSTD                          059191
     C****                 MOVE *BLANKS   DDVALD                          059191
     C****                 SUB  1         PSTD                            059191
     C****                 MOVE PSTD      ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 ADD  1         PSTD                            059191
     C****                 MOVE *BLANKS   WWCRDT                          059191
     C****                 MOVE *BLANKS   WWDEBT                          059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C****                 Z-ADD0         DDAMNT                          059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C****                 ADD  1         WWRRN0                          059191
     C****                                                                059191
     C****       WWCRDT    IFEQ *BLANKS                    B3             059191
     C****       ZDECS     IFEQ 0                          B4             059191
     C****                 MOVE '0 '      WWCRDT                          059191
     C****                 END                             E4             059191
     C****       ZDECS     IFEQ 1                          B4             059191
     C****                 MOVE '0.0 '    WWCRDT                          059191
     C****                 END                             E4             059191
     C****       ZDECS     IFEQ 2                          B4             059191
     C****                 MOVE '0.00 '   WWCRDT                          059191
     C****                 END                             E4             059191
     C****       ZDECS     IFEQ 3                          B4             059191
     C****                 MOVE '0.000 '  WWCRDT                          059191
     C****                 END                             E4             059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 WRITEPM2120S0                                  059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                                                                059191
     C****AVE THE RRN IN A TABLE                                          059191
     C****                 Z-ADD1         X       30                      059191
     C****                 Z-ADDWWRRN0    TB0,X                           059191
     C****                 END                             E2             059191
     C****                                                                059191
     C****O WHILE SAME CONDITIONS AS BEFORE                               059191
     C****    AND POSTING DATE SAME AS PREVIOUS POSTING DATE              059191
     C****       *IN70     DOWEQ'0'                        B2             059191
     C****       CNUM      ANDEQWWCNUM                                    059191
     C****       CCY       ANDEQWWCCY                                     059191
     C****       ACOD      ANDEQWWACOD                                    059191
     C****       ACSQ      ANDEQWWACSQ                                    059191
     C****       PSTD      ANDEQWWPDAT                                    059191
     C****                                                                059191
     C****RITE ACCOUNT MOVEMENT 'DETAIL' RECORD ON THE SUBFILE            059191
     C****                 EXSR WACMD                                     059191
     C****                 ADD  1         WWRRN0                          059191
     C****                 MOVE 'Y'       WWBALT  1                       059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 WRITEPM2120S0                                  059191
     C****                                                                059191
     C****       DRCR      IFEQ 0                          B3             059191
     C****                 ADD  PSTA      WWBAL                           059191
     C****                 ELSE                            X3             059191
     C****                 SUB  PSTA      WWBAL                           059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 READ HPOSTL8                  70               059191
     C****                                                                059191
     C****F END OF PROCESS FOR THIS ACCOUNT SET POSTING DATE =9999        059191
     C****       *IN70     IFEQ '1'                        B3             059191
     C****       CNUM      ORNE WWCNUM                                    059191
     C****       CCY       ORNE WWCCY                                     059191
     C****       ACOD      ORNE WWACOD                                    059191
     C****       ACSQ      ORNE WWACSQ                                    059191
     C****                 MOVE 'Y'       WWLAST  1                       059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****ND LOOP ON SAME POSTING DATE                                    059191
     C****                 END                             E2             059191
     C****                                                                059191
     C****OW PROCESS BREAK ON POSTING DATE                                059191
     C****ONLY IF SAME ACCOUNT YET READ                                   059191
     C****REVIOUS POSTING DATE IS LESS THAN RUN DATE                      059191
     C****ND POSTING DATE READ IS GREATER THAN OR EQUAL TO RUN DATE       059191
     C****       WWPDAT    IFLT QMRDNB                     B2             059191
     C****       PSTD      ANDGEQMRDNB                                    059191
     C****       WWLAST    OREQ 'Y'                                       059191
     C****                                                                059191
     C****RITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = LEDGER BAL.  059191
     C****                 MOVE *BLANK    DDPSTD                          059191
     C****                 MOVE *BLANK    DDVALD                          059191
     C****                                                                059191
     C****       LDBL      IFLT 0                          B3             059191
     C****                 Z-SUBLDBL      ZFLD15                          059191
     C****                 EXSR ZSEDIT                                    059191
     C****                 MOVE ZOUT21    WWCRDT                          059191
     C****                                                                059191
     C****       WWCRDT    IFEQ *BLANKS                    B4             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWCRDT                          059191
     C****                 END                                            059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWDEBT                          059191
     C****                 ELSE                            X3             059191
     C****                 Z-ADDLDBL      ZFLD15                          059191
     C****                 EXSR ZSEDIT                                    059191
     C****                 MOVE ZOUT21    WWDEBT                          059191
     C****                                                                059191
     C****       WWDEBT    IFEQ *BLANKS                    B4             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWDEBT                          059191
     C****                 END                                            059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWCRDT                          059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 MOVE WWPDAT    ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C****                 Z-ADD0         DDAMNT                          059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C****                 ADD  1         WWRRN0                          059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 WRITEPM2120S0                                  059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                                                                059191
     C****                 SUB  LDBL      WWBAL                           059191
     C****                 Z-ADD1         X                               059191
     C****                 Z-ADDWWRRN0    WWSAVE  30                      059191
     C****                                                                059191
     C****       TB0,X     DOWNE0                          B3             059191
     C****       TB0,X     CHAINPM2120S0             70                   059191
     C****                 SUB  WWBAL     DDAMNT                          059191
     C****                                                                059191
     C****       DDAMNT    IFLT 0                          B4             059191
     C****                 Z-SUBDDAMNT    ZFLD15                          059191
     C****                 EXSR ZSEDIT                                    059191
     C****                 MOVE ZOUT21    WWCRDT                          059191
     C****                                                                059191
     C****       WWCRDT    IFEQ *BLANKS                    B5             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWCRDT                          059191
     C****                 END                                            059191
     C****                 END                             E5             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWDEBT                          059191
     C****                 ELSE                            X4             059191
     C****                 Z-ADDDDAMNT    ZFLD15                          059191
     C****                 EXSR ZSEDIT                                    059191
     C****                 MOVE ZOUT21    WWDEBT                          059191
     C****                                                                059191
     C****       WWDEBT    IFEQ *BLANKS                    B5             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWDEBT                          059191
     C****                 END                                            059191
     C****                 END                             E5             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWCRDT                          059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****       DDTYPR    IFEQ 'B'                        B4             059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 ELSE                            X4             059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 UPDATPM2120S0                                  059191
     C****                 ADD  1         X                               059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 Z-ADDWWSAVE    WWRRN0                          059191
     C****                 Z-ADDLDBL      WWBAL                           059191
     C****                 END                             E2             059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                                                                059191
     C****OTH PREVIOUS POSTING DATE AND POSTING DATE READ                 059191
     C****RE LESS THAN RUN DATE                                           059191
     C****       WWPDAT    IFLT QMRDNB                     B2             059191
     C****       PSTD      ANDLTQMRDNB                                    059191
     C****       WWRRN0    ANDGT1                                         059191
     C****       WWBALT    ANDEQ'Y'                                       059191
     C****                                                                059191
     C****RITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = WWBAL        059191
     C****ND POSTING DATE = PREVIOUS POSTING DATE                         059191
     C****                 MOVE *BLANK    DDPSTD                          059191
     C****                 MOVE *BLANK    DDVALD                          059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 Z-ADDWWPDAT    ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C****                 Z-ADDWWBAL     DDAMNT                          059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C****                 ADD  1         WWRRN0                          059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 WRITEPM2120S0                                  059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                 ADD  1         X                               059191
     C****                 Z-ADDWWRRN0    TB0,X                           059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 END                             E2             059191
     C****                                                                059191
     C****OF FOR THIS PROCESS:                                            059191
     C****REVIOUS POSTING DATE AND POSTING DATE READ                      059191
     C****RE GREATER THAN OR EQUAL TO RUN DATE                            059191
     C***********WWPDAT    IFGE QMRDNB                     B2             059191
     C***********PSTD      ANDGEQMRDNB                                    059191
     C****       WWLAST    IFEQ 'Y'                                       059191
     C****       WWBALT    ANDEQ'Y'                                       059191
     C****                                                                059191
     C****RITE 'BALANCE' REC TO THE SUBFILE WITH AMOUNT = WWBAL           059191
     C****       WWRRN0    CHAINPM2120S0             70                   059191
     C****                 MOVE *BLANK    DDPSTD                          059191
     C****                 MOVE *BLANK    DDVALD                          059191
     C****       WWBAL     IFLT 0                          B3             059191
     C****                 Z-SUBWWBAL     ZFLD15                          059191
     C****                 ELSE                            X3             059191
     C****                 Z-ADDWWBAL     ZFLD15                          059191
     C****                 END                             E3             059191
     C****                 EXSR ZSEDIT                                    059191
     C****       WWBAL     IFGT 0                          B3             059191
     C****                 MOVE ZOUT21    WWDEBT                          059191
     C****                                                                059191
     C****       WWDEBT    IFEQ *BLANKS                    B4             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWDEBT                          059191
     C****                 END                                            059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWCRDT                          059191
     C****                 ELSE                            X3             059191
     C****                 MOVE ZOUT21    WWCRDT                          059191
     C****                                                                059191
     C****       WWCRDT    IFEQ *BLANKS                    B4             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWCRDT                          059191
     C****                 END                                            059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWDEBT                          059191
     C****                 END                             E3             059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 Z-ADDWWPDAT    ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C****                 Z-ADD0         DDAMNT                          059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C*********************ADD  1         WWRRN0                          059191
     C*********************MOVE '1'       *IN50                           059191
     C*********************WRITEPM2120S0                                  059191
     C****       DDTYPR    IFEQ 'B'                        B3             059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 ELSE                            X3             059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 UPDATPM2120S0                                  059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                                                                059191
     C****                 END                             E2             059191
     C****                                                                059191
     C****RANSFER POSTING DATE READ INTO PREVIOUS POSTING DATE            059191
     C****                 MOVE PSTD      WWPDAT                          059191
     C****                                                                059191
     C****ND LOOP ON SAME CUSTOMER, CURRENCY, ACCOUNT CODE & SEQUENCE     059191
     C****                 END                             E1             059191
     C****                                                                059191
     C****F*NO*RECORDS*ON*LF/HPOSTL1*WRITE*ONLY*LEDGER*BALANCE*REC R10055 059191
     C****F NO RECORDS ON LF/HPOSTL6 WRITE ONLY LEDGER BALANCE RECORD     059191
     C****N THE SUBFILE                                                   059191
     C****       WWRRN0    IFEQ 0                          B1             059191
     C****                 MOVE *BLANK    DDPSTD                          059191
     C****                 MOVE *BLANK    DDVALD                          059191
     C****       LDBL      IFLT 0                          B2             059191
     C****                 Z-SUBLDBL      ZFLD15                          059191
     C****                 ELSE                            X2             059191
     C****                 Z-ADDLDBL      ZFLD15                          059191
     C****                 END                             E2             059191
     C****                 EXSR ZSEDIT                                    059191
     C****       LDBL      IFGT 0                          B2             059191
     C****                 MOVE ZOUT21    WWDEBT                          059191
     C****                                                                059191
     C****       WWDEBT    IFEQ *BLANKS                    B3             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWDEBT                          059191
     C****                 END                                            059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWCRDT                          059191
     C****                 ELSE                            X2             059191
     C****                 MOVE ZOUT21    WWCRDT                          059191
     C****                                                                059191
     C****       WWCRDT    IFEQ *BLANKS                    B3             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWCRDT                          059191
     C****                 END                                            059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWDEBT                          059191
     C****                 END                             E2             059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 Z-ADDQMRDNB    ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C****                 Z-ADD0         DDAMNT                          059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C****                 ADD  1         WWRRN0                          059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 WRITEPM2120S0                                  059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                 END                             E1             059191
     C****                                                                059191
     C****UBFILE END INDICATOR                                            059191
     C****                 MOVE '1'       *IN52                           059191
     C****                 MOVE '1'       WWSBFP                          059191
     C****                 Z-ADDWWRRN0    WWRRNA                          059191
     C****                                                                059191
     C****                 ENDSR                           * LSUBFP ESR * 059191
     C*****************************************************************   059191
      /EJECT                                                              059191
     C*****************************************************************   059191
      **                                                                  059191
      ** LSUBFp - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         059191
      **          IN POSTING DATE DESCENDING SEQUENCE                     059191
      **                                                                  059191
      ** CALLED FROM:                                                     059191
      ** P01    - ACCESS ACCOUNT MOVEMENTS                                059191
      **                                                                  059191
      ** CALLS:                                                           059191
      ** WACMD  - FORMAT FIELDS FOR ACCOUNT MOVEMENT 'DETAIL' RECORD      059191
      **                                                                  059191
     C*****************************************************************   059191
     C           LSUBFP    BEGSR                           * LSUBFP BSR * 059191
     C*                                                                   059191
     C                     MOVE 'Y'       WWFRST  1                       059191
     C                     MOVE 'N'       WWLAST  1                       059191
     C                     MOVE 'N'       WWBALT  1                       059191
     C                     Z-ADDLDBL      LDBLS  150                      059191
     C*                                                                   059191
     C** INITIALISE SUBFILE                                               059191
     C                     Z-ADD0         WWRRN0                          059191
     C                     MOVE '0'       *IN51                           059191
     C                     WRITEPM2120C0                                  059191
     C                     MOVE '1'       *IN51                           059191
     C*                                                                   059191
     C                     Z-ADD0         WWPDAT  50                      059191
     C                     MOVE *BLANKS   DDPSTD                          059191
     C                     Z-ADD0         WWBAL  180                      059191
     C                     Z-ADD0         DDAMNT                          059191
     C*                                                                   059191
     C***SET*LOWER*LIMITS*ON*LF/HPOSTL8*************************** 059191 S01486
     C** Set lower limits on LF/APOSTL1                                   S01486
     C**********           Z-ADDWWCNUM    CNUM                                         059191 CSD027
     C                     MOVE WWCNUM    CNUM                                                CSD027
     C                     MOVE WWCCY     CCY                             059191
     C                     Z-ADDWWACOD    ACOD                            059191
     C                     Z-ADDWWACSQ    ACSQ                            059191
     C                     MOVE WWBRCA    BRCA                            085862
     C                     Z-ADD0         PSTD                            059191
     C                     Z-ADD0         PSTA                            059191
     C                     Z-ADD0         DRCR                            059191
     C***********KHPOS1    SETLLHPOSTL8                            059191 S01486
     C           KHPOS1    SETLLAPOSTL1                                   S01486
     C*                                                                   059191
     C***FIRST*READ*OF*LF/HPOSTL7********************************* 059191 S01486
     C***********          READ HPOSTL8                  70        059191 S01486
     C**  First read of LF/APOSTL1                                        S01486
     C                     READ APOSTL1                  70               S01486
     C                     Z-ADDPSTD      WWPDAT                          059191
     C*                                                                   059191
     C** IF NO RECORDS READ OUTPUT BROUGHT FORWARD BALANCE ONLY           059191
     C           *IN70     IFEQ '1'                        B1             059191
     C           CNUM      ORNE WWCNUM                                    059191
     C           CCY       ORNE WWCCY                                     059191
     C           ACOD      ORNE WWACOD                                    059191
     C           ACSQ      ORNE WWACSQ                                    059191
     C           BRCA      ORNE WWBRCA                                    085862
     C*                                                                   059191
     C** WRITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = 0            059191
     C** AND POSTING DATE = RUN DATE                                      059191
     C                     MOVE *BLANKS   DDPSTD                          059191
     C                     MOVE *BLANKS   DDVALD                          059191
     C                     Z-ADDQMRDNB    ZDAYNO                          059191
     C                     EXSR ZDATE2                                    059191
     C                     MOVELZADATE    DSNAR2                          059191
     C                     MOVE *BLANKS   WWCRDT                          059191
     C                     MOVE *BLANKS   WWDEBT                          059191
     C                     MOVELTXT,1     DSNAR1                          059191
     C                     MOVE *BLANK    DSNAR3                          059191
     C                     MOVE DSNARR    DDPNAR                          059191
     C                     Z-ADD0         DDAMNT                          059191
     C                     Z-ADD0         DDAMNS                          059191
     C                     MOVE 'B'       DDTYPR                          059191
     C                     ADD  1         WWRRN0                          059191
     C                     Z-ADDWWRRN0    WWSAVE  30                      059191
     C****************     Z-ADDPSTD      DDVLDT                    059191132262
     C           PSTD      SUB  1         DDVLDT                          132262
     C                     MOVE '1'       *IN50                           059191
     C                     MOVE *IN50     DDIN50                          059191
     C                     WRITEPM2120S0                                  059191
     C                     MOVE '0'       *IN50                           059191
     C                     MOVE 'D'       DDTYPR                          059191
     C*                                                                   059191
     C** SAVE THE RRN IN A TABLE                                          059191
     C                     Z-ADD1         Y       30                      059191
      *                                                                   167494
      ** Should use RRN for posting date                                  167494
      *                                                                   167494
     C**********           Z-ADDWWRRN1    TB1,Y                    059191 167494
     C                     Z-ADDWWRRN0    TB1,Y                           167494
     C                     END                             E1             059191
     C*                                                                   059191
     C** DO WHILE NOT END OF FILE AND SAME CUSTOMER, SAME CURRENCY,       059191
     C** SAME ACCOUNT CODE & SAME ACCOUNT SEQUENCE ARE BEING PROCESSED    059191
     C           *IN70     DOWEQ'0'                        B1             059191
     C           CNUM      ANDEQWWCNUM                                    059191
     C           CCY       ANDEQWWCCY                                     059191
     C           ACOD      ANDEQWWACOD                                    059191
     C           ACSQ      ANDEQWWACSQ                                    059191
     C           BRCA      ANDEQWWBRCA                                    085862
     C*                                                                   059191
     C** WRITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = 0            059191
     C** AND POSTING DATE = POSTING DATE FROM HPOSTL5 - 1                 059191
     C           WWRRN0    IFEQ 0                          B2             059191
     C                     MOVE *BLANKS   DDPSTD                          059191
     C                     MOVE *BLANKS   DDVALD                          059191
     C                     SUB  1         PSTD                            059191
     C                     MOVE PSTD      ZDAYNO                          059191
     C                     EXSR ZDATE2                                    059191
     C                     MOVELZADATE    DSNAR2                          059191
     C                     ADD  1         PSTD                            059191
     C                     MOVE *BLANKS   WWCRDT                          059191
     C                     MOVE *BLANKS   WWDEBT                          059191
     C                     MOVELTXT,1     DSNAR1                          059191
     C                     MOVE *BLANK    DSNAR3                          059191
     C                     MOVE DSNARR    DDPNAR                          059191
     C                     Z-ADD0         DDAMNT                          059191
     C                     MOVE 'B'       DDTYPR                          059191
     C                     ADD  1         WWRRN0                          059191
     C                     Z-ADDPSTD      DDVLDT                          059191
     C                     MOVE '1'       *IN50                           059191
     C                     MOVE *IN50     DDIN50                          059191
     C                     WRITEPM2120S0                                  059191
     C                     MOVE '0'       *IN50                           059191
     C                     MOVE 'D'       DDTYPR                          059191
     C*                                                                   059191
     C** SAVE THE RRN IN A TABLE                                          059191
     C                     Z-ADD1         Y       30                      059191
     C                     Z-ADDWWRRN0    TB1,Y                           059191
     C                     END                             E2             059191
     C*                                                                   059191
     C** IF FIRST POSTING FOR ACCOUNT OR PREVIOUS POSTING BEFORE LAST     059191
     C** EXTRACT DATE RESET AMOUNT TO 0                                   059191
     C           WWFRST    IFEQ 'N'                                       059191
     C           WWSDAT    ANDLEWWLXTR                                    059191
     C           PSTD      ANDGTWWLXTR                                    059191
     C           PSTD      ORLE WWLXTR                                    059191
     C                     Z-ADD0         DDAMNT                          059191
     C                     END                                            059191
     C                     MOVE 'N'       WWFRST                          059191
     C*                                                                   059191
     C** DO WHILE SAME CONDITIONS AS BEFORE                               059191
     C**      AND VALUE DATE SAME AS PREVIOUS VALUE DATE                  059191
     C           *IN70     DOWEQ'0'                        B2             059191
     C           CNUM      ANDEQWWCNUM                                    059191
     C           CCY       ANDEQWWCCY                                     059191
     C           ACOD      ANDEQWWACOD                                    059191
     C           ACSQ      ANDEQWWACSQ                                    059191
     C           BRCA      ANDEQWWBRCA                                    085862
     C           PSTD      ANDEQWWPDAT                                    059191
     C*                                                                   059191
     C** WRITE ACCOUNT MOVEMENT 'DETAIL' RECORD ON THE SUBFILE            059191
     C                     EXSR WACMD                                     059191
     C                     ADD  1         WWRRN0                          059191
     C                     MOVE 'Y'       WWBALT  1                       059191
     C                     Z-ADDPSTD      DDVLDT                          059191
     C                     MOVE *IN50     DDIN50                          059191
     C*                                                                   059191
     C** CALCULATE TOTAL VALUE OF POSTINGS READ FOR EACH VALUE DATE       059191
     C           PSTD      IFGT WWLXTR                     B3          897059191
     C           DRCR      IFEQ 0                          B4             059191
     C                     ADD  PSTA      DDAMNT                          059191
     C                     ELSE                            X4             059191
     C                     SUB  PSTA      DDAMNT                          059191
     C                     END                             E4             059191
     C*                                                                   059191
     C                     ELSE                            X3             059191
     C           DRCR      IFEQ 0                          B4             059191
     C                     SUB  PSTA      DDAMNT                          059191
     C                     ELSE                            X4             059191
     C                     ADD  PSTA      DDAMNT                          059191
     C                     END                             E4             059191
     C                     END                             E3             059191
     C*                                                                   059191
     C                     WRITEPM2120S0                                  059191
     C*                                                                   059191
     C***NEXT*READ*OF*LF/HPOSTL7********************************** 059191 S01486
     C**  Next read of LF/APOSTL1                                         S01486
     C                     Z-ADDPSTD      WWSDAT  50                      059191
     C***********          READ HPOSTL8                  70        059191 S01486
     C                     READ APOSTL1                  70               S01486
     C*                                                                   059191
     C           WWRRN0    IFGE 9997                                      176940
     C                     MOVE '1'       *IN70                           176940
     C                     END                                            176940
      *                                                                   176940
     C** IF END OF PROCESS FOR THIS ACCOUNT SET VALUE DATE = 0            059191
     C           *IN70     IFEQ '1'                        B3             059191
     C           CNUM      ORNE WWCNUM                                    059191
     C           CCY       ORNE WWCCY                                     059191
     C           ACOD      ORNE WWACOD                                    059191
     C           ACSQ      ORNE WWACSQ                                    059191
     C           BRCA      ORNE WWBRCA                                    085862
     C           PSTD      ORNE WWPDAT                                    059191
     C                     MOVE 'Y'       WWLAST                          059191
     C                     END                             E3             059191
     C*                                                                   059191
     C** END LOOP ON SAME VALUE DATE                                      059191
     C                     END                             E2             059191
     C*                                                                   059191
     C** PREVIOUS VALUE DATE IS LESS THAN RUN DATE                        059191
     C** AND VALUE DATE READ IS GREATER THAN OR EQUAL TO RUN DATE         059191
     C           WWLAST    IFEQ 'Y'                        B2             059191
     C*                                                                   059191
     C** WRITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = LEDGER BAL   059191
     C** AND VALUE DATE = PREVIOUS VALUE DATE                             059191
     C                     MOVE *BLANK    DDPSTD                          059191
     C                     MOVE *BLANK    DDVALD                          059191
     C*                                                                   059191
     C           LDBL      IFLT 0                          B3             059191
     C                     Z-SUBLDBL      ZFLD15                          059191
     C                     EXSR ZSEDIT                                    059191
     C                     MOVE ZOUT21    WWCRDT                          059191
     C*                                                                   059191
     C           WWCRDT    IFEQ *BLANKS                    B4             059191
     C           ZDECS     IFEQ 0                                         059191
     C                     MOVE '0 '      WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 1                                         059191
     C                     MOVE '0.0 '    WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 2                                         059191
     C                     MOVE '0.00 '   WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 3                                         059191
     C                     MOVE '0.000 '  WWCRDT                          059191
     C                     END                                            059191
     C                     END                             E4             059191
     C*                                                                   059191
     C                     MOVE *BLANK    WWDEBT                          059191
     C                     ELSE                            X3             059191
     C                     Z-ADDLDBL      ZFLD15                          059191
     C                     EXSR ZSEDIT                                    059191
     C                     MOVE ZOUT21    WWDEBT                          059191
     C*                                                                   059191
     C           WWDEBT    IFEQ *BLANKS                    B4             059191
     C           ZDECS     IFEQ 0                                         059191
     C                     MOVE '0 '      WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 1                                         059191
     C                     MOVE '0.0 '    WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 2                                         059191
     C                     MOVE '0.00 '   WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 3                                         059191
     C                     MOVE '0.000 '  WWDEBT                          059191
     C                     END                                            059191
     C                     END                             E4             059191
     C*                                                                   059191
     C                     MOVE *BLANK    WWCRDT                          059191
     C                     END                             E3             059191
     C*                                                                   059191
     C                     MOVELTXT,1     DSNAR1                          059191
     C                     MOVE 'N'       WWBALT                          059191
     C                     MOVE WWPDAT    ZDAYNO                          059191
     C                     EXSR ZDATE2                                    059191
     C                     MOVELZADATE    DSNAR2                          059191
     C                     MOVE *BLANK    DSNAR3                          059191
     C                     MOVE DSNARR    DDPNAR                          059191
     C                     MOVE 'B'       DDTYPR                          059191
     C                     ADD  1         WWRRN0                          059191
     C                     Z-ADDWWPDAT    DDVLDT                          059191
     C                     MOVE '1'       *IN50                           059191
     C                     MOVE *IN50     DDIN50                          059191
     C                     WRITEPM2120S0                                  059191
     C                     ADD  1         Y                               059191
     C                     Z-ADDWWRRN0    TB1,Y                           059191
     C                     MOVE '0'       *IN50                           059191
     C                     MOVE 'D'       DDTYPR                          059191
     C*                                                                   059191
     C                     ADD  LDBL      WWBAL                           059191
     C                     Z-ADDWWRRN0    WWSAVE                          059191
     C                     Z-ADDPSTD      WWPDAT                          059191
     C                     END                             E2             059191
     C                     END                             E1             059191
     C*                                                                   059191
     C                     MOVE 'N'       WWFLAG  1                       059191
     C*                                                                   059191
     C           Y         DOWNE0                          B1             059191
     C                     Z-ADDDDAMNT    DDAMNS 180                      059191
     C           TB1,Y     CHAINPM2120S0             70                   059191
     C*                                                                   059191
     C** IF FORWARD DATE ADD AMOUNT TO CLEARED BALANCE                    059191
     C           DDVLDT    IFGT WWLXTR                     B2             059191
     C           LDBLS     ADD  DDAMNT    WWBALW 150                      059191
     C                     ELSE                            X2             059191
     C*                                                                   059191
     C***********DDVLDT    IFEQ WWLXTR                     B3       059191099271
     C***********          Z-ADDLDBLS     WWBALW 150                059191099271
     C***********          MOVE 'Y'       WWFLAG                    059191099271
     C***********          ELSE                            X3       059191099271
     C*                                                                   059191
     C           WWFLAG    IFEQ 'N'                        B4             059191
     C                     MOVE 'Y'       WWFLAG                          059191
     C                     Z-ADDLDBLS     WWBALW                          059191
     C                     ELSE                            X4             059191
     C           WWBALW    ADD  DDAMNS    WWBALW                          059191
     C                     END                             E4             059191
     C***************      END                             E3       059191099271
     C                     END                             E2             059191
     C*                                                                   059191
     C           WWBALW    IFLT 0                          B2             059191
     C                     Z-SUBWWBALW    ZFLD15                          059191
     C                     EXSR ZSEDIT                                    059191
     C                     MOVE ZOUT21    WWCRDT                          059191
     C*                                                                   059191
     C           WWCRDT    IFEQ *BLANKS                    B3             059191
     C           ZDECS     IFEQ 0                                         059191
     C                     MOVE '0 '      WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 1                                         059191
     C                     MOVE '0.0 '    WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 2                                         059191
     C                     MOVE '0.00 '   WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 3                                         059191
     C                     MOVE '0.000 '  WWCRDT                          059191
     C                     END                                            059191
     C                     END                             E3             059191
     C*                                                                   059191
     C                     MOVE *BLANK    WWDEBT                          059191
     C                     ELSE                            X2             059191
     C                     Z-ADDWWBALW    ZFLD15                          059191
     C                     EXSR ZSEDIT                                    059191
     C                     MOVE ZOUT21    WWDEBT                          059191
     C*                                                                   059191
     C           WWDEBT    IFEQ *BLANKS                    B3             059191
     C           ZDECS     IFEQ 0                                         059191
     C                     MOVE '0 '      WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 1                                         059191
     C                     MOVE '0.0 '    WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 2                                         059191
     C                     MOVE '0.00 '   WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 3                                         059191
     C                     MOVE '0.000 '  WWDEBT                          059191
     C                     END                                            059191
     C                     END                             E3             059191
     C*                                                                   059191
     C                     MOVE *BLANK    WWCRDT                          059191
     C                     END                             E2             059191
     C*                                                                   059191
     C           DDTYPR    IFEQ 'B'                        B2             059191
     C                     MOVE '1'       *IN50                           059191
     C                     ELSE                            X2             059191
     C                     MOVE '0'       *IN50                           059191
     C                     END                             E2             059191
     C*                                                                   059191
     C                     MOVE *IN50     DDIN50                          059191
     C                     UPDATPM2120S0                                  059191
     C                     SUB  1         Y                               059191
     C                     END                             E1             059191
     C*                                                                   059191
     C** SUBFILE END INDICATOR                                            059191
     C                     MOVE '1'       *IN52                           059191
     C**                   MOVE '1'       WWSBFV                    059191064752
     C                     Z-ADDWWSAVE    WWRRNA                          059191
     C*                                                                   059191
     C                     ENDSR                           * LSUBFV ESR * 059191
     C*****************************************************************
      /EJECT
     C*****************************************************************   R10055
      **                                                                  R10055
      ** LSUBFV - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         R10055
      **          IN VALUE DATE DESCENDING SEQUENCE                       R10055
      **                                                                  R10055
      ** CALLED FROM:                                                     R10055
      ** P01    - ACCESS ACCOUNT MOVEMENTS                                R10055
      **                                                                  R10055
      ** CALLS:                                                           R10055
      ** WACMD  - FORMAT FIELDS FOR ACCOUNT MOVEMENT 'DETAIL' RECORD      R10055
      **                                                                  R10055
     C*****************************************************************   R10055
     C           LSUBFV    BEGSR                           * LSUBFV BSR * 059191
     C*                                                                   059191
     C                     MOVE 'Y'       WWFRST  1                       059191
     C                     MOVE 'N'       WWLAST                          059191
     C                     MOVE 'N'       WWBALT  1                       059191
     C                     MOVE 'V'       WWTVDA  1                       059191
     C                     Z-ADDCLBL      CLBLS  150                      059191
     C*                                                                   059191
     C** INITIALISE SUBFILE                                               059191
     C                     Z-ADD0         WWRRN1                          059191
     C                     MOVE '0'       *IN53                           059191
     C                     WRITEPM2120C1                                  059191
     C                     MOVE '1'       *IN53                           059191
     C*                                                                   059191
     C                     Z-ADD0         WWPDAT  50                      059191
     C                     MOVE *BLANKS   DDPSTD                          059191
     C                     Z-ADD0         WWBAL  180                      059191
     C                     Z-ADD0         DDAMNT                          059191
     C*                                                                   059191
     C***SET*LOWER*LIMITS*ON*LF/HPOSTL7*************************** 059191 S01486
     C**  Set lower limits on LF/PMHPOSL1                                 S01486
     C**********           Z-ADDWWCNUM    CNUM                                         059191 CSD027
     C                     MOVE WWCNUM    CNUM                                                CSD027
     C                     MOVE WWCCY     CCY                             059191
     C                     Z-ADDWWACOD    ACOD                            059191
     C                     Z-ADDWWACSQ    ACSQ                            059191
     C                     MOVE WWBRCA    BRCA                            085862
     C                     Z-ADD0         VALD                            059191
     C                     Z-ADD0         PSTA                            059191
     C                     Z-ADD0         DRCR                            059191
     C***********KHPOS5    SETLLHPOSTL7                            059191 S01486
     C           KHPOS5    SETLLPMHPOSL1                                  S01486
     C*                                                                   059191
     C***FIRST*READ*OF*LF/HPOSTL7********************************* 059191 S01486
     C***********          READ HPOSTL7                  70        059191 S01486
     C**  First read of LF/PMHPOSL1                                       S01486
     C                     READ PMHPOSL1                 70               S01486
     C                     Z-ADDVALD      WWPDAT                          059191
     C*                                                                   059191
     C** IF NO RECORDS READ OUTPUT BROUGHT FORWARD BALANCE ONLY           059191
     C           *IN70     IFEQ '1'                        B1             059191
     C           CNUM      ORNE WWCNUM                                    059191
     C           CCY       ORNE WWCCY                                     059191
     C           ACOD      ORNE WWACOD                                    059191
     C           ACSQ      ORNE WWACSQ                                    059191
     C           BRCA      ORNE WWBRCA                                    085862
     C*                                                                   059191
     C** WRITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = 0            059191
     C** AND POSTING DATE = RUN DATE                                      059191
     C                     MOVE *BLANKS   DDPSTD                          059191
     C                     MOVE *BLANKS   DDVALD                          059191
     C                     Z-ADDQMRDNB    ZDAYNO                          059191
     C                     EXSR ZDATE2                                    059191
     C                     MOVELZADATE    DSNAR2                          059191
     C                     MOVE *BLANKS   WWCRDT                          059191
     C                     MOVE *BLANKS   WWDEBT                          059191
     C                     MOVELTXT,1     DSNAR1                          059191
     C                     MOVE *BLANK    DSNAR3                          059191
     C                     MOVE DSNARR    DDPNAR                          059191
     C                     Z-ADD0         DDAMNT                          059191
     C                     Z-ADD0         DDAMNS                          059191
     C                     MOVE 'B'       DDTYPR                          059191
     C                     ADD  1         WWRRN1                          059191
     C                     Z-ADDWWRRN1    WWSAVE                          059191
     C*****************    Z-ADDVALD      DDVLDT                    059191132262
     C           VALD      SUB  1         DDVLDT                          132262
     C                     MOVE '1'       *IN50                           059191
     C                     MOVE *IN50     DDIN50                          059191
     C                     WRITEPM2120S1                                  059191
     C                     MOVE '0'       *IN50                           059191
     C                     MOVE 'D'       DDTYPR                          059191
     C*                                                                   059191
     C** SAVE THE RRN IN A TABLE                                          059191
     C                     Z-ADD1         Y       30                      059191
     C                     Z-ADDWWRRN1    TB1,Y                           059191
     C                     END                             E1             059191
     C*                                                                   059191
     C** DO WHILE NOT END OF FILE AND SAME CUSTOMER, SAME CURRENCY,       059191
     C** SAME ACCOUNT CODE & SAME ACCOUNT SEQUENCE ARE BEING PROCESSED    059191
     C           *IN70     DOWEQ'0'                        B1             059191
     C           CNUM      ANDEQWWCNUM                                    059191
     C           CCY       ANDEQWWCCY                                     059191
     C           ACOD      ANDEQWWACOD                                    059191
     C           ACSQ      ANDEQWWACSQ                                    059191
     C           BRCA      ANDEQWWBRCA                                    085862
     C*                                                                   059191
     C** WRITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = 0            059191
     C** AND POSTING DATE = POSTING DATE FROM HPOSTL5 - 1                 059191
     C           WWRRN1    IFEQ 0                          B2             059191
     C                     MOVE *BLANKS   DDPSTD                          059191
     C                     MOVE *BLANKS   DDVALD                          059191
     C                     SUB  1         VALD                            059191
     C                     MOVE VALD      ZDAYNO                          059191
     C                     EXSR ZDATE2                                    059191
     C                     MOVELZADATE    DSNAR2                          059191
     C                     ADD  1         VALD                            059191
     C                     MOVE *BLANKS   WWCRDT                          059191
     C                     MOVE *BLANKS   WWDEBT                          059191
     C                     MOVELTXT,1     DSNAR1                          059191
     C                     MOVE *BLANK    DSNAR3                          059191
     C                     MOVE DSNARR    DDPNAR                          059191
     C                     Z-ADD0         DDAMNT                          059191
     C                     MOVE 'B'       DDTYPR                          059191
     C                     ADD  1         WWRRN1                          059191
     C                     Z-ADDVALD      DDVLDT                          059191
     C                     MOVE '1'       *IN50                           059191
     C                     MOVE *IN50     DDIN50                          059191
     C                     WRITEPM2120S1                                  059191
     C                     MOVE '0'       *IN50                           059191
     C                     MOVE 'D'       DDTYPR                          059191
     C*                                                                   059191
     C** SAVE THE RRN IN A TABLE                                          059191
     C                     Z-ADD1         Y       30                      059191
     C                     Z-ADDWWRRN1    TB1,Y                           059191
     C                     END                             E2             059191
     C*                                                                   059191
     C** IF FIRST POSTING FOR ACCOUNT OR PREVIOUS POSTING BEFORE LAST     059191
     C** EXTRACT DATE RESET AMOUNT TO 0                                   059191
     C           WWFRST    IFEQ 'N'                                       059191
     C           WWSDAT    ANDLEWWLXTR                                    059191
     C           VALD      ANDGTWWLXTR                                    059191
     C           VALD      ORLE WWLXTR                                    059191
     C                     Z-ADD0         DDAMNT                          059191
     C                     END                                            059191
     C                     MOVE 'N'       WWFRST                          059191
     C*                                                                   059191
     C** DO WHILE SAME CONDITIONS AS BEFORE                               059191
     C**      AND VALUE DATE SAME AS PREVIOUS VALUE DATE                  059191
     C           *IN70     DOWEQ'0'                        B2             059191
     C           CNUM      ANDEQWWCNUM                                    059191
     C           CCY       ANDEQWWCCY                                     059191
     C           ACOD      ANDEQWWACOD                                    059191
     C           ACSQ      ANDEQWWACSQ                                    059191
     C           BRCA      ANDEQWWBRCA                                    085862
     C           VALD      ANDEQWWPDAT                                    059191
     C*                                                                   059191
     C** WRITE ACCOUNT MOVEMENT 'DETAIL' RECORD ON THE SUBFILE            059191
     C                     EXSR WACMD                                     059191
     C                     ADD  1         WWRRN1                          059191
     C                     MOVE 'Y'       WWBALT  1                       059191
     C                     Z-ADDVALD      DDVLDT                          059191
     C                     MOVE *IN50     DDIN50                          059191
     C*                                                                   059191
     C** CALCULATE TOTAL VALUE OF POSTINGS READ FOR EACH VALUE DATE       059191
     C           VALD      IFGT WWLXTR                     B3          897059191
     C           DRCR      IFEQ 0                          B4             059191
     C                     ADD  PSTA      DDAMNT                          059191
     C                     ELSE                            X4             059191
     C                     SUB  PSTA      DDAMNT                          059191
     C                     END                             E4             059191
     C*                                                                   059191
     C                     ELSE                            X3             059191
     C           DRCR      IFEQ 0                          B4             059191
     C                     SUB  PSTA      DDAMNT                          059191
     C                     ELSE                            X4             059191
     C                     ADD  PSTA      DDAMNT                          059191
     C                     END                             E4             059191
     C                     END                             E3             059191
     C*                                                                   059191
     C                     WRITEPM2120S1                                  059191
     C*                                                                   059191
     C***NEXT*READ*OF*LF/HPOSTL7********************************** 059191 S01486
     C**  Next read of LF/PMPOSL1                                         S01486
     C                     Z-ADDVALD      WWSDAT  50                      059191
     C***********          READ HPOSTL7                  70        059191 S01486
     C                     READ PMHPOSL1                 70               S01486
     C*                                                                   059191
     C           WWRRN1    IFGE 9997                                      176940
     C                     MOVE '1'       *IN70                           176940
     C                     END                                            176940
      *                                                                   176940
     C** IF END OF PROCESS FOR THIS ACCOUNT SET VALUE DATE = 0            059191
     C           *IN70     IFEQ '1'                        B3             059191
     C           CNUM      ORNE WWCNUM                                    059191
     C           CCY       ORNE WWCCY                                     059191
     C           ACOD      ORNE WWACOD                                    059191
     C           ACSQ      ORNE WWACSQ                                    059191
     C           BRCA      ORNE WWBRCA                                    085862
     C           VALD      ORNE WWPDAT                                    059191
     C                     MOVE 'Y'       WWLAST                          059191
     C                     END                             E3             059191
     C*                                                                   059191
     C** END LOOP ON SAME VALUE DATE                                      059191
     C                     END                             E2             059191
     C*                                                                   059191
     C** PREVIOUS VALUE DATE IS LESS THAN RUN DATE                        059191
     C** AND VALUE DATE READ IS GREATER THAN OR EQUAL TO RUN DATE         059191
     C           WWLAST    IFEQ 'Y'                        B2             059191
     C*                                                                   059191
     C** WRITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = LEDGER BAL   059191
     C** AND VALUE DATE = PREVIOUS VALUE DATE                             059191
     C                     MOVE *BLANK    DDPSTD                          059191
     C                     MOVE *BLANK    DDVALD                          059191
     C*                                                                   059191
     C           CLBL      IFLT 0                          B3             059191
     C                     Z-SUBCLBL      ZFLD15                          059191
     C                     EXSR ZSEDIT                                    059191
     C                     MOVE ZOUT21    WWCRDT                          059191
     C*                                                                   059191
     C           WWCRDT    IFEQ *BLANKS                    B4             059191
     C           ZDECS     IFEQ 0                                         059191
     C                     MOVE '0 '      WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 1                                         059191
     C                     MOVE '0.0 '    WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 2                                         059191
     C                     MOVE '0.00 '   WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 3                                         059191
     C                     MOVE '0.000 '  WWCRDT                          059191
     C                     END                                            059191
     C                     END                             E4             059191
     C*                                                                   059191
     C                     MOVE *BLANK    WWDEBT                          059191
     C                     ELSE                            X3             059191
     C                     Z-ADDCLBL      ZFLD15                          059191
     C                     EXSR ZSEDIT                                    059191
     C                     MOVE ZOUT21    WWDEBT                          059191
     C*                                                                   059191
     C           WWDEBT    IFEQ *BLANKS                    B4             059191
     C           ZDECS     IFEQ 0                                         059191
     C                     MOVE '0 '      WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 1                                         059191
     C                     MOVE '0.0 '    WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 2                                         059191
     C                     MOVE '0.00 '   WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 3                                         059191
     C                     MOVE '0.000 '  WWDEBT                          059191
     C                     END                                            059191
     C                     END                             E4             059191
     C*                                                                   059191
     C                     MOVE *BLANK    WWCRDT                          059191
     C                     END                             E3             059191
     C*                                                                   059191
     C                     MOVELTXT,1     DSNAR1                          059191
     C                     MOVE 'N'       WWBALT                          059191
     C                     MOVE WWPDAT    ZDAYNO                          059191
     C                     EXSR ZDATE2                                    059191
     C                     MOVELZADATE    DSNAR2                          059191
     C                     MOVE *BLANK    DSNAR3                          059191
     C                     MOVE DSNARR    DDPNAR                          059191
     C                     MOVE 'B'       DDTYPR                          059191
     C                     ADD  1         WWRRN1                          059191
     C                     Z-ADDWWPDAT    DDVLDT                          059191
     C                     MOVE '1'       *IN50                           059191
     C                     MOVE *IN50     DDIN50                          059191
     C                     WRITEPM2120S1                                  059191
     C                     ADD  1         Y                               059191
     C                     Z-ADDWWRRN1    TB1,Y                           059191
     C                     MOVE '0'       *IN50                           059191
     C                     MOVE 'D'       DDTYPR                          059191
     C*                                                                   059191
     C                     ADD  CLBL      WWBAL                           059191
     C                     Z-ADDWWRRN1    WWSAVE                          059191
     C                     Z-ADDVALD      WWPDAT                          059191
     C                     END                             E2             059191
     C                     END                             E1             059191
     C*                                                                   059191
     C                     MOVE 'N'       WWFLAG  1                       059191
     C*                                                                   059191
     C           Y         DOWNE0                          B1             059191
     C                     Z-ADDDDAMNT    DDAMNS 180                      059191
     C           TB1,Y     CHAINPM2120S1             70                   059191
     C*                                                                   059191
     C** IF FORWARD DATE ADD AMOUNT TO CLEARED BALANCE                    059191
     C           DDVLDT    IFGT WWLXTR                     B2             059191
     C           CLBLS     ADD  DDAMNT    WWBALW 150                      059191
     C                     ELSE                            X2             059191
     C*                                                                   059191
     C***********DDVLDT    IFEQ WWLXTR                     B3       059191099271
     C***********          Z-ADDCLBLS     WWBALW 150                059191099271
     C***********          MOVE 'Y'       WWFLAG                    059191099271
     C***********          ELSE                            X3       059191099271
     C*                                                                   059191
     C           WWFLAG    IFEQ 'N'                        B4             059191
     C                     MOVE 'Y'       WWFLAG                          059191
     C                     Z-ADDCLBLS     WWBALW                          059191
     C                     ELSE                                           059191
     C           WWBALW    ADD  DDAMNS    WWBALW                          059191
     C                     END                             E4             059191
     C***********          END                             E3       059191099271
     C                     END                             E2             059191
     C*                                                                   059191
     C           WWBALW    IFLT 0                          B2             059191
     C                     Z-SUBWWBALW    ZFLD15                          059191
     C                     EXSR ZSEDIT                                    059191
     C                     MOVE ZOUT21    WWCRDT                          059191
     C*                                                                   059191
     C           WWCRDT    IFEQ *BLANKS                    B3             059191
     C           ZDECS     IFEQ 0                                         059191
     C                     MOVE '0 '      WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 1                                         059191
     C                     MOVE '0.0 '    WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 2                                         059191
     C                     MOVE '0.00 '   WWCRDT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 3                                         059191
     C                     MOVE '0.000 '  WWCRDT                          059191
     C                     END                                            059191
     C                     END                             E3             059191
     C*                                                                   059191
     C                     MOVE *BLANK    WWDEBT                          059191
     C                     ELSE                            X2             059191
     C                     Z-ADDWWBALW    ZFLD15                          059191
     C                     EXSR ZSEDIT                                    059191
     C                     MOVE ZOUT21    WWDEBT                          059191
     C*                                                                   059191
     C           WWDEBT    IFEQ *BLANKS                    B3             059191
     C           ZDECS     IFEQ 0                                         059191
     C                     MOVE '0 '      WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 1                                         059191
     C                     MOVE '0.0 '    WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 2                                         059191
     C                     MOVE '0.00 '   WWDEBT                          059191
     C                     END                                            059191
     C           ZDECS     IFEQ 3                                         059191
     C                     MOVE '0.000 '  WWDEBT                          059191
     C                     END                                            059191
     C                     END                             E3             059191
     C*                                                                   059191
     C                     MOVE *BLANK    WWCRDT                          059191
     C                     END                             E2             059191
     C*                                                                   059191
     C           DDTYPR    IFEQ 'B'                        B2             059191
     C                     MOVE '1'       *IN50                           059191
     C                     ELSE                            X2             059191
     C                     MOVE '0'       *IN50                           059191
     C                     END                             E2             059191
     C*                                                                   059191
     C                     MOVE *IN50     DDIN50                          059191
     C                     UPDATPM2120S1                                  059191
     C                     SUB  1         Y                               059191
     C                     END                             E1             059191
     C*                                                                   059191
     C** SUBFILE END INDICATOR                                            059191
     C                     MOVE '1'       *IN54                           059191
     C**                   MOVE '1'       WWSBFV                    059191064752
     C                     Z-ADDWWSAVE    WWRRNB                          059191
     C*                                                                   059191
     C                     ENDSR                           * LSUBFV ESR * 059191
     C*****************************************************************   059191
      ****CT                                                              059191
     C*****************************************************************   059191
      ****                                                                059191
      ****SUBFV - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         059191
      ****        IN VALUE DATE DESCENDING SEQUENCE                       059191
      ****                                                                059191
      ****ALLED FROM:                                                     059191
      ****01    - ACCESS ACCOUNT MOVEMENTS                                059191
      ****                                                                059191
      ****ALLS:                                                           059191
      ****ACMD  - FORMAT FIELDS FOR ACCOUNT MOVEMENT 'DETAIL' RECORD      059191
      ****                                                                059191
     C*****************************************************************   059191
     C****       LSUBFV    BEGSR                           * LSUBFV BSR * 059191
     C****                                                                059191
     C****                 MOVE 'N'       WWLAST                          059191
     C****                 MOVE 'N'       WWBALT  1                       059191
     C****                 Z-ADDCLBL      CLBLS  150                      059191
     C****                                                                059191
     C****NITIALISE SUBFILE                                               059191
     C****                 Z-ADD0         WWRRN1                          059191
     C****                 MOVE '0'       *IN53                           059191
     C****                 WRITEPM2120C1                                  059191
     C****                 MOVE '1'       *IN53                           059191
     C****                                                                059191
     C****                 Z-ADD0         WWPDAT  50                      059191
     C****                 MOVE *BLANKS   DDPSTD                          059191
     C****                 Z-ADD0         WWBAL  180                      059191
     C****                                                                059191
     C****ET LOWER LIMITS ON LF/HPOSTL7                                   059191
     C****                 Z-ADDWWCNUM    CNUM                            059191
     C****                 MOVE WWCCY     CCY                             059191
     C****                 Z-ADDWWACOD    ACOD                            059191
     C****                 Z-ADDWWACSQ    ACSQ                            059191
     C****                 Z-ADD0         VALD                            059191
     C****                 Z-ADD0         PSTA                            059191
     C****                 Z-ADD0         DRCR                            059191
     C****       KHPOS5    SETLLHPOSTL7                                   059191
     C****                                                                059191
     C****IRST READ OF LF/HPOSTL7                                         059191
     C****                 READ HPOSTL7                  70               059191
     C****                                                                059191
     C****O WHILE NOT END OF FILE AND SAME CUSTOMER, SAME CURRENCY,       059191
     C****AME ACCOUNT CODE & SAME ACCOUNT SEQUENCE ARE BEING PROCESSED    059191
     C****       *IN70     DOWEQ'0'                        B1             059191
     C****       CNUM      ANDEQWWCNUM                                    059191
     C****       CCY       ANDEQWWCCY                                     059191
     C****       ACOD      ANDEQWWACOD                                    059191
     C****       ACSQ      ANDEQWWACSQ                                    059191
     C****                                                                059191
     C****RITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = 0            059191
     C****ND POSTING DATE = POSTING DATE FROM HPOSTL5 - 1                 059191
     C****       WWRRN1    IFEQ 0                          B2             059191
     C****                 MOVE *BLANKS   DDPSTD                          059191
     C****                 MOVE *BLANKS   DDVALD                          059191
     C****                 SUB  1         VALD                            059191
     C****                 MOVE VALD      ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 ADD  1         VALD                            059191
     C****                 MOVE *BLANKS   WWCRDT                          059191
     C****                 MOVE *BLANKS   WWDEBT                          059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C****                 Z-ADD0         DDAMNT                          059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C****                 ADD  1         WWRRN1                          059191
     C****                 Z-ADDVALD      DDVLDT                          059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 WRITEPM2120S1                                  059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                                                                059191
     C****AVE THE RRN IN A TABLE                                          059191
     C****                 Z-ADD1         Y       30                      059191
     C****                 Z-ADDWWRRN1    TB1,Y                           059191
     C****                 END                             E2             059191
     C****                                                                059191
     C****HEN CROSS FROM BARKWARD MOVEMENTS TO FORWARD MOVEMENTS RESET    059191
     C****CCUMULATED BALANCE                                              059191
     C****       VALD      IFLT QMRDNB                     B2             059191
     C****       VALD      ANDGEWWLRUN                                    059191
     C****                 Z-ADD0         WWBAL                           059191
     C****                 END                             X2             059191
     C****                 Z-ADD0         DDAMNT                          059191
     C****                                                                059191
     C****O WHILE SAME CONDITIONS AS BEFORE                               059191
     C****    AND VALUE DATE SAME AS PREVIOUS VALUE DATE                  059191
     C****       *IN70     DOWEQ'0'                        B2             059191
     C****       CNUM      ANDEQWWCNUM                                    059191
     C****       CCY       ANDEQWWCCY                                     059191
     C****       ACOD      ANDEQWWACOD                                    059191
     C****       ACSQ      ANDEQWWACSQ                                    059191
     C****       VALD      ANDEQWWPDAT                                    059191
     C****                                                                059191
     C****RITE ACCOUNT MOVEMENT 'DETAIL' RECORD ON THE SUBFILE            059191
     C****                 EXSR WACMD                                     059191
     C****                 ADD  1         WWRRN1                          059191
     C****                 MOVE 'Y'       WWBALT  1                       059191
     C****                 Z-ADDVALD      DDVLDT                          059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                                                                059191
     C****ALCULATE TOTAL VALUE OF POSTINGS READ FOR EACH VALUE DATE       059191
     C****       VALD      IFGE WWLXTR                     B3          897059191
     C****       DRCR      IFEQ 0                          B4             059191
     C****                 ADD  PSTA      DDAMNT                          059191
     C****                 ELSE                            X4             059191
     C****                 SUB  PSTA      DDAMNT                          059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 ELSE                            X3             059191
     C****       DRCR      IFEQ 0                          B4             059191
     C****                 SUB  PSTA      DDAMNT                          059191
     C****                 ELSE                            X4             059191
     C****                 ADD  PSTA      DDAMNT                          059191
     C****                 END                             E4             059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 WRITEPM2120S1                                  059191
     C****                                                                059191
     C****F THE POSTING DATE *EQ RUN DATE RESET BALANCE TO BE USED        059191
     C****       VALD      IFLT QMRDNB                     B3             059191
     C****       VALD      ANDGEWWLRUN                     B3             059191
     C****                 Z-ADD0         WWBAL                           059191
     C****                 ELSE                            X3             059191
     C****                                                                059191
     C****F VALUE DATE IS BEFORE RUN DATE REVERSE SIGN OF AMOUNT          059191
     C****       VALD      IFGE QMRDNB                     B4       R05897059191
     C****       DRCR      IFEQ 0                          B5       R05897059191
     C****                 ADD  PSTA      WWBAL                     R05897059191
     C****                 ELSE                            X5       R05897059191
     C****                 SUB  PSTA      WWBAL                     R05897059191
     C****                 END                             E5       R05897059191
     C****                 ELSE                            X4       R05897059191
     C****                                                          R05897059191
     C****       DRCR      IFEQ 0                          B5       R05897059191
     C****                 SUB  PSTA      WWBAL                     R05897059191
     C****                 ELSE                            X5       R05897059191
     C****                 ADD  PSTA      WWBAL                     R05897059191
     C****                 END                             E5       R05897059191
     C****                 END                             E4       R05897059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****EXT READ OF LF/HPOSTL7                                          059191
     C****                 READ HPOSTL7                  70               059191
     C****                                                                059191
     C****F END OF PROCESS FOR THIS ACCOUNT SET VALUE DATE = 0            059191
     C****       *IN70     IFEQ '1'                        B3             059191
     C****       CNUM      ORNE WWCNUM                                    059191
     C****       CCY       ORNE WWCCY                                     059191
     C****       ACOD      ORNE WWACOD                                    059191
     C****       ACSQ      ORNE WWACSQ                                    059191
     C****                 MOVE 'Y'       WWLAST                          059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****ND LOOP ON SAME VALUE DATE                                      059191
     C****                 END                             E2             059191
     C****                                                                059191
     C****REVIOUS VALUE DATE IS LESS THAN RUN DATE                        059191
     C****ND VALUE DATE READ IS GREATER THAN OR EQUAL TO RUN DATE         059191
     C*****      WWPDAT    IFLT QMRDNB                     B2       R05897059191
     C*****      VALD      ANDGEQMRDNB                              R05897059191
     C*****      WWLAST    OREQ 'Y'                                 R05897059191
     C****       WWLAST    IFEQ 'Y'                        B2             059191
     C****                                                                059191
     C****RITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = LEDGER BAL   059191
     C****ND VALUE DATE = PREVIOUS VALUE DATE                             059191
     C****                 MOVE *BLANK    DDPSTD                          059191
     C****                 MOVE *BLANK    DDVALD                          059191
     C***********CLBL      ADD  DDAMNT    CLBL                     038516 059191
     C****                                                                059191
     C****       CLBL      IFLT 0                          B3             059191
     C****                 Z-SUBCLBL      ZFLD15                          059191
     C****                 EXSR ZSEDIT                                    059191
     C****                 MOVE ZOUT21    WWCRDT                          059191
     C****                                                                059191
     C****       WWCRDT    IFEQ *BLANKS                    B4             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWCRDT                          059191
     C****                 END                                            059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWDEBT                          059191
     C****                 ELSE                            X3             059191
     C****                 Z-ADDCLBL      ZFLD15                          059191
     C****                 EXSR ZSEDIT                                    059191
     C****                 MOVE ZOUT21    WWDEBT                          059191
     C****                                                                059191
     C****       WWDEBT    IFEQ *BLANKS                    B4             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWDEBT                          059191
     C****                 END                                            059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWCRDT                          059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 MOVE WWPDAT    ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C*****                Z-ADD0         DDAMNT                          059191
     C****                 Z-ADDWWBAL     DDAMNT                    R05897059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C****                 ADD  1         WWRRN1                          059191
     C****                 Z-ADDWWPDAT    DDVLDT                          059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 WRITEPM2120S1                                  059191
     C****                 ADD  1         Y                               059191
     C****                 Z-ADDWWRRN1    TB1,Y                           059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                                                                059191
     C*********************SUB  CLBL      WWBAL                           059191
     C****                 ADD  CLBL      WWBAL                           059191
     C******               Z-ADD1         Y                               059191
     C****                 Z-ADDWWRRN1    WWSAVE                          059191
     C****                 MOVE 'N'       WWFLAG  1                       059191
     C****                 MOVE 'Y'       WWFFFW  1                       059191
     C****                                                                059191
     C******     TB1,Y     DOWNE0                          B3             059191
     C****       Y         DOWNE0                          B3             059191
     C****                 Z-ADDDDAMNT    DDAMNS 180                      059191
     C****       TB1,Y     CHAINPM2120S1             70                   059191
     C*****                SUB  WWBAL     DDAMNT                          059191
     C****                                                                059191
     C****       DDVLDT    IFGE QMRDNB                              R05897059191
     C****       DDVLDT    IFGE WWLXTR                     B4             059191
     C****                                                                059191
     C****F FIRST FORWARD DATE ADD TO CLEARED BALANCE                     059191
     C****       WWFFFW    IFEQ 'Y'                                       059191
     C****       CLBLS     ADD  DDAMNT    WWBALW 150                      059191
     C****                 MOVE 'N'       WWFFFW  1                       059191
     C****                                                                059191
     C****..OTHERWISE ADD TO CURRENT BALANCE                              059191
     C****                 ELSE                                           059191
     C****       WWBALW    ADD  DDAMNT    WWBALW                          059191
     C****                 END                                            059191
     C****                                                                059191
     C****                 ELSE                                           059191
     C****                                                                059191
     C****       WWFLAG    IFEQ 'N'                                       059191
     C****                 MOVE 'Y'       WWFLAG                          059191
     C****                 Z-ADDCLBLS     WWBALW                          059191
     C****                 ELSE                                           059191
     C*********************Z-SUBDDAMNT    WWBALW                   038516 059191
     C****       WWBAL     SUB  DDAMNT    WWBALW             038516 R05897059191
     C****       WWBALW    SUB  DDAMNS    WWBALW                          059191
     C****                 END                                            059191
     C****                 END                                            059191
     C****                                                                059191
     C****                 Z-ADDWWBALW    DDAMNT                          059191
     C****                                                                059191
     C****       DDAMNT    IFLT 0                          B4             059191
     C****                 Z-SUBDDAMNT    ZFLD15                          059191
     C****                 EXSR ZSEDIT                                    059191
     C****                 MOVE ZOUT21    WWCRDT                          059191
     C****                                                                059191
     C****       WWCRDT    IFEQ *BLANKS                    B5             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWCRDT                          059191
     C****                 END                                            059191
     C****                 END                             E5             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWDEBT                          059191
     C****                 ELSE                            X4             059191
     C****                 Z-ADDDDAMNT    ZFLD15                          059191
     C****                 EXSR ZSEDIT                                    059191
     C****                 MOVE ZOUT21    WWDEBT                          059191
     C****                                                                059191
     C****       WWDEBT    IFEQ *BLANKS                    B5             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWDEBT                          059191
     C****                 END                                            059191
     C****                 END                             E5             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWCRDT                          059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****       DDTYPR    IFEQ 'B'                        B4             059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 ELSE                            X4             059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 UPDATPM2120S1                                  059191
     C*****                ADD  1         Y                               059191
     C****                 SUB  1         Y                               059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 Z-ADDWWSAVE    WWRRN1                          059191
     C****                 Z-ADDCLBL      WWBAL                           059191
     C****                 END                             E2             059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                                                                059191
     C****OTH PREVIOUS VALUE DATE AND VALUE DATE READ                     059191
     C****RE LESS THAN RUN DATE                                           059191
     C****       WWPDAT    IFLT QMRDNB                     B2             059191
     C****       VALD      ANDLTQMRDNB                                    059191
     C****       WWRRN1    ANDGT1                                         059191
     C****       WWBALT    ANDEQ'Y'                                       059191
     C****       VALD      ORNE WWPDAT                                    059191
     C****       WWLAST    ANDNE'Y'                                       059191
     C****       WWRRN1    ANDGT1                                         059191
     C****       WWBALT    ANDEQ'Y'                                       059191
     C****                                                                059191
     C****                 Z-ADDWWBAL     WWBALS 150                      059191
     C****                                                                059191
     C****F THE POSTING DATE *EQ RUN DATE RESET BALANCE TO BE USED        059191
     C****       WWPDAT    IFLT QMRDNB                     B3             059191
     C****       WWPDAT    ANDGEWWLRUN                                    059191
     C****                 Z-ADD0         WWBAL                           059191
     C****                 ELSE                            X3             059191
     C****                                                                059191
     C****F VALUE DATE IS BEFORE RUN DATE REVERSE SIGN OF AMOUNT          059191
     C****       WWPDAT    IFGE QMRDNB                     B4             059191
     C****       DRCR      IFEQ 0                          B5             059191
     C****                 ADD  PSTA      WWBAL                           059191
     C****                 ELSE                            X5             059191
     C****                 SUB  PSTA      WWBAL                           059191
     C****                 END                             E5             059191
     C****                 ELSE                            X4             059191
     C****                                                                059191
     C****       DRCR      IFEQ 0                          B5             059191
     C****                 SUB  PSTA      WWBAL                           059191
     C****                 ELSE                            X5             059191
     C****                 ADD  PSTA      WWBAL                           059191
     C****                 END                             E5             059191
     C****                 END                             E4             059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****RITE 'BALANCE' RECORD TO THE SUBFILE WITH AMOUNT = WWBAL        059191
     C****ND VALUE DATE = PREVIOUS VALUE DATE                             059191
     C****                 MOVE *BLANK    DDPSTD                          059191
     C****                 MOVE *BLANK    DDVALD                          059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 Z-ADDWWPDAT    ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C****                 Z-ADDWWBAL     DDAMNT                          059191
     C****                 Z-ADDWWBALS    DDAMNT                          059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C****                 ADD  1         WWRRN1                          059191
     C****                 Z-ADDWWPDAT    DDVLDT                          059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 WRITEPM2120S1                                  059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                 ADD  1         Y                               059191
     C****                 Z-ADDWWRRN1    TB1,Y                           059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 END                             E2             059191
     C****                                                                059191
     C****REVIOUS VALUE DATE IS GREATER THAN OR EQUAL TO RUN DATE         059191
     C****ND VALUE DATE READ IS GREATER THAN OR EQUAL TO RUN DATE         059191
     C****       WWLAST    IFEQ 'Y'                        B2             059191
     C****       WWBALT    ANDEQ'Y'                                       059191
     C****                                                                059191
     C****RITE 'BALANCE' REC TO THE SUBFILE WITH AMOUNT = BALANCE         059191
     C****       WWRRN0    CHAINPM2120S1             70                   059191
     C****       WWRRN1    CHAINPM2120S1             70                   059191
     C****                 MOVE *BLANK    DDPSTD                          059191
     C****                 MOVE *BLANK    DDVALD                          059191
     C****       CLBL      ADD  DDAMNT    WWBAL                           059191
     C****       WWBAL     IFLT 0                          B3             059191
     C****                 Z-SUBWWBAL     ZFLD15                          059191
     C****                 ELSE                            X3             059191
     C****                 Z-ADDWWBAL     ZFLD15                          059191
     C****                 END                             E3             059191
     C****                 EXSR ZSEDIT                                    059191
     C****       WWBAL     IFGT 0                          B3             059191
     C****                 MOVE ZOUT21    WWDEBT                          059191
     C****                                                                059191
     C****       WWDEBT    IFEQ *BLANKS                    B4             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWDEBT                          059191
     C****                 END                                            059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWCRDT                          059191
     C****                 ELSE                            X3             059191
     C****                 MOVE ZOUT21    WWCRDT                          059191
     C****                                                                059191
     C****       WWCRDT    IFEQ *BLANKS                    B4             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWCRDT                          059191
     C****                 END                                            059191
     C****                 END                             E4             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWDEBT                          059191
     C****                 END                             E3             059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 Z-ADDWWPDAT    ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C****                 Z-ADD0         DDAMNT                          059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C*****                ADD  1         WWRRN1                          059191
     C*****                MOVE '1'       *IN50                           059191
     C*****                WRITEPM2120S1                                  059191
     C****       DDTYPR    IFEQ 'B'                        B3             059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 ELSE                            X3             059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 UPDATPM2120S0                                  059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                                                                059191
     C****                 END                             E2             059191
     C****                                                                059191
     C****F POSTING DATE VALUE DATE GREATER THAN OR EQUAL TO RUN DATE     059191
     C****ESET RUNNING TOTAL TO ZERO                                      059191
     C****       VALD      IFGE QMRDNB                     B2       R05897059191
     C****       WWPDAT    ANDLTQMRDNB                              R05897059191
     C****       VALD      IFGE WWLXTR                     B2             059191
     C****       WWPDAT    ANDLTWWLXTR                                    059191
     C****                 Z-ADD0         WWBAL                           059191
     C****                 END                             E2             059191
     C****                                                                059191
     C****RANSFER VALUE DATE READ INTO PREVIOUS VALUE DATE                059191
     C****                 MOVE VALD      WWPDAT                          059191
     C****                                                                059191
     C****ND LOOP ON SAME CUSTOMER, CURRENCY, ACCOUNT CODE & SEQUENCE     059191
     C****                 END                             E1             059191
     C****                                                                059191
     C****F NO RECORDS ON LF/HPOSTL5 WRITE ONLY CLEARED BALANCE RECORD    059191
     C****N THE SUBFILE                                                   059191
     C****       WWRRN1    IFEQ 0                          B1             059191
     C****                 MOVE *BLANK    DDPSTD                          059191
     C****                 MOVE *BLANK    DDVALD                          059191
     C****       CLBL      IFLT 0                          B2             059191
     C****                 Z-SUBCLBL      ZFLD15                          059191
     C****                 ELSE                            X2             059191
     C****                 Z-ADDCLBL      ZFLD15                          059191
     C****                 END                             E2             059191
     C****                 EXSR ZSEDIT                                    059191
     C****       CLBL      IFGT 0                          B2             059191
     C****                 MOVE ZOUT21    WWDEBT                          059191
     C****                                                                059191
     C****       WWDEBT    IFEQ *BLANKS                    B3             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWDEBT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWDEBT                          059191
     C****                 END                                            059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWCRDT                          059191
     C****                 ELSE                            X2             059191
     C****                 MOVE ZOUT21    WWCRDT                          059191
     C****                                                                059191
     C****       WWCRDT    IFEQ *BLANKS                    B3             059191
     C****       ZDECS     IFEQ 0                                         059191
     C****                 MOVE '0 '      WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 1                                         059191
     C****                 MOVE '0.0 '    WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 2                                         059191
     C****                 MOVE '0.00 '   WWCRDT                          059191
     C****                 END                                            059191
     C****       ZDECS     IFEQ 3                                         059191
     C****                 MOVE '0.000 '  WWCRDT                          059191
     C****                 END                                            059191
     C****                 END                             E3             059191
     C****                                                                059191
     C****                 MOVE *BLANK    WWDEBT                          059191
     C****                 END                             E2             059191
     C****                 MOVELTXT,1     DSNAR1                          059191
     C****                 MOVE 'N'       WWBALT                          059191
     C****                 Z-ADDQMRDNB    ZDAYNO                          059191
     C****                 EXSR ZDATE2                                    059191
     C****                 MOVELZADATE    DSNAR2                          059191
     C****                 MOVE *BLANK    DSNAR3                          059191
     C****                 MOVE DSNARR    DDPNAR                          059191
     C****                 Z-ADD0         DDAMNT                          059191
     C****                 MOVE 'B'       DDTYPR                          059191
     C****                 ADD  1         WWRRN1                          059191
     C****                 MOVE '1'       *IN50                           059191
     C****                 WRITEPM2120S1                                  059191
     C****                 MOVE '0'       *IN50                           059191
     C****                 MOVE *IN50     DDIN50                          059191
     C****                 MOVE 'D'       DDTYPR                          059191
     C****                 END                             E1             059191
     C****                                                                059191
     C****UBFILE END INDICATOR                                            059191
     C****                 MOVE '1'       *IN54                           059191
     C****                 MOVE '1'       WWSBFV                          059191
     C****                 Z-ADDWWRRN1    WWRRNB                          059191
     C****                                                                059191
     C****                 ENDSR                           * LSUBFV ESR * 059191
     C*****************************************************************
      /EJECT
     C*****************************************************************   R10055
      **                                                                  R10055
      ** WACMD  - FORMAT FIELDS FOR ACCOUNT MOVEMENT 'DETAIL' RECORD      R10055
      **                                                                  R10055
      ** CALLED FROM:                                                     R10055
      ** LSUBFP - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         R10055
      **          IN POSTING DATE DESCENDING SEQUENCE                     R10055
      ** LSUBFV - LOAD SUBFILE WITH MOVEMENTS AGAINST THE ACCOUNT         R10055
      **          IN VALUE DATE DESCENDING SEQUENCE                       R10055
      **                                                                  R10055
      ** CALLS:                                                           R10055
      ** ZDATE2 - STANDARD SUBROUTINE TO FORMAT DATE                      R10055
      ** ZSEDIT - STANDARD SUBROUTINE TO FORMAT AMOUNT                    R10055
      *                                                                   R10055
     C*****************************************************************   R10055
     C           WACMD     BEGSR                           * WACMD  BSR * R10055
     C*                                                                   R10055
     C** FORMAT POSTING DATE                                              R10055
     C                     Z-ADDPSTD      ZDAYNO                          R10055
     C                     EXSR ZDATE2                                    R10055
     C                     MOVELZADATE    DDPSTD                          R10055
     C*                                                                   R10055
     C** FORMAT VALUE DATE                                                R10055
     C                     Z-ADDVALD      ZDAYNO                          R10055
     C                     EXSR ZDATE2                                    R10055
     C                     MOVELZADATE    DDVALD                          R10055
     C*                                                                   R10055
     C** FORMAT POSTING AMOUNT                                            R10055
     C                     Z-ADDPSTA      ZFLD15                          R10055
     C                     EXSR ZSEDIT                                    R10055
     C******************** MOVELZOUT21    DDPSTA                   R10055 R01149
     C*                                                                   R10055
     C           DRCR      IFEQ 0                                         R10055
     C******************** MOVE 'DR'      DDPSTA                   R10055 R01149
     C                     MOVE 'DR'      DDDRCR                          R10055
     C                     MOVE ZOUT21    WWDEBT                          R01149
     C*                                                                   R05739
     C           WWDEBT    IFEQ *BLANKS                                   R05739
     C           ZDECS     IFEQ 0                                         R05739
     C                     MOVE '0 '      WWDEBT                          R05739
     C                     END                                            R05739
     C           ZDECS     IFEQ 1                                         R05739
     C                     MOVE '0.0 '    WWDEBT                          R05739
     C                     END                                            R05739
     C           ZDECS     IFEQ 2                                         R05739
     C                     MOVE '0.00 '   WWDEBT                          R05739
     C                     END                                            R05739
     C           ZDECS     IFEQ 3                                         R05739
     C                     MOVE '0.000 '  WWDEBT                          R05739
     C                     END                                            R05739
     C                     END                                            R05739
     C*                                                                   R05739
     C                     MOVE *BLANK    WWCRDT                          R01149
     C                     ELSE                                           R10055
     C******************** MOVE 'CR'      DDPSTA                   R10055 R01149
     C                     MOVE 'CR'      DDDRCR                          R10055
     C                     MOVE ZOUT21    WWCRDT                          R01149
     C*                                                                   R05739
     C           WWCRDT    IFEQ *BLANKS                                   R05739
     C           ZDECS     IFEQ 0                                         R05739
     C                     MOVE '0 '      WWCRDT                          R05739
     C                     END                                            R05739
     C           ZDECS     IFEQ 1                                         R05739
     C                     MOVE '0.0 '    WWCRDT                          R05739
     C                     END                                            R05739
     C           ZDECS     IFEQ 2                                         R05739
     C                     MOVE '0.00 '   WWCRDT                          R05739
     C                     END                                            R05739
     C           ZDECS     IFEQ 3                                         R05739
     C                     MOVE '0.000 '  WWCRDT                          R05739
     C                     END                                            R05739
     C                     END                                            R05739
     C*                                                                   R05739
     C                     MOVE *BLANK    WWDEBT                          R01149
     C                     END                                            R10055
     C*                                                                   R10055
     C                     MOVELPNAR      DDPNAR                          R10055
     C*                                                                   R10055
     C****                 Z-ADDPSTA      DDAMNT                    R10055059191
     C                     MOVE 'D'       DDTYPR                          R10055
     C*                                                                   R10055
     C                     ENDSR                           * WACMD  ESR * R10055
     C*****************************************************************
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2                                               S01486
     C*                                                                   S01486
     C/COPY ZSRSRC,ZSEDITZ3                                               S01486
     C*                                                                   S01486
     C********************************************************************S01486
     C***********                                                         S01486
     C*****ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.            S01486
     C***********                                                         S01486
     C*****THE*YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.         S01486
     C***********                                                         S01486
     C********************************************************************S01486
     C***********ZDATE2    BEGSR                           *** ZDATE2 *** S01486
     C***********                                                         S01486
     C*****CLEAR*LEAP YEAR WORK FIELD.                                    S01486
     C***********          MOVE 'N'       ZLEAP   1                       S01486
     C***********                                                         S01486
     C*****CLEAR*DATE FIELDS.                                             S01486
     C***********          Z-ADD0         ZDATE   60                      S01486
     C***********          MOVEL'       ' ZADATE  7                       S01486
     C***********                                                         S01486
     C*****CALCULATION TO DEFINE INPUT DAY NUMBER.                        S01486
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01486
     C***********                                                         S01486
     C*****DETERMINE YEAR NUMBER.                                         S01486
     C***********                                                         S01486
     C*****ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.                    S01486
     C***********ZDAYNO    SUB  1         ZDAYN1  50                      S01486
     C***********ZDAYN1    IFLT 0                                         S01486
     C***********          GOTO ZDEND2                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.             S01486
     C***********ZDAYN1    DIV  1461      ZLYR    20                      S01486
     C***********          MVR            ZDAYN1           SAVE REMAINING S01486
     C***********                                          DAYS           S01486
     C*****CALCULATE NUMBER OF REMAINING YEARS.                           S01486
     C***********          Z-ADD1         ZWRK2   20                      S01486
     C***********ZDTAG1    TAG                             ** ZDTAG1 TAG *S01486
     C***********ZDAYN1    IFGE ZYDY,ZWRK2                                S01486
     C***********ZWRK2     ADD  1         ZWRK2                           S01486
     C***********          GOTO ZDTAG1                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********ZWRK2     SUB  1         ZWRK2                           S01486
     C***********                                                         S01486
     C*****DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.                  S01486
     C***********ZWRK2     IFNE 0                                         S01486
     C***********ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CALCULATE ACTUAL YEAR NUMBER.                                  S01486
     C***********ZLYR      MULT 4         ZWRK3   30                      S01486
     C***********ZWRK3     ADD  72        ZWRK3            BASE IS 1972   S01486
     C***********          Z-ADDZWRK3     ZYEAR   20                      S01486
     C***********ZYEAR     ADD  ZWRK2     ZYEAR            YEAR           S01486
     C***********                                                         S01486
     C*****DETERMINE MONTH NUMBER.                                        S01486
     C***********                                                         S01486
     C*****ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.         S01486
     C***********ZWRK2     IFEQ 0                                         S01486
     C***********ZDAYN1    IFEQ 59                                        S01486
     C***********          MOVE 'Y'       ZLEAP                           S01486
     C***********          END                                            S01486
     C***********ZDAYN1    IFGE 59                                        S01486
     C***********ZDAYN1    SUB  1         ZDAYN1                          S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CALCULATE MONTH NUMBER.                                        S01486
     C***********          Z-ADD2         ZWRK2                           S01486
     C***********ZDTAG2    TAG                             ** ZDTAG2 TAG *S01486
     C***********ZDAYN1    IFGE ZMDY,ZWRK2                                S01486
     C***********ZWRK2     ADD  1         ZWRK2                           S01486
     C***********          GOTO ZDTAG2                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********ZWRK2     SUB  1         ZWRK2                           S01486
     C***********                                                         S01486
     C***********          Z-ADDZWRK2     ZMTH    20       MONTH          S01486
     C***********                                                         S01486
     C*****DETERMINE DAY OF MONTH.                                        S01486
     C***********                                                         S01486
     C*****ADD*BACK LAST DAY OF YEAR ADJUSTMENT.                          S01486
     C***********ZDAYN1    ADD  1         ZDAYN1                          S01486
     C***********                                                         S01486
     C*****CALCULATE DAY OF MONTH.                                        S01486
     C***********ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY            S01486
     C***********                                                         S01486
     C*****ADD*BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.       S01486
     C***********ZLEAP     IFEQ 'Y'                                       S01486
     C***********ZDAY      ADD  1         ZDAY                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****FORMAT DATE, DDMMYY OR MMDDYY.                                 S01486
     C**N98******          MOVELZDAY      ZWRK4   40                      S01486
     C***98******          MOVE ZDAY      ZWRK4                           S01486
     C**N98******          MOVE ZMTH      ZWRK4                           S01486
     C***98******          MOVELZMTH      ZWRK4                           S01486
     C***********          MOVELZWRK4     ZDATE                           S01486
     C***********          MOVE ZYEAR     ZDATE                           S01486
     C***********                                                         S01486
     C*****FORMAT ALPHA DATE, DDMMMYY.                                    S01486
     C***********          MOVELZDAY      ZWRK5   5                       S01486
     C***********ZDAY      IFLT 10                                        S01486
     C***********          MOVEL' '       ZWRK5                           S01486
     C***********          END                                            S01486
     C***********          MOVE ZMNM,ZMTH ZWRK5                           S01486
     C***********          MOVELZWRK5     ZADATE                          S01486
     C***********          MOVE ZYEAR     ZADATE                          S01486
     C***********                                                         S01486
     C***********ZDEND2    ENDSR                           * ZDEND2 ENDSR*S01486
     C***********                                                         S01486
     C***********                                                         S01486
     C********************************************************************S01486
      */EJECT****                                                         S01486
     C********************************************************************S01486
     C***********                                                        *S01486
     C***ZSEDIT*subroutine to insert a decimal point and sign into a     *S01486
     C***numeric*field and to blank out leading zeros (optionaly         *S01486
     C***inserting commas).                                              *S01486
     C*******Input fields:   ZFLD15 15/0                                 *S01486
     C***********            ZDECS  1/0                                  *S01486
     C***********            ZECODE 1/  ('J', 'L' or blank)              *S01486
     C***********                                                        *S01486
     C*******Arrays:         ZS1    15/1/0                               *S01486
     C***********            ZS2    21/1/                                *S01486
     C***********                                                        *S01486
     C*******Output fields:  ZOUT21 21                                   *S01486
     C***********                                                        *S01486
     C********************************************************************S01486
     C*SR********ZSEDIT    BEGSR                           **  ZSEDIT   * S01486
     C***********                                                         S01486
     C***Define/Clear fields                                              S01486
     C***********                                                         S01486
     C***********          Z-ADDZFLD15    ZFLD15 150                      S01486
     C***********          Z-ADDZDECS     ZDECS   10                      S01486
     C***********          MOVE ZECODE    ZECODE  1                       S01486
     C***********          MOVE *BLANKS   ZOUT21 21                       S01486
     C***********                                                         S01486
     C***SET*UP*WORK FIELDS                                               S01486
     C***********                                                         S01486
     C***********          Z-ADD0         ZS1                             S01486
     C***********          MOVE ' '       ZS2                             S01486
     C***********                                                         S01486
     C***********          Z-ADD15        Z1      20                      S01486
     C***********          Z-ADD20        Z2      20                      S01486
     C***********                                                         S01486
     C***********15        SUB  ZDECS     ZINTS   20                      S01486
     C***********                                                         S01486
     C***Check*if numeric field is negative                               S01486
     C***********                                                         S01486
     C***********ZFLD15    IFLT *ZEROS                                    S01486
     C***********          MOVE '-'       ZS2,21                          S01486
     C***********          Z-SUBZFLD15    ZFLD15                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          Z-ADDZFLD15    WORK15                          S01486
     C***********                                                         S01486
     C***CHECK*TO SEE IF THERE ARE ANY DECIMAL PLACES                     S01486
     C***********                                                         S01486
     C***********ZDECS     CABEQ0         ZS10                            S01486
     C***********                                                         S01486
     C***SET*UP*DECIMALS                                                  S01486
     C***********                                                         S01486
     C***********          Z-ADD*ZEROS    ZCNT    10                      S01486
     C***********ZCNT      DOUEQZDECS                                     S01486
     C***********          MOVE ZS1,Z1    ZS2,Z2                          S01486
     C***********          SUB  1         Z2                              S01486
     C***********          ADD  1         ZCNT                            S01486
     C***********          SUB  1         Z1                              S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***PUT*IN*DECIMAL PLACE                                             S01486
     C***********                                                         S01486
     C***********          MOVE '.'       ZS2,Z2                          S01486
     C***********          SUB  1         Z2                              S01486
     C***********                                                         S01486
     C***********ZS10      TAG                             ** ZS10 TAG ** S01486
     C***********                                                         S01486
     C***SET*UP*INTEGERS                                                  S01486
     C***********                                                         S01486
     C***********          Z-ADD*ZEROS    CNT3    10                      S01486
     C***********Z1        DOUEQ*ZEROS                                    S01486
     C***********          MOVE ZS1,Z1    ZS2,Z2                          S01486
     C***********          SUB  1         Z1                              S01486
     C***********          SUB  1         Z2                              S01486
     C***********                                                         S01486
     C***If*edit*code is 'J', insert a ',' before each group of three     S01486
     C***digits*- not if beginning of array reached.                      S01486
     C***********                                                         S01486
     C***********Z2        IFGT *ZEROS                                    S01486
     C***********ZECODE    ANDEQ'J'                                       S01486
     C***********          ADD  1         CNT3                            S01486
     C***********CNT3      IFEQ 3                                         S01486
     C***********          MOVE ','       ZS2,Z2                          S01486
     C***********          SUB  1         Z2                              S01486
     C***********          Z-ADD*ZEROS    CNT3                            S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***PUT*IN*LEADING BLANKS                                            S01486
     C***********                                                         S01486
     C***********          Z-ADD1         Z2                              S01486
     C***********ZS2,Z2    DOWEQ'0'                                       S01486
     C***********ZS2,Z2    OREQ ' '                                       S01486
     C***********ZS2,Z2    OREQ ','                                       S01486
     C***********          MOVE ' '       ZS2,Z2                          S01486
     C***********          ADD  1         Z2                              S01486
     C***********Z2        CABEQ22        ZS20                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***IF*NO*INTEGERS PUT IN LEADING ZERO                               S01486
     C***********                                                         S01486
     C***********ZS20      TAG                             ** ZS20 TAG ** S01486
     C***********                                                         S01486
     C***********Z2        IFEQ 22                                        S01486
     C***********          SUB  2         Z2                              S01486
     C***********          MOVE '0'       ZS2,Z2                          S01486
     C***********          ELSE                                           S01486
     C***********                                                         S01486
     C***********ZS2,Z2    IFEQ '.'                                       S01486
     C***********          SUB  1         Z2                              S01486
     C***********          MOVE '0'       ZS2,Z2                          S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***SET*UP*OUTPUT FIELD                                              S01486
     C***********                                                         S01486
     C***********          MOVEAZS2       ZOUT21                          S01486
     C***********                                                         S01486
     C*SR********          ENDSR                                          S01486
     C*****************************************************************   S01486
     C/EJECT                                                              S01486
     C/COPY ZSRSRC,ZACCH                                                  S01486
     C/EJECT                                                              S01486
     C/COPY ZSRSRC,ZBKDT                                                  S01486
      /EJECT
      ********************************************************************
      *                                                                  *
      ** ENDPRC - UPDATE GDA, TERMINATE PROCESS
      *                                                                  *
      ** SUBROUTINE CALLS:                                               *
      *                                                                  *
      ** SUBROUTINE CALLED FROM:                                         *
      ** P01    - ACCESS ACCOUNT MOVEMENTS
      ** *PSSR  - STANDARD ERROR SUBROUTINE
      *                                                                  *
      ** ROUTINE USES VARIABLES:                                         *
      *                                                                  *
      ********************************************************************
     C           ENDPRC    BEGSR                           ** ENDPRC BSR **
     C*
     C***UPDATE**GDA***************************************************   S01486
     C***********          MOVEL'Y'       QMENQT                          S01486
     C***********          MOVEL'PM2120'  QMPGM                           S01486
     C***********          CALL 'PMC1002'                                 S01486
     C***********          PARM           WWGDA                           S01486
     C*                                                                   S01486
     C** UPDATE *LDA                                                      S01486
     C*                                                                   S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C*
     C***END*GROUP*JOB*************************************************   S01486
     C***********          CALL 'PMC1020'                                 S01486
     C***********          CALL 'DBERRCTL'                          S01486086665
     C                     RETRN                                          S01486
     C*
     C                     ENDSR                           ** ENDPRC ESR **
      ********************************************************************
      /EJECT
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR                           S01486
     C                     DUMP
     C                     MOVEL'Y'       QMDBER                       ***
     C                     CALL 'DBERRCTL'                                086665
     C                     EXSR ENDPRC                                    S01486
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C***********                                                         S01486
     C*****ZBACK******TO*CALCULATE*LAST*WORKING*DAY*IN*CURRENCY********   S01486
     C***********                                                         S01486
     C***********ZBACK     BEGSR                           *** ZBKDAY *   S01486
     C***********                                                         S01486
     C*****CALCULATIONS*TO*DEFINE*INPUT*FIELDS.************************   S01486
     C***********          Z-ADDZDAYNO    ZDAYNO  50       STARTING DAT   S01486
     C***********          MOVE ZCCY      ZCCY    3        DATE CURRENC   S01486
     C***********          Z-ADDZNRDYS    ZNRDYS  50       DAYS BACKWAR   S01486
     C***********                                                         S01486
     C*****CLEAR*COUNT*OF*NBR*OF*DAYS*SUBTRACTED*&*DEFINE*ZDYNBR.******   S01486
     C***********          Z-ADD0         ZDCNT   20                      S01486
     C***********          Z-ADDZDAYNO    ZDYNBR  50                      S01486
     C***********                                                         S01486
     C*****EXIT*IF*NO*DAYS*SUBTRACTED**********************************   S01486
     C***********ZNRDYS    CABEQ0         ZBKEND                          S01486
     C***********                                                         S01486
     C*****LOOP*TO*DECREMENT*DAY*NUMBER*AND*CHECK*FOR*HOLIDAY.*********   S01486
     C***********ZDCNT     DOWLTZNRDYS                                    S01486
     C***********                                                         S01486
     C***********          SUB  1         ZDYNBR                          S01486
     C***********                                                         S01486
     C*****CHAIN*FOR*HOLIDAY*RECORD*1*-*IF*NOT*FOUND,*NO*HOLIDAY*******   S01486
     C***********ZDYNBR    CHAINTABLETJF             90                   S01486
     C************IN90     IFEQ '1'                                       S01486
     C***********RECI      ORNE 'D'                                       S01486
     C***********          ADD  1         ZDCNT                           S01486
     C***********          GOTO ZTOAGN                                    S01486
     C***********          ELSE                                           S01486
     C***********          MOVEAHCCY      ZHC,1                           S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CHECK*IF*DAY*IS*HOLIDAY*FOR*CURRENCY.***********************   S01486
     C***********ZCCY      LOKUPZHC                      93               S01486
     C***********                                                         S01486
     C*****DETERMINE*TYPE*FOUND,*IF*INCLUDE*AND*NOT*IN*ARRAY/EXCLUDE*AN   S01486
     C*****IN*ARRAY,*THEN*MUST*CHAIN*TO*RECORD*2*TO*SEE*IF*IT*IS*A*HOL.   S01486
     C***********INEX      IFEQ 'E'                                       S01486
     C************IN93     ANDEQ'1'                                       S01486
     C***********INEX      OREQ 'I'                                       S01486
     C************IN93     ANDEQ'0'                                       S01486
     C***********                                                         S01486
     C*****IF*BLANK*ENTRIES*IN*HCCY,*THEN*NO*RECORD*2*WILL*BE*PRESENT**   S01486
     C***********          Z-ADD1         Z       20                      S01486
     C***********'   '     LOKUPZHC,Z                    94ON IF NO RCD   S01486
     C***********Z         IFLT 26                                        S01486
     C***********          ADD  1         ZDCNT                           S01486
     C***********          GOTO ZTOAGN                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CHAIN*FOR*HOLIDAY*RECORD,*RECORD*2**************************   S01486
     C***********          READ TABLETJF                 90               S01486
     C************IN90     IFEQ '1'                                       S01486
     C***********RECI      ORNE 'D'                                       S01486
     C***********HOL       ORNE ZDYNBR                                    S01486
     C***********          ADD  1         ZDCNT                           S01486
     C***********          GOTO ZTOAGN                                    S01486
     C***********          ELSE                                           S01486
     C***********          MOVEAHCCY      ZHC,26                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CHECK*IF*DAY*IS*HOLIDAY*FOR*CURRENCY.***********************   S01486
     C***********ZCCY      LOKUPZHC                      93               S01486
     C***********                                                         S01486
     C*****DETERMINE*TYPE*FOUND,*IF*INCLUDE*AND*NOT*IN*ARRAY/EXCLUDE*AN   S01486
     C*****IN*ARRAY,*THEN*NOT*A*HOLIDAY********************************   S01486
     C***********INEX      IFEQ 'E'                                       S01486
     C************IN93     ANDEQ'1'                                       S01486
     C***********INEX      OREQ 'I'                                       S01486
     C************IN93     ANDEQ'0'                                       S01486
     C***********ZDCNT     ADD  1         ZDCNT                           S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C****END*OF*DO*LOOP*****************************************         S01486
     C***********ZTOAGN    TAG                             *** ZTOAGN *   S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********ZBKEND    ENDSR                                          S01486
     C*****************************************************************
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** CARRIED FORWARD BALANCE TEXT
BROUGHT FORWARD
