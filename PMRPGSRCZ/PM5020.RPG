     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Pool Customer Portfolio Selection')           *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                                 *
     F*                                                               *
     F*  PM5020 - PM POOL CUSTOMER PORTFOLIO ENQUIRY                  *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM005             Date 17Jul96               *
      *                 CFF004             Date 02Oct96               *
     F*                 085817             DATE 13MAR95               *
     F*                 082394             DATE 30JAN95               *
     F*                 S01486             DATE 30AUG94               *
     F*                 059478             DATE 11AUG93               *
     F*                 056986             DATE 22JUN93               *
     F*                 S01313             DATE 19MAY92               *
     F*                 41946 ADI          DATE 07JUL92               *
     F*                 MFOX               DATE 26JUN92               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           PBFG/5 - INSTRUMENT ASSET/LIABILITY SPLIT           *
     F*           PBFG/6 - ADDITIONAL CUSTOMER DETAILS                *
     F*           PBFG/7 - NET COMMITMENT BY CURRENCY                 *
     F*           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
     F*  085817 - Recompile due to changes in PMLDAPD                 *
     F*  082394 - Command 3 do not work.                              *
     F*  S01486 - Private Banking upgrade to Release 10               *
     F*  059478 - ALLOW ENQUIRY INTO PORTFOLIOS CONTAINING ONLY       *
     F*           MATURE / FLAT POSITIONS                             *
     F*  056986 - FIELDS REMOVED FROM FILE                            *
     F*  S01313 - RECOMPILED FOR PORTFOLIO PERFORMANCE                *
     F*                                                               *
     F*   41946 - WRONG CDP USED FOR FORMATING OF MARKET VALUE AND    *
     F*           ACCRUED INTEREST AMOUNTS.                           *
     F*   MFOX  - QCRECI NOT MORE DEFINED IN PMPOTTPP (SEE FIX B8040) *
     F*           SAME FOR QCPVAI                                     *
     F*  WRITTEN FOR SAR 91/08 - POOL SECURITIES TRANSACTIONS         *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F********************************************************************
     F***SDPORTL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F***PREFIX*'P9'                                                      S01486
     F***********                                                         S01486
     F***SDCURRL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F***PREFIX*'Q8'***                                                   S01486
     F***********                                                         S01486
     F***PMHSEXPPIF**E           K        DISK                            S01486
     FPMHSEXPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** PREFIX 'AG' **
     F**
     F***PMPOTTPPIF**E           K        DISK                            S01486
     FPMPOTTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** PREFIX 'QC' **
     F**
     F***PMPORTPPIF**E           K        DISK                            S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** PREFIX 'PN' **
     F**
     F***PMPTFTPPIF**E           K        DISK                            S01486
     FPMPTFTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F** PREFIX 'PE' **
     F**
     F***SDACOFL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F***PREFIX*'AZ'***                                                   S01486
     F***********                                                         S01486
     F***SDPLCSL2IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F***PREFIX*'QB'***                                                   S01486
     F***********                                                         S01486
     FPMSBPDPDIF  E           K        DISK
     F                                              KINFSR *PSSR
     F** PREFIX 'OR' **
     F**
     FPMSBPMPDIF  E           K        DISK
     F                                              KINFSR *PSSR
     F** PREFIX 'OS' **
     F**
     F***SDBANKL1IF**E                    DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F***PREFIX*'BJ'***                                                   S01486
     F***********                                                         S01486
     F** PREFIX 'QF' **                                                   059478
     F***PMMFHLPPIF**E           K        DISK                      059478S01486
     FPMMFHLPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR          059478
      ** Prefix 'FE' **                                                   CPM005
     FPMASLIL0IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
      ** Prefix 'FI' **                                                   CPM005
     FPMCIALL0IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
      ** Prefix 'FM' **                                                   CPM005
     FPMICALL0IF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
      ** Prefix 'FJ' **                                                   CPM005
     FPMNTCMLLIF  E           K        DISK                               CPM005
     F                                              KINFSR *PSSR          CPM005
     F***PM5020DDCF**E                    WORKSTN                         S01486
     FPM5020DFCF  E                    WORKSTN                            S01486
     F                                        RRN1  KSFILE PM5020S1
     F** PREFIX 'DD' **
     F**
     F*****************************************************************
      /EJECT
     F*************************************************************
     F*                                                          **
     F* ID F  C  H  L    FUNCTION OF INDICATORS                  **      *
     F*                                                          **      *
     F* 34            USED FOR DISPLAY ATTRIBUTE ON PM5020C1     **      *
     F* 35            USED FOR DISPLAY ATTRIBUTE ON PM5020F1     **      *
     F* 36            USED FOR DISPLAY ATTRIBUTE ON PM5020S1     **      *
     F* 37            USED FOR DISPLAY ATTRIBUTE ON PM5020C1     **      *
     F* 38            USED FOR DISPLAY ATTRIBUTE ON PM5020C1     **      *
     F* 40            USED FOR DISPLAY ATTRIBUTE ON PM5020S1          *   S01486
     F*                                                          **      *
     F* 70            READ ON DSPF/PM5020C1                      **      *
     F* 71            READ ON DSPF/PM5020S1                      **      *
     F**72************READ*ON*LF/SDPORTL1*********************************S01486
     F**73************READ*ON*LF/SDBANKL1*********************************S01486
     F**74************READ*ON*PF/PMHSEXPP*********************************S01486
     F**75************CHAIN*ON*PF/PMPORTPP********************************S01486
     F* 74            READ ON PF/PMHSEXPD                        **      *S01486
     F* 75            CHAIN ON PF/PMPORTPD                       **      *S01486
     F**76************CHAIN*ON*LF/SDCURRL1********************************S01486
     F**77************CHAIN*ON*PF/PMPOTTPP********************************S01486
     F* 77            CHAIN ON PF/PMPOTTPD                       **      *S01486
     F* 78            CHAIN ON PF/PMSBPDPD                       **      *
     F* 79            CHAIN ON PF/PMSBPMPD                       **      *
     F*                                                          **
     F*************************************************************
      /EJECT
     E*************************************************************
     E***********                                                         S01486
     E***TABLES*AND*ARRAYS*FOR*ZDATE2*************************************S01486
     E***********                                                         S01486
     E***********         ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYS01486
     E***********         ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYS01486
     E***********         ZMNM   12  12  3               ZDATE2 SR. ARRAY S01486
     E***********                                                         S01486
     E***TABLES*AND*ARRAYS*FOR*ZSEDIT*************************************S01486
     E***********                                                         S01486
     E***********         ZS1        15  1 0                              S01486
     E***********         ZS2        21  1                                S01486
     E/COPY ZSRSRC,ZDATE2Z1                                               S01486
     E/COPY ZSRSRC,ZSEDITZ1                                               S01486
     E**
     E                    CPY@    1   1 80
     E*************************************************************
      /EJECT
     I*************************************************************
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I**
     I***EXTERNAL*FORMAT*FOR*GROUP*DATA*AREA******************************S01486
     I** EXTERNAL FORMAT FOR LOCAL DATA AREA                              S01486
     I**
     I***WWGDA*****E*DSPMGRDAPP                                           S01486
     I**
     I***WWLDA*****E*DSPMLDAPP                                            S01486
     IWWLDA     E DSPMLDAPD                                               S01486
     I**
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     IPSDS       SDS
     I                                      244 253 WSID
     I                                      254 263 USID
     I*                                                                   S01486
     IRUNDAT      DS                                                      S01486
     I** DATA STRUCTURE FOR MULTIBRANCH INDICATOR USING RUNDAT.           S01486
     I                                       13  13 MBIN                  S01486
     I*
     IWWPPDG      DS
     I                                        1   1 WWPDG1
     I                                        2   2 WWPDG2
     I                                        3   3 WWPDG3
     I                                        4   4 WWPDG4
     I                                        5   5 WWPDG5
     I                                        6   6 WWPDG6
     I                                        7   7 WWPDG7
     I**
     I** DATA STRUCTURE WHEN ERROR ON PF/PMSBPMPD
     I**
     IWWWPTM      DS
     I**********                              1   60WPCNU                                     CSD027
     I                                        1   6 WPCNU                                     CSD027
     I                                        7  10 WPRPO
     I**********                             11  160WCUNU                                     CSD027
     I                                       11  16 WCUNU                                     CSD027
     I                                       17  20 WREPO
     I**
     I** DATA STRUCTURE WHEN ERROR ON PF/PMSBPDPD
     I**
     IWWWPTD      DS
     I**********                              1   60WWPOCU                                    CSD027
     I                                        1   6 WWPOCU                                    CSD027
     I                                        7  10 WWPOFO
     I**
     I***DATA*STRUCTURE*WHEN*ERROR*ON*PF/PMPORTPP*************************S01486
     I** DATA STRUCTURE WHEN ERROR ON PF/PMPORTPD                         S01486
     I**
     IWWWORT      DS
     I**********                              1   60WWCUST                                    CSD027
     I                                        1   6 WWCUST                                    CSD027
     I                                        7  10 WWPORE
     I**
     I** DATA STRUCTURE WHEN ERROR ON PF/PMPOTTPD
     I**
     IWWWOTT      DS
     I**********                              1   60WWCUSR                                    CSD027
     I                                        1   6 WWCUSR                                    CSD027
     I                                        7  10 WWPTFR
     I**
     I***DATA*STRUCTURE*WHEN*ERROR*ON*PF/PMHSEXPP*************************S01486
     I** DATA STRUCTURE WHEN ERROR ON PF/PMHSEXPD                         S01486
     I**
     IWWWSEX      DS
     I                                        1   3 WWHCCY
     I                                        4   80WWYEST
     I***********                                                         S01486
     I***DATA*STRUCTURE*TO*WORK*FOR*ZSEDIT********************************S01486
     I***********                                                         S01486
     I*********** DS                                                      S01486
     I***********                             1  150WORK15                S01486
     I***********                             1  150ZS1                   S01486
     I/COPY ZSRSRC,ZSEDITZ2                                               S01486
     I*                                                                   S01486
     ISDACOF    E DSSDACOFPD                                              S01486
     I** DUMMY RECORD FORMAT FOR ACCOUNT OFFICER DETAILS                  S01486
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I** DUMMY RECORD FORMAT FOR BANK DETAILS                             S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I** DUMMY RECORD FORMAT FOR CURRENCY DETAILS                         S01486
     I*                                                                   S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I** DUMMY RECORD FORMAT FOR CUSTOMER DETAILS                         S01486
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I** DUMMY RECORD FORMAT FOR PORTFOLIO MANAGEMENT CUSTOMER DETAILS    S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I** DUMMY RECORD FORMAT FOR PORTFOLIO MANAGEMENT ICD DETAILS         S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01486
     I**
     I********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     - MAIN PROCESSING                                       *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      * #P1004   - PROCESS PORTFOLIO DETAILS                             *
      * #P1005   - PROCESS POOL PORTFOLIO DETAILS                        *
      * #P1008   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      * #P1009   - PROCESS PREPARE DETAILS FOR OUTPUT TO HEADER          *
      * #P1015   - FILL HEADER, DISPLAY SCREEN                           *
      * #P1016   - SET UP INFORMATION FOR PLEDGE ETC..                   *
      * #U1001   - DISPLAY CUSTOMER DETAILS                              *
      * #W1002   - UPDATE DATA AREA                                      *
      * ZCCYXR   - SEE ZCCYCN                                            *
      * ZDATE2   - TO CONVERT A MIDAS DATE NUMBER IN ALPHA               *
      * ZSEDIT   - TO EDIT A NUMBER WITH DECIMAL POINT                   *
      * *PSSR    - TO PROCESS DATA BASE ERRORS                           *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      **PMC1010**-*TO*RETRIEVE*DATA*AREA**********************************S01486
      **PMC1000**-*TO*UPDATE*DATA*AREA************************************S01486
      **PMC1020**-*TO*STOP*GROUP*JOB**************************************S01486
      **PM0660***-*SEARCH*SELECT*WINDOW***********************************S01486
      **PMC5020**-*TO*START*THE*SCROLL*GROUP*JOB**************************S01486
      **PM0600***-*NOTEPAD************************************************S01486
      * PMC1003  - TO RETRIEVE DATA AREA                                 *S01486
      * PMC1001  - TO UPDATE DATA AREA                                   *S01486
      * PMC0660  - SEARCH SELECT WINDOW                                  *S01486
      * PMC5020  - TO START THE SCROLL SCREEN                            *S01486
      * PMC0600  - NOTEPAD                                               *S01486
      * PM0640   - OPTION 'C' TAKEN                                      *
      * PM0670   - OPTION 'I' TAKEN                                      *S01486
      *                                                                  *
      ********************************************************************
      /EJECT
     C***************************************************************
     C** MAIN                                                      **
     C***************************************************************
     C**
     C** PARAMETER LIST
     C**
     C           *ENTRY    PLIST
     C                     PARM           WWUPRF 10
     C**
     C***KEY*LIST*FOR*ACCESS*ON*FILE*PMPOTTPP*****************************S01486
     C** KEY LIST FOR ACCESS ON FILE PMPOTTPD                             S01486
     C**
     C           PMPOTT    KLIST
     C                     KFLD           WWCUSR
     C                     KFLD           WWPTFR
     C**
     C** KEY LIST FOR ACCESS ON FILE PMSBPMPD
     C**
     C           PMPPTM    KLIST
     C                     KFLD           WPCNU
     C                     KFLD           WPRPO
     C                     KFLD           WCUNU
     C                     KFLD           WREPO
     C**
     C** KEY LIST FOR ACCESS ON FILE PMSBPDPD
     C**
     C           PMPPTD    KLIST
     C                     KFLD           WWPOCU
     C                     KFLD           WWPOFO
     C**
     C***KEY*LIST*FOR*ACCESS*ON*FILE*PMPORTPP*****************************S01486
     C** KEY LIST FOR ACCESS ON FILE PMPORTPD                             S01486
     C**
     C           PMPORT    KLIST
     C                     KFLD           WWCUST
     C                     KFLD           WWPORE
     C**
     C***KEY*LIST*FOR*ACCESS*ON*FILE*PMHSEXPP*****************************S01486
     C** KEY LIST FOR ACCESS ON FILE PMHSEXPD                             S01486
     C**
     C           PMHSEX    KLIST
     C                     KFLD           WWHCCY
     C                     KFLD           WWYEST
     C**                                                                  059478
     C           MFHLK     KLIST                                          059478
     C**********           KFLD           WXCNUM  60                                   059478 CSD027
     C                     KFLD           WXCNUM  6                                           CSD027
     C                     KFLD           WXPTFR  4                       059478
     C                     KFLD           WXDSPS  20                      059478
     C                     KFLD           WXDSPG  3                       059478
     C                     KFLD           WXITDS  20                      059478
     C                     KFLD           WXINNR  3                       059478
     C                     KFLD           WXDLSQ  30                      059478
     C                     KFLD           WXCCY1  3                       059478
     C                     KFLD           WXTDSS 10                       059478
     C**********           KFLD           WXTRNB  60                                   059478 CLE148
     C                     KFLD           WXTRNB  6                                           CLE148
     C**********           KFLD           WXTXT2 20                                    059478 CGL029
     C                     KFLD           WXTXT2 26                                           CGL029
     C**                                                                  059478
     C           MFHLK1    KLIST                                          059478
     C**********           KFLD           WXCNUM  60                                   059478 CSD027
     C                     KFLD           WXCNUM  6                                           CSD027
     C                     KFLD           WXPTFR  4                       059478
     C**
     C****************
     C** PROGRAM START
     C****************
     C**
     C                     EXSR #P1001
     C**
     C                     RETRN
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PMC1003  - TO RETRIEVE DATA AREA *LDA                            *
      **PMC1004**-*TO*RETRIEVE*DATA*AREA**GDA*****************************S01486
      * PMC1001  - TO UPDATE DATA AREA *LDA                              *
      **PMC1002**-*TO*UPDATE*DATA*AREA**GDA*******************************S01486
      **PMC1020**-*TO*STOP*GROUP*JOB**************************************S01486
      * #P1002   - PROCESS SCREEN SET UP                                 *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      **PM0660***-*SEARCH*SELECT*WINDOW***********************************S01486
      * PMC0660  - SEARCH SELECT WINDOW                                  *S01486
      **PMC5020**-*TO*START*THE*SCROLL*GROUP*JOB**************************S01486
      * PMC5020  - TO START THE SCROLL JOB                               *S01486
      * #P1015   - FILL HEADER, DISPLAY SCREEN                           *
      **PM0600***-*NOTEPAD************************************************S01486
      * PMC0600  - NOTEPAD                                               *S01486
      * #W1002   - UPDATE DATA AREA                                      *
      * PM0640   - OPTION 'C' TAKEN - PORTFOLIO CASHFLOW                 *
      * PM0760   - OPTION 'I' TAKEN - INVESTMENT POLICIES DETAILS        *S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     - MAIN PROCESSING                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWLDA    - *LDA PARAMETER                                        *
      **WWGDA****-**GDA*PARAMETER*****************************************S01486
      * WWEND    - END PARAMETER                                         *
      * WWGRPJ   - GROUP JOB PARAMETER                                   *
      * QMFLAG   - WORK FLAG                                             *
      * WWSCRL   - SCROLL PARAMETER                                      *
      * WWFIN    - END PARAMETER                                         *
      *                                                                  *
      ********************************************************************
     C**
     C           #P1001    BEGSR
     C*                                                                   S01486
     C** READ DATA AREA - RUNDAT                                          S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN           RUNDAT                          S01486
     C                     IN   RUNDAT                                    S01486
     C**                                                                  S01486
     C**   Fill in fields for subroutine ZASNMS                           S01486
     C**                                                                  S01486
     C                     MOVEL'*'       DDPGMQ                          S01486
     C                     MOVEL'*'       TOPQ                            S01486
     C                     MOVEL'*PRV'    TOPRQ                           S01486
     C                     MOVEL*BLANK    ZAPGM  10        Message queue  S01486
     C                     MOVEL'PMUSRMSG'ZAMSGF 10        Message file   S01486
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue      S01486
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.    S01486
     C                     MOVEL*BLANK    ZAMSDA132        Message data.  S01486
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.  S01486
     C**
     C** PREPARE FIELD ZECODE FOR SUBROUTINE ZSEDIT
     C**
     C                     MOVEL'J'       ZECODE
     C                     MOVEA'0'       *IN
     C                     MOVE '0'       *INKL
     C**
     C** INITIALIZE RECORD NUMBER
     C**
     C                     Z-ADD0         RRN1    40
     C                     Z-ADD1         SFLRRN
     C**
     C** INITIALIZE FLAGS
     C**
     C***********          MOVEL*BLANK    WWFLAG  1                       082394
     C                     MOVE '0'       *IN98
     C**
     C** INITIALIZE WWPPDG
     C**
     C                     MOVE *BLANK    WWPDG1
     C                     MOVE *BLANK    WWPDG3
     C                     MOVE *BLANK    WWPDG5
     C                     MOVE '/'       WWPDG2
     C                     MOVE '/'       WWPDG4
     C                     MOVE '/'       WWPDG6
     C                     MOVE *BLANK    WWPDG7
     C**
     C** ACCESS LF/SDBANKL1 TO OBTAIN BK ICD
     C**
     C***********          READ SDBANKL1                 73               S01486
     C***********                                                         S01486
     C************IN73     IFEQ '1'                                       S01486
     C***********          MOVEL'Y'       QMDBER                          S01486
     C***********          MOVEL'Y'       QMENQT                          S01486
     C***********          MOVE 'SDBANKL1'QMFILE                          S01486
     C***********          MOVE 'PM5020'  QMPGM                           S01486
     C***********          MOVE *BLANKS   QMKEY            ***************S01486
     C***********          Z-ADD1         QMERRN           **DB ERROR 01**S01486
     C***********          EXSR *PSSR                      ***************S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM '*DBERR'  RTCD    7                       S01486
     C                     PARM '*FIRST'  OPTN    7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C**
     C** RETRIEVE DATA AREA
     C**
     C                     CALL 'PMC1003'
     C                     PARM           WWLDA
     C**
     C** CALCULATE DATE OF LAST COB
     C**
     C           QMRDNB    SUB  1         WWYEST
     C**
     C** ACCESS LF/SDPORTL1 TO OBTAIN PM ICD
     C**
     C***********          READ SDPORTL1                 72               S01486
     C***********                                                         S01486
     C************IN72     IFEQ '1'                                       S01486
     C***********          MOVEL'Y'       QMDBER                          S01486
     C***********          MOVEL'Y'       QMENQT                          S01486
     C***********          MOVE 'SDPORT'  QMFILE                          S01486
     C***********          MOVE 'PM5020'  QMPGM                           S01486
     C***********          MOVE *BLANKS   QMKEY            ***************S01486
     C***********          Z-ADD2         QMERRN           **DB ERROR 02**S01486
     C***********          EXSR *PSSR                      ***************S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM '*DBERR'  RTCD    7                       S01486
     C                     PARM '*FIRST'  OPTN    7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C**
     C** ACCESS SDCURRL1 WITH CUSTOMER CURRENCY TO OBTAIN CURRENCY
     C** DETAILS
     C**
     C***********QMCSBY    CHAINSDCURRL1             76                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM QMCSBY    KEYCY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C************IN76     IFEQ '1'                                       S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C                     MOVE 'SDCURRL1'QMFILE
     C                     MOVE 'PM5020'  QMPGM
     C                     MOVE QMCSBY    QMKEY            ***************
     C                     Z-ADD3         QMERRN           **DB ERROR 03**
     C                     EXSR *PSSR                      ***************
     C**
     C                     END
     C**
     C** SAVE SPOT RATE, CURRENCY DECIMAL PLACES AND MULTIPLY/DIVIDE
     C** INDICATOR
     C**
     C                     Z-ADDA6SPRT    W2SPRT 138
     C                     Z-ADDA6NBDP    W2NBDP  10
     C                     MOVELA6MDIN    W2MDIN  1
     C**
     C** ACCESS SDCURRL1 WITH CURRENCY FOR ACCOUNTING TO OBTAIN
     C** CURRENCY DETAILS
     C**
     C***********QMCYCD    CHAINSDCURRL1             76                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM QMCYCD    KEYCY                           S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C************IN76     IFEQ '1'                                       S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C                     MOVE 'SDCURRL1'QMFILE
     C                     MOVE 'PM5020'  QMPGM
     C                     MOVE QMCYCD    QMKEY            ***************
     C                     Z-ADD4         QMERRN           **DB ERROR 04**
     C                     EXSR *PSSR                      ***************
     C**
     C                     END
     C**
     C** SAVE SPOT RATE, CURRENCY DECIMAL PLACES AND MULTIPLY/DIVIDE
     C** INDICATOR
     C**
     C                     Z-ADDA6SPRT    W3SPRT 138
     C                     Z-ADDA6NBDP    W3NBDP  10
     C                     MOVELA6MDIN    W3MDIN  1
     C**
     C***********P9TVPS    IFEQ 'V'                                       S01486
     C           FCTVPS    IFEQ 'V'                                       S01486
     C                     MOVE '1'       *IN35
     C                     ELSE
     C                     MOVE '0'       *IN35
     C                     END
     C**
     C** ACCESS LF/PMSBPDPD WITH CUSTOMER NUMBER AND PORTFOLIO
     C***REFERENCE*FROM*DTAARA/*GDA***************************************S01486
     C** REFERENCE FROM DTAARA/*LDA                                       S01486
     C**
     C                     MOVE QMCNUM    WWPOCU
     C                     MOVE QMPTF2    WWPOFO
     C**
     C           PMPPTD    CHAINPMSBPDPD             78
     C**
     C           *IN78     IFEQ '1'
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C                     MOVE 'PMSBPDPD'QMFILE
     C                     MOVE 'PM5020'  QMPGM
     C                     MOVE WWWPTD    QMKEY            ***************
     C                     Z-ADD5         QMERRN           **DB ERROR 05**
     C                     EXSR *PSSR                      ***************
     C**
     C                     END
     C**
     C** SET UP SCREEN DETAILS
     C**
     C                     EXSR #P1002
     C**
     C                     EXSR #P1015
     C**
     C** DO UNTIL TERMINATION FLAG SET TO 'Y'
     C**
     C***********WWFLAG    DOUEQ'Y'                                       082394
     C           QMENQT    DOUEQ'Y'                                       082394
     C**
     C** SET TERMINATION FLAG TO 'N'
     C** (THIS MEANS THAT THIS PROCESSING LOOP WILL NEVER BE EXITED.
     C** TO EXIT PROGRAM RETURN TO PMC5020
     C**
     C***********          MOVEL'N'       WWFLAG                          082394
     C**
     C                     EXSR #P1003
     C**
     C** IF F3 TAKEN
     C**
     C           *INKC     IFEQ '1'
     C**
     C***SET*ENQUIRIES*TERMINATING*ON**GDA*TO*'Y'*************************S01486
     C** SET ENQUIRIES TERMINATING ON *LDA TO 'Y'                         S01486
     C**
     C                     MOVEL'Y'       QMENQT
     C**
     C***UPDATE**GDA******************************************************S01486
     C** UPDATE *LDA                                                      S01486
     C**
     C***********          CALL 'PMC1002'                                 S01486
     C***********          PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C**
     C**
     C                     END
     C**
     C** IF F4 TAKEN
     C**
     C           *INKD     IFEQ '1'
     C**
     C                     CALL 'PMC0660'
     C                     PARM           WWF12   1
     C                     PARM 'N'       WWIND   1                       CPM005
     C**
     C           WWF12     IFNE 'Y'
     C**
     C***RESET*ALL*FIELDS*OF*DTAARA**GDA**********************************S01486
     C** RESET ALL FIELDS OF DTAARA *LDA                                  S01486
     C**
     C                     MOVEL*BLANKS   QMPTF1
     C                     MOVEL*BLANKS   QMPTF2
     C                     MOVEL*BLANKS   QMPTFN
     C                     MOVEL*BLANKS   QMTPMV
     C                     MOVEL*BLANKS   QMVPMV
     C                     MOVEL*BLANKS   QMPTAI
     C                     MOVEL*BLANKS   QMPVAI
     C                     MOVEL*BLANKS   QMPTCY
     C                     Z-ADD0         QMPCDP
     C                     MOVEL*BLANKS   QMPTFT
     C                     MOVEL*BLANKS   QMDPO1
     C                     MOVEL*BLANKS   QMPPDG
     C                     MOVEL*BLANKS   QMDSPG
     C                     MOVEL*BLANKS   QMNDSP
     C                     MOVEL*BLANKS   QMDSPT
     C                     Z-ADD0         QMDSPS
     C                     MOVEL*BLANKS   QMDGMV
     C                     MOVEL*BLANKS   QMDGAI
     C                     MOVEL*BLANKS   QMINNR
     C                     MOVEL*BLANKS   QMISTN
     C                     Z-ADD0         QMITDS
     C                     MOVEL*BLANKS   QMTIMV
     C                     MOVEL*BLANKS   QMVIMV
     C                     MOVEL*BLANKS   QMITAI
     C                     MOVEL*BLANKS   QMIVAI
     C                     MOVEL*BLANKS   QMMODI
     C                     MOVEL*BLANKS   QMSESN
     C**********           Z-ADD0         QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMENQT
     C                     MOVEL*BLANKS   QMDBER
     C                     MOVEL*BLANKS   QMATTN
     C                     MOVEL*BLANKS   QMPGM
     C                     MOVEL*BLANKS   QMFILE
     C                     MOVEL*BLANKS   QMKEY
     C                     Z-ADD0         QMERRN
     C                     MOVEL*BLANKS   QMPPCS
     C**
     C***UPDATE**GDA******************************************************S01486
     C** UPDATE *LDA                                                      S01486
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C***********                                                         S01486
     C***********          CALL 'PMC1002'                                 S01486
     C***********          PARM           WWGDA                           S01486
     C**
     C                     END
      *                                                                   CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C**
     C                     END
     C**
     C** IF F12 TAKEN
     C**
     C           *INKL     IFEQ '1'
     C**
     C***********          CALL 'PMC1020'                                 S01486
     C                     RETRN                                          S01486
     C**
     C                     END
     C**
     C** IF F24 TAKEN
     C**
     C           *INKY     IFEQ '1'
     C**
     C                     MOVEL'PM0630'  PGMNAM 10                       CPM005
     C                     CALL 'PMC0600'
     C                     PARM           PGMNAM                          CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C**
     C                     END
     C**
     C** IF ENTER HAS BEEN PRESSED
     C**
     C           *IN60     IFEQ '0'
     C**
     C           WWMBR     IFNE *ZEROS
     C**
     C                     READCPM5020S1                 71
     C**
     C           *IN71     IFEQ '0'
     C                     MOVELDDACTN    WWACTN  1
     C                     MOVEL*BLANK    DDACTN
     C                     MOVELDDCUST    QMCNUM
     C                     MOVELDDPORT    QMPTF1
     C                     MOVELDDPORT    QMPTF2
     C                     MOVEL*BLANKS   QMPPCS
     C                     MOVE DDTRDH    QMTPMV
     C                     MOVE DDVALH    QMVPMV
     C                     MOVE DDTAIH    QMPTAI
     C                     MOVE DDVAIH    QMPVAI
     C                     MOVE W2PPDG    QMPPDG
     C**
     C***********DDCUST    CHAINSDPLCSL2             69                   S01486
     C                     MOVELDDCUST    KEYCN                           S01486
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN  10                       S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C           RTCD      IFEQ *BLANKS                                   S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN  10                       S01486
     C                     PARM           KEYST   7                       S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C                     END                                            S01486
     C************IN69     IFEQ '1'                                       S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C                     MOVE 'SDPLCSL2'QMFILE
     C                     MOVE 'PM5020'  QMPGM
     C                     MOVE DDCUST    QMKEY            ***************
     C                     Z-ADD7         QMERRN           **DB ERROR 07**
     C                     EXSR *PSSR                      ***************
     C                     END
     C**
     C** CUSTOMER REPORT NAME
     C**
     C                     MOVELBBCRNM    QMCRNM
     C                     MOVELBBCSSN    QMCSSN
     C                     MOVELBBCRTN    QMCRTN
     C******************** Z-ADDQBDASS    ZDAYNO                         056986
     C******************** EXSR ZDATE2                                   056986
     C******************** MOVE ZADATE    QMDTA1                         056986
     C                     MOVELBBACOC    QMACOC
     C***********BBACOC    CHAINSDACOFL1             72                   S01486
     C                     CALL 'AOACOFR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM BBACOC    KEYAF   2                       S01486
     C           SDACOF    PARM SDACOF    DSFDY                           S01486
     C************IN72     IFEQ '0'                                       S01486
     C           RTCD      IFEQ *BLANKS                                   S01486
     C                     MOVELAZACON    QMACON
     C                     END
     C**
     C                     MOVE DDCUST    WWCUST
     C                     MOVE DDPORT    WWPORE
     C**
     C***ACCESS*PF/PMPORTPP*WITH*CUSTOMER*NUMBER*AND*PORTFOLIO************S01486
     C** ACCESS PF/PMPORTPD WITH CUSTOMER NUMBER AND PORTFOLIO            S01486
     C**
     C***********PMPORT    CHAINPMPORTPP             75                   S01486
     C           PMPORT    CHAINPMPORTPD             75                   S01486
     C**
     C           *IN75     IFEQ '1'
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C***********          MOVE 'PMPORTPP'QMFILE                          S01486
     C                     MOVE 'PMPORTPD'QMFILE                          S01486
     C                     MOVE 'PM5020'  QMPGM
     C                     MOVE WWWORT    QMKEY            ***************
     C                     Z-ADD8         QMERRN           **DB ERROR 08**
     C                     EXSR *PSSR                      ***************
     C                     END
     C**
     C                     MOVE PNPTFN    QMPTFN
     C                     Z-ADDPNDPOP    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    QMDPO1
     C**
     C           PNPTFT    IFNE *BLANK
     C***********PNPTFT    CHAINPMPTFTPP             74                   S01486
     C           PNPTFT    CHAINPMPTFTPD             74                   S01486
     C           *IN74     IFEQ '0'
     C                     MOVELPEPTFT    QMPTFT
     C                     END
     C                     END
     C*                                                                   S01486
     C** VALIDATE USER, ACTION CODE AND BRANCH                            S01486
     C*                                                                   S01486
     C                     EXSR #Z1001                                    S01486
     C**
     C                     UPDATPM5020S1
     C                     Z-ADDRRN1      SFLRRN
     C                     WRITEPM5020F0                                  S01486
     C                     WRITEPM5020C1
     C                     SETOF                     40                   S01486
     C                     END
     C                     END
     C*                                                                   S01486
     C** VALIDATE USER, ACTION CODE AND BRANCH IF NOT ALREADY VALIDATED   S01486
     C*                                                                   S01486
     C           VALIDA    IFNE 'Y'                                       S01486
     C                     MOVELDDPOCU    KEYCN                           S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN  10                       S01486
     C                     PARM           KEYST   7                       S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER                          S01486
     C                     MOVEL'Y'       QMENQT                          S01486
     C                     MOVE 'SDCUSTPD'QMFILE                          S01486
     C                     MOVE 'PM5020'  QMPGM                           S01486
     C                     MOVE DDPOCU    QMKEY            ***************S01486
     C                     Z-ADD14        QMERRN           **DB ERROR 14**S01486
     C                     EXSR *PSSR                      ***************S01486
     C                     END                                            S01486
     C                     EXSR #Z1001                                    S01486
     C                     WRITEPM5020F0                                  CPM005
     C                     MOVE '0'       *IN40                           CPM005
     C                     END                                            S01486
     C*                                                                   S01486
     C** DO NOT DO ACTION IF ACTION CODE NOT VALID                        S01486
     C*                                                                   S01486
     C           ERR       IFEQ 0                                         S01486
     C**
     C***IF*OPTION*'C'*HAS*BEEN*TAKEN**********************************   CPM005
      **  If option 'I' has been taken                                    CPM005
     C**
     C***********WWACTN    IFEQ 'C'
     C           WWACTN    IFEQ 'I'                                       CPM005
     C           PMPOTT    CHAINPMICALL0             72                   CPM005
     C           *IN72     IFEQ '0'                                       CPM005
     C**
     C** CALL  PMC1001 TO UPDATE LDA
     C**
     C                     EXSR #W1002
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C***CALL*PM0640*WITH*PARAMETERS*PASSED*BY*GDA************************S01486
     C***CALL*PM0640*WITH*PARAMETERS*PASSED*BY*LDA*****************S01486 CPM005
      **  Call PM6090 with parameters passed by LDA                       CPM005
     C**
     C                     MOVEL'TOTICY  'WWJOB                           CPM005
     C***********          CALL 'PM0640'                                  CPM005
     C                     CALL 'PMC5020'                                 CPM005
     C                     PARM           WWJOB                           CPM005
     C**
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD
     C** SET UP IN #W1002
     C**
     C                     MOVEL*BLANKS   QMPTF1
     C                     MOVEL*BLANKS   QMPTF2
     C                     MOVEL*BLANKS   QMPTFN
     C                     MOVEL*BLANKS   QMVPMV
     C                     MOVEL*BLANKS   QMPTAI
     C                     MOVEL*BLANKS   QMPVAI
     C                     MOVEL*BLANKS   QMPTCY
     C                     Z-ADD0         QMPCDP
     C                     MOVEL*BLANKS   QMPTFT
     C                     MOVEL*BLANKS   QMDPO1
     C                     MOVEL*BLANKS   QMPPDG
     C                     MOVEL*BLANKS   QMPGM
     C                     MOVEL*BLANKS   QMATTN
     C                     MOVEL*BLANKS   QMPOLC
     C                     MOVEL*BLANKS   QMPPCS
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '1'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END
     C                     END                                            CPM005
      *                                                                   CPM005
      **  If option 'F' has been taken                                    CPM005
      *                                                                   CPM005
     C           WWACTN    IFEQ 'F'                                       CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA                                      CPM005
      *                                                                   CPM005
     C                     EXSR #W1002                                    CPM005
      *                                                                   CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *                                                                   CPM005
      **  Call PM0640 with parameters passed by LDA                       CPM005
      *                                                                   CPM005
     C                     CALL 'PM0640'                                  CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA with blanks in field                 CPM005
      **  set up in #W1002                                                CPM005
      *                                                                   CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
      *                                                                   CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *                                                                   CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  If option 'E' has been taken                                    CPM005
      *                                                                   CPM005
     C           WWACTN    IFEQ 'E'                                       CPM005
      *                                                                   CPM005
     C                     Z-ADDWWPMVT    QMPMVT                          CPM005
     C                     Z-ADDWWPMVV    QMPMVV                          CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA                                      CPM005
      *                                                                   CPM005
     C                     EXSR #W1002                                    CPM005
      *                                                                   CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *                                                                   CPM005
      **  Call PMC630 with parameters passed by LDA to call PM0671        CPM005
      *                                                                   CPM005
     C                     MOVEL'POSCCY  'WWJOB                           CPM005
      *                                                                   CPM005
     C                     CALL 'PMC5020'                                 CPM005
     C                     PARM           WWJOB                           CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA with blanks in field                 CPM005
      **  set up in #W1002                                                CPM005
      *                                                                   CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
      *                                                                   CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *                                                                   CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  If option 'N' has been taken                                    CPM005
      *                                                                   CPM005
     C           WWACTN    IFEQ 'N'                                       CPM005
     C           PMPOTT    CHAINPMNTCMLL             72                   CPM005
     C           *IN72     IFEQ '0'                                       CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA                                      CPM005
      *                                                                   CPM005
     C                     EXSR #W1002                                    CPM005
      *                                                                   CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *                                                                   CPM005
      **  Call PM6020 with parameters passed by LDA                       CPM005
      *                                                                   CPM005
     C                     CALL 'PM6020'                                  CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA with blanks in field                 CPM005
      **  set up in #W1002                                                CPM005
      *                                                                   CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
      *                                                                   CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *                                                                   CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '1'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      **  If option 'T' has been taken                                    CPM005
      *                                                                   CPM005
     C           WWACTN    IFEQ 'T'                                       CPM005
     C           WWPTFR    IFNE '9997'                                    CPM005
     C           WWPTFR    ANDNE'9998'                                    CPM005
     C           WWPTFR    ANDNE'9999'                                    CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA                                      CPM005
      *                                                                   CPM005
     C                     EXSR #W1002                                    CPM005
      *                                                                   CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *                                                                   CPM005
      **  Call PM0720 with parameters passed by LDA                       CPM005
      *                                                                   CPM005
     C                     CALL 'PM0720'                                  CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA with blanks in field                 CPM005
      **  set up in #W1002                                                CPM005
      *                                                                   CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
      *                                                                   CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *                                                                   CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '1'       *IN09                           CPM005
     C                     END                                            CPM005
     C                     END                                            CPM005
     C**
     C** IF OPTION 'D' HAS BEEN TAKEN
      **  allow only if record exists in PMASLIL0                         CPM005
     C**
     C           WWACTN    IFEQ 'D'
     C           PMPOTT    CHAINPMASLIL0             72                   CPM005
     C           *IN72     IFEQ '0'                                       CPM005
     C**
     C***CALL**PMC1000*TO*UPDATE*GDA**************************************S01486
     C** CALL  PMC1001 TO UPDATE LDA                                      S01486
     C**
     C                     EXSR #W1002
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C** CALL PMC5020
     C**
     C***********          MOVEL'N'       WWSCRL  1                       CPM005
     C                     MOVEL'TOTINS  'WWJOB   8                       CPM005
     C**
     C                     CALL 'PMC5020'
     C***********          PARM           WWSCRL                          CPM005
     C                     PARM           WWJOB                           CPM005
     C**
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD
     C** SET UP IN #W1002
     C                     MOVEL*BLANKS   QMPTF1
     C                     MOVEL*BLANKS   QMPTF2
     C                     MOVEL*BLANKS   QMPTFN
     C                     MOVEL*BLANKS   QMTPMV
     C                     MOVEL*BLANKS   QMVPMV
     C                     MOVEL*BLANKS   QMPTAI
     C                     MOVEL*BLANKS   QMPVAI
     C                     MOVEL*BLANKS   QMPTCY
     C                     Z-ADD0         QMPCDP
     C                     MOVEL*BLANKS   QMPTFT
     C                     MOVEL*BLANKS   QMDPO1
     C                     MOVEL*BLANKS   QMPPDG
     C                     MOVEL*BLANKS   QMPGM
     C                     MOVEL*BLANKS   QMATTN
     C                     MOVEL*BLANKS   QMPOLC
     C                     MOVEL*BLANKS   QMPPCS
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '1'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END
     C                     END                                            CPM005
     C**
     C** IF OPTION 'S' HAS BEEN TAKEN
     C**
     C           WWACTN    IFEQ 'S'
     C**
     C** CALL  PMC1001 TO UPDATE LDA
     C**
     C                     Z-ADDWWPMVT    QMPMVT
     C                     Z-ADDWWPMVV    QMPMVV
     C*
     C                     EXSR #W1002
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C** CALL PMC5020 WITH PARAMETERS PASSED BY LDA
     C**
     C***********          MOVEL'Y'       WWSCRL                          CPM005
     C                     MOVEL'POSINS  'WWJOB                           CPM005
     C**
     C                     CALL 'PMC5020'
     C***********          PARM           WWSCRL                          CPM005
     C                     PARM           WWJOB                           CPM005
     C**
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELD
     C** SET UP IN #W1002
     C**
     C                     MOVEL*BLANKS   QMPTF1
     C                     MOVEL*BLANKS   QMPTF2
     C                     MOVEL*BLANKS   QMPTFN
     C                     MOVEL*BLANKS   QMTPMV
     C                     MOVEL*BLANKS   QMVPMV
     C                     MOVEL*BLANKS   QMPTAI
     C                     MOVEL*BLANKS   QMPVAI
     C                     MOVEL*BLANKS   QMPTCY
     C                     Z-ADD0         QMPCDP
     C                     MOVEL*BLANKS   QMPTFT
     C                     MOVEL*BLANKS   QMDPO1
     C                     MOVEL*BLANKS   QMPPDG
     C                     MOVEL*BLANKS   QMPGM
     C                     MOVEL*BLANKS   QMATTN
     C                     MOVEL*BLANKS   QMPOLC
     C                     MOVEL*BLANKS   QMPPCS
     C**
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C**
     C                     END
      *                                                                   CPM005
      **  If option 'P' has been taken                                    CPM005
      *                                                                   CPM005
     C           WWACTN    IFEQ 'P'                                       CPM005
      *                                                                   CPM005
     C                     Z-ADDWWPMVT    QMPMVT                          CPM005
     C                     Z-ADDWWPMVV    QMPMVV                          CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA                                      CPM005
      *                                                                   CPM005
     C                     EXSR #W1002                                    CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
      *                                                                   CPM005
      **  Call PM0730 for investment policies details                     CPM005
      *                                                                   CPM005
     C                     MOVE 'PM0630'  WWCPGM  6                       CPM005
     C                     CALL 'PM0730'                                  CPM005
     C                     PARM           WWCPGM                          CPM005
      *                                                                   CPM005
      **  Call PMC1001 to update LDA with blanks in fields                CPM005
      **  set up in #W1002                                                CPM005
      *                                                                   CPM005
     C                     MOVEL*BLANKS   QMPTF1                          CPM005
     C                     MOVEL*BLANKS   QMPTF2                          CPM005
     C                     MOVEL*BLANKS   QMPTFN                          CPM005
     C                     MOVEL*BLANKS   QMTPMV                          CPM005
     C                     MOVEL*BLANKS   QMVPMV                          CPM005
     C                     MOVEL*BLANKS   QMPTAI                          CPM005
     C                     MOVEL*BLANKS   QMPVAI                          CPM005
     C                     MOVEL*BLANKS   QMPTCY                          CPM005
     C                     Z-ADD0         QMPCDP                          CPM005
     C                     MOVEL*BLANKS   QMPTFT                          CPM005
     C                     MOVEL*BLANKS   QMDPO1                          CPM005
     C                     MOVEL*BLANKS   QMPPDG                          CPM005
     C                     MOVEL*BLANKS   QMPGM                           CPM005
     C                     MOVEL*BLANKS   QMATTN                          CPM005
     C                     MOVEL*BLANKS   QMPOLC                          CPM005
     C                     MOVEL*BLANKS   QMPPCS                          CPM005
     C                     CALL 'PMC1001'                                 CPM005
     C                     PARM           WWLDA                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END                                            CPM005
     C**
     C***IF*OPTION*'I'*HAS*BEEN*TAKEN**********************************   CPM005
      **  If option 'C' has been taken                                    CPM005
      **  allow only if record exists in PMCIALL0                         CPM005
     C**
     C***********WWACTN    IFEQ 'I'                                       CPM005
     C           WWACTN    IFEQ 'C'                                       CPM005
     C           PMPOTT    CHAINPMCIALL0             72                   CPM005
     C           *IN72     IFEQ '0'                                       CPM005
     C**
     C                     Z-ADDWWPMVT    QMPMVT
     C                     Z-ADDWWPMVV    QMPMVV
     C**
     C** CALL  PMC1001 TO UPDATE LDA
     C                     EXSR #W1002
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C**
     C***CALL*PM0730*FOR*INVESTMENT*POLICIES*DETAILS*******************   CPM005
     C***********          MOVE 'PM5020'  WWCPGM  6                       CPM005
     C***********          CALL 'PM0730'                                  CPM005
     C***********          PARM           WWCPGM                          CPM005
     C                     MOVEL'TOTCCY  'WWJOB   8                       CPM005
      *                                                                   CPM005
     C                     CALL 'PMC5020'                                 CPM005
     C                     PARM           WWJOB                           CPM005
     C**
     C** CALL PMC1001 TO UPDATE LDA WITH BLANKS IN FIELDS
     C** SET UP IN #W1002
     C                     MOVEL*BLANKS   QMPTF1
     C                     MOVEL*BLANKS   QMPTF2
     C                     MOVEL*BLANKS   QMPTFN
     C                     MOVEL*BLANKS   QMTPMV
     C                     MOVEL*BLANKS   QMVPMV
     C                     MOVEL*BLANKS   QMPTAI
     C                     MOVEL*BLANKS   QMPVAI
     C                     MOVEL*BLANKS   QMPTCY
     C                     Z-ADD0         QMPCDP
     C                     MOVEL*BLANKS   QMPTFT
     C                     MOVEL*BLANKS   QMDPO1
     C                     MOVEL*BLANKS   QMPPDG
     C                     MOVEL*BLANKS   QMPGM
     C                     MOVEL*BLANKS   QMATTN
     C                     MOVEL*BLANKS   QMPOLC
     C                     MOVEL*BLANKS   QMPPCS
     C                     CALL 'PMC1001'
     C                     PARM           WWLDA
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '0'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE '0'       *IN01                           CPM005
     C                     MOVE '1'       *IN02                           CPM005
     C                     MOVE '0'       *IN07                           CPM005
     C                     MOVE '0'       *IN08                           CPM005
     C                     MOVE '0'       *IN09                           CPM005
     C                     END
     C                     END                                            CPM005
     C                     END                                            S01486
     C                     MOVEL'N'       VALIDA                          S01486
     C**
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1008   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCNUM   - CUSTOMER NUMBER                                       *
      * WWCUSR   - CUSTOMER NUMBER                                       *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      *                                                                  *
      ********************************************************************
     C           #P1002    BEGSR
     C**
     C** CLEAR SUBFILES
     C**
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN39
     C                     WRITEPM5020C1
     C                     MOVE '0'       *IN34
     C                     MOVE '0'       *IN38
     C                     MOVE '0'       *IN39
     C**
     C** LOAD RUN DATE
     C**
     C                     MOVELQMRUNA    DDRUNA
     C**
     C** LOAD CUSTOMER NUMBER FROM LDA
     C**
     C                     MOVE QMCNUM    WPCNU
     C                     MOVE QMPTF2    WPRPO
     C                     MOVE *LOVAL    WCUNU
     C                     MOVE *LOVAL    WREPO
     C**
     C**********           Z-ADDORPCNU    WWCUST                                              CSD027
     C                     MOVE ORPCNU    WWCUST                                              CSD027
     C                     MOVELORPPTF    WWPORE
     C**
     C***ACCESS*PF/PMPORTPP*WITH*CUSTOMER*NUMBER*AND*PORTFOLIO************S01486
     C** ACCESS PF/PMPORTPD WITH CUSTOMER NUMBER AND PORTFOLIO            S01486
     C** REFERENCE FROM PF/PMSBPMPD
     C**
     C***********PMPORT    CHAINPMPORTPP             75                   S01486
     C           PMPORT    CHAINPMPORTPD             75                   S01486
     C**
     C           *IN75     IFEQ '1'
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C***********          MOVE 'PMPORTPP'QMFILE                          S01486
     C                     MOVE 'PMPORTPD'QMFILE                          S01486
     C                     MOVE 'PM5020'  QMPGM
     C                     MOVE WWWORT    QMKEY            ***************
     C                     Z-ADD9         QMERRN           **DB ERROR 09**
     C                     EXSR *PSSR                      ***************
     C                     END
     C**
     C                     MOVE PNPTFN    W1PTFN 20
     C                     Z-ADDPNDPOP    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    W1DPO1  7
     C           PNPTFT    IFNE *BLANK
     C***********PNPTFT    CHAINPMPTFTPP             74                   S01486
     C           PNPTFT    CHAINPMPTFTPD             74                   S01486
     C           *IN74     IFEQ '0'
     C                     MOVELPEPTFT    W1PTFT  2
     C                     END
     C                     END
     C**
     C** LOAD SCREEN FIELDS
     C**
     C                     MOVELPNPTCY    WWPTCY
     C**
     C                     EXSR #P1009
     C**
     C** POSITION IN FILE PMSBPMPD
     C**
     C                     Z-ADD0         WWMBR   10
     C**
     C           PMPPTM    SETLLPMSBPMPD
     C**
     C                     READ PMSBPMPD                 79
     C**
     C** LOOP WHILE CUSTOMER NUMBER FOUND
     C**
     C           OSPCNU    DOWEQWPCNU
     C           OSPPTF    ANDEQWPRPO
     C           *IN79     ANDEQ'0'
     C**
     C           OSRECI    IFEQ 'D'
     C**
     C**********           Z-ADDOSCNUM    WWCUST                                              CSD027
     C                     MOVE OSCNUM    WWCUST                                              CSD027
     C                     MOVELOSPTFR    WWPORE
     C**
     C                     Z-ADD1         WWMBR
     C**
     C***ACCESS*PF/PMPORTPP*WITH*CUSTOMER*NUMBER*AND*PORTFOLIO************S01486
     C** ACCESS PF/PMPORTPD WITH CUSTOMER NUMBER AND PORTFOLIO            S01486
     C** REFERENCE FROM PF/PMSBPMPD
     C**
     C***********PMPORT    CHAINPMPORTPP             75                   S01486
     C           PMPORT    CHAINPMPORTPD             75                   S01486
     C**
     C           *IN75     IFEQ '1'
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C***********          MOVE 'PMPORTPP'QMFILE                          S01486
     C                     MOVE 'PMPORTPD'QMFILE                          S01486
     C                     MOVE 'PM5020'  QMPGM
     C                     MOVE WWWORT    QMKEY            ***************
     C                     Z-ADD10        QMERRN           **DB ERROR 10**
     C                     EXSR *PSSR                      ***************
     C                     END
     C**
     C** LOAD SCREEN FIELDS
     C**
     C                     MOVELOSCNUM    DDCUST
     C                     MOVELOSPTFR    DDPORT
     C                     MOVELPNPTCY    WWPTCY
     C**
     C                     EXSR #P1008
     C**
     C** RESET SCREEN FIELDS BEFORE FURTHER PROCESS
     C**
     C                     MOVEL*BLANKS   DDCUST
     C                     MOVEL*BLANKS   DDPORT
     C                     MOVEL*BLANKS   DDUNIT
     C**
     C                     END
     C**
     C                     READ PMSBPMPD                 79
     C**
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      *                                                                  *
      ********************************************************************
     C**
     C           #P1003    BEGSR
     C**
     C***RETRIEVE*DATA*AREA**GDA*TO*CHECK*IF*TERMINATION*INDICATOR*'ON'***S01486
     C** RETRIEVE DATA AREA *LDA TO CHECK IF TERMINATION INDICATOR 'ON'   S01486
     C**
     C***********          CALL 'PMC1004'                                 S01486
     C***********          PARM           WWGDA                           S01486
     C                     CALL 'PMC1003'                                 S01486
     C                     PARM           WWLDA                           S01486
     C**
     C***********QMENQT    IFNE 'P'                                       S01486
     C***********QMENQT    ANDNE' '                                       S01486
     C***********          CALL 'PMC1020'                                 S01486
     C***********          END                                            S01486
     C**
     C** DISPLAY PM5020F5
     C**
     C                     WRITEPM5020F5
     C**
     C** SEND SUBFILE
     C**
     C                     READ PM5020C1                 70
     C*                                                                   S01486
     C**  CLEAR PROGRAM MESSAGE QUEUE                                     S01486
     C*                                                                   S01486
     C                     CALL 'Y2CLMSC'                                 S01486
     C                     PARM           TOPQ   10                       S01486
     C                     PARM           TOPRQ   5                       S01486
     C**
     C           *IN70     IFEQ '0'
     C                     MOVELDDACTN    WWACTN
     C                     MOVEL*BLANK    DDACTN
     C                     MOVELDDPOCU    QMCNUM
     C                     MOVELDDPOFO    QMPTF1
     C                     MOVELDDPOFO    QMPTF2
     C                     MOVEL'Y'       QMPPCS
     C                     MOVE DDPTRD    QMTPMV
     C                     MOVE DDPVAL    QMVPMV
     C                     MOVE DDPTAI    QMPTAI
     C                     MOVE DDPVAI    QMPVAI
     C                     MOVE W1PTFN    QMPTFN
     C                     MOVE W1DPO1    QMDPO1
     C                     MOVE W1PTFT    QMPTFT
     C                     MOVE W1PPDG    QMPPDG
     C**
     C***********DDPOCU    CHAINSDPLCSL2             69                   S01486
     C                     MOVELDDPOCU    KEYCN                           S01486
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C           RTCD      IFEQ *BLANKS                                   S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM           KEYCN                           S01486
     C                     PARM           KEYST                           S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C                     END                                            S01486
     C************IN69     IFEQ '1'                                       S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C                     MOVE 'SDPLCSL2'QMFILE
     C                     MOVE 'PM5020'  QMPGM
     C                     MOVE WWWORT    QMKEY            ***************
     C                     Z-ADD11        QMERRN           **DB ERROR 11**
     C                     EXSR *PSSR                      ***************
     C                     END
     C**
     C** CUSTOMER REPORT NAME
     C**
     C                     MOVELBBCRNM    QMCRNM
     C                     MOVELBBCSSN    QMCSSN
     C                     MOVELBBCRTN    QMCRTN
     C*******************  Z-ADDQBDASS    ZDAYNO                         056986
     C*******************  EXSR ZDATE2                                   056986
     C*******************  MOVE ZADATE    QMDTA1                         056986
     C                     MOVELBBACOC    QMACOC
     C***********BBACOC    CHAINSDACOFL1             72                   S01486
     C                     CALL 'AOACOFR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM BBACOC    KEYAF                           S01486
     C           SDACOF    PARM SDACOF    DSFDY                           S01486
     C************IN72     IFEQ '0'                                       S01486
     C           RTCD      IFEQ *BLANKS                                   S01486
     C                     MOVELAZACON    QMACON
     C                     END
     C**
     C           RRN1      IFEQ *ZEROS
     C                     MOVE '1'       *IN39
     C                     END
     C                     WRITEPM5020F0                                  S01486
     C                     WRITEPM5020C1
     C                     MOVE '0'       *IN39
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1004   - PROCESS PORTFOLIO DETAILS                             *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZSEDIT  - TO EDIT A NUMBER WITH DECIMAL POINT                   *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1008   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTPMV   - TEMPORARY MARKET VALUE                                *
      *                                                                  *
      ********************************************************************
     C           #P1004    BEGSR
     C**
     C** COMPUTE TRADE DATE MARKET VALUE
     C**
     C           QCPTPA    SUB  QCPTNA    WWTPMV 150
     C           WWTPMV    SUB  QCPTMV    WWTPMV
     C**
     C** LOAD TRADE DATE MARKET VALUE IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDWWTPMV    ZFLD15
     C*********************Z-ADDQ8CDP     ZDECS                           41946
     C                     Z-ADDPNPCDP    ZDECS                           41946
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDTRDH
     C**
     C** COMPUTE VALUE DATE MARKET VALUE
     C**
     C           QCPVPA    SUB  QCPVNA    WWTPMV
     C           WWTPMV    SUB  QCPVMV    WWTPMV
     C**
     C** LOAD VALUE DATE MARKET VALUE IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDWWTPMV    ZFLD15
     C*********************Z-ADDQ8CDP     ZDECS                           41946
     C                     Z-ADDPNPCDP    ZDECS                           41946
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDVALH
     C**
     C** LOAD TRADE DATE ACCRUED INTEREST IN PORTFOLIO CURRENCY (FOR LDA)
     C**
     C                     Z-ADDQCPTAI    ZFLD15
     C*********************Z-ADDQ8CDP     ZDECS                           41946
     C                     Z-ADDPNPCDP    ZDECS                           41946
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDTAIH
     C**
     C** LOAD VALUE DATE ACCRUED INTEREST IN PORTFOLIO CURRENCY (FOR LDA)
     C**
     C*********************Z-ADDQCPVAI    ZFLD15
     C*********************Z-ADDQ8CDP     ZDECS                           41946
     C                     Z-ADDQCPTAI    ZFLD15                          CPM005
     C                     Z-ADDPNPCDP    ZDECS                           41946
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDVAIH
     C**
     C** DISPLAY TRADE OR VALUE DATE MARKET VALUE/ACCRUED INTEREST
     C**
     C***********P9TVPS    IFEQ 'T'                                       S01486
     C           FCTVPS    IFEQ 'T'                                       S01486
     C                     MOVE DDTRDH    DDMVAL
     C                     MOVE DDTAIH    DDACIN
     C                     ELSE
     C                     MOVE DDVALH    DDMVAL
     C                     MOVE DDVAIH    DDACIN
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1008   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1004   - PROCESS PORTFOLIO DETAILS                             *
      * #P1016   - SET UP INFORMATION FOR PLEDGE ETC..                   *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1008    BEGSR
     C**
     C** OBTAIN EDITION OF 'UNITS' ON PM502S1
     C**
     C                     Z-ADDOSNOUN    ZFLD15
     C                     Z-ADD0         ZDECS
     C                     MOVE *BLANKS   ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDUNIT
     C                     MOVE 'J'       ZECODE
     C**
     C** PERFORM ROUTINE TO SET UP PLEDGE ETC INFORMATION
     C**
     C                     EXSR #P1016
     C**
     C                     MOVELWWPPDG    W2PPDG  1
     C**
     C** SET TRADE AND VALUE DATE PORTFOLIO MARKET VALUE TO ZERO
     C**
     C                     Z-ADD0         QMPMVT 150
     C                     Z-ADD0         QMPMVV 150
     C**
     C                     MOVE OSCNUM    WWCUSR
     C                     MOVE OSPTFR    WWPTFR
     C**
     C***********PMPOTT    CHAINPMPOTTPP             77                   S01486
     C           PMPOTT    CHAINPMPOTTPD             77                   S01486
     C*                                                                   059478
     C** IF NOT FOUND CHECK FOR EXISTENCE OF MATURED POSITIONS ON PMMFHLPP059478
     C           *IN77     IFEQ '1'                                       059478
     C                     MOVE WWCUSR    WXCNUM                          059478
     C                     MOVE WWPTFR    WXPTFR                          059478
     C                     Z-ADD0         WXDSPS                          059478
     C                     MOVE *LOVAL    WXDSPG                          059478
     C                     Z-ADD0         WXITDS                          059478
     C                     MOVE *LOVAL    WXINNR                          059478
     C                     MOVE *LOVAL    WXCCY1                          059478
     C                     MOVE *LOVAL    WXTDSS                          059478
     C                     Z-ADD0         WXDLSQ                          059478
     C**********           Z-ADD0         WXTRNB                                       059478 CLE148
     C                     MOVEL*BLANKS   WXTRNB                                              CLE148
     C                     MOVE *LOVAL    WXTXT2                          059478
     C*                                                                   059478
     C***********MFHLK     SETLLPMMFHLPP                            059478S01486
     C***********MFHLK1    READEPMMFHLPP                 77         059478S01486
     C           MFHLK     SETLLPMMFHLPD                                  S01486
     C           MFHLK1    READEPMMFHLPD                 77               S01486
     C*                                                                   059478
     C                     Z-ADD0         QCPTPA                          059478
     C                     Z-ADD0         QCPTNA                          059478
     C                     Z-ADD0         QCPTMV                          059478
     C                     Z-ADD0         QCPVPA                          059478
     C                     Z-ADD0         QCPVNA                          059478
     C                     Z-ADD0         QCPVMV                          059478
     C                     Z-ADD0         QCPTAI                          059478
     C                     END                                            059478
     C**
     C** RECORD FOUND
     C**
     C           *IN77     IFEQ '0'
     C***********QCRECI    ANDEQ'D'                                  MFOX
     C**
     C** CONVERT AMOUNTS TO CUSTOMER BASE CURRENCY
     C**
     C                     EXSR #P1004
     C**
     C** CALCULATE TRADE DATE PORTFOLIO VALUE
     C**
     C           QCPTPA    SUB  QCPTNA    QMPMVT
     C                     SUB  QCPTMV    QMPMVT
     C                     ADD  QCPTAI    QMPMVT
     C                     Z-ADDQMPMVT    WWPMVT
     C**
     C** CALCULATE VALUE DATE PORTFOLIO VALUE
     C**
     C           QCPVPA    SUB  QCPVNA    QMPMVV
     C                     SUB  QCPVMV    QMPMVV
     C*********************ADD  QCPVAI    QMPMVV
     C                     Z-ADDQMPMVV    WWPMVV
     C**
     C** RECORD NOT FOUND
     C**
     C                     ELSE
     C**
     C                     MOVEL*BLANKS   DDMVAL
     C                     MOVEL*BLANKS   DDACIN
     C                     MOVE '1'       *IN36
     C**
     C                     END
     C**
     C** WRITE RECORD TO THE SUBFILE
     C**
     C                     ADD  1         RRN1
     C                     WRITEPM5020S1
     C                     MOVE '0'       *IN36
     C**
     C                     ENDSR
     C**
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1005   - PROCESS PORTFOLIO DETAILS                             *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZSEDIT  - TO EDIT A NUMBER WITH DECIMAL POINT                   *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1008   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWTPMV   - TEMPORARY MARKET VALUE                                *
      *                                                                  *
      ********************************************************************
     C           #P1005    BEGSR
     C**
     C** LOAD SPOT RATE FOR PORTFOLIO CURRENCY
     C**
     C                     MOVE WWPTCY    WWHCCY
     C**
     C***********PMHSEX    SETGTPMHSEXPP                                  S01486
     C***********          READPPMHSEXPP                 74               S01486
     C           PMHSEX    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 74               S01486
     C*
     C           *IN74     IFEQ '1'
     C           Q8CCY     ORNE WWPTCY
     C           Q8RECI    ORNE 'D'
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C***********          MOVE 'PMHSEXPP'QMFILE
     C                     MOVE 'PMHSEXPD'QMFILE                          S01486
     C                     MOVE 'PM5020'  QMPGM                           S01486
     C                     MOVELWWPTCY    QMKEY            ***************
     C                     Z-ADD12        QMERRN           **DB ERROR 12**
     C                     EXSR *PSSR                      ***************
     C                     END
     C**
     C** COMPUTE TRADE DATE MARKET VALUE
     C**
     C           QCPTPA    SUB  QCPTNA    WWTPMV 150
     C           WWTPMV    SUB  QCPTMV    WWTPMV
     C**
     C** LOAD TRADE DATE MARKET VALUE IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDWWTPMV    ZFLD15
     C                     Z-ADDQ8CDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDPTRD 16
     C**
     C** COMPUTE VALUE DATE MARKET VALUE
     C**
     C           QCPVPA    SUB  QCPVNA    WWTPMV
     C           WWTPMV    SUB  QCPVMV    WWTPMV
     C**
     C** LOAD VALUE DATE MARKET VALUE IN PORTFOLIO CURRENCY
     C**
     C                     Z-ADDWWTPMV    ZFLD15
     C                     Z-ADDQ8CDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDPVAL 16
     C**
     C** LOAD TRADE DATE ACCRUED INTEREST IN PORTFOLIO CURRENCY (FOR LDA)
     C**
     C                     Z-ADDQCPTAI    ZFLD15
     C                     Z-ADDQ8CDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDPTAI 16
     C**
     C** LOAD VALUE DATE ACCRUED INTEREST IN PORTFOLIO CURRENCY (FOR LDA)
     C**
     C*********************Z-ADDQCPVAI    ZFLD15
     C                     Z-ADDQ8CDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDPVAI 16
     C**
     C** DISPLAY TRADE OR VALUE DATE MARKET VALUE/ACCRUED INTEREST
     C**
     C***********P9TVPS    IFEQ 'T'                                       S01486
     C           FCTVPS    IFEQ 'T'                                       S01486
     C                     MOVE DDPTRD    DDPMVA
     C                     MOVE DDPTAI    DDPACI
     C                     ELSE
     C                     MOVE DDPVAL    DDPMVA
     C                     MOVE DDPVAI    DDPACI
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1009   - PROCESS PREPARE DETAILS FOR OUTPUT TO SUBFILE         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * #P1005   - PROCESS PORTFOLIO DETAILS                             *
      * #P1016   - SET UP INFORMATION FOR PLEDGE ETC..                   *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1002   - PROCESS SCREEN SET UP                                 *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1009    BEGSR
     C**
     C** OBTAIN EDITION OF 'UNITS' ON PM502C1
     C**
     C                     Z-ADDORNOUN    ZFLD15
     C                     Z-ADD0         ZDECS
     C                     MOVE *BLANKS   ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDPUNI
     C                     MOVE 'J'       ZECODE
     C**
     C** PERFORM ROUTINE TO SET UP PLEDGE ETC INFORMATION
     C**
     C                     EXSR #P1016
     C**
     C                     MOVELWWPPDG    W1PPDG  1
     C**
     C** SET TRADE AND VALUE DATE PORTFOLIO MARKET VALUE TO ZERO
     C**
     C                     Z-ADD0         QMPMVT 150
     C                     Z-ADD0         QMPMVV 150
     C**
     C                     MOVE QMCNUM    WWCUSR
     C                     MOVE QMPTF2    WWPTFR
     C**
     C***********PMPOTT    CHAINPMPOTTPP             77                   S01486
     C           PMPOTT    CHAINPMPOTTPD             77                   S01486
     C**
     C** RECORD FOUND
     C**
     C           *IN77     IFEQ '0'
     C***********QCRECI    ANDEQ'D'                                  MFOX
     C**
     C** CONVERT AMOUNTS TO CUSTOMER BASE CURRENCY
     C**
     C                     EXSR #P1005
     C**
     C** CALCULATE TRADE DATE PORTFOLIO VALUE
     C**
     C           QCPTPA    SUB  QCPTNA    QMPMVT
     C                     SUB  QCPTMV    QMPMVT
     C                     ADD  QCPTAI    QMPMVT
     C                     Z-ADDQMPMVT    WWPMVT
     C**
     C** CALCULATE VALUE DATE PORTFOLIO VALUE
     C**
     C           QCPVPA    SUB  QCPVNA    QMPMVV
     C                     SUB  QCPVMV    QMPMVV
     C*********************ADD  QCPVAI    QMPMVV
     C                     Z-ADDQMPMVV    WWPMVV
     C**
     C** RECORD NOT FOUND
     C**
     C                     ELSE
     C**
     C                     MOVEL*BLANKS   DDPMVA
     C                     MOVEL*BLANKS   DDPACI
     C                     MOVE '1'       *IN34
     C**
     C                     END
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #P1015   - FILL HEADER DETAILS AND SEND SUBFILE                  *
      *                                                                  *
      * SUBROUTINE CALLS: #U1001                                         *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #P1015    BEGSR
     C**
     C                     EXSR #U1001
     C**
     C                     WRITEPM5020F1
     C**
     C           RRN1      IFEQ *ZEROS
     C                     MOVE '1'       *IN39
     C                     END
     C**
     C                     WRITEPM5020F0                                  S01486
     C                     WRITEPM5020C1
     C                     MOVE '0'       *IN39
     C**
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #U1001   - DISPLAY CUSTOMER DETAILS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1003   - PROCESS TO WRITE SCREEN                               *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #U1001    BEGSR
     C**
     C** LOAD FIELDS OF HEADER FORMAT
     C**
     C                     MOVELQMCNUM    DDPOCU
     C                     MOVELQMPTF2    DDPOFO
     C                     MOVE OROPCP    DDOPCL
     C                     MOVELPNPTCY    DDPBCY
     C**
     C                     Z-ADDORINUS    ZFLD15
     C                     Z-ADDPNPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DDIUVA
     C**
     C                     Z-ADDORPSTD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDSTDA
     C**
     C                     Z-ADDORPMTD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DDINDA
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #W1002   - UPDATE DATA AREA                                      *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZDATE2   - TO CONVERT A MIDAS DATE NUMBER IN ALPHA               *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #P1001   - MAINTAIN CUSTOMER SELECTION SCREEN                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWCUSR   - CUSTOMER NUMBER                                       *
      * WWPTFR   - PORTFOLIO REFERENCE                                   *
      * WWTRDT   - TRADE DATE                                            *
      * WWVLDT   - VALUE DATE                                            *
      *                                                                  *
      ********************************************************************
     C           #W1002    BEGSR
     C**
     C**   SET 'PORTFOLIO' CURRENCY,DEC.PLACES & DATE OPENED FOR NON-PORTFOLIOS
     C**
     C                     MOVELQMBYDP    PNPCDP
     C                     Z-ADD*ZERO     PNDPOP
     C**
     C**  TRADE VALUE/DATE POSITION
     C**
     C***********          MOVELP9TVPS    QMTVPS                          S01486
     C                     MOVELFCTVPS    QMTVPS                          S01486
     C**
     C** PORTFOLIO CURRENCY
     C**
     C                     MOVELPNPTCY    QMPTCY
     C**
     C** PORTFOLIO CURRENCY DECIMAL PLACES
     C**
     C***********QMPTCY    CHAINSDCURRL1             76                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   RTCD                            S01486
     C                     PARM '*KEY'    OPTN                            S01486
     C                     PARM QMPTCY    KEYCY   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**
     C************IN76     IFEQ '1'                        B3             S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C                     MOVE 'SDCURRL1'QMFILE
     C                     MOVE 'PM5020'  QMPGM
     C                     MOVE QMPTCY    QMKEY            ***************
     C                     Z-ADD13        QMERRN           **DB ERROR 13**
     C                     EXSR *PSSR                      ***************
     C*
     C                     END
     C**
     C                     MOVE A6NBDP    QMPCDP
     C**
     C** ENQUIRIES TERMINATING
     C**
     C                     MOVEL*BLANKS   QMENQT
     C**
     C** DATA BASE ERROR
     C**
     C                     MOVEL'PM5020'  QMPGM
     C**
     C** ATTENTION KEY ALLOWED
     C**
     C           WWACTN    IFEQ 'S'
     C                     MOVEL'Y'       QMATTN
     C                     ELSE
     C                     MOVEL'N'       QMATTN
     C                     END
     C**
     C** BANK INVTESTMENT POLICY CODE
     C**
     C                     MOVE DDPOLH    QMPOLC
     C**
     C                     ENDSR
     C**************************************************************************
     C***/EJECT**                                                         S01486
     C********************************************************************S01486
     C***********                                                         S01486
     C*****ZDATE2*SR.*TO*CONVERT*A*DAY*NUMBER*TO*DATE*FORMATS.************S01486
     C***********                                                         S01486
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********S01486
     C***********                                                         S01486
     C***********ZDATE2    BEGSR                           *** ZDATE2 *** S01486
     C***********                                                         S01486
     C*****CLEAR*LEAP*YEAR*WORK*FIELD.************************************S01486
     C***********          MOVE 'N'       ZLEAP   1                       S01486
     C***********                                                         S01486
     C*****CLEAR*DATE*FIELDS.*********************************************S01486
     C***********          Z-ADD0         ZDATE   60                      S01486
     C***********          MOVEL'       ' ZADATE  7                       S01486
     C***********                                                         S01486
     C*****CALCULATION*TO*DEFINE*INPUT*DAY*NUMBER.************************S01486
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01486
     C***********                                                         S01486
     C*****DETERMINE*YEAR*NUMBER.*****************************************S01486
     C***********                                                         S01486
     C*****ADJUST*DAY*NUMBER*IN*CASE*LAST*DAY*OF*YEAR.********************S01486
     C***********ZDAYNO    SUB  1         ZDAYN1  50                      S01486
     C***********ZDAYN1    IFLT 0                                         S01486
     C***********          GOTO ZDEND2                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CALCULATE*NUMBER*OF*4*YEAR*SPANS*SINCE*31/12/1971.*************S01486
     C***********ZDAYN1    DIV  1461      ZLYR    20                      S01486
     C***********          MVR            ZDAYN1           SAVE REMAINING S01486
     C***********                                          DAYS           S01486
     C*****CALCULATE*NUMBER*OF*REMAINING*YEARS.***************************S01486
     C***********          Z-ADD1         ZWRK2   20                      S01486
     C***********ZDTAG1    TAG                             ** ZDTAG1 TAG *S01486
     C***********ZDAYN1    IFGE ZYDY,ZWRK2                                S01486
     C***********ZWRK2     ADD  1         ZWRK2                           S01486
     C***********          GOTO ZDTAG1                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********ZWRK2     SUB  1         ZWRK2                           S01486
     C***********                                                         S01486
     C*****DECREMENT*DAY*NO.*BY*DAYS*IN*REMAINING*YEARS.******************S01486
     C***********ZWRK2     IFNE 0                                         S01486
     C***********ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CALCULATE*ACTUAL*YEAR*NUMBER.**********************************S01486
     C***********ZLYR      MULT 4         ZWRK3   30                      S01486
     C***********ZWRK3     ADD  72        ZWRK3            BASE IS 1972   S01486
     C***********          Z-ADDZWRK3     ZYEAR   20                      S01486
     C***********ZYEAR     ADD  ZWRK2     ZYEAR            YEAR           S01486
     C***********                                                         S01486
     C*****DETERMINE*MONTH*NUMBER.****************************************S01486
     C***********                                                         S01486
     C*****ADJUST*DAY*NO.*IN*CASE*LAST*DAY*OF*LEAP*YEAR*FEBRUARY.*********S01486
     C***********ZWRK2     IFEQ 0                                         S01486
     C***********ZDAYN1    IFEQ 59                                        S01486
     C***********          MOVE 'Y'       ZLEAP                           S01486
     C***********          END                                            S01486
     C***********ZDAYN1    IFGE 59                                        S01486
     C***********ZDAYN1    SUB  1         ZDAYN1                          S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CALCULATE*MONTH*NUMBER.****************************************S01486
     C***********          Z-ADD2         ZWRK2                           S01486
     C***********ZDTAG2    TAG                             ** ZDTAG2 TAG *S01486
     C***********ZDAYN1    IFGE ZMDY,ZWRK2                                S01486
     C***********ZWRK2     ADD  1         ZWRK2                           S01486
     C***********          GOTO ZDTAG2                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********ZWRK2     SUB  1         ZWRK2                           S01486
     C***********                                                         S01486
     C***********          Z-ADDZWRK2     ZMTH    20       MONTH          S01486
     C***********                                                         S01486
     C*****DETERMINE*DAY*OF*MONTH.****************************************S01486
     C***********                                                         S01486
     C*****ADD*BACK*LAST*DAY*OF*YEAR*ADJUSTMENT.**************************S01486
     C***********ZDAYN1    ADD  1         ZDAYN1                          S01486
     C***********                                                         S01486
     C*****CALCULATE*DAY*OF*MONTH.****************************************S01486
     C***********ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY            S01486
     C***********                                                         S01486
     C*****ADD*BACK*LEAP*YEAR*29TH*FEBUARY*ADJUSTMENT,*IF*REQUIRED.*******S01486
     C***********ZLEAP     IFEQ 'Y'                                       S01486
     C***********ZDAY      ADD  1         ZDAY                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****FORMAT*DATE,*DDMMYY*OR*MMDDYY.*********************************S01486
     C**N98******          MOVELZDAY      ZWRK4   40                      S01486
     C***98******          MOVE ZDAY      ZWRK4                           S01486
     C**N98******          MOVE ZMTH      ZWRK4                           S01486
     C***98******          MOVELZMTH      ZWRK4                           S01486
     C***********          MOVELZWRK4     ZDATE                           S01486
     C***********          MOVE ZYEAR     ZDATE                           S01486
     C***********                                                         S01486
     C*****FORMAT*ALPHA*DATE,*DDMMMYY.************************************S01486
     C***********          MOVELZDAY      ZWRK5   5                       S01486
     C***********ZDAY      IFLT 10                                        S01486
     C***********          MOVEL' '       ZWRK5                           S01486
     C***********          END                                            S01486
     C***********          MOVE ZMNM,ZMTH ZWRK5                           S01486
     C***********          MOVELZWRK5     ZADATE                          S01486
     C***********          MOVE ZYEAR     ZADATE                          S01486
     C***********                                                         S01486
     C***********ZDEND2    ENDSR                           * ZDEND2 ENDSR*S01486
     C***********                                                         S01486
     C***********                                                         S01486
     C********************************************************************S01486
     C***/EJECT**                                                         S01486
     C********************************************************************S01486
     C***********                                                        *S01486
     C***ZSEDIT*subroutine*to*insert*a*decimal*point*and*sign*into*a***  *S01486
     C***numeric*field*and*to*blank*out*leading*zeros*(optionaly*******  *S01486
     C***inserting*commas).********************************************  *S01486
     C*******Input*fields:***ZFLD15*15/0*******************************  *S01486
     C***********************ZDECS**1/0********************************  *S01486
     C***********************ZECODE*1/**('J',*'L'*or*blank)************  *S01486
     C***********                                                        *S01486
     C*******Arrays:*********ZS1****15/1/0********************************S01486
     C***********************ZS2****21/1/*********************************S01486
     C***********                                                        *S01486
     C*******Output*fields:**ZOUT21*21************************************S01486
     C***********                                                        *S01486
     C********************************************************************S01486
     C***********                                                        *S01486
     C***********ZSEDIT    BEGSR                           **  ZSEDIT   * S01486
     C***********                                                         S01486
     C**Define/Clear*fields***********************************************S01486
     C***********                                                         S01486
     C***********          Z-ADDZFLD15    ZFLD15 150                      S01486
     C***********          Z-ADDZDECS     ZDECS   10                      S01486
     C***********          MOVE ZECODE    ZECODE  1                       S01486
     C***********          MOVE *BLANKS   ZOUT21 21                       S01486
     C***********                                                         S01486
     C********SET*UP*WORK*FIELDS******************************************S01486
     C***********                                                         S01486
     C***********          Z-ADD0         ZS1                             S01486
     C***********          MOVE ' '       ZS2                             S01486
     C***********                                                         S01486
     C***********          Z-ADD15        Z1      20                      S01486
     C***********          Z-ADD20        Z2      20                      S01486
     C***********                                                         S01486
     C***********15        SUB  ZDECS     ZINTS   20                      S01486
     C***********                                                         S01486
     C**Check*if*numeric*field*is*negative********************************S01486
     C***********                                                         S01486
     C***********ZFLD15    IFLT *ZEROS                                    S01486
     C***********          MOVE '-'       ZS2,21                          S01486
     C***********          Z-SUBZFLD15    ZFLD15                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          Z-ADDZFLD15    WORK15                          S01486
     C***********                                                         S01486
     C********CHECK*TO*SEE*IF*THERE*ARE*ANY*DECIMAL*PLACES****************S01486
     C***********                                                         S01486
     C***********ZDECS     CABEQ0         ZS10                            S01486
     C***********                                                         S01486
     C********SET*UP*DECIMALS*********************************************S01486
     C***********                                                         S01486
     C***********          Z-ADD*ZEROS    ZCNT    10                      S01486
     C***********ZCNT      DOUEQZDECS                                     S01486
     C***********          MOVE ZS1,Z1    ZS2,Z2                          S01486
     C***********          SUB  1         Z2                              S01486
     C***********          ADD  1         ZCNT                            S01486
     C***********          SUB  1         Z1                              S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C********PUT*IN*DECIMAL*PLACE****************************************S01486
     C***********                                                         S01486
     C***********          MOVE '.'       ZS2,Z2                          S01486
     C***********          SUB  1         Z2                              S01486
     C***********                                                         S01486
     C***********ZS10      TAG                             ** ZS10 TAG ** S01486
     C***********                                                         S01486
     C********SET*UP*INTEGERS*********************************************S01486
     C***********                                                         S01486
     C***********          Z-ADD*ZEROS    CNT3    10                      S01486
     C***********Z1        DOUEQ*ZEROS                                    S01486
     C***********          MOVE ZS1,Z1    ZS2,Z2                          S01486
     C***********          SUB  1         Z1                              S01486
     C***********          SUB  1         Z2                              S01486
     C***********                                                         S01486
     C**If*edit*code*is*'J',*insert*a*','*before*each*group*of*three******S01486
     C**digits*-*not*if*beginning*of*array*reached.***********************S01486
     C***********                                                         S01486
     C***********Z2        IFGT *ZEROS                                    S01486
     C***********ZECODE    ANDEQ'J'                                       S01486
     C***********          ADD  1         CNT3                            S01486
     C***********CNT3      IFEQ 3                                         S01486
     C***********          MOVE ','       ZS2,Z2                          S01486
     C***********          SUB  1         Z2                              S01486
     C***********          Z-ADD*ZEROS    CNT3                            S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C********PUT*IN*LEADING*BLANKS***************************************S01486
     C***********                                                         S01486
     C***********          Z-ADD1         Z2                              S01486
     C***********ZS2,Z2    DOWEQ'0'                                       S01486
     C***********ZS2,Z2    OREQ ' '                                       S01486
     C***********ZS2,Z2    OREQ ','                                       S01486
     C***********          MOVE ' '       ZS2,Z2                          S01486
     C***********          ADD  1         Z2                              S01486
     C***********Z2        CABEQ22        ZS20                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C********IF*NO*INTEGERS*PUT*IN*LEADING*ZERO**************************S01486
     C***********                                                         S01486
     C***********ZS20      TAG                             ** ZS20 TAG ** S01486
     C***********                                                         S01486
     C***********Z2        IFEQ 22                                        S01486
     C***********          SUB  2         Z2                              S01486
     C***********          MOVE '0'       ZS2,Z2                          S01486
     C***********          ELSE                                           S01486
     C***********                                                         S01486
     C***********ZS2,Z2    IFEQ '.'                                       S01486
     C***********          SUB  1         Z2                              S01486
     C***********          MOVE '0'       ZS2,Z2                          S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C********SET*UP*OUTPUT*FIELD*****************************************S01486
     C***********                                                         S01486
     C***********          MOVEAZS2       ZOUT21                          S01486
     C***********                                                         S01486
     C***********          ENDSR                                          S01486
     C***********                                                         S01486
     C********************************************************************S01486
     C/EJECT                                                              S01486
     C*****************************************************************   S01486
     C*                                                               *   S01486
     C* ZASNMS   - Send message to program message queue              *   S01486
     C*                                                               *   S01486
     C* CALLS    Y2SNMSGC                                             *   S01486
     C*                                                               *   S01486
     C* CALLED BY  #P1001 - Validate customer selection screen.       *   S01486
     C*                                                               *   S01486
     C*****************************************************************   S01486
     C           ZASNMS    BEGSR                                          S01486
     C*                                                                   S01486
     C                     CALL 'Y2SNMGC'                                 S01486
     C                     PARM           ZAPGM            Program queue  S01486
     C                     PARM           ZAPGRL           Rel queue      S01486
     C                     PARM           ZAMSID           Message Id.    S01486
     C                     PARM           ZAMSGF           Message file.  S01486
     C                     PARM           ZAMSDA           Message data.  S01486
     C                     PARM           ZAMSTP           Message type.  S01486
     C*                                                                   S01486
     C** Clear all fields for default mechanism next time.                S01486
     C                     MOVEL*BLANK    ZAPGM            Message queue  S01486
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      S01486
     C                     MOVEL*BLANK    ZAMSDA           Message data.  S01486
     C                     MOVEL*BLANK    ZAMSTP           Message type.  S01486
     C*                                                                   S01486
     C           ZASNM9    ENDSR                           ZASNM9 TAG     S01486
     C*****************************************************************   S01486
     C/EJECT                                                              S01486
     C*****************************************************************   S01486
     C*                                                               *   S01486
     C* #Z1001   - Send message to program message queue              *   S01486
     C*                                                               *   S01486
     C* CALLS    ZVACTBU, ZVACTU                                      *   S01486
     C*                                                               *   S01486
     C* CALLED BY  #P1001 - Validate customer selection screen.       *   S01486
     C*                                                               *   S01486
     C*****************************************************************   S01486
     C           #Z1001    BEGSR                                          S01486
     C*                                                                   S01486
     C** VALIDATE USER, ACTION CODE AND BRANCH                            S01486
     C*                                                                   S01486
     C                     MOVELWWACTN    ZACTN                           S01486
     C                     SETOF                     40                   S01486
     C           MBIN      IFEQ 'Y'                                       S01486
     C                     MOVELBBBRCD    ZBR                             S01486
     C*                                                                   S01486
     C                     CALL 'ZVACTBU'                                 S01486
     C***********          PARM           ZACTN   1                S01486 CPM005
     C                     PARM 'E'       ZACTN   1                       CPM005
     C                     PARM           ZBR     3                       S01486
     C                     PARM *ZEROS    ERR     10                      S01486
     C*                                                                   S01486
     C           ERR       IFNE *ZEROS                                    S01486
     C           ERR       IFEQ 1                                         S01486
     C                     MOVEL'PM51115' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     SETON                     40                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C           ERR       IFEQ 2                                         S01486
     C                     MOVEL'PM51116' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     SETON                     40                   S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C                     CALL 'ZVACTU'                                  S01486
     C***********          PARM           ZACTN   1                S01486 CPM005
     C                     PARM 'E'       ZACTN   1                       CPM005
     C                     PARM *ZEROS    ERR     10                      S01486
     C*                                                                   S01486
     C           ERR       IFEQ 1                                         S01486
     C                     MOVEL'PM51117' ZAMSID                          S01486
     C                     EXSR ZASNMS                                    S01486
     C                     SETON                     40                   S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** IF ACTION CODE IS NOT VALID, DO NOT BLANK IT OUT                 S01486
     C*                                                                   S01486
     C           *IN40     IFEQ '1'                                       S01486
     C                     MOVELWWACTN    DDACTN                          S01486
     C                     END                                            S01486
     C                     MOVEL'Y'       VALIDA  1                       S01486
     C*                                                                   S01486
     C                     ENDSR                                          S01486
     C*****************************************************************   S01486
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - TO PROCESS DATA BASE ERRORS                           *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      **PMC1000**-*TO*UPDATE*DATA*AREA************************************S01486
      **PMC1020**-*TO*STOP*GROUP*JOB**************************************S01486
      * PMC1001  - TO UPDATE DATA AREA                                   *S01486
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      **WWPARM***-**GDA*PARAMETER*****************************************S01486
      * WWPARM   - *LDA PARAMETER                                        *S01486
      * WWEND    - END PARAMETER                                         *
      * WWGRPJ   - GROUP JOB PARAMETER                                   *
      *                                                                  *
     C********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'Y'       QMENQT
     C**
     C***UPDATE**GDA******************************************************S01486
     C** UPDATE *LDA                                                      S01486
     C**
     C***********          CALL 'PMC1002'                                 S01486
     C***********          PARM           WWGDA                           S01486
     C                     CALL 'PMC1001'                                 S01486
     C                     PARM           WWLDA                           S01486
     C**
     C                     DUMP
     C**
     C***********          CALL 'PMC1020'                                 S01486
     C                     CALL 'DBERRCTL'                                S01486
     C**
     C                     ENDSR
     C**
      ********************************************************************
      /EJECT
     C*******************************************************************
     C**
     C** SUBROUTINE TO SET UP DETAIL OF PLEDGE STATUS, MANAGED
     C** INDICATOR AND INVESTMENT POLICY INDICATOR
     C**
     C*******************************************************************
     C           #P1016    BEGSR
     C**
     C** PLEDGED (Y/N)
     C**
     C**  IF RUN DATE LESS THAN OR EQUAL TO PLEDGE START DATE
     C**
     C                     MOVE *BLANK    WWPDG1
     C                     MOVE *BLANK    WWPDG3
     C                     MOVE 'N'       WWPDG5
     C**
     C           PNPDGS    IFEQ 0
     C           QMRDNB    ORGT PNPDGF
     C**
     C                     MOVE 'N'       WWPDG1
     C**
     C                     ELSE
     C**
     C           QMRDNB    IFGE PNPDGS
     C           QMRDNB    ANDLEPNPDGF
     C                     MOVE 'Y'       WWPDG1
     C                     END
     C**
     C                     END
     C**
     C** MANAGED INDICATOR
     C**
     C                     MOVE PNMNGI    WWPDG3
     C**
     C** INVESTMENT POLICY
     C**
     C           PNPOLC    IFNE *BLANK
     C           PNIPIN    OREQ 'Y'
     C           PNCYIN    OREQ 'Y'
     C           PNYPIN    OREQ 'Y'
     C           PNNPIN    OREQ 'Y'
     C                     MOVE 'Y'       WWPDG5
     C                     END
     C**
     C** INDICATOR FOR EXCEPTION TO INVESTMENT POLICY
     C**
     C           PNXPTN    IFEQ *BLANK
     C                     MOVE 'N'       WWPDG7
     C                     ELSE
     C                     MOVE PNXPTN    WWPDG7
     C                     END
     C**
     C                     MOVE PNPOLC    DDPOLH
     C**
     C                     ENDSR
     C**
      ********************************************************************
     C/COPY ZSRSRC,ZDATE2Z2                                               S01486
     C/COPY ZSRSRC,ZSEDITZ3                                               S01486
      /EJECT
      ********************************************************************
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Finastra International Limited 2001
