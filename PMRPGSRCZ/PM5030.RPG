     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Pool portfolio details report')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management                             *
     F*                                                               *
     F*  PM5030 - POOL PORTFOLIO DETAILS REPORT                       *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 172595             Date 08Jun00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 S01486             Date 31AUG94               *
     F*                 059464             DATE 02AUG93               *
     F*                 058159             DATE 01JUL93               *
     F*                 S01313             DATE 19MAY92               *
     F*                 35611 ADIF         DATE 19FEB91               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
     F*  172595 - Prevent I/O error when no member portfolios exist   *
     F*           in a pool portfolio.                                *
     F*  S01486 - Private Banking upgrade to Release 10               *
     F*  059464 - IF NO DETAILS TO REPORT OUTPUT REPORT HEADER        *
     F*  058159 - FOR UNIT SIZE AND NUMBER OF UNITS EQUAL TO 0 OUTPUT *
     F*           BLANKS ON REPORT                                    *
     F*  S01313 - RECOMPILED FOR PORTFOLIO PERFORMANCE                *
     F*  35611  - FOOB EACH TIME                                      *
     F*  WRITTEN FOR SAR 91/08 - POOL SECURITIES TRANSACTIONS         *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     FPM5030AUO   E                    PRINTER
     F                                              KINFDS SPOOLU         S01486
     F****PREFIX*OF*PMPPTDZZ*IS*'OR'**************************************S01486
     F***PMPPTDZZIF  E           K        DISK                            S01486
     F**  PREFIX OF PMPPTDPA IS 'OR'                                      S01486
     FPMPPTDPAIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F****PREFIX*OF*SDBANKL1*IS*'BJ'**************************************S01486
     F***SDBANKL1IF**E           K        DISK                            S01486
     F***********                                   KINFSR *PSSR          S01486
     F**  PREFIX OF PMPPTDPD IS 'OR'
     FPMPPTDPDIF  E           K        DISK
     F                                              KINFSR *PSSR
     F**  PREFIX OF PMPPTMPD IS 'OS'
     FPMPPTMPDIF  E           K        DISK
     F                                              KINFSR *PSSR
     F***PMPORTPPIF**E           K        DISK                            S01486
     FPMPORTPDIF  E           K        DISK                               S01486
     F                                              KINFSR *PSSR
     F*
     F***PM5030P1O***E             70     PRINTER                         S01486
     FPM5030P1O   E             70     PRINTER      KINFDS SPOOL      UC  S01486
     E*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      21: INDICATOR FOR INSERT
     F**      22: INDICATOR FOR AMEND
     F**      23: INDICATOR FOR DELETE
     F**      69: INDICATOR FOR FIRST PAGE ON PM5030P1
     F**      70: INDICATOR FOR OVERFLOW ON PM5030P1
     F**      71: INDICATOR FOR READ
     F**      72: INDICATOR FOR PRINT DETAILS
     F**      73: INDICATOR FOR MODE '1'
     F**      74: INDICATOR FOR MODE '2'
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * ..   ..   ..   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   ..   .. *
     F**      * ..   ..   ..   ..   75   76   77   78   79   80 *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     E*****************************************************************
     E*
     E***********         ZS1        15  1 0             ZSEDITZ1 / ZSRSRCS01486
     E***********         ZS2        21  1               ZSEDITZ1 / ZSRSRCS01486
     E***********         ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYS01486
     E***********         ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYS01486
     E***********         ZMNM   12  12  3               ZDATE2 SR. ARRAY S01486
     E/COPY ZSRSRC,ZSEDITZ1                                               S01486
     E/COPY ZSRSRC,ZDATE2Z1                                               S01486
     E*
     E                    CPY@    1   1 80
      /COPY ZSRSRC,ZEDITZ1                                                058159
     I*************************************************************************
     I** COPY ZSRSRC,ZSEDITZ2
     I*********** DS                                                      S01486
     I***********                             1  150WORK15                S01486
     I***********                             1  150ZS1                   S01486
     I/COPY ZSRSRC,ZSEDITZ2                                               S01486
     I*
     I*  Data structure to strip last character from ZSEDIT output
     I            DS
     I                                        1  21 ZOUT21
     I                                        1  20 ZOUT20
     I*****************************************************************
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***LDA********UDS                            256                    S01486
     ILDA         DS                            256                       S01486
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     ISDBANK    E DSSDBANKPD                                              S01486
     I** DUMMY RECORD FORMAT FOR BANK DETAILS                             S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01486
     I*                                                                   S01486
     ISPOOL       DS                                                      S01486
     I**    SPOOL FILE INFORMATION DATA STRUCTURE                         S01486
     I                                       83  92 SFILE                 S01486
     I                                    B 123 1240SFNUM                 S01486
     I*                                                                   S01486
     ISPOOLU      DS                                                      S01486
     I**    SPOOL FILE INFORMATION DATA STRUCTURE                         S01486
     I                                       83  92 SFILEU                S01486
     I                                    B 123 1240SFNUMU                S01486
     I********************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* INDEX OF SUBROUTINES                                             *
     C* P1001    - GENERAL PROCESSING                                    *
     C* P1002    - INITIAL PROCESSING                                    *
     C* P1003    - AUDIT REPORT PROCESSING                               *
     C* P1004    - FULL LIST PROCESSING                                  *
     C* P1005    - AUDIT PROCESSING                                      *
     C* W1001    - PRINT POOL PORTOFOLIO DETAILS                         *
     C* W1002    - PRINT AUDIT REPORT                                    *
     C* *PSSR    - ERROR SUBROUTINE                                      *
     C*                                                                  *
     C* EXTERNAL ROUTINES CALLED                                         *
     C*                                                                  *
     C********************************************************************
      /EJECT
     C*****************************************************************
     C** KEY DEFINITION
     C*****************************************************************
     C*
     C           KPPDR     KLIST
     C                     KFLD           ORPCNU
     C                     KFLD           ORPPTF
     C*
     C********************************************************************
      /EJECT
     C*****************************************************************
     C** P1001  -  GENERAL PROCESSING
     C*****************************************************************
     C*
     C           *ENTRY    PLIST
     C                     PARM           WWMODE  1
     C*
     C* Set code for ZSEDIT
     C                     MOVEL'L'       ZECODE
     C*
     C*
     C* P1002    - INITIAL PROCESSING
     C                     EXSR P1002
     C*
     C           WWMODE    IFEQ '1'                        B1
     C*
     C* P1003    - AUDIT REPORT PROCESSING
     C                     EXSR P1003
     C*
     C                     ELSE                            X1
     C*
     C* P1004    - FULL LIST PROCESSING
     C                     EXSR P1004
     C*
     C                     END                             E1
     C*
     C* P1005    - AUDIT PROCESSING
     C                     EXSR P1005
     C*
     C                     SETON                     LR
     C**************************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* P1003  -  AUDIT REPORT PROCESSING                                *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           P1003     BEGSR
     C*
     C** ACCESS POOL PORTOFOLIO DETAILS FROM PF/PMPPTDPD
     C*
     C                     READ PMPPTDPD                 71
     C*
     C* IF NO DETAILS TO REPORT, WRITE HEADER + "NO DETAILS TO REPORT"
     C*
     C           *IN71     IFEQ '1'                        B1
     C           WWMODE    IFEQ '1'                        B*2
     C                     MOVE '1'       *IN73
     C                     END                             E*2
     C***********          WRITEPM5030F1                                  S01486
     C                     WRITEPM5030F0                                  S01486
     C                     WRITENODET
     C                     MOVE '0'       *IN73
     C                     GOTO EP1003
     C                     END                             E1
     C*
     C           *IN71     DOWEQ'0'                        B1
     C*
     C           ORLCD     IFEQ BJRDNB                     B*2
     C                     Z-ADDORLCD     WNLCD   50                      059464
     C*
     C           ORCHTP    IFEQ 'I'                        B**3
     C                     ADD  1         WWINSE  50
     C                     MOVE '1'       *IN21
     C                     END                             E**3
     C*
     C           ORCHTP    IFEQ 'A'                        B**3
     C                     ADD  1         WWAMEN  50
     C                     MOVE '1'       *IN22
     C                     END                             E**3
     C*
     C           ORCHTP    IFEQ 'D'                        B**3
     C                     ADD  1         WWDELE  50
     C                     MOVE '1'       *IN23
     C                     END                             E**3
     C*
     C                     MOVE '1'       *IN72
     C*
     C** ACCESS POOL PORTOFOLIO MEMBERS FROM PF/PMPPTMPD
     C*
     C           KPPDR     SETLLPMPPTMPD
     C*
     C                     READ PMPPTMPD                 71
     C*
     C           *IN71     DOWEQ'0'                        B**3
     C           OSPCNU    ANDEQORPCNU
     C           OSPPTF    ANDEQORPPTF
     C*
     C                     EXSR W1001
     C*
     C                     MOVE '0'       *IN72
     C                     MOVE '0'       *IN21
     C                     MOVE '0'       *IN22
     C                     MOVE '0'       *IN23
     C*
     C                     READ PMPPTMPD                 71
     C*
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C                     READ PMPPTDPD                 71
     C*
     C* IF CHANGE OF CUSTOMER OR PORTOFOLIO REFERENCE, WRITE A
     C* BLANK LINE
     C*
     C           *IN71     IFEQ '0'                        B*2
     C           WNLCD     ANDEQBJRDNB                                    059464
     C                     WRITEBLANC
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** IF NO DETAILS HAVE BEEN REPORTED WRITE HEADER INFORMATION        059464
     C           WWINSE    IFEQ 0                                         059464
     C           WWAMEN    ANDEQ0                                         059464
     C           WWDELE    ANDEQ0                                         059464
     C***********          WRITEPM5030F1                            059464S01486
     C                     WRITEPM5030F0                                  S01486
     C                     WRITENODET                                     059464
     C***********          END                                      059464S01486
     C                     ELSE                                           S01486
     C*                                                                   059464
     C                     WRITEENDP
     C                     END                                            S01486
     C*
     C           EP1003    ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* P1004  -  FULL LIST PROCESSING                                   *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           P1004     BEGSR
     C*
     C** ACCESS POOL PORTOFOLIO DETAILS FROM PF/PMPPTDPD
     C*
     C                     READ PMPPTDPD                 71
     C*
     C* IF NO DETAILS TO REPORT, WRITE HEADER + "NO DETAILS TO REPORT"
     C*
     C           *IN71     IFEQ '1'                        B1
     C           WWMODE    IFEQ '2'                        B*2
     C                     MOVE '1'       *IN74
     C                     END                             E*2
     C***********          WRITEPM5030F1                                  S01486
     C                     WRITEPM5030F0                                  S01486
     C                     WRITENODET
     C                     MOVE '0'       *IN74
     C                     GOTO EP1004
     C                     END                             E1
     C*
     C           *IN71     DOWEQ'0'                        B1
     C*
     C           ORRECI    IFEQ 'D'                        B*2
     C                     ADD  1         WWLIVE  50
     C                     END                             E*2
     C*
     C                     MOVE '1'       *IN72
     C*
     C           ORCHTP    IFEQ 'I'                        B*2
     C                     MOVE '1'       *IN21
     C                     END                             E*2
     C*
     C           ORCHTP    IFEQ 'A'                        B*2
     C                     MOVE '1'       *IN22
     C                     END                             E*2
     C*
     C           ORCHTP    IFEQ 'D'                        B*2
     C                     MOVE '1'       *IN23
     C                     END                             E*2
     C*
     C** ACCESS POOL PORTOFOLIO MEMBERS FROM PF/PMPPTMPD
     C*
     C           KPPDR     SETLLPMPPTMPD
     C*
     C                     READ PMPPTMPD                 71
     C*
     C           *IN71     DOWEQ'0'                        B*2
     C           OSPCNU    ANDEQORPCNU
     C           OSPPTF    ANDEQORPPTF
     C*
     C* Set on indicator to show member portfolio has been found.         172595
     C*                                                                   172595
     C                     MOVE *ON       *IN75                           172595
     C*                                                                   172595
     C                     EXSR W1001
     C*
     C                     MOVE '0'       *IN72
     C                     MOVE '0'       *IN21
     C                     MOVE '0'       *IN22
     C                     MOVE '0'       *IN23
     C*
     C                     READ PMPPTMPD                 71
     C*
     C                     END                             E*2
     C*
     C*  If no member found for pool, output record to say  this.         172595
     C*                                                                   172595
     C           *IN75     IFEQ *OFF                                      172595
     C                     EXSR NOMEM                                     172595
     C                     ENDIF                                          172595
     C*                                                                   172595
     C                     READ PMPPTDPD                 71
     C*
     C* IF CHANGE OF CUSTOMER OR PORTOFOLIO REFERENCE, WRITE A
     C* BLANK LINE
     C*
     C           *IN71     IFEQ '0'                        B*2
     C                     WRITEBLANC
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C                     WRITEENDP
     C*
     C           EP1004    ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* P1005  -  AUDIT PROCESSING                                       *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C* *PSSR    - ERROR SUBROUTINE                                      *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           P1005     BEGSR
     C*
     C***ACCESS*PF/PMPPTDZZ***********************************************S01486
     C** ACCESS PF/PMPPTDPA                                               S01486
     C*
     C***********          READ PMPPTDZZ                 71               S01486
     C                     READ PMPPTDPA                 71               S01486
     C*
     C           *IN71     IFEQ '1'                        B1
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD2         DBASE            **DB ERROR 02**
     C***********          MOVEL'PMPPTDZZ'DBFILE           ***************S01486
     C                     MOVEL'PMPPTDPA'DBFILE           ***************S01486
     C                     MOVEL*BLANKS   DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E1
     C*
     C           WWMODE    IFEQ '2'                        B1
     C***********WWLIVE    ANDEQORNORE                                    35611
     C           WWLIVE    ANDNEORNORE                                    35611
     C                     MOVE '1'       *INU8
     C                     END                             E1
     C*
     C* W1002    - PRINT AUDIT REPORT
     C*
     C                     EXSR W1002
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* W1001  -  PRINT POOL PORTOFOLIO DETAILS                          *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           W1001     BEGSR
     C*
     C           WWMODE    IFEQ '1'                        B1
     C                     MOVE '1'       *IN73
     C                     ELSE                            X1
     C                     MOVE '1'       *IN74
     C                     END                             E1
     C*
     C* PRINT HEADER IF FIRST PAGE OR OVERFLOW
     C*
     C           *IN69     IFEQ '0'                        B1
     C                     OPEN PM5030P1                                  S01486
     C*                                                                   S01486
     C** Report printer file to RCF via ZSFILE                            S01486
     C*                                                                   S01486
     C                     Z-ADDSFNUM     ZSNUM   60                      S01486
     C                     CALL 'ZSFILE'                                  S01486
     C                     PARM           SEQ     5                       S01486
     C                     PARM           @ENT    3                       S01486
     C                     PARM           SFILE                           S01486
     C                     PARM           ZSNUM                           S01486
     C                     PARM *BLANKS   ZSERR   1                       S01486
     C*                                                                   S01486
     C** Error during ZSFILE processing, return to calling program        S01486
     C*                                                                   S01486
     C           ZSERR     IFEQ 'Y'                                       S01486
     C                     SETON                     U7U8LR               S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C                     WRITEPM5030F1
     C                     MOVE '1'       *IN69
     C                     END                             E1
     C*
     C           *IN70     IFEQ '1'                        B1
     C                     WRITEPM5030F1                    1
     C                     MOVE '0'       *IN70             1
     C                     END                             E1
     C*
     C* MOVE DETAILS TO FIELDS OF DSPF PM5030P1
     C*
     C**********           Z-ADDORPCNU    RRPCNU                                              CSD027
     C                     MOVE ORPCNU    RRPCNU                                              CSD027
     C                     MOVELORPPTF    RRPPTF
     C                     MOVELOROPCP    RROPCP
     C           ORRANG    IFNE *ZEROS
     C                     MOVE ORRANG    RRRANG
     C                     ELSE
     C                     MOVE *BLANKS   RRRANG
     C                     END
     C**********           Z-ADDOSCNUM    RRCNUM                                              CSD027
     C                     MOVE OSCNUM    RRCNUM                                              CSD027
     C                     MOVELOSPTFR    RRPTFR
     C                     Z-ADDORDLUP    RRDLUP
     C                     MOVELORMLUP    RRMLUP
     C                     Z-ADDORYLUP    RRYLUP
     C                     Z-ADDORDLUP    XXDLUP
     C                     MOVELORMLUP    XXMLUP
     C                     Z-ADDORYLUP    XXYLUP
     C                     Z-ADDORTLUP    RRTLUP
     C*
     C                     Z-ADDORPMTD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    RRLCD
     C*
     C                     Z-ADDORPSTD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    RRPSTD
     C*
     C** EDIT UNIT SIZE FOR OUTPUT
     C***********KPPDR     CHAINPMPORTPP             01                   S01486
     C           KPPDR     CHAINPMPORTPD             01                   S01486
     C*
     C           *IN01     IFEQ '1'                        B1
     C           PNRECI    OREQ '*'
     C                     Z-ADD3         DBASE            ***************
     C***********          MOVEL'PMPORTPP'DBFILE           * DB ERROR 03 *S01486
     C                     MOVEL'PMPORTPD'DBFILE           * DB ERROR 03 *S01486
     C                     MOVELORPCNU    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             E1
     C*
     C           ORINUS    IFEQ 0                                         058159
     C                     MOVE *BLANKS   RRINUS                          058159
     C                     ELSE                                           058159
     C                     Z-ADDORINUS    ZFLD15
     C                     Z-ADDPNPCDP    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRINUS
     C                     END                                            058159
     C*
     C           OSNOUN    IFEQ 0                                         058159
     C                     MOVE *BLANKS   RRNOUN                          058159
     C                     ELSE                                           058159
     C                     MOVE OSNOUN    ZFIELD                          058159
     C                     Z-ADD5         ZADIG                           058159
     C                     Z-ADD0         ZADEC                           058159
     C                     EXSR ZEDIT                                     058159
     C                     MOVE ZFIELD    RRNOUN                          058159
     C                     END                                            058159
     C*
     C* WRITE DETAILS
     C*
     C                     WRITEPM5030F2
     C*
     C                     MOVE '0'       *IN73
     C                     MOVE '0'       *IN74
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* W1002  -  PRINT AUDIT REPORT                                     *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           W1002     BEGSR
     C*
     C           WWMODE    IFEQ '1'                        B1
     C                     MOVE '1'       *IN73
     C                     ELSE                            X1
     C                     MOVE '1'       *IN74
     C                     END                             E1
     C*
     C                     Z-ADDORNORE    WWNORE  50
     C*
     C* WRITE AUDIT REPORT
     C*
     C                     WRITEPM5030F0                                  S01486
     C                     WRITEPM5030PP
     C*
     C                     MOVE '0'       *IN73
     C                     MOVE '0'       *IN74
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* *PSSR    - ERROR SUBROUTINE                                      *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           *PSSR     BEGSR
     C*
     C           WWERRO    IFEQ ' '                        B1
     C                     MOVE 'Y'       WWERRO  1
     C*
     C           DBASE     IFNE 0                          B*2
     C*
     C**  PRINT ERROR MESSAGE:
     C***********          WRITEERRORAU                                   S01486
     C                     ELSE                            X*2
     C                     Z-ADD999       DBASE
     C                     END                             E*2
     C                     WRITEPM5030F0                                  S01486
     C                     WRITEERRORAU                                   S01486
     C*
     C                     DUMP
     C                     END                             E1
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
     C***/EJECT******                                                     S01486
     C********************************************************************S01486
     C***********                                                         S01486
     C*****ZDATE2*SR.*TO*CONVERT*A*DAY*NUMBER*TO*DATE*FORMATS.************S01486
     C***********                                                         S01486
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********S01486
     C***********                                                         S01486
     C***********ZDATE2    BEGSR                           *** ZDATE2 *** S01486
     C***********                                                         S01486
     C*****CLEAR*LEAP*YEAR*WORK*FIELD.************************************S01486
     C***********          MOVE 'N'       ZLEAP   1                       S01486
     C***********                                                         S01486
     C*****CLEAR*DATE*FIELDS.*********************************************S01486
     C***********          Z-ADD0         ZDATE   60                      S01486
     C***********          MOVEL'       ' ZADATE  7                       S01486
     C***********                                                         S01486
     C*****CALCULATION*TO*DEFINE*INPUT*DAY*NUMBER.************************S01486
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01486
     C***********                                                         S01486
     C*****DETERMINE*YEAR*NUMBER.*****************************************S01486
     C***********                                                         S01486
     C*****ADJUST*DAY*NUMBER*IN*CASE*LAST*DAY*OF*YEAR.********************S01486
     C***********ZDAYNO    SUB  1         ZDAYN1  50                      S01486
     C***********ZDAYN1    IFLT 0                                         S01486
     C***********          GOTO ZDEND2                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CALCULATE*NUMBER*OF*4*YEAR*SPANS*SINCE*31/12/1971.*************S01486
     C***********ZDAYN1    DIV  1461      ZLYR    20                      S01486
     C***********          MVR            ZDAYN1           SAVE REMAINING S01486
     C***********                                          DAYS           S01486
     C*****CALCULATE*NUMBER*OF*REMAINING*YEARS.***************************S01486
     C***********          Z-ADD1         ZWRK2   20                      S01486
     C***********ZDTAG1    TAG                             ** ZDTAG1 TAG *S01486
     C***********ZDAYN1    IFGE ZYDY,ZWRK2                                S01486
     C***********ZWRK2     ADD  1         ZWRK2                           S01486
     C***********          GOTO ZDTAG1                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********ZWRK2     SUB  1         ZWRK2                           S01486
     C***********                                                         S01486
     C*****DECREMENT*DAY*NO.*BY*DAYS*IN*REMAINING*YEARS.******************S01486
     C***********ZWRK2     IFNE 0                                         S01486
     C***********ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CALCULATE*ACTUAL*YEAR*NUMBER.**********************************S01486
     C***********ZLYR      MULT 4         ZWRK3   30                      S01486
     C***********ZWRK3     ADD  72        ZWRK3            BASE IS 1972   S01486
     C***********          Z-ADDZWRK3     ZYEAR   20                      S01486
     C***********ZYEAR     ADD  ZWRK2     ZYEAR            YEAR           S01486
     C***********                                                         S01486
     C*****DETERMINE*MONTH*NUMBER.****************************************S01486
     C***********                                                         S01486
     C*****ADJUST*DAY*NO.*IN*CASE*LAST*DAY*OF*LEAP*YEAR*FEBRUARY.*********S01486
     C***********ZWRK2     IFEQ 0                                         S01486
     C***********ZDAYN1    IFEQ 59                                        S01486
     C***********          MOVE 'Y'       ZLEAP                           S01486
     C***********          END                                            S01486
     C***********ZDAYN1    IFGE 59                                        S01486
     C***********ZDAYN1    SUB  1         ZDAYN1                          S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****CALCULATE*MONTH*NUMBER.****************************************S01486
     C***********          Z-ADD2         ZWRK2                           S01486
     C***********ZDTAG2    TAG                             ** ZDTAG2 TAG *S01486
     C***********ZDAYN1    IFGE ZMDY,ZWRK2                                S01486
     C***********ZWRK2     ADD  1         ZWRK2                           S01486
     C***********          GOTO ZDTAG2                                    S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********ZWRK2     SUB  1         ZWRK2                           S01486
     C***********                                                         S01486
     C***********          Z-ADDZWRK2     ZMTH    20       MONTH          S01486
     C***********                                                         S01486
     C*****DETERMINE*DAY*OF*MONTH.****************************************S01486
     C***********                                                         S01486
     C*****ADD*BACK*LAST*DAY*OF*YEAR*ADJUSTMENT.**************************S01486
     C***********ZDAYN1    ADD  1         ZDAYN1                          S01486
     C***********                                                         S01486
     C*****CALCULATE*DAY*OF*MONTH.****************************************S01486
     C***********ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY            S01486
     C***********                                                         S01486
     C*****ADD*BACK*LEAP*YEAR*29TH*FEBUARY*ADJUSTMENT,*IF*REQUIRED.*******S01486
     C***********ZLEAP     IFEQ 'Y'                                       S01486
     C***********ZDAY      ADD  1         ZDAY                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C*****FORMAT*DATE,*DDMMYY*OR*MMDDYY.*********************************S01486
     C**N98******          MOVELZDAY      ZWRK4   40                      S01486
     C***98******          MOVE ZDAY      ZWRK4                           S01486
     C**N98******          MOVE ZMTH      ZWRK4                           S01486
     C***98******          MOVELZMTH      ZWRK4                           S01486
     C***********          MOVELZWRK4     ZDATE                           S01486
     C***********          MOVE ZYEAR     ZDATE                           S01486
     C***********                                                         S01486
     C*****FORMAT*ALPHA*DATE,*DDMMMYY.************************************S01486
     C***********          MOVELZDAY      ZWRK5   5                       S01486
     C***********ZDAY      IFLT 10                                        S01486
     C***********          MOVEL' '       ZWRK5                           S01486
     C***********          END                                            S01486
     C***********          MOVE ZMNM,ZMTH ZWRK5                           S01486
     C***********          MOVELZWRK5     ZADATE                          S01486
     C***********          MOVE ZYEAR     ZADATE                          S01486
     C***********                                                         S01486
     C***********ZDEND2    ENDSR                           * ZDEND2 ENDSR*S01486
     C***********                                                         S01486
     C***********                                                         S01486
     C********************************************************************S01486
      /EJECT
     C********************************************************************
     C*                                                                  *
     C* P1002  -  INITIAL PROCESSING                                     *
     C*                                                                  *
     C* SUBROUTINE CALLS:                                                *
     C* *PSSR    - ERROR SUBROUTINE                                      *
     C*                                                                  *
     C* SUBROUTINE CALLED FROM:                                          *
     C* MAIN     - MAIN PROCESSING                                       *
     C*                                                                  *
     C* ROUTINE USES VARIABLES:                                          *
     C*                                                                  *
     C********************************************************************
     C           P1002     BEGSR                           ** INIT  BSR **
     C*                                                                   S01486
     C** Report printer file to RCF via ZSFILE                            S01486
     C*                                                                   S01486
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01486
     C                     CALL 'ZSFILE'                                  S01486
     C                     PARM           SEQ                             S01486
     C                     PARM           @ENT                            S01486
     C                     PARM           SFILEU                          S01486
     C                     PARM           ZSNUMU                          S01486
     C                     PARM *BLANKS   ZSERR                           S01486
     C*                                                                   S01486
     C** Error during ZSFILE processing, return to calling program        S01486
     C*                                                                   S01486
     C           ZSERR     IFEQ 'Y'                                       S01486
     C                     SETON                     U7U8LR               S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*
     C** PREPARE LDA
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM5030'  DBPGM
     C                     OUT  LDA                                       S01486
     C*
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1***************************S01486
     C** ACCESS BANK ICD DETAILS                                          S01486
     C***********          READ SDBANKL1                 71               S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM '*MSG  '  RTCD    7                       S01486
     C                     PARM '*FIRST'  OPTN    7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C** ERROR
     C************IN71     IFEQ '1'                        B1             S01486
     C           RTCD      IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD1         DBASE            **DB ERROR 01**
     C                     MOVEL'SDBANKL1'DBFILE           ***************
     C                     MOVEL*BLANKS   DBKEY
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR
     C                     END                             E1
     C*
     C           BJDFIN    IFEQ 'M'                        B1
     C                     MOVE '1'       *IN98
     C                     END                             E1
     C*
     C* RESET COUNTERS TO ZERO
     C                     Z-ADD0         WWINSE
     C                     Z-ADD0         WWAMEN
     C                     Z-ADD0         WWDELE
     C                     Z-ADD0         WWLIVE
     C*
     C                     ENDSR
     C*
     C********************************************************************172595
     C*                                                                  *172595
     C* NOMEM  -  No members exist in this pool                          *172595
     C*                                                                  *172595
     C* SUBROUTINE CALLS:                                                *172595
     C* W1001    - Output details to printer file.                       *172595
     C*                                                                  *172595
     C* SUBROUTINE CALLED FROM:                                          *172595
     C* P1004    - Main list details                                     *172595
     C*                                                                  *172595
     C*                                                                  *172595
     C********************************************************************172595
     C           NOMEM     BEGSR                                          172595
      *                                                                   172595
      * Setup field details for no member present in this pool.           172595
      *                                                                   172595
     C**********           Z-ADD0         OSCNUM                                       172595 CSD027
     C                     MOVE *BLANKS   OSCNUM                                              CSD027
     C                     MOVE 'NONE'    OSPTFR                          172595
     C                     Z-ADD0         OSNOUN                          172595
      *                                                                   172595
      * Reset indicator for no member found.                              172595
      *                                                                   172595
     C                     MOVE *OFF      *IN75                           172595
      *                                                                   172595
      * Output the blank record for no member found.                      172595
      *                                                                   172595
     C                     EXSR W1001                                     172595
      *                                                                   172595
     C                     ENDSR                                          172595
      *                                                                   172595
     C********************************************************************S01486
     C***********                                                        *S01486
     C***ZSEDIT*subroutine*to*insert*a*decimal*point*and*sign*into*a******S01486
     C***numeric*field*and*to*blank*out*leading*zeros*(optionaly**********S01486
     C***inserting*commas).***********************************************S01486
     C*******Input*fields:***ZFLD15*15/0**********************************S01486
     C***********************ZDECS**1/0***********************************S01486
     C***********************ZECODE*1/**('J',*'L'*or*blank)***************S01486
     C***********                                                        *S01486
     C*******Arrays:*********ZS1****15/1/0********************************S01486
     C***********************ZS2****21/1/*********************************S01486
     C***********                                                        *S01486
     C*******Output*fields:**ZOUT21*21************************************S01486
     C***********                                                        *S01486
     C***********ZSEDIT    BEGSR                           **  ZSEDIT   * S01486
     C***********                                                         S01486
     C**Define/Clear*fields***********************************************S01486
     C***********                                                         S01486
     C***********          Z-ADDZFLD15    ZFLD15 150                      S01486
     C***********          Z-ADDZDECS     ZDECS   10                      S01486
     C***********          MOVE ZECODE    ZECODE  1                       S01486
     C***********          MOVE *BLANKS   ZOUT21 21                       S01486
     C***********                                                         S01486
     C********SET*UP*WORK*FIELDS******************************************S01486
     C***********                                                         S01486
     C***********          Z-ADD0         ZS1                             S01486
     C***********          MOVE ' '       ZS2                             S01486
     C***********                                                         S01486
     C***********          Z-ADD15        Z1      20                      S01486
     C***********          Z-ADD20        Z2      20                      S01486
     C***********                                                         S01486
     C***********15        SUB  ZDECS     ZINTS   20                      S01486
     C***********                                                         S01486
     C**Check*if*numeric*field*is*negative********************************S01486
     C***********                                                         S01486
     C***********ZFLD15    IFLT *ZEROS                                    S01486
     C***********          MOVE '-'       ZS2,21                          S01486
     C***********          Z-SUBZFLD15    ZFLD15                          S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          Z-ADDZFLD15    WORK15                          S01486
     C***********                                                         S01486
     C********CHECK*TO*SEE*IF*THERE*ARE*ANY*DECIMAL*PLACES****************S01486
     C***********                                                         S01486
     C***********ZDECS     CABEQ0         ZS10                            S01486
     C***********                                                         S01486
     C********SET*UP*DECIMALS*********************************************S01486
     C***********                                                         S01486
     C***********          Z-ADD*ZEROS    ZCNT    10                      S01486
     C***********ZCNT      DOUEQZDECS                                     S01486
     C***********          MOVE ZS1,Z1    ZS2,Z2                          S01486
     C***********          SUB  1         Z2                              S01486
     C***********          ADD  1         ZCNT                            S01486
     C***********          SUB  1         Z1                              S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C********PUT*IN*DECIMAL*PLACE****************************************S01486
     C***********                                                         S01486
     C***********          MOVE '.'       ZS2,Z2                          S01486
     C***********          SUB  1         Z2                              S01486
     C***********                                                         S01486
     C***********ZS10      TAG                             ** ZS10 TAG ** S01486
     C***********                                                         S01486
     C********SET*UP*INTEGERS*********************************************S01486
     C***********                                                         S01486
     C***********          Z-ADD*ZEROS    CNT3    10                      S01486
     C***********Z1        DOUEQ*ZEROS                                    S01486
     C***********          MOVE ZS1,Z1    ZS2,Z2                          S01486
     C***********          SUB  1         Z1                              S01486
     C***********          SUB  1         Z2                              S01486
     C***********                                                         S01486
     C**If*edit*code*is*'J',*insert*a*','*before*each*group*of*three******S01486
     C**digits*-*not*if*beginning*of*array*reached.***********************S01486
     C***********                                                         S01486
     C***********Z2        IFGT *ZEROS                                    S01486
     C***********ZECODE    ANDEQ'J'                                       S01486
     C***********          ADD  1         CNT3                            S01486
     C***********CNT3      IFEQ 3                                         S01486
     C***********          MOVE ','       ZS2,Z2                          S01486
     C***********          SUB  1         Z2                              S01486
     C***********          Z-ADD*ZEROS    CNT3                            S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C********PUT*IN*LEADING*BLANKS***************************************S01486
     C***********                                                         S01486
     C***********          Z-ADD1         Z2                              S01486
     C***********ZS2,Z2    DOWEQ'0'                                       S01486
     C***********ZS2,Z2    OREQ ' '                                       S01486
     C***********ZS2,Z2    OREQ ','                                       S01486
     C***********          MOVE ' '       ZS2,Z2                          S01486
     C***********          ADD  1         Z2                              S01486
     C***********Z2        CABEQ22        ZS20                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C********IF*NO*INTEGERS*PUT*IN*LEADING*ZERO**************************S01486
     C***********                                                         S01486
     C***********ZS20      TAG                             ** ZS20 TAG ** S01486
     C***********                                                         S01486
     C***********Z2        IFEQ 22                                        S01486
     C***********          SUB  2         Z2                              S01486
     C***********          MOVE '0'       ZS2,Z2                          S01486
     C***********          ELSE                                           S01486
     C***********                                                         S01486
     C***********ZS2,Z2    IFEQ '.'                                       S01486
     C***********          SUB  1         Z2                              S01486
     C***********          MOVE '0'       ZS2,Z2                          S01486
     C***********          END                                            S01486
     C***********          END                                            S01486
     C***********                                                         S01486
     C********SET*UP*OUTPUT*FIELD*****************************************S01486
     C***********                                                         S01486
     C***********          MOVEAZS2       ZOUT21                          S01486
     C***********                                                         S01486
     C***********          ENDSR                                          S01486
     C*****************************************************************   S01486
     C/COPY ZSRSRC,ZDATE2Z2                                               S01486
     C/COPY ZSRSRC,ZSEDITZ3                                               S01486
      /COPY ZSRSRC,ZEDITZ2                                                058159
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Finastra International Limited 2001
