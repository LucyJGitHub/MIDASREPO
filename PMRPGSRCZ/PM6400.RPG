     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas PM Setup system with work transactions')         *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Management Module                          *
     F*                                                               *
     F*  PM6400 - SETUP SYSTEM WITH WORK TRANSACTIONS FILE            *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CDL096             Date 22Sep14               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CSW212             Date 03May12               *
      *                 CRE073             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER048             Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 11Jul06               *
      *                 CLE042             Date 06Sep05               *
      *                 CDL038             Date 10May05               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG3644            Date 12Jul04               *
      *                 CGL014             Date 20Oct03               *
      *                 CAP074             Date 08Aug02               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAS002             Date 14Jan02               *
      *                 190347             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 Patch E ---------------------------------------*
      *                 170520             Date 19Nov99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAP003             Date 18Aug98               *
      *                 CPM005             Date 19JUN96               *
      *                 S01124             Date 16JUN94               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CSW212 - SWIFT 2012 Changes (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CGL014 - Collaterals Processing (Recompile)                  *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *           (Recompile)                                         *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  CAS002 - Hedge Strategy/Linkage (Recompile)                  *
      *  190347 - Check if record already exists in PMBPLGPD before   *
      *           the write operation to avoid duplicate key.         *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  170520 - Recompile over changed TRANSD file                  *
      *  CDL006 - Dealing Fiduciary (Recompile)                       *
      *  CAP003 - Conversion of Midas inputs to modular API structure *
      *           (phase 2) - recompiled                              *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*  S01124  -  PBFG/1 - CHANGE CUSTOMER/PORTFOLIO BASE CURRENCY  *
     F*                                                               *
     F*****************************************************************
     FPMPCBCL1IF  E           K        DISK         KINFSR *PSSR
     F***FIDPLNP2IF  E           K        DISK         KINFSR *PSSR       CPM005
     F***********                                   KINFDS FDS1           CPM005
     F***PFIDPLN2O   E                    DISK         KINFSR *PSSR       CPM005
     F*********** FIDEPOD0                          KRENAMEPFIDEPO0       CPM005
     F*********** FILOAND0                          KRENAMEPFILOAN0       CPM005
     F***TRANSP2*IF**E           K        DISK         KINFSR *PSSR       CPM005
     FPMTRANL0IF  E           K        DISK         KINFSR *PSSR          CPM005
     F                                              KINFDS FDS2
     F***PTRANS**O***E                    DISK         KINFSR *PSSR       CPM005
     FPMBTRNL0O   E                    DISK         KINFSR *PSSR          CPM005
     F            TRANSDF                           KRENAMETRANSDF1
     F***DEALSP2*IF**E           K        DISK         KINFSR *PSSR       CPM005
     FPMDEALL2IF  E           K        DISK         KINFSR *PSSR          CPM005
     F                                              KINFDS FDS3
     F***PDEALSP2O***E                    DISK         KINFSR *PSSR       CPM005
     FPMBDELL2O   E                    DISK         KINFSR *PSSR          CPM005
     F            DEALSDBF                          KRENAMEDEALSDB1
     F            DEALSDCF                          KRENAMEDEALSDC1
     F***CLOANP2*IF**E           K        DISK         KINFSR *PSSR       CPM005
     F***PCLOANP2O***E                    DISK         KINFSR *PSSR       CPM005
     FPMCLONL2IF  E           K        DISK         KINFSR *PSSR          CPM005
     FPMBCLNL2O   E                    DISK         KINFSR *PSSR          CPM005
     F            CLOANCLF                          KRENAMECLOANCL1
     F***ACCNTPT*IF**E           K        DISK         KINFSR *PSSR       CPM005
     F***PACCNTP2O***E                    DISK         KINFSR *PSSR       CPM005
     FPMACCNL1IF  E           K        DISK         KINFSR *PSSR          CPM005
     FPMBACNL3O   E                    DISK         KINFSR *PSSR          CPM005
     F            ACCNTABF                          KRENAMEACCNTAB1
     FPMCPOSLLIF  E           K        DISK         KINFSR *PSSR
     F***PPMCPOS0O***E                    DISK         KINFSR *PSSR       CPM005
     F*********** PMCPOSP0                          KRENAMEPPMCPOSP       CPM005
     FPMBCPSL0O   E                    DISK         KINFSR *PSSR          CPM005
     F            PMCPOSP0                          KRENAMEPMBCPSP0       CPM005
     FLBPLEGLAIF  E           K        DISK         KINFSR *PSSR
     F***LBPLEGCUIF**E           K        DISK         KINFSR *PSSR       CPM005
     FLBPLEGLPIF  E           K        DISK         KINFSR *PSSR          CPM005
     F            LBPLEGD0                          KRENAMELBPLEGD1
     F***PLBPLEGPUF**E           K        DISK         KINFSR *PSSR A     CPM005
     F*********** LBPLEGD0                          KRENAMEPLBPLEGD       CPM005
     FPMBPLGL0UF  E           K        DISK         KINFSR *PSSR A        CPM005
     F            LBPLEGD0                          KRENAMEPMBPLGD0       CPM005
     F***SDMMODL0IF**E           K        DISK         KINFSR *PSSR       CPM005
      *****************************************************************
     E                    CPY@    1   1 80
      *
      *****************************************************************
      *
      **  LOCAL DATA AREA FOR DATA BASE ERRORS:
     ILDA         DS                            256
     I***********                           132 183 DBLOT                 CPM005
     I***********                           132 141 DBFILE                CPM005
     I                                      134 183 DBLOT                 CPM005
     I                                      134 141 DBFILE                CPM005
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
      **  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION:
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I***FDS1******* DS                                                   CPM005
     I***********                                                         CPM005
     I***FILE*STATUS*DATA*STRUCTURE*-*RECORD*FORMAT***********************CPM005
     I***********                          *RECORD  @FORM                 CPM005
     IFDS2        DS
     I*
     I** FILE STATUS DATA STRUCTURE - RECORD FORMAT
     I                                     *RECORD  @FORM0
     IFDS3        DS
     I*
     I** FILE STATUS DATA STRUCTURE - RECORD FORMAT
     I                                     *RECORD  @FORM1
      *
      ** OBTAIN EVENT CONTROL DATE
     IPMSTAT      DS                            256
     I                                        1   50WWECD
     I*                                                                   CPM005
     ISDMMOD    E DSSDMMODPD                                              CPM005
     I** EXTERNAL DS Module ID                                            CPM005
     I*                                                                   CPM005
     IDSFDY     E DSDSFDY                                                 CPM005
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                CPM005
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     -                                                       *
      * #INIT    - INITIAL PROCESSING                                    *
      * #MAIN    - MAIN PROCESSING                                       *
      * #TERM    - TERMINATION PROCESSING                                *
      * *PSSR    - ERROR IN FILE                                         *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      *                                                                  *
      ********************************************************************
     C                     EXSR #INIT
      *
     C                     EXSR #MAIN
      *
     C                     EXSR #TERM
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    - ERROR IN FILE                                         *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #INIT     BEGSR
      *
      **  PREPARE LDA:
     C           *NAMVAR   DEFN           LDA
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'PM6400'  DBPGM
      *
      **  GET INSTALLATION CONTROL DATA RECORD 1
     C************LOVAL    SETLLSDMMODL0                                  CPM005
     C***********          READ SDMMODL0                 71               CPM005
     C                     CALL 'AOMMODR0'                                CPM005
     C                     PARM *BLANKS   WRTCD   7                       CPM005
     C                     PARM '*FIRST ' WOPTN   7                       CPM005
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPM005
     C           WRTCD     IFNE *BLANKS                                   CPM005
     C************IN71     IFEQ '1'                        ***************CPM005
     C                     Z-ADD1         DBASE   30       **DB ERROR 01**
     C***********          MOVEL'SDMMODL0'DBFILE 10        ***************CPM005
     C                     MOVE 'SDMMODPD'DBFILE           ***************CPM005
     C                     MOVE *BLANKS   DBKEY  29
     C                     EXSR *PSSR
     C                     END
      *
      **  OBTAIN EVENT CONTROL MIDAS
     C           *NAMVAR   DEFN           PMSTAT
     C                     IN   PMSTAT
     C*
     C** KEY LIST FOR ACCESS TO LF/LBPLEGLA
     C           PLEGKY    KLIST
     C                     KFLD           PGCNUM
     C                     KFLD           PGBPSN
     C                     KFLD           PGSEQN
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #MAIN    - MAIN PROCESSING                                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZDATE2   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #MAIN     BEGSR
      *
     C**********           Z-ADD*ZEROS    WWCUST  60                                          CSD027
     C                     MOVE *BLANKS   WWCUST  6                                           CSD027
      *
     C           *LOVAL    SETLLPMPCBCL1
     C                     READ PMPCBCL1                 72
      *
     C           *IN72     DOWEQ'0'                        *B1
      *
      ** IF CHANGE OF CUSTOMER AND CHANGE DATE LOWER OR EQUAL THAN EVENT CONTROL
      ** DATE AND VALUATION STATEMENT ASKED
     C           FMCUST    IFNE WWCUST                     *B2
     C           FMCDAT    ANDLEWWECD
     C           FMSTFM    ANDNE*BLANKS
      *
      ** LOMBARD MODULE
     C           BGLMCR    IFEQ 'Y'                        *B21
      *
      ** EXTRACT DETAILS OF RECEIVER OF PLEDGES
     C           FMCUST    SETLLLBPLEGLA
     C           FMCUST    READELBPLEGLA                 73
      *
     C           *IN73     DOWEQ'0'                        *B3
      *
     C           PGRECI    IFEQ 'D'                        *B4
     C           PGRECI    OREQ 'M'
     C*
     C           PGTYPE    IFEQ 'P'                        *B5
     C           PGTYPE    OREQ 'C'
     C           PGTYPE    OREQ 'S'
      *                                                                   190347
      ** Before write check that record has not already been output.      190347
      *                                                                   190347
     C           PLEGKY    CHAINPMBPLGL0             60                   190347
     C           *IN60     IFEQ '1'                                       190347
     C***********          WRITEPLBPLEGD                                  CPM005
     C                     WRITEPMBPLGD0                                  CPM005
     C                     ENDIF                                          190347
     C                     END                             *E5
     C                     END                             *E4
      *
     C           FMCUST    READELBPLEGLA                 73
     C                     END                             *E3
      *
      ** EXTRACT DETAILS OF GIVER OF PLEDGES
     C***********FMCUST    SETLLLBPLEGCU                                  CPM005
     C***********FMCUST    READELBPLEGCU                 73               CPM005
     C           FMCUST    SETLLLBPLEGLP                                  CPM005
     C           FMCUST    READELBPLEGLP                 73               CPM005
      *
     C           *IN73     DOWEQ'0'                        *B3
      *
     C           PGRECI    IFEQ 'D'                        *B4
     C           PGRECI    OREQ 'M'
     C*
     C           PGTYPE    IFEQ 'P'                        *B5
     C           PGTYPE    OREQ 'C'
     C           PGTYPE    OREQ 'S'
     C*
     C** BEFORE WRITE CHECK THAT RECORD HAS NOT ALREADY BEEN OUTPUT
     C***********PLEGKY    CHAINPLBPLEGP             60                   CPM005
     C           PLEGKY    CHAINPMBPLGL0             60                   CPM005
     C           *IN60     IFEQ '1'
     C***********          WRITEPLBPLEGD                                  CPM005
     C                     WRITEPMBPLGD0                                  CPM005
     C                     END
     C*
     C                     END                             *E5
     C                     END                             *E4
      *
     C***********FMCUST    READELBPLEGCU                 73               CPM005
     C           FMCUST    READELBPLEGLP                 73               CPM005
     C                     END                             *E3
     C                     END                             *E21
      ***********                                                         CPM005
      ***FIDUCIARY*MODULE*************************************************CPM005
     C***********BGFLND    IFEQ 'Y'                        *B21           CPM005
      ***********                                                         CPM005
     C***********FMCUST    SETLLFIDPLNP2                                  CPM005
     C***********FMCUST    READEFIDPLNP2                 73               CPM005
      ***********                                                         CPM005
     C************IN73     DOWEQ'0'                        *B3            CPM005
      ***********                                                         CPM005
     C***********@FORM     IFEQ 'FIDEPOD0'                 *B4            CPM005
     C***********          WRITEPFIDEPO0                                  CPM005
     C***********          ELSE                                           CPM005
     C***********          WRITEPFILOAN0                                  CPM005
     C***********          END                             *E4            CPM005
      ***********                                                         CPM005
     C***********FMCUST    READEFIDPLNP2                 73               CPM005
     C***********          END                             *E3            CPM005
     C***********          END                             *E21           CPM005
      *
      ** FUTURES AND OPTIONS MODULE
     C           BGFUOP    IFEQ 'Y'                        *B21
      *
     C************LOVAL    SETLLTRANSP2                                   CPM005
     C***********          READ TRANSP2                  73               CPM005
     C           *LOVAL    SETLLPMTRANL0                                  CPM005
     C                     READ PMTRANL0                 73               CPM005
      *
     C           *IN73     DOWEQ'0'                        *B3
      *
     C           FMCUST    IFEQ CUSC                       *B4
     C                     WRITETRANSDF1
     C                     END                             *E4
      *
     C***********          READ TRANSP2                  73               CPM005
     C                     READ PMTRANL0                 73               CPM005
     C                     END                             *E3
     C                     END                             *E21
      *
      ** DEALING MODULE
     C           BGDLFX    IFEQ 'Y'                        *B21
     C           BGDLMM    OREQ 'Y'
      *
     C***********FMCUST    SETLLDEALSP2                                   CPM005
     C***********FMCUST    READEDEALSP2                  73               CPM005
     C           FMCUST    SETLLPMDEALL2                                  CPM005
     C           FMCUST    READEPMDEALL2                 73               CPM005
      *
     C           *IN73     DOWEQ'0'                        *B3
      *
     C           @FORM1    IFEQ 'DEALSDBF'                 *B4
     C                     WRITEDEALSDB1
     C                     ELSE
     C                     WRITEDEALSDC1
     C                     END                             *E4
      *
     C***********FMCUST    READEDEALSP2                  73               CPM005
     C           FMCUST    READEPMDEALL2                 73               CPM005
     C                     END                             *E3
     C                     END                             *E21
      *
      ** LENDING MODULE
     C           BGCSLN    IFEQ 'Y'                        *B21
      *
     C***********FMCUST    SETLLCLOANP2                                   CPM005
     C***********FMCUST    READECLOANP2                  73               CPM005
     C           FMCUST    SETLLPMCLONL2                                  CPM005
     C           FMCUST    READEPMCLONL2                 73               CPM005
      *
     C           *IN73     DOWEQ'0'                        *B3
      *
     C           FMCUST    IFEQ CNUM                       *B4
     C                     WRITECLOANCL1
     C                     END                             *E4
      *
     C***********FMCUST    READECLOANP2                  73               CPM005
     C           FMCUST    READEPMCLONL2                 73               CPM005
     C                     END                             *E3
      *
     C                     END                             *E21
      *
      ** RETAIL MODULE
     C           BGRTBN    IFEQ 'Y'                        *B21
      *
     C***********FMCUST    SETLLACCNTPT                                   CPM005
     C***********FMCUST    READEACCNTPT                  73               CPM005
     C           FMCUST    SETLLPMACCNL1                                  CPM005
     C           FMCUST    READEPMACCNL1                 73               CPM005
      *
     C           *IN73     DOWEQ'0'                        *B3
      *
     C           PTFR      IFNE *BLANKS                    *B4
     C           ATYP      ANDEQ'R'
     C           RECI      ANDEQ'D'
     C                     WRITEACCNTAB1
     C                     END                             *E4
      *
     C***********FMCUST    READEACCNTPT                  73               CPM005
     C           FMCUST    READEPMACCNL1                 73               CPM005
     C                     END                             *E3
     C                     END                             *E21
      *
      ** SECURITIES MODULE
     C           BGSECS    IFEQ 'Y'                        *B21
      *
     C           FMCUST    SETLLPMCPOSLL
     C           FMCUST    READEPMCPOSLL                 73
      *
     C           *IN73     DOWEQ'0'                        *B3
      *
     C***********          WRITEPPMCPOSP                                  CPM005
     C                     WRITEPMBCPSP0                                  CPM005
      *
     C           FMCUST    READEPMCPOSLL                 73
     C                     END                             *E3
     C                     END                             *E21
      *
     C**********           Z-ADDFMCUST    WWCUST                                              CSD027
     C                     MOVE FMCUST    WWCUST                                              CSD027
     C                     END                             *E2
      *
     C                     READ PMPCBCL1                 72
     C                     END                             *E1
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * #TERM    - TERMINATION PROCESSING                                *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           #TERM     BEGSR
      *
     C                     MOVE '1'       *INLR
     C                     RETRN
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    - ERROR IN FILE                                         *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * #INIT    - INITIAL PROCESSING                                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           *PSSR     BEGSR
      *
     C           *LOCK     IN   LDA
     C                     OUT  LDA
      *
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     DUMP
      *
     C                     RETRN
      *
     C                     ENDSR
     C**=================================================================
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
